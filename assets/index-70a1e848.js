(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();const GIe="modulepreload",jIe=function(t,e){return new URL(t,e).href},zte={},ce=function(e,i,r){if(!i||i.length===0)return e();const n=document.getElementsByTagName("link");return Promise.all(i.map(s=>{if(s=jIe(s,r),s in zte)return;zte[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let h=n.length-1;h>=0;h--){const d=n[h];if(d.href===s&&(!o||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":GIe,o||(c.as="script",c.crossOrigin=""),c.href=s,document.head.appendChild(c),o)return new Promise((h,d)=>{c.addEventListener("load",h),c.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e()).catch(s=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s})};function u(t,e,i,r){var n,s=arguments.length,o=s<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,i):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,i,o):n(e,i))||o);return s>3&&o&&Object.defineProperty(e,i,o),o}function iRt(t,e,i,r){function n(s){return s instanceof i?s:new i(function(o){o(s)})}return new(i||(i=Promise))(function(s,o){function a(h){try{c(r.next(h))}catch(d){o(d)}}function l(h){try{c(r.throw(h))}catch(d){o(d)}}function c(h){h.done?s(h.value):n(h.value).then(a,l)}c((r=r.apply(t,e||[])).next())})}let V_;function ie(t){return typeof V_[t]=="function"?V_[t]=V_[t](globalThis):V_[t]}V_=globalThis.dojoConfig?.has||globalThis.esriConfig?.has?{...globalThis.dojoConfig?.has,...globalThis.esriConfig?.has}:{},ie.add=(t,e,i,r)=>((r||V_[t]===void 0)&&(V_[t]=e),i&&ie(t)),ie.cache=V_,ie.add("big-integer-warning-enabled",!0),ie.add("esri-deprecation-warnings",!0),ie.add("esri-tests-disable-screenshots",!1),ie.add("esri-tests-use-full-window",!1),ie.add("esri-tests-post-to-influx",!0),(()=>{ie.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const t=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(ie.add("host-browser",t),ie.add("host-node",typeof globalThis.process=="object"&&globalThis.process.versions?.node&&globalThis.process.versions.v8),ie.add("dom",t),ie("host-browser")){const e=navigator,i=e.userAgent,r=e.appVersion,n=parseFloat(r);if(ie.add("wp",parseFloat(i.split("Windows Phone")[1])||void 0),ie.add("msapp",parseFloat(i.split("MSAppHost/")[1])||void 0),ie.add("khtml",r.includes("Konqueror")?n:void 0),ie.add("edge",parseFloat(i.split("Edge/")[1])||void 0),ie.add("opr",parseFloat(i.split("OPR/")[1])||void 0),ie.add("webkit",!ie("wp")&&!ie("edge")&&parseFloat(i.split("WebKit/")[1])||void 0),ie.add("chrome",!ie("edge")&&!ie("opr")&&parseFloat(i.split("Chrome/")[1])||void 0),ie.add("android",!ie("wp")&&parseFloat(i.split("Android ")[1])||void 0),ie.add("safari",!r.includes("Safari")||ie("wp")||ie("chrome")||ie("android")||ie("edge")||ie("opr")?void 0:parseFloat(r.split("Version/")[1])),ie.add("mac",r.includes("Macintosh")),!ie("wp")&&/(iPhone|iPod|iPad)/.test(i)){const s=RegExp.$1.replace(/P/,"p"),o=/OS ([\d_]+)/.test(i)?RegExp.$1:"1",a=parseFloat(o.replace(/_/,".").replaceAll("_",""));ie.add(s,a),ie.add("ios",a)}ie("webkit")||(!i.includes("Gecko")||ie("wp")||ie("khtml")||ie("edge")||ie.add("mozilla",n),ie("mozilla")&&ie.add("ff",parseFloat(i.split("Firefox/")[1]||i.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const t=navigator.userAgent,e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(t),i=/iPhone/i.test(t);e&&ie.add("esri-mobile",e),i&&ie.add("esri-iPhone",i),ie.add("esri-geolocation",!!navigator.geolocation)}ie.add("esri-wasm","WebAssembly"in globalThis),ie.add("esri-performance-mode-frames-between-render",20),ie.add("esri-force-performance-mode",!1),ie.add("esri-shared-array-buffer",()=>{const t="SharedArrayBuffer"in globalThis,e=globalThis.crossOriginIsolated===!1;return t&&!e}),ie.add("wasm-simd",()=>{const t=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(t))}),ie.add("esri-atomics","Atomics"in globalThis),ie.add("esri-workers","Worker"in globalThis),ie.add("web-feat:cache","caches"in globalThis),ie.add("esri-workers-arraybuffer-transfer",!ie("safari")||Number(ie("safari"))>=12),ie.add("workers-pool-size",8),ie.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),ie.add("featurelayer-simplify-payload-size-factors",[1,1,4]),ie.add("featurelayer-animation-enabled",!0),ie.add("featurelayer-snapshot-enabled",!0),ie.add("featurelayer-snapshot-point-min-threshold",8e4),ie.add("featurelayer-snapshot-point-max-threshold",4e5),ie.add("featurelayer-snapshot-point-coverage",.1),ie.add("featurelayer-advanced-symbols",!1),ie.add("featurelayer-pbf",!0),ie.add("featurelayer-pbf-statistics",!1),ie.add("feature-layers-workers",!0),ie.add("feature-polyline-generalization-factor",1),ie.add("mapview-transitions-duration",200),ie.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),ie.add("mapserver-pbf-version-support",10.81),ie.add("mapservice-popup-identify-max-tolerance",20),ie.add("heatmap-allow-raster-fallback",!1),ie.add("heatmap-force-raster",!1),ie("host-webworker")||ie("host-browser")&&(ie.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),ie.add("esri-image-decode",()=>{if("decode"in new Image){const t=new Image;return t.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void t.decode().then(()=>{ie.add("esri-image-decode",!0,!0,!0)}).catch(()=>{ie.add("esri-image-decode",!1,!0,!0)})}return!1}),ie.add("esri-url-encodes-apostrophe",()=>{const t=window.document.createElement("a");return t.href="?'",t.href.includes("?%27")}))})();let kO=class sb{constructor(e=1){this._seed=e}set seed(e){this._seed=e??Math.random()*sb._m}getInt(){return this._seed=(sb._a*this._seed+sb._c)%sb._m,this._seed}getFloat(){return this.getInt()/(sb._m-1)}getIntRange(e,i){return Math.round(this.getFloatRange(e,i))}getFloatRange(e,i){const r=i-e;return e+this.getInt()/sb._m*r}};kO._m=2147483647,kO._a=48271,kO._c=0;const e6=1.5,HIe=1/e6,qIe=.5;function t6(t,e){return e?t.filter((i,r,n)=>n.findIndex(e.bind(null,i))===r):Array.from(new Set(t))}function vy(t,e,i){if(t==null&&e==null)return!0;if(t==null||e==null||t.length!==e.length)return!1;if(i){for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1}else for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function EX(t,e){let i=t.length!==e.length;i&&(t.length=e.length);for(let r=0;r<e.length;++r)t[r]!==e[r]&&(t[r]=e[r],i=!0);return i}function WIe(t,e,i){let r,n;return i?(r=e.filter(s=>!t.some(o=>i(o,s))),n=t.filter(s=>!e.some(o=>i(o,s)))):(r=e.filter(s=>!t.includes(s)),n=t.filter(s=>!e.includes(s))),{added:r,removed:n}}function YIe(t){return t&&typeof t.length=="number"}function rRt(t,e){const i=t.length;if(i===0)return[];const r=[];for(let n=0;n<i;n+=e)r.push(t.slice(n,n+e));return r}const XIe=!!Array.prototype.fill;function nRt(t,e){if(XIe)return new Array(t).fill(e);const i=new Array(t);for(let r=0;r<t;r++)i[r]=e;return i}function ZIe(t,e){e===void 0&&(e=t,t=0);const i=new Array(e-t);for(let r=t;r<e;r++)i[r-t]=r;return i}function JIe(t,e,i){const r=t.length;let n=0,s=r-1;for(;n<s;){const a=n+Math.floor((s-n)/2);e>t[a]?n=a+1:s=a}const o=t[n];return i?e>=t[r-1]?-1:o===e?n:n-1:o===e?n:-1}let _me=class{constructor(){this.last=0}};const vme=new _me;function KV(t,e,i,r){r=r||vme;const n=Math.max(0,r.last-10);for(let o=n;o<i;++o)if(t[o]===e)return r.last=o,o;const s=Math.min(n,i);for(let o=0;o<s;++o)if(t[o]===e)return r.last=o,o;return-1}function WR(t,e,i,r){const n=i??t.length,s=KV(t,e,n,r);if(s!==-1)return t[s]=t[n-1],i==null&&t.pop(),e}const _d=new Set;function KIe(t,e,i=t.length,r=e.length,n,s){if(r===0||i===0)return i;_d.clear();for(let a=0;a<r;++a)_d.add(e[a]);n=n||vme;const o=Math.max(0,n.last-10);for(let a=o;a<i;++a)if(_d.has(t[a])&&(s?.push(t[a]),_d.delete(t[a]),t[a]=t[i-1],--i,--a,_d.size===0||i===0))return _d.clear(),i;for(let a=0;a<o;++a)if(_d.has(t[a])&&(s?.push(t[a]),_d.delete(t[a]),t[a]=t[i-1],--i,--a,_d.size===0||i===0))return _d.clear(),i;return _d.clear(),i}function QIe(t,e){let i=0;for(let r=0;r<t.length;++r){const n=t[r];e(n,r)&&(t[i]=n,i++)}t.length=i}function eLe(t){return t?(Bte.seed=t,()=>Bte.getFloat()):Math.random}function oRt(t,e){const i=eLe(e);for(let r=t.length-1;r>0;r--){const n=Math.floor(i()*(r+1)),s=t[r];t[r]=t[n],t[n]=s}return t}const Bte=new kO;function CX(t,e){const i=t.indexOf(e);return i!==-1?(t.splice(i,1),e):null}function aRt(t,e){const i=new Map,r=t.length;for(let n=0;n<r;n++){const s=t[n],o=e(s,n,t),a=i.get(o);a?a.push(s):i.set(o,[s])}return i}function Yv(t,e){return t!=null}const tLe=[];function bme(t){return 32+t.length}function AX(){return 16}function wme(t){if(!t)return 0;let e=Sme;for(const i in t)if(t.hasOwnProperty(i)){const r=t[i];switch(typeof r){case"string":e+=bme(r);break;case"number":e+=AX();break;case"boolean":e+=4}}return e}function xme(t){if(!t)return 0;if(Array.isArray(t))return iLe(t);let e=Sme;for(const i in t)t.hasOwnProperty(i)&&(e+=Tme(t[i]));return e}function iLe(t){const e=t.length;if(e===0||typeof t[0]=="number")return 32+8*e;let i=Eme;for(let r=0;r<e;r++)i+=Tme(t[r]);return i}function Tme(t){switch(typeof t){case"object":return xme(t);case"string":return bme(t);case"number":return AX();case"boolean":return 4;default:return 8}}function rLe(t,e){return Eme+t.length*e}const Sme=32,Eme=32;function i3(t){return t instanceof ArrayBuffer}function OX(t){return t?.constructor?.name==="Int8Array"}function G_(t){return t?.constructor?.name==="Uint8Array"}function Cme(t){return t?.constructor?.name==="Uint8ClampedArray"}function RX(t){return t?.constructor?.name==="Int16Array"}function i6(t){return t?.constructor?.name==="Uint16Array"}function PX(t){return t?.constructor?.name==="Int32Array"}function r6(t){return t?.constructor?.name==="Uint32Array"}function _C(t){return t?.constructor?.name==="Float32Array"}function vC(t){return t?.constructor?.name==="Float64Array"}function Kh(t){return!("buffer"in t)}function gv(...t){return t.reduce((e,i)=>e+(i?Kh(i)?rLe(i,AX()):i.byteLength+Ame:0),0)}const Ame=145,Ju=1024;function nLe(t){return vC(t)||_C(t)||PX(t)||RX(t)||OX(t)}function sLe(t){return vC(t)||_C(t)}function oLe(t){return vC(t)?179769e303:_C(t)?3402823e32:r6(t)?4294967295:i6(t)?65535:G_(t)||Cme(t)?255:PX(t)?2147483647:RX(t)?32767:OX(t)?127:256}function n6(t,e){let i;if(e)for(i in t)t.hasOwnProperty(i)&&(t[i]===void 0?delete t[i]:t[i]instanceof Object&&n6(t[i],!0));else for(i in t)t.hasOwnProperty(i)&&t[i]===void 0&&delete t[i];return t}function Q(t){if(!t||typeof t!="object"||typeof t=="function")return t;const e=Pme(t);if(e!=null)return e;if(s5(t))return t.clone();if(Ome(t))return t.map(Q);if(Rme(t))return t.clone();const i={};for(const r of Object.getOwnPropertyNames(t))i[r]=Q(t[r]);return i}function QV(t){if(!t||typeof t!="object"||typeof t=="function"||"HTMLElement"in globalThis&&t instanceof HTMLElement)return t;const e=Pme(t);if(e!=null)return e;if(Ome(t)){let i=!0;const r=t.map(n=>{const s=QV(n);return n!=null&&s==null&&(i=!1),s});return i?r:null}if(s5(t))return t.clone();if(t instanceof File||t instanceof Blob)return t;if(!Rme(t)){const i=new(Object.getPrototypeOf(t)).constructor;for(const r of Object.getOwnPropertyNames(t)){const n=t[r],s=QV(n);if(n!=null&&s==null)return null;i[r]=s}return i}return null}function s5(t){return typeof t.clone=="function"}function Ome(t){return typeof t.map=="function"&&typeof t.forEach=="function"}function Rme(t){return typeof t.notifyChange=="function"&&typeof t.watch=="function"}function Vte(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function Pme(t){if(OX(t)||G_(t)||Cme(t)||RX(t)||i6(t)||PX(t)||r6(t)||_C(t)||vC(t))return t.slice();if(t instanceof Date)return new Date(t.getTime());if(t instanceof ArrayBuffer)return t.slice(0,t.byteLength);if(t instanceof Map){const e=new Map;for(const[i,r]of t)e.set(i,Q(r));return e}if(t instanceof Set){const e=new Set;for(const i of t)e.add(Q(i));return e}return null}function MX(t,e){return t===e||typeof t=="number"&&isNaN(t)&&typeof e=="number"&&isNaN(e)||typeof t?.getTime=="function"&&typeof e?.getTime=="function"&&t.getTime()===e.getTime()||!1}function Mme(t,e){return t===e||(t==null||typeof t=="string"?t===e:typeof t=="number"?t===e||typeof e=="number"&&isNaN(t)&&isNaN(e):t instanceof Date?e instanceof Date&&t.getTime()===e.getTime():Array.isArray(t)?Array.isArray(e)&&vy(t,e):t instanceof Set?e instanceof Set&&lLe(t,e):t instanceof Map?e instanceof Map&&cLe(t,e):!!Vte(t)&&Vte(e)&&aLe(t,e))}function aLe(t,e){if(t===null||e===null)return!1;const i=Object.keys(t);if(e===null||Object.keys(e).length!==i.length)return!1;for(const r of i)if(t[r]!==e[r]||!Object.prototype.hasOwnProperty.call(e,r))return!1;return!0}function lLe(t,e){if(t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0}function cLe(t,e){if(t.size!==e.size)return!1;for(const[i,r]of t){const n=e.get(i);if(n!==r||n===void 0&&!e.has(i))return!1}return!0}function $X(t,e,i=!1){return Ime(t,e,i)}function Jg(t,e){if(e!=null)return e[t]||$me(t.split("."),!1,e)}function Mp(t,e,i){const r=t.split("."),n=r.pop(),s=$me(r,!0,i);s&&n&&(s[n]=e)}function $me(t,e,i){let r=i;for(const n of t){if(r==null)return;if(!(n in r)){if(!e)return;r[n]={}}r=r[n]}return r}function Ime(t,e,i){return e?Object.keys(e).reduce((r,n)=>{let s=r[n],o=e[n];return s===o?r:s===void 0?(r[n]=Q(o),r):(Array.isArray(o)||Array.isArray(r)?(s=s?Array.isArray(s)?r[n]=s.concat():r[n]=[s]:r[n]=[],o&&(Array.isArray(o)||(o=[o]),i?o.forEach(a=>{s.includes(a)||s.push(a)}):r[n]=o.concat())):o&&typeof o=="object"?r[n]=Ime(s,o,i):r.hasOwnProperty(n)&&!e.hasOwnProperty(n)||(r[n]=o),r)},t||{}):t}const Di={apiKey:void 0,applicationName:"",applicationUrl:globalThis.location?.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!0,portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&($X(Di,globalThis.esriConfig,!0),delete Di.has),!Di.assetsPath){{const t="4.28";Di.assetsPath=`https://js.arcgis.com/${t}/@arcgis/core/assets`}Di.defaultAssetsPath=Di.assetsPath}const uLe=/\{([^\}]+)\}/g;function Gte(t){return t??""}function s6(t,e){return e?t.replaceAll(uLe,typeof e=="object"?(i,r)=>Gte(Jg(r,e)):(i,r)=>Gte(e(r))):t}function lRt(t,e){return t.replaceAll(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,i=>e&&e.includes(i)?i:`\\${i}`)}function IX(t){let e=0;for(let i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i),e|=0;return e}function cRt(t){return new DOMParser().parseFromString(t||"","text/html").body.innerText||""}function uRt(t,e){return new RegExp(`{${e}}`,"ig").test(t)}const jte={info:0,warn:1,error:2,none:3};let K=class Za{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},e.level!=null&&(this.level=e.level),e.writer!=null&&(this.writer=e.writer),this._module=e.module,Za._loggers.set(this.module,this);const i=this.module.lastIndexOf(".");i!==-1&&(this._parent=Za.getLogger(this.module.slice(0,i)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){const e=this;return{loggedMessages:e._loggedMessages,clearLoggedWarnings:()=>e._loggedMessages.warn.clear()}}static get test(){return{resetLoggers(e=new Map){const i=Za._loggers;return Za._loggers=e,i},set throttlingDisabled(e){Za._throttlingDisabled=e}}}static getLogger(e){return e=typeof e!="string"?e.declaredClass:e,Za._loggers.get(e)||new Za({module:e})}_log(e,i,...r){if(this._matchLevel(e)){if(i!=="always"&&!Za._throttlingDisabled){const n=this._argsToKey(r),s=this._loggedMessages[e].get(n);if(i==="once"&&s!=null||i==="oncePerTick"&&s&&s>=Za._tickCounter)return;this._loggedMessages[e].set(n,Za._tickCounter),Za._scheduleTickCounterIncrement()}for(const n of Di.log.interceptors)if(n(e,this.module,...r))return;this._inheritedWriter()(e,this.module,...r)}}_parentWithMember(e,i){let r=this;for(;r!=null;){const n=r[e];if(n!=null)return n;r=r.parent}return i}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(e,i,...r){console[e](`[${i}]`,...r)}_matchLevel(e){const i=Di.log.level||"warn";return jte[this._parentWithMember("level",i)]<=jte[e]}_argsToKey(...e){return IX(JSON.stringify(e,(r,n)=>typeof n!="object"||Array.isArray(n)?n:"[Object]"))}static _scheduleTickCounterIncrement(){Za._tickCounterScheduled||(Za._tickCounterScheduled=!0,Promise.resolve().then(()=>{Za._tickCounter++,Za._tickCounterScheduled=!1}))}};K._loggers=new Map,K._tickCounter=0,K._tickCounterScheduled=!1,K._throttlingDisabled=!1;function hLe(t,e){return t.replaceAll(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(i,r)=>r===""?"$":(Jg(r,e)??"").toString())}let Lme=class{constructor(e,i,r){this.name=e,this.details=r,this.message=(i&&hLe(i,r))??""}toString(){return"["+this.name+"]: "+this.message}},G=class Dme extends Lme{constructor(e,i,r){super(e,i,r)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(e,i)=>{if(i&&typeof i=="object"&&typeof i.toJSON=="function")return i;try{return Q(i)}catch{return"[object]"}}))}}catch(e){throw K.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new Dme(e.name,e.message,e.details)}};G.prototype.type="error";const Hte=new Set;function dLe(t,e,i=!1){i&&Hte.has(e)||(i&&Hte.add(e),t.warn(`🛑 DEPRECATED - ${e}`))}function Nme(t,e,i={}){if(ie("esri-deprecation-warnings")){const{moduleName:r}=i;xE(t,`Function: ${(r?r+"::":"")+e+"()"}`,i)}}function Kg(t,e,i={}){if(ie("esri-deprecation-warnings")){const{moduleName:r}=i;xE(t,`Property: ${(r?r+"::":"")+e}`,i)}}function xE(t,e,i={}){if(ie("esri-deprecation-warnings")){const{replacement:r,version:n,see:s,warnOnce:o}=i;let a=e;r&&(a+=`
	🛠️ Replacement: ${r}`),n&&(a+=`
	⚙️ Version: ${n}`),s&&(a+=`
	🔗 See ${s} for more details.`),dLe(t,a,o)}}function dRt(t){const e=[];return function*(){yield*e;for(const i of t)e.push(i),yield i}}function pLe(t,e){for(const i of t)if(i!=null&&e(i))return i}function e7(t){return t!=null&&typeof t[Symbol.iterator]=="function"}let Ny=class t7{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(i=>{e+=i.length}),e}add(e,i){if(e7(e)){const r=this._getOrCreateGroup(i);for(const n of e)this._isHandle(n)&&r.push(n)}else this._isHandle(e)&&this._getOrCreateGroup(i).push(e);return this}forEach(e,i){if(typeof e=="function")this._groups.forEach(r=>r.forEach(e));else{const r=this._getGroup(e);r&&i&&r.forEach(i)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(typeof e!="string"&&e7(e)){for(const i of e)this.remove(i);return this}return this.has(e)?(this._removeAllFromGroup(this._getGroup(e)),this._groups.delete(this._ensureGroupKey(e)),this):this}removeAll(){return this._groups.forEach(e=>this._removeAllFromGroup(e)),this._groups.clear(),this}_isHandle(e){return e&&(!!e.remove||e instanceof t7)}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const i=[];return this._groups.set(this._ensureGroupKey(e),i),i}_getGroup(e){return this._groups.get(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}_removeAllFromGroup(e){for(const i of e)i instanceof t7?i.removeAll():i.remove()}};function o6(t,e){if(t==null)throw new Error(e??"value is None")}function $e(t){return t?.destroy(),null}function rt(t){return t?.dispose(),null}function Tr(t){return t?.remove(),null}function Gc(t){return t?.abort(),null}function li(t){return t?.release(),null}function fLe(t,e,i){return t!=null&&e!=null?i!=null?i(t,e):t.equals(e):t===e}function qte(t,e){return t?.[e]}const Fme=Symbol("Accessor-beforeDestroy"),mLe={remove:()=>{}};function Vi(t){return t?{remove(){t&&(t(),t=void 0)}}:mLe}function gLe(t){t.forEach(e=>e?.remove())}function yv(t){return Vi(()=>gLe(t))}function kme(t){return Vi(t!=null?()=>t.destroy():void 0)}function Jl(t){return t.__accessor__??null}function yLe(t,e){return t?.metadatas?.[e]!=null}function BD(t,e,i){return i?o5(t,e,{policy:i,path:""}):o5(t,e,null)}function o5(t,e,i){return e?Object.keys(e).reduce((r,n)=>{const s=n;let o=null,a="merge";if(i&&(o=i.path?`${i.path}.${n}`:n,a=i.policy(o)),a==="replace"||a==="replace-arrays"&&Array.isArray(r[s]))return r[s]=e[s],r;if(r[s]===void 0)return r[s]=Q(e[s]),r;let l=r[s],c=e[s];if(l===c)return r;if(Array.isArray(c)||Array.isArray(r))l=l?Array.isArray(l)?r[s]=l.concat():r[s]=[l]:r[s]=[],c&&(Array.isArray(c)||(c=[c]),c.forEach(h=>{l.includes(h)||l.push(h)}));else if(c&&typeof c=="object")if(i){const h=i.path;i.path=o,r[s]=o5(l,c,i),i.path=h}else r[s]=o5(l,c,null);else r.hasOwnProperty(n)&&!e.hasOwnProperty(n)||(r[s]=c);return r},t||{}):t}function Ume(t){return Array.isArray(t)?t:t.split(".")}function Wte(t){return t.includes(",")?t.split(",").map(e=>e.trim()):[t.trim()]}function _Le(t){if(Array.isArray(t)){const e=[];for(const i of t)e.push(...Wte(i));return e}return Wte(t)}function zme(t,e,i,r){const n=_Le(e);if(n.length!==1){const s=n.map(o=>r(t,o,i));return yv(s)}return r(t,n[0],i)}function Bme(t,e){const i=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const n=parseInt(i,10);if(!isNaN(n))return Array.isArray(e)?e[n]:e.at(n)}const r=Jl(e);return yLe(r,i)?r.get(i):e[i]}function Vme(t,e,i){if(t==null)return t;const r=Bme(e[i],t);return!r&&i<e.length-1?void 0:i===e.length-1?r:Vme(r,e,i+1)}function iM(t,e,i=0){return typeof e!="string"||e.includes(".")?Vme(t,Ume(e),i):Bme(e,t)}function Hl(t,e){return iM(t,e)}function Yte(t,e){return iM(e,t)!==void 0}function rM(t){let e=t.constructor.__accessorMetadata__;const i=Object.prototype.hasOwnProperty.call(t.constructor,"__accessorMetadata__");if(e){if(!i){e=Object.create(e);for(const r in e)e[r]=Q(e[r]);Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0})}}else e={},Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0});return t.constructor.__accessorMetadata__}function a6(t,e){const i=rM(t);let r=i[e];return r||(r=i[e]={}),r}function vLe(t,e){return BD(t,e,wLe)}const bLe=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function wLe(t){return bLe.test(t)?"replace":"merge"}function xLe(t){return t?.release&&typeof t.release=="function"}function TLe(t){return t?.acquire&&typeof t.acquire=="function"}let $a=class i7{constructor(e,i,r,n=1,s=0){if(this._ctor=e,this._acquireFunction=i,this._releaseFunction=r,this.allocationSize=n,this._pool=new Array(s),this._initialSize=s,this._ctor)for(let o=0;o<s;o++)this._pool[o]=new this._ctor;this.allocationSize=Math.max(n,1)}destroy(){this.prune(0)}acquire(...e){let i;if(i7.test.disabled)i=new this._ctor;else{if(this._pool.length===0){const r=this.allocationSize;for(let n=0;n<r;n++)this._pool[n]=new this._ctor}i=this._pool.pop()}return this._acquireFunction?this._acquireFunction(i,...e):TLe(i)&&i.acquire(...e),i}release(e){e&&!i7.test.disabled&&(this._releaseFunction?this._releaseFunction(e):xLe(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let i=e;i<this._pool.length;++i){const r=this._pool[i];this._dispose(r)}this._pool.length=e}}_dispose(e){e.dispose&&typeof e.dispose=="function"&&e.dispose()}};$a.test={disabled:!1};var Yg;(function(t){t[t.INITIALIZING=0]="INITIALIZING",t[t.CONSTRUCTING=1]="CONSTRUCTING",t[t.CONSTRUCTED=2]="CONSTRUCTED"})(Yg||(Yg={}));let SLe=class{constructor(e,i){this._observers=e,this._observer=i}remove(){CX(this._observers,this._observer)}},Gme=class{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return ELe;this._observers==null&&(this._observers=[]);const i=this._observers;let r=!1,n=!1;const s=i.length;for(let o=0;o<s;++o){const a=i[o];if(a.destroyed)n=!0;else if(a===e){r=!0;break}}return r||(i.push(e),n&&this._removeDestroyedObservers()),new SLe(i,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||e.length===0)return;const i=e.length;let r=0;for(let n=0;n<i;++n){for(;n+r<i&&e[n+r].destroyed;)++r;if(r>0){if(!(n+r<i))break;e[n]=e[n+r]}}e.length=i-r}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(e!=null){for(const i of e)i.onCommitted();this._observers=null}}};const ELe=Vi();var Ci;(function(t){t[t.DEFAULTS=0]="DEFAULTS",t[t.COMPUTED=1]="COMPUTED",t[t.SERVICE=2]="SERVICE",t[t.PORTAL_ITEM=3]="PORTAL_ITEM",t[t.WEB_SCENE=4]="WEB_SCENE",t[t.WEB_MAP=5]="WEB_MAP",t[t.LINK_CHART=6]="LINK_CHART",t[t.USER=7]="USER"})(Ci||(Ci={}));const r7=Ci.USER+1;function j_(t){switch(t){case"defaults":return Ci.DEFAULTS;case"service":return Ci.SERVICE;case"portal-item":return Ci.PORTAL_ITEM;case"web-scene":return Ci.WEB_SCENE;case"web-map":return Ci.WEB_MAP;case"link-chart":return Ci.LINK_CHART;case"user":return Ci.USER;default:return null}}function a5(t){switch(t){case Ci.DEFAULTS:return"defaults";case Ci.SERVICE:return"service";case Ci.PORTAL_ITEM:return"portal-item";case Ci.WEB_SCENE:return"web-scene";case Ci.WEB_MAP:return"web-map";case Ci.LINK_CHART:return"link-chart";case Ci.USER:return"user"}}function CLe(t){return a5(t)}var kr;(function(t){t[t.Dirty=1]="Dirty",t[t.Overriden=2]="Overriden",t[t.Computing=4]="Computing",t[t.NonNullable=8]="NonNullable",t[t.HasDefaultValue=16]="HasDefaultValue",t[t.DepTrackingInitialized=32]="DepTrackingInitialized",t[t.AutoTracked=64]="AutoTracked",t[t.ExplicitlyTracking=128]="ExplicitlyTracking"})(kr||(kr={}));const l5={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},r3=[];let UO=l5;function Mt(t){UO.onObservableAccessed(t)}let VD=!1,GD=!1;function by(t,e,i){if(VD)return LX(t,e,i);jme(t);const r=e.call(i);return Hme(),r}function ALe(t,e){return by(l5,t,e)}function LX(t,e,i){const r=VD;VD=!0,jme(t);let n=null;try{n=e.call(i)}catch(s){GD&&K.getLogger("esri.core.accessorSupport.tracking").error(s)}return Hme(),VD=r,n}function jme(t){UO=t,r3.push(t)}function Hme(){const t=r3.length;if(t>1){const e=r3.pop();UO=r3[t-2],e.onTrackingEnd()}else if(t===1){const e=r3.pop();UO=l5,e.onTrackingEnd()}else UO=l5}function qme(t,e){if(e.flags&kr.DepTrackingInitialized)return;const i=GD;GD=!1,e.flags&kr.AutoTracked?LX(e,e.metadata.get,t):Wme(t,e),GD=i}const OLe=[];function Wme(t,e){e.flags&kr.ExplicitlyTracking||(e.flags|=kr.ExplicitlyTracking,LX(e,()=>{const i=e.metadata.dependsOn||OLe;for(const r of i)if(typeof r!="string"||r.includes(".")){const n=Ume(r);for(let s=0,o=t;s<n.length&&o!=null&&typeof o=="object";++s)o=Xte(o,n[s],s!==n.length-1)}else Xte(t,r,!1)}),e.flags&=~kr.ExplicitlyTracking)}function Xte(t,e,i){const r=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const s=parseInt(r,10);if(!isNaN(s))return Array.isArray(t)?t[s]:t.at(s)}const n=Jl(t);if(n){const s=n.propertiesByName.get(r);s&&(Mt(s),qme(t,s))}return i?t[r]:void 0}let Zte=class extends Gme{constructor(e,i){super(),this.propertyName=e,this.metadata=i,this._accessed=null,this._handles=null,this.flags=0,this.flags=kr.Dirty|(i.nonNullable?kr.NonNullable:0)|(i.hasOwnProperty("value")?kr.HasDefaultValue:0)|(i.get===void 0?kr.DepTrackingInitialized:0)|(i.dependsOn===void 0?kr.AutoTracked:0)}destroy(){this.flags&kr.Dirty&&this.onCommitted(),super.destroy(),this._accessed=null,this._clearObservationHandles()}getComputed(e){Mt(this);const i=e.store,r=this.propertyName,n=this.flags,s=i.get(r);if(n&kr.Computing||~n&kr.Dirty&&i.has(r))return s;this.flags|=kr.Computing;const o=e.host;let a;n&kr.AutoTracked?a=by(this,this.metadata.get,o):(Wme(o,this),a=this.metadata.get.call(o)),i.set(r,a,Ci.COMPUTED);const l=i.get(r);return l===s?this.flags&=~kr.Dirty:ALe(this.commit,this),this.flags&=~kr.Computing,l}onObservableAccessed(e){if(e===this)return;let i=this._accessed;if(i==null)i=[],this._accessed=i;else if(i.includes(e))return;i.push(e)}onTrackingEnd(){this._clearObservationHandles(),this.flags|=kr.DepTrackingInitialized;const e=this._accessed;if(e==null||e.length===0)return;let i=this._handles;i==null&&(i=[],this._handles=i);for(let r=0;r<e.length;++r)i.push(e[r].observe(this));e.length=0}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}commit(){this.flags&=~kr.Dirty,this.onCommitted()}_clearObservationHandles(){const e=this._handles;if(e!==null){for(let i=0;i<e.length;++i)e[i].remove();e.length=0}}onInvalidated(){~this.flags&kr.Overriden&&(this.flags|=kr.Dirty);const e=this._observers;if(e&&e.length>0)for(const i of e)i.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onCommitted()}}},RLe=class Yme{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new Yme;return this._values.forEach((r,n)=>{e&&e.has(n)||i.set(n,Q(r))}),i}get(e){return this._values.get(e)}originOf(){return Ci.USER}keys(){return[...this._values.keys()]}set(e,i){this._values.set(e,i)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}};function T$(t,e,i){return t!==void 0}function Jte(t,e,i,r){return t!==void 0&&(!(i==null&&t.flags&kr.NonNullable)||(r.lifecycle,Yg.INITIALIZING,!1))}function PLe(t){return t&&typeof t.destroy=="function"}K.getLogger("esri.core.accessorSupport.Properties");let MLe=class{constructor(e){this.host=e,this.propertiesByName=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=Yg.INITIALIZING,this.store=new RLe,this._origin=Ci.USER;const i=this.host.constructor.__accessorMetadata__;for(const r in i){const n=new Zte(r,i[r]);this.propertiesByName.set(r,n)}this.metadatas=i}initialize(){this.lifecycle=Yg.CONSTRUCTING}constructed(){this.lifecycle=Yg.CONSTRUCTED}destroy(){this.destroyed=!0;for(const[e,i]of this.propertiesByName){if(i.metadata.autoDestroy){const r=this.internalGet(e);r&&PLe(r)&&(r.destroy(),~i.flags&kr.NonNullable&&this._internalSet(i,null))}i.destroy()}}get initialized(){return this.lifecycle!==Yg.INITIALIZING}get(e){const i=this.propertiesByName.get(e);if(i.metadata.get)return i.getComputed(this);Mt(i);const r=this.store;return r.has(e)?r.get(e):i.metadata.value}originOf(e){const i=this.store.originOf(e);if(i===void 0){const r=this.propertiesByName.get(e);if(r!==void 0&&r.flags&kr.HasDefaultValue)return"defaults"}return a5(i)}has(e){return!!this.propertiesByName.has(e)&&this.store.has(e)}keys(){return[...this.propertiesByName.keys()]}internalGet(e){const i=this.propertiesByName.get(e);if(T$(i))return this.store.has(e)?this.store.get(e):i.metadata.value}internalSet(e,i){const r=this.propertiesByName.get(e);T$(r)&&this._internalSet(r,i)}getDependsInfo(e,i,r){const n=this.propertiesByName.get(i);if(!T$(n))return"";const s=new Set,o=by({onObservableAccessed:l=>s.add(l),onTrackingEnd:()=>{}},()=>n.metadata.get?.call(e));let a=`${r}${e.declaredClass.split(".").pop()}.${i}: ${o}
`;if(s.size===0)return a;r+="  ";for(const l of s)l instanceof Zte&&(a+=`${r}${l.propertyName}: undefined
`);return a}setAtOrigin(e,i,r){const n=this.propertiesByName.get(e);if(T$(n))return this._setAtOrigin(n,i,r)}isOverridden(e){const i=this.propertiesByName.get(e);return i!==void 0&&!!(i.flags&kr.Overriden)}clearOverride(e){const i=this.propertiesByName.get(e);i&&i.flags&kr.Overriden&&(i.flags&=~kr.Overriden,i.notifyChange())}override(e,i){const r=this.propertiesByName.get(e);if(!Jte(r,e,i,this))return;const n=r.metadata.cast;if(n){const s=this._cast(n,i),{valid:o,value:a}=s;if($8.release(s),!o)return;i=a}r.flags|=kr.Overriden,this._internalSet(r,i)}set(e,i){const r=this.propertiesByName.get(e);if(!Jte(r,e,i,this))return;const n=r.metadata.cast;if(n){const o=this._cast(n,i),{valid:a,value:l}=o;if($8.release(o),!a)return;i=l}const s=r.metadata.set;s?s.call(this.host,i):this._internalSet(r,i)}setDefaultOrigin(e){this._origin=j_(e)}getDefaultOrigin(){return a5(this._origin)}notifyChange(e){const i=this.propertiesByName.get(e);i!==void 0&&i.notifyChange()}invalidate(e){const i=this.propertiesByName.get(e);i!==void 0&&i.invalidate()}commit(e){const i=this.propertiesByName.get(e);i!==void 0&&i.commit()}_internalSet(e,i){const r=this.lifecycle!==Yg.INITIALIZING?this._origin:Ci.DEFAULTS;this._setAtOrigin(e,i,r)}_setAtOrigin(e,i,r){const n=this.store,s=e.propertyName;n.has(s,r)&&MX(i,n.get(s))&&~e.flags&kr.Overriden&&r===n.originOf(s)||(e.invalidate(),n.set(s,i,r),e.commit(),qme(this.host,e))}_cast(e,i){const r=$8.acquire();return r.valid=!0,r.value=i,e&&(r.value=e.call(this.host,i,r)),r}},$Le=class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}};const $8=new $a($Le);function c5(t,e,i){if(t&&e)if(typeof e=="object")for(const r of Object.getOwnPropertyNames(e))c5(t,r,e[r]);else{if(e.includes(".")){const n=e.split("."),s=n.splice(-1,1)[0];return void c5(Hl(t,n),s,i)}const r=t.__accessor__;r!=null&&ILe(e,r),t[e]=i}}function ILe(t,e){if(ie("esri-unknown-property-errors")&&!LLe(t,e))throw new G("set:unknown-property",DLe(t,e))}function LLe(t,e){return e.metadatas[t]!=null}function DLe(t,e){return"setting unknown property '"+t+"' on instance of "+e.host.declaredClass}let NLe;function FLe(){return NLe}var Kte;(function(t){t[t.Ignore=0]="Ignore",t[t.Destroy=1]="Destroy",t[t.ThrowError=2]="ThrowError"})(Kte||(Kte={}));function kLe(t){t.length=0}let Mc=class{constructor(e=50,i=50){this._pool=new $a(Array,void 0,kLe,i,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return I8.acquire()}static release(e){return I8.release(e)}static prune(){I8.prune()}};const I8=new Mc(100);let Xme=class extends $a{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=null}acquire(...e){const i=super.acquire(...e);return this._set.delete(i),i}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}};const S$=[];function TE(t){S$.push(t),S$.length===1&&queueMicrotask(()=>{const e=S$.slice();S$.length=0;for(const i of e)i()})}let Qg=class{constructor(e,i=30){this.name=e,this._counter=0,this._samples=new Array(i)}record(e){e!=null&&(this._samples[++this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort((e,i)=>e-i)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((e,i)=>e+i,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var n7;(function(t){const e=(s,o,a,l)=>{let c=o,h=o;const d=a>>>1,f=s[c-1];for(;h<=d;){h=c<<1,h<a&&l(s[h-1],s[h])<0&&++h;const m=s[h-1];if(l(m,f)<=0)break;s[c-1]=m,c=h}s[c-1]=f},i=(s,o)=>s<o?-1:s>o?1:0;function r(s,o,a,l){o===void 0&&(o=0),a===void 0&&(a=s.length),l===void 0&&(l=i);for(let h=a>>>1;h>o;h--)e(s,h,a,l);const c=o+1;for(let h=a-1;h>o;h--){const d=s[o];s[o]=s[h],s[h]=d,e(s,c,h,l)}}function*n(s,o,a,l){o===void 0&&(o=0),a===void 0&&(a=s.length),l===void 0&&(l=i);for(let h=a>>>1;h>o;h--)e(s,h,a,l),yield;const c=o+1;for(let h=a-1;h>o;h--){const d=s[o];s[o]=s[h],s[h]=d,e(s,c,h,l),yield}}t.sort=r,t.iterableSort=n})(n7||(n7={}));const Qte=n7,ULe=1.5,zLe=1.1;let Ut=class{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new _me,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),e.deallocator!==void 0&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>eie(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const i=new Array;for(let r=0;r<this._length;r++){const n=this.data[r];e(n)&&i.push(n)}return i}at(e){if((e=Math.trunc(e)||0)<0&&(e+=this._length),!(e<0||e>=this._length))return this.data[e]}includes(e,i){const r=this.data.indexOf(e,i);return r!==-1&&r<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let i=e;i<this._length;++i)this.data[i]=this._deallocator(this.data[i]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,i=e.length){for(let r=0;r<i;r++)this.data[this._length++]=e[r]}fill(e,i){for(let r=0;r<i;r++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,eie(this)}pop(){if(this.length===0)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const i=KV(this.data,e,this.length,this._hint);if(i!==-1)return this.data.splice(i,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex(KV(this.data,e,this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,i=e.length,r){this.length=KIe(this.data,e,this.length,i,this._hint,r),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(e,i){if(e>=this.length||i>=this.length||e===i)return;const r=this.data[e];this.data[e]=this.data[i],this.data[i]=r}sort(e){Qte.sort(this.data,0,this.length,e)}iterableSort(e){return Qte.iterableSort(this.data,0,this.length,e)}some(e,i){for(let r=0;r<this.length;++r)if(e.call(i,this.data[r],r,this.data))return!0;return!1}find(e,i){for(let r=0;r<this.length;++r){const n=this.data[r];if(e.call(i,n,r))return n}}filterInPlace(e,i){let r=0;for(let n=0;n<this._length;++n){const s=this.data[n];e.call(i,s,n,this.data)&&(this.data[n]=this.data[r],this.data[r]=s,r++)}if(this._deallocator)for(let n=r;n<this._length;n++)this.data[n]=this._deallocator(this.data[n]);return this._length=r,this._shrink(),this}forAll(e,i){const r=this.length,n=this.data;for(let s=0;s<r;++s)e.call(i,n[s],s,n)}forEach(e,i){for(let r=0;r<this.length;++r)e.call(i,this.data[r],r,this.data)}map(e,i){const r=new Array(this.length);for(let n=0;n<this.length;++n)r[n]=e.call(i,this.data[n],n,this.data);return r}reduce(e,i){let r=i;for(let n=0;n<this.length;++n)r=e(r,this.data[n],n,this.data);return r}has(e){const i=this.length,r=this.data;for(let n=0;n<i;++n)if(r[n]===e)return!0;return!1}};function eie(t){t.data.length>ULe*t.length&&(t.data.length=Math.floor(t.length*zLe))}function BLe(t){return{setTimeout:(e,i)=>{const r=t.setTimeout(e,i);return Vi(()=>t.clearTimeout(r))}}}const nM=BLe(globalThis);function l6(t){return t&&(typeof t.on=="function"||typeof t.addEventListener=="function")}function oy(t,e,i){if(!l6(t))throw new TypeError("target is not a Evented or EventTarget object");if("on"in t)return t.on(e,i);if(Array.isArray(e)){const r=e.slice();for(const n of r)t.addEventListener(n,i);return Vi(()=>{for(const n of r)t.removeEventListener(n,i)})}return t.addEventListener(e,i),Vi(()=>t.removeEventListener(e,i))}function Zme(t,e,i){if(!l6(t))throw new TypeError("target is not a Evented or EventTarget object");if("once"in t)return t.once(e,i);const r=oy(t,e,n=>{r.remove(),i.call(t,n)});return r}const VLe={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function Jme({key:t}){return VLe[t]||t}function Ti(t="Aborted"){return new G("AbortError",t)}function Tt(t,e="Aborted"){if(ps(t))throw Ti(e)}function c6(t){return t!=null?"aborted"in t?t:t.signal:t}function ps(t){const e=c6(t);return e!=null&&e.aborted}function Gl(t){if(Tn(t))throw t}function tie(t){if(!Tn(t))throw t}function Ms(t,e){const i=c6(t);if(i!=null){if(!i.aborted)return Zme(i,"abort",()=>e());e()}}function sM(t,e){const i=c6(t);if(i!=null)return Tt(i),Zme(i,"abort",()=>e(Ti()))}function GLe(t,e){return c6(e)==null?t:new Promise((i,r)=>{let n=Ms(e,()=>r(Ti()));const s=()=>{n=Tr(n)};t.then(s,s),t.then(i,r)})}function Tn(t){return t?.name==="AbortError"}async function YR(t){try{return await t}catch(e){if(!Tn(e))throw e;return}}async function xRt(t,e=K.getLogger("esri")){try{return await t}catch(i){Tn(i)||e.error(i)}}async function oM(t){if(!t)return;if(typeof t.forEach!="function"){const i=Object.keys(t),r=i.map(o=>t[o]),n=await oM(r),s={};return i.map((o,a)=>s[o]=n[a]),s}const e=t;return Promise.allSettled(e).then(i=>Array.from(e,(r,n)=>{const s=i[n];return s.status==="fulfilled"?{promise:r,value:s.value}:{promise:r,error:s.reason}}))}async function jLe(t){return(await oM(t)).filter(e=>!!e.value).map(e=>e.value)}async function iie(t){return(await Promise.allSettled(t)).filter(e=>e.status==="fulfilled").map(e=>e.value)}async function HLe(t){return(await Promise.allSettled(t)).filter(e=>e.status==="rejected").map(e=>e.reason)}function XR(t,e=void 0,i){const r=new AbortController;return Ms(i,()=>r.abort()),new Promise((n,s)=>{let o=setTimeout(()=>{o=0,n(e)},t);Ms(r,()=>{o&&(clearTimeout(o),s(Ti()))})})}function Zc(t){return t&&typeof t.then=="function"}function s7(t){return Zc(t)?t:Promise.resolve(t)}function aM(t,e=-1){let i,r,n,s,o=null;const a=(...l)=>{if(i){r=l,s&&s.reject(Ti()),s=Hs();const f=s.promise;if(o){const m=o;o=null,m.abort()}return f}if(n=s||Hs(),s=null,e>0){const f=new AbortController;i=s7(t(...l,f.signal));const m=i;XR(e).then(()=>{i===m&&(s?f.abort():o=f)})}else i=1,i=s7(t(...l));const c=()=>{const f=r;r=n=i=o=null,f!=null&&a(...f)},h=i,d=n;return h.then(c,c),h.then(d.resolve,d.reject),d.promise};return a}function Hs(){let t,e;const i=new Promise((n,s)=>{t=n,e=s}),r=n=>{t(n)};return r.resolve=n=>t(n),r.reject=n=>e(n),r.timeout=(n,s)=>nM.setTimeout(()=>r.reject(s),n),r.promise=i,r}function TRt(t,e){return t.then(e,e)}async function rie(t){await Promise.resolve(),Tt(t)}function SRt(t){return t}function Kme(t){return 1e3*t}function ERt(t){return t}function DX(t){return .001*t}let qLe=class{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}},WLe=class{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}},o7=0,a7=0;const XC={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},l7=["prepare","preRender","render","postRender","update","finish"],c7=[],ix=new Ut;let YLe=class{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}};const u5={frameTasks:ix,willDispatch:!1,clearFrameTasks:XLe,dispatch:tge,executeFrameTasks:JLe};function Ux(t){const e=new WLe(t);return c7.push(e),u5.willDispatch||(u5.willDispatch=!0,TE(tge)),e}function rx(t){const e=new qLe(t);return ix.push(e),h5==null&&(o7=performance.now(),h5=requestAnimationFrame(Qme)),new YLe(e)}let h5=null;function XLe(t=!1){ix.forAll(e=>{e.removed=!0}),t&&ege()}function ZLe(t){a7=Math.max(0,t)}function Qme(){const t=performance.now();h5=null,h5=ix.length>0?requestAnimationFrame(Qme):null,u5.executeFrameTasks(t)}function JLe(t){const e=t-o7;o7=t;const i=a7>0?a7:1e3/60,r=Math.max(0,e-i);XC.time=t,XC.frameDuration=i-r;for(let n=0;n<l7.length;n++){const s=performance.now(),o=l7[n];ix.forAll(a=>{a.paused||a.removed||(n===0&&a.ticks++,a.phases[o]&&(XC.elapsedFrameTime=performance.now()-t,XC.deltaTime=a.ticks===0?0:e,a.phases[o]?.call(a,XC)))}),KLe[n].record(performance.now()-s)}ege(),QLe.record(performance.now()-t)}const E$=new Ut;function ege(){ix.forAll(t=>{t.removed&&E$.push(t)}),ix.removeUnorderedMany(E$.data,E$.length),E$.clear()}function tge(){for(;c7.length;){const t=c7.shift();t.isActive&&t.callback()}u5.willDispatch=!1}function RRt(t=1,e){const i=Hs(),r=()=>{ps(e)?i.reject(Ti()):t===0?i():(--t,TE(()=>r()))};return r(),i.promise}const KLe=l7.map(t=>new Qg(t)),QLe=new Qg("total");function jD(t,e){for(const i of t.entries())if(e(i[0]))return!0;return!1}function nie(t,e){if(!e)return t;for(const i of e)t.add(i);return t}function eDe(t,e){const i=new Set;return nie(i,t),nie(i,e),i}function PRt(t,e){const i=new Set;for(const r of e)t.has(r)&&i.add(r);return i}function MRt(t,e){if(!t||!e)return!1;if(t===e)return!0;for(const i of t)if(!e.has(i))return!1;return!0}function $Rt(t,e){if(t==null&&e==null)return!0;if(t==null||e==null||t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0}function IRt(t,e){const i=new Set(t);for(const r of e)i.delete(r);return i}let tDe=0;const iDe=0;function zu(){return++tDe}let u6=class{constructor(e){this._accessed=[],this._handles=[],this._observerObject=new rDe(e),sie.register(this,new WeakRef(this._observerObject),this)}destroy(){sie.unregister(this._observerObject),this._accessed.length=0,this._observerObject?.destroy(),this.clear()}onObservableAccessed(e){const i=this._accessed;i.includes(e)||i.push(e)}onTrackingEnd(){const e=this._handles,i=this._accessed,r=this._observerObject;for(let n=0;n<i.length;++n)e.push(i[n].observe(r));i.length=0}clear(){const e=this._handles;for(let i=0;i<e.length;++i)e[i].remove();e.length=0}},rDe=class{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(e===1)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=nDe}};const sie=new FinalizationRegistry(t=>{t.deref()?.destroy()});function nDe(){}let G2=!1;const d5=[];function ige(t,e){let i=new u6(s),r=null,n=!1;function s(){if(!i||n)return;if(G2)return void sge(s);const a=r;i.clear(),G2=!0,n=!0,r=by(i,t),n=!1,G2=!1,e(r,a),oge()}function o(){i&&(i.destroy(),i=null,r=null)}return n=!0,r=by(i,t),n=!1,Vi(o)}function rge(t,e){let i=new u6(n),r=null;function n(){e(r,o)}function s(){i&&(i.destroy(),i=null),r=null}function o(){return i?(i.clear(),r=by(i,t),r):null}return o(),Vi(s)}function nge(t){let e=new u6(r),i=!1;function r(){e&&!i&&(G2?sge(r):(e.clear(),G2=!0,i=!0,by(e,t),i=!1,G2=!1,oge()))}function n(){e&&(e.destroy(),e=null)}return i=!0,by(e,t),i=!1,Vi(n)}function sge(t){d5.includes(t)||d5.unshift(t)}function oge(){for(;d5.length;)d5.pop()()}var zO;(function(t){t[t.Untracked=0]="Untracked",t[t.Tracked=1]="Tracked"})(zO||(zO={}));let ZR=class{constructor(){this.uid=zu(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,i,r,n,s){return this.pool.acquire(zO.Untracked,e,i,r,n,s,MX)}static acquireTracked(e,i,r,n){return this.pool.acquire(zO.Tracked,e,i,r,null,null,n)}notify(e,i){this.type===zO.Untracked?this.callback.call(this.target,e,i,this.path,this.target):this.callback.call(null,e,i,void 0,void 0)}acquire(e,i,r,n,s,o,a){this.uid=zu(),this.removed=!1,this.type=e,this.oldValue=i,this.callback=r,this.getValue=n,this.target=s,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=zu(),this.removed=!0}};ZR.pool=new Xme(ZR);const HD=new Mc,ay=new Set;let p5;function f5(t){ay.delete(t),ay.add(t),p5||(p5=Ux(aDe))}function sDe(t){if(t.removed)return;const e=t.oldValue,i=t.getValue();t.equals(e,i)||(t.oldValue=i,t.notify(i,e))}function oDe(t){for(const e of ay.values())e.target===t&&(e.removed=!0)}function aDe(){let t=10;for(;p5&&t--;){p5=null;const e=lDe(),i=HD.acquire();for(const r of e){const n=r.uid;sDe(r),n===r.uid&&r.removed&&i.push(r)}for(const r of ay)r.removed&&(i.push(r),ay.delete(r));for(const r of i)ZR.pool.release(r);HD.release(i),HD.release(e),u7.forEach(r=>r())}}function lDe(){const t=HD.acquire();t.length=ay.size;let e=0;for(const i of ay)t[e]=i,++e;return ay.clear(),t}const u7=new Set;function age(t){return u7.add(t),Vi(()=>u7.delete(t))}function cDe(t,e,i){let r=zme(t,e,i,(n,s,o)=>{let a,l,c=rge(()=>iM(n,s),(h,d)=>{n.__accessor__.destroyed||a&&a.uid!==l?r.remove():(a||(a=ZR.acquireUntracked(h,o,d,n,s),l=a.uid),f5(a))});return Vi(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,f5(a)),a=null),r=c=null})});return r}function uDe(t,e,i){const r=zme(t,e,i,(n,s,o)=>{let a=!1;return ige(()=>iM(n,s),(l,c)=>{n.__accessor__.destroyed?r.remove():a||(a=!0,MX(c,l)||o.call(n,l,c,s,n),a=!1)})});return r}function hDe(t,e,i,r=!1){return!t.__accessor__||t.__accessor__.destroyed?Vi():r?uDe(t,e,i):cDe(t,e,i)}function dDe(t,e,i){let r,n,s=rge(t,(o,a)=>{r&&r.uid!==n?s.remove():(r||(r=ZR.acquireTracked(o,e,a,i),n=r.uid),f5(r))});return Vi(()=>{s.remove(),r&&(r.uid!==n||r.removed||(r.removed=!0,f5(r)),r=null),s=null})}function pDe(t,e,i){let r=!1;return ige(t,(n,s)=>{r||(r=!0,i(s,n)||e(n,s),r=!1)})}function fDe(t,e,i=!1,r=Mme){return i?pDe(t,e,r):dDe(t,e,r)}function oie(t){return jD(ay,e=>e.oldValue===t)}function $u(t,e){for(const[i,r]of t)if(e(r,i))return!0;return!1}function FRt(t,e){for(const[i,r]of t)if(e(r,i))return r;return null}function lge(t,e,i){const r=t.get(e);if(r!==void 0)return r;const n=i();return t.set(e,n),n}const j2=K.getLogger("esri.core.accessorSupport.ensureTypes");function mDe(t){return t==null?t:new Date(t)}function gDe(t){return t==null?t:!!t}function lM(t){return t==null?t:t.toString()}function Nh(t){return t==null?t:(t=parseFloat(t),isNaN(t)?0:t)}function NX(t){return t==null?t:Math.round(parseFloat(t))}function cge(t){return t?.constructor&&t.constructor.__accessorMetadata__!==void 0}function m5(t,e){return e!=null&&t&&!(e instanceof t)}function uge(t){return t&&"isCollection"in t}function aie(t){return t?.Type?typeof t.Type=="function"?t.Type:t.Type.base:null}function yDe(t,e){if(!e?.constructor||!uge(e.constructor))return h7(t,e)?e:new t(e);const i=aie(t.prototype.itemType),r=aie(e.constructor.prototype.itemType);return i?r?i===r?e:i.prototype.isPrototypeOf(r.prototype)?new t(e):(h7(t,e),e):new t(e):e}function h7(t,e){return!!cge(e)&&(j2.error("Accessor#set","Assigning an instance of '"+(e.declaredClass||"unknown")+"' which is not a subclass of '"+h6(t)+"'"),!0)}function nx(t,e){return e==null?e:uge(t)?yDe(t,e):m5(t,e)?h7(t,e)?e:new t(e):e}function h6(t){return t?.prototype?.declaredClass||"unknown"}const _De=new WeakMap;function vDe(t){switch(t){case Number:return Nh;case dr:return NX;case Boolean:return gDe;case String:return lM;case Date:return mDe;default:return lge(_De,t,()=>nx.bind(null,t))}}function as(t,e){const i=vDe(t);return arguments.length===1?i:i(e)}function JR(t,e,i){return arguments.length===1?JR.bind(null,t):e&&(Array.isArray(e)?e.map(r=>t(r,i)):[t(e,i)])}function bDe(t,e){return arguments.length===1?JR(i=>as(t,i)):JR(i=>as(t,i),e)}function hge(t,e,i){return e!==0&&Array.isArray(i)?i.map(r=>hge(t,e-1,r)):t(i)}function g5(t,e,i){if(arguments.length===2)return s=>g5(t,e,s);if(!i)return i;i=hge(t,e,i);let r=e,n=i;for(;r>0&&Array.isArray(n);)r--,n=n[0];if(n!==void 0)for(let s=0;s<r;s++)i=[i];return i}function wDe(t,e,i){return arguments.length===2?g5(r=>as(t,r),e):g5(r=>as(t,r),e,i)}function dge(t){return!!Array.isArray(t)&&!t.some(e=>{const i=typeof e;return!(i==="string"||i==="number"||i==="function"&&t.length>1)})}function d7(t,e){if(arguments.length===2)return d7(t).call(null,e);const i=new Set,r=t.filter(a=>typeof a!="function"),n=t.filter(a=>typeof a=="function");for(const a of t)typeof a!="string"&&typeof a!="number"||i.add(a);let s=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,h=c==="string"||c==="number";return h&&(i.has(a)||n.some(d=>c==="string"&&d===String||c==="number"&&d===Number))||c==="object"&&n.some(d=>!m5(a,d))?a:(h&&r.length?(s||(s=r.map(d=>typeof d=="string"?`'${d}'`:`${d}`).join(", ")),j2.error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${s}`)):typeof a=="object"&&n.length?(o||(o=n.map(d=>h6(d)).join(", ")),j2.error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):j2.error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function Tm(t,e){if(arguments.length===2)return Tm(t).call(null,e);const i={},r=[],n=[];for(const l in t.typeMap){const c=t.typeMap[l];i[l]=as(c),r.push(h6(c)),n.push(l)}const s=()=>`'${r.join("', '")}'`,o=()=>`'${n.join("', '")}'`,a=typeof t.key=="string"?l=>l[t.key]:t.key;return l=>{if(t.base&&!m5(t.base,l)||l==null)return l;const c=a(l)||t.defaultKeyValue,h=i[c];if(!h)return j2.error("Accessor#set",`Invalid property value, value needs to be one of ${s()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!m5(t.typeMap[c],l))return l;if(typeof t.key=="string"&&!cge(l)){const d={};for(const f in l)f!==t.key&&(d[f]=l[f]);return h(d)}return h(l)}}let dr=class{};const URt={native:t=>({type:"native",value:t}),array:t=>({type:"array",value:t}),oneOf:t=>({type:"one-of",values:t})};function xDe(t){if(!t||!("type"in t))return!1;switch(t.type){case"native":case"array":case"one-of":return!0}return!1}function pge(t){switch(t.type){case"native":return as(t.value);case"array":return JR(pge(t.value));case"one-of":return TDe(t);default:return null}}function TDe(t){let e=null;return(i,r)=>f7(i,t)?i:(e==null&&(e=p7(t)),j2.error("Accessor#set",`Invalid property value, value needs to be of type ${e}`),r&&(r.valid=!1),null)}function p7(t){switch(t.type){case"native":switch(t.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case dr:return"integer";case Date:return"date";default:return h6(t.value)}case"array":return`array of ${p7(t.value)}`;case"one-of":{const e=t.values.map(i=>p7(i));return`one of ${e.slice(0,-1)} or ${e[e.length-1]}`}}return"unknown"}function f7(t,e){if(t==null)return!0;switch(e.type){case"native":switch(e.value){case Number:case dr:return typeof t=="number";case Boolean:return typeof t=="boolean";case String:return typeof t=="string"}return t instanceof e.value;case"array":return!!Array.isArray(t)&&!t.some(i=>!f7(i,e.value));case"one-of":return e.values.some(i=>f7(t,i))}}function p(t={}){return(e,i)=>{if(e===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${e.name}.${i}. Accessor does not support static properties.`);const r=Object.getOwnPropertyDescriptor(e,i),n=a6(e,i);r&&(r.get||r.set?(n.get=r.get||n.get,n.set=r.set||n.set):"value"in r&&("value"in t&&K.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${i}" on "${e.constructor.name}" already defined in the metadata`,t),n.value=t.value=r.value)),t.readOnly!=null&&(n.readOnly=t.readOnly);const s=t.aliasOf;if(s){const l=typeof s=="string"?s:s.source,c=typeof s=="string"?null:s.overridable===!0;let h;n.dependsOn=[l],n.get=function(){let d=Hl(this,l);if(typeof d=="function"){h||(h=l.split(".").slice(0,-1).join("."));const f=Hl(this,h);f&&(d=d.bind(f))}return d},n.readOnly||(n.set=c?function(d){this._override(i,d)}:function(d){c5(this,l,d)})}const o=t.type,a=t.types;n.cast||(o?n.cast=SDe(o):a&&(Array.isArray(a)?n.cast=JR(Tm(a[0])):n.cast=Tm(a))),vLe(n,t),t.range&&(n.cast=EDe(n.cast,t.range))}}function fge(t,e,i){const r=a6(t,i);r.json||(r.json={});let n=r.json;return e!==void 0&&(n.origins||(n.origins={}),n.origins[e]||(n.origins[e]={}),n=n.origins[e]),n}function SDe(t){let e=0,i=t;if(xDe(t))return pge(t);for(;Array.isArray(i)&&i.length===1&&typeof i[0]!="string"&&typeof i[0]!="number";)i=i[0],e++;const r=i;if(dge(r))return e===0?d7(r):g5(d7(r),e);if(e===1)return bDe(r);if(e>1)return wDe(r,e);const n=t;return n.from?n.from:as(n)}function EDe(t,e){return i=>{let r=+t(i);return e.step!=null&&(r=Math.round(r/e.step)*e.step),e.min!=null&&(r=Math.max(e.min,r)),e.max!=null&&(r=Math.min(e.max,r)),r}}function CDe(t){if(t.json&&t.json.origins){const e=t.json.origins,i={"web-document":["web-scene","web-map"]};for(const r in i)if(e[r]){const n=e[r];i[r].forEach(s=>{e[s]=n}),delete e[r]}}}let Sm=class extends Lme{constructor(e,i,r){super(e,i,r)}};Sm.prototype.type="warning";function mge(t){return!!t&&t.prototype?.declaredClass&&t.prototype.declaredClass.indexOf("esri.core.Collection")===0}const m7=K.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function lie(t,e,i){t&&(!i&&!e.read||e.read?.reader||e.read?.enabled===!1||RDe(t)&&Mp("read.reader",bC(t),e))}function bC(t){const e=t.ndimArray??0;if(e>1)return ODe(t);if(e===1)return cie(t);if("type"in t&&yge(t.type)){const i=t.type.prototype?.itemType?.Type,r=cie(typeof i=="function"?{type:i}:{types:i});return(n,s,o)=>{const a=r(n,s,o);return a&&new t.type(a)}}return FX(t)}function FX(t){return"type"in t?ADe(t.type):PDe(t.types)}function ADe(t){return t.prototype.read?(e,i,r)=>{if(e==null)return e;const n=typeof e;if(n!=="object")return void m7.error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${n}'`);const s=new t;return s.read(e,r),s}:t.fromJSON}function gge(t,e,i,r){return r!==0&&Array.isArray(e)?e.map(n=>gge(t,n,i,r-1)):t(e,void 0,i)}function ODe(t){const e=FX(t),i=gge.bind(null,e),r=t.ndimArray??0;return(n,s,o)=>{if(n==null)return n;n=i(n,o,r);let a=r,l=n;for(;a>0&&Array.isArray(l);)a--,l=l[0];if(l!==void 0)for(let c=0;c<a;c++)n=[n];return n}}function cie(t){const e=FX(t);return(i,r,n)=>{if(i==null)return i;if(Array.isArray(i)){const o=[];for(const a of i){const l=e(a,void 0,n);l!==void 0&&o.push(l)}return o}const s=e(i,void 0,n);return s!==void 0?[s]:void 0}}function yge(t){if(!mge(t))return!1;const e=t.prototype.itemType;return!(!e||!e.Type)&&(typeof e.Type=="function"?kX(e.Type):_ge(e.Type))}function RDe(t){return"types"in t?_ge(t.types):kX(t.type)}function kX(t){return!Array.isArray(t)&&!!t&&t.prototype&&("read"in t.prototype||"fromJSON"in t||yge(t))}function _ge(t){for(const e in t.typeMap)if(!kX(t.typeMap[e]))return!1;return!0}function PDe(t){let e=null;const i=t.errorContext??"type",r=t.validate;return(n,s,o)=>{if(n==null)return n;const a=typeof n;if(a!=="object")return void m7.error(`Expected JSON value of type 'object' to deserialize, but got '${a}'`);e||(e=MDe(t));const l=t.key;if(typeof l!="string")return;const c=n[l],h=c?e[c]:t.defaultKeyValue?t.typeMap[t.defaultKeyValue]:void 0;if(!h){const f=`Type '${c||"unknown"}' is not supported`;return o?.messages&&n&&o.messages.push(new Sm(`${i}:unsupported`,f,{definition:n,context:o})),void m7.error(f)}const d=new h;return d.read(n,o),r?r(d):d}}function MDe(t){const e={};for(const i in t.typeMap){const r=t.typeMap[i],n=rM(r.prototype);if(typeof t.key=="function")continue;const s=n[t.key];if(!s)continue;s.json?.type&&Array.isArray(s.json.type)&&s.json.type.length===1&&typeof s.json.type[0]=="string"&&(e[s.json.type[0]]=r);const o=s.json?.write;if(!o?.writer){e[i]=r;continue}const a=o.target,l=typeof a=="string"?a:t.key,c={};o.writer(i,c,l),c[l]&&(e[c[l]]=r)}return e}function $De(t){if(t.json||(t.json={}),hie(t.json),die(t.json),uie(t.json),t.json.origins)for(const e in t.json.origins)hie(t.json.origins[e]),die(t.json.origins[e]),uie(t.json.origins[e]);return!0}function uie(t){t.name&&(t.read&&typeof t.read=="object"?t.read.source===void 0&&(t.read.source=t.name):t.read={source:t.name},t.write&&typeof t.write=="object"?t.write.target===void 0&&(t.write.target=t.name):t.write={target:t.name})}function hie(t){typeof t.read=="boolean"?t.read={enabled:t.read}:typeof t.read=="function"?t.read={enabled:!0,reader:t.read}:t.read&&typeof t.read=="object"&&t.read.enabled===void 0&&(t.read.enabled=!0)}function die(t){typeof t.write=="boolean"?t.write={enabled:t.write}:typeof t.write=="function"?t.write={enabled:!0,writer:t.write}:t.write&&typeof t.write=="object"&&t.write.enabled===void 0&&(t.write.enabled=!0)}function pie(t,e){if(!e.write||e.write.writer||e.write.enabled===!1&&!e.write.overridePolicy)return;const i=t?.ndimArray??0;t&&(i===1||"type"in t&&mge(t.type))?e.write.writer=DDe:i>1?e.write.writer=NDe(i):e.types?Array.isArray(e.types)?e.write.writer=LDe(e.types[0]):e.write.writer=IDe(e.types):e.write.writer=KR}function IDe(t){return(e,i,r,n)=>e?vge(e,t,n)?KR(e,i,r,n):void 0:KR(e,i,r,n)}function vge(t,e,i){for(const r in e.typeMap)if(t instanceof e.typeMap[r])return!0;if(i?.messages){const r=e.errorContext??"type",n=`Values of type '${(typeof e.key!="function"?t[e.key]:t.declaredClass)??"Unknown"}' cannot be written`;i&&i.messages&&t&&i.messages.push(new G(`${r}:unsupported`,n,{definition:t,context:i})),K.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(n)}return!1}function LDe(t){return(e,i,r,n)=>!e||!Array.isArray(e)?KR(e,i,r,n):KR(e.filter(s=>vge(s,t,n)),i,r,n)}function KR(t,e,i,r){Mp(i,y5(t,r),e)}function y5(t,e){return t&&typeof t.write=="function"?t.write({},e):t&&typeof t.toJSON=="function"?t.toJSON():typeof t=="number"?_5(t):t}function _5(t){return t===-1/0?-Number.MAX_VALUE:t===1/0?Number.MAX_VALUE:isNaN(t)?null:t}function DDe(t,e,i,r){let n;t===null?n=null:t&&typeof t.map=="function"?(n=t.map(s=>y5(s,r)),typeof n.toArray=="function"&&(n=n.toArray())):n=[y5(t,r)],Mp(i,n,e)}function bge(t,e,i){return i!==0&&Array.isArray(t)?t.map(r=>bge(r,e,i-1)):y5(t,e)}function NDe(t){return(e,i,r,n)=>{let s;if(e===null)s=null;else{s=bge(e,n,t);let o=t,a=s;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)s=[s]}Mp(r,s,i)}}function FDe(t,e){return UX(t,"any",e?.origin)}function g7(t,e){return UX(t,"read",e?.origin)}function wge(t,e){return UX(t,"write",e?.origin)}function UX(t,e,i){let r=t?.json;if(r?.origins&&i){let n;n=i==="link-chart"?r.origins[i]&&(e==="any"||e in r.origins[i])?r.origins[i]:r.origins["web-map"]:r.origins[i],n&&(e==="any"||e in n)&&(r=n)}return r}function kDe(t){const e=UDe(t);if(t.json.origins)for(const i in t.json.origins){const r=t.json.origins[i],n=r.types?zDe(r):e;lie(n,r,!1),r.types&&!r.write&&t.json.write&&t.json.write.enabled&&(r.write={...t.json.write}),pie(n,r)}lie(e,t.json,!0),pie(e,t.json)}function UDe(t){return t.json.types?y7(t.json):t.type?xge(t):y7(t)}function zDe(t){return t.type?xge(t):y7(t)}function xge(t){if(!t.type)return;let e=0,i=t.type;for(;Array.isArray(i)&&!dge(i);)i=i[0],e++;return{type:i,ndimArray:e}}function y7(t){if(!t.types)return;let e=0,i=t.types;for(;Array.isArray(i);)i=i[0],e++;return{types:i,ndimArray:e}}function BDe(t){$De(t)&&(CDe(t),kDe(t))}const L8=new Set,D8=new Set;function M(t){return e=>{t??(t="esri.core.Accessor"),e.prototype.declaredClass=t,GDe(e);const i=[],r=[];let n=e.prototype;for(;n;)n.hasOwnProperty("initialize")&&!L8.has(n.initialize)&&(L8.add(n.initialize),i.push(n.initialize)),n.hasOwnProperty("destroy")&&!D8.has(n.destroy)&&(D8.add(n.destroy),r.push(n.destroy)),n=Object.getPrototypeOf(n);L8.clear(),D8.clear();const s=class extends e{constructor(...a){if(super(...a),this.constructor===s&&typeof this.postscript=="function"){if(i.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=i.length-1;l>=0;l--)i[l].call(this)}}),r.length){let l=!1;const c=this[Fme];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0,c.call(this);for(let h=0;h<r.length;h++)r[h].call(this)}}})}this.postscript(...a)}}};s.__accessorMetadata__=rM(e.prototype),s.prototype.declaredClass=t;const o=(t||"AccessorSubclass").split(".").slice(-1)[0];return Object.defineProperty(s,"name",{value:o,configurable:!0}),s}}function VDe(t,e){return e.get==null?function(){const i=this.__accessor__,r=i.propertiesByName.get(t);if(r===void 0)return;Mt(r);const n=i.store;return n.has(t)?n.get(t):r.metadata.value}:function(){const i=this.__accessor__,r=i.propertiesByName.get(t);if(r!==void 0)return r.getComputed(i)}}function GDe(t){const e=t.prototype,i=rM(e),r={};for(const n of Object.getOwnPropertyNames(i)){const s=i[n];BDe(s),r[n]={enumerable:!0,configurable:!0,get:VDe(n,s),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this)){if(a.initialized&&s.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${n}' of ${this.declaredClass}`);if(a.lifecycle===Yg.CONSTRUCTED&&s.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${n}' of ${this.declaredClass}`);a.set(n,o)}}else Object.defineProperty(this,n,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(t.prototype,r)}var Tge,Sge;function jDe(t){if(t==null)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return t.constructor?.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const q0=Symbol("Accessor-Handles"),_7=Symbol("Accessor-Initialized");let we=class Ege{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:i,declaredClass:r,constructor:n}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const s=this;class o extends s{constructor(...l){super(...l),this.inherited=null,n&&n.apply(this,l)}}rM(o.prototype);for(const a in e){const l=e[a];o.prototype[a]=typeof l=="function"?function(...c){const h=this.inherited;let d;this.inherited=function(...f){if(s.prototype[a])return s.prototype[a].apply(this,f)};try{d=l.apply(this,c)}catch(f){throw this.inherited=h,f}return this.inherited=h,d}:e[a]}for(const a in i){const l=jDe(i[a]);p(l)(o.prototype,a)}return M(r)(o)}constructor(...e){if(this[Tge]=null,this[Sge]=!1,this.constructor===Ege)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const i=new MLe(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:i}),e.length>0&&this.normalizeCtorArgs&&(i.ctorArgs=this.normalizeCtorArgs.apply(this,e))}postscript(e){const i=this.__accessor__,r=i.ctorArgs||e;i.initialize(),r&&(this.set(r),i.ctorArgs=null),i.constructed(),this.initialize(),this[_7]=!0}initialize(){}[Fme](){this[q0]=$e(this[q0])}destroy(){this.destroyed||(oDe(this),this.__accessor__.destroy(),FLe()?.onInstanceDestroy(this))}[Symbol.dispose](){this.destroy()}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[_7]}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(e){Hl(this,e)}get(e){return Nme(K.getLogger(this),"`Accessor.get` is deprecated in favor of using optional chaining",{version:"4.28",see:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining"}),Hl(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,i){return c5(this,e,i),this}watch(e,i,r){return hDe(this,e,i,r)}addHandles(e,i){if(this.destroyed){const n=Array.isArray(e)?e:[e];for(const s of n)s.remove();return}let r=this[q0];r==null&&(r=this[q0]=new Ny),r.add(e,i)}removeHandles(e){const i=this[q0];i?.remove(e)}removeAllHandles(){const e=this[q0];e?.removeAll()}hasHandles(e){const i=this[q0];return i!=null&&i.has(e)}_override(e,i){i===void 0?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,i){i==null?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,i){return this.__accessor__.internalSet(e,i),this}};Tge=q0,Sge=_7;let HDe=class Cge{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new Cge;return this._values.forEach((r,n)=>{e&&e.has(n)||i.set(n,Q(r.value),r.origin)}),i}get(e,i){i=this._normalizeOrigin(i);const r=this._values.get(e);return i==null||r?.origin===i?r?.value:void 0}originOf(e){return this._values.get(e)?.origin??Ci.USER}keys(e){e=this._normalizeOrigin(e);const i=[...this._values.keys()];return e==null?i:i.filter(r=>this._values.get(r)?.origin===e)}set(e,i,r){if((r=this._normalizeOrigin(r))===Ci.DEFAULTS){const n=this._values.get(e);if(n?.origin!=null&&n.origin>r)return}this._values.set(e,new qDe(i,r))}delete(e,i){(i=this._normalizeOrigin(i))!=null&&this._values.get(e)?.origin!==i||this._values.delete(e)}has(e,i){return(i=this._normalizeOrigin(i))!=null?this._values.get(e)?.origin===i:this._values.has(e)}forEach(e){this._values.forEach(({value:i},r)=>e(i,r))}_normalizeOrigin(e){if(e!=null)return e===Ci.DEFAULTS?e:Ci.USER}},qDe=class{constructor(e,i){this.value=e,this.origin=i}};function Age(t,e,i){e.keys().forEach(n=>{i.set(n,e.get(n),Ci.DEFAULTS)});const r=t.metadatas;Object.keys(r).forEach(n=>{t.internalGet(n)&&i.set(n,t.internalGet(n),Ci.DEFAULTS)})}function WDe(t,e,i){if(!t?.read||t.read.enabled===!1||!t.read.source)return!1;const r=t.read.source;if(typeof r=="string"){if(r===e||r.includes(".")&&r.indexOf(e)===0&&Yte(r,i))return!0}else for(const n of r)if(n===e||n.includes(".")&&n.indexOf(e)===0&&Yte(n,i))return!0;return!1}function YDe(t){return t&&(!t.read||t.read.enabled!==!1&&!t.read.source)}function XDe(t,e,i,r,n){let s=g7(e[i],n);YDe(s)&&(t[i]=!0);for(const o of Object.getOwnPropertyNames(e))s=g7(e[o],n),WDe(s,i,r)&&(t[o]=!0)}function ZDe(t,e,i,r){const n=i.metadatas,s=FDe(n[e],r),o=s?.default;if(o===void 0)return;const a=typeof o=="function"?o.call(t,e,r):o;a!==void 0&&i.set(e,a)}const Oge={origin:"service"};function Rge(t,e,i=Oge){if(!e||typeof e!="object")return;const r=Jl(t),n=r.metadatas,s={};for(const o of Object.getOwnPropertyNames(e))XDe(s,n,o,e,i);r.setDefaultOrigin(i.origin);for(const o of Object.getOwnPropertyNames(s)){const a=g7(n[o],i).read,l=a?.source;let c;c=l&&typeof l=="string"?iM(e,l):e[o],a?.reader&&(c=a.reader.call(t,c,e,i)),c!==void 0&&r.set(o,c)}if(!i||!i.ignoreDefaults){r.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(n))s[o]||ZDe(t,o,r,i)}r.setDefaultOrigin("user")}function Pge(t,e,i,r=Oge){const n={...r,messages:[]};i(n),n.messages?.forEach(s=>{s.type!=="warning"||t.loaded?r?.messages&&r.messages.push(s):t.loadWarnings.push(s)})}function JDe(t,e,i,r,n){const s={};return e.write?.writer?.call(t,r,s,i,n),s}function Mge(t,e,i,r,n,s){if(!r?.write)return!1;const o=Hl(t,i);if(!n&&r.write.overridePolicy){const a=r.write.overridePolicy.call(t,o,i,s??void 0);a!==void 0&&(n=a)}if(n||(n=r.write),!n||n.enabled===!1||n.layerContainerTypes&&s?.layerContainerType&&!n.layerContainerTypes.includes(s.layerContainerType))return!1;if((o===null&&!n.allowNull&&!n.writerEnsuresNonNull||o===void 0)&&n.isRequired){const a=new G("web-document-write:property-required",`Missing value for required property '${i}' on '${t.declaredClass}'`,{propertyName:i,target:t});return a&&s?.messages?s.messages.push(a):a&&!s&&K.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!n.allowNull&&!n.writerEnsuresNonNull||!n.alwaysWriteDefaults&&(!e.store.multipleOriginsSupported||e.store.originOf(i)===Ci.DEFAULTS)&&KDe(t,i,s,r,o)||!n.ignoreOrigin&&s?.origin&&e.store.multipleOriginsSupported&&e.store.originOf(i)<j_(s.origin))}function KDe(t,e,i,r,n){const s=r.default;if(s===void 0)return!1;if(r.defaultEquals!=null)return r.defaultEquals(n);if(typeof s=="function"){if(Array.isArray(n)){const o=s.call(t,e,i??void 0);return vy(o,n)}return!1}return s===n}function QDe(t,e,i,r){const n=Jl(t),s=n.metadatas,o=wge(s[e],r);return!!o&&Mge(t,n,e,o,i,r)}function $ge(t,e,i){if(t&&typeof t.toJSON=="function"&&(!t.toJSON.isDefaultToJSON||!t.write))return BD(e,t.toJSON(i));const r=Jl(t),n=r.metadatas;for(const s in n){const o=wge(n[s],i);if(!Mge(t,r,s,o,void 0,i))continue;const a=Hl(t,s),l=JDe(t,o,o.write&&typeof o.write.target=="string"?o.write.target:s,a,i);Object.keys(l).length>0&&(e=BD(e,l),i?.resources?.pendingOperations?.length&&i.resources.pendingOperations.push(Promise.all(i.resources.pendingOperations).then(()=>BD(e,l,()=>"replace-arrays"))),i?.writtenProperties&&i.writtenProperties.push({target:t,propName:s,oldOrigin:CLe(r.store.originOf(s)),newOrigin:i.origin}))}return e}const cM=t=>{let e=class extends t{constructor(...i){super(...i);const r=Jl(this),n=r.store,s=new HDe;r.store=s,Age(r,n,s)}read(i,r){Rge(this,i,r)}write(i,r){return $ge(this,i??{},r)}toJSON(i){return this.write({},i)}static fromJSON(i,r){return eNe.call(this,i,r)}};return e=u([M("esri.core.JSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function eNe(t,e){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const i=new this;return i.read(t,e),i}function v5(t){return t&&typeof t=="object"&&"toJSON"in t&&typeof t.toJSON=="function"}let pe=class extends cM(we){};pe=u([M("esri.core.JSONSupport")],pe);const tNe=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,iNe={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function fie(t){const e=t?.match(tNe);if(!e)return null;const[,i,r,n]=e;if(!i)return null;let s=null,o=null,a=null;const{devext:l,qaext:c,www:h}=iNe;if(r)if(s=i,n)switch(n.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qa":({customBaseUrl:o,portalHostname:a}=c);break;default:return null}else({customBaseUrl:o,portalHostname:a}=h);else switch(i.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qaext":({customBaseUrl:o,portalHostname:a}=c);break;case"www":({customBaseUrl:o,portalHostname:a}=h);break;default:return null}return{customBaseUrl:o,isPortal:!1,portalHostname:a,urlKey:s}}function Ige(t){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)}function Lge(t){const e=atob(t),i=new Uint8Array(e.length);for(let r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return i.buffer}function rNe(t){const e=new Uint8Array(t);let i="";for(let r=0;r<e.length;r++)i+=String.fromCharCode(e[r]);return btoa(i)}const nNe=K.getLogger("esri.core.urlUtils"),wC=Di.request,mie="esri/config: esriConfig.request.proxyUrl is not set.",Dge=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,Nge=/^\s*http:/i,sNe=/^\s*https:/i,oNe=/^\s*file:/i,aNe=/:\d+$/,lNe=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,cNe=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),uNe=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");let Ic=class{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let i=this.uri.match(cNe);this.scheme=i[2]||(i[1]?"":null),this.authority=i[4]||(i[3]?"":null),this.path=i[5],this.query=i[7]||(i[6]?"":null),this.fragment=i[9]||(i[8]?"":null),this.authority!=null&&(i=this.authority.match(uNe),this.user=i[3]||null,this.password=i[4]||null,this.host=i[6]||i[7],this.port=i[9]||null)}toString(){return this.uri}};const C$={},hNe=new Ic(Di.applicationUrl);let cl=hNe;const dNe=pNe();let zX=dNe;const BX=()=>cl,jRt=()=>zX;function pNe(){const t=cl.path,e=t.substring(0,t.lastIndexOf(t.split("/")[t.split("/").length-1]));return`${`${cl.scheme}://${cl.host}${cl.port!=null?`:${cl.port}`:""}`}${e}`}function Nn(t){if(!t)return null;const e={path:null,query:null},i=new Ic(t),r=t.indexOf("?");return i.query===null?e.path=t:(e.path=t.substring(0,r),e.query=Sw(i.query)),i.fragment&&(e.hash=i.fragment,i.query===null&&(e.path=e.path.substring(0,e.path.length-(i.fragment.length+1)))),e}function Sw(t){const e=t.split("&"),i={};for(const r of e){if(!r)continue;const n=r.indexOf("=");let s,o;n<0?(s=decodeURIComponent(r),o=""):(s=decodeURIComponent(r.slice(0,n)),o=decodeURIComponent(r.slice(n+1)));let a=i[s];typeof a=="string"&&(a=i[s]=[a]),Array.isArray(a)?a.push(o):i[s]=o}return i}function sx(t,e){return t?e&&typeof e=="function"?Object.keys(t).map(i=>encodeURIComponent(i)+"="+encodeURIComponent(e(i,t[i]))).join("&"):Object.keys(t).map(i=>{const r=t[i];if(r==null)return"";const n=encodeURIComponent(i)+"=",s=e?.[i];return s?n+encodeURIComponent(s(r)):Array.isArray(r)?r.map(o=>v5(o)?n+encodeURIComponent(JSON.stringify(o)):n+encodeURIComponent(o)).join("&"):v5(r)?n+encodeURIComponent(JSON.stringify(r)):n+encodeURIComponent(r)}).filter(i=>i).join("&"):""}function fNe(t=!1){let e,i=wC.proxyUrl;if(typeof t=="string"){e=bNe(t);const r=uM(t);r&&(i=r.proxyUrl)}else e=!!t;if(!i)throw nNe.warn(mie),new G("urlutils:proxy-not-set",mie);return e&&v7()&&(i=WX(i)),Nn(i)}function HRt(t){const e=uM(t);let i,r;if(e){const n=VX(e.proxyUrl);i=n.path,r=n.query?Sw(n.query):null}if(i){const n=Nn(t);t=i+"?"+n.path;const s=sx({...r,...n.query});s&&(t=`${t}?${s}`)}return t}const ZC={path:"",query:""};function VX(t){const e=t.indexOf("?");return e!==-1?(ZC.path=t.slice(0,e),ZC.query=t.slice(e+1)):(ZC.path=t,ZC.query=null),ZC}function Fge(t){return t=(t=w5(t=ENe(t=VX(t).path),!0)).toLowerCase()}function mNe(t){const e={proxyUrl:t.proxyUrl,urlPrefix:Fge(t.urlPrefix)},i=wC.proxyRules,r=e.urlPrefix;let n=i.length;for(let s=0;s<i.length;s++){const o=i[s].urlPrefix;if(r.indexOf(o)===0){if(r.length===o.length)return-1;n=s;break}o.indexOf(r)===0&&(n=s+1)}return i.splice(n,0,e),n}function uM(t){const e=wC.proxyRules,i=Fge(t);for(let r=0;r<e.length;r++)if(i.indexOf(e[r].urlPrefix)===0)return e[r]}function gNe(t,e){if(!t||!e)return!1;t=b5(t),e=b5(e);const i=fie(t),r=fie(e);return i!=null&&r!=null?i.portalHostname===r.portalHostname:i==null&&r==null&&Ec(t,e,!0)}function kge(t,e){return t=b5(t),e=b5(e),w5(t)===w5(e)}function b5(t){const e=(t=Bu(t)).indexOf("/sharing");return e>0?t.substring(0,e):t.replace(/\/+$/,"")}function Uge(t){const e=r=>r==null||r instanceof RegExp&&r.test(t)||typeof r=="string"&&t.startsWith(r),i=wC.interceptors;if(i){for(const r of i)if(Array.isArray(r.urls)){if(r.urls.some(e))return r}else if(e(r.urls))return r}return null}function Ec(t,e,i=!1){if(!t||!e)return!1;const r=w7(t),n=w7(e);return!(!i&&r.scheme!==n.scheme)&&r.host!=null&&n.host!=null&&r.host.toLowerCase()===n.host.toLowerCase()&&r.port===n.port}function GX(t){if(typeof t=="string"){if(!Vu(t))return!0;t=w7(t)}if(Ec(t,cl))return!0;const e=wC.trustedServers||[];for(let i=0;i<e.length;i++){const r=yNe(e[i]);for(let n=0;n<r.length;n++)if(Ec(t,r[n]))return!0}return!1}function yNe(t){return C$[t]||(qX(t)||Em(t)?C$[t]=[new Ic(ul(t))]:C$[t]=[new Ic(`http://${t}`),new Ic(`https://${t}`)]),C$[t]}function ul(t,e=zX,i){return Em(t)?i&&i.preserveProtocolRelative?t:cl.scheme==="http"&&cl.authority===Tp(t).slice(2)?`http:${t}`:`https:${t}`:qX(t)?t:Nm(t[0]==="/"?SNe(e):e,t)}function jX(t,e=zX,i){if(t==null||!Vu(t))return t;const r=Bu(t),n=r.toLowerCase(),s=Bu(e).toLowerCase().replace(/\/+$/,""),o=i?Bu(i).toLowerCase().replace(/\/+$/,""):null;if(o&&s.indexOf(o)!==0)return t;const a=(d,f,m)=>(m=d.indexOf(f,m))===-1?d.length:m;let l=a(n,"/",n.indexOf("//")+2),c=-1;for(;n.slice(0,l+1)===s.slice(0,l)+"/"&&(c=l+1,l!==n.length);)l=a(n,"/",l+1);if(c===-1||o&&c<o.length)return t;t=r.slice(c);const h=s.slice(c-1).replaceAll(/[^/]+/g,"").length;if(h>0)for(let d=0;d<h;d++)t=`../${t}`;else t=`./${t}`;return t}function Bu(t){return t=ONe(t=ANe(t=CNe(t=ul(t=t.trim()))))}function Nm(...t){const e=t.filter(Yv);if(!e?.length)return;const i=[];if(Vu(e[0])){const n=e[0],s=n.indexOf("//");s!==-1&&(i.push(n.slice(0,s+1)),xNe(e[0])&&(i[0]+="/"),e[0]=n.slice(s+2))}else e[0][0]==="/"&&i.push("");const r=e.reduce((n,s)=>s?n.concat(s.split("/")):n,[]);for(let n=0;n<r.length;n++){const s=r[n];s===".."&&i.length>0&&i[i.length-1]!==".."?i.pop():(!s&&n===r.length-1||s&&(s!=="."||i.length===0))&&i.push(s)}return i.join("/")}function Tp(t,e=!1){if(t==null||SE(t)||Fm(t))return null;let i=t.indexOf("://");if(i===-1&&Em(t))i=2;else{if(i===-1)return null;i+=3}const r=t.indexOf("/",i);return r!==-1&&(t=t.slice(0,r)),e&&(t=w5(t,!0)),t}function Vu(t){return Em(t)||qX(t)}function SE(t){return t!=null&&t.slice(0,5)==="blob:"}function Fm(t){return t!=null&&t.slice(0,5)==="data:"}function HX(t){const e=_v(t);return e&&e.isBase64?Lge(e.data):null}function N8(t){return rNe(t).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const _Ne=/^data:(.*?)(;base64)?,(.*)$/;function _v(t){const e=t.match(_Ne);if(!e)return null;const[,i,r,n]=e;return{mediaType:i,isBase64:!!r,data:n}}function zge(t){return t.isBase64?`data:${t.mediaType};base64,${t.data}`:`data:${t.mediaType},${t.data}`}async function qRt(t){return(await fetch(t)).blob()}function WRt(t){const e=HX(t);if(!e)return null;const i=_v(t);return new Blob([e],{type:i.mediaType})}function YRt(t,e){vNe(t,e)}function vNe(t,e){if(!t)return!1;const i=document.createElement("a");if(!("download"in i))return!1;const r=URL.createObjectURL(t);return i.download=e,i.href=r,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r),!0}function Em(t){return t!=null&&t[0]==="/"&&t[1]==="/"}function qX(t){return t!=null&&Dge.test(t)}function bNe(t){return t!=null&&sNe.test(t)||cl.scheme==="https"&&Em(t)}function wNe(t){return t!=null&&Nge.test(t)||cl.scheme==="http"&&Em(t)}function xNe(t){return t!=null&&oNe.test(t)}function WX(t){return Em(t)?`https:${t}`:t.replace(Nge,"https:")}function TNe(){return cl.scheme==="http"}function v7(){return cl.scheme==="https"}function w5(t,e=!1){return Em(t)?t.slice(2):(t=t.replace(Dge,""),e&&t.length>1&&t[0]==="/"&&t[1]==="/"&&(t=t.slice(2)),t)}function SNe(t){const e=t.indexOf("//"),i=t.indexOf("/",e+2);return i===-1?t:t.slice(0,i)}function YX(t){let e=0;if(Vu(t)){const r=t.indexOf("//");r!==-1&&(e=r+2)}const i=t.lastIndexOf("/");return i<e?t:t.slice(0,i+1)}function XRt(t,e){if(!t)return"";const i=Nn(t).path.replace(/\/+$/,""),r=i.substring(i.lastIndexOf("/")+1);if(!e?.length)return r;const n=new RegExp(`.(${e.join("|")})$`,"ig");return r.replace(n,"")}function ENe(t){return t.endsWith("/")?t:`${t}/`}function Bge(t){return t.replace(/\/+$/,"")}function CNe(t){if(/^https?:\/\//i.test(t)){const e=VX(t);t=(t=e.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),e.query&&(t+=`?${e.query}`)}return t}function ANe(t){return t.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function ONe(t){const e=wC.httpsDomains;if(!wNe(t))return t;const i=t.indexOf("/",7);let r;if(r=i===-1?t:t.slice(0,i),r=r.toLowerCase().slice(7),aNe.test(r)){if(!r.endsWith(":80"))return t;r=r.slice(0,-3),t=t.replace(":80","")}return TNe()&&r===cl.authority&&!lNe.test(t)||(v7()&&r===cl.authority||e&&e.some(n=>r===n||r.endsWith(`.${n}`))||v7()&&!uM(t))&&(t=WX(t)),t}function b7(t,e,i){if(!(e&&i&&t&&Vu(t)))return t;const r=t.indexOf("//"),n=t.indexOf("/",r+2),s=t.indexOf(":",r+2),o=Math.min(n<0?t.length:n,s<0?t.length:s);return t.slice(r+2,o).toLowerCase()!==e.toLowerCase()?t:`${t.slice(0,r+2)}${i}${t.slice(o)}`}function w7(t){return typeof t=="string"?new Ic(ul(t)):(t.scheme||(t.scheme=cl.scheme),t)}function Vge(t){return PNe.test(t)}function Gge(t,e){const i=Nn(t),r=Object.keys(i.query||{});return r.length>0&&e&&e.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${r.join(", ")}.`),i.path}function XX(t,e,i){const r=Nn(t),n=r.query||{};return n[e]=String(i),`${r.path}?${sx(n)}`}function qD(t,e){if(!e)return t;const i=Nn(t),r=i.query||{};for(const[s,o]of Object.entries(e))o!=null&&(r[s]=o);const n=sx(r);return n?`${i.path}?${n}`:i.path}function RNe(t){if(t==null)return null;const e=t.match(jge);return e?e[2]:null}function gie(t){if(t==null)return null;const e=t.match(jge);return e?{path:e[1],extension:e[2]}:{path:t,extension:null}}async function ZRt(t){return typeof t=="string"?_v(t)??{data:t}:new Promise((e,i)=>{const r=new FileReader;r.readAsDataURL(t),r.onload=()=>e(_v(r.result)),r.onerror=n=>i(n)})}const jge=/([^.]*)\.([^\/]*)$/,PNe=/(^data:image\/svg|\.svg$)/i,Hge="20231030",qge="3a1dbcf6ca66ff827c68b22ba716b8223f3d53ec";Symbol.dispose??(Symbol.dispose=Symbol("Symbol.dispose")),Symbol.asyncDispose??(Symbol.asyncDispose=Symbol("Symbol.asyncDispose"));const Wge="4.28";let Wt,d6=Wge;d6="4.28.4";function MNe(t){Wt=t}function JRt(t){const e=Wt?.findCredential(t);return e?.token?XX(t,"token",e.token):t}ie("host-webworker");const $Ne=new Set(["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"]);function ZX(t){const e=Tp(t,!0);return!!e&&e.endsWith(".arcgis.com")&&!$Ne.has(e)&&!t.endsWith("/sharing/rest/generateToken")}function Yge(t,e,i=!1,r){return new Promise((n,s)=>{if(ps(r))return void s(yie());let o=()=>{c(),s(new Error(`Unable to load ${e}`))},a=()=>{const h=t;c(),n(h)},l=()=>{if(!t)return;const h=t;c(),h.src="",s(yie())};const c=()=>{ie("esri-image-decode")||(t.removeEventListener("error",o),t.removeEventListener("load",a)),o=null,a=null,t=null,r?.removeEventListener("abort",l),l=null,i&&URL.revokeObjectURL(e)};r?.addEventListener("abort",l),ie("esri-image-decode")?t.decode().then(a,o):(t.addEventListener("error",o),t.addEventListener("load",a))})}function yie(){try{return new DOMException("Aborted","AbortError")}catch{const t=new Error;return t.name="AbortError",t}}const Xge="Timeout exceeded";function INe(){return new Error(Xge)}function KRt(t){return typeof t=="object"&&!!t&&"message"in t&&t.message===Xge}function LNe(t){Di.request.crossOriginNoCorsDomains||(Di.request.crossOriginNoCorsDomains={});const e=Di.request.crossOriginNoCorsDomains;for(let i of t)i=i.toLowerCase(),/^https?:\/\//.test(i)?e[Tp(i)??""]=0:(e[Tp("http://"+i)??""]=0,e[Tp("https://"+i)??""]=0)}function DNe(t){const e=Di.request.crossOriginNoCorsDomains;if(e){let i=Tp(t);if(i)return i=i.toLowerCase(),!Ec(i,BX())&&e[i]<Date.now()-36e5}return!1}async function NNe(t){const e=Di.request.crossOriginNoCorsDomains,i=Tp(t);e&&i&&(e[i.toLowerCase()]=Date.now());const r=Nn(t);t=r.path,r.query?.f==="json"&&(t+="?f=json");try{await fetch(t,{mode:"no-cors",credentials:"include"})}catch{}}async function _i(t,e){t instanceof URL&&(t=t.toString()),e?.query instanceof URLSearchParams&&(e.query=Sw(e.query.toString().replaceAll("+"," ")));const i=Fm(t),r=SE(t);r||i||(t=Bu(t));const n={url:t,requestOptions:{...e}};let s=Uge(t);if(s){const c=await jNe(s,n);if(c!=null)return{data:c,getHeader:JX,httpStatus:200,requestOptions:n.requestOptions,url:n.url};s.after||s.error||(s=null)}if(t=n.url,(e=n.requestOptions).responseType==="image"&&(ie("host-webworker")||ie("host-node")))throw hm("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),n);if(e.method==="head"){if(e.body)throw hm("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),n);if(i||r)throw hm("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),n)}if(await BNe(),x5)return x5.execute(t,e);const o=new AbortController;Ms(e,()=>o.abort());const a={controller:o,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:s,params:n,redoRequest:!1,useIdentity:np.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},l=await qNe(a);return s?.after?.(l),l}let x5;const np=Di.request,Zge="FormData"in globalThis,FNe=new Set([499,498,403,401]),kNe=new Set(["COM_0056","COM_0057","SB_0008"]),UNe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],JX=()=>null,T5=Symbol();function zNe(t){const e=Tp(t);e&&!_i._corsServers.includes(e)&&_i._corsServers.push(e)}function _ie(t){const e=Tp(t);return!e||e.endsWith(".arcgis.com")||_i._corsServers.includes(e)||GX(e)}function hm(t,e,i,r){let n="Error";const s={url:i.url,requestOptions:i.requestOptions,getHeader:JX,ssl:!1};if(e instanceof G)return e.details?(e.details=Q(e.details),e.details.url=i.url,e.details.requestOptions=i.requestOptions):e.details=s,e;if(e){const o=r&&(c=>r.headers.get(c)),a=r?.status,l=e.message;l&&(n=l),o&&(s.getHeader=o),s.httpStatus=(e.httpCode!=null?e.httpCode:e.code)||a||0,s.subCode=e.subcode,s.messageCode=e.messageCode,typeof e.details=="string"?s.messages=[e.details]:s.messages=e.details,s.raw=T5 in e?e[T5]:e}return Tn(e)?Ti():new G(t,n,s)}async function BNe(){ie("host-webworker")?x5||(x5=await ce(()=>import("./request-8f418d18.js"),[],import.meta.url)):_i._abortableFetch||(_i._abortableFetch=globalThis.fetch.bind(globalThis))}async function x7(){Wt||await ce(()=>Promise.resolve().then(()=>qOt),void 0,import.meta.url)}async function VNe(t){const e=t.params.url,i=t.params.requestOptions,r=t.controller.signal,n=i.body;let s=null,o=null;if(Zge&&"HTMLFormElement"in globalThis&&(n instanceof FormData?s=n:n instanceof HTMLFormElement&&(s=new FormData(n))),typeof n=="string"&&(o=n),t.fetchOptions={cache:i.cacheBust&&!("polyfill"in _i._abortableFetch)?"no-cache":"default",credentials:"same-origin",headers:i.headers||{},method:i.method==="head"?"HEAD":"GET",mode:"cors",priority:np.priority,redirect:"follow",signal:r},(s||o)&&(t.fetchOptions.body=s||o),i.authMode==="anonymous"&&(t.useIdentity=!1),t.hasToken=!!(/token=/i.test(e)||i.query?.token||s?.get("token")),!t.hasToken&&Di.apiKey&&ZX(e)&&(i.query||(i.query={}),i.query.token=Di.apiKey,t.hasToken=!0),t.useIdentity&&!t.hasToken&&!t.credentialToken&&!Jge(e)&&!ps(r)){let a;i.authMode==="immediate"?(await x7(),a=await Wt.getCredential(e,{signal:r}),t.credential=a):i.authMode==="no-prompt"?(await x7(),a=await Wt.getCredential(e,{prompt:!1,signal:r}).catch(()=>{}),t.credential=a):Wt&&(a=Wt.findCredential(e)),a&&(t.credentialToken=a.token,t.useSSL=!!a.ssl)}}function Jge(t){return UNe.some(e=>e.test(t))}async function GNe(t){let e=t.params.url;const i=t.params.requestOptions,r=t.fetchOptions??{},n=SE(e)||Fm(e),s=i.responseType||"json",o=n?0:i.timeout!=null?i.timeout:np.timeout;let a=!1;if(!n){t.useSSL&&(e=WX(e)),i.cacheBust&&r.cache==="default"&&(e=XX(e,"request.preventCache",Date.now()));let f={...i.query};t.credentialToken&&(f.token=t.credentialToken);let m=sx(f);ie("esri-url-encodes-apostrophe")&&(m=m.replaceAll("'","%27"));const y=e.length+1+m.length;let _;a=i.method==="delete"||i.method==="post"||i.method==="put"||!!i.body||y>np.maxUrlLength;const v=i.useProxy||!!uM(e);if(v){const w=fNe(e);_=w.path,!a&&_.length+1+y>np.maxUrlLength&&(a=!0),w.query&&(f={...w.query,...f})}if(r.method==="HEAD"&&(a||v)){if(a)throw y>np.maxUrlLength?hm("request:invalid-parameters",new Error("URL exceeds maximum length"),t.params):hm("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),t.params);if(v)throw hm("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),t.params)}a?(r.method=i.method==="delete"?"DELETE":i.method==="put"?"PUT":"POST",i.body?e=qD(e,f):(r.body=sx(f),r.headers||(r.headers={}),r.headers["Content-Type"]="application/x-www-form-urlencoded")):e=qD(e,f),v&&(t.useProxy=!0,e=`${_}?${e}`),f.token&&Zge&&r.body instanceof FormData&&!Ige(e)&&r.body.set("token",f.token),i.hasOwnProperty("withCredentials")?t.withCredentials=i.withCredentials:Ec(e,BX())||(GX(e)||Wt&&Wt.findServerInfo(e)?.webTierAuth)&&(t.withCredentials=!0),t.withCredentials&&(r.credentials="include",DNe(e)&&await NNe(a?qD(e,f):e))}let l,c,h=0,d=!1;o>0&&(h=setTimeout(()=>{d=!0,t.controller.abort()},o));try{if(i.responseType==="native-request-init")c=r,c.url=e;else if(i.responseType!=="image"||r.cache!=="default"||r.method!=="GET"||a||HNe(i.headers)||!n&&!t.useProxy&&np.proxyUrl&&!_ie(e)){if(l=await _i._abortableFetch(e,r),t.useProxy||zNe(e),i.responseType==="native")c=l;else if(r.method!=="HEAD")if(l.ok){switch(s){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(h&&(clearTimeout(h),h=0),s==="json"||s==="xml"||s==="document")if(c)switch(s){case"json":c=JSON.parse(c);break;case"xml":c=vie(c,"application/xml");break;case"document":c=vie(c,"text/html")}else c=null;if(c){if(s==="array-buffer"||s==="blob"){const f=l.headers.get("Content-Type");if(f&&/application\/json|text\/plain/i.test(f)&&c[s==="blob"?"size":"byteLength"]<=750)try{const m=await new Response(c).json();m.error&&(c=m)}catch{}}s==="image"&&c instanceof Blob&&(c=await bie(URL.createObjectURL(c),t,!0))}}else{c=await l.text();try{c=JSON.parse(c)}catch{}}}else c=await bie(e,t)}catch(f){if(f.name==="AbortError")throw d?INe():Ti("Request canceled");if(!(!l&&f instanceof TypeError&&np.proxyUrl)||i.body||i.method==="delete"||i.method==="head"||i.method==="post"||i.method==="put"||t.useProxy||_ie(e))throw f;t.redoRequest=!0,mNe({proxyUrl:np.proxyUrl,urlPrefix:Tp(e)??""})}finally{h&&clearTimeout(h)}return[l,c]}async function jNe(t,e){if(t.responseData!=null)return t.responseData;if(t.headers&&(e.requestOptions.headers={...e.requestOptions.headers,...t.headers}),t.query&&(e.requestOptions.query={...e.requestOptions.query,...t.query}),t.before){let i,r;try{r=await t.before(e)}catch(n){i=hm("request:interceptor",n,e)}if((r instanceof Error||r instanceof G)&&(i=hm("request:interceptor",r,e)),i)throw t.error&&t.error(i),i;return r}}function HNe(t){if(t){for(const e of Object.getOwnPropertyNames(t))if(t[e])return!0}return!1}function vie(t,e){let i;try{i=new DOMParser().parseFromString(t,e)}catch{}if(!i||i.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return i}async function qNe(t){let e,i;await VNe(t);try{do[e,i]=await GNe(t);while(!await WNe(t,e,i))}catch(s){const o=hm("request:server",s,t.params,e);throw o.details.ssl=t.useSSL,t.interceptor?.error&&t.interceptor.error(o),o}const r=t.params.url;if(i&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(r)){if(!t.hasToken&&!t.credentialToken&&i.user?.username&&!GX(r)){const s=Tp(r,!0);s&&np.trustedServers.push(s)}Array.isArray(i.authorizedCrossOriginNoCorsDomains)&&LNe(i.authorizedCrossOriginNoCorsDomains)}const n=t.credential;if(n&&Wt){let o=Wt.findServerInfo(n.server)?.owningSystemUrl;if(o){o=o.replace(/\/?$/,"/sharing");const a=Wt.findCredential(o,n.userId);a&&Wt._getIdenticalSvcIdx(o,a)===-1&&a.resources.unshift(o)}}return{data:i,getHeader:e?s=>e?.headers.get(s):JX,httpStatus:e?.status??200,requestOptions:t.params.requestOptions,ssl:t.useSSL,url:t.params.url}}async function WNe(t,e,i){if(t.redoRequest)return t.redoRequest=!1,!1;const r=t.params.requestOptions;if(!e||r.responseType==="native"||r.responseType==="native-request-init")return!0;let n,s;if(i&&(i.error?n=i.error:i.status==="error"&&Array.isArray(i.messages)&&(n={...i},n[T5]=i,n.details=i.messages)),!n&&!e.ok)throw n=new Error(`Unable to load ${e.url} status: ${e.status}`),n[T5]=i,n;let o,a=null;n&&(s=Number(n.code),a=n.hasOwnProperty("subcode")?Number(n.subcode):null,o=n.messageCode,o=o?.toUpperCase());const l=r.authMode;if(s===403&&(a===4||n.message?.toLowerCase().includes("ssl")&&!n.message.toLowerCase().includes("permission"))){if(!t.useSSL)return t.useSSL=!0,!1}else if(!t.hasToken&&t.useIdentity&&(l!=="no-prompt"||s===498)&&s!==void 0&&FNe.has(s)&&!Jge(t.params.url)&&(s!==403||(!o||!kNe.has(o))&&(a==null||a===2&&t.credentialToken))){await x7();try{const c=await Wt.getCredential(t.params.url,{error:hm("request:server",n,t.params),prompt:l!=="no-prompt",signal:t.controller.signal,token:t.credentialToken});return t.credential=c,t.credentialToken=c.token,t.useSSL=t.useSSL||c.ssl,!1}catch(c){if(l==="no-prompt")return t.credential=void 0,t.credentialToken=void 0,!1;n=c}}if(n)throw n;return!0}function bie(t,e,i=!1){const r=e.controller.signal,n=new Image;return e.withCredentials?n.crossOrigin="use-credentials":n.crossOrigin="anonymous",n.alt="",n.fetchPriority=np.priority,n.src=t,Yge(n,t,i,r)}_i._abortableFetch=null,_i._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];let WD=class Kge{constructor(){this._emitter=new Kge.EventEmitter(this)}emit(e,i){return this._emitter.emit(e,i)}on(e,i){return this._emitter.on(e,i)}once(e,i){return this._emitter.once(e,i)}hasEventListener(e){return this._emitter.hasEventListener(e)}};(function(t){class e{constructor(n=null){this._target=n,this._listenersMap=null}clear(){this._listenersMap?.clear(),this._listenersMap=null}destroy(){this.clear()}emit(n,s){let o=this._listenersMap?.get(n);if(!o)return!1;const a=this._target||this;let l=!1;for(const c of o.slice()){const h="deref"in c?c.deref():c;h?h?.call(a,s):l=!0}return l&&(o=o.filter(c=>!("deref"in c)||c.deref()!=null),this._listenersMap.set(n,o)),o.length>0}on(n,s){if(Array.isArray(n)){const a=n.map(l=>this.on(l,s));return yv(a)}if(n.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap??(this._listenersMap=new Map);const o=this._listenersMap.get(n)||[];return o.push(s),this._listenersMap.set(n,o),Vi(()=>{const a=this._listenersMap?.get(n),l=a?.indexOf(s)??-1;l>=0&&a.splice(l,1)})}once(n,s){const o=this.on(n,a=>{o.remove(),("deref"in s?s.deref():s)?.call(null,a)});return o}hasEventListener(n){const s=this._listenersMap?.get(n);return s!=null&&s.length>0}}t.EventEmitter=e,t.EventedMixin=r=>{let n=class extends r{constructor(){super(...arguments),this._emitter=new e}destroy(){this._emitter.clear()}emit(s,o){return this._emitter.emit(s,o)}on(s,o){return this._emitter.on(s,o)}once(s,o){return this._emitter.once(s,o)}hasEventListener(s){return this._emitter.hasEventListener(s)}};return n=u([M("esri.core.Evented")],n),n};let i=class extends we{constructor(){super(...arguments),this._emitter=new WD.EventEmitter(this)}destroy(){this._emitter.clear()}emit(r,n){return this._emitter.emit(r,n)}on(r,n){return this._emitter.on(r,n)}once(r,n){return this._emitter.once(r,n)}hasEventListener(r){return this._emitter.hasEventListener(r)}};i=u([M("esri.core.Evented")],i),t.EventedAccessor=i})(WD||(WD={}));const Sn=WD;var cr;(function(t){t[t.ADD=1]="ADD",t[t.REMOVE=2]="REMOVE",t[t.MOVE=4]="MOVE"})(cr||(cr={}));function Qge(t){return(e,i)=>{e[i]=t}}let hM=class extends Gme{notify(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onInvalidated(),r.onCommitted()}}};var Hg;let YNe=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}},XNe=class{constructor(e,i,r,n,s){this.target=e,this.added=i,this.removed=r,this.start=n,this.deleteCount=s}};const sh=new $a(YNe,void 0,t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1});function F8(t){return t?t instanceof ow?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function k8(t){if(t?.length)return t[0]}function ZNe(t,e,i,r){const n=Math.min(t.length-i,e.length-r);let s=0;for(;s<n&&t[i+s]===e[r+s];)s++;return s}function eye(t,e,i,r){e&&e.forEach((n,s,o)=>{t.push(n),eye(t,i.call(r,n,s,o),i,r)})}const a0=new Set,l0=new Set,c0=new Set,U8=new Map;let JNe=0,ow=Hg=class extends Sn.EventedAccessor{static isCollection(t){return t!=null&&t instanceof Hg}constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new hM,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:JNe++})}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof Hg?{items:t}:t:{}}destroy(){this._removeAllRaw()}*[Symbol.iterator](){yield*this.items}get items(){return Mt(this._observable),this._items}set items(t){this._emitBeforeChanges(cr.ADD)||(this._splice(0,this.length,F8(t)),this._emitAfterChanges(cr.ADD))}hasEventListener(t){return t==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(t)}on(t,e){if(t==="change"){const i=this._chgListeners,r={removed:!1,callback:e};return i.push(r),this._notifications&&this._notifications.push({listeners:i.slice(),items:this._items.slice(),changes:[]}),Vi(()=>{r.removed=!0,i.splice(i.indexOf(r),1)})}return this._emitter.on(t,e)}once(t,e){const i="deref"in e?()=>e.deref():()=>e,r=this.on(t,n=>{i()?.call(null,n),r.remove()});return r}add(t,e){if(Mt(this._observable),this._emitBeforeChanges(cr.ADD))return this;const i=this.getNextIndex(e??null);return this._splice(i,0,[t]),this._emitAfterChanges(cr.ADD),this}addMany(t,e=this._items.length){if(Mt(this._observable),!t?.length)return this;if(this._emitBeforeChanges(cr.ADD))return this;const i=this.getNextIndex(e);return this._splice(i,0,F8(t)),this._emitAfterChanges(cr.ADD),this}at(t){if(Mt(this._observable),(t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this._items[t]}removeAll(){if(Mt(this._observable),!this.length||this._emitBeforeChanges(cr.REMOVE))return[];const t=this._removeAllRaw();return this._emitAfterChanges(cr.REMOVE),t}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return Mt(this._observable),this._createNewInstance({items:this._items.map(Q)})}concat(...t){Mt(this._observable);const e=t.map(F8);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(Mt(this._observable),!this.length||this._emitBeforeChanges(cr.REMOVE))return;const i=this._splice(0,this.length),r=i.length;for(let n=0;n<r;n++)t.call(e,i[n],n,i);this._emitAfterChanges(cr.REMOVE)}every(t,e){return Mt(this._observable),this._items.every(t,e)}filter(t,e){let i;return Mt(this._observable),i=arguments.length===2?this._items.filter(t,e):this._items.filter(t),this._createNewInstance({items:i})}find(t,e){return Mt(this._observable),this._items.find(t,e)}findIndex(t,e){return Mt(this._observable),this._items.findIndex(t,e)}flatten(t,e){Mt(this._observable);const i=[];return eye(i,this,t,e),new Hg(i)}forEach(t,e){return Mt(this._observable),this._items.forEach(t,e)}getItemAt(t){return Mt(this._observable),this._items[t]}getNextIndex(t){Mt(this._observable);const e=this.length;return(t=t??e)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return Mt(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return Mt(this._observable),this._items.indexOf(t,e)}join(t=","){return Mt(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return Mt(this._observable),this._items.lastIndexOf(t,e)}map(t,e){Mt(this._observable);const i=this._items.map(t,e);return new Hg({items:i})}reorder(t,e=this.length-1){Mt(this._observable);const i=this.indexOf(t);if(i!==-1){if(e<0?e=0:e>=this.length&&(e=this.length-1),i!==e){if(this._emitBeforeChanges(cr.MOVE))return t;this._splice(i,1),this._splice(e,0,[t]),this._emitAfterChanges(cr.MOVE)}return t}}pop(){if(Mt(this._observable),!this.length||this._emitBeforeChanges(cr.REMOVE))return;const t=k8(this._splice(this.length-1,1));return this._emitAfterChanges(cr.REMOVE),t}push(...t){return Mt(this._observable),this._emitBeforeChanges(cr.ADD)||(this._splice(this.length,0,t),this._emitAfterChanges(cr.ADD)),this.length}reduce(t,e){Mt(this._observable);const i=this._items;return arguments.length===2?i.reduce(t,e):i.reduce(t)}reduceRight(t,e){Mt(this._observable);const i=this._items;return arguments.length===2?i.reduceRight(t,e):i.reduceRight(t)}remove(t){return Mt(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(Mt(this._observable),t<0||t>=this.length||this._emitBeforeChanges(cr.REMOVE))return;const e=k8(this._splice(t,1));return this._emitAfterChanges(cr.REMOVE),e}removeMany(t){if(Mt(this._observable),!t?.length||this._emitBeforeChanges(cr.REMOVE))return[];const e=t instanceof Hg?t.toArray():t,i=this._items,r=[],n=e.length;for(let s=0;s<n;s++){const o=e[s],a=i.indexOf(o);if(a>-1){const l=1+ZNe(e,i,s+1,a+1),c=this._splice(a,l);c&&c.length>0&&r.push.apply(r,c),s+=l-1}}return this._emitAfterChanges(cr.REMOVE),r}reverse(){if(Mt(this._observable),this._emitBeforeChanges(cr.MOVE))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(cr.MOVE),this}shift(){if(Mt(this._observable),!this.length||this._emitBeforeChanges(cr.REMOVE))return;const t=k8(this._splice(0,1));return this._emitAfterChanges(cr.REMOVE),t}slice(t=0,e=this.length){return Mt(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return Mt(this._observable),this._items.some(t,e)}sort(t){if(Mt(this._observable),!this.length||this._emitBeforeChanges(cr.MOVE))return this;const e=this._splice(0,this.length);return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(cr.MOVE),this}splice(t,e,...i){Mt(this._observable);const r=(e?cr.REMOVE:0)|(i.length?cr.ADD:0);if(this._emitBeforeChanges(r))return[];const n=this._splice(t,e,i)||[];return this._emitAfterChanges(r),n}toArray(){return Mt(this._observable),this._items.slice()}toJSON(){return Mt(this._observable),this.toArray()}toLocaleString(){return Mt(this._observable),this._items.toLocaleString()}toString(){return Mt(this._observable),this._items.toString()}unshift(...t){return Mt(this._observable),!t.length||this._emitBeforeChanges(cr.ADD)||(this._splice(0,0,t),this._emitAfterChanges(cr.ADD)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,i){const r=this._items,n=this.itemType;let s,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=Ux(()=>this._dispatchChange())),t<0&&(t+=this.length),e){if(o=r.splice(t,e),this.hasEventListener("before-remove")){const a=sh.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)s=o[l],a.reset(s),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),r.splice(t,0,s),t+=1,l-=1,c-=1);sh.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=sh.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);sh.release(a)}}if(i?.length){if(n){const h=[];for(const d of i){const f=n.ensureType(d);f==null&&d!=null||h.push(f)}i=h}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=t===this.length;if(a||l){const h=sh.acquire();h.target=this,h.cancellable=!0;const d=sh.acquire();d.target=this,d.cancellable=!1;for(const f of i)a?(h.reset(f),this.emit("before-add",h),h.defaultPrevented||(c?r.push(f):r.splice(t++,0,f),this._set("length",r.length),l&&(d.reset(f),this.emit("after-add",d)))):(c?r.push(f):r.splice(t++,0,f),this._set("length",r.length),d.reset(f),this.emit("after-add",d));sh.release(d),sh.release(h)}else{if(c)for(const h of i)r.push(h);else r.splice(t,0,...i);this._set("length",r.length)}}if((i?.length||o?.length)&&this._notifyChangeEvent(i,o),this.hasEventListener("after-splice")){const a=new XNe(this,i,o,t,e);this.emit("after-splice",a)}return o}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const i=sh.acquire();i.target=this,i.cancellable=!0,i.type=t,this.emit("before-changes",i),e=i.defaultPrevented,sh.release(i)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=sh.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),sh.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const i=e.changes;a0.clear(),l0.clear(),c0.clear();for(const{added:l,removed:c}of i){if(l)if(c0.size===0&&l0.size===0)for(const h of l)a0.add(h);else for(const h of l)l0.has(h)?(c0.add(h),l0.delete(h)):c0.has(h)||a0.add(h);if(c)if(c0.size===0&&a0.size===0)for(const h of c)l0.add(h);else for(const h of c)a0.has(h)?a0.delete(h):(c0.delete(h),l0.add(h))}const r=Mc.acquire();a0.forEach(l=>{r.push(l)});const n=Mc.acquire();l0.forEach(l=>{n.push(l)});const s=this._items,o=e.items,a=Mc.acquire();if(c0.forEach(l=>{o.indexOf(l)!==s.indexOf(l)&&a.push(l)}),e.listeners&&(r.length||n.length||a.length)){const l={target:this,added:r,removed:n,moved:a},c=e.listeners.length;for(let h=0;h<c;h++){const d=e.listeners[h];d.removed||d.callback.call(this,l)}}Mc.release(r),Mc.release(n),Mc.release(a)}a0.clear(),l0.clear(),c0.clear()}};ow.ofType=t=>{if(!t)return Hg;if(U8.has(t))return U8.get(t);let e=null;if(typeof t=="function")e=t.prototype.declaredClass;else if(t.base)e=t.base.prototype.declaredClass;else for(const r in t.typeMap){const n=t.typeMap[r].prototype.declaredClass;e?e+=` | ${n}`:e=n}let i=class extends Hg{};return u([Qge({Type:t,ensureType:typeof t=="function"?as(t):Tm(t)})],i.prototype,"itemType",void 0),i=u([M(`esri.core.Collection<${e}>`)],i),U8.set(t,i),i},u([p()],ow.prototype,"length",void 0),u([p()],ow.prototype,"items",null),ow=Hg=u([M("esri.core.Collection")],ow);const Je=ow;function wy(t,e,i=Je){return e||(e=new i),e===t||(e.removeAll(),KNe(t)?e.addMany(t):t&&e.add(t)),e}function KX(t){return t}function KNe(t){return t&&(Array.isArray(t)||"items"in t&&Array.isArray(t.items))}var E_;(function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"})(E_||(E_={}));let QNe=class{constructor(){this._resolver=Hs(),this._status=E_.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=E_.RESOLVED,this._cleanUp()},()=>{this._status=E_.REJECTED,this._cleanUp()}),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===E_.RESOLVED}isRejected(){return this._status===E_.REJECTED}isFulfilled(){return this._status!==E_.PENDING}abort(){this._resolver.reject(Ti())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const e=Hs(),i=[...this._resolvingPromises,e.promise],r=this._allPromise=Promise.all(i);r.then(()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve()},n=>{this.isFulfilled()||this._allPromise!==r||Tn(n)||this._resolver.reject(n)}),e.resolve()}};const p6=t=>{let e=class extends t{constructor(...i){super(...i),this._promiseProps=new QNe,this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(i,r){return this._promiseProps.promise.then(()=>this).then(i,r)}catch(i){return this.when(null,i)}addResolvingPromise(i){i&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in i?i.when():i)}};return e=u([M("esri.core.Promise")],e),e};let S5=class extends p6(we){};S5=u([M("esri.core.Promise")],S5);const e4e="not-loaded",t4e="loading",i4e="failed",wie="loaded",tye=t=>{let e=class extends t{constructor(...i){super(...i),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(r=>{const n=this.load.bind(this);this.load=s=>{const o=new Promise((a,l)=>{const c=sM(s,l);this.destroyed&&l(new G("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===e4e){this._set("loadStatus",t4e);const a=this._loadController=new AbortController;n({signal:a.signal})}return r(),o}})),this.when(()=>{this._set("loadStatus",wie),this._loadController=null},r=>{this._set("loadStatus",i4e),this._set("loadError",r),this._loadController=null})}destroy(){this._loadController&&(this._loadController=Gc(this._loadController),this._promiseProps.abort()),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===wie}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){return this.isFulfilled()||(this._set("loadError",new G("load:cancelled","Cancelled")),this._loadController?.abort(),this._promiseProps.abort()),this}};return u([p({readOnly:!0})],e.prototype,"loaded",null),u([p({readOnly:!0})],e.prototype,"loadError",void 0),u([p({clonable:!1})],e.prototype,"loadStatus",void 0),u([p({type:[Sm],readOnly:!0})],e.prototype,"loadWarnings",null),e=u([M("esri.core.Loadable")],e),e};let n3=class extends tye(S5){};n3=u([M("esri.core.Loadable")],n3),function(t){function e(i){return!(!i||!i.load)}t.LoadableMixin=tye,t.isLoadable=e}(n3||(n3={}));const xy=n3;function f6(t,e,i){return oM(t.map((r,n)=>e.apply(i,[r,n])))}async function r4e(t,e,i){return(await oM(t.map((r,n)=>e.apply(i,[r,n])))).map(r=>r.value)}function QX(t){return{ok:!0,value:t}}function eZ(t){return{ok:!1,error:t}}function n4e(t){return t!=null&&t.ok===!0?t.value:null}function s4e(t){return t!=null&&t.ok===!1?t.error:null}async function jc(t){if(t==null)return{ok:!1,error:new Error("no promise provided")};try{return QX(await t)}catch(e){return eZ(e)}}async function o4e(t){try{return QX(await t)}catch(e){return Gl(e),eZ(e)}}function sPt(t){if(t.ok===!0)return t.value;throw t.error}function Xv(t,e){return new W0(t,e)}let W0=class extends we{get value(){return n4e(this._result)}get error(){return s4e(this._result)}get finished(){return this._result!=null}constructor(e,i){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=Gc(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:r}=this._abortController;this.promise=e(r),this.promise.then(n=>{this._result=QX(n),this._cleanup()},n=>{this._result=eZ(n),this._cleanup()}),this._abortHandle=Ms(i,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=Tr(this._abortHandle),this._abortController=null}};u([p()],W0.prototype,"value",null),u([p()],W0.prototype,"error",null),u([p()],W0.prototype,"finished",null),u([p()],W0.prototype,"promise",void 0),u([p()],W0.prototype,"_result",void 0),W0=u([M("esri.core.asyncUtils.ReactiveTask")],W0);async function tZ(t,e){return await t.load(),a4e(t,e)}async function a4e(t,e){const i=[],r=(...s)=>{for(const o of s)o!=null&&(Array.isArray(o)?r(...o):Je.isCollection(o)?o.forEach(a=>r(a)):xy.isLoadable(o)&&i.push(o))};e(r);let n=null;if(await r4e(i,async s=>{const o=await jc(l4e(s)?s.loadAll():s.load());o.ok!==!1||n||(n=o)}),n)throw n.error;return t}function l4e(t){return"loadAll"in t&&typeof t.loadAll=="function"}function Be(t,e,i){let r,n;return e===void 0?(n=t,r=[void 0]):typeof e!="string"?(n=t,r=[void 0],i=e):(n=e,r=Array.isArray(t)?t:[t]),(s,o)=>{const a=s.constructor.prototype;for(const l of r){const c=fge(s,l,n);c.write&&typeof c.write=="object"||(c.write={}),i&&(c.write.target=i),c.write.writer=a[o]}}}let Sr=class{constructor(e,i={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=i,this.apiValues=[],this.jsonValues=[],this._apiToJSON=this._invertMap(e),this.apiValues=this._getKeysSorted(this._apiToJSON),this.jsonValues=this._getKeysSorted(this._jsonToAPI),this.read=r=>this.fromJSON(r),this.write=(r,n,s)=>{const o=this.toJSON(r);o!==void 0&&Mp(s,o,n)},this.write.isJSONMapWriter=!0}toJSON(e){if(e==null)return null;if(this._apiToJSON.hasOwnProperty(e)){const i=this._apiToJSON[e];return this._options.useNumericKeys?+i:i}return this._options.ignoreUnknown?void 0:e}fromJSON(e){return e!=null&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}_invertMap(e){const i={};for(const r in e)i[e[r]]=r;return i}_getKeysSorted(e){const i=[];for(const r in e)i.push(r);return i.sort(),i}};function yl(){return function(t,e){return new Sr(t,{ignoreUnknown:!0,...e})}}let iZ=class{constructor(e,i,r,n){this.semiMajorAxis=e,this.flattening=i,this.outerAtmosphereRimWidth=r;const s=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*s,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=n||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const Ai=new iZ(6378137,1/298.257223563,3e5,.006694379990137799),dm=new iZ(3396190,1/169.8944472236118,23e4),Ty=new iZ(1737400,0,0),c4e=K.getLogger("esri.assets");function u4e(t,e){return _i(ur(t),e)}function ur(t){if(!Di.assetsPath)throw c4e.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new G("assets:path-not-set","config.assetsPath is not set");return Nm(Di.assetsPath,t)}let z8,te=null;function iye(){return!!te}function h4e(){return!!ie("esri-wasm")}function rye(){return z8||(z8=ce(()=>import("./pe-wasm-3f8eceda.js"),[],import.meta.url).then(t=>t.p).then(({default:t})=>t({locateFile:e=>ur(`esri/geometry/support/${e}`)})).then(t=>{sye(t)}),z8)}var T7,qn,S7;(function(t){function e(s,o,a){te.ensureCache.prepare();const l=aw(a),c=a===l,h=te.ensureFloat64(l),d=te._pe_geog_to_proj(te.getPointer(s),o,h);return d&&D_(a,o,h,c),d}function i(s,o,a,l){switch(l){case qn.PE_TRANSFORM_P_TO_G:return r(s,o,a);case qn.PE_TRANSFORM_G_TO_P:return e(s,o,a)}return 0}function r(s,o,a){return n(s,o,a,0)}function n(s,o,a,l){te.ensureCache.prepare();const c=aw(a),h=a===c,d=te.ensureFloat64(c),f=te._pe_proj_to_geog_center(te.getPointer(s),o,d,l);return f&&D_(a,o,d,h),f}t.geogToProj=e,t.projGeog=i,t.projToGeog=r,t.projToGeogCenter=n})(T7||(T7={})),function(t){function e(){t.PE_BUFFER_MAX=te.PeDefs.prototype.PE_BUFFER_MAX,t.PE_NAME_MAX=te.PeDefs.prototype.PE_NAME_MAX,t.PE_MGRS_MAX=te.PeDefs.prototype.PE_MGRS_MAX,t.PE_USNG_MAX=te.PeDefs.prototype.PE_USNG_MAX,t.PE_DD_MAX=te.PeDefs.prototype.PE_DD_MAX,t.PE_DDM_MAX=te.PeDefs.prototype.PE_DDM_MAX,t.PE_DMS_MAX=te.PeDefs.prototype.PE_DMS_MAX,t.PE_UTM_MAX=te.PeDefs.prototype.PE_UTM_MAX,t.PE_PARM_MAX=te.PeDefs.prototype.PE_PARM_MAX,t.PE_TYPE_NONE=te.PeDefs.prototype.PE_TYPE_NONE,t.PE_TYPE_GEOGCS=te.PeDefs.prototype.PE_TYPE_GEOGCS,t.PE_TYPE_PROJCS=te.PeDefs.prototype.PE_TYPE_PROJCS,t.PE_TYPE_GEOGTRAN=te.PeDefs.prototype.PE_TYPE_GEOGTRAN,t.PE_TYPE_COORDSYS=te.PeDefs.prototype.PE_TYPE_COORDSYS,t.PE_TYPE_UNIT=te.PeDefs.prototype.PE_TYPE_UNIT,t.PE_TYPE_LINUNIT=te.PeDefs.prototype.PE_TYPE_LINUNIT,t.PE_STR_OPTS_NONE=te.PeDefs.prototype.PE_STR_OPTS_NONE,t.PE_STR_AUTH_NONE=te.PeDefs.prototype.PE_STR_AUTH_NONE,t.PE_STR_AUTH_TOP=te.PeDefs.prototype.PE_STR_AUTH_TOP,t.PE_STR_NAME_CANON=te.PeDefs.prototype.PE_STR_NAME_CANON,t.PE_STR_FMT_WKT=te.PeDefs.prototype.PE_STR_FMT_WKT,t.PE_STR_FMT_WKT2=te.PeDefs.prototype.PE_STR_FMT_WKT2,t.PE_PARM_X0=te.PeDefs.prototype.PE_PARM_X0,t.PE_PARM_ND=te.PeDefs.prototype.PE_PARM_ND,t.PE_TRANSFORM_1_TO_2=te.PeDefs.prototype.PE_TRANSFORM_1_TO_2,t.PE_TRANSFORM_2_TO_1=te.PeDefs.prototype.PE_TRANSFORM_2_TO_1,t.PE_TRANSFORM_P_TO_G=te.PeDefs.prototype.PE_TRANSFORM_P_TO_G,t.PE_TRANSFORM_G_TO_P=te.PeDefs.prototype.PE_TRANSFORM_G_TO_P,t.PE_HORIZON_RECT=te.PeDefs.prototype.PE_HORIZON_RECT,t.PE_HORIZON_POLY=te.PeDefs.prototype.PE_HORIZON_POLY,t.PE_HORIZON_LINE=te.PeDefs.prototype.PE_HORIZON_LINE,t.PE_HORIZON_DELTA=te.PeDefs.prototype.PE_HORIZON_DELTA}t.init=e}(qn||(qn={})),function(t){const e={},i={},r=m=>{if(m){const y=m.getType();switch(y){case qn.PE_TYPE_GEOGCS:m=te.castObject(m,te.PeGeogcs);break;case qn.PE_TYPE_PROJCS:m=te.castObject(m,te.PeProjcs);break;case qn.PE_TYPE_GEOGTRAN:m=te.castObject(m,te.PeGeogtran);break;default:y&qn.PE_TYPE_UNIT&&(m=te.castObject(m,te.PeUnit))}}return m};function n(){te.PeFactory.prototype.initialize(null)}function s(m){return o(qn.PE_TYPE_COORDSYS,m)}function o(m,y){let _=null,v=e[m];if(v||(v={},e[m]=v),v.hasOwnProperty(String(y)))_=v[y];else{const w=te.PeFactory.prototype.factoryByType(m,y);te.compare(w,te.NULL)||(_=w,v[y]=_)}return _=r(_),_}function a(m,y){let _=null,v=i[m];if(v||(v={},i[m]=v),v.hasOwnProperty(y))_=v[y];else{const w=te.PeFactory.prototype.fromString(m,y);te.compare(w,te.NULL)||(_=w,v[y]=_)}return _=r(_),_}function l(m){return o(qn.PE_TYPE_GEOGCS,m)}function c(m){return o(qn.PE_TYPE_GEOGTRAN,m)}function h(m){return te.PeFactory.prototype.getCode(m)}function d(m){return o(qn.PE_TYPE_PROJCS,m)}function f(m){return o(qn.PE_TYPE_UNIT,m)}t.initialize=n,t.coordsys=s,t.factoryByType=o,t.fromString=a,t.geogcs=l,t.geogtran=c,t.getCode=h,t.projcs=d,t.unit=f}(S7||(S7={}));let nye=null;var E5,E7,C7,A7,C5,O7,A5,O5,R7;function sye(t){function e(s,o,a){s[o]=a(s[o])}te=t,qn.init(),E5.init(),C5.init(),A5.init(),O5.init(),nye=class extends te.PeGCSExtent{destroy(){te.destroy(this)}};const i=[te.PeDatum,te.PeGeogcs,te.PeGeogtran,te.PeObject,te.PeParameter,te.PePrimem,te.PeProjcs,te.PeSpheroid,te.PeUnit];for(const s of i)e(s.prototype,"getName",o=>function(){return o.call(this,new Array(qn.PE_NAME_MAX))});for(const s of[te.PeGeogtran,te.PeProjcs])e(s.prototype,"getParameters",o=>function(){const a=new Array(qn.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const h=te.getValue(l,"*");a[c]=h?te.wrapPointer(h,te.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});e(te.PeHorizon.prototype,"getCoord",s=>function(){const o=this.getSize();if(!o)return null;const a=[];return D_(a,o,s.call(this)),a}),e(te.PeGTlistExtendedEntry.prototype,"getEntries",s=>{const o=te._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=s.call(this);if(!te.compare(l,te.NULL)){a=[l];const c=this.getSteps();if(c>1){const h=te.getPointer(l);for(let d=1;d<c;d++)a.push(te.wrapPointer(h+o*d,te.PeGTlistExtendedGTs))}}return a}});const r=te._pe_getPeHorizonSize(),n=s=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(s))return o.get(s);let a=null;const l=s.call(this);if(!te.compare(l,te.NULL)){a=[l];const c=l.getNump();if(c>1){const h=te.getPointer(l);for(let d=1;d<c;d++)a.push(te.wrapPointer(h+r*d,te.PeHorizon))}}return o.set(s,a),a};e(te.PeProjcs.prototype,"horizonGcsGenerate",n),e(te.PeProjcs.prototype,"horizonPcsGenerate",n),te.PeObject.prototype.toString=function(s=qn.PE_STR_OPTS_NONE){te.ensureCache.prepare();const o=te.getPointer(this),a=te.ensureInt8(new Array(qn.PE_BUFFER_MAX));return te.UTF8ToString(te._pe_object_to_string_ext(o,s,a))}}function Km(t){if(!t)return;const e=te.getClass(t);if(!e)return;const i=te.getCache(e);if(!i)return;const r=te.getPointer(t);r&&delete i[r]}function A$(t,e){const i=[],r=new Array(e);for(let n=0;n<t;n++)i.push(te.ensureInt8(r));return i}function aw(t){let e;return Array.isArray(t[0])?(e=[],t.forEach(i=>{e.push(i[0],i[1])})):e=t,e}function D_(t,e,i,r=!1){if(r)for(let n=0;n<2*e;n++)t[n]=te.getValue(i+n*Float64Array.BYTES_PER_ELEMENT,"double");else{const n=t.length===0;for(let s=0;s<e;s++)n&&(t[s]=new Array(2)),t[s][0]=te.getValue(i,"double"),t[s][1]=te.getValue(i+Float64Array.BYTES_PER_ELEMENT,"double"),i+=2*Float64Array.BYTES_PER_ELEMENT}}(function(t){let e;function i(){t.PE_GTLIST_OPTS_COMMON=te.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,e=te._pe_getPeGTlistExtendedEntrySize()}function r(n,s,o,a,l,c){let h=null;const d=new te.PeInteger(c);try{const f=te.PeGTlistExtended.prototype.getGTlist(n,s,o,a,l,d);if((c=d.val)&&(h=[f],c>1)){const m=te.getPointer(f);for(let y=1;y<c;y++)h.push(te.wrapPointer(m+e*y,te.PeGTlistExtendedEntry))}}finally{te.destroy(d)}return h}t.init=i,t.getGTlist=r})(E5||(E5={})),function(t){function e(i){if(i?.length){for(const r of i)Km(r),r.getEntries().forEach(n=>{Km(n);const s=n.getGeogtran();Km(s),s.getParameters().forEach(Km),[s.getGeogcs1(),s.getGeogcs2()].forEach(o=>{Km(o);const a=o.getDatum();Km(a),Km(a.getSpheroid()),Km(o.getPrimem()),Km(o.getUnit())})});te.PeGTlistExtendedEntry.prototype.Delete(i[0])}}t.destroy=e}(E7||(E7={})),function(t){function e(i,r,n,s,o){te.ensureCache.prepare();const a=aw(n),l=n===a,c=te.ensureFloat64(a);let h=0;s&&(h=te.ensureFloat64(s));const d=te._pe_geog_to_geog(te.getPointer(i),r,c,h,o);return d&&D_(n,r,c,l),d}t.geogToGeog=e}(C7||(C7={})),function(t){const e=(c,h,d,f,m,y)=>{let _,v;switch(te.ensureCache.prepare(),c){case"dd":_=te._pe_geog_to_dd,v=qn.PE_DD_MAX;break;case"ddm":_=te._pe_geog_to_ddm,v=qn.PE_DDM_MAX;break;case"dms":_=te._pe_geog_to_dms,v=qn.PE_DMS_MAX}let w=0;h&&(w=te.getPointer(h));const x=aw(f),T=te.ensureFloat64(x),S=A$(d,v),C=_(w,d,T,m,te.ensureInt32(S));if(C)for(let A=0;A<d;A++)y[A]=te.UTF8ToString(S[A]);return C},i=(c,h,d,f,m)=>{let y;switch(te.ensureCache.prepare(),c){case"dd":y=te._pe_dd_to_geog;break;case"ddm":y=te._pe_ddm_to_geog;break;case"dms":y=te._pe_dms_to_geog}let _=0;h&&(_=te.getPointer(h));const v=f.map(S=>te.ensureString(S)),w=te.ensureInt32(v),x=te.ensureFloat64(new Array(2*d)),T=y(_,d,w,x);return T&&D_(m,d,x),T};function r(c,h,d,f,m){return e("dms",c,h,d,f,m)}function n(c,h,d,f){return i("dms",c,h,d,f)}function s(c,h,d,f,m){return e("ddm",c,h,d,f,m)}function o(c,h,d,f){return i("ddm",c,h,d,f)}function a(c,h,d,f,m){return e("dd",c,h,d,f,m)}function l(c,h,d,f){return i("dd",c,h,d,f)}t.geogToDms=r,t.dmsToGeog=n,t.geogToDdm=s,t.ddmToGeog=o,t.geogToDd=a,t.ddToGeog=l}(A7||(A7={})),function(t){function e(){t.PE_MGRS_STYLE_NEW=te.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,t.PE_MGRS_STYLE_OLD=te.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,t.PE_MGRS_STYLE_AUTO=te.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,t.PE_MGRS_180_ZONE_1_PLUS=te.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,t.PE_MGRS_ADD_SPACES=te.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function i(n,s,o,a,l,c,h){te.ensureCache.prepare();let d=0;n&&(d=te.getPointer(n));const f=aw(o),m=te.ensureFloat64(f),y=A$(s,qn.PE_MGRS_MAX),_=te.ensureInt32(y),v=te._pe_geog_to_mgrs_extended(d,s,m,a,l,c,_);if(v)for(let w=0;w<s;w++)h[w]=te.UTF8ToString(y[w]);return v}function r(n,s,o,a,l){te.ensureCache.prepare();let c=0;n&&(c=te.getPointer(n));const h=o.map(y=>te.ensureString(y)),d=te.ensureInt32(h),f=te.ensureFloat64(new Array(2*s)),m=te._pe_mgrs_to_geog_extended(c,s,d,a,f);return m&&D_(l,s,f),m}t.init=e,t.geogToMgrsExtended=i,t.mgrsToGeogExtended=r}(C5||(C5={})),function(t){function e(r,n,s,o,a,l,c){te.ensureCache.prepare();let h=0;r&&(h=te.getPointer(r));const d=aw(s),f=te.ensureFloat64(d),m=A$(n,qn.PE_MGRS_MAX),y=te.ensureInt32(m),_=te._pe_geog_to_usng(h,n,f,o,a,l,y);if(_)for(let v=0;v<n;v++)c[v]=te.UTF8ToString(m[v]);return _}function i(r,n,s,o){te.ensureCache.prepare();let a=0;r&&(a=te.getPointer(r));const l=s.map(f=>te.ensureString(f)),c=te.ensureInt32(l),h=te.ensureFloat64(new Array(2*n)),d=te._pe_usng_to_geog(a,n,c,h);return d&&D_(o,n,h),d}t.geogToUsng=e,t.usngToGeog=i}(O7||(O7={})),function(t){function e(){t.PE_UTM_OPTS_NONE=te.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,t.PE_UTM_OPTS_ADD_SPACES=te.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,t.PE_UTM_OPTS_NS=te.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function i(n,s,o,a,l){te.ensureCache.prepare();let c=0;n&&(c=te.getPointer(n));const h=aw(o),d=te.ensureFloat64(h),f=A$(s,qn.PE_UTM_MAX),m=te.ensureInt32(f),y=te._pe_geog_to_utm(c,s,d,a,m);if(y)for(let _=0;_<s;_++)l[_]=te.UTF8ToString(f[_]);return y}function r(n,s,o,a,l){te.ensureCache.prepare();let c=0;n&&(c=te.getPointer(n));const h=o.map(y=>te.ensureString(y)),d=te.ensureInt32(h),f=te.ensureFloat64(new Array(2*s)),m=te._pe_utm_to_geog(c,s,d,a,f);return m&&D_(l,s,f),m}t.init=e,t.geogToUtm=i,t.utmToGeog=r}(A5||(A5={})),function(t){const e=new Map;function i(){t.PE_PCSINFO_OPTION_NONE=te.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,t.PE_PCSINFO_OPTION_DOMAIN=te.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,t.PE_POLE_OUTSIDE_BOUNDARY=te.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,t.PE_POLE_POINT=te.PePCSInfo.prototype.PE_POLE_POINT}function r(n,s=t.PE_PCSINFO_OPTION_DOMAIN){let o=null,a=null;return e.has(n)&&(a=e.get(n),a[s]&&(o=a[s])),o||(o=te.PePCSInfo.prototype.generate(n,s),a||(a=[],e.set(n,a)),a[s]=o),o}t.init=i,t.generate=r}(O5||(O5={})),function(t){function e(){return te.PeVersion.prototype.version_string()}t.versionString=e}(R7||(R7={}));const d4e=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return T7},get PeDefs(){return qn},get PeFactory(){return S7},get PeGCSExtent(){return nye},get PeGTTransformations(){return C7},get PeGTlistExtended(){return E5},get PeGTlistExtendedEntry(){return E7},get PeNotationDms(){return A7},get PeNotationMgrs(){return C5},get PeNotationUsng(){return O7},get PeNotationUtm(){return A5},get PePCSInfo(){return O5},get PeVersion(){return R7},_init:sye,get _pe(){return te},isLoaded:iye,isSupported:h4e,load:rye},Symbol.toStringTag,{value:"Module"}));var jh;(function(t){t[t.CGCS2000=4490]="CGCS2000",t[t.GCSMARS2000=104971]="GCSMARS2000",t[t.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",t[t.GCSMOON2000=104903]="GCSMOON2000"})(jh||(jh={}));let g;const $={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9895:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,10160:0,10183:0,10188:0,10194:0,10199:0,10207:0,10212:0,10217:0,10222:0,10227:0,10235:0,10240:0,10250:0,10254:0,10270:0,10275:0,10280:0,10306:0,10329:0,10471:0,20002:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2,103897:1};for(g=2e3;g<=2045;g++)$[g]=0;for(g=2056;g<=2065;g++)$[g]=0;for(g=2067;g<=2135;g++)$[g]=0;for(g=2137;g<=2154;g++)$[g]=0;for(g=2161;g<=2170;g++)$[g]=0;for(g=2172;g<=2193;g++)$[g]=0;for(g=2195;g<=2198;g++)$[g]=0;for(g=2200;g<=2203;g++)$[g]=0;for(g=2205;g<=2217;g++)$[g]=0;for(g=2222;g<=2224;g++)$[g]=1;for(g=2225;g<=2250;g++)$[g]=2;for(g=2251;g<=2253;g++)$[g]=1;for(g=2257;g<=2264;g++)$[g]=2;for(g=2274;g<=2279;g++)$[g]=2;for(g=2280;g<=2282;g++)$[g]=1;for(g=2283;g<=2289;g++)$[g]=2;for(g=2290;g<=2292;g++)$[g]=0;for(g=2308;g<=2313;g++)$[g]=0;for(g=2315;g<=2491;g++)$[g]=0;for(g=2494;g<=2866;g++)$[g]=0;for(g=2867;g<=2869;g++)$[g]=1;for(g=2870;g<=2888;g++)$[g]=2;for(g=2891;g<=2895;g++)$[g]=2;for(g=2896;g<=2898;g++)$[g]=1;for(g=2902;g<=2908;g++)$[g]=2;for(g=2915;g<=2920;g++)$[g]=2;for(g=2921;g<=2923;g++)$[g]=1;for(g=2924;g<=2930;g++)$[g]=2;for(g=2931;g<=2962;g++)$[g]=0;for(g=2964;g<=2968;g++)$[g]=2;for(g=2969;g<=2973;g++)$[g]=0;for(g=2975;g<=2991;g++)$[g]=0;for(g=2995;g<=3051;g++)$[g]=0;for(g=3054;g<=3079;g++)$[g]=0;for(g=3081;g<=3088;g++)$[g]=0;for(g=3092;g<=3101;g++)$[g]=0;for(g=3106;g<=3138;g++)$[g]=0;for(g=3146;g<=3151;g++)$[g]=0;for(g=3153;g<=3166;g++)$[g]=0;for(g=3168;g<=3172;g++)$[g]=0;for(g=3174;g<=3203;g++)$[g]=0;for(g=3294;g<=3358;g++)$[g]=0;for(g=3367;g<=3403;g++)$[g]=0;for(g=3408;g<=3416;g++)$[g]=0;for(g=3417;g<=3438;g++)$[g]=2;for(g=3441;g<=3446;g++)$[g]=2;for(g=3447;g<=3450;g++)$[g]=0;for(g=3451;g<=3459;g++)$[g]=2;for(g=3460;g<=3478;g++)$[g]=0;for(g=3554;g<=3559;g++)$[g]=0;for(g=3560;g<=3570;g++)$[g]=2;for(g=3571;g<=3581;g++)$[g]=0;for(g=3594;g<=3597;g++)$[g]=0;for(g=3601;g<=3604;g++)$[g]=0;for(g=3637;g<=3639;g++)$[g]=0;for(g=3665;g<=3667;g++)$[g]=0;for(g=3693;g<=3695;g++)$[g]=0;for(g=3701;g<=3727;g++)$[g]=0;for(g=3728;g<=3739;g++)$[g]=2;for(g=3740;g<=3751;g++)$[g]=0;for(g=3753;g<=3760;g++)$[g]=2;for(g=3761;g<=3773;g++)$[g]=0;for(g=3775;g<=3777;g++)$[g]=0;for(g=3779;g<=3781;g++)$[g]=0;for(g=3783;g<=3785;g++)$[g]=0;for(g=3788;g<=3791;g++)$[g]=0;for(g=3797;g<=3802;g++)$[g]=0;for(g=3814;g<=3816;g++)$[g]=0;for(g=3825;g<=3829;g++)$[g]=0;for(g=3832;g<=3841;g++)$[g]=0;for(g=3844;g<=3852;g++)$[g]=0;for(g=3873;g<=3885;g++)$[g]=0;for(g=3890;g<=3893;g++)$[g]=0;for(g=3907;g<=3912;g++)$[g]=0;for(g=3942;g<=3950;g++)$[g]=0;for(g=3968;g<=3970;g++)$[g]=0;for(g=3973;g<=3976;g++)$[g]=0;for(g=3986;g<=3989;g++)$[g]=0;for(g=3994;g<=3997;g++)$[g]=0;for(g=4048;g<=4051;g++)$[g]=0;for(g=4056;g<=4063;g++)$[g]=0;for(g=4093;g<=4096;g++)$[g]=0;for(g=4390;g<=4398;g++)$[g]=0;for(g=4399;g<=4413;g++)$[g]=2;for(g=4418;g<=4433;g++)$[g]=2;for(g=4455;g<=4457;g++)$[g]=2;for(g=4484;g<=4489;g++)$[g]=0;for(g=4491;g<=4554;g++)$[g]=0;for(g=4568;g<=4589;g++)$[g]=0;for(g=4652;g<=4656;g++)$[g]=0;for(g=4766;g<=4800;g++)$[g]=0;for(g=5014;g<=5016;g++)$[g]=0;for(g=5069;g<=5072;g++)$[g]=0;for(g=5105;g<=5130;g++)$[g]=0;for(g=5167;g<=5188;g++)$[g]=0;for(g=5253;g<=5259;g++)$[g]=0;for(g=5269;g<=5275;g++)$[g]=0;for(g=5292;g<=5311;g++)$[g]=0;for(g=5329;g<=5331;g++)$[g]=0;for(g=5343;g<=5349;g++)$[g]=0;for(g=5355;g<=5357;g++)$[g]=0;for(g=5387;g<=5389;g++)$[g]=0;for(g=5459;g<=5463;g++)$[g]=0;for(g=5479;g<=5482;g++)$[g]=0;for(g=5518;g<=5520;g++)$[g]=0;for(g=5530;g<=5539;g++)$[g]=0;for(g=5550;g<=5552;g++)$[g]=0;for(g=5562;g<=5583;g++)$[g]=0;for(g=5623;g<=5625;g++)$[g]=2;for(g=5631;g<=5639;g++)$[g]=0;for(g=5649;g<=5653;g++)$[g]=0;for(g=5663;g<=5680;g++)$[g]=0;for(g=5682;g<=5685;g++)$[g]=0;for(g=5875;g<=5877;g++)$[g]=0;for(g=5896;g<=5899;g++)$[g]=0;for(g=5921;g<=5940;g++)$[g]=0;for(g=6050;g<=6125;g++)$[g]=0;for(g=6244;g<=6275;g++)$[g]=0;for(g=6328;g<=6348;g++)$[g]=0;for(g=6350;g<=6356;g++)$[g]=0;for(g=6366;g<=6372;g++)$[g]=0;for(g=6381;g<=6387;g++)$[g]=0;for(g=6393;g<=6404;g++)$[g]=0;for(g=6480;g<=6483;g++)$[g]=0;for(g=6511;g<=6514;g++)$[g]=0;for(g=6579;g<=6581;g++)$[g]=0;for(g=6619;g<=6624;g++)$[g]=0;for(g=6625;g<=6627;g++)$[g]=2;for(g=6628;g<=6632;g++)$[g]=0;for(g=6634;g<=6637;g++)$[g]=0;for(g=6669;g<=6692;g++)$[g]=0;for(g=6707;g<=6709;g++)$[g]=0;for(g=6720;g<=6723;g++)$[g]=0;for(g=6732;g<=6738;g++)$[g]=0;for(g=6931;g<=6933;g++)$[g]=0;for(g=6956;g<=6959;g++)$[g]=0;for(g=7005;g<=7007;g++)$[g]=0;for(g=7057;g<=7070;g++)$[g]=2;for(g=7074;g<=7082;g++)$[g]=0;for(g=7109;g<=7118;g++)$[g]=0;for(g=7119;g<=7127;g++)$[g]=1;for(g=7374;g<=7376;g++)$[g]=0;for(g=7528;g<=7586;g++)$[g]=0;for(g=7587;g<=7645;g++)$[g]=2;for(g=7692;g<=7696;g++)$[g]=0;for(g=7755;g<=7787;g++)$[g]=0;for(g=7791;g<=7795;g++)$[g]=0;for(g=7799;g<=7801;g++)$[g]=0;for(g=7803;g<=7805;g++)$[g]=0;for(g=7825;g<=7831;g++)$[g]=0;for(g=7845;g<=7859;g++)$[g]=0;for(g=8013;g<=8032;g++)$[g]=0;for(g=8065;g<=8068;g++)$[g]=1;for(g=8518;g<=8529;g++)$[g]=2;for(g=8533;g<=8536;g++)$[g]=2;for(g=8538;g<=8540;g++)$[g]=2;for(g=8677;g<=8679;g++)$[g]=0;for(g=8836;g<=8840;g++)$[g]=0;for(g=8857;g<=8859;g++)$[g]=0;for(g=8908;g<=8910;g++)$[g]=0;for(g=9154;g<=9159;g++)$[g]=0;for(g=9205;g<=9218;g++)$[g]=0;for(g=9271;g<=9273;g++)$[g]=0;for(g=9295;g<=9297;g++)$[g]=0;for(g=9356;g<=9360;g++)$[g]=0;for(g=9404;g<=9407;g++)$[g]=0;for(g=9476;g<=9482;g++)$[g]=0;for(g=9487;g<=9494;g++)$[g]=0;for(g=9697;g<=9699;g++)$[g]=0;for(g=9821;g<=9865;g++)$[g]=0;for(g=10285;g<=10291;g++)$[g]=0;for(g=10314;g<=10317;g++)$[g]=0;for(g=10448;g<=10465;g++)$[g]=0;for(g=11114;g<=11118;g++)$[g]=0;for(g=20004;g<=20032;g++)$[g]=0;for(g=20047;g<=20049;g++)$[g]=0;for(g=20062;g<=20092;g++)$[g]=0;for(g=20135;g<=20138;g++)$[g]=0;for(g=20248;g<=20258;g++)$[g]=0;for(g=20348;g<=20358;g++)$[g]=0;for(g=20436;g<=20440;g++)$[g]=0;for(g=20822;g<=20824;g++)$[g]=0;for(g=20904;g<=20932;g++)$[g]=0;for(g=20934;g<=20936;g++)$[g]=0;for(g=21004;g<=21032;g++)$[g]=0;for(g=21035;g<=21037;g++)$[g]=0;for(g=21095;g<=21097;g++)$[g]=0;for(g=21148;g<=21150;g++)$[g]=0;for(g=21207;g<=21264;g++)$[g]=0;for(g=21307;g<=21364;g++)$[g]=0;for(g=21413;g<=21423;g++)$[g]=0;for(g=21453;g<=21463;g++)$[g]=0;for(g=21473;g<=21483;g++)$[g]=0;for(g=21780;g<=21782;g++)$[g]=0;for(g=21891;g<=21894;g++)$[g]=0;for(g=21896;g<=21899;g++)$[g]=0;for(g=22171;g<=22177;g++)$[g]=0;for(g=22181;g<=22187;g++)$[g]=0;for(g=22191;g<=22197;g++)$[g]=0;for(g=22207;g<=22222;g++)$[g]=0;for(g=22229;g<=22232;g++)$[g]=0;for(g=22234;g<=22236;g++)$[g]=0;for(g=22243;g<=22250;g++)$[g]=0;for(g=22262;g<=22265;g++)$[g]=0;for(g=22307;g<=22322;g++)$[g]=0;for(g=22348;g<=22357;g++)$[g]=0;for(g=22407;g<=22422;g++)$[g]=0;for(g=22462;g<=22465;g++)$[g]=0;for(g=22521;g<=22525;g++)$[g]=0;for(g=22607;g<=22622;g++)$[g]=0;for(g=22641;g<=22646;g++)$[g]=0;for(g=22648;g<=22657;g++)$[g]=0;for(g=22707;g<=22722;g++)$[g]=0;for(g=22762;g<=22765;g++)$[g]=0;for(g=22807;g<=22822;g++)$[g]=0;for(g=22991;g<=22994;g++)$[g]=0;for(g=23028;g<=23038;g++)$[g]=0;for(g=23301;g<=23333;g++)$[g]=2;for(g=23830;g<=23853;g++)$[g]=0;for(g=23866;g<=23872;g++)$[g]=0;for(g=23877;g<=23884;g++)$[g]=0;for(g=23886;g<=23894;g++)$[g]=0;for(g=23946;g<=23948;g++)$[g]=0;for(g=24311;g<=24313;g++)$[g]=0;for(g=24342;g<=24347;g++)$[g]=0;for(g=24370;g<=24374;g++)$[g]=10;for(g=24375;g<=24381;g++)$[g]=0;for(g=24718;g<=24721;g++)$[g]=0;for(g=24817;g<=24821;g++)$[g]=0;for(g=24877;g<=24882;g++)$[g]=0;for(g=24891;g<=24893;g++)$[g]=0;for(g=25391;g<=25395;g++)$[g]=0;for(g=25828;g<=25838;g++)$[g]=0;for(g=26191;g<=26195;g++)$[g]=0;for(g=26391;g<=26393;g++)$[g]=0;for(g=26701;g<=26722;g++)$[g]=0;for(g=26729;g<=26799;g++)$[g]=2;for(g=26801;g<=26803;g++)$[g]=2;for(g=26811;g<=26813;g++)$[g]=2;for(g=26847;g<=26870;g++)$[g]=2;for(g=26891;g<=26899;g++)$[g]=0;for(g=26901;g<=26923;g++)$[g]=0;for(g=26929;g<=26946;g++)$[g]=0;for(g=26948;g<=26998;g++)$[g]=0;for(g=27037;g<=27040;g++)$[g]=0;for(g=27205;g<=27232;g++)$[g]=0;for(g=27258;g<=27260;g++)$[g]=0;for(g=27391;g<=27398;g++)$[g]=0;for(g=27561;g<=27564;g++)$[g]=0;for(g=27571;g<=27574;g++)$[g]=0;for(g=27581;g<=27584;g++)$[g]=0;for(g=27591;g<=27594;g++)$[g]=0;for(g=28191;g<=28193;g++)$[g]=0;for(g=28348;g<=28358;g++)$[g]=0;for(g=28402;g<=28432;g++)$[g]=0;for(g=28462;g<=28492;g++)$[g]=0;for(g=29118;g<=29122;g++)$[g]=0;for(g=29168;g<=29172;g++)$[g]=0;for(g=29177;g<=29185;g++)$[g]=0;for(g=29187;g<=29195;g++)$[g]=0;for(g=29900;g<=29903;g++)$[g]=0;for(g=30161;g<=30179;g++)$[g]=0;for(g=30491;g<=30494;g++)$[g]=0;for(g=30729;g<=30732;g++)$[g]=0;for(g=31251;g<=31259;g++)$[g]=0;for(g=31265;g<=31268;g++)$[g]=0;for(g=31275;g<=31279;g++)$[g]=0;for(g=31281;g<=31297;g++)$[g]=0;for(g=31461;g<=31469;g++)$[g]=0;for(g=31491;g<=31495;g++)$[g]=0;for(g=31917;g<=31922;g++)$[g]=0;for(g=31965;g<=32e3;g++)$[g]=0;for(g=32001;g<=32003;g++)$[g]=2;for(g=32005;g<=32031;g++)$[g]=2;for(g=32033;g<=32060;g++)$[g]=2;for(g=32064;g<=32067;g++)$[g]=2;for(g=32074;g<=32077;g++)$[g]=2;for(g=32081;g<=32086;g++)$[g]=0;for(g=32107;g<=32130;g++)$[g]=0;for(g=32133;g<=32159;g++)$[g]=0;for(g=32164;g<=32167;g++)$[g]=2;for(g=32180;g<=32199;g++)$[g]=0;for(g=32201;g<=32260;g++)$[g]=0;for(g=32301;g<=32360;g++)$[g]=0;for(g=32401;g<=32460;g++)$[g]=0;for(g=32501;g<=32560;g++)$[g]=0;for(g=32601;g<=32662;g++)$[g]=0;for(g=32664;g<=32667;g++)$[g]=2;for(g=32701;g<=32761;g++)$[g]=0;for(g=53001;g<=53004;g++)$[g]=0;for(g=53008;g<=53019;g++)$[g]=0;for(g=53021;g<=53032;g++)$[g]=0;for(g=53034;g<=53037;g++)$[g]=0;for(g=53042;g<=53046;g++)$[g]=0;for(g=53074;g<=53080;g++)$[g]=0;for(g=54001;g<=54004;g++)$[g]=0;for(g=54008;g<=54019;g++)$[g]=0;for(g=54021;g<=54032;g++)$[g]=0;for(g=54034;g<=54037;g++)$[g]=0;for(g=54042;g<=54046;g++)$[g]=0;for(g=54048;g<=54053;g++)$[g]=0;for(g=54074;g<=54080;g++)$[g]=0;for(g=54098;g<=54101;g++)$[g]=0;for(g=102001;g<=102040;g++)$[g]=0;for(g=102042;g<=102063;g++)$[g]=0;for(g=102065;g<=102067;g++)$[g]=0;for(g=102070;g<=102117;g++)$[g]=0;for(g=102122;g<=102216;g++)$[g]=0;for(g=102221;g<=102377;g++)$[g]=0;for(g=102382;g<=102388;g++)$[g]=0;for(g=102389;g<=102398;g++)$[g]=2;for(g=102399;g<=102444;g++)$[g]=0;for(g=102445;g<=102447;g++)$[g]=2;for(g=102448;g<=102458;g++)$[g]=0;for(g=102459;g<=102468;g++)$[g]=2;for(g=102469;g<=102499;g++)$[g]=0;for(g=102500;g<=102519;g++)$[g]=1;for(g=102520;g<=102524;g++)$[g]=0;for(g=102525;g<=102529;g++)$[g]=2;for(g=102530;g<=102588;g++)$[g]=0;for(g=102590;g<=102598;g++)$[g]=0;for(g=102601;g<=102603;g++)$[g]=0;for(g=102605;g<=102628;g++)$[g]=0;for(g=102629;g<=102646;g++)$[g]=2;for(g=102648;g<=102700;g++)$[g]=2;for(g=102701;g<=102703;g++)$[g]=0;for(g=102707;g<=102730;g++)$[g]=2;for(g=102733;g<=102758;g++)$[g]=2;for(g=102767;g<=102900;g++)$[g]=0;for(g=102901;g<=102933;g++)$[g]=2;for(g=102934;g<=102950;g++)$[g]=13;for(g=102951;g<=102955;g++)$[g]=0;for(g=102961;g<=102963;g++)$[g]=0;for(g=102965;g<=102969;g++)$[g]=0;for(g=102971;g<=102973;g++)$[g]=0;for(g=102975;g<=102989;g++)$[g]=0;for(g=102990;g<=102992;g++)$[g]=1;for(g=102997;g<=103002;g++)$[g]=0;for(g=103003;g<=103008;g++)$[g]=2;for(g=103009;g<=103011;g++)$[g]=0;for(g=103012;g<=103014;g++)$[g]=2;for(g=103019;g<=103021;g++)$[g]=0;for(g=103022;g<=103024;g++)$[g]=2;for(g=103029;g<=103031;g++)$[g]=0;for(g=103032;g<=103034;g++)$[g]=2;for(g=103065;g<=103068;g++)$[g]=0;for(g=103074;g<=103076;g++)$[g]=0;for(g=103077;g<=103079;g++)$[g]=1;for(g=103080;g<=103082;g++)$[g]=0;for(g=103083;g<=103085;g++)$[g]=2;for(g=103090;g<=103093;g++)$[g]=0;for(g=103097;g<=103099;g++)$[g]=0;for(g=103100;g<=103102;g++)$[g]=2;for(g=103107;g<=103109;g++)$[g]=0;for(g=103110;g<=103112;g++)$[g]=2;for(g=103113;g<=103116;g++)$[g]=0;for(g=103117;g<=103120;g++)$[g]=2;for(g=103153;g<=103157;g++)$[g]=0;for(g=103158;g<=103162;g++)$[g]=2;for(g=103163;g<=103165;g++)$[g]=0;for(g=103166;g<=103168;g++)$[g]=1;for(g=103169;g<=103171;g++)$[g]=2;for(g=103186;g<=103188;g++)$[g]=0;for(g=103189;g<=103191;g++)$[g]=2;for(g=103192;g<=103195;g++)$[g]=0;for(g=103196;g<=103199;g++)$[g]=2;for(g=103200;g<=103224;g++)$[g]=0;for(g=103225;g<=103227;g++)$[g]=1;for(g=103232;g<=103237;g++)$[g]=0;for(g=103238;g<=103243;g++)$[g]=2;for(g=103244;g<=103246;g++)$[g]=0;for(g=103247;g<=103249;g++)$[g]=2;for(g=103254;g<=103256;g++)$[g]=0;for(g=103257;g<=103259;g++)$[g]=2;for(g=103264;g<=103266;g++)$[g]=0;for(g=103267;g<=103269;g++)$[g]=2;for(g=103300;g<=103375;g++)$[g]=0;for(g=103381;g<=103383;g++)$[g]=0;for(g=103384;g<=103386;g++)$[g]=1;for(g=103387;g<=103389;g++)$[g]=0;for(g=103390;g<=103392;g++)$[g]=2;for(g=103397;g<=103399;g++)$[g]=0;for(g=103400;g<=103471;g++)$[g]=2;for(g=103476;g<=103478;g++)$[g]=0;for(g=103479;g<=103481;g++)$[g]=2;for(g=103486;g<=103488;g++)$[g]=0;for(g=103489;g<=103491;g++)$[g]=2;for(g=103492;g<=103495;g++)$[g]=0;for(g=103496;g<=103499;g++)$[g]=2;for(g=103528;g<=103543;g++)$[g]=0;for(g=103544;g<=103548;g++)$[g]=2;for(g=103549;g<=103551;g++)$[g]=0;for(g=103552;g<=103554;g++)$[g]=1;for(g=103555;g<=103557;g++)$[g]=2;for(g=103558;g<=103560;g++)$[g]=0;for(g=103571;g<=103573;g++)$[g]=0;for(g=103574;g<=103576;g++)$[g]=2;for(g=103577;g<=103580;g++)$[g]=0;for(g=103581;g<=103583;g++)$[g]=2;for(g=103595;g<=103694;g++)$[g]=0;for(g=103696;g<=103699;g++)$[g]=0;for(g=103700;g<=103793;g++)$[g]=2;for(g=103794;g<=103890;g++)$[g]=0;for(g=103891;g<=103896;g++)$[g]=2;for(g=103900;g<=103971;g++)$[g]=2;for(g=103972;g<=103977;g++)$[g]=0;for(g=112e3;g<=112101;g++)$[g]=0;const p4e={102113:!0,102100:!0,3857:!0,3785:!0},f4e={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},xie='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',O$=[-20037508342788905e-9,20037508342788905e-9],R$=[-20037508342787e-6,20037508342787e-6],oye={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:O$,origin:R$,dx:1e-5},102100:{wkTemplate:xie,valid:O$,origin:R$,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:O$,origin:R$,dx:1e-5},3857:{wkTemplate:xie,valid:O$,origin:R$,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function Fn(t,e){if(t===e)return!0;if(t==null||e==null)return!1;if(t.wkid!=null||e.wkid!=null)return t.wkid===e.wkid||ox(t)&&ox(e)||e.latestWkid!=null&&t.wkid===e.latestWkid||t.latestWkid!=null&&e.wkid===t.latestWkid;const i=t.wkt2??t.wkt,r=e.wkt2??e.wkt;return!(!i||!r)&&i.toUpperCase()===r.toUpperCase()}function Sp(t){return Ra(t)&&t.wkid&&oye[t.wkid]||null}function R5(t){if(!t)return;if(t.wkid)return String(t.wkid);const e=t.wkt||t.wkt2;return JSON.stringify(e?{wkt:e}:{})}function rZ(t){if(!Ra(t))return!1;if(t.wkid)return $[t.wkid]==null;const e=t.wkt2||t.wkt;return!!e&&/^\s*(?:GEOGCS|GEOGCRS|GEOGRAPHICCRS)/i.test(e)}function EE(t){return!(km(t)||Um(t))}function QR(t){return Ra(t)&&t.wkid===4326}function cPt(t){return/^\s*(?:GEOD|GEODETIC|GEOG|GEOGRAPHIC|PROJ|PROJECTED|VERT|VERTICAL|ENG|ENGINEERING|PARAMETRIC|TIME|DERIVEDPROJ|COMPOUND|BOUND)CRS/i.test(t)}function aye(t){return Ra(t)&&t.wkid===jh.CGCS2000}function ox(t){return Ra(t)&&t.wkid!=null&&p4e[t.wkid]===!0}function nZ(t){return Ra(t)&&t.wkid===32662}function sZ(t){return t===jh.GCSMARS2000||t===jh.GCSMARS2000_SPHERE}function km(t){return Ra(t)&&t.wkid!=null&&sZ(t.wkid)}function oZ(t){return t===jh.GCSMOON2000}function Um(t){return Ra(t)&&t.wkid!=null&&oZ(t.wkid)}function m4e(t){return Ra(t)&&t.wkid!=null&&f4e[t.wkid]===!0}function Ra(t){return t!=null&&(t.wkid!=null&&t.wkid>=2e3||t.wkt2!=null||t.wkt!=null)}const g4e={wkid:4326,wkt:s6(oye[4326].wkTemplate,{Central_Meridian:"0.0"})},y4e={wkid:102100,latestWkid:3857},_4e={wkid:32662};function aZ(t){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${t.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const lye=aZ(Ai),m6=aZ(dm),g6=aZ(Ty),cye={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${Ai.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`};function Wi(t){return t!=null&&(km(t)||Fn(t,m6))?dm:t!=null&&(Um(t)||Fn(t,g6))?Ty:Ai}function uPt(t){return sZ(t)?dm:oZ(t)?Ty:Ai}function P5(t){return Fn(t,lye)}function vv(t){return P5(t)||Fn(t,m6)||Fn(t,g6)}const lZ=39.37,v4e=Ai.radius*Math.PI/200,uye=/(?:LENGTH)?UNIT\[([^\]]+)]]$/i,Fw=$,hye=/UNIT\[([^\]]+)]/i,b4e=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),w4e=yl()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),Zp=t=>t*t,u0=t=>t*t*t,eP={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:Zp(.001)},"square-centimeters":{inBaseUnits:Zp(.01)},"square-decimeters":{inBaseUnits:Zp(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:Zp(1e3)},"square-inches":{inBaseUnits:Zp(.0254)},"square-feet":{inBaseUnits:Zp(.3048)},"square-yards":{inBaseUnits:Zp(.9144)},"square-miles":{inBaseUnits:Zp(1609.344)},"square-us-feet":{inBaseUnits:Zp(1200/3937)},acres:{inBaseUnits:.0015625*Zp(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*u0(.001)},"cubic-centimeters":{inBaseUnits:1e3*u0(.01)},"cubic-decimeters":{inBaseUnits:1e3*u0(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*u0(1e3)},"cubic-inches":{inBaseUnits:1e3*u0(.0254)},"cubic-feet":{inBaseUnits:1e3*u0(.3048)},"cubic-yards":{inBaseUnits:1e3*u0(.9144)},"cubic-miles":{inBaseUnits:1e3*u0(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},x4e=(()=>{const t={};for(const e in eP)for(const i in eP[e].units)t[i]=e;return t})();function T4e(t,e,i){return t*eP[i].units[e].inBaseUnits}function S4e(t,e,i){return t/eP[i].units[e].inBaseUnits}const E4e=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"];function P7(t){const e=x4e[t];if(!e)throw new Error("unknown type");return e}function Tie(t,e=null){return e=e||P7(t),eP[e].baseUnit===t}function No(t,e,i){if(e===i)return t;const r=P7(e);if(r!==P7(i))throw new Error("incompatible units");const n=Tie(e,r)?t:T4e(t,e,r);return Tie(i,r)?n:S4e(n,i,r)}function hPt(t,e,i){switch(i){case"metric":return C4e(t,e);case"imperial":return O4e(t,e);default:return i}}function dPt(t,e,i){switch(i){case"metric":return A4e(t,e);case"imperial":return R4e(t,e);default:return i}}function C4e(t,e){const i=No(t,e,"meters");return Math.abs(i)<3e3?"meters":"kilometers"}function A4e(t,e){const i=No(t,e,"meters");return Math.abs(i)<1e5?"meters":"kilometers"}function O4e(t,e){const i=No(t,e,"feet");return Math.abs(i)<1e3?"feet":"miles"}function R4e(t,e){const i=No(t,e,"feet");return Math.abs(i)<1e5?"feet":"miles"}function pPt(t,e){const i=No(t,e,"square-meters");return Math.abs(i)<3e6?"square-meters":"square-kilometers"}function fPt(t,e){const i=No(t,e,"square-feet");return Math.abs(i)<1e6?"square-feet":"square-miles"}function P4e(t,e,i){return No(t,e,"meters")/(i*Math.PI/180)}function dye(t){return w4e.fromJSON(t.toLowerCase())||null}function M5(t){if(t!=null&&!EE(t))return 1;const e=Da(t);return e>1e5?1:e}function M4e(t){return Da(t)>=Wi(t).metersPerDegree?"meters":y6(t)}function Da(t,e=Ai.metersPerDegree){return $4e(t,!0)??e}function $4e(t,e=!1){const i=t?.wkid??null,r=t?.wkt2??t?.wkt??null;let n=null;if(i){if(sZ(i))return dm.metersPerDegree;if(oZ(i))return Ty.metersPerDegree;n=Fw.values[Fw[i]],!n&&e&&b4e.has(i)&&(n=v4e)}else r&&(mye(r)?n=Sie(uye.exec(r),n):fye(r)&&(n=Sie(hye.exec(r),n)));return n}function M7(t){return rZ(t)?1:Da(t)}function Sie(t,e){return t?.[1]?pye(t[1]):e}function pye(t){return parseFloat(t.split(",")[1])}function y6(t){const e=t?.wkid??null,i=t?.wkt2??t?.wkt??null;let r=null;if(e)r=Fw.units[Fw[e]];else if(i){const n=mye(i)?uye:fye(i)?hye:null;if(n){const s=n.exec(i);s?.[1]&&(r=L4e(s[1]))}}return r!=null?dye(r):null}function mPt(t){const e=y6(t);return e!=null&&E4e.includes(e)?e:null}function fye(t){return/^GEOCCS/i.test(t)}function mye(t){return/^\s*(?:PROJCS|PROJCRS|PROJECTEDCRS)/i.test(t)}const I4e=1e-7;function L4e(t){let i=/[\\"']{1}([^\\"']+)/.exec(t)?.[1];if(!i||!Fw.units.includes(i)){const r=pye(t);i=null;const n=Fw.values;for(let s=0;s<n.length;++s)if(Math.abs(r-n[s])<I4e){i=Fw.units[s];break}}return i}function gPt(t){const e=y6(t);if(e==null)return null;switch(e){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}const D4e={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},N4e={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},F4e={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},yPt=yl()(D4e),_Pt=yl()(N4e),vPt=yl()(F4e);var vf;let gr=vf=class extends pe{static fromJSON(t){if(!t)return null;if(t.wkid){if(t.wkid===102100)return vf.WebMercator;if(t.wkid===4326)return vf.WGS84}const e=new vf;return e.read(t),e}constructor(t){super(t),this.latestWkid=null,this.wkid=null,this.wkt=null,this.wkt2=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(t){return t&&typeof t=="object"?t:{[typeof t=="string"?"wkt":"wkid"]:t}}get isWGS84(){return QR(this)}get isWebMercator(){return ox(this)}get isGeographic(){return rZ(this)}get isWrappable(){return m4e(this)}get metersPerUnit(){return Da(this)}get unit(){return y6(this)||(this.isGeographic?"degrees":null)}writeWkt(t,e){this.wkid||(e.wkt=t)}clone(){if(this===vf.WGS84)return vf.WGS84;if(this===vf.WebMercator)return vf.WebMercator;const t=new vf;return this.wkid!=null?(t.wkid=this.wkid,this.latestWkid!=null&&(t.latestWkid=this.latestWkid),this.vcsWkid!=null&&(t.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(t.latestVcsWkid=this.latestVcsWkid)):(this.wkt!=null&&(t.wkt=this.wkt),this.wkt2!=null&&(t.wkt2=this.wkt2)),this.imageCoordinateSystem&&(t.imageCoordinateSystem=Q(this.imageCoordinateSystem)),t}equals(t){if(t==null)return!1;if(this.imageCoordinateSystem||t.imageCoordinateSystem){if(this.imageCoordinateSystem==null||t.imageCoordinateSystem==null)return!1;const{id:e,referenceServiceName:i}=t.imageCoordinateSystem,{geodataXform:r}=t.imageCoordinateSystem,n=this.imageCoordinateSystem;return e==null||r?JSON.stringify(n)===JSON.stringify(t.imageCoordinateSystem):i?n.id===e&&n.referenceServiceName===i:n.id===e}return Fn(this,t)}toJSON(t){return this.write(void 0,t)}};gr.GCS_NAD_1927=null,gr.WGS84=null,gr.WebMercator=null,gr.PlateCarree=null,u([p({readOnly:!0})],gr.prototype,"isWGS84",null),u([p({readOnly:!0})],gr.prototype,"isWebMercator",null),u([p({readOnly:!0})],gr.prototype,"isGeographic",null),u([p({readOnly:!0})],gr.prototype,"isWrappable",null),u([p({type:dr,json:{write:!0}})],gr.prototype,"latestWkid",void 0),u([p({readOnly:!0})],gr.prototype,"metersPerUnit",null),u([p({readOnly:!0})],gr.prototype,"unit",null),u([p({type:dr,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt==null}}}}}}})],gr.prototype,"wkid",void 0),u([p({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid==null}}}}}}})],gr.prototype,"wkt",void 0),u([Be("wkt"),Be("web-scene","wkt")],gr.prototype,"writeWkt",null),u([p({type:String,json:{write:!1}})],gr.prototype,"wkt2",void 0),u([p({type:dr,json:{write:!0}})],gr.prototype,"vcsWkid",void 0),u([p({type:dr,json:{write:!0}})],gr.prototype,"latestVcsWkid",void 0),u([p()],gr.prototype,"imageCoordinateSystem",void 0),gr=vf=u([M("esri.geometry.SpatialReference")],gr),gr.prototype.toJSON.isDefaultToJSON=!0,gr.GCS_NAD_1927=new gr({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),gr.WGS84=new gr(g4e),gr.WebMercator=new gr(y4e),gr.PlateCarree=new gr(_4e),Object.freeze&&(Object.freeze(gr.GCS_NAD_1927),Object.freeze(gr.WGS84),Object.freeze(gr.WebMercator));const ze=gr;function wt(t,e,i){let r,n;return e===void 0||Array.isArray(e)?(n=t,i=e,r=[void 0]):(n=e,r=Array.isArray(t)?t:[t]),(s,o)=>{const a=s.constructor.prototype;r.forEach(l=>{const c=fge(s,l,n);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],i&&(c.read.source=(c.read.source||[]).concat(i))})}}let bf=class extends pe{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=ze.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,i){if(e instanceof ze)return e;if(e!=null){const r=new ze;return r.read(e,i),r}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,i){this.cache[e]=i}};u([p()],bf.prototype,"type",void 0),u([p({readOnly:!0})],bf.prototype,"cache",null),u([p({readOnly:!0})],bf.prototype,"extent",null),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],bf.prototype,"hasM",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],bf.prototype,"hasZ",void 0),u([p({type:ze,json:{write:!0},value:ze.WGS84})],bf.prototype,"spatialReference",void 0),u([wt("spatialReference")],bf.prototype,"readSpatialReference",null),bf=u([M("esri.geometry.Geometry")],bf);const Zv=bf,k4e=Object.prototype.toString;function U4e(t){const e="__accessorMetadata__"in t?as(t):t;return function(...i){if(i.push(e),typeof i[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return z4e.apply(this,i)}}function z4e(t,e,i,r){a6(t,e).cast=r}function B4e(t){return(e,i)=>{a6(e,t).cast=e[i]}}function ai(...t){if(t.length!==3||typeof t[1]!="string")return t.length===1&&k4e.call(t[0])==="[object Function]"?U4e(t[0]):t.length===1&&typeof t[0]=="string"?B4e(t[0]):void 0}function V4e(t,e){const i=t.x-e.x,r=t.y-e.y,n=t.hasZ&&e.hasZ?t.z-e.z:0;return Math.sqrt(i*i+r*r+n*n)}const G4e=57.29577951308232,j4e=.017453292519943;function Eie(t){return t*G4e}function Cie(t){return t*j4e}function Aie(t){return t/Ai.radius}function $5(t){return Math.PI/2-2*Math.atan(Math.exp(-t/Ai.radius))}function $7(t){return t.wkid!=null||t.wkt!=null}const B8=[0,0];function I5(t,e,i,r,n){const s=t,o=n;if(o.spatialReference=i,"x"in s&&"x"in o)[o.x,o.y]=e(s.x,s.y,B8,r);else if("xmin"in s&&"xmin"in o)[o.xmin,o.ymin]=e(s.xmin,s.ymin,B8,r),[o.xmax,o.ymax]=e(s.xmax,s.ymax,B8,r);else if("paths"in s&&"paths"in o||"rings"in s&&"rings"in o){const a="paths"in s?s.paths:s.rings,l=[];let c;for(let h=0;h<a.length;h++){const d=a[h];c=[],l.push(c);for(let f=0;f<d.length;f++)c.push(e(d[f][0],d[f][1],[0,0],r)),d[f].length>2&&c[f].push(d[f][2]),d[f].length>3&&c[f].push(d[f][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in s&&"points"in o){const a=s.points,l=[];for(let c=0;c<a.length;c++)l[c]=e(a[c][0],a[c][1],[0,0],r),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return n}function BO(t,e){const i=t&&($7(t)?t:t.spatialReference),r=e&&($7(e)?e:e.spatialReference);return!(t&&"type"in t&&t.type==="mesh"||e&&"type"in e&&e.type==="mesh"||!i||!r)&&(!!Fn(r,i)||ox(r)&&QR(i)||ox(i)&&QR(r))}function dM(t,e){if(t==null)return null;const i=t.spatialReference,r=e&&($7(e)?e:e.spatialReference);return BO(i,r)?Fn(i,r)?Q(t):ox(r)?I5(t,b2,ze.WebMercator,!1,Q(t)):QR(r)?I5(t,VO,ze.WGS84,!1,Q(t)):null:null}function b2(t,e,i=[0,0]){e>89.99999?e=89.99999:e<-89.99999&&(e=-89.99999);const r=Cie(e);return i[0]=Cie(t)*Ai.radius,i[1]=Ai.halfSemiMajorAxis*Math.log((1+Math.sin(r))/(1-Math.sin(r))),i}function VO(t,e,i=[0,0],r=!1){const n=Eie(t/Ai.radius);return i[0]=r?n:n-360*Math.floor((n+180)/360),i[1]=Eie(Math.PI/2-2*Math.atan(Math.exp(-e/Ai.radius))),i}function ov(t,e=!1,i=Q(t)){return I5(t,b2,ze.WebMercator,e,i)}function w2(t,e=!1,i=Q(t)){return I5(t,VO,ze.WGS84,e,i)}var YD;const JC=[0,0];function Oie(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let Rl=YD=class extends Zv{static copy(t,e){e._set("x",t._get("x")),e._set("y",t._get("y")),e._set("z",t._get("z")),e._set("m",t._get("m"));const i=t._get("spatialReference");e._set("spatialReference",Object.isFrozen(i)?i:i.clone())}constructor(...t){super(...t),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(t,e,i,r,n){let s;if(Array.isArray(t))s=t,n=e,t=s[0],e=s[1],i=s[2],r=s[3];else if(t&&typeof t=="object"){if(s=t,t=s.x!=null?s.x:s.longitude,e=s.y!=null?s.y:s.latitude,i=s.z,r=s.m,(n=s.spatialReference)&&n.declaredClass!=="esri.geometry.SpatialReference"&&(n=new ze(n)),s.longitude!=null||s.latitude!=null){if(s.longitude==null)K.getLogger(this).warn(".longitude=","Latitude was defined without longitude");else if(s.latitude==null)K.getLogger(this).warn(".latitude=","Longitude was defined without latitude");else if(!s.declaredClass&&n&&n.isWebMercator){const a=b2(s.longitude,s.latitude,JC);t=a[0],e=a[1]}}}else Oie(i)?(n=i,i=null):Oie(r)&&(n=r,r=null);const o={x:t,y:e};return o.x==null&&o.y!=null?K.getLogger(this).warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&K.getLogger(this).warn(".x=","X coordinate was defined without a Y coordinate"),n!=null&&(o.spatialReference=n),i!=null&&(o.z=i),r!=null&&(o.m=r),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(t){t!==(this._get("m")!==void 0)&&(this._set("m",t?0:void 0),this._set("hasM",t))}get hasZ(){return this.z!==void 0}set hasZ(t){t!==(this._get("z")!==void 0)&&(this._set("z",t?0:void 0),this._set("hasZ",t))}get latitude(){const{spatialReference:t,x:e,y:i}=this;if(t){if(t.isWebMercator)return VO(e,i,JC)[1];if(t.isGeographic)return i}return null}set latitude(t){const{spatialReference:e,x:i}=this;t!=null&&e&&(e.isWebMercator?this._set("y",b2(i,t,JC)[1]):e.isGeographic&&this._set("y",t),this._set("latitude",t))}get longitude(){const{x:t,y:e,spatialReference:i}=this;if(i){if(i.isWebMercator)return VO(t,e,JC)[0];if(i.isGeographic)return t}return null}set longitude(t){const{y:e,spatialReference:i}=this;t!=null&&i&&(i.isWebMercator?this._set("x",b2(t,e,JC)[0]):i.isGeographic&&this._set("x",t),this._set("longitude",t))}writeX(t,e,i){e[i]=isNaN(t)?"NaN":t}readX(t){return typeof t=="string"?NaN:t}clone(){const t=new YD;return t.x=this.x,t.y=this.y,t.z=this.z,t.m=this.m,t.spatialReference=this.spatialReference,t}copy(t){return YD.copy(t,this),this}equals(t){if(t==null)return!1;const{x:e,y:i,z:r,m:n,spatialReference:s}=this,{z:o,m:a}=t;let{x:l,y:c,spatialReference:h}=t;if(!s.equals(h))if(s.isWebMercator&&h.isWGS84)[l,c]=b2(l,c),h=s;else{if(!s.isWGS84||!h.isWebMercator)return!1;[l,c]=VO(l,c),h=s}return e===l&&i===c&&r===o&&n===a&&s.wkid===h.wkid}offset(t,e,i){return this.x+=t,this.y+=e,i!=null&&(this.z=(this.z??0)+i),this}normalize(){if(!this.spatialReference)return this;const t=Sp(this.spatialReference);if(!t)return this;let e=this.x;const[i,r]=t.valid,n=2*r;let s;return e>r?(s=Math.ceil(Math.abs(e-r)/n),e-=s*n):e<i&&(s=Math.ceil(Math.abs(e-i)/n),e+=s*n),this._set("x",e),this}distance(t){return V4e(this,t)}toArray(){const t=this.hasZ,e=this.hasM;return t&&e?[this.x,this.y,this.z,this.m]:t?[this.x,this.y,this.z]:e?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(t){return this.write({},t)}};u([p({readOnly:!0})],Rl.prototype,"cache",null),u([p({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Rl.prototype,"hasM",null),u([p({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Rl.prototype,"hasZ",null),u([p({type:Number})],Rl.prototype,"latitude",null),u([p({type:Number})],Rl.prototype,"longitude",null),u([p({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),ai(t=>isNaN(t)?t:Nh(t))],Rl.prototype,"x",void 0),u([Be("x")],Rl.prototype,"writeX",null),u([wt("x")],Rl.prototype,"readX",null),u([p({type:Number,json:{write:!0}})],Rl.prototype,"y",void 0),u([p({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Rl.prototype,"z",void 0),u([p({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],Rl.prototype,"m",void 0),Rl=YD=u([M("esri.geometry.Point")],Rl),Rl.prototype.toJSON.isDefaultToJSON=!0;const ut=Rl,V8=[0,0];function cZ(t,e){return e!=null&&rl(t,e.x,e.y,e.z)}function wPt(t,e){if(!e.points||e.points.length)return!1;for(const i of e.points)if(!CE(t,i))return!1;return!0}function H4e(t,e){const{xmin:i,ymin:r,zmin:n,xmax:s,ymax:o,zmax:a}=e;return t.hasZ&&e.hasZ?rl(t,i,r,n)&&rl(t,i,o,n)&&rl(t,s,o,n)&&rl(t,s,r,n)&&rl(t,i,r,a)&&rl(t,i,o,a)&&rl(t,s,o,a)&&rl(t,s,r,a):rl(t,i,r)&&rl(t,i,o)&&rl(t,s,o)&&rl(t,s,r)}function CE(t,e){return rl(t,e[0],e[1])}function q4e(t,e){return rl(t,e[0],e[1],e[2])}function rl(t,e,i,r){return e>=t.xmin&&e<=t.xmax&&i>=t.ymin&&i<=t.ymax&&(r==null||!t.hasZ||r>=t.zmin&&r<=t.zmax)}function W4e(t,e){return V8[1]=e.y,V8[0]=e.x,Y4e(t,V8)}function Y4e(t,e){return gye(t.rings,e)}function gye(t,e){if(!t)return!1;if(X4e(t))return Rie(!1,t,e);let i=!1;for(let r=0,n=t.length;r<n;r++)i=Rie(i,t[r],e);return i}function X4e(t){return!Array.isArray(t[0][0])}function Rie(t,e,i){const[r,n]=i;let s=t,o=0;for(let a=0,l=e.length;a<l;a++){o++,o===l&&(o=0);const[c,h]=e[a],[d,f]=e[o];(h<n&&f>=n||f<n&&h>=n)&&c+(n-h)/(f-h)*(d-c)<r&&(s=!s)}return s}function Z4e(t,e){return cZ(t,e)}function J4e(t,e){const i=t.hasZ&&e.hasZ;let r,n,s;if(t.xmin<=e.xmin){if(r=e.xmin,t.xmax<r)return!1}else if(r=t.xmin,e.xmax<r)return!1;if(t.ymin<=e.ymin){if(n=e.ymin,t.ymax<n)return!1}else if(n=t.ymin,e.ymax<n)return!1;if(i&&e.hasZ){if(t.zmin<=e.zmin){if(s=e.zmin,t.zmax<s)return!1}else if(s=t.zmin,e.zmax<s)return!1}return!0}function K4e(t,e){const{points:i,hasZ:r}=e,n=r?q4e:CE;for(const s of i)if(n(t,s))return!0;return!1}const ax=[0,0],lx=[0,0],cx=[0,0],ux=[0,0],Q4e=[ax,lx,cx,ux],yye=[[cx,ax],[ax,lx],[lx,ux],[ux,cx]];function e5e(t,e){return t5e(t,e.rings)}function t5e(t,e){ax[0]=t.xmin,ax[1]=t.ymax,lx[0]=t.xmax,lx[1]=t.ymax,cx[0]=t.xmin,cx[1]=t.ymin,ux[0]=t.xmax,ux[1]=t.ymin;for(const i of Q4e)if(gye(e,i))return!0;for(const i of e){if(!i.length)continue;let r=i[0];if(CE(t,r))return!0;for(let n=1;n<i.length;n++){const s=i[n];if(CE(t,s)||_ye(r,s,yye))return!0;r=s}}return!1}function i5e(t,e){ax[0]=t.xmin,ax[1]=t.ymax,lx[0]=t.xmax,lx[1]=t.ymax,cx[0]=t.xmin,cx[1]=t.ymin,ux[0]=t.xmax,ux[1]=t.ymin;const i=e.paths;for(const r of i){if(!i.length)continue;let n=r[0];if(CE(t,n))return!0;for(let s=1;s<r.length;s++){const o=r[s];if(CE(t,o)||_ye(n,o,yye))return!0;n=o}}return!1}const Wo=[0,0];function r5e(t){for(let e=0;e<t.length;e++){const i=t[e];for(let n=0;n<i.length-1;n++){const s=i[n],o=i[n+1];for(let a=e+1;a<t.length;a++)for(let l=0;l<t[a].length-1;l++){const c=t[a][l],h=t[a][l+1];if(I7(s,o,c,h,Wo)&&!(Wo[0]===s[0]&&Wo[1]===s[1]||Wo[0]===c[0]&&Wo[1]===c[1]||Wo[0]===o[0]&&Wo[1]===o[1]||Wo[0]===h[0]&&Wo[1]===h[1]))return!0}}const r=i.length;if(!(r<=4))for(let n=0;n<r-3;n++){let s=r-1;n===0&&(s=r-2);const o=i[n],a=i[n+1];for(let l=n+2;l<s;l++){const c=i[l],h=i[l+1];if(I7(o,a,c,h,Wo)&&!(Wo[0]===o[0]&&Wo[1]===o[1]||Wo[0]===c[0]&&Wo[1]===c[1]||Wo[0]===a[0]&&Wo[1]===a[1]||Wo[0]===h[0]&&Wo[1]===h[1]))return!0}}}return!1}function _ye(t,e,i){for(let r=0;r<i.length;r++)if(I7(t,e,i[r][0],i[r][1]))return!0;return!1}function I7(t,e,i,r,n){const[s,o]=t,[a,l]=e,[c,h]=i,[d,f]=r,m=d-c,y=s-c,_=a-s,v=f-h,w=o-h,x=l-o,T=v*_-m*x;if(T===0)return!1;const S=(m*w-v*y)/T,C=(_*w-x*y)/T;return S>=0&&S<=1&&C>=0&&C<=1&&(n&&(n[0]=s+S*(a-s),n[1]=o+S*(l-o)),!0)}function n5e(t){switch(t){case"esriGeometryEnvelope":case"extent":return J4e;case"esriGeometryMultipoint":case"multipoint":return K4e;case"esriGeometryPoint":case"point":return Z4e;case"esriGeometryPolygon":case"polygon":return e5e;case"esriGeometryPolyline":case"polyline":return i5e}}var gh;function s5e(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}function h0(t,e,i){return e==null?i:i==null?e:t(e,i)}let Oo=gh=class extends Zv{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,i,r,n){return s5e(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:typeof t=="object"?(t.spatialReference=t.spatialReference==null?ze.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:i,ymax:r,spatialReference:n??ze.WGS84}}static fromBounds(t,e){return new gh({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}static fromPoint(t){return new gh({xmin:t.x,ymin:t.y,zmin:t.z,xmax:t.x,ymax:t.y,zmax:t.z,spatialReference:t.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const t=new ut({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return t.z!=null&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new gh;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,this.zmin!=null&&(t.zmin=this.zmin,t.zmax=this.zmax),this.mmin!=null&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&BO(e,i)&&(t=e.isWebMercator?ov(t):w2(t,!0)),t.type==="point"?cZ(this,t):t.type==="extent"&&H4e(this,t)}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&BO(e,i)&&(t=e.isWebMercator?ov(t):w2(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),i=this.width*e,r=this.height*e;if(this.xmin+=i,this.ymin+=r,this.xmax-=i,this.ymax-=r,this.hasZ){const n=(this.zmax-this.zmin)*e;this.zmin+=n,this.zmax-=n}if(this.hasM){const n=(this.mmax-this.mmin)*e;this.mmin+=n,this.mmax-=n}return this}intersects(t){if(t==null)return!1;t.type==="mesh"&&(t=t.extent);const e=this.spatialReference,i=t.spatialReference;return e&&i&&!Fn(e,i)&&BO(e,i)&&(t=e.isWebMercator?ov(t):w2(t,!0)),n5e(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,i){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,i!=null&&(this.zmin+=i,this.zmax+=i),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this===t||(this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=h0(Math.min,this.zmin,t.zmin),this.zmax=h0(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=h0(Math.min,this.mmin,t.mmin),this.mmax=h0(Math.max,this.mmax,t.mmax))),this}intersection(t){return this===t?this:t!=null&&this.intersects(t)?(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=h0(Math.max,this.zmin,t.zmin),this.zmax=h0(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=h0(Math.max,this.mmin,t.mmin),this.mmax=h0(Math.min,this.mmax,t.mmax)),this):null}toJSON(t){return this.write({},t)}_shiftCM(t=Sp(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,i=this._getCM(t);if(i){const r=e.isWebMercator?w2(i):i;this.xmin-=i.x,this.xmax-=i.x,e.isWebMercator||(r.x=this._normalizeX(r.x,t).x),this.spatialReference=new ze(s6((e.isWGS84?t.altTemplate:null)??t.wkTemplate,{Central_Meridian:r.x}))}return this}_getCM(t){let e=null;const[i,r]=t.valid,n=this.xmin,s=this.xmax;return n>=i&&n<=r&&s>=i&&s<=r||(e=this.center),e}_normalize(t,e,i){const r=this.spatialReference;if(!r)return this;const n=i??Sp(r);if(n==null)return this;const s=this._getParts(n).map(l=>l.extent);if(s.length<2)return s[0]||this;if(s.length>2)return t?this._shiftCM(n):this.set({xmin:n.valid[0],xmax:n.valid[1]});if(t)return this._shiftCM(n);if(e)return s;let o=!0,a=!0;return s.forEach(l=>{l.hasZ||(o=!1),l.hasM||(a=!1)}),{rings:s.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(o){const h=(l.zmax-l.zmin)/2;for(let d=0;d<c.length;d++)c[d].push(h)}if(a){const h=(l.mmax-l.mmin)/2;for(let d=0;d<c.length;d++)c[d].push(h)}return c}),hasZ:o,hasM:a,spatialReference:r}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:n,ymax:s,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let h;t=t||Sp(o);const[d,f]=t.valid;h=this._normalizeX(this.xmin,t);const m=h.x,y=h.frameId;h=this._normalizeX(this.xmax,t);const _=h.x,v=h.frameId,w=m===_&&a>0;if(a>2*f){const x=new gh(l<c?m:_,n,f,s,o),T=new gh(d,n,l<c?_:m,s,o),S=new gh(0,n,f,s,o),C=new gh(d,n,0,s,o),A=[],R=[];x.contains(S)&&A.push(y),x.contains(C)&&R.push(y),T.contains(S)&&A.push(v),T.contains(C)&&R.push(v);for(let D=y+1;D<v;D++)A.push(D),R.push(D);e.push({extent:x,frameIds:[y]},{extent:T,frameIds:[v]},{extent:S,frameIds:A},{extent:C,frameIds:R})}else m>_||w?e.push({extent:new gh(m,n,f,s,o),frameIds:[y]},{extent:new gh(d,n,_,s,o),frameIds:[v]}):e.push({extent:new gh(m,n,_,s,o),frameIds:[y]});this.cache._parts=e}const i=this.hasZ,r=this.hasM;if(i||r){const n={};i&&(n.zmin=this.zmin,n.zmax=this.zmax),r&&(n.mmin=this.mmin,n.mmax=this.mmax);for(let s=0;s<e.length;s++)e[s].extent.set(n)}return e}_normalizeX(t,e){const[i,r]=e.valid,n=2*r;let s,o=0;return t>r?(s=Math.ceil(Math.abs(t-r)/n),t-=s*n,o=s):t<i&&(s=Math.ceil(Math.abs(t-i)/n),t+=s*n,o=-s),{x:t,frameId:o}}};u([p({readOnly:!0})],Oo.prototype,"cache",null),u([p({readOnly:!0})],Oo.prototype,"center",null),u([p({readOnly:!0})],Oo.prototype,"extent",null),u([p({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Oo.prototype,"hasM",null),u([p({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Oo.prototype,"hasZ",null),u([p({readOnly:!0})],Oo.prototype,"height",null),u([p({readOnly:!0})],Oo.prototype,"width",null),u([p({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],Oo.prototype,"xmin",void 0),u([p({type:Number,json:{write:!0}})],Oo.prototype,"ymin",void 0),u([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Oo.prototype,"mmin",void 0),u([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Oo.prototype,"zmin",void 0),u([p({type:Number,json:{write:!0}})],Oo.prototype,"xmax",void 0),u([p({type:Number,json:{write:!0}})],Oo.prototype,"ymax",void 0),u([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Oo.prototype,"mmax",void 0),u([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Oo.prototype,"zmax",void 0),Oo=gh=u([M("esri.geometry.Extent")],Oo),Oo.prototype.toJSON.isDefaultToJSON=!0;const zi=Oo;let GO;const o5e=globalThis.esriConfig?.locale??globalThis.dojoConfig?.locale;function vye(){return o5e??globalThis.navigator?.language??"en"}function Gu(){return GO===void 0&&(GO=vye()),GO}function a5e(t=Gu()){return/^([a-zA-Z]{2,3})(?:[_\-]\w+)*$/.exec(t)?.[1].toLowerCase()}const jO=[];function uZ(t){return jO.push(t),Vi(()=>jO.splice(jO.indexOf(t),1))}const L7=[];function hZ(t){return L7.push(t),Vi(()=>jO.splice(L7.indexOf(t),1))}function l5e(){const t=vye();GO!==t&&(GO=t,[...L7].forEach(e=>{e.call(null,t)}),[...jO].forEach(e=>{e.call(null,t)}))}globalThis.addEventListener?.("languagechange",l5e);let P$;function c5e(t){return P$&&!P$.destroyed||(P$=t()),P$}var D7;const u5e=new Sr({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let yh=D7=class extends we{constructor(t){super(t),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){t!=="asc"&&t!=="desc"||this._set("sortOrder",t)}clone(){return new D7({categories:this.categories?Q(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,e){let i=[];this.categories&&(i=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o));let r="";if(this.extent){const o=dM(this.extent,ze.WGS84);o!=null&&(r=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let n=this.query;!this.disableExtraQuery&&t.extraQuery&&(n="("+n+")"+t.extraQuery);const s={categories:i,bbox:r,q:n,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(s.sortField=this.sortField.split(",").map(o=>u5e.toJSON(o.trim())).join(","),s.sortOrder=this.sortOrder),{query:{...e,...s}}}};u([p()],yh.prototype,"categories",void 0),u([p()],yh.prototype,"disableExtraQuery",void 0),u([p({type:zi})],yh.prototype,"extent",void 0),u([p()],yh.prototype,"filter",void 0),u([p()],yh.prototype,"num",void 0),u([p()],yh.prototype,"query",void 0),u([p()],yh.prototype,"sortField",void 0),u([p()],yh.prototype,"sortOrder",null),u([p()],yh.prototype,"start",void 0),yh=D7=u([M("esri.portal.PortalQueryParams")],yh);const Jf=yh;var N7;let eo=N7=class extends pe{constructor(t){super(t),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.sourceJSON=null,this.tags=null,this.title=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e&&this.portal?this.portal?.normalizeUrl(`${t}/info/${e}?f=json`):null}get url(){const t=this.portal?.restUrl;return t?t+"/community/groups/"+this.id:null}fetchCategorySchema(t){return this.portal.request(this.url+"/categorySchema",t).then(e=>{const i=e.categorySchema||[];return i.some(r=>r.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",t):i})}fetchMembers(t){return this.portal.request(this.url+"/users",t)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}toJSON(){throw new G("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new N7;return e.sourceJSON=t,e.read(t),e}queryItems(t,e){let i=as(Jf,t);const r=this.portal;return parseFloat(r.currentVersion)>5?(i=i||new Jf,r.queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",e)):(i=i?i.clone():new Jf,i.query="group:"+this.id+(i.query?" "+i.query:""),r.queryItems(i,e))}_fetchCategorySchemaSet(t,e){const i=this.portal;return i.fetchSelf(i.authMode,!0,e).then(r=>{const n=r.contentCategorySetsGroupQuery;if(n){const s=new Jf;return s.disableExtraQuery=!0,s.num=1,s.query=n,i.queryGroups(s,e)}throw new G("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(r=>{if(r.total){const n=r.results[0],s=new Jf;return s.num=1,s.query=`typekeywords:"${t}"`,n.queryItems(s,e)}throw new G("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(r=>r.total?r.results[0].fetchData("json",e).then(n=>{const s=n?.categorySchema;return s?.length?s:[]}):[])}};u([p()],eo.prototype,"access",void 0),u([p({type:Date})],eo.prototype,"created",void 0),u([p()],eo.prototype,"description",void 0),u([p()],eo.prototype,"id",void 0),u([p()],eo.prototype,"isInvitationOnly",void 0),u([p({type:Date})],eo.prototype,"modified",void 0),u([p()],eo.prototype,"owner",void 0),u([p()],eo.prototype,"portal",void 0),u([p()],eo.prototype,"snippet",void 0),u([p()],eo.prototype,"sortField",void 0),u([p()],eo.prototype,"sortOrder",void 0),u([p()],eo.prototype,"sourceJSON",void 0),u([p()],eo.prototype,"tags",void 0),u([p()],eo.prototype,"thumbnail",void 0),u([p({readOnly:!0})],eo.prototype,"thumbnailUrl",null),u([p()],eo.prototype,"title",void 0),u([p({readOnly:!0})],eo.prototype,"url",null),eo=N7=u([M("esri.portal.PortalGroup")],eo);const F7=eo;let ob=class extends we{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};u([p()],ob.prototype,"nextQueryParams",void 0),u([p()],ob.prototype,"queryParams",void 0),u([p()],ob.prototype,"results",void 0),u([p()],ob.prototype,"total",void 0),ob=u([M("esri.portal.PortalQueryResult")],ob);const h5e=ob;let _g=class extends pe{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.portal?.restUrl;return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new G("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};u([p({type:Date})],_g.prototype,"created",void 0),u([p()],_g.prototype,"id",void 0),u([p()],_g.prototype,"portal",void 0),u([p()],_g.prototype,"title",void 0),u([p({readOnly:!0})],_g.prototype,"url",null),u([p()],_g.prototype,"username",void 0),_g=u([M("esri.portal.PortalFolder")],_g);const d5e=_g;var k7;let Cn=k7=class extends pe{constructor(...t){super(...t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){const t=this.portal?.restUrl;return t?`${t}/content/users/${this.username}`:null}get url(){const t=this.portal?.restUrl;return t?`${t}/community/users/${this.username}`:null}addItem(t){const e=t&&t.item,i=t?.data,r=t?.folder,n={method:"post"};e&&(n.query=e.createPostQuery(),i!=null&&(typeof i=="string"?n.query.text=i:typeof i=="object"&&(n.query.text=JSON.stringify(i))));let s=this.userContentUrl;return r&&(s+="/"+(typeof r=="string"?r:r.id)),this.portal.request(s+"/addItem",n).then(o=>(e.id=o.id,e.portal=this.portal,e.loaded?e.reload():e.load()))}deleteItem(t){let e=this.userContentUrl;return t.ownerFolder&&(e+="/"+t.ownerFolder),this.portal.request(e+`/items/${t.id}/delete`,{method:"post"}).then(()=>{t.id=null,t.portal=null})}deleteItems(t){const e=this.userContentUrl+"/deleteItems",i=t.map(r=>r.id);if(i.length){const r={method:"post",query:{items:i.join(",")}};return this.portal.request(e,r).then(()=>{t.forEach(n=>{n.id=null,n.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then(e=>{let i;return i=e&&e.folders?e.folders.map(r=>{const n=d5e.fromJSON(r);return n.portal=this.portal,n}):[],i})}fetchGroups(){return this.portal.request(this.url??"").then(t=>{let e;return e=t&&t.groups?t.groups.map(i=>{const r=F7.fromJSON(i);return r.portal=this.portal,r}):[],e})}fetchItems(t){const e=t??{};let i,r=this.userContentUrl??"";return e.folder&&(r+="/"+e.folder.id),ce(()=>Promise.resolve().then(()=>bye),void 0,import.meta.url).then(({default:n})=>{i=n;const s={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal.request(r,{query:s})}).then(n=>{let s;return n?.items?(s=n.items.map(o=>{const a=i.fromJSON(o);return a.portal=this.portal,a}),Promise.all(s.map(o=>o.load())).catch(o=>o).then(()=>({items:s,nextStart:n.nextStart,total:n.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal.request(this.url+"/tags").then(t=>t.tags)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new F7({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new G("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new G("internal:not-yet-implemented","PortalUser.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new k7;return e.sourceJSON=t,e.read(t),e}};u([p()],Cn.prototype,"access",void 0),u([p({type:Date})],Cn.prototype,"created",void 0),u([p()],Cn.prototype,"culture",void 0),u([p()],Cn.prototype,"description",void 0),u([p()],Cn.prototype,"email",void 0),u([p()],Cn.prototype,"favGroupId",void 0),u([p()],Cn.prototype,"fullName",void 0),u([p({type:Date})],Cn.prototype,"modified",void 0),u([p()],Cn.prototype,"orgId",void 0),u([p()],Cn.prototype,"portal",void 0),u([p()],Cn.prototype,"preferredView",void 0),u([p()],Cn.prototype,"privileges",void 0),u([p()],Cn.prototype,"region",void 0),u([p()],Cn.prototype,"role",void 0),u([p()],Cn.prototype,"roleId",void 0),u([p()],Cn.prototype,"sourceJSON",void 0),u([p()],Cn.prototype,"thumbnail",void 0),u([p({readOnly:!0})],Cn.prototype,"thumbnailUrl",null),u([p()],Cn.prototype,"units",void 0),u([p({readOnly:!0})],Cn.prototype,"userContentUrl",null),u([p({readOnly:!0})],Cn.prototype,"url",null),u([p()],Cn.prototype,"username",void 0),u([p()],Cn.prototype,"userType",void 0),Cn=k7=u([M("esri.portal.PortalUser")],Cn);const dZ=Cn;var vg;let M$;const Pie={PortalGroup:()=>Promise.resolve({default:F7}),PortalItem:()=>ce(()=>Promise.resolve().then(()=>bye),void 0,import.meta.url),PortalUser:()=>Promise.resolve({default:dZ})};let De=vg=class extends cM(xy){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=Di.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){Mie.unregister(this),this.defaultBasemap=$e(this.defaultBasemap),this.defaultDevBasemap=$e(this.defaultDevBasemap),this.defaultVectorBasemap=$e(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=Tr(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(const e of t)Di.request.trustedServers.includes(e)||Di.request.trustedServers.push(e);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){const t=this.user?.orgId,e=!t||this.canSearchPublic;return this.id&&!e?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let t=this.url;if(t){const e=t.indexOf("/sharing");t=e>0?t.substring(0,e):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){const t=this.restUrl,e=this.thumbnail;return t&&e?this._normalizeSSL(t+"/portals/self/resources/"+e):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let e=null;return t&&(e=dZ.fromJSON(t),e.portal=this),e}load(t){const e=ce(()=>Promise.resolve().then(()=>z5e),void 0,import.meta.url).then(({default:i})=>{Tt(t),M$=i}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(i=>{if(Wt){const r=Wt;this.credential=r.findCredential(this.restUrl),this.credential||this.authMode!==vg.AUTH_MODE_AUTO||(this._esriIdCredentialCreateHandle?.remove(),this._esriIdCredentialCreateHandle=r.on("credential-create",p5e(new WeakRef(this))),Mie.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(e),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),e=(await ce(()=>import("./ElevationLayer-f947161d.js"),["./ElevationLayer-f947161d.js","./ArcGISCachedService-ca5ddc60.js","./TileInfoTilemapCache-20ab7c46.js","./TilemapCache-91478691.js"],import.meta.url)).default;return t?t.map(i=>new e({id:i.id,url:i.url})):[]}async fetchBasemaps(t,e){const i=await this._fetchBasemaps(t,e);if(e?.include3d===!0&&this.use3dBasemaps!==!1){const r=await this._fetchBasemaps3D(t,e);i.unshift(...r)}return i}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(e=>e.categorySchema):ps(t)?Promise.reject(Ti()):Promise.resolve([])}fetchFeaturedGroups(t){const e=this.featuredGroups,i=new Jf;if(i.num=100,i.sortField="title",e&&e.length){const r=[];for(const n of e)r.push(`(title:"${n.title}" AND owner:${n.owner})`);return i.query=r.join(" OR "),this.queryGroups(i,t).then(n=>n.results)}return ps(t)?Promise.reject(Ti()):Promise.resolve([])}fetchRegions(t){const e=this.user?.culture||this.culture||Gu();return this.request(this.restUrl+"/portals/regions",{...t,query:{culture:e}})}fetchSettings(t){const e=this.user?.culture||this.culture||Gu();return this.request(this.restUrl+"/portals/self/settings",{...t,query:{culture:e}})}static getDefault(){return c5e(()=>new vg)}queryGroups(t,e){return this.queryPortal("/community/groups",t,"PortalGroup",e)}queryItems(t,e){return this.queryPortal("/search",t,"PortalItem",e)}queryUsers(t,e){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",e)}fetchSelf(t=this.authMode,e=!1,i){const r=this.restUrl+"/portals/self",n={authMode:t,query:{culture:Gu().toLowerCase()},...i};return n.authMode==="auto"&&(n.authMode="no-prompt"),e&&(n.query.default=!0),this.request(r,n)}queryPortal(t,e,i,r){const n=as(Jf,e),s=o=>this.request(this.restUrl+t,{...n.toRequestOptions(this),...r}).then(a=>{const l=n.clone();return l.start=a.nextStart,new h5e({nextQueryParams:l,queryParams:n,total:a.total,results:vg._resultsToTypedArray(o,{portal:this},a,r)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(Gl(l),a)));return i&&Pie[i]?Pie[i]().then(({default:o})=>(Tt(r),s(o))):s()}signIn(){if(this.authMode===vg.AUTH_MODE_ANONYMOUS)return Promise.reject(new G("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const t=e=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(e||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate"))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate"))).then(i=>{i&&(this.sourceJSON=i,this.read(i))});return Wt?Wt.getCredential(this.restUrl).then(e=>t(e)):t(this.credential)}normalizeUrl(t){const e=this.credential?.token;return this._normalizeSSL(e?t+(t.includes("?")?"&":"?")+"token="+e:t)}requestToTypedArray(t,e,i){return this.request(t,e).then(r=>{const n=vg._resultsToTypedArray(i,{portal:this},r);return Promise.all(n.map(s=>typeof s.when=="function"?s.when():r)).then(()=>n,()=>n)})}request(t,e={}){const i={f:"json",...e.query},{authMode:r=this.authMode===vg.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:n=null,cacheBust:s=!1,method:o="auto",responseType:a="json",signal:l}=e,c={authMode:r,body:n,cacheBust:s,method:o,query:i,responseType:a,timeout:0,signal:l};return _i(this._normalizeSSL(t),c).then(h=>h.data)}toJSON(){throw new G("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new vg({sourceJSON:t})}_getHelperService(t){const e=this.helperServices&&this.helperServices[t];if(!e)throw new G("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return e}async _fetchBasemaps(t,e){const i=new Jf;i.query=t||(Di.apiKey&&ZX(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),i.disableExtraQuery=!0;const r=await this.queryGroups(i,e);if(!r.total)return[];const n=r.results[0];i.num=100,i.query='type:"Web Map" -type:"Web Application"',i.sortField=n.sortField||"name",i.sortOrder=n.sortOrder||"desc";const s=await n.queryItems(i,e);return s.total?s.results.filter(o=>o.type==="Web Map").map(o=>new M$({portalItem:o})):[]}async _fetchBasemaps3D(t,e){const i=t||this.basemapGalleryGroupQuery3D;if(!i)return[];const r=new Jf({query:i,disableExtraQuery:!0}),n=await this.queryGroups(r,e);if(!n.total)return[];const s=n.results[0];r.num=100,r.query='type:"Web Scene"',r.sortField=s.sortField||"name",r.sortOrder=s.sortOrder||"desc";const o=await s.queryItems(r,e);return o.total?o.results.filter(a=>a.type==="Web Scene").map(a=>new M$({portalItem:a})):[]}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){const e=M$.fromJSON(t);return e.portalItem={portal:this},e}return null}static _resultsToTypedArray(t,e,i,r){let n=[];if(i){const s=r!=null?r.signal:null;n=i.listings||i.notifications||i.userInvitations||i.tags||i.items||i.groups||i.comments||i.provisions||i.results||i.relatedItems||i,(t||e)&&(n=n.map(o=>{const a=Object.assign(t?t.fromJSON(o):o,e);return typeof a.load=="function"&&a.load(s),a}))}else n=[];return n}};De.AUTH_MODE_ANONYMOUS="anonymous",De.AUTH_MODE_AUTO="auto",De.AUTH_MODE_IMMEDIATE="immediate",u([p()],De.prototype,"access",void 0),u([p()],De.prototype,"allSSL",void 0),u([p()],De.prototype,"authMode",void 0),u([p()],De.prototype,"authorizedCrossOriginDomains",void 0),u([wt("authorizedCrossOriginDomains")],De.prototype,"readAuthorizedCrossOriginDomains",null),u([p()],De.prototype,"basemapGalleryGroupQuery",void 0),u([p({json:{name:"3DBasemapGalleryGroupQuery"}})],De.prototype,"basemapGalleryGroupQuery3D",void 0),u([p()],De.prototype,"bingKey",void 0),u([p()],De.prototype,"canListApps",void 0),u([p()],De.prototype,"canListData",void 0),u([p()],De.prototype,"canListPreProvisionedItems",void 0),u([p()],De.prototype,"canProvisionDirectPurchase",void 0),u([p()],De.prototype,"canSearchPublic",void 0),u([p()],De.prototype,"canShareBingPublic",void 0),u([p()],De.prototype,"canSharePublic",void 0),u([p()],De.prototype,"canSignInArcGIS",void 0),u([p()],De.prototype,"canSignInIDP",void 0),u([p()],De.prototype,"colorSetsGroupQuery",void 0),u([p()],De.prototype,"commentsEnabled",void 0),u([p({type:Date})],De.prototype,"created",void 0),u([p()],De.prototype,"credential",void 0),u([p()],De.prototype,"culture",void 0),u([p()],De.prototype,"currentVersion",void 0),u([p()],De.prototype,"customBaseUrl",void 0),u([p()],De.prototype,"defaultBasemap",void 0),u([wt("defaultBasemap")],De.prototype,"readDefaultBasemap",null),u([p()],De.prototype,"defaultDevBasemap",void 0),u([wt("defaultDevBasemap")],De.prototype,"readDefaultDevBasemap",null),u([p({type:zi})],De.prototype,"defaultExtent",void 0),u([p()],De.prototype,"defaultVectorBasemap",void 0),u([wt("defaultVectorBasemap")],De.prototype,"readDefaultVectorBasemap",null),u([p()],De.prototype,"description",void 0),u([p()],De.prototype,"devBasemapGalleryGroupQuery",void 0),u([p()],De.prototype,"eueiEnabled",void 0),u([p({readOnly:!0})],De.prototype,"extraQuery",null),u([p()],De.prototype,"featuredGroups",void 0),u([p()],De.prototype,"featuredItemsGroupQuery",void 0),u([p()],De.prototype,"galleryTemplatesGroupQuery",void 0),u([p()],De.prototype,"livingAtlasGroupQuery",void 0),u([p()],De.prototype,"hasCategorySchema",void 0),u([p()],De.prototype,"helpBase",void 0),u([p()],De.prototype,"helperServices",void 0),u([p()],De.prototype,"helpMap",void 0),u([p()],De.prototype,"homePageFeaturedContent",void 0),u([p()],De.prototype,"homePageFeaturedContentCount",void 0),u([p()],De.prototype,"httpPort",void 0),u([p()],De.prototype,"httpsPort",void 0),u([p()],De.prototype,"id",void 0),u([p()],De.prototype,"ipCntryCode",void 0),u([p({readOnly:!0})],De.prototype,"isOrganization",null),u([p()],De.prototype,"isPortal",void 0),u([p()],De.prototype,"isReadOnly",void 0),u([p({readOnly:!0})],De.prototype,"itemPageUrl",null),u([p()],De.prototype,"layerTemplatesGroupQuery",void 0),u([p()],De.prototype,"maxTokenExpirationMinutes",void 0),u([p({type:Date})],De.prototype,"modified",void 0),u([p()],De.prototype,"name",void 0),u([p()],De.prototype,"portalHostname",void 0),u([p()],De.prototype,"portalMode",void 0),u([p()],De.prototype,"portalProperties",void 0),u([p()],De.prototype,"region",void 0),u([p({readOnly:!0})],De.prototype,"restUrl",null),u([p()],De.prototype,"rotatorPanels",void 0),u([p()],De.prototype,"showHomePageDescription",void 0),u([p()],De.prototype,"sourceJSON",void 0),u([p()],De.prototype,"staticImagesUrl",void 0),u([p({json:{name:"2DStylesGroupQuery"}})],De.prototype,"stylesGroupQuery2d",void 0),u([p({json:{name:"stylesGroupQuery"}})],De.prototype,"stylesGroupQuery3d",void 0),u([p()],De.prototype,"supportsHostedServices",void 0),u([p()],De.prototype,"symbolSetsGroupQuery",void 0),u([p()],De.prototype,"templatesGroupQuery",void 0),u([p()],De.prototype,"thumbnail",void 0),u([p({readOnly:!0})],De.prototype,"thumbnailUrl",null),u([p()],De.prototype,"units",void 0),u([p()],De.prototype,"url",void 0),u([p()],De.prototype,"urlKey",void 0),u([wt("urlKey")],De.prototype,"readUrlKey",null),u([p()],De.prototype,"user",void 0),u([wt("user")],De.prototype,"readUser",null),u([p()],De.prototype,"use3dBasemaps",void 0),u([p()],De.prototype,"useStandardizedQuery",void 0),u([p()],De.prototype,"useVectorBasemaps",void 0),u([p()],De.prototype,"vectorBasemapGalleryGroupQuery",void 0),De=vg=u([M("esri.portal.Portal")],De);const Ds=De,Mie=new FinalizationRegistry(t=>{t.remove()});function p5e(t){const e=Wt;return()=>{const i=t.deref();i&&e.findCredential(i.restUrl)&&i.signIn().catch(()=>{})}}let bg=class extends we{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e?.portalItem&&e.path?{...e,path:this._normalizePath(e.path,e.portalItem)}:e}set path(e){e!=null&&Vu(e)?K.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",i){const r=this.cdnUrl;if(r==null)throw new G("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(r,{responseType:e,query:{token:this.portalItem.apiKey},signal:i?.signal})}async update(e,i){const{addOrUpdateResource:r}=await ce(()=>Promise.resolve().then(()=>u3),void 0,import.meta.url);return r(this,"update",e,i)}hasPath(){return this.path!=null}_normalizePath(e,i){return e==null?e:(e=e.replace(/^\/+/,""),i!=null&&Vu(e)&&(e=jX(e,i.itemUrl)),e?.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};u([p()],bg.prototype,"portalItem",void 0),u([p({type:String,value:null})],bg.prototype,"path",null),u([ai("path")],bg.prototype,"_castPath",null),u([p({type:String,readOnly:!0})],bg.prototype,"url",null),u([p({type:String,readOnly:!0})],bg.prototype,"cdnUrl",null),u([p({type:String,readOnly:!0})],bg.prototype,"itemRelativeUrl",null),bg=u([M("esri.portal.PortalItemResource")],bg);const f5e=bg;let s3=class extends we{constructor(e){super(e),this.created=null,this.rating=null}};u([p()],s3.prototype,"created",void 0),u([p()],s3.prototype,"rating",void 0),s3=u([M("esri.portal.PortalRating")],s3);const G8=s3;var ab;const m5e=new Set(["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","GeoJson","CSV","KML","WFS","WMTS","WMS","Feed"]),g5e=new Set(["KML","GeoJson","CSV"]);let hi=ab=class extends cM(xy){static from(t){return nx(ab,t)}constructor(t){super(t),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const t=this.type,e=this.typeKeywords||[];let i=t;return t==="Feature Service"||t==="Feature Collection"?i=e.includes("Table")?"Table":e.includes("Route Layer")?"Route Layer":e.includes("Markup")?"Markup":"Feature Layer":t==="Image Service"?i=e.includes("Elevation 3D Layer")?"Elevation Layer":e.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":t==="Scene Service"?i="Scene Layer":t==="Video Service"?i="Video Layer":t==="Scene Package"?i="Scene Layer Package":t==="Stream Service"?i="Feature Layer":t==="Geoprocessing Service"?i=e.includes("Web Tool")?"Tool":"Geoprocessing Service":t==="Geocoding Service"?i="Locator":t==="Geoenrichment Service"?i="GeoEnrichment Service":t==="Microsoft Powerpoint"?i="Microsoft PowerPoint":t==="GeoJson"?i="GeoJSON":t==="Globe Service"?i="Globe Layer":t==="Vector Tile Service"?i="Tile Layer":t==="netCDF"?i="NetCDF":t==="Map Service"?i=e.includes("Spatiotemporal")||!e.includes("Hosted Service")&&!e.includes("Tiled")||e.includes("Relational")?"Map Image Layer":"Tile Layer":t&&t.toLowerCase().includes("add in")?i=t.replaceAll(/(add in)/gi,"Add-In"):t==="datastore catalog service"?i="Big Data File Share":t==="Compact Tile Package"?i="Tile Package (tpkx)":t==="OGCFeatureServer"?i="OGC Feature Layer":t==="web mapping application"&&e.includes("configurableApp")?i="Instant App":t==="Insights Page"?i="Insights Report":t==="Excalibur Imagery Project"&&(i="Excalibur Project"),i}readExtent(t){return t&&t.length?new zi(t[0][0],t[0][1],t[1][0],t[1][1]):null}get iconUrl(){const t=this.type?.toLowerCase()||"",e=this.typeKeywords||[],i="esri/images/portal/",r="16";let n,s=!1,o=!1,a=!1,l=!1,c=!1,h=!1,d=!1;return t.indexOf("service")>0||t==="feature collection"||t==="kml"||t==="wms"||t==="wmts"||t==="wfs"?(s=e.includes("Hosted Service"),t==="feature service"||t==="feature collection"||t==="kml"||t==="wfs"?(o=e.includes("Table"),a=e.includes("Route Layer"),l=e.includes("Markup"),c=e.includes("Spatiotemporal"),h=e.includes("UtilityNetwork"),n=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":s?"featureshosted":h?"utilitynetwork":"features"):n=t==="map service"||t==="wms"||t==="wmts"?s||e.includes("Tiled")||t==="wmts"?"maptiles":"mapimages":t==="scene service"?e.includes("Line")?"sceneweblayerline":e.includes("3DObject")?"sceneweblayermultipatch":e.includes("Point")?"sceneweblayerpoint":e.includes("IntegratedMesh")?"sceneweblayermesh":e.includes("PointCloud")?"sceneweblayerpointcloud":e.includes("Polygon")?"sceneweblayerpolygon":e.includes("Building")?"sceneweblayerbuilding":e.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":t==="image service"?e.includes("Elevation 3D Layer")?"elevationlayer":e.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":t==="stream service"?"streamlayer":t==="video service"?e.includes("Live Stream")?"livestreamvideolayer":"videolayer":t==="vector tile service"?"vectortile":t==="datastore catalog service"?"datastorecollection":t==="geocoding service"?"geocodeservice":t==="geoprocessing service"?e.includes("Web Tool")?"tool":"layers":t==="geodata service"?"geodataservice":t==="3dtiles service"?"3dtileslayer":"layers"):t==="web map"||t==="cityengine web scene"?n="maps":t==="web scene"?n=e.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":t==="web mapping application"&&e.includes("configurableApp")?n="instantapps":t==="web mapping application"||t==="mobile application"||t==="application"||t==="operation view"||t==="desktop application"?n="apps":t==="map document"||t==="map package"||t==="published map"||t==="scene document"||t==="globe document"||t==="basemap package"||t==="mobile basemap package"||t==="mobile map package"||t==="project package"||t==="project template"||t==="pro map"||t==="layout"||t==="layer"&&e.includes("ArcGIS Pro")||t==="explorer map"&&e.indexOf("Explorer Document")?n="mapsgray":t==="service definition"||t==="csv"||t==="shapefile"||t==="cad drawing"||t==="geojson"||t==="netcdf"||t==="administrative report"?n="datafiles":t==="explorer add in"||t==="desktop add in"||t==="windows viewer add in"||t==="windows viewer configuration"?n="appsgray":t==="360 vr experience"?n="360vr":t==="arcgis pro add in"||t==="arcgis pro configuration"?n="addindesktop":t==="rule package"||t==="file geodatabase"||t==="sqlite geodatabase"||t==="csv collection"||t==="kml collection"||t==="windows mobile package"||t==="map template"||t==="desktop application template"||t==="gml"||t==="arcpad package"||t==="code sample"||t==="document link"||t==="earth configuration"||t==="operations dashboard add in"||t==="rules package"||t==="image"||t==="workflow manager package"||t==="explorer map"&&e.includes("Explorer Mapping Application")||e.includes("Document")?n="datafilesgray":t==="network analysis service"||t==="geoprocessing service"||t==="geodata service"||t==="geometry service"||t==="geoprocessing package"||t==="locator package"||t==="geoprocessing sample"||t==="workflow manager service"?n="toolsgray":t==="layer"||t==="layer package"||t==="explorer layer"?n="layersgray":t==="scene package"?n="scenepackage":t==="3dtiles package"?n="3dtileslayerpackage":t==="mobile scene package"?n="mobilescenepackage":t==="tile package"||t==="compact tile package"?n="tilepackage":t==="task file"?n="taskfile":t==="report template"?n="report-template":t==="statistical data collection"?n="statisticaldatacollection":t==="insights workbook"?n="workbook":t==="insights model"?n="insightsmodel":t==="insights page"?n="insightspage":t==="insights theme"?n="insightstheme":t==="hub initiative"?n="hubinitiative":t==="hubpage"?n="hubpage":t==="hub event"?n="hubevent":t==="hub site application"?n="hubsite":t==="hub project"?n="hubproject":t==="relational database connection"?n="relationaldatabaseconnection":t==="big data file share"?n="datastorecollection":t==="image collection"?n="imagecollection":t==="style"?n="style":t==="desktop style"?n="desktopstyle":t==="dashboard"?n="dashboard":t==="raster function template"?n="rasterprocessingtemplate":t==="vector tile package"?n="vectortilepackage":t==="ortho mapping project"?n="orthomappingproject":t==="ortho mapping template"?n="orthomappingtemplate":t==="solution"?n="solutions":t==="geopackage"?n="geopackage":t==="deep learning package"?n="deeplearningpackage":t==="real time analytic"?n="realtimeanalytics":t==="big data analytic"?n="bigdataanalytics":t==="feed"?n="feed":t==="excalibur imagery project"?n="excaliburimageryproject":t==="notebook"?n="notebook":t==="storymap"?n="storymap":t==="survey123 add in"?n="survey123addin":t==="mission"?n="mission":t==="mission report"?n="missionreport":t==="mission template"?n="missiontemplate":t==="quickcapture project"?n="quickcaptureproject":t==="pro report"?n="proreport":t==="pro report template"?n="proreporttemplate":t==="urban model"?n="urbanmodel":t==="web experience"?n="experiencebuilder":t==="web experience template"?n="webexperiencetemplate":t==="experience builder widget"?n="experiencebuilderwidget":t==="experience builder widget package"?n="experiencebuilderwidgetpackage":t==="workflow"?n="workflow":t==="insights script"?n="insightsscript":t==="kernel gateway connection"?n="kernelgatewayconnection":t==="hub initiative template"?n="hubinitiativetemplate":t==="storymap theme"?n="storymaptheme":t==="knowledge graph"?n="knowledgegraph":t==="knowledge studio project"?n="knowledgestudio":t==="native application"?n="nativeapp":t==="native application installer"?n="nativeappinstaller":t==="link chart"?n="linkchart":t==="investigation"?n="investigation":t==="ogcfeatureserver"?n="features":t==="pro project"?n="proproject":t==="insights workbook package"?n="insightsworkbookpackage":t==="apache parquet"?n="apacheparquet":t==="notebook code snippets"||t==="notebook code snippet library"?n="notebookcodesnippets":t==="suitability model"?n="suitabilitymodel":t==="esri classifier definition"?n="classifierdefinition":t==="esri classification schema"?n="classificationschema":t==="insights data engineering workbook"?n="dataengineeringworkbook":t==="insights data engineering model"?n="dataengineeringmodel":t==="deep learning studio project"?n="deeplearningproject":t==="discussion"?n="discussion":t==="allsource project"?n="allsourceproject":t==="api key"?n="apikey":t==="data pipeline"?n="datapipelines":t==="group layer"?(d=e.includes("Map"),n=d?"layergroup2d":"layergroup"):n=t==="media layer"?"onlinemedialayer":t==="form"?e.includes("Survey123")?"survey":"datafilesgray":"maps",n?ur(i+n+r+".png"):null}get isLayer(){return this.type!=null&&m5e.has(this.type)}get itemCdnUrl(){let t=this.itemUrl;return t&&Wt&&!Wt.findCredential(t)&&(t=Wt._normalizeAGOLorgDomain(t),t=t.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),t=t.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),t=t.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),t}get itemPageUrl(){const t=this.portal?.itemPageUrl;return t&&this.id?`${t}?id=${this.id}`:null}get itemUrl(){const t=this.portal?.restUrl;return t&&this.id?`${t}/content/items/${this.id}`:null}get thumbnailUrl(){const t=this.itemUrl,e=this.thumbnail;return t&&e?this.portal?.normalizeUrl(`${t}/info/${e}?f=json`)??null:null}get userItemUrl(){const t=this.portal?.restUrl;if(!t)return null;const e=this.owner||this.portal?.user?.username;return e?`${t}/content/users/${this.ownerFolder?`${e}/${this.ownerFolder}`:e}/items/${this.id}`:null}load(t){const e=this.portal??(this.portal=Ds.getDefault()),i=e.load(t).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?e.request(this.itemUrl,{signal:t!=null?t.signal:null,query:{token:this.apiKey}}):{}).then(r=>{this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(i),Promise.resolve(this)}async addRating(t){const e={method:"post",query:{}};return t instanceof G8&&(t=t.rating),t==null||isNaN(t)||typeof t!="number"||(e.query.rating=t),this.portal?(await this.portal.request(this.itemUrl+"/addRating",e),new G8({rating:t,created:new Date})):null}clone(){const t={access:this.access,accessInformation:this.accessInformation,applicationProxies:Q(this.applicationProxies),avgRating:this.avgRating,categories:Q(this.categories),created:Q(this.created),culture:this.culture,description:this.description,extent:Q(this.extent),groupCategories:Q(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:Q(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:Q(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:Q(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:Q(this.typeKeywords),url:this.url};this.loaded&&(t.loadStatus="loaded");const e=new ab({sourceJSON:this.sourceJSON}).set(t);return e._set("isOrgItem",this.isOrgItem),e}createPostQuery(){const t=this.toJSON();for(const i of["tags","typeKeywords","categories"])t[i]=t[i]?.join(", ");const{extent:e}=t;return e&&(t.extent=JSON.stringify(e)),t}async deleteRating(){await this.portal.request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(t="json",e){return this.portal.request(this.itemUrl+"/data",{responseType:t,...e,query:{token:this.apiKey}})}async fetchRating(t){const e=await this.portal.request(this.itemUrl+"/rating",{query:{token:this.apiKey},...t});return e.rating!=null?(e.created=new Date(e.created),new G8(e)):null}fetchRelatedItems(t,e){return this.portal.requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...t,token:this.apiKey},...e},ab)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}reload(){return this.portal.request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.sourceJSON=t,this.read(t),this))}update(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t?.data,i={method:"post"};i.query=this.createPostQuery();for(const r in i.query)i.query[r]===null&&(i.query[r]="");return i.query.clearEmptyFields=!0,e!=null&&(typeof e=="string"?i.query.text=e:typeof e=="object"&&(i.query.text=JSON.stringify(e))),this.portal.request(`${this.userItemUrl}/update`,i).then(()=>this.reload())}):Promise.reject(new G("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(t){if(!this.id)throw new G("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:e,itemUrl:i}=this;await e.signIn();const{copyResources:r,folder:n,tags:s,title:o}=t||{},a={method:"post",query:{copyPrivateResources:r==="all",folder:typeof n=="string"?n:n?.id,includeResources:!!r,tags:s?.join(","),title:o}},{itemId:l}=await e.request(`${i}/copy`,a);return new ab({id:l,portal:e})}updateThumbnail(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t.thumbnail,i=t.filename,r={method:"post"};if(typeof e=="string")Fm(e)?r.query={data:e}:r.query={url:ul(e)},i!=null&&(r.query.filename=i);else{const n=new FormData;i!=null?n.append("file",e,i):n.append("file",e),r.body=n}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,r).then(()=>this.reload())}):Promise.reject(new G("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(t={},e){const{fetchResources:i}=await ce(()=>Promise.resolve().then(()=>u3),void 0,import.meta.url);return i(this,t,e)}async addResource(t,e,i){const{addOrUpdateResource:r}=await ce(()=>Promise.resolve().then(()=>u3),void 0,import.meta.url);return t.portalItem=this,r(t,"add",e,i)}async removeResource(t,e){const{removeResource:i}=await ce(()=>Promise.resolve().then(()=>u3),void 0,import.meta.url);if(t.portalItem&&t.portalItem.itemUrl!==this.itemUrl)throw new G("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return i(this,t,e)}async removeAllResources(t){const{removeAllResources:e}=await ce(()=>Promise.resolve().then(()=>u3),void 0,import.meta.url);return e(this,t)}resourceFromPath(t){return new f5e({portalItem:this,path:t})}toJSON(){const t=this.extent,e={accessInformation:this.accessInformation,categories:Q(this.categories),created:this.created?.getTime(),description:this.description,extent:t&&[[t.xmin,t.ymin],[t.xmax,t.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified?.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:Q(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:Q(this.typeKeywords),url:this.url};return n6(e)}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new ab({sourceJSON:t})}_getPostQuery(){const t=this.toJSON();for(const e in t)e==="tags"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="typeKeywords"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="extent"&&t[e]&&(t[e]=JSON.stringify(t[e]));return t}};u([p({type:["private","shared","org","public"]})],hi.prototype,"access",void 0),u([p()],hi.prototype,"accessInformation",void 0),u([p({type:String})],hi.prototype,"apiKey",void 0),u([p({json:{read:{source:"appProxies"}}})],hi.prototype,"applicationProxies",void 0),u([p()],hi.prototype,"avgRating",void 0),u([p()],hi.prototype,"categories",void 0),u([p({type:Date})],hi.prototype,"created",void 0),u([p()],hi.prototype,"culture",void 0),u([p()],hi.prototype,"description",void 0),u([p({readOnly:!0})],hi.prototype,"displayName",null),u([p({type:zi})],hi.prototype,"extent",void 0),u([wt("extent")],hi.prototype,"readExtent",null),u([p()],hi.prototype,"groupCategories",void 0),u([p({readOnly:!0})],hi.prototype,"iconUrl",null),u([p()],hi.prototype,"id",void 0),u([p({readOnly:!0})],hi.prototype,"isLayer",null),u([p({type:Boolean,readOnly:!0})],hi.prototype,"isOrgItem",void 0),u([p()],hi.prototype,"itemControl",void 0),u([p({readOnly:!0})],hi.prototype,"itemPageUrl",null),u([p({readOnly:!0})],hi.prototype,"itemUrl",null),u([p()],hi.prototype,"licenseInfo",void 0),u([p({type:Date})],hi.prototype,"modified",void 0),u([p()],hi.prototype,"name",void 0),u([p()],hi.prototype,"numComments",void 0),u([p()],hi.prototype,"numRatings",void 0),u([p()],hi.prototype,"numViews",void 0),u([p()],hi.prototype,"owner",void 0),u([p()],hi.prototype,"ownerFolder",void 0),u([p({type:Ds})],hi.prototype,"portal",void 0),u([p()],hi.prototype,"screenshots",void 0),u([p()],hi.prototype,"size",void 0),u([p()],hi.prototype,"snippet",void 0),u([p()],hi.prototype,"sourceJSON",void 0),u([p({type:String})],hi.prototype,"sourceUrl",void 0),u([p({type:String})],hi.prototype,"spatialReference",void 0),u([p()],hi.prototype,"tags",void 0),u([p()],hi.prototype,"thumbnail",void 0),u([p({readOnly:!0})],hi.prototype,"thumbnailUrl",null),u([p()],hi.prototype,"title",void 0),u([p()],hi.prototype,"type",void 0),u([p()],hi.prototype,"typeKeywords",void 0),u([p({type:String,json:{read(t,e){if(g5e.has(e.type)){const i=this.portal?.restUrl;t||(t=i&&this.id?`${i}/content/items/${this.id}/data`:null)}return t}}})],hi.prototype,"url",void 0),u([p({readOnly:!0})],hi.prototype,"userItemUrl",null),hi=ab=u([M("esri.portal.PortalItem")],hi);const kw=hi,bye=Object.freeze(Object.defineProperty({__proto__:null,default:kw},Symbol.toStringTag,{value:"Module"})),$ie=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,y5e={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function Iie(t){return t in y5e}const o3=[],H2=new Map;function Lie(t){for(const e of H2.keys())wye(t.pattern,e)&&H2.delete(e)}function _5e(t){return o3.includes(t)||(Lie(t),o3.unshift(t)),Vi(()=>{const e=o3.indexOf(t);e>-1&&(o3.splice(e,1),Lie(t))})}async function pZ(t){const e=Gu();H2.has(t)||H2.set(t,b5e(t,e));const i=H2.get(t);return i&&await w5e.add(i),i}function v5e(t){if(!$ie.test(t))return null;const e=$ie.exec(t);if(e===null)return null;const[,i,r]=e,n=i+(r?"-"+r.toUpperCase():"");return Iie(n)?n:Iie(i)?i:null}async function b5e(t,e){const i=[];for(const r of o3)if(wye(r.pattern,t))try{return await r.fetchMessageBundle(t,e)}catch(n){i.push(n)}throw i.length?new G("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:i}):new G("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}function wye(t,e){return typeof t=="string"?e.startsWith(t):t.test(e)}hZ(()=>{H2.clear()});const w5e=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=Hs())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function x5e(t){if(!t)return;const e=t.includes("-vector")?t.slice(0,t.indexOf("-vector")):t.includes("-3d")?t.slice(0,t.indexOf("-3d")):t,i=await pZ("esri/t9n/basemaps");return i[t]||i[e]}const U7={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return ur("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return ur("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return ur("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return ur("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return ur("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return ur("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get"dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return ur("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return ur("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return ur("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return ur("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return ur("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return ur("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return ur("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return ur("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"arcgis-imagery":{get thumbnailUrl(){return ur("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return ur("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return ur("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return ur("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return ur("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return ur("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return ur("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return ur("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return ur("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return ur("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}},T5e=new Set(["ar","bs","ca","hr","cs","da","nl","en","et","fi","fr","de","el","he","hu","id","it","ja","ko","lv","lt","nb","pl","ro","ru","sr","es","sv","th","tr","uk","vi"]);let TS=class extends we{constructor(e){super(e),this.id=null,this.language=null,this.serviceUrl="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2/webmaps"}getLanguageParamValue(){if(this.language)return this.language;const e=Gu().toLowerCase();switch(e){case"pt-br":return"pt-BR";case"pt-pt":return"pt-PT";case"zh-cn":return"zh-CN";case"zh-hk":return"zh-HK";case"zh-tw":return"zh-TW"}const i=a5e(e);return i==="pt"?"pt-BR":i&&T5e.has(i)?i:"global"}};u([p()],TS.prototype,"id",void 0),u([p()],TS.prototype,"language",void 0),u([p()],TS.prototype,"serviceUrl",void 0),TS=u([M("esri.support.BasemapStyle")],TS);const S5e=TS;function APt(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="feature"}function OPt(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="subtype-group"&&"sublayers"in t}function HO(t){const e=t?.type;return e==="base-tile"||e==="tile"||e==="elevation"||e==="imagery-tile"||e==="base-elevation"||e==="open-street-map"||e==="wcs"||e==="web-tile"||e==="wmts"||e==="vector-tile"}function AE(t){return t!=null&&"type"in t&&t.type==="group"}const RPt={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function xye(t){const e=t?.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function Die(t){return t?.type==="voxel"}function Nie(t){return t?.type==="imagery-tile"}function XD(t){return t?.parent!=null&&"declaredClass"in t.parent&&t.parent.declaredClass==="esri.Basemap"&&t.parent.baseLayers.includes(t)}function _6(t){return t?.type==="feature"&&!t.url&&t.source?.type==="memory"}function PPt(t){return(t?.type==="feature"||t?.type==="subtype-group")&&t.source?.type==="feature-layer"}function E5e(t){if(t.activeLayer){const e=t.activeLayer.tileMatrixSet;if(e)return e;const i=t.activeLayer.tileMatrixSets;if(i)return i}return null}async function Tye(t,e){const i=Wt?.findServerInfo(t);if(i?.currentVersion!=null)return i.owningSystemUrl||null;const r=t.toLowerCase().indexOf("/rest/services");if(r===-1)return null;const n=`${t.substring(0,r)}/rest/info`,s=e!=null?e.signal:null,{data:o}=await _i(n,{query:{f:"json"},responseType:"json",signal:s});return o?.owningSystemUrl||null}function C5e(t){if(!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function A5e(t){return C5e(t)?"effectiveCapabilities"in t?t.effectiveCapabilities:t.capabilities:null}function O5e(t){if(!("editingEnabled"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function R5e(t){return!!O5e(t)&&("effectiveEditingEnabled"in t?t.effectiveEditingEnabled:t.editingEnabled)}const P5e=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),M5e=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","media","ogc-feature","oriented-imagery","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function $5e(t){return t.layerContainerType==="basemap"?P5e:t.layerContainerType==="operational-layers"?M5e:null}function I5e(t,e){if(e.restrictedWebMapWriting){const i=$5e(e);return i==null||i.has(t.type)&&!_6(t)}return!0}function L5e(t,e){if(e)if(_6(t)){const i=Jg("featureCollection.layers",e),r=i?.[0]?.layerDefinition;r&&Fie(t,r)}else t.type!=="group"&&Fie(t,e)}function Fie(t,e){"maxScale"in t&&(e.maxScale=_5(t.maxScale)??void 0),"minScale"in t&&(e.minScale=_5(t.minScale)??void 0)}function D5e(t,e){if(L5e(t,e),e&&(e.id=t.id,"blendMode"in t&&(e.blendMode=t.blendMode,e.blendMode==="normal"&&delete e.blendMode),e.opacity=_5(t.opacity)??void 0,e.title=t.title||"Layer",e.visibility=t.visible,"legendEnabled"in t&&t.type!=="wmts"))if(_6(t)){const i=e.featureCollection;i&&(i.showLegend=t.legendEnabled)}else e.showLegend=t.legendEnabled}function kie(t,e,i){if(!t.persistenceEnabled)return null;if(!("write"in t)||!t.write)return i?.messages&&i.messages.push(new G("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted`,{layer:t})),null;if(_6(t)&&!t.isTable)e=t.resourceInfo;else if(I5e(t,i)){const r={};return t.write(r,i)?r:null}return e!=null&&D5e(t,e=Q(e)),e}var a3;let N5e=0;const F5e="esri.Basemap";let uu=a3=class extends cM(xy){constructor(t){super(t),this.id=null,this.portalItem=null,this.spatialReference=null,this.style=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+N5e++,this.baseLayers=new Je,this.referenceLayers=new Je;const e=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type==="elevation"&&K.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a basemap layer and will therefore be ignored.`)},i=r=>{r.parent=null};this.addHandles([this.baseLayers.on("after-add",r=>e(r.item)),this.referenceLayers.on("after-add",r=>e(r.item)),this.baseLayers.on("after-remove",r=>i(r.item)),this.referenceLayers.on("after-remove",r=>i(r.item))])}initialize(){this.when().catch(t=>{K.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.baseLayers.toArray();for(const i of t)i.destroy();const e=this.referenceLayers.toArray();for(const i of e)i.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),this.portalItem=$e(this.portalItem)}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set baseLayers(t){this._set("baseLayers",wy(t,this._get("baseLayers")))}_writeBaseLayers(t,e,i){const r=[];t&&(i={...i,layerContainerType:"basemap"},this.baseLayers.forEach(n=>{const s=kie(n,i.webmap?i.webmap.getLayerJSONFromResourceInfo(n):null,i);s!=null&&r.push(s)}),this.referenceLayers.forEach(n=>{const s=kie(n,i.webmap?i.webmap.getLayerJSONFromResourceInfo(n):null,i);s!=null&&(n.type!=="scene"&&(s.isReference=!0),r.push(s))})),e.baseMapLayers=r}set referenceLayers(t){this._set("referenceLayers",wy(t,this._get("referenceLayers")))}writeTitle(t,e){e.title=t||"Basemap"}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return tZ(this,t=>{t(this.baseLayers,this.referenceLayers)})}clone(){const t={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(e=>s5(e)?e.clone():e),referenceLayers:this.referenceLayers.map(e=>s5(e)?e.clone():e)};return this.loaded&&(t.loadStatus="loaded"),new a3({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}write(t,e){return t=t||{},e?.origin||(e={origin:"web-map",...e}),super.write(t,e),!this.loaded&&this.resourceInfo?.data.baseMapLayers&&(t.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(i=>{const r=Q(i);return r.url&&Em(r.url)&&(r.url=`https:${r.url}`),r.templateUrl&&Em(r.templateUrl)&&(r.templateUrl=`https:${r.templateUrl}`),r})),t}async _loadFromSource(t){const{resourceInfo:e,portalItem:i,style:r}=this;Tt(t);const n=[];if(e){const s=e.context?e.context.url:null;if(n.push(this._loadLayersFromJSON(e.data,s,t)),e.data.id&&!e.data.title){const o=e.data.id;n.push(x5e(o).then(a=>{a&&this.read({title:a},e.context)}))}}else i?n.push(this._loadFromItem(i,t)):r&&n.push(this._loadFromStylesService(r,t));await Promise.all(n)}async _loadLayersFromJSON(t,e,i){const r=this.resourceInfo?.context,n=this.portalItem?.portal||r?.portal||null,s=U5e[r?.origin||""]??"web-map",{populateOperationalLayers:o}=await ce(()=>import("./layersCreator-96ef29cd.js"),["./layersCreator-96ef29cd.js","./portalLayers-7401a143.js","./associatedFeatureServiceUtils-aa9f1206.js","./requestPresets-07a176e4.js"],import.meta.url),a=[];if(Tt(i),t.baseMapLayers&&Array.isArray(t.baseMapLayers)){const l={context:{...r,origin:s,url:e,portal:n,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},c=f=>s==="web-scene"&&f.layerType==="ArcGISSceneServiceLayer"||f.isReference,h=o(this.baseLayers,t.baseMapLayers.filter(f=>!c(f)),l);a.push(h);const d=o(this.referenceLayers,t.baseMapLayers.filter(c),l);a.push(d)}await Promise.allSettled(a)}async _loadFromItem(t,e){const i=await t.load(e),r=await i.fetchData("json",e),n=Nn(t.itemUrl??"");return this._set("resourceInfo",{data:r.baseMap??{},context:{origin:k5e[t.type||""]??"web-map",portal:t.portal||Ds.getDefault(),url:n}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this.read({title:t.title,thumbnailUrl:t.thumbnailUrl},{origin:"portal-item",portal:t.portal||Ds.getDefault(),url:n}),this._loadLayersFromJSON(this.resourceInfo.data,n,e)}async _loadFromStylesService(t,e){const i=`${t.serviceUrl}/${t.id}`,r=(await _i(i,{query:{language:t.getLanguageParamValue()},signal:e?.signal})).data;if(r.baseMap&&Array.isArray(r.baseMap.baseMapLayers)){for(const s of r.baseMap.baseMapLayers)if(!s.customParameters&&s.styleUrl?.includes("?")){const o=Nn(s.styleUrl);o.query&&(s.styleUrl=o.path,s.customParameters=o.query)}}const n=Nn(i);return this._set("resourceInfo",{data:r.baseMap??{},context:{origin:"web-map",url:n}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this._loadLayersFromJSON(this.resourceInfo.data,n,e)}static fromId(t){const e=U7[t];return e?e.itemId?new a3({portalItem:{id:e.itemId,portal:{url:"https://www.arcgis.com"}}}):a3.fromJSON(e,{origin:e.is3d?"web-scene":"web-map"}):null}};u([p({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(t,e,i,r){this._writeBaseLayers(t,e,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:Je}},writer(t,e,i,r){this._writeBaseLayers(t,e,r)}}}}}})],uu.prototype,"baseLayers",null),u([p({type:String,json:{origins:{"web-scene":{write:!0}}}})],uu.prototype,"id",void 0),u([p({type:kw})],uu.prototype,"portalItem",void 0),u([p()],uu.prototype,"referenceLayers",null),u([p({readOnly:!0})],uu.prototype,"resourceInfo",void 0),u([p({type:ze})],uu.prototype,"spatialReference",void 0),u([p({type:S5e})],uu.prototype,"style",void 0),u([p()],uu.prototype,"thumbnailUrl",void 0),u([p({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],uu.prototype,"title",void 0),u([Be("title")],uu.prototype,"writeTitle",null),uu=a3=u([M(F5e)],uu);const k5e={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},U5e={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},q2=uu,z5e=Object.freeze(Object.defineProperty({__proto__:null,default:q2},Symbol.toStringTag,{value:"Module"})),L5={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function Sye(t){return!!L5[t]||!!L5[t.toLowerCase()]}function fZ(t){return L5[t]??L5[t.toLowerCase()]}function B5e(t){return[...fZ(t)]}function j8(t,e,i){i<0&&++i,i>1&&--i;const r=6*i;return r<1?t+(e-t)*r:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}function Eye(t,e,i,r=1){const n=(t%360+360)%360/360,s=i<=.5?i*(e+1):i+e-i*e,o=2*i-s;return[Math.round(255*j8(o,s,n+1/3)),Math.round(255*j8(o,s,n)),Math.round(255*j8(o,s,n-1/3)),r]}function V5e(t){const e=t.length>5,i=e?8:4,r=(1<<i)-1,n=e?1:17,s=e?t.length===9:t.length===5;let o=+("0x"+t.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return s&&(l=o&r,o>>=i,a[3]=n*l/255),l=o&r,o>>=i,a[2]=n*l,l=o&r,o>>=i,a[1]=n*l,l=o&r,o>>=i,a[0]=n*l,a}function E(){return[0,0,0]}function Qr(t){return[t[0],t[1],t[2]]}function Oe(t,e,i){return[t,e,i]}function Ta(t,e=E()){const i=Math.min(3,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function Cye(t,e){return new Float64Array(t,e,3)}function Aye(){return E()}function Oye(){return Oe(1,1,1)}function Rye(){return Oe(1,0,0)}function Pye(){return Oe(0,1,0)}function mZ(){return Oe(0,0,1)}const vo=Aye(),ey=Oye(),Mye=Rye(),$ye=Pye(),gZ=mZ();Object.freeze(Object.defineProperty({__proto__:null,ONES:ey,UNIT_X:Mye,UNIT_Y:$ye,UNIT_Z:gZ,ZEROS:vo,clone:Qr,create:E,createView:Cye,fromArray:Ta,fromValues:Oe,ones:Oye,unitX:Rye,unitY:Pye,unitZ:mZ,zeros:Aye},Symbol.toStringTag,{value:"Module"}));let yZ=1e-6;function jo(){return yZ}function G5e(t){yZ=t}const pM=Math.random,j5e=Math.PI/180,H5e=180/Math.PI;function v6(t){return t*j5e}function q5e(t){return t*H5e}function W5e(t,e){return Math.abs(t-e)<=yZ*Math.max(1,Math.abs(t),Math.abs(e))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:pM,equals:W5e,getEpsilon:jo,setEpsilon:G5e,toDegree:q5e,toRadian:v6},Symbol.toStringTag,{value:"Module"}));function xe(t){const e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)}function oe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function ae(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t}function ue(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function de(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function b6(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function D5(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function Y5e(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function Iye(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function OE(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}function N5(t,e){return t[0]=Math.sign(e[0]),t[1]=Math.sign(e[1]),t[2]=Math.sign(e[2]),t}function w6(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function Lye(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function X5e(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function re(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function ql(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t}function Mr(t,e){const i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(i*i+r*r+n*n)}function qs(t,e){const i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return i*i+r*r+n*n}function na(t){const e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r}function Pa(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Z5e(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function ye(t,e){const i=e[0],r=e[1],n=e[2];let s=i*i+r*r+n*n;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s),t}function ge(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function lt(t,e,i){const r=e[0],n=e[1],s=e[2],o=i[0],a=i[1],l=i[2];return t[0]=n*l-s*a,t[1]=s*o-r*l,t[2]=r*a-n*o,t}function Xi(t,e,i,r){const n=e[0],s=e[1],o=e[2];return t[0]=n+r*(i[0]-n),t[1]=s+r*(i[1]-s),t[2]=o+r*(i[2]-o),t}function J5e(t,e,i,r,n,s){const o=s*s,a=o*(2*s-3)+1,l=o*(s-2)+s,c=o*(s-1),h=o*(3-2*s);return t[0]=e[0]*a+i[0]*l+r[0]*c+n[0]*h,t[1]=e[1]*a+i[1]*l+r[1]*c+n[1]*h,t[2]=e[2]*a+i[2]*l+r[2]*c+n[2]*h,t}function K5e(t,e,i,r,n,s){const o=1-s,a=o*o,l=s*s,c=a*o,h=3*s*a,d=3*l*o,f=l*s;return t[0]=e[0]*c+i[0]*h+r[0]*d+n[0]*f,t[1]=e[1]*c+i[1]*h+r[1]*d+n[1]*f,t[2]=e[2]*c+i[2]*h+r[2]*d+n[2]*f,t}function Q5e(t,e){e=e||1;const i=pM,r=2*i()*Math.PI,n=2*i()-1,s=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(r)*s,t[1]=Math.sin(r)*s,t[2]=n*e,t}function ke(t,e,i){const r=e[0],n=e[1],s=e[2];return t[0]=i[0]*r+i[4]*n+i[8]*s+i[12],t[1]=i[1]*r+i[5]*n+i[9]*s+i[13],t[2]=i[2]*r+i[6]*n+i[10]*s+i[14],t}function Nc(t,e,i){const r=e[0],n=e[1],s=e[2];return t[0]=r*i[0]+n*i[3]+s*i[6],t[1]=r*i[1]+n*i[4]+s*i[7],t[2]=r*i[2]+n*i[5]+s*i[8],t}function pm(t,e,i){const r=i[0],n=i[1],s=i[2],o=i[3],a=e[0],l=e[1],c=e[2];let h=n*c-s*l,d=s*a-r*c,f=r*l-n*a,m=n*f-s*d,y=s*h-r*f,_=r*d-n*h;const v=2*o;return h*=v,d*=v,f*=v,m*=2,y*=2,_*=2,t[0]=a+h+m,t[1]=l+d+y,t[2]=c+f+_,t}function eFe(t,e,i,r){const n=[],s=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],s[0]=n[0],s[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),s[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2],t}function tFe(t,e,i,r){const n=[],s=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],s[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),s[1]=n[1],s[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2],t}function iFe(t,e,i,r){const n=[],s=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],s[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),s[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),s[2]=n[2],t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2],t}function Dye(t,e){oe($$,t),oe(I$,e),ye($$,$$),ye(I$,I$);const i=ge($$,I$);return i>1?0:i<-1?Math.PI:Math.acos(i)}const $$=E(),I$=E();function rFe(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function oa(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function hx(t,e){if(t===e)return!0;const i=t[0],r=t[1],n=t[2],s=e[0],o=e[1],a=e[2],l=jo();return Math.abs(i-s)<=l*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-o)<=l*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-a)<=l*Math.max(1,Math.abs(n),Math.abs(a))}function Fy(t,e,i){const r=i[0]-e[0],n=i[1]-e[1],s=i[2]-e[2];let o=r*r+n*n+s*s;return o>0?(o=1/Math.sqrt(o),t[0]=r*o,t[1]=n*o,t[2]=s*o,t):(t[0]=0,t[1]=0,t[2]=0,t)}const go=de,nFe=b6,sFe=D5,fM=Mr,x6=qs,Cc=xe,z7=na,Uie=Object.freeze(Object.defineProperty({__proto__:null,abs:OE,add:ue,angle:Dye,bezier:K5e,ceil:Y5e,copy:oe,cross:lt,direction:Fy,dist:fM,distance:Mr,div:sFe,divide:D5,dot:ge,equals:hx,exactEquals:oa,floor:Iye,hermite:J5e,inverse:Z5e,len:Cc,length:xe,lerp:Xi,max:Lye,min:w6,mul:nFe,multiply:b6,negate:Pa,normalize:ye,random:Q5e,rotateX:eFe,rotateY:tFe,rotateZ:iFe,round:X5e,scale:re,scaleAndAdd:ql,set:ae,sign:N5,sqrDist:x6,sqrLen:z7,squaredDistance:qs,squaredLength:na,str:rFe,sub:go,subtract:de,transformMat3:Nc,transformMat4:ke,transformQuat:pm},Symbol.toStringTag,{value:"Module"}));function mp(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Gr(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t}function _Z(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function Nye(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function Fye(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function kye(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function oFe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function aFe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function lFe(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t}function cFe(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t}function uFe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function dx(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function hFe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t}function Uye(t,e){const i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return Math.sqrt(i*i+r*r+n*n+s*s)}function F5(t,e){const i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return i*i+r*r+n*n+s*s}function vZ(t){const e=t[0],i=t[1],r=t[2],n=t[3];return Math.sqrt(e*e+i*i+r*r+n*n)}function bZ(t){const e=t[0],i=t[1],r=t[2],n=t[3];return e*e+i*i+r*r+n*n}function dFe(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function pFe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function zye(t,e){const i=e[0],r=e[1],n=e[2],s=e[3];let o=i*i+r*r+n*n+s*s;return o>0&&(o=1/Math.sqrt(o),t[0]=i*o,t[1]=r*o,t[2]=n*o,t[3]=s*o),t}function Bye(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function T6(t,e,i,r){const n=e[0],s=e[1],o=e[2],a=e[3];return t[0]=n+r*(i[0]-n),t[1]=s+r*(i[1]-s),t[2]=o+r*(i[2]-o),t[3]=a+r*(i[3]-a),t}function fFe(t,e){const i=pM;let r,n,s,o,a,l;e=e||1;do r=2*i()-1,n=2*i()-1,a=r*r+n*n;while(a>=1);do s=2*i()-1,o=2*i()-1,l=s*s+o*o;while(l>=1);const c=Math.sqrt((1-a)/l);return t[0]=e*r,t[1]=e*n,t[2]=e*s*c,t[3]=e*o*c,t}function Fu(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3];return t[0]=i[0]*r+i[4]*n+i[8]*s+i[12]*o,t[1]=i[1]*r+i[5]*n+i[9]*s+i[13]*o,t[2]=i[2]*r+i[6]*n+i[10]*s+i[14]*o,t[3]=i[3]*r+i[7]*n+i[11]*s+i[15]*o,t}function mFe(t,e,i){const r=e[0],n=e[1],s=e[2],o=i[0],a=i[1],l=i[2],c=i[3],h=c*r+a*s-l*n,d=c*n+l*r-o*s,f=c*s+o*n-a*r,m=-o*r-a*n-l*s;return t[0]=h*c+m*-o+d*-l-f*-a,t[1]=d*c+m*-a+f*-o-h*-l,t[2]=f*c+m*-l+h*-a-d*-o,t[3]=e[3],t}function gFe(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function W2(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function px(t,e){const i=t[0],r=t[1],n=t[2],s=t[3],o=e[0],a=e[1],l=e[2],c=e[3],h=jo();return Math.abs(i-o)<=h*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=h*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-l)<=h*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=h*Math.max(1,Math.abs(s),Math.abs(c))}const yFe=Nye,_Fe=Fye,vFe=kye,bFe=Uye,wFe=F5,xFe=vZ,TFe=bZ,Vye=Object.freeze(Object.defineProperty({__proto__:null,add:_Z,ceil:oFe,copy:mp,dist:bFe,distance:Uye,div:vFe,divide:kye,dot:Bye,equals:px,exactEquals:W2,floor:aFe,inverse:pFe,len:xFe,length:vZ,lerp:T6,max:cFe,min:lFe,mul:_Fe,multiply:Fye,negate:dFe,normalize:zye,random:fFe,round:uFe,scale:dx,scaleAndAdd:hFe,set:Gr,sqrDist:wFe,sqrLen:TFe,squaredDistance:F5,squaredLength:bZ,str:gFe,sub:yFe,subtract:Nye,transformMat4:Fu,transformQuat:mFe},Symbol.toStringTag,{value:"Module"})),zie=new Float32Array(1);function Gye(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function _e(t,e,i){return Math.min(Math.max(t,e),i)}function fx(t){return(t&t-1)==0}function MPt(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function $Pt(t){return 10**Math.ceil(Math.LOG10E*Math.log(t))}function xt(t,e,i){return t+(e-t)*i}function IPt(t,e,i,r,n){return xt(r,n,(t-e)/(i-e))}function Dt(t){return t*Math.PI/180}function ml(t){return 180*t/Math.PI}function B7(t,e=1e-6){return(t<0?-1:1)/Math.max(Math.abs(t),e)}function Ys(t){return Math.acos(_e(t,-1,1))}function Qh(t){return Math.asin(_e(t,-1,1))}function av(t,e,i=1e-6){return t===e?!0:!Number.isFinite(t)||!Number.isFinite(e)?!1:(t>e?t-e:e-t)<=i}const k5=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function V7(t){return k5.setFloat64(0,t),k5.getBigInt64(0)}function SFe(t){return k5.setBigInt64(0,t),k5.getFloat64(0)}const ZD=BigInt("1000000"),EFe=jye(1);function jye(t){const e=V7(t=Math.abs(t)),i=SFe(e<=ZD?ZD:e-ZD);return Math.abs(t-i)}function LPt(t,e,i=EFe){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;if(i!=null&&jye(Math.min(Math.abs(t),Math.abs(e)))<i)return Math.abs(t-e)<=i;const r=V7(t),n=V7(e);return r<0!=n<0?!1:!((r<n?n-r:r-n)>ZD)}function CFe(t,e,i=1e-6){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;const r=Math.abs(t-e),n=Math.abs(t),s=Math.abs(e);if(t===0||e===0||n<1e-12&&s<1e-12){if(r>.01*i)return!1}else if(r/(n+s)>i)return!1;return!0}function AFe(t){return Hye(Math.max(-G7,Math.min(t,G7)))}function Hye(t){return zie[0]=t,zie[0]}function tP(t,e,i){const r=_e((i-t)/(e-t),0,1);return r*r*(3-2*r)}function Bie(t,e){const i=xe(t),r=Qh(t[2]/i),n=Math.atan2(t[1]/i,t[0]/i);return ae(e,i,r,n),e}function DPt(t){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[3]*t[3]+t[4]*t[4]+t[5]*t[5],r=t[6]*t[6]+t[7]*t[7]+t[8]*t[8];return!(av(e,1)&&av(i,1)&&av(r,1))}function OFe(t,e){return(t%e+e)%e}const G7=Hye(34028234663852886e22);function L$(t){return _e(NX(t),0,255)}function D$(t,e,i){return t=Number(t),isNaN(t)?i:t<e?e:t>i?i:t}function N$(t,e){const i=t.toString(16).padStart(2,"0");return e?i.substring(0,1):i}let JD=class Ro{static blendColors(e,i,r,n=new Ro){return n.r=Math.round(e.r+(i.r-e.r)*r),n.g=Math.round(e.g+(i.g-e.g)*r),n.b=Math.round(e.b+(i.b-e.b)*r),n.a=e.a+(i.a-e.a)*r,n._sanitize()}static fromRgb(e,i){const r=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(r){const n=r[2].split(/\s*,\s*/),s=r[1];if(s==="rgb"&&n.length===3||s==="rgba"&&n.length===4){const o=n[0];if(o.charAt(o.length-1)==="%"){const a=n.map(l=>2.56*parseFloat(l));return n.length===4&&(a[3]=parseFloat(n[3])),Ro.fromArray(a,i)}return Ro.fromArray(n.map(a=>parseFloat(a)),i)}if(s==="hsl"&&n.length===3||s==="hsla"&&n.length===4)return Ro.fromArray(Eye(parseFloat(n[0]),parseFloat(n[1])/100,parseFloat(n[2])/100,parseFloat(n[3])),i)}return null}static fromHex(e,i=new Ro){if(e[0]!=="#"||isNaN(+`0x${e.substring(1)}`))return null;switch(e.length){case 4:case 5:{const r=parseInt(e.substring(1,2),16),n=parseInt(e.substring(2,3),16),s=parseInt(e.substring(3,4),16),o=e.length===5?15:parseInt(e.substring(4),16);return Ro.fromArray([r+16*r,n+16*n,s+16*s,(o+16*o)/255],i)}case 7:case 9:{const r=parseInt(e.substring(1,3),16),n=parseInt(e.substring(3,5),16),s=parseInt(e.substring(5,7),16),o=e.length===7?255:parseInt(e.substring(7),16);return Ro.fromArray([r,n,s,o/255],i)}default:return null}}static fromArray(e,i=new Ro){return i._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(i.a)&&(i.a=1),i._sanitize()}static fromString(e,i){const r=Sye(e)?fZ(e):null;return r&&Ro.fromArray(r,i)||Ro.fromRgb(e,i)||Ro.fromHex(e,i)}static fromJSON(e){return e!=null?new Ro([e[0],e[1],e[2],(e[3]??255)/255]):void 0}static toUnitRGB(e){return e!=null?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return e!=null?[e.r/255,e.g/255,e.b/255,e.a!=null?e.a:1]:null}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return typeof e=="string"?Ro.fromString(e,this):Array.isArray(e)?Ro.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof Ro||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(e){const i=e?.capitalize??!1,r=e?.digits??6,n=r===3||r===4,s=r===4||r===8,o=`#${N$(this.r,n)}${N$(this.g,n)}${N$(this.b,n)}${s?N$(Math.round(255*this.a),n):""}`;return i?o.toUpperCase():o}toCss(e=!1){const i=this.r+", "+this.g+", "+this.b;return e?`rgba(${i}, ${this.a})`:`rgb(${i})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=Ro.AlphaMode.ALWAYS){const i=L$(this.r),r=L$(this.g),n=L$(this.b);return e===Ro.AlphaMode.ALWAYS||this.a!==1?[i,r,n,L$(255*this.a)]:[i,r,n]}clone(){return new Ro(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return e!=null&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=Math.round(D$(this.r,0,255)),this.g=Math.round(D$(this.g,0,255)),this.b=Math.round(D$(this.b,0,255)),this.a=D$(this.a,0,1),this}_set(e,i,r,n){this.r=e,this.g=i,this.b=r,this.a=n}};JD.prototype.declaredClass="esri.Color",function(t){var e;(e=t.AlphaMode||(t.AlphaMode={}))[e.ALWAYS=0]="ALWAYS",e[e.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(JD||(JD={}));const Pe=JD;function NPt(t){}function RFe(t){return()=>t}function nt(t,e={}){const i=t instanceof Sr?t:new Sr(t,e),r={type:e?.ignoreUnknown??1?i.apiValues:String,json:{type:i.jsonValues,read:!e?.readOnly&&{reader:i.read},write:{writer:i.write}}};return e?.readOnly!==void 0&&(r.readOnly=!!e.readOnly),e?.default!==void 0&&(r.json.default=e.default),e?.name!==void 0&&(r.json.name=e.name),e?.nonNullable!==void 0&&(r.nonNullable=e.nonNullable),p(r)}var j7;let KD=j7=class extends pe{constructor(t){super(t),this.type="none"}clone(){return new j7({type:this.type})}};u([nt({none:"none",stayAbove:"stay-above"})],KD.prototype,"type",void 0),KD=j7=u([M("esri.ground.NavigationConstraint")],KD);function S6(t){const e=NX(100*(1-t));return Math.max(0,Math.min(e,100))}function RE(t){const e=1-t/100;return Math.max(0,Math.min(e,1))}var H7;let wg=H7=class extends cM(xy){constructor(t){super(t),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new Je;const e=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&K.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},i=r=>{r.parent=null};this.addHandles([this.layers.on("after-add",r=>e(r.item)),this.layers.on("after-remove",r=>i(r.item))])}initialize(){this.when().catch(t=>{Tn(t)||K.getLogger(this).error("#load()","Failed to load ground",t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.layers.removeAll();for(const e of t)$e(e);this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set layers(t){this._set("layers",wy(t,this._get("layers")))}writeLayers(t,e,i,r){const n=[];t&&(r={...r,layerContainerType:"ground"},t.forEach(s=>{if("write"in s){const o={};RFe(s)().write(o,r)&&n.push(o)}else r?.messages&&r.messages.push(new G("layer:unsupported",`Layers (${s.title}, ${s.id}) of type '${s.declaredClass}' cannot be persisted in the ground`,{layer:s}))})),e.layers=n}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return tZ(this,t=>{t(this.layers)})}async queryElevation(t,e){await this.load({signal:e?.signal});const{ElevationQuery:i}=await ce(()=>import("./ElevationQuery-ef1bc1cd.js"),[],import.meta.url);Tt(e);const r=new i,n=this.layers.filter(Vie).toArray();return r.queryAll(n,t,e)}async createElevationSampler(t,e){await this.load({signal:e?.signal});const{ElevationQuery:i}=await ce(()=>import("./ElevationQuery-ef1bc1cd.js"),[],import.meta.url);Tt(e);const r=new i,n=this.layers.filter(Vie).toArray();return r.createSamplerAll(n,t,e)}clone(){const t={opacity:this.opacity,surfaceColor:Q(this.surfaceColor),navigationConstraint:Q(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new H7({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve()}async _loadLayersFromJSON(t,e,i){const r=e?.origin||"web-scene",n=e?.portal||null,s=e?.url||null,{populateOperationalLayers:o}=await ce(()=>import("./layersCreator-96ef29cd.js"),["./layersCreator-96ef29cd.js","./portalLayers-7401a143.js","./associatedFeatureServiceUtils-aa9f1206.js","./requestPresets-07a176e4.js"],import.meta.url);Tt(i);const a=[];if(t.layers&&Array.isArray(t.layers)){const l={context:{origin:r,url:s,portal:n,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,t.layers,l))}await Promise.allSettled(a)}};function PFe(t){return t&&"createElevationSampler"in t}function Vie(t){return t.type==="elevation"||PFe(t)}u([p({json:{read:!1}})],wg.prototype,"layers",null),u([Be("layers")],wg.prototype,"writeLayers",null),u([p({readOnly:!0})],wg.prototype,"resourceInfo",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:dr,read:{reader:RE,source:"transparency"},write:{writer:(t,e)=>{e.transparency=S6(t)},target:"transparency"}}})],wg.prototype,"opacity",void 0),u([p({type:Pe,json:{type:[dr],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],wg.prototype,"surfaceColor",void 0),u([p({type:KD,json:{write:!0}})],wg.prototype,"navigationConstraint",void 0),wg=H7=u([M("esri.Ground")],wg);const iP=wg;let SS=class extends Je{constructor(e){super(e),this.getCollections=null}initialize(){this.addHandles(nge(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=this.getCollections!=null?this.getCollections():null;if(e==null)return void this.removeAll();let i=0;for(const r of e)r!=null&&(i=this._processCollection(i,r));this.splice(i,this.length)}_createNewInstance(e){return new Je(e)}_processCollection(e,i){if(!i)return e;const r=this.itemFilterFunction??(n=>!!n);for(const n of i)if(n){if(r(n)){const s=this.indexOf(n,e);s>=0?s!==e&&this.reorder(n,e):this.add(n,e),++e}if(this.getChildrenFunction){const s=this.getChildrenFunction(n);if(Array.isArray(s))for(const o of s)e=this._processCollection(e,o);else e=this._processCollection(e,s)}}return e}};u([p()],SS.prototype,"getCollections",void 0),u([p()],SS.prototype,"getChildrenFunction",void 0),u([p()],SS.prototype,"itemFilterFunction",void 0),SS=u([M("esri.core.CollectionFlattener")],SS);const rP=SS,MFe=[["binary","application/octet-stream","bin",""]];function kPt(t,e){return Yye(e.name,t?.supportedFormats??[])!=null}function UPt(t,e){if(!t)return!1;const i=$Fe(e,t.supportedFormats??[]);return i!=null&&t.editFormats.includes(i)}function qye(t,e){return xZ(LFe(t,e))}function Wye(t,e){return xZ(Yye(t,e))}function zPt(t,e){return Xye(IFe(t,e))}function $Fe(t,e){return Wye(t.name,e)??qye(t.type,e)}function wZ(t){return[...MFe,...t]}function IFe(t,e){return wZ(e).find(i=>xZ(i)===t)}function LFe(t,e){const i=t.toLowerCase();return wZ(e).find(r=>Xye(r)===i)}function Yye(t,e){const i=t.toLowerCase();return wZ(e).find(r=>DFe(r).some(n=>i.endsWith(n)))}function xZ(t){return t?.[0]}function Xye(t){return t?.[1].toLowerCase()}function DFe(t){return t?.[2].split(",").map(e=>e.toLowerCase())??[]}function BPt(t){return t.tables?.find(e=>e.role==="assetMaps")}function NFe(t){return!(!(t&&typeof t=="object"&&"loaded"in t&&t.loaded&&A5e(t)?.operations?.supportsEditing&&"type"in t)||"editingEnabled"in t&&!R5e(t)||t.type==="scene"&&!FFe(t))}function FFe(t){const{associatedLayer:e}=t,i=e?.infoFor3D;if(!i)return!0;const{supportedFormats:r,queryFormats:n}=i,s=qye("model/gltf-binary",r)??Wye("glb",r);if(!(s!=null&&n.includes(s)))return K.getLogger("esri.layers.support.editableLayers").warnOnce(`SceneLayer (${t.title??"Untitled layer"}, ${t.id}) is not editable because it does not support GLB queries.`),!1;const o=t.spatialReference,a=e.spatialReference;if(!Fn(o,a))return K.getLogger("esri.layers.support.editableLayers").warnOnce(`SceneLayer (${t.title??"Untitled layer"}, ${t.id}) is not editable because its spatial reference (wkid:${o.wkid}) is different from its associated FeatureLayer's spatial reference (wkid:${a.wkid}).`),!1;const l=e.sourceJSON.sourceSpatialReference;return!(l!=null&&!Fn(l,a))||(K.getLogger("esri.layers.support.editableLayers").warnOnce(`SceneLayer (${t.title??"Untitled layer"}, ${t.id}) is not editable because the spatial reference of its associated FeatureLayer's service (wkid:${a.wkid}) is different from its source spatial reference (wkid:${l.wkid}).`),!1)}const kFe=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,UFe="screenUtils.toPt: input not recognized!",Zye=96;function Jn(t){return t?t/72*Zye:0}function Ku(t){return t?72*t/Zye:0}function sr(t){if(typeof t=="string"){const e=t.match(kFe);if(e){const i=Number(e[1]),r=e[3]&&e[3].toLowerCase(),n=t.charAt(0)==="-",s=r==="px"?Ku(i):i;return n?-s:s}return console.warn(UFe),null}return t}function ed(t=0,e=0){return{x:t,y:e}}function cn(t=0,e=0){return[t,e]}function Jye(t=0,e=0){return[t,e]}function aa(t=0,e=0,i=0){return[t,e,i]}function VPt(t){return t}function GPt(t){return t}function jPt(t){return t}function fp(t,e){return e?(e[0]=t.x,e[1]=t.y,e.length>2&&(e[2]=0),e):[t.x,t.y]}function E6(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function zFe(t){const e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function BFe(t,e,i,r,n,s,o,a,l,c,h,d,f,m,y,_){const v=new Float32Array(16);return v[0]=t,v[1]=e,v[2]=i,v[3]=r,v[4]=n,v[5]=s,v[6]=o,v[7]=a,v[8]=l,v[9]=c,v[10]=h,v[11]=d,v[12]=f,v[13]=m,v[14]=y,v[15]=_,v}function VFe(t,e){return new Float32Array(t,e,16)}const GFe=E6();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:GFe,clone:zFe,create:E6,createView:VFe,fromValues:BFe},Symbol.toStringTag,{value:"Module"}));function Qn(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function zm(t,e,i,r,n,s,o,a,l,c,h,d,f,m,y,_,v){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=s,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t[9]=h,t[10]=d,t[11]=f,t[12]=m,t[13]=y,t[14]=_,t[15]=v,t}function td(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Hc(t,e){if(t===e){const i=e[1],r=e[2],n=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=n,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function xC(t,e){return fs(t,e)||td(t),t}function fs(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=e[9],f=e[10],m=e[11],y=e[12],_=e[13],v=e[14],w=e[15],x=i*a-r*o,T=i*l-n*o,S=i*c-s*o,C=r*l-n*a,A=r*c-s*a,R=n*c-s*l,D=h*_-d*y,N=h*v-f*y,k=h*w-m*y,B=d*v-f*_,L=d*w-m*_,z=f*w-m*v;let j=x*z-T*L+S*B+C*k-A*N+R*D;return j?(j=1/j,t[0]=(a*z-l*L+c*B)*j,t[1]=(n*L-r*z-s*B)*j,t[2]=(_*R-v*A+w*C)*j,t[3]=(f*A-d*R-m*C)*j,t[4]=(l*k-o*z-c*N)*j,t[5]=(i*z-n*k+s*N)*j,t[6]=(v*S-y*R-w*T)*j,t[7]=(h*R-f*S+m*T)*j,t[8]=(o*L-a*k+c*D)*j,t[9]=(r*k-i*L-s*D)*j,t[10]=(y*A-_*S+w*x)*j,t[11]=(d*S-h*A-m*x)*j,t[12]=(a*N-o*B-l*D)*j,t[13]=(i*B-r*N+n*D)*j,t[14]=(_*T-y*C-v*x)*j,t[15]=(h*C-d*T+f*x)*j,t):null}function jFe(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=e[9],f=e[10],m=e[11],y=e[12],_=e[13],v=e[14],w=e[15];return t[0]=a*(f*w-m*v)-d*(l*w-c*v)+_*(l*m-c*f),t[1]=-(r*(f*w-m*v)-d*(n*w-s*v)+_*(n*m-s*f)),t[2]=r*(l*w-c*v)-a*(n*w-s*v)+_*(n*c-s*l),t[3]=-(r*(l*m-c*f)-a*(n*m-s*f)+d*(n*c-s*l)),t[4]=-(o*(f*w-m*v)-h*(l*w-c*v)+y*(l*m-c*f)),t[5]=i*(f*w-m*v)-h*(n*w-s*v)+y*(n*m-s*f),t[6]=-(i*(l*w-c*v)-o*(n*w-s*v)+y*(n*c-s*l)),t[7]=i*(l*m-c*f)-o*(n*m-s*f)+h*(n*c-s*l),t[8]=o*(d*w-m*_)-h*(a*w-c*_)+y*(a*m-c*d),t[9]=-(i*(d*w-m*_)-h*(r*w-s*_)+y*(r*m-s*d)),t[10]=i*(a*w-c*_)-o*(r*w-s*_)+y*(r*c-s*a),t[11]=-(i*(a*m-c*d)-o*(r*m-s*d)+h*(r*c-s*a)),t[12]=-(o*(d*v-f*_)-h*(a*v-l*_)+y*(a*f-l*d)),t[13]=i*(d*v-f*_)-h*(r*v-n*_)+y*(r*f-n*d),t[14]=-(i*(a*v-l*_)-o*(r*v-n*_)+y*(r*l-n*a)),t[15]=i*(a*f-l*d)-o*(r*f-n*d)+h*(r*l-n*a),t}function HFe(t){const e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=t[9],d=t[10],f=t[11],m=t[12],y=t[13],_=t[14],v=t[15];return(e*o-i*s)*(d*v-f*_)-(e*a-r*s)*(h*v-f*y)+(e*l-n*s)*(h*_-d*y)+(i*a-r*o)*(c*v-f*m)-(i*l-n*o)*(c*_-d*m)+(r*l-n*a)*(c*y-h*m)}function qi(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],f=e[9],m=e[10],y=e[11],_=e[12],v=e[13],w=e[14],x=e[15];let T=i[0],S=i[1],C=i[2],A=i[3];return t[0]=T*r+S*a+C*d+A*_,t[1]=T*n+S*l+C*f+A*v,t[2]=T*s+S*c+C*m+A*w,t[3]=T*o+S*h+C*y+A*x,T=i[4],S=i[5],C=i[6],A=i[7],t[4]=T*r+S*a+C*d+A*_,t[5]=T*n+S*l+C*f+A*v,t[6]=T*s+S*c+C*m+A*w,t[7]=T*o+S*h+C*y+A*x,T=i[8],S=i[9],C=i[10],A=i[11],t[8]=T*r+S*a+C*d+A*_,t[9]=T*n+S*l+C*f+A*v,t[10]=T*s+S*c+C*m+A*w,t[11]=T*o+S*h+C*y+A*x,T=i[12],S=i[13],C=i[14],A=i[15],t[12]=T*r+S*a+C*d+A*_,t[13]=T*n+S*l+C*f+A*v,t[14]=T*s+S*c+C*m+A*w,t[15]=T*o+S*h+C*y+A*x,t}function Kl(t,e,i){const r=i[0],n=i[1],s=i[2];if(e===t)t[12]=e[0]*r+e[4]*n+e[8]*s+e[12],t[13]=e[1]*r+e[5]*n+e[9]*s+e[13],t[14]=e[2]*r+e[6]*n+e[10]*s+e[14],t[15]=e[3]*r+e[7]*n+e[11]*s+e[15];else{const o=e[0],a=e[1],l=e[2],c=e[3],h=e[4],d=e[5],f=e[6],m=e[7],y=e[8],_=e[9],v=e[10],w=e[11];t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=h,t[5]=d,t[6]=f,t[7]=m,t[8]=y,t[9]=_,t[10]=v,t[11]=w,t[12]=o*r+h*n+y*s+e[12],t[13]=a*r+d*n+_*s+e[13],t[14]=l*r+f*n+v*s+e[14],t[15]=c*r+m*n+w*s+e[15]}return t}function mM(t,e,i){const r=i[0],n=i[1],s=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Fc(t,e,i,r){let n,s,o,a,l,c,h,d,f,m,y,_,v,w,x,T,S,C,A,R,D,N,k,B,L=r[0],z=r[1],j=r[2],H=Math.sqrt(L*L+z*z+j*j);return H<jo()?null:(H=1/H,L*=H,z*=H,j*=H,n=Math.sin(i),s=Math.cos(i),o=1-s,a=e[0],l=e[1],c=e[2],h=e[3],d=e[4],f=e[5],m=e[6],y=e[7],_=e[8],v=e[9],w=e[10],x=e[11],T=L*L*o+s,S=z*L*o+j*n,C=j*L*o-z*n,A=L*z*o-j*n,R=z*z*o+s,D=j*z*o+L*n,N=L*j*o+z*n,k=z*j*o-L*n,B=j*j*o+s,t[0]=a*T+d*S+_*C,t[1]=l*T+f*S+v*C,t[2]=c*T+m*S+w*C,t[3]=h*T+y*S+x*C,t[4]=a*A+d*R+_*D,t[5]=l*A+f*R+v*D,t[6]=c*A+m*R+w*D,t[7]=h*A+y*R+x*D,t[8]=a*N+d*k+_*B,t[9]=l*N+f*k+v*B,t[10]=c*N+m*k+w*B,t[11]=h*N+y*k+x*B,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function PE(t,e,i){const r=Math.sin(i),n=Math.cos(i),s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],d=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*n+c*r,t[5]=o*n+h*r,t[6]=a*n+d*r,t[7]=l*n+f*r,t[8]=c*n-s*r,t[9]=h*n-o*r,t[10]=d*n-a*r,t[11]=f*n-l*r,t}function C6(t,e,i){const r=Math.sin(i),n=Math.cos(i),s=e[0],o=e[1],a=e[2],l=e[3],c=e[8],h=e[9],d=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n-c*r,t[1]=o*n-h*r,t[2]=a*n-d*r,t[3]=l*n-f*r,t[8]=s*r+c*n,t[9]=o*r+h*n,t[10]=a*r+d*n,t[11]=l*r+f*n,t}function ME(t,e,i){const r=Math.sin(i),n=Math.cos(i),s=e[0],o=e[1],a=e[2],l=e[3],c=e[4],h=e[5],d=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n+c*r,t[1]=o*n+h*r,t[2]=a*n+d*r,t[3]=l*n+f*r,t[4]=c*n-s*r,t[5]=h*n-o*r,t[6]=d*n-a*r,t[7]=f*n-l*r,t}function gM(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function qFe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Qu(t,e,i){if(e===0)return td(t);let r,n,s,o=i[0],a=i[1],l=i[2],c=Math.sqrt(o*o+a*a+l*l);return c<jo()?null:(c=1/c,o*=c,a*=c,l*=c,r=Math.sin(e),n=Math.cos(e),s=1-n,t[0]=o*o*s+n,t[1]=a*o*s+l*r,t[2]=l*o*s-a*r,t[3]=0,t[4]=o*a*s-l*r,t[5]=a*a*s+n,t[6]=l*a*s+o*r,t[7]=0,t[8]=o*l*s+a*r,t[9]=a*l*s-o*r,t[10]=l*l*s+n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function Kye(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function WFe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Qye(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function e0e(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=r+r,l=n+n,c=s+s,h=r*a,d=r*l,f=r*c,m=n*l,y=n*c,_=s*c,v=o*a,w=o*l,x=o*c;return t[0]=1-(m+_),t[1]=d+x,t[2]=f-w,t[3]=0,t[4]=d-x,t[5]=1-(h+_),t[6]=y+v,t[7]=0,t[8]=f+w,t[9]=y-v,t[10]=1-(h+m),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function YFe(t,e){const i=XFe,r=-e[0],n=-e[1],s=-e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=r*r+n*n+s*s+o*o;return d>0?(i[0]=2*(a*o+h*r+l*s-c*n)/d,i[1]=2*(l*o+h*n+c*r-a*s)/d,i[2]=2*(c*o+h*s+a*n-l*r)/d):(i[0]=2*(a*o+h*r+l*s-c*n),i[1]=2*(l*o+h*n+c*r-a*s),i[2]=2*(c*o+h*s+a*n-l*r)),e0e(t,e,i),t}const XFe=E();function U5(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function t0e(t,e){const i=e[0],r=e[1],n=e[2],s=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10];return t[0]=Math.sqrt(i*i+r*r+n*n),t[1]=Math.sqrt(s*s+o*o+a*a),t[2]=Math.sqrt(l*l+c*c+h*h),t}function ZFe(t,e){const i=e[0]+e[5]+e[10];let r=0;return i>0?(r=2*Math.sqrt(i+1),t[3]=.25*r,t[0]=(e[6]-e[9])/r,t[1]=(e[8]-e[2])/r,t[2]=(e[1]-e[4])/r):e[0]>e[5]&&e[0]>e[10]?(r=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/r,t[0]=.25*r,t[1]=(e[1]+e[4])/r,t[2]=(e[8]+e[2])/r):e[5]>e[10]?(r=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/r,t[0]=(e[1]+e[4])/r,t[1]=.25*r,t[2]=(e[6]+e[9])/r):(r=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/r,t[0]=(e[8]+e[2])/r,t[1]=(e[6]+e[9])/r,t[2]=.25*r),t}function i0e(t,e,i,r){const n=e[0],s=e[1],o=e[2],a=e[3],l=n+n,c=s+s,h=o+o,d=n*l,f=n*c,m=n*h,y=s*c,_=s*h,v=o*h,w=a*l,x=a*c,T=a*h,S=r[0],C=r[1],A=r[2];return t[0]=(1-(y+v))*S,t[1]=(f+T)*S,t[2]=(m-x)*S,t[3]=0,t[4]=(f-T)*C,t[5]=(1-(d+v))*C,t[6]=(_+w)*C,t[7]=0,t[8]=(m+x)*A,t[9]=(_-w)*A,t[10]=(1-(d+y))*A,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function JFe(t,e,i,r,n){const s=e[0],o=e[1],a=e[2],l=e[3],c=s+s,h=o+o,d=a+a,f=s*c,m=s*h,y=s*d,_=o*h,v=o*d,w=a*d,x=l*c,T=l*h,S=l*d,C=r[0],A=r[1],R=r[2],D=n[0],N=n[1],k=n[2],B=(1-(_+w))*C,L=(m+S)*C,z=(y-T)*C,j=(m-S)*A,H=(1-(f+w))*A,X=(v+x)*A,P=(y+T)*R,I=(v-x)*R,V=(1-(f+_))*R;return t[0]=B,t[1]=L,t[2]=z,t[3]=0,t[4]=j,t[5]=H,t[6]=X,t[7]=0,t[8]=P,t[9]=I,t[10]=V,t[11]=0,t[12]=i[0]+D-(B*D+j*N+P*k),t[13]=i[1]+N-(L*D+H*N+I*k),t[14]=i[2]+k-(z*D+X*N+V*k),t[15]=1,t}function KFe(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=i+i,a=r+r,l=n+n,c=i*o,h=r*o,d=r*a,f=n*o,m=n*a,y=n*l,_=s*o,v=s*a,w=s*l;return t[0]=1-d-y,t[1]=h+w,t[2]=f-v,t[3]=0,t[4]=h-w,t[5]=1-c-y,t[6]=m+_,t[7]=0,t[8]=f+v,t[9]=m-_,t[10]=1-c-d,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function r0e(t,e,i,r,n,s,o){const a=1/(i-e),l=1/(n-r),c=1/(s-o);return t[0]=2*s*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s*l,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(n+r)*l,t[10]=(o+s)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*c,t[15]=0,t}function QFe(t,e,i,r,n){const s=1/Math.tan(e/2);let o;return t[0]=s/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0?(o=1/(r-n),t[10]=(n+r)*o,t[14]=2*n*r*o):(t[10]=-1,t[14]=-2*r),t}function eke(t,e,i,r){const n=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(n+s);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-a)*l*.5,t[9]=(n-s)*c*.5,t[10]=r/(i-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*i/(i-r),t[15]=0,t}function n0e(t,e,i,r,n,s,o){const a=1/(e-i),l=1/(r-n),c=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*a,t[13]=(n+r)*l,t[14]=(o+s)*c,t[15]=1,t}function A6(t,e,i,r){const n=e[0],s=e[1],o=e[2];let a=n-i[0],l=s-i[1],c=o-i[2];const h=jo();if(Math.abs(a)<h&&Math.abs(l)<h&&Math.abs(c)<h)return void td(t);let d=1/Math.sqrt(a*a+l*l+c*c);a*=d,l*=d,c*=d;const f=r[0],m=r[1],y=r[2];let _=m*c-y*l,v=y*a-f*c,w=f*l-m*a;d=Math.sqrt(_*_+v*v+w*w),d?(d=1/d,_*=d,v*=d,w*=d):(_=0,v=0,w=0);let x=l*w-c*v,T=c*_-a*w,S=a*v-l*_;d=Math.sqrt(x*x+T*T+S*S),d?(d=1/d,x*=d,T*=d,S*=d):(x=0,T=0,S=0),t[0]=_,t[1]=x,t[2]=a,t[3]=0,t[4]=v,t[5]=T,t[6]=l,t[7]=0,t[8]=w,t[9]=S,t[10]=c,t[11]=0,t[12]=-(_*n+v*s+w*o),t[13]=-(x*n+T*s+S*o),t[14]=-(a*n+l*s+c*o),t[15]=1}function s0e(t,e,i,r){const n=e[0],s=e[1],o=e[2],a=r[0],l=r[1],c=r[2];let h=n-i[0],d=s-i[1],f=o-i[2],m=h*h+d*d+f*f;m>0&&(m=1/Math.sqrt(m),h*=m,d*=m,f*=m);let y=l*f-c*d,_=c*h-a*f,v=a*d-l*h;return m=y*y+_*_+v*v,m>0&&(m=1/Math.sqrt(m),y*=m,_*=m,v*=m),t[0]=y,t[1]=_,t[2]=v,t[3]=0,t[4]=d*v-f*_,t[5]=f*y-h*v,t[6]=h*_-d*y,t[7]=0,t[8]=h,t[9]=d,t[10]=f,t[11]=0,t[12]=n,t[13]=s,t[14]=o,t[15]=1,t}function tke(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function ike(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2+t[9]**2+t[10]**2+t[11]**2+t[12]**2+t[13]**2+t[14]**2+t[15]**2)}function rke(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t}function o0e(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}function nke(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t}function ske(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t[9]=e[9]+i[9]*r,t[10]=e[10]+i[10]*r,t[11]=e[11]+i[11]*r,t[12]=e[12]+i[12]*r,t[13]=e[13]+i[13]*r,t[14]=e[14]+i[14]*r,t[15]=e[15]+i[15]*r,t}function TZ(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function O6(t,e){if(t===e)return!0;const i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],d=t[9],f=t[10],m=t[11],y=t[12],_=t[13],v=t[14],w=t[15],x=e[0],T=e[1],S=e[2],C=e[3],A=e[4],R=e[5],D=e[6],N=e[7],k=e[8],B=e[9],L=e[10],z=e[11],j=e[12],H=e[13],X=e[14],P=e[15],I=jo();return Math.abs(i-x)<=I*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(r-T)<=I*Math.max(1,Math.abs(r),Math.abs(T))&&Math.abs(n-S)<=I*Math.max(1,Math.abs(n),Math.abs(S))&&Math.abs(s-C)<=I*Math.max(1,Math.abs(s),Math.abs(C))&&Math.abs(o-A)<=I*Math.max(1,Math.abs(o),Math.abs(A))&&Math.abs(a-R)<=I*Math.max(1,Math.abs(a),Math.abs(R))&&Math.abs(l-D)<=I*Math.max(1,Math.abs(l),Math.abs(D))&&Math.abs(c-N)<=I*Math.max(1,Math.abs(c),Math.abs(N))&&Math.abs(h-k)<=I*Math.max(1,Math.abs(h),Math.abs(k))&&Math.abs(d-B)<=I*Math.max(1,Math.abs(d),Math.abs(B))&&Math.abs(f-L)<=I*Math.max(1,Math.abs(f),Math.abs(L))&&Math.abs(m-z)<=I*Math.max(1,Math.abs(m),Math.abs(z))&&Math.abs(y-j)<=I*Math.max(1,Math.abs(y),Math.abs(j))&&Math.abs(_-H)<=I*Math.max(1,Math.abs(_),Math.abs(H))&&Math.abs(v-X)<=I*Math.max(1,Math.abs(v),Math.abs(X))&&Math.abs(w-P)<=I*Math.max(1,Math.abs(w),Math.abs(P))}function SZ(t){const e=jo(),i=t[0],r=t[1],n=t[2],s=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10];return Math.abs(1-(i*i+s*s+l*l))<=e&&Math.abs(1-(r*r+o*o+c*c))<=e&&Math.abs(1-(n*n+a*a+h*h))<=e}function R6(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[8]===0&&t[9]===0&&t[10]===1}const oke=qi,ake=o0e;Object.freeze(Object.defineProperty({__proto__:null,add:rke,adjoint:jFe,copy:Qn,determinant:HFe,equals:O6,exactEquals:TZ,frob:ike,fromQuat:KFe,fromQuat2:YFe,fromRotation:Qu,fromRotationTranslation:e0e,fromRotationTranslationScale:i0e,fromRotationTranslationScaleOrigin:JFe,fromScaling:qFe,fromTranslation:gM,fromXRotation:Kye,fromYRotation:WFe,fromZRotation:Qye,frustum:r0e,getRotation:ZFe,getScaling:t0e,getTranslation:U5,hasIdentityRotation:R6,identity:td,invert:fs,invertOrIdentity:xC,isOrthoNormal:SZ,lookAt:A6,mul:oke,multiply:qi,multiplyScalar:nke,multiplyScalarAndAdd:ske,ortho:n0e,perspective:QFe,perspectiveFromFieldOfView:eke,rotate:Fc,rotateX:PE,rotateY:C6,rotateZ:ME,scale:mM,set:zm,str:tke,sub:ake,subtract:o0e,targetTo:s0e,translate:Kl,transpose:Hc},Symbol.toStringTag,{value:"Module"}));const lke=(t,e)=>{const i=zm(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return Hc(i,i)},cke=(t,e)=>{const i=zm(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return Hc(i,i)},uke=(t,e)=>{const i=1-e,r=zm(t,.2126+.7874*i,.7152-.7152*i,.0722-.0722*i,0,.2126-.2126*i,.7152+.2848*i,.0722-.0722*i,0,.2126-.2126*i,.7152-.7152*i,.0722+.9278*i,0,0,0,0,1);return Hc(r,r)},hke=(t,e)=>{const i=Math.sin(e*Math.PI/180),r=Math.cos(e*Math.PI/180),n=zm(t,.213+.787*r-.213*i,.715-.715*r-.715*i,.072-.072*r+.928*i,0,.213-.213*r+.143*i,.715+.285*r+.14*i,.072-.072*r-.283*i,0,.213-.213*r-.787*i,.715-.715*r+.715*i,.072+.928*r+.072*i,0,0,0,0,1);return Hc(n,n)},dke=(t,e)=>{const i=1-2*e,r=zm(t,i,0,0,e,0,i,0,e,0,0,i,e,0,0,0,1);return Hc(r,r)},pke=(t,e)=>{const i=zm(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return Hc(i,i)},fke=(t,e)=>{const i=1-e,r=zm(t,.393+.607*i,.769-.769*i,.189-.189*i,0,.349-.349*i,.686+.314*i,.168-.168*i,0,.272-.272*i,.534-.534*i,.131+.869*i,0,0,0,0,1);return Hc(r,r)};let a0e=class l0e{constructor(e,i,r){this.strength=e,this.radius=i,this.threshold=r,this.type="bloom"}interpolate(e,i,r){this.strength=Rc(e.strength,i.strength,r),this.radius=Rc(e.radius,i.radius,r),this.threshold=Rc(e.threshold,i.threshold,r)}clone(){return new l0e(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:qO(this.radius),strength:this.strength,threshold:this.threshold}}},c0e=class u0e{constructor(e){this.radius=e,this.type="blur"}interpolate(e,i,r){this.radius=Math.round(Rc(e.radius,i.radius,r))}clone(){return new u0e(this.radius)}toJSON(){return{type:"blur",radius:qO(this.radius)}}},q7=class h0e{constructor(e,i){this.type=e,this.amount=i,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.amount=Rc(e.amount,i.amount,r),this._updateMatrix()}clone(){return new h0e(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||E6();switch(this.type){case"brightness":this._colorMatrix=lke(e,this.amount);break;case"contrast":this._colorMatrix=cke(e,this.amount);break;case"grayscale":this._colorMatrix=uke(e,this.amount);break;case"invert":this._colorMatrix=dke(e,this.amount);break;case"saturate":this._colorMatrix=pke(e,this.amount);break;case"sepia":this._colorMatrix=fke(e,this.amount)}}},d0e=class p0e{constructor(e,i,r,n){this.offsetX=e,this.offsetY=i,this.blurRadius=r,this.color=n,this.type="drop-shadow"}interpolate(e,i,r){this.offsetX=Rc(e.offsetX,i.offsetX,r),this.offsetY=Rc(e.offsetY,i.offsetY,r),this.blurRadius=Rc(e.blurRadius,i.blurRadius,r),this.color[0]=Math.round(Rc(e.color[0],i.color[0],r)),this.color[1]=Math.round(Rc(e.color[1],i.color[1],r)),this.color[2]=Math.round(Rc(e.color[2],i.color[2],r)),this.color[3]=Rc(e.color[3],i.color[3],r)}clone(){return new p0e(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:qO(this.offsetX),yoffset:qO(this.offsetY),blurRadius:qO(this.blurRadius),color:e}}},f0e=class m0e{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.angle=Rc(e.angle,i.angle,r),this._updateMatrix()}clone(){return new m0e(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||E6();this._colorMatrix=hke(e,this.angle)}},g0e=class y0e{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,i,r){this.amount=Rc(e.amount,i.amount,r)}clone(){return new y0e(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function Rc(t,e,i){return t+(e-t)*i}function qO(t){return Math.round(1e3*Ku(t))/1e3}function mke(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new q7(t.type,0);case"saturate":case"brightness":case"contrast":return new q7(t.type,1);case"opacity":return new g0e(1);case"hue-rotate":return new f0e(0);case"blur":return new c0e(0);case"drop-shadow":return new d0e(0,0,0,[...fZ("transparent")]);case"bloom":return new a0e(0,0,1)}}function gke(t,e){const i=t.length>e.length?t:e;return(t.length>e.length?e:t).every((r,n)=>r.type===i[n].type)}function yke(t,e){const i=t.length>e.length?t:e,r=t.length>e.length?e:t;for(let n=r.length;n<i.length;n++)r.push(mke(i[n]))}function _ke(t){const e=t[0];return!!e&&"type"in e}function vke(t,e){return JSON.stringify(t??null)===JSON.stringify(e??null)}const Gie=K.getLogger("esri.support.basemapUtils");function bke(){return{}}function wke(t){for(const e in t){const i=t[e];$e(i),delete t[e]}}function EZ(t,e){let i;if(typeof t=="string"){const r=t in U7,n=!r&&t.includes("/");if(!r&&!n){const s=Object.entries(U7).filter(([o,a])=>Di.apiKey&&!a.classic||!Di.apiKey&&(a.classic||a.is3d)).map(([o])=>`"${o}"`).sort().join(", ");return Gie.warn(`Unable to find basemap definition for: ${t}. Try one of these: ${s}`),null}e&&(i=e[t]),i||(i=r?q2.fromId(t):new q2({style:{id:t}}),e&&(e[t]=i))}else i=as(q2,t);return i?.destroyed&&(Gie.warn("The provided basemap is already destroyed",{basemap:i}),i=null),i}function HPt(t,e){return t.basemap?.referenceLayers?.some(i=>i.uid===e)||t.basemap?.baseLayers?.some(i=>i.uid===e)}function xke(t,e=null){const i=EZ(t);if(!i)return null;const r=i.clone();return e&&(r.baseLayers=jie(r.baseLayers,e.baseLayers),r.referenceLayers=jie(r.referenceLayers,e.referenceLayers)),r}function jie(t,e){const i=new Je;return t.forEach(r=>{const n=e.find(s=>s.type!=="scene"&&Eke(Wie(r),Wie(s)))||r;i.includes(n)?i.push(r):i.push(n)}),i}function Hie(t){return!!t?.baseLayers.concat(t.referenceLayers).some(Tke)}function Tke(t){if(qie(t.url))return!0;if(t.type==="vector-tile")for(const e in t.sourceNameToSource){const i=t.sourceNameToSource[e];if(qie(i?.sourceUrl))return!0}return!1}const Ske=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function qie(t){if(!t)return!1;const e=new Ic(ul(t));return!!e.authority&&Ske.test(e.authority)}function Wie(t){return{type:t.type,effect:"effect"in t?t.effect:void 0,url:Cke("urlTemplate"in t&&t.urlTemplate||t.url||"styleUrl"in t&&t.styleUrl||""),minScale:"minScale"in t&&t.minScale!=null?t.minScale:0,maxScale:"maxScale"in t&&t.maxScale!=null?t.maxScale:0,opacity:t.opacity!=null?t.opacity:1,visible:t.visible==null||!!t.visible,sublayers:t.type!=="map-image"&&t.type!=="wms"||t.sublayers==null?void 0:t.sublayers?.map(e=>({id:e.id,visible:e.visible})),activeLayerId:t.type==="wmts"?t.activeLayer?.id:void 0}}function Eke(t,e){if(t.type!==e.type||t.url!==e.url||t.minScale!==e.minScale||t.maxScale!==e.maxScale||t.visible!==e.visible||t.opacity!==e.opacity||!vke(t.effect,e.effect))return!1;if(t.activeLayerId!=null||e.activeLayerId!=null)return t.activeLayerId===e.activeLayerId;if(t.sublayers!=null||e.sublayers!=null){if(t.sublayers==null||e.sublayers==null||t.sublayers.length!==e.sublayers.length)return!1;for(let i=0;i<t.sublayers.length;i++){const r=t.sublayers.at(i),n=e.sublayers.at(i);if(r?.id!==n?.id||r?.visible!==n?.visible)return!1}}return!0}function Cke(t){return t?Bu(t).replace(/^\s*https?:/i,"").toLowerCase():""}function Ake(t){return new rP({getCollections:()=>[t.tables,t.layers],getChildrenFunction:e=>{const i=[];return"tables"in e&&i.push(e.tables),"layers"in e&&i.push(e.layers),i},itemFilterFunction:e=>{const i=e.parent;return!!i&&"tables"in i&&i.tables.includes(e)}})}function H8(t){for(const e of t.values())e?.destroy();t.clear()}const Yie={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function Oke(t){let e=null;if(typeof t=="string")if(t in Yie){const i=Yie[t];e=new iP({resourceInfo:{data:{layers:[i]}}})}else K.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`);else e=as(iP,t);return e}function $E(t,e,i=!1){let{hasM:r,hasZ:n}=t;Array.isArray(e)?e.length!==4||r||n?e.length===3&&i&&!r?(n=!0,r=!1):e.length===3&&r&&n&&(r=!1,n=!1):(r=!0,n=!0):(n=!n&&e.hasZ&&(!r||e.hasM),r=!r&&e.hasM&&(!n||e.hasZ)),t.hasZ=n,t.hasM=r}var W7;function Xie(t){return(e,i)=>e==null?i:i==null?e:t(e,i)}function Rke(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let Y0=W7=class extends Zv{constructor(...t){super(...t),this.points=[],this.type="multipoint"}normalizeCtorArgs(t,e){if(!t&&!e)return{};const i={};Array.isArray(t)?(i.points=t,i.spatialReference=e):Rke(t)?i.spatialReference=t:(t.points&&(i.points=t.points),t.spatialReference&&(i.spatialReference=t.spatialReference),t.hasZ&&(i.hasZ=t.hasZ),t.hasM&&(i.hasM=t.hasM));const r=i.points?.[0];return r&&(i.hasZ===void 0&&i.hasM===void 0?(i.hasZ=r.length>2,i.hasM=!1):i.hasZ===void 0?i.hasZ=r.length>3:i.hasM===void 0&&(i.hasM=r.length>3)),i}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const t=this.points;if(!t.length)return null;const e=new zi,i=this.hasZ,r=this.hasM,n=i?3:2,s=t[0],o=Xie(Math.min),a=Xie(Math.max);let l,c,h,d,[f,m]=s,[y,_]=s;for(let v=0,w=t.length;v<w;v++){const x=t[v],[T,S]=x;if(f=o(f,T),m=o(m,S),y=a(y,T),_=a(_,S),i&&x.length>2){const C=x[2];l=o(l,C),h=a(h,C)}if(r&&x.length>n){const C=x[n];c=o(c,C),d=a(d,C)}}return e.xmin=f,e.ymin=m,e.xmax=y,e.ymax=_,e.spatialReference=this.spatialReference,i?(e.zmin=l,e.zmax=h):(e.zmin=void 0,e.zmax=void 0),r?(e.mmin=c,e.mmax=d):(e.mmin=void 0,e.mmax=void 0),e}writePoints(t,e){e.points=Q(this.points)}addPoint(t){return $E(this,t),Array.isArray(t)?this.points.push(t):this.points.push(t.toArray()),this.notifyChange("points"),this}clone(){const t={points:Q(this.points),spatialReference:this.spatialReference};return this.hasZ&&(t.hasZ=!0),this.hasM&&(t.hasM=!0),new W7(t)}getPoint(t){if(!this._validateInputs(t))return null;const e=this.points[t],i={x:e[0],y:e[1],spatialReference:this.spatialReference};let r=2;return this.hasZ&&(i.z=e[2],r=3),this.hasM&&(i.m=e[r]),new ut(i)}removePoint(t){if(!this._validateInputs(t))return null;const e=new ut(this.points.splice(t,1)[0],this.spatialReference);return this.notifyChange("points"),e}setPoint(t,e){return this._validateInputs(t)?($E(this,e),Array.isArray(e)||(e=e.toArray()),this.points[t]=e,this.notifyChange("points"),this):this}toJSON(t){return this.write({},t)}_validateInputs(t){return t!=null&&t>=0&&t<this.points.length}};u([p({readOnly:!0})],Y0.prototype,"cache",null),u([p()],Y0.prototype,"extent",null),u([p({type:[[Number]],json:{write:{isRequired:!0}}})],Y0.prototype,"points",void 0),u([Be("points")],Y0.prototype,"writePoints",null),Y0=W7=u([M("esri.geometry.Multipoint")],Y0),Y0.prototype.toJSON.isDefaultToJSON=!0;const TC=Y0;function qPt(t){const e=[];for(t.reset();t.nextPath();){const i=[];for(;t.nextPoint();)i.push([t.x,t.y]);e.push(i)}return t.reset(),e}function Pke(t){const e=[];for(;t.nextPoint();)e.push([t.x,t.y]);return t.seekPathStart(),e}var an;(function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"})(an||(an={}));function P6(t,e){const i=e[0]-t[0],r=e[1]-t[1];if(t.length>2&&e.length>2){const n=t[2]-e[2];return Math.sqrt(i*i+r*r+n*n)}return Math.sqrt(i*i+r*r)}function _0e(t,e,i){const r=t[0]+i*(e[0]-t[0]),n=t[1]+i*(e[1]-t[1]);return t.length>2&&e.length>2?[r,n,t[2]+i*(e[2]-t[2])]:[r,n]}function WPt(t,e,i,r){const[n,s]=e,[o,a]=i,[l,c]=r,h=l-o,d=c-a,f=h*h+d*d,m=(n-o)*h+(s-a)*d,y=Math.min(1,Math.max(0,m/f));return t[0]=o+h*y,t[1]=a+d*y,t}function v0e(t,e){return _0e(t,e,.5)}function b0e(t){const e=t.length;let i=0;for(let r=0;r<e-1;++r)i+=P6(t[r],t[r+1]);return i}function w0e(t,e){if(e<=0)return t[0];const i=t.length;let r=0;for(let n=0;n<i-1;++n){const s=P6(t[n],t[n+1]);if(e-r<s){const o=(e-r)/s;return _0e(t[n],t[n+1],o)}r+=s}return t[i-1]}function QD(t,e=an.X,i=an.Y){let r=0;const n=t.length;let s=t[0];for(let o=0;o<n-1;o++){const a=t[o+1];r+=(a[e]-s[e])*(a[i]+s[i]),s=a}return r>=0}function Mke(t){const e=t.length;return e>2&&vy(t[0],t[e-1])}function YPt(t){if("rings"in t)for(const e of t.rings)Mke(e)||e.push(e[0].slice())}function XPt(t){return t?t.hasZ?[t.xmax-t.xmin/2,t.ymax-t.ymin/2,t.zmax-t.zmin/2]:[t.xmax-t.xmin/2,t.ymax-t.ymin/2]:null}function $ke(t){return t?x0e(t.rings,t.hasZ??!1):null}function x0e(t,e){if(!t?.length)return null;const i=[],r=[],n=e?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let s=0,o=t.length;s<o;s++){const a=T0e(t[s],e,n);a&&r.push(a)}if(r.sort((s,o)=>{let a=s[2]-o[2];return a===0&&e&&(a=s[4]-o[4]),a}),r.length&&(i[0]=r[0][0],i[1]=r[0][1],e&&(i[2]=r[0][3]),(i[0]<n[0]||i[0]>n[1]||i[1]<n[2]||i[1]>n[3]||e&&(i[2]<n[4]||i[2]>n[5]))&&(i.length=0)),!i.length){const s=t[0]&&t[0].length?Ike(t[0],e):null;if(!s)return null;i[0]=s[0],i[1]=s[1],e&&s.length>2&&(i[2]=s[2])}return i}function T0e(t,e,i){let r=0,n=0,s=0,o=0,a=0;const l=t.length?t[0][0]:0,c=t.length?t[0][1]:0,h=t.length&&e?t[0][2]:0;for(let f=0;f<t.length;f++){const m=t[f],y=t[(f+1)%t.length],[_,v,w]=m,x=_-l,T=v-c,[S,C,A]=y,R=S-l,D=C-c,N=x*D-R*T;if(o+=N,r+=(x+R)*N,n+=(T+D)*N,e&&m.length>2&&y.length>2){const k=w-h,B=A-h,L=x*B-R*k;s+=(k+B)*L,a+=L}_<i[0]&&(i[0]=_),_>i[1]&&(i[1]=_),v<i[2]&&(i[2]=v),v>i[3]&&(i[3]=v),e&&(w<i[4]&&(i[4]=w),w>i[5]&&(i[5]=w))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const d=[r/(6*o)+l,n/(6*o)+c,o];return e&&(i[4]===i[5]||a===0?(d[3]=(i[4]+i[5])/2,d[4]=0):(d[3]=s/(6*a)+h,d[4]=a)),d}function ZPt(t,e){let i=0,r=0,n=0;t.nextPoint();const s=t.pathSize?t.x:0,o=t.pathSize?t.y:0;for(let a=0;a<t.pathSize;a++){t.seekInPath(a);const l=[t.x,t.y];t.seekInPath((a+1)%t.pathSize);const c=[t.x,t.y],[h,d]=l,f=h-s,m=d-o,[y,_]=c,v=y-s,w=_-o,x=f*w-v*m;n+=x,i+=(f+v)*x,r+=(m+w)*x,h<e[0]&&(e[0]=h),h>e[1]&&(e[1]=h),d<e[2]&&(e[2]=d),d>e[3]&&(e[3]=d)}return n>0&&(n*=-1),n?(n*=.5,[i/(6*n)+s,r/(6*n)+o,n]):null}function Ike(t,e){const i=e?[0,0,0]:[0,0],r=e?[0,0,0]:[0,0];let n=0,s=0,o=0,a=0;for(let l=0,c=t.length;l<c-1;l++){const h=t[l],d=t[l+1];if(h&&d){i[0]=h[0],i[1]=h[1],r[0]=d[0],r[1]=d[1],e&&h.length>2&&d.length>2&&(i[2]=h[2],r[2]=d[2]);const f=P6(i,r);if(f){n+=f;const m=v0e(h,d);s+=f*m[0],o+=f*m[1],e&&m.length>2&&(a+=f*m[2])}}}return n>0?e?[s/n,o/n,a/n]:[s/n,o/n]:t.length?t[0]:null}function Lke(t){const{hasZ:e,totalSize:i}=t;if(i===0)return null;const r=[],n=[],s=e?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(t.reset();t.nextPath();){const o=T0e(Pke(t),t.hasZ,s);o&&n.push(o)}if(n.sort((o,a)=>{let l=o[2]-a[2];return l===0&&e&&(l=o[4]-a[4]),l}),n.length&&(r[0]=n[0][0],r[1]=n[0][1],e&&(r[2]=n[0][3]),(r[0]<s[0]||r[0]>s[1]||r[1]<s[2]||r[1]>s[3]||e&&(r[2]<s[4]||r[2]>s[5]))&&(r.length=0)),!r.length){t.reset(),t.nextPath();const o=t.pathSize?Dke(t):null;if(!o)return null;r[0]=o[0],r[1]=o[1],e&&o.length>2&&(r[2]=o[2])}return r}function Dke(t){const{hasZ:e}=t,i=e?[0,0,0]:[0,0],r=e?[0,0,0]:[0,0];let n=0,s=0,o=0,a=0;if(t.nextPoint()){let l=t.x,c=t.y,h=t.z;for(;t.nextPoint();){const d=t.x,f=t.y,m=t.z;i[0]=l,i[1]=c,r[0]=d,r[1]=f,e&&(i[2]=h,r[2]=m);const y=P6(i,r);if(y){n+=y;const _=v0e(i,r);s+=y*_[0],o+=y*_[1],e&&_.length>2&&(a+=y*_[2])}l=d,c=f,h=m}}return n>0?e?[s/n,o/n,a/n]:[s/n,o/n]:t.pathSize?(t.seekPathStart(),t.nextPoint(),[t.x,t.y]):null}const Nke=1e-6;function JPt(t){let e=0;for(t.reset();t.nextPath();)e+=t.getCurrentRingArea();if(e<Nke){const n=Lke(t);return n?[n[0],n[1]]:null}const i=[0,0];if(t.reset(),!t.nextPath()||!t.nextPoint())return null;const r=[t.x,t.y];for(t.reset();t.nextPath();)kke(i,r,t);return i[0]*=1/e,i[1]*=1/e,i[0]+=r[0],i[1]+=r[1],i}const Fke=1/3;function kke(t,e,i){if(!t||!i||i.pathSize<3)return null;i.nextPoint();const r=i.x,n=i.y;i.nextPoint();let s,o=i.x-r,a=i.y-n,l=0,c=0;for(;i.nextPoint();)l=i.x-r,c=i.y-n,s=.5*Fke*(l*a-c*o),t[0]+=s*(o+l),t[1]+=s*(a+c),o=l,a=c;const h=i.getCurrentRingArea(),d=[r,n];return d[0]-=e[0],d[1]-=e[1],d[0]*=h,d[1]*=h,t[0]+=d[0],t[1]+=d[1],t}function Zt(t=Vke){return[t[0],t[1],t[2],t[3]]}function KPt(t){return[t[0],t[1],t[2],t[3]]}function Sy(t,e){return t!==e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t}function CZ(t,e,i,r,n=Zt()){return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n}function S0e(t,e=Zt()){return e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax,e}function M6(t,e){return new zi({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}function AZ(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function lv(t,e,i){if(e!=null)if("length"in e)Z7(e)?(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[2]),i[3]=Math.max(t[3],e[3])):e.length!==2&&e.length!==3||(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[0]),i[3]=Math.max(t[3],e[1]));else switch(e.type){case"extent":i[0]=Math.min(t[0],e.xmin),i[1]=Math.min(t[1],e.ymin),i[2]=Math.max(t[2],e.xmax),i[3]=Math.max(t[3],e.ymax);break;case"point":i[0]=Math.min(t[0],e.x),i[1]=Math.min(t[1],e.y),i[2]=Math.max(t[2],e.x),i[3]=Math.max(t[3],e.y)}else Sy(i,t)}function q8(t,e,i=t){const r=e.length;let n=t[0],s=t[1],o=t[2],a=t[3];for(let l=0;l<r;l++){const c=e[l];n=Math.min(n,c[0]),s=Math.min(s,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return i[0]=n,i[1]=s,i[2]=o,i[3]=a,i}function Y7(t){for(let e=0;e<4;e++)if(!isFinite(t[e]))return!1;return!0}function Oa(t){return t==null||t[0]>=t[2]?0:t[2]-t[0]}function Wl(t){return t==null||t[1]>=t[3]?0:t[3]-t[1]}function QPt(t){return Oa(t)*Wl(t)}function z5(t){return Oa(t)>0&&Wl(t)>0}function OZ(t,e=[0,0]){return e[0]=(t[0]+t[2])/2,e[1]=(t[1]+t[3])/2,e}function E0e(t,e){return $6(t,e[0],e[1])}function Zie(t,e){const i=e[3],r=.5*(t[0]+t[2]),n=Math.abs(e[0]-r),s=.5*(t[2]-t[0]);if(n>i+s)return!1;const o=.5*(t[1]+t[3]),a=.5*(t[3]-t[1]),l=Math.abs(e[1]-o);if(l>i+a)return!1;if(n<s||l<a)return!0;const c=n-s,h=l-a;return c*c+h*h<=i*i}function eMt(t,e,i){const r=t[0],n=t[1],s=t[2],o=t[3],{x:a,y:l}=e,{x:c,y:h}=i,d=(v,w)=>(h-l)*v+(a-c)*w+(c*l-a*h)<0,f=d(r,o),m=d(s,o),y=d(s,n),_=d(r,n);return!(f===m&&m===y&&y===_&&_===f||a<r&&c<r||a>s&&c>s||l>o&&h>o||l<n&&h<n)}function tMt(t,e){return $6(t,e.x,e.y)}function $6(t,e,i){return e>=t[0]&&i>=t[1]&&e<=t[2]&&i<=t[3]}function Uke(t,e,i){return e[0]>=t[0]-i&&e[1]>=t[1]-i&&e[0]<=t[2]+i&&e[1]<=t[3]+i}function I6(t,e){return Math.max(e[0],t[0])<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])<=Math.min(e[3],t[3])}function Jie(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}function X7(t,e,i){if(e==null)return Sy(i,t);const r=e[0],n=e[1],s=e[2],o=e[3];return i[0]=_e(t[0],r,s),i[1]=_e(t[1],n,o),i[2]=_e(t[2],r,s),i[3]=_e(t[3],n,o),i}function zke(t,e){const i=(t[0]+t[2])/2,r=(t[1]+t[3])/2,n=Math.max(Math.abs(e[0]-i)-Oa(t)/2,0),s=Math.max(Math.abs(e[1]-r)-Wl(t)/2,0);return Math.sqrt(n*n+s*s)}function B5(t,e,i,r=t){return r[0]=t[0]+e,r[1]=t[1]+i,r[2]=t[2]+e,r[3]=t[3]+i,r}function id(t){return t?Sy(t,J7):Zt(J7)}function Z7(t){return t!=null&&t.length===4}function Bke(t){return!(Oa(t)!==0&&isFinite(t[0])||Wl(t)!==0&&isFinite(t[1]))}function Uw(t,e){return Z7(t)&&Z7(e)?t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]:t===e}const iMt=[-1/0,-1/0,1/0,1/0],J7=[1/0,1/0,-1/0,-1/0],Vke=[0,0,0,0];function C0e(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function A0e(t){return t.points!==void 0}function O0e(t){return t.x!==void 0&&t.y!==void 0}function R0e(t){return t.paths!==void 0}function P0e(t){return t.rings!==void 0}function M0e(t){function e(i,r){return i==null?r:r==null?i:t(i,r)}return e}const H_=M0e(Math.min),q_=M0e(Math.max);function rMt(t,e){return R0e(e)?IE(t,e.paths,!1,!1):P0e(e)?IE(t,e.rings,!1,!1):A0e(e)?RZ(t,e.points,!1,!1,!1,!1):C0e(e)?$0e(t,e):(O0e(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.x,t[3]=e.y),t)}function nMt(t){let e,i,r,n;for(t.reset(),e=r=1/0,i=n=-1/0;t.nextPath();){const s=Gke(t);e=Math.min(s[0],e),r=Math.min(s[1],r),i=Math.max(s[2],i),n=Math.max(s[3],n)}return Zt([e,r,i,n])}function Gke(t){let e,i,r,n;for(e=r=1/0,i=n=-1/0;t.nextPoint();)e=Math.min(t.x,e),r=Math.min(t.y,r),i=Math.max(t.x,i),n=Math.max(t.y,n);return Zt([e,r,i,n])}function sMt(t,e){return R0e(e)?IE(t,e.paths,!0,!1):P0e(e)?IE(t,e.rings,!0,!1):A0e(e)?RZ(t,e.points,!0,!1,!0,!1):C0e(e)?$0e(t,e,!0,!1,!0,!1):(O0e(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.x,t[4]=e.y,t[5]=e.z),t)}function IE(t,e,i,r){const n=i?3:2;if(!e.length||!e[0].length)return null;let s,o,a,l,[c,h]=e[0][0],[d,f]=e[0][0];for(let m=0;m<e.length;m++){const y=e[m];for(let _=0;_<y.length;_++){const v=y[_],[w,x]=v;if(c=H_(c,w),h=H_(h,x),d=q_(d,w),f=q_(f,x),i&&v.length>2){const T=v[2];s=H_(s,T),o=q_(o,T)}if(r&&v.length>n){const T=v[n];a=H_(s,T),l=q_(o,T)}}}return i?r?(t[0]=c,t[1]=h,t[2]=s,t[3]=a,t[4]=d,t[5]=f,t[6]=o,t[7]=l,t.length=8,t):(t[0]=c,t[1]=h,t[2]=s,t[3]=d,t[4]=f,t[5]=o,t.length=6,t):r?(t[0]=c,t[1]=h,t[2]=a,t[3]=d,t[4]=f,t[5]=l,t.length=6,t):(t[0]=c,t[1]=h,t[2]=d,t[3]=f,t.length=4,t)}function $0e(t,e,i,r,n,s){const o=e.xmin,a=e.xmax,l=e.ymin,c=e.ymax;let h=e.zmin,d=e.zmax,f=e.mmin,m=e.mmax;return n?(h=h||0,d=d||0,s?(f=f||0,m=m||0,t[0]=o,t[1]=l,t[2]=h,t[3]=f,t[4]=a,t[5]=c,t[6]=d,t[7]=m,t):(t[0]=o,t[1]=l,t[2]=h,t[3]=a,t[4]=c,t[5]=d,t)):s?(f=f||0,m=m||0,t[0]=o,t[1]=l,t[2]=f,t[3]=a,t[4]=c,t[5]=m,t):(t[0]=o,t[1]=l,t[2]=a,t[3]=c,t)}function RZ(t,e,i,r,n,s){const o=i?3:2,a=r&&s,l=i&&n;if(!e.length||!e[0].length)return null;let c,h,d,f,[m,y]=e[0],[_,v]=e[0];for(let w=0;w<e.length;w++){const x=e[w],[T,S]=x;if(m=H_(m,T),y=H_(y,S),_=q_(_,T),v=q_(v,S),l&&x.length>2){const C=x[2];c=H_(c,C),h=q_(h,C)}if(a&&x.length>o){const C=x[o];d=H_(c,C),f=q_(h,C)}}return n?(c=c||0,h=h||0,s?(d=d||0,f=f||0,t[0]=m,t[1]=y,t[2]=c,t[3]=d,t[4]=_,t[5]=v,t[6]=h,t[7]=f,t):(t[0]=m,t[1]=y,t[2]=c,t[3]=_,t[4]=v,t[5]=h,t)):s?(d=d||0,f=f||0,t[0]=m,t[1]=y,t[2]=d,t[3]=_,t[4]=v,t[5]=f,t):(t[0]=m,t[1]=y,t[2]=_,t[3]=v,t)}function jke(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function Hke(t){return t.points!==void 0}function qke(t){return t.x!==void 0&&t.y!==void 0}function Wke(t){return t.paths!==void 0}function Yke(t){return t.rings!==void 0}const PZ=[];function I0e(t,e,i,r){return{xmin:t,ymin:e,xmax:i,ymax:r}}function L0e(t,e,i,r,n,s){return{xmin:t,ymin:e,zmin:i,xmax:r,ymax:n,zmax:s}}function D0e(t,e,i,r,n,s){return{xmin:t,ymin:e,mmin:i,xmax:r,ymax:n,mmax:s}}function N0e(t,e,i,r,n,s,o,a){return{xmin:t,ymin:e,zmin:i,mmin:r,xmax:n,ymax:s,zmax:o,mmax:a}}function MZ(t,e=!1,i=!1){return e?i?N0e(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):L0e(t[0],t[1],t[2],t[3],t[4],t[5]):i?D0e(t[0],t[1],t[2],t[3],t[4],t[5]):I0e(t[0],t[1],t[2],t[3])}function oMt(t){return t?jke(t)?t:qke(t)?Zke(t):Yke(t)?F0e(t):Wke(t)?k0e(t):Hke(t)?Xke(t):null:null}function Xke(t){const{hasZ:e,hasM:i,points:r}=t;return MZ(RZ(PZ,r,e??!1,i??!1),e,i)}function Zke(t){const{x:e,y:i,z:r,m:n}=t,s=n!=null;return r!=null?s?N0e(e,i,r,n,e,i,r,n):L0e(e,i,r,e,i,r):s?D0e(e,i,n,e,i,n):I0e(e,i,e,i)}function F0e(t){const{hasZ:e,hasM:i,rings:r}=t,n=IE(PZ,r,e??!1,i??!1);return n?MZ(n,e,i):null}function k0e(t){const{hasZ:e,hasM:i,paths:r}=t,n=IE(PZ,r,e??!1,i??!1);return n?MZ(n,e,i):null}var eN;function Kie(t){return!Array.isArray(t[0])}let wf=eN=class extends Zv{static fromExtent(t){const e=t.clone().normalize(),i=t.spatialReference;let r=!1,n=!1;for(const o of e)o.hasZ&&(r=!0),o.hasM&&(n=!0);const s={rings:e.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(r&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(n&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:i};return r&&(s.hasZ=!0),n&&(s.hasM=!0),new eN(s)}constructor(...t){super(...t),this.rings=[],this.type="polygon"}normalizeCtorArgs(t,e){let i,r,n=null,s=null;return t&&!Array.isArray(t)?(n=t.rings??null,e||(t.spatialReference?e=t.spatialReference:t.rings||(e=t)),i=t.hasZ,r=t.hasM):n=t,n=n||[],e=e||ze.WGS84,n.length&&n[0]?.[0]!=null&&typeof n[0][0]=="number"&&(n=[n]),s=n[0]?.[0],s&&(i===void 0&&r===void 0?(i=s.length>2,r=s.length>3):i===void 0?i=r?s.length>3:s.length>2:r===void 0&&(r=i?s.length>3:s.length>2)),{rings:n,spatialReference:e,hasZ:i,hasM:r}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const t=$ke(this);if(!t||isNaN(t[0])||isNaN(t[1])||this.hasZ&&isNaN(t[2]))return null;const e=new ut;return e.x=t[0],e.y=t[1],e.spatialReference=this.spatialReference,this.hasZ&&(e.z=t[2]),e}get extent(){const{spatialReference:t}=this,e=F0e(this);if(!e)return null;const i=new zi(e);return i.spatialReference=t,i}get isSelfIntersecting(){return r5e(this.rings)}writeRings(t,e){e.rings=Q(this.rings)}addRing(t){if(!t)return;const e=this.rings,i=e.length;if(Kie(t)){const r=[];for(let n=0,s=t.length;n<s;n++)r[n]=t[n].toArray();e[i]=r}else e[i]=t.concat();return this.notifyChange("rings"),this}clone(){const t=new eN;return t.spatialReference=this.spatialReference,t.rings=Q(this.rings),t.hasZ=this.hasZ,t.hasM=this.hasM,t}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,i=t.spatialReference;if(e!=null!=(i!=null)||e!=null&&i!=null&&!e.equals(i)||this.rings.length!==t.rings.length)return!1;const r=([n,s,o,a],[l,c,h,d])=>n===l&&s===c&&(o==null&&h==null||o===h)&&(a==null&&d==null||a===d);for(let n=0;n<this.rings.length;n++){const s=this.rings[n],o=t.rings[n];if(!vy(s,o,r))return!1}return!0}contains(t){if(!t)return!1;const e=dM(t,this.spatialReference);return W4e(this,e??t)}isClockwise(t){let e;return e=Kie(t)?t.map(i=>this.hasZ?this.hasM?[i.x,i.y,i.z,i.m]:[i.x,i.y,i.z]:[i.x,i.y]):t,QD(e)}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.rings[t][e],r=this.hasZ,n=this.hasM;return r&&!n?new ut(i[0],i[1],i[2],void 0,this.spatialReference):n&&!r?new ut(i[0],i[1],void 0,i[2],this.spatialReference):r&&n?new ut(i[0],i[1],i[2],i[3],this.spatialReference):new ut(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?($E(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t].splice(e,0,i),this.notifyChange("rings"),this):this}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new ut(this.rings[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("rings"),i}removeRing(t){if(!this._validateInputs(t,null))return null;const e=this.rings.splice(t,1)[0],i=this.spatialReference,r=e.map(n=>new ut(n,i));return this.notifyChange("rings"),r}setPoint(t,e,i){return this._validateInputs(t,e)?($E(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t][e]=i,this.notifyChange("rings"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.rings.length)return!1;if(e!=null){const r=this.rings[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};u([p({readOnly:!0})],wf.prototype,"cache",null),u([p({readOnly:!0})],wf.prototype,"centroid",null),u([p({readOnly:!0})],wf.prototype,"extent",null),u([p({readOnly:!0})],wf.prototype,"isSelfIntersecting",null),u([p({type:[[[Number]]],json:{write:{isRequired:!0}}})],wf.prototype,"rings",void 0),u([Be("rings")],wf.prototype,"writeRings",null),wf=eN=u([M("esri.geometry.Polygon")],wf),wf.prototype.toJSON.isDefaultToJSON=!0;const Cm=wf;var K7;function Jke(t){return!Array.isArray(t[0])}let X0=K7=class extends Zv{constructor(...t){super(...t),this.paths=[],this.type="polyline"}normalizeCtorArgs(t,e){let i,r,n=null,s=null;return t&&!Array.isArray(t)?(n=t.paths??null,e||(t.spatialReference?e=t.spatialReference:t.paths||(e=t)),i=t.hasZ,r=t.hasM):n=t,n=n||[],e=e||ze.WGS84,n.length&&n[0]?.[0]!=null&&typeof n[0][0]=="number"&&(n=[n]),s=n[0]?.[0],s&&(i===void 0&&r===void 0?(i=s.length>2,r=!1):i===void 0?i=!r&&s.length>3:r===void 0&&(r=!i&&s.length>3)),{paths:n,spatialReference:e,hasZ:i,hasM:r}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:t}=this,e=k0e(this);if(!e)return null;const i=new zi(e);return i.spatialReference=t,i}writePaths(t,e){e.paths=Q(this.paths)}addPath(t){if(!t)return;const e=this.paths,i=e.length;if(Jke(t)){const r=[];for(let n=0,s=t.length;n<s;n++)r[n]=t[n].toArray();e[i]=r}else e[i]=t.concat();return this.notifyChange("paths"),this}clone(){const t=new K7;return t.spatialReference=this.spatialReference,t.paths=Q(this.paths),t.hasZ=this.hasZ,t.hasM=this.hasM,t}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.paths[t][e],r=this.hasZ,n=this.hasM;return r&&!n?new ut(i[0],i[1],i[2],void 0,this.spatialReference):n&&!r?new ut(i[0],i[1],void 0,i[2],this.spatialReference):r&&n?new ut(i[0],i[1],i[2],i[3],this.spatialReference):new ut(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?($E(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t].splice(e,0,i),this.notifyChange("paths"),this):this}removePath(t){if(!this._validateInputs(t,null))return null;const e=this.paths.splice(t,1)[0],i=this.spatialReference,r=e.map(n=>new ut(n,i));return this.notifyChange("paths"),r}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new ut(this.paths[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("paths"),i}setPoint(t,e,i){return this._validateInputs(t,e)?($E(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t][e]=i,this.notifyChange("paths"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.paths.length)return!1;if(e!=null){const r=this.paths[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};u([p({readOnly:!0})],X0.prototype,"cache",null),u([p({readOnly:!0})],X0.prototype,"extent",null),u([p({type:[[[Number]]],json:{write:{isRequired:!0}}})],X0.prototype,"paths",void 0),u([Be("paths")],X0.prototype,"writePaths",null),X0=K7=u([M("esri.geometry.Polyline")],X0),X0.prototype.toJSON.isDefaultToJSON=!0;const gp=X0,nP=yl()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),aMt=yl()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function U0e(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function $Z(t){return t.points!==void 0}function IZ(t){return t.x!==void 0&&t.y!==void 0}function LZ(t){return t.paths!==void 0}function L6(t){return t.rings!==void 0}function bv(t){return t==null?null:t instanceof Zv?t:IZ(t)?ut.fromJSON(t):LZ(t)?gp.fromJSON(t):L6(t)?Cm.fromJSON(t):$Z(t)?TC.fromJSON(t):U0e(t)?zi.fromJSON(t):null}function yM(t){return t?IZ(t)?"esriGeometryPoint":LZ(t)?"esriGeometryPolyline":L6(t)?"esriGeometryPolygon":U0e(t)?"esriGeometryEnvelope":$Z(t)?"esriGeometryMultipoint":null:null}const Kke={esriGeometryPoint:ut,esriGeometryPolyline:gp,esriGeometryPolygon:Cm,esriGeometryEnvelope:zi,esriGeometryMultipoint:TC};function Qke(t){return t&&Kke[t]||null}const _M={base:Zv,key:"type",typeMap:{extent:zi,multipoint:TC,point:ut,polyline:gp,polygon:Cm}};Tm(_M);let z0e=0;const vM=t=>{let e=class extends t{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+z0e++})}};return e=u([M("esri.core.Identifiable")],e),e},lMt=t=>{let e=class extends t{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:z0e++})}};return e=u([M("esri.core.NumericIdentifiable")],e),e};let Qie=class extends vM(class{}){};Qie=u([M("esri.core.Identifiable")],Qie);async function e6e(t){const e="portalItem"in t?t:{portalItem:t},{fromItem:i}=await ce(()=>import("./portalLayers-7401a143.js").then(r=>r.p),["./portalLayers-7401a143.js","./associatedFeatureServiceUtils-aa9f1206.js","./requestPresets-07a176e4.js"],import.meta.url);try{return await i(e)}catch(r){const n=e&&e.portalItem,s=n?.id||"unset",o=n&&n.portal&&n.portal.url||Di.portalUrl;throw K.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+s+"')",r),r}}let t6e=0,to=class extends Sn.EventedMixin(vM(xy)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new zi(-180,-90,180,90,ze.WGS84),this.id=Date.now().toString(16)+"-layer-"+t6e++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.persistenceEnabled=!1,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=ze.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const i=typeof e=="string"?{url:e}:e;return(await ce(()=>import("./arcgisLayers-a2b7c315.js"),["./arcgisLayers-a2b7c315.js","./associatedFeatureServiceUtils-aa9f1206.js","./fetchService-6e256c6d.js","./requestPresets-07a176e4.js"],import.meta.url)).fromUrl(i)}static fromPortalItem(e){return e6e(e)}initialize(){this.when().catch(e=>{Tn(e)||K.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}destroy(){const e=this.parent;if(e){const i=this;"layers"in e&&e.layers.includes(i)?e.layers.remove(i):"tables"in e&&e.tables.includes(i)?e.tables.remove(i):"baseLayers"in e&&e.baseLayers.includes(i)?e.baseLayers.remove(i):"referenceLayers"in e&&e.referenceLayers.includes(i)&&e.referenceLayers.remove(i),this._set("parent",null)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return Nn(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await _i(e,{query:{f:"json"},responseType:"json"})).data;throw new G("layer:no-attribution-data","Layer does not have attribution data")}};u([p({type:String})],to.prototype,"attributionDataUrl",void 0),u([p({type:zi})],to.prototype,"fullExtent",void 0),u([p({readOnly:!0})],to.prototype,"hasAttributionData",null),u([p({type:String,clonable:!1})],to.prototype,"id",void 0),u([p({type:Boolean,nonNullable:!0})],to.prototype,"legendEnabled",void 0),u([p({type:["show","hide","hide-children"]})],to.prototype,"listMode",void 0),u([p({type:Number,range:{min:0,max:1},nonNullable:!0})],to.prototype,"opacity",void 0),u([p({clonable:!1})],to.prototype,"parent",void 0),u([p({readOnly:!0})],to.prototype,"parsedUrl",null),u([p({type:Boolean,readOnly:!0})],to.prototype,"persistenceEnabled",void 0),u([p({type:Boolean})],to.prototype,"popupEnabled",void 0),u([p({type:Boolean})],to.prototype,"attributionVisible",void 0),u([p({type:ze})],to.prototype,"spatialReference",void 0),u([p({type:String})],to.prototype,"title",void 0),u([p({readOnly:!0,json:{read:!1}})],to.prototype,"type",void 0),u([p()],to.prototype,"url",void 0),u([p({type:Boolean,nonNullable:!0})],to.prototype,"visible",void 0),to=u([M("esri.layers.Layer")],to);const DZ=to;function Q7(t,e,i){let r,n;if(t)for(let s=0,o=t.length;s<o;s++){if(r=t.at(s),r?.[e]===i)return r;if(r?.type==="group"&&(n=Q7(r.layers,e,i),n))return n}}const i6e=t=>{let e=class extends t{constructor(...i){super(...i),this.layers=new Je;const r=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},n=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||K.getLogger(this).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},s=o=>{o.parent=null,this.layerRemoved(o)};this.addHandles([this.layers.on("before-add",o=>r(o.item)),this.layers.on("after-add",o=>n(o.item)),this.layers.on("after-remove",o=>s(o.item))])}destroy(){const i=this.layers.toArray();for(const r of i)r.destroy();this.layers.destroy()}set layers(i){this._set("layers",wy(i,this._get("layers")))}add(i,r){const n=this.layers;if(r=n.getNextIndex(r),i instanceof DZ){const s=i;s.parent===this?this.reorder(s,r):n.add(s,r)}else Zc(i)?i.then(s=>{this.destroyed||this.add(s,r)}):K.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(i,r){const n=this.layers;let s=n.getNextIndex(r);i.slice().forEach(o=>{o.parent!==this?(n.add(o,s),s+=1):this.reorder(o,s)})}findLayerById(i){return Q7(this.layers,"id",i)}findLayerByUid(i){return Q7(this.layers,"uid",i)}remove(i){return this.layers.remove(i)}removeMany(i){return this.layers.removeMany(i)}removeAll(){return this.layers.removeAll()}reorder(i,r){return this.layers.reorder(i,r)}layerAdded(i){}layerRemoved(i){}};return u([p()],e.prototype,"layers",null),e=u([M("esri.support.LayersMixin")],e),e};function eG(t,e,i){if(t)for(let r=0,n=t.length;r<n;r++){const s=t.at(r);if(s[e]===i)return s;if(s?.type==="group"){const o=eG(s.tables,e,i);if(o)return o}}}const r6e=t=>{let e=class extends t{constructor(...i){super(...i),this.tables=new Je,this.addHandles([this.tables.on("after-add",r=>{const n=r.item;n.parent&&n.parent!==this&&"tables"in n.parent&&n.parent.tables.remove(n),n.parent=this,n.type!=="feature"&&K.getLogger(this).error(`Layer 'title:${n.title}, id:${n.id}' of type '${n.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",r=>{r.item.parent=null})])}destroy(){const i=this.tables.toArray();for(const r of i)r.destroy();this.tables.destroy()}set tables(i){this._set("tables",wy(i,this._get("tables")))}findTableById(i){return eG(this.tables,"id",i)}findTableByUid(i){return eG(this.tables,"uid",i)}};return u([p()],e.prototype,"tables",null),e=u([M("esri.support.TablesMixin")],e),e};let xf=class extends r6e(i6e(Sn.EventedMixin(we))){constructor(e){super(e),this.allLayers=new rP({getCollections:()=>[this.basemap?.baseLayers,this.ground?.layers,this.layers,this.basemap?.referenceLayers],getChildrenFunction:i=>"layers"in i?i.layers:null}),this.allTables=Ake(this),this.basemap=null,this.editableLayers=new rP({getCollections:()=>[this.allLayers],itemFilterFunction:NFe}),this.ground=new iP,this._basemapCache=bke()}destroy(){wke(this._basemapCache),this._basemapCache=null,this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=$e(this.basemap),$e(this.ground),this._set("ground",null)}castBasemap(e){return EZ(e,this._basemapCache)}castGround(e){return Oke(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(i=>i.id===e)}findTableById(e){return this.allTables.find(i=>i.id===e)}};u([p({readOnly:!0,dependsOn:[]})],xf.prototype,"allLayers",void 0),u([p({readOnly:!0})],xf.prototype,"allTables",void 0),u([p({type:q2,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],xf.prototype,"basemap",void 0),u([ai("basemap")],xf.prototype,"castBasemap",null),u([p({readOnly:!0})],xf.prototype,"editableLayers",void 0),u([p({type:iP,nonNullable:!0})],xf.prototype,"ground",void 0),u([ai("ground")],xf.prototype,"castGround",null),xf=u([M("esri.Map")],xf);const B0e=xf,es=t=>{let e=class extends t{clone(){const i=Jl(this);o6(i,"unable to clone instance of non-accessor class");const r=i.metadatas,n=i.store,s={},o=new Map;for(const l in r){const c=r[l],h=n?.originOf(l),d=c.clonable;if(c.readOnly||d===!1||h!==Ci.USER&&h!==Ci.DEFAULTS&&h!==Ci.WEB_MAP&&h!==Ci.WEB_SCENE)continue;const f=this[l];let m=null;m=typeof d=="function"?d(f):d==="reference"?f:QV(f),f!=null&&m==null||(h===Ci.DEFAULTS?o.set(l,m):s[l]=m)}const a=new(Object.getPrototypeOf(this)).constructor(s);if(o.size){const l=Jl(a)?.store;if(l)for(const[c,h]of o)l.set(c,h,Ci.DEFAULTS)}return a}};return e=u([M("esri.core.Clonable")],e),e};let ere=class extends es(we){};ere=u([M("esri.core.Clonable")],ere);let wv=class{constructor(e,i){this.min=e,this.max=i,this.range=i-e}ndiff(e,i=0){return Math.ceil((e-i)/this.range)*this.range+i}_normalize(e,i,r,n=0,s=!1){return(r-=n)<e?r+=this.ndiff(e-r):r>i&&(r-=this.ndiff(r-i)),s&&r===i&&(r=e),r+n}normalize(e,i=0,r=!1){return this._normalize(this.min,this.max,e,i,r)}clamp(e,i=0){return _e(e-i,this.min,this.max)+i}monotonic(e,i,r){return e<i?i:i+this.ndiff(e-i,r)}minimalMonotonic(e,i,r){return this._normalize(e,e+this.range,i,r)}center(e,i,r){return i=this.monotonic(e,i,r),this.normalize((e+i)/2,r)}diff(e,i,r){return this.monotonic(e,i,r)-e}shortestSignedDiff(e,i){e=this.normalize(e);const r=(i=this.normalize(i))-e,n=i<e?this.minimalMonotonic(e,i)-e:i-this.minimalMonotonic(i,e);return Math.abs(r)<Math.abs(n)?r:n}contains(e,i,r){return i=this.minimalMonotonic(e,i),(r=this.minimalMonotonic(e,r))>e&&r<i}};function NZ(t){for(const e in t){const i=t[e];i instanceof Function&&(t[e]=i.bind(t))}return t}const n6e=NZ(new wv(0,2*Math.PI)),xv=NZ(new wv(-Math.PI,Math.PI)),FZ=NZ(new wv(0,360));let xg=class extends es(pe){constructor(...e){super(...e),this.position=new ut([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,i,r,n){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const s={position:e};return i!=null&&(s.heading=i),r!=null&&(s.tilt=r),n!=null&&(s.fov=n),s}return e}writePosition(e,i,r,n){const s=e.clone();s.x=Nh(e.x||0),s.y=Nh(e.y||0),s.z=e.hasZ?Nh(e.z||0):e.z,i[r]=s.write({},n)}readPosition(e,i){const r=new ut;return r.read(e,i),r.x=Nh(r.x||0),r.y=Nh(r.y||0),r.z=r.hasZ?Nh(r.z||0):r.z,r}equals(e){return e!=null&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};u([p({type:ut,json:{write:{isRequired:!0}}})],xg.prototype,"position",void 0),u([Be("position")],xg.prototype,"writePosition",null),u([wt("position")],xg.prototype,"readPosition",null),u([p({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),ai(t=>FZ.normalize(Nh(t)))],xg.prototype,"heading",void 0),u([p({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),ai(t=>_e(Nh(t),-180,180))],xg.prototype,"tilt",void 0),u([p({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],xg.prototype,"fov",void 0),xg=u([M("esri.Camera")],xg);const eh=xg;var tG;let Z0=tG=class extends pe{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new tG({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};function W8(){return{enabled:!this.camera}}u([p({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:W8}}}}})],Z0.prototype,"rotation",void 0),u([ai("rotation")],Z0.prototype,"castRotation",null),u([p({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:W8}}}}})],Z0.prototype,"scale",void 0),u([p({types:_M,json:{read:bv,write:!0,origins:{"web-scene":{read:bv,write:{overridePolicy:W8}}}}})],Z0.prototype,"targetGeometry",void 0),u([p({type:eh,json:{write:!0}})],Z0.prototype,"camera",void 0),Z0=tG=u([M("esri.Viewpoint")],Z0);const qc=Z0;let s6e=class V0e{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(r7),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const i=new V0e,r=this._originStores[Ci.DEFAULTS];r&&r.forEach((n,s)=>{i.set(s,Q(n),Ci.DEFAULTS)});for(let n=Ci.SERVICE;n<r7;n++){const s=this._originStores[n];s&&s.forEach((o,a)=>{e&&e.has(a)||i.set(a,Q(o),n)})}return i}get(e,i){const r=i===void 0?this._values:this._originStores[i];return r?r.get(e):void 0}keys(e){const i=e==null?this._values:this._originStores[e];return i?[...i.keys()]:[]}set(e,i,r=Ci.USER){let n=this._originStores[r];if(n||(n=new Map,this._originStores[r]=n),n.set(e,i),!this._values.has(e)||this._propertyOriginMap.get(e)<=r){const s=this._values.get(e);return this._values.set(e,i),this._propertyOriginMap.set(e,r),s!==i}return!1}delete(e,i=Ci.USER){const r=this._originStores[i];if(!r)return;const n=r.get(e);if(r.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===i){this._values.delete(e);for(let s=i-1;s>=0;s--){const o=this._originStores[s];if(o&&o.has(e)){this._values.set(e,o.get(e)),this._propertyOriginMap.set(e,s);break}}}return n}has(e,i){const r=i===void 0?this._values:this._originStores[i];return!!r&&r.has(e)}revert(e,i){for(;i>0&&!this.has(e,i);)--i;const r=this._originStores[i],n=r?.get(e),s=this._values.get(e);return this._values.set(e,n),this._propertyOriginMap.set(e,i),s!==n}originOf(e){return this._propertyOriginMap.get(e)||Ci.DEFAULTS}forEach(e){this._values.forEach(e)}};const G0e=t=>{let e=class extends t{constructor(...i){super(...i);const r=Jl(this),n=r.store,s=new s6e;r.store=s,Age(r,n,s)}read(i,r){Rge(this,i,r)}getAtOrigin(i,r){const n=Y8(this),s=j_(r);if(typeof i=="string")return n.get(i,s);const o={};return i.forEach(a=>{o[a]=n.get(a,s)}),o}originOf(i){return a5(this.originIdOf(i))}originIdOf(i){return Y8(this).originOf(i)}revert(i,r){const n=Y8(this),s=j_(r),o=Jl(this);let a;a=typeof i=="string"?i==="*"?n.keys(s):[i]:i,a.forEach(l=>{o.invalidate(l),n.revert(l,s),o.commit(l)})}};return e=u([M("esri.core.ReadOnlyMultiOriginJSONSupport")],e),e};function Y8(t){return Jl(t).store}let tre=class extends G0e(we){};tre=u([M("esri.core.ReadOnlyMultiOriginJSONSupport")],tre);const o6e=t=>{let e=class extends t{constructor(...i){super(...i)}clear(i,r="user"){return X8(this).delete(i,j_(r))}write(i,r){return $ge(this,i=i||{},r),i}setAtOrigin(i,r,n){Jl(this).setAtOrigin(i,r,j_(n))}removeOrigin(i){const r=X8(this),n=j_(i),s=r.keys(n);for(const o of s)r.originOf(o)===n&&r.set(o,r.get(o,n),Ci.USER)}updateOrigin(i,r){const n=X8(this),s=j_(r),o=Hl(this,i);for(let a=s+1;a<r7;++a)n.delete(i,a);n.set(i,o,s)}toJSON(i){return this.write({},i)}};return e=u([M("esri.core.WriteableMultiOriginJSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function X8(t){return Jl(t).store}const kZ=t=>{let e=class extends o6e(G0e(t)){constructor(...i){super(...i)}};return e=u([M("esri.core.MultiOriginJSONSupport")],e),e};let iG=class extends kZ(we){};iG=u([M("esri.core.MultiOriginJSONSupport")],iG);function ne(t,e,i={}){return UZ(t,e,i,j0e)}function gl(t,e,i={}){return UZ(t,e,i,H0e)}function UZ(t,e,i={},r){let n=null;const s=i.once?(o,a)=>{r(o)&&(Tr(n),e(o,a))}:(o,a)=>{r(o)&&e(o,a)};if(n=fDe(t,s,i.sync,i.equals),i.initial){const o=t();s(o,o)}return n}function bo(t,e,i,r={}){let n=null,s=null,o=null;function a(){n&&s&&(s.remove(),r.onListenerRemove?.(n),n=null,s=null)}function l(h){r.once&&r.once&&Tr(o),i(h)}const c=ne(t,(h,d)=>{a(),l6(h)&&(n=h,s=oy(h,e,l),r.onListenerAdd?.(h))},{sync:r.sync,initial:!0});return o=Vi(()=>{c.remove(),a()}),o}function Tv(t,e){return a6e(t,H0e,e)}function a6e(t,e,i){if(ps(i))return Promise.reject(Ti());const r=t();if(e?.(r))return Promise.resolve(r);let n=null;function s(){n=Tr(n)}return new Promise((o,a)=>{n=yv([Ms(i,()=>{s(),a(Ti())}),UZ(t,l=>{s(),o(l)},{sync:!1,once:!0},e??j0e)])})}function j0e(t){return!0}function H0e(t){return!!t}function l6e(t,e,i={}){let r=!1;const n=ne(t,(s,o)=>{r||e(s,o)},i);return{remove(){n.remove()},pause(){r=!0},resume(){r=!1}}}function c6e(t,e){const i=new Je,r=bo(t,"after-splice",({added:n,start:s,deleteCount:o})=>{const a=i.splice(s,o);for(const l of a)l.remove();if(n?.length){const l=n.map(e);i.addMany(l,s)}},{sync:!0,onListenerRemove:()=>i.drain(n=>n.remove()),onListenerAdd:n=>i.addMany(n.items.map(e))});return i.addHandles(r),i}function yMt(t,e){const i=new Je,r=c6e(t,a=>Xv(async l=>{const c=await e(a,l);if(ps(l))throw c.remove(),Ti();return c})),n=()=>null,s=async a=>{const l=await a.promise,c=r.indexOf(a);c<0||i.splice(c,1,l)};i.addMany(r.items.map(n));for(const a of r)YR(s(a));const o=r.on("after-splice",({added:a,start:l,deleteCount:c})=>{const h=i.splice(l,c);for(const d of h)d?.remove();if(a?.length){i.addMany(a.map(n),l);for(const d of a)YR(s(d))}});return i.addHandles([kme(r),o]),i}const Zi={sync:!0},Xt={initial:!0},Ji={sync:!0,initial:!0};function u6e(t){return t&&"getAtOrigin"in t&&"originOf"in t}function ire(t){t?.writtenProperties&&t.writtenProperties.forEach(({target:e,propName:i,newOrigin:r})=>{u6e(e)&&r&&e.originOf(i)!==r&&e.updateOrigin(i,r)})}var l3;const V5=yl()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),q0e=V5.jsonValues.slice();WR(q0e,"orthometric");const WO=yl()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let Ld=l3=class extends pe{constructor(t){super(t),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(t,e,i){return V5.write(t,e,i)}readHeightModel(t,e,i){return V5.read(t)||(i?.messages&&i.messages.push(h6e(t,{context:i})),null)}readHeightUnit(t,e,i){return WO.read(t)||(i?.messages&&i.messages.push(rre(t,{context:i})),null)}readHeightUnitService(t,e,i){return dye(t)||WO.read(t)||(i?.messages&&i.messages.push(rre(t,{context:i})),null)}readVertCRS(t,e){return e.vertCRS||e.ellipsoid||e.geoid}clone(){return new l3({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(t){return!!t&&(this===t||this.heightModel===t.heightModel&&this.heightUnit===t.heightUnit&&this.vertCRS===t.vertCRS)}static deriveUnitFromSR(t,e){const i=M4e(e);return new l3({heightModel:t.heightModel,heightUnit:i,vertCRS:t.vertCRS})}write(t,e){return e={origin:"web-scene",...e},super.write(t,e)}static fromJSON(t){if(!t)return null;const e=new l3;return e.read(t,{origin:"web-scene"}),e}};function rre(t,e){return new Sm("height-unit:unsupported",`Height unit of value '${t}' is not supported`,e)}function h6e(t,e){return new Sm("height-model:unsupported",`Height model of value '${t}' is not supported`,e)}u([p({type:V5.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:q0e,default:"ellipsoidal"}}}})],Ld.prototype,"heightModel",void 0),u([Be("web-scene","heightModel")],Ld.prototype,"writeHeightModel",null),u([wt(["web-scene","service"],"heightModel")],Ld.prototype,"readHeightModel",null),u([p({type:WO.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:WO.jsonValues,write:WO.write}}}})],Ld.prototype,"heightUnit",void 0),u([wt("web-scene","heightUnit")],Ld.prototype,"readHeightUnit",null),u([wt("service","heightUnit")],Ld.prototype,"readHeightUnitService",null),u([p({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],Ld.prototype,"vertCRS",void 0),u([wt("service","vertCRS",["vertCRS","ellipsoid","geoid"])],Ld.prototype,"readVertCRS",null),Ld=l3=u([M("esri.geometry.HeightModelInfo")],Ld);const zx=Ld,_Mt=Math.PI/180,vMt=/(?:SPHEROID|ELLIPSOID)\[([^\]]+)]/i,d0=Ai.radius,vd=Ai.eccentricitySquared,d6e={a1:d0*vd,a2:d0*vd*d0*vd,a3:d0*vd*vd/2,a4:d0*vd*d0*vd*2.5,a5:d0*vd+d0*vd*vd/2,a6:1-vd},bMt={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:Ai.radius,f:Ai.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:Ty.radius,f:Ty.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:dm.radius,f:dm.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:dm.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};var Z;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",t[t.WGS84=2]="WGS84",t[t.WEB_MERCATOR=3]="WEB_MERCATOR",t[t.WGS84_ECEF=4]="WGS84_ECEF",t[t.CGCS2000=5]="CGCS2000",t[t.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",t[t.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",t[t.GCSMARS2000=8]="GCSMARS2000",t[t.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",t[t.GCSMOON2000=10]="GCSMOON2000",t[t.LON_LAT=11]="LON_LAT",t[t.PLATE_CARREE=12]="PLATE_CARREE"})(Z||(Z={}));const x2={[Z.WGS84]:{[Z.CGCS2000]:null,[Z.GCSMARS2000]:null,[Z.GCSMOON2000]:null,[Z.LON_LAT]:zr,[Z.WGS84_COMPARABLE_LON_LAT]:zr,[Z.SPHERICAL_ECEF]:Y_,[Z.SPHERICAL_MARS_PCPF]:null,[Z.SPHERICAL_MOON_PCPF]:null,[Z.UNKNOWN]:null,[Z.WEB_MERCATOR]:LE,[Z.PLATE_CARREE]:W_,[Z.WGS84]:zr,[Z.WGS84_ECEF]:Z_},[Z.CGCS2000]:{[Z.CGCS2000]:zr,[Z.GCSMARS2000]:null,[Z.GCSMOON2000]:null,[Z.LON_LAT]:zr,[Z.WGS84_COMPARABLE_LON_LAT]:zr,[Z.SPHERICAL_ECEF]:Y_,[Z.SPHERICAL_MARS_PCPF]:null,[Z.SPHERICAL_MOON_PCPF]:null,[Z.UNKNOWN]:null,[Z.WEB_MERCATOR]:null,[Z.PLATE_CARREE]:W_,[Z.WGS84]:null,[Z.WGS84_ECEF]:Z_},[Z.GCSMARS2000]:{[Z.CGCS2000]:null,[Z.GCSMARS2000]:zr,[Z.GCSMOON2000]:null,[Z.LON_LAT]:zr,[Z.WGS84_COMPARABLE_LON_LAT]:null,[Z.SPHERICAL_ECEF]:null,[Z.SPHERICAL_MARS_PCPF]:nG,[Z.SPHERICAL_MOON_PCPF]:null,[Z.UNKNOWN]:null,[Z.WEB_MERCATOR]:null,[Z.PLATE_CARREE]:null,[Z.WGS84]:null,[Z.WGS84_ECEF]:null},[Z.GCSMOON2000]:{[Z.CGCS2000]:null,[Z.GCSMARS2000]:null,[Z.GCSMOON2000]:zr,[Z.LON_LAT]:zr,[Z.WGS84_COMPARABLE_LON_LAT]:null,[Z.SPHERICAL_ECEF]:null,[Z.SPHERICAL_MARS_PCPF]:null,[Z.SPHERICAL_MOON_PCPF]:rG,[Z.UNKNOWN]:null,[Z.WEB_MERCATOR]:null,[Z.PLATE_CARREE]:null,[Z.WGS84]:null,[Z.WGS84_ECEF]:null},[Z.WEB_MERCATOR]:{[Z.CGCS2000]:null,[Z.GCSMARS2000]:null,[Z.GCSMOON2000]:null,[Z.LON_LAT]:zw,[Z.WGS84_COMPARABLE_LON_LAT]:zw,[Z.SPHERICAL_ECEF]:Y0e,[Z.SPHERICAL_MARS_PCPF]:null,[Z.SPHERICAL_MOON_PCPF]:null,[Z.UNKNOWN]:null,[Z.WEB_MERCATOR]:zr,[Z.PLATE_CARREE]:Z0e,[Z.WGS84]:zw,[Z.WGS84_ECEF]:X0e},[Z.WGS84_ECEF]:{[Z.CGCS2000]:J_,[Z.GCSMARS2000]:null,[Z.GCSMOON2000]:null,[Z.LON_LAT]:J_,[Z.WGS84_COMPARABLE_LON_LAT]:J_,[Z.SPHERICAL_ECEF]:Q0e,[Z.SPHERICAL_MARS_PCPF]:null,[Z.SPHERICAL_MOON_PCPF]:null,[Z.UNKNOWN]:null,[Z.WEB_MERCATOR]:e_e,[Z.PLATE_CARREE]:p6e,[Z.WGS84]:J_,[Z.WGS84_ECEF]:zr},[Z.SPHERICAL_ECEF]:{[Z.CGCS2000]:X_,[Z.GCSMARS2000]:null,[Z.GCSMOON2000]:null,[Z.LON_LAT]:X_,[Z.WGS84_COMPARABLE_LON_LAT]:X_,[Z.SPHERICAL_ECEF]:zr,[Z.SPHERICAL_MARS_PCPF]:null,[Z.SPHERICAL_MOON_PCPF]:null,[Z.UNKNOWN]:null,[Z.WEB_MERCATOR]:J0e,[Z.PLATE_CARREE]:f6e,[Z.WGS84]:X_,[Z.WGS84_ECEF]:K0e},[Z.SPHERICAL_MARS_PCPF]:{[Z.CGCS2000]:null,[Z.GCSMARS2000]:oG,[Z.GCSMOON2000]:null,[Z.LON_LAT]:oG,[Z.WGS84_COMPARABLE_LON_LAT]:null,[Z.SPHERICAL_ECEF]:null,[Z.SPHERICAL_MARS_PCPF]:zr,[Z.SPHERICAL_MOON_PCPF]:null,[Z.UNKNOWN]:null,[Z.WEB_MERCATOR]:null,[Z.PLATE_CARREE]:null,[Z.WGS84]:null,[Z.WGS84_ECEF]:null},[Z.SPHERICAL_MOON_PCPF]:{[Z.CGCS2000]:null,[Z.GCSMARS2000]:null,[Z.GCSMOON2000]:sG,[Z.LON_LAT]:sG,[Z.WGS84_COMPARABLE_LON_LAT]:null,[Z.SPHERICAL_ECEF]:null,[Z.SPHERICAL_MARS_PCPF]:null,[Z.SPHERICAL_MOON_PCPF]:zr,[Z.UNKNOWN]:null,[Z.WEB_MERCATOR]:null,[Z.PLATE_CARREE]:null,[Z.WGS84]:null,[Z.WGS84_ECEF]:null},[Z.UNKNOWN]:{[Z.CGCS2000]:null,[Z.GCSMARS2000]:null,[Z.GCSMOON2000]:null,[Z.LON_LAT]:null,[Z.WGS84_COMPARABLE_LON_LAT]:null,[Z.SPHERICAL_ECEF]:null,[Z.SPHERICAL_MARS_PCPF]:null,[Z.SPHERICAL_MOON_PCPF]:null,[Z.UNKNOWN]:zr,[Z.WEB_MERCATOR]:null,[Z.PLATE_CARREE]:null,[Z.WGS84]:null,[Z.WGS84_ECEF]:null},[Z.LON_LAT]:{[Z.CGCS2000]:zr,[Z.GCSMARS2000]:zr,[Z.GCSMOON2000]:zr,[Z.LON_LAT]:zr,[Z.WGS84_COMPARABLE_LON_LAT]:zr,[Z.SPHERICAL_ECEF]:Y_,[Z.SPHERICAL_MARS_PCPF]:nG,[Z.SPHERICAL_MOON_PCPF]:rG,[Z.UNKNOWN]:null,[Z.WEB_MERCATOR]:LE,[Z.PLATE_CARREE]:W_,[Z.WGS84]:zr,[Z.WGS84_ECEF]:Z_},[Z.WGS84_COMPARABLE_LON_LAT]:{[Z.CGCS2000]:null,[Z.GCSMARS2000]:null,[Z.GCSMOON2000]:null,[Z.LON_LAT]:zr,[Z.WGS84_COMPARABLE_LON_LAT]:zr,[Z.SPHERICAL_ECEF]:Y_,[Z.SPHERICAL_MARS_PCPF]:null,[Z.SPHERICAL_MOON_PCPF]:null,[Z.UNKNOWN]:null,[Z.WEB_MERCATOR]:null,[Z.PLATE_CARREE]:W_,[Z.WGS84]:zr,[Z.WGS84_ECEF]:Z_},[Z.PLATE_CARREE]:{[Z.CGCS2000]:Ew,[Z.GCSMARS2000]:null,[Z.GCSMOON2000]:null,[Z.LON_LAT]:Ew,[Z.WGS84_COMPARABLE_LON_LAT]:Ew,[Z.SPHERICAL_ECEF]:m6e,[Z.SPHERICAL_MARS_PCPF]:null,[Z.SPHERICAL_MOON_PCPF]:null,[Z.UNKNOWN]:null,[Z.WEB_MERCATOR]:g6e,[Z.PLATE_CARREE]:zr,[Z.WGS84]:Ew,[Z.WGS84_ECEF]:y6e}};function W0e(t){const e=sP(t,i_e);return x2[e][Z.WGS84_COMPARABLE_LON_LAT]}function zZ(t,e,i=t_e()){return t==null||e==null?null:v6e(t,e,i).projector}function wMt(t,e){switch(zZ(t,e,jZ)){case zr:return"copy3";case Y_:return"wgs84ToSphericalECEF";case LE:return"wgs84ToWebMercator";case W_:return"wgs84ToPlateCarree";case Z_:return"wgs84ToWGS84ECEF";case zw:return"webMercatorToWGS84";case Y0e:return"webMercatorToSphericalECEF";case X0e:return"webMercatorToWGS84ECEF";case Z0e:return"webMercatorToPlateCarree";case J_:return"wgs84ECEFToWGS84";case Q0e:return"wgs84ECEFToSphericalECEF";case e_e:return"wgs84ECEFToWebMercator";case X_:return"sphericalECEFToWGS84";case J0e:return"sphericalECEFToWebMercator";case oG:return"sphericalMarsPCPFToMars2000";case sG:return"sphericalMoonPCPFToMoon2000";case K0e:return"sphericalECEFToWGS84ECEF";case nG:return"mars2000ToSphericalPCPF";case rG:return"moon2000ToSphericalPCPF";default:return null}}function sP(t,e){return t?e.spatialReference===t?e.spatialReferenceId:(e.spatialReference=t,"metersPerUnit"in e&&(e.metersPerUnit=Da(t,1)),P5(t)?e.spatialReferenceId=Z.SPHERICAL_ECEF:QR(t)?e.spatialReferenceId=Z.WGS84:ox(t)?e.spatialReferenceId=Z.WEB_MERCATOR:nZ(t)?e.spatialReferenceId=Z.PLATE_CARREE:t.wkt===cye.wkt?e.spatialReferenceId=Z.WGS84_ECEF:t.wkid===jh.CGCS2000?e.spatialReferenceId=Z.CGCS2000:t.wkt===m6.wkt?e.spatialReferenceId=Z.SPHERICAL_MARS_PCPF:t.wkt===g6.wkt?e.spatialReferenceId=Z.SPHERICAL_MOON_PCPF:km(t)?e.spatialReferenceId=Z.GCSMARS2000:Um(t)?e.spatialReferenceId=Z.GCSMOON2000:e.spatialReferenceId=Z.UNKNOWN):Z.UNKNOWN}function zr(t,e,i,r){t!==i&&(i[r++]=t[e++],i[r++]=t[e++],i[r]=t[e])}function zw(t,e,i,r){i[r++]=NE*(t[e++]/Ai.radius),i[r++]=NE*(Math.PI/2-2*Math.atan(Math.exp(-t[e++]/Ai.radius))),i[r]=t[e]}function Y0e(t,e,i,r){zw(t,e,i,r),Y_(i,r,i,r)}function X0e(t,e,i,r){zw(t,e,i,r),Z_(i,r,i,r)}function BZ(t,e,i,r,n){const s=.4999999*Math.PI,o=_e(DE*t[e+1],-s,s),a=Math.sin(o);i[r++]=DE*t[e]*n.radius,i[r++]=n.halfSemiMajorAxis*Math.log((1+a)/(1-a)),i[r]=t[e+2]}function LE(t,e,i,r){BZ(t,e,i,r,Ai)}const nre=Ai.radius*Math.PI/180,sre=180/(Ai.radius*Math.PI);function W_(t,e,i,r){i[r]=t[e]*nre,i[r+1]=t[e+1]*nre,i[r+2]=t[e+2]}function Ew(t,e,i,r){i[r]=t[e]*sre,i[r+1]=t[e+1]*sre,i[r+2]=t[e+2]}function Z0e(t,e,i,r){zw(t,e,i,r),W_(i,r,i,r)}function p6e(t,e,i,r){J_(t,e,i,r),W_(i,r,i,r)}function f6e(t,e,i,r){X_(t,e,i,r),W_(i,r,i,r)}function m6e(t,e,i,r){Ew(t,e,i,r),Y_(i,r,i,r)}function g6e(t,e,i,r){Ew(t,e,i,r),LE(i,r,i,r)}function y6e(t,e,i,r){Ew(t,e,i,r),Z_(i,r,i,r)}function VZ(t,e,i,r,n){const s=n+t[e+2],o=DE*t[e+1],a=DE*t[e],l=Math.cos(o);i[r++]=Math.cos(a)*l*s,i[r++]=Math.sin(a)*l*s,i[r]=Math.sin(o)*s}function rG(t,e,i,r){VZ(t,e,i,r,Ty.radius)}function nG(t,e,i,r){VZ(t,e,i,r,dm.radius)}function Y_(t,e,i,r){VZ(t,e,i,r,Ai.radius)}function GZ(t,e,i,r,n){const s=t[e],o=t[e+1],a=t[e+2],l=Math.sqrt(s*s+o*o+a*a),c=Qh(a/(l===0?1:l)),h=Math.atan2(o,s);i[r++]=NE*h,i[r++]=NE*c,i[r]=l-n}function sG(t,e,i,r){GZ(t,e,i,r,Ty.radius)}function oG(t,e,i,r){GZ(t,e,i,r,dm.radius)}function X_(t,e,i,r){GZ(t,e,i,r,Ai.radius)}function J0e(t,e,i,r){X_(t,e,i,r),LE(i,r,i,r)}function K0e(t,e,i,r){X_(t,e,i,r),Z_(i,r,i,r)}function _6e(t,e,i,r,n){const s=DE*t[e],o=DE*t[e+1],a=t[e+2],l=Math.sin(o),c=Math.cos(o),h=n.radius/Math.sqrt(1-n.eccentricitySquared*l*l);i[r++]=(h+a)*c*Math.cos(s),i[r++]=(h+a)*c*Math.sin(s),i[r++]=(h*(1-n.eccentricitySquared)+a)*l}function Z_(t,e,i,r){_6e(t,e,i,r,Ai)}function J_(t,e,i,r){const n=d6e,s=t[e],o=t[e+1],a=t[e+2];let l,c,h,d,f,m,y,_,v,w,x,T,S,C,A,R,D,N,k,B,L;l=Math.abs(a),c=s*s+o*o,h=Math.sqrt(c),d=c+a*a,f=Math.sqrt(d),B=Math.atan2(o,s),m=a*a/d,y=c/d,C=n.a2/f,A=n.a3-n.a4/f,y>.3?(_=l/f*(1+y*(n.a1+C+m*A)/f),k=Math.asin(_),w=_*_,v=Math.sqrt(1-w)):(v=h/f*(1-m*(n.a5-C-y*A)/f),k=Math.acos(v),w=1-v*v,_=Math.sqrt(w)),x=1-Ai.eccentricitySquared*w,T=Ai.radius/Math.sqrt(x),S=n.a6*T,C=h-T*v,A=l-S*_,D=v*C+_*A,R=v*A-_*C,N=R/(S/x+D),k+=N,L=D+R*N/2,a<0&&(k=-k),i[r++]=NE*B,i[r++]=NE*k,i[r]=L}function Q0e(t,e,i,r){J_(t,e,i,r),Y_(i,r,i,r)}function e_e(t,e,i,r){J_(t,e,i,r),LE(i,r,i,r)}function v6e(t,e,i){if(t==null||e==null||i.source.spatialReference===t&&i.dest.spatialReference===e)return i;const r=sP(t,i.source),n=sP(e,i.dest);return r===Z.UNKNOWN&&n===Z.UNKNOWN?Fn(t,e)?i.projector=zr:i.projector=null:i.projector=x2[r][n],i}function t_e(){return{source:{spatialReference:null,spatialReferenceId:Z.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:Z.UNKNOWN,metersPerUnit:1},projector:zr}}const i_e={spatialReference:null,spatialReferenceId:Z.UNKNOWN},b6e={spatialReference:null,spatialReferenceId:Z.UNKNOWN},jZ=t_e(),DE=Dt(1),NE=ml(1);function rn(t,e,i,r,n,s,o=1){const a=zZ(e,n,jZ);if(a==null)return!1;if(a===zr){if(t===r&&i===s)return!0;const c=i+3*o;for(let h=i,d=s;h<c;h++,d++)r[d]=t[h];return!0}const l=i+3*o;for(let c=i,h=s;c<l;c+=3,h+=3)a(t,c,r,h);return!0}const xMt=Object.freeze(Object.defineProperty({__proto__:null,projectBuffer:rn},Symbol.toStringTag,{value:"Module"}));function ore(t,e,i,r,n,s){return F$[0]=t,F$[1]=e,F$[2]=i,rn(F$,r,0,n,s,0,1)}const F$=E();let k$=0,Z8=class aG{static fromGE(e){const i=new aG;return i._wkt=e.wkt,i._wkid=e.wkid,i._isInverse=e.isInverse,i}constructor(e){this.uid=k$++,e?(this._wkt=e.wkt!=null?e.wkt:null,this._wkid=e.wkid!=null?e.wkid:-1,this._isInverse=e.isInverse!=null&&e.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=k$++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=k$++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=k$++}getInverse(){const e=new aG;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}},G5=class c3{static cacheKey(e,i){return[e.wkid?.toString()??"-1",e.wkt?.toString()??"",e.wkt2?.toString()??"",i.wkid?.toString()??"-1",i.wkt?.toString()??"",i.wkt2?.toString()??""].join()}static fromGE(e){const i=new c3;let r="";for(const n of e.steps){const s=Z8.fromGE(n);i.steps.push(s),r+=s.uid.toString()+","}return i._cachedProjection={},i._gtlistentry=null,i._chain=r,i}constructor(e){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,e?.steps)for(const i of e.steps)i instanceof Z8?this.steps.push(i):this.steps.push(new Z8({wkid:i.wkid,wkt:i.wkt,isInverse:i.isInverse}))}getInverse(){const e=new c3;e.steps=[];for(let i=this.steps.length-1;i>=0;i--){const r=this.steps[i];e.steps.push(r.getInverse())}return e}getGTListEntry(){let e="";for(const i of this.steps)e+=i.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=e),this._gtlistentry}assignCachedGe(e,i,r){this._cachedProjection[c3.cacheKey(e,i)]=r}getCachedGeTransformation(e,i){let r="";for(const s of this.steps)r+=s.uid.toString()+",";r!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=r);const n=this._cachedProjection[c3.cacheKey(e,i)];return n===void 0?null:n}};function w6e(t,e,i){if(e==null||i==null||i.vcsWkid||Fn(e,i)||vv(e)||vv(i))return null;const r=M5(e)/M5(i);if(r===1)return null;switch(t){case"point":case"esriGeometryPoint":return n=>x6e(n,r);case"polyline":case"esriGeometryPolyline":return n=>S6e(n,r);case"polygon":case"esriGeometryPolygon":return n=>T6e(n,r);case"multipoint":case"esriGeometryMultipoint":return n=>E6e(n,r);case"extent":case"esriGeometryEnvelope":return n=>C6e(n,r);default:return null}}function x6e(t,e){t?.z!=null&&(t.z*=e)}function T6e(t,e){if(t)for(const i of t.rings)for(const r of i)r.length>2&&(r[2]*=e)}function S6e(t,e){if(t)for(const i of t.paths)for(const r of i)r.length>2&&(r[2]*=e)}function E6e(t,e){if(t)for(const i of t.points)i.length>2&&(i[2]*=e)}function C6e(t,e){t&&t.zmin!=null&&t.zmax!=null&&(t.zmin*=e,t.zmax*=e)}let Ep=null,Sv=null,YO=null,tN={};const HZ=new hM;function bM(){return!!Ep&&iye()}function A6e(){return!!bM()||(Mt(HZ),FE(),!1)}function FE(t){return YO==null&&(YO=Promise.all([rye(),ce(()=>import("./geometryEngineBase-f6af2696.js"),[],import.meta.url).then(e=>e.g),ce(()=>import("./hydrated-67746186.js"),[],import.meta.url)])),YO.then(([,e,{hydratedAdapter:i}])=>{Tt(t),Sv=i,Ep=e.default,Ep._enableProjection(d4e),HZ.notify()})}function Bm(t,e,i=null,r=null){return Array.isArray(t)?t.length===0?[]:lG(Sv,t,t[0].spatialReference,e,i,r):lG(Sv,[t],t.spatialReference,e,i,r)[0]}function lG(t,e,i,r,n=null,s=null){if(i==null||r==null)return e;if($p(i,r,n))return e.map(o=>XO(o,i,r));if(n==null&&P5(i))return e.map(o=>XO(o,i,ze.WGS84)).map(o=>oP(o,r));if(n==null&&P5(r))return e.map(o=>oP(o,ze.WGS84)).map(o=>XO(o,ze.WGS84,r));if(n==null){const o=G5.cacheKey(i,r);tN[o]!==void 0?n=tN[o]:((n=n_e(i,r,void 0))==null&&(n=new G5),tN[o]=n)}if(Ep==null||t==null)throw new D6;return s!=null?Ep._project(t,e,i,r,n,s):Ep._project(t,e,i,r,n)}function O6e(t,e){const i=r_e([t],e);return i.pending!=null?{pending:i.pending,geometry:null}:i.geometries!=null?{pending:null,geometry:i.geometries[0]}:{pending:null,geometry:null}}function r_e(t,e){if(!bM()){for(const i of t)if(i!=null&&!Fn(i.spatialReference,e)&&Ra(i.spatialReference)&&Ra(e)&&!$p(i.spatialReference,e))return Mt(HZ),{pending:FE(),geometries:null}}return{pending:null,geometries:t.map(i=>i==null?null:Fn(i.spatialReference,e)?i:Ra(i.spatialReference)&&Ra(e)?oP(i,e):null)}}function n_e(t,e,i=null){if(t==null||e==null)return null;if(Ep==null||Sv==null)throw new D6;const r=Ep._getTransformation(Sv,t,e,i,i?.spatialReference);return r!==null?G5.fromGE(r):null}function R6e(t,e,i=null){if(Ep==null||Sv==null)throw new D6;const r=Ep._getTransformationBySuitability(Sv,t,e,i,i?.spatialReference);if(r!==null){const n=[];for(const s of r)n.push(G5.fromGE(s));return n}return[]}let D6=class extends G{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}};function P6e(){Ep=null,Sv=null,YO=null,tN={}}const M6e={get loadPromise(){return YO}};function oP(t,e){try{const i=Bm(t,e);if(i==null)return null;"xmin"in t&&"xmin"in i&&(i.zmin=t.zmin,i.zmax=t.zmax);const r=w6e(i.type,t.spatialReference,e);return r?.(i),i}catch(i){if(!(i instanceof D6))throw i;return null}}async function Am(t,e,i){const r=t.spatialReference;return r!=null&&e!=null&&await qZ(r,e,null,i),oP(t,e)}function $p(t,e,i){return!i&&(!!Fn(t,e)||Ra(t)&&Ra(e)&&!!zZ(t,e,jZ))}async function qZ(t,e,i,r){if(bM())return rie(r);if(Array.isArray(t)){for(const{source:n,dest:s,geographicTransformation:o}of t)if(!$p(n,s,o))return FE(r)}else if(!$p(t,e,i))return FE(r);return rie(r)}function XO(t,e,i){return t?"x"in t?o_e(t,e,new ut,i,0):"xmin"in t?u_e(t,e,new zi,i,0):"rings"in t?c_e(t,e,new Cm,i,0):"paths"in t?l_e(t,e,new gp,i,0):"points"in t?a_e(t,e,new TC,i,0):null:null}function s_e(t,e,i=e.spatialReference,r=0){return i!=null&&t.spatialReference!=null&&o_e(t,t.spatialReference,e,i,r)!=null}function o_e(t,e,i,r,n){sl[0]=t.x,sl[1]=t.y;const s=t.z;return sl[2]=s!==void 0?s:n,rn(sl,e,0,sl,r,0,1)?(i.x=sl[0],i.y=sl[1],i.spatialReference=r,s!==void 0||vv(r)?(i.z=sl[2],i.hasZ=!0):(i.z=void 0,i.hasZ=!1),t.m===void 0?(i.m=void 0,i.hasM=!1):(i.m=t.m,i.hasM=!0),i):null}function $6e(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&a_e(t,t.spatialReference,e,i,r)!=null}function a_e(t,e,i,r,n){const{points:s,hasZ:o,hasM:a}=t,l=[],c=s.length,h=[];for(const f of s)h.push(f[0],f[1],o?f[2]:n);if(!rn(h,e,0,h,r,0,c))return null;const d=o||vv(r);for(let f=0;f<c;++f){const m=3*f,y=h[m],_=h[m+1];d&&a?l.push([y,_,h[m+2],s[f][3]]):d?l.push([y,_,h[m+2]]):a?l.push([y,_,s[f][2]]):l.push([y,_])}return i.points=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i}function I6e(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&l_e(t,t.spatialReference,e,i,r)!=null}function l_e(t,e,i,r,n){const{paths:s,hasZ:o,hasM:a}=t,l=[];if(!h_e(s,o??!1,a??!1,e,l,r,n))return null;const c=o||vv(r);return i.paths=l,i.spatialReference=r,i.hasZ=c,i.hasM=a,i}function L6e(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&c_e(t,t.spatialReference,e,i,r)!=null}function c_e(t,e,i,r,n){const{rings:s,hasZ:o,hasM:a}=t,l=[];if(!h_e(s,o??!1,a??!1,e,l,r,n))return null;const c=o||vv(r);return i.rings=l,i.spatialReference=r,i.hasZ=c,i.hasM=a,i}function D6e(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&u_e(t,t.spatialReference,e,i,r)!=null}function u_e(t,e,i,r,n){const{xmin:s,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:h}=t,d=c?t.zmin:n;if(!ore(s,o,d,e,sl,r))return null;const f=c||vv(r);i.xmin=sl[0],i.ymin=sl[1],f&&(i.zmin=sl[2]);const m=c?t.zmax:n;return ore(a,l,m,e,sl,r)?(i.xmax=sl[0],i.ymax=sl[1],f&&(i.zmax=sl[2]),h&&(i.mmin=t.mmin,i.mmax=t.mmax),i.spatialReference=r,i):null}function h_e(t,e,i,r,n,s,o=0){const a=new Array;for(const h of t)for(const d of h)a.push(d[0],d[1],e?d[2]:o);if(!rn(a,r,0,a,s,0,a.length/3))return!1;let l=0;n.length=0;const c=e||vv(s);for(const h of t){const d=new Array;for(const f of h)c&&i?d.push([a[l++],a[l++],a[l++],f[3]]):c?d.push([a[l++],a[l++],a[l++]]):i?(d.push([a[l++],a[l++],f[2]]),l++):(d.push([a[l++],a[l++]]),l++);n.push(d)}return!0}function Ev(t){return t!=null&&W0e(t)!=null}const sl=E(),SMt=Object.freeze(Object.defineProperty({__proto__:null,canProjectToWGS84ComparableLonLat:Ev,canProjectWithoutEngine:$p,getTransformation:n_e,getTransformations:R6e,initializeProjection:qZ,isLoaded:bM,isLoadedOrLoad:A6e,load:FE,project:Bm,projectExtent:D6e,projectMany:lG,projectMultipoint:$6e,projectOrLoad:O6e,projectOrLoadMany:r_e,projectPoint:s_e,projectPolygon:L6e,projectPolyline:I6e,projectWithZConversion:Am,projectWithoutEngine:XO,test:M6e,tryProjectWithZConversion:oP,unload:P6e},Symbol.toStringTag,{value:"Module"}));function Cv(t,e){const i=e?.url?.path;if(t&&i&&(t=ul(t,i,{preserveProtocolRelative:!0}),e.portalItem&&e.readResourcePaths)){const r=jX(t,e.portalItem.itemUrl);r!=null&&N6e.test(r)&&e.readResourcePaths.push(e.portalItem.resourceFromPath(r).path)}return cG(t,e?.portal)}function mx(t,e,i=aP.YES){if(t==null)return t;!Vu(t)&&e?.blockedRelativeUrls&&e.blockedRelativeUrls.push(t);let r=ul(t);if(e){const n=e.verifyItemRelativeUrls?.rootPath||e.url?.path;if(n){const s=cG(n,e.portal),o=cG(r,e.portal);r=jX(o,s,s),r!=null&&r!==o&&r!==t&&e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.push(r)}}return r=p_e(r,e?.portal),Vu(r)&&(r=Bu(r)),e?.resources&&e?.portalItem&&!Vu(r)&&!Fm(r)&&i===aP.YES&&e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(r),compress:!1}),r}function WZ(t,e,i){return Cv(t,i)}function Av(t,e,i,r){const n=mx(t,r);n!==void 0&&(e[i]=n)}const d_e=/\/items\/([^\/]+)\/resources\/(.*)/,N6e=/^\.\/resources\//;function F6e(t){return(t?.match(d_e)??null)?.[1]??null}function k6e(t){const e=t?.match(d_e)??null;if(e==null)return null;const i=e[2],r=i.lastIndexOf("/");if(r===-1){const{path:o,extension:a}=gie(i);return{prefix:null,filename:o,extension:a}}const{path:n,extension:s}=gie(i.slice(r+1));return{prefix:i.slice(0,r),filename:n,extension:s}}function p_e(t,e){return e&&!e.isPortal&&e.urlKey&&e.customBaseUrl?b7(t,`${e.urlKey}.${e.customBaseUrl}`,e.portalHostname):t}function cG(t,e){if(!e||e.isPortal||!e.urlKey||!e.customBaseUrl)return t;const i=`${e.urlKey}.${e.customBaseUrl}`,r=BX();return Ec(r,`${r.scheme}://${i}`)?b7(t,e.portalHostname,i):b7(t,i,e.portalHostname)}var aP;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})(aP||(aP={}));const EMt=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return aP},ensureMainOnlineDomain:p_e,fromJSON:Cv,itemIdFromResourceUrl:F6e,prefixAndFilenameFromResourceUrl:k6e,read:WZ,toJSON:mx,write:Av},Symbol.toStringTag,{value:"Module"})),f_e={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},m_e=Object.values(f_e),g_e=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${m_e.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),U6e=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${m_e.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),z6e=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function CMt(t){return!!g_e.test(t)}function N6(t){if(t==null)return null;const e=Nn(t),i=e?.path.match(g_e)||e?.path.match(U6e);if(!i)return null;const[,r,n,s,o]=i,a=n.indexOf("/");return{title:y_e(a!==-1?n.slice(a+1):n),serverType:f_e[s.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:r}}}function B6e(t){const e=Nn(t).path.match(z6e);return e?{serviceUrl:e[1],sublayerId:Number(e[2])}:null}function y_e(t){return(t=t.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+t.slice(1)}function AMt(t,e){const i=[];if(t){const r=N6(t);r!=null&&r.title&&i.push(r.title)}if(e){const r=y_e(e);i.push(r)}if(i.length===2){if(i[0].toLowerCase().includes(i[1].toLowerCase()))return i[0];if(i[1].toLowerCase().includes(i[0].toLowerCase()))return i[1]}return i.join(" - ")}function OMt(t){if(!t)return!1;const e=".arcgis.com/",i="//services",r="//tiles",n="//features",s=(t=t.toLowerCase()).includes(e),o=t.includes(i)||t.includes(r)||t.includes(n);return s&&o}function V6e(t,e){return t&&Bge(Gge(t,e))}function RMt(t){let{url:e}=t;if(!e)return{url:e};e=Gge(e,t.logger);const i=Nn(e),r=N6(i.path);let n;if(r!=null)r.sublayer!=null&&t.layer.layerId==null&&(n=r.sublayer),e=r.url.path;else if(t.nonStandardUrlAllowed){const s=B6e(i.path);s!=null&&(e=s.serviceUrl,n=s.sublayerId)}return{url:Bge(e),layerId:n}}function PMt(t,e,i,r,n){Av(e,r,"url",n),r.url&&t.layerId!=null&&(r.url=Nm(r.url,i,t.layerId.toString()))}function MMt(t){if(!t)return!1;const e=t.toLowerCase(),i=e.includes("/services/"),r=e.includes("/mapserver/wmsserver"),n=e.includes("/imageserver/wmsserver"),s=e.includes("/wmsserver");return i&&(r||n||s)}function G6e(t,e){if(!t)return null;if(!uG(t))return new G("webscene:unsupported-height-model-info","The vertical coordinate system of the scene is not supported",{heightModelInfo:t});const i=t.heightUnit,r=zx.deriveUnitFromSR(t,e).heightUnit;return i!==r?new G("webscene:incompatible-height-unit",`The vertical units of the scene (${i}) must match the horizontal units of the scene (${r})`,{verticalUnit:i,horizontalUnit:r}):null}function $Mt(t,e,i){const r=__e(t),n=e,s=j6e(r,n,i);if(r){const o=zx.deriveUnitFromSR(r,t.spatialReference).heightUnit;if(!i&&o!==r.heightUnit){const a=new G("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new G("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r,error:a})}}if(!H6e(t)||s===Ac.Unsupported)return new G("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r});switch(s){case Ac.Units:{const o=r?.heightUnit||"unknown",a=n?.heightUnit||"unknown",l=new G("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new G("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:n,error:l})}case Ac.HeightModel:{const o=r?.heightModel||"unknown",a=n?.heightModel||"unknown",l=new G("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new G("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:n,error:l})}case Ac.CRS:{const o=r?.vertCRS||"unknown",a=n?.vertCRS||"unknown",l=new G("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new G("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:n,error:l})}}return null}function j6e(t,e,i){if(!uG(t)||!uG(e))return Ac.Unsupported;if(t==null||e==null)return Ac.Ok;if(!i&&t.heightUnit!==e.heightUnit)return Ac.Units;if(t.heightModel!==e.heightModel)return Ac.HeightModel;switch(t.heightModel){case"gravity-related-height":return Ac.Ok;case"ellipsoidal":return t.vertCRS===e.vertCRS?Ac.Ok:Ac.CRS;default:return Ac.Unsupported}}var Ac;function uG(t){return t==null||t.heightModel!=null&&t.heightUnit!=null}function H6e(t){return"heightModelInfo"in t&&t.heightModelInfo!=null||t.spatialReference!=null||!w_e(t)}function __e(t){const e=t.url?N6(t.url):void 0;return!(t.spatialReference?.vcsWkid==null&&e!=null&&e.serverType==="ImageServer")&&v_e(t)&&t.heightModelInfo?t.heightModelInfo:w_e(t)?zx.deriveUnitFromSR(W6e,t.spatialReference):null}function v_e(t){return"heightModelInfo"in t}function b_e(t){if(t.type==="unknown"||!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function w_e(t){return b_e(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):x_e(t)}function q6e(t){return t.layers!=null||x_e(t)||b_e(t)||v_e(t)}function x_e(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(t){t[t.Ok=0]="Ok",t[t.Units=1]="Units",t[t.HeightModel=2]="HeightModel",t[t.CRS=3]="CRS",t[t.Unsupported=4]="Unsupported"})(Ac||(Ac={}));const W6e=new zx({heightModel:"gravity-related-height"});async function Y6e(t){const e=t.spatialReference;if(e.isWGS84)return t.clone();if(e.isWebMercator)return w2(t);const i=ze.WGS84;return await qZ(e,i),Bm(t,i)}function X6e(t,e){if(!T_e(t,e)){const i=t.typeKeywords;i?i.push(e):t.typeKeywords=[e]}}function T_e(t,e){return!!t.typeKeywords?.includes(e)}function IMt(t){return T_e(t,hG.HOSTED_SERVICE)}function Z6e(t,e){const i=t.typeKeywords;if(i){const r=i.indexOf(e);r>-1&&i.splice(r,1)}}function are(t,e,i){i?X6e(t,e):Z6e(t,e)}async function LMt(t){const e=t.clone().normalize();let i;if(e.length>1)for(const r of e)i?r.width>i.width&&(i=r):i=r;else i=e[0];return Y6e(i)}const hG={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service",LOCAL_SCENE:"ViewingMode-Local",TILED_IMAGERY:"Tiled Imagery",GROUP_LAYER_MAP:"Map"};function lre(t){const{portal:e,isOrgItem:i,itemControl:r}=t,n=e.user?.privileges;let s=!n||n.includes("features:user:edit"),o=!!i&&!!n?.includes("features:user:fullEdit");const a=r==="update"||r==="admin";return a?o=s=!0:o&&(s=!0),{features:{edit:s,fullEdit:o},content:{updateItem:a}}}let J0=class extends pe{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};u([p({type:String,json:{write:!0}})],J0.prototype,"facilityIdField",void 0),u([p({type:String,json:{write:!0}})],J0.prototype,"layerId",void 0),u([p({type:String,json:{write:!0}})],J0.prototype,"nameField",void 0),u([p({type:String,json:{write:!0}})],J0.prototype,"siteIdField",void 0),u([p({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],J0.prototype,"sublayerId",void 0),J0=u([M("esri.layers.support.FacilityLayerInfo")],J0);const J6e=J0;let Dd=class extends pe{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.levelIdField=null,this.levelNumberField=null,this.longNameField=null,this.shortNameField=null,this.sublayerId=null,this.verticalOrderField=null}};u([p({type:String,json:{write:!0}})],Dd.prototype,"facilityIdField",void 0),u([p({type:String,json:{write:!0}})],Dd.prototype,"layerId",void 0),u([p({type:String,json:{write:!0}})],Dd.prototype,"levelIdField",void 0),u([p({type:String,json:{write:!0}})],Dd.prototype,"levelNumberField",void 0),u([p({type:String,json:{write:!0}})],Dd.prototype,"longNameField",void 0),u([p({type:String,json:{write:!0}})],Dd.prototype,"shortNameField",void 0),u([p({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],Dd.prototype,"sublayerId",void 0),u([p({type:String,json:{write:!0}})],Dd.prototype,"verticalOrderField",void 0),Dd=u([M("esri.layers.support.LevelLayerInfo")],Dd);const K6e=Dd;let lb=class extends pe{constructor(e){super(e),this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};u([p({type:String,json:{write:!0}})],lb.prototype,"layerId",void 0),u([p({type:String,json:{write:!0}})],lb.prototype,"nameField",void 0),u([p({type:String,json:{write:!0}})],lb.prototype,"siteIdField",void 0),u([p({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],lb.prototype,"sublayerId",void 0),lb=u([M("esri.layers.support.SiteLayerInfo")],lb);const Q6e=lb;let ES=class extends pe{constructor(e){super(e),this.levelLayer=null,this.facilityLayer=null,this.siteLayer=null}};u([p({type:K6e,json:{write:!0}})],ES.prototype,"levelLayer",void 0),u([p({type:J6e,json:{write:!0}})],ES.prototype,"facilityLayer",void 0),u([p({type:Q6e,json:{write:!0}})],ES.prototype,"siteLayer",void 0),ES=u([M("esri.support.MapFloorInfo")],ES);const eUe=ES,tUe=Symbol("WebScene"),iUe="webscene:failed-to-copy-embedded-resources",rUe="webscene:schema-validation";function nUe(){return new G(iUe,"Copying of embedded resources is currently not supported")}function sUe(t){return new G(rUe,"Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:t})}var Le;function cre(t){return t==="global"?Le.Global:Le.Local}function J8(t){return t===Le.Global?"global":"local"}(function(t){t[t.Global=1]="Global",t[t.Local=2]="Local"})(Le||(Le={}));function lP(t,e){return t!=null&&(e==null||(e===Le.Local?!t.isGeographic||t.isWGS84||t.wkid===jh.CGCS2000:t.isWebMercator||t.isWGS84||t.wkid===jh.CGCS2000||t.wkid===jh.GCSMARS2000||t.wkid===jh.GCSMARS2000_SPHERE||t.wkid===jh.GCSMOON2000))}var nm;(function(t){t[t.SAVE=0]="SAVE",t[t.SAVE_AS=1]="SAVE_AS"})(nm||(nm={}));function ure(t){if(Di.apiKey&&ZX(t.portal.url))throw new G("save-api-key-utils:api-key-not-supported",`Saving is not supported on ${t.portal.url} when using an api key`)}const oUe="randomUUID"in crypto;function YZ(){if(oUe)return crypto.randomUUID();const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=i=>t[i].toString(16).padStart(4,"0");return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}function UMt(){return`{${YZ()}}`}async function aUe(t,e={},i){await t.load(i);const r=Nm(t.itemUrl,"resources"),{start:n=1,num:s=10,sortOrder:o="asc",sortField:a="created"}=e,l={query:{start:n,num:s,sortOrder:o,sortField:a,token:t.apiKey},signal:i?.signal},c=await t.portal.request(r,l);return{total:c.total,nextStart:c.nextStart,resources:c.resources.map(({created:h,size:d,resource:f})=>({created:new Date(h),size:d,resource:t.resourceFromPath(f)}))}}async function lUe(t,e,i,r){if(!t.hasPath())throw new G(`portal-item-resource-${e}:invalid-path`,"Resource does not have a valid path");const n=t.portalItem;await n.load(r);const s=Nm(n.userItemUrl,e==="add"?"addResources":"updateResources"),[o,a]=S_e(t.path),l=new FormData;return o&&o!=="."&&l.append("resourcesPrefix",o),r!=null&&r.compress&&l.append("compress","true"),l.append("fileName",a),l.append("file",i,a),l.append("f","json"),r?.access&&l.append("access",r.access),await n.portal.request(s,{method:"post",body:l,signal:r?.signal}),t}async function cUe(t,e,i){if(!e.hasPath())throw new G("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await t.load(i);const r=Nm(t.userItemUrl,"removeResources");await t.portal.request(r,{method:"post",query:{resource:e.path},signal:i?.signal}),e.portalItem=null}async function uUe(t,e){await t.load(e);const i=Nm(t.userItemUrl,"removeResources");return t.portal.request(i,{method:"post",query:{deleteAll:!0},signal:e?.signal})}function S_e(t){const e=t.lastIndexOf("/");return e===-1?[".",t]:[t.slice(0,e),t.slice(e+1)]}function XZ(t){const[e,i]=hUe(t),[r,n]=S_e(e);return[r,n,i]}function hUe(t){const e=RNe(t);return e==null?[t,""]:[t.slice(0,t.length-e.length-1),`.${e}`]}async function ZZ(t){return t.type==="blob"?t.blob:t.type==="json"?new Blob([t.jsonString],{type:"application/json"}):(await _i(t.url,{responseType:"blob"})).data}function dUe(t,e){if(!t.hasPath())return null;const[i,,r]=XZ(t.path);return t.portalItem.resourceFromPath(Nm(i,e+r))}function E_e(t,e){if(!t.hasPath())return null;const[i,,r]=XZ(t.path);return t.portalItem.resourceFromPath(Nm(i,e+r))}const u3=Object.freeze(Object.defineProperty({__proto__:null,addOrUpdateResource:lUe,contentToBlob:ZZ,fetchResources:aUe,getSiblingOfSameType:dUe,getSiblingOfSameTypeI:E_e,removeAllResources:uUe,removeResource:cUe,splitPrefixFileNameAndExtension:XZ},Symbol.toStringTag,{value:"Module"}));async function pUe(t,e,i=null){const r=await C_e(t,e,i);await A_e(r,e,i)}async function fUe(t,e,i,r,n=null){const s=await C_e(i,r,n);await t.update({data:e}),await A_e(s,r,n)}async function C_e(t,e,i=null){if(!e?.resources)return;const r=e.portalItem===t.portalItem?new Set(t.paths):new Set;t.paths.length=0,t.portalItem=e.portalItem;const n=new Set(e.resources.toKeep.map(l=>l.resource.path)),s=new Set,o=[];n.forEach(l=>{r.delete(l),t.paths.push(l)});for(const l of e.resources.toUpdate)if(r.delete(l.resource.path),n.has(l.resource.path)||s.has(l.resource.path)){const{resource:c,content:h,finish:d,error:f}=l,m=E_e(c,YZ());t.paths.push(m.path),o.push(hre({resource:m,content:h,compress:l.compress,finish:d,error:f},i))}else t.paths.push(l.resource.path),o.push(mUe(l,i)),s.add(l.resource.path);for(const l of e.resources.toAdd)t.paths.push(l.resource.path),r.has(l.resource.path)?r.delete(l.resource.path):o.push(hre(l,i));if(o.length===0)return r;const a=await HLe(o);if(Tt(i),a.length>0)throw new G("save:resources","Failed to save one or more resources",{errors:a});return r}async function A_e(t,e,i=null){if(!t||!e.portalItem)return;const r=[];for(const n of t){const s=e.portalItem.resourceFromPath(n);r.push(s.portalItem.removeResource(s,i))}await oM(r)}async function hre(t,e){const i={...e??{},compress:t.compress},r=await jc(t.resource.portalItem.addResource(t.resource,await ZZ(t.content),i));if(r.ok!==!0)throw t.error?.(r.error),r.error;t.finish?.(t.resource)}async function mUe(t,e){const i=await jc(t.resource.update(await ZZ(t.content),e));if(i.ok!==!0)throw t.error?.(i.error),i.error;t.finish?.(t.resource)}async function zMt(t){const e=[];for(const i of t.allLayers)if("beforeSave"in i&&typeof i.beforeSave=="function"){const r=i.beforeSave();r&&e.push(r)}await Promise.allSettled(e)}const gUe={width:600,height:400},U$=1.5;function yUe(t,e){e=e||gUe;let{width:i,height:r}=e;const n=i/r;return n<U$?r=i/U$:n>U$&&(i=r*U$),i>t.width&&(r*=t.width/i,i=t.width),r>t.height&&(i*=t.height/r,r=t.height),{width:Math.round(i),height:Math.round(r)}}function dre(t){return{enabled:!!t?.length}}const JZ=new Sr({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"});var dG;let CS=dG=class extends pe{constructor(t){super(t),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new dG({exactMatch:this.exactMatch,type:this.type,name:this.name})}};u([p({type:Boolean,json:{write:!0}})],CS.prototype,"exactMatch",void 0),u([p({type:String,json:{write:!0}})],CS.prototype,"name",void 0),u([nt(JZ)],CS.prototype,"type",void 0),CS=dG=u([M("esri.webdoc.applicationProperties.SearchLayerField")],CS);const _Ue=CS;var pG;let AS=pG=class extends pe{constructor(t){super(t),this.field=null,this.id=null,this.subLayer=null}clone(){return new pG(Q({field:this.field,id:this.id,subLayer:this.subLayer}))}};u([p({type:_Ue,json:{write:{isRequired:!0}}})],AS.prototype,"field",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],AS.prototype,"id",void 0),u([p({type:dr,json:{write:!0}})],AS.prototype,"subLayer",void 0),AS=pG=u([M("esri.webdoc.applicationProperties.SearchLayer")],AS);const vUe=AS;var fG;let OS=fG=class extends pe{constructor(t){super(t),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new fG({exactMatch:this.exactMatch,type:this.type,name:this.name})}};u([p({type:Boolean,json:{write:!0}})],OS.prototype,"exactMatch",void 0),u([p({type:String,json:{write:!0}})],OS.prototype,"name",void 0),u([nt(JZ)],OS.prototype,"type",void 0),OS=fG=u([M("esri.webdoc.applicationProperties.SearchTableField")],OS);const bUe=OS;var mG;let h3=mG=class extends pe{constructor(t){super(t),this.field=null,this.id=null}clone(){return new mG(Q({field:this.field,id:this.id}))}};u([p({type:bUe,json:{write:{isRequired:!0}}})],h3.prototype,"field",void 0),u([p({type:String,json:{write:{isRequired:!0}}})],h3.prototype,"id",void 0),h3=mG=u([M("esri.webdoc.applicationProperties.SearchTable")],h3);const wUe=h3;var gG;const O_e=Je.ofType(vUe),R_e=Je.ofType(wUe);let Tf=gG=class extends pe{constructor(t){super(t),this.addressSearchEnabled=!0,this.enabled=!0,this.hintText=null,this.layers=new O_e,this.tables=new R_e}readAddressSearchEnabled(t){return!t}writeAddressSearchEnabled(t,e,i){e[i]=!t}clone(){return new gG(Q({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,tables:this.tables}))}};u([p({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],Tf.prototype,"addressSearchEnabled",void 0),u([wt("addressSearchEnabled")],Tf.prototype,"readAddressSearchEnabled",null),u([Be("addressSearchEnabled")],Tf.prototype,"writeAddressSearchEnabled",null),u([p({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],Tf.prototype,"enabled",void 0),u([p({type:String,json:{write:!0}})],Tf.prototype,"hintText",void 0),u([p({type:O_e,json:{write:{overridePolicy:dre},origins:{"web-scene":{write:{isRequired:!0}}}}})],Tf.prototype,"layers",void 0),u([p({type:R_e,json:{read:!0,write:{overridePolicy:dre}}})],Tf.prototype,"tables",void 0),Tf=gG=u([M("esri.webdoc.applicationProperties.Search")],Tf);const xUe=Tf;var yG;let iN=yG=class extends pe{constructor(t){super(t),this.search=null}clone(){return new yG(Q({search:this.search}))}};u([p({type:xUe,json:{write:!0}})],iN.prototype,"search",void 0),iN=yG=u([M("esri.webdoc.applicationProperties.Viewing")],iN);const TUe=iN;var _G;let rN=_G=class extends pe{constructor(t){super(t),this.viewing=null}clone(){return new _G({viewing:this.viewing?this.viewing.clone():null})}};u([p({type:TUe,json:{write:!0}})],rN.prototype,"viewing",void 0),rN=_G=u([M("esri.webscene.ApplicationProperties")],rN);const SUe=rN;var vG;let d3=vG=class extends pe{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new vG({cloudCover:this.cloudCover})}};u([nt({sunny:"sunny"})],d3.prototype,"type",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],d3.prototype,"cloudCover",void 0),d3=vG=u([M("esri.views.3d.environment.SunnyWeather")],d3);const j5=d3;var bG;let p3=bG=class extends pe{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new bG({cloudCover:this.cloudCover})}};u([nt({cloudy:"cloudy"})],p3.prototype,"type",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],p3.prototype,"cloudCover",void 0),p3=bG=u([M("esri.views.3d.environment.CloudyWeather")],p3);const EUe=p3;var wG;let f3=wG=class extends pe{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new wG({fogStrength:this.fogStrength})}};u([nt({foggy:"foggy"})],f3.prototype,"type",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],f3.prototype,"fogStrength",void 0),f3=wG=u([M("esri.views.3d.environment.FoggyWeather")],f3);const CUe=f3;var xG;let RS=xG=class extends pe{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new xG({cloudCover:this.cloudCover,precipitation:this.precipitation})}};u([nt({rainy:"rainy"})],RS.prototype,"type",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],RS.prototype,"cloudCover",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],RS.prototype,"precipitation",void 0),RS=xG=u([M("esri.views.3d.environment.RainyWeather")],RS);const AUe=RS;var TG;let cb=TG=class extends pe{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new TG({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};u([nt({snowy:"snowy"})],cb.prototype,"type",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],cb.prototype,"cloudCover",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],cb.prototype,"precipitation",void 0),u([p({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],cb.prototype,"snowCover",void 0),cb=TG=u([M("esri.views.3d.environment.SnowyWeather")],cb);const OUe=cb,KZ={key:"type",base:j5,typeMap:{sunny:j5,cloudy:EUe,rainy:AUe,snowy:OUe,foggy:CUe}},RUe=Object.keys(KZ.typeMap);function PUe(t,e){return!!RUe.includes(t)||(e.error(`"${t}" is not a valid weather type`),!1)}const qg=1e4,MUe=1e5;var SG;let _h=SG=class extends pe{constructor(t){super(t),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(t,e){return e.datetime!=null&&new Date(e.datetime)||null}writeDate(t,e,i){e[i]=t.getTime()}readDirectShadowsEnabled(t,e){return!!e.directShadows}writedirectShadowsEnabled(t,e,i){t&&(e[i]=t)}writeDisplayUTCOffset(t,e){t!=null&&(e.displayUTCOffset=t)}clone(){return new SG(this.cloneConstructProperties())}cloneConstructProperties(){const t={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(t.date=new Date(this.date.getTime())),t}};u([p({readOnly:!0,type:["sun"],json:{write:!0}})],_h.prototype,"type",void 0),u([p({type:Date,json:{type:Number,write:{target:"datetime"}}})],_h.prototype,"date",void 0),u([wt("date",["datetime"])],_h.prototype,"readDate",null),u([Be("date")],_h.prototype,"writeDate",null),u([p({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],_h.prototype,"directShadowsEnabled",void 0),u([wt("directShadowsEnabled",["directShadows"])],_h.prototype,"readDirectShadowsEnabled",null),u([Be("directShadowsEnabled")],_h.prototype,"writedirectShadowsEnabled",null),u([p({type:Number,json:{write:!0}})],_h.prototype,"displayUTCOffset",void 0),u([Be("displayUTCOffset")],_h.prototype,"writeDisplayUTCOffset",null),_h=SG=u([M("esri.webscene.SunLighting")],_h);const gx=_h;var EG;let m3=EG=class extends pe{constructor(t){super(t),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new EG(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};u([p({readOnly:!0,type:["virtual"],json:{write:!0}})],m3.prototype,"type",void 0),u([p({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],m3.prototype,"directShadowsEnabled",void 0),m3=EG=u([M("esri.webscene.VirtualLighting")],m3);const wM=m3,P_e={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:gx,virtual:wM}};let nN=class extends pe{constructor(e){super(e)}clone(){}};u([p({readOnly:!0,json:{read:!1}})],nN.prototype,"type",void 0),nN=u([M("esri.webscene.background.Background")],nN);const M_e=nN;function $Ue(t,e){const i=e.transparency!=null?RE(e.transparency):1,r=e.color;return r&&Array.isArray(r)?new Pe([r[0]||0,r[1]||0,r[2]||0,i]):null}function IUe(t,e){e.color=t.toJSON().slice(0,3);const i=S6(t.a);i!==0&&(e.transparency=i)}const ky={type:Pe,json:{type:[dr],default:null,read:{source:["color","transparency"],reader:$Ue},write:{target:{color:{type:[dr]},transparency:{type:dr}},writer:IUe}}},Om={type:Number,cast:sr,json:{write:!0}};var CG;const LUe={...ky,nonNullable:!0};let g3=CG=class extends M_e{constructor(t){super(t),this.type="color",this.color=new Pe([0,0,0,1])}clone(){return new CG(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};u([nt({color:"color"},{readOnly:!0})],g3.prototype,"type",void 0),u([p(LUe)],g3.prototype,"color",void 0),g3=CG=u([M("esri.webscene.background.ColorBackground")],g3);const $_e=g3,pre={base:M_e,key:"type",typeMap:{color:$_e}};function DUe(t){return(e,i,r)=>{if(!e)return e;for(const n in t.typeMap)if(e.type===n){const s=new t.typeMap[n];return s.read(e,r),s}}}const NUe={types:pre,json:{read:DUe(pre),write:{overridePolicy:(t,e,i)=>({enabled:!i||!i.isPresentation})}}};var AG;const I_e="esri.webscene.Environment",FUe=K.getLogger(I_e),fre=(t,e,i)=>({enabled:!i||!i.isPresentation});let K0=AG=class extends pe{constructor(t){super(t),this.lighting=new gx,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(t){PUe(t?.type,FUe)&&this._set("weather",t)}clone(){return new AG(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?wM.prototype.clone.call(this.lighting):gx.prototype.clone.call(this.lighting),background:Q(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};u([p({types:P_e,nonNullable:!0,json:{write:!0}})],K0.prototype,"lighting",void 0),u([p(NUe)],K0.prototype,"background",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:fre}}})],K0.prototype,"atmosphereEnabled",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:fre}}})],K0.prototype,"starsEnabled",void 0),u([p({types:KZ,nonNullable:!0,json:{write:!0},value:new j5})],K0.prototype,"weather",null),K0=AG=u([M(I_e)],K0);const kE=K0;var OG;let ub=OG=class extends pe{constructor(t){super(t),this.environment=new kE,this.spatialReference=null,this.viewpoint=null}set viewingMode(t){this._set("viewingMode",t)}clone(){return new OG({environment:this.environment.clone(),spatialReference:this.spatialReference?this.spatialReference.clone():null,viewingMode:this.viewingMode,viewpoint:this.viewpoint?this.viewpoint.clone():null})}};u([p({type:kE,json:{write:{isRequired:!0}}})],ub.prototype,"environment",void 0),u([p({type:ze})],ub.prototype,"spatialReference",void 0),u([p({type:["local","global"]})],ub.prototype,"viewingMode",null),u([p({type:qc,json:{write:{isRequired:!0}}})],ub.prototype,"viewpoint",void 0),ub=OG=u([M("esri.webscene.InitialViewProperties")],ub);const H5=ub;let kUe=class{constructor(e,i){this._observable=new hM,this._value=e,this._equalityFunction=i}get value(){return Mt(this._observable),this._value}set value(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}mutate(e){e(this._value),this._observable.notify()}};function UE(t,e=Mme){return new kUe(t,e)}let UUe=class{constructor(){this._tasks=new Array,this._running=UE(!1)}get length(){return this._tasks.length}get running(){return this._running.value}destroy(){this.cancelAll()}runTask(e){for(;!e.done&&this._process(e);)e.madeProgress()}push(e,i,r){return this._running.value=!0,new Promise((n,s)=>this._tasks.push(new mre(n,s,e,i,r)))}unshift(e,i,r){return this._running.value=!0,new Promise((n,s)=>this._tasks.unshift(new mre(n,s,e,i,r)))}_process(e){if(this._tasks.length===0)return!1;const i=this._tasks.shift();try{const r=ps(i.signal);if(r&&!i.abortCallback)i.reject(Ti());else{const n=r?i.abortCallback?.(Ti()):i.callback(e);Zc(n)?n.then(i.resolve,i.reject):i.resolve(n)}}catch(r){i.reject(r)}return this._running.value=this._tasks.length>0,!0}cancelAll(){const e=Ti();for(const i of this._tasks)if(i.abortCallback){const r=i.abortCallback(e);i.resolve(r)}else i.reject(e);this._tasks.length=0,this._running.value=!1}},mre=class{constructor(e,i,r,n=void 0,s=void 0){this.resolve=e,this.reject=i,this.callback=r,this.signal=n,this.abortCallback=s}},y3=class extends we{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};u([p()],y3.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),u([p()],y3.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),y3=u([M("esri.views.support.DebugFlags")],y3);const zUe=new y3;var Li;(function(t){t[t.ANIMATING=0]="ANIMATING",t[t.INTERACTING=1]="INTERACTING",t[t.IDLE=2]="IDLE"})(Li||(Li={}));function BUe(){return new q5.Scheduler}var ca,pt;(function(t){t[t.YIELD=1]="YIELD"})(ca||(ca={})),function(t){t.RESOURCE_CONTROLLER_IMMEDIATE="immediate",t.RESOURCE_CONTROLLER="schedule",t.SLIDE="slide",t.STREAM_DATA_LOADER="stream loader",t.ELEVATION_QUERY="elevation query",t.TERRAIN_SURFACE="terrain",t.SURFACE_GEOMETRY_UPDATES="surface geometry updates",t.LOD_RENDERER="LoD renderer",t.GRAPHICS_CORE="Graphics3D",t.I3S_CONTROLLER="I3S",t.POINT_CLOUD_LAYER="point cloud",t.FEATURE_TILE_FETCHER="feature fetcher",t.OVERLAY="overlay",t.STAGE="stage",t.GRAPHICS_DECONFLICTOR="graphics deconflictor",t.FILTER_VISIBILITY="Graphics3D filter visibility",t.SCALE_VISIBILITY="Graphics3D scale visibility",t.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",t.POINT_OF_INTEREST_FREQUENT="POI frequent",t.POINT_OF_INTEREST_INFREQUENT="POI infrequent",t.LABELER="labeler",t.FEATURE_QUERY_ENGINE="feature query",t.FEATURE_TILE_TREE="feature tile tree",t.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",t.ELEVATION_ALIGNMENT="elevation alignment",t.TEXT_TEXTURE_ATLAS="text texture atlas",t.TEXTURE_UNLOAD="texture unload",t.LINE_OF_SIGHT_TOOL="line of sight tool",t.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",t.ELEVATION_PROFILE="elevation profile",t.SNAPPING="snapping",t.SHADOW_ACCUMULATOR="shadow accumulator",t.CLOUDS_GENERATOR="clouds generator",t[t.NONE=0]="NONE",t[t.TEST_PRIO=1]="TEST_PRIO"}(pt||(pt={}));const qf=0,gre=new Map([[pt.RESOURCE_CONTROLLER_IMMEDIATE,qf],[pt.RESOURCE_CONTROLLER,4],[pt.SLIDE,qf],[pt.STREAM_DATA_LOADER,qf],[pt.ELEVATION_QUERY,qf],[pt.TERRAIN_SURFACE,1],[pt.SURFACE_GEOMETRY_UPDATES,1],[pt.LOD_RENDERER,2],[pt.GRAPHICS_CORE,2],[pt.I3S_CONTROLLER,2],[pt.POINT_CLOUD_LAYER,2],[pt.FEATURE_TILE_FETCHER,2],[pt.OVERLAY,4],[pt.STAGE,4],[pt.GRAPHICS_DECONFLICTOR,4],[pt.FILTER_VISIBILITY,4],[pt.SCALE_VISIBILITY,4],[pt.FRUSTUM_VISIBILITY,4],[pt.CLOUDS_GENERATOR,4],[pt.POINT_OF_INTEREST_FREQUENT,6],[pt.POINT_OF_INTEREST_INFREQUENT,30],[pt.LABELER,8],[pt.FEATURE_QUERY_ENGINE,8],[pt.FEATURE_TILE_TREE,16],[pt.FEATURE_TILE_TREE_ACTIVE,qf],[pt.ELEVATION_ALIGNMENT,12],[pt.TEXT_TEXTURE_ATLAS,12],[pt.TEXTURE_UNLOAD,12],[pt.LINE_OF_SIGHT_TOOL,16],[pt.LINE_OF_SIGHT_TOOL_INTERACTIVE,qf],[pt.SNAPPING,qf],[pt.SHADOW_ACCUMULATOR,30]]);function yre(t){return gre.has(t)?gre.get(t):typeof t=="number"?t:1}const _re=6.5,vre=1,VUe=30,bre=1e3/30,wre=100,xre=.9;var q5,y1;(function(t){class e{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(s=>s.needsUpdate)}constructor(){this._updating=UE(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new Qg("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new r,this._state=Li.INTERACTING,this._tasks=new Ut,this._runQueue=new Ut,this._load=0,this._idleStateCallbacks=new Ut,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=ne(()=>zUe.SCHEDULER_LOG_SLOW_TASKS,o=>this._debug=o,Xt);for(const o of Object.keys(pt))this.performanceInfo.tasks.set(pt[o],new Qg(pt[o]));const s=this;this._test={FRAME_SAFETY_BUDGET:_re,INTERACTING_BUDGET:bre,IDLE_BUDGET:wre,get availableBudget(){return s._budget.budget},usedBudget:0,getBudget:()=>s._budget,setBudget:o=>s._budget=o,updateTask:o=>this._updateTask(o),getState:o=>this._getState(o),getRuntime:o=>this._getRuntime(o),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(s=>s.remove()),this._tasks.clear(),Tr(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(s){this._updatingChanged(),s&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(s,o){const a=yre(s),l=new i(this,s,o,a);return this._tasks.push(l),this._updatingChanged(),this.performanceInfo.tasks.has(s)||this.performanceInfo.tasks.set(s,new Qg(s)),l}registerIdleStateCallbacks(s,o){const a={idleBegin:s,idleEnd:o};this._idleStateCallbacks.push(a),this.state===Li.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(c){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===Li.IDLE&&c()),a.idleBegin=c},set idleEnd(c){a.idleEnd=c}}}get load(){return this._load}set state(s){this._state!==s&&(this._state=s,this.state!==Li.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(o=>o.idleEnd())))}get state(){return this._state}updateBudget(s){this._test.usedBudget=0,++this._frameNumber;let o=_re,a=s.frameDuration,l=vre;switch(this.state){case Li.IDLE:o=0,a=Math.max(wre,s.frameDuration),l=VUe;break;case Li.INTERACTING:a=Math.max(bre,s.frameDuration);case Li.ANIMATING:}return a=a-s.elapsedFrameTime-o,this.state!==Li.IDLE&&a<vre&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case Li.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(s=>s.idleBegin())),this._runIdle();break;case Li.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(s){this._idleUpdatesStartFired&&s.idleEnd(),this._idleStateCallbacks.removeUnordered(s)}removeTask(s){this._tasks.removeUnordered(s),this._runQueue.removeUnordered(s),this._updatingChanged()}_updateTask(s){this._tasks.forAll(o=>{o.name===s&&o.setPriority(s)})}_getState(s){if(this._runQueue.some(a=>a.name===s))return y1.SCHEDULED;let o=y1.IDLE;return this._tasks.forAll(a=>{a.name===s&&a.needsUpdate&&(a.schedulePriority<=1?o=y1.READY:o!==y1.READY&&(o=y1.WAITING))}),o}_getRuntime(s){let o=0;return this._tasks.forAll(a=>{a.name===s&&(o+=a.runtime)}),o}_resetRuntimes(){this._tasks.forAll(s=>s.runtime=0)}_getRunning(){const s=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&s.set(a.name,(s.get(a.name)||0)+1)}),s.size===0)return null;let o="";return s.forEach((a,l)=>{o+=a>1?` ${a}x ${l}`:` ${l}`}),o}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const s=this._tasks.reduce((o,a)=>a.needsUpdate?++o:o,0);this._load=this._load*xre+s*(1-xre)}_schedule(){for(this._runQueue.filterInPlace(s=>!!s.needsUpdate||(s.schedulePriority=s.basePriority,!1)),this._tasks.forAll(s=>{s.basePriority===qf&&s.needsUpdate&&!this._runQueue.includes(s)&&s.blockFrame!==this._frameNumber&&this._runQueue.unshift(s)});this._runQueue.length===0;){let s=!1,o=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==qf&&a.blockFrame!==this._frameNumber&&(s=!0,o=Math.max(o,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!s)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const s=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const o=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)===ca.YIELD&&(a.blockFrame=this._frameNumber)}catch(c){K.getLogger("esri.views.support.Scheduler").error(`Exception in task "${a.name}"`,c),a.blockFrame=this._frameNumber}!this._budget.hasProgressed&&a.blockFrame!==this._frameNumber&&a.needsUpdate&&(a.name,pt.I3S_CONTROLLER,a.blockFrame=this._frameNumber),a.schedulePriority=a.basePriority;const l=this._budget.now()-o;if(a.runtime+=l,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+l),this._debug&&l>2*this._budget.budget&&console.log("Task",a.name,"used",l,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-s)}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-s)}_startFrameTaskTimes(){for(const s of Object.keys(pt))this._frameTaskTimes.set(pt[s],0)}_recordFrameTaskTimes(s){this._frameTaskTimes.forEach((o,a)=>this.performanceInfo.tasks.get(a).record(o)),this.performanceInfo.total.record(s)}get test(){return this._test}}t.Scheduler=e;class i{get task(){return this._task.value}get updating(){return this._queue.running}constructor(s,o,a,l){this._scheduler=s,this.name=o,this._basePriority=l,this.blockFrame=0,this.runtime=0,this._queue=new UUe,this._handles=new Ny,this.schedulePriority=this._basePriority,this._task=UE(a??this._queue),this._handles.add(gl(()=>this.task.running,c=>s.taskRunningChanged(c)))}remove(){this.processQueue(hl),this._scheduler.removeTask(this),this.schedule=zE.schedule,this.reschedule=zE.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(s){this.name=s;const o=yre(s);this._basePriority!==qf&&this.schedulePriority===0||(this.schedulePriority=o),this._basePriority=o}get priority(){return this.name}set priority(s){this.setPriority(s)}get needsUpdate(){return this.updating||this.task.running}schedule(s,o,a){return this._queue.push(s,o,a)}reschedule(s,o,a){return this._queue.unshift(s,o,a)}processQueue(s){this._queue.runTask(s)}}class r{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=Li.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(s){return!this.done&&(s()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(s){this._enabled=s}reset(s,o){this._begin=this.now(),this._budget=s,this._state=o,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}t.Budget=r})(q5||(q5={})),function(t){t.SCHEDULED="s",t.READY="r",t.WAITING="w",t.IDLE="i"}(y1||(y1={}));const hl=(()=>{const t=new q5.Budget;return t.enabled=!1,t})();let GUe=class{remove(){}processQueue(){}schedule(e,i,r){try{if(ps(i)){const n=Ti();return r?Promise.resolve(r(n)):Promise.reject(n)}return s7(e(hl))}catch(n){return Promise.reject(n)}}reschedule(e,i,r){return this.schedule(e,i,r)}};const zE=new GUe;var RG;let ty=RG=class extends pe{constructor(){super(...arguments),this.url=""}destroy(){this.url=""}clone(){return new RG({url:this.url})}};u([p({type:String,json:{write:{isRequired:!0}}})],ty.prototype,"url",void 0),ty=RG=u([M("esri.webdoc.support.SlideThumbnail")],ty);var PG;let sN=PG=class extends pe{constructor(){super(...arguments),this.text=""}clone(){return new PG({text:this.text})}};u([p({type:String,json:{write:!0}})],sN.prototype,"text",void 0),sN=PG=u([M("esri.webscene.support.Description")],sN);const oN=sN;var MG;let T2=MG=class extends pe{constructor(){super(...arguments),this.lighting=new gx,this.weather=new j5}clone(){return new MG({lighting:Q(this.lighting),weather:Q(this.weather)})}};u([p({types:P_e,json:{write:!0}})],T2.prototype,"lighting",void 0),u([p({types:KZ,json:{write:!0}})],T2.prototype,"weather",void 0),T2=MG=u([M("esri.webscene.Environment")],T2);var aN;let lN=aN=class extends pe{constructor(){super(...arguments),this.opacity=null}clone(){return new aN({opacity:this.opacity})}cloneAndApplyTo(t){return this.opacity==null||((t=t?.clone()??new iP).opacity=this.opacity),t}static fromGround(t){return new aN({opacity:t.opacity})}};u([p({type:Number,json:{type:dr,read:{reader:RE,source:"transparency"},write:{writer:(t,e)=>{e.transparency=S6(t)},target:"transparency"}}})],lN.prototype,"opacity",void 0),lN=aN=u([M("esri.webscene.support.SlideGround")],lN);const L_e=lN;var $G;let S2=$G=class extends pe{constructor(t){super(t),this.id="",this.sublayerIds=null}clone(){return new $G({id:this.id,sublayerIds:Q(this.sublayerIds)})}};u([p({type:String,json:{write:!0}})],S2.prototype,"id",void 0),u([p({type:[dr],json:{read:{source:"subLayerIds"},write:{target:"subLayerIds"}}})],S2.prototype,"sublayerIds",void 0),S2=$G=u([M("esri.webscene.support.SlideVisibleLayer")],S2);var IG;let cN=IG=class extends pe{constructor(){super(...arguments),this.text=""}clone(){return new IG({text:this.text})}};u([p({type:String,json:{write:{isRequired:!0}}})],cN.prototype,"text",void 0),cN=IG=u([M("esri.webscene.support.Title")],cN);const ZO=cN;let jUe=0;const LG=Je.ofType(S2);let Zo=class extends pe{constructor(e){super(e),this.id=Date.now().toString(16)+"-slide-"+jUe++,this.title=new ZO,this.description=new oN,this.hidden=!1,this.thumbnail=new ty,this.viewpoint=null,this.basemap=null,this.ground=null,this.environment=new T2,this.visibleLayers=new LG}destroy(){this.visibleLayers.removeAll(),this.basemap=null,this.thumbnail=$e(this.thumbnail),this.description=null,this.title=null,this.thumbnail=null}castTitle(e){return typeof e=="string"?new ZO({text:e}):as(ZO,e)}castDescription(e){return typeof e=="string"?new oN({text:e}):as(oN,e)}castThumbnail(e){return typeof e=="string"?new ty({url:e}):as(ty,e)}castBasemap(e){return EZ(e)}set visibleLayers(e){this._set("visibleLayers",wy(e,this._get("visibleLayers"),LG))}castVisibleLayers(e){return e&&typeof e.map=="function"?e.map(i=>{if(typeof i=="string")return{id:i};if(i instanceof DZ){const r=Tre(i);return{id:i.id,sublayerIds:r}}return i.id?{id:i.id,sublayerIds:"sublayerIds"in i?i.sublayerIds:void 0}:(K.getLogger(this).warn('Invalid visible layer, expected { id }, Layer or "id"'),i)}):null}clone(){return new this.constructor({id:this.id,title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||null,basemap:this.basemap?.clone()||null,ground:this.ground?.clone()||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&this.environment.clone()||null,hidden:this.hidden})}async _updateVisibleLayersFrom(e){const i=[];await Promise.allSettled(this._getLayers(e.map).map(r=>e.whenLayerView(r).then(n=>{if(n.visible){const s=Tre(r);i.push(new S2({id:n.layer.id,sublayerIds:s}))}})).toArray()),this.visibleLayers.removeAll(),this.visibleLayers.addMany(i)}updateFrom(e,i){const r={format:"png",quality:80,width:120,height:75,disableDecorations:!0,...i?.screenshot};return e.when(()=>(this.viewpoint=e.viewpoint.clone(),this.environment.lighting=e.environment.lighting.type==="virtual"?wM.prototype.clone.apply(e.environment.lighting):gx.prototype.clone.apply(e.environment.lighting),this.environment.weather=e.environment.weather.clone(),this.basemap=e.map.basemap&&e.map.basemap.clone()||null,this.ground=e.map.ground?L_e.fromGround(e.map.ground):null,this._updateVisibleLayersFrom(e))).then(()=>e.takeScreenshot(r)).then(n=>(this.thumbnail=new ty({url:n.dataUrl}),this))}async applyTo(e,i){this._applyToController!=null&&this._applyToController.abort();let r=new AbortController;this._applyToController=r;const n=sM(i,()=>r?.abort()),s=e.resourceController.scheduler.registerTask(pt.SLIDE);let o=!1;const a={animate:!0,...i,signal:this._applyToController.signal},l=async()=>{await Promise.all([s.schedule(async()=>o=await this._setViewpointOfInterest(e,a)),s.schedule(()=>this._applyBasemap(e,a),a.signal)]),await this._loadLayersWithSublayerVisibility(e),await Promise.all([s.schedule(()=>this._applyLayerVisibility(e),a.signal),s.schedule(()=>this._applyGround(e),a.signal),s.schedule(()=>this._applyViewpoint(e,a),a.signal)]),await s.schedule(()=>e.environment.weather=this.environment.weather.clone())},c=await jc(e.addUpdatingPromise(l()));if(o&&(e.contentCamera=null),s.remove(),this._applyToController===r&&(this._applyToController=null),r=null,n?.remove(),c.ok===!1)throw c.error;return this}async _applyBasemap(e,i){if(this.basemap){try{await this.basemap.load(i)}catch(r){if(Tn(r))throw r}e.map.basemap=xke(this.basemap,e.map.basemap)}}_applyGround(e){this.ground&&(e.map.ground=this.ground.cloneAndApplyTo(e.map.ground))}_getLayers(e){const i=new Je;return this._collectLayers(e,i),this._collectLayers(e.ground,i),i}_collectLayers(e,i){e.layers.forEach(r=>{r.persistenceEnabled&&(i.add(r),"layers"in r&&this._collectLayers(r,i))})}async _loadLayersWithSublayerVisibility(e){this.visibleLayers&&await Promise.allSettled(this._getLayers(e.map).items.map(i=>this.visibleLayers.find(n=>n.id===i.id)?.sublayerIds?i.load():null))}_applyLayerVisibility(e){this.visibleLayers&&this._getLayers(e.map).forEach(i=>{const r=this.visibleLayers.find(o=>o.id===i.id);i.visible=r!=null;const n=r?.sublayerIds,s=D_e(i);n&&s&&s.forEach(o=>o.visible=n.includes(o.id))})}async _setViewpointOfInterest(e,i){if(e.state.fixedContentCamera||!this.viewpoint||i?.ignoreViewpoint||!i?.useDestinationCamera)return!1;const{toCameraAsync:r}=await ce(()=>Promise.resolve().then(()=>Eet),void 0,import.meta.url),n=await r(e,this.viewpoint);return e.contentCamera=n,n!=null}async _applyViewpoint(e,i){if(this._applyCachedCameraTrackingEnabled(e),this.viewpoint&&!i.ignoreViewpoint){this.viewpoint.camera!=null&&(this.viewpoint.camera.fov=e.camera.fov);const r=this.environment.lighting;if(i.animate&&r.type==="sun"&&r.date)return this._animateToLighting(e,i);i.animate&&(e.environment.applyLighting(r.clone()),await e.goTo(this.viewpoint,i)),e.viewpoint=this.viewpoint}e.environment.applyLighting(this.environment.lighting.clone())}async _animateToLighting(e,i){let r=null;return e.environment.lighting.type!=="virtual"&&this.environment.lighting.type!=="virtual"&&(e.viewingMode==="global"&&(r=this._animateLightingWithCamera(e,e.environment.lighting,this.environment.lighting)),e.environment.cachedCameraTrackingEnabled=e.environment.lighting.cameraTrackingEnabled,e.environment.lighting.cameraTrackingEnabled=!1),e.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled,this.environment.lighting.type==="virtual"||e.environment.lighting.type==="virtual"?(e.environment.applyLighting(this.environment.lighting.clone()),e.environment.lighting.type!=="virtual"&&(e.environment.cachedCameraTrackingEnabled=e.environment.lighting.cameraTrackingEnabled,e.environment.lighting.cameraTrackingEnabled=!1)):this.environment.lighting.displayUTCOffset!=null&&(e.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset),e.goTo(this.viewpoint,i).then(()=>{this._applyCachedCameraTrackingEnabled(e),e.environment.applyLighting(this.environment.lighting.clone())}).catch(n=>{throw e.animation==null&&this._applyCachedCameraTrackingEnabled(e),n}).finally(()=>{Tr(r)})}_applyCachedCameraTrackingEnabled(e){e.environment.cachedCameraTrackingEnabled!=null&&(e.environment.lighting.cameraTrackingEnabled=e.environment.cachedCameraTrackingEnabled,e.environment.cachedCameraTrackingEnabled=null)}_getTime(e){return[e.getTime(),3600*e.getUTCHours()+60*e.getUTCMinutes()+e.getUTCSeconds()]}_setTime(e,i,r){return e.setTime(i),e.setUTCHours(r/3600),e.setUTCMinutes(r%3600/60),e.setUTCSeconds(r%3600%60),e}_animateLightingWithCamera(e,i,r){const n=new Date(i.date.toString()),[s,o]=this._getTime(n),[a,l]=this._getTime(r.date),c=HUe(o,l),h=e.renderCoordsHelper,d=E();h.toRenderCoords(e.camera.position,d);const f=E(),m=E();this.viewpoint.camera!=null&&h.toRenderCoords(this.viewpoint.camera.position,f);const y=new Date;return gl(()=>e.camera,_=>{h.toRenderCoords(_.position,m);const v=qs(d,m),w=qs(f,m);let x=0;v+w!==0&&(x=v/(v+w));const T=s+(a-s)*x,S=qUe(o,c*x);i.date=this._setTime(y,T,S)})}static createFrom(e,i){return new this().updateFrom(e,i)}};function D_e(t){if(t.type==="building-scene"||t.type==="map-image")return t.allSublayers.toArray()}function Tre(t){const e=D_e(t);if(e)return e.filter(i=>i.visible).map(i=>i.id)}u([p({type:String,json:{write:{isRequired:!0}}})],Zo.prototype,"id",void 0),u([p({type:ZO,json:{default:()=>new ZO({text:""}),write:{isRequired:!0}}})],Zo.prototype,"title",void 0),u([ai("title")],Zo.prototype,"castTitle",null),u([p({type:oN,json:{write:{overridePolicy:t=>({enabled:!(!t||!t.text)})}}})],Zo.prototype,"description",void 0),u([ai("description")],Zo.prototype,"castDescription",null),u([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!1}})],Zo.prototype,"hidden",void 0),u([p({type:ty,json:{default:()=>new ty({url:""}),write:{isRequired:!0}}})],Zo.prototype,"thumbnail",void 0),u([ai("thumbnail")],Zo.prototype,"castThumbnail",null),u([p({type:qc,nonNullable:!0,json:{write:{isRequired:!0}}})],Zo.prototype,"viewpoint",void 0),u([p({type:q2,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],Zo.prototype,"basemap",void 0),u([ai("basemap")],Zo.prototype,"castBasemap",null),u([p({type:L_e,json:{write:!0}})],Zo.prototype,"ground",void 0),u([p({type:LG,json:{write:{isRequired:!0}}})],Zo.prototype,"visibleLayers",null),u([ai("visibleLayers")],Zo.prototype,"castVisibleLayers",null),u([p({type:T2,json:{write:!0}})],Zo.prototype,"environment",void 0),Zo=u([M("esri.webscene.Slide")],Zo);const DG=86400,Sre=43200;function HUe(t,e){let i=e-t;return i>Sre&&(i-=DG),i<-Sre&&(i+=DG),i}function qUe(t,e){return OFe(t+e,DG)}const WUe=Zo,NG=Je.ofType(WUe);let uN=class extends pe{constructor(e){super(e),this.slides=new NG}destroy(){this.slides.forEach(e=>e.destroy()),this.slides.removeAll()}set slides(e){e&&(e=e.filter(i=>!!i.viewpoint)),this._set("slides",wy(e,this._get("slides"),NG))}clone(){return new this.constructor({slides:this.slides.clone()})}};u([p({type:NG,nonNullable:!0,json:{write:!0}}),ai(KX)],uN.prototype,"slides",null),uN=u([M("esri.webscene.Presentation")],uN);const N_e=uN;var FG;let PS=FG=class extends pe{constructor(t){super(t)}clone(){return new FG({name:this.name,path:this.path,title:this.title})}};u([p({type:String,json:{write:!0}})],PS.prototype,"name",void 0),u([p({type:String,json:{write:!0}})],PS.prototype,"path",void 0),u([p({type:String,json:{write:!0}})],PS.prototype,"title",void 0),PS=FG=u([M("esri.webscene.TransportationNetwork")],PS);const YUe=PS;let Ov=class{constructor(e,i,r=""){this.major=e,this.minor=i,this._context=r}lessThan(e,i){return this.major<e||e===this.major&&this.minor<i}since(e,i){return!this.lessThan(e,i)}validate(e){if(this.major!==e.major){const i=this._context&&this._context+":",r=this._context&&this._context+" ";throw new G(i+"unsupported-version",`Required major ${r}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new Ov(this.major,this.minor,this._context)}static parse(e,i=""){const[r,n]=e.split("."),s=/^\s*\d+\s*$/;if(!r?.match||!s.test(r))throw new G((i&&i+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!n?.match||!s.test(n))throw new G((i&&i+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const o=parseInt(r,10),a=parseInt(n,10);return new Ov(o,a,i)}},W5=class extends Ov{constructor(e,i){super(e,i,"webscene")}get supportsGround(){return this.since(1,8)}get supportsVisibleElevationLayersInSlides(){return this.lessThan(1,8)}},XUe=null;function ZUe(){return XUe}var F_e;const Bw=new W5(1,32),JUe=()=>{const e=[],i=Bw.major;for(let r=8;r<=Bw.minor;r++)e.push(`${i}.${r}`);return e},K8="Web Scene";let lr=class extends xy.LoadableMixin(p6(kZ(B0e))){constructor(e){super(e),this[F_e]=!0,this._layersIdGCTimeoutId=void 0,this._updateFromPromise=null,this.applicationProperties=null,this.clippingArea=null,this.clippingEnabled=!1,this.floorInfo=null,this.heightModelInfo=void 0,this.sourceVersion=null,this.transportationNetworks=null,this.presentation=new N_e,this.initialViewProperties=new H5,this.portalItem=null,this.resourceInfo=null,this._debouncedSaveOperations=aM(async(i,r,n)=>{switch(i){case nm.SAVE:return this._saveImpl(r);case nm.SAVE_AS:return this._saveAsImpl(n,r)}}),this._resourceReferences={portalItem:null,paths:[]},this.authoringApp=null,this.authoringAppVersion=null,this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1}initialize(){if(this.when().catch(e=>{K.getLogger(this).error("#load()","Failed to load web scene",e)}),this.resourceInfo){let e;try{e=this._validateJSON(this.resourceInfo)}catch(i){return void this.addResolvingPromise(Promise.reject(i))}this.read(e),this.addResolvingPromise(this._validateSpatialReference()),this.addResolvingPromise(this._validateHeightModelInfo())}this.addHandles(bo(()=>this.allLayers,"change",()=>this._scheduleLayersIdGC()))}destroy(){this._unscheduleLayersIdGC(),this.presentation&&this.presentation.destroy(),this.portalItem=$e(this.portalItem)}writeClippingArea(e,i){i.clippingArea||(i.clippingArea={}),i.clippingArea.geometry=e.toJSON()}readClippingEnabled(e,i){return!!i.clippingArea&&!!i.clippingArea.clip}writeClippingEnabled(e,i){this.clippingArea&&(i.clippingArea||(i.clippingArea={}),i.clippingArea.clip=e)}writeLayers(e,i,r,n){i[r]=this._layersToJSON(e,"operational-layers",n)}readSourceVersion(e,i){const[r,n]=i.version.split(".");return new W5(parseInt(r,10),parseInt(n,10))}writeSourceVersion(e,i,r){i[r]=`${Bw.major}.${Bw.minor}`}writeTables(e,i,r,n){const s=this._layersToJSON(e,"tables",n);s.length&&(i[r]=s)}get thumbnailUrl(){return this.portalItem?.thumbnailUrl??null}set thumbnailUrl(e){e?this._override("thumbnailUrl",e):(this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}set authoringApp(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e)}writeAuthoringApp(e,i){e&&this._isAuthoringAppSetByUser?i.authoringApp=e:i.authoringApp="ArcGIS API for JavaScript"}set authoringAppVersion(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e)}writeAuthoringAppVersion(e,i){e&&this._isAuthoringAppVersionSetByUser?i.authoringAppVersion=e:i.authoringAppVersion=Wge}writeGround(e,i,r,n){i[r]=e?e.write({},n):{transparency:0,layers:[]}}readInitialViewProperties(e,i){const r={};return i.initialState?.environment&&(r.environment=kE.fromJSON(i.initialState.environment)),r.spatialReference=i.spatialReference?ze.fromJSON(i.spatialReference):ze.WebMercator,r.viewingMode=i.viewingMode??"global",i.initialState?.viewpoint&&(r.viewpoint=qc.fromJSON(i.initialState.viewpoint)),new H5(r)}get spatialReference(){return this.initialViewProperties?.spatialReference??ze.WebMercator}get viewingMode(){return this.initialViewProperties?.viewingMode??"global"}load(e){const i=this.ground;return this.addResolvingPromise(this._loadFromSource().then(()=>{i&&i!==this.ground&&i.destroy()})),Promise.resolve(this)}loadAll(){return tZ(this,e=>{const i=this.presentation&&this.presentation.slides;e(this.ground,this.basemap,this.layers,i&&i.map(r=>r.basemap),this.tables)})}read(e,i){i={...i,origin:"web-scene"};const r=this._isAuthoringAppVersionSetByUser,n=this._isAuthoringAppSetByUser;if(Pge(this,e,s=>super.read(e,s),i),n||(this._isAuthoringAppSetByUser=!1),r||(this._isAuthoringAppVersionSetByUser=!1),e.baseMap&&Array.isArray(e.baseMap.elevationLayers)&&this.sourceVersion?.supportsVisibleElevationLayersInSlides){const s=e.baseMap.elevationLayers.map(c=>({id:c.id})),o=this.presentation.slides,a=(c,h)=>c.visibleLayers.some(d=>d.id===h),l=s.filter(c=>!o.some(h=>a(h,c.id)));o.forEach(c=>{c.visibleLayers.addMany(l)})}}_writeBasemapElevationLayers(e){const i=e.ground?.layers;!e.baseMap&&i?.length&&(e.baseMap={title:"Basemap",baseMapLayers:[]}),e.baseMap&&(e.baseMap.elevationLayers=Q(i))}_layersToJSON(e,i,r){const n={...r,layerContainerType:i};return e.map(s=>this._verifyWritableLayer(s,r)?s.write({},n):null).filter(s=>!!s).toArray()}_verifyWritableLayer(e,i){return!!e.persistenceEnabled&&("write"in e||(i?.messages&&i.messages.push(new G("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted in web scenes`,{layer:e})),!1))}write(e,i){if(this.loadStatus!=="loaded"){const s=new G("webscene:not-loaded","Web scene must be loaded before it can be serialized");throw K.getLogger(this).error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus),s}this._runLayersIdGC();const r=!i?.messages;i={messages:[],...i,origin:"web-scene"};const n=super.write(e,i);if(r){const s=i.messages?.filter(o=>o.name==="web-document-write:property-required")??[];if(s.length){const o=new G("web-document:property-required","One or more properties that are required in the webscene JSON are missing, see details for the specific errors",{errors:s});throw K.getLogger(this).error("#toJSON()","One or more properties that are required in the webscene JSON are missing",s),o}}return this._writeBasemapElevationLayers(n),n}async save(e){return this._debouncedSaveOperations(nm.SAVE,e)}async _saveImpl(e){if(!this.portalItem)throw new G("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene");if(ure(this.portalItem),this.portalItem?.type!==K8)throw new G("webscene:portal-item-wrong-type",`Portal item needs to have type "${K8}"`);const i=this._updateFromPromise;await this._ensureLoadBeforeSave();const r=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:this.portalItem.itemUrl?Nn(this.portalItem.itemUrl):null,messages:[],portal:this.portalItem.portal??Ds.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}}),n=this.write({},r);return await Promise.all(r.resources.pendingOperations),await this._verifySave(n,r,e),this._updateTypeKeywords(this.portalItem),await fUe(this.portalItem,n,this._resourceReferences,r,null),ire(r),i&&await i,await this._saveThumbnail(),this.portalItem}async saveAs(e,i){return this._debouncedSaveOperations(nm.SAVE_AS,i,e)}async _saveAsImpl(e,i){let r=kw.from(e);if(!r)throw new G("webscene:portal-item-required","saveAs requires a portal item to save to");ure(r),r.id&&(r=r.clone(),r.id=null);const n=r.portal||Ds.getDefault();await this._ensureLoadBeforeSave(),r.type=K8,r.portal=n;const s=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:null,messages:[],portal:n,portalItem:r,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}}),o=this.write({},s);await Promise.all(s.resources.pendingOperations),await this._verifySaveAs(o,s,i);const a=this.thumbnailUrl,l=!this._isOverridden("thumbnailUrl");if(this._updateTypeKeywords(r),await n.signIn(),!n.user)throw new G("webscene:user-not-signed-in","saveAs requires a user to be signed in to the portal");return await n.user.addItem({item:r,folder:i?.folder,data:o}),await pUe(this._resourceReferences,s,null),this.portalItem=r,iG.prototype.read.call(this,{version:o.version,authoringApp:o.authoringApp,authoringAppVersion:o.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:r.itemUrl?Nn(r.itemUrl):void 0}),ire(s),a&&(this.thumbnailUrl=l?XX(a,"w","8192"):a),s.portalItem=r,await this._saveThumbnail(),r}async _saveThumbnail(){this._isOverridden("thumbnailUrl")&&(await this.portalItem?.updateThumbnail({thumbnail:this.thumbnailUrl}),this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}_verifySave(e,i,r,n=!1){if(!EE(this.spatialReference))return Promise.reject(new G("webscene:unsupported-spatial-reference","Webscenes using spatial reference systems from Mars or Moon can not be saved currently."));let s,o=i.messages?.filter(c=>c.type==="error").map(c=>new G(c.name,c.message,c.details))??[];i.blockedRelativeUrls&&(o=o.concat(i.blockedRelativeUrls.map(c=>new G("url:unsupported",`Relative url '${c}' is not supported in Web Scene`)))),r&&r.ignoreUnsupported&&(o=o.filter(c=>c.name!=="layer:unsupported"&&c.name!=="symbol:unsupported"&&c.name!=="symbol-layer:unsupported"&&c.name!=="property:unsupported"&&c.name!=="url:unsupported"&&c.name!=="scenemodification:unsupported")),r?.requiredPropertyChecksDisabled&&(o=o.filter(c=>c.name!=="web-document-write:property-required"));const a=!!r?.strictSchemaValidationEnabled,l=ZUe();return s=a&&l?l().then(c=>{const h=c.validate(e);if(h.length>0){const d=`webscene did not validate:
${h.join(`
`)}`;K.getLogger(this).error(`${n?"saveAs":"save"}(): ${d}`)}return h.map(d=>new G("webscene:schema-validation",d))}).then(c=>{if(c.length>0)throw sUe(c.concat(o));return o}):Promise.resolve(o),s.then(c=>{if(c.length>0)throw new G("webscene:save","Failed to save webscene due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:c})})}_verifySaveAs(e,i,r){return this.canNotSaveAs(i)?Promise.reject(nUe()):this._verifySave(e,i,r,!0)}verifySaveAs(e){const i=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),r=this.write({},i);return this._verifySaveAs(r,i,e)}canNotSaveAs(e){return e||(e=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write({},e)),(e.verifyItemRelativeUrls?.writtenUrls?.length??0)>0}async updateFrom(e,i={}){const r=this._updateFrom(e,i);this._updateFromPromise=r,await r,this._updateFromPromise===r&&(this._updateFromPromise=null)}async _updateFrom(e,i={}){if(await e.whenReady(),!i.environmentExcluded&&e.environment&&(this.initialViewProperties.environment=kE.prototype.clone.apply(e.environment)),!i.viewpointExcluded&&e.viewpoint&&(this.initialViewProperties.viewpoint=e.viewpoint.clone()),this.initialViewProperties.spatialReference=e.spatialReference.clone(),this.initialViewProperties.viewingMode=e.viewingMode,e.clippingArea!=null?e.clippingArea!==this.clippingArea&&(this.clippingArea=e.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,e.heightModelInfo&&(this.heightModelInfo=e.heightModelInfo.clone()),e.map===this)for(const r of e.allLayerViews){const n="visible";n in r&&n in r.layer&&r._isOverridden(n)&&(r.layer[n]=r[n])}(i.thumbnailExcluded===!1||i.thumbnailExcluded==null&&!i.viewpointExcluded)&&await this._updateFromThumbnail(e,i.thumbnailSize??void 0)}async _updateFromThumbnail(e,i){const r=yUe(e,i),n=await e.takeScreenshot({format:"jpg",width:r.width,height:r.height,disableDecorations:!0});this.thumbnailUrl=n.dataUrl}_loadFromSource(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):this.portalItem?.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()}_readAndLoadFromJSON(e,i){const r=this._validateJSON(e);return this.read(r,i),this._loadFromJSON(r,i)}_extractOperationalLayers(e){const i=[];if(!this.sourceVersion?.supportsGround&&e.baseMap&&Array.isArray(e.baseMap.elevationLayers))for(const s of e.baseMap.elevationLayers)i.push(s);const r=[],n=s=>(s.layers&&(s.layers=s.layers.filter(n)),s.layerType!=="ArcGISTiledElevationServiceLayer"||(this.sourceVersion?.supportsGround||r.push(s),!1));return{operationalLayers:e.operationalLayers?e.operationalLayers.filter(n):[],operationalElevationLayers:r,basemapElevationLayers:i}}async _loadFromJSON(e,i){const r=new Je;await this._validateSpatialReference(),await this._validateHeightModelInfo();const{populateOperationalLayers:n}=await ce(()=>import("./layersCreator-96ef29cd.js"),["./layersCreator-96ef29cd.js","./portalLayers-7401a143.js","./associatedFeatureServiceUtils-aa9f1206.js","./requestPresets-07a176e4.js"],import.meta.url),{operationalLayers:s,operationalElevationLayers:o,basemapElevationLayers:a}=this._extractOperationalLayers(e),l=[],c={context:{...i,layerContainerType:"operational-layers"}};if(this.portalItem&&(c.context.portal=this.portalItem.portal||Ds.getDefault()),a.length>0){const h={...c,context:{...c.context,layerContainerType:"ground"}};h.defaultLayerType="ArcGISTiledElevationServiceLayer",l.push(n(this.ground.layers,a,h))}if(o.length>0){const h={...c,context:{...c.context,layerContainerType:"ground"}};h.defaultLayerType="ArcGISTiledElevationServiceLayer",l.push(n(r,o,h))}s&&s.length>0&&l.push(n(this.layers,s,c)),e.tables?.length&&l.push(n(this.tables,e.tables,{...c,context:{...c.context,layerContainerType:"tables"},defaultLayerType:"ArcGISFeatureLayer"})),await Promise.allSettled(l),await this._loadObjectsWithLayers(),this.ground.layers.addMany(r)}async _ensureLoadBeforeSave(){await this.load(),await this._loadObjectsWithLayers();const e=[],i=[...this.allLayers.items];for(const{basemap:r}of this.presentation.slides.items)r&&(i.push(...r.baseLayers.items),i.push(...r.referenceLayers.items));for(const r of i)if("beforeSave"in r&&typeof r.beforeSave=="function"){const n=r.beforeSave();n&&e.push(n)}await Promise.allSettled(e)}async _loadObjectsWithLayers(){const e=[];this.ground&&e.push(this.ground.load()),this.basemap&&e.push(this.basemap.load()),this.presentation.slides.forEach(i=>{i.basemap&&e.push(i.basemap.load())}),await Promise.allSettled(e)}async _loadFromItem(e){if(await e.load().catch(n=>{throw new G("webscene:load-portal-item","Failed to load portal item",{error:n})}),e.type!=="Web Scene")throw new G("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:e.type});const i=await e.fetchData();this.resourceInfo=i;const r={origin:"web-scene",url:Nn(e.itemUrl),portal:e.portal||Ds.getDefault(),portalItem:e,readResourcePaths:[]};await this._readAndLoadFromJSON(i,r),this._resourceReferences={portalItem:e,paths:r.readResourcePaths??[]}}_validateSpatialReference(){const e=this.initialViewProperties,i=this._sceneSpatialReference;let r;if(e.viewingMode!=="local"){if(!lP(i,Le.Global))return Promise.reject(new G("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:i,viewingMode:e.viewingMode}));r=l=>!l||$p(l,i)}else{if(!lP(i,Le.Local))return Promise.reject(new G("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:i,viewingMode:e.viewingMode}));r=l=>!l||l.equals(i)}const n=l=>l?.camera?.position.spatialReference??l?.targetGeometry?.spatialReference,s=e.viewpoint,o=n(s);if(o&&!r(o))return Promise.reject(new G("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:o,sceneSpatialReference:i,viewingMode:e.viewingMode}));const a=this.presentation.slides.find(l=>!r(n(l.viewpoint)));if(a){const l=n(a.viewpoint);return Promise.reject(new G("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{slideSpatialReference:l,sceneSpatialReference:i,viewingMode:e.viewingMode}))}return Promise.resolve()}_validateHeightModelInfo(){const e=this._sceneSpatialReference,i=G6e(this.heightModelInfo,e);return i?Promise.reject(i):Promise.resolve()}_validateJSON(e){const i=W5.parse(e.version||"","webscene");return Bw.validate(i),e.version=`${i.major}.${i.minor}`,i.major===1&&i.minor<=2&&(e.spatialReference=ze.WebMercator.toJSON()),e}_updateTypeKeywords(e){are(e,hG.LOCAL_SCENE,this.initialViewProperties.viewingMode==="local"),are(e,hG.DEVELOPER_BASEMAP,Hie(this.basemap)||this.presentation.slides.some(({basemap:i})=>!!i&&Hie(i))),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter((i,r,n)=>n.indexOf(i)===r))}get _sceneSpatialReference(){return this.initialViewProperties.spatialReference||ze.WebMercator}get _verifyItemRelativeRootPath(){return this.portalItem?.itemUrl?Nn(this.portalItem.itemUrl).path:null}_enableVerifyItemRelativeUrls(e){const i=this._verifyItemRelativeRootPath;return i&&(e.verifyItemRelativeUrls={rootPath:i,writtenUrls:[]}),e}_unscheduleLayersIdGC(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),this._layersIdGCTimeoutId=0)}_scheduleLayersIdGC(){this._unscheduleLayersIdGC(),this._layersIdGCTimeoutId=setTimeout(()=>{this._layersIdGCTimeoutId=0,this._runLayersIdGC()},3e3)}_runLayersIdGC(){this._unscheduleLayersIdGC();const e=this.applicationProperties?.viewing?.search,i=n=>this.allLayers.some(s=>s.id===n&&s.persistenceEnabled);e&&e.layers&&(e.layers=e.layers.filter(n=>i(n.id)));const r=this.presentation&&this.presentation.slides;r&&r.forEach(n=>{n.visibleLayers&&(n.visibleLayers=n.visibleLayers.filter(s=>i(s.id)))})}static fromJSON(e){if(!e)throw new G("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:e})}};F_e=tUe,lr.version=`${Bw.major}.${Bw.minor}`,u([p({type:SUe,json:{write:!0}})],lr.prototype,"applicationProperties",void 0),u([p({type:zi,json:{read:{source:"clippingArea.geometry",reader:bv},write:{target:"clippingArea.geometry"}}})],lr.prototype,"clippingArea",void 0),u([Be("clippingArea")],lr.prototype,"writeClippingArea",null),u([p({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],lr.prototype,"clippingEnabled",void 0),u([wt("clippingEnabled",["clippingArea"])],lr.prototype,"readClippingEnabled",null),u([Be("clippingEnabled")],lr.prototype,"writeClippingEnabled",null),u([p({type:eUe,json:{read:{source:"mapFloorInfo"},write:{target:"mapFloorInfo"}}})],lr.prototype,"floorInfo",void 0),u([p({type:zx,json:{write:!0}})],lr.prototype,"heightModelInfo",void 0),u([p({json:{write:{target:"operationalLayers",ignoreOrigin:!0}}})],lr.prototype,"layers",void 0),u([Be("layers")],lr.prototype,"writeLayers",null),u([p({readOnly:!0,type:W5,json:{type:JUe(),write:{ignoreOrigin:!0,target:"version",isRequired:!0,overridePolicy:()=>({enabled:!0,allowNull:!0,ignoreOrigin:!0})}}})],lr.prototype,"sourceVersion",void 0),u([wt("sourceVersion",["version"])],lr.prototype,"readSourceVersion",null),u([Be("sourceVersion")],lr.prototype,"writeSourceVersion",null),u([p({json:{read:!1,write:{enabled:!0,ignoreOrigin:!0}}})],lr.prototype,"tables",void 0),u([Be("tables")],lr.prototype,"writeTables",null),u([p()],lr.prototype,"thumbnailUrl",null),u([p({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],lr.prototype,"authoringApp",null),u([Be("authoringApp")],lr.prototype,"writeAuthoringApp",null),u([p({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],lr.prototype,"authoringAppVersion",null),u([Be("authoringAppVersion")],lr.prototype,"writeAuthoringAppVersion",null),u([p({json:{write:{isRequired:!0,allowNull:!0,ignoreOrigin:!0,enabled:!0}}})],lr.prototype,"ground",void 0),u([Be("ground")],lr.prototype,"writeGround",null),u([p({type:Je.ofType(YUe),json:{write:!0}})],lr.prototype,"transportationNetworks",void 0),u([p({type:N_e,nonNullable:!0,json:{write:{ignoreOrigin:!0,writer:(t,e,i,r)=>{if(t.slides&&t.slides.length>0){const n={...r,isPresentation:!0};e.presentation=t.write({},n)}}}}})],lr.prototype,"presentation",void 0),u([p({type:H5,nonNullable:!0,json:{write:{target:"initialState",isRequired:!0,ignoreOrigin:!0},default:()=>new H5({viewingMode:"global",spatialReference:ze.WebMercator})}})],lr.prototype,"initialViewProperties",void 0),u([wt("initialViewProperties",["initialState.environment","initialState.viewpoint","spatialReference","viewingMode"])],lr.prototype,"readInitialViewProperties",null),u([p({type:ze,json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],lr.prototype,"spatialReference",null),u([p({type:["local","global"],json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],lr.prototype,"viewingMode",null),u([p({type:kw})],lr.prototype,"portalItem",void 0),u([p()],lr.prototype,"resourceInfo",void 0),lr=u([M("esri.WebScene")],lr);const KUe=lr;async function QZ(t,e){const{WhereClause:i}=await ce(()=>import("./WhereClause-813f9607.js").then(r=>r.W),["./WhereClause-813f9607.js","./TimeOnly-5ca21580.js"],import.meta.url);return i.create(t,e)}function KMt(t,e){return t!=null?e!=null?`(${t}) AND (${e})`:t:e}function lT(t){return typeof t=="string"||t instanceof String}const Ere=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Almaty"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Mazatlan"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);class Bx extends Error{}class QUe extends Bx{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class e8e extends Bx{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class t8e extends Bx{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class _3 extends Bx{}class k_e extends Bx{constructor(e){super(`Invalid unit ${e}`)}}class Fh extends Bx{}class p0 extends Bx{constructor(){super("Zone is an abstract class")}}const Ye="numeric",Ip="short",ju="long",Y5={year:Ye,month:Ye,day:Ye},U_e={year:Ye,month:Ip,day:Ye},i8e={year:Ye,month:Ip,day:Ye,weekday:Ip},z_e={year:Ye,month:ju,day:Ye},B_e={year:Ye,month:ju,day:Ye,weekday:ju},V_e={hour:Ye,minute:Ye},G_e={hour:Ye,minute:Ye,second:Ye},j_e={hour:Ye,minute:Ye,second:Ye,timeZoneName:Ip},H_e={hour:Ye,minute:Ye,second:Ye,timeZoneName:ju},q_e={hour:Ye,minute:Ye,hourCycle:"h23"},W_e={hour:Ye,minute:Ye,second:Ye,hourCycle:"h23"},Y_e={hour:Ye,minute:Ye,second:Ye,hourCycle:"h23",timeZoneName:Ip},X_e={hour:Ye,minute:Ye,second:Ye,hourCycle:"h23",timeZoneName:ju},Z_e={year:Ye,month:Ye,day:Ye,hour:Ye,minute:Ye},J_e={year:Ye,month:Ye,day:Ye,hour:Ye,minute:Ye,second:Ye},K_e={year:Ye,month:Ip,day:Ye,hour:Ye,minute:Ye},Q_e={year:Ye,month:Ip,day:Ye,hour:Ye,minute:Ye,second:Ye},r8e={year:Ye,month:Ip,day:Ye,weekday:Ip,hour:Ye,minute:Ye},eve={year:Ye,month:ju,day:Ye,hour:Ye,minute:Ye,timeZoneName:Ip},tve={year:Ye,month:ju,day:Ye,hour:Ye,minute:Ye,second:Ye,timeZoneName:Ip},ive={year:Ye,month:ju,day:Ye,weekday:ju,hour:Ye,minute:Ye,timeZoneName:ju},rve={year:Ye,month:ju,day:Ye,weekday:ju,hour:Ye,minute:Ye,second:Ye,timeZoneName:ju};class xM{get type(){throw new p0}get name(){throw new p0}get ianaName(){return this.name}get isUniversal(){throw new p0}offsetName(e,i){throw new p0}formatOffset(e,i){throw new p0}offset(e){throw new p0}equals(e){throw new p0}get isValid(){throw new p0}}let Q8=null;class F6 extends xM{static get instance(){return Q8===null&&(Q8=new F6),Q8}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return sve(e,i,r)}formatOffset(e,i){return KO(this.offset(e),i)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let hN={};function n8e(t){return hN[t]||(hN[t]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),hN[t]}const s8e={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function o8e(t,e){const i=t.format(e).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(i),[,n,s,o,a,l,c,h]=r;return[o,n,s,a,l,c,h]}function a8e(t,e){const i=t.formatToParts(e),r=[];for(let n=0;n<i.length;n++){const{type:s,value:o}=i[n],a=s8e[s];s==="era"?r[a]=o:tr(a)||(r[a]=parseInt(o,10))}return r}let z$={};class Lp extends xM{static create(e){return z$[e]||(z$[e]=new Lp(e)),z$[e]}static resetCache(){z$={},hN={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=Lp.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return sve(e,i,r,this.name)}formatOffset(e,i){return KO(this.offset(e),i)}offset(e){const i=new Date(e);if(isNaN(i))return NaN;const r=n8e(this.name);let[n,s,o,a,l,c,h]=r.formatToParts?a8e(r,i):o8e(r,i);a==="BC"&&(n=-Math.abs(n)+1);const f=U6({year:n,month:s,day:o,hour:l===24?0:l,minute:c,second:h,millisecond:0});let m=+i;const y=m%1e3;return m-=y>=0?y:1e3+y,(f-m)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let Cre={};function l8e(t,e={}){const i=JSON.stringify([t,e]);let r=Cre[i];return r||(r=new Intl.ListFormat(t,e),Cre[i]=r),r}let kG={};function UG(t,e={}){const i=JSON.stringify([t,e]);let r=kG[i];return r||(r=new Intl.DateTimeFormat(t,e),kG[i]=r),r}let zG={};function c8e(t,e={}){const i=JSON.stringify([t,e]);let r=zG[i];return r||(r=new Intl.NumberFormat(t,e),zG[i]=r),r}let BG={};function u8e(t,e={}){const{base:i,...r}=e,n=JSON.stringify([t,r]);let s=BG[n];return s||(s=new Intl.RelativeTimeFormat(t,e),BG[n]=s),s}let v3=null;function h8e(){return v3||(v3=new Intl.DateTimeFormat().resolvedOptions().locale,v3)}function d8e(t){const e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));const i=t.indexOf("-u-");if(i===-1)return[t];{let r,n;try{r=UG(t).resolvedOptions(),n=t}catch{const l=t.substring(0,i);r=UG(l).resolvedOptions(),n=l}const{numberingSystem:s,calendar:o}=r;return[n,s,o]}}function p8e(t,e,i){return(i||e)&&(t.includes("-u-")||(t+="-u"),i&&(t+=`-ca-${i}`),e&&(t+=`-nu-${e}`)),t}function f8e(t){const e=[];for(let i=1;i<=12;i++){const r=si.utc(2009,i,1);e.push(t(r))}return e}function m8e(t){const e=[];for(let i=1;i<=7;i++){const r=si.utc(2016,11,13+i);e.push(t(r))}return e}function B$(t,e,i,r){const n=t.listingMode();return n==="error"?null:n==="en"?i(e):r(e)}function g8e(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem==="latn"}class y8e{constructor(e,i,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;const{padTo:n,floor:s,...o}=r;if(!i||Object.keys(o).length>0){const a={useGrouping:!1,...r};r.padTo>0&&(a.minimumIntegerDigits=r.padTo),this.inf=c8e(e,a)}}format(e){if(this.inf){const i=this.floor?Math.floor(e):e;return this.inf.format(i)}else{const i=this.floor?Math.floor(e):tJ(e,3);return po(i,this.padTo)}}}class _8e{constructor(e,i,r){this.opts=r,this.originalZone=void 0;let n;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){const o=-1*(e.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;e.offset!==0&&Lp.create(a).valid?(n=a,this.dt=e):(n="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,n=e.zone.name):(n="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const s={...this.opts};s.timeZone=s.timeZone||n,this.dtf=UG(i,s)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(i=>{if(i.type==="timeZoneName"){const r=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...i,value:r}}else return i}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class v8e{constructor(e,i,r){this.opts={style:"long",...r},!i&&nve()&&(this.rtf=u8e(e,r))}format(e,i){return this.rtf?this.rtf.format(e,i):N8e(i,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,i){return this.rtf?this.rtf.formatToParts(e,i):[]}}class Wn{static fromOpts(e){return Wn.create(e.locale,e.numberingSystem,e.outputCalendar,e.defaultToEN)}static create(e,i,r,n=!1){const s=e||uo.defaultLocale,o=s||(n?"en-US":h8e()),a=i||uo.defaultNumberingSystem,l=r||uo.defaultOutputCalendar;return new Wn(o,a,l,s)}static resetCache(){v3=null,kG={},zG={},BG={}}static fromObject({locale:e,numberingSystem:i,outputCalendar:r}={}){return Wn.create(e,i,r)}constructor(e,i,r,n){const[s,o,a]=d8e(e);this.locale=s,this.numberingSystem=i||o||null,this.outputCalendar=r||a||null,this.intl=p8e(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=n,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=g8e(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),i=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&i?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:Wn.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,i=!1){return B$(this,e,lve,()=>{const r=i?{month:e,day:"numeric"}:{month:e},n=i?"format":"standalone";return this.monthsCache[n][e]||(this.monthsCache[n][e]=f8e(s=>this.extract(s,r,"month"))),this.monthsCache[n][e]})}weekdays(e,i=!1){return B$(this,e,hve,()=>{const r=i?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},n=i?"format":"standalone";return this.weekdaysCache[n][e]||(this.weekdaysCache[n][e]=m8e(s=>this.extract(s,r,"weekday"))),this.weekdaysCache[n][e]})}meridiems(){return B$(this,void 0,()=>dve,()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[si.utc(2016,11,13,9),si.utc(2016,11,13,19)].map(i=>this.extract(i,e,"dayperiod"))}return this.meridiemCache})}eras(e){return B$(this,e,pve,()=>{const i={era:e};return this.eraCache[e]||(this.eraCache[e]=[si.utc(-40,1,1),si.utc(2017,1,1)].map(r=>this.extract(r,i,"era"))),this.eraCache[e]})}extract(e,i,r){const n=this.dtFormatter(e,i),s=n.formatToParts(),o=s.find(a=>a.type.toLowerCase()===r);return o?o.value:null}numberFormatter(e={}){return new y8e(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,i={}){return new _8e(e,this.intl,i)}relFormatter(e={}){return new v8e(this.intl,this.isEnglish(),e)}listFormatter(e={}){return l8e(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let ez=null;class pl extends xM{static get utcInstance(){return ez===null&&(ez=new pl(0)),ez}static instance(e){return e===0?pl.utcInstance:new pl(e)}static parseSpecifier(e){if(e){const i=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(i)return new pl(z6(i[1],i[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${KO(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${KO(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,i){return KO(this.fixed,i)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class b8e extends xM{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function N_(t,e){if(tr(t)||t===null)return e;if(t instanceof xM)return t;if(w8e(t)){const i=t.toLowerCase();return i==="default"?e:i==="local"||i==="system"?F6.instance:i==="utc"||i==="gmt"?pl.utcInstance:pl.parseSpecifier(i)||Lp.create(t)}else return Vw(t)?pl.instance(t):typeof t=="object"&&"offset"in t&&typeof t.offset=="function"?t:new b8e(t)}let Are=()=>Date.now(),Ore="system",Rre=null,Pre=null,Mre=null,$re=60,Ire;class uo{static get now(){return Are}static set now(e){Are=e}static set defaultZone(e){Ore=e}static get defaultZone(){return N_(Ore,F6.instance)}static get defaultLocale(){return Rre}static set defaultLocale(e){Rre=e}static get defaultNumberingSystem(){return Pre}static set defaultNumberingSystem(e){Pre=e}static get defaultOutputCalendar(){return Mre}static set defaultOutputCalendar(e){Mre=e}static get twoDigitCutoffYear(){return $re}static set twoDigitCutoffYear(e){$re=e%100}static get throwOnInvalid(){return Ire}static set throwOnInvalid(e){Ire=e}static resetCaches(){Wn.resetCache(),Lp.resetCache()}}function tr(t){return typeof t>"u"}function Vw(t){return typeof t=="number"}function k6(t){return typeof t=="number"&&t%1===0}function w8e(t){return typeof t=="string"}function x8e(t){return Object.prototype.toString.call(t)==="[object Date]"}function nve(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function T8e(t){return Array.isArray(t)?t:[t]}function Lre(t,e,i){if(t.length!==0)return t.reduce((r,n)=>{const s=[e(n),n];return r&&i(r[0],s[0])===r[0]?r:s},null)[1]}function S8e(t,e){return e.reduce((i,r)=>(i[r]=t[r],i),{})}function BE(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function iy(t,e,i){return k6(t)&&t>=e&&t<=i}function E8e(t,e){return t-e*Math.floor(t/e)}function po(t,e=2){const i=t<0;let r;return i?r="-"+(""+-t).padStart(e,"0"):r=(""+t).padStart(e,"0"),r}function C_(t){if(!(tr(t)||t===null||t===""))return parseInt(t,10)}function _1(t){if(!(tr(t)||t===null||t===""))return parseFloat(t)}function eJ(t){if(!(tr(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function tJ(t,e,i=!1){const r=10**e;return(i?Math.trunc:Math.round)(t*r)/r}function TM(t){return t%4===0&&(t%100!==0||t%400===0)}function JO(t){return TM(t)?366:365}function X5(t,e){const i=E8e(e-1,12)+1,r=t+(e-i)/12;return i===2?TM(r)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][i-1]}function U6(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(t.year,t.month-1,t.day)),+e}function Z5(t){const e=(t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400))%7,i=t-1,r=(i+Math.floor(i/4)-Math.floor(i/100)+Math.floor(i/400))%7;return e===4||r===3?53:52}function VG(t){return t>99?t:t>uo.twoDigitCutoffYear?1900+t:2e3+t}function sve(t,e,i,r=null){const n=new Date(t),s={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(s.timeZone=r);const o={timeZoneName:e,...s},a=new Intl.DateTimeFormat(i,o).formatToParts(n).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function z6(t,e){let i=parseInt(t,10);Number.isNaN(i)&&(i=0);const r=parseInt(e,10)||0,n=i<0||Object.is(i,-0)?-r:r;return i*60+n}function ove(t){const e=Number(t);if(typeof t=="boolean"||t===""||Number.isNaN(e))throw new Fh(`Invalid unit value ${t}`);return e}function J5(t,e){const i={};for(const r in t)if(BE(t,r)){const n=t[r];if(n==null)continue;i[e(r)]=ove(n)}return i}function KO(t,e){const i=Math.trunc(Math.abs(t/60)),r=Math.trunc(Math.abs(t%60)),n=t>=0?"+":"-";switch(e){case"short":return`${n}${po(i,2)}:${po(r,2)}`;case"narrow":return`${n}${i}${r>0?`:${r}`:""}`;case"techie":return`${n}${po(i,2)}${po(r,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function B6(t){return S8e(t,["hour","minute","second","millisecond"])}const C8e=["January","February","March","April","May","June","July","August","September","October","November","December"],ave=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],A8e=["J","F","M","A","M","J","J","A","S","O","N","D"];function lve(t){switch(t){case"narrow":return[...A8e];case"short":return[...ave];case"long":return[...C8e];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const cve=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],uve=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],O8e=["M","T","W","T","F","S","S"];function hve(t){switch(t){case"narrow":return[...O8e];case"short":return[...uve];case"long":return[...cve];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const dve=["AM","PM"],R8e=["Before Christ","Anno Domini"],P8e=["BC","AD"],M8e=["B","A"];function pve(t){switch(t){case"narrow":return[...M8e];case"short":return[...P8e];case"long":return[...R8e];default:return null}}function $8e(t){return dve[t.hour<12?0:1]}function I8e(t,e){return hve(e)[t.weekday-1]}function L8e(t,e){return lve(e)[t.month-1]}function D8e(t,e){return pve(e)[t.year<0?0:1]}function N8e(t,e,i="always",r=!1){const n={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},s=["hours","minutes","seconds"].indexOf(t)===-1;if(i==="auto"&&s){const d=t==="days";switch(e){case 1:return d?"tomorrow":`next ${n[t][0]}`;case-1:return d?"yesterday":`last ${n[t][0]}`;case 0:return d?"today":`this ${n[t][0]}`}}const o=Object.is(e,-0)||e<0,a=Math.abs(e),l=a===1,c=n[t],h=r?l?c[1]:c[2]||c[1]:l?n[t][0]:t;return o?`${a} ${h} ago`:`in ${a} ${h}`}function Dre(t,e){let i="";for(const r of t)r.literal?i+=r.val:i+=e(r.val);return i}const F8e={D:Y5,DD:U_e,DDD:z_e,DDDD:B_e,t:V_e,tt:G_e,ttt:j_e,tttt:H_e,T:q_e,TT:W_e,TTT:Y_e,TTTT:X_e,f:Z_e,ff:K_e,fff:eve,ffff:ive,F:J_e,FF:Q_e,FFF:tve,FFFF:rve};class dl{static create(e,i={}){return new dl(e,i)}static parseFormat(e){let i=null,r="",n=!1;const s=[];for(let o=0;o<e.length;o++){const a=e.charAt(o);a==="'"?(r.length>0&&s.push({literal:n||/^\s+$/.test(r),val:r}),i=null,r="",n=!n):n||a===i?r+=a:(r.length>0&&s.push({literal:/^\s+$/.test(r),val:r}),r=a,i=a)}return r.length>0&&s.push({literal:n||/^\s+$/.test(r),val:r}),s}static macroTokenToFormatOpts(e){return F8e[e]}constructor(e,i){this.opts=i,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,i){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...i}).format()}dtFormatter(e,i={}){return this.loc.dtFormatter(e,{...this.opts,...i})}formatDateTime(e,i){return this.dtFormatter(e,i).format()}formatDateTimeParts(e,i){return this.dtFormatter(e,i).formatToParts()}formatInterval(e,i){return this.dtFormatter(e.start,i).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,i){return this.dtFormatter(e,i).resolvedOptions()}num(e,i=0){if(this.opts.forceSimple)return po(e,i);const r={...this.opts};return i>0&&(r.padTo=i),this.loc.numberFormatter(r).format(e)}formatDateTimeFromString(e,i){const r=this.loc.listingMode()==="en",n=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",s=(m,y)=>this.loc.extract(e,m,y),o=m=>e.isOffsetFixed&&e.offset===0&&m.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,m.format):"",a=()=>r?$8e(e):s({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(m,y)=>r?L8e(e,m):s(y?{month:m}:{month:m,day:"numeric"},"month"),c=(m,y)=>r?I8e(e,m):s(y?{weekday:m}:{weekday:m,month:"long",day:"numeric"},"weekday"),h=m=>{const y=dl.macroTokenToFormatOpts(m);return y?this.formatWithSystemDefault(e,y):m},d=m=>r?D8e(e,m):s({era:m},"era"),f=m=>{switch(m){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return a();case"d":return n?s({day:"numeric"},"day"):this.num(e.day);case"dd":return n?s({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return n?s({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return n?s({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return n?s({month:"numeric"},"month"):this.num(e.month);case"MM":return n?s({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return n?s({year:"numeric"},"year"):this.num(e.year);case"yy":return n?s({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return n?s({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return n?s({year:"numeric"},"year"):this.num(e.year,6);case"G":return d("short");case"GG":return d("long");case"GGGGG":return d("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return h(m)}};return Dre(dl.parseFormat(i),f)}formatDurationFromString(e,i){const r=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},n=l=>c=>{const h=r(c);return h?this.num(l.get(h),c.length):c},s=dl.parseFormat(i),o=s.reduce((l,{literal:c,val:h})=>c?l:l.concat(h),[]),a=e.shiftTo(...o.map(r).filter(l=>l));return Dre(s,n(a))}}class yp{constructor(e,i){this.reason=e,this.explanation=i}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const fve=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function SC(...t){const e=t.reduce((i,r)=>i+r.source,"");return RegExp(`^${e}$`)}function EC(...t){return e=>t.reduce(([i,r,n],s)=>{const[o,a,l]=s(e,n);return[{...i,...o},a||r,l]},[{},null,1]).slice(0,2)}function CC(t,...e){if(t==null)return[null,null];for(const[i,r]of e){const n=i.exec(t);if(n)return r(n)}return[null,null]}function mve(...t){return(e,i)=>{const r={};let n;for(n=0;n<t.length;n++)r[t[n]]=C_(e[i+n]);return[r,null,i+n]}}const gve=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,k8e=`(?:${gve.source}?(?:\\[(${fve.source})\\])?)?`,iJ=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,yve=RegExp(`${iJ.source}${k8e}`),rJ=RegExp(`(?:T${yve.source})?`),U8e=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,z8e=/(\d{4})-?W(\d\d)(?:-?(\d))?/,B8e=/(\d{4})-?(\d{3})/,V8e=mve("weekYear","weekNumber","weekDay"),G8e=mve("year","ordinal"),j8e=/(\d{4})-(\d\d)-(\d\d)/,_ve=RegExp(`${iJ.source} ?(?:${gve.source}|(${fve.source}))?`),H8e=RegExp(`(?: ${_ve.source})?`);function Y2(t,e,i){const r=t[e];return tr(r)?i:C_(r)}function q8e(t,e){return[{year:Y2(t,e),month:Y2(t,e+1,1),day:Y2(t,e+2,1)},null,e+3]}function AC(t,e){return[{hours:Y2(t,e,0),minutes:Y2(t,e+1,0),seconds:Y2(t,e+2,0),milliseconds:eJ(t[e+3])},null,e+4]}function SM(t,e){const i=!t[e]&&!t[e+1],r=z6(t[e+1],t[e+2]),n=i?null:pl.instance(r);return[{},n,e+3]}function EM(t,e){const i=t[e]?Lp.create(t[e]):null;return[{},i,e+1]}const W8e=RegExp(`^T?${iJ.source}$`),Y8e=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function X8e(t){const[e,i,r,n,s,o,a,l,c]=t,h=e[0]==="-",d=l&&l[0]==="-",f=(m,y=!1)=>m!==void 0&&(y||m&&h)?-m:m;return[{years:f(_1(i)),months:f(_1(r)),weeks:f(_1(n)),days:f(_1(s)),hours:f(_1(o)),minutes:f(_1(a)),seconds:f(_1(l),l==="-0"),milliseconds:f(eJ(c),d)}]}const Z8e={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function nJ(t,e,i,r,n,s,o){const a={year:e.length===2?VG(C_(e)):C_(e),month:ave.indexOf(i)+1,day:C_(r),hour:C_(n),minute:C_(s)};return o&&(a.second=C_(o)),t&&(a.weekday=t.length>3?cve.indexOf(t)+1:uve.indexOf(t)+1),a}const J8e=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function K8e(t){const[,e,i,r,n,s,o,a,l,c,h,d]=t,f=nJ(e,n,r,i,s,o,a);let m;return l?m=Z8e[l]:c?m=0:m=z6(h,d),[f,new pl(m)]}function Q8e(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const eze=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,tze=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,ize=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function Nre(t){const[,e,i,r,n,s,o,a]=t;return[nJ(e,n,r,i,s,o,a),pl.utcInstance]}function rze(t){const[,e,i,r,n,s,o,a]=t;return[nJ(e,a,i,r,n,s,o),pl.utcInstance]}const nze=SC(U8e,rJ),sze=SC(z8e,rJ),oze=SC(B8e,rJ),aze=SC(yve),vve=EC(q8e,AC,SM,EM),lze=EC(V8e,AC,SM,EM),cze=EC(G8e,AC,SM,EM),uze=EC(AC,SM,EM);function hze(t){return CC(t,[nze,vve],[sze,lze],[oze,cze],[aze,uze])}function dze(t){return CC(Q8e(t),[J8e,K8e])}function pze(t){return CC(t,[eze,Nre],[tze,Nre],[ize,rze])}function fze(t){return CC(t,[Y8e,X8e])}const mze=EC(AC);function gze(t){return CC(t,[W8e,mze])}const yze=SC(j8e,H8e),_ze=SC(_ve),vze=EC(AC,SM,EM);function bze(t){return CC(t,[yze,vve],[_ze,vze])}const Fre="Invalid Duration",bve={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},wze={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...bve},oh=146097/400,cT=146097/4800,xze={years:{quarters:4,months:12,weeks:oh/7,days:oh,hours:oh*24,minutes:oh*24*60,seconds:oh*24*60*60,milliseconds:oh*24*60*60*1e3},quarters:{months:3,weeks:oh/28,days:oh/4,hours:oh*24/4,minutes:oh*24*60/4,seconds:oh*24*60*60/4,milliseconds:oh*24*60*60*1e3/4},months:{weeks:cT/7,days:cT,hours:cT*24,minutes:cT*24*60,seconds:cT*24*60*60,milliseconds:cT*24*60*60*1e3},...bve},Cw=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],Tze=Cw.slice(0).reverse();function f0(t,e,i=!1){const r={values:i?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new vr(r)}function wve(t,e){let i=e.milliseconds??0;for(const r of Tze.slice(1))e[r]&&(i+=e[r]*t[r].milliseconds);return i}function kre(t,e){const i=wve(t,e)<0?-1:1;Cw.reduceRight((r,n)=>{if(tr(e[n]))return r;if(r){const s=e[r]*i,o=t[n][r],a=Math.floor(s/o);e[n]+=a*i,e[r]-=a*o*i}return n},null),Cw.reduce((r,n)=>{if(tr(e[n]))return r;if(r){const s=e[r]%1;e[r]-=s,e[n]+=s*t[r][n]}return n},null)}function Sze(t){const e={};for(const[i,r]of Object.entries(t))r!==0&&(e[i]=r);return e}class vr{constructor(e){const i=e.conversionAccuracy==="longterm"||!1;let r=i?xze:wze;e.matrix&&(r=e.matrix),this.values=e.values,this.loc=e.loc||Wn.create(),this.conversionAccuracy=i?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=r,this.isLuxonDuration=!0}static fromMillis(e,i){return vr.fromObject({milliseconds:e},i)}static fromObject(e,i={}){if(e==null||typeof e!="object")throw new Fh(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new vr({values:J5(e,vr.normalizeUnit),loc:Wn.fromObject(i),conversionAccuracy:i.conversionAccuracy,matrix:i.matrix})}static fromDurationLike(e){if(Vw(e))return vr.fromMillis(e);if(vr.isDuration(e))return e;if(typeof e=="object")return vr.fromObject(e);throw new Fh(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,i){const[r]=fze(e);return r?vr.fromObject(r,i):vr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,i){const[r]=gze(e);return r?vr.fromObject(r,i):vr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,i=null){if(!e)throw new Fh("need to specify a reason the Duration is invalid");const r=e instanceof yp?e:new yp(e,i);if(uo.throwOnInvalid)throw new t8e(r);return new vr({invalid:r})}static normalizeUnit(e){const i={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!i)throw new k_e(e);return i}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,i={}){const r={...i,floor:i.round!==!1&&i.floor!==!1};return this.isValid?dl.create(this.loc,r).formatDurationFromString(this,e):Fre}toHuman(e={}){if(!this.isValid)return Fre;const i=Cw.map(r=>{const n=this.values[r];return tr(n)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:r.slice(0,-1)}).format(n)}).filter(r=>r);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(i)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=tJ(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const i=this.toMillis();return i<0||i>=864e5?null:(e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e,includeOffset:!1},si.fromMillis(i,{zone:"UTC"}).toISOTime(e))}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.isValid?wve(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const i=vr.fromDurationLike(e),r={};for(const n of Cw)(BE(i.values,n)||BE(this.values,n))&&(r[n]=i.get(n)+this.get(n));return f0(this,{values:r},!0)}minus(e){if(!this.isValid)return this;const i=vr.fromDurationLike(e);return this.plus(i.negate())}mapUnits(e){if(!this.isValid)return this;const i={};for(const r of Object.keys(this.values))i[r]=ove(e(this.values[r],r));return f0(this,{values:i},!0)}get(e){return this[vr.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const i={...this.values,...J5(e,vr.normalizeUnit)};return f0(this,{values:i})}reconfigure({locale:e,numberingSystem:i,conversionAccuracy:r,matrix:n}={}){const o={loc:this.loc.clone({locale:e,numberingSystem:i}),matrix:n,conversionAccuracy:r};return f0(this,o)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return kre(this.matrix,e),f0(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=Sze(this.normalize().shiftToAll().toObject());return f0(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(o=>vr.normalizeUnit(o));const i={},r={},n=this.toObject();let s;for(const o of Cw)if(e.indexOf(o)>=0){s=o;let a=0;for(const c in r)a+=this.matrix[c][o]*r[c],r[c]=0;Vw(n[o])&&(a+=n[o]);const l=Math.trunc(a);i[o]=l,r[o]=(a*1e3-l*1e3)/1e3}else Vw(n[o])&&(r[o]=n[o]);for(const o in r)r[o]!==0&&(i[s]+=o===s?r[o]:r[o]/this.matrix[s][o]);return kre(this.matrix,i),f0(this,{values:i},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const i of Object.keys(this.values))e[i]=this.values[i]===0?0:-this.values[i];return f0(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function i(r,n){return r===void 0||r===0?n===void 0||n===0:r===n}for(const r of Cw)if(!i(this.values[r],e.values[r]))return!1;return!0}}const uT="Invalid Interval";function Eze(t,e){return!t||!t.isValid?Ts.invalid("missing or invalid start"):!e||!e.isValid?Ts.invalid("missing or invalid end"):e<t?Ts.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class Ts{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,i=null){if(!e)throw new Fh("need to specify a reason the Interval is invalid");const r=e instanceof yp?e:new yp(e,i);if(uo.throwOnInvalid)throw new e8e(r);return new Ts({invalid:r})}static fromDateTimes(e,i){const r=QC(e),n=QC(i),s=Eze(r,n);return s??new Ts({start:r,end:n})}static after(e,i){const r=vr.fromDurationLike(i),n=QC(e);return Ts.fromDateTimes(n,n.plus(r))}static before(e,i){const r=vr.fromDurationLike(i),n=QC(e);return Ts.fromDateTimes(n.minus(r),n)}static fromISO(e,i){const[r,n]=(e||"").split("/",2);if(r&&n){let s,o;try{s=si.fromISO(r,i),o=s.isValid}catch{o=!1}let a,l;try{a=si.fromISO(n,i),l=a.isValid}catch{l=!1}if(o&&l)return Ts.fromDateTimes(s,a);if(o){const c=vr.fromISO(n,i);if(c.isValid)return Ts.after(s,c)}else if(l){const c=vr.fromISO(r,i);if(c.isValid)return Ts.before(a,c)}}return Ts.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds"){if(!this.isValid)return NaN;const i=this.start.startOf(e),r=this.end.startOf(e);return Math.floor(r.diff(i,e).get(e))+(r.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:i}={}){return this.isValid?Ts.fromDateTimes(e||this.s,i||this.e):this}splitAt(...e){if(!this.isValid)return[];const i=e.map(QC).filter(o=>this.contains(o)).sort(),r=[];let{s:n}=this,s=0;for(;n<this.e;){const o=i[s]||this.e,a=+o>+this.e?this.e:o;r.push(Ts.fromDateTimes(n,a)),n=a,s+=1}return r}splitBy(e){const i=vr.fromDurationLike(e);if(!this.isValid||!i.isValid||i.as("milliseconds")===0)return[];let{s:r}=this,n=1,s;const o=[];for(;r<this.e;){const a=this.start.plus(i.mapUnits(l=>l*n));s=+a>+this.e?this.e:a,o.push(Ts.fromDateTimes(r,s)),r=s,n+=1}return o}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const i=this.s>e.s?this.s:e.s,r=this.e<e.e?this.e:e.e;return i>=r?null:Ts.fromDateTimes(i,r)}union(e){if(!this.isValid)return this;const i=this.s<e.s?this.s:e.s,r=this.e>e.e?this.e:e.e;return Ts.fromDateTimes(i,r)}static merge(e){const[i,r]=e.sort((n,s)=>n.s-s.s).reduce(([n,s],o)=>s?s.overlaps(o)||s.abutsStart(o)?[n,s.union(o)]:[n.concat([s]),o]:[n,o],[[],null]);return r&&i.push(r),i}static xor(e){let i=null,r=0;const n=[],s=e.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...s),a=o.sort((l,c)=>l.time-c.time);for(const l of a)r+=l.type==="s"?1:-1,r===1?i=l.time:(i&&+i!=+l.time&&n.push(Ts.fromDateTimes(i,l.time)),i=null);return Ts.merge(n)}difference(...e){return Ts.xor([this].concat(e)).map(i=>this.intersection(i)).filter(i=>i&&!i.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} – ${this.e.toISO()})`:uT}toLocaleString(e=Y5,i={}){return this.isValid?dl.create(this.s.loc.clone(i),e).formatInterval(this):uT}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:uT}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:uT}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:uT}toFormat(e,{separator:i=" – "}={}){return this.isValid?`${this.s.toFormat(e)}${i}${this.e.toFormat(e)}`:uT}toDuration(e,i){return this.isValid?this.e.diff(this.s,e,i):vr.invalid(this.invalidReason)}mapEndpoints(e){return Ts.fromDateTimes(e(this.s),e(this.e))}}class V${static hasDST(e=uo.defaultZone){const i=si.now().setZone(e).set({month:12});return!e.isUniversal&&i.offset!==i.set({month:6}).offset}static isValidIANAZone(e){return Lp.isValidZone(e)}static normalizeZone(e){return N_(e,uo.defaultZone)}static months(e="long",{locale:i=null,numberingSystem:r=null,locObj:n=null,outputCalendar:s="gregory"}={}){return(n||Wn.create(i,r,s)).months(e)}static monthsFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:n=null,outputCalendar:s="gregory"}={}){return(n||Wn.create(i,r,s)).months(e,!0)}static weekdays(e="long",{locale:i=null,numberingSystem:r=null,locObj:n=null}={}){return(n||Wn.create(i,r,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:n=null}={}){return(n||Wn.create(i,r,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return Wn.create(e).meridiems()}static eras(e="short",{locale:i=null}={}){return Wn.create(i,null,"gregory").eras(e)}static features(){return{relative:nve()}}}function Ure(t,e){const i=n=>n.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=i(e)-i(t);return Math.floor(vr.fromMillis(r).as("days"))}function Cze(t,e,i){const r=[["years",(l,c)=>c.year-l.year],["quarters",(l,c)=>c.quarter-l.quarter+(c.year-l.year)*4],["months",(l,c)=>c.month-l.month+(c.year-l.year)*12],["weeks",(l,c)=>{const h=Ure(l,c);return(h-h%7)/7}],["days",Ure]],n={},s=t;let o,a;for(const[l,c]of r)i.indexOf(l)>=0&&(o=l,n[l]=c(t,e),a=s.plus(n),a>e?(n[l]--,t=s.plus(n),t>e&&(a=t,n[l]--,t=s.plus(n))):t=a);return[t,n,a,o]}function Aze(t,e,i,r){let[n,s,o,a]=Cze(t,e,i);const l=e-n,c=i.filter(d=>["hours","minutes","seconds","milliseconds"].indexOf(d)>=0);c.length===0&&(o<e&&(o=n.plus({[a]:1})),o!==n&&(s[a]=(s[a]||0)+l/(o-n)));const h=vr.fromObject(s,r);return c.length>0?vr.fromMillis(l,r).shiftTo(...c).plus(h):h}const sJ={arab:"[٠-٩]",arabext:"[۰-۹]",bali:"[᭐-᭙]",beng:"[০-৯]",deva:"[०-९]",fullwide:"[０-９]",gujr:"[૦-૯]",hanidec:"[〇|一|二|三|四|五|六|七|八|九]",khmr:"[០-៩]",knda:"[೦-೯]",laoo:"[໐-໙]",limb:"[᥆-᥏]",mlym:"[൦-൯]",mong:"[᠐-᠙]",mymr:"[၀-၉]",orya:"[୦-୯]",tamldec:"[௦-௯]",telu:"[౦-౯]",thai:"[๐-๙]",tibt:"[༠-༩]",latn:"\\d"},zre={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},Oze=sJ.hanidec.replace(/[\[|\]]/g,"").split("");function Rze(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);if(t[i].search(sJ.hanidec)!==-1)e+=Oze.indexOf(t[i]);else for(const n in zre){const[s,o]=zre[n];r>=s&&r<=o&&(e+=r-s)}}return parseInt(e,10)}else return e}function bd({numberingSystem:t},e=""){return new RegExp(`${sJ[t||"latn"]}${e}`)}const Pze="missing Intl.DateTimeFormat.formatToParts support";function Lr(t,e=i=>i){return{regex:t,deser:([i])=>e(Rze(i))}}const Mze=String.fromCharCode(160),xve=`[ ${Mze}]`,Tve=new RegExp(xve,"g");function $ze(t){return t.replace(/\./g,"\\.?").replace(Tve,xve)}function Bre(t){return t.replace(/\./g,"").replace(Tve," ").toLowerCase()}function wd(t,e){return t===null?null:{regex:RegExp(t.map($ze).join("|")),deser:([i])=>t.findIndex(r=>Bre(i)===Bre(r))+e}}function Vre(t,e){return{regex:t,deser:([,i,r])=>z6(i,r),groups:e}}function G$(t){return{regex:t,deser:([e])=>e}}function Ize(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function Lze(t,e){const i=bd(e),r=bd(e,"{2}"),n=bd(e,"{3}"),s=bd(e,"{4}"),o=bd(e,"{6}"),a=bd(e,"{1,2}"),l=bd(e,"{1,3}"),c=bd(e,"{1,6}"),h=bd(e,"{1,9}"),d=bd(e,"{2,4}"),f=bd(e,"{4,6}"),m=v=>({regex:RegExp(Ize(v.val)),deser:([w])=>w,literal:!0}),_=(v=>{if(t.literal)return m(v);switch(v.val){case"G":return wd(e.eras("short"),0);case"GG":return wd(e.eras("long"),0);case"y":return Lr(c);case"yy":return Lr(d,VG);case"yyyy":return Lr(s);case"yyyyy":return Lr(f);case"yyyyyy":return Lr(o);case"M":return Lr(a);case"MM":return Lr(r);case"MMM":return wd(e.months("short",!0),1);case"MMMM":return wd(e.months("long",!0),1);case"L":return Lr(a);case"LL":return Lr(r);case"LLL":return wd(e.months("short",!1),1);case"LLLL":return wd(e.months("long",!1),1);case"d":return Lr(a);case"dd":return Lr(r);case"o":return Lr(l);case"ooo":return Lr(n);case"HH":return Lr(r);case"H":return Lr(a);case"hh":return Lr(r);case"h":return Lr(a);case"mm":return Lr(r);case"m":return Lr(a);case"q":return Lr(a);case"qq":return Lr(r);case"s":return Lr(a);case"ss":return Lr(r);case"S":return Lr(l);case"SSS":return Lr(n);case"u":return G$(h);case"uu":return G$(a);case"uuu":return Lr(i);case"a":return wd(e.meridiems(),0);case"kkkk":return Lr(s);case"kk":return Lr(d,VG);case"W":return Lr(a);case"WW":return Lr(r);case"E":case"c":return Lr(i);case"EEE":return wd(e.weekdays("short",!1),1);case"EEEE":return wd(e.weekdays("long",!1),1);case"ccc":return wd(e.weekdays("short",!0),1);case"cccc":return wd(e.weekdays("long",!0),1);case"Z":case"ZZ":return Vre(new RegExp(`([+-]${a.source})(?::(${r.source}))?`),2);case"ZZZ":return Vre(new RegExp(`([+-]${a.source})(${r.source})?`),2);case"z":return G$(/[a-z_+-/]{1,256}?/i);case" ":return G$(/[^\S\n\r]/);default:return m(v)}})(t)||{invalidReason:Pze};return _.token=t,_}const Dze={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function Nze(t,e,i){const{type:r,value:n}=t;if(r==="literal"){const l=/^\s+$/.test(n);return{literal:!l,val:l?" ":n}}const s=e[r];let o=r;r==="hour"&&(e.hour12!=null?o=e.hour12?"hour12":"hour24":e.hourCycle!=null?e.hourCycle==="h11"||e.hourCycle==="h12"?o="hour12":o="hour24":o=i.hour12?"hour12":"hour24");let a=Dze[o];if(typeof a=="object"&&(a=a[s]),a)return{literal:!1,val:a}}function Fze(t){return[`^${t.map(i=>i.regex).reduce((i,r)=>`${i}(${r.source})`,"")}$`,t]}function kze(t,e,i){const r=t.match(e);if(r){const n={};let s=1;for(const o in i)if(BE(i,o)){const a=i[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(n[a.token.val[0]]=a.deser(r.slice(s,s+l))),s+=l}return[r,n]}else return[r,{}]}function Uze(t){const e=s=>{switch(s){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let i=null,r;return tr(t.z)||(i=Lp.create(t.z)),tr(t.Z)||(i||(i=new pl(t.Z)),r=t.Z),tr(t.q)||(t.M=(t.q-1)*3+1),tr(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),tr(t.u)||(t.S=eJ(t.u)),[Object.keys(t).reduce((s,o)=>{const a=e(o);return a&&(s[a]=t[o]),s},{}),i,r]}let tz=null;function zze(){return tz||(tz=si.fromMillis(1555555555555)),tz}function Bze(t,e){if(t.literal)return t;const i=dl.macroTokenToFormatOpts(t.val),r=Cve(i,e);return r==null||r.includes(void 0)?t:r}function Sve(t,e){return Array.prototype.concat(...t.map(i=>Bze(i,e)))}function Eve(t,e,i){const r=Sve(dl.parseFormat(i),t),n=r.map(o=>Lze(o,t)),s=n.find(o=>o.invalidReason);if(s)return{input:e,tokens:r,invalidReason:s.invalidReason};{const[o,a]=Fze(n),l=RegExp(o,"i"),[c,h]=kze(e,l,a),[d,f,m]=h?Uze(h):[null,null,void 0];if(BE(h,"a")&&BE(h,"H"))throw new _3("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:r,regex:l,rawMatches:c,matches:h,result:d,zone:f,specificOffset:m}}}function Vze(t,e,i){const{result:r,zone:n,specificOffset:s,invalidReason:o}=Eve(t,e,i);return[r,n,s,o]}function Cve(t,e){if(!t)return null;const r=dl.create(e,t).dtFormatter(zze()),n=r.formatToParts(),s=r.resolvedOptions();return n.map(o=>Nze(o,t,s))}const Ave=[0,31,59,90,120,151,181,212,243,273,304,334],Ove=[0,31,60,91,121,152,182,213,244,274,305,335];function qh(t,e){return new yp("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function Rve(t,e,i){const r=new Date(Date.UTC(t,e-1,i));t<100&&t>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);const n=r.getUTCDay();return n===0?7:n}function Pve(t,e,i){return i+(TM(t)?Ove:Ave)[e-1]}function Mve(t,e){const i=TM(t)?Ove:Ave,r=i.findIndex(s=>s<e),n=e-i[r];return{month:r+1,day:n}}function GG(t){const{year:e,month:i,day:r}=t,n=Pve(e,i,r),s=Rve(e,i,r);let o=Math.floor((n-s+10)/7),a;return o<1?(a=e-1,o=Z5(a)):o>Z5(e)?(a=e+1,o=1):a=e,{weekYear:a,weekNumber:o,weekday:s,...B6(t)}}function Gre(t){const{weekYear:e,weekNumber:i,weekday:r}=t,n=Rve(e,1,4),s=JO(e);let o=i*7+r-n-3,a;o<1?(a=e-1,o+=JO(a)):o>s?(a=e+1,o-=JO(e)):a=e;const{month:l,day:c}=Mve(a,o);return{year:a,month:l,day:c,...B6(t)}}function iz(t){const{year:e,month:i,day:r}=t,n=Pve(e,i,r);return{year:e,ordinal:n,...B6(t)}}function jre(t){const{year:e,ordinal:i}=t,{month:r,day:n}=Mve(e,i);return{year:e,month:r,day:n,...B6(t)}}function Gze(t){const e=k6(t.weekYear),i=iy(t.weekNumber,1,Z5(t.weekYear)),r=iy(t.weekday,1,7);return e?i?r?!1:qh("weekday",t.weekday):qh("week",t.week):qh("weekYear",t.weekYear)}function jze(t){const e=k6(t.year),i=iy(t.ordinal,1,JO(t.year));return e?i?!1:qh("ordinal",t.ordinal):qh("year",t.year)}function $ve(t){const e=k6(t.year),i=iy(t.month,1,12),r=iy(t.day,1,X5(t.year,t.month));return e?i?r?!1:qh("day",t.day):qh("month",t.month):qh("year",t.year)}function Ive(t){const{hour:e,minute:i,second:r,millisecond:n}=t,s=iy(e,0,23)||e===24&&i===0&&r===0&&n===0,o=iy(i,0,59),a=iy(r,0,59),l=iy(n,0,999);return s?o?a?l?!1:qh("millisecond",n):qh("second",r):qh("minute",i):qh("hour",e)}const rz="Invalid DateTime",Hre=864e13;function j$(t){return new yp("unsupported zone",`the zone "${t.name}" is not supported`)}function nz(t){return t.weekData===null&&(t.weekData=GG(t.c)),t.weekData}function v1(t,e){const i={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new si({...i,...e,old:i})}function Lve(t,e,i){let r=t-e*60*1e3;const n=i.offset(r);if(e===n)return[r,e];r-=(n-e)*60*1e3;const s=i.offset(r);return n===s?[r,n]:[t-Math.min(n,s)*60*1e3,Math.max(n,s)]}function H$(t,e){t+=e*60*1e3;const i=new Date(t);return{year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate(),hour:i.getUTCHours(),minute:i.getUTCMinutes(),second:i.getUTCSeconds(),millisecond:i.getUTCMilliseconds()}}function dN(t,e,i){return Lve(U6(t),e,i)}function qre(t,e){const i=t.o,r=t.c.year+Math.trunc(e.years),n=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,s={...t.c,year:r,month:n,day:Math.min(t.c.day,X5(r,n))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},o=vr.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),a=U6(s);let[l,c]=Lve(a,i,t.zone);return o!==0&&(l+=o,c=t.zone.offset(l)),{ts:l,o:c}}function KC(t,e,i,r,n,s){const{setZone:o,zone:a}=i;if(t&&Object.keys(t).length!==0||e){const l=e||a,c=si.fromObject(t,{...i,zone:l,specificOffset:s});return o?c:c.setZone(a)}else return si.invalid(new yp("unparsable",`the input "${n}" can't be parsed as ${r}`))}function q$(t,e,i=!0){return t.isValid?dl.create(Wn.create("en-US"),{allowZ:i,forceSimple:!0}).formatDateTimeFromString(t,e):null}function sz(t,e){const i=t.c.year>9999||t.c.year<0;let r="";return i&&t.c.year>=0&&(r+="+"),r+=po(t.c.year,i?6:4),e?(r+="-",r+=po(t.c.month),r+="-",r+=po(t.c.day)):(r+=po(t.c.month),r+=po(t.c.day)),r}function Wre(t,e,i,r,n,s){let o=po(t.c.hour);return e?(o+=":",o+=po(t.c.minute),(t.c.millisecond!==0||t.c.second!==0||!i)&&(o+=":")):o+=po(t.c.minute),(t.c.millisecond!==0||t.c.second!==0||!i)&&(o+=po(t.c.second),(t.c.millisecond!==0||!r)&&(o+=".",o+=po(t.c.millisecond,3))),n&&(t.isOffsetFixed&&t.offset===0&&!s?o+="Z":t.o<0?(o+="-",o+=po(Math.trunc(-t.o/60)),o+=":",o+=po(Math.trunc(-t.o%60))):(o+="+",o+=po(Math.trunc(t.o/60)),o+=":",o+=po(Math.trunc(t.o%60)))),s&&(o+="["+t.zone.ianaName+"]"),o}const Dve={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},Hze={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},qze={ordinal:1,hour:0,minute:0,second:0,millisecond:0},Nve=["year","month","day","hour","minute","second","millisecond"],Wze=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],Yze=["year","ordinal","hour","minute","second","millisecond"];function Yre(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new k_e(t);return e}function Xre(t,e){const i=N_(e.zone,uo.defaultZone),r=Wn.fromObject(e),n=uo.now();let s,o;if(tr(t.year))s=n;else{for(const c of Nve)tr(t[c])&&(t[c]=Dve[c]);const a=$ve(t)||Ive(t);if(a)return si.invalid(a);const l=i.offset(n);[s,o]=dN(t,l,i)}return new si({ts:s,zone:i,loc:r,o})}function Zre(t,e,i){const r=tr(i.round)?!0:i.round,n=(o,a)=>(o=tJ(o,r||i.calendary?0:2,!0),e.loc.clone(i).relFormatter(i).format(o,a)),s=o=>i.calendary?e.hasSame(t,o)?0:e.startOf(o).diff(t.startOf(o),o).get(o):e.diff(t,o).get(o);if(i.unit)return n(s(i.unit),i.unit);for(const o of i.units){const a=s(o);if(Math.abs(a)>=1)return n(a,o)}return n(t>e?-0:0,i.units[i.units.length-1])}function Jre(t){let e={},i;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],i=Array.from(t).slice(0,t.length-1)):i=Array.from(t),[e,i]}class si{constructor(e){const i=e.zone||uo.defaultZone;let r=e.invalid||(Number.isNaN(e.ts)?new yp("invalid input"):null)||(i.isValid?null:j$(i));this.ts=tr(e.ts)?uo.now():e.ts;let n=null,s=null;if(!r)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(i))[n,s]=[e.old.c,e.old.o];else{const a=i.offset(this.ts);n=H$(this.ts,a),r=Number.isNaN(n.year)?new yp("invalid input"):null,n=r?null:n,s=r?null:a}this._zone=i,this.loc=e.loc||Wn.create(),this.invalid=r,this.weekData=null,this.c=n,this.o=s,this.isLuxonDateTime=!0}static now(){return new si({})}static local(){const[e,i]=Jre(arguments),[r,n,s,o,a,l,c]=i;return Xre({year:r,month:n,day:s,hour:o,minute:a,second:l,millisecond:c},e)}static utc(){const[e,i]=Jre(arguments),[r,n,s,o,a,l,c]=i;return e.zone=pl.utcInstance,Xre({year:r,month:n,day:s,hour:o,minute:a,second:l,millisecond:c},e)}static fromJSDate(e,i={}){const r=x8e(e)?e.valueOf():NaN;if(Number.isNaN(r))return si.invalid("invalid input");const n=N_(i.zone,uo.defaultZone);return n.isValid?new si({ts:r,zone:n,loc:Wn.fromObject(i)}):si.invalid(j$(n))}static fromMillis(e,i={}){if(Vw(e))return e<-Hre||e>Hre?si.invalid("Timestamp out of range"):new si({ts:e,zone:N_(i.zone,uo.defaultZone),loc:Wn.fromObject(i)});throw new Fh(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,i={}){if(Vw(e))return new si({ts:e*1e3,zone:N_(i.zone,uo.defaultZone),loc:Wn.fromObject(i)});throw new Fh("fromSeconds requires a numerical input")}static fromObject(e,i={}){e=e||{};const r=N_(i.zone,uo.defaultZone);if(!r.isValid)return si.invalid(j$(r));const n=uo.now(),s=tr(i.specificOffset)?r.offset(n):i.specificOffset,o=J5(e,Yre),a=!tr(o.ordinal),l=!tr(o.year),c=!tr(o.month)||!tr(o.day),h=l||c,d=o.weekYear||o.weekNumber,f=Wn.fromObject(i);if((h||a)&&d)throw new _3("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&a)throw new _3("Can't mix ordinal dates with month/day");const m=d||o.weekday&&!h;let y,_,v=H$(n,s);m?(y=Wze,_=Hze,v=GG(v)):a?(y=Yze,_=qze,v=iz(v)):(y=Nve,_=Dve);let w=!1;for(const D of y){const N=o[D];tr(N)?w?o[D]=_[D]:o[D]=v[D]:w=!0}const x=m?Gze(o):a?jze(o):$ve(o),T=x||Ive(o);if(T)return si.invalid(T);const S=m?Gre(o):a?jre(o):o,[C,A]=dN(S,s,r),R=new si({ts:C,zone:r,o:A,loc:f});return o.weekday&&h&&e.weekday!==R.weekday?si.invalid("mismatched weekday",`you can't specify both a weekday of ${o.weekday} and a date of ${R.toISO()}`):R}static fromISO(e,i={}){const[r,n]=hze(e);return KC(r,n,i,"ISO 8601",e)}static fromRFC2822(e,i={}){const[r,n]=dze(e);return KC(r,n,i,"RFC 2822",e)}static fromHTTP(e,i={}){const[r,n]=pze(e);return KC(r,n,i,"HTTP",i)}static fromFormat(e,i,r={}){if(tr(e)||tr(i))throw new Fh("fromFormat requires an input string and a format");const{locale:n=null,numberingSystem:s=null}=r,o=Wn.fromOpts({locale:n,numberingSystem:s,defaultToEN:!0}),[a,l,c,h]=Vze(o,e,i);return h?si.invalid(h):KC(a,l,r,`format ${i}`,e,c)}static fromString(e,i,r={}){return si.fromFormat(e,i,r)}static fromSQL(e,i={}){const[r,n]=bze(e);return KC(r,n,i,"SQL",e)}static invalid(e,i=null){if(!e)throw new Fh("need to specify a reason the DateTime is invalid");const r=e instanceof yp?e:new yp(e,i);if(uo.throwOnInvalid)throw new QUe(r);return new si({invalid:r})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,i={}){const r=Cve(e,Wn.fromObject(i));return r?r.map(n=>n?n.val:null).join(""):null}static expandFormat(e,i={}){return Sve(dl.parseFormat(e),Wn.fromObject(i)).map(n=>n.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?nz(this).weekYear:NaN}get weekNumber(){return this.isValid?nz(this).weekNumber:NaN}get weekday(){return this.isValid?nz(this).weekday:NaN}get ordinal(){return this.isValid?iz(this.c).ordinal:NaN}get monthShort(){return this.isValid?V$.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?V$.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?V$.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?V$.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const e=864e5,i=6e4,r=U6(this.c),n=this.zone.offset(r-e),s=this.zone.offset(r+e),o=this.zone.offset(r-n*i),a=this.zone.offset(r-s*i);if(o===a)return[this];const l=r-o*i,c=r-a*i,h=H$(l,o),d=H$(c,a);return h.hour===d.hour&&h.minute===d.minute&&h.second===d.second&&h.millisecond===d.millisecond?[v1(this,{ts:l}),v1(this,{ts:c})]:[this]}get isInLeapYear(){return TM(this.year)}get daysInMonth(){return X5(this.year,this.month)}get daysInYear(){return this.isValid?JO(this.year):NaN}get weeksInWeekYear(){return this.isValid?Z5(this.weekYear):NaN}resolvedLocaleOptions(e={}){const{locale:i,numberingSystem:r,calendar:n}=dl.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:i,numberingSystem:r,outputCalendar:n}}toUTC(e=0,i={}){return this.setZone(pl.instance(e),i)}toLocal(){return this.setZone(uo.defaultZone)}setZone(e,{keepLocalTime:i=!1,keepCalendarTime:r=!1}={}){if(e=N_(e,uo.defaultZone),e.equals(this.zone))return this;if(e.isValid){let n=this.ts;if(i||r){const s=e.offset(this.ts),o=this.toObject();[n]=dN(o,s,e)}return v1(this,{ts:n,zone:e})}else return si.invalid(j$(e))}reconfigure({locale:e,numberingSystem:i,outputCalendar:r}={}){const n=this.loc.clone({locale:e,numberingSystem:i,outputCalendar:r});return v1(this,{loc:n})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const i=J5(e,Yre),r=!tr(i.weekYear)||!tr(i.weekNumber)||!tr(i.weekday),n=!tr(i.ordinal),s=!tr(i.year),o=!tr(i.month)||!tr(i.day),a=s||o,l=i.weekYear||i.weekNumber;if((a||n)&&l)throw new _3("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(o&&n)throw new _3("Can't mix ordinal dates with month/day");let c;r?c=Gre({...GG(this.c),...i}):tr(i.ordinal)?(c={...this.toObject(),...i},tr(i.day)&&(c.day=Math.min(X5(c.year,c.month),c.day))):c=jre({...iz(this.c),...i});const[h,d]=dN(c,this.o,this.zone);return v1(this,{ts:h,o:d})}plus(e){if(!this.isValid)return this;const i=vr.fromDurationLike(e);return v1(this,qre(this,i))}minus(e){if(!this.isValid)return this;const i=vr.fromDurationLike(e).negate();return v1(this,qre(this,i))}startOf(e){if(!this.isValid)return this;const i={},r=vr.normalizeUnit(e);switch(r){case"years":i.month=1;case"quarters":case"months":i.day=1;case"weeks":case"days":i.hour=0;case"hours":i.minute=0;case"minutes":i.second=0;case"seconds":i.millisecond=0;break}if(r==="weeks"&&(i.weekday=1),r==="quarters"){const n=Math.ceil(this.month/3);i.month=(n-1)*3+1}return this.set(i)}endOf(e){return this.isValid?this.plus({[e]:1}).startOf(e).minus(1):this}toFormat(e,i={}){return this.isValid?dl.create(this.loc.redefaultToEN(i)).formatDateTimeFromString(this,e):rz}toLocaleString(e=Y5,i={}){return this.isValid?dl.create(this.loc.clone(i),e).formatDateTime(this):rz}toLocaleParts(e={}){return this.isValid?dl.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:i=!1,suppressMilliseconds:r=!1,includeOffset:n=!0,extendedZone:s=!1}={}){if(!this.isValid)return null;const o=e==="extended";let a=sz(this,o);return a+="T",a+=Wre(this,o,i,r,n,s),a}toISODate({format:e="extended"}={}){return this.isValid?sz(this,e==="extended"):null}toISOWeekDate(){return q$(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:i=!1,includeOffset:r=!0,includePrefix:n=!1,extendedZone:s=!1,format:o="extended"}={}){return this.isValid?(n?"T":"")+Wre(this,o==="extended",i,e,r,s):null}toRFC2822(){return q$(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return q$(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?sz(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:i=!1,includeOffsetSpace:r=!0}={}){let n="HH:mm:ss.SSS";return(i||e)&&(r&&(n+=" "),i?n+="z":e&&(n+="ZZ")),q$(this,n,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():rz}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const i={...this.c};return e.includeConfig&&(i.outputCalendar=this.outputCalendar,i.numberingSystem=this.loc.numberingSystem,i.locale=this.loc.locale),i}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,i="milliseconds",r={}){if(!this.isValid||!e.isValid)return vr.invalid("created by diffing an invalid DateTime");const n={locale:this.locale,numberingSystem:this.numberingSystem,...r},s=T8e(i).map(vr.normalizeUnit),o=e.valueOf()>this.valueOf(),a=o?this:e,l=o?e:this,c=Aze(a,l,s,n);return o?c.negate():c}diffNow(e="milliseconds",i={}){return this.diff(si.now(),e,i)}until(e){return this.isValid?Ts.fromDateTimes(this,e):this}hasSame(e,i){if(!this.isValid)return!1;const r=e.valueOf(),n=this.setZone(e.zone,{keepLocalTime:!0});return n.startOf(i)<=r&&r<=n.endOf(i)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const i=e.base||si.fromObject({},{zone:this.zone}),r=e.padding?this<i?-e.padding:e.padding:0;let n=["years","months","days","hours","minutes","seconds"],s=e.unit;return Array.isArray(e.unit)&&(n=e.unit,s=void 0),Zre(i,this.plus(r),{...e,numeric:"always",units:n,unit:s})}toRelativeCalendar(e={}){return this.isValid?Zre(e.base||si.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(si.isDateTime))throw new Fh("min requires all arguments be DateTimes");return Lre(e,i=>i.valueOf(),Math.min)}static max(...e){if(!e.every(si.isDateTime))throw new Fh("max requires all arguments be DateTimes");return Lre(e,i=>i.valueOf(),Math.max)}static fromFormatExplain(e,i,r={}){const{locale:n=null,numberingSystem:s=null}=r,o=Wn.fromOpts({locale:n,numberingSystem:s,defaultToEN:!0});return Eve(o,e,i)}static fromStringExplain(e,i,r={}){return si.fromFormatExplain(e,i,r)}static get DATE_SHORT(){return Y5}static get DATE_MED(){return U_e}static get DATE_MED_WITH_WEEKDAY(){return i8e}static get DATE_FULL(){return z_e}static get DATE_HUGE(){return B_e}static get TIME_SIMPLE(){return V_e}static get TIME_WITH_SECONDS(){return G_e}static get TIME_WITH_SHORT_OFFSET(){return j_e}static get TIME_WITH_LONG_OFFSET(){return H_e}static get TIME_24_SIMPLE(){return q_e}static get TIME_24_WITH_SECONDS(){return W_e}static get TIME_24_WITH_SHORT_OFFSET(){return Y_e}static get TIME_24_WITH_LONG_OFFSET(){return X_e}static get DATETIME_SHORT(){return Z_e}static get DATETIME_SHORT_WITH_SECONDS(){return J_e}static get DATETIME_MED(){return K_e}static get DATETIME_MED_WITH_SECONDS(){return Q_e}static get DATETIME_MED_WITH_WEEKDAY(){return r8e}static get DATETIME_FULL(){return eve}static get DATETIME_FULL_WITH_SECONDS(){return tve}static get DATETIME_HUGE(){return ive}static get DATETIME_HUGE_WITH_SECONDS(){return rve}}function QC(t){if(si.isDateTime(t))return t;if(t&&t.valueOf&&Vw(t.valueOf()))return si.fromJSDate(t);if(t&&typeof t=="object")return si.fromObject(t);throw new Fh(`Unknown datetime argument: ${t}, of type ${typeof t}`)}const Rm="system",VE="unknown",yx="UTC",Xze=Intl.DateTimeFormat().resolvedOptions().timeZone,Zze="shortOffset";function Jze(t){return"timeZoneIANA"in t}function Kze(t){return t.startsWith("UTC")}function Qze(t,e=!1){return{json:{read:{source:t,reader:(i,r)=>r[t]?pN(r[t]):null},write:!!e&&{allowNull:!0,writer(i,r){r[t]=i?e9e(i):null}}}}}function pN(t,e=Rm){return t?Jze(t)?t.timeZoneIANA:t9e(t,e):e}function e9e(t){return{timeZoneIANA:t}}function t9e(t,e=Rm){if(!t||!Ere.has(t.timeZone))return e;const i=Ere.get(t.timeZone);return Kze(t.timeZone)||t.respectsDaylightSaving?i:i9e(i)}function i9e(t){const e=si.local().setZone(t),i=Math.min(e.set({month:1,day:1}).offset,e.set({month:5}).offset);return i===0?"Etc/UTC":`Etc/GMT${pl.instance(-i).formatOffset(0,"narrow")}`}function QMt(t,e,i,r,n){if(e&&n==="date")return{timeZone:yx,timeZoneName:void 0};const s=r.timeStyle||r.hour,o=i===VE;return{timeZone:o?n==="timestamp-offset"?void 0:t??yx:i,timeZoneName:o&&s?Zze:void 0}}const r9e={year:void 0,month:void 0,day:void 0,weekday:void 0},n9e={hour:void 0,minute:void 0,second:void 0},Fve={timeZone:yx},Jp={year:"numeric",month:"numeric",day:"numeric"},eA={year:"numeric",month:"long",day:"numeric"},tA={year:"numeric",month:"short",day:"numeric"},iA={year:"numeric",month:"long",weekday:"long",day:"numeric"},A_={hour:"numeric",minute:"numeric"},hb={...A_,second:"numeric"},kve={hourCycle:"h23"},rA={...A_,...kve},nA={...hb,...kve},Uve={"short-date":Jp,"short-date-short-time":{...Jp,...A_},"short-date-short-time-24":{...Jp,...rA},"short-date-long-time":{...Jp,...hb},"short-date-long-time-24":{...Jp,...nA},"short-date-le":Jp,"short-date-le-short-time":{...Jp,...A_},"short-date-le-short-time-24":{...Jp,...rA},"short-date-le-long-time":{...Jp,...hb},"short-date-le-long-time-24":{...Jp,...nA},"long-month-day-year":eA,"long-month-day-year-short-time":{...eA,...A_},"long-month-day-year-short-time-24":{...eA,...rA},"long-month-day-year-long-time":{...eA,...hb},"long-month-day-year-long-time-24":{...eA,...nA},"day-short-month-year":tA,"day-short-month-year-short-time":{...tA,...A_},"day-short-month-year-short-time-24":{...tA,...rA},"day-short-month-year-long-time":{...tA,...hb},"day-short-month-year-long-time-24":{...tA,...nA},"long-date":iA,"long-date-short-time":{...iA,...A_},"long-date-short-time-24":{...iA,...rA},"long-date-long-time":{...iA,...hb},"long-date-long-time-24":{...iA,...nA},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":A_,"long-time":hb},s9e=yl()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),zve={ar:"ar-u-nu-latn-ca-gregory"};let jG=new WeakMap;const V6=Uve["short-date-short-time"];function o9e(t){let e=jG.get(t);if(!e){const i=Gu(),r=zve[i]||i,n=oJ(t.timeZone??Rm),s={...t,timeZone:n};e=new Intl.DateTimeFormat(r,s),jG.set(t,e)}return e}function a9e(t){return Uve[t]}function Rv(t,e=V6){return o9e(e).format(t)}function e$t(t,e=V6){return Rv(new Date(t),{...e,...Fve,...n9e})}function t$t(t,e=V6){return Rv(new Date(`1970-01-01T${t}Z`),{...e,...Fve,...r9e})}function i$t(t,e=V6){if(e.timeZone)return Rv(new Date(t),e);const i=si.fromISO(t,{setZone:!0}),r=Gu(),n=zve[r]??r,s=i.offset===0?yx:e.timeZone,o={...e,timeZone:s};return i.toLocaleString(o,{locale:n})}function oJ(t){switch(t){case Rm:return Xze;case VE:return yx;default:return t}}hZ(()=>{jG=new WeakMap});const l9e={ar:"ar-u-nu-latn"};let fN=new WeakMap,Bve={};function c9e(t){const e=t||Bve;if(!fN.has(e)){const i=Gu(),r=l9e[Gu()]||i;fN.set(e,new Intl.NumberFormat(r,t))}return fN.get(e)}function r$t(t={}){const e={};return t.digitSeparator!=null&&(e.useGrouping=t.digitSeparator),t.places!=null&&(e.minimumFractionDigits=e.maximumFractionDigits=t.places),e}function cP(t,e){return Object.is(t,-0)&&(t=0),c9e(e).format(t)}hZ(()=>{fN=new WeakMap,Bve={}});const Vve=K.getLogger("esri.intl.substitute");function u9e(t,e,i={}){const{format:r={}}=i;return s6(t,n=>h9e(n,e,r))}function h9e(t,e,i){let r,n;const s=t.indexOf(":");if(s===-1?r=t.trim():(r=t.slice(0,s).trim(),n=t.slice(s+1).trim()),!r)return"";const o=Jg(r,e);if(o==null)return"";const a=(n?i?.[n]:null)??i?.[r];return a?d9e(o,a):n?p9e(o,n):aJ(o)}function d9e(t,e){switch(e.type){case"date":return Rv(t,e.intlOptions);case"number":return cP(t,e.intlOptions);default:return Vve.warn("missing format descriptor for key {key}"),aJ(t)}}function p9e(t,e){switch(e.toLowerCase()){case"dateformat":return Rv(t);case"numberformat":return cP(t);default:return Vve.warn(`inline format is unsupported since 4.12: ${e}`),/^(dateformat|datestring)/i.test(e)?Rv(t):/^numberformat/i.test(e)?cP(t):aJ(t)}}function aJ(t){switch(typeof t){case"string":return t;case"number":return cP(t);case"boolean":return""+t;default:return t instanceof Date?Rv(t):""}}async function f9e(t,e,i,r){const n=e.exec(i);if(!n)throw new G("esri-intl:invalid-bundle",`Bundle id "${i}" is not compatible with the pattern "${e}"`);const s=n[1]?`${n[1]}/`:"",o=n[2],a=v5e(r),l=`${s}${o}.json`,c=a?`${s}${o}_${a}.json`:l;let h;try{h=await Kre(t(c))}catch(d){if(c===l)throw new G("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:d});try{h=await Kre(t(l))}catch(f){throw new G("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:f})}}return h}async function Kre(t){if(Qre.fetchBundleAsset!=null)return Qre.fetchBundleAsset(t);const e=await _i(t,{responseType:"text"});return JSON.parse(e.data)}let m9e=class{constructor({base:e="",pattern:i,location:r=new URL(window.location.href)}){let n;n=typeof r=="string"?s=>new URL(s,new URL(r,window.location.href)).href:r instanceof URL?s=>new URL(s,r).href:r,this.pattern=typeof i=="string"?new RegExp(`^${i}`):i,this.getAssetUrl=n,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)/)?(.*)$`)}fetchMessageBundle(e,i){return f9e(this.getAssetUrl,this.matcher,e,i)}};function g9e(t){return new m9e(t)}const Qre={};_5e(g9e({pattern:"esri/",location:ur}));const y9e="yyyy-MM-dd",_9e="TT";var QO;(function(t){t.HM="HH:mm",t.HMS="HH:mm:ss",t.HMS_MS="HH:mm:ss.SSS"})(QO||(QO={}));const v9e=[QO.HMS_MS,QO.HMS,QO.HM,_9e];function ene(t){return si.fromFormat(t,y9e)}function tne(t){let e=null;return v9e.find(i=>(e=si.fromFormat(t,i),e.isValid)),e}function ine(t){return si.fromISO(t)}var GE;(function(t){t.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",t.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(GE||(GE={}));const b9e=new Set(["integer","small-integer","big-integer","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"]);function w9e(t){return t!=null&&b9e.has(t.type)}function Gve(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function jve(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function Hve(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}function x9e(t,e){const i=t?.domain;if(!i)return null;switch(i.type){case"range":{const{min:r,max:n}=qve(t);if(r!=null&&+e<r||n!=null&&+e>n)return GE.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(i.codedValues==null||i.codedValues.every(r=>r==null||r.code!==e))return GE.INVALID_CODED_VALUE}return null}function qve(t,e){const i=e??t?.domain;if(!i||i.type!=="range")return;const r="range"in i?i.range[0]:i.minValue,n="range"in i?i.range[1]:i.maxValue,s=w9e(t);return Gve(t)||Hve(t)||jve(t)?{...T9e(t,n,r),isInteger:s}:{min:r!=null&&typeof r=="number"?r:null,max:n!=null&&typeof n=="number"?n:null,rawMin:r,rawMax:n,isInteger:s}}function T9e(t,e,i){return Gve(t)?{min:i!=null&&lT(i)?ene(i).toMillis():null,max:e!=null&&lT(e)?ene(e).toMillis():null,rawMin:i,rawMax:e}:Hve(t)?{min:i!=null&&lT(i)?tne(i).toMillis():null,max:e!=null&&lT(e)?tne(e).toMillis():null,rawMin:i,rawMax:e}:jve(t)?{min:i!=null&&lT(i)?ine(i).toMillis():null,max:e!=null&&lT(e)?ine(e).toMillis():null,rawMin:i,rawMax:e}:{max:null,min:null}}const S9e=K.getLogger("esri.support.arcadeOnDemand");let oz;function Pv(){return oz||(oz=(async()=>{const t=await ce(()=>import("./arcadeUtils-b1dd5b7d.js").then(e=>e.aD),["./arcadeUtils-b1dd5b7d.js","./TimeOnly-5ca21580.js","./number-c725bbdc.js","./hash-6f442295.js"],import.meta.url);return{arcade:t.arcade,arcadeUtils:t,Dictionary:t.Dictionary,Feature:t.arcadeFeature}})()),oz}const E9e=(t,e,i)=>lJ.create(t,e,i,null,["$feature","$view"],[]),C9e=(t,e,i)=>lJ.create(t,e,i,null,["$feature","$view"],[]),A9e=(t,e,i,r)=>lJ.create(t,e,i,r,["$feature","$view"],[]);let lJ=class Wve{constructor(e,i,r,n,s,o,a){this.services=null,this.script=e,this.evaluate=n;const l=Array.isArray(o)?o:o.fields;this.fields=l,this._syntaxTree=r,this._arcade=i,this._arcadeFeature=s,this._spatialReference=a,this._referencesGeometry=i.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,i,r,n,s,o){const{arcade:a,Feature:l,Dictionary:c}=await Pv(),h=ze.fromJSON(i);let d;try{d=a.parseScript(e,o)}catch(D){return S9e.error(new G("arcade-bad-expression","Failed to parse arcade script",{script:e,error:D})),null}const f=s.reduce((D,N)=>({...D,[N]:null}),{});let m=null;n!=null&&(m=new c(n),m.immutable=!0,f.$config=null);const y=a.scriptUsesGeometryEngine(d),_=y&&a.enableGeometrySupport(),v=a.scriptUsesFeatureSet(d)&&a.enableFeatureSetSupport(),w=a.scriptIsAsync(d),x=w&&a.enableAsyncSupport(),T={vars:f,spatialReference:h,useAsync:!!x};await Promise.all([_,v,x]);const S=new Set;await a.loadDependentModules(S,d,null,w,y);const C=new c;C.immutable=!1,C.setField("scale",0);const A=a.compileScript(d,T),R=(D,N)=>{const k=D.$view?.timeZone;return"$view"in D&&D.$view&&(C.setField("scale",typeof D.$view=="object"&&"scale"in D.$view?D.$view.scale:void 0),D.$view=C),m&&(D.$config=m),A({vars:D,spatialReference:h,services:N,timeZone:k})};return new Wve(e,a,d,R,new l,r,h)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}};const O9e=/^([0-9_])/,R9e=/[^a-z0-9_\u0080-\uffff]+/gi;function P9e(t){return t==null?null:t.trim().replaceAll(R9e,"_").replace(O9e,"F$1")||null}const M9e=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],$9e=["field","normalizationField"];function rne(t,e){if(t!=null&&e!=null){for(const i of Array.isArray(t)?t:[t])if(nne(M9e,i,e),"visualVariables"in i&&i.visualVariables)for(const r of i.visualVariables)nne($9e,r,e)}}function nne(t,e,i){if(t)for(const r of t){const n=Jg(r,e),s=n&&typeof n!="function"&&i.get(n);s&&Mp(r,s.name,e)}}function Yve(t,e){if(t!=null&&e?.fields?.length)if("startField"in t){const i=e.get(t.startField),r=e.get(t.endField);t.startField=i?.name??null,t.endField=r?.name??null}else{const i=e.get(t.startTimeField),r=e.get(t.endTimeField);t.startTimeField=i?.name??null,t.endTimeField=r?.name??null}}const az=new Set;function cJ(t,e){return t&&e?(az.clear(),uP(az,t,e),Array.from(az).sort()):[]}function uP(t,e,i){if(i)if(e?.fields?.length)if(i.includes("*"))for(const{name:r}of e.fields)t.add(r);else for(const r of i)Hu(t,e,r);else{if(i.includes("*"))return t.clear(),void t.add("*");for(const r of i)r!=null&&t.add(r)}}function Hu(t,e,i){if(typeof i=="string")if(e){const r=e.get(i);r&&t.add(r.name)}else t.add(i)}function s$t(t,e){return e==null||t==null?[]:e.includes("*")?(t.fields??[]).map(i=>i.name):e}async function Ql(t,e,i){if(!i)return;const{arcadeUtils:r}=await Pv(),n=r.extractFieldNames(i,e?.fields?.map(s=>s.name));for(const s of n)Hu(t,e,s)}async function Xve(t,e,i){if(i&&i!=="1=1"){const r=await QZ(i,e);if(!r.isStandardized)throw new G("fieldUtils:collectFilterFields","Where clause is not standardized",{where:i});uP(t,e,r.fieldNames)}}function I9e({displayField:t,fields:e}){return t||(e?.length?lz(e,"name-or-title")||lz(e,"unique-identifier")||lz(e,"type-or-category")||L9e(e):null)}function L9e(t){for(const e of t){if(!e?.name)continue;const i=e.name.toLowerCase();if(i.includes("name")||i.includes("title"))return e.name}return null}function lz(t,e){for(const i of t)if(i?.valueType&&i.valueType===e)return i.name;return null}async function o$t(t,e){if(!e)return;const i=e.elevationInfo?.featureExpressionInfo;return i?i.collectRequiredFields(t,e.fieldsIndex):void 0}function D9e(t,e,i){i.onStatisticExpression?Ql(t,e,i.onStatisticExpression.expression):t.add(i.onStatisticField)}async function a$t(t,e,i){if(!e||!i||!("fields"in i))return;const r=[],n=i.popupTemplate;r.push(N9e(t,e,n)),i.fields&&r.push(...i.fields.map(async s=>D9e(t,e.fieldsIndex,s))),await Promise.all(r)}async function N9e(t,e,i){const r=[];i?.expressionInfos&&r.push(...i.expressionInfos.map(s=>Ql(t,e.fieldsIndex,s.expression)));const n=i?.content;if(Array.isArray(n))for(const s of n)s.type==="expression"&&s.expressionInfo&&r.push(Ql(t,e.fieldsIndex,s.expressionInfo.expression));await Promise.all(r)}async function l$t(t,e,i){e&&(e.timeInfo&&i?.timeExtent&&uP(t,e.fieldsIndex,[e.timeInfo.startField,e.timeInfo.endField]),e.floorInfo&&uP(t,e.fieldsIndex,[e.floorInfo.floorField]),i?.where!=null&&await Xve(t,e.fieldsIndex,i.where))}async function c$t(t,e,i){e&&i&&await Promise.all(i.map(r=>F9e(t,e,r)))}async function F9e(t,e,i){e&&i&&(i.valueExpression?await Ql(t,e.fieldsIndex,i.valueExpression):i.field&&Hu(t,e.fieldsIndex,i.field))}function u$t(t){return t?cJ(t.fieldsIndex,Zve(t)):[]}function k9e(t){if(!t)return[];const e=t.geometryFieldsInfo;return e?cJ(t.fieldsIndex,[e.shapeAreaField,e.shapeLengthField]):[]}const U9e=new Set(["oid","global-id","guid"]),z9e=new Set(["oid","global-id"]),B9e=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i];function V9e(t){const e=new Set;Jve(t).forEach(r=>e.add(r)),k9e(t).forEach(r=>e.add(r.toLowerCase()));const i=t&&"infoFor3D"in t?t.infoFor3D:void 0;return i&&(Object.values(i.assetMapFieldRoles).forEach(r=>e.add(r.toLowerCase())),Object.values(i.transformFieldRoles).forEach(r=>e.add(r.toLowerCase()))),Array.from(e)}function Zve(t){if(!t)return[];const e="editFieldsInfo"in t&&t.editFieldsInfo;if(!e)return[];const{creationDateField:i,creatorField:r,editDateField:n,editorField:s}=e;return[i,r,n,s].filter(Boolean)}function Jve(t){return Zve(t).map(e=>e.toLowerCase())}function G9e(t,e){return t.editable&&!U9e.has(t.type)&&!Jve(e).includes(t.name?.toLowerCase()??"")}function j9e(t,e){const i=t.name?.toLowerCase()??"";return!(e?.objectIdField!=null&&i===e.objectIdField.toLowerCase()||e?.globalIdField!=null&&i===e.globalIdField.toLowerCase()||V9e(e).includes(i)||z9e.has(t.type)||B9e.some(r=>r.test(i)))}async function h$t(t,e){const{labelingInfo:i,fieldsIndex:r}=e;i?.length&&await Promise.all(i.map(n=>H9e(t,r,n)))}async function H9e(t,e,i){if(!i)return;const r=i.getLabelExpression(),n=i.where;if(r.type==="arcade")await Ql(t,e,r.expression);else{const s=r.expression.match(/{[^}]*}/g);s&&s.forEach(o=>{Hu(t,e,o.slice(1,-1))})}await Xve(t,e,n)}function q9e(t){const e=t.defaultValue;return e!==void 0&&e1e(t,e)?e:t.nullable?null:void 0}function d$t(t){const e=typeof t=="string"?{type:t}:t;return nBe(e)?255:e.type==="esriFieldTypeDate"||e.type==="date"?8:void 0}function Kve(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function W9e(t){return t===null||Kve(t)}function Y9e(t){return t===null||Number.isInteger(t)}function Qve(t){return t!=null&&typeof t=="string"}function X9e(t){return t===null||Qve(t)}function Z9e(){return!0}function e1e(t,e){let i;switch(t.type){case"date":case"integer":case"long":case"small-integer":case"big-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":case"esriFieldTypeBigInteger":i=t.nullable?Y9e:Number.isInteger;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=t.nullable?W9e:Kve;break;case"string":case"esriFieldTypeString":i=t.nullable?X9e:Qve;break;default:i=Z9e}return arguments.length===1?i:i(e)}const J9e=["integer","small-integer","big-integer"],K9e=["single","double"],Q9e=["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"],eBe=["esriFieldTypeSingle","esriFieldTypeDouble"],tBe=new Set([...J9e,...Q9e]),iBe=new Set([...K9e,...eBe]),rBe=eDe(tBe,iBe);function uJ(t){return t!=null&&rBe.has(t.type)}function nBe(t){return t!=null&&(t.type==="string"||t.type==="esriFieldTypeString")}function t1e(t){return t!=null&&(t.type==="date"||t.type==="esriFieldTypeDate")}function p$t(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function f$t(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function sBe(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}function sne(t){return t!=null&&(t.type==="oid"||t.type==="esriFieldTypeOID")}function one(t){return t!=null&&(t.type==="global-id"||t.type==="esriFieldTypeGlobalID")}function m$t(t,e){return oBe(t,e)===null}var K5,Q5;function g$t(t){return t==null||typeof t=="number"&&isNaN(t)?null:t}function oBe(t,e){return t==null||t.nullable&&e===null?null:uJ(t)&&!aBe(t.type,Number(e))?K5.OUT_OF_RANGE:e1e(t,e)?t.domain?x9e(t,e):null:Q5.INVALID_TYPE}function aBe(t,e){const i=typeof t=="string"?i1e(t):t;if(!i)return!1;const r=i.min,n=i.max;return i.isInteger?Number.isInteger(e)&&e>=r&&e<=n:e>=r&&e<=n}function i1e(t){switch(t){case"esriFieldTypeSmallInteger":case"small-integer":return lBe;case"esriFieldTypeInteger":case"integer":return cBe;case"esriFieldTypeBigInteger":case"big-integer":return uBe;case"esriFieldTypeSingle":case"single":return hBe;case"esriFieldTypeDouble":case"double":return dBe}}(function(t){t.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(K5||(K5={})),function(t){t.INVALID_TYPE="type-validation-error::invalid-type"}(Q5||(Q5={}));const lBe={min:-32768,max:32767,isInteger:!0,rawMin:-32768,rawMax:32767},cBe={min:-2147483648,max:2147483647,isInteger:!0,rawMin:-2147483648,rawMax:2147483647},uBe={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0,rawMin:-Number.MAX_SAFE_INTEGER,rawMax:Number.MAX_SAFE_INTEGER},hBe={min:-34e37,max:12e37,isInteger:!1,rawMin:-34e37,rawMax:12e37},dBe={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1,rawMin:-Number.MAX_VALUE,rawMax:Number.MAX_VALUE};function y$t(t,e,i){switch(t){case GE.INVALID_CODED_VALUE:return`Value ${i} is not in the coded domain - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case GE.VALUE_OUT_OF_RANGE:return`Value ${i} is out of the range of valid values - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case Q5.INVALID_TYPE:return`Value ${i} is not a valid value for the field type - field: ${e.name}, type: ${e.type}, nullable: ${e.nullable}`;case K5.OUT_OF_RANGE:{const{min:r,max:n}=i1e(e.type);return`Value ${i} is out of range for the number type - field: ${e.name}, type: ${e.type}, value range is ${r} to ${n}`}}}function _$t(t,e){return!pBe(t,e,null)}function pBe(t,e,i){if(!e?.attributes||!t){if(i!=null)for(const s of t??[])i.add(s);return!0}const r=new Set(Object.keys(e.attributes));let n=!1;for(const s of t)if(!r.has(s)){if(n=!0,i==null)break;i.add(s)}return n}function fBe(t){return!!t&&["raster.itempixelvalue","raster.servicepixelvalue"].some(e=>t.toLowerCase().startsWith(e))}let mN=class extends pe{constructor(e){super(e),this.type=null}};u([p({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],mN.prototype,"type",void 0),mN=u([M("esri.popup.content.Content")],mN);const Jv=mN;var HG;let db=HG=class extends Jv{constructor(t){super(t),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new HG({description:this.description,displayType:this.displayType,title:this.title})}};u([p({type:String,json:{write:!0}})],db.prototype,"description",void 0),u([p({type:["auto","preview","list"],json:{write:!0}})],db.prototype,"displayType",void 0),u([p({type:String,json:{write:!0}})],db.prototype,"title",void 0),u([p({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],db.prototype,"type",void 0),db=HG=u([M("esri.popup.content.AttachmentsContent")],db);const hP=db;var qG;let pb=qG=class extends Jv{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new qG({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?Q(this.outFields):null})}};u([p()],pb.prototype,"creator",void 0),u([p()],pb.prototype,"destroyer",void 0),u([p()],pb.prototype,"outFields",void 0),u([p({type:["custom"],readOnly:!0})],pb.prototype,"type",void 0),pb=qG=u([M("esri.popup.content.CustomContent")],pb);const mBe=pb;var WG;let MS=WG=class extends pe{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new WG({title:this.title,expression:this.expression})}};u([p({type:String,json:{write:!0}})],MS.prototype,"title",void 0),u([p({type:String,json:{write:!0}})],MS.prototype,"expression",void 0),u([p({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],MS.prototype,"returnType",void 0),MS=WG=u([M("esri.popup.ElementExpressionInfo")],MS);const gBe=MS;var YG;let b3=YG=class extends Jv{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){return new YG({expressionInfo:this.expressionInfo?.clone()})}};u([p({type:gBe,json:{write:!0}})],b3.prototype,"expressionInfo",void 0),u([p({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],b3.prototype,"type",void 0),b3=YG=u([M("esri.popup.content.ExpressionContent")],b3);const hJ=b3;let $S=class extends es(pe){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}};u([nt(s9e)],$S.prototype,"dateFormat",void 0),u([p({type:Boolean,json:{write:!0}})],$S.prototype,"digitSeparator",void 0),u([p({type:dr,json:{write:!0}})],$S.prototype,"places",void 0),$S=u([M("esri.popup.support.FieldInfoFormat")],$S);const gN=$S;var XG;let Nd=XG=class extends pe{constructor(t){super(t),this.fieldName=null,this.format=null,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new XG({fieldName:this.fieldName,format:this.format?Q(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};u([p({type:String,json:{write:!0}})],Nd.prototype,"fieldName",void 0),u([p({type:gN,json:{write:!0}})],Nd.prototype,"format",void 0),u([p({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],Nd.prototype,"isEditable",void 0),u([p({type:String,json:{write:!0}})],Nd.prototype,"label",void 0),u([nt(new Sr({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],Nd.prototype,"stringFieldOption",void 0),u([p({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],Nd.prototype,"statisticType",void 0),u([p({type:String,json:{write:!0}})],Nd.prototype,"tooltip",void 0),u([p({type:Boolean,json:{write:!0}})],Nd.prototype,"visible",void 0),Nd=XG=u([M("esri.popup.FieldInfo")],Nd);const dJ=Nd;var ZG;let Tg=ZG=class extends Jv{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,e){e.fieldInfos=t&&t.map(i=>i.toJSON())}clone(){return new ZG(Q({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};u([p({type:Object,json:{write:!0}})],Tg.prototype,"attributes",void 0),u([p({type:String,json:{write:!0}})],Tg.prototype,"description",void 0),u([p({type:[dJ]})],Tg.prototype,"fieldInfos",void 0),u([Be("fieldInfos")],Tg.prototype,"writeFieldInfos",null),u([p({type:String,json:{write:!0}})],Tg.prototype,"title",void 0),u([p({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],Tg.prototype,"type",void 0),Tg=ZG=u([M("esri.popup.content.FieldsContent")],Tg);const dP=Tg;let fb=class extends pe{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};u([p({type:String,json:{write:!0}})],fb.prototype,"altText",void 0),u([p({type:String,json:{write:!0}})],fb.prototype,"caption",void 0),u([p({type:String,json:{write:!0}})],fb.prototype,"title",void 0),u([p({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],fb.prototype,"type",void 0),fb=u([M("esri.popup.content.mixins.MediaInfo")],fb);const pJ=fb;var JG;let mb=JG=class extends we{constructor(t){super(t),this.color=null,this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new JG({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};u([p()],mb.prototype,"color",void 0),u([p()],mb.prototype,"fieldName",void 0),u([p()],mb.prototype,"tooltip",void 0),u([p()],mb.prototype,"value",void 0),mb=JG=u([M("esri.popup.content.support.ChartMediaInfoValueSeries")],mb);const yBe=mb;var KG;let Q0=KG=class extends pe{constructor(t){super(t),this.colors=null,this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new KG({colors:Q(this.colors),fields:Q(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};u([p({type:[Pe],json:{type:[[dr]],write:!0}})],Q0.prototype,"colors",void 0),u([p({type:[String],json:{write:!0}})],Q0.prototype,"fields",void 0),u([p({type:String,json:{write:!0}})],Q0.prototype,"normalizeField",void 0),u([p({type:[yBe],json:{read:!1}})],Q0.prototype,"series",void 0),u([p({type:String,json:{write:!0}})],Q0.prototype,"tooltipField",void 0),Q0=KG=u([M("esri.popup.content.support.ChartMediaInfoValue")],Q0);const _Be=Q0;let w3=class extends pJ{constructor(e){super(e),this.type=null,this.value=null}};u([p({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],w3.prototype,"type",void 0),u([p({type:_Be,json:{write:!0}})],w3.prototype,"value",void 0),w3=u([M("esri.popup.content.mixins.ChartMediaInfo")],w3);const G6=w3,j6=yl()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var QG;let yN=QG=class extends G6{constructor(t){super(t),this.type="bar-chart"}clone(){return new QG({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([p({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:j6.write}})],yN.prototype,"type",void 0),yN=QG=u([M("esri.popup.content.BarChartMediaInfo")],yN);const r1e=yN;var ej;let _N=ej=class extends G6{constructor(t){super(t),this.type="column-chart"}clone(){return new ej({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([p({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:j6.write}})],_N.prototype,"type",void 0),_N=ej=u([M("esri.popup.content.ColumnChartMediaInfo")],_N);const n1e=_N;var tj;let x3=tj=class extends pe{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new tj({linkURL:this.linkURL,sourceURL:this.sourceURL})}};u([p({type:String,json:{write:!0}})],x3.prototype,"linkURL",void 0),u([p({type:String,json:{write:!0}})],x3.prototype,"sourceURL",void 0),x3=tj=u([M("esri.popup.content.support.ImageMediaInfoValue")],x3);const vBe=x3;var ij;let IS=ij=class extends pJ{constructor(t){super(t),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new ij({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};u([p({type:Number,json:{write:!0}})],IS.prototype,"refreshInterval",void 0),u([p({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],IS.prototype,"type",void 0),u([p({type:vBe,json:{write:!0}})],IS.prototype,"value",void 0),IS=ij=u([M("esri.popup.content.ImageMediaInfo")],IS);const s1e=IS;var rj;let vN=rj=class extends G6{constructor(t){super(t),this.type="line-chart"}clone(){return new rj({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([p({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:j6.write}})],vN.prototype,"type",void 0),vN=rj=u([M("esri.popup.content.LineChartMediaInfo")],vN);const o1e=vN;var nj;let bN=nj=class extends G6{constructor(t){super(t),this.type="pie-chart"}clone(){return new nj({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([p({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:j6.write}})],bN.prototype,"type",void 0),bN=nj=u([M("esri.popup.content.PieChartMediaInfo")],bN);const a1e=bN,l1e={base:pJ,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":r1e,"column-chart":n1e,"line-chart":o1e,"pie-chart":a1e,image:s1e}};var sj;let Fd=sj=class extends Jv{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(e=>e.type==="image"?s1e.fromJSON(e):e.type==="barchart"?r1e.fromJSON(e):e.type==="columnchart"?n1e.fromJSON(e):e.type==="linechart"?o1e.fromJSON(e):e.type==="piechart"?a1e.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(t,e){e.mediaInfos=t&&t.map(i=>i.toJSON())}clone(){return new sj(Q({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};u([p()],Fd.prototype,"activeMediaInfoIndex",void 0),u([p({type:Object,json:{write:!0}})],Fd.prototype,"attributes",void 0),u([p({type:String,json:{write:!0}})],Fd.prototype,"description",void 0),u([p({types:[l1e]})],Fd.prototype,"mediaInfos",void 0),u([wt("mediaInfos")],Fd.prototype,"readMediaInfos",null),u([Be("mediaInfos")],Fd.prototype,"writeMediaInfos",null),u([p({type:String,json:{write:!0}})],Fd.prototype,"title",void 0),u([p({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],Fd.prototype,"type",void 0),Fd=sj=u([M("esri.popup.content.MediaContent")],Fd);const eF=Fd;var oj;let T3=oj=class extends pe{constructor(t){super(t),this.field=null,this.order=null}clone(){return new oj({field:this.field,order:this.order})}};u([p({type:String,json:{write:!0}})],T3.prototype,"field",void 0),u([p({type:["asc","desc"],json:{write:!0}})],T3.prototype,"order",void 0),T3=oj=u([M("esri.popup.support.RelatedRecordsInfoFieldOrder")],T3);const c1e=T3;let Sf=class extends es(Jv){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};u([p({type:String,json:{write:!0}})],Sf.prototype,"description",void 0),u([p({type:Number,json:{type:dr,write:!0}})],Sf.prototype,"displayCount",void 0),u([p({type:["list"],json:{write:!0}})],Sf.prototype,"displayType",void 0),u([p({type:[c1e],json:{write:!0}})],Sf.prototype,"orderByFields",void 0),u([p({type:Number,json:{type:dr,write:!0}})],Sf.prototype,"relationshipId",void 0),u([p({type:String,json:{write:!0}})],Sf.prototype,"title",void 0),u([p({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],Sf.prototype,"type",void 0),Sf=u([M("esri.popup.content.RelationshipContent")],Sf);const tF=Sf;var aj;let S3=aj=class extends Jv{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new aj({text:this.text})}};u([p({type:String,json:{write:!0}})],S3.prototype,"text",void 0),u([p({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],S3.prototype,"type",void 0),S3=aj=u([M("esri.popup.content.TextContent")],S3);const iF=S3,bBe={base:null,key:"type",typeMap:{attachment:hP,media:eF,text:iF,expression:hJ,field:dP,relationship:tF}};var lj;let gb=lj=class extends pe{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new lj({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([p({type:String,json:{write:!0}})],gb.prototype,"name",void 0),u([p({type:String,json:{write:!0}})],gb.prototype,"title",void 0),u([p({type:String,json:{write:!0}})],gb.prototype,"expression",void 0),u([p({type:["string","number"],json:{write:!0}})],gb.prototype,"returnType",void 0),gb=lj=u([M("esri.popup.ExpressionInfo")],gb);const wBe=gb;var cj;let E3=cj=class extends pe{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new cj({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};u([p({type:Boolean,json:{write:!0}})],E3.prototype,"returnTopmostRaster",void 0),u([p({type:Boolean,json:{write:!0}})],E3.prototype,"showNoDataRecords",void 0),E3=cj=u([M("esri.popup.LayerOptions")],E3);const xBe=E3;var uj;let C3=uj=class extends pe{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new uj({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?Q(this.orderByFields):null})}};u([p({type:Boolean,json:{write:!0}})],C3.prototype,"showRelatedRecords",void 0),u([p({type:[c1e],json:{write:!0}})],C3.prototype,"orderByFields",void 0),C3=uj=u([M("esri.popup.RelatedRecordsInfo")],C3);const TBe=C3;var hj;let vh=hj=class extends vM(we){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new hj({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};u([p()],vh.prototype,"active",void 0),u([p()],vh.prototype,"className",void 0),u([p()],vh.prototype,"disabled",void 0),u([p()],vh.prototype,"icon",void 0),u([p()],vh.prototype,"id",void 0),u([p()],vh.prototype,"indicator",void 0),u([p()],vh.prototype,"title",void 0),u([p()],vh.prototype,"type",void 0),u([p()],vh.prototype,"visible",void 0),vh=hj=u([M("esri.support.actions.ActionBase")],vh);const CM=vh;var dj;let wN=dj=class extends CM{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new dj({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};u([p()],wN.prototype,"image",void 0),wN=dj=u([M("esri.support.Action.ActionButton")],wN);const u1e=wN;var pj;let A3=pj=class extends CM{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new pj({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};u([p()],A3.prototype,"image",void 0),u([p()],A3.prototype,"value",void 0),A3=pj=u([M("esri.support.Action.ActionToggle")],A3);const h1e=A3,SBe="esri.PopupTemplate",EBe=K.getLogger(SBe),sA="relationships/",ane="expression/",CBe=Je.ofType({key:"type",defaultKeyValue:"button",base:CM,typeMap:{button:u1e,toggle:h1e}}),ABe={base:Jv,key:"type",typeMap:{media:eF,custom:mBe,text:iF,attachments:hP,fields:dP,expression:hJ,relationship:tF}},OBe=new Set(["attachments","fields","media","text","expression","relationship"]);let Po=class extends es(pe){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(i=>Tm(ABe,i)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||Zc(e)?e:(EBe.error("content error","unsupported content value",{value:e}),null)}readContent(e,i){const{popupElements:r}=i;return Array.isArray(r)&&r.length>0?this._readPopupInfoElements(i.description,i.mediaInfos,r):this._readPopupInfo(i)}writeContent(e,i,r,n){typeof e!="string"?Array.isArray(e)&&(i.popupElements=e.filter(s=>OBe.has(s.type)).map(s=>s?.toJSON(n)),i.popupElements.forEach(s=>{s.type==="attachments"?this._writeAttachmentContent(i):s.type==="media"?this._writeMediaContent(s,i):s.type==="text"?this._writeTextContent(s,i):s.type==="relationship"&&this._writeRelationshipContent(s,i)})):i.description=e}writeFieldInfos(e,i,r,n){const{content:s}=this,o=Array.isArray(s)?s:null;if(e){const a=o?o.filter(c=>c.type==="fields"):[],l=a.length&&a.every(c=>c.fieldInfos?.length);i.fieldInfos=e.filter(Boolean).map(c=>{const h=c.toJSON(n);return l&&(h.visible=!1),h})}if(o)for(const a of o)a.type==="fields"&&this._writeFieldsContent(a,i)}writeLayerOptions(e,i,r,n){i[r]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(n)}writeTitle(e,i){i.title=e||""}async collectRequiredFields(e,i){const r=this.expressionInfos||[];await this._collectExpressionInfoFields(e,i,[...r,...this._getContentExpressionInfos(this.content,r)]),uP(e,i,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const i=new Set;return await this.collectRequiredFields(i,e),[...i].sort()}_writeFieldsContent(e,i){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const r=Q(e.fieldInfos);Array.isArray(i.fieldInfos)?r.forEach(n=>{const s=i.fieldInfos.find(o=>o.fieldName.toLowerCase()===n.fieldName.toLowerCase());s?s.visible=!0:i.fieldInfos.push(n)}):i.fieldInfos=r}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,i){const r=e.orderByFields?.map(s=>this._toFieldOrderJSON(s,e.relationshipId))||[],n=[...i.relatedRecordsInfo?.orderByFields||[],...r];i.relatedRecordsInfo={showRelatedRecords:!0,...n?.length&&{orderByFields:n}}}_writeTextContent(e,i){!i.description&&e.text&&(i.description=e.text)}_writeMediaContent(e,i){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const r=Q(e.mediaInfos);Array.isArray(i.mediaInfos)?i.mediaInfos=[...i.mediaInfos,...r]:i.mediaInfos=r}_readPopupInfoElements(e,i,r){const n={description:!1,mediaInfos:!1};return r.map(s=>s.type==="media"?(s.mediaInfos||!i||n.mediaInfos||(s.mediaInfos=i,n.mediaInfos=!0),eF.fromJSON(s)):s.type==="text"?(s.text||!e||n.description||(s.text=e,n.description=!0),iF.fromJSON(s)):s.type==="attachments"?hP.fromJSON(s):s.type==="fields"?dP.fromJSON(s):s.type==="expression"?hJ.fromJSON(s):s.type==="relationship"?tF.fromJSON(s):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:i,order:r}=e;if(!i?.startsWith(sA))return null;const n=i.replace(sA,"").split("/");if(n.length!==2)return null;const s=parseInt(n[0],10),o=n[1];return typeof s=="number"&&o?tF.fromJSON({relationshipId:s,orderByFields:[{field:o,order:r}]}):null}_toFieldOrderJSON(e,i){const{order:r,field:n}=e;return{field:`${sA}${i}/${n}`,order:r}}_readPopupInfo({description:e,mediaInfos:i,showAttachments:r,relatedRecordsInfo:n={showRelatedRecords:!1}}){const s=[];e?s.push(new iF({text:e})):s.push(new dP),Array.isArray(i)&&i.length&&s.push(eF.fromJSON({mediaInfos:i})),r&&s.push(hP.fromJSON({displayType:"auto"}));const{showRelatedRecords:o,orderByFields:a}=n;return o&&a?.length&&a.forEach(l=>{const c=this._toRelationshipContent(l);c&&s.push(c)}),s.length?s:e}_getContentElementFields(e){const i=e?.type;if(i==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(i==="custom")return e.outFields||[];if(i==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(i==="media"){const r=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...r.reduce((n,s)=>[...n,...this._getMediaInfoFields(s)],[])]}return i==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:i,title:r,value:n}=e,s=n||{},{fields:o,normalizeField:a,tooltipField:l,sourceURL:c,linkURL:h}=s,d=[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(c),...this._extractFieldNames(h),...o??[]];return a&&d.push(a),l&&d.push(l),d}_getContentExpressionInfos(e,i){return Array.isArray(e)?e.reduce((r,n)=>[...r,...n.type==="expression"&&n.expressionInfo?[n.expressionInfo]:[]],i):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((i,r)=>[...i,...this._getContentElementFields(r)],[]):[]}async _collectExpressionInfoFields(e,i,r){r&&await Promise.all(r.map(n=>Ql(e,i,n.expression)))}_getFieldInfoFields(e){return e?e.filter(i=>i.visible===void 0||!!i.visible).map(i=>i.fieldName).filter(i=>!i.startsWith(sA)&&!i.startsWith(ane)):[]}_getActionsFields(e){return e?e.toArray().reduce((i,r)=>[...i,...this._getActionFields(r)],[]):[]}_getActionFields(e){const{className:i,title:r,type:n}=e,s=n==="button"||n==="toggle"?e.image:"";return[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(s)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const i=/{[^}]*}/g,r=e.match(i);if(!r)return[];const n=/\{(\w+):.+\}/,s=r.filter(o=>!(o.indexOf(`{${sA}`)===0||o.indexOf(`{${ane}`)===0)).map(o=>o.replace(n,"{$1}"));return s?s.map(o=>o.slice(1,-1)):[]}};u([p({type:CBe})],Po.prototype,"actions",void 0),u([p()],Po.prototype,"content",void 0),u([ai("content")],Po.prototype,"castContent",null),u([wt("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],Po.prototype,"readContent",null),u([Be("content",{popupElements:{type:Je.ofType(bBe)},showAttachments:{type:Boolean},mediaInfos:{type:Je.ofType(l1e)},description:{type:String},relatedRecordsInfo:{type:TBe}})],Po.prototype,"writeContent",null),u([p({type:[wBe],json:{write:!0}})],Po.prototype,"expressionInfos",void 0),u([p({type:[dJ]})],Po.prototype,"fieldInfos",void 0),u([Be("fieldInfos")],Po.prototype,"writeFieldInfos",null),u([p({type:xBe})],Po.prototype,"layerOptions",void 0),u([Be("layerOptions")],Po.prototype,"writeLayerOptions",null),u([p({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],Po.prototype,"lastEditInfoEnabled",void 0),u([p()],Po.prototype,"outFields",void 0),u([p()],Po.prototype,"overwriteActions",void 0),u([p()],Po.prototype,"returnGeometry",void 0),u([p({json:{type:String}})],Po.prototype,"title",void 0),u([Be("title")],Po.prototype,"writeTitle",null),Po=u([M("esri.PopupTemplate")],Po);const AM=Po,lne=new Sr({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let RBe=0,LS=class extends pe{constructor(e){super(e),this.id="sym"+RBe++,this.type=null,this.color=new Pe([0,0,0,1])}readColor(e){return e?.[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,i){}hash(){return JSON.stringify(this.toJSON())}clone(){}};u([p({type:lne.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:lne.write}}})],LS.prototype,"type",void 0),u([p({type:Pe,json:{write:{allowNull:!0}}})],LS.prototype,"color",void 0),u([wt("color")],LS.prototype,"readColor",null),LS=u([M("esri.symbols.Symbol")],LS);const Jc=LS;var fj;let e_=fj=class extends Jc{constructor(t){super(t),this.data=null,this.type="cim"}readData(t,e){return e}writeData(t,e){Object.assign(e,t)}async collectRequiredFields(t,e){if(this.data?.type==="CIMSymbolReference"){const i=this.data.primitiveOverrides;if(i){const r=i.map(n=>{const s=n.valueExpressionInfo;return Ql(t,e,s.expression)});await Promise.all(r)}}}clone(){return new fj({data:Q(this.data)})}hash(){return IX(JSON.stringify(this.data)).toString()}};u([p({json:{write:!1}})],e_.prototype,"color",void 0),u([p({json:{write:!0}})],e_.prototype,"data",void 0),u([wt("data",["symbol"])],e_.prototype,"readData",null),u([Be("data",{})],e_.prototype,"writeData",null),u([nt({CIMSymbolReference:"cim"},{readOnly:!0})],e_.prototype,"type",void 0),e_=fj=u([M("esri.symbols.CIMSymbol")],e_);const OC=e_;let DS=class extends pe{constructor(e){super(e),this.enabled=!0,this.type=null,this.ignoreDrivers=!1}writeEnabled(e,i,r){e||(i[r]=e)}};u([p({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],DS.prototype,"enabled",void 0),u([Be("enabled")],DS.prototype,"writeEnabled",null),u([p({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],DS.prototype,"type",void 0),DS=u([M("esri.symbols.Symbol3DLayer")],DS);const Vm=DS;let yb=class extends pe{constructor(e){super(e),this.color=new Pe([0,0,0,1]),this.extensionLength=0,this.size=Ku(1)}clone(){}cloneProperties(){return{color:Q(this.color),size:this.size,extensionLength:this.extensionLength}}};u([p({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],yb.prototype,"type",void 0),u([p(ky)],yb.prototype,"color",void 0),u([p({...Om,json:{write:{overridePolicy:t=>({enabled:!!t})}}})],yb.prototype,"extensionLength",void 0),u([p(Om)],yb.prototype,"size",void 0),yb=u([M("esri.symbols.edges.Edges3D")],yb);const fJ=yb;var mj;let xN=mj=class extends fJ{constructor(t){super(t),this.type="sketch"}clone(){return new mj(this.cloneProperties())}};u([nt({sketch:"sketch"},{readOnly:!0})],xN.prototype,"type",void 0),xN=mj=u([M("esri.symbols.edges.SketchEdges3D")],xN);const PBe=xN;var gj;let TN=gj=class extends fJ{constructor(t){super(t),this.type="solid"}clone(){return new gj(this.cloneProperties())}};u([nt({solid:"solid"},{readOnly:!0})],TN.prototype,"type",void 0),TN=gj=u([M("esri.symbols.support.SolidEdges3D")],TN);const MBe=TN,d1e={types:{key:"type",base:fJ,typeMap:{solid:MBe,sketch:PBe}},json:{write:!0}};var yj;let qu=yj=class extends pe{constructor(t){super(t),this.color=null}clone(){const t={color:this.color!=null?this.color.clone():null};return new yj(t)}};u([p(ky)],qu.prototype,"color",void 0),qu=yj=u([M("esri.symbols.support.Symbol3DMaterial")],qu);var _j;let t_=_j=class extends Vm{constructor(t){super(t),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new _j({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};u([nt({Extrude:"extrude"},{readOnly:!0})],t_.prototype,"type",void 0),u([p({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],t_.prototype,"size",void 0),u([p({type:qu,json:{write:!0}})],t_.prototype,"material",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],t_.prototype,"castShadows",void 0),u([p(d1e)],t_.prototype,"edges",void 0),t_=_j=u([M("esri.symbols.ExtrudeSymbol3DLayer")],t_);const p1e=t_;let O3=class extends Jc{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};u([nt({esriSLS:"simple-line"},{readOnly:!0})],O3.prototype,"type",void 0),u([p({type:Number,cast:sr,json:{write:!0}})],O3.prototype,"width",void 0),O3=u([M("esri.symbols.LineSymbol")],O3);const $Be=O3,IBe=["begin","end","begin-end"],f1e=["arrow","circle","square","diamond","cross","x"];var vj;let Ef=vj=class extends pe{constructor(t){super(t),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(t,e,i,r){e[i]=r?.origin==="web-map"?"arrow":t}set color(t){this._set("color",t)}readColor(t){return t?.[0]!=null?[t[0],t[1],t[2],t[3]/255]:t}writeColor(t,e,i,r){r?.origin==="web-map"||(e[i]=t)}clone(){return new vj({color:Q(this.color),placement:this.placement,style:this.style})}hash(){return`${this.placement}.${this.color?.hash()}.${this.style}`}};u([p({type:["begin","end","begin-end"],json:{write:!0}})],Ef.prototype,"placement",void 0),u([nt({"line-marker":"line-marker"},{readOnly:!0}),p({json:{origins:{"web-map":{write:!1}}}})],Ef.prototype,"type",void 0),u([p({type:f1e})],Ef.prototype,"style",void 0),u([Be("style")],Ef.prototype,"writeStyle",null),u([p({type:Pe,value:null,json:{write:{allowNull:!0}}})],Ef.prototype,"color",null),u([wt("color")],Ef.prototype,"readColor",null),u([Be("color")],Ef.prototype,"writeColor",null),Ef=vj=u([M("esri.symbols.LineSymbolMarker")],Ef);const LBe=Ef;var bj;const cz=new Sr({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let Sg=bj=class extends $Be{constructor(...t){super(...t),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(t,e,i,r,n,s){if(t&&typeof t!="string")return t;const o={};return t!=null&&(o.style=t),e!=null&&(o.color=e),i!=null&&(o.width=sr(i)),r!=null&&(o.cap=r),n!=null&&(o.join=n),s!=null&&(o.miterLimit=sr(s)),o}clone(){return new bj({color:Q(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:this.marker?.clone()})}hash(){return`${super.hash()}.${this.color?.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${this.marker?.hash()}`}};u([nt({esriSLS:"simple-line"},{readOnly:!0})],Sg.prototype,"type",void 0),u([p({type:cz.apiValues,json:{read:cz.read,write:cz.write}})],Sg.prototype,"style",void 0),u([p({type:["butt","round","square"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&i?.origin==null})}}})],Sg.prototype,"cap",void 0),u([p({type:["miter","round","bevel"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&i?.origin==null})}}})],Sg.prototype,"join",void 0),u([p({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":LBe}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],Sg.prototype,"marker",void 0),u([p({type:Number,json:{read:!1,write:!1}})],Sg.prototype,"miterLimit",void 0),Sg=bj=u([M("esri.symbols.SimpleLineSymbol")],Sg);const ud=Sg;let R3=class extends Jc{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};u([p({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":ud}},json:{default:null,write:!0}})],R3.prototype,"outline",void 0),u([p({type:["simple-fill","picture-fill"],readOnly:!0})],R3.prototype,"type",void 0),R3=u([M("esri.symbols.FillSymbol")],R3);const m1e=R3;let SN=class extends pe{constructor(e){super(e)}clone(){}};u([p({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],SN.prototype,"type",void 0),SN=u([M("esri.symbols.patterns.LinePattern3D")],SN);const g1e=SN,DBe=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var wj;const NBe=yl()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let P3=wj=class extends g1e{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new wj(t)}};u([p({type:["style"]})],P3.prototype,"type",void 0),u([nt(NBe),p({type:DBe})],P3.prototype,"style",void 0),P3=wj=u([M("esri.symbols.patterns.LineStylePattern3D")],P3);const mJ=P3;let EN=class extends pe{constructor(e){super(e)}clone(){}};u([p({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],EN.prototype,"type",void 0),EN=u([M("esri.symbols.patterns.Pattern3D")],EN);const y1e=EN,FBe=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var xj;let M3=xj=class extends y1e{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new xj(t)}};u([p({type:["style"]})],M3.prototype,"type",void 0),u([p({type:FBe,json:{read:!0,write:!0}})],M3.prototype,"style",void 0),M3=xj=u([M("esri.symbols.patterns.StylePattern3D")],M3);const _1e=M3,kBe={types:{key:"type",base:y1e,typeMap:{style:_1e}},json:{write:!0}},v1e={types:{key:"type",base:g1e,typeMap:{style:mJ}},json:{write:!0}},eR=new Pe("white");new Pe("black");const UBe=new Pe([255,255,255,0]);function zBe(t){return t.r===0&&t.g===0&&t.b===0}var Tj;let tR=Tj=class extends qu{constructor(t){super(t),this.colorMixMode=null}clone(){const t={color:this.color!=null?this.color.clone():null,colorMixMode:this.colorMixMode};return new Tj(t)}};u([nt({multiply:"multiply",replace:"replace",tint:"tint"})],tR.prototype,"colorMixMode",void 0),tR=Tj=u([M("esri.symbols.support.Symbol3DFillMaterial")],tR);function ks(t=S1e){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function _x(t,e,i,r,n,s,o=ks()){return o[0]=t,o[1]=e,o[2]=i,o[3]=r,o[4]=n,o[5]=s,o}function $$t(t,e){const i=isFinite(t[2])||isFinite(t[5]);return new zi(i?{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],zmin:t[2],zmax:t[5],spatialReference:e}:{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],spatialReference:e})}function jE(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t[4]=Math.max(t[4],e[4]),t[5]=Math.max(t[5],e[5])}function BBe(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[3]=Math.max(t[3],e[2]),t[4]=Math.max(t[4],e[3])}function Dp(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[0]),t[4]=Math.max(t[4],e[1]),t[5]=Math.max(t[5],e[2])}function ku(t,e,i=0,r=e.length/3){let n=t[0],s=t[1],o=t[2],a=t[3],l=t[4],c=t[5];for(let h=0;h<r;h++)n=Math.min(n,e[i+3*h]),s=Math.min(s,e[i+3*h+1]),o=Math.min(o,e[i+3*h+2]),a=Math.max(a,e[i+3*h]),l=Math.max(l,e[i+3*h+1]),c=Math.max(c,e[i+3*h+2]);t[0]=n,t[1]=s,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function uz(t,e,i){const r=e.length;let n=t[0],s=t[1],o=t[2],a=t[3],l=t[4],c=t[5];if(i)for(let h=0;h<r;h++){const d=e[h];n=Math.min(n,d[0]),s=Math.min(s,d[1]),o=Math.min(o,d[2]),a=Math.max(a,d[0]),l=Math.max(l,d[1]),c=Math.max(c,d[2])}else for(let h=0;h<r;h++){const d=e[h];n=Math.min(n,d[0]),s=Math.min(s,d[1]),a=Math.max(a,d[0]),l=Math.max(l,d[1])}t[0]=n,t[1]=s,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function VBe(t){for(let e=0;e<6;e++)if(!isFinite(t[e]))return!1;return!0}function Vx(t){return t[0]>=t[3]?0:t[3]-t[0]}function Gx(t){return t[1]>=t[4]?0:t[4]-t[1]}function Kv(t){return t[2]>=t[5]?0:t[5]-t[2]}function b1e(t){const e=Vx(t),i=Kv(t),r=Gx(t);return Math.sqrt(e*e+i*i+r*r)}function _p(t,e=[0,0,0]){return e[0]=t[0]+Vx(t)/2,e[1]=t[1]+Gx(t)/2,e[2]=t[2]+Kv(t)/2,e}function W$(t,e=[0,0,0]){return e[0]=Vx(t),e[1]=Gx(t),e[2]=Kv(t),e}function gJ(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]}function I$t(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[3]<=t[3]&&e[4]<=t[4]&&e[5]<=t[5]}function GBe(t,e){return Math.max(e[0],t[0])<=Math.min(e[3],t[3])&&Math.max(e[1],t[1])<=Math.min(e[4],t[4])&&Math.max(e[2],t[2])<=Math.min(e[5],t[5])}function vp(t,e){return e==null||GBe(t,e)}function w1e(t,e,i,r,n=t){return n[0]=t[0]+e,n[1]=t[1]+i,n[2]=t[2]+r,n[3]=t[3]+e,n[4]=t[4]+i,n[5]=t[5]+r,n}function L$t(t,e,i=t){const r=t[0]+Vx(t)/2,n=t[1]+Gx(t)/2,s=t[2]+Kv(t)/2;return i[0]=r+(t[0]-r)*e,i[1]=n+(t[1]-n)*e,i[2]=s+(t[2]-s)*e,i[3]=r+(t[3]-r)*e,i[4]=n+(t[4]-n)*e,i[5]=s+(t[5]-s)*e,i}function x1e(t,e,i=t){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i!==t&&(i[3]=t[3],i[4]=t[4],i[5]=t[5]),i}function T1e(t,e,i=t){return i[3]=e[0],i[4]=e[1],i[5]=e[2],i!==t&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),t}function H6(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Pr(t){return t?H6(t,cne):ks(cne)}function yJ(t,e){return e||(e=Zt()),e[0]=t[0],e[1]=t[1],e[2]=t[3],e[3]=t[4],e}function D$t(t,e){return t[0]=e[0],t[1]=e[1],t[2]=Number.NEGATIVE_INFINITY,t[3]=e[2],t[4]=e[3],t[5]=Number.POSITIVE_INFINITY,t}function jBe(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=Number.NEGATIVE_INFINITY,t[3]=r,t[4]=n,t[5]=Number.POSITIVE_INFINITY,t}function Sj(t){return t.length===6}function _J(t){return Vx(t)===0&&Gx(t)===0&&Kv(t)===0}function N$t(t,e,i){if(t==null||e==null)return t===e;if(!Sj(t)||!Sj(e))return!1;if(i){for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1}else for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function HBe(t,e,i,r,n,s){return _x(t,e,i,r,n,s,qBe)}const F$t=[-1/0,-1/0,-1/0,1/0,1/0,1/0],cne=[1/0,1/0,1/0,-1/0,-1/0,-1/0],S1e=[0,0,0,0,0,0],qBe=ks();function hz(t,{isPrimitive:e,width:i,depth:r,height:n}){const s=e?10:1;if(i==null&&n==null&&r==null)return[s*t[0],s*t[1],s*t[2]];const o=Oe(i,r,n);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/t[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=t[l]*a);return o}const WBe=_x(-.5,-.5,-.5,.5,.5,.5),YBe=_x(-.5,-.5,0,.5,.5,1),XBe=_x(-.5,-.5,0,.5,.5,.5);function ZBe(t){switch(t){case"sphere":case"cube":case"diamond":return WBe;case"cylinder":case"cone":case"inverted-cone":return YBe;case"tetrahedron":return XBe;default:return}}const vJ=["butt","square","round"],JBe=[...vJ,"none"],E1e=["miter","bevel","round"];var Ej;let _b=Ej=class extends pe{constructor(t){super(t),this.color=new Pe([0,0,0,1]),this.size=Ku(1),this.pattern=null,this.patternCap="butt"}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size,pattern:this.pattern!=null?this.pattern.clone():null,patternCap:this.patternCap};return new Ej(t)}};u([p(ky)],_b.prototype,"color",void 0),u([p(Om)],_b.prototype,"size",void 0),u([p(v1e)],_b.prototype,"pattern",void 0),u([p({type:vJ,json:{default:"butt",write:{overridePolicy(){return{enabled:this.pattern!=null}}}}})],_b.prototype,"patternCap",void 0),_b=Ej=u([M("esri.symbols.support.Symbol3DOutline")],_b);var CN;let Eg=CN=class extends Vm{constructor(t){super(t),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const t={edges:this.edges!=null?this.edges.clone():null,enabled:this.enabled,material:this.material!=null?this.material.clone():null,pattern:this.pattern!=null?this.pattern.clone():null,castShadows:this.castShadows,outline:this.outline!=null?this.outline.clone():null};return new CN(t)}static fromSimpleFillSymbol(t){const e=t.outline&&t.outline.style&&t.outline.style!=="inside-frame"&&t.outline.style!=="solid"?new mJ({style:t.outline.style}):null,i={size:t.outline?.width??0,color:(t.outline?.color??eR).clone(),pattern:e};return e&&t.outline?.cap&&(i.patternCap=t.outline.cap),new CN({material:new tR({color:(t.color??UBe).clone()}),pattern:t.style&&t.style!=="solid"?new _1e({style:t.style}):null,outline:i})}};u([nt({Fill:"fill"},{readOnly:!0})],Eg.prototype,"type",void 0),u([p({type:tR,json:{write:!0}})],Eg.prototype,"material",void 0),u([p(kBe)],Eg.prototype,"pattern",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Eg.prototype,"castShadows",void 0),u([p({type:_b,json:{write:!0}})],Eg.prototype,"outline",void 0),u([p(d1e)],Eg.prototype,"edges",void 0),Eg=CN=u([M("esri.symbols.FillSymbol3DLayer")],Eg);const OM=Eg,KBe=["none","underline","line-through"],QBe=["normal","italic","oblique"],eVe=["normal","lighter","bold","bolder"],C1e={type:Number,cast:t=>{const e=Nh(t);return e===0?1:_e(e,.1,4)},nonNullable:!0},tVe=["left","right","center"],iVe=["baseline","top","middle","bottom"],A1e={type:tVe,nonNullable:!0},O1e={type:iVe,nonNullable:!0},k$t=8;var Cj;let Cg=Cj=class extends pe{constructor(t){super(t),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(t){return sr(t)}clone(){return new Cj({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};u([p({type:KBe,json:{default:"none",write:!0}})],Cg.prototype,"decoration",void 0),u([p({type:String,json:{write:!0}})],Cg.prototype,"family",void 0),u([p({type:Number,json:{write:{overridePolicy:(t,e,i)=>({enabled:!i||!i.textSymbol3D})}}})],Cg.prototype,"size",void 0),u([ai("size")],Cg.prototype,"castSize",null),u([p({type:QBe,json:{default:"normal",write:!0}})],Cg.prototype,"style",void 0),u([p({type:eVe,json:{default:"normal",write:!0}})],Cg.prototype,"weight",void 0),Cg=Cj=u([M("esri.symbols.Font")],Cg);const q6=Cg;var Aj;const rVe=yl()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let vb=Aj=class extends pe{constructor(t){super(t)}readHref(t,e,i){return t?Cv(t,i):e.dataURI}writeHref(t,e,i,r){t&&(Fm(t)?e.dataURI=t:(e.href=mx(t,r),Vu(e.href)&&(e.href=Bu(e.href))))}clone(){return new Aj({href:this.href,primitive:this.primitive})}};u([p({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],vb.prototype,"href",void 0),u([wt("href")],vb.prototype,"readHref",null),u([Be("href",{href:{type:String},dataURI:{type:String}})],vb.prototype,"writeHref",null),u([nt(rVe)],vb.prototype,"primitive",void 0),vb=Aj=u([M("esri.symbols.support.IconSymbol3DLayerResource")],vb);const nVe="circle";var Oj;let E2=Oj=class extends we{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new Oj({x:this.x,y:this.y})}};u([p({type:Number})],E2.prototype,"x",void 0),u([p({type:Number})],E2.prototype,"y",void 0),E2=Oj=u([M("esri.symbols.support.Symbol3DAnchorPosition2D")],E2);var Rj;let $3=Rj=class extends pe{constructor(t){super(t),this.color=new Pe([0,0,0,1]),this.size=Ku(1)}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size};return new Rj(t)}};u([p(ky)],$3.prototype,"color",void 0),u([p(Om)],$3.prototype,"size",void 0),$3=Rj=u([M("esri.symbols.support.Symbol3DIconOutline")],$3);var NS;const R1e="esri.symbols.IconSymbol3DLayer";let Cf=NS=class extends Vm{constructor(t){super(t),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new NS({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,outline:this.outline!=null?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(t){const e=t.color||eR,i=une(t),r=t.outline&&t.outline.width>0?{size:t.outline.width,color:(t.outline.color||eR).clone()}:null;return new NS({size:t.size,resource:{primitive:oVe(t.style)},material:{color:e},outline:r,anchor:i?"relative":void 0,anchorPosition:i})}static fromPictureMarkerSymbol(t){const e=!t.color||zBe(t.color)?eR:t.color,i=une(t);return new NS({size:t.width<=t.height?t.height:t.width,resource:{href:t.url},material:{color:e.clone()},anchor:i?"relative":void 0,anchorPosition:i})}static fromCIMSymbol(t){return new NS({resource:{href:zge({mediaType:"application/json",data:JSON.stringify(t.data)})}})}};function une(t){const e="width"in t?t.width:t.size,i="height"in t?t.height:t.size,r=hne(t.xoffset),n=hne(t.yoffset);return(r||n)&&e&&i?{x:-r/e,y:n/i}:null}function hne(t){return isFinite(t)?t:0}u([p({type:qu,json:{write:!0}})],Cf.prototype,"material",void 0),u([p({type:vb,json:{write:!0}})],Cf.prototype,"resource",void 0),u([nt({Icon:"icon"},{readOnly:!0})],Cf.prototype,"type",void 0),u([p(Om)],Cf.prototype,"size",void 0),u([nt({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),p({json:{default:"center"}})],Cf.prototype,"anchor",void 0),u([p({type:E2,json:{type:[Number],read:{reader:t=>new E2({x:t[0],y:t[1]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Cf.prototype,"anchorPosition",void 0),u([p({type:$3,json:{write:!0}})],Cf.prototype,"outline",void 0),Cf=NS=u([M(R1e)],Cf);const sVe={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function oVe(t){return sVe[t]||(K.getLogger(R1e).warn(`${t} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const sm=Cf;let bb=class extends es(pe){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return e!=null&&e.placement===this.placement&&e.style===this.style&&(this.color==null&&e.color==null||this.color!=null&&e.color!=null&&this.color.toJSON()===e.color.toJSON())}};u([p({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],bb.prototype,"type",void 0),u([p({type:IBe,json:{default:"begin-end",write:!0}})],bb.prototype,"placement",void 0),u([p({type:f1e,json:{default:"arrow",write:!0}})],bb.prototype,"style",void 0),u([p({type:Pe,json:{type:[dr],default:null,write:!0}})],bb.prototype,"color",void 0),bb=u([M("esri.symbols.LineStyleMarker3D")],bb);const Pj=bb;var AN;let Af=AN=class extends Vm{constructor(t){super(t),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=Ku(1),this.pattern=null,this.marker=null}clone(){const t={enabled:this.enabled,material:this.material!=null?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:this.pattern!=null?this.pattern.clone():null,marker:this.marker!=null?this.marker.clone():null};return new AN(t)}static fromSimpleLineSymbol(t){const e={enabled:!0,size:t.width??Ku(1),cap:t.cap||"butt",join:t.join||"miter",pattern:t.style&&t.style!=="inside-frame"?new mJ({style:t.style}):null,material:new qu({color:(t.color||eR).clone()}),marker:t.marker?new Pj({placement:t.marker.placement,style:t.marker.style,color:t.marker.color?.clone()??null}):null};return new AN(e)}};u([p({type:qu,json:{write:!0}})],Af.prototype,"material",void 0),u([nt({Line:"line"},{readOnly:!0})],Af.prototype,"type",void 0),u([p({type:E1e,json:{write:!0,default:"miter"}})],Af.prototype,"join",void 0),u([p({type:vJ,json:{write:!0,default:"butt"}})],Af.prototype,"cap",void 0),u([p(Om)],Af.prototype,"size",void 0),u([p(v1e)],Af.prototype,"pattern",void 0),u([p({types:{key:"type",base:Pj,typeMap:{style:Pj}},json:{write:!0}})],Af.prototype,"marker",void 0),Af=AN=u([M("esri.symbols.LineSymbol3DLayer")],Af);const RM=Af;var Mj;const aVe=yl()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let I3=Mj=class extends pe{clone(){return new Mj({href:this.href,primitive:this.primitive})}};u([p({type:String,json:{read:WZ,write:Av}})],I3.prototype,"href",void 0),u([nt(aVe)],I3.prototype,"primitive",void 0),I3=Mj=u([M("esri.symbols.support.ObjectSymbol3DLayerResource")],I3);const P1e="sphere";var $j;let lw=$j=class extends we{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new $j({x:this.x,y:this.y,z:this.z})}};u([p({type:Number})],lw.prototype,"x",void 0),u([p({type:Number})],lw.prototype,"y",void 0),u([p({type:Number})],lw.prototype,"z",void 0),lw=$j=u([M("esri.symbols.support.Symbol3DAnchorPosition3D")],lw);var Ij;let Ja=Ij=class extends Vm{constructor(t){super(t),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new Ij({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition?.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:this.material?.clone()??null,castShadows:this.castShadows,resource:this.resource?.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};u([p({type:qu,json:{write:!0}})],Ja.prototype,"material",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Ja.prototype,"castShadows",void 0),u([p({type:I3,json:{write:!0}})],Ja.prototype,"resource",void 0),u([nt({Object:"object"},{readOnly:!0})],Ja.prototype,"type",void 0),u([p({type:Number,json:{write:!0}})],Ja.prototype,"width",void 0),u([p({type:Number,json:{write:!0}})],Ja.prototype,"height",void 0),u([p({type:Number,json:{write:!0}})],Ja.prototype,"depth",void 0),u([nt({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),p({json:{default:"origin"}})],Ja.prototype,"anchor",void 0),u([p({type:lw,json:{type:[Number],read:{reader:t=>new lw({x:t[0],y:t[1],z:t[2]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y,t.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Ja.prototype,"anchorPosition",void 0),u([p({type:Number,json:{write:!0}})],Ja.prototype,"heading",void 0),u([p({type:Number,json:{write:!0}})],Ja.prototype,"tilt",void 0),u([p({type:Number,json:{write:!0}})],Ja.prototype,"roll",void 0),u([p({readOnly:!0})],Ja.prototype,"isPrimitive",null),Ja=Ij=u([M("esri.symbols.ObjectSymbol3DLayer")],Ja);const bJ=Ja;var Lj;let Pl=Lj=class extends Vm{constructor(t){super(t),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(t,e){return t??(e.height==null&&e.size!=null?e.size:void 0)}readHeight(t,e){return t??(e.width==null&&e.size!=null?e.size:void 0)}clone(){return new Lj({enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};u([p({type:qu,json:{write:!0}})],Pl.prototype,"material",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Pl.prototype,"castShadows",void 0),u([nt({Path:"path"},{readOnly:!0})],Pl.prototype,"type",void 0),u([p({type:["circle","quad"],json:{write:!0,default:"circle"}})],Pl.prototype,"profile",void 0),u([p({type:E1e,json:{write:!0,default:"miter"}})],Pl.prototype,"join",void 0),u([p({type:JBe,json:{write:!0,default:"butt"}})],Pl.prototype,"cap",void 0),u([p({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],Pl.prototype,"width",void 0),u([wt("width",["width","size","height"])],Pl.prototype,"readWidth",null),u([p({type:Number,json:{write:!0}})],Pl.prototype,"height",void 0),u([wt("height",["height","size","width"])],Pl.prototype,"readHeight",null),u([p({type:["center","bottom","top"],json:{write:!0,default:"center"}})],Pl.prototype,"anchor",void 0),u([p({type:["heading","all"],json:{write:!0,default:"all"}})],Pl.prototype,"profileRotation",void 0),Pl=Lj=u([M("esri.symbols.PathSymbol3DLayer")],Pl);const wJ=Pl;var Dj;let C2=Dj=class extends pe{constructor(){super(...arguments),this.color=new Pe([0,0,0,1]),this.size=0}clone(){const t={color:Q(this.color),size:this.size};return new Dj(t)}};u([p(ky)],C2.prototype,"color",void 0),u([p(Om)],C2.prototype,"size",void 0),C2=Dj=u([M("esri.symbols.support.Symbol3DHalo")],C2);let iR=class extends es(pe){constructor(e){super(e),this.color=null}};u([p(ky)],iR.prototype,"color",void 0),iR=u([M("esri.symbols.support.Symbol3DTextBackground")],iR);var ON;let gc=ON=class extends Vm{constructor(t){super(t),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(t){t!=null&&this._userSize!=null&&(t.size=this._userSize),this._set("font",t)}writeFont(t,e,i,r){const n={...r,textSymbol3D:!0};e.font=t.write({},n),delete e.font.size}get size(){return this._userSize!=null?this._userSize:this.font?.size!=null?this.font.size:9}set size(t){this._userSize=t,this.font!=null&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const t=new ON({enabled:this.enabled,font:this.font&&Q(this.font),halo:this.halo&&Q(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:this.material!=null?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:Q(this.background)});return t._userSize=this._userSize,t}static fromTextSymbol(t){return new ON({font:t.font!=null?t.font.clone():new q6,halo:lVe(t.haloColor,t.haloSize),horizontalAlignment:t.horizontalAlignment,lineHeight:t.lineHeight,material:t.color?new qu({color:t.color.clone()}):null,text:t.text,verticalAlignment:t.verticalAlignment,background:t.backgroundColor?new iR({color:t.backgroundColor.clone()}):null})}};function lVe(t,e){return t&&e!=null&&e>0?new C2({color:Q(t),size:e}):null}u([p({type:q6,json:{write:!0}})],gc.prototype,"font",null),u([Be("font")],gc.prototype,"writeFont",null),u([p({type:C2,json:{write:!0}})],gc.prototype,"halo",void 0),u([p({...A1e,json:{default:"center",write:!0}})],gc.prototype,"horizontalAlignment",void 0),u([p({...C1e,json:{default:1,write:!0}})],gc.prototype,"lineHeight",void 0),u([p({type:qu,json:{write:!0}})],gc.prototype,"material",void 0),u([p({type:iR,json:{write:!0}})],gc.prototype,"background",void 0),u([p(Om)],gc.prototype,"size",null),u([p({type:String,json:{write:!0}})],gc.prototype,"text",void 0),u([nt({Text:"text"},{readOnly:!0})],gc.prototype,"type",void 0),u([p({...O1e,json:{default:"baseline",write:!0}})],gc.prototype,"verticalAlignment",void 0),gc=ON=u([M("esri.symbols.TextSymbol3DLayer")],gc);const Uy=gc;var Nj;let i_=Nj=class extends Vm{constructor(t){super(t),this.color=Fj.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new Nj({color:Q(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};u([p({type:Pe,nonNullable:!0,json:{type:[dr],write:(t,e,i)=>e[i]=t.toArray(Pe.AlphaMode.UNLESS_OPAQUE),default:()=>Fj.clone(),defaultEquals:t=>t.toCss(!0)===Fj.toCss(!0)}})],i_.prototype,"color",void 0),u([nt({Water:"water"},{readOnly:!0})],i_.prototype,"type",void 0),u([p({type:["small","medium","large"],json:{write:!0,default:"medium"}})],i_.prototype,"waterbodySize",void 0),u([p({type:Number,json:{write:!0,default:null}})],i_.prototype,"waveDirection",void 0),u([p({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],i_.prototype,"waveStrength",void 0),i_=Nj=u([M("esri.symbols.WaterSymbol3DLayer")],i_);const Fj=new Pe([0,119,190]),M1e=i_;var kj;let wb=kj=class extends we{constructor(t){super(t),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new kj({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};u([p({type:String})],wb.prototype,"name",void 0),u([p({type:String})],wb.prototype,"styleUrl",void 0),u([p({type:String})],wb.prototype,"styleName",void 0),u([p({type:Ds})],wb.prototype,"portal",void 0),wb=kj=u([M("esri.symbols.support.StyleOrigin")],wb);const pP=wb;var Uj;let Gw=Uj=class extends we{constructor(){super(...arguments),this.url=""}clone(){return new Uj({url:this.url})}};u([p({type:String})],Gw.prototype,"url",void 0),Gw=Uj=u([M("esri.symbols.support.Thumbnail")],Gw);const $1e={icon:sm,object:bJ,line:RM,path:wJ,fill:OM,extrude:p1e,text:Uy,water:M1e},cVe=Je.ofType({base:Vm,key:"type",typeMap:$1e,errorContext:"symbol-layer"});let Of=class extends Jc{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const i=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,r=i?.type,n=r||Je;this._set("symbolLayers",new n)}get color(){return null}set color(e){this.constructed&&K.getLogger(this).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){wy(e,this._get("symbolLayers"))}readStyleOrigin(e,i,r){if(e.styleUrl&&e.name){const n=Cv(e.styleUrl,r);return new pP({styleUrl:n,name:e.name})}if(e.styleName&&e.name)return new pP({portal:r?.portal||Ds.getDefault(),styleName:e.styleName,name:e.name});r?.messages&&r.messages.push(new Sm("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:r,definition:e}))}writeStyleOrigin(e,i,r,n){if(e.styleUrl&&e.name){let s=mx(e.styleUrl,n);Vu(s)&&(s=Bu(s)),i.styleOrigin={styleUrl:s,name:e.name}}else e.styleName&&e.name&&(e.portal&&n?.portal&&!kge(e.portal.restUrl,n.portal.restUrl)?n?.messages&&n.messages.push(new Sm("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):i.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof Vm||e&&$1e[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};u([p({json:{read:!1,write:!1}})],Of.prototype,"color",null),u([p({type:cVe,nonNullable:!0,json:{write:!0}}),ai(KX)],Of.prototype,"symbolLayers",null),u([p({type:pP})],Of.prototype,"styleOrigin",void 0),u([wt("styleOrigin")],Of.prototype,"readStyleOrigin",null),u([Be("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],Of.prototype,"writeStyleOrigin",null),u([p({type:Gw,json:{read:!1}})],Of.prototype,"thumbnail",void 0),u([p({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],Of.prototype,"type",void 0),Of=u([M("esri.symbols.Symbol3D")],Of);const RC=Of;let L3=class extends pe{constructor(e){super(e),this.visible=!0}clone(){}};u([p({type:["line"],constructOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],L3.prototype,"type",void 0),u([p({readOnly:!0})],L3.prototype,"visible",void 0),L3=u([M("esri.symbols.callouts.Callout3D")],L3);const I1e=L3;var zj;let RN=zj=class extends pe{constructor(t){super(t),this.color=new Pe("white")}clone(){return new zj({color:Q(this.color)})}};u([p(ky)],RN.prototype,"color",void 0),RN=zj=u([M("esri.symbols.callouts.LineCallout3DBorder")],RN);const uVe=RN;var Bj;let r_=Bj=class extends I1e{constructor(t){super(t),this.type="line",this.color=new Pe([0,0,0,1]),this.size=Ku(1),this.border=null}get visible(){return this.size>0&&this.color!=null&&this.color.a>0}clone(){return new Bj({color:Q(this.color),size:this.size,border:Q(this.border)})}};u([nt({line:"line"})],r_.prototype,"type",void 0),u([p(ky)],r_.prototype,"color",void 0),u([p(Om)],r_.prototype,"size",void 0),u([p({type:uVe,json:{write:!0}})],r_.prototype,"border",void 0),u([p({readOnly:!0})],r_.prototype,"visible",null),r_=Bj=u([M("esri.symbols.callouts.LineCallout3D")],r_);const PM=r_;function xJ(t){if(!t)return!1;const e=t.verticalOffset;return!!e&&!(e.screenLength<=0||e.maxWorldLength!=null&&e.maxWorldLength<=0)}function L1e(t){if(!t||!t.supportsCallout||!t.supportsCallout())return!1;const e=t.callout;return!!e&&!!e.visible&&!!xJ(t)}function TJ(t){return t.type==="point-3d"||t.type==="label-3d"}function D1e(t){return t.horizontalAlignment==="center"}const N1e={types:{key:"type",base:I1e,typeMap:{line:PM}},json:{write:!0}};var Vj;let FS=Vj=class extends pe{constructor(t){super(t),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new Vj({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};u([p(Om)],FS.prototype,"screenLength",void 0),u([p({type:Number,nonNullable:!0,json:{write:!0,default:0}})],FS.prototype,"minWorldLength",void 0),u([p({type:Number,json:{write:!0}})],FS.prototype,"maxWorldLength",void 0),FS=Vj=u([M("esri.symbols.support.Symbol3DVerticalOffset")],FS);const SJ=FS;var PN;const F1e=Je.ofType({base:null,key:"type",typeMap:{text:Uy}});let n_=PN=class extends RC{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new F1e,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return L1e(this)}hasVisibleVerticalOffset(){return xJ(this)}clone(){return new PN({styleOrigin:Q(this.styleOrigin),symbolLayers:Q(this.symbolLayers),thumbnail:Q(this.thumbnail),callout:Q(this.callout),verticalOffset:Q(this.verticalOffset)})}static fromTextSymbol(t){return new PN({symbolLayers:new Je([Uy.fromTextSymbol(t)])})}};u([p({type:SJ,json:{write:!0}})],n_.prototype,"verticalOffset",void 0),u([p(N1e)],n_.prototype,"callout",void 0),u([p({json:{read:!1,write:!1}})],n_.prototype,"styleOrigin",void 0),u([p({type:F1e})],n_.prototype,"symbolLayers",void 0),u([nt({LabelSymbol3D:"label-3d"},{readOnly:!0})],n_.prototype,"type",void 0),n_=PN=u([M("esri.symbols.LabelSymbol3D")],n_);const PC=n_;var MN;const k1e=Je.ofType({base:null,key:"type",typeMap:{line:RM,path:wJ}}),hVe=Je.ofType({base:null,key:"type",typeMap:{line:RM,path:wJ}});let D3=MN=class extends RC{constructor(t){super(t),this.symbolLayers=new k1e,this.type="line-3d"}clone(){return new MN({styleOrigin:Q(this.styleOrigin),symbolLayers:Q(this.symbolLayers),thumbnail:Q(this.thumbnail)})}static fromSimpleLineSymbol(t){return new MN({symbolLayers:new Je([RM.fromSimpleLineSymbol(t)])})}};u([p({type:k1e,json:{type:hVe}})],D3.prototype,"symbolLayers",void 0),u([nt({LineSymbol3D:"line-3d"},{readOnly:!0})],D3.prototype,"type",void 0),D3=MN=u([M("esri.symbols.LineSymbol3D")],D3);const W6=D3;let s_=class extends Jc{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};u([p({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],s_.prototype,"angle",void 0),u([p({type:["simple-marker","picture-marker"],readOnly:!0})],s_.prototype,"type",void 0),u([p({type:Number,cast:sr,json:{write:!0}})],s_.prototype,"xoffset",void 0),u([p({type:Number,cast:sr,json:{write:!0}})],s_.prototype,"yoffset",void 0),u([p({type:Number,cast:t=>t==="auto"?t:sr(t),json:{write:!0}})],s_.prototype,"size",void 0),s_=u([M("esri.symbols.MarkerSymbol")],s_);const U1e=s_;var $N;const z1e=Je.ofType({base:null,key:"type",typeMap:{fill:OM}});let N3=$N=class extends RC{constructor(t){super(t),this.symbolLayers=new z1e,this.type="mesh-3d"}clone(){return new $N({styleOrigin:Q(this.styleOrigin),symbolLayers:Q(this.symbolLayers),thumbnail:Q(this.thumbnail)})}static fromSimpleFillSymbol(t){return new $N({symbolLayers:new Je([OM.fromSimpleFillSymbol(t)])})}};u([p({type:z1e})],N3.prototype,"symbolLayers",void 0),u([nt({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],N3.prototype,"type",void 0),N3=$N=u([M("esri.symbols.MeshSymbol3D")],N3);const Y6=N3;function dVe(t,e,i){return e.imageData?zge({mediaType:e.contentType||"image/png",isBase64:!0,data:e.imageData}):B1e(e.url,i)}function B1e(t,e){return fVe(e)&&!Vu(t)&&e?.layer?.parsedUrl?Nm(e.layer.parsedUrl.path,"images",t):Cv(t,e)}function pVe(t,e,i,r){if(Fm(t)){const n=_v(t);if(!n)return;e.contentType=n.mediaType,e.imageData=n.data,i&&i.imageData===e.imageData&&i.url&&Av(i.url,e,"url",r)}else Av(t,e,"url",r)}const V1e={json:{read:{source:["imageData","url"],reader:dVe},write:{writer(t,e,i,r){pVe(t,e,this.source,r)}}}},G1e={readOnly:!0,json:{read:{source:["imageData","url"],reader(t,e,i){const r={};return e.imageData&&(r.imageData=e.imageData),e.contentType&&(r.contentType=e.contentType),e.url&&(r.url=B1e(e.url,i)),r}}}};function fVe(t){return!(t==null||t.origin!=="service"&&t.origin!=="portal-item"||t.layer?.type!=="feature"&&t.layer?.type!=="stream")}var Gj;let bh=Gj=class extends m1e{constructor(...t){super(...t),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string"&&t.imageData==null)return t;const n={};return t&&(n.url=t),e&&(n.outline=e),i!=null&&(n.width=sr(i)),r!=null&&(n.height=sr(r)),n}clone(){const t=new Gj({color:Q(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return t._set("source",Q(this.source)),t}hash(){return`${super.hash()}.${this.color?.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};u([nt({esriPFS:"picture-fill"},{readOnly:!0})],bh.prototype,"type",void 0),u([p(V1e)],bh.prototype,"url",void 0),u([p({type:Number,json:{write:!0}})],bh.prototype,"xscale",void 0),u([p({type:Number,json:{write:!0}})],bh.prototype,"yscale",void 0),u([p({type:Number,cast:sr,json:{write:!0}})],bh.prototype,"width",void 0),u([p({type:Number,cast:sr,json:{write:!0}})],bh.prototype,"height",void 0),u([p({type:Number,cast:sr,json:{write:!0}})],bh.prototype,"xoffset",void 0),u([p({type:Number,cast:sr,json:{write:!0}})],bh.prototype,"yoffset",void 0),u([p(G1e)],bh.prototype,"source",void 0),bh=Gj=u([M("esri.symbols.PictureFillSymbol")],bh);const j1e=bh;var jj;let kd=jj=class extends U1e{constructor(...t){super(...t),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string"&&t.imageData==null)return t;const r={};return t&&(r.url=t),e!=null&&(r.width=sr(e)),i!=null&&(r.height=sr(i)),r}readHeight(t,e){return e.size||t}readWidth(t,e){return e.size||t}clone(){const t=new jj({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return t._set("source",Q(this.source)),t}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};u([p({json:{write:!1}})],kd.prototype,"color",void 0),u([nt({esriPMS:"picture-marker"},{readOnly:!0})],kd.prototype,"type",void 0),u([p(V1e)],kd.prototype,"url",void 0),u([p(G1e)],kd.prototype,"source",void 0),u([p({type:Number,cast:sr,json:{write:!0}})],kd.prototype,"height",void 0),u([wt("height",["height","size"])],kd.prototype,"readHeight",null),u([p({type:Number,cast:sr,json:{write:!0}})],kd.prototype,"width",void 0),u([p({json:{write:!1}})],kd.prototype,"size",void 0),kd=jj=u([M("esri.symbols.PictureMarkerSymbol")],kd);const X6=kd;var xb;const H1e=Je.ofType({base:null,key:"type",typeMap:{icon:sm,object:bJ,text:Uy}});let Tb=xb=class extends RC{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.symbolLayers=new H1e,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const t of this.symbolLayers.items)switch(t.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return L1e(this)}hasVisibleVerticalOffset(){return xJ(this)}clone(){return new xb({verticalOffset:Q(this.verticalOffset),callout:Q(this.callout),styleOrigin:Q(this.styleOrigin),symbolLayers:Q(this.symbolLayers),thumbnail:Q(this.thumbnail)})}static fromSimpleMarkerSymbol(t){return new xb({symbolLayers:new Je([sm.fromSimpleMarkerSymbol(t)])})}static fromPictureMarkerSymbol(t){return new xb({symbolLayers:new Je([sm.fromPictureMarkerSymbol(t)])})}static fromCIMSymbol(t){if(t.data?.symbol?.type!=="CIMPointSymbol")return null;const i=t.data.symbol;return new xb(i?.callout?{symbolLayers:new Je([sm.fromCIMSymbol(t)]),callout:new PM({size:.5,color:new Pe([0,0,0])}),verticalOffset:new SJ({screenLength:40})}:{symbolLayers:new Je([sm.fromCIMSymbol(t)])})}static fromTextSymbol(t){return new xb({symbolLayers:new Je([Uy.fromTextSymbol(t)])})}};u([p({type:SJ,json:{write:!0}})],Tb.prototype,"verticalOffset",void 0),u([p(N1e)],Tb.prototype,"callout",void 0),u([p({type:H1e,json:{origins:{"web-scene":{write:!0}}}})],Tb.prototype,"symbolLayers",void 0),u([nt({PointSymbol3D:"point-3d"},{readOnly:!0})],Tb.prototype,"type",void 0),Tb=xb=u([M("esri.symbols.PointSymbol3D")],Tb);const ry=Tb;var F3;const q1e=Je.ofType({base:null,key:"type",typeMap:{extrude:p1e,fill:OM,icon:sm,line:RM,object:bJ,text:Uy,water:M1e}});let k3=F3=class extends RC{constructor(t){super(t),this.symbolLayers=new q1e,this.type="polygon-3d"}initialize(){const t=e=>{e.type==="line"&&xE(K.getLogger(this),"LineSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use FillSymbol3DLayer.outline instead.",version:"4.28"}),e.type==="text"&&xE(K.getLogger(this),"TextSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use Labels instead.",version:"4.28"})};for(const e of this.symbolLayers)t(e);this.addHandles(bo(()=>this.symbolLayers,"after-add",({item:e})=>t(e),Zi))}clone(){return new F3({styleOrigin:Q(this.styleOrigin),symbolLayers:Q(this.symbolLayers),thumbnail:Q(this.thumbnail)})}static fromJSON(t){const e=new F3;if(e.read(t),e.symbolLayers.length===2&&e.symbolLayers.at(0).type==="fill"&&e.symbolLayers.at(1).type==="line"){const i=e.symbolLayers.at(0),r=e.symbolLayers.at(1);!r.enabled||t.symbolLayers?.[1]&&t.symbolLayers[1].enable===!1||(i.outline={size:r.size,color:r.material!=null?r.material.color:null}),e.symbolLayers.removeAt(1)}return e}static fromSimpleFillSymbol(t){return new F3({symbolLayers:new Je([OM.fromSimpleFillSymbol(t)])})}};u([p({type:q1e,json:{write:!0}})],k3.prototype,"symbolLayers",void 0),u([nt({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],k3.prototype,"type",void 0),k3=F3=u([M("esri.symbols.PolygonSymbol3D")],k3);const MM=k3;var Hj;const dz=new Sr({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let Sb=Hj=class extends m1e{constructor(...t){super(...t),this.color=new Pe([0,0,0,.25]),this.outline=new ud,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.style=t),e&&(r.outline=e),i&&(r.color=i),r}clone(){return new Hj({color:Q(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};u([p()],Sb.prototype,"color",void 0),u([p()],Sb.prototype,"outline",void 0),u([nt({esriSFS:"simple-fill"},{readOnly:!0})],Sb.prototype,"type",void 0),u([p({type:dz.apiValues,json:{read:dz.read,write:dz.write}})],Sb.prototype,"style",void 0),Sb=Hj=u([M("esri.symbols.SimpleFillSymbol")],Sb);const jx=Sb;var qj;const pz=new Sr({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let Rf=qj=class extends U1e{constructor(...t){super(...t),this.color=new Pe([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new ud}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string")return t;const n={};return t&&(n.style=t),e!=null&&(n.size=sr(e)),i&&(n.outline=i),r&&(n.color=r),n}writeColor(t,e){t&&this.style!=="x"&&this.style!=="cross"&&(e.color=t.toJSON()),t===null&&(e.color=null)}set path(t){this.style="path",this._set("path",t)}clone(){return new qj({angle:this.angle,color:Q(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${this.outline?.hash()}`}};u([p()],Rf.prototype,"color",void 0),u([Be("color")],Rf.prototype,"writeColor",null),u([nt({esriSMS:"simple-marker"},{readOnly:!0})],Rf.prototype,"type",void 0),u([p()],Rf.prototype,"size",void 0),u([p({type:pz.apiValues,json:{read:pz.read,write:pz.write}})],Rf.prototype,"style",void 0),u([p({type:String,json:{write:!0}})],Rf.prototype,"path",null),u([p({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":ud}},json:{default:null,write:!0}})],Rf.prototype,"outline",void 0),Rf=qj=u([M("esri.symbols.SimpleMarkerSymbol")],Rf);const Qv=Rf;var Wj;let zn=Wj=class extends Jc{constructor(...t){super(...t),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new q6,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.text=t),e&&(r.font=e),i&&(r.color=i),r}writeLineWidth(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}castLineWidth(t){return sr(t)}writeLineHeight(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}clone(){return new Wj({angle:this.angle,backgroundColor:Q(this.backgroundColor),borderLineColor:Q(this.borderLineColor),borderLineSize:this.borderLineSize,color:Q(this.color),font:this.font&&this.font.clone(),haloColor:Q(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor?.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color?.hash()}.${this.font&&this.font.hash()}.${this.haloColor?.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};u([p({type:Pe,json:{write:!0}})],zn.prototype,"backgroundColor",void 0),u([p({type:Pe,json:{write:!0}})],zn.prototype,"borderLineColor",void 0),u([p({type:Number,json:{write:!0},cast:sr})],zn.prototype,"borderLineSize",void 0),u([p({type:q6,json:{write:!0}})],zn.prototype,"font",void 0),u([p({...A1e,json:{write:!0}})],zn.prototype,"horizontalAlignment",void 0),u([p({type:Boolean,json:{write:!0}})],zn.prototype,"kerning",void 0),u([p({type:Pe,json:{write:!0}})],zn.prototype,"haloColor",void 0),u([p({type:Number,cast:sr,json:{write:!0}})],zn.prototype,"haloSize",void 0),u([p({type:Boolean,json:{write:!0}})],zn.prototype,"rightToLeft",void 0),u([p({type:Boolean,json:{write:!0}})],zn.prototype,"rotated",void 0),u([p({type:String,json:{write:!0}})],zn.prototype,"text",void 0),u([nt({esriTS:"text"},{readOnly:!0})],zn.prototype,"type",void 0),u([p({...O1e,json:{write:!0}})],zn.prototype,"verticalAlignment",void 0),u([p({type:Number,cast:sr,json:{write:!0}})],zn.prototype,"xoffset",void 0),u([p({type:Number,cast:sr,json:{write:!0}})],zn.prototype,"yoffset",void 0),u([p({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],zn.prototype,"angle",void 0),u([p({type:Number,json:{write:!0}})],zn.prototype,"width",void 0),u([p({type:Number})],zn.prototype,"lineWidth",void 0),u([Be("lineWidth")],zn.prototype,"writeLineWidth",null),u([ai("lineWidth")],zn.prototype,"castLineWidth",null),u([p(C1e)],zn.prototype,"lineHeight",void 0),u([Be("lineHeight")],zn.prototype,"writeLineHeight",null),zn=Wj=u([M("esri.symbols.TextSymbol")],zn);const MC=zn;var Yj;let Ud=Yj=class extends Jc{constructor(t){super(t),this.color=null,this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const t=this.portal!=null?this.portal:Ds.getDefault(),e=t.user?t.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${e}:${t.url}`}read(t,e){this.portal=e?.portal,super.read(t,e)}clone(){return new Yj({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(t){return this._fetchSymbol("webRef",t)}fetchCIMSymbol(t){return this._fetchSymbol("cimRef",t)}async _fetchSymbol(t,e){const i=e!=null?e.cache:null,r=i?this._fetchCacheKey:null;if(i!=null){const a=r&&i.get(r);if(a)return a.clone()}const{resolveWebStyleSymbol:n}=await ce(()=>Promise.resolve().then(()=>Gdt),void 0,import.meta.url);Tt(e);const s=n(this,{portal:this.portal},t,e);s.catch(a=>{K.getLogger(this).error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await s;return t==="webRef"&&o.type==="point-3d"||t==="cimRef"&&o.type==="cim"?(i?.set(r,o.clone()),o):null}};u([p({json:{write:!1}})],Ud.prototype,"color",void 0),u([p({type:String,json:{write:!0}})],Ud.prototype,"styleName",void 0),u([p({type:Ds,json:{write:!1}})],Ud.prototype,"portal",void 0),u([p({type:String,json:{read:WZ,write:Av}})],Ud.prototype,"styleUrl",void 0),u([p({type:Gw,json:{read:!1}})],Ud.prototype,"thumbnail",void 0),u([p({type:String,json:{write:!0}})],Ud.prototype,"name",void 0),u([nt({styleSymbolReference:"web-style"},{readOnly:!0})],Ud.prototype,"type",void 0),u([p()],Ud.prototype,"_fetchCacheKey",null),Ud=Yj=u([M("esri.symbols.WebStyleSymbol")],Ud);const Hx=Ud;function Z6(t){if(!t)return!1;switch(t.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function Mv(t){if(!t)return!1;switch(t.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const X2={base:Jc,key:"type",typeMap:{"simple-fill":jx,"picture-fill":j1e,"picture-marker":X6,"simple-line":ud,"simple-marker":Qv,text:MC,"label-3d":PC,"line-3d":W6,"mesh-3d":Y6,"point-3d":ry,"polygon-3d":MM,"web-style":Hx,cim:OC},errorContext:"symbol"},mVe={base:Jc,key:"type",typeMap:{"picture-marker":X6,"simple-marker":Qv,text:MC,"web-style":Hx,cim:OC},errorContext:"symbol"},gVe=bC({types:X2}),W1e={base:Jc,key:"type",typeMap:{"simple-fill":jx,"picture-fill":j1e,"picture-marker":X6,"simple-line":ud,"simple-marker":Qv,text:MC,"line-3d":W6,"mesh-3d":Y6,"point-3d":ry,"polygon-3d":MM,"web-style":Hx,cim:OC},errorContext:"symbol"},yVe={base:Jc,key:"type",typeMap:{text:MC,"label-3d":PC},errorContext:"symbol"},dne={base:Jc,key:"type",typeMap:{"line-3d":W6,"mesh-3d":Y6,"point-3d":ry,"polygon-3d":MM,"web-style":Hx,cim:OC},errorContext:"symbol"},_Ve={base:Jc,key:"type",typeMap:{"label-3d":PC},errorContext:"symbol"},Y1e=Tm(X2);var Xj;function vVe(t){if(!t)return null;const e={};for(const i in t){const r=bv(t[i]);r&&(e[i]=r)}return Object.keys(e).length!==0?e:null}function bVe(t){if(t==null)return null;const e={};for(const i in t){const r=t[i];r&&(e[i]=r.toJSON())}return Object.keys(e).length!==0?e:null}let yc=Xj=class extends es(pe){constructor(...t){super(...t),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:zu(),configurable:!0})}normalizeCtorArgs(t,e,i,r){return t&&!t.declaredClass?t:{geometry:t,symbol:e,attributes:i,popupTemplate:r}}set aggregateGeometries(t){const e=this._get("aggregateGeometries");JSON.stringify(e)!==JSON.stringify(t)&&this._set("aggregateGeometries",t)}set attributes(t){const e=this._get("attributes");e!==t&&(this._set("attributes",t),this._notifyLayer("attributes",e,t))}set geometry(t){const e=this._get("geometry");e!==t&&(this._set("geometry",t),this._notifyLayer("geometry",e,t))}set symbol(t){const e=this._get("symbol");e!==t&&(this._set("symbol",t),this._notifyLayer("symbol",e,t))}set visible(t){const e=this._get("visible");e!==t&&(this._set("visible",t),this._notifyLayer("visible",e,t))}cloneShallow(){return new Xj({aggregateGeometries:this.aggregateGeometries,attributes:this.attributes,geometry:this.geometry,isAggregate:this.isAggregate,layer:this.layer,popupTemplate:this.popupTemplate,sourceLayer:this.sourceLayer,symbol:this.symbol,visible:this.visible})}getEffectivePopupTemplate(t=!1){if(this.popupTemplate)return this.popupTemplate;for(const e of[this.sourceLayer,this.layer])if(e){if("popupTemplate"in e&&e.popupTemplate)return e.popupTemplate;if(t&&"defaultPopupTemplate"in e&&e.defaultPopupTemplate!=null)return e.defaultPopupTemplate}return null}getAttribute(t){return this.attributes?.[t]}setAttribute(t,e){if(this.attributes){const i=this.getAttribute(t);this.attributes[t]=e,this._notifyLayer("attributes",i,e,t)}else this.attributes={[t]:e},this._notifyLayer("attributes",void 0,e,t)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:bVe(this.aggregateGeometries),geometry:this.geometry!=null?this.geometry.toJSON():null,symbol:this.symbol!=null?this.symbol.toJSON():null,attributes:v5(this.attributes)?this.attributes.toJSON():{...this.attributes},popupTemplate:this.popupTemplate?.toJSON()??null}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(t={}){const{geometry:e}=this;if(e?.type==="mesh"){const i={origin:e.origin,transform:e.transform};this._notifyLayer("origin-transform",i,i,t.action)}}_notifyLayer(t,e,i,r){if(!this.layer||!("graphicChanged"in this.layer))return;const n={graphic:this,property:t,oldValue:e,newValue:i};t==="origin-transform"&&(n.action=r),t==="attributes"&&(n.attributeName=r),this.layer.graphicChanged(n)}};u([p({value:null,json:{read:vVe}})],yc.prototype,"aggregateGeometries",null),u([p({value:null})],yc.prototype,"attributes",null),u([p({value:null,types:_M,json:{read:bv}})],yc.prototype,"geometry",null),u([p({type:Boolean})],yc.prototype,"isAggregate",void 0),u([p({clonable:"reference"})],yc.prototype,"layer",void 0),u([p({type:AM})],yc.prototype,"popupTemplate",void 0),u([p({clonable:"reference"})],yc.prototype,"sourceLayer",void 0),u([p({value:null,types:X2})],yc.prototype,"symbol",null),u([p({type:Boolean,value:!0})],yc.prototype,"visible",null),yc=Xj=u([M("esri.Graphic")],yc),function(t){t.generateUID=zu}(yc||(yc={}));const vx=yc;function J6(t){return typeof t=="string"?document.getElementById(t):t??null}function X1e(t){for(;t.hasChildNodes();)t.removeChild(t.firstChild)}function pne(t,e){const i=e.parentNode;i&&i.insertBefore(t,e)}function fne(t,e){for(;;){const i=t.firstChild;if(!i)break;e.appendChild(i)}}let rF=class{constructor(e=i=>i.values().next().value){this._peeker=e,this._observable=new hM,this._items=new Set}get length(){return Mt(this._observable),this._items.size}clear(){this.length!==0&&(this._items.clear(),this._observable.notify())}last(){if(this.length===0)return;let e;for(e of this._items);return e}peek(){if(this.length!==0)return this._peeker(this._items)}push(e){this.contains(e)||(this._items.add(e),this._observable.notify())}contains(e){return Mt(this._observable),this._items.has(e)}pop(){if(this.length===0)return;const e=this.peek();return this._items.delete(e),this._observable.notify(),e}popLast(){if(this.length===0)return;const e=this.last();return this._items.delete(e),this._observable.notify(),e}remove(e){this.contains(e)&&(this._items.delete(e),this._observable.notify())}filter(e){const i=this.length;return this._items.forEach(r=>{e(r)||this._items.delete(r)}),i!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){Mt(this._observable),yield*this._items}};const Z1e=new FinalizationRegistry(t=>{t.close()});function wVe(t,e){Z1e.register(t,e,e)}function xVe(t){Z1e.unregister(t)}const TVe={statsWorker:()=>ce(()=>import("./statsWorker-ffeb7733.js"),["./statsWorker-ffeb7733.js","./utils-d4e69d8a.js","./utils-e4f79b61.js","./generateRendererUtils-45001f16.js"],import.meta.url),geometryEngineWorker:()=>ce(()=>import("./geometryEngineWorker-baab5887.js"),["./geometryEngineWorker-baab5887.js","./geometryEngineJSON-84b52367.js","./geometryEngineBase-f6af2696.js","./json-48e3ea08.js"],import.meta.url),CSVSourceWorker:()=>ce(()=>import("./CSVSourceWorker-de4ec8f0.js"),["./CSVSourceWorker-de4ec8f0.js","./date-430969b3.js","./json-48e3ea08.js","./FeatureStore-502a78b3.js","./BoundsStore-7941b063.js","./PooledRBush-a82b8470.js","./quickselect-cd6fa001.js","./QueryEngine-7a150f90.js","./WhereClause-813f9607.js","./TimeOnly-5ca21580.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-d4e69d8a.js","./utils-e4f79b61.js","./generateRendererUtils-45001f16.js","./optimizedFeatureQueryEngineAdapter-68a83ac4.js","./number-c725bbdc.js","./clientSideDefaults-9edee6f4.js"],import.meta.url),EdgeProcessingWorker:()=>ce(()=>import("./EdgeProcessingWorker-183a1e05.js"),[],import.meta.url),ElevationSamplerWorker:()=>ce(()=>import("./ElevationSamplerWorker-917b972c.js"),["./ElevationSamplerWorker-917b972c.js","./PooledRBush-a82b8470.js","./quickselect-cd6fa001.js"],import.meta.url),FeatureServiceSnappingSourceWorker:()=>ce(()=>import("./FeatureServiceSnappingSourceWorker-90b9fca8.js"),["./FeatureServiceSnappingSourceWorker-90b9fca8.js","./FeatureStore-502a78b3.js","./BoundsStore-7941b063.js","./PooledRBush-a82b8470.js","./quickselect-cd6fa001.js","./QueryEngine-7a150f90.js","./WhereClause-813f9607.js","./TimeOnly-5ca21580.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-d4e69d8a.js","./utils-e4f79b61.js","./generateRendererUtils-45001f16.js","./optimizedFeatureQueryEngineAdapter-68a83ac4.js","./symbologySnappingCandidates-be7acbb5.js","./pbfQueryUtils-2cf66e2d.js","./pbf-b60d46d3.js","./query-329b2ac1.js","./queryZScale-47976d5a.js"],import.meta.url),GeoJSONSourceWorker:()=>ce(()=>import("./GeoJSONSourceWorker-822b16ae.js"),["./GeoJSONSourceWorker-822b16ae.js","./FeatureStore-502a78b3.js","./BoundsStore-7941b063.js","./PooledRBush-a82b8470.js","./quickselect-cd6fa001.js","./QueryEngine-7a150f90.js","./WhereClause-813f9607.js","./TimeOnly-5ca21580.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-d4e69d8a.js","./utils-e4f79b61.js","./generateRendererUtils-45001f16.js","./optimizedFeatureQueryEngineAdapter-68a83ac4.js","./geojson-8889f8c8.js","./date-430969b3.js","./clientSideDefaults-9edee6f4.js","./sourceUtils-63c321ec.js"],import.meta.url),LercWorker:()=>ce(()=>import("./LercWorker-41a95d78.js"),[],import.meta.url),MemorySourceWorker:()=>ce(()=>import("./MemorySourceWorker-d6ca4d9f.js"),["./MemorySourceWorker-d6ca4d9f.js","./objectIdUtils-967fafff.js","./FeatureStore-502a78b3.js","./BoundsStore-7941b063.js","./PooledRBush-a82b8470.js","./quickselect-cd6fa001.js","./QueryEngine-7a150f90.js","./WhereClause-813f9607.js","./TimeOnly-5ca21580.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-d4e69d8a.js","./utils-e4f79b61.js","./generateRendererUtils-45001f16.js","./optimizedFeatureQueryEngineAdapter-68a83ac4.js","./clientSideDefaults-9edee6f4.js","./sourceUtils-63c321ec.js","./date-430969b3.js"],import.meta.url),PBFDecoderWorker:()=>ce(()=>import("./PBFDecoderWorker-2b1ee099.js"),["./PBFDecoderWorker-2b1ee099.js","./pbfQueryUtils-2cf66e2d.js","./pbf-b60d46d3.js"],import.meta.url),Pipeline:()=>ce(()=>import("./Pipeline-9cfffa76.js").then(t=>t.P),["./Pipeline-9cfffa76.js","./QueryEngine-7a150f90.js","./WhereClause-813f9607.js","./TimeOnly-5ca21580.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-d4e69d8a.js","./utils-e4f79b61.js","./generateRendererUtils-45001f16.js","./StreamFeatureManager-94c02f5a.js","./quickselect-cd6fa001.js","./labelPoint-454a2ef5.js","./ogcFeatureUtils-22595d5c.js","./geojson-8889f8c8.js","./date-430969b3.js","./clientSideDefaults-9edee6f4.js","./query-329b2ac1.js","./pbfQueryUtils-2cf66e2d.js","./pbf-b60d46d3.js","./queryZScale-47976d5a.js","./createConnection-efa0dc21.js","./definitions-24b8f578.js","./enums-9d4f5c11.js","./number-e491b09e.js","./geohashUtils-77d8429b.js"],import.meta.url),PointCloudWorker:()=>ce(()=>import("./PointCloudWorker-95f8aa0e.js"),["./PointCloudWorker-95f8aa0e.js","./PointCloudWorkerUtil-d3409edb.js","./PointCloudUniqueValueRenderer-f29eb455.js","./I3SBinaryReader-b93e280e.js"],import.meta.url),RasterWorker:()=>ce(()=>import("./RasterWorker-6b64bb60.js"),["./RasterWorker-6b64bb60.js","./dataUtils-c41f9a51.js","./pixelRangeUtils-367cd051.js","./utils-6b5312f8.js","./rasterProjectionHelper-05232069.js"],import.meta.url),SceneLayerSnappingSourceWorker:()=>ce(()=>import("./SceneLayerSnappingSourceWorker-a4256078.js"),[],import.meta.url),SceneLayerWorker:()=>ce(()=>import("./SceneLayerWorker-18445ad8.js").then(t=>t.S),["./SceneLayerWorker-18445ad8.js","./I3SNode-2b3c2c48.js"],import.meta.url),WFSSourceWorker:()=>ce(()=>import("./WFSSourceWorker-b7ae9aaf.js"),["./WFSSourceWorker-b7ae9aaf.js","./FeatureStore-502a78b3.js","./BoundsStore-7941b063.js","./PooledRBush-a82b8470.js","./quickselect-cd6fa001.js","./QueryEngine-7a150f90.js","./WhereClause-813f9607.js","./TimeOnly-5ca21580.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-d4e69d8a.js","./utils-e4f79b61.js","./generateRendererUtils-45001f16.js","./optimizedFeatureQueryEngineAdapter-68a83ac4.js","./geojson-8889f8c8.js","./date-430969b3.js","./sourceUtils-63c321ec.js","./wfsUtils-5a7e83e6.js","./xmlUtils-444cb4c0.js"],import.meta.url),WorkerTileHandler:()=>ce(()=>import("./WorkerTileHandler-0214d666.js"),["./WorkerTileHandler-0214d666.js","./TileClipper-ae6eca9e.js","./StyleRepository-43550a47.js","./definitions-24b8f578.js","./Rect-98da58d6.js","./pbf-b60d46d3.js","./TurboLine-5f9d8e13.js","./BidiEngine-9a40f2f4.js"],import.meta.url)};var ra;(function(t){t[t.HANDSHAKE=0]="HANDSHAKE",t[t.OPEN=1]="OPEN",t[t.OPENED=2]="OPENED",t[t.RESPONSE=3]="RESPONSE",t[t.INVOKE=4]="INVOKE",t[t.ABORT=5]="ABORT",t[t.CLOSE=6]="CLOSE",t[t.OPEN_PORT=7]="OPEN_PORT",t[t.ON=8]="ON"})(ra||(ra={}));let SVe=0;function J1e(){return SVe++}function EVe(t){return t&&typeof t=="object"&&("result"in t||"transferList"in t)}function fP(t){return t?typeof t=="string"?JSON.stringify({name:"message",message:t}):t.toJSON?JSON.stringify(t):JSON.stringify({name:t.name,message:t.message,details:t.details||{stack:t.stack}}):null}function EJ(t,e,i,r){if(e.type===ra.OPEN_PORT)return void t.postMessage(e,[e.port]);if(e.type!==ra.INVOKE&&e.type!==ra.RESPONSE)return void t.postMessage(e);let n;if(EVe(i)?(n=mne(i.transferList),e.data=i.result):(n=mne(r),e.data=i),n){if(ie("ff")){for(const s of n)if("byteLength"in s&&s.byteLength>267386880){const o="Worker call with large ArrayBuffer would crash Firefox";switch(e.type){case ra.INVOKE:throw o;case ra.RESPONSE:return void EJ(t,{type:ra.RESPONSE,jobId:e.jobId,error:fP(o)})}}}t.postMessage(e,n)}else t.postMessage(e)}function mP(t){if(!t)return null;const e=t.data;return e?typeof e=="string"?JSON.parse(e):e:null}function mne(t){if(!t?.length)return null;if(ie("esri-workers-arraybuffer-transfer"))return t;const e=t.filter(i=>!CVe(i));return e.length?e:null}function CVe(t){return t instanceof ArrayBuffer||t?.constructor?.name==="ArrayBuffer"}const{CLOSE:gne,ABORT:yne,INVOKE:_ne,RESPONSE:oA,OPEN_PORT:vne,ON:AVe}=ra,OVe=2;let RVe=class{constructor(e){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=e,this._timer=null,this._process=this._process.bind(this)}push(e){e.type===ra.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}},$v=class kS{static connect(e){const i=new MessageChannel;let r;r=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const n=new kS(i.port1,{channel:i,client:r});return typeof r=="object"&&"remoteClient"in r&&(r.remoteClient=n),kS.clients.set(n,r),i.port2}static loadWorker(e){const i=TVe[e];return i?i():Promise.resolve(null)}constructor(e,i,r){this._port=e,this._jobQueue=r,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new RVe(n=>this._onInvokeMessage(n)),this._client=i.client,this._onMessage=this._onMessage.bind(this),this._channel=i.channel,this._schedule=i.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:gne}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,i,r){const n=r?.signal,s=r?.transferList;if(!this._port)return Promise.reject(new G("worker:port-closed",`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:i}));const o=J1e();return new Promise((a,l)=>{if(ps(n))return this._processWork(),void l(Ti());const c=Ms(n,()=>{const d=this._outJobs.get(o);d&&(this._outJobs.delete(o),this._processWork(),Tr(d.abortHandle),this._post({type:yne,jobId:o}),l(Ti()))}),h={resolve:a,reject:l,abortHandle:c,debugInfo:e};this._outJobs.set(o,h),this._post({type:_ne,jobId:o,methodName:e,abortable:n!=null},i,s)})}on(e,i){const r=new MessageChannel;function n(s){i(s.data)}return this._port.postMessage({type:ra.ON,eventType:e,port:r.port2},[r.port2]),r.port1.addEventListener("message",n),r.port1.start(),Vi(()=>{r.port1.postMessage({type:ra.CLOSE}),r.port1.close(),r.port1.removeEventListener("message",n)})}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:vne,port:e.port2}),e.port1}_processWork(){if(this._outJobs.size>=OVe)return;const e=this._jobQueue?.pop();if(!e)return;const{methodName:i,data:r,invokeOptions:n,resolver:s}=e;this.invoke(i,r,n).then(o=>s.resolve(o)).catch(o=>s.reject(o))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{Tr(e.abortHandle),e.reject(Ti(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(e){this._schedule!=null?this._schedule(()=>this._processMessage(e)):this._processMessage(e)}_processMessage(e){const i=mP(e);if(i)switch(i.type){case oA:this._onResponseMessage(i);break;case _ne:this._invokeQueue.push(i);break;case yne:this._onAbortMessage(i);break;case gne:this._onCloseMessage();break;case vne:this._onOpenPortMessage(i);break;case AVe:this._onOnMessage(i)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,n=i.get(r);this._invokeQueue.push(e),n&&(n.controller&&n.controller.abort(),i.delete(r))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&kS.clients.get(this)===e&&e.destroy(),kS.clients.delete(this),e?.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:i,jobId:r,data:n,abortable:s}=e,o=s?new AbortController:null,a=this._inJobs;let l,c=this._client,h=c[i];try{if(!h&&i&&i.includes(".")){const d=i.split(".");for(let f=0;f<d.length-1;f++)c=c[d[f]],h=c[d[f+1]]}if(typeof h!="function")throw new TypeError(`${i} is not a function`);l=h.call(c,n,{client:this,signal:o?o.signal:null})}catch(d){return void this._post({type:oA,jobId:r,error:fP(d)})}Zc(l)?(a.set(r,{controller:o,promise:l}),l.then(d=>{a.has(r)&&(a.delete(r),this._post({type:oA,jobId:r},d))},d=>{a.has(r)&&(a.delete(r),Tn(d)||this._post({type:oA,jobId:r,error:fP(d||{message:`Error encountered at method ${i}`})}))})):this._post({type:oA,jobId:r},l)}_onOpenPortMessage(e){new kS(e.port,{client:this._client})}_onOnMessage(e){const{port:i}=e,r=this._client.on(e.eventType,s=>{i.postMessage(s)}),n=oy(e.port,"message",s=>{mP(s)?.type===ra.CLOSE&&(n.remove(),r.remove(),i.close())})}_onResponseMessage(e){const{jobId:i,error:r,data:n}=e,s=this._outJobs;if(!s.has(i))return;const o=s.get(i);s.delete(i),this._processWork(),Tr(o.abortHandle),r?o.reject(G.fromJSON(JSON.parse(r))):o.resolve(n)}_post(e,i,r){return EJ(this._port,e,i,r)}};$v.kernelInfo={buildDate:Hge,fullVersion:d6,revision:qge},$v.clients=new Map;let PVe=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new rF}destroy(){this.close()}get closed(){return!this._clients?.length}open(e,i){return new Promise((r,n)=>{let s=!0;const o=a=>{Tt(i.signal),s&&(s=!1,a())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let a=0;a<e.length;++a){const l=e[a];Zc(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new $v(c,i,this._ongoingJobsQueue),o(r),this._clients[a]),()=>(o(n),null)):(this._clients[a]=new $v(l,i,this._ongoingJobsQueue),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(r))}})}broadcast(e,i,r){const n=new Array(this._clientPromises.length);for(let s=0;s<this._clientPromises.length;++s){const o=this._clientPromises[s];n[s]=o.then(a=>a?.invoke(e,i,r))}return n}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject(Ti(`Worker closing, aborting job calling '${e.methodName}'`));for(const i of this._clientPromises)i.then(r=>r?.close());this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0,xVe(this)}invoke(e,i,r){let n;Array.isArray(r)?(K.getLogger("esri.core.workers.Connection").warn("invoke()","The transferList parameter is deprecated, use the options object instead"),n={transferList:r}):n=r;const s=Hs();this._ongoingJobsQueue.push({methodName:e,data:i,invokeOptions:n,resolver:s});for(let o=0;o<this._clientPromises.length;o++){const a=this._clients[o];a?a.jobAdded():this._clientPromises[o].then(l=>l?.jobAdded())}return s.promise}on(e,i){return Promise.all(this._clientPromises).then(()=>yv(this._clients.map(r=>r.on(e,i))))}openPorts(){return new Promise(e=>{const i=new Array(this._clientPromises.length);let r=i.length;for(let n=0;n<this._clientPromises.length;++n)this._clientPromises[n].then(s=>{s&&(i[n]=s.openPort()),--r==0&&e(i)})})}get test(){return{numClients:this._clients.length}}};const MVe={async request(t,e){const i=t.options,r=i.responseType;i.signal=e?.signal,i.responseType=r==="native"||r==="native-request-init"?"native-request-init":r&&["blob","json","text"].includes(r)&&Uge(t.url)?.after?r:"array-buffer";const n=await _i(t.url,i),s={data:n.data,httpStatus:n.httpStatus,ssl:n.ssl};switch(n.requestOptions?.responseType){case"native-request-init":return delete s.data.signal,s;case"blob":s.data=await s.data.arrayBuffer();break;case"json":s.data=new TextEncoder().encode(JSON.stringify(s.data)).buffer;break;case"text":s.data=new TextEncoder().encode(s.data).buffer}return{result:s,transferList:[s.data]}}},$Ve={};function IVe(t){const e={async:t.async,isDebug:t.isDebug,locale:t.locale,baseUrl:t.baseUrl,has:{...t.has},map:{...t.map},packages:t.packages?.concat()||[],paths:{...t.paths}};return t.hasOwnProperty("async")||(e.async=!0),t.hasOwnProperty("isDebug")||(e.isDebug=!1),t.baseUrl||(e.baseUrl=$Ve.baseUrl),e}let LVe=class{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(i=>{this[i]=(...r)=>e[i](...r)})}},IN=class{constructor(){this._dispatcher=new LVe,this._workerPostMessage({type:ra.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){TE(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,i,r){this._dispatcher.addEventListener(e,i,r)}removeEventListener(e,i,r){this._dispatcher.removeEventListener(e,i,r)}_workerPostMessage(e){TE(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const i=mP(e);if(i&&i.type===ra.OPEN){const{modulePath:r,jobId:n}=i;let s=await $v.loadWorker(r);s||(s=await ce(()=>import(r),[],import.meta.url));const o=$v.connect(s);this._workerPostMessage({type:ra.OPENED,jobId:n,data:o})}}};const Zj=K.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:DVe}=ra,NVe='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,s)=>{if(t){if(t.aborted)return s(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:ABORT,jobId:n}),s(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:s}),self.postMessage({type:INVOKE,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\\nModules version: ${r}\\nAssets version: ${n??s}\\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case OPEN:let n;function t(e){const o=n.connect(e);self.postMessage({type:OPENED,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case RESPONSE:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let Y$,X$;const bne="Failed to create Worker. Fallback to execute module in main thread";async function FVe(){if(!ie("esri-workers"))return wne(new IN);if(!Y$&&!X$)try{const e=NVe.split('"{CONFIGURATION}"').join(`'${kVe()}'`);Y$=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){X$=e||{}}let t;if(Y$)try{t=new Worker(Y$,{name:"esri-worker-"+UVe++})}catch{Zj.warn(bne,X$),t=new IN}else Zj.warn(bne,X$),t=new IN;return wne(t)}async function wne(t){return new Promise(e=>{function i(n){const s=mP(n);s&&s.type===DVe&&(t.removeEventListener("message",i),t.removeEventListener("error",r),e(t))}function r(n){n.preventDefault(),t.removeEventListener("message",i),t.removeEventListener("error",r),Zj.warn("Failed to create Worker. Fallback to execute module in main thread",n),(t=new IN).addEventListener("message",i),t.addEventListener("error",r)}t.addEventListener("message",i),t.addEventListener("error",r)})}function kVe(){let t;if(Di.default!=null){const n={...Di};delete n.default,t=JSON.parse(JSON.stringify(n))}else t=JSON.parse(JSON.stringify(Di));t.assetsPath=ul(t.assetsPath),t.defaultAssetsPath=t.defaultAssetsPath?ul(t.defaultAssetsPath):void 0,t.request.interceptors=[],t.log.interceptors=[],t.locale=Gu(),t.has={"esri-csp-restrictions":ie("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":ie("esri-2d-update-debug"),"esri-2d-log-updating":ie("esri-2d-log-updating"),"featurelayer-pbf":ie("featurelayer-pbf"),"featurelayer-simplify-thresholds":ie("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":ie("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":ie("featurelayer-simplify-mobile-factor"),"esri-atomics":ie("esri-atomics"),"esri-shared-array-buffer":ie("esri-shared-array-buffer"),"esri-tiles-debug":ie("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":ie("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":ie("feature-polyline-generalization-factor"),"host-webworker":1},t.workers.loaderUrl&&(t.workers.loaderUrl=ul(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=ul(t.workers.workerPath):t.workers.workerPath=ul(ur("esri/core/workers/RemoteClient.js")),t.workers.useDynamicImport=!1;const e=Di.workers.loaderConfig,i=IVe({baseUrl:e?.baseUrl,locale:Gu(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e?.has},map:{...e?.map},paths:{...e?.paths},packages:e?.packages||[]});return JSON.stringify({esriConfig:t,loaderConfig:i,kernelInfo:{buildDate:Hge,fullVersion:d6,revision:qge}})}let UVe=0;const{ABORT:xne,INVOKE:zVe,OPEN:BVe,OPENED:VVe,RESPONSE:aA}=ra;let GVe=class K1e{static async create(e){const i=await FVe();return new K1e(i,e)}constructor(e,i){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=i,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",r=>{r.preventDefault(),K.getLogger("esri.core.workers.WorkerOwner").error(r)})}terminate(){this.worker.terminate()}async open(e,i={}){const{signal:r}=i,n=J1e();return new Promise((s,o)=>{const a={resolve:s,reject:o,abortHandle:sM(r,()=>{this._outJobs.delete(n),this._post({type:xne,jobId:n})})};this._outJobs.set(n,a),this._post({type:BVe,jobId:n,modulePath:e})})}_onMessage(e){const i=mP(e);if(i)switch(i.type){case VVe:this._onOpenedMessage(i);break;case aA:this._onResponseMessage(i);break;case xne:this._onAbortMessage(i);break;case zVe:this._onInvokeMessage(i)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,n=i.get(r);n&&(n.controller&&n.controller.abort(),i.delete(r))}_onInvokeMessage(e){const{methodName:i,jobId:r,data:n,abortable:s}=e,o=s?new AbortController:null,a=this._inJobs,l=MVe[i];let c;try{if(typeof l!="function")throw new TypeError(`${i} is not a function`);c=l.call(null,n,{signal:o?o.signal:null})}catch(h){return void this._post({type:aA,jobId:r,error:fP(h)})}Zc(c)?(a.set(r,{controller:o,promise:c}),c.then(h=>{a.has(r)&&(a.delete(r),this._post({type:aA,jobId:r},h))},h=>{a.has(r)&&(a.delete(r),h||(h={message:"Error encountered at method"+i}),Tn(h)||this._post({type:aA,jobId:r,error:fP(h||{message:`Error encountered at method ${i}`})}))})):this._post({type:aA,jobId:r},c)}_onOpenedMessage(e){const{jobId:i,data:r}=e,n=this._outJobs.get(i);n&&(this._outJobs.delete(i),Tr(n.abortHandle),n.resolve(r))}_onResponseMessage(e){const{jobId:i,error:r,data:n}=e,s=this._outJobs.get(i);s&&(this._outJobs.delete(i),Tr(s.abortHandle),r?s.reject(G.fromJSON(JSON.parse(r))):s.resolve(n))}_post(e,i,r){return EJ(this.worker,e,i,r)}};const Tne=ie("host-browser")?Math.min(navigator.hardwareConcurrency-1,ie("workers-pool-size")):0;let Aw=ie("esri-mobile")?Math.min(Tne,3):Tne;Aw||(Aw=ie("safari")&&ie("mac")?7:2);let Sne=0;const LN=[];function jVe(){Q1e()}async function Z$(t,e){const i=new PVe,{registryTarget:r,...n}=e;return await i.open(t,n),r&&wVe(r,i),i}async function HVe(t,e={}){if(typeof t!="string")throw new G("workers:undefined-module","modulePath is missing");let i=e.strategy||"distributed";if(ie("host-webworker")&&!ie("esri-workers")&&(i="local"),i==="local"){let r=await $v.loadWorker(t);r||(r=await ce(()=>import(t),[],import.meta.url)),Tt(e.signal);const n=e.client||r;return Z$([$v.connect(r)],{...e,client:n})}if(await Q1e(),Tt(e.signal),i==="dedicated"){const r=Sne++%Aw;return Z$([await LN[r].open(t,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const r=Math.min(e.maxNumWorkers,Aw);if(r<Aw){const n=new Array(r);for(let s=0;s<r;++s){const o=Sne++%Aw;n[s]=LN[o].open(t,e)}return Z$(n,e)}}return Z$(LN.map(r=>r.open(t,e)),e)}let J$=null;async function Q1e(){if(J$)return J$;new AbortController;const t=[];for(let e=0;e<Aw;e++){const i=GVe.create(e).then(r=>(LN[e]=r,r));t.push(i)}return J$=Promise.all(t),J$}let rR=class extends Je{constructor(e){super(e),this.addHandles([this.on("before-add",i=>{i.item==null&&i.preventDefault()}),this.on("after-add",i=>this._own(i.item)),this.on("after-remove",i=>this._release(i.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(Je.ofType(this.itemType.Type))(e):new Je(e)}};function Jj(t,e){return{type:t,cast:KX,set(i){const r=wy(i,this._get(e),t);r.owner=this,this._set(e,r)}}}u([p()],rR.prototype,"owner",null),rR=u([M("esri.core.support.OwningCollection")],rR);function K6(t,e,i,r){return t!=null&&(Fn(e,r)?(Sy(i,t),!0):(nc[0]=t[0],nc[1]=t[1],nc[2]=0,!!rn(nc,e,0,nc,r,0,1)&&(i[0]=nc[0],i[1]=nc[1],nc[0]=t[2],nc[1]=t[3],nc[2]=0,!!rn(nc,e,0,nc,r,0,1)&&(i[2]=nc[0],i[3]=nc[1],!0))))}const nc=E();function Wc(t,e,i,r=0){K$[0]=t.x,K$[1]=t.y;const n=t.z;return K$[2]=n!==void 0?n:r,rn(K$,t.spatialReference,0,e,i,0,1)}const K$=E();function ua(t,e,i,r){return!(e==null||r==null||t.length<2)&&(t.length===2&&(Q$[0]=t[0],Q$[1]=t[1],Q$[2]=0,t=Q$),rn(t,e,0,i,r,0,1))}const Q$=E();let zy=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&TE(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*Ene);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,Ene));e++)this._items.push(this._allocator())}};const Ene=1024;function be(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function HE(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function CJ(t,e,i,r,n,s,o,a,l,c,h,d,f,m,y,_){return[t,e,i,r,n,s,o,a,l,c,h,d,f,m,y,_]}function ebe(t,e){return new Float64Array(t,e,16)}const Kr=be();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Kr,clone:HE,create:be,createView:ebe,fromValues:CJ},Symbol.toStringTag,{value:"Module"}));var nF;(function(t){t[t.KILOBYTES=1024]="KILOBYTES",t[t.MEGABYTES=1048576]="MEGABYTES",t[t.GIGABYTES=1073741824]="GIGABYTES"})(nF||(nF={}));function nn(){return[1,0,0,0,1,0,0,0,1]}function tbe(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function qVe(t,e,i,r,n,s,o,a,l){return[t,e,i,r,n,s,o,a,l]}function ibe(t,e){return new Float64Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:tbe,create:nn,createView:ibe,fromValues:qVe},Symbol.toStringTag,{value:"Module"}));function hd(){return[0,0,0,1]}function rbe(t){return[t[0],t[1],t[2],t[3]]}function WVe(t,e,i,r){return[t,e,i,r]}function nbe(t,e){return new Float64Array(t,e,4)}const YVe=hd();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:YVe,clone:rbe,create:hd,createView:nbe,fromValues:WVe},Symbol.toStringTag,{value:"Module"}));function Ge(){return[0,0]}function U3(t){return[t[0],t[1]]}function pi(t,e){return[t,e]}function sbe(t,e=Ge()){const i=Math.min(2,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function obe(t,e){return new Float64Array(t,e,2)}function abe(){return Ge()}function lbe(){return pi(1,1)}function cbe(){return pi(1,0)}function ube(){return pi(0,1)}const Ey=abe(),XVe=lbe(),hbe=cbe(),ZVe=ube();Object.freeze(Object.defineProperty({__proto__:null,ONES:XVe,UNIT_X:hbe,UNIT_Y:ZVe,ZEROS:Ey,clone:U3,create:Ge,createView:obe,fromArray:sbe,fromValues:pi,ones:lbe,unitX:cbe,unitY:ube,zeros:abe},Symbol.toStringTag,{value:"Module"}));function oi(){return[0,0,0,0]}function $M(t){return[t[0],t[1],t[2],t[3]]}function Ft(t,e,i,r){return[t,e,i,r]}function AJ(t,e=oi()){const i=Math.min(4,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function dbe(t,e){return new Float64Array(t,e,4)}function pbe(){return oi()}function fbe(){return Ft(1,1,1,1)}function mbe(){return Ft(1,0,0,0)}function gbe(){return Ft(0,1,0,0)}function ybe(){return Ft(0,0,1,0)}function _be(){return Ft(0,0,0,1)}const Wu=pbe(),Hh=fbe(),JVe=mbe(),KVe=gbe(),QVe=ybe(),e7e=_be();Object.freeze(Object.defineProperty({__proto__:null,ONES:Hh,UNIT_W:e7e,UNIT_X:JVe,UNIT_Y:KVe,UNIT_Z:QVe,ZEROS:Wu,clone:$M,create:oi,createView:dbe,fromArray:AJ,fromValues:Ft,ones:fbe,unitW:_be,unitX:mbe,unitY:gbe,unitZ:ybe,zeros:pbe},Symbol.toStringTag,{value:"Module"}));let $C=class Eb{constructor(e,i,r){this._itemByteSize=e,this._itemCreate=i,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(r/this._itemByteSize)}get(){this._itemsPtr===0&&TE(()=>this._reset());const e=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=e;){const i=new ArrayBuffer(this._itemsPerBuffer*this._itemByteSize);for(let r=0;r<this._itemsPerBuffer;++r)this._items.push(this._itemCreate(i,r*this._itemByteSize));this._buffers.push(i)}return this._items[this._itemsPtr++]}_reset(){const e=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>e;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(e=hT){return new Eb(16,obe,e)}static createVec3f64(e=hT){return new Eb(24,Cye,e)}static createVec4f64(e=hT){return new Eb(32,dbe,e)}static createMat3f64(e=hT){return new Eb(72,ibe,e)}static createMat4f64(e=hT){return new Eb(128,ebe,e)}static createQuatf64(e=hT){return new Eb(32,nbe,e)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this._itemByteSize}}};const hT=4*nF.KILOBYTES,J$t=$C.createVec2f64(),Ne=$C.createVec3f64(),OJ=$C.createVec4f64();$C.createMat3f64();const RJ=$C.createMat4f64(),K$t=$C.createQuatf64();function Vp(t){return t?{origin:Qr(t.origin),vector:Qr(t.vector)}:{origin:E(),vector:E()}}function t7e(t,e){const i=r7e.get();return i.origin=t,i.vector=e,i}function Q$t(t,e=Vp()){return i7e(t.origin,t.vector,e)}function i7e(t,e,i=Vp()){return oe(i.origin,t),oe(i.vector,e),i}function jw(t,e,i=Vp()){return oe(i.origin,t),de(i.vector,e,t),i}function PJ(t,e){const i=de(Ne.get(),e,t.origin),r=ge(t.vector,i),n=ge(t.vector,t.vector),s=_e(r/n,0,1),o=de(Ne.get(),re(Ne.get(),t.vector,s),i);return ge(o,o)}function eIt(t,e,i){return Kj(t,e,0,1,i)}function tIt(t,e,i){return ue(i,t.origin,re(i,t.vector,e))}function Kj(t,e,i,r,n){const{vector:s,origin:o}=t,a=de(Ne.get(),e,o),l=ge(s,a)/na(s);return re(n,s,_e(l,i,r)),ue(n,n,t.origin)}function iIt(t,e){if(bbe(t,t7e(e.origin,e.direction),!1,sF)){const{tA:i,pB:r,distance2:n}=sF;if(i>=0&&i<=1)return n;if(i<0)return qs(t.origin,r);if(i>1)return qs(ue(Ne.get(),t.origin,t.vector),r)}return null}function vbe(t,e,i){return!!bbe(t,e,!0,sF)&&(oe(i,sF.pA),!0)}function bbe(t,e,i,r){const s=t.origin,o=ue(Ne.get(),s,t.vector),a=e.origin,l=ue(Ne.get(),a,e.vector),c=Ne.get(),h=Ne.get();if(c[0]=s[0]-a[0],c[1]=s[1]-a[1],c[2]=s[2]-a[2],h[0]=l[0]-a[0],h[1]=l[1]-a[1],h[2]=l[2]-a[2],Math.abs(h[0])<1e-6&&Math.abs(h[1])<1e-6&&Math.abs(h[2])<1e-6)return!1;const d=Ne.get();if(d[0]=o[0]-s[0],d[1]=o[1]-s[1],d[2]=o[2]-s[2],Math.abs(d[0])<1e-6&&Math.abs(d[1])<1e-6&&Math.abs(d[2])<1e-6)return!1;const f=c[0]*h[0]+c[1]*h[1]+c[2]*h[2],m=h[0]*d[0]+h[1]*d[1]+h[2]*d[2],y=c[0]*d[0]+c[1]*d[1]+c[2]*d[2],_=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],v=(d[0]*d[0]+d[1]*d[1]+d[2]*d[2])*_-m*m;if(Math.abs(v)<1e-6)return!1;let w=(f*m-y*_)/v,x=(f+m*w)/_;i&&(w=_e(w,0,1),x=_e(x,0,1));const T=Ne.get(),S=Ne.get();return T[0]=s[0]+w*d[0],T[1]=s[1]+w*d[1],T[2]=s[2]+w*d[2],S[0]=a[0]+x*h[0],S[1]=a[1]+x*h[1],S[2]=a[2]+x*h[2],r.tA=w,r.tB=x,r.pA=T,r.pB=S,r.distance2=qs(T,S),!0}const sF={tA:0,tB:0,pA:E(),pB:E(),distance2:0},r7e=new zy(()=>Vp());function js(t){return t?Cne(Qr(t.origin),Qr(t.direction)):Cne(E(),E())}function Cne(t,e){return{origin:t,direction:e}}function rIt(t,e){return vy(t.origin,e.origin)&&vy(t.direction,e.direction)}function th(t,e){const i=o7e.get();return i.origin=t,i.direction=e,i}function oF(t,e=js()){return xbe(t.origin,t.direction,e)}function wbe(t,e,i=js()){return oe(i.origin,t),de(i.direction,e,t),i}function xbe(t,e,i=js()){return oe(i.origin,t),oe(i.direction,e),i}function n7e(t,e){const i=lt(Ne.get(),ye(Ne.get(),t.direction),de(Ne.get(),e,t.origin));return ge(i,i)}function s7e(t,e,i){const r=ge(t.direction,de(i,e,t.origin));return ue(i,t.origin,re(i,t.direction,r)),i}const o7e=new zy(()=>js());function nR(t,e){return ge(t,e)/xe(t)}function Q6(t,e){const i=ge(t,e)/(xe(t)*xe(e));return-Ys(i)}function Tbe(t,e,i){ye(eI,t),ye(fz,e);const r=ge(eI,fz),n=Ys(r),s=lt(eI,eI,fz);return ge(s,i)<0?2*Math.PI-n:n}const eI=E(),fz=E(),Sbe=kn();function kn(){return oi()}const a7e=px,l7e=px;function qE(t,e=kn()){return mp(e,t)}function Ebe(t,e){return Ft(t[0],t[1],t[2],e)}function c7e(t){return t}function u7e(t){t[0]=t[1]=t[2]=t[3]=0}function eU(t,e){return t[0]=t[1]=t[2]=0,t[3]=e,t}function ly(t){return t[3]}function h7e(t){return t}function Cbe(t,e,i,r){return Ft(t,e,i,r)}function d7e(t,e,i){return t!==i&&oe(i,t),i[3]=t[3]+e,i}function p7e(t,e,i){return K.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported"),t===i?i:qE(t,i)}function e1(t,e,i){if(e==null||!Abe(t,e,aF))return!1;let{t0:r,t1:n}=aF;if((r<0||n<r&&n>0)&&(r=n),r<0)return!1;if(i){const{origin:s,direction:o}=e;i[0]=s[0]+o[0]*r,i[1]=s[1]+o[1]*r,i[2]=s[2]+o[2]*r}return!0}function f7e(t,e,i){const r=wbe(e,i);if(!Abe(t,r,aF))return[];const{origin:n,direction:s}=r,{t0:o,t1:a}=aF,l=c=>{const h=E();return ql(h,n,s,c),MJ(t,h,h)};return Math.abs(o-a)<jo()?[l(o)]:[l(o),l(a)]}const aF={t0:0,t1:0};function Abe(t,e,i){const{origin:r,direction:n}=e,s=m7e;s[0]=r[0]-t[0],s[1]=r[1]-t[1],s[2]=r[2]-t[2];const o=n[0]*n[0]+n[1]*n[1]+n[2]*n[2];if(o===0)return!1;const a=2*(n[0]*s[0]+n[1]*s[1]+n[2]*s[2]),l=a*a-4*o*(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]-t[3]*t[3]);if(l<0)return!1;const c=Math.sqrt(l);return i.t0=(-a-c)/(2*o),i.t1=(-a+c)/(2*o),!0}const m7e=E();function Qj(t,e){return e1(t,e,null)}function g7e(t,e,i){if(e1(t,e,i))return i;const r=IC(t,e,Ne.get());return ue(i,e.origin,re(Ne.get(),e.direction,Mr(e.origin,r)/xe(e.direction))),i}function IC(t,e,i){const r=Ne.get(),n=RJ.get();lt(r,e.origin,e.direction);const s=ly(t);lt(i,r,e.origin),re(i,i,1/xe(i)*s);const o=Rbe(t,e.origin),a=Q6(e.origin,i);return Qu(n,a+o,r),ke(i,i,n),i}function y7e(t,e,i){return e1(t,e,i)?i:(s7e(e,t,i),MJ(t,i,i))}function MJ(t,e,i){const r=de(Ne.get(),e,t),n=re(Ne.get(),r,t[3]/xe(r));return ue(i,n,t)}function Obe(t,e){const i=de(Ne.get(),e,t),r=na(i),n=t[3]*t[3];return Math.sqrt(Math.abs(r-n))}function Rbe(t,e){const i=de(Ne.get(),e,t),r=xe(i),n=ly(t),s=n+Math.abs(n-r);return Ys(n/s)}const mz=E();function Pbe(t,e,i,r){const n=de(mz,e,t);switch(i){case an.X:{const s=Bie(n,mz)[2];return ae(r,-Math.sin(s),Math.cos(s),0)}case an.Y:{const s=Bie(n,mz),o=s[1],a=s[2],l=Math.sin(o);return ae(r,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case an.Z:return ye(r,n);default:return}}function Mbe(t,e){const i=de(eH,e,t);return xe(i)-t[3]}function _7e(t,e,i,r){const n=Mbe(t,e),s=Pbe(t,e,an.Z,eH),o=re(eH,s,i-n);return ue(r,e,o)}function v7e(t,e){const i=qs(t,e),r=ly(t);return i<=r*r}function b7e(t,e,i=kn()){const r=Mr(t,e),n=t[3],s=e[3];return r+s<n?(mp(i,t),i):r+n<s?(mp(i,e),i):(Xi(i,t,e,(r+s-n)/(2*r)),i[3]=(r+n+s)/2,i)}const eH=E(),tU=kn(),w7e=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:Sbe,altitudeAt:Mbe,angleToSilhouette:Rbe,axisAt:Pbe,clear:u7e,closestPoint:y7e,closestPointOnSilhouette:IC,containsPoint:v7e,copy:qE,create:kn,distanceToSilhouette:Obe,elevate:d7e,equals:l7e,exactEquals:a7e,fromCenterAndRadius:Ebe,fromRadius:eU,fromValues:Cbe,getCenter:h7e,getRadius:ly,intersectLine:f7e,intersectRay:e1,intersectRayClosestSilhouette:g7e,intersectsRay:Qj,projectPoint:MJ,setAltitudeAt:_7e,setExtent:p7e,tmpSphere:tU,union:b7e,wrap:c7e},Symbol.toStringTag,{value:"Module"}));function WE(t){const e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],i=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],r=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(e,i,r))}function x7e(t,e){const i=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),r=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),n=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return ae(t,i,r,n),t}function nIt(t,e,i){i=i||t;const r=ge(t,e);ae(i,t[0]-r*e[0],t[1]-r*e[1],t[2]-r*e[2]),ye(i,i)}function sIt(t,e,i){Math.abs(t[0])>Math.abs(t[1])?ae(e,0,1,0):ae(e,1,0,0),lt(i,t,e),ye(e,e),lt(e,i,t),ye(i,i)}function tI(t,e,i,r,n,s){const o=t+(e-t)*n;return o+(i+(r-i)*n-o)*s}function T7e(t,e,i,r=E()){const n=xe(t),s=xe(e),o=ge(t,e)/(n*s);if(o<.9999999999999999){const a=Math.acos(o),l=((1-i)*n+i*s)/Math.sin(a),c=l/n*Math.sin((1-i)*a),h=l/s*Math.sin(i*a);return re(Ow,t,c),re(Rw,e,h),ue(r,Ow,Rw)}return Xi(r,t,e,i)}function oIt(t,e,i,r=E(),n=E()){const s=xe(t),o=xe(e),a=ge(t,e)/(s*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),h=Math.sin(i*l),d=Math.sin((1-i)*l),f=(1-i)*s+i*o;{const m=f/c,y=m/o*h;re(Ow,t,m/s*d),re(Rw,e,y),ue(r,Ow,Rw)}{const m=1/s*(-Math.cos((1-i)*l)*l*f+d*(-s+o));re(Ow,t,m);const y=1/o*(Math.cos(i*l)*l*f+h*(-s+o));re(Rw,e,y),ue(n,Ow,Rw),re(n,n,1/c)}return n}return Xi(r,t,e,i),de(n,e,t),ye(n,n),n}function DN(t,e,i){t=ye(Ow,t),e=ye(Rw,e);const r=Ys(ge(t,e));if(i){const n=lt(S7e,t,e);if(ge(n,i)<0)return-r}return r}function NN(t){const e=t.length;return i=>{if(i<=t[0][0])return t[0][1];if(i>=t[e-1][0])return t[e-1][1];let r=1;for(;i>t[r][0];)r++;const n=t[r-1][0],s=t[r][0],o=(s-i)/(s-n);return o*t[r-1][1]+(1-o)*t[r][1]}}function aIt(t,e,i,r){de(Ane,e,t),de(One,i,t),lt(r,Ane,One),ye(r,r),r[3]=-ge(t,r)}const Ane=E(),One=E(),S7e=E(),Ow=E(),Rw=E();function Ii(t=z3){return[t[0],t[1],t[2],t[3]]}function E7e(t=z3[0],e=z3[1],i=z3[2],r=z3[3]){return $J(t,e,i,r,OJ.get())}function iU(t,e){return $J(e[0],e[1],e[2],e[3],t)}function $J(t,e,i,r,n=Ii()){return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n}function $be(t,e,i){return oe(i,t),i[3]=e,i}function IM(t,e,i){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=-(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]),i}function Ca(t,e,i,r=Ii()){const n=i[0]-e[0],s=i[1]-e[1],o=i[2]-e[2],a=t[0]-e[0],l=t[1]-e[1],c=t[2]-e[2],h=s*c-o*l,d=o*a-n*c,f=n*l-s*a,m=h*h+d*d+f*f,y=Math.abs(m-1)>1e-5&&m>1e-12?1/Math.sqrt(m):1;return r[0]=h*y,r[1]=d*y,r[2]=f*y,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function IJ(t,e,i,r=0,n=Math.floor(i*(1/3)),s=Math.floor(i*(2/3))){if(i<3)return!1;e(lA,r);let o=n,a=!1;for(;o<i-1&&!a;)e(dT,o),o++,a=!oa(lA,dT);if(!a)return!1;for(o=Math.max(o,s),a=!1;o<i&&!a;)e(cw,o),o++,de(iI,lA,dT),ye(iI,iI),de(rI,dT,cw),ye(rI,rI),a=!oa(lA,cw)&&!oa(dT,cw)&&Math.abs(ge(iI,rI))<A7e;return a?(Ca(lA,dT,cw,t),!0):(r!==0||n!==1||s!==2)&&IJ(t,e,i,0,1,2)}function C7e(t,e,i=!0){const r=e.length/3;return IJ(t,(n,s)=>ae(n,e[3*s+0],e[3*s+1],e[3*s+2]),i?r-1:r)}const A7e=.99619469809,lA=E(),dT=E(),cw=E(),iI=E(),rI=E();function tH(t,e,i){return e!==t&&iU(t,e),t[3]=-ge(t,i),t}function iH(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function gP(t,e,i,r){return lt(cw,e,t),IM(i,cw,r)}function lIt(t,e,i,r){return rU(t,e,de(Ne.get(),i,e),I7e,r)}function qx(t,e,i){return e!=null&&rU(t,e.origin,e.direction,L7e,i)}function O7e(t,e,i){return rU(t,e.origin,e.vector,fm.NONE,i)}function R7e(t,e,i){return rU(t,e.origin,e.vector,fm.CLAMP,i)}const cIt=(()=>{const t=E();return(e,i,r)=>{const n=e,s=i;if(lt(t,n,s),na(t)<jo())return!1;ye(t,t);const[o,a,l]=t,c=r.origin,h=Math.abs(o),d=Math.abs(a),f=Math.abs(l),[m,y,_]=n,[v,w,x]=s,T=e[3],S=i[3];return h>d&&h>f?(c[1]=(S*_-T*x)/o,c[2]=(T*w-S*y)/o):d>f?(c[0]=(T*x-S*_)/a,c[2]=(S*m-T*v)/a):(c[0]=(S*y-T*w)/l,c[1]=(T*v-S*m)/l),oe(r.direction,t),!0}})();function Ibe(t,e){return hr(t,e)>=0}function P7e(t,e){const i=ge(t,e.ray.direction),r=-hr(t,e.ray.origin);if(r<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return r>0;if((r<0||i<0)&&!(r<0&&i<0))return!0;const n=r/i;return i>0?n<e.c1&&(e.c1=n):n>e.c0&&(e.c0=n),e.c0<=e.c1}function M7e(t,e){const i=ge(t,e.ray.direction),r=-hr(t,e.ray.origin);if(i>-1e-6&&i<1e-6)return r>0;const n=r/i;return i>0?n<e.c1&&(e.c1=n):n>e.c0&&(e.c0=n),e.c0<=e.c1}function $7e(t,e,i){const r=re(Ne.get(),t,-t[3]),n=rH(t,de(Ne.get(),e,r),Ne.get());return ue(i,n,r),i}function rH(t,e,i){const r=re(Ne.get(),t,ge(t,e));return de(i,e,r),i}function uIt(t,e){return Math.abs(hr(t,e))}function hr(t,e){return ge(t,e)+t[3]}function rU(t,e,i,r,n){const s=ge(t,i);if(s===0)return!1;let o=-(ge(t,e)+t[3])/s;return r&fm.CLAMP&&(o=_e(o,0,1)),!(!(r&fm.INFINITE_MIN)&&o<0||!(r&fm.INFINITE_MAX)&&o>1)&&(ue(n,e,re(n,i,o)),!0)}function hIt(t){return t}function dIt(t){return Math.abs(t[2])<jo()}const z3=[0,0,1,0];var fm;(function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"})(fm||(fm={}));const I7e=fm.INFINITE_MIN|fm.INFINITE_MAX,L7e=fm.INFINITE_MAX,gz=K.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");let D7e=class{constructor(){this.plane=Ii(),this.origin=E(),this.basis1=E(),this.basis2=E()}};const Lbe=D7e;function By(t=Hbe){return{plane:Ii(t.plane),origin:Qr(t.origin),basis1:Qr(t.basis1),basis2:Qr(t.basis2)}}function N7e(t,e,i){const r=Y7e.get();return r.origin=t,r.basis1=e,r.basis2=i,r.plane=E7e(0,0,0,0),nU(r),r}function Wx(t,e=By()){return LJ(t.origin,t.basis1,t.basis2,e)}function F7e(t,e){oe(e.origin,t.origin),oe(e.basis1,t.basis1),oe(e.basis2,t.basis2),iU(e.plane,t.plane)}function LJ(t,e,i,r=By()){return oe(r.origin,t),oe(r.basis1,e),oe(r.basis2,i),nU(r),q7e(r,"fromValues()"),r}function nU(t){gP(t.basis2,t.basis1,t.origin,t.plane)}function Dbe(t,e,i){t!==i&&Wx(t,i);const r=re(Ne.get(),Cy(t),e);return ue(i.origin,i.origin,r),i.plane[3]-=e,i}function k7e(t,e,i){return Nbe(e,i),Dbe(i,kJ(t,t.origin),i),i}function Nbe(t,e=By()){const i=(t[2]-t[0])/2,r=(t[3]-t[1])/2;return ae(e.origin,t[0]+i,t[1]+r,0),ae(e.basis1,i,0,0),ae(e.basis2,0,r,0),$J(0,0,1,0,e.plane),e}function DJ(t,e,i){return!!qx(t.plane,e,i)&&Gbe(t,i)}function U7e(t,e,i){if(DJ(t,e,i))return i;const r=Fbe(t,e,Ne.get());return ue(i,e.origin,re(Ne.get(),e.direction,Mr(e.origin,r)/xe(e.direction))),i}function Fbe(t,e,i){const r=lF.get();jbe(t,e,r,lF.get());let n=Number.POSITIVE_INFINITY;for(const s of zJ){const o=UJ(t,s,sU.get()),a=Ne.get();if(O7e(r,o,a)){const l=Fy(Ne.get(),e.origin,a),c=Math.abs(Ys(ge(e.direction,l)));c<n&&(n=c,oe(i,a))}}return n===Number.POSITIVE_INFINITY?kbe(t,e,i):i}function kbe(t,e,i){if(DJ(t,e,i))return i;const r=lF.get(),n=lF.get();jbe(t,e,r,n);let s=Number.POSITIVE_INFINITY;for(const o of zJ){const a=UJ(t,o,sU.get()),l=Ne.get();if(R7e(r,a,l)){const c=n7e(e,l);if(!Ibe(n,l))continue;c<s&&(s=c,oe(i,l))}}return NJ(t,e.origin)<s&&Ube(t,e.origin,i),i}function Ube(t,e,i){const r=$7e(t.plane,e,Ne.get()),n=Kj(Rne(t,t.basis1),r,-1,1,Ne.get()),s=Kj(Rne(t,t.basis2),r,-1,1,Ne.get());return de(i,ue(Ne.get(),n,s),t.origin),i}function zbe(t,e,i){const{origin:r,basis1:n,basis2:s}=t,o=de(Ne.get(),e,r),a=nR(n,o),l=nR(s,o),c=nR(Cy(t),o);return ae(i,a,l,c)}function NJ(t,e){const i=zbe(t,e,Ne.get()),{basis1:r,basis2:n}=t,s=xe(r),o=xe(n),a=Math.max(Math.abs(i[0])-s,0),l=Math.max(Math.abs(i[1])-o,0),c=i[2];return a*a+l*l+c*c}function z7e(t,e){return Math.sqrt(NJ(t,e))}function B7e(t,e){let i=Number.NEGATIVE_INFINITY;for(const r of zJ){const n=UJ(t,r,sU.get()),s=PJ(n,e);s>i&&(i=s)}return Math.sqrt(i)}function FJ(t,e){return Ibe(t.plane,e)&&Gbe(t,e)}function V7e(t,e,i,r){return H7e(t,i,r)}function kJ(t,e){const i=-t.plane[3];return nR(Cy(t),e)-i}function G7e(t,e,i,r){const n=kJ(t,e),s=re(W7e,Cy(t),i-n);return ue(r,e,s),r}function Bbe(t,e){return oa(t.basis1,e.basis1)&&oa(t.basis2,e.basis2)&&oa(t.origin,e.origin)}function Vbe(t,e,i){return t!==i&&Wx(t,i),fs(pT,e),Hc(pT,pT),ke(i.basis1,t.basis1,pT),ke(i.basis2,t.basis2,pT),ke(i.plane,t.plane,pT),ke(i.origin,t.origin,e),tH(i.plane,i.plane,i.origin),i}function j7e(t,e,i,r){return t!==r&&Wx(t,r),Qu(yz,e,i),ke(r.basis1,t.basis1,yz),ke(r.basis2,t.basis2,yz),nU(r),r}function Cy(t){return t.plane}function H7e(t,e,i){switch(e){case an.X:oe(i,t.basis1),ye(i,i);break;case an.Y:oe(i,t.basis2),ye(i,i);break;case an.Z:oe(i,Cy(t))}return i}function Gbe(t,e){const i=de(Ne.get(),e,t.origin),r=na(t.basis1),n=na(t.basis2),s=ge(t.basis1,i),o=ge(t.basis2,i);return-s-r<0&&s-r<0&&-o-n<0&&o-n<0}function Rne(t,e){const i=sU.get();return oe(i.origin,t.origin),oe(i.vector,e),i}function UJ(t,e,i){const{basis1:r,basis2:n,origin:s}=t,o=re(Ne.get(),r,e.origin[0]),a=re(Ne.get(),n,e.origin[1]);ue(i.origin,o,a),ue(i.origin,i.origin,s);const l=re(Ne.get(),r,e.direction[0]),c=re(Ne.get(),n,e.direction[1]);return re(i.vector,ue(l,l,c),2),i}function q7e(t,e){Math.abs(ge(t.basis1,t.basis2)/(xe(t.basis1)*xe(t.basis2)))>1e-6&&gz.warn(e,"Provided basis vectors are not perpendicular"),Math.abs(ge(t.basis1,Cy(t)))>1e-6&&gz.warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-ge(Cy(t),t.origin)-t.plane[3])>1e-6&&gz.warn(e,"Plane offset is not consistent with plane origin")}function jbe(t,e,i,r){const n=Cy(t);gP(n,e.direction,e.origin,i),gP(i,n,e.origin,r)}const Hbe={plane:Ii(),origin:Oe(0,0,0),basis1:Oe(1,0,0),basis2:Oe(0,1,0)},lF=new zy(Ii),sU=new zy(Vp),W7e=E(),Y7e=new zy(()=>By()),zJ=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],pT=be(),yz=be(),X7e=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:Lbe,altitudeAt:kJ,axisAt:V7e,closestPoint:kbe,closestPointOnSilhouette:Fbe,copy:Wx,copyWithoutVerify:F7e,create:By,distance:z7e,distance2:NJ,distanceToSilhouette:B7e,elevate:Dbe,equals:Bbe,extrusionContainsPoint:FJ,fromAABoundingRect:Nbe,fromValues:LJ,intersectRay:DJ,intersectRayClosestSilhouette:U7e,normal:Cy,projectPoint:Ube,projectPointLocal:zbe,rotate:j7e,setAltitudeAt:G7e,setExtent:k7e,transform:Vbe,up:Hbe,updateUnboundedPlane:nU,wrap:N7e},Symbol.toStringTag,{value:"Module"})),Z7e=new ze(lye),Pne=new ze(m6),Mne=new ze(g6),fIt=new ze(cye);function LC(t){return t&&(km(t)||Fn(t,Pne))?Pne:t&&(Um(t)||Fn(t,Mne))?Mne:Z7e}function J7e(t){const{value:e,operations:i}=t;return{operations:i,value:i.create(e)}}function K7e(t,e,i){return t.operations.setExtent(t.value,e,i.value),i}function Q7e(t){return{operations:t,value:t.create()}}function qbe(t,e,i=Q7e(t)){return i.operations=t,t.copy(e,i.value),i}function eGe(t){return qbe(w7e,Cbe(0,0,0,Wi(t).radius))}const $ne=2**50;function tGe(){return qbe(X7e,LJ([0,0,0],[$ne,0,0],[0,$ne,0]))}function iGe(t,e,i){return t.operations.axisAt(t.value,e,an.Z,i)}function rGe(t,e,i,r){return t.operations.axisAt(t.value,e,i,r)}function nGe(t,e,i){return t.operations.intersectRay(t.value,e,i)}function sGe(t,e,i){return t.operations.intersectRayClosestSilhouette(t.value,e,i)}function oGe(t,e){return t.operations.altitudeAt(t.value,e)}function Wbe(t,e,i,r){return t.operations.setAltitudeAt(t.value,e,i,r)}function aGe(t,e,i,r){return e!==r&&Qn(r,e),ae(fT,r[12],r[13],r[14]),Wbe(t,fT,i,fT),r[12]=fT[0],r[13]=fT[1],r[14]=fT[2],r}function _z(t,e,i){return t.operations.elevate(t.value,e,i.value)}const fT=E();function Ine(t,e,i,r,n){return n[0]=ge(t,e),n[1]=ge(t,i),n[2]=ge(t,r),n}function nH(t,e,i,r,n){oe(i,t),oe(nI,e),ye(nI,nI),lt(r,nI,i),lt(n,r,i)}function lGe(t,e){return t?LC(e):e.isGeographic?ze.PlateCarree:e}const nI=E(),BJ=96;function mIt(t,e){const i=e||t.extent,r=t.width,n=Da(i?.spatialReference);return i&&r?i.width/r*n*lZ*BJ:0}function cGe(t,e){return t/(Da(e)*lZ*BJ)}function uGe(t){return t/(lZ*BJ)}function gIt(t,e,i){return hGe(t,e)&&dGe(t,i)}function hGe(t,e){return e===0||av(t,e)||t<e}function dGe(t,e){return e===0||av(t,e)||t>e}const pGe="OBJECTID";let YE=class extends rR{constructor(e){super(e),this.addHandles(this.on("before-add",i=>{i.item!=null&&i.item.parent===this.owner&&(K.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),i.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};YE=u([M("esri.support.AnalysesCollection")],YE);const FN={widthBreakpoint:{getValue(t){const e=t.viewSize[0],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,i=e[0],r=e[1],n=this.values;return r>=i?n.portrait:n.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},vz={xsmall:544,small:768,medium:992,large:1200};function fGe(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function bz(t,e){return e?FN[t].valueToClassName[e].split(" "):[]}const mGe=t=>{let e=class extends t{constructor(...i){super(...i),this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=vz}initialize(){this.addHandles(ne(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),Xt))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(i){if(i===this._get("breakpoints"))return;const r=fGe(i);if(!r){const n=JSON.stringify(vz,null,2);console.warn("provided breakpoints are not valid, using defaults:"+n)}i=r?i:vz,this._set("breakpoints",{...i})}_updateClassNames(){if(!this.container)return;const i=Mc.acquire(),r=Mc.acquire();let n,s=!1;for(n in FN){const o=this[n],a=FN[n].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(s=!0,this[n]=a,bz(n,o).forEach(l=>r.push(l)),bz(n,a).forEach(l=>i.push(l)))}s&&(this._applyClassNameChanges(i,r),Mc.release(i),Mc.release(r))}_applyClassNameChanges(i,r){const n=this.container;n&&(r.forEach(s=>n.classList.remove(s)),i.forEach(s=>n.classList.add(s)))}_removeActiveClassNames(){const i=this.container;if(!i)return;let r;for(r in FN)bz(r,this[r]).forEach(n=>i.classList.remove(n))}};return u([p()],e.prototype,"breakpoints",null),u([p()],e.prototype,"orientation",void 0),u([p()],e.prototype,"widthBreakpoint",void 0),u([p()],e.prototype,"heightBreakpoint",void 0),e=u([M("esri.views.BreakpointsOwner")],e),e};let Cp=class extends we{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(e,i,r={}){return this._installWatch(e,i,r,ne)}addWhen(e,i,r={}){return this._installWatch(e,i,r,gl)}addOnCollectionChange(e,i,{initial:r=!1,final:n=!1}={}){const s=++this._handleId;return this.addHandles([bo(e,"after-changes",this._createSyncUpdatingCallback(),Zi),bo(e,"change",i,{onListenerAdd:r?o=>i({added:o.toArray(),removed:[]}):void 0,onListenerRemove:n?o=>i({added:[],removed:o.toArray()}):void 0})],s),Vi(()=>this.removeHandles(s))}addPromise(e){if(e==null)return e;const i=++this._handleId;this.addHandles(Vi(()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this.hasHandles(sI)||this._set("updating",!1))}),i),this._pendingPromises.add(e),this._set("updating",!0);const r=()=>this.removeHandles(i);return e.then(r,r),e}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set("updating",!1)}_installWatch(e,i,r={},n){const s=++this._handleId;r.sync||this._installSyncUpdatingWatch(e,s);const o=n(e,i,r);return this.addHandles(o,s),Vi(()=>this.removeHandles(s))}_installSyncUpdatingWatch(e,i){const r=this._createSyncUpdatingCallback(),n=ne(e,r,{sync:!0,equals:()=>!1});return this.addHandles(n,i),n}_createSyncUpdatingCallback(){return()=>{this.removeHandles(sI),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this.addHandles(Ux(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this.removeHandles(sI))}),sI)}}};u([p({readOnly:!0})],Cp.prototype,"updating",void 0),Cp=u([M("esri.core.support.UpdatingHandles")],Cp);const sI=-42;/*!
 * @esri/arcgis-html-sanitizer - v3.0.1 - Tue Nov 15 2022 09:46:54 GMT-0800 (Pacific Standard Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei(雷宗民) <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 */var gGe=function(t){if(typeof t!="object"||t===null||Object.prototype.toString.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},uw={exports:{}},ys={},yP={exports:{}},Yx={};function Ybe(){var t={};return t["align-content"]=!1,t["align-items"]=!1,t["align-self"]=!1,t["alignment-adjust"]=!1,t["alignment-baseline"]=!1,t.all=!1,t["anchor-point"]=!1,t.animation=!1,t["animation-delay"]=!1,t["animation-direction"]=!1,t["animation-duration"]=!1,t["animation-fill-mode"]=!1,t["animation-iteration-count"]=!1,t["animation-name"]=!1,t["animation-play-state"]=!1,t["animation-timing-function"]=!1,t.azimuth=!1,t["backface-visibility"]=!1,t.background=!0,t["background-attachment"]=!0,t["background-clip"]=!0,t["background-color"]=!0,t["background-image"]=!0,t["background-origin"]=!0,t["background-position"]=!0,t["background-repeat"]=!0,t["background-size"]=!0,t["baseline-shift"]=!1,t.binding=!1,t.bleed=!1,t["bookmark-label"]=!1,t["bookmark-level"]=!1,t["bookmark-state"]=!1,t.border=!0,t["border-bottom"]=!0,t["border-bottom-color"]=!0,t["border-bottom-left-radius"]=!0,t["border-bottom-right-radius"]=!0,t["border-bottom-style"]=!0,t["border-bottom-width"]=!0,t["border-collapse"]=!0,t["border-color"]=!0,t["border-image"]=!0,t["border-image-outset"]=!0,t["border-image-repeat"]=!0,t["border-image-slice"]=!0,t["border-image-source"]=!0,t["border-image-width"]=!0,t["border-left"]=!0,t["border-left-color"]=!0,t["border-left-style"]=!0,t["border-left-width"]=!0,t["border-radius"]=!0,t["border-right"]=!0,t["border-right-color"]=!0,t["border-right-style"]=!0,t["border-right-width"]=!0,t["border-spacing"]=!0,t["border-style"]=!0,t["border-top"]=!0,t["border-top-color"]=!0,t["border-top-left-radius"]=!0,t["border-top-right-radius"]=!0,t["border-top-style"]=!0,t["border-top-width"]=!0,t["border-width"]=!0,t.bottom=!1,t["box-decoration-break"]=!0,t["box-shadow"]=!0,t["box-sizing"]=!0,t["box-snap"]=!0,t["box-suppress"]=!0,t["break-after"]=!0,t["break-before"]=!0,t["break-inside"]=!0,t["caption-side"]=!1,t.chains=!1,t.clear=!0,t.clip=!1,t["clip-path"]=!1,t["clip-rule"]=!1,t.color=!0,t["color-interpolation-filters"]=!0,t["column-count"]=!1,t["column-fill"]=!1,t["column-gap"]=!1,t["column-rule"]=!1,t["column-rule-color"]=!1,t["column-rule-style"]=!1,t["column-rule-width"]=!1,t["column-span"]=!1,t["column-width"]=!1,t.columns=!1,t.contain=!1,t.content=!1,t["counter-increment"]=!1,t["counter-reset"]=!1,t["counter-set"]=!1,t.crop=!1,t.cue=!1,t["cue-after"]=!1,t["cue-before"]=!1,t.cursor=!1,t.direction=!1,t.display=!0,t["display-inside"]=!0,t["display-list"]=!0,t["display-outside"]=!0,t["dominant-baseline"]=!1,t.elevation=!1,t["empty-cells"]=!1,t.filter=!1,t.flex=!1,t["flex-basis"]=!1,t["flex-direction"]=!1,t["flex-flow"]=!1,t["flex-grow"]=!1,t["flex-shrink"]=!1,t["flex-wrap"]=!1,t.float=!1,t["float-offset"]=!1,t["flood-color"]=!1,t["flood-opacity"]=!1,t["flow-from"]=!1,t["flow-into"]=!1,t.font=!0,t["font-family"]=!0,t["font-feature-settings"]=!0,t["font-kerning"]=!0,t["font-language-override"]=!0,t["font-size"]=!0,t["font-size-adjust"]=!0,t["font-stretch"]=!0,t["font-style"]=!0,t["font-synthesis"]=!0,t["font-variant"]=!0,t["font-variant-alternates"]=!0,t["font-variant-caps"]=!0,t["font-variant-east-asian"]=!0,t["font-variant-ligatures"]=!0,t["font-variant-numeric"]=!0,t["font-variant-position"]=!0,t["font-weight"]=!0,t.grid=!1,t["grid-area"]=!1,t["grid-auto-columns"]=!1,t["grid-auto-flow"]=!1,t["grid-auto-rows"]=!1,t["grid-column"]=!1,t["grid-column-end"]=!1,t["grid-column-start"]=!1,t["grid-row"]=!1,t["grid-row-end"]=!1,t["grid-row-start"]=!1,t["grid-template"]=!1,t["grid-template-areas"]=!1,t["grid-template-columns"]=!1,t["grid-template-rows"]=!1,t["hanging-punctuation"]=!1,t.height=!0,t.hyphens=!1,t.icon=!1,t["image-orientation"]=!1,t["image-resolution"]=!1,t["ime-mode"]=!1,t["initial-letters"]=!1,t["inline-box-align"]=!1,t["justify-content"]=!1,t["justify-items"]=!1,t["justify-self"]=!1,t.left=!1,t["letter-spacing"]=!0,t["lighting-color"]=!0,t["line-box-contain"]=!1,t["line-break"]=!1,t["line-grid"]=!1,t["line-height"]=!1,t["line-snap"]=!1,t["line-stacking"]=!1,t["line-stacking-ruby"]=!1,t["line-stacking-shift"]=!1,t["line-stacking-strategy"]=!1,t["list-style"]=!0,t["list-style-image"]=!0,t["list-style-position"]=!0,t["list-style-type"]=!0,t.margin=!0,t["margin-bottom"]=!0,t["margin-left"]=!0,t["margin-right"]=!0,t["margin-top"]=!0,t["marker-offset"]=!1,t["marker-side"]=!1,t.marks=!1,t.mask=!1,t["mask-box"]=!1,t["mask-box-outset"]=!1,t["mask-box-repeat"]=!1,t["mask-box-slice"]=!1,t["mask-box-source"]=!1,t["mask-box-width"]=!1,t["mask-clip"]=!1,t["mask-image"]=!1,t["mask-origin"]=!1,t["mask-position"]=!1,t["mask-repeat"]=!1,t["mask-size"]=!1,t["mask-source-type"]=!1,t["mask-type"]=!1,t["max-height"]=!0,t["max-lines"]=!1,t["max-width"]=!0,t["min-height"]=!0,t["min-width"]=!0,t["move-to"]=!1,t["nav-down"]=!1,t["nav-index"]=!1,t["nav-left"]=!1,t["nav-right"]=!1,t["nav-up"]=!1,t["object-fit"]=!1,t["object-position"]=!1,t.opacity=!1,t.order=!1,t.orphans=!1,t.outline=!1,t["outline-color"]=!1,t["outline-offset"]=!1,t["outline-style"]=!1,t["outline-width"]=!1,t.overflow=!1,t["overflow-wrap"]=!1,t["overflow-x"]=!1,t["overflow-y"]=!1,t.padding=!0,t["padding-bottom"]=!0,t["padding-left"]=!0,t["padding-right"]=!0,t["padding-top"]=!0,t.page=!1,t["page-break-after"]=!1,t["page-break-before"]=!1,t["page-break-inside"]=!1,t["page-policy"]=!1,t.pause=!1,t["pause-after"]=!1,t["pause-before"]=!1,t.perspective=!1,t["perspective-origin"]=!1,t.pitch=!1,t["pitch-range"]=!1,t["play-during"]=!1,t.position=!1,t["presentation-level"]=!1,t.quotes=!1,t["region-fragment"]=!1,t.resize=!1,t.rest=!1,t["rest-after"]=!1,t["rest-before"]=!1,t.richness=!1,t.right=!1,t.rotation=!1,t["rotation-point"]=!1,t["ruby-align"]=!1,t["ruby-merge"]=!1,t["ruby-position"]=!1,t["shape-image-threshold"]=!1,t["shape-outside"]=!1,t["shape-margin"]=!1,t.size=!1,t.speak=!1,t["speak-as"]=!1,t["speak-header"]=!1,t["speak-numeral"]=!1,t["speak-punctuation"]=!1,t["speech-rate"]=!1,t.stress=!1,t["string-set"]=!1,t["tab-size"]=!1,t["table-layout"]=!1,t["text-align"]=!0,t["text-align-last"]=!0,t["text-combine-upright"]=!0,t["text-decoration"]=!0,t["text-decoration-color"]=!0,t["text-decoration-line"]=!0,t["text-decoration-skip"]=!0,t["text-decoration-style"]=!0,t["text-emphasis"]=!0,t["text-emphasis-color"]=!0,t["text-emphasis-position"]=!0,t["text-emphasis-style"]=!0,t["text-height"]=!0,t["text-indent"]=!0,t["text-justify"]=!0,t["text-orientation"]=!0,t["text-overflow"]=!0,t["text-shadow"]=!0,t["text-space-collapse"]=!0,t["text-transform"]=!0,t["text-underline-position"]=!0,t["text-wrap"]=!0,t.top=!1,t.transform=!1,t["transform-origin"]=!1,t["transform-style"]=!1,t.transition=!1,t["transition-delay"]=!1,t["transition-duration"]=!1,t["transition-property"]=!1,t["transition-timing-function"]=!1,t["unicode-bidi"]=!1,t["vertical-align"]=!1,t.visibility=!1,t["voice-balance"]=!1,t["voice-duration"]=!1,t["voice-family"]=!1,t["voice-pitch"]=!1,t["voice-range"]=!1,t["voice-rate"]=!1,t["voice-stress"]=!1,t["voice-volume"]=!1,t.volume=!1,t["white-space"]=!1,t.widows=!1,t.width=!0,t["will-change"]=!1,t["word-break"]=!0,t["word-spacing"]=!0,t["word-wrap"]=!0,t["wrap-flow"]=!1,t["wrap-through"]=!1,t["writing-mode"]=!1,t["z-index"]=!1,t}function yGe(t,e,i){}function _Ge(t,e,i){}var vGe=/javascript\s*\:/img;function bGe(t,e){return vGe.test(e)?"":e}Yx.whiteList=Ybe();Yx.getDefaultWhiteList=Ybe;Yx.onAttr=yGe;Yx.onIgnoreAttr=_Ge;Yx.safeAttrValue=bGe;var wGe={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,n;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,n=t.length;r<n;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")}},cA=wGe;function xGe(t,e){t=cA.trimRight(t),t[t.length-1]!==";"&&(t+=";");var i=t.length,r=!1,n=0,s=0,o="";function a(){if(!r){var h=cA.trim(t.slice(n,s)),d=h.indexOf(":");if(d!==-1){var f=cA.trim(h.slice(0,d)),m=cA.trim(h.slice(d+1));if(f){var y=e(n,o.length,f,m,h);y&&(o+=y+"; ")}}}n=s+1}for(;s<i;s++){var l=t[s];if(l==="/"&&t[s+1]==="*"){var c=t.indexOf("*/",s+2);if(c===-1)break;s=c+1,n=s+1,r=!1}else l==="("?r=!0:l===")"?r=!1:l===";"?r||a():l===`
`&&a()}return cA.trim(o)}var TGe=xGe,oI=Yx,SGe=TGe;function Lne(t){return t==null}function EGe(t){var e={};for(var i in t)e[i]=t[i];return e}function Xbe(t){t=EGe(t||{}),t.whiteList=t.whiteList||oI.whiteList,t.onAttr=t.onAttr||oI.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||oI.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||oI.safeAttrValue,this.options=t}Xbe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,n=i.onAttr,s=i.onIgnoreAttr,o=i.safeAttrValue,a=SGe(t,function(l,c,h,d,f){var m=r[h],y=!1;if(m===!0?y=m:typeof m=="function"?y=m(d):m instanceof RegExp&&(y=m.test(d)),y!==!0&&(y=!1),d=o(h,d),!!d){var _={position:c,sourcePosition:l,source:f,isWhite:y};if(y){var v=n(h,d,_);return Lne(v)?h+":"+d:v}else{var v=s(h,d,_);if(!Lne(v))return v}}});return a};var CGe=Xbe;(function(t,e){var i=Yx,r=CGe;function n(o,a){var l=new r(a);return l.process(o)}e=t.exports=n,e.FilterCSS=r;for(var s in i)e[s]=i[s]})(yP,yP.exports);var VJ={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,n;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,n=t.length;r<n;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/,i=e.exec(t);return i?i.index:-1}},AGe=yP.exports.FilterCSS,OGe=yP.exports.getDefaultWhiteList,cF=VJ;function Zbe(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var Jbe=new AGe;function RGe(t,e,i){}function PGe(t,e,i){}function MGe(t,e,i){}function $Ge(t,e,i){}function Kbe(t){return t.replace(LGe,"&lt;").replace(DGe,"&gt;")}function IGe(t,e,i,r){if(i=nwe(i),e==="href"||e==="src"){if(i=cF.trim(i),i==="#")return"#";if(!(i.substr(0,7)==="http://"||i.substr(0,8)==="https://"||i.substr(0,7)==="mailto:"||i.substr(0,4)==="tel:"||i.substr(0,11)==="data:image/"||i.substr(0,6)==="ftp://"||i.substr(0,2)==="./"||i.substr(0,3)==="../"||i[0]==="#"||i[0]==="/"))return""}else if(e==="background"){if(aI.lastIndex=0,aI.test(i))return""}else if(e==="style"){if(Dne.lastIndex=0,Dne.test(i)||(Nne.lastIndex=0,Nne.test(i)&&(aI.lastIndex=0,aI.test(i))))return"";r!==!1&&(r=r||Jbe,i=r.process(i))}return i=swe(i),i}var LGe=/</g,DGe=/>/g,NGe=/"/g,FGe=/&quot;/g,kGe=/&#([a-zA-Z0-9]*);?/gim,UGe=/&colon;?/gim,zGe=/&newline;?/gim,aI=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,Dne=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,Nne=/u\s*r\s*l\s*\(.*/gi;function Qbe(t){return t.replace(NGe,"&quot;")}function ewe(t){return t.replace(FGe,'"')}function twe(t){return t.replace(kGe,function(i,r){return r[0]==="x"||r[0]==="X"?String.fromCharCode(parseInt(r.substr(1),16)):String.fromCharCode(parseInt(r,10))})}function iwe(t){return t.replace(UGe,":").replace(zGe," ")}function rwe(t){for(var e="",i=0,r=t.length;i<r;i++)e+=t.charCodeAt(i)<32?" ":t.charAt(i);return cF.trim(e)}function nwe(t){return t=ewe(t),t=twe(t),t=iwe(t),t=rwe(t),t}function swe(t){return t=Qbe(t),t=Kbe(t),t}function BGe(){return""}function VGe(t,e){typeof e!="function"&&(e=function(){});var i=!Array.isArray(t);function r(o){return i?!0:cF.indexOf(t,o)!==-1}var n=[],s=!1;return{onIgnoreTag:function(o,a,l){if(r(o))if(l.isClosing){var c="[/removed]",h=l.position+c.length;return n.push([s!==!1?s:l.position,h]),s=!1,c}else return s||(s=l.position),"[removed]";else return e(o,a,l)},remove:function(o){var a="",l=0;return cF.forEach(n,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function GGe(t){for(var e="",i=0;i<t.length;){var r=t.indexOf("<!--",i);if(r===-1){e+=t.slice(i);break}e+=t.slice(i,r);var n=t.indexOf("-->",r);if(n===-1)break;i=n+3}return e}function jGe(t){var e=t.split("");return e=e.filter(function(i){var r=i.charCodeAt(0);return r===127?!1:r<=31?r===10||r===13:!0}),e.join("")}ys.whiteList=Zbe();ys.getDefaultWhiteList=Zbe;ys.onTag=RGe;ys.onIgnoreTag=PGe;ys.onTagAttr=MGe;ys.onIgnoreTagAttr=$Ge;ys.safeAttrValue=IGe;ys.escapeHtml=Kbe;ys.escapeQuote=Qbe;ys.unescapeQuote=ewe;ys.escapeHtmlEntities=twe;ys.escapeDangerHtml5Entities=iwe;ys.clearNonPrintableCharacter=rwe;ys.friendlyAttrValue=nwe;ys.escapeAttrValue=swe;ys.onIgnoreTagStripAll=BGe;ys.StripTagBody=VGe;ys.stripCommentTag=GGe;ys.stripBlankChar=jGe;ys.cssFilter=Jbe;ys.getDefaultCSSWhiteList=OGe;var oU={},O_=VJ;function HGe(t){var e=O_.spaceIndex(t),i;return e===-1?i=t.slice(1,-1):i=t.slice(1,e+1),i=O_.trim(i).toLowerCase(),i.slice(0,1)==="/"&&(i=i.slice(1)),i.slice(-1)==="/"&&(i=i.slice(0,-1)),i}function qGe(t){return t.slice(0,2)==="</"}function WGe(t,e,i){var r="",n=0,s=!1,o=!1,a=0,l=t.length,c="",h="";e:for(a=0;a<l;a++){var d=t.charAt(a);if(s===!1){if(d==="<"){s=a;continue}}else if(o===!1){if(d==="<"){r+=i(t.slice(n,a)),s=a,n=a;continue}if(d===">"){r+=i(t.slice(n,s)),h=t.slice(s,a+1),c=HGe(h),r+=e(s,r.length,c,h,qGe(h)),n=a+1,s=!1;continue}if(d==='"'||d==="'")for(var f=1,m=t.charAt(a-f);m.trim()===""||m==="=";){if(m==="="){o=d;continue e}m=t.charAt(a-++f)}}else if(d===o){o=!1;continue}}return n<t.length&&(r+=i(t.substr(n))),r}var YGe=/[^a-zA-Z0-9\\_:.-]/gim;function XGe(t,e){var i=0,r=0,n=[],s=!1,o=t.length;function a(f,m){if(f=O_.trim(f),f=f.replace(YGe,"").toLowerCase(),!(f.length<1)){var y=e(f,m||"");y&&n.push(y)}}for(var l=0;l<o;l++){var c=t.charAt(l),h,d;if(s===!1&&c==="="){s=t.slice(i,l),i=l+1,r=t.charAt(i)==='"'||t.charAt(i)==="'"?i:JGe(t,l+1);continue}if(s!==!1&&l===r){if(d=t.indexOf(c,l+1),d===-1)break;h=O_.trim(t.slice(r+1,d)),a(s,h),s=!1,l=d,i=l+1;continue}if(/\s|\n|\t/.test(c))if(t=t.replace(/\s|\n|\t/g," "),s===!1)if(d=ZGe(t,l),d===-1){h=O_.trim(t.slice(i,l)),a(h),s=!1,i=l+1;continue}else{l=d-1;continue}else if(d=KGe(t,l-1),d===-1){h=O_.trim(t.slice(i,l)),h=Fne(h),a(s,h),s=!1,i=l+1;continue}else continue}return i<t.length&&(s===!1?a(t.slice(i)):a(s,Fne(O_.trim(t.slice(i))))),O_.trim(n.join(" "))}function ZGe(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="="?e:-1}}function JGe(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="'"||i==='"'?e:-1}}function KGe(t,e){for(;e>0;e--){var i=t[e];if(i!==" ")return i==="="?e:-1}}function QGe(t){return t[0]==='"'&&t[t.length-1]==='"'||t[0]==="'"&&t[t.length-1]==="'"}function Fne(t){return QGe(t)?t.substr(1,t.length-2):t}oU.parseTag=WGe;oU.parseAttr=XGe;var eje=yP.exports.FilterCSS,rp=ys,owe=oU,tje=owe.parseTag,ije=owe.parseAttr,kN=VJ;function lI(t){return t==null}function rje(t){var e=kN.spaceIndex(t);if(e===-1)return{html:"",closing:t[t.length-2]==="/"};t=kN.trim(t.slice(e+1,-1));var i=t[t.length-1]==="/";return i&&(t=kN.trim(t.slice(0,-1))),{html:t,closing:i}}function nje(t){var e={};for(var i in t)e[i]=t[i];return e}function sje(t){var e={};for(var i in t)Array.isArray(t[i])?e[i.toLowerCase()]=t[i].map(function(r){return r.toLowerCase()}):e[i.toLowerCase()]=t[i];return e}function awe(t){t=nje(t||{}),t.stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=rp.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=sje(t.whiteList||t.allowList):t.whiteList=rp.whiteList,t.onTag=t.onTag||rp.onTag,t.onTagAttr=t.onTagAttr||rp.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||rp.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||rp.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||rp.safeAttrValue,t.escapeHtml=t.escapeHtml||rp.escapeHtml,this.options=t,t.css===!1?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new eje(t.css))}awe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,n=i.onTag,s=i.onIgnoreTag,o=i.onTagAttr,a=i.onIgnoreTagAttr,l=i.safeAttrValue,c=i.escapeHtml,h=e.cssFilter;i.stripBlankChar&&(t=rp.stripBlankChar(t)),i.allowCommentTag||(t=rp.stripCommentTag(t));var d=!1;i.stripIgnoreTagBody&&(d=rp.StripTagBody(i.stripIgnoreTagBody,s),s=d.onIgnoreTag);var f=tje(t,function(m,y,_,v,w){var x={sourcePosition:m,position:y,isClosing:w,isWhite:Object.prototype.hasOwnProperty.call(r,_)},T=n(_,v,x);if(!lI(T))return T;if(x.isWhite){if(x.isClosing)return"</"+_+">";var S=rje(v),C=r[_],A=ije(S.html,function(R,D){var N=kN.indexOf(C,R)!==-1,k=o(_,R,D,N);return lI(k)?N?(D=l(_,R,D,h),D?R+'="'+D+'"':R):(k=a(_,R,D,N),lI(k)?void 0:k):k});return v="<"+_,A&&(v+=" "+A),S.closing&&(v+=" /"),v+=">",v}else return T=s(_,v,x),lI(T)?c(v):T},c);return d&&(f=d.remove(f)),f};var oje=awe;(function(t,e){var i=ys,r=oU,n=oje;function s(a,l){var c=new n(l);return c.process(a)}e=t.exports=s,e.filterXSS=s,e.FilterXSS=n,function(){for(var a in i)e[a]=i[a];for(var l in r)e[l]=r[l]}();function o(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=t.exports)})(uw,uw.exports);var aje=function(){function t(e,i){var r=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(s,o,a,l){return s==="a"&&o==="href"||(s==="img"||s==="source")&&o==="src"?r.sanitizeUrl(a):uw.exports.safeAttrValue(s,o,a,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var n;e&&!i?n=e:e&&i?(n=Object.create(this.arcgisFilterOptions),Object.keys(e).forEach(function(s){s==="whiteList"?n.whiteList=r._extendObjectOfArrays([r.arcgisWhiteList,e.whiteList||{}]):n[s]=e[s]})):(n=Object.create(this.arcgisFilterOptions),n.whiteList=this.arcgisWhiteList),this.xssFilterOptions=n,this._xssFilter=new uw.exports.FilterXSS(n)}return t.prototype.sanitize=function(e,i){switch(i===void 0&&(i={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,i);default:return i.allowUndefined&&typeof e>"u"?void 0:null}},t.prototype.sanitizeUrl=function(e,i){var r=(i??{}).isProtocolRequired,n=r===void 0?!0:r,s=this._trim(e.substring(0,e.indexOf(":"))),o=e==="/",a=/^#/.test(e),l=s&&this.allowedProtocols.indexOf(s.toLowerCase())>-1;return o||a||l?uw.exports.escapeAttrValue(e):!s&&!n?uw.exports.escapeAttrValue("https://".concat(e)):""},t.prototype.sanitizeHTMLAttribute=function(e,i,r,n){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(e,i,r,n):uw.exports.safeAttrValue(e,i,r,n)},t.prototype.validate=function(e,i){i===void 0&&(i={});var r=this.sanitize(e,i);return{isValid:e===r,sanitized:r}},t.prototype.encodeHTML=function(e){var i=this;return String(e).replace(/[&<>"'\/]/g,function(r){return i._entityMap[r]})},t.prototype.encodeAttrValue=function(e){var i=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,function(r,n){return i.test(r)?r:"&#x".concat(Number(e.charCodeAt(n)).toString(16),";")})},t.prototype._extendObjectOfArrays=function(e){var i={};return e.forEach(function(r){Object.keys(r).forEach(function(n){Array.isArray(r[n])&&Array.isArray(i[n])?i[n]=i[n].concat(r[n]):i[n]=r[n]})}),i},t.prototype._iterateOverObject=function(e,i){var r=this;i===void 0&&(i={});try{var n=!1,s=void 0;if(Array.isArray(e))s=e.reduce(function(a,l){var c=r.validate(l,i);return c.isValid?a.concat([l]):(n=!0,a.concat([c.sanitized]))},[]);else if(gGe(e)){var o=Object.keys(e);s=o.reduce(function(a,l){var c=e[l],h=r.validate(c,i);return h.isValid?a[l]=c:(n=!0,a[l]=h.sanitized),a},{})}else return i.allowUndefined&&typeof e>"u"?void 0:null;return n?s:e}catch{return null}},t.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},t}();const aU=new Map;function lwe(){aU.clear()}function lje(t){return aU.get(t)}function cje(t,e){aU.set(t,e)}function wz(t){aU.delete(t)}const uje=K.getLogger("esri.widgets.support.widgetUtils");function hje(t){const e=Mc.acquire();for(let r=0;r<arguments.length;r++){const n=arguments[r],s=typeof n;if(s==="string")e.push(n);else if(Array.isArray(n))e.push.apply(e,n);else if(s==="object")for(const o in n)n[o]&&e.push(o)}const i=e.join(" ");return Mc.release(e),i}(()=>{const t=new Map,e=new ResizeObserver(r=>{lwe();for(const n of r)t.get(n.target)?.(n)}),i=(r,n,s)=>(t.has(r)&&uje.error("Already observing element",r),t.set(r,n),e.observe(r,s),Vi(()=>{e.unobserve(r),t.delete(r)}));return(r,n,s)=>{let o=null;return yv([ne(()=>typeof r=="function"?r():r,a=>{o?.remove(),a&&(o=i(a,n,s))},Ji),Vi(()=>o?.remove())])}})();function dje(t){const e=t?.closest("[dir]");return e!==null&&e instanceof HTMLElement&&e.dir==="rtl"||document.dir==="rtl"}function vIt(t){const e="data-node-ref";this[t.getAttribute(e)]=null}function kne(t){const e="data-node-ref";this[t.getAttribute(e)]=t}const pje=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],fje=pje.reduce((t,e)=>(t[e]=[],t),{}),mje=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],cwe=new aje({whiteList:fje,onTagAttr:(t,e,i)=>{const r=`${e}="${i}"`;if(mje.includes(e))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function gje(t){return t==="Enter"||t===" "}const uwe="http://www.w3.org/",lU=`${uwe}2000/svg`,hwe=`${uwe}1999/xlink`;let Une=[],GJ=(t,e)=>{let i={};return Object.keys(t).forEach(r=>{i[r]=t[r]}),e&&Object.keys(e).forEach(r=>{i[r]=e[r]}),i},jJ=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),dwe=t=>{if(typeof t!="string")throw new Error("Style values must be strings")},yje=(t,e,i)=>{if(e.vnodeSelector!==""){for(let r=i;r<t.length;r++)if(jJ(t[r],e))return r}return-1},xz=(t,e,i,r)=>{let n=t[e];if(n.vnodeSelector==="")return;let s=n.properties;if(!(s&&(s.key===void 0?s.bind:s.key))){for(let o=0;o<t.length;o++)if(o!==e){let a=t[o];if(jJ(a,n))throw new Error(`${i.vnodeSelector} had a ${n.vnodeSelector} child ${r==="added"?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},_je=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},sH=[],oH=!1,pwe=t=>{(t.children||[]).forEach(pwe),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.apply(t.properties.bind||t.properties,[t.domNode])},zne=()=>{oH=!1,sH.forEach(pwe),sH.length=0},Bne=t=>{sH.push(t),oH||(oH=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(zne,{timeout:16}):setTimeout(zne,16))},Vne=t=>{let e=t.domNode;if(t.properties){let i=t.properties.exitAnimation;if(i)return e.style.pointerEvents="none",void i(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),Bne(t))},t.properties)}e.parentNode&&(e.parentNode.removeChild(e),Bne(t))},vje=(t,e,i)=>{if(!e)return;let r=i.eventHandlerInterceptor,n=Object.keys(e),s=n.length;for(let o=0;o<s;o++){let a=n[o],l=e[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")lH(t,l,!0);else if(a==="classes"){let c=Object.keys(l),h=c.length;for(let d=0;d<h;d++){let f=c[d];l[f]&&t.classList.add(f)}}else if(a==="styles"){let c=Object.keys(l),h=c.length;for(let d=0;d<h;d++){let f=c[d],m=l[f];m&&(dwe(m),i.styleApplyer(t,f,m))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(r&&(l=r(a,l,t,e)),a==="oninput"&&function(){let h=l;l=function(d){h.apply(this,[d]),d.target["oninput-value"]=d.target.value}}()),t[a]=l):i.namespace===lU?a==="href"?t.setAttributeNS(hwe,a,l):t.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?t[a]=cwe.sanitize(l):aH(t)&&a in t?t[a]=l:t.setAttribute(a,l):t[a]=l}}};function aH(t){if(!(t instanceof Element&&t.tagName.includes("-")))return!1;const e=window.customElements.get(t.tagName.toLowerCase());return!!e&&t instanceof e}let uF,bje=(t,e,i)=>{if(e)for(let r of e)A2(r,t,void 0,i)},fwe=(t,e,i)=>{bje(t,e.children,i),e.text&&(t.textContent=e.text),vje(t,e.properties,i),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[t,i,e.vnodeSelector,e.properties,e.children])},A2=(t,e,i,r)=>{let n,s=0,o=t.vnodeSelector,a=e.ownerDocument;if(o==="")n=t.domNode=a.createTextNode(t.text),i!==void 0?e.insertBefore(n,i):e.appendChild(n);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let h=o.charAt(s-1),d=o.slice(s,l);h==="."?n.classList.add(d):h==="#"?n.id=d:(d==="svg"&&(r=GJ(r,{namespace:lU})),r.namespace!==void 0?n=t.domNode=a.createElementNS(r.namespace,d):(n=t.domNode=t.domNode||a.createElement(d),d==="input"&&t.properties&&t.properties.type!==void 0&&n.setAttribute("type",t.properties.type)),i!==void 0?e.insertBefore(n,i):n.parentNode!==e&&e.appendChild(n)),s=l+1}}fwe(n,t,r)}},lH=(t,e,i)=>{e&&e.split(" ").forEach(r=>{r&&t.classList.toggle(r,i)})},wje=(t,e,i,r)=>{if(!i)return;let n=!1,s=Object.keys(i),o=s.length;for(let a=0;a<o;a++){let l=s[a],c=i[l],h=e[l];if(l==="class")h!==c&&(lH(t,h,!1),lH(t,c,!0));else if(l==="classes"){let d=t.classList,f=Object.keys(c),m=f.length;for(let y=0;y<m;y++){let _=f[y],v=!!c[_];v!==!!h[_]&&(n=!0,v?d.add(_):d.remove(_))}}else if(l==="styles"){let d=Object.keys(c),f=d.length;for(let m=0;m<f;m++){let y=d[m],_=c[y];_!==h[y]&&(n=!0,_?(dwe(_),r.styleApplyer(t,y,_)):r.styleApplyer(t,y,""))}}else if(c||typeof h!="string"||(c=""),l!=="value"||aH(t)){if(c!==h){let d=typeof c;d==="function"&&r.eventHandlerInterceptor||(r.namespace===lU?l==="href"?t.setAttributeNS(hwe,l,c):t.setAttribute(l,c):d==="string"?l==="innerHTML"?t[l]=cwe.sanitize(c):l==="role"&&c===""?t.removeAttribute(l):aH(t)&&l in t?t[l]=c:t.setAttribute(l,c):t[l]!==c&&(t[l]=c),n=!0)}}else{let d=t[l];d!==c&&(t["oninput-value"]?d===t["oninput-value"]:c!==h)&&(t[l]=c,t["oninput-value"]=void 0),c!==h&&(n=!0)}}return n},xje=(t,e,i,r,n)=>{if(i===r)return!1;r=r||Une;let s,o=(i=i||Une).length,a=r.length,l=0,c=0,h=!1;for(;c<a;){let d=l<o?i[l]:void 0,f=r[c];if(d!==void 0&&jJ(d,f))h=uF(d,f,n)||h,l++;else{let m=yje(i,f,l+1);if(m>=0){for(s=l;s<m;s++)Vne(i[s]),xz(i,s,t,"removed");h=uF(i[m],f,n)||h,l=m+1}else A2(f,e,l<o?i[l].domNode:void 0,n),_je(f),xz(r,c,t,"added")}c++}if(o>l)for(s=l;s<o;s++)Vne(i[s]),xz(i,s,t,"removed");return h};uF=(t,e,i)=>{let r=t.domNode,n=!1;if(t===e)return!1;let s=!1;if(e.vnodeSelector===""){if(e.text!==t.text){let o=r.ownerDocument.createTextNode(e.text);return r.parentNode.replaceChild(o,r),e.domNode=o,n=!0,n}e.domNode=r}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(i=GJ(i,{namespace:lU})),t.text!==e.text&&(s=!0,e.text===void 0?r.removeChild(r.firstChild):r.textContent=e.text),e.domNode=r,s=xje(e,r,t.children,e.children,i)||s,s=wje(r,t.properties,e.properties,i)||s,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[r,i,e.vnodeSelector,e.properties,e.children]);return s&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(r,e.properties,t.properties),n};let uA=(t,e)=>({getLastRender:()=>t,update:i=>{if(t.vnodeSelector!==i.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let r=t;t=i,uF(r,i,e)},domNode:t.domNode});const Tje={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{e.charAt(0)==="-"?t.style.setProperty(e,i):t.style[e]=i}};let US=t=>GJ(Tje,t),K_={create:(t,e)=>(e=US(e),A2(t,document.createElement("div"),void 0,e),uA(t,e)),append:(t,e,i)=>(i=US(i),A2(e,t,void 0,i),uA(e,i)),insertBefore:(t,e,i)=>(i=US(i),A2(e,t.parentNode,t,i),uA(e,i)),merge:(t,e,i)=>(i=US(i),e.domNode=t,fwe(t,e,i),uA(e,i)),replace:(t,e,i)=>(i=US(i),A2(e,t.parentNode,t,i),t.parentNode.removeChild(t),uA(e,i))},mwe,Sje=(t,e)=>{let i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i};mwe=Array.prototype.find?(t,e)=>t.find(e):(t,e)=>t.filter(e)[0];let Eje=(t,e)=>{let i=t;return e.forEach(r=>{i=i&&i.children?mwe(i.children,n=>n.domNode===r):void 0}),i},Cje=(t,e,i)=>{let r=function(n){i("domEvent",n);let s=e(),o=Sje(n.currentTarget,s.domNode);o.reverse();let a,l=Eje(s.getLastRender(),o);return t.scheduleRender(),l&&(a=l.properties[`on${n.type}`].apply(l.properties.bind||this,arguments)),i("domEventProcessed",n),a};return(n,s,o,a)=>r},Gne=t=>{let e,i,r=US(t),n=r.performanceLogger,s=!0,o=!1,a=[],l=[],c=(d,f,m)=>{let y,_=()=>y;r.eventHandlerInterceptor=Cje(e,_,n),y=d(f,m(),r),a.push(y),l.push(m)},h=()=>{if(i=void 0,s){s=!1,n("renderStart",void 0);for(let d=0;d<a.length;d++){let f=l[d]();n("rendered",void 0),a[d].update(f),n("patched",void 0)}n("renderDone",void 0),s=!0}};return e={renderNow:h,scheduleRender:()=>{i||o||(i=requestAnimationFrame(h))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),o=!0},resume:()=>{o=!1,s=!0,e.scheduleRender()},append:(d,f)=>{c(K_.append,d,f)},insertBefore:(d,f)=>{c(K_.insertBefore,d,f)},merge:(d,f)=>{c(K_.merge,d,f)},replace:(d,f)=>{c(K_.replace,d,f)},detach:d=>{for(let f=0;f<l.length;f++)if(l[f]===d)return l.splice(f,1),a.splice(f,1)[0];throw new Error("renderFunction was not found")}},e},o_=class extends we{constructor(){super(...arguments),this.items=new Je,this._watchUpdatingTracking=new Cp,this._callbacks=new Map,this._projector=Gne(),this._hiddenProjector=Gne()}get needsRender(){return this.items.length>0}get updating(){return this._watchUpdatingTracking?.updating??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,i=>{for(const r of i.added){const n=()=>r.render();this._callbacks.set(r,n),this._projector.append(this.surface,n)}for(const r of i.removed){const n=this._projector.detach(this._callbacks.get(r));this.surface.removeChild(n.domNode),this._callbacks.delete(r)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const i=this._hiddenSurface,r=this._hiddenProjector;let n;const s=()=>(n=e.render(),n);r.append(i,s),r.renderNow();const o={left:0,top:0,right:0,bottom:0};if(n?.domNode){const a=n.domNode.getBoundingClientRect();o.left=a.left,o.top=a.top,o.right=a.right,o.bottom=a.bottom}for(r.detach(s);i.firstChild;)i.removeChild(i.firstChild);return o}overlaps(e,i){const r=this.computeBoundingRect(e),n=this.computeBoundingRect(i);return Math.max(r.left,n.left)<=Math.min(r.right,n.right)&&Math.max(r.top,n.top)<=Math.min(r.bottom,n.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e,i){const r=!!i?.disableDecorations;if(!this.items.some(s=>s.visible&&!(r&&s.isDecoration)))return;const n=e.getContext("2d");n.save(),n.font=this._fontString(),this.items.forEach(s=>{r&&s.isDecoration||(n.save(),s.renderCanvas(n),n.restore())}),n.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};u([p({readOnly:!0})],o_.prototype,"surface",void 0),u([p({readOnly:!0})],o_.prototype,"items",void 0),u([p({readOnly:!0})],o_.prototype,"needsRender",null),u([p({readOnly:!0})],o_.prototype,"_watchUpdatingTracking",void 0),u([p({readOnly:!0})],o_.prototype,"updating",null),o_=u([M("esri.views.overlay.ViewOverlay")],o_);const jne=o_,Tz=[0,0];function Aje(t){const e=(t.ownerDocument||window.document).defaultView,i=t.getBoundingClientRect();return Tz[0]=i.left+(e?.pageXOffset??0),Tz[1]=i.top+(e?.pageYOffset??0),Tz}function Hne(t){t&&(X1e(t),t.parentNode&&t.parentNode.removeChild(t))}function Oje(t){const e=document.createElement("div");return t.appendChild(e),e}const hA=16,cI=750,Rje=512,Pje=2,Mje=t=>{let e=class extends t{constructor(...i){super(...i),this._freqInfo={freq:hA,time:cI},this._overlayRenderTaskHandle=null,this.height=0,this.messagesCommon=null,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([ne(()=>this.cursor,r=>{const{surface:n}=this;n&&n.setAttribute("data-cursor",r)}),ne(()=>this.navigating,r=>{const{surface:n}=this;n&&n.setAttribute("data-navigating",r.toString())})])}initialize(){const i=ie("mac"),r=async()=>{i&&(await Tv(()=>this.ready),this.messagesCommon=await pZ("esri/t9n/common").catch(()=>{}))};r(),this.addHandles([ne(()=>this.ui,(n,s)=>this._handleUIChange(n,s),Xt),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused")),uZ(r)])}destroy(){this.destroyed||(this.ui=$e(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(i){const r=this._get("container"),n=J6(i);if(n||typeof i!="string"||K.getLogger(this).error("#container",`element with id '${i}' not found`),r===n)return;if(this._stopMeasuring(),r&&(r.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(Hne(this.root),this._set("root",null)),this.userContent&&(fne(this.userContent,r),Hne(this.userContent),this._set("userContent",null))),!n)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);n.classList.add("esri-view");const s=document.createElement("div");s.className="esri-view-user-storage",fne(n,s),n.appendChild(s),this._set("userContent",s);const o=document.createElement("div");o.className="esri-view-root",n.insertBefore(o,n.firstChild),this._set("root",o);const a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);const l=new jne;o.appendChild(l.surface),this._set("overlay",l),this.addHandles(ne(()=>l.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=rx({render:()=>this.overlay?.render()}):this._overlayRenderTaskHandle=Tr(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",n),this._startMeasuring()}get focused(){const i=document.activeElement===this.surface;return document.hasFocus()&&i}get size(){return[this.width,this.height]}blur(){this.surface?.blur()}focus(){this.surface?.focus()}pageToContainer(i,r,n){const s=this.position;return i-=s?s[0]:0,r-=s?s[1]:0,n?(n[0]=i,n[1]=r):n=[i,r],n}containerToPage(i,r,n){const s=this.position;return i+=s?s[0]:0,r+=s?s[1]:0,n?(n[0]=i,n[1]=r):n=[i,r],n}_handleUIChange(i,r){this.removeHandles("ui"),r&&r!==i&&r.destroy(),i&&(i.view=this,this.addHandles(ne(()=>this.root,n=>{i.container=n?Oje(n):null},Xt),"ui")),this._set("ui",i)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const i=this._freqInfo;i.freq=hA,i.time=cI,this.addHandles([oy(window,"resize",()=>{i.freq=hA,i.time=cI}),rx({prepare:r=>{const n=this._measure(),s=this._freqInfo;if(s.time+=r.deltaTime,n&&(s.freq=hA,this._get("resizing")||this._set("resizing",!0)),s.time<s.freq)return;s.time=0;const o=this._position();s.freq=o||n?hA:Math.min(cI,s.freq*Pje),!n&&s.freq>=Rje&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const i=this.container,r=i?i.clientWidth:0,n=i?i.clientHeight:0;if(r===0||n===0)return this.suspended||this._set("suspended",!0),!1;const s=this.width,o=this.height;return r===s&&n===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",r),this._set("height",n),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:s,oldHeight:o,width:r,height:n}),!0)}_position(){const i=this.container,r=this.position,n=i&&Aje(i);return!!n&&(!r||n[0]!==r[0]||n[1]!==r[1])&&(this._set("position",[n[0],n[1]]),!0)}forceDOMReadyCycle(){}};return u([p()],e.prototype,"container",null),u([p({readOnly:!0})],e.prototype,"focused",null),u([p({readOnly:!0})],e.prototype,"height",void 0),u([p()],e.prototype,"messagesCommon",void 0),u([p({type:jne})],e.prototype,"overlay",void 0),u([p({readOnly:!0})],e.prototype,"position",void 0),u([p({readOnly:!0})],e.prototype,"resizing",void 0),u([p({readOnly:!0})],e.prototype,"root",void 0),u([p({value:null,readOnly:!0})],e.prototype,"size",null),u([p({readOnly:!0})],e.prototype,"surface",void 0),u([p({readOnly:!0})],e.prototype,"suspended",void 0),u([p()],e.prototype,"ui",void 0),u([p({readOnly:!0})],e.prototype,"userContent",void 0),u([p({readOnly:!0})],e.prototype,"width",void 0),u([p()],e.prototype,"widthBreakpoint",void 0),e=u([M("esri.views.DOMContainer")],e),e};function t1(t,e,i,r){return{x:t,y:e,z:i,hasZ:i!=null,hasM:!1,spatialReference:r,type:"point"}}async function hF(t,e,i,r,n){r??(r=0);const s=t.spatialReference;if($p(s,i)||s==null||i==null||Fn(s,i))return uI[0]=t.x,uI[1]=t.y,uI[2]=t.z??r,void rn(uI,t.spatialReference,0,e,i,0,1);const o=t1(t.x,t.y,t.z??r,s),a=await Am(o,i,n);e[0]=a.x,e[1]=a.y,e[2]=a.z??0}const uI=E();function Ay(t,e,i){if(e==null||i==null)return null;const r=new ut({spatialReference:i});return rn(t,e,0,hI,i,0,1)?(r.x=hI[0],r.y=hI[1],r.z=hI[2],r):null}const hI=E();async function gwe(t,e,i,r){const n=Ay(t,e,i);if(n!=null)return n;const s=new ut({x:t[0],y:t[1],z:t[2],spatialReference:e,hasZ:!0});return Am(s,i,r)}var Jr,Bo;(function(t){t[t.OBJECT=0]="OBJECT",t[t.HUD=1]="HUD",t[t.TERRAIN=2]="TERRAIN",t[t.OVERLAY=3]="OVERLAY",t[t.I3S=4]="I3S",t[t.PCL=5]="PCL",t[t.LOD=6]="LOD",t[t.VOXEL=7]="VOXEL"})(Jr||(Jr={}));let $je=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=Bo.ALL}};(function(t){t[t.MIN=0]="MIN",t[t.MINMAX=1]="MINMAX",t[t.ALL=2]="ALL"})(Bo||(Bo={}));let Ije=class{constructor(e,i,r){this.object=e,this.geometryId=i,this.triangleNr=r}},Lje=class extends Ije{constructor(e,i,r,n){super(e,i,r),this.center=n!=null?Qr(n):null}},ywe=class{constructor(e){this.layerUid=e}},cU=class extends ywe{constructor(e,i){super(e),this.graphicUid=i}};function Gp(t){return t?.dist!=null}function qne(t){return(e,i,r)=>(Xi(Wne,e,i,r),!FJ(t,Wne))}function uU(t){return Gp(t)&&t.intersector===Jr.OBJECT&&!!t.target}function hU(t){return Gp(t)&&t.intersector===Jr.HUD&&!!t.target&&"center"in t.target&&t.target.center!=null}const Wne=E();function rd(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function Dje(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function HJ(t,e,i,r,n,s,o,a,l,c){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=s,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t}function qJ(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function nd(t,e){if(t===e){const i=e[1],r=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function Xx(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=h*o-a*c,f=-h*s+a*l,m=c*s-o*l;let y=i*d+r*f+n*m;return y?(y=1/y,t[0]=d*y,t[1]=(-h*r+n*c)*y,t[2]=(a*r-n*o)*y,t[3]=f*y,t[4]=(h*i-n*l)*y,t[5]=(-a*i+n*s)*y,t[6]=m*y,t[7]=(-c*i+r*l)*y,t[8]=(o*i-r*s)*y,t):null}function Nje(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return t[0]=o*h-a*c,t[1]=n*c-r*h,t[2]=r*a-n*o,t[3]=a*l-s*h,t[4]=i*h-n*l,t[5]=n*s-i*a,t[6]=s*c-o*l,t[7]=r*l-i*c,t[8]=i*o-r*s,t}function Fje(t){const e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*s-o*l)+i*(-c*n+o*a)+r*(l*n-s*a)}function XE(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],f=i[0],m=i[1],y=i[2],_=i[3],v=i[4],w=i[5],x=i[6],T=i[7],S=i[8];return t[0]=f*r+m*o+y*c,t[1]=f*n+m*a+y*h,t[2]=f*s+m*l+y*d,t[3]=_*r+v*o+w*c,t[4]=_*n+v*a+w*h,t[5]=_*s+v*l+w*d,t[6]=x*r+T*o+S*c,t[7]=x*n+T*a+S*h,t[8]=x*s+T*l+S*d,t}function dF(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],f=i[0],m=i[1];return t[0]=r,t[1]=n,t[2]=s,t[3]=o,t[4]=a,t[5]=l,t[6]=f*r+m*o+c,t[7]=f*n+m*a+h,t[8]=f*s+m*l+d,t}function WJ(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],f=Math.sin(i),m=Math.cos(i);return t[0]=m*r+f*o,t[1]=m*n+f*a,t[2]=m*s+f*l,t[3]=m*o-f*r,t[4]=m*a-f*n,t[5]=m*l-f*s,t[6]=c,t[7]=h,t[8]=d,t}function YJ(t,e,i){const r=i[0],n=i[1],s=i[2];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=s*e[6],t[7]=s*e[7],t[8]=s*e[8],t}function kje(t,e,i){const r=i[0],n=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t}function Uje(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function zje(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Bje(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Vje(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function XJ(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=i+i,a=r+r,l=n+n,c=i*o,h=r*o,d=r*a,f=n*o,m=n*a,y=n*l,_=s*o,v=s*a,w=s*l;return t[0]=1-d-y,t[3]=h-w,t[6]=f+v,t[1]=h+w,t[4]=1-c-y,t[7]=m-_,t[2]=f-v,t[5]=m+_,t[8]=1-c-d,t}function _we(t,e){const i=e[0],r=e[1],n=e[2],s=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10],d=h*o-a*c,f=-h*s+a*l,m=c*s-o*l,y=i*d+r*f+n*m;if(!y)return null;const _=1/y;return t[0]=d*_,t[1]=(-h*r+n*c)*_,t[2]=(a*r-n*o)*_,t[3]=f*_,t[4]=(h*i-n*l)*_,t[5]=(-a*i+n*s)*_,t[6]=m*_,t[7]=(-c*i+r*l)*_,t[8]=(o*i-r*s)*_,t}function Oy(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=e[9],f=e[10],m=e[11],y=e[12],_=e[13],v=e[14],w=e[15],x=i*a-r*o,T=i*l-n*o,S=i*c-s*o,C=r*l-n*a,A=r*c-s*a,R=n*c-s*l,D=h*_-d*y,N=h*v-f*y,k=h*w-m*y,B=d*v-f*_,L=d*w-m*_,z=f*w-m*v;let j=x*z-T*L+S*B+C*k-A*N+R*D;return j?(j=1/j,t[0]=(a*z-l*L+c*B)*j,t[1]=(l*k-o*z-c*N)*j,t[2]=(o*L-a*k+c*D)*j,t[3]=(n*L-r*z-s*B)*j,t[4]=(i*z-n*k+s*N)*j,t[5]=(r*k-i*L-s*D)*j,t[6]=(_*R-v*A+w*C)*j,t[7]=(v*S-y*R-w*T)*j,t[8]=(y*A-_*S+w*x)*j,t):null}function Gje(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function jje(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function Hje(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2)}function qje(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t}function vwe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}function Wje(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t}function Yje(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t}function Xje(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function Zje(t,e){const i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],d=e[0],f=e[1],m=e[2],y=e[3],_=e[4],v=e[5],w=e[6],x=e[7],T=e[8],S=jo();return Math.abs(i-d)<=S*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(r-f)<=S*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(n-m)<=S*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(s-y)<=S*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(o-_)<=S*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(a-v)<=S*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(l-w)<=S*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(c-x)<=S*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(h-T)<=S*Math.max(1,Math.abs(h),Math.abs(T))}function ZJ(t){const e=jo(),i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8];return Math.abs(1-(i*i+s*s+l*l))<=e&&Math.abs(1-(r*r+o*o+c*c))<=e&&Math.abs(1-(n*n+a*a+h*h))<=e}const Jje=XE,Kje=vwe;Object.freeze(Object.defineProperty({__proto__:null,add:qje,adjoint:Nje,copy:Dje,determinant:Fje,equals:Zje,exactEquals:Xje,frob:Hje,fromMat2d:Vje,fromMat4:rd,fromQuat:XJ,fromRotation:zje,fromScaling:Bje,fromTranslation:Uje,identity:qJ,invert:Xx,isOrthoNormal:ZJ,mul:Jje,multiply:XE,multiplyScalar:Wje,multiplyScalarAndAdd:Yje,normalFromMat4:Oy,normalFromMat4Legacy:_we,projection:Gje,rotate:WJ,scale:YJ,scaleByVec2:kje,set:HJ,str:jje,sub:Kje,subtract:vwe,translate:dF,transpose:nd},Symbol.toStringTag,{value:"Module"}));function Qje(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function _P(t,e,i){i*=.5;const r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t}function JJ(t,e){const i=2*Math.acos(e[3]),r=Math.sin(i/2);return r>jo()?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),i}function KJ(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=i[0],l=i[1],c=i[2],h=i[3];return t[0]=r*h+o*a+n*c-s*l,t[1]=n*h+o*l+s*a-r*c,t[2]=s*h+o*c+r*l-n*a,t[3]=o*h-r*a-n*l-s*c,t}function eHe(t,e,i){i*=.5;const r=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+o*a,t[1]=n*l+s*a,t[2]=s*l-n*a,t[3]=o*l-r*a,t}function tHe(t,e,i){i*=.5;const r=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l-s*a,t[1]=n*l+o*a,t[2]=s*l+r*a,t[3]=o*l-n*a,t}function iHe(t,e,i){i*=.5;const r=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+n*a,t[1]=n*l-r*a,t[2]=s*l+o*a,t[3]=o*l-s*a,t}function rHe(t,e){const i=e[0],r=e[1],n=e[2];return t[0]=i,t[1]=r,t[2]=n,t[3]=Math.sqrt(Math.abs(1-i*i-r*r-n*n)),t}function UN(t,e,i,r){const n=e[0],s=e[1],o=e[2],a=e[3];let l,c,h,d,f,m=i[0],y=i[1],_=i[2],v=i[3];return c=n*m+s*y+o*_+a*v,c<0&&(c=-c,m=-m,y=-y,_=-_,v=-v),1-c>jo()?(l=Math.acos(c),h=Math.sin(l),d=Math.sin((1-r)*l)/h,f=Math.sin(r*l)/h):(d=1-r,f=r),t[0]=d*n+f*m,t[1]=d*s+f*y,t[2]=d*o+f*_,t[3]=d*a+f*v,t}function nHe(t){const e=pM,i=e(),r=e(),n=e(),s=Math.sqrt(1-i),o=Math.sqrt(i);return t[0]=s*Math.sin(2*Math.PI*r),t[1]=s*Math.cos(2*Math.PI*r),t[2]=o*Math.sin(2*Math.PI*n),t[3]=o*Math.cos(2*Math.PI*n),t}function sHe(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=i*i+r*r+n*n+s*s,a=o?1/o:0;return t[0]=-i*a,t[1]=-r*a,t[2]=-n*a,t[3]=s*a,t}function bx(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function bwe(t,e){const i=e[0]+e[4]+e[8];let r;if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{let n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);const s=(n+1)%3,o=(n+2)%3;r=Math.sqrt(e[3*n+n]-e[3*s+s]-e[3*o+o]+1),t[n]=.5*r,r=.5/r,t[3]=(e[3*s+o]-e[3*o+s])*r,t[s]=(e[3*s+n]+e[3*n+s])*r,t[o]=(e[3*o+n]+e[3*n+o])*r}return t}function oHe(t,e,i,r){const n=.5*Math.PI/180;e*=n,i*=n,r*=n;const s=Math.sin(e),o=Math.cos(e),a=Math.sin(i),l=Math.cos(i),c=Math.sin(r),h=Math.cos(r);return t[0]=s*l*h-o*a*c,t[1]=o*a*h+s*l*c,t[2]=o*l*c-s*a*h,t[3]=o*l*h+s*a*c,t}function aHe(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const QJ=mp,lHe=Gr,cHe=_Z,uHe=KJ,hHe=dx,dHe=Bye,pHe=T6,wwe=vZ,fHe=wwe,xwe=bZ,mHe=xwe,eK=zye,gHe=W2,yHe=px;function _He(t,e,i){const r=ge(e,i);return r<-.999999?(lt(Kp,vHe,e),Cc(Kp)<1e-6&&lt(Kp,bHe,e),ye(Kp,Kp),_P(t,Kp,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(lt(Kp,e,i),t[0]=Kp[0],t[1]=Kp[1],t[2]=Kp[2],t[3]=1+r,eK(t,t))}const Kp=E(),vHe=Oe(1,0,0),bHe=Oe(0,1,0);function wHe(t,e,i,r,n,s){return UN(Yne,e,n,s),UN(Xne,i,r,s),UN(t,Yne,Xne,2*s*(1-s)),t}const Yne=hd(),Xne=hd();function xHe(t,e,i,r){const n=THe;return n[0]=i[0],n[3]=i[1],n[6]=i[2],n[1]=r[0],n[4]=r[1],n[7]=r[2],n[2]=-e[0],n[5]=-e[1],n[8]=-e[2],eK(t,bwe(t,n))}const THe=nn();Object.freeze(Object.defineProperty({__proto__:null,add:cHe,calculateW:rHe,conjugate:bx,copy:QJ,dot:dHe,equals:yHe,exactEquals:gHe,fromEuler:oHe,fromMat3:bwe,getAxisAngle:JJ,identity:Qje,invert:sHe,len:fHe,length:wwe,lerp:pHe,mul:uHe,multiply:KJ,normalize:eK,random:nHe,rotateX:eHe,rotateY:tHe,rotateZ:iHe,rotationTo:_He,scale:hHe,set:lHe,setAxes:xHe,setAxisAngle:_P,slerp:UN,sqlerp:wHe,sqrLen:mHe,squaredLength:xwe,str:aHe},Symbol.toStringTag,{value:"Module"}));let LM=class{constructor(e,i,r=i){this.data=e,this.size=i,this.stride=r}},Ve=class extends LM{constructor(e,i,r,n=!1,s=r){super(e,r,s),this.indices=i,this.exclusive=n}};const ZE=1e-6,dA=[0,0,0],dI=[0,0,0];function SHe(t,e){const{data:i,size:r}=t,n=i.length/r;if(n<=0)return;const s=new IHe(t);zN(dA,s.minProj,s.maxProj),hw(dA,dA,.5),kh(dI,s.maxProj,s.minProj);const o=cH(dI),a=new LHe;a.quality=o,n<14&&(t=new LM(new Float64Array(s.buffer,112,42),3));const l=[0,0,0],c=[0,0,0],h=[0,0,0],d=[0,0,0],f=[0,0,0],m=[0,0,0],y=[0,0,0];switch(EHe(s,t,y,l,c,h,d,f,m,a)){case 1:return void Qne(dA,dI,e);case 2:return void $He(t,d,e)}CHe(t,y,l,c,h,d,f,m,a),Twe(t,a.b0,a.b1,a.b2,J2,K2);const _=[0,0,0];kh(_,K2,J2),a.quality=cH(_),a.quality<o?Swe(a.b0,a.b1,a.b2,J2,K2,_,e):Qne(dA,dI,e)}function EHe(t,e,i,r,n,s,o,a,l,c){return AHe(t,r,n),uH(r,n)<ZE?1:(kh(o,r,n),ea(o,o),OHe(e,r,o,s)<ZE?2:(kh(a,n,s),ea(a,a),kh(l,s,r),ea(l,l),Uh(i,a,o),ea(i,i),Cb(e,i,o,a,l,c),0))}const pA=[0,0,0],fA=[0,0,0],ah=[0,0,0],lh=[0,0,0],ch=[0,0,0],m0=[0,0,0],g0=[0,0,0],y0=[0,0,0];function CHe(t,e,i,r,n,s,o,a,l){RHe(t,e,i,pA,fA),pA[0]!==void 0&&(kh(ah,pA,i),ea(ah,ah),kh(lh,pA,r),ea(lh,lh),kh(ch,pA,n),ea(ch,ch),Uh(m0,lh,s),ea(m0,m0),Uh(g0,ch,o),ea(g0,g0),Uh(y0,ah,a),ea(y0,y0),Cb(t,m0,s,lh,ah,l),Cb(t,g0,o,ch,lh,l),Cb(t,y0,a,ah,ch,l)),fA[0]!==void 0&&(kh(ah,fA,i),ea(ah,ah),kh(lh,fA,r),ea(lh,lh),kh(ch,fA,n),ea(ch,ch),Uh(m0,lh,s),ea(m0,m0),Uh(g0,ch,o),ea(g0,g0),Uh(y0,ah,a),ea(y0,y0),Cb(t,m0,s,lh,ah,l),Cb(t,g0,o,ch,lh,l),Cb(t,y0,a,ah,ch,l))}function AHe(t,e,i){let r=uH(t.maxVert[0],t.minVert[0]),n=0;for(let s=1;s<7;++s){const o=uH(t.maxVert[s],t.minVert[s]);o>r&&(r=o,n=s)}kc(e,t.minVert[n]),kc(i,t.maxVert[n])}const uh=[0,0,0];function OHe(t,e,i,r){const{data:n,size:s}=t;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<n.length;l+=s){uh[0]=n[l]-e[0],uh[1]=n[l+1]-e[1],uh[2]=n[l+2]-e[2];const c=i[0]*uh[0]+i[1]*uh[1]+i[2]*uh[2],h=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],d=uh[0]*uh[0]+uh[1]*uh[1]+uh[2]*uh[2]-c*c/h;d>o&&(o=d,a=l)}return kc(r,n,a),o}const Vs=[0,0];function RHe(t,e,i,r,n){MHe(t,e,Vs,n,r);const s=Cwe(i,e);Vs[1]-ZE<=s&&(r[0]=void 0),Vs[0]+ZE>=s&&(n[0]=void 0)}const Zne=[0,0,0],Jne=[0,0,0],Kne=[0,0,0],mT=[0,0,0],gT=[0,0,0],pI=[0,0,0];function Cb(t,e,i,r,n,s){if(Ewe(e)<ZE)return;Uh(Zne,i,e),Uh(Jne,r,e),Uh(Kne,n,e),Z2(t,e,Vs),gT[1]=Vs[0],mT[1]=Vs[1],pI[1]=mT[1]-gT[1];const o=[i,r,n],a=[Zne,Jne,Kne];for(let l=0;l<3;++l){Z2(t,o[l],Vs),gT[0]=Vs[0],mT[0]=Vs[1],Z2(t,a[l],Vs),gT[2]=Vs[0],mT[2]=Vs[1],pI[0]=mT[0]-gT[0],pI[2]=mT[2]-gT[2];const c=cH(pI);c<s.quality&&(kc(s.b0,o[l]),kc(s.b1,e),kc(s.b2,a[l]),s.quality=c)}}const PHe=[0,0,0];function Z2(t,e,i){const{data:r,size:n}=t;i[0]=Number.POSITIVE_INFINITY,i[1]=Number.NEGATIVE_INFINITY;for(let s=0;s<r.length;s+=n){const o=r[s]*e[0]+r[s+1]*e[1]+r[s+2]*e[2];i[0]=Math.min(i[0],o),i[1]=Math.max(i[1],o)}}function MHe(t,e,i,r,n){const{data:s,size:o}=t;kc(r,s),kc(n,r),i[0]=Cwe(PHe,e),i[1]=i[0];for(let a=o;a<s.length;a+=o){const l=s[a]*e[0]+s[a+1]*e[1]+s[a+2]*e[2];l<i[0]&&(i[0]=l,kc(r,s,a)),l>i[1]&&(i[1]=l,kc(n,s,a))}}function Qne(t,e,i){kc(i.center,t),hw(i.halfSize,e,.5),i.quaternion[0]=0,i.quaternion[1]=0,i.quaternion[2]=0,i.quaternion[3]=1}const Qm=[0,0,0],yT=[0,0,0],mA=[0,0,0],J2=[0,0,0],K2=[0,0,0],ese=[0,0,0];function $He(t,e,i){kc(Qm,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?Qm[0]=0:Math.abs(e[1])>Math.abs(e[2])?Qm[1]=0:Qm[2]=0,Ewe(Qm)<ZE&&(Qm[0]=Qm[1]=Qm[2]=1),Uh(yT,e,Qm),ea(yT,yT),Uh(mA,e,yT),ea(mA,mA),Twe(t,e,yT,mA,J2,K2),kh(ese,K2,J2),Swe(e,yT,mA,J2,K2,ese,i)}function Twe(t,e,i,r,n,s){Z2(t,e,Vs),n[0]=Vs[0],s[0]=Vs[1],Z2(t,i,Vs),n[1]=Vs[0],s[1]=Vs[1],Z2(t,r,Vs),n[2]=Vs[0],s[2]=Vs[1]}const fI=[0,0,0],Qp=[1,0,0,0,1,0,0,0,1],_T=[0,0,0];function Swe(t,e,i,r,n,s,o){Qp[0]=t[0],Qp[1]=t[1],Qp[2]=t[2],Qp[3]=e[0],Qp[4]=e[1],Qp[5]=e[2],Qp[6]=i[0],Qp[7]=i[1],Qp[8]=i[2],DHe(o.quaternion,Qp),zN(_T,r,n),hw(_T,_T,.5),hw(o.center,t,_T[0]),hw(fI,e,_T[1]),zN(o.center,o.center,fI),hw(fI,i,_T[2]),zN(o.center,o.center,fI),hw(o.halfSize,s,.5)}const Qc=7;let IHe=class{constructor(e){this.minVert=new Array(Qc),this.maxVert=new Array(Qc);const i=64*Qc;this.buffer=new ArrayBuffer(i);let r=0;this.minProj=new Float64Array(this.buffer,r,Qc),r+=8*Qc,this.maxProj=new Float64Array(this.buffer,r,Qc),r+=8*Qc;for(let l=0;l<Qc;++l)this.minVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<Qc;++l)this.maxVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<Qc;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const n=new Array(Qc),s=new Array(Qc),{data:o,size:a}=e;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,n[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,s[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,n[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,s[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,n[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,s[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,n[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,s[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,n[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,s[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,n[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,s[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,n[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,s[6]=l)}for(let l=0;l<Qc;++l){let c=n[l];kc(this.minVert[l],o,c),c=s[l],kc(this.maxVert[l],o,c)}}},LHe=class{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}};function cH(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function zN(t,e,i){t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2]}function kh(t,e,i){t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2]}function hw(t,e,i){t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}function kc(t,e,i=0){t[0]=e[i],t[1]=e[i+1],t[2]=e[i+2]}function Uh(t,e,i){const r=e[0],n=e[1],s=e[2],o=i[0],a=i[1],l=i[2];t[0]=n*l-s*a,t[1]=s*o-r*l,t[2]=r*a-n*o}function ea(t,e){const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(i>0){const r=1/Math.sqrt(i);t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}}function Ewe(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function uH(t,e){const i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return i*i+r*r+n*n}function Cwe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function DHe(t,e){const i=e[0]+e[4]+e[8];if(i>0){let r=Math.sqrt(i+1);t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r}else{let r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);const n=(r+1)%3,s=(r+2)%3;let o=Math.sqrt(e[3*r+r]-e[3*n+n]-e[3*s+s]+1);t[r]=.5*o,o=.5/o,t[3]=(e[3*n+s]-e[3*s+n])*o,t[n]=(e[3*n+r]+e[3*r+n])*o,t[s]=(e[3*s+r]+e[3*r+s])*o}}const Hw=hd(),nl=E(),hH=E(),NHe=nn();function tK(t=[0,0,0],e=[-1,-1,-1],i=hd()){return{center:Qr(t),halfSize:Qr(e),quaternion:rbe(i)}}function tse(t){return tK(t.center,t.halfSize,t.quaternion)}function PIt(t,e){oe(e.center,t.center),oe(e.halfSize,t.halfSize),QJ(e.quaternion,t.quaternion)}function MIt(t,e){return e=e||tK(),SHe(t,e),e}function Ab(t,e){const i=hr(e,t.center),r=dU(t,e);return i>r?1:i<-r?-1:0}function $It(t,e){return nl[0]=t.center[0]-e[0],nl[1]=t.center[1]-e[1],nl[2]=t.center[2]-e[2],bx(Hw,t.quaternion),pm(nl,nl,Hw),OE(nl,nl),w6(hH,nl,t.halfSize),x6(hH,nl)<e[3]*e[3]}function IIt(t,e){e||(e=ks());const i=XJ(NHe,t.quaternion),r=t.halfSize[0]*Math.abs(i[0])+t.halfSize[1]*Math.abs(i[3])+t.halfSize[2]*Math.abs(i[6]),n=t.halfSize[0]*Math.abs(i[1])+t.halfSize[1]*Math.abs(i[4])+t.halfSize[2]*Math.abs(i[7]),s=t.halfSize[0]*Math.abs(i[2])+t.halfSize[1]*Math.abs(i[5])+t.halfSize[2]*Math.abs(i[8]);return e[0]=t.center[0]-r,e[1]=t.center[1]-n,e[2]=t.center[2]-s,e[3]=t.center[0]+r,e[4]=t.center[1]+n,e[5]=t.center[2]+s,e}function LIt(t,e){return hr(e,t.center)-dU(t,e)}function DIt(t,e){return hr(e,t.center)+dU(t,e)}function NIt(t,e){return Ab(t,e[0])<=0&&Ab(t,e[1])<=0&&Ab(t,e[2])<=0&&Ab(t,e[3])<=0&&Ab(t,e[4])<=0&&Ab(t,e[5])<=0}function FIt(t,e,i,r=0){bx(Hw,t.quaternion),de(nl,e,t.center);const n=pm(nl,nl,Hw),s=pm(hH,i,Hw);let o=-1/0,a=1/0;for(let l=0;l<3;l++)if(Math.abs(s[l])>1e-6){const c=(r+t.halfSize[l]-n[l])/s[l],h=(-r-t.halfSize[l]-n[l])/s[l];o=Math.max(o,Math.min(c,h)),a=Math.min(a,Math.max(c,h))}else if(n[l]>t.halfSize[l]+r||n[l]<-t.halfSize[l]-r)return!1;return o<=a}(()=>{const t=new Int8Array(162);let e=0;const i=r=>{for(let n=0;n<r.length;n++)t[e+n]=r[n];e+=6};return i([6,2,3,1,5,4]),i([0,2,3,1,5,4]),i([0,2,3,7,5,4]),i([0,1,3,2,6,4]),i([0,1,3,2,0,0]),i([0,1,5,7,3,2]),i([0,1,3,7,6,4]),i([0,1,3,7,6,2]),i([0,1,5,7,6,2]),i([0,1,5,4,6,2]),i([0,1,5,4,0,0]),i([0,1,3,7,5,4]),i([0,2,6,4,0,0]),i([0,0,0,0,0,0]),i([1,3,7,5,0,0]),i([2,3,7,6,4,0]),i([2,3,7,6,0,0]),i([2,3,1,5,7,6]),i([0,1,5,7,6,2]),i([0,1,5,7,6,4]),i([0,1,3,7,6,4]),i([4,5,7,6,2,0]),i([4,5,7,6,0,0]),i([4,5,1,3,7,6]),i([0,2,3,7,5,4]),i([6,2,3,7,5,4]),i([6,2,3,1,5,4]),t})();function dU(t,e){bx(Hw,t.quaternion),pm(nl,e,Hw);const i=t.halfSize;return Math.abs(nl[0]*i[0])+Math.abs(nl[1]*i[1])+Math.abs(nl[2]*i[2])}function kIt(t,e){for(let i=0;i<8;++i){const r=e[i];r[0]=1&i?-t.halfSize[0]:t.halfSize[0],r[1]=2&i?-t.halfSize[1]:t.halfSize[1],r[2]=4&i?-t.halfSize[2]:t.halfSize[2],pm(r,r,t.quaternion),ue(r,r,t.center)}}function FHe(t){return Cc(t.halfSize)}function Awe(t,e,i,r,n){if(QJ(n.quaternion,t.quaternion),r===Le.Global){bx(mI,t.quaternion),pm(_0,t.center,mI),OE(vT,_0),w6(bT,vT,t.halfSize),go(bT,vT,bT);const s=xe(bT);ue(bT,vT,t.halfSize);const o=xe(bT);if(s<i)oe(n.center,t.center),ae(_0,i,i,i),ue(n.halfSize,t.halfSize,_0);else{const a=o>0?1+e/o:1,l=s>0?1+i/s:1,c=(l+a)/2,h=(l-a)/2;re(n.halfSize,vT,h),ql(n.halfSize,n.halfSize,t.halfSize,c),re(n.center,vT,c),ql(n.center,n.center,t.halfSize,h),N5(_0,_0),b6(n.center,n.center,_0),pm(n.center,n.center,n.quaternion)}}else{const s=ae(_0,0,0,1);ql(n.center,t.center,s,(i+e)/2),bx(mI,t.quaternion),pm(s,s,mI),OE(s,s),ql(n.halfSize,t.halfSize,s,(i-e)/2)}return n}const _0=E(),vT=E(),bT=E(),mI=hd();let kHe=class{constructor(){this._transform=be(),this._transformInverse=new gI({value:this._transform},fs,be),this._transformInverseTranspose=new gI(this._transformInverse,Hc,be),this._transformTranspose=new gI({value:this._transform},Hc,be),this._transformInverseRotation=new gI({value:this._transform},_we,nn)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){Qn(this._transform,e)}multiplyTransform(e){qi(this._transform,this._transform,e)}set(e){Qn(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,i){this.setTransformMatrix(e),this.multiplyTransform(i),this._invalidateLazyTransforms()}},gI=class{constructor(e,i,r){this._original=e,this._update=i,this._dirty=!0,this._transform=r()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},UHe=class{constructor(e=0){this.offset=e,this.tmpVertex=E()}applyToVertex(e,i,r){const n=ae(pF,e,i,r),s=ue(pH,n,this.localOrigin),o=this.offset/xe(s);return ql(this.tmpVertex,n,s,o),this.tmpVertex}applyToAabb(e){const i=Owe,r=Rwe,n=Pwe;for(let l=0;l<3;++l)i[l]=e[0+l]+this.localOrigin[l],r[l]=e[3+l]+this.localOrigin[l],n[l]=i[l];const s=this.applyToVertex(i[0],i[1],i[2]);for(let l=0;l<3;++l)e[l]=s[l],e[l+3]=s[l];const o=l=>{const c=this.applyToVertex(l[0],l[1],l[2]);for(let h=0;h<3;++h)e[h]=Math.min(e[h],c[h]),e[h+3]=Math.max(e[h+3],c[h])};for(let l=1;l<8;++l){for(let c=0;c<3;++c)n[c]=l&1<<c?r[c]:i[c];o(n)}let a=0;for(let l=0;l<3;++l)i[l]*r[l]<0&&(a|=1<<l);if(a!==0&&a!==7){for(let l=0;l<8;++l)if(!(a&l)){for(let c=0;c<3;++c)n[c]=a&1<<c?0:l&1<<c?i[c]:r[c];o(n)}}for(let l=0;l<3;++l)e[l]-=this.localOrigin[l],e[l+3]-=this.localOrigin[l];return e}},zHe=class{constructor(e=0){this.componentLocalOriginLength=0,this._tmpVertex=E(),this._mbs=kn(),this._obb=tK(),this._totalOffset=0,this._offset=0,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=xe(e)}applyToVertex(e,i,r){const n=ae(pF,e,i,r),s=ae(pH,e,i,r+this.componentLocalOriginLength),o=this._totalOffset/xe(s);return ql(this._tmpVertex,n,s,o),this._tmpVertex}applyToAabb(e){const i=ae(pF,e[0],e[1],e[2]+this.componentLocalOriginLength),r=ae(pH,e[3],e[4],e[5]+this.componentLocalOriginLength),n=N5(Owe,i),s=N5(Rwe,r),o=OE(Pwe,i),a=OE(jHe,r),l=w6(sse,o,a);l[0]=n[0]*s[0]<0?0:l[0],l[1]=n[1]*s[1]<0?0:l[1],l[2]=n[2]*s[2]<0?0:l[2];const c=xe(l);if(c<this._totalOffset)return e[0]-=i[0]<0?this._totalOffset:0,e[1]-=i[1]<0?this._totalOffset:0,e[2]-=i[2]<0?this._totalOffset:0,e[3]+=r[0]>0?this._totalOffset:0,e[4]+=r[1]>0?this._totalOffset:0,e[5]+=r[2]>0?this._totalOffset:0,e;const h=Lye(sse,o,a),d=xe(h),f=this._totalOffset/d,m=this._totalOffset/c;return e[0]+=i[0]*(i[0]>0?f:m),e[1]+=i[1]*(i[1]>0?f:m),e[2]+=i[2]*(i[2]>0?f:m),e[3]+=r[0]*(r[0]<0?f:m),e[4]+=r[1]*(r[1]<0?f:m),e[5]+=r[2]*(r[2]<0?f:m),e}applyToMbs(e){const i=xe(e),r=this._totalOffset/i;return ql(this._mbs,e,e,r),this._mbs[3]=e[3]+e[3]*this._totalOffset/i,this._mbs}applyToObb(e){return Awe(e,this._totalOffset,this._totalOffset,Le.Global,this._obb),this._obb}},BHe=class{constructor(e=0){this.offset=e,this.sphere=kn(),this.tmpVertex=E()}applyToVertex(e,i,r){const n=this.objectTransform.transform,s=ae(pF,e,i,r),o=ke(s,s,n),a=this.offset/xe(o);ql(o,o,o,a);const l=this.objectTransform.inverse;return ke(this.tmpVertex,o,l),this.tmpVertex}applyToMinMax(e,i){const r=this.offset/xe(e);ql(e,e,e,r);const n=this.offset/xe(i);ql(i,i,i,n)}applyToAabb(e){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const r=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*r,e[4]+=e[4]*r,e[5]+=e[5]*r,e}applyToBoundingSphere(e){const i=xe(e),r=this.offset/i;return ql(this.sphere,e,e,r),this.sphere[3]=e[3]+e[3]*this.offset/i,this.sphere}};const ise=new BHe;function dH(t){return t!=null?(ise.offset=t,ise):null}const rse=new zHe;function VHe(t){return t!=null?(rse.offset=t,rse):null}const nse=new UHe;function GHe(t){return t!=null?(nse.offset=t,nse):null}const F_="terrain",pF=E(),pH=E(),Owe=E(),Rwe=E(),Pwe=E(),jHe=E(),sse=E(),JE=1e-5;let HHe=class{constructor(e){this.options=new $je,this._results=new qHe,this.transform=new kHe,this.tolerance=JE,this.verticalOffset=null,this._ray=js(),this._rayEnd=E(),this._rayBeginTransformed=E(),this._rayEndTransformed=E(),this.viewingMode=e??Le.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,i,r){this.resetWithRay(wbe(e,i,this._ray),r)}resetWithRay(e,i){this.camera=i,e!==this._ray&&oF(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===Le.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,ue(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,i,r,n,s){this.point=i,this.filterPredicate=n,this.tolerance=r??JE;const o=dH(this.verticalOffset);if(e&&e.length>0){const a=s?l=>{s(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of e){const c=l.getSpatialQueryAccelerator?.();c!=null?(o!=null?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,a,o):c.forEachAlongRay(this._ray.origin,this._ray.direction,a),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(a)):l.objects.forAll(h=>a(h))}}this.sortResults()}intersectObject(e){const i=e.geometries;if(!i)return;const r=e.effectiveTransformation,n=dH(this.verticalOffset);for(const s of i){if(!s.visible)continue;const{material:o,id:a}=s;this.transform.setAndInvalidateLazyTransforms(r,s.transformation),ke(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),ke(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;n!=null&&(n.objectTransform=this.transform),o.intersect(s,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,h,d,f,m,y)=>{if(c>=0){if(this.filterPredicate!=null&&!this.filterPredicate(this._ray.origin,this._rayEnd,c))return;const _=f?this._results.hud:this._results,v=f?w=>{const x=new Lje(e,a,d,y);w.set(Jr.HUD,x,c,h,Kr,m)}:w=>w.set(Jr.OBJECT,{object:e,geometryId:a,triangleNr:d},c,h,l,m);if((_.min.drapedLayerOrder==null||m>=_.min.drapedLayerOrder)&&(_.min.dist==null||c<_.min.dist)&&v(_.min),this.options.store!==Bo.MIN&&(_.max.drapedLayerOrder==null||m<_.max.drapedLayerOrder)&&(_.max.dist==null||c>_.max.dist)&&v(_.max),this.options.store===Bo.ALL)if(f){const w=new fH(this._ray);v(w),this._results.hud.all.push(w)}else{const w=new Q2(this._ray);v(w),this._results.all.push(w)}}})}}sortResults(e=this._results.all){e.sort((i,r)=>i.dist!==r.dist?(i.dist??0)-(r.dist??0):i.drapedLayerOrder!==r.drapedLayerOrder?(i.drapedLayerOrder??Number.MAX_VALUE)-(r.drapedLayerOrder??Number.MAX_VALUE):(r.drapedLayerGraphicOrder??Number.MIN_VALUE)-(i.drapedLayerGraphicOrder??Number.MIN_VALUE))}};function sd(t){return new HHe(t)}let qHe=class{constructor(){this.min=new Q2(js()),this.max=new Q2(js()),this.hud={min:new fH(js()),max:new fH(js()),all:new Array},this.ground=new Q2(js()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}},Q2=class{get ray(){return this._ray}get distanceInRenderSpace(){return this.dist!=null?(re(yI,this.ray.direction,this.dist),xe(yI)):null}getIntersectionPoint(e){return!!Gp(this)&&(re(yI,this.ray.direction,this.dist),ue(e,this.ray.origin,yI),!0)}getTransformedNormal(e){return oe(gA,this.normal),gA[3]=0,Fu(gA,gA,this.transformation),oe(e,gA),ye(e,e)}constructor(e){this.intersector=Jr.OBJECT,this.normal=E(),this.transformation=be(),this._ray=js(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=Jr.OBJECT,oF(e,this._ray)}set(e,i,r,n,s,o,a){this.intersector=e,this.dist=r,oe(this.normal,n??gZ),Qn(this.transformation,s??Kr),this.target=i,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(e){oF(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,oe(this.normal,e.normal),Qn(this.transformation,e.transformation)}},fH=class extends Q2{constructor(){super(...arguments),this.intersector=Jr.HUD}};function iK(t){return new Q2(t)}const yI=E(),gA=oi();function Mwe(t,e,i,r){return t.renderCoordsHelper.fromRenderCoords(e.eye,fF,r)!=null&&E0e(i,fF)}function pU(t,e){return t.elevationProvider?t.elevationProvider.getElevation(e[0],e[1],e[2],t.renderCoordsHelper.spatialReference,"ground")??0:0}function Zx(t,e,i,r){const n=t.state.camera.clone();e&&i&&r&&(n.eye=e,n.center=i,n.up=r),WHe(t,n.ray,v0)||oe(v0,n.center);const s=t.state.constraints,o=s.minimumPoiDistance;if(qs(n.eye,v0)<o){const a=s.collision.enabled;oe(b1,n.viewForward),re(b1,b1,o),a?n.eye=de(fF,v0,b1):ue(v0,n.eye,b1);const l=t.renderCoordsHelper,c=l.getAltitude(n.eye),h=s.collision.elevationMargin;a&&c<h&&(de(b1,v0,n.eye),n.eye=l.setAltitude(fF,h,n.eye),ue(v0,n.eye,b1))}return n.center=v0,n}function ose(t,e,i){if(!t.state.isGlobal||!t.stateManager.constraintsManager)return!1;const r=pU(t,e),n=t.stateManager.constraintsManager.nearFarHeuristic,{far:s}=n.compute(e,i,t.renderDataExtent,r,XHe),o=s*s;return qs(e,i)>o}function WHe(t,e,i){let r=ase[t.viewingMode];r||(r=sd(t.state.viewingMode),r.options.backfacesTerrain=!t.state.isGlobal,r.options.invisibleTerrain=!0,ase[t.viewingMode]=r);const{isGlobal:n}=t.state;return!(!t.sceneIntersectionHelper.intersectRay(e,r,i)||ose(t,e.origin,i))||!(!t.renderCoordsHelper.intersectManifold(e,0,i)||ose(t,e.origin,i))||!!n&&YHe(e,i,Wi(t.spatialReference).radius)}function YHe(t,e,i){const r=ge(t.origin,t.origin)-i*i,n=r>0?Math.sqrt(r)/3:1;return re(e,t.direction,n/xe(t.direction)),ue(e,e,t.origin),!0}const ase={},fF=E(),v0=E(),b1=E(),XHe={near:0,far:0},ZHe=E(),_I=E();function rK(){return{direction:E(),up:E()}}function $we(t,e,i,r,n){let s=ye(ZHe,t),o=ge(s,r);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(ge(e,r)),o<.99?(oe(s,e),a&&re(s,s,-1)):s=null);let l=0;if(s){re(_I,r,ge(r,s)),de(s,s,_I);const h=ge(s,n)/(xe(s)*xe(n));lt(_I,s,n),l=(ge(_I,r)>0?1:-1)*ml(Ys(h))}const c=ml(Ys(-ge(r,t)/xe(t)));return i?(i.heading=l,i.tilt=c,i):{heading:l,tilt:c}}const Iwe=Oe(0,1,0),Lwe=Oe(0,0,1),yA=be(),eg=E(),tg=E();function Dwe(t,e,i,r=rK()){const{direction:n,up:s}=r;return Qye(yA,-Dt(e)),PE(yA,yA,Dt(i)),ke(n,Lwe,yA),re(n,n,-1),ke(s,Iwe,yA),r}function JHe(t,e,i,r){return $we(e,i,r,Lwe,Iwe)}function KHe(t,e,i,r){const n=Dwe(t,i,r),s=E();return re(s,n.direction,-e),ue(s,s,t),{up:n.up,eye:s,heading:i,tilt:r}}function QHe(t){return ml(t)}function eqe(t){return Dt(t)}function Nwe(t,e,i,r,n){const s=t.renderSpatialReference,o=t.map&&t.spatialReference||e.spatialReference;return Wc(e,eg,s),Wc(e,tg,s),eg[0]-=i/2,tg[0]+=i/2,eg[1]-=r/2,tg[1]+=r/2,ua(eg,s,eg,o),ua(tg,s,tg,o),n?(n.xmin=eg[0],n.ymin=eg[1],n.xmax=tg[0],n.ymax=tg[1],n.spatialReference=o):n=new zi(eg[0],eg[1],tg[0],tg[1],o),n}const tqe=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:JHe,eyeForCenterWithHeadingTilt:KHe,eyeTiltToLookAtTilt:eqe,headingTiltToDirectionUp:Dwe,lookAtTiltToEyeTilt:QHe,toExtent:Nwe},Symbol.toStringTag,{value:"Module"}));function lse(t,e,i){if(e.longitude==null||e.latitude==null||i.longitude==null||i.latitude==null)throw new Error("Invalid points: no lon/lat");return iqe(t,e.longitude,e.latitude,i.longitude,i.latitude)}function iqe(t,e,i,r,n){const s=Dt(i),o=Dt(n),a=s-o,l=Dt(e)-Dt(r),c=Math.sin(a/2),h=Math.sin(l/2),d=2*Qh(Math.sqrt(c*c+Math.cos(s)*Math.cos(o)*h*h))*t;return Math.round(1e4*d)/1e4}function rqe(t,e,i){const r=e.spatialReference,n=Wi(r),s=new ut(e.x,t.y,r),o=new ut(i.x,t.y,r),a=new ut(t.x,e.y,r),l=new ut(t.x,i.y,r);return{lon:lse(n.radius,s,o),lat:lse(n.radius,a,l)}}function nqe(t,e,i){const r=e/i,n=Dt(t),s=Math.sin(r/2),o=Math.cos(n),a=2*Qh(Math.sqrt(s*s/(o*o)));return ml(a)}function sqe(t,e){let i=t/15;return e||(i=Math.round(i)),i}function cse(t,e){const i=t?.[0];if(i==null)return null;e||(e={hours:0,minutes:0,seconds:0}),e.hours=sqe(i,!0);const r=e.hours%1;e.hours-=r,e.minutes=60*r;const n=e.minutes%1;return e.minutes-=n,e.seconds=Math.round(60*n),e}const Fwe=Oe(0,0,1),kwe=ye(E(),Oe(1,1,1)),oqe=new wv(-180,180),_A=be(),R_=E(),wT=E();function Uwe(t,e,i,r=rK()){lt(R_,t,Fwe),ge(R_,R_)===0&&lt(R_,t,kwe),Qu(_A,-Dt(e),t),Fc(_A,_A,-Dt(i),R_);const{up:n,direction:s}=r;return lt(n,R_,t),ye(n,n),ke(n,n,_A),ye(s,t),Pa(s,s),ke(s,s,_A),r}function aqe(t,e,i,r){const n=R_,s=wT;return ye(n,t),lt(wT,n,Fwe),ge(wT,wT)===0&&lt(wT,n,kwe),lt(s,wT,n),$we(e,i,r,n,s)}function lqe(t,e,i,r){const n={eye:E(),up:null,tilt:r,heading:i},s=R_;s[0]=t[0],s[1]=t[2],s[2]=-t[1];const o=e,a=Dt(i),l=Dt(r),c=Math.sin(a),h=Math.cos(a),d=Math.sin(l),f=Math.cos(l),m=xe(s);let y;if(Math.abs(l)<1e-8)y=o+m;else{const X=m/d,P=Qh(o/X),I=Math.PI-l-P;y=X*Math.sin(I)}const _=f*o,v=o*o*(d*d),w=h*h*v,x=y-_,T=x*x,S=w*(w+T-s[1]*s[1]);if(S<0)return re(n.eye,s,y/m),n.tilt=0,vI(n,t);const C=Math.sqrt(S),A=s[1]*x,R=w+T;let D;if(D=h>0?-C+A:C+A,Math.abs(R)<1e-8)return m<1e-8?(n.eye[0]=0,n.eye[1]=0,n.eye[2]=o):re(n.eye,s,y/m),n.tilt=0,Sz(n.eye),vI(n,t);n.eye[1]=D/R;const N=c*c*v,k=d*o,B=h*k*n.eye[1],L=n.eye[1]*n.eye[1],z=1-L,j=Math.sqrt(z),H=w*L+N-2*B*j*x+z*T;return Math.abs(H)<1e-8?(re(n.eye,s,y/m),n.tilt=0,Sz(n.eye),vI(n,t)):(n.eye[0]=(z*(y*s[0]-_*s[0])-k*j*(s[0]*n.eye[1]*h+s[2]*c))/H,n.eye[2]=(z*(y*s[2]-_*s[2])-k*j*(s[2]*n.eye[1]*h-s[0]*c))/H,re(n.eye,n.eye,y),Sz(n.eye),vI(n,t))}function Sz(t){const e=t[1];t[1]=-t[2],t[2]=e}function vI(t,e){const i=Uwe(e,t.heading,t.tilt);return t.up=i.up,t}function cqe(t,e,i){const r=xe(e),n=Math.sqrt(i*i+r*r-2*i*r*Math.cos(Math.PI-t)),s=Qh(i/(n/Math.sin(t)));return ml(t-s)}function uqe(t,e,i){const r=Dt(t),n=xe(e);return Qh(i/(n/Math.sin(r)))+r}function zwe(t,e,i,r,n){let s,o,a,l;const c=e.latitude,h=Wi(t.spatialReference).radius,d=e.longitude,f=nqe(c,i,h)/2;s=d-f,o=d+f;const m=Dt(c),y=(1+Math.sin(m))/(1-Math.sin(m)),_=(y+1)*Math.tan(r/h/2),v=_*_;function w(T){const S=Math.PI/2;return(T=n6e.normalize(T,-S))>S&&(T=Math.PI-T),T}if(a=1.5*Math.PI-2*Math.atan(.5*(_+Math.sqrt(4*y+v))),l=a+r/h,a=w(a),l=w(l),l<a){const T=l;l=a,a=T}if(a=Math.max(ml(a),-90),l=Math.min(ml(l),90),o=oqe.monotonic(s,o),o-s>180){const T=(o-s-180)/2;s+=T,o-=T}const x=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:ze.WGS84;return n?(n.xmin=s,n.ymin=a,n.xmax=o,n.ymax=l,n.spatialReference=x):n=new zi(s,a,o,l,x),t.spatialReference&&t.spatialReference.isWebMercator&&ov(n,!1,n),n}const hqe=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:aqe,eyeForCenterWithHeadingTilt:lqe,eyeTiltToLookAtTilt:uqe,headingTiltToDirectionUp:Uwe,lookAtTiltToEyeTilt:cqe,toExtent:zwe},Symbol.toStringTag,{value:"Module"}));function mF(t){return t.type==="point"}let nK=class{constructor(e,i=null,r=0){this.array=e,this.spatialReference=i,this.offset=r}};function Bwe(t){return"array"in t}function om(t,e,i="ground"){if(mF(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,i);if(Bwe(e)){let r=e.offset;return t.getElevation(e.array[r++],e.array[r++],e.array[r]||0,e.spatialReference??t.spatialReference,i)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,i)}const Vwe=K.getLogger("esri.views.3d.support.cameraUtils"),Gwe=39.37,jwe=96,mH=1,dqe=8,pqe=5,Hwe=1,use=E(),fqe={heading:0,tilt:0},sR=E(),mqe=new wv(-20037508342788905e-9,20037508342788905e-9),gqe=new wv(-180,180);var la;function Vy(t){return t.spatialReference??ze.WGS84}function DC(t){return t.viewingMode==="global"?hqe:tqe}function yqe(t,e,i,r,n){return DC(t).headingTiltToDirectionUp(e,i,r,n)}function Bg(t,e){if(e==null)return null;const i=t.renderSpatialReference,r=DC(t).headingTiltToDirectionUp,n=E();if(!Wc(e.position,n,i))return null;const s=r(n,e.heading,e.tilt);re(s.direction,s.direction,t.state.camera.distance),ue(s.direction,s.direction,n);const o=Zx(t,n,s.direction,s.up);return o.fov=Dt(e.fov),o}(function(t){t[t.LOCKED=0]="LOCKED",t[t.ADJUST=1]="ADJUST"})(la||(la={}));const xT=E();function KE(t,e,i){const r=t.renderSpatialReference,n=mU(t,e.eye,e.viewForward,e.up,fqe);let s=Vy(t);return ua(e.eye,r,xT,s)||(s=ze.WGS84,ua(e.eye,r,xT,s)),i==null?new eh(new ut(xT,s),n.heading,n.tilt,ml(e.fov)):(i.position.x=xT[0],i.position.y=xT[1],i.position.z=xT[2],i.position.spatialReference=s,i.heading=n.heading,i.tilt=n.tilt,i.fov=ml(e.fov),i)}function fU(t,e,i){const r=t.state.camera,n=r.width/2/r.pixelRatio;return t.renderCoordsHelper.viewingMode===Le.Global&&i!=null&&(e*=Math.cos(Dt(i))),e/=t.renderCoordsHelper.unitInMeters,n/(jwe*Gwe/e)/Math.tan(r.fovX/2)}function wx(t,e,i){const r=t.state.camera,n=e*Math.tan(r.fovX/2),s=r.width/2/r.pixelRatio;let o=jwe*Gwe/(s/n);return t.renderCoordsHelper.viewingMode===Le.Global&&i!=null&&(o/=Math.cos(Dt(i))),o*t.renderCoordsHelper.unitInMeters}async function qwe(t,e,i,r,n,s){return Wwe(t,e,fU(t,i,e.latitude),r,n,s)}function _qe(t,e,i,r,n,s){return axe(t,sK(t,r.heading,r.tilt,e,i,n),r.fov,s)}async function Wwe(t,e,i,r,n,s){const o=await Xwe(t,r.heading,r.tilt,e,i,n,s);return Tt(s),lxe(t,o,r.fov,s)}function mU(t,e,i,r,n){return DC(t).directionToHeadingTilt(e,i,r,n)}function Ywe(t,e){return!!(t.basemapTerrain&&t.renderCoordsHelper.fromRenderCoords(e,sR,t.spatialReference)&&t.elevationProvider&&(om(t.elevationProvider,sR)??0)>sR[2]-Hwe)}async function vqe(t,e,i){if(Ywe(t,e))return!0;const{elevationProvider:r,spatialReference:n,renderCoordsHelper:s}=t;if(r==null||!s.fromRenderCoords(e,sR,n))return!1;const[o,a,l]=sR,c=await r.queryElevation(o,a,l,n,"ground",i)??0;return Tt(i),c>l-Hwe}async function bqe(t,e,i){const r=E();if(e==null)return oe(r,t.state.camera.center);if(e instanceof ut){const{renderSpatialReference:n,basemapTerrain:s,elevationProvider:o}=t,a=e.spatialReference;if(await hF(e,r,n,0,{signal:i}),Tt(i),e.z==null&&s!=null&&o!=null){const l=await o.queryElevation(e.x,e.y,e.z??0,a,"ground",i);Tt(i),l!=null&&t.renderCoordsHelper.setAltitude(r,l)}return r}return oe(r,e)}function wqe(t,e){const i=E();if(e==null)return oe(i,t.state.camera.center);if(e instanceof ut){if(!Wc(e,i,t.renderSpatialReference))return null;const{basemapTerrain:r,elevationProvider:n}=t;if(e.z==null&&r!=null&&n!=null){const s=om(n,e);s!=null&&t.renderCoordsHelper.setAltitude(i,s)}return i}return oe(i,e)}function sK(t,e,i,r,n,s){return Zwe(t,e,i,r instanceof ut?r:null,wqe(t,r),n,s)}async function Xwe(t,e,i,r,n,s,o){const a=r instanceof ut?r:null,l=await bqe(t,r,o);return Tt(o),Jwe(t,e,i,a,l,n,s,o)}function Zwe(t,e,i,r,n,s,o){if(n==null||(r??(r=Ay(n,t.renderSpatialReference,Vy(t))),r==null))return null;const a=Kwe(t,e,i,n,s,o);if(Qwe(t,i,o)&&Ywe(t,a.eye)){const{tilt:l,mode:c}=exe(t,i,n,s);return Zwe(t,e,l,r,n,s,c)}return txe(a,n)}async function Jwe(t,e,i,r,n,s,o,a){r??(r=await gwe(n,t.renderSpatialReference,Vy(t),{signal:a})),Tt(a);const l=Kwe(t,e,i,n,s,o);if(Qwe(t,i,o)&&await vqe(t,l.eye,a)){Tt(a);const{tilt:c,mode:h}=exe(t,i,n,s);return Jwe(t,e,c,r,n,s,h,a)}return txe(l,n)}function Kwe(t,e,i,r,n,s){const o=Tqe(t,e,i,r,n=Math.max(n,t.state.constraints.minimumPoiDistance),s);return(0,DC(t).eyeForCenterWithHeadingTilt)(r,n,o.heading,o.tilt)}function Qwe(t,e,i){const r=t.map.ground.navigationConstraint;return i===la.ADJUST&&t.viewingMode==="global"&&e>0&&(r==null||r.type==="stay-above")}function exe(t,e,i,r){const n=oxe(t,i,r,Eqe(t,r,e,i));return{tilt:n,mode:e-n<1?la.LOCKED:la.ADJUST}}function txe(t,e){return{...t,center:Qr(e)}}function ixe(t,e){const{state:i,spatialReference:r}=t,n=e.spatialReference;return i.isGlobal&&lP(n,Le.Global)||i.isLocal&&r.equals(n)}function rxe(t,e){let i,r,n;if(t.state.isGlobal){const h=new ut(e.xmin,e.ymin,e.spatialReference),d=new ut(e.xmax,e.ymax,e.spatialReference),f=e.spatialReference.isGeographic?gqe:mqe;i=new ut({x:f.center(h.x,d.x),y:(d.y+h.y)/2,z:e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0,spatialReference:e.spatialReference});const m=Wi(e.spatialReference),y=rqe(i,h,d);r=y.lon,n=y.lat,f.diff(h.x,d.x)>f.range/2&&(r+=m.halfCircumference),r=Math.min(r,m.halfCircumference),n=Math.min(n,m.halfCircumference)}else{const h=t.renderSpatialReference??e.spatialReference;h.equals(e.spatialReference)||(e=Bm(e,h)),r=e.xmax-e.xmin,n=e.ymax-e.ymin;const d=e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0;i=new ut({x:e.xmin+.5*r,y:e.ymin+.5*n,z:d,spatialReference:h})}const s=e.zmax!=null&&e.zmin!=null?e.zmax-e.zmin:0,o=t.state.camera,a=1/Math.tan(o.fovX/2),l=1/Math.tan(o.fovY/2),c=1/Math.tan(o.fov/2);return{center:i,distance:Math.max(.5*r*a,.5*n*l,.5*s*c)/mH}}async function nxe(t,e,i,r,n,s){const o=ixe(t,e)?e:await Am(e,t.spatialReference,{signal:s});Tt(s);const{center:a,distance:l}=rxe(t,o),c=await Xwe(t,i,r,a,l,n,s);return Tt(s),lxe(t,c,t.camera.fov,s)}function BN(t,e,i,r,n,s){let o;try{o=ixe(t,e)?e:Bm(e,t.spatialReference)}catch{return null}const{center:a,distance:l}=rxe(t,o),c=sK(t,i,r,a,l,n);return c==null?null:axe(t,c,t.camera.fov,s)}function sxe(t,e,i){const r=t.renderSpatialReference,n=Ay(i,r,Vy(t));if(n==null)return null;const s=Math.tan(e.fovX/2),o=Math.tan(e.fovY/2),a=fM(e.eye,i),l=2*a*s*mH,c=2*a*o*mH;return t.viewingMode==="global"?zwe(t,n,l,c):Nwe(t,n,l,c)}function xqe(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(i/r)/Math.LN2>dqe)return!0;const n=t.renderSpatialReference,s=Vy(t),o=Ay(e,n,s),a=Ay(t.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n,s);if(o==null||a==null)return!1;const l=Math.tan(.5*t.state.camera.fov)*r;return a.distance(o)/l>pqe}function Tqe(t,e,i,r,n,s){let o=0;return s===la.ADJUST&&xqe(t,r,n)?(e=0,o=Sqe(t,n,i,r)):o=oK(t,r,n,i),o=t.state.constraints.clampTilt(n,o),{heading:e,tilt:i=oxe(t,r,n,o)}}const gF=.7;function Sqe(t,e,i,r){const n=oK(t,r,e,i);if(!t.state.constraints.tilt)return n;const s=t.state.constraints.tilt(e);s.max=Math.min(s.max,.5*Math.PI);const o=s.min*(1-gF)+s.max*gF;return Math.min(n,o)}function Eqe(t,e,i,r){let n=oK(t,r,e,i);if(!t.state.constraints.tilt)return n;const s=t.state.constraints.tilt(e);return n=Math.min(n,.5*Math.PI),s.min*(1-gF)+n*gF}function oxe(t,e,i,r){return DC(t).lookAtTiltToEyeTilt(r,e,i)}function oK(t,e,i,r){return DC(t).eyeTiltToLookAtTilt(r,e,i)}function axe(t,e,i,r){if(e==null)return null;const n=t.renderSpatialReference,s=Ay(e.eye,n,Vy(t));return s==null?null:(r??(r=new eh),r.position=s,r.heading=e.heading,r.tilt=e.tilt,r.fov=i,r)}async function lxe(t,e,i,r){const n=t.renderSpatialReference,s=await gwe(e.eye,n,Vy(t),{signal:r});return Tt(r),new eh(s,e.heading,e.tilt,i)}function Cqe(t,e){const i=t.basemapTerrain?.tilingScheme;if(i)return i.levelAtScale(e);Vwe.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function cxe(t,e){const i=t.basemapTerrain?.tilingScheme;if(i)return i.scaleAtLevel(e);Vwe.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function uxe(t,e){return ua(e.center,t.renderSpatialReference,use,ze.WGS84),wx(t,e.distance,use[1])}const aK=K.getLogger("esri.layers.support.ElevationSampler");let hxe=class{queryElevation(e){return dxe(e.clone(),this)}on(){return Vi()}projectIfRequired(e,i){return pxe(e,i)}},Aqe=class extends hxe{get spatialReference(){return this.extent.spatialReference}constructor(e,i,r){super(),this.tile=e,this.noDataValue=r;const n=e.tile.extent;this.extent=M6(n,i.spatialReference),this.extent.zmin=e.zmin,this.extent.zmax=e.zmax,this._aaExtent=n;const s=Da(i.spatialReference),o=i.lodAt(e.tile.level).resolution*s;this.demResolution={min:o,max:o}}contains(e){const i=this.projectIfRequired(e,this.spatialReference);return i!=null&&this.containsAt(i.x,i.y)}containsAt(e,i){return $6(this._aaExtent,e,i)}elevationAt(e,i){if(!this.containsAt(e,i)){const r=this.extent,n=`${r.xmin}, ${r.ymin}, ${r.xmax}, ${r.ymax}`;return aK.warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler extent (${n})`),this.noDataValue}return this.tile.sample(e,i)??this.noDataValue}},JIt=class extends hxe{get spatialReference(){return this.extent.spatialReference}constructor(e,i,r){let n;super(),typeof i=="number"?(this.noDataValue=i,n=null):(n=i,this.noDataValue=r),this.samplers=n?e.map(o=>new Aqe(o,n,this.noDataValue)):e;const s=this.samplers[0];if(s){this.extent=s.extent.clone();const{min:o,max:a}=s.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=M6(Zt(),n.spatialReference),this.demResolution={min:0,max:0}}elevationAt(e,i){for(const r of this.samplers)if(r.containsAt(e,i))return r.elevationAt(e,i);return aK.warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler`),this.noDataValue}};function dxe(t,e){const i=pxe(t,e.spatialReference);if(!i)return null;switch(t.type){case"point":Oqe(t,i,e);break;case"polyline":Rqe(t,i,e);break;case"multipoint":Pqe(t,i,e)}return t}function pxe(t,e){if(t==null)return null;const i=t.spatialReference;if(i.equals(e))return t;const r=dM(t,e);return r||aK.error(`Cannot project geometry spatial reference (wkid:${i.wkid}) to elevation sampler spatial reference (wkid:${e.wkid})`),r}function Oqe(t,e,i){t.z=i.elevationAt(e.x,e.y)}function Rqe(t,e,i){Kf.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let n=0;n<t.paths.length;n++){const s=t.paths[n],o=e.paths[n];for(let a=0;a<s.length;a++){const l=s[a],c=o[a];Kf.x=c[0],Kf.y=c[1],r&&(l[3]=l[2]),l[2]=i.elevationAt(Kf.x,Kf.y)}}t.hasZ=!0}function Pqe(t,e,i){Kf.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let n=0;n<t.points.length;n++){const s=t.points[n],o=e.points[n];Kf.x=o[0],Kf.y=o[1],r&&(s[3]=s[2]),s[2]=i.elevationAt(Kf.x,Kf.y)}t.hasZ=!0}const Kf=new ut;var gH;let Pf=gH=class extends pe{constructor(t){super(t),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new gH({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};u([p({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Pf.prototype,"cols",void 0),u([p({type:dr,json:{write:!0}})],Pf.prototype,"level",void 0),u([p({type:String,json:{write:!0}})],Pf.prototype,"levelValue",void 0),u([p({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Pf.prototype,"origin",void 0),u([p({type:Number,json:{write:!0}})],Pf.prototype,"resolution",void 0),u([p({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Pf.prototype,"rows",void 0),u([p({type:Number,json:{write:!0}})],Pf.prototype,"scale",void 0),Pf=gH=u([M("esri.layers.support.LOD")],Pf);const up=Pf;let Mqe=class{constructor(e,i,r,n,s=void 0){this.id=e,this.level=i,this.row=r,this.col=n,this.extent=s}};var a_;const hse=new Sr({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let ya=a_=class extends pe{static create(t={}){const{resolutionFactor:e=1,scales:i,size:r=256,spatialReference:n=ze.WebMercator,numLODs:s=24}=t;if(!Ra(n)){const d=[];if(i)for(let f=0;f<i.length;f++){const m=i[f];d.push(new up({level:f,scale:m,resolution:m}))}else{let f=5e-4;for(let m=s-1;m>=0;m--)d.unshift(new up({level:m,scale:f,resolution:f})),f*=2}return new a_({dpi:96,lods:d,origin:new ut(0,0,n),size:[r,r],spatialReference:n})}const o=Sp(n),a=t.origin?new ut({x:t.origin.x,y:t.origin.y,spatialReference:n}):new ut(o?{x:o.origin[0],y:o.origin[1],spatialReference:n}:{x:0,y:0,spatialReference:n}),l=96,c=1/(Da(n)*39.37*l),h=[];if(i)for(let d=0;d<i.length;d++){const f=i[d],m=f*c;h.push(new up({level:d,scale:f,resolution:m}))}else{let d=rZ(n)?512/r*5916575275917094e-7:256/r*591657527591555e-6;const f=Math.ceil(s/e);h.push(new up({level:0,scale:d,resolution:d*c}));for(let m=1;m<f;m++){const y=d/2**e,_=y*c;h.push(new up({level:m,scale:y,resolution:_})),d=y}}return new a_({dpi:l,lods:h,origin:a,size:[r,r],spatialReference:n})}constructor(t){super(t),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:t,origin:e}=this;if(t&&e){const i=Sp(t);return t.isWrappable&&!!i&&Math.abs(i.origin[0]-e.x)<=i.dx}return!1}readOrigin(t,e){return ut.fromJSON({spatialReference:e.spatialReference,...t})}set lods(t){let e=0,i=0;const r=[],n=this._levelToLOD={};t&&(e=-1/0,i=1/0,t.forEach(s=>{r.push(s.scale),e=s.scale>e?s.scale:e,i=s.scale<i?s.scale:i,n[s.level]=s})),this._set("scales",r),this._set("lods",t),this._initializeUpsampleLevels()}readSize(t,e){return[e.cols,e.rows]}writeSize(t,e){e.cols=t[0],e.rows=t[1]}zoomToScale(t){const e=this.scales;if(t<=0)return e[0];if(t>=e.length-1)return e[e.length-1];const i=Math.floor(t),r=i+1;return e[i]/(e[i]/e[r])**(t-i)}scaleToZoom(t){const e=this.scales,i=e.length-1;let r=0;for(;r<i;r++){const n=e[r],s=e[r+1];if(n<=t)return r;if(s===t)return r+1;if(n>t&&s<t)return r+Math.log(n/t)/Math.log(n/s)}return r}snapScale(t,e=.95){const i=this.scaleToZoom(t);return i%Math.floor(i)>=e?this.zoomToScale(Math.ceil(i)):this.zoomToScale(Math.floor(i))}tileAt(t,e,i,r){const n=this.lodAt(t);if(!n)return null;let s,o;if(typeof e=="number")s=e,o=i;else if(Fn(e.spatialReference,this.spatialReference))s=e.x,o=e.y,r=i;else{const c=dM(e,this.spatialReference);if(c==null)return null;s=c.x,o=c.y,r=i}const a=n.resolution*this.size[0],l=n.resolution*this.size[1];return r||(r=new Mqe(null,0,0,0,Zt())),r.level=t,r.row=Math.floor((this.origin.y-o)/l+.001),r.col=Math.floor((s-this.origin.x)/a+.001),this.updateTileInfo(r),r}updateTileInfo(t,e=a_.ExtrapolateOptions.NONE){let i=this.lodAt(t.level);if(!i&&e===a_.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<t.level&&(i=o)}if(!i)return;const r=t.level-i.level,n=i.resolution*this.size[0]/2**r,s=i.resolution*this.size[1]/2**r;t.id=`${t.level}/${t.row}/${t.col}`,t.extent||(t.extent=Zt()),t.extent[0]=this.origin.x+t.col*n,t.extent[1]=this.origin.y-(t.row+1)*s,t.extent[2]=t.extent[0]+n,t.extent[3]=t.extent[1]+s}upsampleTile(t){const e=this._upsampleLevels[t.level];return!(!e||e.parentLevel===-1)&&(t.level=e.parentLevel,t.row=Math.floor(t.row/e.factor+.001),t.col=Math.floor(t.col/e.factor+.001),this.updateTileInfo(t),!0)}getTileBounds(t,e){const i=this.lodAt(e.level);if(i==null)return null;const{resolution:r}=i,n=r*this.size[0],s=r*this.size[1];return t[0]=this.origin.x+e.col*n,t[1]=this.origin.y-(e.row+1)*s,t[2]=t[0]+n,t[3]=t[1]+s,t}lodAt(t){return this._levelToLOD?.[t]??null}clone(){return a_.fromJSON(this.write({}))}getOrCreateCompatible(t,e){if(this.size[0]===256&&this.size[1]===256)return t===256?this:null;const i=[],r=this.lods.length;for(let n=0;n<r;n++){const s=this.lods[n],o=s.resolution*e;i.push(new up({level:s.level,scale:s.scale,resolution:o}))}return new a_({size:[t,t],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:i})}_initializeUpsampleLevels(){const t=this.lods;this._upsampleLevels=[];let e=null;for(let i=0;i<t.length;i++){const r=t[i];this._upsampleLevels[r.level]={parentLevel:e?e.level:-1,factor:e?e.resolution/r.resolution:0},e=r}}};u([p({type:Number,json:{write:!0}})],ya.prototype,"compressionQuality",void 0),u([p({type:Number,json:{write:!0}})],ya.prototype,"dpi",void 0),u([p({type:String,json:{read:hse.read,write:hse.write,origins:{"web-scene":{read:!1,write:!1}}}})],ya.prototype,"format",void 0),u([p({readOnly:!0})],ya.prototype,"isWrappable",null),u([p({type:ut,json:{write:!0}})],ya.prototype,"origin",void 0),u([wt("origin")],ya.prototype,"readOrigin",null),u([p({type:[up],value:null,json:{write:!0}})],ya.prototype,"lods",null),u([p({readOnly:!0})],ya.prototype,"scales",void 0),u([p({cast:t=>Array.isArray(t)?t:typeof t=="number"?[t,t]:[256,256]})],ya.prototype,"size",void 0),u([wt("size",["rows","cols"])],ya.prototype,"readSize",null),u([Be("size",{cols:{type:dr},rows:{type:dr}})],ya.prototype,"writeSize",null),u([p({type:ze,json:{write:!0}})],ya.prototype,"spatialReference",void 0),ya=a_=u([M("esri.layers.support.TileInfo")],ya),function(t){var e;(e=t.ExtrapolateOptions||(t.ExtrapolateOptions={}))[e.NONE=0]="NONE",e[e.POWER_OF_TWO=1]="POWER_OF_TWO"}(ya||(ya={}));const VN=ya,$qe=12;let $c=class Ml{constructor(e){const i=Ml.checkUnsupported(e);if(i!=null)throw i;const r=e;this.spatialReference=r.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=Ev(this.spatialReference)||km(this.spatialReference)||Um(this.spatialReference),this.origin=[r.origin.x,r.origin.y],this.pixelSize=r.size[0],this.dpi=r.dpi;const n=r.lods.reduce((c,h,d)=>(h.level<c.min&&(c.min=h.level,c.minIndex=d),c.max=Math.max(c.max,h.level),c),{min:1/0,minIndex:0,max:-1/0}),s=r.lods[n.minIndex],o=2**s.level;let a=s.resolution*o,l=s.scale*o;this.levels=new Array(n.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*r.size[0],a*r.size[1]]},a/=2,l/=2}clone(){return new Ml(this.toTileInfo())}toTileInfo(){return new VN({dpi:this.dpi,origin:new ut({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,i)=>new up({level:i,scale:e.scale,resolution:e.resolution}))})}getExtent(e,i,r,n){const s=this.levels[e],o=s.tileSize[0],a=s.tileSize[1];n[0]=this.origin[0]+r*o,n[2]=this.origin[0]+(r+1)*o,n[3]=this.origin[1]-i*a,n[1]=this.origin[1]-(i+1)*a}convertExtentToRadians(e,i){this._isWebMercator?(i[0]=Aie(e[0]),i[1]=$5(e[1]),i[2]=Aie(e[2]),i[3]=$5(e[3])):this._isGCS&&(i[0]=Dt(e[0]),i[1]=Dt(e[1]),i[2]=Dt(e[2]),i[3]=Dt(e[3]))}getExtentGeometry(e,i,r,n=new zi){return this.getExtent(e,i,r,ef),n.spatialReference=this.spatialReference,n.xmin=ef[0],n.ymin=ef[1],n.xmax=ef[2],n.ymax=ef[3],n.zmin=void 0,n.zmax=void 0,n}ensureMaxLod(e){if(e==null)return!1;let i=!1;for(;this.levels.length<=e;){const r=this.levels[this.levels.length-1],n=r.resolution/2;this.levels.push({resolution:n,scale:r.scale/2,tileSize:[n*this.pixelSize,n*this.pixelSize]}),i=!0}return i}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const i=this.levels[0].scale;return e>=i?0:Math.log(i/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e){if(!(e instanceof Ml)){if(Ml.checkUnsupported(e))return!1;e=new Ml(e)}if(!e.spatialReference.equals(this.spatialReference)||e.pixelSize!==this.pixelSize)return!1;const i=Math.min(this.levels.length,e.levels.length)-1,r=this.levels[i].resolution;let n=.5*r;return!av(e.origin[0],this.origin[0],n)||!av(e.origin[1],this.origin[1],n)?!1:(n=.5*r/2**i/this.pixelSize*$qe,av(r,e.levels[i].resolution,n))}rootTilesInExtent(e,i=null,r=1/0){const n=new Array,s=this.levels[0].tileSize;if(e==null||s[0]===0||s[1]===0)return n;Ml.computeRowColExtent(e,s,this.origin,ef);let o=ef[1],a=ef[3],l=ef[0],c=ef[2];const h=c-l,d=a-o;if(h*d>r){const f=Math.floor(Math.sqrt(r));d>f&&(o=o+Math.floor(.5*d)-Math.floor(.5*f),a=o+f),h>f&&(l=l+Math.floor(.5*h)-Math.floor(.5*f),c=l+f)}for(let f=o;f<a;f++)for(let m=l;m<c;m++)n.push([0,f,m]);return i!=null&&(i[0]=this.origin[0]+l*s[0],i[1]=this.origin[1]-a*s[1],i[2]=this.origin[0]+c*s[0],i[3]=this.origin[1]-o*s[1]),n}static computeRowColExtent(e,i,r,n){const s=.001*(e[2]-e[0]+(e[3]-e[1]));n[0]=Math.max(0,Math.floor((e[0]+s-r[0])/i[0])),n[2]=Math.max(0,Math.ceil((e[2]-s-r[0])/i[0])),n[1]=Math.max(0,Math.floor((r[1]-e[3]+s)/i[1])),n[3]=Math.max(0,Math.ceil((r[1]-e[1]-s)/i[1]))}static isPowerOfTwo(e){const i=e.lods,r=i[0].resolution*2**i[0].level;return!i.some(n=>!CFe(n.resolution,r/2**n.level))}static hasGapInLevels(e){const i=e.lods.map(r=>r.level);i.sort((r,n)=>r-n);for(let r=1;r<i.length;r++)if(i[r]!==i[0]+r)return!0;return!1}static tileSizeSupported(e){const i=e.size[1];return i===e.size[0]&&(i&i-1)==0&&i>=128&&i<=512}static hasOriginPerLODs(e){const i=e.origin;return e.lods.some(r=>r.origin!=null&&(r.origin[0]!==i.x||r.origin[1]!==i.y))}static getMissingTileInfoError(){return new G("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return e==null?lK():e.lods.length<1?new G("tilingscheme:generic","Tiling scheme must have at least one level"):Ml.isPowerOfTwo(e)?Ml.hasGapInLevels(e)?new G("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):Ml.tileSizeSupported(e)?Ml.hasOriginPerLODs(e)?new G("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new G("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new G("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,i){const r=e[2]-e[0],n=e[3]-e[1],s=Da(i),o=1.2*Math.max(r,n),a=256,l=96,c=.0254,h=new Ml(new VN({size:[a,a],origin:new ut({x:e[0]-.5*(o-r),y:e[3]+.5*(o-n)}),lods:[new up({level:0,resolution:o/a,scale:1/(a/l*c/(o*s))})],spatialReference:i}));return h.ensureMaxLod(20),h}static makeWebMercatorAuxiliarySphere(e){const i=new Ml(Ml.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(e),i}static makeGCSWithTileSize(e,i=256,r=16){const n=256/i,s=new Ml(new VN({size:[i,i],origin:new ut({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new up({level:0,resolution:.703125*n,scale:295497598570834e-6*n})]}));return s.ensureMaxLod(r),s}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}};function lK(){return new G("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}$c.WebMercatorAuxiliarySphereTileInfo=new VN({size:[256,256],origin:new ut({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:ze.WebMercator}),spatialReference:ze.WebMercator,lods:[new up({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),$c.WebMercatorAuxiliarySphere=$c.makeWebMercatorAuxiliarySphere(19);const ef=Zt(),O2=64,B3=512,Iqe=2.5,vP=AFe(G7/10),fxe=2,mxe=Zt();$c.WebMercatorAuxiliarySphere.getExtent(0,0,0,mxe);const Lqe=Zt([-180,-90,180,90]),Dqe="Cannot extend surface to encompass all layers because it would result in too many root tiles.",Nqe="Surface extent is too large for tile resolution at level 0.",Fqe=3;let kqe=Fqe;function yH(t){return t<4?3:kqe}let l_=class extends Sn.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=vP}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(e?.extent==null||e.spatialReference==null)return null;const i=M6(e.extent,e.spatialReference);return i.zmin=e.visibleElevationBounds.min,i.zmax=e.visibleElevationBounds.max,i}get spatialReference(){return this.view.basemapTerrain?.spatialReference??ze.WGS84}elevationAt(e,i){if(this.extent==null||!rl(this.extent,e,i)){const r=this.extent!=null?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return K.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler extent (${r})`),this.noDataValue}return this.view.elevationProvider?.getElevation(e,i,0,this.spatialReference,"ground")??this.noDataValue}queryElevation(e){return dxe(e.clone(),this)}};u([p({readOnly:!0})],l_.prototype,"demResolution",void 0),u([p({readOnly:!0})],l_.prototype,"extent",null),u([p({readOnly:!0})],l_.prototype,"noDataValue",void 0),u([p()],l_.prototype,"spatialReference",null),u([p({constructOnly:!0})],l_.prototype,"view",void 0),l_=u([M("esri.views.support.GroundViewElevationSampler")],l_);const Uqe=l_;let Ag=class extends we{constructor(e){super(e),this.view=null,this.layerViews=new Je}initialize(){this.addHandles(gl(()=>this.view?.map?.ground,e=>e.load())),this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null);for(const e of this.layerViews)e.destroy();this.layerViews.length=0}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new Uqe({view:this.view}):null:null}get extent(){const e=this.view;return e&&e.type!=="2d"&&e.ready?sxe(e,e.state.camera,e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation):null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.removeHandles("updating"),this.addHandles(this.layerViews.map(e=>ne(()=>e.updating,()=>this._updateUpdating(),Zi)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};u([p({readOnly:!0})],Ag.prototype,"elevationSampler",null),u([p({readOnly:!0})],Ag.prototype,"extent",null),u([p({type:Boolean,readOnly:!0})],Ag.prototype,"updating",null),u([p({constructOnly:!0})],Ag.prototype,"view",void 0),u([p({type:Je,readOnly:!0})],Ag.prototype,"layerViews",void 0),u([p({readOnly:!0})],Ag.prototype,"suspended",null),Ag=u([M("esri.views.GroundView")],Ag);const zqe=Ag;let Ry=class{constructor(e,i){this._owner=i,this._properties={},this._afterDispatchHandle=null;for(const r in e){const n=e[r],s=new Xme(n,void 0,void 0,2,2);this._properties[r]={pool:s,acquired:[]}}this._afterDispatchHandle=age(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const i=this._properties[e];for(const r of i.acquired)oie(r)||i.pool.release(r);i.pool.destroy(),i.pool=null,i.acquired=null}this._properties=null,this._owner=null}get(e){const i=this._owner._get(e),r=this._properties[e];let n=r.pool.acquire();for(r.acquired.push(n);n===i;)r.acquired.push(n),n=r.pool.acquire();return n}_release(){for(const e in this._properties){const i=this._properties[e];let r=0;for(const n of i.acquired)oie(n)?i.acquired[r++]=n:i.pool.release(n);i.acquired.length=r}}};const Bqe=ie("mac")?"Meta":"Ctrl",gU={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let t=48;t<58;t++)gU[t]=String.fromCharCode(t);for(let t=1;t<25;t++)gU[111+t]=`F${t}`;for(let t=65;t<91;t++)gU[t]=[String.fromCharCode(t+32),String.fromCharCode(t)];function Vqe(t){if(t.key!==void 0)return Jme(t);const e=gU[t.keyCode];return Array.isArray(e)?t.shiftKey?e[1]:e[0]:e}function Gqe(t){switch(t){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}let jqe=class{constructor(e,i=[]){this.eventType=e,this.keyModifiers=i}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const i=e.modifiers;for(const r of this.keyModifiers)if(!i.has(r))return!1;return!0}};const dse=K.getLogger("esri.views.input.InputHandler");let Ho=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const i=this._incoming[e];for(const r of i)this._incomingEventMatches.push(r.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?dse.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback(i=>this._handleEvent(i)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,i,r){let n;typeof i=="function"?(r=i,n=[]):n=i||[];const s=typeof e=="string"?new jqe(e,n):e,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=h=>{const d=this._incoming[h.match.eventType];if(d){const f=d.indexOf(h);d.splice(f,1),o(),this._manager&&this._manager.updateDependencies()}},l=new Hqe(s,r,{onPause:a,onRemove:a,onResume:h=>{const d=this._incoming[h.match.eventType];d&&!d.includes(h)&&(d.push(h),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[s.eventType];return c||(c=[],this._incoming[s.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const i=new qqe(e,{onEmit:(r,n,s,o)=>{this._manager?.emit(r.eventType,n,s,o)},onRemove:r=>{delete this._outgoing[r.eventType],this._manager?.updateDependencies()}});return this._outgoing[e]=i,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),i}startCapturingPointer(e){this._manager?.setPointerCapture(e,!0)}stopCapturingPointer(e){this._manager?.setPointerCapture(e,!1)}refreshHasPendingInputs(){this._manager?.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):dse.error("This InputHandler is not registered with an InputManager")}_handleEvent(e){const i=this._incoming[e.type];if(i){for(const r of i)if(r.match.matches(e)&&(r.callback?.(e),e.shouldStopPropagation()))break}}},Hqe=class{constructor(e,i,r){this.match=e,this._callback=i,this._handler=r}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},qqe=class{constructor(e,i){this.eventType=e,this._removed=!1,this._handler=i}emit(e,i,r){this._removed||this._handler.onEmit(this,e,i,r)}remove(){this._removed=!0,this._handler.onRemove(this)}},Wqe=class extends Ho{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",i=>{this._update(i.data)})}_update(e){const i=e.native.pointerType==="touch"?"touch":"mouse",{x:r,y:n}=e;i===this._value&&this._x===r&&this._y===n||(this._value=i,this._x=r,this._y=n,this._onChange(i,r,n))}},Yqe=class extends Ho{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=UE(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},wh=class extends we{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=Bqe,this._latestPointerType="mouse",this._propertiesPool=new Ry({latestPointerLocation:Jqe},this),this.latestPointerLocation=null,this._paused=!1,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const i of e)this.uninstallHandlers(i);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get updating(){return this.hasPendingInputs||this._paused}installHandlers(e,i,r=cv.INTERNAL){if(this._nameToGroup[e])return void K.getLogger(this).error("There is already an InputHandler group registered under the name `"+e+"`");if(i.length===0)return void K.getLogger(this).error("Can't register a group of zero handlers");const n={name:e,handlers:i.map(s=>({handler:s,active:!0,removed:!1,priorityIndex:0,groupPriority:r,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=n;for(let s=n.handlers.length-1;s>=0;s--){const o=n.handlers[s];this._handlers.push(o),o.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(a,l,c,h,d)=>{this._emitInputEvent(o.priorityIndex+1,a,l,c,d,h)},setPointerCapture:(a,l)=>{this._setPointerCapture(n,o,a,l)},setEventCallback:a=>{o.eventCallback=a},setUninstallCallback:a=>{o.uninstallCallback=a},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const i=this._nameToGroup[e];i?(i.handlers.forEach(r=>{r.removed=!0,r.uninstallCallback?.()}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):K.getLogger(this).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,i=new Set;this._handlersPriority=[];for(let r=this._handlers.length-1;r>=0;r--){const n=this._handlers[r];n.priorityIndex=r,this._handlersPriority.push(n)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let r=this._handlersPriority.length-1;r>=0;r--){const n=this._handlersPriority[r];n.priorityIndex=r;let s=n.handler.hasSideEffects;if(!s){for(const o of n.handler.outgoingEventTypes)if(e.has(o)){s=!0;break}}if(s)for(const o of n.handler.incomingEventMatches){e.add(o.eventType);for(const a of o.keyModifiers)Gqe(a)||i.add(a)}n.active=s}this._sourceEvents=e,this._keyModifiers=i,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,i,r){this._latestPointerType=e;const n=this._get("latestPointerLocation");if(n==null||n.x!==i||n.y!==r){const s=this._propertiesPool.get("latestPointerLocation");s.x=i,s.y=r,this._set("latestPointerLocation",s)}}_onEventReceived(e,i){if(e==="pointer-capture-lost"){const s=i;this._pointerCaptures.delete(s.native.pointerId)}this._updateKeyModifiers(e,i);const r=this.test.timestamp!=null?this.test.timestamp:i.native?i.native.timestamp:void 0,n=i.native?i.native.cancelable:void 0;this._emitInputEventFromSource(e,i,r,n)}_updateKeyModifiers(e,i){if(!i)return;let r=!1;const n=()=>{if(!r){const a=new Set;this._activeKeyModifiers.forEach(l=>{a.add(l)}),this._activeKeyModifiers=a,r=!0}},s=(a,l)=>{l&&!this._activeKeyModifiers.has(a)?(n(),this._activeKeyModifiers.add(a)):!l&&this._activeKeyModifiers.has(a)&&(n(),this._activeKeyModifiers.delete(a))};if(e==="key-down"||e==="key-up"){const a=i.key;this._keyModifiers.has(a)&&s(a,e==="key-down")}const o=i.native;s("Alt",!(!o||!o.altKey)),s("Ctrl",!(!o||!o.ctrlKey)),s("Shift",!(!o||!o.shiftKey)),s("Meta",!(!o||!o.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new Wqe((e,i,r)=>this._setLatestPointer(e,i,r)),this._multiTouchHandler=new Yqe,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],cv.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,cv.INTERNAL)}_setPointerCapture(e,i,r,n){const s=e.name+"-"+i.priorityIndex,o=this._pointerCaptures.get(r.pointerId)||new Set;this._pointerCaptures.set(r.pointerId,o),n?(o.add(s),o.size===1&&this.eventSource&&this.eventSource.setPointerCapture(r,!0)):o.has(s)&&(o.delete(s),o.size===0&&(this._pointerCaptures.delete(r.pointerId),this.eventSource&&this.eventSource.setPointerCapture(r,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,i,r,n){this._emitInputEvent(0,e,i,r,n)}_emitInputEvent(e,i,r,n,s,o){const a=n!==void 0?n:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),l=s!==void 0&&s,c={event:new Xqe(i,r,a,o||this._activeKeyModifiers,l),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(e){this._currentPropagation={events:new rF,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){this._paused=!1;const e=this._currentPropagation;if(e){for(;e.events.length>0;){const{event:i,priorityIndex:r}=e.events.pop(),n=i.data?.eventId;if(!(n!=null&&this._stoppedPropagationEventIds.has(n)))for(e.currentHandler=this._handlersPriority[r];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!i.shouldStopPropagation()&&e.currentHandler.eventCallback?.(i),i.shouldStopPropagation()){n!=null&&this._stoppedPropagationEventIds.add(n);break}if(i.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:i,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const i=new rF;i.push(e);const r=this._currentPropagation;if(r){for(;r.events.length;)i.push(r.events.pop());r.events=i,r.currentHandler=null,this._paused=!0}}_compareHandlerPriority(e,i){if(e.handler.hasSideEffects!==i.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==i.groupPriority)return e.groupPriority>i.groupPriority?-1:1;for(const r of e.handler.incomingEventMatches)for(const n of i.handler.incomingEventMatches){if(r.eventType!==n.eventType)continue;const s=r.keyModifiers.filter(o=>n.keyModifiers.includes(o));if(s.length===r.keyModifiers.length!=(s.length===n.keyModifiers.length))return r.keyModifiers.length>n.keyModifiers.length?-1:1}return e.priorityIndex>i.priorityIndex?-1:1}_sortHandlersPriority(e){const i=[];for(const r of e){let n=0;for(;n<i.length&&this._compareHandlerPriority(r,i[n])>=0;)n++;i.splice(n,0,r)}return i}get debug(){const e=i=>{const r=this._setPointerCapture;this._setPointerCapture=()=>{},i(),this._setPointerCapture=r};return{injectEvent:(i,r)=>{e(()=>{this._onEventReceived(i,r)})},disablePointerCapture:e}}};u([p({readOnly:!0})],wh.prototype,"hasPendingInputs",null),u([p({constructOnly:!0})],wh.prototype,"eventSource",void 0),u([p({constructOnly:!0})],wh.prototype,"recognizers",void 0),u([p()],wh.prototype,"_latestPointerType",void 0),u([p()],wh.prototype,"latestPointerType",null),u([p()],wh.prototype,"multiTouchActive",null),u([p({readOnly:!0})],wh.prototype,"latestPointerLocation",void 0),u([p()],wh.prototype,"_paused",void 0),u([p({readOnly:!0})],wh.prototype,"updating",null),wh=u([M("esri.views.input.InputManager")],wh);let Xqe=class{constructor(e,i,r,n,s){this.type=e,this.data=i,this.timestamp=r,this.modifiers=n,this.cancelable=s,this._propagationState=P_.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=P_.STOPPED}shouldStopPropagation(){return(this._propagationState&P_.STOPPED)!=0}async(e){this._propagationState|=P_.PAUSED;const i=(r,n)=>{this._propagationState&=~P_.PAUSED;const s=this._resumeCallback;if(this._resumeCallback=null,s&&s(),n)throw r;return r};return(typeof e=="function"?e():e).then(r=>i(r,!1),r=>i(r,!0))}shouldPausePropagation(e){return!!(this._propagationState&P_.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var P_;(function(t){t[t.NONE=0]="NONE",t[t.STOPPED=1]="STOPPED",t[t.PAUSED=2]="PAUSED"})(P_||(P_={}));const cv={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let Zqe=class{};const Jqe=Zqe;function tf(t){return t!=null&&"open"in t&&"declaredClass"in t}function pse(t){return t!=null&&"declaredClass"in t&&"dockOptions"in t}const Kqe=t=>{let e=class extends t{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([ne(()=>[this.ui,this.popup],([i,r],n)=>{const s="popup",o="manual";if(n){const[a,l]=n;a&&tf(l)&&(l.view=null,pse(l)&&a.remove(l,s))}i&&tf(r)&&(r.view=this,pse(r)&&i.add(r,{key:s,position:o,internal:!0}))},Xt),this.on("click",i=>{this.popup&&this.popupEnabled&&(i.pointerType!=="mouse"||i.button===0)&&(!tf(this.popup)&&"autoOpenEnabled"in this.popup&&this.popup.autoOpenEnabled===!1||(tf(this.popup)?this.popup.viewModel.handleViewClick(i):i.async(async()=>{await this.setupPopup(),tf(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(i)})))},cv.WIDGET)]),Tv(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{ce(()=>import("./Popup-ddeecd9f.js"),["./Popup-ddeecd9f.js","./unitFormatUtils-8c430bad.js","./AttachmentInfo-1af1e30b.js","./utils-e4f79b61.js","./symbolUtils-67cc8a74.js","./executeQueryJSON-c894fe77.js","./query-329b2ac1.js","./pbfQueryUtils-2cf66e2d.js","./pbf-b60d46d3.js","./queryZScale-47976d5a.js","./FeatureSet-20ce479f.js","./TopFeaturesQuery-62024588.js","./FeatureLayer-4b20d634.js","./FeatureLayerBase-d5b34521.js","./LayerFloorInfo-2c0a736f.js","./serviceCapabilitiesUtils-979570ad.js","./editsZScale-edfeccc6.js","./APIKeyMixin-3e91b31f.js","./EditBusLayer-4de7f58b.js","./OrderedLayer-ea33712e.js","./FeatureTemplate-1a55ea44.js","./FeatureType-c8e18d40.js","./versionUtils-f448b405.js","./ReactiveSet-eabb3c3b.js"],import.meta.url)})}destroy(){this.destroyed||this.closePopup()}async openPopup(i){if(tf(this.popup))return this.popup.open(i);try{if(await this.setupPopup(),!this.popup)return void K.getLogger(this).error(new G("view:null-popup","Popup is null and can't be opened"));this.popup.open(i)}catch{}}closePopup(){this._popupSetupTask?.abort(),tf(this.popup)&&this.popup.close()}async fetchPopupFeatures(i,r){await this.when();const{location:n,queryArea:s,layerViewsAndGraphics:o,clientOnlyGraphics:a}=await this._prepareFetchPopupFeatures(i,r),l=Promise.resolve(a),c=this._queryLayerPopupFeatures(s,o,r),h=c.map(d=>d.promise);return{location:n,clientOnlyGraphics:a,allGraphicsPromise:jLe([l,...h]).then(d=>Array.from(new Set(d.flat()))),promisesPerLayerView:c}}async setupPopup(){if(this._popupSetupTask?.abort(),this.popup&&!tf(this.popup))return this._popupSetupTask=Xv(async i=>{const{default:r}=await ce(()=>import("./Popup-ddeecd9f.js"),["./Popup-ddeecd9f.js","./unitFormatUtils-8c430bad.js","./AttachmentInfo-1af1e30b.js","./utils-e4f79b61.js","./symbolUtils-67cc8a74.js","./executeQueryJSON-c894fe77.js","./query-329b2ac1.js","./pbfQueryUtils-2cf66e2d.js","./pbf-b60d46d3.js","./queryZScale-47976d5a.js","./FeatureSet-20ce479f.js","./TopFeaturesQuery-62024588.js","./FeatureLayer-4b20d634.js","./FeatureLayerBase-d5b34521.js","./LayerFloorInfo-2c0a736f.js","./serviceCapabilitiesUtils-979570ad.js","./editsZScale-edfeccc6.js","./APIKeyMixin-3e91b31f.js","./EditBusLayer-4de7f58b.js","./OrderedLayer-ea33712e.js","./FeatureTemplate-1a55ea44.js","./FeatureType-c8e18d40.js","./versionUtils-f448b405.js","./ReactiveSet-eabb3c3b.js"],import.meta.url);if(Tt(i),!this.popup||tf(this.popup))return;const n=this.popup;delete n.open,delete n.close,this.popup=new r(n)}),this._popupSetupTask.promise}_queryLayerPopupFeatures(i,r,n){return r.map(({layerView:s,graphics:o})=>{const a={clientGraphics:o,event:n?.event,signal:n?.signal,defaultPopupTemplateEnabled:n!=null&&!!n.defaultPopupTemplateEnabled},l=s.fetchPopupFeatures(i,a);return{layerView:s,promise:l}})}_isValidPopupGraphic(i,r){return i&&!!i.getEffectivePopupTemplate(r!=null&&r.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(i,r){const{clientGraphics:n,queryArea:s,location:o}=await this._popupHitTestGraphics(i,r),a=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:l,clientOnlyGraphics:c}=this._graphicsPerFetchPopupLayerView(n,a);return{clientOnlyGraphics:c,layerViewsAndGraphics:l,queryArea:s,location:o}}async _popupHitTestGraphics(i,r){const n=await this.popupHitTest(i),s=n.results,o=n.mapPoint,a=s.filter(c=>c.type==="graphic"&&this._isValidPopupGraphic(c.graphic,r)),l=a.length?a[0].mapPoint:null;return{clientGraphics:a.map(c=>c.graphic),queryArea:o,location:o||l}}_getFetchPopupLayerViews(){const i=[];return this.allLayerViews.forEach(r=>{this._isValidPopupLayerView(r)&&i.push(r)}),this.graphicsView!=null&&this._isValidPopupLayerView(this.graphicsView)&&i.push(this.graphicsView),i.reverse()}_isValidPopupLayerView(i){return i!=null&&(!("layer"in i)||!i.suspended)&&"fetchPopupFeatures"in i}_graphicsPerFetchPopupLayerView(i,r){const n=[],s=new Map,o=r.map(a=>{const l=[];return"layer"in a?s.set(a.layer,l):s.set(a.graphics,l),{layerView:a,graphics:l}});for(const a of i){const l=s.get(a.layer)||s.get(a.sourceLayer)||null;l?l.push(a):n.push(a)}return{layerViewsAndGraphics:o,clientOnlyGraphics:n}}};return u([p({cast(i){return!i||tf(i)||typeof i=="object"&&(i.open=r=>(xE(K.getLogger(this),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",version:"4.27"}),this.openPopup(r)),i.close=()=>(xE(K.getLogger(this),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",{replacement:"Use view.closePopup() instead.",version:"4.27"}),this.closePopup())),i}})],e.prototype,"popup",void 0),u([p()],e.prototype,"popupEnabled",void 0),e=u([M("esri.views.PopupView")],e),e},fse={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8};function qw(t,e,i,r=Rm){const n=new Lp(oJ(r)),s=si.fromJSDate(t,{zone:n}),o=i==="decades"||i==="centuries"?"year":gxe(i);return i==="decades"&&(e*=10),i==="centuries"&&(e*=100),s.plus({[o]:e}).toJSDate()}function mse(t,e,i=Rm){const r=new Lp(oJ(i)),n=si.fromJSDate(t,{zone:r});if(e==="decades"||e==="centuries"){const o=n.startOf("year"),{year:a}=o,l=a-a%(e==="decades"?10:100);return o.set({year:l}).toJSDate()}const s=gxe(e);return n.startOf(s).toJSDate()}function Qqe(t,e,i){return t===0?0:t*fse[e]/fse[i]}function dLt(t,e){return t&&e?t.intersection(e):t||e}function gxe(t){switch(t){case"milliseconds":return"millisecond";case"seconds":return"second";case"minutes":return"minute";case"hours":return"hour";case"days":return"day";case"weeks":return"week";case"months":return"month";case"years":return"year"}}var zd;let Tu=zd=class extends pe{static get allTime(){return gse}static get empty(){return eWe}constructor(t){super(t),this.end=null,this.start=null}readEnd(t,e){return e.end!=null?new Date(e.end):null}writeEnd(t,e){e.end=t?.getTime()??null}get isAllTime(){return this.equals(zd.allTime)}get isEmpty(){return this.equals(zd.empty)}readStart(t,e){return e.start!=null?new Date(e.start):null}writeStart(t,e){e.start=t?.getTime()??null}clone(){return new zd({end:this.end,start:this.start})}equals(t){if(!t)return!1;const e=this.start?.getTime()??this.start,i=this.end?.getTime()??this.end,r=t.start?.getTime()??t.start,n=t.end?.getTime()??t.end;return e===r&&i===n}expandTo(t,e=Rm){if(this.isEmpty||this.isAllTime)return this.clone();let i=this.start;i&&(i=mse(i,t,e));let r=this.end;if(r){const n=mse(r,t,e);r=r.getTime()===n.getTime()?n:qw(n,1,t,e)}return new zd({start:i,end:r})}intersection(t){if(!t)return this.clone();if(this.isEmpty||t.isEmpty)return zd.empty;if(this.isAllTime)return t.clone();if(t.isAllTime)return this.clone();const e=this.start?.getTime()??-1/0,i=this.end?.getTime()??1/0,r=t.start?.getTime()??-1/0,n=t.end?.getTime()??1/0;let s,o;if(r>=e&&r<=i?s=r:e>=r&&e<=n&&(s=e),i>=r&&i<=n?o=i:n>=e&&n<=i&&(o=n),s!=null&&o!=null&&!isNaN(s)&&!isNaN(o)){const a=new zd;return a.start=s===-1/0?null:new Date(s),a.end=o===1/0?null:new Date(o),a}return zd.empty}offset(t,e,i=Rm){if(this.isEmpty||this.isAllTime)return this.clone();const r=new zd,{start:n,end:s}=this;return n!=null&&(r.start=qw(n,t,e,i)),s!=null&&(r.end=qw(s,t,e,i)),r}union(t){if(!t||t.isEmpty)return this.clone();if(this.isEmpty)return t.clone();if(this.isAllTime||t.isAllTime)return gse.clone();const e=this.start!=null&&t.start!=null?new Date(Math.min(this.start.getTime(),t.start.getTime())):null,i=this.end!=null&&t.end!=null?new Date(Math.max(this.end.getTime(),t.end.getTime())):null;return new zd({start:e,end:i})}};u([p({type:Date,json:{write:{allowNull:!0}}})],Tu.prototype,"end",void 0),u([wt("end")],Tu.prototype,"readEnd",null),u([Be("end")],Tu.prototype,"writeEnd",null),u([p({readOnly:!0,json:{read:!1}})],Tu.prototype,"isAllTime",null),u([p({readOnly:!0,json:{read:!1}})],Tu.prototype,"isEmpty",null),u([p({type:Date,json:{write:{allowNull:!0}}})],Tu.prototype,"start",void 0),u([wt("start")],Tu.prototype,"readStart",null),u([Be("start")],Tu.prototype,"writeStart",null),Tu=zd=u([M("esri.TimeExtent")],Tu);const gse=new Tu,eWe=new Tu({start:void 0,end:void 0}),Gy=Tu;let oR=class extends rR{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};u([Qge({Type:vx,ensureType:as(vx)})],oR.prototype,"itemType",void 0),oR=u([M("esri.support.GraphicsCollection")],oR);let c_=class extends we{constructor(e){super(e),this.view=null,this.baseLayerViews=new Je,this.referenceLayerViews=new Je,this._loadingHandle=ne(()=>this.view?.map?.basemap,i=>{i&&i.load().catch(()=>{})},Xt)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(const e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return!this.view||this.view.suspended}get updating(){if(this.view&&this.view.suspended)return!1;const e=this.view?.map?.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(i=>i.updating)||this.referenceLayerViews.some(i=>i.updating))}};u([p({constructOnly:!0})],c_.prototype,"view",void 0),u([p({readOnly:!0})],c_.prototype,"baseLayerViews",void 0),u([p({readOnly:!0})],c_.prototype,"referenceLayerViews",void 0),u([p({readOnly:!0})],c_.prototype,"suspended",null),u([p({type:Boolean,readOnly:!0})],c_.prototype,"updating",null),c_=u([M("esri.views.BasemapView")],c_);function tWe(t){return"tryRecycleWith"in t}let iWe=class{constructor(e,i,r){this.layer=e,this.view=i,this.layerViewImporter=r,this._controller=new AbortController,this._deferred=Hs(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,Ms(this._controller.signal,()=>{const n=new G("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(n)})}tryRecycle(e){if(!this.done||!this.layerView||!tWe(this.layerView))return null;const i=this.layer.type,r=this._controller.signal;for(let n=0;n<e.length;n++){const s=e[n];if(s.type!==i)continue;const o=this.layerView.tryRecycleWith(s,{signal:r});if(o){e.splice(n,1),this.layer=s;const a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(Tt(this._controller.signal),s.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),s.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((c,h)=>Ms(this._controller.signal,()=>h(Ti())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:i,view:r}=this;i.emit("layerview-destroy",{view:r,layerView:e}),r.emit("layerview-destroy",{layer:i,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:i,view:r}=this;this._map=r.map;try{let n,s;if(await i.load({signal:e}),i.prefetchResources&&await i.prefetchResources({signal:e}),nWe(i))n=await i.createLayerView(r,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(i))throw new G("layer:view-not-supported","No layerview implementation was found");const l=await this.layerViewImporter.importLayerView(i);Tt(e),n="default"in l?new l.default({layer:i,view:r}):new l({layer:i,view:r})}const o=()=>{s=Tr(s),n.destroyed||n.destroy(),n.layer=null,n.parent=null,n.view=null,this.done=!0};s=Ms(e,o),Tt(e);try{await n.when()}catch(l){throw o(),l}if(!this._map?.allLayers?.includes(i))return o(),void this._deferred.reject(new G("view:no-layerview-for-layer","The layer has been removed from the map",{layer:i}));this.layerView=n,i.emit("layerview-create",{view:r,layerView:n}),r.emit("layerview-create",{layer:i,layerView:n}),this.done=!0,this._deferred.resolve(n)}catch(n){i.emit("layerview-create-error",{view:r,error:n}),r.emit("layerview-create-error",{layer:i,error:n}),this.done=!0,this._deferred.reject(new G("layerview:create-error","layerview creation failed",{layer:i,error:n}))}}},xh=class extends we{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new Cp,this.supportsGround=!0,this._preloadLayerViewModules=()=>{const i=this.view.map?.allLayers;if(i)for(const r of i)this.layerViewImporter.hasLayerViewModule(r)&&this.layerViewImporter.importLayerView(r)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=Hs(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(Ux(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{if(this.destroyed)return;const i=this.view.map;if(this._map!==i&&(this.clear(),this._map=i),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const r=new Set,n=[],s=this.view.ready,o=l=>{if(l!=null){for(const c of l)if(c){r.add(c);const h=this._layerLayerViewInfoMap.get(c);h&&s?h.start():h||this._recyclingInfoMap.has(c)||n.push(c),"layers"in c&&c.layers&&o(c.layers)}}};for(const l of this._rootCollectionNames)o(Hl(this,l));for(const[l,c]of this._layerLayerViewInfoMap)if(!r.has(l)){this._layerLayerViewInfoMap.delete(c.layer);const h=c.tryRecycle(n);h?(this.notifyChange("updating"),this._recyclingInfoMap.set(c.layer,c),h.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(c.layer),this._layerLayerViewInfoMap.set(c.layer,c),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(c.layer),c.destroy(),this._reschedule()})):c.destroy()}for(const[l,c]of this._recyclingInfoMap)r.has(l)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(c.layer),c.destroy());for(const l of n)this._createLayerView(l);this._refreshCollections();const a=[i?.ground?.layers,i?.basemap?.baseLayers,i?.basemap?.referenceLayers,i?.layers].filter(l=>!!l);r.forEach(l=>"layers"in l&&a.push(l.layers)),this.addHandles(a.map(l=>this._watchUpdatingTracking.addOnCollectionChange(()=>l,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.addHandles([bo(()=>this.view?.map?.allLayers,"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),ne(()=>{const e=this.view,i=e?.map;return[i?.basemap,i?.ground,i?.layers,e?.ready]},()=>this._reschedule(),Ji)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),H8(this._recyclingInfoMap),H8(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(Ti()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||$u(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const i of this._layerLayerViewInfoMap.values())i.done||++e;return e}clear(){this.destroyed||(H8(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new G("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,i]of this._layersToLayerViews)this._populateLayerViewsOwners(Hl(this,e),Hl(this,i),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,i,r){if(!e||!i)return void(i&&i.removeAll());let n=0;for(const s of e){const o=this._layerLayerViewInfoMap.get(s);if(!o?.layerView)continue;const a=o.layerView;a.layer=s,a.parent=r,i.at(n)!==a&&i.splice(n,0,a),s.layers&&this._populateLayerViewsOwners(s.layers,a.layerViews,a),n+=1}n<i.length&&i.splice(n,i.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const i=new iWe(e,this.view,this.layerViewImporter);i.promise.then(()=>this._refreshCollections(),r=>{r&&(Tn(r)||r.name==="cancelled:layerview-create")||K.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:r}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,i),this.view.ready&&i.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};u([p()],xh.prototype,"_workPromise",void 0),u([p({readOnly:!0})],xh.prototype,"_watchUpdatingTracking",void 0),u([p({readOnly:!0})],xh.prototype,"_layersToLayerViews",null),u([p({readOnly:!0})],xh.prototype,"_rootCollectionNames",null),u([p()],xh.prototype,"layerViewImporter",void 0),u([p()],xh.prototype,"supportsGround",void 0),u([p({readOnly:!0})],xh.prototype,"updating",null),u([p({readOnly:!0})],xh.prototype,"updatingRemaining",null),u([p({constructOnly:!0})],xh.prototype,"view",void 0),xh=u([M("esri.views.LayerViewManager")],xh);const rWe=xh;function nWe(t){return"createLayerView"in t&&t.createLayerView!=null}let hu=class extends we{constructor(e){super(e),this.factor=1.5,this.offset=ed(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};u([p({type:Number})],hu.prototype,"factor",void 0),u([p({nonNullable:!0})],hu.prototype,"offset",void 0),u([p()],hu.prototype,"position",void 0),u([p({type:Number,range:{min:0}})],hu.prototype,"size",void 0),u([p()],hu.prototype,"maskUrl",void 0),u([p()],hu.prototype,"maskEnabled",void 0),u([p()],hu.prototype,"overlayUrl",void 0),u([p()],hu.prototype,"overlayEnabled",void 0),u([p({readOnly:!0})],hu.prototype,"version",null),u([p({type:Boolean})],hu.prototype,"visible",void 0),hu=u([M("esri.views.Magnifier")],hu);const yxe=hu;let V3=class extends es(we){constructor(e){super(e),this.accentColor=new Pe([255,127,0]),this.textColor=new Pe([255,255,255])}};u([p({type:Pe,nonNullable:!0})],V3.prototype,"accentColor",void 0),u([p({type:Pe,nonNullable:!0})],V3.prototype,"textColor",void 0),V3=u([M("esri.views.Theme")],V3);const _H=V3;var yse;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"})(yse||(yse={}));const _xe=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],vxe={};function bxe(t){return!!vxe[t]}function sWe(t){for(const e of t)if(!bxe(e))return!1;return!0}_xe.forEach(t=>{vxe[t]=!0});let oWe=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:i,priority:r},n)=>this.inputManager?.installHandlers(n,[i],r))}disconnect(){this.inputManager&&this._handlers.forEach((e,i)=>this.inputManager?.uninstallHandlers(i)),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,i,r,n){const s=Array.isArray(e)?e:e.split(",");if(!sWe(s))return s.some(bxe)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(i)?a=i:(o=i,a=[]),typeof r=="function"?o=r:n=r,n=n??cv.DEFAULT;const l=this._createUniqueGroupName(),c=new aWe(this.view,s,a,o);this._handlers.set(l,{handler:c,priority:n});for(const h of s){const d=this._handlerCounts.get(h)||0;this._handlerCounts.set(h,d+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],n),Vi(()=>this._removeHandler(l,s))}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,i){if(this._handlers.has(e)){this._handlers.delete(e);for(const r of i){const n=this._handlerCounts.get(r);n===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",r):n===1?this._handlerCounts.delete(r):this._handlerCounts.set(r,n-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},aWe=class extends Ho{constructor(e,i,r,n){super(!0),this._latestDragStart=void 0,this.view=e;for(const s of i)switch(s){case"click":this.registerIncoming("click",r,o=>n(this._wrapClick(o)));break;case"double-click":this.registerIncoming("double-click",r,o=>n(this._wrapDoubleClick(o)));break;case"immediate-click":this.registerIncoming("immediate-click",r,o=>n(this._wrapImmediateClick(o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",r,o=>n(this._wrapImmediateDoubleClick(o)));break;case"hold":this.registerIncoming("hold",r,o=>n(this._wrapHold(o)));break;case"drag":this.registerIncoming("drag",r,o=>{const a=this._wrapDrag(o);a&&n(a)});break;case"key-down":this.registerIncoming("key-down",r,o=>n(this._wrapKeyDown(o)));break;case"key-up":this.registerIncoming("key-up",r,o=>n(this._wrapKeyUp(o)));break;case"pointer-down":this.registerIncoming("pointer-down",r,o=>n(this._wrapPointer(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",r,o=>n(this._wrapPointer(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",r,o=>n(this._wrapPointer(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",r,o=>n(this._wrapPointerDrag(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",r,o=>n(this._wrapMouseWheel(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",r,o=>n(this._wrapPointer(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",r,o=>n(this._wrapPointer(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",r,o=>{n(this._wrapGamepad(o))});break;case"focus":this.registerIncoming("focus",r,o=>{n(this._wrapFocus(o))});break;case"blur":this.registerIncoming("blur",r,o=>{n(this._wrapBlur(o))})}}_wrapFocus(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:i=>e.async(i),preventDefault:()=>e.preventDefault()}}_wrapBlur(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:i=>e.async(i),preventDefault:()=>e.preventDefault()}}_wrapClick(e){const{pointerType:i,button:r,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:h}=e;return{type:"click",pointerType:i,button:r,buttons:n,x:s,y:o,native:a,timestamp:h,screenPoint:ed(s,o),mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}_wrapDoubleClick(e){const{pointerType:i,button:r,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:h}=e;return{type:"double-click",pointerType:i,button:r,buttons:n,x:s,y:o,native:a,timestamp:h,mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}_wrapImmediateClick(e){const{pointerType:i,button:r,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:h,timestamp:d}=e;return{type:"immediate-click",pointerId:c,pointerType:i,button:r,buttons:n,x:s,y:o,native:a,timestamp:d,mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}_wrapImmediateDoubleClick(e){const{pointerType:i,button:r,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:h,timestamp:d}=e;return{type:"immediate-double-click",pointerId:c,pointerType:i,button:r,buttons:n,x:s,y:o,native:a,timestamp:d,mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}_wrapHold(e){const{pointerType:i,button:r,buttons:n,x:s,y:o,native:a}=e.data,{cancelable:l,timestamp:c}=e;return{type:"hold",pointerType:i,button:r,buttons:n,x:s,y:o,native:a,timestamp:c,mapPoint:this._getMapPoint(s,o),cancelable:l,stopPropagation:()=>e.stopPropagation(),async:h=>e.async(h),preventDefault:()=>e.preventDefault()}}_getMapPoint(e,i){return this.view.toMap(ed(e,i),{exclude:[]})}_wrapDrag(e){const i=e.data,{x:r,y:n}=i.center,{action:s,pointerType:o,button:a}=i;if(s==="start"&&(this._latestDragStart=i),!this._latestDragStart)return;const l=i.pointer.native,c=i.buttons,{cancelable:h,timestamp:d}=e,f={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return s==="end"&&(this._latestDragStart=void 0),{type:"drag",action:s,x:r,y:n,origin:f,pointerType:o,button:a,buttons:c,radius:i.radius,angle:ml(i.angle),native:l,timestamp:d,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}_wrapKeyDown(e){const{key:i,repeat:r,native:n}=e.data,{cancelable:s,timestamp:o}=e;return{type:"key-down",key:i,repeat:r,native:n,timestamp:o,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:a=>e.async(a),preventDefault:()=>e.preventDefault()}}_wrapKeyUp(e){const{key:i,native:r}=e.data,{cancelable:n,timestamp:s}=e;return{type:"key-up",key:i,native:r,timestamp:s,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:o=>e.async(o),preventDefault:()=>e.preventDefault()}}_wrapPointer(e,i){const{x:r,y:n,button:s,buttons:o,native:a,eventId:l}=e.data,c=a.pointerId,h=a.pointerType,{cancelable:d,timestamp:f}=e;return{type:i,x:r,y:n,pointerId:c,pointerType:h,button:s,buttons:o,native:a,timestamp:f,eventId:l,cancelable:d,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}_wrapPointerDrag(e){const{x:i,y:r,buttons:n,native:s,eventId:o}=e.data.currentEvent,{button:a}=e.data.startEvent,l=e.data.startEvent.native.pointerId,c=e.data.startEvent.native.pointerType,h=e.data.action,d={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:f,timestamp:m}=e;return{type:"pointer-drag",x:i,y:r,pointerId:l,pointerType:c,button:a,buttons:n,action:h,origin:d,native:s,timestamp:m,eventId:o,cancelable:f,stopPropagation:()=>e.stopPropagation(),async:y=>e.async(y),preventDefault:()=>e.preventDefault()}}_wrapMouseWheel(e){const{cancelable:i,data:r,timestamp:n}=e,{x:s,y:o,deltaY:a,native:l}=r;return{type:"mouse-wheel",x:s,y:o,deltaY:a,native:l,timestamp:n,cancelable:i,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}_wrapGamepad(e){const{action:i,state:r,device:n}=e.data,{cancelable:s,timestamp:o}=e,{buttons:a,axes:l}=r;return{type:"gamepad",device:n,timestamp:o,action:i,buttons:a,axes:l,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}};var bP,_se,vse;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})(bP||(bP={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}(_se||(_se={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(vse||(vse={}));function lWe(t){return[t.on("before-add",e=>{const i=e.item;if(i==null||t.includes(i))return K.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();i.onAdd()}),t.on("after-remove",e=>{const i=e.item;i.active&&(i.view.activeTool=null),i.destroy()})]}function vH(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag(bP.USER)&&t.getEditableFlag(bP.MANAGER)}function Mf(t){return ed(t.x,t.y)}function wLt(t){return cn(t.x,t.y)}function wxe(t,e){const i=(t instanceof HTMLElement?t:t.surface)?.getBoundingClientRect();return i?ed(e.clientX-i.left,e.clientY-i.top):ed(0,0)}function bse(t,e){return e instanceof Event?wxe(t,e):Mf(e)}function wse(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let cWe=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,i){const r=()=>e.stopPropagation();switch(e.type){case"pointer-move":xse(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(r(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!Tse(e))break;const n=Mf(e),s=this._intersect(n,e.pointerType,i.forEachTool);if(s==null)break;const o=s.manipulator,a=s.tool;o==null||a==null||!o.interactive||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._ungrabManipulatorBeforeDragging(o,e,i),o!=null&&a!=null&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:o,tool:a,start:n,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&i.activeTool==null&&(this._revertToNullActiveTool=!0,i.setActiveTool(s.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:n}),r());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,i);break;case"pointer-drag":{if(!Tse(e))break;const n=this._grabbedManipulators.get(e.pointerId),s=n?.manipulator,o=n?.tool;if(s==null||o==null)break;const a=Mf(e);a.x=_e(a.x,0,i.view.width),a.y=_e(a.y,0,i.view.height);const l=n.start,c=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(s.dragging=!0,c?s.events.emit("drag",{action:"update",start:l,screenPoint:a}):s.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:o,manipulator:s,start:l}));break;case"end":s.dragging=!1,c&&s.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,i)}r();break}case"immediate-click":{const n=Mf(e),s=this._intersect(n,e.pointerType,i.forEachTool);if(uWe(e)||i.forEachTool(c=>{if((s==null||s.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let h=!1;c.manipulators.forEach(({manipulator:d})=>{d.selected&&(d.selected=!1,h=!0)}),h&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),s==null)break;const{manipulator:o,tool:a}=s;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const l=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:r}),Ez(o,r);break}case"click":{const n=Mf(e),s=this._intersect(n,e.pointerType,i.forEachTool),o=s?.manipulator;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit(e.type,{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a}),r();break}case"double-click":{const n=Mf(e),s=this._intersect(n,e.pointerType,i.forEachTool),o=s!=null?s.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("double-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:r}),Ez(o,r);break}case"immediate-double-click":{const n=Mf(e),s=this._intersect(n,e.pointerType,i.forEachTool),o=s!=null?s.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:r}),Ez(o,r);break}}this._onFocusChange(i.forEachTool)}_ungrabManipulatorBeforeDragging(e,i,r){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:i.pointerType,screenPoint:Mf(i)}),this._grabbedManipulators.forEach(({manipulator:n},s)=>{n===e&&this._grabbedManipulators.delete(s)}),this._afterManipulatorUngrab(r.setActiveTool)}_handlePointerEnd(e,i){const r=this._grabbedManipulators.get(e.pointerId)?.manipulator;r!=null&&r.grabbing&&(r.grabbing=!1,r.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:Mf(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorUngrab(i.setActiveTool))}_cursorFromMap(e){let i=null;return $u(e,({manipulator:r})=>!(r==null||!r.interactive)&&(r.grabbing&&r.grabCursor?(i=r.grabCursor,!0):!!r.cursor&&(i=r.cursor,!0))),i}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const i=new Set,r=new Set;this._grabbedManipulators.forEach(({tool:n})=>{i.add(n)}),this._hoveredManipulators.forEach(({tool:n})=>{r.add(n)}),e(n=>{n.hasGrabbedManipulators=i.has(n),n.hasHoveredManipulators=r.has(n);const s=this._grabbedManipulators.values(),o=pLe(s,({tool:a})=>a===n);n.firstGrabbedManipulator=o!=null?o.manipulator:null})}clearPointers(e,{forEachTool:i,setActiveTool:r},n=!0,s){const o=(a,l)=>a===e&&(s==null||s===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},h)=>{o(a,l)&&(this._grabbedManipulators.delete(h),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),n&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorUngrab(r),this._onFocusChange(i)}_intersect(e,i,r){let n=null;return r(s=>{if(s.manipulators==null||!vH(s))return!1;const o=s.manipulators.intersect(e,i);return o!=null&&(n={tool:s,manipulator:o},!0)}),n}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((i,r)=>{this._updateHoveredStateForPointerAtScreenPosition(ed(i.x,i.y),r,i.pointerType,e)})}handleHoverEvent(e,i){e.type!=="pointer-up"&&e.type!=="immediate-click"&&e.type!=="pointer-move"||!xse(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(Mf(e),e.pointerId,e.pointerType,i)}_updateHoveredStateForPointerAtScreenPosition(e,i,r,n){let s=this._intersect(e,r,n);const o=this._hoveredManipulators.get(i)?.manipulator;s==null||s.manipulator.interactive||(s=null),s!=null&&o===s.manipulator||(o!=null&&(o.hovering=!1),s!=null?(s.manipulator.hovering=!0,this._hoveredManipulators.set(i,s)):this._hoveredManipulators.delete(i),this._onFocusChange(n))}_afterManipulatorUngrab(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}};function xse(t){return t==="mouse"}function Tse(t){return t.pointerType!=="mouse"||t.button===0}function uWe(t){return!!t.native.shiftKey}function Ez(t,e){t?.consumesClicks&&e()}const Sse="attached",Cz="tools",Ese=1e3;let $f=class extends we{constructor(e){super(e),this._updatingHandles=new Cp,this._clock=nM,this._manipulatorState=new cWe,this.tools=new Je,this.cursor=null,this._interacting=!1,this._interactingTimeout=Ese,this._interactingTimeoutHandle=null,this._forEachTool=i=>{for(const r of this.tools.items)if(i(r))return}}initialize(){this.addHandles([this.view.on(_xe,e=>{this._handleInputEvent(e)},cv.TOOL),...lWe(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.activeTool=null,this.tools.drain(e=>e.destroy()),this._clearInteractingTimeout(),this._interacting=!1,this._updatingHandles.destroy()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void K.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const i=this.activeTool;this._set("activeTool",e),i?.deactivate(),e?.activate(),this._removeIncompleteTools(e);for(const r of this.tools){this._updateToolEditableFlag(r);const n=vH(r);this.activeTool!=null&&n||this._manipulatorState.clearPointers(r,this._manipulatorStateEventArgs,!n)}this._updateCursor()}get updating(){return this._updatingHandles.updating||this.tools.some(e=>e.updating)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeoutHandle=Tr(this._interactingTimeoutHandle)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeoutHandle=this._clock.setTimeout(()=>this._interacting=!1,this._interactingTimeout)}attach(){this.view.type==="3d"?this.addHandles([ne(()=>{const{state:e}=this.view;return"camera"in e&&e.camera},()=>this._forEachManipulator(e=>e.onViewChange())),this.view.elevationProvider?.on("elevation-change",e=>this._forEachManipulator(i=>i.onElevationChange(e)))],Sse):this.addHandles(ne(()=>this.view.extent,()=>this._forEachManipulator(e=>e.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.removeHandles(Sse),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(i=>{i.manipulators&&i.manipulators.forEach(({manipulator:r})=>e(r,i))})}_handleInputEvent(e){let i=!1;const r={...e,stopPropagation:()=>{i=!0,e.stopPropagation()}};this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(r):this._forEachTool(n=>{!i&&n.visible&&n.handleInputEvent(r)}),!i&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(r,this._manipulatorStateEventArgs),i||this.activeTool==null||this.activeTool.handleInputEventAfter(r),this._manipulatorState.handleHoverEvent(r,this._forEachTool),this._updateCursor(),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.removeHandles(Cz),this._forEachTool(e=>{if(e instanceof we){const i=ne(()=>[e.cursor,e.visible,e.editable],()=>{vH(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.addHandles(i,Cz)}e.manipulators&&this.addHandles([e.manipulators.on("after-remove",i=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,i.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],Cz)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){e.setEditableFlag?.(bP.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(i=>!(i.cursor==null||!i.visible)&&(e=i.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(i=>(e==null||i!==e)&&!i.created&&i.removeIncompleteOnCancel).forEach(i=>{this.tools.remove(i)})}get test(){const e=this;return{setClock:i=>this._clock=i,set interactingTimeoutEnabled(i){e._interactingTimeout=i?Ese:0},get interactingTimeoutEnabled(){return e._interactingTimeout!==0}}}};u([p({constructOnly:!0,nonNullable:!0})],$f.prototype,"view",void 0),u([p({value:null})],$f.prototype,"activeTool",null),u([p({readOnly:!0,type:Je})],$f.prototype,"tools",void 0),u([p({readOnly:!0})],$f.prototype,"cursor",void 0),u([p({readOnly:!0})],$f.prototype,"updating",null),u([p()],$f.prototype,"_interacting",void 0),u([p({readOnly:!0})],$f.prototype,"interacting",null),$f=u([M("esri.views.ToolViewManager")],$f);let zS=class extends we{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":hWe.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return dWe[this.deviceType]}};u([p({nonNullable:!0,readOnly:!0})],zS.prototype,"nativeIndex",void 0),u([p({type:String,readOnly:!0})],zS.prototype,"deviceType",null),u([p({type:Number,readOnly:!0})],zS.prototype,"axisThreshold",null),zS=u([M("esri.views.input.gamepad.GamepadInputDevice")],zS);const hWe=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),dWe={standard:.15,spacemouse:.025,unknown:0},cK=zS;let G3=class extends we{constructor(...e){super(...e),this.devices=new Je,this.enabledFocusMode="document"}};u([p({type:Je.ofType(cK),readOnly:!0})],G3.prototype,"devices",void 0),u([p({type:["document","view","none"]})],G3.prototype,"enabledFocusMode",void 0),G3=u([M("esri.views.input.gamepad.GamepadSettings")],G3);const pWe=G3;let GN=class extends we{constructor(){super(...arguments),this.gamepad=new pWe}};u([p({readOnly:!0})],GN.prototype,"gamepad",void 0),GN=u([M("esri.views.input.Input")],GN);const fWe=GN;let u_=class extends we{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};u([p({type:Boolean,nonNullable:!0})],u_.prototype,"enabled",void 0),u([p({type:cK})],u_.prototype,"device",void 0),u([p({type:["pan","zoom"],nonNullable:!0})],u_.prototype,"mode",void 0),u([p({type:["forward-down","forward-up"],nonNullable:!0})],u_.prototype,"tiltDirection",void 0),u([p({type:Number,nonNullable:!0})],u_.prototype,"velocityFactor",void 0),u_=u([M("esri.views.navigation.gamepad.GamepadSettings")],u_);const xxe=u_;let Ob=class extends we{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new xxe,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};u([p({type:Boolean})],Ob.prototype,"browserTouchPanEnabled",void 0),u([p({type:xxe,nonNullable:!0})],Ob.prototype,"gamepad",void 0),u([p({type:Boolean})],Ob.prototype,"momentumEnabled",void 0),u([p({type:Boolean})],Ob.prototype,"mouseWheelZoomEnabled",void 0),Ob=u([M("esri.views.navigation.Navigation")],Ob);const Txe=Ob;let bH,Az=null;async function mWe(t){Az||(Az=ce(()=>Promise.resolve().then(()=>Vmt),void 0,import.meta.url).then(e=>bH=e)),await Az,Tt(t)}async function Sxe(t,e,i,r){if(!t)return null;const n=t.spatialReference;return bM()||$p(n,e)?Bm(t,e):bH?bH.projectGeometry(t,e,i,r):(await Promise.race([mWe(r),FE(r)]),Sxe(t,e,i,r))}let Xr=class extends we{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=Gc(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference!=null?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){const e=this.map?.(),i=[];return this.priorityCollection!=null&&i.push(this.priorityCollection),i.push({parent:e?.basemap,layers:e?.basemap?.baseLayers},{layers:e?.layers},{parent:e?.ground,layers:e?.ground?.layers},{parent:e?.basemap,layers:e?.basemap?.referenceLayers}),i}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:i}=this._allLayers;let r=null;for(const s of e){const o=this._getSupportedSpatialReferences(s);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(r,o);a!=null&&(r=a)}if(r!=null&&r.length===1)break}if(i&&(r==null||r.length!==1))return{updating:!0};const n=this._pickSpatialReferenceCandidate(r);return{spatialReference:n!=null?n.spatialReference:null,viewingMode:n!=null?n.viewingMode:null,updating:!1}}get _tileInfoTask(){if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:i}=this._collectLayers([{parent:this.map?.()?.basemap,layers:this.map?.()?.basemap?.baseLayers},{layers:this.map?.()?.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const r=e[0].tileInfo;return{tileInfo:r&&r.spatialReference.equals(this.spatialReference)?r:null,updating:!1}}return{updating:i}}get _heightModelInfoTask(){if(!this.required.heightModelInfo||this.suspended&&this._get("_heightModelInfoTask")?.heightModelInfo)return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:i}=this._allLayers;for(const r of e)if(q6e(r)){const n=__e(r);if(n)return{heightModelInfo:n,vcsWkid:r.spatialReference?.vcsWkid,latestVcsWkid:r.spatialReference?.latestVcsWkid,updating:!1}}return{updating:i}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,i=e.updating,r=[];for(const n of e.layers){const s="fullExtents"in n&&n.fullExtents||(n.fullExtent!=null?[n.fullExtent]:[]),o=this.requiresExtentInSpatialReference?null:s[0],a=s.find(l=>l.spatialReference.equals(this.spatialReference))??o;if(a)return{candidates:[{extent:a,layer:n}],updating:!1};if(this._getSupportedSpatialReferences(n).length>0)for(const l of s)r.push({extent:l,layer:n})}return{candidates:r,updating:i}}get _extentTask(){const{candidates:e,updating:i}=this._extentCandidatesTask;if(i)return{updating:i};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const r=this._pickExtentCandidate(e),n=this.spatialReference;return r.extent.equals(this._projectExtentTask.input)&&n.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=Gc(this._projectExtentTask.task)),this._projectExtentTask={input:r.extent.clone(),output:null,spatialReference:n.clone(),task:Xv(async s=>{try{const o=await Sxe(r.extent,n,"portalItem"in r.layer?r.layer.portalItem:void 0,s);this._projectExtentTask={...this._projectExtentTask,task:null,output:o}}catch{if(ps(s))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,i){if(e==null)return i;const r=[],n=(s,o)=>s!=null?o!=null?s===o&&s:s:o;for(const s of e)for(const o of i){if(!s.spatialReference.equals(o.spatialReference))continue;const a=n(s.viewingMode,o.viewingMode);if(a!==!1){r.push({spatialReference:s.spatialReference,viewingMode:a});break}}return r.length>0?r:null}_pickSpatialReferenceCandidate(e){const i=this.defaultSpatialReference;return e==null||e.length<1?i!=null?{spatialReference:i,viewingMode:null}:null:(i!=null&&e.length>1&&e.some(({spatialReference:r})=>r.equals(i))&&(e=e.filter(({spatialReference:r})=>r.equals(i))),e.length>1&&e.some(({viewingMode:r})=>r!==Le.Local)&&(e=e.filter(({viewingMode:r})=>r!==Le.Local)),e[0])}_getSupportedSpatialReferences(e){const i="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(i.length===0)return[];const r=[];for(const n of i){const s=this.getSpatialReferenceSupport({spatialReference:n,layer:e});if(s!=null){const o=s.constraints!=null?s.constraints:[{spatialReference:n,viewingMode:null}];for(const{spatialReference:a,viewingMode:l}of o)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!a.equals(this.userSpatialReference)||r.push({spatialReference:a,viewingMode:l})}}return r}_pickExtentCandidate(e){const i=this.spatialReference;return e.find(({extent:r})=>i.equals(r.spatialReference))||e[0]}_collectLayers(e){if(this._loadMaybe(this.map?.())!=="loaded")return{layers:[],updating:!0};const i=new gWe;for(const r of e)if(this._collectCollection(r,i),i.preloading===this.sourcePreloadCount)break;return{layers:i.layers,updating:i.updating}}_collectCollection(e,i){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return i.updating=!0,void++i.preloading;case"failed":return}for(const r of e.layers){switch(this._loadMaybe(r)){case"failed":continue;case"loading":i.updating=!0,++i.preloading;break;case"loaded":i.updating||i.layers.push(r),"layers"in r&&this._collectCollection({layers:r.layers},i)}if(i.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(i=>{Tn(i)||console.log(i)}),"loading"):e.loadStatus:"loaded"}};u([p()],Xr.prototype,"required",void 0),u([p({constructOnly:!0})],Xr.prototype,"map",void 0),u([p({constructOnly:!0})],Xr.prototype,"getSpatialReferenceSupport",void 0),u([p()],Xr.prototype,"defaultSpatialReference",void 0),u([p()],Xr.prototype,"userSpatialReference",void 0),u([p()],Xr.prototype,"sourcePreloadCount",void 0),u([p()],Xr.prototype,"priorityCollection",void 0),u([p()],Xr.prototype,"requiresExtentInSpatialReference",void 0),u([p()],Xr.prototype,"suspended",void 0),u([p({readOnly:!0})],Xr.prototype,"ready",null),u([p({readOnly:!0})],Xr.prototype,"heightModelInfoReady",null),u([p({readOnly:!0})],Xr.prototype,"spatialReference",null),u([p({readOnly:!0})],Xr.prototype,"extent",null),u([p({readOnly:!0})],Xr.prototype,"heightModelInfo",null),u([p({readOnly:!0})],Xr.prototype,"vcsWkid",null),u([p({readOnly:!0})],Xr.prototype,"latestVcsWkid",null),u([p({readOnly:!0})],Xr.prototype,"viewingMode",null),u([p({readOnly:!0})],Xr.prototype,"tileInfo",null),u([p({readOnly:!0})],Xr.prototype,"mapCollections",null),u([p({readOnly:!0})],Xr.prototype,"_allLayers",null),u([p({readOnly:!0})],Xr.prototype,"_spatialReferenceTask",null),u([p({readOnly:!0})],Xr.prototype,"_tileInfoTask",null),u([p({readOnly:!0})],Xr.prototype,"_heightModelInfoTask",null),u([p({readOnly:!0})],Xr.prototype,"_extentCandidatesTask",null),u([p()],Xr.prototype,"_extentTask",null),u([p()],Xr.prototype,"_projectExtentTask",void 0),Xr=u([M("esri.views.support.DefaultsFromMap")],Xr);let gWe=class{constructor(){this.layers=new Array,this.preloading=-1,this.updating=!1}};var j3;let Rt=j3=class extends Sn.EventedMixin(p6(we)){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.handles=new Ny,this.updatingHandles=new Cp,this.allLayerViews=new rP({getCollections:()=>[this.basemapView?.baseLayerViews,this.groundView?.layerViews,this.layerViews,this.basemapView?.referenceLayerViews],getChildrenFunction:_We}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new oR,this.analyses=new YE,this.typeSpecificPreconditionsReady=!0,this.layerViews=new Je,this.magnifier=new yxe,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new fWe,this.navigation=new Txe,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new oWe(this),this.persistableViewModels=new Je,this._isValid=!1,this._readyCycleForced=!1,this._lockedSpatialReference=null,this._userTimeZone=null,this._lockedTimeZone=null,this.theme=null,this.handles.add(ne(()=>this.preconditionsReady,e=>{e?(this._lockedSpatialReference=this.spatialReference,this._lockedTimeZone=this.timeZone,j3.views.add(this)):(this._lockedSpatialReference=null,j3.views.remove(this)),this.notifyChange("spatialReference"),!e&&this.ready?(this.toolViewManager?.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),this.layerViewManager?.clear(),this._teardown()):e&&!this.ready&&(this._startup(),this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach())},Zi))}initialize(){this.addResolvingPromise(Promise.all([this.loadAsyncDependencies(),this.validate()]).then(()=>(this._isValid=!0,Tv(()=>this.ready)))),this.basemapView=new c_({view:this}),this.layerViewManager=new rWe({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new $f({view:this}),this._setupSpatialReferenceLogger(),this.addHandles([ne(()=>this.initialExtentRequired,t=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:t},{sync:!0,initial:!0}),ne(()=>this.ready,t=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=t,this.defaultsFromMap.userSpatialReference=t?this.spatialReference:this._userSpatialReference)},{sync:!0}),ne(()=>this._userSpatialReference,t=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=t)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let t=null;this.addHandles([ne(()=>this.defaultsFromMap?.ready,e=>{const i=this.map?.allLayers.length>0;if(e&&!this.spatialReference&&i){if(t!=null)return;const r=Vi(()=>t=Gc(t));t=Xv(async n=>{try{await XR(this.spatialReferenceWarningDelay,null,n)}catch{return}finally{t=null}K.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.addHandles(r,"spatial-reference-logger-task")}else this.removeHandles("spatial-reference-logger-task")},{sync:!0})])}destroy(){this.destroyed||(j3.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=$e(this.graphics),this.analyses=$e(this.analyses),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),$e(this.analysisViewManager),this.toolViewManager=$e(this.toolViewManager),this.layerViewManager=$e(this.layerViewManager),this.basemapView=$e(this.basemapView),this.groundView?.destroy(),this.layerViews?.forEach(t=>t.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.destroy(),this.map=$e(this.map),this.updatingHandles.destroy())}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return K.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){return this.toolViewManager?.activeTool}set activeTool(t){this.toolViewManager&&(this.toolViewManager.activeTool=t)}get animation(){return this._get("animation")}set animation(t){this._set("animation",t)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new Xr({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:t=>this.getSpatialReferenceSupport(t),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(t){this._set("extent",t)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||xy.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._lockedSpatialReference&&!this.defaultsFromMap?.ready||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(t){t!==this._get("map")&&(t?.destroyed&&(K.getLogger(this).warn("#map","The provided map is already destroyed",{map:t}),t=null),xy.isLoadable(t)&&t.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._lockedSpatialReference=null),this._set("map",t))}get spatialReference(){let t=this._userSpatialReference||this._lockedSpatialReference||this.getDefaultSpatialReference()||null;return t&&this.defaultsFromMap?.required?.heightModelInfo&&(t=t.clone(),t.vcsWkid=this.defaultsFromMap.vcsWkid,t.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),t}set spatialReference(t){const e=!Fn(t,this._get("spatialReference"));this._set("_userSpatialReference",t),e&&(this._set("spatialReference",t),this._spatialReferenceChanged(t))}_spatialReferenceChanged(t){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get timeZone(){return this._userTimeZone??this._lockedTimeZone??this.getDefaultTimeZone()??Rm}set timeZone(t){const e=new Set(["etc/utc","etc/gmt","gmt"]),i=new Set(Intl.supportedValuesOf("timeZone").map(r=>r.toLowerCase()));this._userTimeZone=t,t===Rm||t===VE||e.has(t.toLowerCase())||i.has(t.toLowerCase())||K.getLogger(this).warn("#timeZone",`the parsed value '${t}' may not be a valid IANA time zone`)}get tools(){return this.toolViewManager?.tools}get initialExtent(){return this.defaultsFromMap?.extent}get cursor(){return this.toolViewManager?.cursor??this._cursor??"default"}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}get effectiveTheme(){return this.theme??new _H}whenLayerView(t){return this.layerViewManager?.whenLayerView(t)??Promise.reject()}getDefaultSpatialReference(){return this.defaultsFromMap?.spatialReference}getDefaultHeightModelInfo(){return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??this.defaultsFromMap?.heightModelInfo??null}getDefaultTimeZone(){return null}importLayerView(t){throw new G("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}async loadAsyncDependencies(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(t){return this.getSpatialReferenceSupport({spatialReference:t})!=null}when(t,e){return this.isResolved()&&!this.ready&&K.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(t,e)}forceReadyCycle(){this.ready&&(gl(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}};Rt.views=new Je,u([p()],Rt.prototype,"_userSpatialReference",void 0),u([p()],Rt.prototype,"activeTool",null),u([p({readOnly:!0})],Rt.prototype,"allLayerViews",void 0),u([p()],Rt.prototype,"groundView",void 0),u([p()],Rt.prototype,"animation",null),u([p()],Rt.prototype,"basemapView",void 0),u([p()],Rt.prototype,"center",null),u([p({readOnly:!0})],Rt.prototype,"_defaultsFromMapSettings",null),u([p()],Rt.prototype,"defaultsFromMap",null),u([p()],Rt.prototype,"fatalError",void 0),u([p({type:zi})],Rt.prototype,"extent",null),u([p(Jj(oR,"graphics"))],Rt.prototype,"graphics",void 0),u([p(Jj(YE,"analyses"))],Rt.prototype,"analyses",void 0),u([p({readOnly:!0,type:zx})],Rt.prototype,"heightModelInfo",null),u([p({readOnly:!0})],Rt.prototype,"interacting",null),u([p({readOnly:!0})],Rt.prototype,"navigating",null),u([p({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_lockedSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],Rt.prototype,"preconditionsReady",null),u([p({readOnly:!0})],Rt.prototype,"typeSpecificPreconditionsReady",void 0),u([p({type:Je,readOnly:!0})],Rt.prototype,"layerViews",void 0),u([p()],Rt.prototype,"resolution",null),u([p({type:yxe})],Rt.prototype,"magnifier",void 0),u([p({value:null,type:B0e})],Rt.prototype,"map",null),u([p()],Rt.prototype,"padding",void 0),u([p({readOnly:!0})],Rt.prototype,"ready",void 0),u([p({type:ze})],Rt.prototype,"spatialReference",null),u([p()],Rt.prototype,"spatialReferenceWarningDelay",void 0),u([p()],Rt.prototype,"stationary",null),u([p({readOnly:!0})],Rt.prototype,"supportsGround",void 0),u([p({type:Gy})],Rt.prototype,"timeExtent",void 0),u([p({type:String,nonNullable:!0})],Rt.prototype,"timeZone",null),u([p()],Rt.prototype,"tools",null),u([p()],Rt.prototype,"toolViewManager",void 0),u([p({readOnly:!0})],Rt.prototype,"type",void 0),u([p({type:Number})],Rt.prototype,"scale",void 0),u([p({readOnly:!0})],Rt.prototype,"updating",void 0),u([p({readOnly:!0})],Rt.prototype,"initialExtentRequired",void 0),u([p({readOnly:!0})],Rt.prototype,"initialExtent",null),u([p()],Rt.prototype,"cursor",null),u([p({readOnly:!0})],Rt.prototype,"input",void 0),u([p({type:Txe,nonNullable:!0})],Rt.prototype,"navigation",void 0),u([p()],Rt.prototype,"layerViewManager",void 0),u([p()],Rt.prototype,"analysisViewManager",void 0),u([p()],Rt.prototype,"width",void 0),u([p()],Rt.prototype,"height",void 0),u([p({readOnly:!0})],Rt.prototype,"resizing",void 0),u([p({value:null,readOnly:!0})],Rt.prototype,"size",null),u([p({readOnly:!0})],Rt.prototype,"suspended",void 0),u([p({readOnly:!0})],Rt.prototype,"viewEvents",void 0),u([p({readOnly:!0})],Rt.prototype,"persistableViewModels",void 0),u([p()],Rt.prototype,"_isValid",void 0),u([p()],Rt.prototype,"_readyCycleForced",void 0),u([p()],Rt.prototype,"_lockedSpatialReference",void 0),u([p()],Rt.prototype,"_userTimeZone",void 0),u([p()],Rt.prototype,"_lockedTimeZone",void 0),u([p({type:_H})],Rt.prototype,"theme",void 0),u([p({readOnly:!0,type:_H})],Rt.prototype,"effectiveTheme",null),Rt=j3=u([M("esri.views.View")],Rt);const yWe=Rt;function _We(t){return t.layerViews}let h_=class extends S5{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=Hs(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),this._resolver?.reject(new G("ViewAnimation stopped")))}finish(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),this._resolver?.resolve())}update(e,i){i||(i=Zc(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",i)}};u([p({readOnly:!0})],h_.prototype,"done",null),u([p({readOnly:!0,type:String})],h_.prototype,"state",void 0),u([p()],h_.prototype,"target",void 0),h_=u([M("esri.views.ViewAnimation")],h_),function(t){t.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(h_||(h_={}));const QE=h_,vA=()=>ce(()=>import("./TileLayerView3D-6dcb73bd.js"),["./TileLayerView3D-6dcb73bd.js","./LayerView3D-a480bbae.js","./TiledLayerView3D-90f865a6.js","./LayerView-fa72efbb.js","./RefreshableLayerView-ea970069.js","./MapServiceLayerViewHelper-0eb1b6d7.js","./floorFilterUtils-73949d2d.js","./sublayerUtils-453a6830.js","./popupUtils-85d853d6.js","./drapedUtils-d279d53d.js"],import.meta.url),Cse=()=>ce(()=>import("./ElevationLayerView3D-929e9eec.js"),["./ElevationLayerView3D-929e9eec.js","./LayerView3D-a480bbae.js","./TiledLayerView3D-90f865a6.js","./LayerView-fa72efbb.js"],import.meta.url),Ase={"base-dynamic":()=>ce(()=>import("./BaseDynamicLayerView3D-2b9f7503.js"),["./BaseDynamicLayerView3D-2b9f7503.js","./DynamicLayerView3D-8b0d2dc1.js","./LayerView3D-a480bbae.js","./projectExtentUtils-b83cb1bf.js","./ImageMaterial-3dbcbb9a.js","./LayerView-fa72efbb.js","./RefreshableLayerView-ea970069.js"],import.meta.url),"base-elevation":Cse,"base-tile":vA,"bing-maps":vA,"building-scene":()=>ce(()=>import("./BuildingSceneLayerView3D-bab7b464.js"),["./BuildingSceneLayerView3D-bab7b464.js","./BuildingGroupSublayer-509dfabe.js","./BuildingComponentSublayer-aae26ebd.js","./FeatureLayer-4b20d634.js","./FeatureLayerBase-d5b34521.js","./LayerFloorInfo-2c0a736f.js","./serviceCapabilitiesUtils-979570ad.js","./editsZScale-edfeccc6.js","./queryZScale-47976d5a.js","./FeatureSet-20ce479f.js","./APIKeyMixin-3e91b31f.js","./EditBusLayer-4de7f58b.js","./OrderedLayer-ea33712e.js","./FeatureTemplate-1a55ea44.js","./FeatureType-c8e18d40.js","./versionUtils-f448b405.js","./TopFeaturesQuery-62024588.js","./capabilities-c607cf72.js","./I3SIndexInfo-e8052f88.js","./I3SLayerDefinitions-677add91.js","./I3SUtil-0d0882d1.js","./I3SBinaryReader-b93e280e.js","./popupUtils-85d853d6.js","./WhereClause-813f9607.js","./TimeOnly-5ca21580.js","./I3SMeshView3D-74f48a84.js","./I3SOverrides-f724f567.js","./I3SNode-2b3c2c48.js","./ReactiveSet-eabb3c3b.js","./meshFeatureSet-a5b908a3.js","./External-5bb4f949.js","./FeatureLayerView3D-3f0d81ef.js","./FeatureLayerViewBase3D-596ac4f8.js","./FeatureLikeLayerView3D-72eddda9.js","./dehydratedFeatureComparison-01107244.js","./queryForSymbologySnapping-4b1b166f.js","./elevationInfoUtils-d483be9b.js","./hash-6f442295.js","./Graphics3DObjectStates-d17b3cec.js","./rendererConversion-f2d7d312.js","./optimizedFeatureQueryEngineAdapter-68a83ac4.js","./PooledRBush-a82b8470.js","./quickselect-cd6fa001.js","./floorFilterUtils-73949d2d.js","./QueryEngine-7a150f90.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-d4e69d8a.js","./utils-e4f79b61.js","./generateRendererUtils-45001f16.js","./FeatureStore-502a78b3.js","./BoundsStore-7941b063.js","./projectExtentUtils-b83cb1bf.js","./LayerView3D-a480bbae.js","./query-329b2ac1.js","./pbfQueryUtils-2cf66e2d.js","./pbf-b60d46d3.js","./EventedSet-cf12acd8.js","./LayerView-fa72efbb.js","./RefreshableLayerView-ea970069.js","./SceneModification-f535d834.js","./persistable-11a51d0d.js","./resourceExtension-e91c0a13.js","./SceneLayerWorker-18445ad8.js","./I3SQueryFeatureStore-88e56d0e.js","./DefinitionExpressionSceneLayerView-73fe43c1.js"],import.meta.url),csv:()=>ce(()=>import("./CSVLayerView3D-0a644102.js"),["./CSVLayerView3D-0a644102.js","./FeatureLayerViewBase3D-596ac4f8.js","./FeatureLikeLayerView3D-72eddda9.js","./dehydratedFeatureComparison-01107244.js","./queryForSymbologySnapping-4b1b166f.js","./elevationInfoUtils-d483be9b.js","./hash-6f442295.js","./Graphics3DObjectStates-d17b3cec.js","./rendererConversion-f2d7d312.js","./optimizedFeatureQueryEngineAdapter-68a83ac4.js","./PooledRBush-a82b8470.js","./quickselect-cd6fa001.js","./popupUtils-85d853d6.js","./floorFilterUtils-73949d2d.js","./QueryEngine-7a150f90.js","./WhereClause-813f9607.js","./TimeOnly-5ca21580.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-d4e69d8a.js","./utils-e4f79b61.js","./generateRendererUtils-45001f16.js","./FeatureSet-20ce479f.js","./FeatureStore-502a78b3.js","./BoundsStore-7941b063.js","./projectExtentUtils-b83cb1bf.js","./LayerView3D-a480bbae.js","./query-329b2ac1.js","./pbfQueryUtils-2cf66e2d.js","./pbf-b60d46d3.js","./queryZScale-47976d5a.js","./EventedSet-cf12acd8.js","./LayerView-fa72efbb.js","./RefreshableLayerView-ea970069.js"],import.meta.url),dimension:()=>ce(()=>import("./DimensionLayerView3D-8774ab1b.js"),["./DimensionLayerView3D-8774ab1b.js","./LayerView3D-a480bbae.js","./LayerView-fa72efbb.js"],import.meta.url),elevation:Cse,feature:()=>ce(()=>import("./FeatureLayerView3D-3f0d81ef.js"),["./FeatureLayerView3D-3f0d81ef.js","./FeatureLayerViewBase3D-596ac4f8.js","./FeatureLikeLayerView3D-72eddda9.js","./dehydratedFeatureComparison-01107244.js","./queryForSymbologySnapping-4b1b166f.js","./elevationInfoUtils-d483be9b.js","./hash-6f442295.js","./Graphics3DObjectStates-d17b3cec.js","./rendererConversion-f2d7d312.js","./optimizedFeatureQueryEngineAdapter-68a83ac4.js","./PooledRBush-a82b8470.js","./quickselect-cd6fa001.js","./popupUtils-85d853d6.js","./floorFilterUtils-73949d2d.js","./QueryEngine-7a150f90.js","./WhereClause-813f9607.js","./TimeOnly-5ca21580.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-d4e69d8a.js","./utils-e4f79b61.js","./generateRendererUtils-45001f16.js","./FeatureSet-20ce479f.js","./FeatureStore-502a78b3.js","./BoundsStore-7941b063.js","./projectExtentUtils-b83cb1bf.js","./LayerView3D-a480bbae.js","./query-329b2ac1.js","./pbfQueryUtils-2cf66e2d.js","./pbf-b60d46d3.js","./queryZScale-47976d5a.js","./EventedSet-cf12acd8.js","./LayerView-fa72efbb.js","./RefreshableLayerView-ea970069.js"],import.meta.url),geojson:()=>ce(()=>import("./GeoJSONLayerView3D-2862c380.js"),["./GeoJSONLayerView3D-2862c380.js","./FeatureLayerViewBase3D-596ac4f8.js","./FeatureLikeLayerView3D-72eddda9.js","./dehydratedFeatureComparison-01107244.js","./queryForSymbologySnapping-4b1b166f.js","./elevationInfoUtils-d483be9b.js","./hash-6f442295.js","./Graphics3DObjectStates-d17b3cec.js","./rendererConversion-f2d7d312.js","./optimizedFeatureQueryEngineAdapter-68a83ac4.js","./PooledRBush-a82b8470.js","./quickselect-cd6fa001.js","./popupUtils-85d853d6.js","./floorFilterUtils-73949d2d.js","./QueryEngine-7a150f90.js","./WhereClause-813f9607.js","./TimeOnly-5ca21580.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-d4e69d8a.js","./utils-e4f79b61.js","./generateRendererUtils-45001f16.js","./FeatureSet-20ce479f.js","./FeatureStore-502a78b3.js","./BoundsStore-7941b063.js","./projectExtentUtils-b83cb1bf.js","./LayerView3D-a480bbae.js","./query-329b2ac1.js","./pbfQueryUtils-2cf66e2d.js","./pbf-b60d46d3.js","./queryZScale-47976d5a.js","./EventedSet-cf12acd8.js","./LayerView-fa72efbb.js","./RefreshableLayerView-ea970069.js"],import.meta.url),graphics:()=>ce(()=>import("./GraphicsLayerView3D-9eae0635.js"),["./GraphicsLayerView3D-9eae0635.js","./LayerView3D-a480bbae.js","./queryForSymbologySnapping-4b1b166f.js","./elevationInfoUtils-d483be9b.js","./GraphicsProcessor-25439ae2.js","./Graphics3DObjectStates-d17b3cec.js","./rendererConversion-f2d7d312.js","./optimizedFeatureQueryEngineAdapter-68a83ac4.js","./PooledRBush-a82b8470.js","./quickselect-cd6fa001.js","./popupUtils-85d853d6.js","./projectExtentUtils-b83cb1bf.js","./LayerView-fa72efbb.js"],import.meta.url),group:()=>ce(()=>import("./GroupLayerView-ae44c457.js"),["./GroupLayerView-ae44c457.js","./LayerView-fa72efbb.js"],import.meta.url),imagery:()=>ce(()=>import("./ImageryLayerView3D-956bfeea.js"),["./ImageryLayerView3D-956bfeea.js","./DynamicLayerView3D-8b0d2dc1.js","./LayerView3D-a480bbae.js","./projectExtentUtils-b83cb1bf.js","./ImageMaterial-3dbcbb9a.js","./LayerView-fa72efbb.js","./RefreshableLayerView-ea970069.js","./popupUtils-85d853d6.js"],import.meta.url),"integrated-mesh":()=>ce(()=>import("./IntegratedMeshLayerView3D-7e338341.js"),["./IntegratedMeshLayerView3D-7e338341.js","./I3SMeshView3D-74f48a84.js","./I3SOverrides-f724f567.js","./I3SNode-2b3c2c48.js","./I3SUtil-0d0882d1.js","./I3SBinaryReader-b93e280e.js","./ReactiveSet-eabb3c3b.js","./meshFeatureSet-a5b908a3.js","./External-5bb4f949.js","./FeatureSet-20ce479f.js","./FeatureLayerView3D-3f0d81ef.js","./FeatureLayerViewBase3D-596ac4f8.js","./FeatureLikeLayerView3D-72eddda9.js","./dehydratedFeatureComparison-01107244.js","./queryForSymbologySnapping-4b1b166f.js","./elevationInfoUtils-d483be9b.js","./hash-6f442295.js","./Graphics3DObjectStates-d17b3cec.js","./rendererConversion-f2d7d312.js","./optimizedFeatureQueryEngineAdapter-68a83ac4.js","./PooledRBush-a82b8470.js","./quickselect-cd6fa001.js","./popupUtils-85d853d6.js","./floorFilterUtils-73949d2d.js","./QueryEngine-7a150f90.js","./WhereClause-813f9607.js","./TimeOnly-5ca21580.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-d4e69d8a.js","./utils-e4f79b61.js","./generateRendererUtils-45001f16.js","./FeatureStore-502a78b3.js","./BoundsStore-7941b063.js","./projectExtentUtils-b83cb1bf.js","./LayerView3D-a480bbae.js","./query-329b2ac1.js","./pbfQueryUtils-2cf66e2d.js","./pbf-b60d46d3.js","./queryZScale-47976d5a.js","./EventedSet-cf12acd8.js","./LayerView-fa72efbb.js","./RefreshableLayerView-ea970069.js","./SceneModification-f535d834.js","./persistable-11a51d0d.js","./resourceExtension-e91c0a13.js","./SceneLayerWorker-18445ad8.js"],import.meta.url),"line-of-sight":()=>ce(()=>import("./LineOfSightLayerView3D-e5387b4e.js"),["./LineOfSightLayerView3D-e5387b4e.js","./LayerView3D-a480bbae.js","./LayerView-fa72efbb.js"],import.meta.url),"map-image":()=>ce(()=>import("./MapImageLayerView3D-e7bc2ee3.js"),["./MapImageLayerView3D-e7bc2ee3.js","./DynamicLayerView3D-8b0d2dc1.js","./LayerView3D-a480bbae.js","./projectExtentUtils-b83cb1bf.js","./ImageMaterial-3dbcbb9a.js","./LayerView-fa72efbb.js","./RefreshableLayerView-ea970069.js","./ExportImageParameters-669c498d.js","./floorFilterUtils-73949d2d.js","./sublayerUtils-453a6830.js","./MapServiceLayerViewHelper-0eb1b6d7.js","./popupUtils-85d853d6.js","./drapedUtils-d279d53d.js"],import.meta.url),media:()=>ce(()=>import("./MediaLayerView3D-be384030.js"),["./MediaLayerView3D-be384030.js","./MediaElementView-a0def988.js","./normalizeUtilsSync-11fd9991.js","./LayerView3D-a480bbae.js","./ImageMaterial-3dbcbb9a.js","./LayerView-fa72efbb.js"],import.meta.url),"ogc-feature":()=>ce(()=>import("./OGCFeatureLayerView3D-376531af.js"),["./OGCFeatureLayerView3D-376531af.js","./FeatureLayerViewBase3D-596ac4f8.js","./FeatureLikeLayerView3D-72eddda9.js","./dehydratedFeatureComparison-01107244.js","./queryForSymbologySnapping-4b1b166f.js","./elevationInfoUtils-d483be9b.js","./hash-6f442295.js","./Graphics3DObjectStates-d17b3cec.js","./rendererConversion-f2d7d312.js","./optimizedFeatureQueryEngineAdapter-68a83ac4.js","./PooledRBush-a82b8470.js","./quickselect-cd6fa001.js","./popupUtils-85d853d6.js","./floorFilterUtils-73949d2d.js","./QueryEngine-7a150f90.js","./WhereClause-813f9607.js","./TimeOnly-5ca21580.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-d4e69d8a.js","./utils-e4f79b61.js","./generateRendererUtils-45001f16.js","./FeatureSet-20ce479f.js","./FeatureStore-502a78b3.js","./BoundsStore-7941b063.js","./projectExtentUtils-b83cb1bf.js","./LayerView3D-a480bbae.js","./query-329b2ac1.js","./pbfQueryUtils-2cf66e2d.js","./pbf-b60d46d3.js","./queryZScale-47976d5a.js","./EventedSet-cf12acd8.js","./LayerView-fa72efbb.js","./RefreshableLayerView-ea970069.js"],import.meta.url),"open-street-map":vA,"oriented-imagery":()=>ce(()=>import("./FeatureLayerView3D-3f0d81ef.js"),["./FeatureLayerView3D-3f0d81ef.js","./FeatureLayerViewBase3D-596ac4f8.js","./FeatureLikeLayerView3D-72eddda9.js","./dehydratedFeatureComparison-01107244.js","./queryForSymbologySnapping-4b1b166f.js","./elevationInfoUtils-d483be9b.js","./hash-6f442295.js","./Graphics3DObjectStates-d17b3cec.js","./rendererConversion-f2d7d312.js","./optimizedFeatureQueryEngineAdapter-68a83ac4.js","./PooledRBush-a82b8470.js","./quickselect-cd6fa001.js","./popupUtils-85d853d6.js","./floorFilterUtils-73949d2d.js","./QueryEngine-7a150f90.js","./WhereClause-813f9607.js","./TimeOnly-5ca21580.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-d4e69d8a.js","./utils-e4f79b61.js","./generateRendererUtils-45001f16.js","./FeatureSet-20ce479f.js","./FeatureStore-502a78b3.js","./BoundsStore-7941b063.js","./projectExtentUtils-b83cb1bf.js","./LayerView3D-a480bbae.js","./query-329b2ac1.js","./pbfQueryUtils-2cf66e2d.js","./pbf-b60d46d3.js","./queryZScale-47976d5a.js","./EventedSet-cf12acd8.js","./LayerView-fa72efbb.js","./RefreshableLayerView-ea970069.js"],import.meta.url),"point-cloud":()=>ce(()=>import("./PointCloudLayerView3D-aed2c75a.js").then(t=>t.P),["./PointCloudLayerView3D-aed2c75a.js","./LayerView3D-a480bbae.js","./I3SUtil-0d0882d1.js","./I3SBinaryReader-b93e280e.js","./PointCloudWorkerUtil-d3409edb.js","./PointCloudUniqueValueRenderer-f29eb455.js","./PopupSceneLayerView-67d17677.js","./popupUtils-85d853d6.js","./LayerView-fa72efbb.js"],import.meta.url),voxel:()=>ce(()=>import("./VoxelLayerView3D-cd2bb665.js"),["./VoxelLayerView3D-cd2bb665.js","./LayerView3D-a480bbae.js","./PopupSceneLayerView-67d17677.js","./popupUtils-85d853d6.js","./LayerView-fa72efbb.js"],import.meta.url),route:()=>ce(()=>import("./RouteLayerView3D-fa9c88d3.js"),["./RouteLayerView3D-fa9c88d3.js","./Stop-59e290f7.js","./LayerView3D-a480bbae.js","./GraphicsProcessor-25439ae2.js","./Graphics3DObjectStates-d17b3cec.js","./rendererConversion-f2d7d312.js","./optimizedFeatureQueryEngineAdapter-68a83ac4.js","./PooledRBush-a82b8470.js","./quickselect-cd6fa001.js","./popupUtils-85d853d6.js","./projectExtentUtils-b83cb1bf.js","./EventedSet-cf12acd8.js","./LayerView-fa72efbb.js"],import.meta.url),scene:t=>t.profile==null||t.profile==="mesh-pyramids"?ce(()=>import("./SceneLayerView3D-3c5441e9.js"),["./SceneLayerView3D-3c5441e9.js","./ReactiveSet-eabb3c3b.js","./WhereClause-813f9607.js","./TimeOnly-5ca21580.js","./floorFilterUtils-73949d2d.js","./I3SMeshView3D-74f48a84.js","./I3SOverrides-f724f567.js","./I3SNode-2b3c2c48.js","./I3SUtil-0d0882d1.js","./I3SBinaryReader-b93e280e.js","./meshFeatureSet-a5b908a3.js","./External-5bb4f949.js","./FeatureSet-20ce479f.js","./FeatureLayerView3D-3f0d81ef.js","./FeatureLayerViewBase3D-596ac4f8.js","./FeatureLikeLayerView3D-72eddda9.js","./dehydratedFeatureComparison-01107244.js","./queryForSymbologySnapping-4b1b166f.js","./elevationInfoUtils-d483be9b.js","./hash-6f442295.js","./Graphics3DObjectStates-d17b3cec.js","./rendererConversion-f2d7d312.js","./optimizedFeatureQueryEngineAdapter-68a83ac4.js","./PooledRBush-a82b8470.js","./quickselect-cd6fa001.js","./popupUtils-85d853d6.js","./QueryEngine-7a150f90.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-d4e69d8a.js","./utils-e4f79b61.js","./generateRendererUtils-45001f16.js","./FeatureStore-502a78b3.js","./BoundsStore-7941b063.js","./projectExtentUtils-b83cb1bf.js","./LayerView3D-a480bbae.js","./query-329b2ac1.js","./pbfQueryUtils-2cf66e2d.js","./pbf-b60d46d3.js","./queryZScale-47976d5a.js","./EventedSet-cf12acd8.js","./LayerView-fa72efbb.js","./RefreshableLayerView-ea970069.js","./SceneModification-f535d834.js","./persistable-11a51d0d.js","./resourceExtension-e91c0a13.js","./SceneLayerWorker-18445ad8.js","./SceneLayerView-d10af534.js","./DefinitionExpressionSceneLayerView-73fe43c1.js","./I3SQueryFeatureStore-88e56d0e.js","./PopupSceneLayerView-67d17677.js"],import.meta.url):ce(()=>import("./SceneLayerGraphicsView3D-ab6f3e55.js"),["./SceneLayerGraphicsView3D-ab6f3e55.js","./I3SOverrides-f724f567.js","./I3SNode-2b3c2c48.js","./I3SUtil-0d0882d1.js","./I3SBinaryReader-b93e280e.js","./ReactiveSet-eabb3c3b.js","./meshFeatureSet-a5b908a3.js","./External-5bb4f949.js","./FeatureSet-20ce479f.js","./FeatureLayerView3D-3f0d81ef.js","./FeatureLayerViewBase3D-596ac4f8.js","./FeatureLikeLayerView3D-72eddda9.js","./dehydratedFeatureComparison-01107244.js","./queryForSymbologySnapping-4b1b166f.js","./elevationInfoUtils-d483be9b.js","./hash-6f442295.js","./Graphics3DObjectStates-d17b3cec.js","./rendererConversion-f2d7d312.js","./optimizedFeatureQueryEngineAdapter-68a83ac4.js","./PooledRBush-a82b8470.js","./quickselect-cd6fa001.js","./popupUtils-85d853d6.js","./floorFilterUtils-73949d2d.js","./QueryEngine-7a150f90.js","./WhereClause-813f9607.js","./TimeOnly-5ca21580.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-d4e69d8a.js","./utils-e4f79b61.js","./generateRendererUtils-45001f16.js","./FeatureStore-502a78b3.js","./BoundsStore-7941b063.js","./projectExtentUtils-b83cb1bf.js","./LayerView3D-a480bbae.js","./query-329b2ac1.js","./pbfQueryUtils-2cf66e2d.js","./pbf-b60d46d3.js","./queryZScale-47976d5a.js","./EventedSet-cf12acd8.js","./LayerView-fa72efbb.js","./RefreshableLayerView-ea970069.js","./SceneLayerView-d10af534.js","./DefinitionExpressionSceneLayerView-73fe43c1.js","./PopupSceneLayerView-67d17677.js"],import.meta.url),stream:()=>ce(()=>import("./StreamLayerView3D-76dc87c3.js"),["./StreamLayerView3D-76dc87c3.js","./StreamFeatureManager-94c02f5a.js","./createConnection-efa0dc21.js","./query-329b2ac1.js","./pbfQueryUtils-2cf66e2d.js","./pbf-b60d46d3.js","./queryZScale-47976d5a.js","./EventedSet-cf12acd8.js","./FeatureLikeLayerView3D-72eddda9.js","./dehydratedFeatureComparison-01107244.js","./queryForSymbologySnapping-4b1b166f.js","./elevationInfoUtils-d483be9b.js","./hash-6f442295.js","./Graphics3DObjectStates-d17b3cec.js","./rendererConversion-f2d7d312.js","./optimizedFeatureQueryEngineAdapter-68a83ac4.js","./PooledRBush-a82b8470.js","./quickselect-cd6fa001.js","./popupUtils-85d853d6.js","./floorFilterUtils-73949d2d.js","./QueryEngine-7a150f90.js","./WhereClause-813f9607.js","./TimeOnly-5ca21580.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-d4e69d8a.js","./utils-e4f79b61.js","./generateRendererUtils-45001f16.js","./FeatureSet-20ce479f.js","./FeatureStore-502a78b3.js","./BoundsStore-7941b063.js","./projectExtentUtils-b83cb1bf.js","./LayerView3D-a480bbae.js","./LayerView-fa72efbb.js"],import.meta.url),tile:vA,"imagery-tile":()=>ce(()=>import("./ImageryTileLayerView3D-d5b985e6.js"),["./ImageryTileLayerView3D-d5b985e6.js","./rasterProjectionHelper-05232069.js","./LayerView3D-a480bbae.js","./TiledLayerView3D-90f865a6.js","./popupUtils-85d853d6.js","./LayerView-fa72efbb.js","./RefreshableLayerView-ea970069.js","./drapedUtils-d279d53d.js"],import.meta.url),"vector-tile":()=>ce(()=>import("./VectorTileLayerView3D-9e6397d8.js"),["./VectorTileLayerView3D-9e6397d8.js","./Rect-98da58d6.js","./pbf-b60d46d3.js","./rasterizingUtils-92b6527e.js","./vec4f32-0d1b2306.js","./definitions-24b8f578.js","./enums-9d4f5c11.js","./number-e491b09e.js","./GeometryUtils-0258f920.js","./StyleRepository-43550a47.js","./TileClipper-ae6eca9e.js","./LayerView3D-a480bbae.js","./TiledLayerView3D-90f865a6.js","./LayerView-fa72efbb.js"],import.meta.url),wcs:()=>ce(()=>import("./ImageryTileLayerView3D-d5b985e6.js"),["./ImageryTileLayerView3D-d5b985e6.js","./rasterProjectionHelper-05232069.js","./LayerView3D-a480bbae.js","./TiledLayerView3D-90f865a6.js","./popupUtils-85d853d6.js","./LayerView-fa72efbb.js","./RefreshableLayerView-ea970069.js","./drapedUtils-d279d53d.js"],import.meta.url),"web-tile":vA,wfs:()=>ce(()=>import("./WFSLayerView3D-2ae82484.js"),["./WFSLayerView3D-2ae82484.js","./FeatureLayerViewBase3D-596ac4f8.js","./FeatureLikeLayerView3D-72eddda9.js","./dehydratedFeatureComparison-01107244.js","./queryForSymbologySnapping-4b1b166f.js","./elevationInfoUtils-d483be9b.js","./hash-6f442295.js","./Graphics3DObjectStates-d17b3cec.js","./rendererConversion-f2d7d312.js","./optimizedFeatureQueryEngineAdapter-68a83ac4.js","./PooledRBush-a82b8470.js","./quickselect-cd6fa001.js","./popupUtils-85d853d6.js","./floorFilterUtils-73949d2d.js","./QueryEngine-7a150f90.js","./WhereClause-813f9607.js","./TimeOnly-5ca21580.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-d4e69d8a.js","./utils-e4f79b61.js","./generateRendererUtils-45001f16.js","./FeatureSet-20ce479f.js","./FeatureStore-502a78b3.js","./BoundsStore-7941b063.js","./projectExtentUtils-b83cb1bf.js","./LayerView3D-a480bbae.js","./query-329b2ac1.js","./pbfQueryUtils-2cf66e2d.js","./pbf-b60d46d3.js","./queryZScale-47976d5a.js","./EventedSet-cf12acd8.js","./LayerView-fa72efbb.js","./RefreshableLayerView-ea970069.js"],import.meta.url),wms:()=>ce(()=>import("./WMSLayerView3D-4cf443c4.js"),["./WMSLayerView3D-4cf443c4.js","./DynamicLayerView3D-8b0d2dc1.js","./LayerView3D-a480bbae.js","./projectExtentUtils-b83cb1bf.js","./ImageMaterial-3dbcbb9a.js","./LayerView-fa72efbb.js","./RefreshableLayerView-ea970069.js","./ExportWMSImageParameters-47d58d9b.js"],import.meta.url),wmts:()=>ce(()=>import("./WMTSLayerView3D-e506364e.js"),["./WMTSLayerView3D-e506364e.js","./LayerView3D-a480bbae.js","./TiledLayerView3D-90f865a6.js","./LayerView-fa72efbb.js","./RefreshableLayerView-ea970069.js"],import.meta.url),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};function vWe(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",i=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new G(`${i}:view-not-supported`,`${e} is not supported in 3D`)}const Ose={hasLayerViewModule:t=>Ase[t.type]!=null,importLayerView:t=>{const e=Ase[t.type];if(e==null)throw vWe(t);return e(t)}},Rse="analyses-owner-handles";var R2,dw;(function(t){t[t.PENDING=0]="PENDING",t[t.CREATED=1]="CREATED"})(R2||(R2={})),function(t){t[t.ADDED=0]="ADDED",t[t.REMOVED=1]="REMOVED"}(dw||(dw={}));let Rb=class extends we{constructor(e){super(e),this._allAnalysisViews=new Je,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=Pse(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(Ti("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(Ti()),this._attachedToViewResolver=Pse()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const i=this._items.get(e);if(i==null||i.state.list===dw.REMOVED)throw new G("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return i.createAnalysisViewTask.promise}_connectOwners(){this.addHandles(this._connectAnalysesCollection(this.view.analyses),Rse)}_disconnectOwners(){this.removeHandles(Rse),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const n of e)this._addAnalysis(n);const i=e.on("after-add",n=>this._addAnalysis(n.item)),r=e.on("after-remove",n=>this._removeAnalysis(n.item));return Vi(()=>{i.remove(),r.remove();for(const n of e)this._removeAnalysis(n)})}_addAnalysis(e){const i=this._items.get(e);if(i==null){const r={state:{view:R2.PENDING,list:dw.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,r),r.createAnalysisViewTask=Xv(n=>this._createAnalysisViewPromise(r,n))}else i.state.list=dw.ADDED}_removeAnalysis(e){const i=this._items.get(e);i!=null?(i.state.list=dw.REMOVED,this._scheduleUpdate()):K.getLogger(this).error("Trying to remove analysis which was not added")}_scheduleUpdate(){this._scheduledUpdateHandle==null&&(this._scheduledUpdateHandle=Ux(()=>this._update()))}_update(){this._scheduledUpdateHandle=Tr(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===dw.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case R2.PENDING:e.createAnalysisViewTask=Gc(e.createAnalysisViewTask);break;case R2.CREATED:e.view!=null&&(this._allAnalysisViews.remove(e.view),e.view=$e(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,i){const r=e.analysis,n=r.type,s=this._analysisModules[n];if(this._creatingViewCount+=1,s.module==null)try{s.module=await this._loadAnalysisModule(n)}catch(a){throw this._creatingViewCount-=1,a}if(ps(i))throw this._creatingViewCount-=1,Ti("AnalysisView creation aborted");const o=new s.module.default({analysis:r,view:this.view});try{await o.when()}catch(a){throw this._creatingViewCount-=1,a}if(ps(i))throw this._creatingViewCount-=1,o.destroy(),Ti("AnalysisView creation aborted");return e.view=o,e.state.view=R2.CREATED,this._allAnalysisViews.add(o),this._creatingViewCount-=1,o}_loadAnalysisModule(e){switch(e){case"area-measurement":return ce(()=>import("./AreaMeasurementAnalysisView3D-21521178.js").then(i=>i.A),["./AreaMeasurementAnalysisView3D-21521178.js","./UnitNormalizer-578e6b3d.js","./Segment-2d33ca9e.js","./unitFormatUtils-8c430bad.js","./LineVisualElement-60da457c.js","./elevationInfoUtils-d483be9b.js","./geometryEngine-d73b8deb.js","./geometryEngineBase-f6af2696.js","./hydrated-67746186.js","./EditGeometryOperations-06bc1d36.js"],import.meta.url);case"dimension":return ce(()=>import("./DimensionAnalysisView3D-1889d11d.js").then(i=>i.D),["./DimensionAnalysisView3D-1889d11d.js","./LineVisualElement-60da457c.js","./LengthDimension-dfef8776.js","./Segment-2d33ca9e.js","./unitFormatUtils-8c430bad.js","./elevationInfoUtils-d483be9b.js","./analysisViewUtils-66fe4cec.js","./Factory-6042a0b2.js","./ImageMaterial-3dbcbb9a.js","./vec4f32-0d1b2306.js","./RightAngleQuadVisualElement-d8315ed3.js","./PointVisualElement-622ec17b.js","./EditGeometryOperations-06bc1d36.js","./floorFilterUtils-73949d2d.js","./dehydratedFeatureComparison-01107244.js"],import.meta.url);case"direct-line-measurement":return ce(()=>import("./DirectLineMeasurementAnalysisView3D-30dd0b5a.js").then(i=>i.D),["./DirectLineMeasurementAnalysisView3D-30dd0b5a.js","./UnitNormalizer-578e6b3d.js","./Segment-2d33ca9e.js","./unitFormatUtils-8c430bad.js","./LineVisualElement-60da457c.js","./elevationInfoUtils-d483be9b.js","./geometryEngine-d73b8deb.js","./geometryEngineBase-f6af2696.js","./hydrated-67746186.js","./RightAngleQuadVisualElement-d8315ed3.js"],import.meta.url);case"line-of-sight":return ce(()=>import("./LineOfSightAnalysisView3D-26072bc4.js"),["./LineOfSightAnalysisView3D-26072bc4.js","./LineVisualElement-60da457c.js","./LineOfSightAnalysisTarget-d8124b02.js","./persistable-11a51d0d.js","./resourceExtension-e91c0a13.js","./elevationInfoUtils-d483be9b.js","./analysisViewUtils-66fe4cec.js","./PointVisualElement-622ec17b.js"],import.meta.url);case"slice":return ce(()=>import("./SliceAnalysisView3D-86ce73cd.js").then(i=>i.S),["./SliceAnalysisView3D-86ce73cd.js","./LineVisualElement-60da457c.js","./persistable-11a51d0d.js","./resourceExtension-e91c0a13.js","./BuildingComponentSublayer-aae26ebd.js","./FeatureLayer-4b20d634.js","./FeatureLayerBase-d5b34521.js","./LayerFloorInfo-2c0a736f.js","./serviceCapabilitiesUtils-979570ad.js","./editsZScale-edfeccc6.js","./queryZScale-47976d5a.js","./FeatureSet-20ce479f.js","./APIKeyMixin-3e91b31f.js","./EditBusLayer-4de7f58b.js","./OrderedLayer-ea33712e.js","./FeatureTemplate-1a55ea44.js","./FeatureType-c8e18d40.js","./versionUtils-f448b405.js","./TopFeaturesQuery-62024588.js","./capabilities-c607cf72.js","./I3SIndexInfo-e8052f88.js","./I3SLayerDefinitions-677add91.js","./I3SUtil-0d0882d1.js","./I3SBinaryReader-b93e280e.js","./popupUtils-85d853d6.js","./analysisViewUtils-66fe4cec.js","./Factory-6042a0b2.js","./ImageMaterial-3dbcbb9a.js"],import.meta.url)}}};function Pse(){const t=Hs();return t.promise.catch(()=>{}),t}u([p()],Rb.prototype,"updating",null),u([p({constructOnly:!0})],Rb.prototype,"view",void 0),u([p()],Rb.prototype,"_allAnalysisViews",void 0),u([p()],Rb.prototype,"_creatingViewCount",void 0),Rb=u([M("esri.views.3d.analysis.AnalysisViewManager3D")],Rb);const bWe=Rb;let Og=class extends we{constructor(e){super(e),this.collision=new H3,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===Le.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==Le.Local?this._set("altitude",e):K.getLogger(this).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?_e(e,this.altitude.min,this.altitude.max):e}clampTilt(e,i){if(!this.tilt)return i;const r=this.tilt(e);return _e(i,r.min,r.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===Le.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(i,r=Oz)=>(r.min=ia.min,r.max=e,r)}_createDefaultTiltLocal(){const e=this.collision.enabled?NN([[4e3,ia.max],[1e4,Dt(88)],[6e6,Dt(88)]]):()=>ia.max;return(i,r=Oz)=>(r.min=ia.min,r.max=e(i),r)}_createDefaultTiltGlobal(){const e=this.collision.enabled?NN([[4e3,ia.max],[5e4,Dt(88)],[6e6,Dt(88)],[2e7,ia.min]]):NN([[3e5,ia.max],[3e6,Dt(88)],[6e6,Dt(88)],[2e7,ia.min]]);return(i,r=Oz)=>(r.min=ia.min,r.max=e(i),r)}};function wWe(t){return{min:-2e5,max:4*t.radius}}u([p()],Og.prototype,"altitude",null),u([p({readOnly:!0})],Og.prototype,"collision",void 0),u([p()],Og.prototype,"distance",void 0),u([p({readOnly:!0})],Og.prototype,"minimumPoiDistance",void 0),u([p()],Og.prototype,"tilt",void 0),u([p({constructOnly:!0})],Og.prototype,"mode",void 0),Og=u([M("esri.views.3d.state.Constraints")],Og);const Mse=wWe(Ai),ia={min:Dt(.5),max:Dt(179.5)},Oz={min:0,max:0};let H3=class extends we{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};u([p({type:Boolean})],H3.prototype,"enabled",void 0),u([p({type:Number})],H3.prototype,"elevationMargin",void 0),H3=u([M("esri.views.3d.state.Constraints.CollisionConstraint")],H3);let P2=class extends we{constructor(){super(...arguments),this.min=Mse.min,this.max=Mse.max}};u([p({type:Number})],P2.prototype,"min",void 0),u([p({type:Number})],P2.prototype,"max",void 0),P2=u([M("esri.views.3d.constraints.AltitudeConstraint")],P2);let Vg=class extends we{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,i){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==i&&this._set("far",i))}};u([p({type:Number,value:1e-8})],Vg.prototype,"near",null),u([ai("near")],Vg.prototype,"castNear",null),u([p({type:Number,value:1e-8})],Vg.prototype,"far",null),u([ai("far")],Vg.prototype,"castFar",null),u([p({type:["auto","manual"]})],Vg.prototype,"mode",void 0),Vg=u([M("esri.views.3d.constraints.ClipDistanceConstraint")],Vg);const wH={min:ml(ia.min),max:ml(ia.max)};let pw=class extends we{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return _e(e,wH.min,wH.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};u([p({type:["auto","manual"]})],pw.prototype,"mode",void 0),u([p({type:Number,value:wH.max})],pw.prototype,"max",null),u([ai("max")],pw.prototype,"castMax",null),pw=u([M("esri.views.3d.constraints.TiltConstraint")],pw);let fw=class extends we{constructor(){super(...arguments),this.tilt=new pw,this.altitude=new P2,this.clipDistance=new Vg}};u([p({type:pw})],fw.prototype,"tilt",void 0),u([p({type:P2})],fw.prototype,"altitude",void 0),u([p({type:Vg})],fw.prototype,"clipDistance",void 0),fw=u([M("esri.views.3d.constraints.Constraints")],fw);var BS;const Exe="esri.views.3d.environment.SunLighting",bI=K.getLogger(Exe);let If=BS=class extends Sn.EventedMixin(gx){constructor(t){super(t),this.cameraTrackingEnabled=!0,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),i=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",i),this._set("date",i)}get ambientOcclusionEnabled(){return Kg(bI,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(t){Kg(bI,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",t)}get waterReflectionEnabled(){return Kg(bI,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(t){Kg(bI,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",t)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(t){return new BS(t.cloneConstructProperties())}set defaultDate(t){const e=this._get("date")===this._get("defaultDate");t=new Date(t.getTime()),this._set("defaultDate",t),e&&this._set("date",t)}set date(t){t!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t.getTime())))}autoUpdate(t,e){const i=BS.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let r=null;t!=null&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(r=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(r=this.date&&this.date.getTime(),this._set("date",new Date(t.getTime()))));const n=BS.calculateTimezoneOffset(this.positionTimezoneInfo);if(i!==n&&(wI.target=this,wI.timezoneOffset=n,this.emit("timezone-will-change",wI),wI.target=null),t!=null)return isNaN(t.getTime())||r!==t.getTime()}clone(){const t=this._get("date")===this._get("defaultDate"),e=new BS({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});return t&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(t){const e=this.clone();return t.date!=null&&(e.date=t.date),e.directShadowsEnabled=t.directShadowsEnabled,e.displayUTCOffset=t.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([p({type:Boolean})],If.prototype,"cameraTrackingEnabled",void 0),u([p({type:Boolean})],If.prototype,"ambientOcclusionEnabled",null),u([p({type:Boolean})],If.prototype,"waterReflectionEnabled",null),u([p({type:Date})],If.prototype,"defaultDate",null),u([p({type:Date})],If.prototype,"date",null),If=BS=u([M(Exe)],If),function(t){function e({hours:i,minutes:r,seconds:n}){return Math.round(i+r/60+n/3600)}t.calculateTimezoneOffset=e}(If||(If={}));const wI={target:null,timezoneOffset:0},Pb=If;var jN;const Cxe="esri.views.3d.environment.VirtualLighting",xI=K.getLogger(Cxe);let VS=jN=class extends Sn.EventedMixin(wM){constructor(t){super(t),this.cameraTrackingEnabled=!0}get ambientOcclusionEnabled(){return Kg(xI,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(t){Kg(xI,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",t)}get waterReflectionEnabled(){return Kg(xI,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(t){Kg(xI,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",t)}clone(){return new jN({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(t){return new jN(t.cloneConstructProperties())}cloneWithWebsceneLighting(t){const e=this.clone();return e.directShadowsEnabled=t.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([p({type:Boolean})],VS.prototype,"ambientOcclusionEnabled",null),u([p({type:Boolean})],VS.prototype,"waterReflectionEnabled",null),u([p({type:Boolean})],VS.prototype,"cameraTrackingEnabled",void 0),VS=jN=u([M(Cxe)],VS);const q3=VS,xWe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:Pb,virtual:q3}};var xH;let aR=xH=class extends we{set quality(t){["low","high"].includes(t)&&this._set("quality",t)}clone(){return new xH({quality:this.quality})}};u([p({type:["low","high"],value:"low"})],aR.prototype,"quality",null),aR=xH=u([M("esri.views.3d.environment.SceneViewAtmosphere")],aR);var W3;let GS=W3=class extends kE{constructor(t){super(t),this.atmosphere=new aR,this.lighting=this.castLighting(),this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(t){const e=t.cloneConstructProperties();return new W3({...e,lighting:e.lighting?e.lighting.type==="virtual"?q3.fromWebsceneLighting(e.lighting):Pb.fromWebsceneLighting(e.lighting):void 0})}castLighting(t){return this._convertLightingWithDestroy(t)}applyLighting(t){this.lighting=this._convertLightingWithDestroy(t)}_convertLightingWithDestroy(t){const e=this._convertLighting(t);return e!==t&&this.addHandles(kme(e)),e}_convertLighting(t){return t?t instanceof Pb||t instanceof q3?t:t instanceof gx?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(t):new Pb({...t.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):t instanceof wM?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t):new q3({...t.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):Tm(xWe,t):new Pb}clone(){return new W3({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:Q(this.background)})}cloneWithWebsceneEnvironment(t){return new W3({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:Q(this.background),...t.cloneConstructProperties(),lighting:this._getLighting(t)})}_getLighting(t){switch(t.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(t.lighting):Pb.fromWebsceneLighting(t.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t.lighting):q3.fromWebsceneLighting(t.lighting);default:return t.lighting,Pb.fromWebsceneLighting(t.lighting)}}};u([p({type:aR,json:{read:!1},nonNullable:!0})],GS.prototype,"atmosphere",void 0),u([p({nonNullable:!0})],GS.prototype,"lighting",void 0),u([ai("lighting")],GS.prototype,"castLighting",null),GS=W3=u([M("esri.views.3d.environment.SceneViewEnvironment")],GS);const jS=GS;function TWe(t,e,i){if(e==null)return!1;const r=W0e(e);return r!=null&&(r(t,0,bA,0),i!==bA&&(i[0]=bA[0],i[1]=bA[1],i.length>2&&(i[2]=bA[2])),!0)}const bA=E();function SWe(t,e){TI[0]=t.x,TI[1]=t.y;const i=t.z;return TI[2]=i!==void 0?i:0,TWe(TI,t.spatialReference,e)}const TI=E();var wa;(function(t){t[t.Realistic=0]="Realistic",t[t.Local=1]="Local",t[t.Mars=2]="Mars",t[t.None=3]="None"})(wa||(wa={}));function EWe(t){return"r"in t&&"g"in t&&"b"in t}function Axe(t){return"h"in t&&"s"in t&&"v"in t}function Oxe(t){return"l"in t&&"a"in t&&"b"in t}function Rxe(t){return"l"in t&&"c"in t&&"h"in t}function CWe(t){return"x"in t&&"y"in t&&"z"in t}const AWe=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],OWe=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function Pxe(t,e){const i=[];let r,n;if(t[0].length!==e.length)throw new Error("dimensions do not match");const s=t.length,o=t[0].length;let a=0;for(r=0;r<s;r++){for(a=0,n=0;n<o;n++)a+=t[r][n]*e[n];i.push(a)}return i}function Mxe(t){const e=[t.r/255,t.g/255,t.b/255].map(r=>r<=.04045?r/12.92:((r+.055)/1.055)**2.4),i=Pxe(AWe,e);return{x:100*i[0],y:100*i[1],z:100*i[2]}}function uK(t){const e=Pxe(OWe,[t.x/100,t.y/100,t.z/100]).map(i=>{const r=i<=.0031308?12.92*i:1.055*i**.4166666666666667-.055;return Math.min(1,Math.max(r,0))});return{r:Math.round(255*e[0]),g:Math.round(255*e[1]),b:Math.round(255*e[2])}}function $xe(t){const e=[t.x/95.047,t.y/100,t.z/108.883].map(i=>i>.008856451679035631?i**.3333333333333333:7.787037037037035*i+.13793103448275862);return{l:116*e[1]-16,a:500*(e[0]-e[1]),b:200*(e[1]-e[2])}}function Ixe(t){const e=t.l,i=[(e+16)/116+t.a/500,(e+16)/116,(e+16)/116-t.b/200].map(r=>r>6/29?r**3:3*(6/29)**2*(r-4/29));return{x:95.047*i[0],y:100*i[1],z:108.883*i[2]}}function RWe(t){const e=t.l,i=t.a,r=t.b,n=Math.sqrt(i*i+r*r);let s=Math.atan2(r,i);return s=s>0?s:s+2*Math.PI,{l:e,c:n,h:s}}function PWe(t){const e=t.l,i=t.c,r=t.h;return{l:e,a:i*Math.cos(r),b:i*Math.sin(r)}}function MWe(t){return $xe(Mxe(t))}function $We(t){return uK(Ixe(t))}function IWe(t){return RWe($xe(Mxe(t)))}function LWe(t){return uK(Ixe(PWe(t)))}function DWe(t){const e=t.r,i=t.g,r=t.b,n=Math.max(e,i,r),s=n-Math.min(e,i,r);let o=n,a=s===0?0:n===e?(i-r)/s%6:n===i?(r-e)/s+2:(e-i)/s+4,l=s===0?0:s/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}function NWe(t){const e=(t.h+360)%360/60,i=t.s/100,r=t.v/100*255,n=r*i,s=n*(1-Math.abs(e%2-1));let o;switch(Math.floor(e)){case 0:o={r:n,g:s,b:0};break;case 1:o={r:s,g:n,b:0};break;case 2:o={r:0,g:n,b:s};break;case 3:o={r:0,g:s,b:n};break;case 4:o={r:s,g:0,b:n};break;case 5:case 6:o={r:n,g:0,b:s};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+r-n),o.g=Math.round(o.g+r-n),o.b=Math.round(o.b+r-n),o}function hK(t){return EWe(t)?t:Rxe(t)?LWe(t):Oxe(t)?$We(t):CWe(t)?uK(t):Axe(t)?NWe(t):t}function ULt(t){return Axe(t)?t:DWe(hK(t))}function zLt(t){return Oxe(t)?t:MWe(hK(t))}function BLt(t){return Rxe(t)?t:IWe(hK(t))}function FWe(t){let{r:e,g:i,b:r,a:n}=t;return n<1&&(e=Math.round(n*e+255*(1-n)),i=Math.round(n*i+255*(1-n)),r=Math.round(n*r+255*(1-n))),new Pe({r:e,g:i,b:r})}function kWe(t,e){const{r:i,g:r,b:n}=e?.ignoreAlpha?t:FWe(t);return .2126*i+.7152*r+.0722*n}var TH;function VLt(t,e=TH.High){return kWe(t,{ignoreAlpha:!0})>e?new Pe([0,0,0,t.a]):new Pe([255,255,255,t.a])}function GLt(t,e){const i=t.clone();return i.a*=e,i}function wP(t){return Pe.toUnitRGBA(t)}function jLt(t,e){return t===e||t!=null&&e!=null&&px(t,e)}function HLt(t){return Ft(t[0],t[1],t[2],t.length>3?t[3]:1)}function qLt(t,e){const i=Pe.toUnitRGBA(t);return i[3]*=e,i}(function(t){t[t.Low=160]="Low",t[t.High=225]="High"})(TH||(TH={}));function gs(t,e){return t[0]=e[0],t[1]=e[1],t}function mi(t,e,i){return t[0]=e,t[1]=i,t}function sp(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function Qf(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function Lxe(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function Dxe(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function UWe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function zWe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function BWe(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t}function VWe(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t}function GWe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function Lc(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function jWe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t}function Iv(t,e){const i=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(i*i+r*r)}function yF(t,e){const i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r}function dK(t){const e=t[0],i=t[1];return Math.sqrt(e*e+i*i)}function Nxe(t){const e=t[0],i=t[1];return e*e+i*i}function pK(t,e){return t[0]=-e[0],t[1]=-e[1],t}function HWe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function xP(t,e){const i=e[0],r=e[1];let n=i*i+r*r;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t}function Ss(t,e){return t[0]*e[0]+t[1]*e[1]}function qWe(t,e,i){const r=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=r,t}function zh(t,e,i,r){const n=e[0],s=e[1];return t[0]=n+r*(i[0]-n),t[1]=s+r*(i[1]-s),t}function WWe(t,e){e=e||1;const i=2*pM()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t}function Fxe(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[2]*n,t[1]=i[1]*r+i[3]*n,t}function d_(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[2]*n+i[4],t[1]=i[1]*r+i[3]*n+i[5],t}function YWe(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[3]*n+i[6],t[1]=i[1]*r+i[4]*n+i[7],t}function XWe(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[4]*n+i[12],t[1]=i[1]*r+i[5]*n+i[13],t}function ZWe(t,e,i,r){const n=e[0]-i[0],s=e[1]-i[1],o=Math.sin(r),a=Math.cos(r);return t[0]=n*a-s*o+i[0],t[1]=n*o+s*a+i[1],t}function JWe(t,e){const i=t[0],r=t[1],n=e[0],s=e[1];let o=i*i+r*r;o>0&&(o=1/Math.sqrt(o));let a=n*n+s*s;a>0&&(a=1/Math.sqrt(a));const l=(i*n+r*s)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function KWe(t){return"vec2("+t[0]+", "+t[1]+")"}function kxe(t,e){return t[0]===e[0]&&t[1]===e[1]}function Uxe(t,e){const i=t[0],r=t[1],n=e[0],s=e[1],o=jo();return Math.abs(i-n)<=o*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-s)<=o*Math.max(1,Math.abs(r),Math.abs(s))}function QWe(t,e,i,r,n){let s=e[0]-i[0],o=e[1]-i[1];const a=(r[0]*s+r[1]*o)*(n-1);return s=r[0]*a,o=r[1]*a,t[0]=e[0]+s,t[1]=e[1]+o,t}const eYe=dK,tYe=Qf,iYe=Lxe,rYe=Dxe,zxe=Iv,nYe=yF,sYe=Nxe;Object.freeze(Object.defineProperty({__proto__:null,add:sp,angle:JWe,ceil:UWe,copy:gs,cross:qWe,dist:zxe,distance:Iv,div:rYe,divide:Dxe,dot:Ss,equals:Uxe,exactEquals:kxe,floor:zWe,inverse:HWe,len:eYe,length:dK,lerp:zh,max:VWe,min:BWe,mul:iYe,multiply:Lxe,negate:pK,normalize:xP,projectAndScale:QWe,random:WWe,rotate:ZWe,round:GWe,scale:Lc,scaleAndAdd:jWe,set:mi,sqrDist:nYe,sqrLen:sYe,squaredDistance:yF,squaredLength:Nxe,str:KWe,sub:tYe,subtract:Qf,transformMat2:Fxe,transformMat2d:d_,transformMat3:YWe,transformMat4:XWe},Symbol.toStringTag,{value:"Module"}));function fK(t){return _e((t-1e5)/(1e6-1e5),0,1)}const SH=1e4,oYe=.085,M_=1e5;let aYe=class{};const or=aYe;function b(t,...e){let i="";for(let r=0;r<e.length;r++)i+=t[r]+e[r];return i+=t[t.length-1],i}(function(t){function e(r){return Math.round(r).toString()}function i(r){return r.toPrecision(8)}t.int=e,t.float=i})(b||(b={}));var O;function lYe(t){return t===O.POSITION}(function(t){t.POSITION="position",t.NORMAL="normal",t.NORMALCOMPRESSED="normalCompressed",t.UV0="uv0",t.AUXPOS1="auxpos1",t.AUXPOS2="auxpos2",t.COLOR="color",t.SYMBOLCOLOR="symbolColor",t.SIZE="size",t.TANGENT="tangent",t.OFFSET="offset",t.PERSPECTIVEDIVIDE="perspectiveDivide",t.SUBDIVISIONFACTOR="subdivisionFactor",t.COLORFEATUREATTRIBUTE="colorFeatureAttribute",t.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",t.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",t.DISTANCETOSTART="distanceToStart",t.UVMAPSPACE="uvMapSpace",t.BOUNDINGRECT="boundingRect",t.UVREGION="uvRegion",t.PROFILERIGHT="profileRight",t.PROFILEUP="profileUp",t.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",t.FEATUREVALUE="featureValue",t.INSTANCEMODELORIGINHI="instanceModelOriginHi",t.INSTANCEMODELORIGINLO="instanceModelOriginLo",t.INSTANCEMODEL="instanceModel",t.INSTANCEMODELNORMAL="instanceModelNormal",t.INSTANCECOLOR="instanceColor",t.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",t.LOCALTRANSFORM="localTransform",t.GLOBALTRANSFORM="globalTransform",t.BOUNDINGSPHERE="boundingSphere",t.MODELORIGIN="modelOrigin",t.MODELSCALEFACTORS="modelScaleFactors",t.FEATUREATTRIBUTE="featureAttribute",t.STATE="state",t.LODLEVEL="lodLevel",t.POSITION0="position0",t.POSITION1="position1",t.NORMALA="normalA",t.NORMALB="normalB",t.COMPONENTINDEX="componentIndex",t.VARIANTOFFSET="variantOffset",t.VARIANTSTROKE="variantStroke",t.VARIANTEXTENSION="variantExtension",t.SIDENESS="sideness",t.START="start",t.END="end",t.UP="up",t.EXTRUDE="extrude",t.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",t.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"})(O||(O={}));var Zn;function mm(t,e){switch(e.textureCoordinateType){case Zn.Default:return t.attributes.add(O.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(b`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case Zn.Compressed:return t.attributes.add(O.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(b`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case Zn.Atlas:return t.attributes.add(O.UV0,"vec2"),t.varyings.add("vuv0","vec2"),t.attributes.add(O.UVREGION,"vec4"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(b`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:e.textureCoordinateType;case Zn.None:return void t.vertex.code.add(b`void forwardTextureCoordinates() {}`);case Zn.COUNT:return}}(function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Atlas=2]="Atlas",t[t.Compressed=3]="Compressed",t[t.COUNT=4]="COUNT"})(Zn||(Zn={}));function dd(t){t.code.add(b`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function od(t){t.include(dd),t.code.add(b`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromRGBA(vec4 depth, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(depth), nearFar);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTex, 0)));
return linearDepthFromRGBA(texelFetch(depthTex, iuv, 0), nearFar);
}`)}function yU(t){t.fragment.code.add(b`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var Oi;(function(t){t[t.Pass=0]="Pass",t[t.Draw=1]="Draw"})(Oi||(Oi={}));let dn=class{constructor(e,i,r,n,s=null){if(this.name=e,this.type=i,this.arraySize=s,this.bind={[Oi.Pass]:null,[Oi.Draw]:null},n)switch(r){case Oi.Pass:this.bind[Oi.Pass]=n;break;case Oi.Draw:this.bind[Oi.Draw]=n}}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},kt=class extends dn{constructor(e,i){super(e,"vec3",Oi.Pass,(r,n,s)=>r.setUniform3fv(e,i(n,s)))}};function jy(t){t.uniforms.add(new kt("mainLightDirection",(e,i)=>i.lighting.mainLight.direction))}function Gm(t){t.uniforms.add(new kt("mainLightIntensity",(e,i)=>i.lighting.mainLight.intensity))}function _F(t){jy(t.fragment),Gm(t.fragment),t.fragment.code.add(b`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}let Ki=class extends dn{constructor(e,i){super(e,"vec2",Oi.Pass,(r,n,s)=>r.setUniform2fv(e,i(n,s)))}},yi=class extends dn{constructor(e,i){super(e,"vec4",Oi.Pass,(r,n,s)=>r.setUniform4fv(e,i(n,s)))}},Re=class extends dn{constructor(e,i){super(e,"float",Oi.Pass,(r,n,s)=>r.setUniform1f(e,i(n,s)))}},en=class extends dn{constructor(e,i){super(e,"mat4",Oi.Pass,(r,n,s)=>r.setUniformMatrix4fv(e,i(n,s)))}};const za=oi();let cYe=class{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}};function tt(t,e){if(!t){e=e||"Assertion";const i=new Error(e).stack;throw new cYe(`${e} at ${i}`)}}function TT(t,e){t||(e=e||"",console.warn("Verify failed: "+e+`
`+new Error("verify").stack))}function $se(t,e,i,r){let n,s=(i[0]-t[0])/e[0],o=(r[0]-t[0])/e[0];s>o&&(n=s,s=o,o=n);let a=(i[1]-t[1])/e[1],l=(r[1]-t[1])/e[1];if(a>l&&(n=a,a=l,l=n),s>l||a>o)return!1;a>s&&(s=a),l<o&&(o=l);let c=(i[2]-t[2])/e[2],h=(r[2]-t[2])/e[2];return c>h&&(n=c,c=h,h=n),!(s>h||c>o)&&(h<o&&(o=h),!(o<0))}function SI(t,e,i,r,n,s=Ge()){const o=(r[n]-i[n])*(e[0]-t[0])-(r[0]-i[0])*(e[n]-t[n]),a=(r[0]-i[0])*(t[n]-i[n])-(r[n]-i[n])*(t[0]-i[0]);if(o===0)return!1;const l=a/o;return s[0]=t[0]+l*(e[0]-t[0]),s[1]=t[n]+l*(e[n]-t[n]),!0}function Ise(t,e,i,r,n){za[0]=t[0],za[1]=t[1],za[2]=t[2],za[3]=1,Fu(za,za,e),n.length>2&&(n[2]=-za[2]),Fu(za,za,i),tt(za[3]!==0),n[0]=za[0]/za[3],n[1]=za[1]/za[3],n[2]=za[2]/za[3],n[0]=(.5*n[0]+.5)*r[2]+r[0],n[1]=(.5*n[1]+.5)*r[3]+r[1]}function uYe(t,e){return Math.log(t)/Math.log(e)}function hYe(t,e,i,r){t[12]=e,t[13]=i,t[14]=r}function Bxe(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[15]===1}const Vxe=K.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let Gxe=class{constructor(){this._includedModules=new Map}include(e,i){if(this._includedModules.has(e)){const r=this._includedModules.get(e);if(r!==i){Vxe.error("Trying to include shader module multiple times with different sets of options.");const n=new Set;for(const s of Object.keys(r))r[s]!==e[s]&&n.add(s);for(const s of Object.keys(e))r[s]!==e[s]&&n.add(s);n.forEach(s=>console.error(`  ${s}: current ${r[s]} new ${e[s]}`))}}else this._includedModules.set(e,i),e(this.builder,i)}},Ei=class extends Gxe{constructor(){super(...arguments),this.vertex=new Lse,this.fragment=new Lse,this.attributes=new fYe,this.varyings=new mYe,this.extensions=new EH,this.constants=new jxe,this.outputs=new AH}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const i=this.extensions.generateSource(e),r=this.attributes.generateSource(e),n=this.varyings.generateSource(e),s=e==="vertex"?this.vertex:this.fragment,o=s.uniforms.generateSource(),a=s.code.generateSource(),l=e==="vertex"?yYe:gYe,c=this.constants.generateSource().concat(s.constants.generateSource()),h=this.outputs.generateSource(e);return`#version 300 es
${i.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${r.join(`
`)}

${n.join(`
`)}

${h.join(`
`)}

${a.join(`
`)}`}generateBindPass(e){const i=new Map;this.vertex.uniforms.entries.forEach(s=>{const o=s.bind[Oi.Pass];o&&i.set(s.name,o)}),this.fragment.uniforms.entries.forEach(s=>{const o=s.bind[Oi.Pass];o&&i.set(s.name,o)});const r=Array.from(i.values()),n=r.length;return(s,o)=>{for(let a=0;a<n;++a)r[a](e,s,o)}}generateBindDraw(e){const i=new Map;this.vertex.uniforms.entries.forEach(s=>{const o=s.bind[Oi.Draw];o&&i.set(s.name,o)}),this.fragment.uniforms.entries.forEach(s=>{const o=s.bind[Oi.Draw];o&&i.set(s.name,o)});const r=Array.from(i.values()),n=r.length;return(s,o,a)=>{for(let l=0;l<n;++l)r[l](e,s,o,a)}}},dYe=class{constructor(){this._entries=new Map}add(...e){for(const i of e)this._add(i)}get(e){return this._entries.get(e)}_add(e){if(e!=null){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new G(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else Vxe.error(`Trying to add null Uniform from ${new Error().stack}.`)}generateSource(){return Array.from(this._entries.values()).map(e=>e.arraySize!=null?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`)}get entries(){return Array.from(this._entries.values())}},pYe=class{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}},Lse=class extends Gxe{constructor(){super(...arguments),this.uniforms=new dYe,this.code=new pYe,this.constants=new jxe}get builder(){return this}},fYe=class{constructor(){this._entries=new Array}add(e,i){this._entries.push([e,i])}generateSource(e){return e==="fragment"?[]:this._entries.map(i=>`in ${i[1]} ${i[0]};`)}},mYe=class{constructor(){this._entries=new Map}add(e,i){this._entries.has(e)&&tt(this._entries.get(e)===i),this._entries.set(e,i)}generateSource(e){const i=new Array;return this._entries.forEach((r,n)=>i.push(e==="vertex"?`out ${r} ${n};`:`in ${r} ${n};`)),i}},EH=class CH{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const i=e==="vertex"?CH.ALLOWLIST_VERTEX:CH.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(r=>i.includes(r)).map(r=>`#extension ${r} : enable`)}};EH.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],EH.ALLOWLIST_VERTEX=[];let AH=class OH{constructor(){this._entries=new Map}add(e,i,r=0){const n=this._entries.get(r);n?tt(n.name===e&&n.type===i,`Fragment shader output location ${r} occupied`):this._entries.set(r,{name:e,type:i})}generateSource(e){if(e==="vertex")return[];this._entries.size===0&&this._entries.set(0,{name:OH.DEFAULT_NAME,type:OH.DEFAULT_TYPE});const i=new Array;return this._entries.forEach((r,n)=>i.push(`layout(location = ${n}) out ${r.type} ${r.name};`)),i}};AH.DEFAULT_TYPE="vec4",AH.DEFAULT_NAME="fragColor";let jxe=class _s{constructor(){this._entries=new Set}add(e,i,r){let n="ERROR_CONSTRUCTOR_STRING";switch(i){case"float":n=_s._numberToFloatStr(r);break;case"int":n=_s._numberToIntStr(r);break;case"bool":n=r.toString();break;case"vec2":n=`vec2(${_s._numberToFloatStr(r[0])},                            ${_s._numberToFloatStr(r[1])})`;break;case"vec3":n=`vec3(${_s._numberToFloatStr(r[0])},                            ${_s._numberToFloatStr(r[1])},                            ${_s._numberToFloatStr(r[2])})`;break;case"vec4":n=`vec4(${_s._numberToFloatStr(r[0])},                            ${_s._numberToFloatStr(r[1])},                            ${_s._numberToFloatStr(r[2])},                            ${_s._numberToFloatStr(r[3])})`;break;case"ivec2":n=`ivec2(${_s._numberToIntStr(r[0])},                             ${_s._numberToIntStr(r[1])})`;break;case"ivec3":n=`ivec3(${_s._numberToIntStr(r[0])},                             ${_s._numberToIntStr(r[1])},                             ${_s._numberToIntStr(r[2])})`;break;case"ivec4":n=`ivec4(${_s._numberToIntStr(r[0])},                             ${_s._numberToIntStr(r[1])},                             ${_s._numberToIntStr(r[2])},                             ${_s._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":n=`${i}(${Array.prototype.map.call(r,s=>_s._numberToFloatStr(s)).join(", ")})`}return this._entries.add(`const ${i} ${e} = ${n};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}};const gYe=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif`,yYe=`precision highp float;
precision highp sampler2D;`;let et=class extends dn{constructor(e,i){super(e,"sampler2D",Oi.Pass,(r,n,s)=>r.bindTexture(e,i(n,s)))}};const lR=Oe(parseFloat(5802e-9.toFixed(6)),parseFloat(13558e-9.toFixed(6)),parseFloat(331e-7.toFixed(6))),Rz=3,Pz=Oe(Rz*parseFloat(65e-8.toFixed(6)),Rz*parseFloat(1881e-9.toFixed(6)),Rz*parseFloat(85e-9.toFixed(6))),_Ye=3996e-9,vYe=Oe(parseFloat(Number(lR[0]+Pz[0]).toFixed(6)),parseFloat(Number(lR[1]+Pz[1]).toFixed(6)),parseFloat(Number(lR[2]+Pz[2]).toFixed(6)));function bYe(t){const e=new Ei;e.attributes.add(O.POSITION,"vec2"),e.include(mm,{textureCoordinateType:Zn.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:i,fragment:r}=e;return i.uniforms.add(new en("inverseProjectionMatrix",(n,s)=>s.camera.inverseProjectionMatrix),new en("inverseViewMatrix",(n,s)=>xC(wYe,s.camera.viewMatrix))),i.code.add(b`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new kt("backgroundColor",n=>n.backgroundColor),new Ki("radii",n=>n.radii),new kt("cameraPosition",(n,s)=>s.camera.eye),new yi("heightParameters",n=>n.heightParameters),new Re("innerFadeDistance",n=>n.innerFadeDistance),new Re("altitudeFade",n=>n.altitudeFade),new et("depthTexture",n=>n.depthTexture),new Re("hazeStrength",n=>n.hazeStrength)),r.constants.add("betaRayleigh","vec3",lR),r.constants.add("betaCombined","vec3",vYe),r.constants.add("betaMie","float",_Ye),r.constants.add("scaleHeight","float",oYe*M_),jy(r),e.include(yU),t.haze&&(r.include(od),r.uniforms.add(new Ki("nearFar",(n,s)=>s.camera.nearFar))),r.code.add(b`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(b`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),r.code.add(b`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),r.code.add(b`
    const int STEPS = 6;

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${t.haze?b`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${t.haze?"":b`mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * `} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${t.haze?"":b`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${t.haze?b`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:b`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    ${t.haze?"":b`
            vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
              vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
              if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
                return fragColor;
              }

              float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
              vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
              float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
              if (relDist > 1.0) {
                return surfaceColor;
              }

              return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
            }

            float getGlow(float dist, float radius, float intensity) {
              return pow(radius / max(dist, 1e-6), intensity);
            }

            vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){

              // Get the amount of atmosphere between camera and the Sun along the view ray
              float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
              float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));

              // Find the amount of light that remains after travelling through the atmosphere from the Sun along the view ray
              // This will make the colour of the Sun reddish on the horizon and white from space
              vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));

              // Alignment of light direction and view ray
              float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
              // Draw the Sun as a bright disc
              float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));

              return normalize(sunTransmittance) * sunDisc;
            }`}

    ${t.haze&&t.reduced?b`
        float getDepth(vec2 uv){
          return linearDepthFromTexture(depthTexture, uv, nearFar);
        }

        float textureBilinear(vec2 uv) {
          // Information about the high-resolution depth texture
          vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
          vec2 texelSize = 1.0 / depthTextureSize;

          // The uv inside the upper right pixel - of the tile of 4 pixels -
          // that the atmosphere uv maps to in the depth texture
          vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);

          // Relative distance of the uv coordinates inside the depth texture pixel
          vec2 f = fract(depthUV);

          // Snap to the centre of the depth texture pixel
          vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;

          // Read the depth texture pixel and its three neighbours
          float d0 = getDepth(snapUV);
          float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
          float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
          float d3 = getDepth(snapUV + texelSize);

          // Return the bilinearly interpolated value of the neighbouring pixels based
          // on the sample position in the depth texture pixel
          return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
        }
        `:""}

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${t.haze?b`
          vec4 depthSample = texture(depthTexture, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;

              ${t.reduced?b`cameraSpaceRay *= -textureBilinear(vuv0);`:b`cameraSpaceRay *= -linearDepthFromTexture(depthTexture, vuv0, nearFar);`}

            terrainDepth = max(0.0, length(cameraSpaceRay));
          }else{
            discard;
          }
          `:b`${t.reduced?"":b`
                float depthSample = texture(depthTexture, vuv0).r;
                if (depthSample != 1.0) {
                  fragColor = vec4(0);
                  return;
                }`}`}

      ${t.haze?b`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            // Alpha is ignored for haze blending
            float alpha = 1.0;
            `:b`
            vec3 col = linearizeGamma(backgroundColor);
            col += getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            col += getSun(cameraPosition, rayDir, mainLightDirection);
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      ${t.haze?"":b`fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);`}
    }
  `),e}const wYe=be(),xYe=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:lR,build:bYe},Symbol.toStringTag,{value:"Module"}));let Pi=class{constructor(e,i){this._module=e,this._loadModule=i}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}};var wr,ci,Te,Pm,Ct,bp,eC,Qe,Bi,tn,zt,Vt,bn,gt,We,Fs,fo,Ri,Pu,ta;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(wr||(wr={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(ci||(ci={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(Te||(Te={})),function(t){t[t.ADD=32774]="ADD",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.SUBTRACT=32778]="SUBTRACT",t[t.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(Pm||(Pm={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(Ct||(Ct={})),function(t){t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(bp||(bp={})),function(t){t[t.CW=2304]="CW",t[t.CCW=2305]="CCW"}(eC||(eC={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT"}(Qe||(Qe={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(Bi||(Bi={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP"}(tn||(tn={})),function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(zt||(zt={})),function(t){t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(Vt||(Vt={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(bn||(bn={})),function(t){t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.RED=6403]="RED",t[t.RG=33319]="RG",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER"}(gt||(gt={})),function(t){t[t.RGBA4=32854]="RGBA4",t[t.R16F=33325]="R16F",t[t.RG16F=33327]="RG16F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.R32F=33326]="R32F",t[t.RG32F=33328]="RG32F",t[t.RGBA32F=34836]="RGBA32F",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB5_A1=32855]="RGB5_A1",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGB565=36194]="RGB565",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI"}(We||(We={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.INT=5124]="INT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(Fs||(Fs={})),function(t){t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(fo||(fo={})),function(t){t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_READ=35045]="STATIC_READ",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.STREAM_COPY=35042]="STREAM_COPY"}(Ri||(Ri={})),function(t){t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER"}(Pu||(Pu={})),function(t){t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(ta||(ta={}));const Mz=33984;var Yn,zl,RH;(function(t){t[t.Texture=0]="Texture",t[t.BufferObject=1]="BufferObject",t[t.VertexArrayObject=2]="VertexArrayObject",t[t.Shader=3]="Shader",t[t.Program=4]="Program",t[t.FramebufferObject=5]="FramebufferObject",t[t.Renderbuffer=6]="Renderbuffer",t[t.Sync=7]="Sync",t[t.UNCOUNTED=8]="UNCOUNTED",t[t.LinesOfCode=8]="LinesOfCode",t[t.Uniform=9]="Uniform",t[t.COUNT=10]="COUNT"})(Yn||(Yn={})),function(t){t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(zl||(zl={})),function(t){t[t.NONE=0]="NONE",t[t.BACK=1029]="BACK"}(RH||(RH={}));const Dse=33306;var Pn,Nse,Fse,kse,vF,PH,Use;(function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(Pn||(Pn={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(Nse||(Nse={})),function(t){t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS"}(Fse||(Fse={})),function(t){t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED"}(kse||(kse={})),function(t){t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED"}(vF||(vF={})),function(t){t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(PH||(PH={})),function(t){t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(Use||(Use={}));let Fi=class{constructor(e,i,r){this.release=r,this.initializeConfiguration(e,i),this._configuration=i.snapshot(),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}destroy(){this._program=rt(this._program),this._pipeline=this._configuration=null}reload(e){rt(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return ci.TRIANGLES}getPipeline(e,i,r){return this._pipeline}initializeConfiguration(e,i){}};const Si=new Map([[O.POSITION,0],[O.NORMAL,1],[O.NORMALCOMPRESSED,1],[O.UV0,2],[O.COLOR,3],[O.COLORFEATUREATTRIBUTE,3],[O.SIZE,4],[O.TANGENT,4],[O.AUXPOS1,5],[O.SYMBOLCOLOR,5],[O.AUXPOS2,6],[O.FEATUREATTRIBUTE,6],[O.INSTANCEFEATUREATTRIBUTE,6],[O.INSTANCECOLOR,7],[O.OBJECTANDLAYERIDCOLOR,7],[O.INSTANCEOBJECTANDLAYERIDCOLOR,7],[O.INSTANCEMODEL,8],[O.INSTANCEMODELNORMAL,12],[O.INSTANCEMODELORIGINHI,11],[O.INSTANCEMODELORIGINLO,15]]),TYe=K.getLogger("esri.views.webgl.checkWebGLError");function SYe(t,e){switch(e){case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const Hxe=!!ie("enable-feature:webgl-debug");function op(){return Hxe}function MH(){return Hxe}function em(t){if(op()){const e=t.getError();if(e){const i=SYe(t,e),r=new Error().stack;TYe.error(new G("webgl-error","WebGL error occurred",{message:i,stack:r}))}}}let Mi=class{constructor(e,i,r){this._context=e,this._locations=r,this._textures=new Map,this._freeTextureUnits=new Ut({deallocator:null}),this._glProgram=e.programCache.acquire(i.generate("vertex"),i.generate("fragment"),r),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=i.generateBindPass(this),this.bindDraw=i.generateBindDraw(this),this._fragmentUniforms=op()?i.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get compiled(){return this._glProgram.compiled}setUniform1b(e,i){this._glProgram.setUniform1i(e,i?1:0)}setUniform1i(e,i){this._glProgram.setUniform1i(e,i)}setUniform1f(e,i){this._glProgram.setUniform1f(e,i)}setUniform2fv(e,i){this._glProgram.setUniform2fv(e,i)}setUniform3fv(e,i){this._glProgram.setUniform3fv(e,i)}setUniform4fv(e,i){this._glProgram.setUniform4fv(e,i)}setUniformMatrix3fv(e,i){this._glProgram.setUniformMatrix3fv(e,i)}setUniformMatrix4fv(e,i){this._glProgram.setUniformMatrix4fv(e,i)}setUniform1fv(e,i){this._glProgram.setUniform1fv(e,i)}setUniform1iv(e,i){this._glProgram.setUniform1iv(e,i)}setUniform2iv(e,i){this._glProgram.setUniform3iv(e,i)}setUniform3iv(e,i){this._glProgram.setUniform3iv(e,i)}setUniform4iv(e,i){this._glProgram.setUniform4iv(e,i)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,i){if(i?.glName==null){const n=this._textures.get(e);return n&&(this._context.bindTexture(null,n.unit),this._freeTextureUnit(n),this._textures.delete(e)),null}let r=this._textures.get(e);return r==null?(r=this._allocTextureUnit(i),this._textures.set(e,r)):r.texture=i,this._context.useProgram(this),this.setUniform1i(e,r.unit),this._context.bindTexture(i,r.unit),r.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((e,i)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(i,e.unit)}),this._fragmentUniforms!=null&&this._fragmentUniforms.forEach(e=>{e.type!=="sampler2D"&&e.type!=="samplerCube"||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)})}_allocTextureUnit(e){return{texture:e,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}};var xr,xx,Ln,Lv,Zl,Py,nr,Uc,cy;(function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"})(xr||(xr={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(xx||(xx={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(Ln||(Ln={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(Lv||(Lv={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(Zl||(Zl={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee",t[t.COUNT=2]="COUNT"}(Py||(Py={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(nr||(nr={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(Uc||(Uc={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(cy||(cy={}));function Yc(t,e,i=Pm.ADD,r=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function Go(t,e,i,r,n=Pm.ADD,s=Pm.ADD,o=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:i,dstAlpha:r,opRgb:n,opAlpha:s,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const mK={face:bp.BACK,mode:eC.CCW},qxe={face:bp.FRONT,mode:eC.CCW},_U=t=>t===xr.Back?mK:t===xr.Front?qxe:null,ec={zNear:0,zFar:1},Gt={r:!0,g:!0,b:!0,a:!0};function EYe(t){return LYe.intern(t)}function CYe(t){return DYe.intern(t)}function AYe(t){return NYe.intern(t)}function OYe(t){return FYe.intern(t)}function RYe(t){return kYe.intern(t)}function PYe(t){return UYe.intern(t)}function MYe(t){return zYe.intern(t)}function $Ye(t){return BYe.intern(t)}function IYe(t){return VYe.intern(t)}function Lt(t){return GYe.intern(t)}let jm=class{constructor(e,i){this._makeKey=e,this._makeRef=i,this._interns=new Map}intern(e){if(!e)return null;const i=this._makeKey(e),r=this._interns;return r.has(i)||r.set(i,this._makeRef(e)),r.get(i)??null}};function Hm(t){return"["+t.join(",")+"]"}const LYe=new jm(Wxe,t=>({__tag:"Blending",...t}));function Wxe(t){return t?Hm([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const DYe=new jm(Yxe,t=>({__tag:"Culling",...t}));function Yxe(t){return t?Hm([t.face,t.mode]):null}const NYe=new jm(Xxe,t=>({__tag:"PolygonOffset",...t}));function Xxe(t){return t?Hm([t.factor,t.units]):null}const FYe=new jm(Zxe,t=>({__tag:"DepthTest",...t}));function Zxe(t){return t?Hm([t.func]):null}const kYe=new jm(Jxe,t=>({__tag:"StencilTest",...t}));function Jxe(t){return t?Hm([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const UYe=new jm(Kxe,t=>({__tag:"DepthWrite",...t}));function Kxe(t){return t?Hm([t.zNear,t.zFar]):null}const zYe=new jm(Qxe,t=>({__tag:"ColorWrite",...t}));function Qxe(t){return t?Hm([t.r,t.g,t.b,t.a]):null}const BYe=new jm(eTe,t=>({__tag:"StencilWrite",...t}));function eTe(t){return t?Hm([t.mask]):null}const VYe=new jm(tTe,t=>({__tag:"DrawBuffers",...t}));function tTe(t){return t?Hm(t.buffers):null}const GYe=new jm(jYe,t=>({blending:EYe(t.blending),culling:CYe(t.culling),polygonOffset:AYe(t.polygonOffset),depthTest:OYe(t.depthTest),stencilTest:RYe(t.stencilTest),depthWrite:PYe(t.depthWrite),colorWrite:MYe(t.colorWrite),stencilWrite:$Ye(t.stencilWrite),drawBuffers:IYe(t.drawBuffers)}));function jYe(t){return t?Hm([Wxe(t.blending),Yxe(t.culling),Xxe(t.polygonOffset),Zxe(t.depthTest),Jxe(t.stencilTest),Kxe(t.depthWrite),Qxe(t.colorWrite),eTe(t.stencilWrite),tTe(t.drawBuffers)]):null}let HYe=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._setDrawBuffers(e.drawBuffers),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(e){this._drawBuffers=this._setSubState(e,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(e,i,r,n){return(r||e!==i)&&(n(e),this._pipelineInvalid=!0),e}},qYe=class extends or{constructor(){super(...arguments),this.heightParameters=oi(),this.radii=Ge(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1,this.renderScale=Ge(),this.backgroundColor=E()}},Y3=class iTe extends Fi{initializeProgram(e){return new Mi(e.rctx,iTe.shader.get().build(this.configuration),Si)}initializePipeline(){return this.configuration.reduced?Lt({blending:Yc(Te.ONE,Te.ZERO),depthTest:{func:Bi.ALWAYS},colorWrite:Gt}):this.configuration.haze?Lt({blending:Go(Te.ONE,Te.ZERO,Te.ONE_MINUS_SRC_COLOR,Te.ONE),colorWrite:Gt}):Lt({blending:Yc(Te.SRC_ALPHA,Te.ONE_MINUS_SRC_ALPHA),depthTest:{func:Bi.LEQUAL},colorWrite:Gt})}};Y3.shader=new Pi(xYe,()=>ce(()=>import("./ChapmanAtmosphere.glsl-fcb88f14.js"),[],import.meta.url));let tc=class extends or{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,i={key:this.key};for(const r of e)i[r]=this[r];return i}};function U(t={}){return(e,i)=>{if(e._parameterNames=e._parameterNames??[],e._parameterNames.push(i),t.constValue!=null)Object.defineProperty(e,i,{get:()=>t.constValue});else{const r=e._parameterNames.length-1,n=t.count||2,s=Math.ceil(Math.log2(n)),o=e._parameterBits??[0];let a=0;for(;o[a]+s>16;)a++,a>=o.length&&o.push(0);e._parameterBits=o;const l=o[a],c=(1<<s)-1<<l;o[a]+=s,Object.defineProperty(e,i,{get(){return this[r]},set(h){if(this[r]!==h&&(this[r]=h,this._keyDirty=!0,this._parameterBits[a]=this._parameterBits[a]&~c|+h<<l&c,typeof h!="number"&&typeof h!="boolean"))throw new Error("Configuration value for "+i+" must be boolean or number, got "+typeof h)}})}}}let bF=class extends tc{constructor(){super(...arguments),this.haze=!1,this.reduced=!1}};u([U()],bF.prototype,"haze",void 0),u([U()],bF.prototype,"reduced",void 0);const cR=-3;var ap;(function(t){t[t.ALL=0]="ALL",t[t.SOME=1]="SOME"})(ap||(ap={}));let WYe=class{constructor(e,i,r){this.name=e,this._storage=i,this.id=YYe+++":",this.size=0,this.maxSize=0,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),r&&(this._storage.registerRemoveFunc(this.id,r),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get sizeAll(){return this._storage.size}resetHitRate(){this._hit=this._miss=0}put(e,i,r,n=0){this._storage.put(this,e,i,r,n)}get(e){const i=this._storage.get(this,e);return i===void 0?++this._miss:++this._hit,i}peek(e){return this._storage.peek(this,e)}pop(e){const i=this._storage.pop(this,e);return i===void 0?++this._miss:++this._hit,i}updateSize(e,i,r){this._storage.updateSize(this,e,i,r)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}},rTe=class{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new Ut,this._users=new Ut}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,i){this._removeFuncs.push([e,i])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace(i=>i[0]!==e)}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,0),this._checkSizeLimits()}put(e,i,r,n,s){i=e.id+i;const o=this._db.get(i);if(o&&(this._size-=o.size,e.size-=o.size,this._db.delete(i),o.entry!==r&&this._notifyRemove(i,o.entry,ap.ALL)),n>this._maxSize)return void this._notifyRemove(i,r,ap.ALL);if(r===void 0)return void console.warn("Refusing to cache undefined entry ");if(!n||n<0)return console.warn(`Refusing to cache entry with size ${n} for key ${i}`),void this._notifyRemove(i,r,ap.ALL);const a=1+Math.max(s,cR)-cR;this._db.set(i,{entry:r,size:n,lifetime:a,lives:a}),this._size+=n,e.size+=n,this._checkSizeLimits()}updateSize(e,i,r,n){i=e.id+i;const s=this._db.get(i);if(s&&s.entry===r){for(this._size-=s.size,e.size-=s.size;n>this._maxSize;){const o=this._notifyRemove(i,r,ap.SOME);if(!(o!=null&&o>0))return void this._db.delete(i);n=o}s.size=n,this._size+=n,e.size+=n,this._checkSizeLimits()}}pop(e,i){i=e.id+i;const r=this._db.get(i);if(r)return this._size-=r.size,e.size-=r.size,this._db.delete(i),++this._hit,r.entry;++this._miss}get(e,i){i=e.id+i;const r=this._db.get(i);if(r!==void 0)return this._db.delete(i),r.lives=r.lifetime,this._db.set(i,r),++this._hit,r.entry;++this._miss}peek(e,i){const r=this._db.get(e.id+i);return r?++this._hit:++this._miss,r?.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},i={},r=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;r[l]=(r[l]||0)+o.size,this._users.forAll(c=>{const{id:h,name:d}=c;if(a.startsWith(h)){const f=i[d]||0;i[d]=f+o.size}})});const n={};this._users.forAll(o=>{const a=o.name;if("hitRate"in o&&typeof o.hitRate=="number"&&!isNaN(o.hitRate)&&o.hitRate>0){const l=i[a]||0;i[a]=l,n[a]=Math.round(100*o.hitRate)+"%"}else n[a]="0%"});const s=Object.keys(i);s.sort((o,a)=>i[a]-i[o]),s.forEach(o=>e[o]=Math.round(i[o]/2**20)+"MB / "+n[o]);for(let o=r.length-1;o>=0;--o){const a=r[o];a&&(e["Priority "+(o+cR-1)]=Math.round(a/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll(e=>e.resetHitRate())}clear(e){const i=e.id;this._db.forEach((r,n)=>{n.startsWith(i)&&(this._size-=r.size,this._db.delete(n),this._notifyRemove(n,r.entry,ap.ALL))}),e.size=0}clearAll(){this._db.forEach((e,i)=>this._notifyRemove(i,e.entry,ap.ALL)),this._users.forEach(e=>e.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,i,r){let n;return this._removeFuncs.some(s=>{if(e.startsWith(s[0])){const o=s[1](i,r);return typeof o=="number"&&(n=o),!0}return!1}),n}_checkSizeLimits(){if(this._size>this._maxSize){for(const[e,i]of this._db)if(this._purgeItem(e,i),this._size<=.9*this.maxSize)return}this._users.forEach(e=>{if(e.maxSize>0&&e.size>e.maxSize){for(const[i,r]of this._db)if(i.startsWith(e.id)&&(this._purgeItem(i,r,e),e.size<=.9*e.maxSize))return}})}_purgeItem(e,i,r=this._users.find(n=>e.startsWith(n.id))){if(this._db.delete(e),i.lives<=1){this._size-=i.size,r&&(r.size-=i.size);const n=this._notifyRemove(e,i.entry,ap.SOME);n!=null&&n>0&&(this._size+=n,r&&(r.size+=n),i.lives=i.lifetime,i.size=n,this._db.set(e,i))}else--i.lives,this._db.set(e,i)}},YYe=0,DM=class{constructor(e,i){this._cache=e(i,(r,n)=>this._remove(r,n))}hitrate(){return this._cache.hitRate}destroy(){this._cache.destroy()}clear(){this._cache.clear()}pop(e){const i=this._cache.peek(e);if(!i)return;const r=i.pop();if(i.length>0){const n=i.reduce((s,o)=>s+o.usedMemory,0);this._cache.updateSize(e,i,n)}else this._cache.pop(e);return r}put(e,i,r=cR){const n=this._cache.peek(e);if(!n)return void this._cache.put(e,[i],i.usedMemory,r);n.push(i);const s=n.reduce((o,a)=>o+a.usedMemory,0);this._cache.updateSize(e,n,s)}_remove(e,i){switch(i){case ap.ALL:return e.forEach(r=>r.dispose()),0;case ap.SOME:return e.shift()?.dispose(),e.reduce((r,n)=>r+n.usedMemory,0)}}},$z=class{constructor(e,i){this._last=new Ut,this._incarnation=0,this._cache=new DM(e,i)}destroy(){this._last?.forAll(e=>e.dispose()),this._last=null,this._cache.destroy()}set interactive(e){e&&!this._last?this._last=new Ut:e||(this._last?.forAll(i=>i.dispose()),this._last=null)}clean(){this._last?.filterInPlace(e=>!(e.incarnation<this._incarnation)||(this._cache.put(e.key,e),!1))}frame(){++this._incarnation}pop(e){if(this._last){const i=this._last.find(r=>r.key===e);if(i)return this._last.removeUnordered(i),i}return this._cache.pop(e)}put(e){e.incarnation=this._incarnation,this._last?this._last.push(e):this._cache.put(e.key,e)}get usedMemory(){return this._last?.reduce((e,i)=>e+i.usedMemory,0)??0}};var fi;function $H(t,e,i={}){const r=e===fi.WEBGL1?"webgl":"webgl2";return t.getContext(r,i)||null}function XYe(t,e,i={}){const r=nTe(t);for(const n of r){const s=$H(e,n,i);if(s)return s}return null}function nTe(t){if(t==="3d")return[fi.WEBGL2];const e=ie("esri-force-webgl");return e===fi.WEBGL1||e===fi.WEBGL2?[e]:ie("mac")&&ie("chrome")?[fi.WEBGL1,fi.WEBGL2]:[fi.WEBGL2,fi.WEBGL1]}(function(t){t[t.WEBGL1=1]="WEBGL1",t[t.WEBGL2=2]="WEBGL2"})(fi||(fi={}));const rf=K.getLogger("esri.views.webgl.BufferObject");let Ui=class HS{static createIndex(e,i,r){return new HS(e,Ct.ELEMENT_ARRAY_BUFFER,i,r)}static createVertex(e,i,r){return new HS(e,Ct.ARRAY_BUFFER,i,r)}static createUniform(e,i,r){if(e.type!==fi.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new HS(e,Ct.UNIFORM_BUFFER,i,r)}static createPixelPack(e,i=Ri.STREAM_READ,r){if(e.type!==fi.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const n=new HS(e,Ct.PIXEL_PACK_BUFFER,i);return r&&n.setSize(r),n}static createPixelUnpack(e,i=Ri.STREAM_DRAW,r){if(e.type!==fi.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new HS(e,Ct.PIXEL_UNPACK_BUFFER,i,r)}constructor(e,i,r,n){this._context=e,this.bufferType=i,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(Yn.BufferObject,this),this._glName=this._context.gl.createBuffer(),em(this._context.gl),n&&this.setData(n)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteLength(){return this.bufferType===Ct.ELEMENT_ARRAY_BUFFER?this._indexType===Qe.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===Ct.ELEMENT_ARRAY_BUFFER||this.bufferType===Ct.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(Yn.BufferObject,this),this._context=null):this._glName&&rf.warn("Leaked WebGL buffer object")}setSize(e,i=null){if(e<=0&&rf.error("Buffer size needs to be positive!"),this.bufferType===Ct.ELEMENT_ARRAY_BUFFER&&i!=null)switch(this._indexType=i,i){case Qe.UNSIGNED_SHORT:e*=2;break;case Qe.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let i=e.byteLength;this.bufferType===Ct.ELEMENT_ARRAY_BUFFER&&(i6(e)&&(i/=2,this._indexType=Qe.UNSIGNED_SHORT),r6(e)&&(i/=4,this._indexType=Qe.UNSIGNED_INT)),this._setBufferData(i,e)}_setBufferData(e,i=null){this._size=e;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const n=this._context.gl;i!=null?n.bufferData(this.bufferType,i,this.usage):n.bufferData(this.bufferType,e,this.usage),em(n),this._isVAOAware&&this._context.bindVAO(r)}setSubData(e,i,r,n){if(!e)return;(i<0||i*e.BYTES_PER_ELEMENT>=this.byteLength)&&rf.error("offset is out of range!"),r>=n&&rf.error("end must be bigger than start!"),(i+(n-r))*e.BYTES_PER_ELEMENT>this.byteLength&&rf.error("An attempt to write beyond the end of the buffer!");const s=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const o=this._context.gl;if(this._context.type===fi.WEBGL2)o.bufferSubData(this.bufferType,i*e.BYTES_PER_ELEMENT,e,r,n-r);else{const a=r===0&&n===e.length?e:e.subarray(r,n);o.bufferSubData(this.bufferType,i*e.BYTES_PER_ELEMENT,a)}em(o),this._isVAOAware&&this._context.bindVAO(s)}getSubData(e,i=0,r,n){if(this._context.type!==fi.WEBGL2)return void rf.error("Get buffer subdata is supported in WebGL2 only!");if(r<0||n<0)return void rf.error("Problem getting subdata: offset and length were less than zero!");const s=ZYe(e)?e.BYTES_PER_ELEMENT:1;if(s*((r??0)+(n??0))>e.byteLength)return void rf.error("Problem getting subdata: offset and length exceeded destination size!");i+s*(n??0)>this.byteLength&&rf.warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this._context.bindBuffer(this,Ct.COPY_READ_BUFFER),o.getBufferSubData(Ct.COPY_READ_BUFFER,i,e,r,n),this._context.unbindBuffer(Ct.COPY_READ_BUFFER)}async getSubDataAsync(e,i=0,r,n){this._context.type===fi.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(e,i,r,n)):rf.error("Get buffer subdata is supported in WebGL2 only!")}};function ZYe(t){return YIe(t)}var Dv;(function(t){t[t.Texture=0]="Texture",t[t.RenderBuffer=1]="RenderBuffer"})(Dv||(Dv={}));function JYe(t){const e=t.gl;switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case e.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case e.INVALID_OPERATION:return"The specified command is not allowed for the current state";case e.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case e.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case e.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function uy(t,e){return t.vertexBuffers[e].byteLength/KYe(t.layout[e])}function KYe(t){return t[0].stride}function gK(t,e,i,r,n=0){const s=t.gl;t.bindBuffer(i);for(const o of r){const a=e.get(o.name);a===void 0&&console.error(`There is no location for vertex attribute '${o.name}' defined.`);const l=n*o.stride;if(o.count<=4)s.vertexAttribPointer(a,o.count,o.type,o.normalized,o.stride,o.offset+l),s.enableVertexAttribArray(a),o.divisor>0&&t.gl2?.vertexAttribDivisor(a,o.divisor);else if(o.count===9)for(let c=0;c<3;c++)s.vertexAttribPointer(a+c,3,o.type,o.normalized,o.stride,o.offset+12*c+l),s.enableVertexAttribArray(a+c),o.divisor>0&&t.gl2?.vertexAttribDivisor(a+c,o.divisor);else if(o.count===16)for(let c=0;c<4;c++)s.vertexAttribPointer(a+c,4,o.type,o.normalized,o.stride,o.offset+16*c+l),s.enableVertexAttribArray(a+c),o.divisor>0&&t.gl2?.vertexAttribDivisor(a+c,o.divisor);else console.error("Unsupported vertex attribute element count: "+o.count)}}function yK(t,e,i,r){const n=t.gl;t.bindBuffer(i);for(const s of r){const o=e.get(s.name);if(s.count<=4)n.disableVertexAttribArray(o),s.divisor&&s.divisor>0&&t.gl2?.vertexAttribDivisor(o,0);else if(s.count===9)for(let a=0;a<3;a++)n.disableVertexAttribArray(o+a),s.divisor&&s.divisor>0&&t.gl2?.vertexAttribDivisor(o+a,0);else if(s.count===16)for(let a=0;a<4;a++)n.disableVertexAttribArray(o+a),s.divisor&&s.divisor>0&&t.gl2?.vertexAttribDivisor(o+a,0);else console.error("Unsupported vertex attribute element count: "+s.count)}t.unbindBuffer(Ct.ARRAY_BUFFER)}function _K(t){switch(t){case gt.ALPHA:case gt.LUMINANCE:case gt.RED:case gt.RED_INTEGER:case We.R8:case We.R8I:case We.R8UI:case We.R8_SNORM:case fo.STENCIL_INDEX8:return 1;case gt.LUMINANCE_ALPHA:case gt.RG:case gt.RG_INTEGER:case We.RGBA4:case We.R16F:case We.R16I:case We.R16UI:case We.RG8:case We.RG8I:case We.RG8UI:case We.RG8_SNORM:case We.RGB565:case We.RGB5_A1:case fo.DEPTH_COMPONENT16:return 2;case gt.DEPTH_COMPONENT:case gt.RGB:case gt.RGB_INTEGER:case We.RGB8:case We.RGB8I:case We.RGB8UI:case We.RGB8_SNORM:case We.SRGB8:case fo.DEPTH_COMPONENT24:return 3;case gt.DEPTH_STENCIL:case gt.DEPTH24_STENCIL8:case gt.RGBA:case gt.RGBA_INTEGER:case We.RGBA8:case We.R32F:case We.R11F_G11F_B10F:case We.RG16F:case We.R32I:case We.R32UI:case We.RG16I:case We.RG16UI:case We.RGBA8I:case We.RGBA8UI:case We.RGBA8_SNORM:case We.SRGB8_ALPHA8:case We.RGB9_E5:case We.RGB10_A2UI:case We.RGB10_A2:case fo.DEPTH_STENCIL:case fo.DEPTH_COMPONENT32F:case fo.DEPTH24_STENCIL8:return 4;case fo.DEPTH32F_STENCIL8:return 5;case We.RGB16F:case We.RGB16I:case We.RGB16UI:return 6;case We.RG32F:case We.RG32I:case We.RG32UI:case We.RGBA16F:case We.RGBA16I:case We.RGBA16UI:return 8;case We.RGB32F:case We.RGB32I:case We.RGB32UI:return 12;case We.RGBA32F:case We.RGBA32I:case We.RGBA32UI:return 16;case Pn.COMPRESSED_RGB_S3TC_DXT1_EXT:case Pn.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case Pn.COMPRESSED_RGBA_S3TC_DXT3_EXT:case Pn.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case Pn.COMPRESSED_R11_EAC:case Pn.COMPRESSED_SIGNED_R11_EAC:case Pn.COMPRESSED_RGB8_ETC2:case Pn.COMPRESSED_SRGB8_ETC2:case Pn.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case Pn.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case Pn.COMPRESSED_RG11_EAC:case Pn.COMPRESSED_SIGNED_RG11_EAC:case Pn.COMPRESSED_RGBA8_ETC2_EAC:case Pn.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}let HN=class{constructor(e,i,r=i){this.internalFormat=e,this.width=i,this.height=r,this.multisampled=!1,this.samples=1}};function QYe(t){return t.width<=0||t.height<=0||t.internalFormat==null?0:t.width*t.height*_K(t.internalFormat)}let sTe=class{constructor(e,i){this._context=e,this._descriptor=i,this.type=Dv.RenderBuffer,this._context.instanceCounter.increment(Yn.Renderbuffer,this);const r=this._context.gl;this.glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:n,height:s,internalFormat:o,multisampled:a}=i;if(a){if(this._context.type!==fi.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");r.renderbufferStorageMultisample(r.RENDERBUFFER,this.samples,o,n,s)}else r.renderbufferStorage(r.RENDERBUFFER,o,n,s)}get descriptor(){return this._descriptor}get samples(){const e=this._descriptor.samples,i=this._context.parameters.maxSamples;return e?Math.min(e,i):i}get gpuMemoryUsage(){return QYe(this._descriptor)}resize(e,i){const r=this._descriptor;if(r.width===e&&r.height===i)return;r.width=e,r.height=i;const n=this._context.gl;this._context.bindRenderbuffer(this),r.multisampled?n.renderbufferStorageMultisample(n.RENDERBUFFER,this.samples,r.internalFormat,r.width,r.height):n.renderbufferStorage(n.RENDERBUFFER,r.internalFormat,r.width,r.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(Yn.Renderbuffer,this),this._context=null)}},Hi=class{constructor(e=0,i=e){this.width=e,this.height=i,this.target=bn.TEXTURE_2D,this.pixelFormat=gt.RGBA,this.dataType=Fs.UNSIGNED_BYTE,this.samplingMode=zt.LINEAR,this.wrapMode=Vt.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.depth=1,this.isImmutable=!1}};function eXe(t){return t.width<=0||t.height<=0?0:t.width*t.height*(t.hasMipmap?4/3:1)*(t.internalFormat==null?4:_K(t.internalFormat))}let tXe=class oTe extends Hi{constructor(e,i){switch(super(),this.context=e,Object.assign(this,i),this.internalFormat){case We.R16F:case We.R16I:case We.R16UI:case We.R32F:case We.R32I:case We.R32UI:case We.R8_SNORM:case We.R8:case We.R8I:case We.R8UI:this.pixelFormat=gt.RED}}static validate(e,i){return new oTe(e,i)}};const zse=4;let Nt=class{constructor(e,i=null,r=null){if(this.type=Dv.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,r=i;else{const n=tXe.validate(e,i);if(!n)throw new G("Texture descriptor invalid");this._descriptor=n}if(this._descriptor.context.type!==fi.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),Mb(this._descriptor.target)))throw new G("3D and array textures are not supported in WebGL1");this._descriptor.target===bn.TEXTURE_CUBE_MAP?this._setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get gpuMemoryUsage(){return oXe.delete(this),eXe(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._glName&&this._descriptor.context.instanceCounter.decrement(Yn.Texture,this),this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(e,i){const r=this._descriptor;if(r.width!==e||r.height!==i){if(this._wasImmutablyAllocated)throw new G("Immutable textures can't be resized!");r.width=e,r.height=i,this._descriptor.target===bn.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let i=bn.TEXTURE_CUBE_MAP_POSITIVE_X;i<=bn.TEXTURE_CUBE_MAP_NEGATIVE_Z;i++)this._setData(e,i)}setData(e){this._setData(e)}_setData(e,i){if(!this._descriptor.context?.gl)return;const r=this._descriptor.context.gl;em(r),this._glName||(this._glName=r.createTexture(),this._glName&&this._descriptor.context.instanceCounter.increment(Yn.Texture,this)),e===void 0&&(e=null);const n=this._descriptor,s=i??n.target,o=Mb(s);e===null&&(n.width=n.width||zse,n.height=n.height||zse,o&&(n.depth=n.depth??1));const a=this._descriptor.context.bindTexture(this,Nt.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(Nt.TEXTURE_UNIT_FOR_UPDATES),Iz(this._descriptor.context,n),this._configurePixelStorage(),em(r);const l=this._deriveInternalFormat();if(Lz(e)){let c="width"in e?e.width:e.codedWidth,h="height"in e?e.height:e.codedHeight;const d=1;e instanceof HTMLVideoElement&&(c=e.videoWidth,h=e.videoHeight),n.width&&n.height,o&&n.depth,n.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(s,l,n.hasMipmap,c,h,d),this._texImage(s,0,l,c,h,d,e),em(r),n.hasMipmap&&this.generateMipmap(),n.width||(n.width=c),n.height||(n.height=h),o&&!n.depth&&(n.depth=d)}else{const{width:c,height:h,depth:d}=n;if(c==null||h==null)throw new G("Width and height must be specified!");if(o&&d==null)throw new G("Depth must be specified!");if(n.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(s,l,n.hasMipmap,c,h,d),qN(e)){const f=e.levels,m=Gse(s,c,h,d),y=Math.min(m-1,f.length-1);this._descriptor.context.gl2!=null?r.texParameteri(n.target,this._descriptor.context.gl2.TEXTURE_MAX_LEVEL,y):n.hasMipmap=n.hasMipmap&&m===f.length;const _=l;if(!nXe(_))throw new G("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel((v,w,x,T)=>{const S=f[Math.min(v,f.length-1)];this._compressedTexImage(s,v,_,w,x,T,S)},y)}else this._texImage(s,0,l,c,h,d,e),em(r),n.hasMipmap&&this.generateMipmap()}Bse(r,this._descriptor),Vse(r,this._descriptor),iXe(this._descriptor.context,this._descriptor),em(r),this._descriptor.context.bindTexture(a,Nt.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,i,r,n,s,o,a=0){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const l=this._descriptor.context.gl,c=this._descriptor.context.gl2,h=this._descriptor,d=this._deriveInternalFormat(),{pixelFormat:f,dataType:m,target:y,isImmutable:_}=h;if(_&&!this._wasImmutablyAllocated)throw new G("Cannot update immutable texture before allocation!");const v=this._descriptor.context.bindTexture(this,Nt.TEXTURE_UNIT_FOR_UPDATES,!0);if((i<0||r<0||n>h.width||s>h.height||i+n>h.width||r+s>h.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),a){if(!c)return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(c.UNPACK_SKIP_ROWS,a)}if(Lz(o)?c?c.texSubImage2D(y,e,i,r,n,s,f,m,o):l.texSubImage2D(y,e,i,r,f,m,o):qN(o)?l.compressedTexSubImage2D(y,e,i,r,n,s,d,o.levels[e]):l.texSubImage2D(y,e,i,r,n,s,f,m,o),a){if(!c)return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(c.UNPACK_SKIP_ROWS,0)}this._descriptor.context.bindTexture(v,Nt.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,i,r,n,s,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._descriptor.context.gl2;if(c==null)throw new G("3D textures are not supported in WebGL1");const h=this._descriptor,d=this._deriveInternalFormat(),{pixelFormat:f,dataType:m,isImmutable:y,target:_}=h;if(y&&!this._wasImmutablyAllocated)throw new G("Cannot update immutable texture before allocation!");Mb(_)||console.warn("Attempting to set 3D texture data on a non-3D texture");const v=this._descriptor.context.bindTexture(this,Nt.TEXTURE_UNIT_FOR_UPDATES);if(this._descriptor.context.setActiveTexture(Nt.TEXTURE_UNIT_FOR_UPDATES),(i<0||r<0||n<0||s>h.width||o>h.height||a>h.depth||i+s>h.width||r+o>h.height||n+a>h.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),qN(l))l=l.levels[e],c.compressedTexSubImage3D(_,e,i,r,n,s,o,a,d,l);else{const w=l;c.texSubImage3D(_,e,i,r,n,s,o,a,f,m,w)}this._descriptor.context.bindTexture(v,Nt.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new G("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,Iz(this._descriptor.context,e)}e.samplingMode===zt.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=zt.LINEAR_MIPMAP_NEAREST):e.samplingMode===zt.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=zt.NEAREST_MIPMAP_NEAREST);const i=this._descriptor.context.bindTexture(this,Nt.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(Nt.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(e.target),this._descriptor.context.bindTexture(i,Nt.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,Iz(this._descriptor.context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._descriptor.context.gl,i=this._descriptor;this._samplingModeDirty&&(Bse(e,i),this._samplingModeDirty=!1),this._wrapModeDirty&&(Vse(e,i),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(this._descriptor.context.type===fi.WEBGL1)return this._descriptor.internalFormat=this._descriptor.pixelFormat;if(this._descriptor.internalFormat!=null)return this._descriptor.internalFormat===gt.DEPTH_STENCIL&&(this._descriptor.internalFormat=gt.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case Fs.FLOAT:switch(this._descriptor.pixelFormat){case gt.RGBA:return this._descriptor.internalFormat=We.RGBA32F;case gt.RGB:return this._descriptor.internalFormat=We.RGB32F;default:throw new G("Unable to derive format")}case Fs.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case gt.RGBA:return this._descriptor.internalFormat=We.RGBA8;case gt.RGB:return this._descriptor.internalFormat=We.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===gt.DEPTH_STENCIL?gt.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:i,flipped:r,preMultiplyAlpha:n}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,i),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n?1:0)}_texStorage(e,i,r,n,s,o){const a=this._descriptor.context.gl2;if(a==null)throw new G("Immutable textures are not supported in WebGL1");if(!rXe(i))throw new G("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=r?Gse(e,n,s,o):1;if(Mb(e)){if(o==null)throw new G("Missing depth dimension for 3D texture upload");a.texStorage3D(e,l,i,n,s,o)}else a.texStorage2D(e,l,i,n,s);this._wasImmutablyAllocated=!0}_texImage(e,i,r,n,s,o,a){const l=this._descriptor.context.gl,c=Mb(e),{isImmutable:h,pixelFormat:d,dataType:f}=this._descriptor,m=this._descriptor.context.type===fi.WEBGL2,y=m?l:null;if(m||!Lz(a))if(h){if(a!=null){const _=a;if(c){if(o==null)throw new G("Missing depth dimension for 3D texture upload");y.texSubImage3D(e,i,0,0,0,n,s,o,d,f,_)}else l.texSubImage2D(e,i,0,0,n,s,d,f,_)}}else{const _=a;if(c){if(o==null)throw new G("Missing depth dimension for 3D texture upload");y.texImage3D(e,i,r,n,s,o,0,d,f,_)}else l.texImage2D(e,i,r,n,s,0,d,f,_)}else l.texImage2D(e,0,r,d,f,a)}_compressedTexImage(e,i,r,n,s,o,a){const l=this._descriptor.context.gl;let c=null;const h=Mb(e),d=this._descriptor.isImmutable;if(h){if(this._descriptor.context.type!==fi.WEBGL2)throw new G("3D textures are not supported in WebGL1");c=l}if(d){if(a!=null)if(h){if(o==null)throw new G("Missing depth dimension for 3D texture upload");c.compressedTexSubImage3D(e,i,0,0,0,n,s,o,r,a)}else l.compressedTexSubImage2D(e,i,0,0,n,s,r,a)}else if(h){if(o==null)throw new G("Missing depth dimension for 3D texture upload");c.compressedTexImage3D(e,i,r,n,s,o,0,a)}else l.compressedTexImage2D(e,i,r,n,s,0,a)}_forEachMipmapLevel(e,i=1/0){let{width:r,height:n,depth:s,hasMipmap:o,target:a}=this._descriptor;const l=a===bn.TEXTURE_3D;if(r==null||n==null||l&&s==null)throw new G("Missing texture dimensions for mipmap calculation");for(let c=0;e(c,r,n,s),o&&(r!==1||n!==1||l&&s!==1)&&!(c>=i);++c)r=Math.max(1,r>>1),n=Math.max(1,n>>1),l&&(s=Math.max(1,s>>1))}};function Iz(t,e){(e.width!=null&&e.width<0||e.height!=null&&e.height<0||e.depth!=null&&e.depth<0)&&console.error("Negative dimension parameters are not allowed!");const i=t.type===fi.WEBGL2;i||!e.isImmutable&&!Mb(e.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),!i&&(e.width!=null&&fx(e.width)&&e.height!=null&&fx(e.height)||(typeof e.wrapMode=="number"?e.wrapMode!==Vt.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):e.wrapMode.s===Vt.CLAMP_TO_EDGE&&e.wrapMode.t===Vt.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),e.hasMipmap&&console.error("Mipmapping requires power-of-two textures!")))}function Bse(t,e){let i=e.samplingMode,r=e.samplingMode;i===zt.LINEAR_MIPMAP_NEAREST||i===zt.LINEAR_MIPMAP_LINEAR?(i=zt.LINEAR,e.hasMipmap||(r=zt.LINEAR)):i!==zt.NEAREST_MIPMAP_NEAREST&&i!==zt.NEAREST_MIPMAP_LINEAR||(i=zt.NEAREST,e.hasMipmap||(r=zt.NEAREST)),t.texParameteri(e.target,t.TEXTURE_MAG_FILTER,i),t.texParameteri(e.target,t.TEXTURE_MIN_FILTER,r)}function Vse(t,e){typeof e.wrapMode=="number"?(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode)):(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode.s),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode.t))}function iXe(t,e){const i=t.capabilities.textureFilterAnisotropic;i&&t.gl.texParameterf(e.target,i.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}function rXe(t){return t in We}function nXe(t){return t in Pn}function qN(t){return t!=null&&"type"in t&&t.type==="compressed"}function sXe(t){return t!=null&&"byteLength"in t}function Lz(t){return t!=null&&!qN(t)&&!sXe(t)}function Mb(t){return t===bn.TEXTURE_3D||t===bn.TEXTURE_2D_ARRAY}function Gse(t,e,i,r=1){let n=Math.max(e,i);return t===bn.TEXTURE_3D&&(n=Math.max(n,r)),Math.round(Math.log(n)/Math.LN2)+1}Nt.TEXTURE_UNIT_FOR_UPDATES=0;const oXe=new Map,aXe=K.getLogger("esri.views.webgl.FramebufferObject");let jp=class qS{constructor(e,i,r=null){this._context=e,this._glName=null,this._colorAttachments=new Map,this._depthStencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,e.instanceCounter.increment(Yn.FramebufferObject,this);const n=WN(i)?i:new Nt(this._context,i);if(this._colorAttachments.set(zl.COLOR_ATTACHMENT0,n),this._validateTextureDescriptor(n.descriptor),this._validateColorAttachmentPoint(zl.COLOR_ATTACHMENT0),r!=null)if(cXe(r))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),this._depthStencilTexture=WN(r)?r:new Nt(this._context,r),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const s=lXe(r)?r:new sTe(this._context,r);this._depthStencilBuffer=s,this._validateRenderBufferDescriptor(s.descriptor)}}dispose(){if(this._colorAttachments.size===0&&!this._glName)return;const e=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((i,r)=>this.detachColorTexture(r)?.dispose()),this.detachDepthStencilBuffer()?.dispose(),this.detachDepthStencilTexture()?.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(Yn.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(zl.COLOR_ATTACHMENT0)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._colorAttachments.get(zl.COLOR_ATTACHMENT0)?.descriptor?.width??0}get height(){return this._colorAttachments.get(zl.COLOR_ATTACHMENT0)?.descriptor?.height??0}get gpuMemoryUsage(){return[...this._colorAttachments].reduce((e,[i,r])=>e+r.gpuMemoryUsage,this.depthStencil?.gpuMemoryUsage??0)}getColorTexture(e){const i=this._colorAttachments.get(e);return i&&WN(i)?i:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(e,i=zl.COLOR_ATTACHMENT0){if(!e)return;this._validateColorAttachmentPoint(i);const r=e.descriptor;this._validateTextureDescriptor(r),this.detachColorTexture(i)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,i)),this._colorAttachments.set(i,e)}detachColorTexture(e=zl.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(e);if(i)return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e)),this._colorAttachments.delete(e),i}setColorTextureTarget(e,i=zl.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(i);r&&this._framebufferTexture2D(r.glName,i,e)}attachDepthStencil(e){if(e)switch(e.type){case Dv.Texture:return this._attachDepthStencilTexture(e);case Dv.RenderBuffer:return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){if(e==null)return;const i=e.descriptor;i.pixelFormat!==gt.DEPTH_STENCIL&&i.pixelFormat!==gt.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),i.dataType!==Fs.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),this._validateTextureDescriptor(i),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,Dse)),this._depthStencilTexture?.dispose(),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;return e&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,Dse)),this._depthStencilTexture=null,e}_attachDepthStencilBuffer(e){if(e==null)return;const i=e.descriptor;if(this._validateRenderBufferDescriptor(i),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,n=this._getGLAttachmentPoint(i);r.framebufferRenderbuffer(ta.FRAMEBUFFER,n,r.RENDERBUFFER,e.glName)}this._depthStencilBuffer=e}detachDepthStencilBuffer(){const e=this._depthStencilBuffer;if(e&&this._initialized){this._context.bindFramebuffer(this);const i=this._context.gl,r=this._getGLAttachmentPoint(e.descriptor);i.framebufferRenderbuffer(ta.FRAMEBUFFER,r,i.RENDERBUFFER,null)}return this._depthStencilBuffer=null,e}copyToTexture(e,i,r,n,s,o,a){(e<0||i<0||s<0||o<0)&&console.error("Offsets cannot be negative!"),(r<=0||n<=0)&&console.error("Copy width and height must be greater than zero!");const l=a.descriptor;a.descriptor.target!==bn.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),(l?.width==null||l?.height==null||e+r>this.width||i+n>this.height||s+r>l.width||o+n>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const c=this._context,h=c.bindTexture(a,Nt.TEXTURE_UNIT_FOR_UPDATES);c.setActiveTexture(Nt.TEXTURE_UNIT_FOR_UPDATES),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(bn.TEXTURE_2D,0,s,o,e,i,r,n),c.bindTexture(h,Nt.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,i,r,n,s,o,a){(r<=0||n<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,i,r,n,s,o,a)}async readPixelsAsync(e,i,r,n,s,o,a){if(this._context.type!==fi.WEBGL2)return op()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(e,i,r,n,s,o,a);const l=this._context.gl,c=Ui.createPixelPack(this._context,Ri.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(e,i,r,n,s,o,0),this._context.unbindBuffer(Ct.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(e,i){if(this.width===e&&this.height===i)return;const r={width:e,height:i};Pw(r,this._context.parameters.maxTextureSize),this._colorAttachments.forEach(n=>n.resize(r.width,r.height)),this._depthStencilTexture?.resize(r.width,r.height),this._initialized&&(Pw(r,this._context.parameters.maxRenderbufferSize),this._depthStencilBuffer?.resize(r.width,r.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(e=ta.FRAMEBUFFER){const i=this._context.gl;if(this._initialized)return void i.bindFramebuffer(e,this.glName);this._glName&&i.deleteFramebuffer(this._glName);const r=i.createFramebuffer();if(i.bindFramebuffer(e,r),this._colorAttachments.forEach((n,s)=>this._framebufferTexture2D(n.glName,s,jse(n),e)),this._depthStencilBuffer){const n=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);i.framebufferRenderbuffer(e,n,i.RENDERBUFFER,this._depthStencilBuffer.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,i.DEPTH_STENCIL_ATTACHMENT,jse(this._depthStencilTexture),e);op()&&i.checkFramebufferStatus(e)!==i.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=r,this._initialized=!0}_framebufferTexture2D(e,i=zl.COLOR_ATTACHMENT0,r=bn.TEXTURE_2D,n=ta.FRAMEBUFFER,s=0){this._context.gl.framebufferTexture2D(n,i,r,e,s)}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const i=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);e.framebufferRenderbuffer(ta.FRAMEBUFFER,i,e.RENDERBUFFER,null)}this._depthStencilBuffer=rt(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=rt(this._depthStencilTexture))}_validateTextureDescriptor(e){e.target!==bn.TEXTURE_2D&&e.target!==bn.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),Pw(e,this._context.parameters.maxTextureSize),this._validateBufferDimensions(e)}_validateRenderBufferDescriptor(e){Pw(e,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(e)}_validateBufferDimensions(e){e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),this.width>0&&this.height>0&&(this.width===e.width&&this.height===e.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(e){switch(e.internalFormat){case fo.DEPTH_COMPONENT16:case fo.DEPTH_COMPONENT24:case fo.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case fo.DEPTH24_STENCIL8:case fo.DEPTH32F_STENCIL8:case fo.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case fo.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(e){if(qS._MAX_COLOR_ATTACHMENTS===-1){const r=this._context.capabilities.drawBuffers;if(r){const n=this._context.gl;qS._MAX_COLOR_ATTACHMENTS=n.getParameter(r.MAX_COLOR_ATTACHMENTS)}else qS._MAX_COLOR_ATTACHMENTS=1}const i=e-zl.COLOR_ATTACHMENT0;i+1>qS._MAX_COLOR_ATTACHMENTS&&K.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${i+1}. Implementation supports up to ${qS._MAX_COLOR_ATTACHMENTS} color attachments`)}};function WN(t){return t!=null&&"type"in t&&t.type===Dv.Texture}function lXe(t){return t!=null&&"type"in t&&t.type===Dv.RenderBuffer}function cXe(t){return WN(t)||t!=null&&"pixelFormat"in t}function Pw(t,e){const i=Math.max(t.width,t.height);if(i>e){aXe.warn(`Resizing FBO attachment size ${t.width}x${t.height} to device limit ${e}`);const r=e/i;return t.width=Math.round(t.width*r),t.height=Math.round(t.height*r),!1}return!0}function jse(t){return t.descriptor.target===bn.TEXTURE_CUBE_MAP?bn.TEXTURE_CUBE_MAP_POSITIVE_X:bn.TEXTURE_2D}jp._MAX_COLOR_ATTACHMENTS=-1;let uXe=class{constructor(e){this.rctx=e,this._acquired=new Set,this._cache=new $z(e.newCache,"FBOCache"),this._depthCache=new $z(e.newCache,"DepthAttachmentCache"),this._colorCache=new $z(e.newCache,"ColorAttachmentCache")}destroy(){this._cache.destroy(),this._depthCache.destroy(),this._colorCache.destroy()}clean(){this._cache.clean(),this._colorCache.clean(),this._depthCache.clean()}frame(){this._cache.frame(),this._colorCache.frame(),this._depthCache.frame()}get usedMemory(){return Array.from(this._acquired.values()).reduce((e,i)=>e+("colorTexture"in i?i.colorTexture?.gpuMemoryUsage??0:i.usedMemory),this._cache.usedMemory+this._colorCache.usedMemory+this._depthCache.usedMemory)}set interactive(e){this._cache.interactive=this._colorCache.interactive=this._depthCache.interactive=e}acquire(e,i,r){const n=Dz(e,i,r),s=this._cache.pop(n)||new hXe(n,new jp(this.rctx,{...qse[e],width:i,height:r}),o=>(s.releaseDepth(),s.depth=this._acquireDepth(o,s.fbo.width,s.fbo.height),s.fbo.attachDepthStencil(s.depth.attachment),s),(o,a)=>{const l=this._acquireColor(o,i,r);return s.colors??(s.colors=new Map),s.colors.set(a,l),s.fbo.attachColorTexture(l.attachment,a),s});return s.release=()=>{this._acquired.delete(s),s.releaseDepth(),this._cache.put(s),s.release=()=>console.log(`Double FBO release in ${new Error().stack}`)},this.rctx.unbindTexture(s.fbo.colorTexture),this._trackHandle(s)}acquireDepth(e,i,r){return this._acquireDepth(e,i,r)}_acquireDepth(e,i,r){const n=Dz(e,i,r),s=this._depthCache.pop(n);if(s)return this._trackHandle(s);const o=e===As.DEPTH_STENCIL_TEXTURE?new Hse(n,new Nt(this.rctx,{...Wse[e],width:i,height:r}),()=>{this._acquired.delete(o),this._depthCache.put(o)}):new Hse(n,new sTe(this.rctx,{...Wse[e],width:i,height:r}),()=>{this._acquired.delete(o),this._depthCache.put(o)});return this._trackHandle(o)}_acquireColor(e,i,r){const n=Dz(e,i,r),s=this._colorCache.pop(n);if(s)return this._trackHandle(s);const o=new dXe(n,new Nt(this.rctx,{...qse[e],width:i,height:r}),()=>{this._acquired.delete(o),this._colorCache.put(o)});return this._trackHandle(o)}_trackHandle(e){return this._acquired.add(e),e}},hXe=class{constructor(e,i,r,n){this.key=e,this.fbo=i,this.acquireDepth=r,this.acquireColor=n,this.release=()=>{},this.incarnation=0}dispose(){this.fbo.dispose()}releaseDepth(){this.fbo.detachDepthStencilTexture(),this.fbo.detachDepthStencilBuffer(),this.depth=li(this.depth)}detachDepth(){const e=this.depth;return this.depth=void 0,this.fbo.detachDepthStencilTexture(),this.fbo.detachDepthStencilBuffer(),e}attachDepth(e){return this.releaseDepth(),e&&(this.fbo.attachDepthStencil(e.attachment),this.depth=e),this}releaseColor(e){this.fbo.detachColorTexture(e);const i=this.colors?.get(e);this.colors?.delete(e),li(i)}get colorTexture(){return this.fbo?.colorTexture}getColorTexture(e=zl.COLOR_ATTACHMENT0){return this.fbo?.getColorTexture(e)}get usedMemory(){return this.fbo.gpuMemoryUsage}},aTe=class{constructor(e,i,r){this.key=e,this.attachment=i,this.release=r,this.incarnation=0}dispose(){this.attachment.dispose()}get usedMemory(){return this.attachment.gpuMemoryUsage}},Hse=class extends aTe{},dXe=class extends aTe{constructor(e,i,r){super(e,i,r),this.attachment=i,this.release=r}};function Dz(t,e,i){return`${t}x${e}x${i}`}var xi;(function(t){t[t.RED=0]="RED",t[t.RG=1]="RG",t[t.RGBA4=2]="RGBA4",t[t.RGBA=3]="RGBA",t[t.RGBA_MIPMAP=4]="RGBA_MIPMAP",t[t.R16F=5]="R16F",t[t.RGBA16F=6]="RGBA16F"})(xi||(xi={}));const YN=new Hi;YN.pixelFormat=gt.RED,YN.internalFormat=We.R8,YN.wrapMode=Vt.CLAMP_TO_EDGE;const XN=new Hi;XN.pixelFormat=gt.RG,XN.internalFormat=We.RG8,XN.wrapMode=Vt.CLAMP_TO_EDGE;const ZN=new Hi;ZN.internalFormat=We.RGBA4,ZN.dataType=Fs.UNSIGNED_SHORT_4_4_4_4,ZN.wrapMode=Vt.CLAMP_TO_EDGE;const lTe=new Hi;lTe.wrapMode=Vt.CLAMP_TO_EDGE;const X3=new Hi;X3.wrapMode=Vt.CLAMP_TO_EDGE,X3.samplingMode=zt.LINEAR_MIPMAP_LINEAR,X3.hasMipmap=!0,X3.maxAnisotropy=8;const Z3=new Hi;Z3.pixelFormat=gt.RED,Z3.dataType=Fs.HALF_FLOAT,Z3.internalFormat=We.R16F,Z3.samplingMode=zt.NEAREST;const JN=new Hi;JN.dataType=Fs.HALF_FLOAT,JN.internalFormat=We.RGBA16F,JN.samplingMode=zt.NEAREST;const qse={[xi.RED]:YN,[xi.RG]:XN,[xi.RGBA4]:ZN,[xi.RGBA]:lTe,[xi.RGBA_MIPMAP]:X3,[xi.R16F]:Z3,[xi.RGBA16F]:JN};var As;(function(t){t[t.DEPTH_STENCIL_TEXTURE=0]="DEPTH_STENCIL_TEXTURE",t[t.DEPTH_STENCIL_BUFFER=1]="DEPTH_STENCIL_BUFFER",t[t.DEPTH24_BUFFER=2]="DEPTH24_BUFFER",t[t.DEPTH16_BUFFER=3]="DEPTH16_BUFFER"})(As||(As={}));const J3=new Hi;J3.pixelFormat=gt.DEPTH_STENCIL,J3.dataType=Fs.UNSIGNED_INT_24_8,J3.samplingMode=zt.NEAREST,J3.wrapMode=Vt.CLAMP_TO_EDGE;const Wse={[As.DEPTH_STENCIL_TEXTURE]:J3,[As.DEPTH_STENCIL_BUFFER]:new HN(fo.DEPTH24_STENCIL8,4),[As.DEPTH24_BUFFER]:new HN(fo.DEPTH_COMPONENT24,4),[As.DEPTH16_BUFFER]:new HN(fo.DEPTH_COMPONENT16,4)};let Vo=class{constructor(e,i,r,n,s,o=!1,a=0){this.name=e,this.count=i,this.type=r,this.offset=n,this.stride=s,this.normalized=o,this.divisor=a}};new Vo(O.POSITION,3,Qe.FLOAT,0,12);new Vo(O.POSITION,3,Qe.FLOAT,0,20),new Vo(O.UV0,2,Qe.FLOAT,12,20);new Vo(O.POSITION,3,Qe.FLOAT,0,32),new Vo(O.NORMAL,3,Qe.FLOAT,12,32),new Vo(O.UV0,2,Qe.FLOAT,24,32);new Vo(O.POSITION,3,Qe.FLOAT,0,16),new Vo(O.COLOR,4,Qe.UNSIGNED_BYTE,12,16);const vK=[new Vo(O.POSITION,2,Qe.FLOAT,0,8)],NM=[new Vo(O.POSITION,2,Qe.FLOAT,0,16),new Vo(O.UV0,2,Qe.FLOAT,8,16)],ST=K.getLogger("esri.views.webgl.VertexArrayObject");let ad=class{constructor(e,i,r,n,s=null){this._context=e,this._locations=i,this._layout=r,this._buffers=n,this._indexBuffer=s,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce((e,i)=>e+this._buffers[i].byteLength,this._indexBuffer!=null?this._indexBuffer.byteLength:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*Ame}dispose(){if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const e in this._buffers)this._buffers[e]?.dispose(),delete this._buffers[e];this._indexBuffer=rt(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&ST.warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&((this._context?.capabilities?.vao).deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(Yn.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const e=this._context.capabilities.vao;if(e){const i=e.createVertexArray();e.bindVertexArray(i),this._bindLayout(),e.bindVertexArray(null),this._glName=i,this._context.instanceCounter.increment(Yn.VertexArrayObject,this)}this._initialized=!0}bind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:e,_layout:i,_indexBuffer:r}=this;e||ST.error("Vertex buffer dictionary is empty!");const n=this._context.gl;for(const s in e){const o=e[s];o||ST.error("Vertex buffer is uninitialized!");const a=i[s];a||ST.error("Vertex element descriptor is empty!"),gK(this._context,this._locations,o,a)}r!=null&&(this._context.capabilities.vao?n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r.glName):this._context.bindBuffer(r))}unbind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:e,_layout:i}=this;e||ST.error("Vertex buffer dictionary is empty!");for(const r in e){const n=e[r];n||ST.error("Vertex buffer is uninitialized!");const s=i[r];yK(this._context,this._locations,n,s)}this._indexBuffer!=null&&this._context.unbindBuffer(this._indexBuffer.bufferType)}},Hp=class extends ad{};function qm(t,e=vK,i=Si,r=-1,n=1){let s=null;return e===NM?s=new Float32Array([r,r,0,0,n,r,1,0,r,n,0,1,n,n,1,1]):s=new Float32Array([r,r,n,r,r,n,n,n]),new Hp(t,i,{geometry:e},{geometry:Ui.createVertex(t,Ri.STATIC_DRAW,s)})}function pXe(t,e=vK,i=Si){const r=new Float32Array([-1,-1,3,-1,-1,3]);return new Hp(t,i,{geometry:e},{geometry:Ui.createVertex(t,Ri.STATIC_DRAW,r)})}const fXe=4;function cTe(t){const e=new Hi(fXe);return e.samplingMode=zt.NEAREST,new Nt(t,e)}function mXe(t){const e=new Hi(1);return e.samplingMode=zt.NEAREST,new Nt(t,e,new Uint8Array([255,255,255,255]))}const Yse=16;function Ww(t){return Math.ceil(t/Yse)*Yse}function gXe(t,e){let s=t.width*t.height;if(s<4096)return t instanceof ImageData?uTe(t):t;let o=t.width,a=t.height;do o=Math.ceil(o/2),a=Math.ceil(a/2),s=o*a;while(s>1048576||e!=null&&(o>e||a>e));return bK(t,o,a)}function yXe(t,e){const i=Math.max(t.width,t.height);if(i<=e)return t;const r=e/i;return bK(t,Math.round(t.width*r),Math.round(t.height*r))}function bK(t,e,i){if(t instanceof ImageData)return bK(uTe(t),e,i);const r=document.createElement("canvas");return r.width=e,r.height=i,r.getContext("2d").drawImage(t,0,0,r.width,r.height),r}function uTe(t){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");if(i==null)throw new G("Failed to create 2d context from HTMLCanvasElement");return i.putImageData(t,0,0),e}function Na(t,e=!0){t.attributes.add(O.POSITION,"vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.code.add(b`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?b`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}let hTe=class extends or{};function _Xe(t){const e=new Ei;e.include(Na),e.fragment.uniforms.add(new et("colorTexture",r=>r.color),new et("depthTexture",r=>r.depth));const i=t.haze;return e.fragment.code.add(b`
    void main() {
      ${i?b`vec4`:b`float`} depthSample = texture(depthTexture, uv) ${i?"":b`.r`};
      if (depthSample ${i?b`== vec4(0)`:b`!= 1.0`} ) {
          fragColor = vec4(0);
          return;
      }
      fragColor = texture(colorTexture, uv);
    }
    `),e}const vXe=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:hTe,build:_Xe},Symbol.toStringTag,{value:"Module"}));let dTe=class pTe extends Fi{initializeProgram(e){return new Mi(e.rctx,pTe.shader.get().build(this.configuration),Si)}initializePipeline(){return this.configuration.haze?Lt({blending:Go(Te.ONE,Te.ZERO,Te.ONE_MINUS_SRC_COLOR,Te.ONE),depthTest:{func:Bi.ALWAYS},colorWrite:Gt}):Lt({blending:Yc(Te.SRC_ALPHA,Te.ONE_MINUS_SRC_ALPHA),depthTest:{func:Bi.ALWAYS},colorWrite:Gt})}};dTe.shader=new Pi(vXe,()=>ce(()=>import("./AtmosphereCompositing.glsl-0c14e278.js"),[],import.meta.url));let Xse=class{constructor(e,i){this._view=e,this._context=i,this.type=wa.Realistic,this._handles=new Ny,this._atmosphereCompositionParameters=new hTe,this._atmosphereConfiguration=new bF,this._passParameters=new qYe,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=Ai.radius,this._fadeHaze=0,this._updateRadius(Ai.radius);const r=this._context.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([ne(()=>this._view?.basemapTerrain?.rootTileElevationBounds,()=>this._view?.basemapTerrain?this._updateRootTileElevationBounds():null),ne(()=>this._view?.basemapTerrain?.visibleElevationBounds,()=>this._view?.basemapTerrain?this._updateVisibleElevationBounds():null),ne(()=>this._view?.environment.background,s=>{const o=s instanceof $_e?wP(s.color):Wu;ae(this._passParameters.backgroundColor,o[0]*o[3],o[1]*o[3],o[2]*o[3])},Ji)]);const n=new bF;n.haze=!1,this._atmosphereTechnique=this._context.techniqueRepository.acquire(Y3,n),n.haze=!0,this._atmosphereHazeTechnique=this._context.techniqueRepository.acquire(Y3,n),n.reduced=!0,n.haze=!1,this._atmosphereReducedTechnique=this._context.techniqueRepository.acquire(Y3,n),n.haze=!0,this._atmosphereHazeReducedTechnique=this._context.techniqueRepository.acquire(Y3,n),this._vao=qm(r,NM)}destroy(){this._handles.destroy(),this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._atmosphereReducedTechnique.release(),this._atmosphereHazeReducedTechnique.release(),this._vao.dispose()}render(e,i){this._render(e,i?this._atmosphereTechnique:this._atmosphereReducedTechnique,e.offscreenRenderingHelper.depthTexture,i,!1)}renderHaze(e,i,r){this._fadeHaze=i,this._render(e,r?this._atmosphereHazeTechnique:this._atmosphereHazeReducedTechnique,e.bindParameters.linearDepth?.colorTexture,r,!0)}_render(e,i,r,n,s){if(r==null)return;const o=e.offscreenRenderingHelper;this._update(e.bindParameters.camera),this._passParameters.depthTexture=r;const a=e.rctx.bindTechnique(i,this._passParameters,e.bindParameters);if(n)o.renderDepthDetached(()=>this._renderCommon(a,e));else{const l=e.rctx.getViewport(),c=xe(e.bindParameters.camera.eye)-Ai.radius;let h;if(c<M_){const _=Math.min(1,Math.max(0,c/M_));h=s?xt(.4,.5,_):xt(.2,.3,_)}else{const _=Math.min(1,Math.max(0,(c-M_)/(15*M_)));h=s?xt(.5,1,_):xt(.3,.6,_)}const d=Ww(Math.round(h*e.bindParameters.camera.fullViewport[2])),f=Ww(Math.round(h*e.bindParameters.camera.fullViewport[3]));e.rctx.setViewport(0,0,d,f);const m=o.renderToCachedFBO(null,()=>this._renderCommon(a,e),[0,0,0,1],xi.RGBA,null,d,f);e.rctx.setViewport(l.x,l.y,l.width,l.height),this._atmosphereCompositionParameters.color=m.colorTexture,this._atmosphereCompositionParameters.depth=r,this._atmosphereConfiguration.haze=s;const y=this._context.techniqueRepository.acquire(dTe,this._atmosphereConfiguration);e.rctx.bindTechnique(y,this._atmosphereCompositionParameters,e.bindParameters),o.renderDepthDetached(()=>e.rctx.screen.draw()),y.release(),m.release()}}_renderCommon(e,i){this._vao!=null&&(i.rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.rctx.drawArrays(ci.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(e){return e*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const e=this._view.basemapTerrain.rootTileElevationBounds.min;e!==this._rootTileElevationMin&&(this._rootTileElevationMin=e,this._lowerBoundEarthRadius=Ai.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=this._adjustRadiusForTesselation(Ai.radius+this._view.basemapTerrain.visibleElevationBounds.min);e<this._lowerBoundEarthRadius&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e,mi(this._passParameters.radii,e,e+M_),this._passParameters.innerFadeDistance=2*Math.sqrt((2*e-SH)*SH)}_update(e){if(!e)return;const i=na(e.eye),r=Math.sqrt(i),n=i-this._passParameters.radii[1]*this._passParameters.radii[1],s=_e((r-this._passParameters.radii[0])/M_,0,1);Gr(this._passParameters.heightParameters,r,i,n,s),this._passParameters.altitudeFade=fK(r-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=xt(xt(.6,1,tP(9500,10500,r-Ai.radius)),1,this._fadeHaze)}static isSupported(e){return e.renderContext.rctx.capabilities.depthTexture}};function fTe(t){t.fragment.code.add(b`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function wK(t,e){switch(t.include(mm,e),e.textureCoordinateType){case Zn.Default:case Zn.Compressed:return void t.fragment.code.add(b`vec4 textureLookup(sampler2D tex, vec2 uv) {
return texture(tex, uv);
}`);case Zn.Atlas:return t.include(fTe),void t.fragment.code.add(b`vec4 textureLookup(sampler2D tex, vec2 uv) {
return textureAtlasLookup(tex, uv, vuvRegion);
}`);default:e.textureCoordinateType;case Zn.None:case Zn.COUNT:return}}let Yu=class extends dn{constructor(e,i){super(e,"vec3",Oi.Draw,(r,n,s,o)=>r.setUniform3fv(e,i(n,s,o)))}},Yh=class extends dn{constructor(e,i){super(e,"sampler2D",Oi.Draw,(r,n,s)=>r.bindTexture(e,i(n,s)))}},i1=class{constructor(e){this._material=e.material,this._techniqueRepository=e.techniqueRep,this._output=e.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}get _markerTextureRepository(){return this._techniqueRepository.constructionContext.markerTextureRepository}ensureTechnique(e,i){return this._technique=this._techniqueRepository.releaseAndAcquire(e,this._material.getConfiguration(this._output,i),this._technique),this._technique}ensureResources(e){return Lv.LOADED}},xK=class extends i1{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textureRepository=e.textureRepository,this._textureId=e.textureId,this._acquire(e.textureId,i=>this._texture=i),this._acquire(e.normalTextureId,i=>this._textureNormal=i),this._acquire(e.emissiveTextureId,i=>this._textureEmissive=i),this._acquire(e.occlusionTextureId,i=>this._textureOcclusion=i),this._acquire(e.metallicRoughnessTextureId,i=>this._textureMetallicRoughness=i)}dispose(){this._texture=li(this._texture),this._textureNormal=li(this._textureNormal),this._textureEmissive=li(this._textureEmissive),this._textureOcclusion=li(this._textureOcclusion),this._textureMetallicRoughness=li(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?Lv.LOADED:Lv.LOADING}get textureBindParameters(){return new mTe(this._texture!=null?this._texture.glTexture:null,this._textureNormal!=null?this._textureNormal.glTexture:null,this._textureEmissive!=null?this._textureEmissive.glTexture:null,this._textureOcclusion!=null?this._textureOcclusion.glTexture:null,this._textureMetallicRoughness!=null?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){this._texture!=null&&e===this._texture.id||(this._texture=li(this._texture),this._textureId=e,this._acquire(this._textureId,i=>this._texture=i))}_acquire(e,i){if(e==null)return void i(null);const r=this._textureRepository.acquire(e);if(Zc(r))return++this._numLoading,void r.then(n=>{if(this._disposed)return li(n),void i(null);i(n)}).finally(()=>--this._numLoading);i(r)}},mTe=class extends or{constructor(e=null,i=null,r=null,n=null,s=null){super(),this.texture=e,this.textureNormal=i,this.textureEmissive=r,this.textureOcclusion=n,this.textureMetallicRoughness=s}};var ot;(function(t){t[t.Disabled=0]="Disabled",t[t.Normal=1]="Normal",t[t.Schematic=2]="Schematic",t[t.Water=3]="Water",t[t.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",t[t.Terrain=5]="Terrain",t[t.TerrainWithWater=6]="TerrainWithWater",t[t.COUNT=7]="COUNT"})(ot||(ot={}));function TK(t,e){const i=t.fragment,r=e.hasMetallicRoughnessTexture||e.hasEmissionTexture||e.hasOcclusionTexture;if(e.pbrMode===ot.Normal&&r&&t.include(wK,e),e.pbrMode!==ot.Schematic)if(e.pbrMode!==ot.Disabled){if(e.pbrMode===ot.Normal){i.code.add(b`vec3 mrr;
vec3 emission;
float occlusion;`);const n=e.pbrTextureBindType;e.hasMetallicRoughnessTexture&&(i.uniforms.add(n===Oi.Pass?new et("texMetallicRoughness",s=>s.textureMetallicRoughness):new Yh("texMetallicRoughness",s=>s.textureMetallicRoughness)),i.code.add(b`void applyMetallnessAndRoughness(vec2 uv) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),e.hasEmissionTexture&&(i.uniforms.add(n===Oi.Pass?new et("texEmission",s=>s.textureEmissive):new Yh("texEmission",s=>s.textureEmissive)),i.code.add(b`void applyEmission(vec2 uv) {
emission *= textureLookup(texEmission, uv).rgb;
}`)),e.hasOcclusionTexture?(i.uniforms.add(n===Oi.Pass?new et("texOcclusion",s=>s.textureOcclusion):new Yh("texOcclusion",s=>s.textureOcclusion)),i.code.add(b`void applyOcclusion(vec2 uv) {
occlusion *= textureLookup(texOcclusion, uv).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):i.code.add(b`float getBakedOcclusion() { return 1.0; }`),n===Oi.Pass?i.uniforms.add(new kt("emissionFactor",s=>s.emissiveFactor),new kt("mrrFactors",s=>s.mrrFactors)):i.uniforms.add(new Yu("emissionFactor",s=>s.emissiveFactor),new Yu("mrrFactors",s=>s.mrrFactors)),i.code.add(b`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;

      ${e.hasMetallicRoughnessTexture?b`applyMetallnessAndRoughness(${e.hasMetallicRoughnessTextureTransform?b`metallicRoughnessUV`:"vuv0"});`:""}

      ${e.hasEmissionTexture?b`applyEmission(${e.hasEmissiveTextureTransform?b`emissiveUV`:"vuv0"});`:""}

      ${e.hasOcclusionTexture?b`applyOcclusion(${e.hasOcclusionTextureTransform?b`occlusionUV`:"vuv0"});`:""}
    }
  `)}}else i.code.add(b`float getBakedOcclusion() { return 1.0; }`);else i.code.add(b`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function SK(t,e){const i=t.fragment,r=e.lightingSphericalHarmonicsOrder!==void 0?e.lightingSphericalHarmonicsOrder:2;r===0?(i.uniforms.add(new kt("lightingAmbientSH0",(n,s)=>ae(Zse,s.lighting.sh.r[0],s.lighting.sh.g[0],s.lighting.sh.b[0]))),i.code.add(b`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===1?(i.uniforms.add(new yi("lightingAmbientSH_R",(n,s)=>Gr(ig,s.lighting.sh.r[0],s.lighting.sh.r[1],s.lighting.sh.r[2],s.lighting.sh.r[3])),new yi("lightingAmbientSH_G",(n,s)=>Gr(ig,s.lighting.sh.g[0],s.lighting.sh.g[1],s.lighting.sh.g[2],s.lighting.sh.g[3])),new yi("lightingAmbientSH_B",(n,s)=>Gr(ig,s.lighting.sh.b[0],s.lighting.sh.b[1],s.lighting.sh.b[2],s.lighting.sh.b[3]))),i.code.add(b`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===2&&(i.uniforms.add(new kt("lightingAmbientSH0",(n,s)=>ae(Zse,s.lighting.sh.r[0],s.lighting.sh.g[0],s.lighting.sh.b[0])),new yi("lightingAmbientSH_R1",(n,s)=>Gr(ig,s.lighting.sh.r[1],s.lighting.sh.r[2],s.lighting.sh.r[3],s.lighting.sh.r[4])),new yi("lightingAmbientSH_G1",(n,s)=>Gr(ig,s.lighting.sh.g[1],s.lighting.sh.g[2],s.lighting.sh.g[3],s.lighting.sh.g[4])),new yi("lightingAmbientSH_B1",(n,s)=>Gr(ig,s.lighting.sh.b[1],s.lighting.sh.b[2],s.lighting.sh.b[3],s.lighting.sh.b[4])),new yi("lightingAmbientSH_R2",(n,s)=>Gr(ig,s.lighting.sh.r[5],s.lighting.sh.r[6],s.lighting.sh.r[7],s.lighting.sh.r[8])),new yi("lightingAmbientSH_G2",(n,s)=>Gr(ig,s.lighting.sh.g[5],s.lighting.sh.g[6],s.lighting.sh.g[7],s.lighting.sh.g[8])),new yi("lightingAmbientSH_B2",(n,s)=>Gr(ig,s.lighting.sh.b[5],s.lighting.sh.b[6],s.lighting.sh.b[7],s.lighting.sh.b[8]))),i.code.add(b`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),e.pbrMode!==ot.Normal&&e.pbrMode!==ot.Schematic||i.code.add(b`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const Zse=E(),ig=oi();function FM(t){t.vertex.code.add(b`const float PI = 3.141592653589793;`),t.fragment.code.add(b`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}var am,Tx;function bXe(t){return t?.cubeMap!=null}function wXe(t){return t!=null&&!t.running}(function(t){t[t.RENDERING=0]="RENDERING",t[t.FADING=1]="FADING",t[t.FINISHED=2]="FINISHED"})(am||(am={})),function(t){t[t.RG=0]="RG",t[t.BA=1]="BA"}(Tx||(Tx={}));function Hy(t=gTe){return[t[0],t[1],t[2],t[3]]}function KN(t,e,i=Hy()){return oe(i,t),i[3]=e,i}function Jse(t,e,i=Hy()){return lt(i,t,e),ye(i,i),i[3]=-Dye(t,e),i}function Kse(t,e,i=Hy()){return _P(EI,t,IH(t)),_P(Qse,e,IH(e)),KJ(EI,Qse,EI),TXe(i,ml(JJ(i,EI)))}function zDt(t,e,i,r=Hy()){return KN(Mye,t,CI),KN($ye,e,eoe),KN(gZ,i,toe),Kse(CI,eoe,CI),Kse(CI,toe,r),r}function BDt(t){return t}function xXe(t){return t[3]}function IH(t){return Dt(t[3])}function TXe(t,e){return t[3]=e,t}const gTe=[0,0,1,0],EI=hd(),Qse=hd();Hy();const CI=Hy(),eoe=Hy(),toe=Hy();let SXe=class{constructor(){this.readChannels=Tx.RG,this.renderingStage=am.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=E(),this.parallax=new ioe,this.parallaxNew=new ioe,this.pointOnGround=E(),this.fadeMode=Rr.HIDE,this.fadeFactor=0,this.opacity=0}updateParallax(e){const i=this.parallax,r=xe(e.eye);if(i.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(r*r-Ai.radius*Ai.radius,0))/r,Jse(roe,i.anchorPointClouds,ET),Fc(i.transform,Kr,ET[3],ET),this.fadeMode===Rr.CROSS_FADE){const n=this.parallaxNew;Jse(roe,n.anchorPointClouds,ET),Fc(n.transform,Kr,ET[3],ET)}}updateFading(e,i,r,n){this.isFading&&this._advanceFading(r,n),this._evaluateFading(e,i,r)}_evaluateFading(e,i,r){const n=e.relativeElevation,s=this._calculateDistanceToAnchorPoint(e);if((n>1.7*qg||n<-qg||s>RXe)&&this.opacity>0)this._setFade(Rr.HIDE,r);else if(!this.isFading){if((n>qg||n<-.35*qg||s>OXe)&&this.opacity>0)this._setFade(Rr.FADE_OUT,r);else if(n<=qg&&n>=-.35*qg&&i===Li.IDLE&&wXe(this.data)){if(this.opacity===0)return void this._setFade(Rr.FADE_IN,r);(s>AXe||this.renderingStage===am.FADING)&&this._setFade(Rr.CROSS_FADE,r)}}}_advanceFading(e,i){this._switchReadChannels(),this._updateAnchorPoint(),this._advanceFadingFactorAndOpacity(e,i)}_advanceFadingFactorAndOpacity(e,i){if(this.fadeFactor<1)return this.fadeFactor=i?_e((e-this.startTime)/(CXe*i),0,1):1,this.fadeMode===Rr.FADE_OUT&&(this.opacity=1-this.fadeFactor),this.fadeMode===Rr.FADE_IN&&(this.opacity=this.fadeFactor),void(this.fadeMode===Rr.CROSS_FADE&&(this.opacity=1));this.fadeFactor=0,this.fadeMode===Rr.FADE_OUT&&(this.opacity=0),this.fadeMode===Rr.FADE_IN&&(this.opacity=1),this.fadeMode===Rr.CROSS_FADE&&(this.opacity=1),this.fadeMode=Rr.NONE}_switchReadChannels(){const e=this.fadeMode===Rr.CROSS_FADE&&this.fadeFactor===1,i=this.fadeMode===Rr.FADE_IN&&this.fadeFactor===0;this.renderingStage===am.FADING&&(e||i)&&(this.readChannels=1-this.readChannels,this.renderingStage=am.FINISHED)}_calculateDistanceToAnchorPoint(e){return ye(this.pointOnGround,e.eye),re(this.pointOnGround,this.pointOnGround,Ai.radius),xe(de(EXe,this.parallax.anchorPointClouds,this.pointOnGround))}_updateAnchorPoint(){this.fadeMode===Rr.CROSS_FADE&&(this.fadeFactor===0&&oe(this.parallaxNew.anchorPointClouds,this.pointOnGround),this.fadeFactor===1&&oe(this.parallax.anchorPointClouds,this.parallaxNew.anchorPointClouds)),this.fadeMode===Rr.FADE_IN&&this.fadeFactor===0&&oe(this.parallax.anchorPointClouds,this.pointOnGround)}_setFade(e,i){switch(e){case Rr.HIDE:this.opacity=0;break;case Rr.FADE_OUT:this.opacity=1;break;case Rr.FADE_IN:this.opacity=0;break;case Rr.CROSS_FADE:this.opacity=1}this.fadeMode=e,this.fadeFactor=0,this.startTime=i}get isFading(){return this.fadeMode===Rr.FADE_OUT||this.fadeMode===Rr.FADE_IN||this.fadeMode===Rr.CROSS_FADE}};var Rr;(function(t){t[t.NONE=0]="NONE",t[t.HIDE=1]="HIDE",t[t.FADE_OUT=2]="FADE_OUT",t[t.FADE_IN=3]="FADE_IN",t[t.CROSS_FADE=4]="CROSS_FADE"})(Rr||(Rr={}));let ioe=class{constructor(){this.anchorPointClouds=E(),this.radiusCurvatureCorrectionFactor=0,this.transform=be()}};const roe=Oe(0,0,1),ET=Hy(),EXe=E(),CXe=1.25,AXe=34e3,OXe=64e3,RXe=2e5;let gm=class extends dn{constructor(e,i){super(e,"bool",Oi.Pass,(r,n,s)=>r.setUniform1b(e,i(n,s)))}},PXe=class extends dn{constructor(e,i){super(e,"samplerCube",Oi.Pass,(r,n,s)=>r.bindTexture(e,i(n,s)))}};function yTe(t){const e=t.fragment;e.uniforms.add(new en("rotationMatrixClouds",(i,r)=>r.cloudsFade.parallax.transform),new en("rotationMatrixCloudsCrossFade",(i,r)=>r.cloudsFade.parallaxNew.transform),new kt("anchorPosition",(i,r)=>r.cloudsFade.parallax.anchorPointClouds),new kt("anchorPositionCrossFade",(i,r)=>r.cloudsFade.parallaxNew.anchorPointClouds),new Re("cloudsHeight",()=>MUe),new Re("radiusCurvatureCorrectionFactor",(i,r)=>r.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new Re("totalFadeInOut",(i,r)=>1-r.cloudsFade.opacity),new Re("crossFadeAnchorFactor",(i,r)=>_e(r.cloudsFade.fadeFactor,0,1)),new PXe("cubeMap",(i,r)=>r.cloudsFade.data?.cubeMap?.colorTexture??null),new gm("crossFade",(i,r)=>r.cloudsFade.fadeMode===Rr.CROSS_FADE),new gm("readChannelsRG",(i,r)=>r.cloudsFade.readChannels===Tx.RG),new gm("fadeTextureChannels",(i,r)=>r.cloudsFade.renderingStage===am.FADING)),e.constants.add("planetRadius","float",Ai.radius),e.code.add(b`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),e.code.add(b`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),e.code.add(b`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),jy(e),Gm(e),e.code.add(b`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),e.code.add(b`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = texture(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),e.code.add(b`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),e.code.add(b`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),e.code.add(b`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function Wm(t){t.code.add(b`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function MXe(){const t=new Ei,{attributes:e,varyings:i,vertex:r,fragment:n}=t;return e.add(O.POSITION,"vec2"),i.add("worldRay","vec3"),r.uniforms.add(new en("inverseProjectionMatrix",(s,o)=>o.camera.inverseProjectionMatrix),new en("inverseViewMatrix",(s,o)=>xC($Xe,o.camera.viewMatrix))),r.code.add(b`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),n.include(Wm),n.include(dd),t.include(SK,{pbrMode:ot.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(FM),t.include(yU),t.include(_F),t.include(yTe),n.uniforms.add(new kt("cameraPosition",(s,o)=>o.camera.eye)),n.code.add(b`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),t}const $Xe=be(),IXe=Object.freeze(Object.defineProperty({__proto__:null,build:MXe},Symbol.toStringTag,{value:"Module"}));let _Te=class vTe extends Fi{constructor(e){super(e,new tc,()=>this.destroy())}initializeProgram(e){return new Mi(e.rctx,vTe.shader.get().build(),Si)}initializePipeline(){return Lt({blending:Go(Te.ONE,Te.ZERO,Te.SRC_ALPHA,Te.ONE),depthTest:{func:Bi.LEQUAL},colorWrite:Gt})}};_Te.shader=new Pi(IXe,()=>ce(()=>import("./CloudsComposition.glsl-b72f3fbb.js"),[],import.meta.url));let $b=class extends we{constructor(e){super(e),this._technique=new _Te(e),this._vao=qm(e.rctx)}destroy(){this._technique=li(this._technique),this._vao=rt(this._vao)}render(e){if(!this._technique.compiled)return void this.requestRender();const i=e.bindParameters.cloudsFade;if(this._vao==null||i.data==null)return;const r=e.rctx.bindTechnique(this._technique,LXe,e.bindParameters);e.rctx.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(ci.TRIANGLE_STRIP,0,4)}};u([p({constructOnly:!0})],$b.prototype,"rctx",void 0),u([p({constructOnly:!0})],$b.prototype,"viewingMode",void 0),u([p({constructOnly:!0})],$b.prototype,"planetRadius",void 0),u([p({constructOnly:!0})],$b.prototype,"requestRender",void 0),$b=u([M("esri.views.3d.environment.CloudsComposition")],$b);const LXe=new or;function Mn(){return new Float32Array(3)}function LH(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function rr(t,e,i){const r=new Float32Array(3);return r[0]=t,r[1]=e,r[2]=i,r}function DXe(t,e){return new Float32Array(t,e,3)}function EK(){return Mn()}function bTe(){return rr(1,1,1)}function wTe(){return rr(1,0,0)}function xTe(){return rr(0,1,0)}function TTe(){return rr(0,0,1)}const NXe=EK(),FXe=bTe(),kXe=wTe(),UXe=xTe(),zXe=TTe();Object.freeze(Object.defineProperty({__proto__:null,ONES:FXe,UNIT_X:kXe,UNIT_Y:UXe,UNIT_Z:zXe,ZEROS:NXe,clone:LH,create:Mn,createView:DXe,fromValues:rr,ones:bTe,unitX:wTe,unitY:xTe,unitZ:TTe,zeros:EK},Symbol.toStringTag,{value:"Module"}));var Yl;(function(t){t[t.SIXTEEN=0]="SIXTEEN",t[t.HUNDRED=1]="HUNDRED",t[t.TWOHUNDRED=2]="TWOHUNDRED",t[t.COUNT=3]="COUNT"})(Yl||(Yl={}));let QN=class extends tc{constructor(){super(...arguments),this.steps=Yl.SIXTEEN,this.writeTextureChannels=Tx.RG}};u([U({count:Yl.COUNT})],QN.prototype,"steps",void 0),u([U({constValue:ie("esri-mobile")?1024:2048})],QN.prototype,"cubeMapSize",void 0),u([U()],QN.prototype,"writeTextureChannels",void 0);let K3=class{constructor(e,i,r,n,s,o,a,l,c=.5){this.coverage=e,this.density=i,this.absorption=r,this.cloudSize=n,this.detailSize=s,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}};const noe=new K3([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],Yl.SIXTEEN),va={sunny:noe,cloudy:new K3([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],Yl.TWOHUNDRED,.6),rainy:new K3([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],Yl.TWOHUNDRED,.4),snowy:new K3([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],Yl.HUNDRED,.65),foggy:new K3([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],Yl.SIXTEEN),default:noe},Lh=ie("esri-mobile")?64:128,BXe=Lh/128,tp=Math.ceil(Math.sqrt(Lh)),uv=(Lh+2)*tp,VXe=1e5,Nz=128,GXe=uv/1560;let TP=class extends dn{constructor(e,i){super(e,"mat3",Oi.Draw,(r,n,s)=>r.setUniformMatrix3fv(e,i(n,s)))}},STe=class extends or{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=va.default.raymarchingSteps,this.weatherTile=Ge()}},ETe=class extends or{constructor(){super(...arguments),this.viewMatrix=nn()}};function jXe(t){const e=new Ei;e.include(Na,!1);const i=e.fragment;return i.uniforms.add(new Re("cloudRadius",r=>r.cloudRadius),new Re("power",r=>xt(35,120,r.absorption)),new Re("sigmaE",r=>1+r.absorption),new Re("density",r=>xt(0,.3,r.density)),new Re("cloudSize",r=>xt(0,.02,Math.max(.01,1-r.cloudSize))),new Re("detailSize",r=>xt(0,.2,Math.max(.01,1-r.detailSize))),new Re("smoothness",r=>xt(0,.5,1-r.smoothness)),new Re("cloudHeight",r=>xt(0,1500,r.cloudHeight)),new Re("coverage",r=>r.coverage),new TP("view",r=>r.viewMatrix),new et("cloudShapeTexture",r=>r.noiseTexture!=null?r.noiseTexture.textureAtlas:null),new Ki("cloudVariables",r=>mi(HXe,r.coverage,r.absorption))),i.constants.add("halfCubeMapSize","float",.5*t.cubeMapSize),i.code.add(b`
    const int STEPS = ${t.steps===Yl.SIXTEEN?b`16`:t.steps===Yl.HUNDRED?b`100`:b`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),i.code.add(b`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${b.float(uv)};
      const float dataWidth = ${b.float(uv)};
      const float tileRows = ${b.float(tp)};
      const vec3 atlasDimensions = vec3(${b.float(Lh)}, ${b.float(Lh)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${b.float(BXe)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${b.float(GXe)} * p) / ${b.float(uv)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `),i.code.add(b`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),i.code.add(b`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),i.code.add(`
    float multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      float luminance = 0.0;

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),i.code.add(b`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),i.code.add(b`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),i.code.add(b`void main() {
if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),e}const HXe=Ge(),qXe=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:ETe,CloudsPassParameters:STe,build:jXe},Symbol.toStringTag,{value:"Module"}));let CTe=class ATe extends Fi{constructor(e,i){super(e,i,()=>this.destroy())}initializeProgram(e){return new Mi(e.rctx,ATe.shader.get().build(this.configuration),Si)}initializePipeline(){return Lt({blending:Yc(Te.CONSTANT_COLOR,Te.ONE_MINUS_CONSTANT_COLOR,Pm.ADD,this.configuration.writeTextureChannels===Tx.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:Bi.LEQUAL},colorWrite:Gt})}};CTe.shader=new Pi(qXe,()=>ce(()=>import("./Clouds.glsl-292b179f.js"),[],import.meta.url));var Iu;(function(t){t[t.Full=0]="Full",t[t.WeatherMap=1]="WeatherMap",t[t.COUNT=2]="COUNT"})(Iu||(Iu={}));let DH=class extends tc{constructor(){super(...arguments),this.mode=Iu.Full}};u([U({count:Iu.COUNT})],DH.prototype,"mode",void 0);let OTe=class extends or{constructor(){super(...arguments),this.weatherTile=pi(0,0)}};function WXe(t){const e=new Ei;return e.include(Na,!1),e.fragment.code.add(b`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.mode===Iu.Full&&e.fragment.code.add(b`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${b.float(tp)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${b.float(8)});

      float worley0 = worley(p, ${b.float(2)} * 2.0);
      float worley1 = worley(p, ${b.float(2)} * 8.0);
      float worley2 = worley(p, ${b.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${b.float(2)});
      float worley1 = worley(p, ${b.float(2)} * 2.0);
      float worley2 = worley(p, ${b.float(2)} * 4.0);
      float worley3 = worley(p, ${b.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),e.fragment.uniforms.add(new Ki("weatherTile",i=>i.weatherTile)),e.fragment.code.add(b`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${b.float(Nz)});

      // Get global coordinates of p
      p += weatherTile * ${b.float(Nz)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${b.float(VXe)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),e.fragment.code.add(b`void main() {`),t.mode===Iu.Full&&e.fragment.code.add(b`
        float padWidth = 1.0;
        float paddedSize = ${b.float(Lh)} + 2.0 * padWidth;
        float tileCount = ${b.float(tp)} * ${b.float(tp)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${b.float(Lh)};
          }

          if (startPadY) {
            pixel.y += ${b.float(Lh)};
          }

          if (endPadX) {
            pixel.x -= ${b.float(Lh)};
          }

          if (endPadY) {
            pixel.y -= ${b.float(Lh)};
          }

          uv = vec2(pixel.xy / ${b.float(Lh)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${b.float(Lh)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${b.float(tp)} * ${b.float(tp)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${b.float(tp)} * ${b.float(tp)});
        p = p_;
        p.z /= (${b.float(tp)} * ${b.float(tp)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),e.fragment.code.add(b`
      vec2 mapUV = ${b.float(Nz)} * (gl_FragCoord.xy / ${b.float(uv)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${t.mode===Iu.Full?b`fragColor.ba = vec2(0.0, map);`:b`fragColor = vec4(map);`};
    }
  `),e}const YXe=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:OTe,build:WXe},Symbol.toStringTag,{value:"Module"}));let NH=class RTe extends Fi{initializeProgram(e){return new Mi(e.rctx,RTe.shader.get().build(this.configuration),Si)}initializePipeline(){return Lt({blending:this.configuration.mode===Iu.Full?Yc(Te.ONE,Te.ZERO):Go(Te.ZERO,Te.ONE,Te.ONE,Te.ZERO),depthTest:{func:Bi.ALWAYS},colorWrite:Gt})}};NH.shader=new Pi(YXe,()=>ce(()=>import("./NoiseTextureAtlas.glsl-ace6f740.js"),[],import.meta.url));let Q3=class extends we{constructor(e){super(e),this._needsRender=!0,this._passParameters=new OTe,this._frameBuffer=new jp(e.context.renderContext.rctx,new Hi(uv)),this._vao=qm(e.context.renderContext.rctx)}get _techniqueRepository(){return this.context.techniqueRepository}get textureAtlas(){return this._texture!=null?this._weatherMapTechnique!=null&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(Iu.WeatherMap)):this._fullTechnique!=null&&this._fullTechnique.compiled&&(this._texture=this._render(Iu.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||(gs(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=li(this._fullTechniqueCached),this._weatherMapTechniqueCached=li(this._weatherMapTechniqueCached),this._frameBuffer=rt(this._frameBuffer),this._vao=rt(this._vao)}get _fullTechnique(){if(this._fullTechniqueCached==null){const e=new DH;e.mode=Iu.Full,this._fullTechniqueCached=this._techniqueRepository.acquire(NH,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(this._weatherMapTechniqueCached==null){const e=new DH;e.mode=Iu.WeatherMap,this._weatherMapTechniqueCached=this._techniqueRepository.acquire(NH,e)}return this._weatherMapTechniqueCached}_render(e){if(this._vao==null||this._frameBuffer==null)return null;const i=e===Iu.Full?this._fullTechnique:this._weatherMapTechnique,r=this.context.renderContext.rctx,n=r.getViewport();r.setViewport(0,0,uv,uv),r.bindFramebuffer(this._frameBuffer);const s=r.bindTechnique(i,this._passParameters,null);return r.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.setViewport(n.x,n.y,n.width,n.height),this._needsRender=!1,this._frameBuffer.colorTexture}};u([p({constructOnly:!0})],Q3.prototype,"context",void 0),u([p({readOnly:!0})],Q3.prototype,"_techniqueRepository",null),Q3=u([M("esri.views.3d.environment.NoiseTextureAtlas")],Q3);var Sc;(function(t){t[t.Occluded=0]="Occluded",t[t.NotOccluded=1]="NotOccluded",t[t.Both=2]="Both",t[t.COUNT=3]="COUNT"})(Sc||(Sc={}));function PTe(t){t.include(od),t.uniforms.add(new et("geometryDepthTexture",(e,i)=>i.multipassGeometry.linearDepth?.colorTexture),new Ki("nearFar",(e,i)=>i.camera.nearFar)),t.code.add(b`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}let XXe=class{};function Xc(t,e){if(!e.multipassEnabled)return;t.fragment.include(od),t.fragment.uniforms.add(new et("terrainDepthTexture",(r,n)=>n.multipassTerrain.linearDepth?.colorTexture)),t.fragment.uniforms.add(new Ki("nearFar",(r,n)=>n.camera.nearFar));const i=e.occlusionPass;t.fragment.code.add(b`
   ${i?"bool":"void"} terrainDepthTest(float fragmentDepth) {
      vec4 data = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0);
      float linearDepth = linearDepthFromRGBA(data, nearFar);
      ${i?b`return fragmentDepth < linearDepth && data != vec4(0.0, 0.0, 0.0, 1.0);`:b`
          if(fragmentDepth ${e.cullAboveGround?">":"<="} linearDepth){
            discard;
          }`}
    }`)}let ZXe=class{constructor(){this.cullAboveGround=!1}};function vU(t){return t?{ray:js(t.ray),c0:t.c0,c1:t.c1}:{ray:js(),c0:0,c1:Number.MAX_VALUE}}function JXe(t,e=vU()){return oF(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function KXe(t,e,i=vU()){const r=xe(t.vector);return xbe(t.origin,e,i.ray),i.c0=0,i.c1=r,i}function rNt(t,e){return MTe(t,t.c0,e)}function nNt(t,e){return MTe(t,t.c1,e)}function MTe(t,e,i){return ue(i,t.ray.origin,re(i,t.ray.direction,e))}new zy(()=>vU());function SP(t){return t?[Ii(t[0]),Ii(t[1]),Ii(t[2]),Ii(t[3]),Ii(t[4]),Ii(t[5])]:[Ii(),Ii(),Ii(),Ii(),Ii(),Ii()]}function $Te(){return[E(),E(),E(),E(),E(),E(),E(),E()]}function wF(t,e){for(let i=0;i<NC;i++)iU(t[i],e[i]);return t}function ITe(t,e,i,r=nZe){const n=qi(RJ.get(),e,t);fs(n,n);for(let s=0;s<iZe;++s){const o=Fu(OJ.get(),rZe[s],n);ae(r[s],o[0]/o[3],o[1]/o[3],o[2]/o[3])}LTe(i,r)}function LTe(t,e){Ca(e[Ze.FAR_BOTTOM_LEFT],e[Ze.NEAR_BOTTOM_LEFT],e[Ze.NEAR_TOP_LEFT],t[br.LEFT]),Ca(e[Ze.NEAR_BOTTOM_RIGHT],e[Ze.FAR_BOTTOM_RIGHT],e[Ze.FAR_TOP_RIGHT],t[br.RIGHT]),Ca(e[Ze.FAR_BOTTOM_LEFT],e[Ze.FAR_BOTTOM_RIGHT],e[Ze.NEAR_BOTTOM_RIGHT],t[br.BOTTOM]),Ca(e[Ze.NEAR_TOP_LEFT],e[Ze.NEAR_TOP_RIGHT],e[Ze.FAR_TOP_RIGHT],t[br.TOP]),Ca(e[Ze.NEAR_BOTTOM_LEFT],e[Ze.NEAR_BOTTOM_RIGHT],e[Ze.NEAR_TOP_RIGHT],t[br.NEAR]),Ca(e[Ze.FAR_BOTTOM_RIGHT],e[Ze.FAR_BOTTOM_LEFT],e[Ze.FAR_TOP_LEFT],t[br.FAR])}function Q_(t,e){for(let i=0;i<NC;i++){const r=t[i];if(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]>=e[3])return!1}return!0}function QXe(t,e){return NTe(t,JXe(e,FTe.get()))}function sNt(t,e){for(let i=0;i<NC;i++){const r=t[i];if(!M7e(r,e))return!1}return!0}function eZe(t,e,i){return NTe(t,KXe(e,i,FTe.get()))}function DTe(t,e){for(let i=0;i<NC;i++)if(hr(t[i],e)>0)return!1;return!0}function NTe(t,e){for(let i=0;i<NC;i++)if(!P7e(t[i],e))return!1;return!0}var br,Ze;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.TOP=3]="TOP",t[t.NEAR=4]="NEAR",t[t.FAR=5]="FAR"})(br||(br={})),function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",t[t.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(Ze||(Ze={}));const tZe={bottom:[Ze.FAR_BOTTOM_RIGHT,Ze.NEAR_BOTTOM_RIGHT,Ze.NEAR_BOTTOM_LEFT,Ze.FAR_BOTTOM_LEFT],near:[Ze.NEAR_BOTTOM_LEFT,Ze.NEAR_BOTTOM_RIGHT,Ze.NEAR_TOP_RIGHT,Ze.NEAR_TOP_LEFT],far:[Ze.FAR_BOTTOM_RIGHT,Ze.FAR_BOTTOM_LEFT,Ze.FAR_TOP_LEFT,Ze.FAR_TOP_RIGHT],right:[Ze.NEAR_BOTTOM_RIGHT,Ze.FAR_BOTTOM_RIGHT,Ze.FAR_TOP_RIGHT,Ze.NEAR_TOP_RIGHT],left:[Ze.FAR_BOTTOM_LEFT,Ze.NEAR_BOTTOM_LEFT,Ze.NEAR_TOP_LEFT,Ze.FAR_TOP_LEFT],top:[Ze.FAR_TOP_LEFT,Ze.NEAR_TOP_LEFT,Ze.NEAR_TOP_RIGHT,Ze.FAR_TOP_RIGHT]},NC=6,iZe=8,rZe=[Ft(-1,-1,-1,1),Ft(1,-1,-1,1),Ft(1,1,-1,1),Ft(-1,1,-1,1),Ft(-1,-1,1,1),Ft(1,-1,1,1),Ft(1,1,1,1),Ft(-1,1,1,1)],FTe=new zy(vU),nZe=$Te();function sZe(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/e)}function oZe(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/i)}function aZe(t,e,i){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}function lZe(t,e,i){return 2*Math.atan(i*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}var FH;let ft=FH=class extends we{constructor(t={}){super(t),this._center=E(),this._up=E(),this._viewUp=E(),this._viewForward=E(),this._viewRight=E(),this._ray=js(),this._viewport=Ft(0,0,1,1),this._padding=Ft(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=pi(1,1e3),this._viewDirty=!0,this._viewMatrix=be(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=be(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=be(),this._frustumDirty=!0,this._frustum=SP(),this._fullViewport=oi(),this._pixelRatio=1,this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return de(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){Qn(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=dx(oi(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&px(t,e)?e:t}get screenPadding(){if(this.pixelRatio===1)return this._padding;const t=dx(oi(),this._padding,1/this.pixelRatio),e=this._get("screenPadding");return e&&px(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[ii.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[ii.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[ii.RIGHT]+this._padding[ii.LEFT]}set fullWidth(t){this.width=t-(this._padding[ii.RIGHT]+this._padding[ii.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[ii.TOP]+this._padding[ii.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[ii.TOP]+this._padding[ii.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[ii.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[ii.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){W2(this._padding,t)||(this._viewport[0]+=t[ii.LEFT]-this._padding[ii.LEFT],this._viewport[1]+=t[ii.BOTTOM]-this._padding[ii.BOTTOM],this._viewport[2]-=t[ii.RIGHT]+t[ii.LEFT]-(this._padding[ii.RIGHT]+this._padding[ii.LEFT]),this._viewport[3]-=t[ii.TOP]+t[ii.BOTTOM]-(this._padding[ii.TOP]+this._padding[ii.BOTTOM]),mp(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(qi(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){const t=this.width,e=this.height,i=this.near*Math.tan(this.fovY/2),r=i*this._aspect,n=r0e(be(),-r*(1+2*this._padding[ii.LEFT]/t),r*(1+2*this._padding[ii.RIGHT]/t),-i*(1+2*this._padding[ii.BOTTOM]/e),i*(1+2*this._padding[ii.TOP]/e),this.near,this.far),s=this._get("projectionMatrix");return s&&O6(s,n)?s:n}get inverseProjectionMatrix(){return fs(be(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||be()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return aZe(this._fov,this.width,this.height)}set fovX(t){this._fov=sZe(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return lZe(this._fov,this.width,this.height)}set fovY(t){this._fov=oZe(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Mr(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(fs(this._viewInverseTransposeMatrix,this.viewMatrix),Hc(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const e=2*t-1;return 2*this.near*this.far/(this.far+this.near-e*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}copyFrom(t){oe(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,mp(this._viewport,t.viewport),this.notifyChange("_viewport"),mp(this._padding,t.padding),this.notifyChange("_padding"),gs(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||(Qn(this._viewMatrix,t.viewMatrix),oe(this._viewRight,t.viewRight),oe(this._viewUp,t.viewUp),oe(this._viewForward,t.viewForward)),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(wF(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Qn(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),mp(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new FH().copyFrom(this)}equals(t){return oa(this.eye,t.eye)&&oa(this.center,t.center)&&oa(this.up,t.up)&&W2(this._viewport,t.viewport)&&W2(this._padding,t.padding)&&kxe(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){const e=Math.max(1,1/this.pixelRatio,1/t.pixelRatio);if(Math.abs(t.fov-this._fov)>=.001||F5(t.screenPadding,this.screenPadding)>=e||F5(this.screenViewport,t.screenViewport)>=e)return!1;go(da,t.eye,t.center),go(Fz,this.eye,this.center);const i=ge(da,Fz),r=z7(da),n=z7(Fz),s=5e-4;return i*i>=(1-1e-10)*r*n&&x6(t.eye,this.eye)<Math.max(r,n)*s*s}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(nR(this.viewForward,de(da,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=cn()){return t[0]=(this.padding[ii.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[ii.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,i=.5){return t[0]=this.padding[ii.LEFT]+this.width*e,t[1]=this.padding[ii.BOTTOM]+this.height*i,t[2]=.5,t}setGLViewport(t){const e=this.viewport,i=this.padding;t.setViewport(e[0]-i[3],e[1]-i[2],e[2]+i[1]+i[3],e[3]+i[0]+i[2])}applyProjection(t,e){t!==ti&&oe(ti,t),ti[3]=1,Fu(ti,ti,this.projectionMatrix);const i=Math.abs(ti[3]);re(ti,ti,1/i);const r=this.fullViewport;e[0]=xt(0,r[0]+r[2],.5+.5*ti[0]),e[1]=xt(0,r[1]+r[3],.5+.5*ti[1]),e[2]=.5*(ti[2]+1),e[3]=i}unapplyProjection(t,e){const i=this.fullViewport;ti[0]=(t[0]/(i[0]+i[2])*2-1)*t[3],ti[1]=(t[1]/(i[1]+i[3])*2-1)*t[3],ti[2]=(2*t[2]-1)*t[3],ti[3]=t[3],this.inverseProjectionMatrix!=null&&(Fu(ti,ti,this.inverseProjectionMatrix),e[0]=ti[0],e[1]=ti[1],e[2]=ti[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,kz),this.renderToScreen(kz,e),e}projectToRenderScreen(t,e){if(ti[0]=t[0],ti[1]=t[1],ti[2]=t[2],ti[3]=1,Fu(ti,ti,this.viewProjectionMatrix),ti[3]===0)return null;re(ti,ti,1/Math.abs(ti[3]));const i=this.fullViewport;return"x"in e?(e.x=xt(0,i[0]+i[2],.5+.5*ti[0]),e.y=xt(0,i[1]+i[3],.5+.5*ti[1])):(e[0]=xt(0,i[0]+i[2],.5+.5*ti[0]),e[1]=xt(0,i[1]+i[3],.5+.5*ti[1]),e.length>2&&(e[2]=.5*(ti[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,kz),e)}unprojectFromRenderScreen(t,e){if(qi(AI,this.projectionMatrix,this.viewMatrix),!fs(AI,AI))return null;const i=this.fullViewport;return ti[0]=2*(t[0]-i[0])/i[2]-1,ti[1]=2*(t[1]-i[1])/i[3]-1,ti[2]=2*t[2]-1,ti[3]=1,Fu(ti,ti,AI),ti[3]===0?null:(e[0]=ti[0]/ti[3],e[1]=ti[1]/ti[3],e[2]=ti[2]/ti[3],e)}constrainWindowSize(t,e,i,r){const n=t*this.pixelRatio,s=e*this.pixelRatio,o=Math.max(n-i/2,0),a=Math.max(this.fullHeight-s-r/2,0),l=-Math.min(n-i/2,0),c=-Math.min(this.fullHeight-s-r/2,0),h=i-l- -Math.min(this.fullWidth-n-i/2,0),d=r-c- -Math.min(s-r/2,0);return[Math.round(o),Math.round(a),Math.round(h),Math.round(d)]}computeUp(t){t===Le.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const i=t[0]*this.pixelRatio,r=this.fullHeight-t[1]*this.pixelRatio;return e[0]=i,e[1]=r,e}renderToScreen(t,e){const i=t[0]/this.pixelRatio,r=(this.fullHeight-t[1])/this.pixelRatio;e[0]=i,e[1]=r}_computeUpGlobal(){de(da,this.center,this.eye);const t=xe(this.center);t<1?(ae(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(ge(da,this.center))>.9999*xe(da)*t||(lt(this._up,da,this.center),lt(this._up,this._up,da),ye(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){Fy(da,this.eye,this.center),Math.abs(da[2])<=.9999&&(re(da,da,da[2]),ae(this._up,-da[0],-da[1],1-da[2]),ye(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,i=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?oa(t,e)||(oe(e,t),this._markViewDirty(),i.length&&this.notifyChange(i)):K.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(ITe(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(A6(this._viewMatrix,this.eye,this.center,this.up),ae(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),ae(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),ae(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};u([p()],ft.prototype,"_center",void 0),u([p()],ft.prototype,"_up",void 0),u([p()],ft.prototype,"_viewport",void 0),u([p()],ft.prototype,"_padding",void 0),u([p()],ft.prototype,"_fov",void 0),u([p()],ft.prototype,"_nearFar",void 0),u([p()],ft.prototype,"_pixelRatio",void 0),u([p()],ft.prototype,"pixelRatio",null),u([p()],ft.prototype,"eye",null),u([p()],ft.prototype,"center",null),u([p()],ft.prototype,"up",null),u([p({readOnly:!0})],ft.prototype,"nearFar",null),u([p()],ft.prototype,"near",null),u([p()],ft.prototype,"far",null),u([p()],ft.prototype,"viewport",null),u([p({readOnly:!0})],ft.prototype,"screenViewport",null),u([p({readOnly:!0})],ft.prototype,"screenPadding",null),u([p()],ft.prototype,"x",null),u([p()],ft.prototype,"y",null),u([p()],ft.prototype,"width",null),u([p()],ft.prototype,"height",null),u([p()],ft.prototype,"fullWidth",null),u([p()],ft.prototype,"fullHeight",null),u([p({readOnly:!0})],ft.prototype,"_aspect",null),u([p()],ft.prototype,"padding",null),u([p({readOnly:!0})],ft.prototype,"projectionMatrix",null),u([p({readOnly:!0})],ft.prototype,"inverseProjectionMatrix",null),u([p()],ft.prototype,"fov",null),u([p()],ft.prototype,"fovX",null),u([p()],ft.prototype,"fovY",null),ft=FH=u([M("esri.views.3d.webgl-engine.lib.Camera")],ft);const ti=oi(),AI=be(),da=E(),Fz=E(),kz=aa();var ii;(function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"})(ii||(ii={}));var le;(function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",t[t.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",t[t.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",t[t.ANTIALIASING=10]="ANTIALIASING",t[t.COMPOSITE=11]="COMPOSITE",t[t.BLIT=12]="BLIT",t[t.SSAO=13]="SSAO",t[t.HIGHLIGHT=14]="HIGHLIGHT",t[t.SHADOW_HIGHLIGHT=15]="SHADOW_HIGHLIGHT",t[t.ENVIRONMENT_OPAQUE=16]="ENVIRONMENT_OPAQUE",t[t.ENVIRONMENT_TRANSPARENT=17]="ENVIRONMENT_TRANSPARENT",t[t.LASERLINES=18]="LASERLINES",t[t.LASERLINES_CONTRAST_CONTROL=19]="LASERLINES_CONTRAST_CONTROL",t[t.HUD_MATERIAL=20]="HUD_MATERIAL",t[t.LABEL_MATERIAL=21]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=22]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=23]="LINE_CALLOUTS_HUD_DEPTH",t[t.DRAPED_MATERIAL=24]="DRAPED_MATERIAL",t[t.DRAPED_WATER=25]="DRAPED_WATER",t[t.VOXEL=26]="VOXEL",t[t.MAX_SLOTS=27]="MAX_SLOTS"})(le||(le={}));var it;(function(t){t[t.Color=0]="Color",t[t.Alpha=1]="Alpha",t[t.FrontFace=2]="FrontFace",t[t.NONE=3]="NONE",t[t.COUNT=4]="COUNT"})(it||(it={}));let CK=class{constructor(e=E()){this.intensity=e}},kTe=class{constructor(e=E(),i=Oe(.57735,.57735,.57735)){this.intensity=e,this.direction=i}},xF=class{constructor(e=E(),i=Oe(.57735,.57735,.57735),r=!0,n=1,s=1){this.intensity=e,this.direction=i,this.castShadows=r,this.specularStrength=n,this.environmentStrength=s}},UTe=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}};function cZe(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e[r];return i}function Uz(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e;return i}function eE(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]+e[r];return i}function zTe(t){return(t+1)*(t+1)}function uZe(t){return _e(Math.floor(Math.sqrt(t)-1),0,2)}function BTe(t,e,i){const r=t[0],n=t[1],s=t[2],o=i||[];return o.length=zTe(e),e>=0&&(o[0]=.28209479177),e>=1&&(o[1]=.4886025119*r,o[2]=.4886025119*s,o[3]=.4886025119*n),e>=2&&(o[4]=1.09254843059*r*n,o[5]=1.09254843059*n*s,o[6]=.31539156525*(3*s*s-1),o[7]=1.09254843059*r*s,o[8]=.54627421529*(r*r-n*n)),o}function hZe(t,e){const i=zTe(t),r=e||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let n=0;n<i;n++)r.r[n]=r.g[n]=r.b[n]=0;return r}function dZe(t,e){const i=uZe(e.r.length);for(const r of t)Pa(kH,r.direction),BTe(kH,i,Xg),cZe(Xg,e4),Uz(Xg,r.intensity[0],CT),eE(e.r,CT),Uz(Xg,r.intensity[1],CT),eE(e.g,CT),Uz(Xg,r.intensity[2],CT),eE(e.b,CT);return e}function pZe(t,e){BTe(kH,0,Xg);for(const i of t)e.r[0]+=Xg[0]*e4[0]*i.intensity[0]*4*Math.PI,e.g[0]+=Xg[0]*e4[0]*i.intensity[1]*4*Math.PI,e.b[0]+=Xg[0]*e4[0]*i.intensity[2]*4*Math.PI;return e}function fZe(t,e,i,r){hZe(e,r),ae(i.intensity,0,0,0);let n=!1;const s=mZe,o=gZe,a=yZe;s.length=0,o.length=0,a.length=0;for(const l of t)l instanceof xF&&!n?(oe(i.direction,l.direction),oe(i.intensity,l.intensity),i.specularStrength=l.specularStrength,i.environmentStrength=l.environmentStrength,i.castShadows=l.castShadows,n=!0):l instanceof xF||l instanceof kTe?s.push(l):l instanceof CK?o.push(l):l instanceof UTe&&a.push(l);dZe(s,r),pZe(o,r);for(const l of a)eE(r.r,l.r),eE(r.g,l.g),eE(r.b,l.b)}const mZe=[],gZe=[],yZe=[],Xg=[0],CT=[0],kH=E(),e4=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];let soe=class{constructor(){this.color=E(),this.intensity=1}},_Ze=class{constructor(){this.direction=E(),this.ambient=new soe,this.diffuse=new soe}};const VTe=.4;let zz=class{constructor(){this._shOrder=2,this._legacy=new _Ze,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new UTe,this._mainLight=new xF(E(),Oe(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){fZe(e,this._shOrder,this._mainLight,this._sphericalHarmonics),oe(this._legacy.direction,this._mainLight.direction);const i=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*i,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*i,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*i,re(this._legacy.diffuse.color,this._mainLight.intensity,i),oe(OI,this._legacy.diffuse.color),re(OI,OI,VTe*this.globalFactor),ue(this._legacy.ambient.color,this._legacy.ambient.color,OI)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),oe(this._mainLight.direction,e.mainLight.direction),oe(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,i,r){if(Xi(this._mainLight.intensity,e.mainLight.intensity,i.mainLight.intensity,r),this._mainLight.environmentStrength=xt(e.mainLight.environmentStrength,i.mainLight.environmentStrength,r),this._mainLight.specularStrength=xt(e.mainLight.specularStrength,i.mainLight.specularStrength,r),oe(this._mainLight.direction,i.mainLight.direction),this._mainLight.castShadows=i.mainLight.castShadows,this.globalFactor=xt(e.globalFactor,i.globalFactor,r),this.noonFactor=xt(e.noonFactor,i.noonFactor,r),e.sh.r.length===i.sh.r.length)for(let n=0;n<i.sh.r.length;n++)this._sphericalHarmonics.r[n]=xt(e.sh.r[n],i.sh.r[n],r),this._sphericalHarmonics.g[n]=xt(e.sh.g[n],i.sh.g[n],r),this._sphericalHarmonics.b[n]=xt(e.sh.b[n],i.sh.b[n],r);else for(let n=0;n<i.sh.r.length;n++)this._sphericalHarmonics.r[n]=i.sh.r[n],this._sphericalHarmonics.g[n]=i.sh.g[n],this._sphericalHarmonics.b[n]=i.sh.b[n]}};const OI=E();let bU=class{constructor(e,i){this.shadowMap=e,this.slicePlane=i,this.slot=le.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=it.NONE,this.alignPixelEnabled=!1,this.decorations=Uc.ON,this.overlayStretch=1,this._camera=new ft,this._inverseViewport=Ge(),this.oldLighting=new zz,this.newLighting=new zz,this._fadedLighting=new zz,this._lighting=this.newLighting,this.ssr=new vZe,this.multipassEnabled=!1,this.multipassTerrain=new ZXe,this.multipassGeometry=new XXe,this.hudRenderStyle=Sc.Occluded,this.cloudsFade=new SXe}get camera(){return this._camera}set camera(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:i,newLighting:r}=this;e>=1?this._lighting=r:(this._fadedLighting.lerpLighting(i,r,e),this._lighting=this._fadedLighting)}},vZe=class{constructor(){this.fadeFactor=1,this.reprojectionMatrix=be()}},$l=class extends we{constructor(e){super(e),this._techniques=new Array,this._techniqueConfiguration=new QN,this._bindParameters=new bU(null,null),this._passParameters=new STe,this._drawParameters=new ETe,this._weatherTile=Ge(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=xt(va.default.coverage[0],va.default.coverage[1],.5),this.density=xt(va.default.density[0],va.default.density[1],.5),this.absorption=xt(va.default.absorption[0],va.default.absorption[1],.5),this.cloudSize=xt(va.default.cloudSize[0],va.default.cloudSize[1],.5),this.detailSize=xt(va.default.detailSize[0],va.default.detailSize[1],.5),this.smoothness=xt(va.default.smoothness[0],va.default.smoothness[1],.5),this.cloudHeight=xt(va.default.cloudHeight[0],va.default.cloudHeight[1],.5),this.raymarchingSteps=va.default.raymarchingSteps,this._viewMatrix=be(),this._dirty=!1,this.running=!1,this._vao=qm(e.context.renderContext.rctx)}_getTechnique(e){const i=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,r=i===Tx.RG?2*e:2*e+1;return this._techniques[r]||(this._techniqueConfiguration.writeTextureChannels=i,this._techniqueConfiguration.steps=e,this._techniques[r]=new CTe({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[r])}updateWeatherTile(){const e=this.view.camera.position.latitude,i=this.view.camera.position.longitude;if(e==null||i==null)return;mi(this._weatherTile,(e+90)/180,(i+180)/360);const r=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-r)*this._weatherTile[1]);let n=0,s=0;if(this.view.environment!=null&&this.view.environment.lighting.type!=="virtual"&&this.view.environment.lighting.date!=null){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),n=31*o.getUTCMonth()+o.getUTCDate(),s=o.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+n)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+s%100)%(4*this._weatherTileCount),Uxe(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){const e=Wi(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this.addHandles([this.view.resourceController.scheduler.registerTask(pt.CLOUDS_GENERATOR,this),ne(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),Xt)])}destroy(){this._techniques.forEach(e=>li(e)),this._frameBufferCube=rt(this._frameBufferCube),this._techniques.length=0,this._vao.dispose(),this._passParameters.noiseTexture=$e(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case Yl.SIXTEEN:return 1;case Yl.HUNDRED:return 4;case Yl.COUNT:case Yl.TWOHUNDRED:return 8}}get usedMemory(){return(this._frameBufferCube?.gpuMemoryUsage??0)+(this._passParameters.noiseTexture?.textureAtlas?.gpuMemoryUsage??0)}_ensureNoiseTexture(){if(this._passParameters.noiseTexture!=null)this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);else{const e=this.context;this._passParameters.noiseTexture=new Q3({context:e}),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile)}return this._passParameters.noiseTexture.textureAtlas!=null}_ensureFrameBufferCube(e){if(this._frameBufferCube==null){const i=new Hi(e);i.target=bn.TEXTURE_CUBE_MAP,i.wrapMode=Vt.CLAMP_TO_EDGE,this._frameBufferCube=new jp(this.context.renderContext.rctx,i)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=rt(this._frameBufferCube)}applyPreset(e,i){const r=e.median,n=s=>{const o=xt(s[0],s[1],r);return i<.5?xt(s[0],o,2*i):xt(o,s[1],2*(i-.5))};this.coverage=n(e.coverage),this.density=n(e.density),this.absorption=n(e.absorption),this.cloudSize=n(e.cloudSize),this.detailSize=n(e.detailSize),this.smoothness=n(e.smoothness),this.cloudHeight=n(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){this._faceIndex===0&&this._tileIndex===0&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),gs(this._passParameters.weatherTile,this._weatherTile));const i=this._getTechnique(this._passParameters.raymarchingSteps);if(!i.compiled||this.context.renderContext.bindParameters.cloudsFade.fadeMode===Rr.CROSS_FADE||!this._ensureNoiseTexture())return ca.YIELD;this._faceIndex===0&&this._tileIndex===0&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=am.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const r=this.context.renderContext.rctx,n=r.bindTechnique(i,this._passParameters,this._bindParameters);r.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao);const s=r.getViewport(),o=i.configuration.cubeMapSize,a=o/this._tilesPerFace,l=this._tileIndex*a;r.setViewport(0,l,o,a);const c=this._ensureFrameBufferCube(o);r.bindFramebuffer(c);const h=bZe[this._faceIndex],d=wZe[this._faceIndex];s0e(this._viewMatrix,xZe,h,d),rd(this._drawParameters.viewMatrix,this._viewMatrix);const f=bn.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return c.setColorTextureTarget(f),n.bindDraw(this._drawParameters,this._bindParameters,this._passParameters),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.gl.flush(),r.setViewport(s.x,s.y,s.width,s.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.running||(this.context.renderContext.bindParameters.cloudsFade.renderingStage=am.FADING)):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),ca.YIELD}};u([p({constructOnly:!0})],$l.prototype,"context",void 0),u([p({constructOnly:!0})],$l.prototype,"view",void 0),u([p({constructOnly:!0})],$l.prototype,"requestRender",void 0),u([p()],$l.prototype,"coverage",void 0),u([p()],$l.prototype,"density",void 0),u([p()],$l.prototype,"absorption",void 0),u([p()],$l.prototype,"cloudSize",void 0),u([p()],$l.prototype,"detailSize",void 0),u([p()],$l.prototype,"smoothness",void 0),u([p()],$l.prototype,"cloudHeight",void 0),u([p()],$l.prototype,"raymarchingSteps",void 0),u([p()],$l.prototype,"running",void 0),$l=u([M("esri.views.3d.environment.CloudsGenerator")],$l);const bZe=[rr(1,0,0),rr(-1,0,0),rr(0,1,0),rr(0,-1,0),rr(0,0,1)],wZe=[rr(0,1,0),rr(0,1,0),rr(0,0,-1),rr(0,0,1),rr(0,1,0)],xZe=EK();let GTe=class extends or{constructor(){super(...arguments),this.fogColor=E(),this.fogStrength=4e-6,this.atmosphereC=1,this.fogAmount=0}};function TZe(){const t=new Ei;t.attributes.add(O.POSITION,"vec2"),t.include(mm,{textureCoordinateType:Zn.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:e,fragment:i}=t;return e.uniforms.add(new en("inverseProjectionMatrix",(r,n)=>n.camera.inverseProjectionMatrix),new en("inverseViewMatrix",(r,n)=>xC(SZe,n.camera.viewMatrix))),e.code.add(b`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add(new Re("atmosphereC",r=>r.atmosphereC),new kt("cameraPosition",(r,n)=>n.camera.eye),new Ki("nearFar",(r,n)=>n.camera.nearFar),new et("depthTexture",r=>r.depthTexture),new Re("fogStrength",r=>r.fogStrength),new Re("fogAmount",r=>r.fogAmount),new kt("fogColor",r=>r.fogColor)),t.include(yU),i.include(od),i.code.add(b`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(b`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),i.code.add(b`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}
void main() {
vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = texture(depthTexture, vuv0).r;
float zNorm = 2.0 * depthSample - 1.0;
float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linDepth;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
vec4 fog = applyFog(terrainDepth, rayDir);
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
}`),t}const SZe=be(),EZe=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:GTe,build:TZe},Symbol.toStringTag,{value:"Module"}));let jTe=class HTe extends Fi{constructor(e){super(e,new tc,()=>this.destroy())}initializeProgram(e){return new Mi(e.rctx,HTe.shader.get().build(),Si)}initializePipeline(){return Lt({blending:Go(Te.SRC_ALPHA,Te.ZERO,Te.ONE_MINUS_SRC_ALPHA,Te.ONE),colorWrite:Gt})}};jTe.shader=new Pi(EZe,()=>ce(()=>import("./Fog.glsl-c37abe4a.js"),[],import.meta.url));const CZe=.95,AZe=1;let Ib=class extends we{constructor(e){super(e),this._passParameters=new GTe;const i=e.context.renderContext.rctx;this._vao=qm(i,NM),this._technique=new jTe(e);const r=Wi(e.view.spatialReference);this._planetRadius=r.radius,this._atmosphereRadius=r.radius+M_}destroy(){this._technique.release(),this._vao.dispose()}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}render(e,i){if(this._update(e,i),this._passParameters.fogAmount<=0)return;const r=this._technique;if(!r.compiled)return void this.context.requestRender();const n=e.offscreenRenderingHelper;n.renderDepthDetached(()=>{this._passParameters.depthTexture=n.depthTexture;const s=e.rctx.bindTechnique(r,this._passParameters,e.bindParameters);this._renderFog(s,e)})}_renderFog(e,i){const r=i.rctx;r.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(ci.TRIANGLE_STRIP,0,4)}_update(e,i){const r=e.bindParameters.camera;ye(ooe,r.eye);const n=Math.max(0,ge(ooe,e.bindParameters.lighting.mainLight.direction)),s=i.color;re(aoe,s,.1),Xi(this._passParameters.fogColor,aoe,s,n);const o=xe(r.eye),a=o*o;this._passParameters.atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-tP(CZe*qg,AZe*qg,Math.abs(o-this._planetRadius)))*i.amount,this._passParameters.fogStrength=i.strength}static isSupported(e){return e.capabilities.depthTexture}};u([p({constructOnly:!0})],Ib.prototype,"context",void 0),u([p({constructOnly:!0})],Ib.prototype,"view",void 0),u([p({constructOnly:!0})],Ib.prototype,"rctx",void 0),u([p({constructOnly:!0})],Ib.prototype,"viewingMode",void 0),Ib=u([M("esri.views.3d.environment.Fog")],Ib);let OZe=class{constructor(){this.color=E(),this.strength=0,this.amount=0}};const ooe=E(),aoe=E();var F;(function(t){t[t.Color=0]="Color",t[t.Depth=1]="Depth",t[t.Normal=2]="Normal",t[t.Shadow=3]="Shadow",t[t.ShadowHighlight=4]="ShadowHighlight",t[t.ShadowExcludeHighlight=5]="ShadowExcludeHighlight",t[t.Highlight=6]="Highlight",t[t.Alpha=7]="Alpha",t[t.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",t[t.CompositeColor=9]="CompositeColor",t[t.COUNT=10]="COUNT"})(F||(F={}));function AK({code:t},e){e.doublePrecisionRequiresObfuscation?t.add(b`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):t.add(b`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}let qTe=class extends dn{constructor(e,i){super(e,"mat4",Oi.Draw,(r,n,s)=>r.setUniformMatrix4fv(e,i(n,s)))}};function Np(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",vo):t.uniforms.add(new Yu("cameraPosition",(i,r)=>ae(WTe,r.camera.viewInverseTransposeMatrix[3]-i.origin[0],r.camera.viewInverseTransposeMatrix[7]-i.origin[1],r.camera.viewInverseTransposeMatrix[11]-i.origin[2])))}function zc(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add(new en("proj",(r,n)=>n.camera.projectionMatrix),new qTe("view",(r,n)=>Kl(loe,n.camera.viewMatrix,r.origin)),new Yu("localOrigin",r=>r.origin));const i=r=>ae(WTe,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]);t.uniforms.add(new en("proj",(r,n)=>n.camera.projectionMatrix),new en("view",(r,n)=>Kl(loe,n.camera.viewMatrix,i(n))),new kt("localOrigin",(r,n)=>i(n)))}const loe=be(),WTe=E();function tC(t){t.uniforms.add(new en("viewNormal",(e,i)=>i.camera.viewInverseTransposeMatrix))}function FC(t){t.uniforms.add(new Re("pixelRatio",(e,i)=>i.camera.pixelRatio/i.overlayStretch))}let qp=class extends dn{constructor(e,i){super(e,"mat3",Oi.Pass,(r,n,s)=>r.setUniformMatrix3fv(e,i(n,s)))}};function UH(t,e,i){for(let r=0;r<i;++r)e[2*r]=t[r],e[2*r+1]=t[r]-e[2*r]}function RZe(t,e){const i=t.length;for(let r=0;r<i;++r)M2[0]=t[r],e[r]=M2[0];return e}function PZe(t,e){const i=t.length;for(let r=0;r<i;++r)M2[0]=t[r],M2[1]=t[r]-M2[0],e[r]=M2[1];return e}const M2=new Float32Array(2);let zH=class extends tc{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}};u([U()],zH.prototype,"instancedDoublePrecision",void 0),u([U()],zH.prototype,"hasModelTransformation",void 0);const coe=nn();function YTe(t,e){const i=e.hasModelTransformation,r=e.instancedDoublePrecision;i&&(t.vertex.uniforms.add(new en("model",s=>s.modelTransformation??Kr)),t.vertex.uniforms.add(new qp("normalLocalOriginFromModel",s=>(Oy(coe,s.modelTransformation??Kr),coe)))),e.instanced&&r&&(t.attributes.add(O.INSTANCEMODELORIGINHI,"vec3"),t.attributes.add(O.INSTANCEMODELORIGINLO,"vec3"),t.attributes.add(O.INSTANCEMODEL,"mat3"),t.attributes.add(O.INSTANCEMODELNORMAL,"mat3"));const n=t.vertex;r&&(n.include(AK,e),n.uniforms.add(new Yu("viewOriginHi",(s,o)=>RZe(ae(RI,o.camera.viewInverseTransposeMatrix[3],o.camera.viewInverseTransposeMatrix[7],o.camera.viewInverseTransposeMatrix[11]),RI)),new Yu("viewOriginLo",(s,o)=>PZe(ae(RI,o.camera.viewInverseTransposeMatrix[3],o.camera.viewInverseTransposeMatrix[7],o.camera.viewInverseTransposeMatrix[11]),RI)))),n.code.add(b`
    vec3 getVertexInLocalOriginSpace() {
      return ${i?r?"(model * vec4(instanceModel * localPosition().xyz, 1.0)).xyz":"(model * localPosition()).xyz":r?"instanceModel * localPosition().xyz":"localPosition().xyz"};
    }

    vec3 subtractOrigin(vec3 _pos) {
      ${r?b`
          // Negated inputs are intentionally the first two arguments. The other way around the obfuscation in dpAdd() stopped
          // working for macOS 14+ and iOS 17+.
          // Issue: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/56280
          vec3 originDelta = dpAdd(-instanceModelOriginHi, -instanceModelOriginLo, viewOriginHi, viewOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),n.code.add(b`
    vec3 dpNormal(vec4 _normal) {
      return normalize(${i?r?"normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz)":"normalLocalOriginFromModel * _normal.xyz":r?"instanceModelNormal * _normal.xyz":"_normal.xyz"});
    }
    `),e.output===F.Normal&&(tC(n),n.code.add(b`
    vec3 dpNormalView(vec4 _normal) {
      return normalize((viewNormal * ${i?r?"vec4(normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz), 1.0)":"vec4(normalLocalOriginFromModel * _normal.xyz, 1.0)":r?"vec4(instanceModelNormal * _normal.xyz, 1.0)":"_normal"}).xyz);
    }
    `)),e.hasVertexTangents&&n.code.add(b`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${i?r?"return vec4(normalLocalOriginFromModel * (instanceModelNormal * _tangent.xyz), _tangent.w);":"return vec4(normalLocalOriginFromModel * _tangent.xyz, _tangent.w);":r?"return vec4(instanceModelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}
    }`)}const RI=E();let fl=class extends zH{};u([U({constValue:!0})],fl.prototype,"hasSliceHighlight",void 0),u([U({constValue:!1})],fl.prototype,"hasSliceInVertexProgram",void 0),u([U({constValue:Oi.Pass})],fl.prototype,"pbrTextureBindType",void 0);var Mm;(function(t){t[t.Cone=0]="Cone",t[t.Cylinder=1]="Cylinder",t[t.Underground=2]="Underground",t[t.COUNT=3]="COUNT"})(Mm||(Mm={}));let OK=class extends fl{constructor(){super(...arguments),this.geometry=Mm.Cone}};u([U({count:Mm.COUNT})],OK.prototype,"geometry",void 0);function kM(t){t.attributes.add(O.POSITION,"vec3"),t.vertex.code.add(b`vec3 positionModel() { return position; }`)}function tE(t,e){t.include(kM);const i=t.vertex;i.include(AK,e),t.varyings.add("vPositionWorldCameraRelative","vec3"),t.varyings.add("vPosition_view","vec3"),i.uniforms.add(new kt("transformWorldFromViewTH",r=>r.transformWorldFromViewTH),new kt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new qp("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new en("transformProjFromView",r=>r.transformProjFromView),new TP("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new Yu("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new Yu("transformWorldFromModelTL",r=>r.transformWorldFromModelTL)),i.code.add(b`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),i.code.add(b`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${e.spherical?b`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:b`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),t.fragment.uniforms.add(new kt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL)),i.code.add(b`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),t.fragment.code.add(b`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}let XTe=class extends or{constructor(){super(...arguments),this.transformWorldFromViewTH=E(),this.transformWorldFromViewTL=E(),this.transformViewFromCameraRelativeRS=nn(),this.transformProjFromView=be()}},ZTe=class extends or{constructor(){super(...arguments),this.transformWorldFromModelRS=nn(),this.transformWorldFromModelTH=E(),this.transformWorldFromModelTL=E()}};function Nv(t){t.varyings.add("linearDepth","float")}function Sx(t){t.vertex.uniforms.add(new Ki("nearFar",(e,i)=>i.camera.nearFar))}function wU(t){t.vertex.code.add(b`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function kC(t,e){const{vertex:i}=t;switch(e.output){case F.Color:if(e.receiveShadows)return Nv(t),void i.code.add(b`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case F.Depth:case F.Shadow:case F.ShadowHighlight:case F.ShadowExcludeHighlight:return t.include(tE,e),Nv(t),Sx(t),wU(t),void i.code.add(b`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}i.code.add(b`void forwardLinearDepth() {}`)}function Xl(t){wU(t),t.vertex.code.add(b`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(b`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}let RK=class extends or{constructor(){super(...arguments),this.texV=Ge(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new JTe}},JTe=class{constructor(){this.center=E(),this.v1=E(),this.v2=E()}};function MZe(t){const e=new Ei,{vertex:i,fragment:r}=e;if(jy(i),t.geometry===Mm.Underground)e.attributes.add(O.POSITION,"vec2"),e.varyings.add("color","vec4"),i.uniforms.add(new kt("cameraPosition",(n,s)=>s.camera.eye),new Re("undergroundFadeAlpha",n=>n.undergroundFadeAlpha)),i.code.add(b`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),r.code.add(b`void main() {
fragColor = color;
}`);else{e.include(Xl,t),e.attributes.add(O.POSITION,"vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const n=t.geometry===Mm.Cylinder;i.uniforms.add(new en("proj",(a,l)=>l.camera.projectionMatrix),new en("view",(a,l)=>l.camera.viewMatrix)),n||(e.varyings.add("innerFactor","float"),i.uniforms.add(new kt("silCircleCenter",a=>a.silhouette.center)),i.uniforms.add(new kt("silCircleV1",a=>a.silhouette.v1)),i.uniforms.add(new kt("silCircleV2",a=>a.silhouette.v2)),i.uniforms.add(new Ki("texV",a=>a.texV)),i.uniforms.add(new Re("innerScale",a=>a.innerScale)));const s=6.2831853,o=1/128;i.code.add(b`
		void main(void) {
      ${n?b`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:b`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${b.float(s*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${b.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),r.uniforms.add(new et("tex",a=>a.texture)),n||r.uniforms.add(new Re("altitudeFade",a=>a.altitudeFade)),r.code.add(b`
		void main() {
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${n?b`fragColor = atmosphereColor;`:b`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return e}const $Ze=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:JTe,SimpleAtmospherePassParameters:RK,build:MZe},Symbol.toStringTag,{value:"Module"}));let TF=class KTe extends Fi{initializeProgram(e){return new Mi(e.rctx,KTe.shader.get().build(this.configuration),Si)}initializePipeline(){return this.configuration.geometry===Mm.Cylinder?Lt({blending:Go(Te.SRC_ALPHA,Te.ONE,Te.ONE_MINUS_SRC_ALPHA,Te.ONE_MINUS_SRC_ALPHA),culling:mK,depthTest:{func:Bi.LEQUAL},colorWrite:Gt}):Lt({blending:Go(Te.SRC_ALPHA,Te.ONE,Te.ONE_MINUS_SRC_ALPHA,Te.ONE_MINUS_SRC_ALPHA),depthTest:{func:Bi.LEQUAL},colorWrite:Gt})}};TF.shader=new Pi($Ze,()=>ce(()=>import("./SimpleAtmosphere.glsl-58397d90.js"),[],import.meta.url));const IZe=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);function Kc(t,e=0){const i=t.stride;return Array.from(t.fields.keys()).map(r=>{const n=t.fields.get(r),s=n.constructor.ElementCount,o=LZe(n.constructor.ElementType),a=n.offset,l=!(!n.optional||!n.optional.glNormalized);return new Vo(r,s,o,a,i,l,e)})}function LZe(t){const e=DZe[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}const DZe={u8:Qe.UNSIGNED_BYTE,u16:Qe.UNSIGNED_SHORT,u32:Qe.UNSIGNED_INT,i8:Qe.BYTE,i16:Qe.SHORT,i32:Qe.INT,f32:Qe.FLOAT};let PK=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.elementCount=9;const o=this.TypedArrayConstructor;n===void 0&&(n=9*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=s==null?new o(i,a):new o(i,a,(s-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let n=0;n<9;n++)i[n]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let n=0;n<9;n++)this.typedBuffer[r++]=i[n]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){const n=this.typedBuffer,s=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<9;++l)n[o++]=s[a++]}get buffer(){return this.typedBuffer.buffer}};PK.ElementCount=9;let MK=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.elementCount=16;const o=this.TypedArrayConstructor;n===void 0&&(n=16*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=s==null?new o(i,a):new o(i,a,(s-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let n=0;n<16;n++)i[n]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let n=0;n<16;n++)this.typedBuffer[r++]=i[n]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){const n=this.typedBuffer,s=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<16;++l)n[o++]=s[a++]}get buffer(){return this.typedBuffer.buffer}};MK.ElementCount=16;let qy=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.elementCount=1;const o=this.TypedArrayConstructor;n===void 0&&(n=o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=s==null?new o(i,a):new o(i,a,(s-r)/o.BYTES_PER_ELEMENT),this.stride=n,this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,i){this.typedBuffer[e*this.typedBufferStride]=i}get buffer(){return this.typedBuffer.buffer}};qy.ElementCount=1;let Wy=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.elementCount=2;const o=this.TypedArrayConstructor;n===void 0&&(n=2*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=s==null?new o(i,a):new o(i,a,(s-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,mi(i,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e]=i[1]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e]=r}copyFrom(e,i,r){const n=this.typedBuffer,s=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;n[o++]=s[a++],n[o]=s[a]}get buffer(){return this.typedBuffer.buffer}};Wy.ElementCount=2;let Yy=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.elementCount=3;const o=this.TypedArrayConstructor;n===void 0&&(n=3*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=s==null?new o(i,a):new o(i,a,(s-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,ae(i,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e]=i[2]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,n){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e]=n}copyFrom(e,i,r){const n=this.typedBuffer,s=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;n[o++]=s[a++],n[o++]=s[a++],n[o]=s[a]}get buffer(){return this.typedBuffer.buffer}};Yy.ElementCount=3;let Xy=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.start=r,this.elementCount=4;const o=this.TypedArrayConstructor;n===void 0&&(n=4*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=s==null?new o(i,a):new o(i,a,(s-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,Gr(i,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e++]=i[2],this.typedBuffer[e]=i[3]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,n,s){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e++]=n,this.typedBuffer[e]=s}copyFrom(e,i,r){const n=this.typedBuffer,s=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;n[o++]=s[a++],n[o++]=s[a++],n[o++]=s[a++],n[o]=s[a]}get buffer(){return this.typedBuffer.buffer}};Xy.ElementCount=4;let xU=class QTe extends qy{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}static fromTypedArray(e,i){return new QTe(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};xU.ElementType="f32";let Jx=class BH extends Wy{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}slice(e,i){return this.sliceBuffer(BH,e,i)}static fromTypedArray(e,i){return new BH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Jx.ElementType="f32";let Ws=class VH extends Yy{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}slice(e,i){return this.sliceBuffer(VH,e,i)}static fromTypedArray(e,i){return new VH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Ws.ElementType="f32";let Fp=class GH extends Xy{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}slice(e,i){return this.sliceBuffer(GH,e,i)}static fromTypedArray(e,i){return new GH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Fp.ElementType="f32";let Fv=class jH extends PK{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}slice(e,i){return this.sliceBuffer(jH,e,i)}static fromTypedArray(e,i){return new jH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Fv.ElementType="f32";let $K=class HH extends PK{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(HH,e,i)}static fromTypedArray(e,i){return new HH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};$K.ElementType="f64";let IK=class qH extends MK{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}slice(e,i){return this.sliceBuffer(qH,e,i)}static fromTypedArray(e,i){return new qH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};IK.ElementType="f32";let EP=class WH extends MK{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(WH,e,i)}static fromTypedArray(e,i){return new WH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};EP.ElementType="f64";let LK=class YH extends qy{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(YH,e,i)}static fromTypedArray(e,i){return new YH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};LK.ElementType="f64";let DK=class XH extends Wy{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(XH,e,i)}static fromTypedArray(e,i){return new XH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};DK.ElementType="f64";let ld=class ZH extends Yy{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(ZH,e,i)}static fromTypedArray(e,i){return new ZH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ld.ElementType="f64";let TU=class JH extends Xy{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(JH,e,i)}static fromTypedArray(e,i){return new JH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};TU.ElementType="f64";let iC=class KH extends qy{constructor(e,i=0,r,n){super(Uint8Array,e,i,r,n),this.elementType="u8"}slice(e,i){return this.sliceBuffer(KH,e,i)}static fromTypedArray(e,i){return new KH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};iC.ElementType="u8";let SU=class QH extends Wy{constructor(e,i=0,r,n){super(Uint8Array,e,i,r,n),this.elementType="u8"}slice(e,i){return this.sliceBuffer(QH,e,i)}static fromTypedArray(e,i){return new QH(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};SU.ElementType="u8";let EU=class eq extends Yy{constructor(e,i=0,r,n){super(Uint8Array,e,i,r,n),this.elementType="u8"}slice(e,i){return this.sliceBuffer(eq,e,i)}static fromTypedArray(e,i){return new eq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};EU.ElementType="u8";let Ia=class tq extends Xy{constructor(e,i=0,r,n){super(Uint8Array,e,i,r,n),this.elementType="u8"}slice(e,i){return this.sliceBuffer(tq,e,i)}static fromTypedArray(e,i){return new tq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Ia.ElementType="u8";let CU=class iq extends qy{constructor(e,i=0,r,n){super(Uint16Array,e,i,r,n),this.elementType="u16"}slice(e,i){return this.sliceBuffer(iq,e,i)}static fromTypedArray(e,i){return new iq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};CU.ElementType="u16";let NK=class rq extends Wy{constructor(e,i=0,r,n){super(Uint16Array,e,i,r,n),this.elementType="u16"}slice(e,i){return this.sliceBuffer(rq,e,i)}static fromTypedArray(e,i){return new rq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};NK.ElementType="u16";let AU=class nq extends Yy{constructor(e,i=0,r,n){super(Uint16Array,e,i,r,n),this.elementType="u16"}slice(e,i){return this.sliceBuffer(nq,e,i)}static fromTypedArray(e,i){return new nq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};AU.ElementType="u16";let UM=class sq extends Xy{constructor(e,i=0,r,n){super(Uint16Array,e,i,r,n),this.elementType="u16"}slice(e,i){return this.sliceBuffer(sq,e,i)}static fromTypedArray(e,i){return new sq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};UM.ElementType="u16";let OU=class oq extends qy{constructor(e,i=0,r,n){super(Uint32Array,e,i,r,n),this.elementType="u32"}slice(e,i){return this.sliceBuffer(oq,e,i)}static fromTypedArray(e,i){return new oq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};OU.ElementType="u32";let FK=class aq extends Wy{constructor(e,i=0,r,n){super(Uint32Array,e,i,r,n),this.elementType="u32"}slice(e,i){return this.sliceBuffer(aq,e,i)}static fromTypedArray(e,i){return new aq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};FK.ElementType="u32";let eSe=class lq extends Yy{constructor(e,i=0,r,n){super(Uint32Array,e,i,r,n),this.elementType="u32"}slice(e,i){return this.sliceBuffer(lq,e,i)}static fromTypedArray(e,i){return new lq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};eSe.ElementType="u32";let tSe=class cq extends Xy{constructor(e,i=0,r,n){super(Uint32Array,e,i,r,n),this.elementType="u32"}slice(e,i){return this.sliceBuffer(cq,e,i)}static fromTypedArray(e,i){return new cq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};tSe.ElementType="u32";let kK=class uq extends qy{constructor(e,i=0,r,n){super(Int8Array,e,i,r,n),this.elementType="i8"}slice(e,i){return this.sliceBuffer(uq,e,i)}static fromTypedArray(e,i){return new uq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};kK.ElementType="i8";let RU=class hq extends Wy{constructor(e,i=0,r,n){super(Int8Array,e,i,r,n),this.elementType="i8"}slice(e,i){return this.sliceBuffer(hq,e,i)}static fromTypedArray(e,i){return new hq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};RU.ElementType="i8";let iSe=class dq extends Yy{constructor(e,i=0,r,n){super(Int8Array,e,i,r,n),this.elementType="i8"}slice(e,i){return this.sliceBuffer(dq,e,i)}static fromTypedArray(e,i){return new dq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};iSe.ElementType="i8";let rSe=class pq extends Xy{constructor(e,i=0,r,n){super(Int8Array,e,i,r,n),this.elementType="i8"}slice(e,i){return this.sliceBuffer(pq,e,i)}static fromTypedArray(e,i){return new pq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};rSe.ElementType="i8";let nSe=class fq extends qy{constructor(e,i=0,r,n){super(Int16Array,e,i,r,n),this.elementType="i16"}slice(e,i){return this.sliceBuffer(fq,e,i)}static fromTypedArray(e,i){return new fq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};nSe.ElementType="i16";let zM=class mq extends Wy{constructor(e,i=0,r,n){super(Int16Array,e,i,r,n),this.elementType="i16"}slice(e,i){return this.sliceBuffer(mq,e,i)}static fromTypedArray(e,i){return new mq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};zM.ElementType="i16";let sSe=class gq extends Yy{constructor(e,i=0,r,n){super(Int16Array,e,i,r,n),this.elementType="i16"}slice(e,i){return this.sliceBuffer(gq,e,i)}static fromTypedArray(e,i){return new gq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};sSe.ElementType="i16";let oSe=class yq extends Xy{constructor(e,i=0,r,n){super(Int16Array,e,i,r,n),this.elementType="i16"}slice(e,i){return this.sliceBuffer(yq,e,i)}static fromTypedArray(e,i){return new yq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};oSe.ElementType="i16";let aSe=class _q extends qy{constructor(e,i=0,r,n){super(Int32Array,e,i,r,n),this.elementType="i32"}slice(e,i){return this.sliceBuffer(_q,e,i)}static fromTypedArray(e,i){return new _q(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};aSe.ElementType="i32";let lSe=class vq extends Wy{constructor(e,i=0,r,n){super(Int32Array,e,i,r,n),this.elementType="i32"}slice(e,i){return this.sliceBuffer(vq,e,i)}static fromTypedArray(e,i){return new vq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};lSe.ElementType="i32";let cSe=class bq extends Yy{constructor(e,i=0,r,n){super(Int32Array,e,i,r,n),this.elementType="i32"}slice(e,i){return this.sliceBuffer(bq,e,i)}static fromTypedArray(e,i){return new bq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};cSe.ElementType="i32";let uSe=class wq extends Xy{constructor(e,i=0,r,n){super(Int32Array,e,i,r,n),this.elementType="i32"}slice(e,i){return this.sliceBuffer(wq,e,i)}static fromTypedArray(e,i){return new wq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};uSe.ElementType="i32";function uoe(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}let hoe=class hSe{constructor(e,i){this.layout=e,this.buffer=typeof i=="number"?new ArrayBuffer(i*e.stride):i;for(const r of e.fields.keys()){const n=e.fields.get(r);this[r]=new n.constructor(this.buffer,n.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,i){const r=this[e];return r&&r.elementCount===i.ElementCount&&r.elementType===i.ElementType?r:null}slice(e,i){return new hSe(this.layout,this.buffer.slice(e*this.stride,i*this.stride))}copyFrom(e,i=0,r=0,n=e.count){const s=this.stride;if(s%4==0){const o=new Uint32Array(e.buffer,i*s,n*s/4);new Uint32Array(this.buffer,r*s,n*s/4).set(o)}else{const o=new Uint8Array(e.buffer,i*s,n*s);new Uint8Array(this.buffer,r*s,n*s).set(o)}return this}get usedMemory(){return this.byteLength}dispose(){}},dSe=class pSe{constructor(e=null){this._stride=0,this._lastAligned=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach(i=>this._fields.set(i[0],{...i[1],constructor:kZe(i[1].constructor)})))}vec2f(e,i){return this._appendField(e,Jx,i),this}vec2f64(e,i){return this._appendField(e,DK,i),this}vec3f(e,i){return this._appendField(e,Ws,i),this}vec3f64(e,i){return this._appendField(e,ld,i),this}vec4f(e,i){return this._appendField(e,Fp,i),this}vec4f64(e,i){return this._appendField(e,TU,i),this}mat3f(e,i){return this._appendField(e,Fv,i),this}mat3f64(e,i){return this._appendField(e,$K,i),this}mat4f(e,i){return this._appendField(e,IK,i),this}mat4f64(e,i){return this._appendField(e,EP,i),this}vec4u8(e,i){return this._appendField(e,Ia,i),this}f32(e,i){return this._appendField(e,xU,i),this}f64(e,i){return this._appendField(e,LK,i),this}u8(e,i){return this._appendField(e,iC,i),this}u16(e,i){return this._appendField(e,CU,i),this}i8(e,i){return this._appendField(e,kK,i),this}vec2i8(e,i){return this._appendField(e,RU,i),this}vec2i16(e,i){return this._appendField(e,zM,i),this}vec2u8(e,i){return this._appendField(e,SU,i),this}vec4u16(e,i){return this._appendField(e,UM,i),this}u32(e,i){return this._appendField(e,OU,i),this}_appendField(e,i,r){if(this._fields.has(e))return void tt(!1,`${e} already added to vertex buffer layout`);const n=i.ElementCount*uoe(i.ElementType),s=this._stride;this._stride+=n,this._fields.set(e,{size:n,constructor:i,offset:s,optional:r})}createBuffer(e){return new hoe(this,e)}createView(e){return new hoe(this,e)}clone(){const e=new pSe;return e._stride=this._stride,e._fields=new Map,this._fields.forEach((i,r)=>e._fields.set(r,i)),e.BufferType=this.BufferType,e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach(i=>e=Math.max(e,uoe(i.constructor.ElementType))),this._stride=Math.floor((this._stride+e-1)/e)*e,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}};function Hr(){return new dSe}let NZe=class{constructor(e){this.fields=new Array,e.fields.forEach((i,r)=>{const n={...i,constructor:fSe(i.constructor)};this.fields.push([r,n])}),this.stride=e.stride}};const FZe=[xU,Jx,Ws,Fp,Fv,IK,LK,DK,ld,TU,$K,EP,iC,SU,EU,Ia,CU,NK,AU,UM,OU,FK,eSe,tSe,kK,RU,iSe,rSe,nSe,zM,sSe,oSe,aSe,lSe,cSe,uSe];function fSe(t){return`${t.ElementType}_${t.ElementCount}`}function kZe(t){return mSe.get(t)}const mSe=new Map;FZe.forEach(t=>mSe.set(fSe(t),t));function _o(t,e=!1){return t<=Ju?e?new Array(t).fill(0):new Array(t):new Float64Array(t)}function gSe(t){return(Kh(t)?t.length:t.byteLength/8)<=Ju?Array.from(t):new Float64Array(t)}function Xh(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}function UZe(t,e){for(let i=0;i<e.length;++i)t[i]=e[i];return t}function DNt(t){return Array.isArray(t)?new Float64Array(t):t}function un(t,e=!1){return t<=Ju?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function NNt(t){return Kh(t)?t.length<Ju?t:new Float32Array(t):t.length<Ju?Array.from(t):t}function doe(t){return(Kh(t)?t.length:t.byteLength/8)<=Ju?Array.from(t):new Float32Array(t)}function SF(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}function ym(t){if(Kh(t)){if(t.length<Ju)return t}else if(t.length<Ju)return Array.from(t);let e=!0,i=!0;return t.some((r,n)=>(e=e&&r===0,i=i&&r===n,!e&&!i)),e?r1(t.length):i?Kx(t.length):Kh(t)||t.BYTES_PER_ELEMENT!==Uint16Array.BYTES_PER_ELEMENT?zZe(t):t}function zZe(t){let e=!0;for(const i of t){if(i>=65536)return Kh(t)?new Uint32Array(t):t;i>=256&&(e=!1)}return e?new Uint8Array(t):new Uint16Array(t)}function EF(t){return t<=Ju?new Array(t):t<=65536?new Uint16Array(t):new Uint32Array(t)}function BZe(t){return t<=Ju?new Array(t):new Uint32Array(t)}let AT=(()=>{const t=new Uint32Array(131072);for(let e=0;e<t.length;++e)t[e]=e;return t})();const ySe=[0],Bz=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function Kx(t){if(t===1)return ySe;if(t<Ju)return Array.from(new Uint16Array(Bz.buffer,0,t));if(t<Bz.length)return new Uint16Array(Bz.buffer,0,t);if(t>AT.length){const e=Math.max(2*AT.length,t);AT=new Uint32Array(e);for(let i=0;i<AT.length;i++)AT[i]=i}return new Uint32Array(AT.buffer,0,t)}let PI=new Uint8Array(65536);function r1(t){if(t===1)return ySe;if(t<Ju)return new Array(t).fill(0);if(t>PI.length){const e=Math.max(2*PI.length,t);PI=new Uint8Array(e)}return new Uint8Array(PI.buffer,0,t)}var xq;(function(t){function e(o,a){const l=o[a],c=o[a+1],h=o[a+2];return Math.sqrt(l*l+c*c+h*h)}function i(o,a){const l=o[a],c=o[a+1],h=o[a+2],d=1/Math.sqrt(l*l+c*c+h*h);o[a]*=d,o[a+1]*=d,o[a+2]*=d}function r(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function n(o,a,l,c,h,d=a){(h=h||o)[d]=o[a]+l[c],h[d+1]=o[a+1]+l[c+1],h[d+2]=o[a+2]+l[c+2]}function s(o,a,l,c,h,d=a){(h=h||o)[d]=o[a]-l[c],h[d+1]=o[a+1]-l[c+1],h[d+2]=o[a+2]-l[c+2]}t.length=e,t.normalize=i,t.scale=r,t.add=n,t.subtract=s})(xq||(xq={}));var wn;(function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"})(wn||(wn={}));function VZe(t){if(t.length<Ju)return Array.from(t);if(Kh(t))return Float64Array.from(t);if(!("BYTES_PER_ELEMENT"in t))return Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return i6(t)?Uint16Array.from(t):Int16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}let _Se=class vSe{constructor(e,i,r){this.primitiveIndices=e,this._numIndexPerPrimitive=i,this.position=r,this._children=void 0,tt(e.length>=1),tt(r.size===3||r.size===4);const{data:n,size:s,indices:o}=r;tt(o.length%this._numIndexPerPrimitive==0),tt(o.length>=e.length*this._numIndexPerPrimitive);const a=e.length;let l=s*o[this._numIndexPerPrimitive*e[0]];w1.clear(),w1.push(l);const c=Oe(n[l],n[l+1],n[l+2]),h=Qr(c);for(let m=0;m<a;++m){const y=this._numIndexPerPrimitive*e[m];for(let _=0;_<this._numIndexPerPrimitive;++_){l=s*o[y+_],w1.push(l);let v=n[l];c[0]=Math.min(v,c[0]),h[0]=Math.max(v,h[0]),v=n[l+1],c[1]=Math.min(v,c[1]),h[1]=Math.max(v,h[1]),v=n[l+2],c[2]=Math.min(v,c[2]),h[2]=Math.max(v,h[2])}}this.bbMin=c,this.bbMax=h;const d=Xi(E(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(h[0]-c[0],h[1]-c[1]),h[2]-c[2]);let f=this.radius*this.radius;for(let m=0;m<w1.length;++m){l=w1.at(m);const y=n[l]-d[0],_=n[l+1]-d[1],v=n[l+2]-d[2],w=y*y+_*_+v*v;if(w<=f)continue;const x=Math.sqrt(w),T=.5*(x-this.radius);this.radius=this.radius+T,f=this.radius*this.radius;const S=T/x;d[0]+=y*S,d[1]+=_*S,d[2]+=v*S}this.center=d,w1.clear()}getChildren(){if(this._children||qs(this.bbMin,this.bbMax)<=1)return this._children;const e=Xi(E(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,r=new Uint8Array(i),n=new Array(8);for(let h=0;h<8;++h)n[h]=0;const{data:s,size:o,indices:a}=this.position;for(let h=0;h<i;++h){let d=0;const f=this._numIndexPerPrimitive*this.primitiveIndices[h];let m=o*a[f],y=s[m],_=s[m+1],v=s[m+2];for(let w=1;w<this._numIndexPerPrimitive;++w){m=o*a[f+w];const x=s[m],T=s[m+1],S=s[m+2];x<y&&(y=x),T<_&&(_=T),S<v&&(v=S)}y<e[0]&&(d|=1),_<e[1]&&(d|=2),v<e[2]&&(d|=4),r[h]=d,++n[d]}let l=0;for(let h=0;h<8;++h)n[h]>0&&++l;if(l<2)return;const c=new Array(8);for(let h=0;h<8;++h)c[h]=n[h]>0?new Uint32Array(n[h]):void 0;for(let h=0;h<8;++h)n[h]=0;for(let h=0;h<i;++h){const d=r[h];c[d][n[d]++]=this.primitiveIndices[h]}this._children=new Array;for(let h=0;h<8;++h)c[h]!==void 0&&this._children.push(new vSe(c[h],this._numIndexPerPrimitive,this.position));return this._children}static prune(){w1.prune()}};const w1=new Ut({deallocator:null});let BM=class{constructor(){this.id=zu()}};function GZe(t){return t?{p0:Qr(t.p0),p1:Qr(t.p1),p2:Qr(t.p2)}:{p0:E(),p1:E(),p2:E()}}function poe(t,e,i){const r=e[0]-t[0],n=e[1]-t[1],s=i[0]-t[0],o=i[1]-t[1];return .5*Math.abs(r*o-n*s)}function jZe(t,e,i){return de(Vz,e,t),de(foe,i,t),xe(lt(Vz,Vz,foe))/2}new zy(Vp);new zy(()=>GZe());const Vz=E(),foe=E();function HZe(t,e){if(!t)return!1;const{size:i,data:r,indices:n}=t;ae(e,0,0,0),ae(Mh,0,0,0);let s=0,o=0;for(let a=0;a<n.length-2;a+=3){const l=n[a]*i,c=n[a+1]*i,h=n[a+2]*i;ae(ho,r[l],r[l+1],r[l+2]),ae(Zg,r[c],r[c+1],r[c+2]),ae(MI,r[h],r[h+1],r[h+2]);const d=jZe(ho,Zg,MI);d?(ue(ho,ho,Zg),ue(ho,ho,MI),re(ho,ho,1/3*d),ue(e,e,ho),s+=d):(ue(Mh,Mh,ho),ue(Mh,Mh,Zg),ue(Mh,Mh,MI),o+=3)}return(o!==0||s!==0)&&(s!==0?(re(e,e,1/s),!0):o!==0&&(re(e,Mh,1/o),!0))}function qZe(t,e){if(!t)return!1;const{size:i,data:r,indices:n}=t;ae(e,0,0,0);let s=-1,o=0;for(let a=0;a<n.length;a++){const l=n[a]*i;s!==l&&(e[0]+=r[l],e[1]+=r[l+1],e[2]+=r[l+2],o++),s=l}return o>1&&re(e,e,1/o),o>0}function WZe(t,e,i){if(!t)return!1;ae(i,0,0,0),ae(Mh,0,0,0);let r=0,n=0;const{size:s,data:o,indices:a}=t,l=a.length-1,c=l+(e?2:0);for(let h=0;h<c;h+=2){const d=h<l?h+1:0,f=a[h<l?h:l]*s,m=a[d]*s;ho[0]=o[f],ho[1]=o[f+1],ho[2]=o[f+2],Zg[0]=o[m],Zg[1]=o[m+1],Zg[2]=o[m+2],re(ho,ue(ho,ho,Zg),.5);const y=fM(ho,Zg);y>0?(ue(i,i,re(ho,ho,y)),r+=y):r===0&&(ue(Mh,Mh,ho),n++)}return r!==0?(re(i,i,1/r),!0):n!==0&&(re(i,Mh,1/n),!0)}const ho=E(),Zg=E(),MI=E(),Mh=E();let CF=class{constructor(e){this.channel=e,this.id=zu()}};function Tq(t,e){return t==null&&(t=[]),t.push(e),t}function Sq(t,e){if(t==null)return null;const i=t.filter(r=>r!==e);return i.length===0?null:i}function YZe(t,e,i,r,n){$I[0]=t.get(e,0),$I[1]=t.get(e,1),$I[2]=t.get(e,2),UH($I,x1,3),i.set(n,0,x1[0]),r.set(n,0,x1[1]),i.set(n,1,x1[2]),r.set(n,1,x1[3]),i.set(n,2,x1[4]),r.set(n,2,x1[5])}const $I=E(),x1=new Float32Array(6);let ms=class bSe extends BM{constructor(e,i,r=null,n=wn.Mesh,s=null,o=-1){super(),this.material=e,this.mapPositions=r,this.type=n,this.objectAndLayerIdColor=s,this.edgeIndicesLength=o,this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(const[a,l]of i)this._attributes.set(a,{...l,indices:ym(l.indices)}),a===O.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(a).indices.length:this.edgeIndicesLength)}instantiate(e={}){const i=new bSe(e.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach((r,n)=>{r.exclusive=!1,i._attributes.set(n,r)}),i._boundingInfo=this._boundingInfo,i.transformation=e.transformation||this.transformation,i}get attributes(){return this._attributes}getMutableAttribute(e){let i=this._attributes.get(e);return i&&!i.exclusive&&(i={...i,exclusive:!0,data:VZe(i.data)},this._attributes.set(e,i)),i}setAttributeData(e,i){const r=this._attributes.get(e);r&&this._attributes.set(e,{...r,exclusive:!0,data:i})}get indexCount(){return this._attributes.values().next().value.indices?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo==null&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===wn.Mesh?this._computeAttachmentOriginTriangles(e):this.type===wn.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(this._transformation!=null&&ke(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const i=this.attributes.get(O.POSITION);return HZe(i,e)}_computeAttachmentOriginLines(e){const i=this.attributes.get(O.POSITION);return WZe(i,XZe(this.material.parameters,i),e)}_computeAttachmentOriginPoints(e){const i=this.attributes.get(O.POSITION);return qZe(i,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.attributes.get(O.POSITION);if(!e||e.indices.length===0)return null;const i=this.type===wn.Mesh?3:1;tt(e.indices.length%i==0,"Indexing error: "+e.indices.length+" not divisible by "+i);const r=Kx(e.indices.length/i);return new _Se(r,i,e)}get transformation(){return this._transformation??Kr}set transformation(e){this._transformation=e&&e!==Kr?HE(e):null}addHighlight(){const e=new CF(Py.Highlight);return this.highlights=Tq(this.highlights,e),e}removeHighlight(e){this.highlights=Sq(this.highlights,e)}};function XZe(t,e){return!(!("isClosed"in t)||!t.isClosed)&&e.indices.length>2}const OT=xq,Gz=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],ZZe=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],JZe=[0,0,1,0,1,1,0,1],KZe=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],wSe=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)wSe[6*t+e]=t;const Lb=new Array(36);for(let t=0;t<6;t++)Lb[6*t]=0,Lb[6*t+1]=1,Lb[6*t+2]=2,Lb[6*t+3]=2,Lb[6*t+4]=3,Lb[6*t+5]=0;function QZe(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(24);for(let r=0;r<8;r++)i[3*r]=Gz[r][0]*e[0],i[3*r+1]=Gz[r][1]*e[1],i[3*r+2]=Gz[r][2]*e[2];return new ms(t,[[O.POSITION,new Ve(i,KZe,3,!0)],[O.NORMAL,new Ve(ZZe,wSe,3)],[O.UV0,new Ve(JZe,Lb,2)]])}const jz=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],eJe=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],tJe=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],iJe=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function rJe(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(18);for(let r=0;r<6;r++)i[3*r]=jz[r][0]*e[0],i[3*r+1]=jz[r][1]*e[1],i[3*r+2]=jz[r][2]*e[2];return new ms(t,[[O.POSITION,new Ve(i,tJe,3,!0)],[O.NORMAL,new Ve(eJe,iJe,3)]])}const t4=rr(-.5,0,-.5),i4=rr(.5,0,-.5),r4=rr(0,0,.5),n4=rr(0,.5,0),RT=Mn(),PT=Mn(),iE=Mn(),rE=Mn(),nE=Mn();de(RT,t4,n4),de(PT,t4,i4),lt(iE,RT,PT),ye(iE,iE),de(RT,i4,n4),de(PT,i4,r4),lt(rE,RT,PT),ye(rE,rE),de(RT,r4,n4),de(PT,r4,t4),lt(nE,RT,PT),ye(nE,nE);const Hz=[t4,i4,r4,n4],nJe=[0,-1,0,iE[0],iE[1],iE[2],rE[0],rE[1],rE[2],nE[0],nE[1],nE[2]],sJe=[0,1,2,3,1,0,3,2,1,3,0,2],oJe=[0,0,0,1,1,1,2,2,2,3,3,3];function aJe(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(12);for(let r=0;r<4;r++)i[3*r]=Hz[r][0]*e[0],i[3*r+1]=Hz[r][1]*e[1],i[3*r+2]=Hz[r][2]*e[2];return new ms(t,[[O.POSITION,new Ve(i,sJe,3,!0)],[O.NORMAL,new Ve(nJe,oJe,3)]])}function UNt(t,e,i,r,n={uv:!0}){const s=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(i)),h=Math.max(2,Math.floor(r)),d=(c+1)*(h+1),f=un(3*d),m=un(3*d),y=un(2*d),_=[];let v=0;for(let T=0;T<=h;T++){const S=[],C=T/h,A=a+C*l,R=Math.cos(A);for(let D=0;D<=c;D++){const N=D/c,k=s+N*o,B=Math.cos(k)*R,L=Math.sin(A),z=-Math.sin(k)*R;f[3*v]=B*e,f[3*v+1]=L*e,f[3*v+2]=z*e,m[3*v]=B,m[3*v+1]=L,m[3*v+2]=z,y[2*v]=N,y[2*v+1]=C,S.push(v),++v}_.push(S)}const w=new Array;for(let T=0;T<h;T++)for(let S=0;S<c;S++){const C=_[T][S],A=_[T][S+1],R=_[T+1][S+1],D=_[T+1][S];T===0?(w.push(C),w.push(R),w.push(D)):T===h-1?(w.push(C),w.push(A),w.push(R)):(w.push(C),w.push(A),w.push(R),w.push(R),w.push(D),w.push(C))}const x=[[O.POSITION,new Ve(f,w,3,!0)],[O.NORMAL,new Ve(m,w,3,!0)]];return n.uv&&x.push([O.UV0,new Ve(y,w,2,!0)]),n.offset&&(x[0][0]=O.OFFSET,x.push([O.POSITION,new Ve(Float64Array.from(n.offset),r1(w.length),3,!0)])),new ms(t,x)}function lJe(t,e,i,r){const n=xSe(e,i,r);return new ms(t,n)}function xSe(t,e,i){const r=t;let n,s;if(i)n=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],s=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const c=r*(1+Math.sqrt(5))/2;n=[-r,c,0,r,c,0,-r,-c,0,r,-c,0,0,-r,c,0,r,c,0,-r,-c,0,r,-c,c,0,-r,c,0,r,-c,0,-r,-c,0,r],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let c=0;c<n.length;c+=3)OT.scale(n,c,t/OT.length(n,c));let o={};function a(c,h){c>h&&([c,h]=[h,c]);const d=c.toString()+"."+h.toString();if(o[d])return o[d];let f=n.length;return n.length+=3,OT.add(n,3*c,n,3*h,n,f),OT.scale(n,f,t/OT.length(n,f)),f/=3,o[d]=f,f}for(let c=0;c<e;c++){const h=s.length,d=new Array(4*h);for(let f=0;f<h;f+=3){const m=s[f],y=s[f+1],_=s[f+2],v=a(m,y),w=a(y,_),x=a(_,m),T=4*f;d[T]=m,d[T+1]=v,d[T+2]=x,d[T+3]=y,d[T+4]=w,d[T+5]=v,d[T+6]=_,d[T+7]=x,d[T+8]=w,d[T+9]=v,d[T+10]=w,d[T+11]=x}s=d,o={}}const l=doe(n);for(let c=0;c<l.length;c+=3)OT.normalize(l,c);return[[O.POSITION,new Ve(doe(n),s,3,!0)],[O.NORMAL,new Ve(l,s,3,!0)]]}function Eq(t,e,i,r,n,s,o,a,l=null){const c=i?[i[0],i[1],i[2]]:[0,0,0],h=e?[e[0],e[1],e[2]]:[0,0,1];o=o||[0,0];const d=r?[255*r[0],255*r[1],255*r[2],r.length>3?255*r[3]:255]:[255,255,255,255],f=n!=null&&n.length===2?n:[1,1],m=r1(1),y=[[O.POSITION,new Ve(c,m,3,!0)],[O.NORMAL,new Ve(h,m,3,!0)],[O.UV0,new Ve(o,m,o.length)],[O.COLOR,new Ve(d,m,4,!0)],[O.SIZE,new Ve(f,m,2)]];if(s!=null){const _=[s[0],s[1],s[2],s[3]];y.push([O.AUXPOS1,new Ve(_,m,4)])}if(a!=null){const _=[a[0],a[1],a[2],a[3]];y.push([O.FEATUREATTRIBUTE,new Ve(_,m,4)])}return new ms(t,y,null,wn.Point,l)}const cJe=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function zNt(t,e=cJe){const i=new Array(12);for(let c=0;c<4;c++)for(let h=0;h<3;h++)i[3*c+h]=e[c][h];const r=[0,1,2,2,3,0],n=[0,0,1],s=[0,0,0,0,0,0],o=[0,0,1,0,1,1,0,1],a=[255,255,255,255],l=[[O.POSITION,new Ve(i,r,3,!0)],[O.NORMAL,new Ve(n,s,3,!0)],[O.UV0,new Ve(o,r,2,!0)],[O.COLOR,new Ve(a,s,4,!0)]];return new ms(t,l)}function moe(t,e,i,r,n,s=!0,o=!0){let a=0;const l=i,c=e;let h=rr(0,a,0),d=rr(0,a+c,0),f=rr(0,-1,0),m=rr(0,1,0);n&&(a=c,d=rr(0,0,0),h=rr(0,a,0),f=rr(0,1,0),m=rr(0,-1,0));const y=[d,h],_=[f,m],v=r+2,w=Math.sqrt(c*c+l*l);if(n)for(let R=r-1;R>=0;R--){const D=R*(2*Math.PI/r),N=rr(Math.cos(D)*l,a,Math.sin(D)*l);y.push(N);const k=rr(c*Math.cos(D)/w,-l/w,c*Math.sin(D)/w);_.push(k)}else for(let R=0;R<r;R++){const D=R*(2*Math.PI/r),N=rr(Math.cos(D)*l,a,Math.sin(D)*l);y.push(N);const k=rr(c*Math.cos(D)/w,l/w,c*Math.sin(D)/w);_.push(k)}const x=new Array,T=new Array;if(s){for(let R=3;R<y.length;R++)x.push(1),x.push(R-1),x.push(R),T.push(0),T.push(0),T.push(0);x.push(y.length-1),x.push(2),x.push(1),T.push(0),T.push(0),T.push(0)}if(o){for(let R=3;R<y.length;R++)x.push(R),x.push(R-1),x.push(0),T.push(R),T.push(R-1),T.push(1);x.push(0),x.push(2),x.push(y.length-1),T.push(1),T.push(2),T.push(_.length-1)}const S=un(3*v);for(let R=0;R<v;R++)S[3*R]=y[R][0],S[3*R+1]=y[R][1],S[3*R+2]=y[R][2];const C=un(3*v);for(let R=0;R<v;R++)C[3*R]=_[R][0],C[3*R+1]=_[R][1],C[3*R+2]=_[R][2];const A=[[O.POSITION,new Ve(S,x,3,!0)],[O.NORMAL,new Ve(C,T,3,!0)]];return new ms(t,A)}function uJe(t,e,i,r,n,s,o){const a=n?LH(n):rr(1,0,0),l=s?LH(s):rr(0,0,0);o??(o=!0);const c=Mn();ye(c,a);const h=Mn();re(h,c,Math.abs(e));const d=Mn();re(d,h,-.5),ue(d,d,l);const f=rr(0,1,0);Math.abs(1-ge(c,f))<.2&&ae(f,0,0,1);const m=Mn();lt(m,c,f),ye(m,m),lt(f,m,c);const y=2*r+(o?2:0),_=r+(o?2:0),v=un(3*y),w=un(3*_),x=un(2*y),T=new Array(3*r*(o?4:2)),S=new Array(3*r*(o?4:2));o&&(v[3*(y-2)]=d[0],v[3*(y-2)+1]=d[1],v[3*(y-2)+2]=d[2],x[2*(y-2)]=0,x[2*(y-2)+1]=0,v[3*(y-1)]=v[3*(y-2)]+h[0],v[3*(y-1)+1]=v[3*(y-2)+1]+h[1],v[3*(y-1)+2]=v[3*(y-2)+2]+h[2],x[2*(y-1)]=1,x[2*(y-1)+1]=1,w[3*(_-2)]=-c[0],w[3*(_-2)+1]=-c[1],w[3*(_-2)+2]=-c[2],w[3*(_-1)]=c[0],w[3*(_-1)+1]=c[1],w[3*(_-1)+2]=c[2]);const C=(k,B,L)=>{T[k]=B,S[k]=L};let A=0;const R=Mn(),D=Mn();for(let k=0;k<r;k++){const B=k*(2*Math.PI/r);re(R,f,Math.sin(B)),re(D,m,Math.cos(B)),ue(R,R,D),w[3*k]=R[0],w[3*k+1]=R[1],w[3*k+2]=R[2],re(R,R,i),ue(R,R,d),v[3*k]=R[0],v[3*k+1]=R[1],v[3*k+2]=R[2],x[2*k]=k/r,x[2*k+1]=0,v[3*(k+r)]=v[3*k]+h[0],v[3*(k+r)+1]=v[3*k+1]+h[1],v[3*(k+r)+2]=v[3*k+2]+h[2],x[2*(k+r)]=k/r,x[2*k+1]=1;const L=(k+1)%r;C(A++,k,k),C(A++,k+r,k),C(A++,L,L),C(A++,L,L),C(A++,k+r,k),C(A++,L+r,L)}if(o){for(let k=0;k<r;k++){const B=(k+1)%r;C(A++,y-2,_-2),C(A++,k,_-2),C(A++,B,_-2)}for(let k=0;k<r;k++){const B=(k+1)%r;C(A++,k+r,_-1),C(A++,y-1,_-1),C(A++,B+r,_-1)}}const N=[[O.POSITION,new Ve(v,T,3,!0)],[O.NORMAL,new Ve(w,S,3,!0)],[O.UV0,new Ve(x,T,2,!0)]];return new ms(t,N)}function BNt(t,e,i,r,n,s,o=rr(0,0,0)){const a=e.length,l=un(i.length*a*3+(6*r.length||0)),c=un(i.length*a*3+(r?6:0)),h=new Array,d=new Array;let f=0,m=0;const y=Mn(),_=Mn(),v=Mn(),w=Mn(),x=Mn(),T=Mn(),S=Mn(),C=E(),A=Mn(),R=Mn(),D=Mn(),N=Mn(),k=Mn(),B=Ii();ae(A,0,1,0),de(_,i[1],i[0]),ye(_,_),s?(ue(C,i[0],o),ye(v,C)):ae(v,0,0,1),AF(_,v,A,A,x,v,goe),oe(w,v),oe(N,x);for(let I=0;I<r.length;I++)re(T,x,r[I][0]),re(C,v,r[I][2]),ue(T,T,C),ue(T,T,i[0]),l[f++]=T[0],l[f++]=T[1],l[f++]=T[2];c[m++]=-_[0],c[m++]=-_[1],c[m++]=-_[2];for(let I=0;I<n.length;I++)h.push(n[I][0]>0?n[I][0]:-n[I][0]-1+r.length),h.push(n[I][1]>0?n[I][1]:-n[I][1]-1+r.length),h.push(n[I][2]>0?n[I][2]:-n[I][2]-1+r.length),d.push(0),d.push(0),d.push(0);let L=r.length;const z=r.length-1;for(let I=0;I<i.length;I++){let V=!1;I>0&&(oe(y,_),I<i.length-1?(de(_,i[I+1],i[I]),ye(_,_)):V=!0,ue(R,y,_),ye(R,R),ue(D,i[I-1],w),IM(i[I],R,B),qx(B,th(D,y),C)?(de(C,C,i[I]),ye(v,C),lt(x,R,v),ye(x,x)):AF(R,w,N,A,x,v,goe),oe(w,v),oe(N,x)),s&&(ue(C,i[I],o),ye(k,C));for(let q=0;q<a;q++)if(re(T,x,e[q][0]),re(C,v,e[q][1]),ue(T,T,C),ye(S,T),c[m++]=S[0],c[m++]=S[1],c[m++]=S[2],ue(T,T,i[I]),l[f++]=T[0],l[f++]=T[1],l[f++]=T[2],!V){const Y=(q+1)%a;h.push(L+q),h.push(L+a+q),h.push(L+Y),h.push(L+Y),h.push(L+a+q),h.push(L+a+Y);for(let J=0;J<6;J++){const ee=h.length-6;d.push(h[ee+J]-z)}}L+=a}const j=i[i.length-1];for(let I=0;I<r.length;I++)re(T,x,r[I][0]),re(C,v,r[I][1]),ue(T,T,C),ue(T,T,j),l[f++]=T[0],l[f++]=T[1],l[f++]=T[2];const H=m/3;c[m++]=_[0],c[m++]=_[1],c[m++]=_[2];const X=L-a;for(let I=0;I<n.length;I++)h.push(n[I][0]>=0?L+n[I][0]:-n[I][0]-1+X),h.push(n[I][2]>=0?L+n[I][2]:-n[I][2]-1+X),h.push(n[I][1]>=0?L+n[I][1]:-n[I][1]-1+X),d.push(H),d.push(H),d.push(H);const P=[[O.POSITION,new Ve(l,h,3,!0)],[O.NORMAL,new Ve(c,d,3,!0)]];return new ms(t,P)}function VNt(t,e,i,r){tt(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),tt(e[0].length===3,"createPolylineGeometry(): malformed vertex"),tt(i==null||i.length===e.length,"createPolylineGeometry: need same number of points and normals"),tt(i==null||i[0].length===3,"createPolylineGeometry(): malformed normal");const n=_o(3*e.length),s=new Array(2*(e.length-1));let o=0,a=0;for(let c=0;c<e.length;c++){for(let h=0;h<3;h++)n[o++]=e[c][h];c>0&&(s[a++]=c-1,s[a++]=c)}const l=[[O.POSITION,new Ve(n,s,3,!0)]];if(i){const c=un(3*i.length);let h=0;for(let d=0;d<e.length;d++)for(let f=0;f<3;f++)c[h++]=i[d][f];l.push([O.NORMAL,new Ve(c,s,3,!0)])}return r&&l.push([O.COLOR,new Ve(r,Kx(r.length/4),4)]),new ms(t,l,null,wn.Line)}function hJe(t,e=t){const i=t.attributes,r=i.get(O.POSITION).data,n=i.get(O.NORMAL).data;if(n){const s=e.getMutableAttribute(O.NORMAL).data;for(let o=0;o<n.length;o+=3){const a=n[o+1];s[o+1]=-n[o+2],s[o+2]=a}}if(r){const s=e.getMutableAttribute(O.POSITION).data;for(let o=0;o<r.length;o+=3){const a=r[o+1];s[o+1]=-r[o+2],s[o+2]=a}}}function qz(t,e,i,r,n){return!(Math.abs(ge(e,t))>n)&&(lt(i,t,e),ye(i,i),lt(r,i,t),ye(r,r),!0)}function AF(t,e,i,r,n,s,o){return qz(t,e,n,s,o)||qz(t,i,n,s,o)||qz(t,r,n,s,o)}const goe=.99619469809;let dJe=class{constructor(e,i){this.type=wa.Local,this._configuration=new OK,this._passParameters=new RK,this._configuration.geometry=Mm.Cylinder,this._technique=i.techniqueRepository.acquire(TF,this._configuration);const r=i.renderContext.rctx;this._vao=this._createVertexArrayObject(r),this._vaoCount=uy(this._vao,"geometry");const n=new Hi;n.wrapMode=Vt.CLAMP_TO_EDGE,n.flipped=!0,n.width=1,n.height=512,this._passParameters.texture=new Nt(r,n,IZe)}destroy(){this._passParameters.texture=rt(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(e){const i=e.rctx,r=i.bindTechnique(this._technique,this._passParameters,e.bindParameters);pJe(yoe,e.bindParameters.camera.viewMatrix),r.setUniformMatrix4fv("view",yoe),i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(ci.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(e){const i=xSe(1,2,!1),{data:r,indices:n}=i[0][1],s=_oe.createBuffer(n.length),o=s.position;for(let a=0;a<n.length;++a){const l=3*n[a%3==0?a+2:a%3==2?a-2:a];o.set(a,0,r[l]),o.set(a,1,r[l+1]),o.set(a,2,r[l+2])}return new Hp(e,Si,{geometry:Kc(_oe)},{geometry:Ui.createVertex(e,Ri.STATIC_DRAW,s.buffer)})}};function pJe(t,e){Qn(t,e),t[12]=0,t[13]=0,t[14]=0,t[15]=1}const yoe=be(),_oe=Hr().vec3f(O.POSITION),fJe=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),II=128,voe=-SH,boe=0,Wz=50,mJe=()=>1-511/512,gJe=NN([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let yJe=class{constructor(e,i){this.view=e,this.type=wa.Mars,this._passParameters=new RK,this._vaoCount=0,this._texV1=1;const r=Wi(e.spatialReference);this._planetRadius=r.radius,this._outerRimWidth=r.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+voe)/this._planetRadius,this._middleRimFactor=(this._planetRadius+boe)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=boe/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniqueRepository=i.techniqueRepository;const n=i.renderContext.rctx;this._cameraChangeHandle=ne(()=>this.view.state?.camera,()=>i.requestRender(),Ji),this._vao=this._createRibbon(n),this._vaoCount=uy(this._vao,"geometry"),this._fadeVao=qm(n),this._fadeVaoCount=uy(this._fadeVao,"geometry");const s=new Hi;s.wrapMode=Vt.CLAMP_TO_EDGE,s.flipped=!0,s.width=1,s.height=512,this._passParameters.texture=new Nt(n,s,fJe);const o=new OK;o.geometry=Mm.Cone,this._coneTechnique=this._techniqueRepository.acquire(TF,o),o.geometry=Mm.Underground,this._undergroundTechnique=this._techniqueRepository.acquire(TF,o)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=rt(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(e){const i=e.bindParameters.camera;this._update(i);const r=e.rctx;this._passParameters.undergroundFadeAlpha<1&&(r.bindTechnique(this._coneTechnique,this._passParameters,e.bindParameters),r.bindVAO(this._vao),r.drawArrays(ci.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(r.bindTechnique(this._undergroundTechnique,this._passParameters,e.bindParameters),r.bindVAO(this._fadeVao),r.drawArrays(ci.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(e){const i=E(),r=this._planetRadius,n=xe(e.eye),s=n-r;if(s<0){const m=Math.min(-s/5e3,1);this._passParameters.undergroundFadeAlpha=m}else this._passParameters.undergroundFadeAlpha=0;const o=Math.max(Wz,s),a=r+voe;this._passParameters.innerScale=_Je(r+o,r,a)-1,this._passParameters.altitudeFade=fK(s),re(i,e.eye,(r+Wz)/n),woe(i,e.center,e.up,r,this._passParameters.silhouette);const l=this._computeScreenRimWidth(e,i,e.up,this._passParameters.silhouette),c=mJe(),h=gJe(s);let d=this._texV0+c*this._texVScale,f=this._texV0+l*h*this._texVScale;if(s>Wz){woe(e.eye,e.center,e.up,r,this._passParameters.silhouette);const m=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),y=_e((m-1.5)/(l-1.5),0,1);d=this._texV0+y*c*this._texVScale,f=this._texV0+xt(this._texV1,l*h,y)*this._texVScale}mi(this._passParameters.texV,d,f)}_createRibbon(e){const i=un(3+3*II*3),r=new Uint32Array(3*II*5);i[0]=0,i[1]=0,i[2]=-1;for(let o=0;o<II;o++){const a=9*o+3;i[a]=o,i[a+1]=this._innerRimFactor,i[a+2]=-1,i[a+3]=o,i[a+4]=this._middleRimFactor,i[a+5]=0,i[a+6]=o,i[a+7]=this._outerRimFactor,i[a+8]=1;const l=3*o+1,c=o===II-1?1:l+3,h=15*o;r[h]=l,r[h+1]=l+1,r[h+2]=c+1,r[h+3]=c+1,r[h+4]=c,r[h+5]=l,r[h+6]=l+1,r[h+7]=l+2,r[h+8]=c+2,r[h+9]=c+2,r[h+10]=c+1,r[h+11]=l+1,r[h+12]=l,r[h+13]=c,r[h+14]=0}const n=xoe.createBuffer(r.length),s=n.position;for(let o=0;o<r.length;++o){const a=3*r[o];s.set(o,0,i[a]),s.set(o,1,i[a+1]),s.set(o,2,i[a+2])}return new Hp(e,Si,{geometry:Kc(xoe)},{geometry:Ui.createVertex(e,Ri.STATIC_DRAW,n.buffer)})}_computeScreenRimWidth(e,i,r,n){return ue(MT,n.center,n.v2),re(LI,MT,this._outerRimFactor),A6(Yz,i,MT,r),Ise(MT,Yz,e.projectionMatrix,e.viewport,MT),Ise(LI,Yz,e.projectionMatrix,e.viewport,LI),Mr(MT,LI)/e.height}};function woe(t,e,i,r,n){const s=xe(t),o=r*Math.sqrt(s*s-r*r)/s,a=Math.sqrt(r*r-o*o),l=n.v1,c=n.v2;return re(n.center,t,a/s),lt(l,t,e),na(l)<1&&lt(l,t,i),re(l,l,o/xe(l)),lt(c,l,t),re(c,c,o/xe(c)),o}const Yz=be(),MT=E(),LI=E();function _Je(t,e,i){return t*t/(Math.sqrt(t*t-e*e)*Math.sqrt(t*t-i*i)+e*i)}const xoe=Hr().vec3f(O.POSITION);var My;(function(t){t[t.Rain=0]="Rain",t[t.Snow=1]="Snow",t[t.COUNT=2]="COUNT"})(My||(My={}));let Cq=class extends tc{constructor(){super(...arguments),this.type=My.Rain}};u([U({count:My.COUNT})],Cq.prototype,"type",void 0);function vJe(t){const e=new Ei;return e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.INSTANCEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add(new kt("cameraPosition",(i,r)=>r.camera.eye)),e.vertex.uniforms.add(new kt("offset",(i,r)=>bJe(i,r))),e.vertex.uniforms.add(new Re("width",i=>i.width)),e.vertex.uniforms.add(new en("proj",(i,r)=>r.camera.projectionMatrix)),e.vertex.uniforms.add(new en("view",(i,r)=>r.camera.viewMatrix)),e.vertex.uniforms.add(new Re("time",i=>i.time)),e.varyings.add("vUv","vec2"),e.vertex.code.add(b`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${t.type===My.Rain?b`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:b`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),e.fragment.uniforms.add(new Re("opacity",i=>i.opacity),new kt("particleColor",(i,r)=>wJe(r,t))),e.fragment.code.add(b`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${t.type===My.Rain?b`d = 0.35 * smoothstep(0.5, 0.0, d);`:b`d = smoothstep(0.5, 0.1, d);`}
      fragColor = opacity * vec4(particleColor * d, d);
    }
  `),e}function bJe(t,e){const i=e.camera.eye,r=.5*t.width,n=1/t.width,s=Iye(Aq,ae(Aq,(i[0]+r)*n,(i[1]+r)*n,(i[2]+r)*n));return go(s,i,re(s,s,t.width))}function wJe(t,e){const i=e.type===My.Rain?TJe:xJe,r=re(Aq,i,SJe),n=t.camera.eye;ye(Toe,n);const s=Math.max(0,ge(Toe,t.lighting.mainLight.direction));return Xi(r,r,i,s)}const Aq=E(),Toe=E(),xJe=Oe(1,1,1),TJe=Oe(.85,.85,.85),SJe=.7,EJe=Object.freeze(Object.defineProperty({__proto__:null,build:vJe},Symbol.toStringTag,{value:"Module"}));let CJe=class extends or{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}},Oq=class TSe extends Fi{initializeProgram(e){return new Mi(e.rctx,TSe.shader.get().build(this.configuration),s4)}initializePipeline(){return Lt({blending:Go(Te.ONE,Te.ONE,Te.ONE_MINUS_SRC_ALPHA,Te.ONE_MINUS_SRC_ALPHA),depthTest:{func:Bi.LEQUAL},colorWrite:Gt})}};Oq.shader=new Pi(EJe,()=>ce(()=>import("./Precipitation.glsl-56cf456c.js"),[],import.meta.url));const s4=new Map([[O.POSITION,0],[O.INSTANCEFEATUREATTRIBUTE,1]]);let SSe=class{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance({deltaTime:e,fixedTime:i}){return i!=null?this._time!==i&&(this._time=i,!0):(this._time=this._time+e,e!==0)}},AJe=class{constructor(e,i){this.deltaTime=e,this.fixedTime=i}},Db=class extends we{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new CJe,this._animation=new SSe,this._updatingTracking=new Cp,this._passParameters.time=0,this._passParameters.radius=Wi(e.view.spatialReference).radius,this._techniqueRepository=e.context.techniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechniqueCached=li(this._snowTechniqueCached),this._rainTechniqueCached=li(this._rainTechniqueCached),this._vao=rt(this._vao),this._instanceIdBuffer=rt(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get _rainTechnique(){if(this._rainTechniqueCached==null){const e=new Cq;e.type=My.Rain,this._rainTechniqueCached=this._techniqueRepository.acquire(Oq,e)}return this._rainTechniqueCached}get _snowTechnique(){if(this._snowTechniqueCached==null){const e=new Cq;e.type=My.Snow,this._snowTechniqueCached=this._techniqueRepository.acquire(Oq,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,i,r){const n=r==="rainy"?this._rainTechnique:this._snowTechnique;if(!n.compiled)return void this.context.requestRender();const s=e.rctx;if(this._ensureResources(s),n==null||this._vao==null||this._instanceIdBuffer==null||(e.bindParameters.cloudsFade.data!=null&&(this._passParameters.opacity=e.bindParameters.cloudsFade.opacity),this._passParameters.opacity<=0))return;const o=.35;i=i<.5?xt(0,o,2*i):xt(o,1,2*(i-.5)),this._passParameters.time=(r==="rainy"?this._rainSpeed:this._snowSpeed)*DX(this._animation.time)%1e5;const a=s.bindTechnique(n,this._passParameters,e.bindParameters);s.bindVAO(this._vao),a.assertCompatibleVertexAttributeLocations(this._vao),gK(s,s4,this._instanceIdBuffer,Soe,0),s.drawArraysInstanced(ci.TRIANGLES,0,3,this._numParticles*i),yK(s,s4,this._instanceIdBuffer,Soe)}_ensureResources(e){this._vao==null&&(this._vao=this._createVertexArrayObject(e)),this._instanceIdBuffer==null&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const i=[];for(let r=0;r<this._numParticles;r++)i.push(r);return Ui.createVertex(e,Ri.STATIC_DRAW,new Float32Array(i))}_createVertexArrayObject(e){const i=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new Hp(e,s4,{geometry:Kc(OJe)},{geometry:Ui.createVertex(e,Ri.STATIC_DRAW,i)})}};u([p({constructOnly:!0})],Db.prototype,"context",void 0),u([p({constructOnly:!0})],Db.prototype,"view",void 0),u([p({readOnly:!0})],Db.prototype,"updating",null),u([p()],Db.prototype,"_updatingTracking",void 0),Db=u([M("esri.views.3d.environment.Precipitation")],Db);const OJe=Hr().vec3f(O.POSITION),Soe=Kc(Hr().f32(O.INSTANCEFEATUREATTRIBUTE),1);function RJe(){const t=new Ei;return t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.COLOR,"vec4"),t.attributes.add(O.SIZE,"float"),t.varyings.add("vcolor","vec4"),t.varyings.add("vsize","float"),t.vertex.uniforms.add(new en("transform",(e,i)=>PJe(e,i)),new yi("viewport",(e,i)=>i.camera.fullViewport),new Re("pixelRatio",(e,i)=>i.camera.pixelRatio)),t.vertex.code.add(b`void main(void) {
gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),t.fragment.code.add(b`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);
}`),t}function PJe(t,e){return Qn(b0,e.camera.projectionMatrix),b0[10]=24e-8-1,b0[11]=-1,b0[14]=(24e-8-2)*e.camera.near,qi(b0,b0,e.camera.viewMatrix),qi(b0,b0,t.modelMatrix)}const b0=be(),MJe=Object.freeze(Object.defineProperty({__proto__:null,build:RJe},Symbol.toStringTag,{value:"Module"}));let $Je=class extends or{constructor(){super(...arguments),this.modelMatrix=be()}},ESe=class CSe extends Fi{constructor(e){super(e,new tc,()=>this.destroy())}initializeProgram(e){return new Mi(e.rctx,CSe.shader.get().build(),Si)}initializePipeline(){return Lt({blending:Go(Te.SRC_ALPHA,Te.ONE,Te.ONE_MINUS_SRC_ALPHA,Te.ONE_MINUS_SRC_ALPHA),depthTest:{func:Bi.LEQUAL},colorWrite:Gt})}};ESe.shader=new Pi(MJe,()=>ce(()=>import("./Stars.glsl-135e3aee.js"),[],import.meta.url));let p_=class extends we{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return this._loadDataTask!=null&&!this._loadDataTask.finished}constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new $Je,this._updatingTracking=new Cp}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=Gc(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=li(this._technique),this._vao=rt(this._vao),T1=null}render(e){const{rctx:i}=e;if(this._ensureResources(i),this._technique==null||this._vao==null)return;if(!this._technique.compiled)return void this.requestRender();const r=i.bindTechnique(this._technique,this._renderParameter,e.bindParameters);i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(ci.POINTS,0,this._numPoints)}_ensureResources(e){if(this._technique!=null||T1==null)return;this._technique=new ESe({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=T1.byteLength/Eoe;const i=new Float32Array(T1,0,2*this._numPoints),r=new Uint8Array(T1,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,i,r,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type!=="virtual"?this.view.environment.lighting.date:null,n=>this._update(n),Xt)}_computeDayDuration(e){const i=e,r=new Date(e.getFullYear(),0,1,11,58,56);return(+i-+r)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+r)}_update(e){if(!e)return;const i=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,r=2*this._computeDayDuration(e),n=Qn(this._renderParameter.modelMatrix,DJe);ME(n,n,-r*Math.PI),qi(n,LJe,n),ME(n,n,-i*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,i,r,n){const s=Coe.createBuffer(n),o=s.position,a=s.color,l=s.size;for(let c=0;c<n;c++){const h=i[2*c],d=i[2*c+1];o.set(c,0,-Math.cos(h)*Math.sin(d)),o.set(c,1,-Math.sin(h)*Math.sin(d)),o.set(c,2,-Math.cos(d));const f=this._unpackUint8Attributes(r[c]),m=this._hexToRGB(IJe[f[1]]);a.set(c,0,255*m[0]),a.set(c,1,255*m[1]),a.set(c,2,255*m[2]),a.set(c,3,255),l.set(c,f[0])}return new Hp(e,Si,{geometry:Kc(Coe)},{geometry:Ui.createVertex(e,Ri.STATIC_DRAW,s.buffer)})}_createLoadDataTask(){if(T1!=null)return null;const e=Xv(async i=>{const{data:r}=await u4e("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:i});this._verifyStarData(r),T1=r});return e.promise.catch(i=>{Tn(i)||K.getLogger(this).error(i)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new G("stars:no-data-received","Failed to create stars because star catalogue is missing");const i=e.byteLength/Eoe;if(i%1!=0||i>5e4||i<5e3)throw new G("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};u([p({constructOnly:!0})],p_.prototype,"view",void 0),u([p({constructOnly:!0})],p_.prototype,"requestRender",void 0),u([p({readOnly:!0})],p_.prototype,"updating",null),u([p()],p_.prototype,"_loadDataTask",void 0),u([p()],p_.prototype,"_updatingTracking",void 0),p_=u([M("esri.views.3d.environment.Stars")],p_);const IJe=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],LJe=CJ(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),DJe=CJ(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),Eoe=9,Coe=Hr().vec3f(O.POSITION).vec4u8(O.COLOR).f32(O.SIZE);let T1=null;const PU={required:[]},ASe={required:[F.Depth]},OSe={required:[F.CompositeColor]},RSe={required:[F.Highlight]},NJe={required:[F.Depth,F.Normal]};let MU=class extends we{consumes(){return PU}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}},Qx=class extends MU{},PSe=class extends MU{},FJe=class extends MU{},kJe=class extends MU{};var sE;(function(t){t[t.Immediate=0]="Immediate",t[t.Faded=1]="Faded"})(sE||(sE={}));var eO;let Jo=eO=class extends Qx{constructor(t){super(t),this.produces=new Map([[le.ENVIRONMENT_OPAQUE,()=>!(this._atmosphere===null&&this._stars===null)],[le.ENVIRONMENT_TRANSPARENT,()=>this._atmosphere!==null]]),this._context=null,this._atmosphere=null,this._oldWeatherParameters=new Xz,this._newWeatherParameters=new Xz,this._fadedWeatherParameters=new Xz,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(this)}destroy(){this.removeHandles(),this.uninitializeRenderContext(),this.view?._stage!=null&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return this._atmosphere}get _atmosphereType(){return this.atmosphere!=null?this.atmosphere.type:wa.None}consumes(){return this._atmosphereType===wa.Realistic?ASe:PU}updateAnimation(t){return this._precipitation!=null&&this._precipitation.update(t)}get updating(){return this._stars!=null&&this._stars.updating||this._clouds!=null&&this._clouds.running}get weatherVisible(){return xe(this.view.state.camera.eye)-Wi(this.view.spatialReference).radius<=qg}get usedMemory(){return this._clouds?.usedMemory??0}get _stars(){const t=this.view,e=t.environment?.starsEnabled??!1,i=this._get("_stars");return e&&this._context!=null?i??new p_({view:t,requestRender:()=>this._setNeedsRender()}):($e(i),null)}get _precipitation(){const t=this._get("_precipitation");if(!this._precipitationEnabled||this._context==null)return $e(t),null;const e=this.view,i=this._context;return t!=null&&t.context===i?t:($e(t),new Db({context:i,view:e}))}get _clouds(){const t=this._get("_clouds");if(!this.weatherEnabled||this._context==null)return $e(t),null;if(t!=null)return t;const e=this.view,i=this._context;return $e(t),new $l({context:i,view:e,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const t=this._get("_cloudsComposition");if(!this.weatherEnabled||this._context==null)return $e(t),null;const e=this.view.state.viewingMode,i=this._context.renderContext.rctx,r=Wi(this.view.spatialReference).radius;return t!=null&&t.viewingMode===e&&t.planetRadius===r?t:($e(t),new $b({rctx:i,viewingMode:e,planetRadius:r,requestRender:()=>this._setNeedsRender()}))}get _fog(){const t=this._get("_fog");if(!this.weatherEnabled||this._context==null)return $e(t),null;if(t!=null)return t;const e=this.view,i=this._context,r=this._context.renderContext.rctx,n=this.view.state.viewingMode;return new Ib({context:i,view:e,rctx:r,viewingMode:n})}get weatherEnabled(){return!!this.view?.environmentManager?.weatherEnabled}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(t=null){this._context=t;const e=()=>this._setNeedsRender();this.addHandles([ne(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),i=>this._updateAtmosphere(i),Ji),ne(()=>this._stars,e),ne(()=>this._precipitation,e),ne(()=>this._clouds,()=>this._updateWeather(),Xt),ne(()=>this._fog,()=>this._updateFogHaze(),Xt),ne(()=>this.view.state.mode,()=>{this._setNeedsRender()},Zi),ne(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},Ji)])}uninitializeRenderContext(){this._context=null,this._atmosphere=$e(this._atmosphere),this._set("_stars",$e(this._stars)),this._set("_precipitation",$e(this._precipitation)),this._set("_clouds",$e(this._clouds)),this._set("_cloudsComposition",$e(this._cloudsComposition)),this._set("_fog",$e(this._fog))}prepareRender(t){t.bindParameters.cloudsFade.data=bXe(this._clouds)?this._clouds:null,this.view.viewingMode!=="local"&&t.bindParameters.cloudsFade.data?.cubeMap!=null&&(this._updateWeatherFading(t.bindParameters,t.time),t.bindParameters.cloudsFade.renderingStage===am.FINISHED&&this._clouds!=null&&this._clouds.coverage===0&&this._clouds.running===!1&&(this._clouds.destroyFrameBufferCube(),t.bindParameters.cloudsFade.data=null))}renderNode(t){switch(t.bindParameters.slot){case le.ENVIRONMENT_OPAQUE:this._stars!=null&&this._stars.render(t),this.atmosphere!=null&&(this.atmosphere.render(t,this.view?._stage?.renderer?.fullResolutionAtmosphere),this._cloudsComposition!=null&&t.bindParameters.cloudsFade.data!=null&&(this.weatherVisible&&this._clouds!=null&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(t)),t.bindParameters.cloudsFade.isFading&&this._context!=null&&t.bindParameters.cloudsFade.data?.cubeMap!=null&&this._context.requestRender());break;case le.ENVIRONMENT_TRANSPARENT:if(this.atmosphere!=null&&(this.atmosphere.renderHaze(t,this._weatherParameters.hazeAmount,this.view?._stage?.renderer?.fullResolutionAtmosphere),this._weatherParameters.fog.amount>0&&this._fog!=null&&this._fog.render(t,this._weatherParameters.fog),this._precipitation!=null)){const e=this.view.environment.weather;e.type!=="rainy"&&e.type!=="snowy"||this._precipitation.render(t,e.precipitation,e.type)}}}updateLightSources(t,e,i,r){if(this._context!=null){const n=this._context.renderContext;n.bindParameters.oldLighting.copyFrom(n.bindParameters.lighting),n.bindParameters.newLighting.noonFactor=e,n.bindParameters.newLighting.globalFactor=i,n.bindParameters.newLighting.set(t),r===sE.Faded||n.bindParameters.weatherFading?n.bindParameters.fadeLighting(0):n.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const t=this.weatherEnabled?this.view.environment.weather:null;return t==null?null:t.type==="rainy"||t.type==="snowy"?{type:t.type,weatherAdjustment:t.cloudCover,effect:t.precipitation}:{type:t.type,weatherAdjustment:t.type==="foggy"?t.fogStrength:t.cloudCover}}_updateWeatherFading(t,e){t.cloudsFade.updateFading(t.camera,this.view.state.mode,e,this.view.qualitySettings.fadeDuration),t.cloudsFade.updateParallax(t.camera),t.weatherFading&&(this._updateLighting(t),this._updateFogAtmoshpere(t))}_updateLighting(t){t.cloudsFade.fadeMode!==Rr.CROSS_FADE&&t.cloudsFade.fadeMode!==Rr.FADE_IN?t.fadeLighting(0):t.fadeLighting(t.cloudsFade.fadeFactor)}_updateFogAtmoshpere(t){t.cloudsFade.fadeMode!==Rr.CROSS_FADE&&t.cloudsFade.fadeMode!==Rr.FADE_IN?this._fadeWeather(0):this._fadeWeather(t.cloudsFade.fadeFactor)}_fadeWeather(t){const{_newWeatherParameters:e,_oldWeatherParameters:i}=this;t>=1?this._weatherParameters=e:(this._fadedWeatherParameters.lerp(i,e,t),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const t=this._weatherUpdateParameters;t!=null&&this._clouds!=null&&(this._clouds.applyPreset(va[t.type],t.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){this._context!=null&&this._context.requestRender()}_updateFogHaze(){const t=this._weatherUpdateParameters;if(this._fog==null||t==null||this._context==null)return;const e=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),t.type){case"foggy":this._newWeatherParameters.fog.strength=xt(3e-5,.005,t.weatherAdjustment**3),oe(this._newWeatherParameters.fog.color,Aoe),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=xt(4e-6,2e-4,(t.effect??0)**3),oe(this._newWeatherParameters.fog.color,UJe),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=xt(4e-6,2e-4,(t.effect??0)**3),oe(this._newWeatherParameters.fog.color,Aoe),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender()}e.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(t){const e=this._selectAtmosphereType(t);if(e!==wa.None&&this._context){if(!this._atmosphere||this._atmosphere.type!==e){this._atmosphere=$e(this._atmosphere);const i=this._getAtmosphereClass(e);i&&(this._atmosphere=new i(this.view,this._context))}}else this._atmosphere=$e(this._atmosphere);this._setNeedsRender()}_getAtmosphereClass(t){switch(t){case wa.Realistic:return Xse;case wa.Local:return dJe;case wa.Mars:return yJe;default:case wa.None:return null}}_selectAtmosphereType(t){const{enabled:e,viewingMode:i}=t;return!e||Um(this.view.spatialReference)?wa.None:i===Le.Local?wa.Local:this._context!=null&&Xse.isSupported(this._context)&&EE(this.view.spatialReference)?wa.Realistic:km(this.view.spatialReference)?wa.Mars:wa.None}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),stubGetAtmosphereClass:t=>{Ooe=eO.prototype._getAtmosphereClass,eO.prototype._getAtmosphereClass=t},restoreGetAtmosphereClass:()=>{eO.prototype._getAtmosphereClass=Ooe}}}};u([p({constructOnly:!0})],Jo.prototype,"view",void 0),u([p({readOnly:!0})],Jo.prototype,"atmosphere",null),u([p({readOnly:!0})],Jo.prototype,"_atmosphereType",null),u([p({type:Boolean,readOnly:!0})],Jo.prototype,"updating",null),u([p({readOnly:!0})],Jo.prototype,"weatherVisible",null),u([p()],Jo.prototype,"_context",void 0),u([p()],Jo.prototype,"_atmosphere",void 0),u([p({readOnly:!0})],Jo.prototype,"_stars",null),u([p({readOnly:!0})],Jo.prototype,"_precipitation",null),u([p({readOnly:!0})],Jo.prototype,"_clouds",null),u([p({readOnly:!0})],Jo.prototype,"_cloudsComposition",null),u([p({readOnly:!0})],Jo.prototype,"_fog",null),u([p({readOnly:!0})],Jo.prototype,"weatherEnabled",null),u([p({readOnly:!0})],Jo.prototype,"_precipitationEnabled",null),u([p({readOnly:!0})],Jo.prototype,"_weatherUpdateParameters",null),Jo=eO=u([M("esri.views.3d.environment.EnvironmentRenderer")],Jo);let Xz=class{constructor(){this.fog=new OZe,this.hazeAmount=1}copyFrom(e){this.fog.amount=e.fog.amount,this.hazeAmount=e.hazeAmount,this.fog.strength=e.fog.strength,oe(this.fog.color,e.fog.color)}lerp(e,i,r){this.fog.amount=xt(e.fog.amount,i.fog.amount,r),this.hazeAmount=xt(e.hazeAmount,i.hazeAmount,r),this.fog.strength=xt(e.fog.strength,i.fog.strength,r),Xi(this.fog.color,e.fog.color,i.fog.color,r)}};const UJe=Oe(.5,.5,.5),Aoe=Oe(1.5,1.5,1.5);let Ooe;var n4t=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function VM(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Roe,Poe,Moe,Rq={exports:{}};Rq.exports,Roe=Rq,Poe=function(){var t=Math.PI,e=Math.sin,i=Math.cos,r=Math.tan,n=Math.asin,s=Math.atan2,o=Math.acos,a=t/180,l=864e5,c=2440588,h=2451545,d={dec:0,ra:0};function f(P){return P.valueOf()/l-.5+c}function m(P){return new Date((P+.5-c)*l)}function y(P){return f(P)-h}var _=23.4397*a;function v(P,I){return s(e(P)*i(_)-r(I)*e(_),i(P))}function w(P,I){return n(e(I)*i(_)+i(I)*e(_)*e(P))}function x(P,I,V){return s(e(P),i(P)*e(I)-r(V)*i(I))}function T(P,I,V){return n(e(I)*e(V)+i(I)*i(V)*i(P))}function S(P,I){return a*(280.16+360.9856235*P)-I}function C(P){return a*(357.5291+.98560028*P)}function A(P){return a*(1.9148*e(P)+.02*e(2*P)+3e-4*e(3*P))}function R(P,I){return P+I+102.9372*a+t}function D(P,I){var V=C(P),q=R(V,A(V));return I||(I={dec:0,ra:0}),I.dec=w(q,0),I.ra=v(q,0),I}var N={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(P,I,V,q){var Y=a*-V,J=a*I,ee=y(P),me=D(ee,d),Me=S(ee,Y)-me.ra;return q||(q={azimuth:0,altitude:0}),q.azimuth=x(Me,J,me.dec),q.altitude=T(Me,J,me.dec),q}},k=[[-.83,"sunrise","sunset"]];N.addTime=function(P,I,V){k.push([P,I,V])};var B=9e-4;function L(P,I){return Math.round(P-B-I/(2*t))}function z(P,I,V){return B+(P+I)/(2*t)+V}function j(P,I,V){return h+P+.0053*e(I)-.0069*e(2*V)}function H(P,I,V){return o((e(P)-e(I)*e(V))/(i(I)*i(V)))}function X(P){var I=a*(134.963+13.064993*P),V=a*(93.272+13.22935*P),q=a*(218.316+13.176396*P)+6.289*a*e(I),Y=5.128*a*e(V),J=385001-20905*i(I);return{ra:v(q,Y),dec:w(q,Y),dist:J}}return N.getTimes=function(P,I,V){var q=a*-V,Y=a*I,J=L(y(P),q),ee=z(0,q,J),me=C(ee),Me=A(me),yt=R(me,Me),St=w(yt,0),ct=j(ee,me,yt);function vt(Et){return j(z(H(Et,Y,St),q,J),me,yt)}function je(Et){var $t=(e(Et)-e(Y)*e(St))/(i(Y)*i(St));return $t<-1?N.PolarException.MIDNIGHT_SUN:$t>1?N.PolarException.POLAR_NIGHT:N.PolarException.NORMAL}var he,At,ve,Fe,st,_t={solarNoon:m(ct),nadir:m(ct-.5),polarException:N.PolarException.NORMAL};for(he=0,At=k.length;he<At;he+=1)st=ct-((Fe=vt((ve=k[he])[0]*a))-ct),_t[ve[1]]=m(st),_t[ve[2]]=m(Fe);return _t.polarException=je(k[0][0]*a),_t},N.getMoonPosition=function(P,I,V){var q=a*-V,Y=a*I,J=y(P),ee=X(J),me=S(J,q)-ee.ra,Me=T(me,Y,ee.dec);return Me+=.017*a/r(Me+10.26*a/(Me+5.1*a)),{azimuth:x(me,Y,ee.dec),altitude:Me,distance:ee.dist}},N.getMoonFraction=function(P){var I=y(P),V=D(I),q=X(I),Y=149598e3,J=o(e(V.dec)*e(q.dec)+i(V.dec)*i(q.dec)*i(V.ra-q.ra)),ee=s(Y*e(J),q.dist-Y*i(J));return(1+i(ee))/2},N},(Moe=Poe())!==void 0&&(Roe.exports=Moe);const Ex=VM(Rq.exports),al={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};let DI=class{constructor(e,i){this.direct=e,this.ambient=i}};function zJe(t,e,i,r,n,s){ae(s.ambient.color,1,1,1),s.ambient.intensity=al.global.ambient,ae(s.direct.color,1,1,1),s.direct.intensity=al.global.direct;const o=e[2],a=_e((Math.abs(o)-al.local.altitude)/(al.global.altitude-al.local.altitude),0,1);let l;if(s.globalFactor=a,t!=null&&(l=Ex.getTimes(t,e[1],e[0])),a<1){let c;if(t!=null)c=WJe(t,l,r);else{const h=ISe(r);c={direct:{intensity:al.local.directAtNoon*h.direct,color:Oe(1,1,1)},ambient:{intensity:al.local.ambientAtNoon*h.ambient,color:Oe(1,1,1)},timeOfDay:"early afternoon"}}Xi(s.ambient.color,c.ambient.color,s.ambient.color,a),s.ambient.intensity=xt(c.ambient.intensity,s.ambient.intensity,a),Xi(s.direct.color,c.direct.color,s.direct.color,a),s.direct.intensity=xt(c.direct.intensity,s.direct.intensity,a),s.specularStrength=r==="rainy"||r==="snowy"||r==="foggy"?0:1,s.environmentStrength=r==="rainy"?.7:r==="snowy"||r==="foggy"?.75:1}s.noonFactor=t!=null?qJe(t,l):1,t!=null?BJe(t,e,i,s.direct.directionToLightSource):MSe(n,i,s.direct.directionToLightSource)}function MSe(t,e,i){e===Le.Global?ye(Qz,t.eye):ae(Qz,0,0,1),re(e9,t.viewForward,-1);const r=DN(e9,Qz),n=Math.max(r-2*t9,0),s=.85*n/(n+1),o=Math.max(t9,r-t9-s);Qu(Voe,-o,t.viewRight),ke(i,e9,Voe),ue(i,i,re(YJe,t.viewRight,XJe)),ye(i,i)}function BJe(t,e,i,r){const n=HJe,s=td(jJe);if(i===Le.Global)Ex.getPosition(t,0,0,n),ae(r,0,0,-1),PE(s,s,-n.azimuth),C6(s,s,-n.altitude),ke(r,r,s);else{const o=al.planarDirection,a=o.globalAngles,l=e[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=_e(c,0,1),c<1?(Ex.getPosition(t,e[1],e[0],n),n.azimuth=(1-c)*n.azimuth+c*a.azimuth,n.altitude=(1-c)*n.altitude+c*a.altitude):(n.azimuth=a.azimuth,n.altitude=a.altitude),ae(r,0,-1,0),ME(s,s,-n.azimuth),PE(s,s,-n.altitude),ke(r,r,s)}}function VJe(t,e){if(e===Le.Global)return!0;const i=al.planarDirection;return Math.abs(t)<i.localAltitude}const GJe=Oe(.5773502691896258,-.5773502691896258,.5773502691896258);let $Se=class{constructor(){this.ambient={color:Oe(1,1,1),intensity:.55},this.direct={color:Oe(1,1,1),intensity:.55,directionToLightSource:Qr(GJe)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const jJe=be(),HJe={azimuth:0,altitude:0};function qJe(t,e){const i=t.valueOf();let r,n;e.polarException===Ex.PolarException.MIDNIGHT_SUN?(r=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,n=r+432e6):e.polarException===Ex.PolarException.POLAR_NIGHT?(r=i-2,n=i-1):(r=e.sunrise.valueOf(),n=e.sunset.valueOf());const s=r+(n-r)/2;return 1-_e(Math.abs(i-s)/432e5,0,1)}function ISe(t){switch(t){case"disabled":case"sunny":case"cloudy":return new DI(1,1);case"rainy":return new DI(.4,1.2);case"snowy":return new DI(.5,1.3);case"foggy":return new DI(.2,1.6)}}function $oe(t,e){const i=(t[0]+t[1]+t[2])/3;t[0]+=(i-t[0])*e,t[1]+=(i-t[1])*e,t[2]+=(i-t[2])*e}const Zz=Oe(.01,.01,.01),Pq=Oe(1,.6,.5),Mq=Oe(1,.98,.98),Ioe=Oe(1,1,1),Jz=Oe(.8,.8,1),$q=Oe(.8,.8,1),Iq=Oe(.98,.98,1),Loe=Oe(1,1,1),Kz=pi(.01,al.local.ambientAtNight),Lq=pi(al.local.directAtTwilight,al.local.ambientAtTwilight),Dq=pi(.9*al.local.directAtNoon,al.local.ambientAtNoon),Doe=pi(al.local.directAtNoon,al.local.ambientAtNoon),Noe=Dq,Foe=Mq,koe=Iq,Uoe=Lq,zoe=Pq,Boe=$q;function WJe(t,e,i){const r=t.valueOf();let n,s;e.polarException===Ex.PolarException.MIDNIGHT_SUN?(n=r-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,s=n+432e6):e.polarException===Ex.PolarException.POLAR_NIGHT?(n=r-2,s=r-1):(n=e.sunrise.valueOf(),s=e.sunset.valueOf());const o=s-n,a=n+o/2,l=o/4,c=a-l,h=a+l,d=.06*o,f=n-d/2,m=n+d/2,y=s-d/2,_=s+d/2,v=Ge(),w=E(),x=E();let T="";if(r<f||r>_)gs(v,Kz),oe(w,Zz),oe(x,Jz),T="night";else if(r<m){const A=(r-f)/(m-f);zh(v,Kz,Lq,A),Xi(w,Zz,Pq,A),Xi(x,Jz,$q,A),T="sun rising"}else if(r<c){const A=(r-m)/(c-m);zh(v,Lq,Dq,A),Xi(w,Pq,Mq,A),Xi(x,$q,Iq,A),T="early morning"}else if(r<a){const A=(r-c)/(a-c);zh(v,Dq,Doe,A),Xi(w,Mq,Ioe,A),Xi(x,Iq,Loe,A),T="late morning"}else if(r<h){const A=(r-a)/(h-a);zh(v,Doe,Noe,A),Xi(w,Ioe,Foe,A),Xi(x,Loe,koe,A),T="early afternoon"}else if(r<y){const A=(r-h)/(y-h);zh(v,Noe,Uoe,A),Xi(w,Foe,zoe,A),Xi(x,koe,Boe,A),T="late afternoon"}else if(r<_){const A=(r-y)/(_-y);zh(v,Uoe,Kz,A),Xi(w,zoe,Zz,A),Xi(x,Boe,Jz,A),T="sun setting"}let S=0;switch(i){case"rainy":case"foggy":S=.8;break;case"snowy":S=.5}S>0&&($oe(w,S),$oe(x,S));const C=ISe(i);return{direct:{intensity:v[0]*C.direct,color:w},ambient:{intensity:v[1]*C.ambient,color:x},timeOfDay:T}}const Voe=be(),Qz=E(),e9=E(),YJe=E(),t9=.25,XJe=.2;let Bd=class extends Sn.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandlesKey="viewHandles",this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new xF,this._ambientLight=new CK,this._moonLight=new kTe,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView()}get _view(){return this._renderer?.view}get updating(){return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!this._renderer?.updating)}get weatherEnabled(){return this._view?.environment.atmosphereEnabled&&!this._disableWeather&&this._view?.state?.viewingMode===Le.Global&&EE(this._view.spatialReference)}get weatherVisible(){return this.weatherEnabled&&this._renderer?.weatherVisible}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new Jo({view:e});const i=()=>this._updateRenderParameters(),r=()=>this._cameraHandler();this.addHandles([ne(()=>e.environment.lighting,n=>this._updateLightingHandler(n),Zi),ne(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,n=>this._lightingDateHandler(n),Zi),ne(()=>e.stationary,()=>this._interactingStationaryHandler()),ne(()=>e.environment.lighting.directShadowsEnabled,i,Zi),ne(()=>e.qualitySettings.ambientOcclusion,i,Zi),ne(()=>e.qualitySettings.reflections,i,Zi),ne(()=>e.spatialReference,()=>this._resetReferencePosition(!0),Zi),ne(()=>e.environment.weather.type,()=>this._updateLighting(null,sE.Faded),Zi),ne(()=>this.weatherEnabled,()=>this._updateLighting(null,sE.Faded),Zi),ne(()=>e.viewingMode,()=>this._resetReferencePosition(!0),Ji),ne(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,n=>this._updateCameraTracking(n),Ji),ne(()=>e.state.camera,r,Ji),ne(()=>this.disableQueries,r)],this._viewHandlesKey),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this.removeHandles(this._viewHandlesKey),this._resetReferencePosition(),this._renderer=$e(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const i=this._view.environment.lighting;i?.type!=="virtual"&&(i.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const i=this._view.environment.lighting;if(i?.type!=="virtual"){if(e){if(!i.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const r=this._view.spatialReference;if(!Ev(r)){const n=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(n))return void this._requestReferencePositionUpdate(n)}if(this._preupdateTracking(e),this._referencePosWGS84Comparable!=null){const n=cse(this._referencePosWGS84Comparable,Goe);n!=null&&(i.autoUpdate(null,n),this._trackingEnabled&&(i.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const i=this._view;if(!i.ready)return;const r=i.stateManager.camera;r&&(this._cameraHandlerClientSide(r,e)||this._cameraHandlerServerSide(r))}_cameraHandlerClientSide(e,i){const r=EE(this._view.spatialReference);if(r&&!Ev(this._view.spatialReference))return this._view.environment.lighting.type==="virtual"&&this._updateLighting(),!1;const n=e.position;return this._referencePosWGS84Comparable==null&&(this._referencePosWGS84Comparable=E()),r?SWe(n,this._referencePosWGS84Comparable):ae(this._referencePosWGS84Comparable,n.longitude??0,n.latitude??0,n.z??0),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,i)||this._updateLighting(i),!0}_cameraHandlerServerSide(e){const i=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(i))&&this._requestReferencePositionUpdate(i,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=(i.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e,i=sE.Immediate){const r=this._view;e=e||(r.environment.lighting.type==="virtual"?null:r.environment.lighting.date);const n=this._referencePosWGS84Comparable,s=n!=null?ZJe:JJe,o=this.weatherVisible?r.environment.weather.type:"disabled";n!=null?zJe(e,n,r.state.viewingMode,o,r.state.camera,s):r.environment.lighting.type==="virtual"&&MSe(r.state.camera,r.state.viewingMode,s.direct.directionToLightSource);const a=this._mainLight,l=s.direct;re(a.intensity,l.color,l.intensity*Math.PI),oe(a.direction,l.directionToLightSource),a.specularStrength=s.specularStrength,a.environmentStrength=s.environmentStrength;const c=this._ambientLight;re(c.intensity,s.ambient.color,s.ambient.intensity);const h=this._moonLight;Xi(h.intensity,QJe,eKe,s.globalFactor);const d=(1-.5*s.globalFactor)*(1-.4*s.noonFactor*(1-s.globalFactor));re(h.intensity,h.intensity,d),oe(h.direction,l.directionToLightSource),this._renderer.updateLightSources([a,c,h],s.noonFactor,s.globalFactor,i),this._updateRenderParameters()}_autoUpdateTimezone(e,i=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||e==null)return!1;const r=KJe;r.setTime((i||this._view.environment.lighting.date).getTime());const n=cse(e,Goe);if(n==null)return!1;let s=this._view.environment.lighting.positionTimezoneInfo;if(s.autoUpdated){if(s.hours===n.hours&&s.minutes===n.minutes&&s.seconds===n.seconds)return!1}else s=n;const o=r.getUTCHours()-(n.hours-s.hours),a=r.getUTCMinutes()-(n.minutes-s.minutes),l=r.getUTCSeconds()-(n.seconds-s.seconds);return r.setUTCHours(o),r.setUTCMinutes(a),r.setUTCSeconds(l),!i&&this._view.environment.lighting.autoUpdate(r,n)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const i=this._referencePosWGS84Comparable==null||VJe(this._referencePosWGS84Comparable[2],this._view.state.viewingMode);e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&i,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible,qualitySettings:this._view.qualitySettings})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,i=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!i,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const r=this._referencePosUpdateQuery=XR(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===r){const s=()=>this._referencePosUpdateQuery!==r;return this._doReferencePositionUpdateQuery(s)}}).catch(s=>{s.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===r&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),n=this._referencePosUpdateTimer=XR(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===n&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const i=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(i[0])&&!isNaN(i[1])){const r=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=i[0],this._referencePosWGS84Comparable[1]=i[1],this._referencePosWGS84Comparable[2]=r):this._referencePosWGS84Comparable=[i[0],i[1],r],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let i=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(i*=this._view.mapCoordsHelper.unitInMeters),i>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(i){e._referencePointUpdateInterval=i},set referencePointUpdateDistThreshold(i){e._referencePointUpdateDistThreshold=i},set referencePosUpdateTimer(i){e._referencePosUpdateTimer=i},set referencePointUpdateDelay(i){e._referencePointUpdateDelay=i},set disableWeather(i){e._disableWeather=i}}}};u([p({type:Boolean,readOnly:!0})],Bd.prototype,"updating",null),u([p()],Bd.prototype,"disableQueries",void 0),u([p()],Bd.prototype,"_disableWeather",void 0),u([p()],Bd.prototype,"weatherEnabled",null),u([p()],Bd.prototype,"weatherVisible",null),u([p()],Bd.prototype,"referencePositionWGS84Comparable",null),u([p()],Bd.prototype,"_renderer",void 0),u([p()],Bd.prototype,"_referencePosWGS84Comparable",void 0),Bd=u([M("esri.views.3d.environment.SceneViewEnvironmentManager")],Bd);const ZJe=new $Se,JJe=new $Se,KJe=new Date,Goe={hours:0,minutes:0,seconds:0},QJe=Oe(.22,.22,.33),eKe=Oe(.22,.22,.22);var Ur;(function(t){t[t.NONE=0]="NONE",t[t.TILT=1]="TILT",t[t.ALTITUDE=2]="ALTITUDE",t[t.DISTANCE=4]="DISTANCE",t[t.COLLISION=8]="COLLISION",t[t.ALL=15]="ALL",t[t.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(Ur||(Ur={}));var Qt;(function(t){t[t.NONE=0]="NONE",t[t.ZOOM=1]="ZOOM",t[t.TUMBLE=2]="TUMBLE",t[t.LOOK_AROUND=3]="LOOK_AROUND",t[t.PAN=4]="PAN",t[t.ASCEND=5]="ASCEND"})(Qt||(Qt={}));var wo;(function(t){t[t.TUMBLE=0]="TUMBLE",t[t.LOOK_AROUND=1]="LOOK_AROUND"})(wo||(wo={}));function CP(t,e){return(t&e)!=0}function OF(t,e,i,r,n,s){t!==0&&(i?(s.min=Math.min(s.min,e),s.max=Math.max(s.max,e)):r!=null?(s.min-=Math.max(0,(e-s.min)*(1-r)),s.max+=Math.max(0,(e-s.max)*(1-r))):n&&(s.min-=Math.max(0,e-s.min-n),s.max+=Math.max(0,e-s.max-n)))}const kv={selection:Ur.NONE,interactionType:Qt.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:wo.TUMBLE};function LSe(t,e,i,r){return e=e||t.viewForward,oe(r,e),re(r,r,Math.sign(ge(e,i))),r}function tKe(t,e,i,r){return oKe(t,e,i,nKe(r,e,i,!0))}function iKe(t,e,i,r){const n=ge(i,de(t,r,e));return ue(t,e,re(t,i,n))}const rKe={dir:E(),len:0,clip:Ge()};function nKe(t,e,i,r){const n=rKe;return t?(i&&r&&(n.len=Mr(e,i)),oe(n.dir,t)):r?(n.len=Mr(e,i),de(n.dir,i,e),re(n.dir,n.dir,1/n.len)):(de(n.dir,i,e),ye(n.dir,n.dir)),n}function sKe(t,e,i){const r=ge(t,i.dir),n=-hr(t,e);if(n<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return n>0;if((n<0||r<0)&&!(n<0&&r<0))return!0;const s=n/r;return r>0?s<i.clip[1]&&(i.clip[1]=s):s>i.clip[0]&&(i.clip[0]=s),i.clip[0]<=i.clip[1]}function oKe(t,e,i,r){r.clip[0]=0,r.clip[1]=i?r.len:Number.MAX_VALUE;for(let n=0;n<t.length;n++)if(!sKe(t[n],e,r))return!1;return!0}function aKe(t,e,i=kv){const r=UK(t,e,i);if(r===0)return!1;const n=t.renderCoordsHelper,s=n.getAltitude(e.eye)+r,o=LSe(e,i.interactionDirection,uKe(t,e,Math.sign(r),fKe),pKe),a=oe(mKe,e.viewForward),l=n.intersectInfiniteManifold(th(e.eye,o),s,i9);return e.eye=l??n.setAltitude(i9,s,e.eye),e.center=iKe(i9,e.eye,a,e.center),!0}function UK(t,e,i=kv){if(!lKe(t,i)||!t.state.constraints.altitude)return 0;const r=hKe(t.state.constraints.altitude,dKe);cKe(t,i,r);const n=t.renderCoordsHelper.getAltitude(e.eye),s=_e(n,r.min,r.max)-n;return Math.abs(s)<=1e-6?0:s}function lKe(t,e){const i=t.state.constraints.altitude;return!(!t.state.isGlobal||!i)&&(e.interactionType!==Qt.TUMBLE||!CP(e.selection,Ur.TILT))}function cKe(t,e,i){const r=e.interactionType;if(r===Qt.NONE)return;const{min:n,max:s}=i,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=r===Qt.TUMBLE||r===Qt.ZOOM,c=UK(t,o),h=c===0?0:t.renderCoordsHelper.getAltitude(o.eye);i.min=n,i.max=s,OF(c,h,l,a,.05*h,i)}function uKe(t,e,i,r){return t.renderCoordsHelper.worldUpAtPosition(e.eye,r),re(r,r,i),r}function hKe(t,e){return e.min=t.min,e.max=t.max,e}const dKe={min:0,max:0},pKe=E(),fKe=E(),mKe=E(),i9=E();function zK(t,e,i=kv){if(!t.state.isLocal)return 0;const r=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;NI.min=0,NI.max=r,yKe(t,i,NI);const n=BK(t,e),s=NI.max-n;return s>=-1e-6?0:s}function gKe(t,e,i=kv){const r=zK(t,e,i);if(r===0)return!1;const n=t.pointsOfInterest.surfaceOrigin;if(!n.renderLocation)return!1;const s=BK(t,e)+r,o=oe(vKe,e.eye),a=LSe(e,i.interactionDirection,_Ke(e,n.renderLocation,xKe),wKe);if(!e1(Ebe(n.renderLocation,s),th(e.eye,a),FI))return!1;e.eye=FI;const l=de(bKe,e.eye,o);e.center=ue(FI,e.center,l);const c=t.renderCoordsHelper.getAltitude(e.center),h=t.renderCoordsHelper.intersectInfiniteManifold(e.ray,c,FI);return h!=null&&(e.center=h),!0}function yKe(t,e,i){const r=e.interactionType;if(r===Qt.NONE)return;const{min:n,max:s}=i,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=r===Qt.ZOOM||r===Qt.PAN,c=zK(t,o),h=c===0?0:BK(t,o);i.min=n,i.max=s,OF(c,h,l,a,.05*h,i)}function BK(t,e){const i=t.pointsOfInterest.surfaceOrigin;return i.renderLocation?Mr(e.eye,i.renderLocation):0}function _Ke(t,e,i){return Fy(i,t.eye,e)}const NI={min:0,max:0},vKe=E(),bKe=E(),wKe=E(),xKe=E(),FI=E();function UC(t,e,i=Wh.EYE){const r=t.state.constraints;if(!r.collision.enabled)return!1;const n=pU(t,e.eye),s=t.renderCoordsHelper.getAltitude(e.eye),o=n+r.collision.elevationMargin;if(s>=o)return!1;const a=xe(e.eye);if(de(kI,e.center,e.eye),e.eye=t.renderCoordsHelper.setAltitude(TKe,o,e.eye),i===Wh.EYE_AND_CENTER)e.center=ue(kI,e.eye,kI);else if(i===Wh.EYE_AND_CENTER_SCALE){const l=(a-s+o)/a;e.center=re(kI,e.center,l)}return!0}var Wh;(function(t){t[t.EYE=0]="EYE",t[t.EYE_AND_CENTER=1]="EYE_AND_CENTER",t[t.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(Wh||(Wh={}));const kI=E(),TKe=E();function Uv(t,e,i){t.worldUpAtPosition(e,joe),de(r9,i,e);const r=xe(r9);return r===0?0:Ys(ge(r9,joe)/r)}const joe=E(),r9=E();function DSe(t,e,i=kv,r=!0){wA.eyeCenterDistance=0,wA.requiresTwoSteps=!1;const n=VK(t,e,i,void 0,wA);if(n===0)return!1;switch(Qu(UI,-n,e.viewRight),i.tiltMode){case wo.LOOK_AROUND:ke(w0,e.viewForward,UI),re(w0,w0,wA.eyeCenterDistance),e.center=ue(k_,e.eye,w0);break;case wo.TUMBLE:de(w0,e.center,e.eye),ke(w0,w0,UI),e.eye=de(k_,e.center,w0);break;default:i.tiltMode}return e.up=ke(k_,e.up,UI),!wA.requiresTwoSteps||!r||DSe(t,e,i,!1)}function VK(t,e,i=kv,r=kv,n){if(!t.state.constraints.tilt)return 0;const s=e.distance,o=t.state.constraints.tilt(s,IKe);return $Ke(t,i,o),r.interactionType===Qt.TUMBLE&&CP(r.selection,Ur.ALTITUDE)&&NSe(t,r.interactionStartCamera,o),i.tiltMode===wo.LOOK_AROUND||r.tiltMode===wo.LOOK_AROUND?EKe(t,e,o,n):SKe(t,e,o)}function SKe(t,e,i){const r=Uv(t.renderCoordsHelper,e.center,e.eye),n=r-_e(r,i.min,i.max);return AP(n)?n:0}function EKe(t,e,i,r){switch(r&&(r.requiresTwoSteps=!1),t.viewingMode){case"global":return AKe(t,e,i,r);case"local":return CKe(t,e,i,r)}}function CKe(t,e,i,r){const n=Uv(t.renderCoordsHelper,e.center,e.eye),s=_e(n,i.min,i.max),o=n-s;if(!AP(o))return 0;if(r){const a=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=t.renderCoordsHelper.getAltitude(e.eye)-a,c=Math.cos(s);Math.abs(c)>1e-4?r.eyeCenterDistance=l/c:r.eyeCenterDistance=e.distance}return o}function AKe(t,e,i,r){const n=OKe(t,e,LKe),s=_e(n.tiltAtCenter,i.min,i.max);if(!AP(n.tiltAtCenter-s))return 0;let o,a;return n.centerIsOnSurface?(o=RKe(n),a=PKe(n,o)):(o=n.constraints.clampTilt(n.eyeCenterDistance,n.tiltAtCenter),r&&o<Math.PI/2&&(r.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=MKe(n,o)),r&&(r.eyeCenterDistance=Nq(n,o)),a}function OKe(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,n=r+Wi(t.spatialReference).radius,s=t.renderCoordsHelper.intersectManifold(e.ray,r,k_);return i.eyeCenterDistance=e.distance,i.centerIsOnSurface=!1,s!=null?(i.eyeCenterDistance=Mr(e.eye,s),i.tiltAtCenter=Uv(t.renderCoordsHelper,s,e.eye),i.centerIsOnSurface=!0):t.state.isLocal?i.tiltAtCenter=Uv(t.renderCoordsHelper,e.center,e.eye):(IC(eU(tU,n),e.ray,k_),i.eyeCenterDistance=Mr(e.eye,k_),i.tiltAtCenter=Ys(-ge(e.viewForward,ye(k_,k_)))),i.radius=n,i.eyeRadius=xe(e.eye),i.constraints=t.state.constraints,i}function AP(t){return Math.abs(t)>1e-9}function RKe(t){const{constraints:e,eyeCenterDistance:i,tiltAtCenter:r}=t;let n=r,s=e.clampTilt(i,r);const o=Nq(t,s);if(e.clampTilt(o,r)===s)return s;let a=0;for(;a<10&&AP(s-n);){const l=(n+s)/2,c=Nq(t,l);AP(e.clampTilt(c,l)-l)?n=l:s=l,a++}return s}function Nq(t,e){if(!t.centerIsOnSurface)return t.eyeCenterDistance;const i=Math.PI-_e(e,0,Math.PI),r=Qh(t.radius/t.eyeRadius*Math.sin(i)),n=Math.PI-i-r,s=Math.sin(n)/Math.sin(i);if(t.eyeRadius<t.radius&&s>1){const o=Math.PI-r,a=Math.PI-i-o;return Math.sin(a)/Math.sin(i)*t.eyeRadius}return s*t.eyeRadius}function PKe(t,e){const i=Qh(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter)),r=Qh(t.radius/t.eyeRadius*Math.sin(e));return t.eyeRadius>t.radius?i-r:r-i}function MKe(t,e){return t.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function $Ke(t,e,i){if(e.interactionType===Qt.NONE)return;const{interactionStartCamera:r,interactionFactor:n}=e;if(!r)return;const{min:s,max:o}=i,a=VK(t,r,kv,e),l=a===0?0:Uv(t.renderCoordsHelper,r.center,r.eye);i.min=s,i.max=o,e.interactionType===Qt.TUMBLE?(CP(e.selection,Ur.ALTITUDE)&&NSe(t,r,i),OF(a,l,!0,n,Hoe,i)):OF(a,l,!1,n,Hoe,i)}function NSe(t,e,i){const r=t.state.constraints;if(t.state.isLocal||!r.altitude||!e)return;const n=na(e.center),s=Math.sqrt(n),o=e.distance,a=Wi(t.spatialReference).radius,l=r.altitude.min+a,c=r.altitude.max+a,h=(l*l-o*o-n)/(-2*s*o),d=(c*c-o*o-n)/(-2*s*o);i.min=Math.max(i.min,Math.min(Math.PI-Ys(d),i.max)),i.max=Math.min(i.max,Math.PI-Ys(h))}const w0=E(),UI=be(),k_=E(),Hoe=Dt(5),IKe={min:0,max:0},LKe={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},wA={eyeCenterDistance:0,requiresTwoSteps:!1},DKe=t=>t,$U=t=>t*t,GK=t=>1-$U(1-t),NKe=t=>t<.5?$U(2*t)/2:(GK(2*(t-.5))+1)/2,jK=t=>t*t*t,FSe=t=>1-jK(1-t),kSe=t=>t<.5?jK(2*t)/2:(FSe(2*(t-.5))+1)/2,HK=t=>t*t*t*t,USe=t=>1-HK(1-t),FKe=t=>t<.5?HK(2*t)/2:(USe(2*(t-.5))+1)/2,qK=t=>t*t*t*t*t,zSe=t=>1-qK(1-t),kKe=t=>t<.5?qK(2*t)/2:(zSe(2*(t-.5))+1)/2,WK=t=>1-Math.cos(t*Math.PI/2),BSe=t=>1-WK(1-t),UKe=t=>t<.5?WK(2*t)/2:(BSe(2*(t-.5))+1)/2,YK=t=>2**(10*(t-1)),GM=t=>1-YK(1-t),zKe=t=>t<.5?YK(2*t)/2:(GM(2*(t-.5))+1)/2,XK=t=>-(Math.sqrt(1-t*t)-1),VSe=t=>1-XK(1-t),BKe=t=>t<.5?XK(2*t)/2:(VSe(2*(t-.5))+1)/2;function pd(t){const e=2*(t-Math.sqrt((t-1)*t)),i=e/2/t;return r=>r<i?t*r*r:e*r-e+1}function fd(t,e){return(i,r)=>i<e?e*t(i/e,r):1-t((1-i)/(1-e),r)*(1-e)}const VKe=fd(pd(1),1),GKe=fd(pd(1),0),GSe=fd(pd(1),.5),jKe=fd(pd(2),1),HKe=fd(pd(2),0),qKe=fd(pd(2),.5),WKe=fd(pd(3),1),YKe=fd(pd(3),0),XKe=fd(pd(3),.5),ZKe=fd(pd(4),1),JKe=fd(pd(4),0),KKe=fd(pd(4),.5),QKe={linear:DKe,"in-quad":$U,"out-quad":GK,"in-out-quad":NKe,"in-coast-quad":VKe,"out-coast-quad":GKe,"in-out-coast-quad":GSe,"in-cubic":jK,"out-cubic":FSe,"in-out-cubic":kSe,"in-coast-cubic":jKe,"out-coast-cubic":HKe,"in-out-coast-cubic":qKe,"in-quart":HK,"out-quart":USe,"in-out-quart":FKe,"in-coast-quart":WKe,"out-coast-quart":YKe,"in-out-coast-quart":XKe,"in-quint":qK,"out-quint":zSe,"in-out-quint":kKe,"in-coast-quint":ZKe,"out-coast-quint":JKe,"in-out-coast-quint":KKe,"in-sine":WK,"out-sine":BSe,"in-out-sine":UKe,"in-expo":YK,"out-expo":GM,"in-out-expo":zKe,"in-circ":XK,"out-circ":VSe,"in-out-circ":BKe};function Xn(t,e,i=rQe,r=e){r!==e&&r.copyFrom(e),r.computeUp(t.state.viewingMode);let n=!1;for(let a=0;a<nQe;a++){let l=0;for(const c of iQe)if(CP(i.selection,c.type)){const h=Math.abs(c.error(t,r,i));c.apply(t,r,i)&&(n=!0,l+=h)}if(l===0)break}const s=CP(i.selection,Ur.COLLISION),o=eQe(i.interactionType,t);return s&&UC(t,r,o)&&(n=!0),n&&r.computeUp(t.state.viewingMode),n}function eQe(t,e){switch(t){case Qt.PAN:return Wh.EYE_AND_CENTER;case Qt.ASCEND:return e.state.isGlobal?Wh.EYE_AND_CENTER_SCALE:Wh.EYE_AND_CENTER;default:return Wh.EYE}}function hp(t){const e=Math.min(1,t/150);return kSe(e)}function tQe(t,e,i){return VK(t,e,i)*e.distance}const iQe=[{type:Ur.TILT,error:tQe,apply:DSe},{type:Ur.ALTITUDE,error:UK,apply:aKe},{type:Ur.DISTANCE,error:zK,apply:gKe}],rQe={selection:Ur.ALL,interactionType:Qt.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:wo.TUMBLE},nQe=5,eu=E(),sc=E(),x0=E(),pa=E(),S1=E(),sQe=E(),tu={upward:Oe(0,0,1),forward:Oe(0,1,0),sideway:Oe(1,0,0)},qoe=nn();let Woe=class{constructor(e=Le.Global){this.viewingMode=e,this.center=E(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=Qr(tu.forward)}pixelsPerPanAtZoom(e){return this.size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this.size/2/(this._zoomToPanScale*e)}pixelsPerRotateAtZoom(){const e=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/e}compareTo(e,i){if(i||(i={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===Le.Global){const s=(xe(this.center)+xe(e.center))/2;i.pan=DN(this.center,e.center)*s}else i.pan=Mr(this.center,e.center);let r=Math.abs(e.yaw-this.yaw);r>=Math.PI&&(r=2*Math.PI-r);const n=Math.abs(e.pitch-this.pitch);return i.rotate=Math.max(r,n),i.sourceZoom=this.distance,i.targetZoom=e.distance,i}interpolate(e,i,r){this.viewingMode===Le.Global?T7e(e.center,i.center,r.pan,this.center):Xi(this.center,e.center,i.center,r.pan),this.distance=isFinite(i.distance)?xt(e.distance,i.distance,r.zoom):e.distance,this.pitch=xt(e.pitch,i.pitch,r.rotate);let n=e.yaw;const s=i.yaw;Math.abs(s-n)>=Math.PI&&(n+=2*(n<s?1:-1)*Math.PI),this.yaw=xt(n,s,r.rotate)}copyFrom(e){oe(this.center,e.center),this.pitch=e.pitch,this.yaw=e.yaw,this.distance=e.distance,oe(this.lookAtDirection,e.lookAtDirection),this.size=e.size,this.copyFromCommon(e),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const i=this._lookAtOrientation(e.center,qoe);oe(this.center,e.center),de(pa,e.center,e.eye),Nc(pa,pa,i),Nc(S1,e.up,i),this.distance=xe(pa),this.distance!==0&&(pa[0]/=this.distance,pa[1]/=this.distance,pa[2]/=this.distance),this.pitch=this._eyeUpToPitch(pa),this.yaw=this._eyeUpToYaw(pa,S1),this.size=Math.sqrt(e.width*e.width+e.height*e.height),this.copyFromCommon(e)}copyFromCommon(e){this.fov=e.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(e){const i=this._lookAtOrientation(this.center,qoe);nd(i,i),this._axisAngleVec3(tu.sideway,this.pitch-Math.PI/2,tu.forward,pa),this._axisAngleVec3(tu.upward,this.yaw,pa),this._axisAngleVec3(tu.sideway,this.pitch-Math.PI/2,tu.upward,S1),this._axisAngleVec3(tu.upward,this.yaw,S1),re(pa,pa,this.distance),Nc(pa,pa,i),Nc(S1,S1,i),e.center=this.center,e.eye=de(pa,this.center,pa),e.up=S1}_axisAngleVec3(e,i,r,n=r){const s=Math.cos(i),o=Math.sin(i);return re(eu,r,s),lt(sc,e,r),re(sc,sc,o),re(x0,e,(1-s)*ge(e,r)),ue(n,ue(n,eu,sc),x0)}_lookAtOrientation(e,i=nn()){return this._upAtLookAt(e,x0),lt(eu,this.lookAtDirection,x0),ye(eu,eu),eu[0]===0&&eu[1]===0&&eu[2]===0&&oe(eu,tu.sideway),lt(sc,x0,eu),ye(sc,sc),i[0]=eu[0],i[1]=sc[0],i[2]=x0[0],i[3]=eu[1],i[4]=sc[1],i[5]=x0[1],i[6]=eu[2],i[7]=sc[2],i[8]=x0[2],i}_upAtLookAt(e,i){return this.viewingMode===Le.Local?oe(i,tu.upward):ye(i,e)}_eyeUpToPitch(e){return Math.PI-DN(tu.upward,e)}_eyeUpToYaw(e,i){const r=sQe;return Math.abs(i[2])<.5?(oe(r,i),e[2]>0&&re(r,r,-1)):oe(r,e),lt(sc,r,tu.upward),ye(sc,sc),DN(tu.sideway,sc,tu.upward)}};const RF={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};let oQe=class jSe{constructor(e){this._createCamera=e,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:RF.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new jSe(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,i,r){this.source!==e&&this.source.copyFrom(e),this.target!==i&&this.target.copyFrom(i),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=r.desiredScreenFlow!=null?r.desiredScreenFlow:RF.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const i=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/i}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}},aQe=class{constructor(){this.segments=[]}get time(){return this.segments.reduce((e,i)=>e+i.time,0)}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1),e*=this.time;let r=0,n=0;const s=this.definition;for(let o=0;o<this.segments.length;o++){const a=this.segments[o],l=a.definition;if(e<=a.time||o===this.segments.length-1){if(i=this.segmentInterpolateComponentsAt(a,a.time===0?0:e/a.time,i),s.hasPan&&!isNaN(i.pan)&&isFinite(s.compared.pan)?i.pan=(r+l.compared.pan*i.pan)/s.compared.pan:i.pan=1,s.hasRotate&&!isNaN(i.rotate)&&isFinite(s.compared.rotate)?i.rotate=(n+l.compared.rotate*i.rotate)/s.compared.rotate:i.rotate=1,s.hasZoom&&!isNaN(i.zoom)&&isFinite(l.compared.targetZoom)){const c=i.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,h=this.segments[0].definition.compared.sourceZoom,d=this.segments[this.segments.length-1].definition.compared.targetZoom;i.zoom=(c-h)/(d-h)}else i.zoom=1;return i}e-=a.time,r+=l.compared.pan,n+=l.compared.rotate}}segmentInterpolateComponentsAt(e,i,r){return e.interpolateComponentsAt(i,r)}},n9=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,i=e.compared,r=i.sourceZoom,n=i.targetZoom;this._zoomSign=r>n?1:-1,this._panPixelsAtSource=i.pan*e.source.pixelsPerPanAtZoom(r);const s=(e.source.pixelsPerRotateAtZoom(r)+e.target.pixelsPerRotateAtZoom(n))/2;this._rotatePixels=i.rotate*s}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom,{hasZoom:r,hasPan:n,hasRotate:s}=this.definition;let o=0,a=0;r&&(n&&(o=(i/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),s&&(a=this._zoomSign*(Math.log(e/i)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(r&&n&&s){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(r&&n){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(r&&s){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(n&&s){const c=this._panPixelsAtSource/this._rotatePixels,h=1+c;this._panPixelFlow=c/h*l,this._rotatePixelFlow=1/h*l}else n?this._panPixelFlow=l:r?this._zoomPixelFlow=l:s&&(this._rotatePixelFlow=l);this._time=s?this.rotateTime:r?this.zoomTime:n?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,i=e*this._panPixelsAtSource;return Math.log(i*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const i=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom;return(i*(i/r)**-e-i)/(r-i)}return e}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const i=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(i*e*this._time)-1))/(i*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1);const r=this._interpolateComponentsZoom(e),n=this._interpolateComponentsPan(e),s=this._interpolateComponentsRotate(e);return i?(i.zoom=r,i.pan=n,i.rotate=s):i={zoom:r,pan:n,rotate:s},i}};function lQe(t,e,i){const r=e-t.compared.sourceZoom,n=t.halfWindowPanAtZoom(r);return-t.halfWindowSize*(i.ascensionFactor*Math.LN2*t.compared.pan+n)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*n)}function cQe(t,e,i){const r=1/e,n=Math.log(t.compared.sourceZoom*r),s=1/t.desiredPixelFlow,o=1/Math.LN2,a=e-t.compared.sourceZoom,l=1/a,c=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(a))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*r*s*o*l*c-t.halfWindowSize*n*s*o*l+t.halfWindowSize*n*s*o*c/(a*a)}function uQe(t,e,i){const r=e-t.compared.sourceZoom,n=1/r,s=1/e,o=Math.log(t.compared.sourceZoom*s),a=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(r))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*n*(-2*n*s*a+2*n*o+2*s-2*o*a/(r*r)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function hQe(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function dQe(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function pQe(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function fQe(t,e,i){return-t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function mQe(t,e,i){return t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function gQe(t,e,i){return-2*t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function yQe(t,e,i){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function _Qe(t,e,i){const r=Math.log(e/t.compared.targetZoom),n=1/t.desiredPixelFlow,s=1/Math.LN2,o=-e+t.compared.targetZoom,a=1/o,l=(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*r*n*s*a+t.halfWindowSize*r*n*s*l/(o*o)+t.halfWindowSize*n*s*a*l/e}function vQe(t,e,i){const r=e-t.compared.targetZoom,n=1/r,s=1/e,o=Math.log(e/t.compared.targetZoom),a=(t.halfWindowPanAtZoom(e)+i.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*n*(-2*n*s*a-2*n*o+2*s+2*o*a/(r*r)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function bQe(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function wQe(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function xQe(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function TQe(t){const e=Math.LN2*t.compared.pan,i=t.compared.sourceZoom-t.compared.targetZoom,r=t.halfWindowPanAtZoom(i),n=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*r);return t.compared.sourceZoom<=t.compared.targetZoom?n*(e-r):n*(e+r)}function SQe(t,e){let i=EQe(t,e);const r={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},n=r.ascensionFactor===0,s=r.descensionFactor===0,o=n?hQe:lQe,a=n?dQe:cQe,l=n?pQe:uQe,c=s?bQe:yQe,h=s?wQe:_Qe,d=s?xQe:vQe,f=S=>o(t,S,r)+fQe(t,S,r)+c(t,S,r),m=S=>a(t,S,r)+mQe(t,S,r)+h(t,S,r),y=S=>l(t,S,r)+gQe(t,S,r)+d(t,S,r);let _=f(i);const v=TQe(t);let w;const x=e.maximumIterations||20,T=e.maximumDistance!=null?e.maximumDistance:1/0;for(w=0;w<x;w++){const C=(m(i)+1e-6)/y(i);if(isNaN(C)||i>=T&&C<0){if(!isFinite(T))return null;i=T,_=f(i);break}if(i-=C,i<t.compared.sourceZoom||i<t.compared.targetZoom)return null;const A=f(i);if(Math.abs(A-_)/_<=.005)break;_=A}return _>v*(1-.3)||i<t.compared.sourceZoom||i<t.compared.targetZoom?null:i}function EQe(t,e){const i=Math.max(t.compared.sourceZoom,t.compared.targetZoom),r=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return r<i?e.maximumDistance!=null?i+(e.maximumDistance-i)/2:1.5*i:e.maximumDistance?Math.min(e.maximumDistance,r):r}let CQe=class extends aQe{constructor(e,i){super(),this._preallocSegments=[new n9,new n9,new n9],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,i)}update(e,i){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();let r=null;i?.apex&&(r=SQe(e,i.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,r==null?this._updateWithoutApex():this._updateWithApex(r,i?.apex)}segmentInterpolateComponentsAt(e,i,r){return r=e.interpolateComponentsAt(i,r),e===this._ascensionSegment?r.zoom=GK(r.zoom):e===this._descensionSegment&&(r.zoom=$U(r.zoom)),r}_updateWithApex(e,i){const[r,n,s]=this._preallocSegments,o=i?.ascensionFactor??.5,a=Math.min(1-o,i?.ascensionFactor!=null&&i.descensionFactor!=null?i.descensionFactor:.5),l=1-o-a;r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.compared.targetZoom=e,r.definition.compared.pan=this.definition.compared.pan*o,r.definition.compared.rotate=this.definition.compared.rotate*o,r.update(),this._ascensionSegment=r,this.segments.push(r),l>0&&(n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.copyFrom(this.definition),n.definition.compared.sourceZoom=e,n.definition.compared.targetZoom=e,n.definition.compared.pan=this.definition.compared.pan*l,n.definition.compared.rotate=this.definition.compared.rotate*l,n.update(),this.segments.push(n)),s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.compared.sourceZoom=e,s.definition.compared.pan=this.definition.compared.pan*a,s.definition.compared.rotate=this.definition.compared.rotate*a,s.update(),this._descensionSegment=s,this.segments.push(s)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const AQe={zoom:0,pan:0,rotate:0};let OQe=class{get time(){return this._time}constructor(e){this._createCamera=e,this._time=0,this.definition=new oQe(e),this.path=new CQe}update(e,i,r){this.definition.update(e,i,r),this.path.update(this.definition,r),this._time=this._applyTimeSettings(Kme(isFinite(this.path.time)?this.path.time:0),r),this._easing=r.easing??(this._time>=1e3?GSe:GM)}cameraAt(e,i){i=i||this._createCamera(),e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const r=this.path.interpolateComponentsAt(e,AQe);return i.interpolate(this.definition.source,this.definition.target,r),i}_normalizedEasing(e){const i=this._easing(0,this._time),r=this._easing(1,this._time);return(this._easing(e,this._time)-i)/(r-i)}_applyTimeSettings(e,i){const r=i.speedFactor!=null?i.speedFactor:1;i.duration!=null?e=i.duration:i.speedFactor!=null&&(e=e/r);const n=i.minDuration!=null?i.minDuration:RF.minDuration/r,s=i.maxDuration!=null?i.maxDuration:RF.maxDuration/r;return Math.min(Math.max(n,e),s)}};const RQe=E();let PQe=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=0,this._animation=new OQe(()=>new Woe(e)),this._current=new Woe(e)}update(e,i,r){const n=this._animation.definition.source,s=this._animation.definition.target,o=de(RQe,i.center,e.center),a=xe(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),oe(n.lookAtDirection,o),oe(s.lookAtDirection,o),n.copyFromRenderCamera(e),s.copyFromRenderCamera(i),this._current.copyFrom(n),this._animation.update(n,s,r),this.currentTime=0,e.almostEquals(i)&&(this.currentTime=this._animation.time)}cameraAt(e,i){return this._animation.cameraAt(e,this._current),i=i||new ft,this._current.copyToRenderCamera(i),i}step(e,i){return this.finished||(this.currentTime=this.currentTime+Kme(e),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,i)}};var on;(function(t){t.Ready="ready",t.Rejected="rejected",t.Running="running",t.Stopped="stopped",t.Finished="finished"})(on||(on={}));let Wg=class extends we{constructor(e){super(e),this.state=on.Ready}get active(){return this.state===on.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=on.Stopped,!0)}finishController(){this.state=on.Finished}get steppingFinished(){return!1}};u([p({constructOnly:!0})],Wg.prototype,"view",void 0),u([p({readOnly:!0})],Wg.prototype,"active",null),u([p()],Wg.prototype,"state",void 0),u([p({readOnly:!0})],Wg.prototype,"isInteractive",null),Wg=u([M("esri.views.3d.state.controllers.CameraController")],Wg);let OP=class extends Wg{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(Ti()),this._asyncResult=null),this.state===on.Finished||this.state===on.Stopped?(o6(e),this.state===on.Finished?e.resolve():e.reject(Ti())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=on.Running,this.viewAnimation!=null&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){this.viewAnimation==null||this.state!==on.Ready&&this.state!==on.Running||(this.viewAnimation.state===QE.State.FINISHED?this.finish():this.viewAnimation.state===QE.State.STOPPED&&(this.state=on.Stopped))}onControllerEnd(){this.viewAnimation==null||this.viewAnimation.done||(this.state===on.Finished?this.viewAnimation.finish():this.state===on.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===on.Finished?this._asyncResult.resolve():this._asyncResult.reject(Ti()))}finish(){this.finishController()}};OP=u([M("esri.views.3d.state.controllers.AnimationController")],OP);let ny=class extends OP{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new PQe(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new QE}get isInteractive(){return this.mode==="interaction"}begin(e,i){this._hasTarget=!0;const r=this.animationSettings(i);zI.copyFrom(this.view.state.camera);const n=sd(this.view.state.viewingMode);this.intersectionHelper.intersectRay(zI.ray,n,Yoe)&&(zI.center=Yoe),this.animation.update(zI,e,r),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,i){this._hasTarget&&this.animation.step(e,i)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?QKe[e.easing]:e.easing}}};u([p({constructOnly:!0})],ny.prototype,"mode",void 0),u([p({readOnly:!0})],ny.prototype,"isInteractive",null),ny=u([M("esri.views.3d.state.controllers.PointToPointAnimationController")],ny);const zI=new ft,Yoe=E();function IU(t=$Qe){return[t[0],t[1],t[2],t[3]]}function RP(t,e){return MQe(t[0],t[1],t[2],e,OJ.get())}function MQe(t,e,i,r,n=IU()){return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n}function ZK(t,e,i){return lt(i,t,e),ye(i,i),i[3]=Q6(t,e),i}const $Qe=[0,0,1,0];function y4t(t,e,i=js()){return JK(t,fp(e),i),ye(i.direction,i.direction),i}function JK(t,e,i){return IQe(t,t.screenToRender(e,Ne.get()),i)}function IQe(t,e,i){const r=gs(Ne.get(),e);if(r[2]=0,!t.unprojectFromRenderScreen(r,i.origin))return null;const n=gs(Ne.get(),e);n[2]=1;const s=t.unprojectFromRenderScreen(n,Ne.get());return s==null?null:(de(i.direction,s,i.origin),i)}function zC(t,e,i){return KK(t,t.screenToRender(e,Ne.get()),i)}function KK(t,e,i){oe(i.origin,t.eye);const r=ae(Ne.get(),e[0],e[1],1),n=t.unprojectFromRenderScreen(r,Ne.get());return n==null?null:(de(i.direction,n,i.origin),i)}function QK(t,e,i,r){const n=zC(e,i,LQe);return e1(t,n,r)}const LQe=js();var rC;(function(t){t[t.Ellipsoid=0]="Ellipsoid",t[t.Silhouette=1]="Silhouette"})(rC||(rC={}));const HSe=30,PF=[1,3e8],LU=80,qSe=8,WSe=200,YSe=1508e5,XSe=5,ZSe=50,DQe=5,NQe=10,s9=90,eT={exclude:new Set([F_])};function Yw(t,e,i){return i[0]=e[0]/(t.fullWidth/t.pixelRatio),i[1]=e[1]/(t.fullHeight/t.pixelRatio),i}function Fq(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function zv(t,e,i){const r=Qu(RJ.get(),i[3],i);r==null||TZ(r,Kr)||(de(ir,t.eye,e),ke(ir,ir,r),t.eye=ue(ir,ir,e),de(ir,t.center,e),ke(ir,ir,r),t.center=ue(ir,ir,e),t.up=ke(ir,t.up,r))}function FQe(t,e,i,r){return qx(t,JK(e,i,iQ),r)}function kq(t,e,i,r){return qx(t,zC(e,i,iQ),r)}function eQ(t,e,i,r){const n=Ne.get();let s=1-i;de(n,e,t.eye);const o=xe(n);let a=o*(1-s);s>=0&&a<r&&(a=r,s=-(a-o)/o),Math.abs(o-a)<1e-6||(re(n,n,s),t.eye=ue(ir,t.eye,n),t.center=Xi(ir,t.center,e,s))}function JSe(t,e,i){e.getScreenCenter(Xoe),QK(t,e,Xoe,ir)&&(e.center=ir);const r=e.distance,n=r*i;if(Math.abs(r-n)<1e-6)return;const s=re(Ne.get(),e.viewForward,n);e.eye=de(ir,e.center,s)}const Xoe=cn();function o9(t,e){ae(e,0,0,0);for(const i of t)ue(e,e,i);re(e,e,1/t.length)}function o4(t,e,i,r){return Math.sin(t/xe(e))*(i+r.radius)}function Zoe(t,e,i,r){return o4(Math.PI/2,e,i,r)+(t-Math.PI/2)}var yo;(function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"})(yo||(yo={}));const Joe={Elevation:3e4,Angle:Dt(16)},BI={Pole:.95,Angle:Dt(18),Tilt:45},KSe=Dt(80);function QSe(t,e,i,r,n,s){const o=E(),a=kn();let l=!0,c=!0;return t.intersectScreen(i,o,s)?a[3]=xe(o):(c=!1,e.aboveGround&&n!==rC.Ellipsoid?a[3]=Math.max(xe(e.center),.9*r.radius):a[3]=xe(e.eye)-e.relativeElevation,n===rC.Silhouette?PP(a,e,i,o):l=QK(a,e,i,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function DU(t,e,i){return xe(t.eye)-i.radius>Joe.Elevation?yo.Horizontal:(zC(t,e,sae),-Math.sign(t.relativeElevation)*(.5*Math.PI+Q6(t.eye,sae.direction))<Joe.Angle?yo.Vertical:yo.Horizontal)}function e2e(t,e,i){de(a9,i,e),t.eye=de(ir,t.eye,a9),t.center=de(ir,t.center,a9)}const a9=E();function PP(t,e,i,r){const n=zC(e,i,iQ);return n!=null&&(IC(t,n,VI),e1(t,n,r)?!(qs(VI,n.origin)<qs(r,n.origin))||(oe(r,VI),!1):(de($T,e.eye,e.center),ye($T,$T),$be($T,-ge(ye($T,$T),VI),Koe),qx(Koe,n,r),!1))}const VI=E(),$T=E(),Koe=Ii();function t2e(t,e,i,r,n,s){let o=0;if(lt(IF,t,e),de(qI,t,e),xe(t)<=n||!r.aboveGround){lt(i,qI,r.eye);const a=ge(t,e)/(xe(t)*xe(e));if(a<.9999)o=Ys(a);else{const c=xe(lt(E(),t,e))/(xe(t)*xe(e));o=Qh(c)}const l=Math.cos(_e(xv.normalize(Dt(s)),0,KSe));o=-o-Math.max(0,xe(e)-n)/(l*n)}else de(Qoe,r.eye,r.center),lt(i,qI,Qoe),o=-xe(qI)/n;return ye(i,i),re(i,i,xe(IF)),o}const Qoe=E();function eae(t,e,i,r){let n,s;const o=Math.cos(_e(xv.normalize(Dt(r)),0,KSe));return n=e>i?-(e-i)/(o*i):e<-i?Math.PI-(e+i)/(o*i):Ys(e/i),s=t>i?-(t-i)/(o*i):t<-i?Math.PI-(t+i)/(o*i):Ys(t/i),(s-n)*i}function kQe(t,e,i,r,n,s,o,a,l,c){const h=eae(t[2],e[2],s[3],a),d=l?eae(t[0],e[0],s[3],180):e[0]-t[0],f=Math.sin(o)*d-Math.cos(o)*h,m=Math.cos(o)*d+Math.sin(o)*h;ye(ir,n);const y=l?f/Math.sqrt(Math.abs(s[3]**2-ge(i,ir)**2)):f/s[3],_=m/Math.sqrt(Math.abs(s[3]**2-ge(i,r)**2));mi(c,y,_)}function i2e(t,e,i,r,n,s,o,a,l,c){lt(IF,t,e),nH(s.up,s.eye,GI,jI,HI),nH([0,0,1],s.eye,hy,hv,o2e),oe(i,hv),oe(r,hy),ye(i,i),re(i,i,xe(IF)),Ine(t,ye(jI,jI),ye(HI,HI),ye(GI,GI),tae),Ine(e,jI,HI,GI,iae),kQe(tae,iae,t,hy,hv,o,a,l,c,n)}function UQe(t,e,i,r,n,s,o){Qu(MF,n,r),Qu($F,o,s),qi($2,MF,$F),de(e,t,i),ke(e,e,$2),ue(e,e,i)}function r2e(t,e,i,r,n,s){Qu(MF,r,i),Qu($F,s,n),qi($2,MF,$F),de(ir,t.eye,e),ke(ir,ir,$2),t.eye=ue(ir,ir,e),de(ir,t.center,e),ke(ir,ir,$2),t.center=ue(ir,ir,e),de(ir,t.up,e),ke(ir,ir,$2),t.up=ue(ir,ir,e)}function tQ(t,e,i,r,n,s){return(Math.abs(r)>Math.PI-BI.Angle||Math.abs(r)<BI.Angle)&&(Math.abs(t[2])<i*BI.Pole||Math.abs(e)>i)&&s.aboveGround&&n<BI.Tilt}function n2e(t,e,i,r,n,s){if(s)ZK(i,r,rae),zv(e,t,rae);else{const o=t2e(i,r,nae,e,t[3],n);zv(e,t,RP(nae,o))}}function s2e(t,e,i,r,n,s,o){const a=o?20:1,l=1e-12;let c,h;oe(E1,r),WI.copyFrom(e);for(let d=0;d<a&&qs(i,E1)>l&&(c=qs(i,E1),i2e(i,E1,hv,hy,xA,WI,t,n,s,o),r2e(WI,t,hy,xA[1],hv,xA[0]),UQe(E1,E1,t,hy,xA[1],hv,xA[0]),h=qs(i,E1),h<c||d===0);d++)e.copyFrom(WI)}function zQe(t,e,i,r,n,s,o){tQ(i,ge(e.up,i),t[3],-xv.normalize(Dt(n)),s,e)?s2e(t,e,i,r,-xv.normalize(Dt(n)),s,o):n2e(t,e,i,r,s,o)}function BQe(t,e,i,r,n,s){const{eye:o}=t;nH([0,0,1],o,hy,hv,o2e);const a=e.translation[0]*i.pan,l=n.mode==="zoom"?0:e.translation[1]*i.pan,c=Math.max(Math.sqrt(Math.abs(1-ge(t.center,hy)**2/xe(t.center)**2)),.5),h=(Math.sin(s)*l+Math.cos(s)*a)/c,d=-Math.cos(s)*l+Math.sin(s)*a;switch(Fc(r.pan.matrix,r.pan.matrix,h,hy),r.pan.enabled=!0,n.mode){case"pan":Fc(r.pan.matrix,r.pan.matrix,d,hv),r.pan.enabled=!0;break;case"zoom":r.zoom=-e.translation[1]*i.zoom}}function VQe(t,e,i,r,n){const{eye:s,viewRight:o}=t,a=lt(Ne.get(),o,s),l=e.translation[0]*i.pan;switch(l!==0&&(Fc(r.pan.matrix,r.pan.matrix,-l,a),r.pan.enabled=!0),n.mode){case"pan":{const c=e.translation[1]*i.pan;c!==0&&(Fc(r.pan.matrix,r.pan.matrix,c,o),r.pan.enabled=!0);break}case"zoom":r.zoom=-e.translation[1]*i.zoom}}function GQe(t,e,i,r,n,s,o,a,l){tQ(t.center,ge(t.up,t.center),xe(t.center),-xv.normalize(Dt(s)),o,e)?BQe(e,i,r,a,l,-xv.normalize(Dt(n))):VQe(e,i,r,a,l)}const hy=E(),hv=E(),o2e=E(),GI=E(),jI=E(),HI=E(),tae=E(),iae=E(),xA=Ge(),rae=IU(),MF=be(),$F=be(),$2=be(),E1=E(),ir=E(),qI=E(),WI=new ft,IF=E(),nae=E(),iQ={origin:E(),direction:E()},sae={origin:E(),direction:E()},oae=.6,l9=4,jQe=60;let LF=class extends ny{constructor(){super(...arguments),this._zoomLocation=E(),this._tmpCamera=new ft,this._tmpViewDir=E(),this._tmpRayDir={origin:E(),direction:E()},this._targetOnSphere=E(),this._tmpCenter=E(),this._constraintOptions={selection:Ur.ALL_EXCEPT_COLLISION,interactionType:Qt.ZOOM,interactionFactor:null,interactionStartCamera:new ft,interactionDirection:null,tiltMode:wo.TUMBLE},this._sphere=kn()}initialize(){this._intersector=sd(this.view.state.viewingMode)}zoomStep(e,i){if(!this.active)return;const r=this.view.state,{interactionStartCamera:n}=this._constraintOptions;n&&(this.animation.finished?n.copyFrom(r.camera):this.animation.cameraAt(1,n));let s=!1,o=!1;this.intersectionHelper.intersectScreen(i,this._zoomLocation,this.view.map.ground.opacity===0?eT:{})&&(s=e>0,o=!0),this._tmpCamera.copyFrom(r.camera),s?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:oe(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,i,o),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:GM}}_updateCamera(e,i,r,n,s){const o=Wi(this.view.spatialReference),a=DU(e,n,o),l=Math.abs(this.view.camera.position.z);ye(XI,e.eye),re(XI,XI,-1),zC(e,n,this._tmpRayDir),ye(this._tmpRayDir.direction,this._tmpRayDir.direction);const c=_e(Math.min(qSe,1/Math.abs(ge(XI,this._tmpRayDir.direction)))*l,WSe,YSe);if(a===yo.Horizontal){let h=oae**i;this._sphere[3]=xe(r),de(this._tmpViewDir,e.center,e.eye);const d=Math.min(xe(this._tmpViewDir),c);let f=d*h;if(h<=1&&f<l9&&(f=l9,h=f/d),Math.abs(d-f)<1e-6)return;const m=xe(e.center);if(this._sphere[3]!==m){const y=this._sphere[3]+h*(m-this._sphere[3]);e.center=re(YI,e.center,y/m)}re(this._tmpViewDir,this._tmpViewDir,-h),e.eye=ue(YI,e.center,this._tmpViewDir),Xn(this.view,e,this._constraintOptions),qs(r,e.center)>1e-12&&QK(this._sphere,e,n,this._targetOnSphere)&&zQe(this._sphere,e,r,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let h=oae**Math.abs(i);const d=i>0?1:-1;de(this._tmpViewDir,r,e.eye);const f=xe(this._tmpViewDir),m=this.view._stage.renderView.getMinimalDepthForArea(null,n[0],n[1],this.view.state.camera,jQe);let y=m??c;y=s&&i>0?Math.min(y,f):y,re(this._tmpRayDir.direction,this._tmpRayDir.direction,y),ue(r,this._tmpRayDir.origin,this._tmpRayDir.direction);let _=y*h;const v=Math.max(l9,1.01*e.nearFar[0]);if(i>0&&_<v&&(_=v,h=_/y),Math.abs(y-_)<1e-6)return;re(this._tmpRayDir.direction,this._tmpRayDir.direction,d*(1-h)),e.eye=ue(YI,e.eye,this._tmpRayDir.direction),e.center=ue(YI,e.center,this._tmpRayDir.direction)}UC(this.view,e)}};LF=u([M("esri.views.3d.state.controllers.global.ZoomStepController")],LF);const YI=E(),XI=E();let a4;const oE=new Map;async function v4t(t){a4==null&&(a4=ce(()=>import("./VoxelWasmPerSceneView-b14e549e.js"),[],import.meta.url));const e=t.view,i=oE.get(e);return i?i.addVoxelLayer(t):(await a4.then(r=>{const n=new r.default({view:e});return oE.set(e,n),n})).addVoxelLayer(t)}function MP(t){return oE.get(t)}function b4t(t){const e=t.view,i=oE.get(e);i&&i.removeVoxelLayer(t)<1&&(oE.delete(e),oE.size===0&&(a4=null))}const HQe=.6,qQe=4,WQe=60;let DF=class extends ny{constructor(){super(...arguments),this._zoomLocation=E(),this._tmpCamera=new ft,this._tmpRayDir=E(),this._tmpCenter=E(),this._constraintOptions={selection:Ur.ALL,interactionType:Qt.ZOOM,interactionFactor:null,interactionStartCamera:new ft,interactionDirection:null,tiltMode:wo.TUMBLE}}zoomStep(e,i){if(!this.active)return;const r=this.view.state,{interactionStartCamera:n}=this._constraintOptions;n&&(this.animation.finished?n.copyFrom(r.camera):this.animation.cameraAt(1,n)),this._tmpCamera.copyFrom(r.camera);const s=sd(this.view.state.viewingMode);let o=!1;e>0?(o=this.intersectionHelper.intersectScreenFreePointFallback(i,this._zoomLocation,this.view.map.ground.opacity===0?eT:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:oe(this._zoomLocation,this._tmpCamera.center);const a=HQe**e;let l=this.view._stage.renderView.getMinimalDepthForArea(MP(this.view),i[0],i[1],this.view.state.camera,WQe);de(ZI,this._tmpCamera.eye,this._zoomLocation),ye(ZI,ZI);const c=_e(Math.min(qSe,1/Math.abs(ge(YQe,ZI)))*Math.abs(this.view.camera.position.z),WSe,YSe);if(l=l??c,l){const h=E();de(h,this._zoomLocation,this._tmpCamera.eye),(l<xe(h)||!o)&&(ye(h,h),ue(this._zoomLocation,this._tmpCamera.eye,re(h,h,l)))}this._updateCamera(this._tmpCamera,a,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:GM}}_updateCamera(e,i,r){de(this._tmpRayDir,r,e.eye);const n=xe(this._tmpRayDir);let s=n*i;const o=i<=1,a=Math.max(qQe,1.01*e.nearFar[0]);s!==0&&(o&&s<a&&(s=a,i=s/n),Math.abs(n-s)<1e-6||(re(this._tmpRayDir,this._tmpRayDir,i),e.eye=de(aae,r,this._tmpRayDir),e.center=Xi(aae,e.center,r,1-i),Xn(this.view,e,this._constraintOptions)))}};DF=u([M("esri.views.3d.state.controllers.local.ZoomStepController")],DF);const aae=E(),YQe=Oe(0,0,1),ZI=E();function XQe(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}function rQ(t,e){if(t.pointerType==="touch")return!1;switch(e){case"primary":return t.button===0;case"secondary":return t.button===2;case"tertiary":return t.button===1}}let ZQe=class extends Ho{constructor(e,i){super(!0),this._view=e,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r))}_handleDoubleClick(e){const i=e.data;if(XQe(i,"primary")){const r=this._view.state.isGlobal?new LF({view:this._view,mode:"animation"}):new DF({view:this._view,mode:"animation"});this._view.state.switchCameraController(r),r.zoomStep(Math.log(.5)/Math.log(.6),cn(i.x,i.y)),e.stopPropagation()}}};function JQe(t,e,i){return t===Le.Global?new QQe(i):new KQe(e,i)}let KQe=class{constructor(e,i){this._elevationProvider=e,this._referenceEllipsoid=Wi(i),this._unitInMeters=Da(i,this._referenceEllipsoid.metersPerDegree)}compute(e,i,r,n,s){s||(s={near:0,far:0});let o=e[2]*this._unitInMeters;const a=o,l=o-n,c=this._elevationProvider?.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);const h={x:(r=r??new zi({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-r.xmin,y:r.ymax-r.ymin,z:4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},d=Math.max(h.x,h.y,h.z);de(C1,i,e),IT[0]=C1[0]>0?r.xmax:r.xmin,IT[1]=C1[1]>0?r.ymax:r.ymin,IT[2]=C1[2]>0?d/2:-d/2,de(IT,IT,e),ye(C1,C1);const f=1.1*ge(IT,C1)*this._unitInMeters,m=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),y=Math.max(r.xmax-r.xmin,r.ymax-r.ymin),_=y*iet*this._unitInMeters,v=y*ret*this._unitInMeters,w=_e((o-v)/(_-v),0,1)**3,x=Math.min(xt(m,f,w),m)*Math.max(Math.log(Math.abs(l)),1);return a2e(Math.min(x,Math.max(34064e4,d))/this._unitInMeters,eet,this._unitInMeters,s)}},QQe=class{constructor(e){this._referenceEllipsoid=Wi(e)}compute(e,i,r,n,s){s||(s={near:0,far:0});const o=xe(e),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,n),c=Math.abs(a-n),h=Math.max(c,Math.abs(a)),d=Math.sqrt(h*(h+2*l)),f=o+this._referenceEllipsoid.radius;return a2e(1.2*xt(d,f,fK(h)),_e(2e4-(Math.log(h)-7.983)/9.011*19e3,1e3,2e4),1,s)}};function a2e(t,e,i,r){const n=tet/i;return t/e>n?(r.far=t,r.near=r.far/e):(r.near=n,r.far=r.near*e),r}const eet=2e4,tet=2,iet=.001,ret=1e-4,IT=E(),C1=E();let l4=class extends we{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const i=this.view.state.camera;e.spatialReference!=null&&Mwe(this.view,i,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>UC(this.view,e,Wh.EYE_AND_CENTER))}};u([p({constructOnly:!0})],l4.prototype,"view",void 0),l4=u([M("esri.views.3d.state.ElevationCollisionConstraint")],l4);let tO=class extends we{constructor(e){super(e),this.nearFarHeuristic=JQe(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([ne(()=>[this.view.constraints?.clipDistance?.near,this.view.constraints?.clipDistance?.far],()=>this._clipDistanceNearFarChanged()),ne(()=>this.view.constraints?.clipDistance?.mode,()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),ne(()=>this.view.renderDataExtent,()=>this._updateNearFar(),Zi),ne(()=>[this.view.constraints?.altitude?.min,this.view.constraints?.altitude?.max],()=>this._updateAltitude(),Zi),ne(()=>this.view.constraints?.tilt?.max,()=>this._updateTiltMax(),Zi),ne(()=>this.view.constraints?.tilt?.mode,()=>this._updateTilt(),Zi),ne(()=>this.view.state?.camera,()=>this._updateTiltAutoMax(),Zi),ne(()=>[this.view.map?.ground?.navigationConstraint?.type,this.view.state?.constraints?.collision?.enabled],()=>this._updateCollision(),Zi)]),this.view.state.isLocal&&this.addHandles(ne(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),Xt)),this._updateNearFar(),this.view.state.viewingMode!==Le.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new l4({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){const e=this.view.constraints?.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(i=>this._updateCameraNearFarManual(i,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const i=this.view.constraints&&this.view.constraints.clipDistance;(i?i.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,i):this._updateCameraNearFarAuto(e,i)}_updateCameraNearFarAuto(e,i){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,pU(this.view,e.eye),e),i&&i.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,i){i&&(e.near=i.near,e.far=i.far)}_updateCollision(){const e=this.view.map?.ground?.navigationConstraint?.type,i=!e||e==="stay-above",r=this.view.state.constraints.collision;if(i!==r.enabled){r.enabled=i,i&&this._reapplyConstraints(Ur.COLLISION);const n=this.view.constraints&&this.view.constraints.tilt;n&&n.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==Le.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const i=this.view.state.constraints;i.tilt=i.createConstantMaxTilt(Dt(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const i=this.view.state.constraints;if(i.tilt){const r=i.tilt(this.view.state.camera.distance).max;e.autoUpdate(ml(r))}}_updateLocalSurfaceDistance(e){if(e==null)return;let i=Math.max(e.width,e.height);if(i<=0)return;e.zmax!=null&&e.zmin!=null&&(i=Math.max(i,e.zmax-e.zmin));const r=this.view.state,n=3*i/Math.atan(r.camera.fov/2);n!==r.constraints.distance&&(r.constraints.distance=n)}_reapplyConstraints(e=Ur.ALL){this.view.state.updateCamera(i=>Xn(this.view,i,{selection:e,interactionType:Qt.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:wo.TUMBLE}))}};u([p({constructOnly:!0})],tO.prototype,"view",void 0),u([p({readOnly:!0})],tO.prototype,"surfaceCollisionConstraint",void 0),tO=u([M("esri.views.3d.state.ConstraintsManager")],tO);let U_=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}constructor(e){this.renderCoordsHelper=e,this.frustum=SP(),this._points=$Te(),this.lines=new Array(12),this._origin=E(),this._direction=E(),this._altitude=null;for(let i=0;i<12;i++)this.lines[i]={origin:null,direction:E(),endpoint:null}}update(e){ITe(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),oe(this._origin,e.eye),oe(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let i=0;i<this._points.length;i++)oe(this._points[i],e[i]);LTe(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return Q_(this.frustum,e)}intersectsRay(e){return QXe(this.frustum,e)}intersectsLineSegment(e,i){return eZe(this.frustum,e,i)}intersectsPoint(e){return DTe(this.frustum,e)}_updateLines(){const e=this._points;for(let i=0;i<4;i++){const r=i+4;c9(this.lines[i],e[i],e[r]),c9(this.lines[i+4],e[i],i===3?e[0]:e[i+1]),c9(this.lines[i+8],e[r],i===3?e[4]:e[r+1])}}};function c9(t,e,i){t.origin=e,t.endpoint=i,Fy(t.direction,e,i)}U_.planePointIndices=tZe,U_.nearFarLineIndices=[[Ze.NEAR_BOTTOM_LEFT,Ze.FAR_BOTTOM_LEFT],[Ze.NEAR_BOTTOM_RIGHT,Ze.FAR_BOTTOM_RIGHT],[Ze.NEAR_TOP_RIGHT,Ze.FAR_TOP_RIGHT],[Ze.NEAR_TOP_LEFT,Ze.FAR_TOP_LEFT]];let uR=class extends Wg{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=on.Running,this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(e){(e.spatialReference==null||Mwe(this.view,this.desiredCamera,e.extent,e.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),UC(this.view,e,Wh.EYE_AND_CENTER)||this.constraintEnabled||(this.state=on.Stopped)})}};u([p({constructOnly:!0})],uR.prototype,"desiredCamera",null),uR=u([M("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],uR);function l2e(t,e,i){const r=Math.sin(t),n=Math.cos(t),s=Math.sin(e),o=Math.cos(e),a=i;return a[0]=-r,a[4]=-s*n,a[8]=o*n,a[12]=0,a[1]=n,a[5]=-s*r,a[9]=o*r,a[13]=0,a[2]=0,a[6]=o,a[10]=s,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function net(t,e,i){return l2e(t,e,i),Hc(i,i),i}function Bc(t,e,i,r){if(t==null||r==null)return!1;const n=sP(t,i_e),s=sP(r,b6e);if(n===s&&!lae(s)&&(n!==Z.UNKNOWN||Fn(t,r)))return gM(i,e),!0;if(lae(s)){const o=x2[n][Z.LON_LAT],a=x2[Z.LON_LAT][s];return o!=null&&a!=null&&(o(e,0,T0,0),a(T0,0,S0,0),l2e(JI*T0[0],JI*T0[1],i),i[12]=S0[0],i[13]=S0[1],i[14]=S0[2],!0)}if((s===Z.WEB_MERCATOR||s===Z.PLATE_CARREE)&&(n===Z.WGS84||n===Z.CGCS2000&&s===Z.PLATE_CARREE||n===Z.SPHERICAL_ECEF||n===Z.WEB_MERCATOR)){const o=x2[n][Z.LON_LAT],a=x2[Z.LON_LAT][s];return o!=null&&a!=null&&(o(e,0,T0,0),a(T0,0,S0,0),n===Z.SPHERICAL_ECEF?net(JI*T0[0],JI*T0[1],i):td(i),i[12]=S0[0],i[13]=S0[1],i[14]=S0[2],!0)}return!1}function lae(t){return t===Z.SPHERICAL_ECEF||t===Z.SPHERICAL_MARS_PCPF||t===Z.SPHERICAL_MOON_PCPF}const JI=Dt(1),T0=E(),S0=E(),set=.66;function c2e(t){return 360-FZ.normalize(t)}function NU(t){return FZ.normalize(360-t)}function u2e(t,e,i){const r=e.camera;if(r!=null)return oet(r,Vy(t));const{targetGeometry:n}=e;if(n==null)return null;const{camera:s,mode:o}=d2e(t,e.rotation,i);if(n.type==="point")return cet(t,e,n,s,o);const a=n.extent;return a==null?null:BN(t,a,s.heading,s.tilt,o)}async function h2e(t,e,i,r){const n=e.camera;if(n!=null)return aet(n,Vy(t),r);const{targetGeometry:s}=e;if(s==null)throw new Error("Viewpoint has no targetGeometry!");const{camera:o,mode:a}=d2e(t,e.rotation,i);if(s.type==="point")return uet(t,e,s,o,a,r);const l=s.extent;if(l==null)throw new Error("Target geometry has no extent!");return nxe(t,l,o.heading,o.tilt,a,r)}function oet(t,e){const i=t.position;let r;try{r=Bm(i,e)}catch{return null}const n=t.clone();return n.position=r.clone(),n}async function aet(t,e,i){const r=t.position,n=await Am(r,e,{signal:i});Tt(i);const s=t.clone();return s.position=n.clone(),s}function d2e(t,e,i){const r=KE(t,t.state.camera);let n=la.ADJUST;return e!=null&&(r.heading=c2e(e),n=la.LOCKED),i!=null&&(r.tilt=i),{camera:r,mode:n}}function cet(t,e,i,r,n){const s=t.spatialReference;let o;try{o=Bm(i.clone(),s)}catch{return null}const a=e.scale!=null?fU(t,e.scale,o.latitude):t.state.camera.distance;return _qe(t,o,a,r,n)}async function uet(t,e,i,r,n,s){const o=t.spatialReference,a=await Am(i.clone(),o,{signal:s});Tt(s);const l=e.scale!=null?fU(t,e.scale,a.latitude):t.state.camera.distance;return Wwe(t,a,l,r,n,s)}function p2e(t,e,i=null){return i==null&&(i=new qc),oQ(t,null,e.clone(),i)}async function f2e(t,e,i){const r=bet(t,e);if(!r)throw new G("viewpointutils-create:no-target","Missing target for creating viewpoint");const n=new eh({fov:t.camera.fov}),s=new qc({camera:n});if(r.target instanceof qc)return A1(await pet(t,r.target,r,i,s));if(r.target instanceof eh)return A1(await g2e(t,r.target,i,s));const o=r.scale!=null||r.zoom!=null;if(r.target instanceof zi){const c=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax;return A1(o||c?await Uq(t,r,r.target.center,n,i,s):await yet(t,r,r.target,n,i,s))}const a={boundingBox:Pr(),hasZ:!1,screenSpaceObjects:[]},l=o?het(t,r):void 0;if(await m2e(t,r.target,l,a,i),isFinite(a.boundingBox[0])){let c;if(_p(a.boundingBox,In),Su.x=In[0],Su.y=In[1],Su.z=In[2],Su.spatialReference=t.spatialReference,isFinite(Su.z)&&a.hasZ?c=_J(a.boundingBox):(Su.z=void 0,c=Bke(yJ(a.boundingBox,xet))),o||c)return A1(await Uq(t,r,Su,n,i,s));const h=wet(t,a.screenSpaceObjects);return A1(await vet(t,r,Su,a.boundingBox,h,n,i,s))}return r.position?A1(await met(t,r,n,s,i)):A1(await get(t,r,n,i,s))}function nQ(t,e){return e.scale==null&&e.zoom!=null?cxe(t,e.zoom):e.scale}function het(t,e){const i=nQ(t,e);return i?uGe(i):void 0}function sQ(t,e){let i=!1;return e.heading!=null?(t.heading=e.heading,i=!0):e.rotation!=null&&(t.heading=c2e(e.rotation),i=!0),e.tilt!=null&&(t.tilt=e.tilt,i=!0),e.fov!=null&&(t.fov=e.fov),i}function oQ(t,e,i,r){const n=t.spatialReference||ze.WGS84;return(e=e??Bg(t,i))==null||(r.targetGeometry=Ay(e.center,t.renderSpatialReference,n),r.scale=uxe(t,e),r.rotation=NU(i.heading),r.camera=i),r}async function NF(t,e,i,r){const n=()=>new G("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!e)throw n();e.type==="mesh"&&(e=e.extent);const s=e.spatialReference,o=t.spatialReference,a=t.basemapTerrain.spatialReference;if(!e.hasZ&&t.basemapTerrain){let d;switch(e.type){case"point":d=e;break;case"multipoint":case"polyline":d=e.extent?.center;break;case"extent":d=e.center;break;case"polygon":d=e.centroid}d!=null&&a!=null&&t.elevationProvider!=null?(d=await Am(d,a,{signal:r}),In[2]=om(t.elevationProvider,d)??0):In[2]=0}const l=Tet[e.type],c=new Array;if(l(e,e.hasZ?d=>{c.push([d[0],d[1],d[2]])}:d=>{c.push([d[0],d[1]])},In),c.length===0)throw n();const h=await Am(new TC({spatialReference:s,hasZ:e.hasZ,hasM:!1,points:c}),o,{signal:r});if(e.hasZ&&(i.hasZ=!0),e.hasZ)for(const[d,f,m]of h.points)In[0]=d,In[1]=f,In[2]=m,Dp(i.boundingBox,In);else for(const[d,f]of h.points)In[0]=d,In[1]=f,Dp(i.boundingBox,In)}async function det(t,e,i,r,n){const s=await jc(t.whenViewForGraphic(e));if(s.ok===!1||s.value==null||!("whenGraphicBounds"in s.value))return void await NF(t,e.geometry,r,n);const o=s.value,a=await jc(o.whenGraphicBounds(e,{minDemResolution:i}));if(a.ok===!1||!a.value)return void await NF(t,e.geometry,r,n);const{screenSpaceObjects:l,boundingBox:c}=a.value;jE(r.boundingBox,c),l&&l.forEach(h=>{r.screenSpaceObjects.push(h)}),isFinite(c[2])&&(r.hasZ=!0)}async function m2e(t,e,i,r,n){if(Array.isArray(e)&&e.length===2){const s=e[0],o=e[1];if(typeof s=="number"&&typeof o=="number")return Su.x=s,Su.y=o,Su.z=void 0,Su.spatialReference=t.spatialReference?.isGeographic?t.spatialReference:ze.WGS84,void await NF(t,Su,r,n)}e&&"map"in e&&typeof e.map=="function"?await Promise.allSettled(e.map(s=>m2e(t,s,i,r,n))):e instanceof Zv?await NF(t,e,r,n):e instanceof vx&&await det(t,e,i,r,n)}async function pet(t,e,i,r,n){if(e.camera!=null)return g2e(t,e.camera,r,n);n.scale=e.scale,n.rotation=e.rotation,n.targetGeometry=e.targetGeometry!=null?e.targetGeometry.clone():null,n.camera=null,i.heading!=null?n.rotation=NU(i.heading):i.rotation!=null&&(n.rotation=i.rotation);const s=nQ(t,i);return s!=null&&(n.scale=s),n.camera=await h2e(t,n,i.tilt,r),n}async function g2e(t,e,i,r){const n=t.spatialReference,s=await Am(e.position,n,{signal:i});return(e=e.clone()).fov=t.camera.fov,e.position=s,oQ(t,null,e,r)}async function fet(t,e,i,r,n,s,o){const a=t.renderSpatialReference;return await hF(e,u9,a,0,{signal:o}),await hF(i,QI,a,0,{signal:o}),s.targetGeometry=new ut(e),n.position=new ut(i),de(FF,u9,QI),mU(t,QI,FF,r.up,n),s.scale=wx(t,Mr(QI,u9),s.targetGeometry.latitude),s.rotation=NU(n.heading),s.camera=n,s}async function Uq(t,e,i,r,n,s){if(i==null)throw new G("createfromcenter","invalid point");s.targetGeometry=i.clone();const o=Zx(t);if(e.position)return fet(t,s.targetGeometry,e.position,o,r,s,n);if(e.zoomFactor){const l=o.distance/e.zoomFactor,c=re(In,o.viewForward,-l);o.eye=ue(In,o.center,c),s.scale=wx(t,l,i.latitude)}KE(t,o,r);const a=sQ(r,e)?la.LOCKED:la.ADJUST;if(!e.zoomFactor){const l=nQ(t,e);if(l==null){const{renderSpatialReference:c}=t;await hF(i,In,c,0,{signal:n}),DTe(o.frustum,In)?s.scale=wx(t,Mr(o.eye,In),i.latitude):s.scale=uxe(t,o)}else s.scale=l;s.camera=await qwe(t,s.targetGeometry,s.scale,r,a,n)}return s}async function met(t,e,i,r,n){const s=Zx(t);oe(FF,s.viewForward),mU(t,s.eye,FF,s.up,h9);const o=t.spatialReference,{position:a}=e;if(a){const l=await Am(a,o,{signal:n});i.position=l}else i.position=new ut;return i.heading=e.heading!=null?e.heading:h9.heading,i.tilt=e.tilt!=null?e.tilt:h9.tilt,oQ(t,null,i,r)}async function get(t,e,i,r,n){const s=Zx(t),{spatialReference:o,renderSpatialReference:a}=t;return Uq(t,e,Ay(s.center,a,o),i,r,n)}async function yet(t,e,i,r,n,s){s.targetGeometry=i.clone();const o=Zx(t);KE(t,o,r);const a=sQ(r,e)?la.LOCKED:la.ADJUST;return s.camera=await nxe(t,i,r.heading,r.tilt,a,n),s}function _et(t,e,i,r,n){let s=0;i.z!=null?s=i.z:t.basemapTerrain&&t.elevationProvider&&(s=om(t.elevationProvider,i)),ae(In,i.x,i.y,s),Bc(t.spatialReference,In,cae,t.renderSpatialReference),rd(KI,cae),nd(KI,KI),Pr(TA);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let y=0;y<o.length;y++){const _=o[y];let v=r[_[2]];isFinite(v)||(v=s),ae(In,r[_[0]],r[_[1]],v),ua(In,t.spatialReference,In,t.renderSpatialReference),Dp(TA,Nc(In,In,KI))}const a=Vx(TA),l=Kv(TA),c=Gx(TA),h=1/Math.tan(e.fovX/2),d=1/Math.tan(e.fovY/2),f=.5*Math.sqrt(a*a+c*c)*Math.max(d,h)+.5*l,m=.5*l*d+.5*Math.max(a,c);return Math.max(f,m)/n}async function vet(t,e,i,r,n,s,o,a){a.targetGeometry=i.clone();const l=Zx(t),c=_et(t,l,i,r,n);KE(t,l,s);const h=sQ(s,e)?la.LOCKED:la.ADJUST;return a.scale=wx(t,c,a.targetGeometry.latitude),a.camera=await qwe(t,a.targetGeometry,a.scale,s,h,o),a}function bet(t,e){if(!e||!t.spatialReference)return null;const i={target:void 0};return"declaredClass"in e||Array.isArray(e)?i.target=e:(Object.assign(i,e),e.center&&!i.target&&(i.target=e.center)),i}function A1(t){return t?.camera!=null&&(t.rotation=NU(t.camera.heading)),t}function wet(t,e){const i=set;if(!e.length)return i;let r=Number.NEGATIVE_INFINITY;for(let n=0;n<e.length;n++){const s=e[n].screenSpaceBoundingRect;r=Math.max(r,Math.abs(s[0]),Math.abs(s[1]),Math.abs(s[2]),Math.abs(s[3]))}return i-r/Math.min(t.width,t.height)*2}const In=E(),cae=be(),KI=nn(),TA=ks(),xet=Zt(),FF=E(),QI=E(),u9=E(),h9={heading:0,tilt:0},Su=new ut,Tet={point(t,e,i){i[0]=t.x,i[1]=t.y,t.z!=null&&(i[2]=t.z),e(i)},polygon(t,e,i){const r=t.hasZ;for(let n=0;n<t.rings.length;n++){const s=t.rings[n];for(let o=0;o<s.length;o++)i[0]=s[o][0],i[1]=s[o][1],r&&(i[2]=s[o][2]),e(i)}},polyline(t,e,i){const r=t.hasZ;for(let n=0;n<t.paths.length;n++){const s=t.paths[n];for(let o=0;o<s.length;o++)i[0]=s[o][0],i[1]=s[o][1],r&&(i[2]=s[o][2]),e(i)}},multipoint(t,e,i){const r=t.points,n=t.hasZ;for(let s=0;s<r.length;s++)i[0]=r[s][0],i[1]=r[s][1],n&&(i[2]=r[s][2]),e(i)},extent(t,e,i){t.zmin!=null&&t.zmax!=null?(e(ae(i,t.xmin,t.ymin,t.zmin)),e(ae(i,t.xmax,t.ymin,t.zmin)),e(ae(i,t.xmin,t.ymax,t.zmin)),e(ae(i,t.xmax,t.ymax,t.zmin)),e(ae(i,t.xmin,t.ymin,t.zmax)),e(ae(i,t.xmax,t.ymin,t.zmax)),e(ae(i,t.xmin,t.ymax,t.zmax)),e(ae(i,t.xmax,t.ymax,t.zmax))):(e(ae(i,t.xmin,t.ymin,i[2])),e(ae(i,t.xmax,t.ymin,i[2])),e(ae(i,t.xmin,t.ymax,i[2])),e(ae(i,t.xmax,t.ymax,i[2])))}},Eet=Object.freeze(Object.defineProperty({__proto__:null,create:f2e,fromCamera:p2e,toCameraAsync:h2e,toCameraSync:u2e},Symbol.toStringTag,{value:"Module"}));let Cet=class{constructor(e,i,r){this.target=e,this.options=i,this.view=r,this.state="pending",this._animationController=null,this.promise=new Promise((n,s)=>{this._resolveCallback=n,this._rejectCallback=s;const o=new AbortController;this.options.signal!=null&&Ms(this.options.signal,()=>{this.abort()}),this._abortController=o,this.waitForReady()})}resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&this._animationController!=null&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this.reject(Ti())}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await Tv(()=>this.view.ready,this._abortController.signal)}catch(e){return this.reject(e)}this.createViewPoint()}async createViewPoint(){if(this.state!=="finished"){this.state="wait-for-viewpoint",this._animationController=this.options.animate?this._getAnimationController():null;try{const e=await f2e(this.view,this.target,this._abortController.signal);if(this.state==="finished")return;const i=e?this._getCameraFromViewpoint(e):null;if(i==null)return;if(this.options.animate){if(this._animationController==null)return;this.startAnimation(i,this._animationController)}else this.view.stateManager.setStateCamera(i.camera,{applyConstraints:!i.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()}catch(e){this.reject(e)}}}_getCameraFromViewpoint(e){const i=!!(this.target instanceof qc&&this.target.camera||this.target instanceof eh),r=e.camera;if(r==null)return null;if(!this.view.stateManager.isCompatible(r)){const s=r.position,o=s&&s.spatialReference,a=o?o.wkid:"none",l=this.view.spatialReference?.wkid;return this.reject(new G("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${a}, view: ${l})`,{camera:r})),null}const n=Bg(this.view,r);return n==null?(this.reject(new G("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:n,isFullySpecified:i}}startAnimation(e,i){this.state="wait-for-animation-finish";const r=i.viewAnimation;if(r==null)return void this.reject(new G("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(r.update(e.viewpoint,"running"),!i.active||i.viewAnimation==null||i.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==i)return this.abort();let n;e.isFullySpecified?(n=new uR({view:this.view,desiredCamera:e.camera}),UC(this.view,e.camera,Wh.EYE_AND_CENTER)):Xn(this.view,e.camera),i.begin(e.camera,this.options);const s=()=>{const a=this.view.state.cameraController;n&&(a&&a.active?a instanceof ny&&a.viewAnimation!=null&&a.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=n):i.viewAnimation!=null&&i.viewAnimation.target===e.viewpoint&&i.state==="finished"&&(this.view.state.cameraController=n))},o=a=>{if(this.view.state!=null)switch(i.state){case on.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case on.Ready:case on.Rejected:case on.Running:case on.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(a)}}};r.when(s,a=>o(a)),i.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let e=null,i=null;const r=this.view.state.cameraController;return r instanceof ny&&(r.updateStateFromViewAnimation(),r.active&&(e=r,i=e.viewAnimation)),e!=null||(e=new ny({view:this.view,mode:"animation"}),i=e.viewAnimation,this.view.state.switchCameraController(e))?e:(i?.stop(),this.reject(new G("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}},BC=class{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(e,i){return this._outer.get(e)?.get(i)}set(e,i,r){const n=this._outer.get(e);n?n.set(i,r):this._outer.set(e,new Map([[i,r]]))}delete(e,i){const r=this._outer.get(e);r&&(r.delete(i),r.size===0&&this._outer.delete(e))}forEach(e){this._outer.forEach((i,r)=>e(i,r))}};var hs;function d9(t=!ie("disable-feature:high-quality-idle"),e=null){const i=new BC;return t?(i.set(Li.IDLE,hs.Antialiasing,e!=="low"),i.set(Li.IDLE,hs.HighResolutionAtmosphere,e!=="low"),i.set(Li.IDLE,hs.HighQualityTransparency,!0),i.set(Li.IDLE,hs.SSAO,!0),i.set(Li.IDLE,hs.WaterReflection,!0),i.set(Li.IDLE,hs.PhysicalPixelRendering,!0)):(i.set(Li.ANIMATING,hs.HighResolutionShadows,!0),i.set(Li.INTERACTING,hs.HighResolutionShadows,!0)),i.set(Li.IDLE,hs.HighResolutionShadows,!0),i.set(Li.IDLE,hs.HighResolutionVoxel,!0),i}(function(t){t[t.Antialiasing=0]="Antialiasing",t[t.HighQualityTransparency=1]="HighQualityTransparency",t[t.HighResolutionVoxel=2]="HighResolutionVoxel",t[t.HighResolutionAtmosphere=3]="HighResolutionAtmosphere",t[t.SSAO=4]="SSAO",t[t.WaterReflection=5]="WaterReflection",t[t.HighResolutionShadows=6]="HighResolutionShadows",t[t.PhysicalPixelRendering=7]="PhysicalPixelRendering"})(hs||(hs={}));let vs=class extends we{get camera(){const e=this._get("camera");if(!this.ready)return e;const i=KE(this.view,this.view.state.camera,p9);return i&&e&&i.equals(e)?e:i.clone()}set camera(e){this._updatePropertyBeforeReady("camera",e)||(this.view.elevationProvider?.enableElevationCache(!0),this.setStateCamera(Bg(this.view,e),{applyConstraints:!1})||K.getLogger(this).error("#camera=","Invalid camera",e),this.view.elevationProvider?.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const i=KE(this.view,this.view.state.contentCamera,p9);return i&&e&&i.equals(e)?e:i.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const i=Bg(this.view,e);i!=null?(this._updateElevation(i),this.view.state.contentCamera=i):this.view.state.contentCamera=null}installContentCameraReset(e){if(this.removeHandles(f9),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const i=this.zoom,r=this.view.state.camera.distance**2,n=Ta(this.view.state.camera.center),s=e.sticky?this.contentCamera.clone():null;return this.addHandles([ne(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(f9),this.test.contentCameraResetState.clear())}),ne(()=>this.zoom,o=>{o!==void 0&&i!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(o-i)/2),Math.abs(o-i)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s))}),ne(()=>this.view.state.camera,o=>{const a=qs(n,o.center);this.test.contentCameraResetState.set("camera.center",a/r),a>r?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)})],f9),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():K.getLogger(this).error("#center=","Invalid center",e):K.getLogger(this).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e):K.getLogger(this).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,i=sxe(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return i??this._get("extent")}set extent(e){this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||K.getLogger(this).error("#extent=","Invalid extent",e):K.getLogger(this).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e):K.getLogger(this).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get _initialViewpoint(){const e=this.view.map;return e&&"initialViewProperties"in e?e.initialViewProperties?.viewpoint:void 0}get hasInitialView(){return!!this._initialViewpoint}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return wx(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||K.getLogger(this).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,i=e.padding,r=e.pixelRatio,n=this._get("padding"),s=Math.round(i[ii.TOP]/r),o=Math.round(i[ii.RIGHT]/r),a=Math.round(i[ii.BOTTOM]/r),l=Math.round(i[ii.LEFT]/r);return n!=null&&n.top===s&&n.right===o&&n.bottom===a&&n.left===l?n:{top:s,right:o,bottom:a,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,eL),this.view.state.updateCamera(i=>i.padding=eL))}_paddingToArray(e,i,r){e?Gr(r,e.top||0,e.right||0,e.bottom||0,e.left||0):Gr(r,0,0,0,0);for(let n=0;n<4;n++)r[n]=Math.round(r[n]*i)}get screenCenter(){const e=this.padding;return ed((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?p2e(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||K.getLogger(this).error("#viewpoint=","Invalid viewpoint",e);else{const i=e.camera!=null?e.camera.position:e.targetGeometry,r=i!=null&&i.spatialReference;K.getLogger(this).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(r?r.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e)}else K.getLogger(this).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?Cqe(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||K.getLogger(this).error("#zoom=","Invalid zoom",e)}_computeCanvasSize(){if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;const e=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio),i=(this._usePhysicalPixelRendering?this._windowDevicePixelRatio:e)*this.view.resolutionScale;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*i),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*i);const r=this.view._stage.renderView.renderingContext.parameters.maxTextureSize;return Pw(this._tmpCanvasSize,r),this._tmpCanvasSize.pixelRatio=this._tmpCanvasSize.width>0?this._tmpCanvasSize.width/this.view.surface.clientWidth*.5+this._tmpCanvasSize.height/this.view.surface.clientHeight*.5:i,this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)),this._tmpCanvasSize}get _rasterPixelRatio(){return this._devicePixelRatioOverride!=null?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){return this.view?._stage?.renderer.isFeatureEnabled(hs.PhysicalPixelRendering)??!1}get _usePhysicalPixelRenderingAny(){const e=this.view?._stage?.renderer;return e&&(e.isFeatureEnabled(hs.PhysicalPixelRendering,Li.IDLE)||e.isFeatureEnabled(hs.PhysicalPixelRendering,Li.INTERACTING)||e.isFeatureEnabled(hs.PhysicalPixelRendering,Li.ANIMATING))}constructor(e){super(e),this.constraintsManager=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._idleTimeout=uae,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:i=>this._devicePixelRatioOverride=i,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},get updatingIgnoreRenderState(){return this.renderState!=null},get idleTimeoutEnabled(){return this.viewStateManager._idleTimeout>0},set idleTimeoutEnabled(i){this.viewStateManager._idleTimeout=i?uae:0}},this._propertiesPool=new Ry({frustum:U_},this),this._cameraSetByUser=!1,this._gotoOperation=null,this._cameraChangeTime=0,this._tmpCanvasSize=new Aet}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([bo(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),ne(()=>this.view.state?.camera,(e,i)=>this._cameraChangedHandler(e,i),Zi)]),gl(()=>this.view.state?.camera,e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([rx({prepare:()=>this._prepareFrame()}),ne(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(tL)}),bo(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=$e(this._propertiesPool)}init(){this.constraintsManager=new tO({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const i of e)this.set(i.name,i.value);if(!this._cameraSetByUser){const i=this._initialViewpoint||this.view.initialExtent;i&&this.isCompatible(i)?this._setInitialView(i):this.view.state.viewingMode===Le.Local&&this.addHandles(gl(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(tL),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),tL)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(tL),this.constraintsManager=$e(this.constraintsManager))}async goTo(e,i){const r={animate:!0,...i};return this._gotoOperation!=null&&this._gotoOperation.abort(r.animate),this._gotoOperation=new Cet(e,r,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation.promise}debugSetCameraOnContent(){this.setStateCamera(Zx(this.view),{applyConstraints:!1})}step(e){const i=this.view.state,r=i?.cameraController;r&&(i.updateCamera(n=>r.stepController(e,n)),r.steppingFinished&&r.finishController())}_cancelGoToOperation(){this._gotoOperation!=null&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,i=[];for(const{propertyName:r,overrides:n}of Ret){const s=e.has(r),o=this._isOverridden(r);!s&&o&&i.push({name:r,value:this._get(r)}),this._clearOverride(r),(s||o)&&n.forEach(a=>e.add(a))}return i}_setInitialView(e){if(e==null||this._cameraSetByUser)return;if(e instanceof eh)return void this.setStateCamera(Bg(this.view,e),{applyConstraints:!1});if(e instanceof qc){if(e.targetGeometry instanceof zi){const s=BN(this.view,e.targetGeometry,0,.5,la.LOCKED);return void(s!=null&&this.setStateCamera(Bg(this.view,s),{applyConstraints:!0}))}const r={applyConstraints:!e.camera},n=this._viewpointToCamera(e);return void this.setStateCamera(n,r)}const i=BN(this.view,e,0,.5,la.LOCKED);i!=null&&this.setStateCamera(Bg(this.view,i),{applyConstraints:!0})}_updatePropertyBeforeReady(e,i){return!this.ready&&(this._override(e,i),i&&Oet.has(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return e!=null&&(e instanceof qc?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof eh?this.isCompatible(e.position):e.spatialReference&&BO(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=Pet){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,i,r=E0){const{heading:n,tilt:s}=this._getPreservingHeadingTilt(),o=sK(this.view,n,s,e,i,la.ADJUST);return o==null?null:(r.copyFrom(this.view.state.camera),r.eye=o.eye,r.center=o.center,r.up=o.up,r)}_centerToCamera(e){const i=this.view.pointsOfInterest.centerOnContent;i.runTask();const r=i.distance;return this._centerPointAtDistanceToCamera(e,r)}_extentToCamera(e){const{heading:i,tilt:r}=this._getPreservingHeadingTilt(),n=BN(this.view,e,i,r,la.ADJUST,p9);return n?Bg(this.view,n):null}_scaleToCamera(e){if(e==null)return null;const i=this.view.pointsOfInterest.centerOnContent;i.runTask();const r=i.renderLocation,n=i.location.latitude;if(n==null)return null;const s=fU(this.view,e,n);return this._centerPointAtDistanceToCamera(r,s)}_zoomToCamera(e){return this._scaleToCamera(cxe(this.view,e))}_viewpointToCamera(e){return Bg(this.view,u2e(this.view,e))}setStateCamera(e,i){return!(e==null||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,i.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(r=>{i.positionAndOrientationOnly?(r.eye=e.eye,r.center=e.center,r.up=e.up):r.copyFrom(e),i.applyConstraints&&Xn(this.view,r)}),i.applyConstraints||(this.view.state.cameraController=new uR({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:i}=this.view;if(!e||!i)return;this._windowDevicePixelRatio=window.devicePixelRatio;const r=this._computeCanvasSize();if(r.width!==0&&r.height!==0&&(i.width===r.width&&i.height===r.height||(i.width=r.width,i.height=r.height),this.view.state)){const n=this.view.state.camera;n.fullWidth===r.width&&n.fullHeight===r.height&&n.pixelRatio===r.pixelRatio||(E0.copyFrom(n),E0.pixelRatio!==r.pixelRatio&&(this._paddingToArray(this.padding,r.pixelRatio,eL),E0.padding=eL),E0.fullWidth=r.width,E0.fullHeight=r.height,E0.pixelRatio=r.pixelRatio,this.view.state.camera=E0),this._updateViewState()}}_updateElevation(e){const i=this.view.basemapTerrain?.spatialReference,r=this.view.renderCoordsHelper?.getAltitude(e.eye)??0,n=i?pU(this.view,e.eye):0;e.relativeElevation=r-n}_updateViewState(){this.test.renderState!=null?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=Li.ANIMATING:this.view.interacting?this.view.state.mode=Li.INTERACTING:(this.view.state.mode===Li.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<this._idleTimeout?this.view.state.mode=Li.INTERACTING:this.view.state.mode=Li.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(e,i){e&&i&&e.almostEquals(i)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};u([p({type:eh,dependsOn:["view.state.camera","ready"]})],vs.prototype,"camera",null),u([p({type:eh,dependsOn:["view.state.contentCamera","ready"]})],vs.prototype,"contentCamera",null),u([p({type:ut})],vs.prototype,"center",null),u([p({type:zi})],vs.prototype,"extent",null),u([p({readOnly:!0})],vs.prototype,"frustum",null),u([p()],vs.prototype,"_initialViewpoint",null),u([p({readOnly:!0})],vs.prototype,"hasInitialView",null),u([p({readOnly:!0,type:Boolean})],vs.prototype,"ready",void 0),u([p({type:Number})],vs.prototype,"scale",null),u([p()],vs.prototype,"padding",null),u([p({readOnly:!0})],vs.prototype,"screenCenter",null),u([p({constructOnly:!0})],vs.prototype,"view",void 0),u([p({type:qc})],vs.prototype,"viewpoint",null),u([p({type:Number})],vs.prototype,"zoom",null),u([p({readOnly:!0})],vs.prototype,"_rasterPixelRatio",null),u([p({readOnly:!0})],vs.prototype,"_usePhysicalPixelRendering",null),u([p({readOnly:!0})],vs.prototype,"_usePhysicalPixelRenderingAny",null),u([p()],vs.prototype,"_windowDevicePixelRatio",void 0),u([p()],vs.prototype,"_devicePixelRatioOverride",void 0),vs=u([M("esri.views.3d.state.ViewStateManager")],vs);let Aet=class{constructor(){this.width=0,this.height=0,this.pixelRatio=1}};const Oet=new Set(["camera","viewpoint","extent","scale","center","zoom"]),Ret=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],Pet={heading:0,tilt:0},p9=new eh,E0=new ft,eL=oi(),tL="pending-initial-view",f9="content-camera-reset",uae=300,hae=100;let lm=class extends Wg{constructor(){super(...arguments),this.startCamera=new ft,this.currentCamera=new ft,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<hae}stepController(e,i){i.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(i)}onControllerStart(e){this.state=on.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),hae),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};u([p({readOnly:!0})],lm.prototype,"isInteractive",null),u([p()],lm.prototype,"_lastInteraction",void 0),lm=u([M("esri.views.3d.state.controllers.InteractiveController")],lm);var Oc;(function(t){t[t.CENTER=0]="CENTER",t[t.EYE=1]="EYE"})(Oc||(Oc={}));let hR=class extends lm{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=Oc.CENTER,this._rotScale=0,this._lastPoint=Ge(),this._tmpWorldUp=E(),this._tmpViewDir=E(),this._tmpRotCurPoint=Ge(),this._tmpTransf=be(),this._tmpAxis=E(),this._tmpPivotPoint=E(),this._pivotPos=E(),this._constraintOptions={selection:Ur.ALL,interactionType:Qt.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:wo.TUMBLE}}initialize(){this._rotScale=this.pivot===Oc.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case Oc.EYE:oe(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=Qt.LOOK_AROUND,this._constraintOptions.tiltMode=wo.LOOK_AROUND,this._constraintOptions.selection=Ur.NONE;break;case Oc.CENTER:{const i=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?eT:{});i||oe(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,i),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=Qt.TUMBLE,this._constraintOptions.tiltMode=wo.TUMBLE,this._constraintOptions.selection=Ur.ALL&~Ur.DISTANCE;break}}this._constraintOptions.interactionStartCamera=this.startCamera,Yw(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,i){const r=this.startCamera,n=E();de(n,this._pivotPos,r.eye);const s=xe(n),o=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(r.eye,dae);let a=Math.max(Math.min(DQe,1/Math.abs(ge(dae,r.viewForward)))*o,NQe);i&&(a=Math.min(s,a));const l=Wi(this.view.spatialReference),c=cn(r.width/r.pixelRatio*.5,r.height/r.pixelRatio*.5),h=DU(this.startCamera,c,l);let d=this.view._stage.renderView.getMinimalDepthForArea(MP(this.view),r.fullWidth/r.pixelRatio*.5,r.fullHeight/r.pixelRatio*.5,r,2.5*s9,s9),f=this.view._stage.renderView.getMinimalDepthForArea(MP(this.view),e[0],e[1],r,s9);d==null&&f==null||(d=d??f??0,f=f==null||h===yo.Horizontal?d:f,a=d>f?f:d,a=i?Math.min(a,s):a),ye(n,n),oe(this._pivotPos,ue(this._tmpPivotPoint,r.eye,re(this._tmpPivotPoint,n,a)))}update(e){if(this.active){switch(this.pivot){case Oc.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case Oc.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}Xn(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,i,r,n){this.view.renderCoordsHelper.worldUpAtPosition(n,this._tmpWorldUp),Yw(e,i,this._tmpRotCurPoint);let s=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,o=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;de(this._tmpViewDir,r,n);const a=xe(this._tmpViewDir),l=Ys(ge(this._tmpViewDir,this._tmpWorldUp)/a);if(this.pivot===Oc.EYE){s*=-.5;const c=.5*Math.PI-l,h=.5*Math.PI*.99;s=c-Math.max(-h,Math.min(h,c+s))}return s=_e(s+l,ia.min,ia.max)-l,lt(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===Oc.CENTER&&(o=-o),Qu(this._tmpTransf,o,this._tmpWorldUp),Fc(this._tmpTransf,this._tmpTransf,s,this._tmpAxis),ke(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=ke(m9,e.up,this._tmpTransf),ue(m9,n,this._tmpViewDir),gs(this._lastPoint,this._tmpRotCurPoint),m9}};u([p()],hR.prototype,"pivot",void 0),hR=u([M("esri.views.3d.state.controllers.RotateController")],hR);const m9=E(),dae=E();let g9=class extends Ho{constructor(e,i,r,n){super(!0),this._view=e,this.pointerAction=i,this._pivot=r,this.registerIncoming("drag",n,s=>this._handleDrag(s))}_handleDrag(e){const i=e.data;if(i.pointers.size>1||!rQ(e.data,this.pointerAction))return;const r=cn(i.center.x,i.center.y);switch(i.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new hR({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}},zq=class extends lm{constructor(){super(...arguments),this._pickPoint=E(),this._tmpP0=Ge(),this._panAxisAngle=IU(),this._tmpRayDir=E(),this._tmpRayDirPick=E(),this._targetOnSphere=E(),this._navMode=yo.Horizontal,this._tmpRay={origin:E(),direction:E()},this.dragBeginPoint=cn(),this._normalizedAnchorPoint=Ge(),this._constraintOptions={selection:Ur.ALL_EXCEPT_COLLISION,interactionType:Qt.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:wo.TUMBLE},this._sphere=kn(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;gs(this.dragBeginPoint,e),Yw(this.startCamera,e,this._normalizedAnchorPoint);const i=Wi(this.view.spatialReference),r=QSe(this._intersectionHelper,this.startCamera,e,i,rC.Ellipsoid,this.view.map.ground.opacity===0?eT:{});if(this._navMode=DU(this.startCamera,e,i),this._navMode===yo.Horizontal)this._hasPickPoint=!!r.scenePickPoint,this._pickPoint=r.scenePickPoint??this._pickPoint,this._sphere=r.sphere;else{let n;zC(this.startCamera,e,this._tmpRay),ye(this._tmpRay.direction,this._tmpRay.direction),r.scenePickPoint!=null&&(de(this._tmpRayDirPick,this.startCamera.eye,r.scenePickPoint),n=xe(this._tmpRayDirPick));const s=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,pae);let o=_e(Math.min(HSe,1/Math.abs(ge(pae,this._tmpRay.direction)))*s,PF[0],PF[1]);const a=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,LU);o=a??o,o=n!=null?Math.min(o,n):o,this._hasPickPoint=!0,re(this._tmpRay.direction,this._tmpRay.direction,o),ue(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===yo.Horizontal){de(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const i=xe(this._tmpRayDir);Yw(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let n=i*2**r;const s=this.view.state.constraints.minimumPoiDistance;if(r<0&&n<s&&(n=s),Math.abs(i-n)<1e-6)return;if(this._hasPickPoint&&n<i){const o=1-(1-n/i)*(1-this._sphere[3]/xe(this.currentCamera.center));this.currentCamera.center=re(iL,this.currentCamera.center,o)}re(this._tmpRayDir,this._tmpRayDir,-n/i),this.currentCamera.eye=ue(iL,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=hp(Iv(this.dragBeginPoint,e)),Xn(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(PP(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),ZK(this._pickPoint,this._targetOnSphere,this._panAxisAngle),zv(this.currentCamera,this._sphere,this._panAxisAngle))}else{const i=xe(this._tmpRay.direction);Yw(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let n=i*2**r;const s=this.view.state.constraints.minimumPoiDistance;if(r<0&&n<s&&(n=s),Math.abs(i-n)<1e-6)return;re(this._tmpRayDir,this._tmpRay.direction,1-n/i),this.currentCamera.eye=ue(iL,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=ue(iL,this.currentCamera.center,this._tmpRayDir)}UC(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};zq=u([M("esri.views.3d.state.controllers.global.ZoomController")],zq);const iL=E(),pae=E();let Bq=class extends lm{constructor(){super(...arguments),this._tmpP=E(),this._tmpDir=E(),this._tmpN=E(),this._tmpP0=Ge(),this._tmpPoi=E(),this._tmpRayDir=E(),this.dragBeginPoint=cn(),this._normalizedAnchorPoint=Ge(),this._constraintOptions={selection:Ur.ALL,interactionType:Qt.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:E(),tiltMode:wo.TUMBLE},this._plane=Ii()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;gs(this.dragBeginPoint,e),Yw(this.startCamera,e,this._normalizedAnchorPoint);const i=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?eT:{});de(this._tmpDir,this._tmpP,this.startCamera.eye);const r=xe(this._tmpDir);ye(this._tmpDir,this._tmpDir);const n=Math.abs(this.view.camera.position.z);let s=_e(Math.min(HSe,1/Math.abs(ge(Met,this._tmpDir)))*n,PF[0],PF[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(MP(this.view),e[0],e[1],this.view.state.camera,LU);s=o??s,s=i?Math.min(s,r):s,re(this._tmpDir,this._tmpDir,s),ue(this._tmpP,this.startCamera.eye,this._tmpDir),de(this._tmpN,this.startCamera.eye,this.startCamera.center),ye(this._tmpN,this._tmpN),this._tmpN[1]<0&&Pa(this._tmpN,this._tmpN),IM(this._tmpP,this._tmpN,this._plane),this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;FQe(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||oe(this._tmpPoi,this.currentCamera.center),Yw(this.currentCamera,e,this._tmpP0);let i=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);gs(this._normalizedAnchorPoint,this._tmpP0),de(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const r=xe(this._tmpRayDir);let n=r*(1-i);this._constraintOptions.interactionDirection&&(oe(this._constraintOptions.interactionDirection,this._tmpRayDir),re(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(i)/r));const s=this.view.state.constraints.minimumPoiDistance;i>=0&&n<s&&(n=s,i=-(n-r)/r),Math.abs(r-n)<1e-6||(re(this._tmpRayDir,this._tmpRayDir,i),this.currentCamera.eye=ue(O1,this.currentCamera.eye,this._tmpRayDir),Xi(O1,this.currentCamera.center,this._tmpPoi,i),this._tmpPoi[2]>this.startCamera.center[2]?O1[2]=Math.max(this.startCamera.center[2],O1[2]):O1[2]=Math.min(this.startCamera.center[2],O1[2]),this.currentCamera.center=O1,this._constraintOptions.interactionFactor=hp(Iv(this.dragBeginPoint,e)),Xn(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};Bq=u([M("esri.views.3d.state.controllers.local.ZoomController")],Bq);const O1=E(),Met=Oe(0,0,1);let $et=class extends Ho{constructor(e,i,r){super(!0),this._view=e,this.pointerAction=i,this.registerIncoming("drag",r,n=>this._handleDrag(n))}_handleDrag(e){const i=e.data;if(i.pointers.size>1||!rQ(e.data,this.pointerAction))return;const r=cn(i.center.x,i.center.y);switch(i.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new zq({view:this._view}):this._cameraController=new Bq({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}};function xd(t){let e=t*t;return t<0&&(e*=-1),e}function fae(t,e,i){const r=i,n=t.state,s=t.device,o=e.tiltDirection==="forward-down"?1:-1,a=1;return s.deviceType==="standard"?(r.translation[0]=xd(n.axes[0]),r.translation[1]=xd(n.axes[1]),r.translation[2]=xd(n.buttons[7])-xd(n.buttons[6]),r.heading=xd(n.axes[2]),r.tilt=xd(n.axes[3])):s.deviceType==="spacemouse"&&(r.translation[0]=1.2*xd(n.axes[0]),r.translation[1]=1.2*xd(n.axes[1]),r.translation[2]=2*-xd(n.axes[2]),r.heading=1.2*xd(n.axes[5]),r.tilt=1.2*xd(n.axes[3])),r.tilt*=o,re(r.translation,r.translation,a),r}function mae(t,e){const i=e;return i.translation[0]=t[1]-t[0],i.translation[1]=t[3]-t[2],i.translation[2]=t[4]-t[5],i.heading=t[7]-t[6],i.tilt=t[8]-t[9],i.zoom=t[10]-t[11],i}function y9(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}let Mw=class extends lm{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new ft,this._headingStart=0,this._constraintOptions={selection:Ur.ALL,interactionType:Qt.NONE,interactionStartCamera:new ft,interactionFactor:0,interactionDirection:null,tiltMode:wo.LOOK_AROUND}}handleEventGamepad(e){const i=fae(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||y9(i))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,mae(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;const i=mae(this._keysButtonState,this._transformation);y9(i)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const i=this.view.pointsOfInterest.cameraOnSurface.location.z,r=1;this._filteredSurfaceElevation+=r*(i-this._filteredSurfaceElevation)*e}stepController(e,i){this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(i),this._updateCameraCenter(),this._constraintOptions.interactionStartCamera?.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,R1),this._applyDisabledMovementTypes(R1),this._applyPan(R1.pan),this._applyRotate(R1.rotate),this._applyZoom(R1.zoom),this._applyAscend(R1.ascend),this._constraintOptions.interactionType=Qt.NONE,this._constraintOptions.selection=Ur.COLLISION,Xn(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,i)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const i=this.currentCamera;de(bl,i.center,i.eye),ke(bl,bl,e.matrix),i.center=ue(bl,bl,i.eye),i.up=ke(bl,i.up,e.matrix),this._constraintOptions.interactionType=Qt.LOOK_AROUND,this._constraintOptions.selection=Ur.ALL_EXCEPT_COLLISION,Xn(this.view,i,this._constraintOptions)}_applyPan(e,i=this.currentCamera){e.enabled&&(i.eye=ke(bl,i.eye,e.matrix),i.center=ke(bl,i.center,e.matrix),this.view.state.isGlobal&&(i.up=ke(bl,i.up,e.matrix)),this._constraintOptions.interactionType=Qt.PAN,this._constraintOptions.selection=Ur.ALL,Xn(this.view,i,this._constraintOptions))}_applyZoom(e){if(!e)return;const i=this.currentCamera.viewForward;this.currentCamera.eye=ue(bl,this.currentCamera.eye,re(Ne.get(),i,e)),oe(SA,i),Pa(SA,SA),this._constraintOptions.interactionDirection=SA,this._constraintOptions.interactionType=Qt.ZOOM,this._constraintOptions.selection=Ur.ALL_EXCEPT_COLLISION,Xn(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const i=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Ne.get());if(this._constraintOptions.interactionDirection=oe(SA,i),this.view.state.isGlobal){const r=xe(this.currentCamera.eye),n=(r+e)/r;this.currentCamera.eye=re(bl,this.currentCamera.eye,n),this.currentCamera.center=re(bl,this.currentCamera.center,n)}else{const r=re(Ne.get(),i,e);this.currentCamera.eye=ue(bl,this.currentCamera.eye,r),this.currentCamera.center=ue(bl,this.currentCamera.center,r)}this._updateCameraCenter(),this._constraintOptions.interactionType=Qt.ASCEND,this._constraintOptions.selection=Ur.COLLISION,Xn(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=Ur.ALL_EXCEPT_COLLISION,Xn(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,i,r){Uet(r);const n=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(n,i,r):this._calculateControlTransformationGlobal(n,i,r)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,i=this.view.renderCoordsHelper,r=this.currentCamera.ray;this.currentCamera.center=i.intersectManifoldClosestSilhouette(r,e,bl)}_calculateControlTransformationLocal(e,i,r){const{viewRight:n,viewForward:s}=i,o=this._transformation,a=this.view.navigation.gamepad,l=ae(Ne.get(),s[0],s[1],0);ye(l,l);const c=o.translation[0]*e.pan;if(c!==0){const _=re(Ne.get(),n,c);Kl(r.pan.matrix,r.pan.matrix,_),r.pan.enabled=!0}switch(a.mode){case"pan":{const _=-o.translation[1]*e.pan;if(_!==0){const v=re(Ne.get(),l,_);Kl(r.pan.matrix,r.pan.matrix,v),r.pan.enabled=!0}r.zoom=o.zoom*e.zoom;break}case"zoom":r.zoom=(-o.translation[1]+o.zoom)*e.zoom;break;default:a.mode}const h=o.translation[2]*e.ascend;r.ascend=h;const d=-o.heading*e.rotate;d!==0&&(Fc(r.rotate.matrix,r.rotate.matrix,d,this.view.renderCoordsHelper.worldUpAtPosition(i.eye,Ne.get())),r.rotate.enabled=!0);const f=o.tilt*e.rotate,m=Uv(this.view.renderCoordsHelper,i.center,i.eye),y=_e(m+f,ia.min,ia.max)-m;y&&(Fc(r.rotate.matrix,r.rotate.matrix,y,n),r.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,i,r){const{eye:n,viewRight:s}=i,o=this._transformation,a=this.view.navigation.gamepad,l=lt(Ne.get(),s,n);ye(l,l),Pa(l,l),GQe(this.startCamera,i,o,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,r,a),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(R1.pan,this._tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,h=o.translation[2]*e.ascend;r.ascend=h;const d=-o.heading*e.rotate;d!==0&&(Fc(r.rotate.matrix,r.rotate.matrix,d,this._tmpCamera.eye),r.rotate.enabled=!0);const f=o.tilt*e.rotate,m=this._clampTiltDeltaGlobalToValidRange(f,i.ray,c);m!==0&&(Fc(r.rotate.matrix,r.rotate.matrix,m,this._tmpCamera.viewRight),r.rotate.enabled=!0),r.zoom+=o.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,i,r){const n=Wi(this.view.spatialReference),s=o4(ia.min,i.origin,r,n);let o=0,a=0;const l=Ne.get();if(this.view.renderCoordsHelper.intersectManifold(i,r,l)){const c=Uv(this.view.renderCoordsHelper,l,i.origin);o=o4(c,i.origin,r,n),a=o4(ia.max,i.origin,r,n)}else{IC(eU(tU,r+n.radius),i,l);const c=Math.PI+Q6(i.direction,l);o=Zoe(c,i.origin,r,n),a=Zoe(ia.max,i.origin,r,n)}return _e(o+e,s,a)-o}_getPointAbsoluteSurfaceElevation(e,i,r){const{renderCoordsHelper:n}=this.view,s=n.getAltitude(e),o=i+Math.abs(s-i);return n.setAltitude(r,o,e),o}_clampedDistanceToSurface(e,i){const{renderCoordsHelper:r}=this.view,{camera:n}=this.view.state,{direction:s}=yqe(this.view,i,0,y2e,ket),o=r.intersectManifoldClosestSilhouette(th(i,s),e,Ne.get()),a=Mr(i,o),l=r.intersectManifoldClosestSilhouette(th(i,Fy(Ne.get(),i,n.center)),e,Ne.get()),c=Mr(i,l);return Math.min(a,c)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:i,state:r}=this.view,{camera:n,isGlobal:s}=r,o=i.intersectManifoldClosestSilhouette(n.ray,this._filteredSurfaceElevation,Ne.get());if(s){const a=de(Ne.get(),e,o),l=xe(a);re(a,a,1/l);const c=ye(Ne.get(),e),h=Ys(ge(c,a));return l*Math.sin(Math.min(Let,h))}{const a=oe(Ne.get(),e);return i.setAltitude(a,this._filteredSurfaceElevation),Mr(o,a)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:Det}_computeVelocities(e){const i=this._filteredSurfaceElevation,r=i+Wi(this.view.spatialReference).radius,{camera:n,isGlobal:s}=this.view.state,o=Ne.get(),a=this._getPointAbsoluteSurfaceElevation(n.eye,i,o),l=this._clampedDistanceToSurface(i,o),c=n.width/2,h=gae*n.width,d=gae*n.width,f=l*Math.tan(.5*n.fovX)/c,m=f/r,y=f/this._computeHeadingRotateRadius(o),_=a-i;return{pan:(s?m:f)*h*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(h*e/c)*_-_),zoom:2**(h*e/c)*l-l,rotate:_e(y*d,Net,Fet)*e}}_applyDisabledMovementTypes(e){this.disableMovements==null||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&td(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&td(e.rotate.matrix))}static activatesFor(e,i){const r=fae(i,e.navigation.gamepad,Iet);return!(i.action==="end"||y9(r))}};u([p({constructOnly:!0})],Mw.prototype,"gamepadDevice",void 0),u([p({constructOnly:!0})],Mw.prototype,"disableMovements",void 0),Mw=u([M("esri.views.3d.state.controllers.GamepadKeyboardController")],Mw);const Iet={translation:[0,0,0],heading:0,tilt:0,zoom:0},y2e=80,Let=Dt(y2e),gae=.75,Det=5,Net=Dt(30),Fet=Dt(80),R1={zoom:0,ascend:0,pan:{enabled:!1,matrix:be()},rotate:{enabled:!1,matrix:be()}},bl=E(),SA=E(),ket=rK();function Uet(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,td(t.pan.matrix),t.rotate.enabled=!1,td(t.rotate.matrix)}let zet=class extends Ho{constructor(e){super(!0),this._view=e,this._watchHandles=new Ny,this._handle=this.registerIncoming("gamepad",i=>this._handleEventGamepad(i)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([ne(()=>this._view.navigation.gamepad.enabled,i=>{i?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},Xt),ne(()=>this._view.navigation.gamepad.device,i=>{this._cameraControllerGamepad&&i&&this._cameraControllerGamepad.gamepadDevice!==i&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){const i=this._view.navigation.gamepad.device;if(i&&e.data.device!==i)return;const r=this._cameraControllerGamepad&&this._cameraControllerGamepad.active;if(r||Mw.activatesFor(this._view,e.data)){if(!r){const n=new Mw({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(n)&&(this._cameraControllerGamepad=n)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}};function Bet(t){const e=()=>t(document.visibilityState==="visible");return document.addEventListener("visibilitychange",e),{remove:()=>document.addEventListener("visibilitychange",e)}}var bc;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.FORWARD=2]="FORWARD",t[t.BACKWARD=3]="BACKWARD",t[t.UP=4]="UP",t[t.DOWN=5]="DOWN",t[t.HEADINGLEFT=6]="HEADINGLEFT",t[t.HEADINGRIGHT=7]="HEADINGRIGHT",t[t.TILTUP=8]="TILTUP",t[t.TILTDOWN=9]="TILTDOWN",t[t.ZOOMIN=10]="ZOOMIN",t[t.ZOOMOUT=11]="ZOOMOUT"})(bc||(bc={}));let Vet=class extends Ho{constructor(e,i){super(!0),this._view=e,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:Le.Local},this._keyToNumber={[i.left]:bc.LEFT,[i.right]:bc.RIGHT,[i.forward]:bc.FORWARD,[i.backward]:bc.BACKWARD,[i.up]:bc.UP,[i.down]:bc.DOWN,[i.headingLeft]:bc.HEADINGLEFT,[i.headingRight]:bc.HEADINGRIGHT,[i.tiltUp]:bc.TILTUP,[i.tiltDown]:bc.TILTDOWN,[i.zoomIn]:bc.ZOOMIN,[i.zoomOut]:bc.ZOOMOUT},this.registerIncoming("key-down",null,r=>this._handleKeyDown(r)),this.registerIncoming("key-up",null,r=>this._handleKeyUp(r)),this.registerIncoming("blur",null,()=>this._handleStop()),this._visibilityHandle=Bet(r=>r?null:this._handleStop())}onUninstall(){this._visibilityHandle?.remove(),this._handleStop()}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const i=this._keyToNumber[e.data.key];i!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new Mw({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(i),e.stopPropagation()))}_handleStop(){this._cameraControllerKeyboard?.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const i=this._keyToNumber[e.data.key];i!=null&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(i),e.stopPropagation())}},Get=class extends Ho{constructor(e,i){super(!0),this._view=e,this.registerIncoming("mouse-wheel",i,r=>this._handleMouseWheel(r))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled)return;const i=e.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new LF({view:this._view,mode:"interaction"}):new DF({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*i.deltaY,cn(i.x,i.y)),e.preventDefault(),e.stopPropagation()}},kF=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},Cx=class extends OP{constructor(){super(...arguments),this._beginCamera=new ft,this._elapsedTimeSec=0,this.constraintOptions={selection:Ur.ALL,interactionType:Qt.PAN,interactionFactor:0,interactionStartCamera:new ft,interactionDirection:null,tiltMode:wo.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new QE}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this._beginCamera,super.onControllerStart(e)}stepController(e,i){i.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,i),Xn(this.view,i,this.constraintOptions)}};Cx=u([M("esri.views.3d.state.controllers.momentum.MomentumController")],Cx);let dR=class extends Cx{constructor(e){super(e),this.interactionType=Qt.PAN,this._tmpPan=E()}momentumStep(e,i){const r=this.momentum.value(e);re(this._tmpPan,this.momentum.direction,r),i.eye=de(yae,i.eye,this._tmpPan),i.center=de(yae,i.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};u([p({constructOnly:!0})],dR.prototype,"momentum",void 0),dR=u([M("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],dR);const yae=E(),jet=E(),rL=E();let c4=class extends Cx{constructor(e){super(e),this.interactionType=Qt.PAN}momentumStep(e,i){const r=this.momentum.value1(e),n=this.momentum.value2(e);oe(rL,i.eye),ye(rL,rL),lt(this.momentum.axis2,rL,this.momentum.axis1),r2e(i,jet,this.momentum.axis1,r,this.momentum.axis2,n)}};u([p({constructOnly:!0})],c4.prototype,"momentum",void 0),c4=u([M("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],c4);let mw=class extends Cx{set center(e){this._set("center",Qr(e))}set axis(e){this._set("axis",Qr(e))}constructor(e){super(e),this.interactionType=Qt.TUMBLE}momentumStep(e,i){const r=this.momentum.value(e);zv(i,this.center,RP(this.axis,r))}};u([p({constructOnly:!0})],mw.prototype,"momentum",void 0),u([p({constructOnly:!0})],mw.prototype,"center",null),u([p({constructOnly:!0})],mw.prototype,"axis",null),mw=u([M("esri.views.3d.state.controllers.momentum.MomentumController")],mw);let I2=class extends Cx{set zoomCenter(e){this._set("zoomCenter",Qr(e))}constructor(e){super(e),this.interactionType=Qt.ZOOM,this.constraintOptions.interactionDirection=E()}momentumStep(e,i){const{interactionDirection:r}=this.constraintOptions;if(!r)return;oe(r,i.eye);const n=this.momentum.valueDelta(0,e);eQ(i,this.zoomCenter,n,this.view.state.constraints.minimumPoiDistance),Fy(r,i.eye,r)}};u([p({constructOnly:!0})],I2.prototype,"momentum",void 0),u([p({constructOnly:!0})],I2.prototype,"zoomCenter",null),I2=u([M("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],I2);let Nb=class extends Cx{set screenCenter(e){this._set("screenCenter",cn(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",Qr(e))}constructor(e){super(e),this.interactionType=Qt.ZOOM,this.radius=0,this._tmpSceneCenter=E(),this._tmpZoomAxisAngle=IU(),this._sphere=kn()}initialize(){this._sphere[3]=this.radius}momentumStep(e,i){const r=this.momentum.valueDelta(0,e);JSe(this._sphere,i,r),this.constraintOptions.interactionType=Qt.ZOOM,Xn(this.view,i,this.constraintOptions),PP(this._sphere,i,this.screenCenter,this._tmpSceneCenter),ZK(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),zv(i,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=Qt.PAN}};u([p({constructOnly:!0})],Nb.prototype,"momentum",void 0),u([p({constructOnly:!0})],Nb.prototype,"screenCenter",null),u([p({constructOnly:!0})],Nb.prototype,"sceneCenter",null),u([p({constructOnly:!0})],Nb.prototype,"radius",void 0),Nb=u([M("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],Nb);let dp=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const i=this.computeDelta(e);this._updateDelta(i)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},FU=class{constructor(e,i,r){this._initialVelocity=e,this._stopVelocity=i,this._friction=r,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,i){const r=this.value(e);return this.value(e+i)-r}valueFromInitialVelocity(e,i){i=Math.min(i,this.duration);const r=1-this.friction;return e*(r**i-1)/Math.log(r)}},Het=class extends FU{constructor(e,i,r,n,s){super(e,i,r),this._sceneVelocity=n,this.direction=s}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},_2e=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._time=new dp(.6),this._screen=[new dp(.4),new dp(.4)],this._scene=[new dp(.6),new dp(.6),new dp(.6)],this._tmpDirection=E()}add(e,i,r){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(r)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(i[0]),this._scene[1].update(i[1]),this._scene[2].update(i[2]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?0:Math.sqrt(e*e+i*i),n=this._time.filteredDelta,s=n==null||r==null?0:r/n;return Math.abs(s)<this._minimumInitialVelocity?null:this.createMomentum(s,this._stopVelocity,this._friction)}createMomentum(e,i,r){ae(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const n=xe(this._tmpDirection);n>0&&re(this._tmpDirection,this._tmpDirection,1/n);const s=this._time.filteredDelta;return new Het(e,i,r,s==null?0:n/s,this._tmpDirection)}},_ae=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const vae=1e-5;let qet=class extends FU{constructor(e,i,r,n,s,o=0,a){super(e,i,r),this._angularVelocity1=n,this.axis1=s,this.angularVelocity2=o,this.axis2=a}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},Wet=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._tmpAxis1=E(),this._tmpAxis2=E(),this._tmpAngles=Ge(),this._time=new dp(.3),this._screen=[new dp(.4),new dp(.4)],this._angle1=new _ae(.6),this._angle2=new _ae(.6),this._axis1=E(),this._axis2=E(),this._lastScene=E()}addMomentumDirectRotation(e,i,r,n,s,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;let a=t2e(this._lastScene,i,this._tmpAxis2,n,s,o);this._angle2.update(0),na(this._tmpAxis2)<vae?a=0:ye(this._axis1,this._tmpAxis2),this._angle1.update(a),oe(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}addMomentumPreserveHeading(e,i,r,n,s,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;i2e(this._lastScene,i,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,n,s,o,a,!1),na(this._tmpAxis2)<vae?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),ye(this._axis1,this._tmpAxis1),ye(this._axis2,this._tmpAxis2)),oe(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?null:Math.sqrt(e*e+i*i),n=this._time.filteredDelta,s=r==null||n==null?0:r/n;return Math.abs(s)<this._minimumInitialVelocity?null:this.createMomentum(s,this._stopVelocity,this._friction)}createMomentum(e,i,r){const n=this._time.filteredDelta,s=this._angle1.filteredValue,o=this._angle2.filteredValue,a=n==null||o==null?0:o/n;return new qet(e,i,r,n==null||s==null?0:s/n,this._axis1,a,this._axis2)}},v2e=class{constructor(e=2.5,i=.01,r=.95,n=12){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this._maxVelocity=n,this.enabled=!0,this.value=new dp(.8),this.time=new dp(.3)}add(e,i){if(this.enabled&&i!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(i)<.01)return;if(this.value.hasFilteredDelta()){const r=this.value.computeDelta(e);this.value.filteredDelta*r<0&&this.value.reset()}}this.time.update(i),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=_e(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,i,r){return new FU(e,i,r)}},b2e=class extends v2e{constructor(e=3,i=.01,r=.95,n=12){super(e,i,r,n)}add(e,i){const r=this.value.lastValue;if(r!=null){let n=e-r;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;e=r+n}super.add(e,i)}},Yet=class extends FU{constructor(e,i,r){super(e,i,r)}value(e){const i=super.value(e);return Math.exp(i)}valueDelta(e,i){const r=super.value(e),n=super.value(e+i)-r;return Math.exp(n)}},w2e=class extends v2e{constructor(e=2.5,i=.01,r=.95,n=12){super(e,i,r,n)}add(e,i){super.add(Math.log(e),i)}createMomentum(e,i,r){return new Yet(e,i,r)}},Vq=class extends lm{constructor(){super(...arguments),this._smoothRotation=new kF(.05),this._rotationAxis=E(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=Ii(),this._beginRadius=0,this._smoothScaling=new kF(.05),this._zoomCenterScreen=cn(),this._zoomMomentumEstimator=new w2e,this._rotationMomentumEstimator=new b2e,this._panSphericalMomentumEstimator=new Wet,this._panPlanarMomentumEstimator=new _2e,this._adjustedSphere=kn(),this._tmp3d=E(),this._tmpScreenPointArray=cn(),this._beginScreenPoint=cn(),this._beginScenePoint=E(),this._screenPickPoint=cn(),this._scenePickPoint=E(),this._mode=yo.Horizontal,this._sphere=kn(),this._pointerCount=0,this._tmpInteractionDirection=E(),this._constraintOptions={selection:Ur.ALL,interactionType:Qt.NONE,interactionFactor:0,interactionStartCamera:new ft,interactionDirection:null,tiltMode:wo.TUMBLE}}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const i=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=i,this._rotationMomentumEstimator.enabled=i,this._panPlanarMomentumEstimator.enabled=i,this._panSphericalMomentumEstimator.enabled=i,this._beginHeading=-xv.normalize(Dt(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),fp(e.center,this._screenPickPoint),gs(this._beginScreenPoint,this._screenPickPoint);const r=Wi(this.view.spatialReference),n=QSe(this._intersectionHelper,this.startCamera,this._screenPickPoint,r,rC.Silhouette,this.view.map.ground.opacity===0?eT:{});n.scenePickPoint!=null&&(this._scenePickPoint=n.scenePickPoint,this._sphere=n.sphere,oe(this._beginScenePoint,this._scenePickPoint),this._mode=DU(this.startCamera,this._screenPickPoint,r),this._mode===yo.Vertical&&this._preparePlanarPanMode(e,n.hasGeometryIntersection),this._constraintOptions.interactionStartCamera?.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1;this._mode===yo.Horizontal?(i&&this._zoomSpherical(e),this._panningSpherical(e),i&&this._rotateSpherical(e)):(i&&this._zoomPlanar(e),this._panningPlanar(e),i&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return this._mode===yo.Horizontal?new Nb({view:this.view,momentum:i,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new I2({view:this.view,momentum:i,zoomCenter:this._beginScenePoint});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new mw({view:this.view,momentum:r,center:this._sphere,axis:this._rotationAxis});if(this._mode===yo.Horizontal){const n=this._panSphericalMomentumEstimator.evaluateMomentum();if(n)return new c4({view:this.view,momentum:n})}else{const n=this._panPlanarMomentumEstimator.evaluateMomentum();if(n)return new dR({view:this.view,momentum:n})}return null}_preparePlanarPanMode(e,i){const r=Pa(this._tmp3d,this.startCamera.viewForward);IM(this._scenePickPoint,r,this._panningPlane);const n=cn(this._screenPickPoint[0],0),s=E(),o=xe(this.startCamera.eye);this._adjustedSphere[3]=o<this._sphere[3]?o-100:this._sphere[3],PP(this._adjustedSphere,this.startCamera,n,s);const a=aa();this.startCamera.projectToRenderScreen(s,a);const l=E(),c=E(),h=E();de(l,this._scenePickPoint,this.currentCamera.eye);const d=xe(l);ye(l,l);const f=XSe*Math.max(Math.abs(this.view.camera.position.z),ZSe),m=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,LU);let y=m??f;y=i?Math.min(y,d):y,oe(h,ue(c,this.currentCamera.eye,re(c,l,y))),this._panningPlane[3]=-ge(this._panningPlane,h),this.startCamera.center=ue(c,this.startCamera.eye,re(c,this.startCamera.viewForward,y));const _=fp(e.center,this._tmpScreenPointArray);kq(this._panningPlane,this.startCamera,_,this._beginScenePoint)}_zoomSpherical(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),JSe(this._sphere,this.currentCamera,this._smoothScaling.value),fp(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=Qt.ZOOM,this._constraintOptions.interactionFactor=hp(e.radius-this._beginRadius),Xn(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const i=fp(e.center,this._tmpScreenPointArray);PP(this._sphere,this.currentCamera,i,this._tmp3d),tQ(this._beginScenePoint,ge(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(s2e(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(n2e(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=Qt.PAN,this._constraintOptions.interactionFactor=hp(Iv(this._screenPickPoint,i)),Xn(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){ye(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||Pa(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value,r=i+Fq(e.angle-i),n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(r);const s=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(s,.001*e.timestamp),zv(this.currentCamera,this._sphere,RP(this._rotationAxis,s)),this._constraintOptions.interactionType=Qt.TUMBLE,this._constraintOptions.interactionFactor=hp(e.radius*r),Xn(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const i=fp(e.center,this._tmpScreenPointArray);kq(this._panningPlane,this.currentCamera,i,this._tmp3d)&&(e2e(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(i,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=Qt.PAN,this._constraintOptions.interactionFactor=hp(Iv(this._beginScreenPoint,i)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),Xn(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),eQ(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=Qt.ZOOM,this._constraintOptions.interactionFactor=hp(e.radius-this._beginRadius),Xn(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){oe(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||Pa(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value;let r=e.angle-i;r=Fq(r);const n=i+r,s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(n);const o=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(o,.001*e.timestamp),zv(this.currentCamera,this._sphere,RP(this._rotationAxis,o)),this._constraintOptions.interactionType=Qt.TUMBLE,this._constraintOptions.interactionFactor=hp(e.radius*o),Xn(this.view,this.currentCamera,this._constraintOptions)}};Vq=u([M("esri.views.3d.state.controllers.global.PinchAndPanController")],Vq);const bae=Oe(0,0,1),Xet={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI};let Gq=class extends lm{constructor(){super(...arguments),this._rotationValueSmooth=new kF(.05),this._scalingValueSmooth=new kF(.05),this._planeHorizontal=Ii(),this._planeVertical=Ii(),this._rotationMomentumEstimator=new b2e,this._panMomentumEstimator=new _2e(300,12,.9),this._zoomMomentumEstimator=new w2e,this._beginRadius=0,this._beginCenter=E(),this._beginAngle=0,this._tmpPoints=[],this._panMode=yo.Horizontal,this._beginCenterScreen=cn(),this._tmpCentroid3d=E(),this._tmpCentroid2d=cn(),this._tmp2d=cn(),this._pointerCount=0,this._constraintOptions={selection:Ur.ALL,interactionType:Qt.NONE,interactionFactor:0,interactionStartCamera:new ft,interactionDirection:null,tiltMode:wo.TUMBLE}}begin(e){if(!this.active)return;const i=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=i,this._rotationMomentumEstimator.enabled=i,this._panMomentumEstimator.enabled=i,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),fp(e.center,this._beginCenterScreen),$be(bae,0,this._planeHorizontal);const r=E(),n=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,r,this.view.map.ground.opacity===0?eT:{}),s=E();Pa(s,this.startCamera.viewForward);const o=E();oe(o,bae);const a=ge(s,o),l=Qh(a<0?-a:a);this._panMode=l>=Xet.ANGLE_THRESHOLD?yo.Horizontal:yo.Vertical;const c=Math.min(XSe,1/Math.abs(ge(o,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),ZSe);tH(this._planeHorizontal,this._planeHorizontal,r),this.startCamera.aboveGround||iH(this._planeHorizontal,this._planeHorizontal);const h=E(),d=E(),f=E();de(h,r,this.currentCamera.eye);const m=xe(h);if(ye(h,h),this._panMode===yo.Vertical){re(o,o,a),de(this._planeVertical,s,o),ye(this._planeVertical,this._planeVertical),tH(this._planeVertical,this._planeVertical,r);const y=this.view._stage.renderView.getMinimalDepthForArea(MP(this.view),this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,LU);let _=y??c;_=n?Math.min(_,m):_,oe(f,ue(d,this.currentCamera.eye,re(d,h,_))),this._planeVertical[3]=-ge(this._planeVertical,f),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),o9(this._tmpPoints,this._beginCenter)}else{const y=n?m:c;oe(f,ue(d,this.currentCamera.eye,re(d,h,y))),this._planeHorizontal[3]=-ge(this._planeHorizontal,f),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),o9(this._tmpPoints,this._beginCenter)}this._constraintOptions.interactionStartCamera?.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1,r=this._panMode===yo.Horizontal?this._planeHorizontal:this._planeVertical,n=this._beginCenter;if(i){const s=this._beginRadius/e.radius,o=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=o,this._scalingValueSmooth.update(s),eQ(this.currentCamera,n,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=Qt.ZOOM,this._constraintOptions.interactionFactor=hp(Math.abs(e.radius-this._beginRadius)),Xn(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,r,this.currentCamera,this._tmpPoints),o9(this._tmpPoints,this._tmpCentroid3d),fp(e.center,this._tmpCentroid2d),e2e(this.currentCamera,n,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=Qt.PAN,this._constraintOptions.interactionFactor=hp(Iv(this._beginCenterScreen,this._tmpCentroid2d)),Xn(this.view,this.currentCamera,this._constraintOptions),i){const s=this._planeHorizontal,o=n,a=this._rotationValueSmooth.value,l=a+Fq(e.angle-a),c=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=c,this._rotationValueSmooth.update(l);const h=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(h,.001*e.timestamp),zv(this.currentCamera,o,RP(s,h)),this._constraintOptions.interactionType=Qt.TUMBLE,this._constraintOptions.interactionFactor=hp(Math.abs(e.radius*h)),Xn(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return new I2({view:this.view,momentum:i,zoomCenter:this._beginCenter});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new mw({view:this.view,momentum:r,center:this._beginCenter,axis:this._planeHorizontal});const n=this._panMomentumEstimator.evaluateMomentum();return n?new dR({view:this.view,momentum:n}):null}_computePlanePoints(e,i,r,n){n.length=e.size;const s=this._tmp2d;let o=0;return e.forEach(a=>{s[0]=a.x,s[1]=a.y,n[o]===void 0&&(n[o]=E()),kq(i,r,s,n[o]),o+=1}),n}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};Gq=u([M("esri.views.3d.state.controllers.local.PinchAndPanController")],Gq);let wae=class extends Ho{constructor(e,i,r){super(!0),this._view=e,this.pointerAction=i,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",r,n=>this._handleDrag(n))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!rQ(e.data,this.pointerAction))return;const i=e.timestamp-this._lastEndTimestamp,r=40,n=this._momentum&&this._momentum.active&&i<r;switch(e.data.action){case"start":case"update":if(n)break;this._controller&&this._controller.active?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,i){if(this._controller&&this._controller.active){this._lastEndTimestamp=e.timestamp;const r=this._controller.end(e.data);i&&r&&(this._momentum=r,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new Vq({view:this._view}):new Gq({view:this._view})}},Zet=class extends Ho{constructor(e,i){super(!0),this.view=e,this.registerIncoming("pointer-down",i,()=>this.view.state.stopActiveCameraController())}},x2e=class extends Ho{constructor(e,i){super(!0),this.key=e,this.registerIncoming("key-down",i,r=>this._handleKeyDown(r))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}},Jet=class extends x2e{constructor(e,i,r){super(i,r),this.view=e}activate(){this.view.goTo({heading:0}).catch(()=>{})}},Ket=class extends x2e{constructor(e,i,r){super(i,r),this.view=e}activate(){this.view.goTo({tilt:0}).catch(()=>{})}},Qet=class extends Ho{constructor(e,i=!1){super(!0),this._view=e,this._invert=i,this.registerIncoming("vertical-two-finger-drag",r=>this._handleTwoFinger(r))}_handleTwoFinger(e){const i=this._invert?-1:1,r=cn(0,e.data.delta*i);switch(e.data.action){case"begin":this._cameraController?.end(),this._cameraController=new hR({view:this._view,pivot:Oc.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController?.update(r);break;case"end":this._cameraController?.end(),this._cameraController=null}}};function xae(t){const e=t.native;return e?{buttons:e.buttons.map(i=>i.pressed?i.value||1:0),axes:e.axes.map(i=>itt(i,t.axisThreshold))}:{buttons:[],axes:[]}}function ett(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let i=0;i<t.axes.length;i++)if(t.axes[i]!==e.axes[i])return!1;for(let i=0;i<t.buttons.length;i++)if(t.buttons[i]!==e.buttons[i])return!1;return!0}function ttt(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function itt(t,e){const i=Math.abs(t);return i<e?0:Math.sign(t)*(i-e)/(1-e)}let rtt=class{constructor(e,i){this._element=e,this._input=i,this._hasEventListeners=!1,this._onConnectGamepad=s=>{this._connectGamepad(s.gamepad)},this._onDisconnectGamepad=s=>{const o=s.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,xae(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const r="getGamepads"in window.navigator,n=window.isSecureContext;this.supported=r&&n,this.supported&&(this._forEachGamepad(s=>this._connectGamepad(s)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const i=new cK(e);i.deviceType!=="unknown"&&(this._inputDevices[e.index]=i,this._input.gamepad.devices.add(i)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=rx({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),i=this._element.contains(document.activeElement),r=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!i;this._forEachGamepad(n=>{const s=this._inputDevices[n.index];if(!s)return;const o=this._latestUpdate[n.index],a=xae(s),l=r||ttt(a);o&&(o.timestamp===n.timestamp||!o.active&&l||ett(o.state,a))||this._emitGamepadEvent(n,a,!l)})}_forEachGamepad(e){const i=window.navigator.getGamepads();for(let r=0;r<i.length;r++){const n=i[r];this._validate(n)&&e(n)}}_emitGamepadEvent(e,i,r){const n=this._latestUpdate[e.index],s=n&&n.active;if(!s&&!r)return;const o=!s&&r?"start":s&&r?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:i,active:r},this._callback&&this._callback({device:this._inputDevices[e.index],state:i,action:o})}_validate(e){if(!e||!e.connected)return!1;for(let i=0;i<e.axes.length;i++)if(isNaN(e.axes[i]))return!1;return!0}};const Tae=ie("edge"),ntt=ie("chrome"),stt=ie("ff"),ott=ie("safari"),Sae="esri-view-surface",LT={touchNone:`${Sae}--touch-none`,touchPan:`${Sae}--touch-pan`};let T2e=class S2e{constructor(e,i){this._input=i,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new rtt(e,this._input),this._gamepadSource.onEvent=r=>this._callback("gamepad",r)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=$e(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const i in this._active)if(!e||!e.has(i)){const r=this._active[i];this._element.removeEventListener(_9[i],r),delete this._active[i]}e&&e.forEach(i=>{if(!this._active[i]&&_9[i]){const r=(this._eventHandlers[i]||this._handleDefault).bind(this,i);this._element.addEventListener(_9[i],r),this._active[i]=r}}),this._gamepadSource.hasEventListeners=e?.has("gamepad")??!1}setPointerCapture(e,i){i?this._setPointerCatpureSafe(e.pointerId):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?LT.touchNone:LT.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?LT.touchPan:LT.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(LT.touchNone),this._element.classList.remove(LT.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(e){try{this._element.setPointerCapture(e),this._activePointerCaptures.add(e)}catch{}}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,i){const r=wxe(this._element,e);return S2e.test.disableSubpixelCoordinates&&(r.x=Math.round(r.x),r.y=Math.round(r.y)),i.x=r.x,i.y=r.y,i}_handleKey(e,i){const r=Vqe(i);r&&e==="key-up"&&this._keyDownState.delete(r);const n={native:i,key:r,repeat:!!r&&this._keyDownState.has(r)};r&&e==="key-down"&&this._keyDownState.add(n.key),this._callback(e,n)}_handlePointer(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});this._callback(e,r)}_handlePointerPreventDefault(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});i.preventDefault(),this._callback(e,r)}_handleMouseWheel(e,i){let r=i.deltaY;switch(i.deltaMode){case 0:Tae&&(r=r/document.documentElement.clientHeight*600);break;case 1:r*=30;break;case 2:r*=900}Tae?r*=.7:ntt||ott?r*=.6:stt&&(r*=1.375);const n=100,s=Math.abs(r);s>n&&(r=r/s*200/(1+Math.exp(-.02*(s-n))));const o=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,deltaY:r});this._callback(e,o)}_handlePointerCaptureLost(e,i){this._activePointerCaptures.delete(i.pointerId),this._handleDefault(e,i)}_handleDefault(e,i){const r={native:i};i.preventDefault(),this._callback(e,r)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};T2e.test={disableSubpixelCoordinates:!1};const _9={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let att=class extends Ho{constructor(){super(!0),this.registerIncoming("context-menu",e=>{e.data.native.preventDefault()})}};const Lu={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500,maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};function jq(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function ltt(t,e){const i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)}function ctt(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:ed()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[T,S]=t,[C,A]=[S.x-T.x,S.y-T.y];return e.radius=Math.sqrt(C*C+A*A)/2,e.center.x=(T.x+S.x)/2,e.center.y=(T.y+S.y)/2,e}let i=0,r=0;for(let T=0;T<t.length;T++)i+=t[T].x,r+=t[T].y;i/=t.length,r/=t.length;const n=t.map(T=>T.x-i),s=t.map(T=>T.y-r);let o=0,a=0,l=0,c=0,h=0,d=0,f=0;for(let T=0;T<n.length;T++){const S=n[T],C=s[T],A=S*S,R=C*C;o+=A,a+=R,l+=S*C,c+=A*S,h+=R*C,d+=S*R,f+=C*A}const m=.5*(c+d),y=.5*(h+f),_=o*a-l*l,v=(m*a-y*l)/_,w=(o*y-l*m)/_,x=ed(v+i,w+r);return{radius:Math.sqrt(v*v+w*w+(o+a)/t.length),center:x}}function pR(t){const{native:e}=t,{pointerId:i,button:r,pointerType:n}=e;return n==="mouse"?`${i}:${r}`:`${n}`}let utt=class extends Ho{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,i,r,n){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:i.buttons,timestamp:n,pointers:htt(this._activePointerMap),pointer:i,angle:r.angle,radius:r.radius,center:r.center}}_addPointer(e){const i=e.native.pointerId,r=nL(this._activePointerMap).angle,n={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(i,n);const s=u4(n,E2e(this._activePointerMap));n.initialAngle=s,n.lastAngle=s,this._updatePointerAngles(r)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const i=e.native.pointerId,r=this._activePointerMap.get(i);r?r.event=e:this._addPointer(e)}_removePointer(e){const i=nL(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(i)}_updatePointerAngles(e){const i=nL(this._activePointerMap);this._activePointerMap.forEach(r=>{r.initialAngle=u4(r,i)-e,r.lastAngle=u4(r,i)-e})}_emitEvent(e,i,r){const n=nL(this._activePointerMap);this._drag.emit(this._createPayload(e,i,n,r),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const i=e.data.native.pointerId,r=e.timestamp;this._activePointerMap.get(i)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,r),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(i)):(this._removePointer(i),this._emitEvent("removed",e.data,e.timestamp)))}_handlePointerDrag(e){const i=e.data,r=i.currentEvent,n=e.timestamp;switch(i.action){case"start":case"update":this._isDragging?this._activePointerMap.has(r.native.pointerId)?(this._updatePointer(r),!this._isCurrentDragSuppressed&&this._emitEvent("update",r,n)):(this._addPointer(r),this._emitEvent("added",r,n),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(r),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",r,n))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function E2e(t){const e=[];return t.forEach(i=>{e.push(ed(i.event.x,i.event.y))}),ctt(e)}function nL(t){const e=E2e(t);let i=0;return t.forEach(r=>{let n=u4(r,e),s=n-r.lastAngle;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;n=r.lastAngle+s,r.lastAngle=n;const o=n-r.initialAngle;i+=o}),i/=t.size||1,{angle:i,radius:e.radius,center:e.center}}function htt(t){const e=new Map;return t.forEach((i,r)=>e.set(r,i.event)),e}function u4(t,e){const i=t.event,r=i.x-e.center.x,n=i.y-e.center.y;return Math.atan2(n,r)}var Eae;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"})(Eae||(Eae={}));let dtt=class extends Ho{constructor(e=Lu.maximumDoubleClickDelay,i=Lu.maximumDoubleClickDistance,r=Lu.maximumDoubleTouchDelay,n=Lu.maximumDoubleTouchDistance,s=nM){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=n,this._clock=s,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=pR(i);if(!this._pointerState.has(r)){const n={downButton:i.native.button,x:i.x,y:i.y,immediateDoubleClick:null};this._pointerState.set(r,n),this.startCapturingPointer(i.native)}}_handlePointerUp(e){const i=e.data,r=pR(i),n=this._pointerState.get(r);if(n&&n.downButton===i.native.button){const s=n.immediateDoubleClick,o=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;s?(s.timeoutHandle.remove(),jq(s,e.data)>o?this._startImmediateDoubleClick(e,n):(this._immediateDoubleClick.emit(e.data,void 0,s.modifiers),this._removeState(i))):jq(n,e.data)>o?this._removeState(i):this._startImmediateDoubleClick(e,n)}}_startImmediateDoubleClick(e,i){const r=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;i.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),r)}}_removeState(e){const i=pR(e);this._pointerState.delete(i),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}},ptt=class extends Ho{constructor(e=Lu.maximumClickDelay,i=Lu.movementUntilMouseDrag,r=Lu.movementUntilPenDrag,n=Lu.movementUntilTouchDrag,s=Lu.holdDelay,o=nM){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=i,this._movementUntilPenDrag=r,this._movementUntilTouchDrag=n,this._holdDelay=s,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=Tr(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=i.native.pointerId;let n=null;this._pointerState.size===0&&(n=this._clock.setTimeout(()=>{const o=this._pointerState.get(r);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,e.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const s={startEvent:i,previousEvent:i,startTimestamp:e.timestamp,isDragging:!1,downButton:i.native.button,holdTimeout:n,modifiers:new Set};this._pointerState.set(r,s),this.startCapturingPointer(i.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_createPointerDragData(e,i,r){return{action:e,startEvent:i.startEvent,previousEvent:i.previousEvent,currentEvent:r}}_handlePointerMove(e){const i=e.data,r=i.native.pointerId,n=this._pointerState.get(r);n&&(n.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",n,i),void 0,n.modifiers):ltt(i,n.startEvent)>this._getDragThreshold(i.native.pointerType)&&this._startDragging(e),n.previousEvent=i)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const i=e.data,r=i.native.pointerId;this._pointerState.forEach(n=>{n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging||(n.modifiers=e.modifiers,n.isDragging=!0,r===n.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",n,i)):this._pointerDrag.emit(this._createPointerDragData("start",n,n.previousEvent),e.timestamp))})}_handlePointerLoss(e,i){const r=e.data,n=r.native.pointerId,s=this._pointerState.get(n);s&&(s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",s,i==="pointer-up"?r:s.previousEvent),void 0,s.modifiers):i==="pointer-up"&&s.downButton===r.native.button&&e.timestamp-s.startTimestamp<=this._maximumClickDelay&&!s.holdEmitted&&this._immediateClick.emit(r),this._pointerState.delete(n),this.stopCapturingPointer(r.native),this._pointerState.size===0&&this._moveHandle.pause())}},ftt=class extends Ho{constructor(e=Lu.maximumDoubleClickDelay,i=Lu.maximumDoubleClickDistance,r=Lu.maximumDoubleTouchDelay,n=Lu.maximumDoubleTouchDistance,s=nM){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=n,this._clock=s,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=Tr(e.doubleClickTimer))}get hasPendingInputs(){return $u(this._pointerState,e=>e.doubleClickTimer!=null)}_clearDoubleClickTimer(e,i){const r=this._pointerState.get(e);r&&(r.doubleClickTimer=Tr(r.doubleClickTimer),i&&this._click.emit(r.event.data,void 0,r.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const i=this._pointerState.get(e);i.pointerDownCount===1&&this._click.emit(i.event.data,void 0,i.event.modifiers),i.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_getPointerId(e){const{pointerId:i,pointerType:r,button:n}=e.native;return r==="mouse"?`${i}:${n}`:`${r}`}_handleImmediateClick(e){const i=e.data,{pointerType:r}=i.native,n=this._getPointerId(i);if(!this._pointerState.has(n))return void this._startClick(e);const s=this._pointerState.get(n),{data:o,modifiers:a}=s.event,l=r==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;jq(o,i)>l?(this._clearDoubleClickTimer(n,!0),this._startClick(e)):(this._clearDoubleClickTimer(n,!1),s.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(e){const i=pR(e.data),r=this._pointerState.get(i);r&&(r.pointerDownCount+=1)}_startClick(e){const{data:i}=e,{native:{pointerType:r}}=i,n=pR(i),s=r==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(n),s),a=1;this._pointerState.set(n,{event:e,doubleClickTimer:o,pointerDownCount:a}),this.refreshHasPendingInputs()}},mtt=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const i=e.data,r=i.pointers.size;switch(i.action){case"start":this._currentCount=r,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){this._startEvent=e,this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},gtt=class extends Ho{constructor(e=20,i=40){super(!1),this._threshold=e,this._maxDelta=i,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new mtt({start:(r,n)=>this._observeStart(r,n),update:(r,n,s)=>this._observeUpdate(r,n,s),end:(r,n)=>this._observeEnd(n)}),this.registerIncoming("drag",r=>this._dragEventSeparator.handle(r))}get failed(){return this._state==="failed"}_observeStart(e,i){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),i.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,i,r){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void i.stopPropagation()):void(this._checkMovementWithinLimits(i.data,r.data)?this._checkVerticalThresholdReached(i.data,r.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=i.data.center,this._artificalDrag.emit({action:"end",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),i.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,i){let r=-1/0,n=1/0,s=-1/0,o=1/0;for(const{x:_,y:v}of i.pointers.values())r=Math.max(r,_),n=Math.min(n,_),s=Math.max(s,v),o=Math.min(o,v);let a=-1/0,l=1/0,c=-1/0,h=1/0;for(const{x:_,y:v}of e.pointers.values())a=Math.max(a,_),l=Math.min(l,_),c=Math.max(c,v),h=Math.min(h,v);const d=r-n,f=s-o,m=a-l,y=c-h;return Math.abs(e.center.x-i.center.x)<this._threshold&&Math.abs(m-d)<=this._maxDelta&&Math.abs(y-f)<=this._maxDelta}_checkVerticalThresholdReached(e,i){let r=Math.abs(e.center.y-i.center.y);return e.pointers.forEach((n,s)=>{const o=i.pointers.get(s);r=Math.min(r,Math.abs(n.y-o.y))}),r>=this._threshold}},Vd=class extends we{destroy(){this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get updating(){return!!this._inputManager?.updating}get latestPointerType(){return this._inputManager?.latestPointerType}get latestPointerLocation(){return this._inputManager?.latestPointerLocation}get multiTouchActive(){return this._inputManager?.multiTouchActive??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=$e(this._inputManager)}connect(){const e=this.view;this._source=new T2e(this.view.surface,e.input);const i=[new dtt,new ptt,new ftt,new utt(this.view.navigation),new gtt],r=new wh({eventSource:this._source,recognizers:i});this._inputManager=r,r.installHandlers("prevent-context-menu",[new att],cv.INTERNAL),this._modeDragPan=new wae(e,"primary"),this._modeDragRotate=new g9(e,"secondary",Oc.CENTER),this._modeDragZoom=new $et(e,"tertiary");const n={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};r.installHandlers("navigation",[new Zet(e),new ZQe(e),new zet(e),new Vet(e,n.pan),new Get(e),new Ket(e,n.resetTilt),new Jet(e,n.resetHeading),new g9(e,"primary",Oc.EYE,[n.lookAround]),new g9(e,"secondary",Oc.CENTER,[n.lookAround]),new wae(e,"tertiary",[n.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new Qet(e)],cv.INTERNAL),this.view.viewEvents.connect(r),this._updateMode(),this.addHandles(ne(()=>this.view.navigation?.browserTouchPanEnabled,s=>{this._source.browserTouchPanningEnabled=!s},Xt))}_updateMode(){const e=this.mode,i=this.primaryDragAction,r=Hq.get(e)?.get(i);r&&(this._modeDragPan&&(this._modeDragPan.pointerAction=r.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=r.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=r.zoom))}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};u([p()],Vd.prototype,"view",void 0),u([p({value:"pan"})],Vd.prototype,"primaryDragAction",null),u([p({value:"default"})],Vd.prototype,"mode",null),u([p({readOnly:!0})],Vd.prototype,"updating",null),u([p()],Vd.prototype,"latestPointerType",null),u([p()],Vd.prototype,"latestPointerLocation",null),u([p()],Vd.prototype,"multiTouchActive",null),u([p()],Vd.prototype,"_inputManager",void 0),Vd=u([M("esri.views.3d.input.SceneInputManager")],Vd);const Hq=new Map,v9=new Map,b9=new Map;v9.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),v9.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),b9.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),b9.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),Hq.set("default",v9),Hq.set("pro",b9);const ytt=Vd;let Bn=class extends we{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};u([p()],Bn.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),u([p()],Bn.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),u([p()],Bn.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),u([p()],Bn.prototype,"DECONFLICTOR_SHOW_GRID",void 0),u([p()],Bn.prototype,"LABELS_SHOW_BORDER",void 0),u([p()],Bn.prototype,"TEXT_SHOW_BASELINE",void 0),u([p()],Bn.prototype,"TEXT_SHOW_BORDER",void 0),u([p()],Bn.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),u([p()],Bn.prototype,"OVERLAY_SHOW_CENTER",void 0),u([p()],Bn.prototype,"SHOW_POI",void 0),u([p()],Bn.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),u([p()],Bn.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),u([p()],Bn.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),u([p()],Bn.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),u([p()],Bn.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),u([p()],Bn.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),u([p()],Bn.prototype,"I3S_TREE_SHOW_TILES",void 0),u([p()],Bn.prototype,"I3S_SHOW_MODIFICATIONS",void 0),u([p()],Bn.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),u([p()],Bn.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),u([p()],Bn.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),u([p()],Bn.prototype,"LINE_WIREFRAMES",void 0),Bn=u([M("esri.views.3d.support.DebugFlags")],Bn);const pr=new Bn;let Eu,aE,qq=!1,Wq=!1,Yq=!1,Xq=!1,fR=null;function _tt(t,e){if(!Wq||!aE)return;C2e();const i=aE;let r=0;for(let n=0;n<t.accBinsNumX;n++)for(let s=0;s<t.accBinsNumY;s++){const o=t.accBins[n][t.accBinsNumY-1-s];r+=o.length;const a=n*t.accBinsSizeX,l=(n+1)*t.accBinsSizeX,c=s*t.accBinsSizeY,h=(s+1)*t.accBinsSizeY;i.fillText(o.length.toFixed(),a+5,c+15),A2e(a,l,c,h,"blue")}i.fillText("total totalShownLabels: "+r,70,40),i.fillText("total visible labels: "+e.size,70,50),i.fillText("total numTests: "+t.accNumTests,70,30)}function vtt(t){Yq=pr.DECONFLICTOR_SHOW_VISIBLE,Xq=pr.DECONFLICTOR_SHOW_INVISIBLE,qq=Yq||Xq,Wq=pr.DECONFLICTOR_SHOW_GRID,fR=null,qq||Wq?fR=()=>btt(t):Eu&&(Eu.parentElement.removeChild(Eu),Eu=null)}function C2e(){fR&&(fR(),fR=null)}function btt(t){Eu==null&&(Eu=document.createElement("canvas"),Eu.setAttribute("id","debugCanvas2d"),t.surface.parentElement.style.position="relative",t.surface.parentElement.appendChild(Eu));const{state:e}=t,{camera:i,pixelRatio:r}=e,{width:n,height:s}=i,o=n*r,a=s*r;Eu.setAttribute("width",`${o}px`),Eu.setAttribute("height",`${a}px`),Eu.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${n}px;height:${s}px`),aE=Eu.getContext("2d"),aE.clearRect(0,0,n,s),aE.font="12px Arial"}function A2e(t,e,i,r,n){C2e();const s=Eu.height,o=aE;o.beginPath(),o.lineWidth=1,o.strokeStyle=n,o.moveTo(t,s-i),o.lineTo(e,s-i),o.stroke(),o.lineTo(e,s-r),o.stroke(),o.lineTo(e,s-i),o.stroke(),o.lineTo(t,s-i),o.stroke(),o.lineTo(t,s-i),o.stroke(),o.closePath()}function wtt(t,e){qq&&(e&&Yq||!e&&Xq)&&A2e(t.aabr[0],t.aabr[2],t.aabr[1],t.aabr[3],e?"green":"red")}var sa,mo;(function(t){t[t.USER=1]="USER",t[t.SCALE_RANGE=2]="SCALE_RANGE",t[t.FILTER=4]="FILTER",t[t.DECONFLICTION=8]="DECONFLICTION",t[t.ALL_GRAPHIC=15]="ALL_GRAPHIC",t[t.ALL_LABEL=255]="ALL_LABEL"})(sa||(sa={})),function(t){t[t.GRAPHIC=1]="GRAPHIC",t[t.LABEL=16]="LABEL"}(mo||(mo={}));function O2e(t,e){return new M2e(t,I2e,e)}function xtt(t,e){const{curvatureDependent:i,scaleStart:r,scaleFallOffRange:n}=I2e;return new M2e(t,{curvatureDependent:{min:{curvature:i.min.curvature,tiltAngle:i.min.tiltAngle,scaleFallOffFactor:w9.curvatureDependent.min.scaleFallOffFactor},max:{curvature:i.max.curvature,tiltAngle:i.max.tiltAngle,scaleFallOffFactor:w9.curvatureDependent.max.scaleFallOffFactor}},scaleStart:r,scaleFallOffRange:n,minPixelSize:w9.minPixelSize},e)}function Ttt(t){return Math.abs(t*t*t)}function R2e(t,e,i){const r=i.parameters;return x9.scale=Math.min(r.divisor/(e-r.offset),1),x9.factor=Ttt(t),x9}function aQ(t,e){return xt(t*Math.max(e.scale,e.minScaleFactor),t,e.factor)}function Stt(t,e,i){const r=R2e(t,e,i);return r.minScaleFactor=0,aQ(1,r)}function Cae(t,e,i,r){r.scale=Stt(t,e,i),r.factor=0,r.minScaleFactor=i.minScaleFactor}function P2e(t,e,i=[0,0]){const r=Math.min(Math.max(e.scale,e.minScaleFactor),1);return i[0]=t[0]*r,i[1]=t[1]*r,i}function Ett(t,e,i,r){return aQ(t,R2e(e,i,r))}let M2e=class $2e{get minScaleFactor(){return this._fontHeight!=null?Math.min(this._description.minPixelSize/this._fontHeight,1):0}constructor(e,i,r,n=Ctt(),s){this._viewingMode=e,this._description=i,this._ellipsoidRadius=r,this.parameters=n,this._fontHeight=s,this._viewingMode===Le.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),!0)}overrideFontHeight(e){return e!==this._fontHeight?new $2e(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,i,r){const{scaleStart:n,scaleFallOffRange:s}=this._description,{fovY:o,distance:a}=e,l=this._calculateCurvatureDependentParameters(e,i),c=this._coverageCompensation(e,i,l),{tiltAngle:h,scaleFallOffFactor:d}=l,f=Math.sin(h)*a,m=.5*Math.PI-h-o*(.5-n*c),y=f/Math.cos(m),_=m+o*s*c,v=(y-d*(f/Math.cos(_)))/(1-d);return r.camera.fovY=e.fovY,r.camera.distance=e.distance,r.offset=v,r.divisor=y-v,r}_calculateCurvatureDependentParametersLocal(e,i,r=Aae){return r.tiltAngle=this._description.curvatureDependent.min.tiltAngle,r.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,r}_calculateCurvatureDependentParametersGlobal(e,i,r=Aae){const n=this._description.curvatureDependent,s=1+e.distance/i,o=Math.sqrt(s*s-1),[a,l]=[n.min.curvature,n.max.curvature],c=_e((o-a)/(l-a),0,1),[h,d]=[n.min,n.max];return r.tiltAngle=xt(h.tiltAngle,d.tiltAngle,c),r.scaleFallOffFactor=xt(h.scaleFallOffFactor,d.scaleFallOffFactor,c),r}_surfaceCoverageCompensationLocal(e,i,r){return(e.fovY-r.tiltAngle)/e.fovY}_surfaceCoverageCompensationGlobal(e,i,r){const n=i*i,s=r.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=e,l=a*a+n-2*Math.cos(s)*a*i,c=Math.sqrt(l),h=Math.sqrt(l-n);return(Math.acos(h/c)-Math.asin(i/(c/Math.sin(s)))+.5*o)/o}};const I2e={curvatureDependent:{min:{curvature:Dt(10),tiltAngle:Dt(12),scaleFallOffFactor:.5},max:{curvature:Dt(70),tiltAngle:Dt(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},w9={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function Ctt(){return{camera:{distance:0,fovY:0},divisor:0,offset:0}}const x9={scale:0,factor:0,minScaleFactor:0},Aae={tiltAngle:0,scaleFallOffFactor:0};function Att(t){return t instanceof Float32Array&&t.length>=16}function Ott(t){return Array.isArray(t)&&t.length>=16}function Rtt(t){return Att(t)||Ott(t)}const nC={unknown:1,inches:No(1,"meters","inches"),feet:No(1,"meters","feet"),"us-feet":No(1,"meters","us-feet"),yards:No(1,"meters","yards"),miles:No(1,"meters","miles"),"nautical-miles":No(1,"meters","nautical-miles"),millimeters:No(1,"meters","millimeters"),centimeters:No(1,"meters","centimeters"),decimeters:No(1,"meters","decimeters"),meters:No(1,"meters","meters"),kilometers:No(1,"meters","kilometers"),"decimal-degrees":1/P4e(1,"meters",Ai.radius)};var Aa,Oae;(function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"})(Aa||(Aa={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(Oae||(Oae={}));let lQ=class{constructor(e){this.field=e}},Ptt=class extends lQ{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[Aa.Undefined,Aa.Undefined,Aa.Undefined]}},Mtt=class extends lQ{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}},$tt=class extends lQ{constructor(e){super(e),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}},Itt=class{};function EA(t){return t!=null}function DT(t){return typeof t=="number"}function kU(t){return typeof t=="string"}function Ltt(t){return t==null||kU(t)}function $s(t,e){t&&t.push(e)}function Dtt(t,e,i,r=be()){const n=t||0,s=e||0,o=i||0;return n!==0&&ME(r,r,-n/180*Math.PI),s!==0&&PE(r,r,s/180*Math.PI),o!==0&&C6(r,r,o/180*Math.PI),r}function C0(t,e,i,r,n){const s=t.minSize,o=t.maxSize;if(t.expression)return $s(n,"Could not convert size info: expression not supported"),!1;if(t.useSymbolValue){const a=r.symbolSize[i];return e.minSize[i]=a,e.maxSize[i]=a,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=Aa.DefinedSize,!0}if(EA(t.field))return EA(t.stops)?t.stops.length===2&&DT(t.stops[0].size)&&DT(t.stops[1].size)?(Rae(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,i),e.type[i]=Aa.DefinedSize,!0):($s(n,"Could not convert size info: stops only supported with 2 elements"),!1):DT(s)&&DT(o)&&EA(t.minDataValue)&&EA(t.maxDataValue)?(Rae(s,o,t.minDataValue,t.maxDataValue,e,i),e.type[i]=Aa.DefinedSize,!0):t.valueUnit==="unknown"?($s(n,"Could not convert size info: proportional size not supported"),!1):nC[t.valueUnit]!=null?(e.minSize[i]=-1/0,e.maxSize[i]=1/0,e.offset[i]=0,e.factor[i]=1/nC[t.valueUnit],e.type[i]=Aa.DefinedSize,!0):($s(n,"Could not convert size info: scale-dependent size not supported"),!1);if(!EA(t.field)){if(t.stops?.[0]&&DT(t.stops[0].size))return e.minSize[i]=t.stops[0].size,e.maxSize[i]=t.stops[0].size,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=Aa.DefinedSize,!0;if(DT(s))return e.minSize[i]=s,e.maxSize[i]=s,e.offset[i]=s,e.factor[i]=0,e.type[i]=Aa.DefinedSize,!0}return $s(n,"Could not convert size info: unsupported variant of sizeInfo"),!1}function Rae(t,e,i,r,n,s){const o=Math.abs(r-i)>0?(e-t)/(r-i):0;n.minSize[s]=o>0?t:e,n.maxSize[s]=o>0?e:t,n.offset[s]=t-i*o,n.factor[s]=o}function Ntt(t,e,i,r){if(t.normalizationField||t.valueRepresentation)return $s(r,"Could not convert size info: unsupported property"),null;if(!Ltt(t.field))return $s(r,"Could not convert size info: field is not a string"),null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return $s(r,"Could not convert size info: multiple fields in use"),null}else e.size.field=t.field}else e.size=new Ptt(t.field);let n;switch(t.axis){case"width":return n=C0(t,e.size,0,i,r),n?e:null;case"height":return n=C0(t,e.size,2,i,r),n?e:null;case"depth":return n=C0(t,e.size,1,i,r),n?e:null;case"width-and-depth":return n=C0(t,e.size,0,i,r),n&&C0(t,e.size,1,i,r),n?e:null;case null:case void 0:case"all":return n=C0(t,e.size,0,i,r),n=n&&C0(t,e.size,1,i,r),n=n&&C0(t,e.size,2,i,r),n?e:null;default:return $s(r,`Could not convert size info: unknown axis "${t.axis}""`),null}}function Ftt(t,e,i){for(let n=0;n<3;++n){let s=e.unitInMeters;t.type[n]===Aa.DefinedSize&&(s*=e.modelSize[n],t.type[n]=Aa.DefinedScale),t.minSize[n]=t.minSize[n]/s,t.maxSize[n]=t.maxSize[n]/s,t.offset[n]=t.offset[n]/s,t.factor[n]=t.factor[n]/s}let r;if(t.type[0]!==Aa.Undefined)r=0;else if(t.type[1]!==Aa.Undefined)r=1;else{if(t.type[2]===Aa.Undefined)return $s(i,"No size axis contains a valid size or scale"),!1;r=2}for(let n=0;n<3;++n)t.type[n]===Aa.Undefined&&(t.minSize[n]=t.minSize[r],t.maxSize[n]=t.maxSize[r],t.offset[n]=t.offset[r],t.factor[n]=t.factor[r],t.type[n]=t.type[r]);return!0}function Pae(t,e,i){t[4*e]=i.r/255,t[4*e+1]=i.g/255,t[4*e+2]=i.b/255,t[4*e+3]=i.a}function ktt(t,e,i){if(t.normalizationField)return $s(i,"Could not convert color info: unsupported property"),null;if(kU(t.field)){if(!t.stops)return $s(i,"Could not convert color info: missing stops or colors"),null;{if(t.stops.length>8)return $s(i,"Could not convert color info: too many color stops"),null;e.color=new Mtt(t.field);const r=t.stops;for(let n=0;n<8;++n){const s=r[Math.min(n,r.length-1)];e.color.values[n]=s.value,Pae(e.color.colors,n,s.color)}}}else{if(!(t.stops&&t.stops.length>=0))return $s(i,"Could not convert color info: no field and no colors/stops"),null;{const r=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let n=0;n<8;n++)e.color.values[n]=1/0,Pae(e.color.colors,n,r)}}return e}function Utt(t,e,i){if(t.normalizationField)return $s(i,"Could not convert opacity info: unsupported property"),null;if(kU(t.field)){if(!t.stops)return $s(i,"Could not convert opacity info: missing stops or opacities"),null;{if(t.stops.length>8)return $s(i,"Could not convert opacity info: too many opacity stops"),null;e.opacity=new $tt(t.field);const r=t.stops;for(let n=0;n<8;++n){const s=r[Math.min(n,r.length-1)];e.opacity.values[n]=s.value,e.opacity.opacityValues[n]=s.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return $s(i,"Could not convert opacity info: no field and no opacities/stops"),null;{const r=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let n=0;n<8;n++)e.opacity.values[n]=1/0,e.opacity.opacityValues[n]=r}}return e}function T9(t,e,i){const r=i===2&&t.rotationType==="arithmetic";e.offset[i]=r?90:0,e.factor[i]=r?-1:1,e.type[i]=1}function ztt(t,e,i){if(!kU(t.field))return $s(i,"Could not convert rotation info: field is not a string"),null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return $s(i,"Could not convert rotation info: multiple fields in use"),null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return T9(t,e.rotation,0),e;case"roll":return T9(t,e.rotation,1),e;case null:case void 0:case"heading":return T9(t,e.rotation,2),e;default:return $s(i,`Could not convert rotation info: unknown axis "${t.axis}""`),null}}let jM=class{constructor(e,i=[1,1,1],r=[1,1,1],n=1,s=[0,0,0],o=[1,1,1],a=[0,0,0]){this.supports=e,this.modelSize=i,this.symbolSize=r,this.unitInMeters=n,this.anchor=s,this.scale=o,this.rotation=a}};function L2e(t,e,i){if(!t)return null;const r=t.reduce((n,s)=>{if(!n)return n;if(s.valueExpression)return $s(i,"Could not convert visual variables: arcade expressions not supported"),null;switch(s.type){case"size":return e.supports.size?Ntt(s,n,e,i):n;case"color":return e.supports.color?ktt(s,n,i):n;case"opacity":return e.supports.opacity?Utt(s,n,i):null;case"rotation":return e.supports.rotation?ztt(s,n,i):n;default:return null}},new Itt);return!(t.length>0&&r)||r.size||r.color||r.opacity||r.rotation?r?.size&&!Ftt(r.size,e,i)?null:r:null}let Btt=class{constructor(e,i,r){this.visualVariables=e,this.materialParameters=i,this.requiresShaderTransformation=r}};function sC(t,e){if(!t||pr.TESTS_DISABLE_FAST_UPDATES)return null;const i=L2e(t.visualVariables,e);return i?new Btt(i,N2e(i,e),!!i.size):null}function oC(t,e,i){if(!e||!t)return!1;const r=t.visualVariables,n=L2e(e.visualVariables,i);return!!n&&!!(sL(r.size,n.size,"size")&&sL(r.color,n.color,"color")&&sL(r.rotation,n.rotation,"rotation")&&sL(r.opacity,n.opacity,"opacity"))&&(t.visualVariables=n,t.materialParameters=N2e(n,i),t.requiresShaderTransformation=!!n.size,!0)}function sL(t,e,i){if(!!t!=!!e||t&&t.field!==e?.field)return!1;if(t&&i==="rotation"){const r=t,n=e;for(let s=0;s<3;s++)if(r.type[s]!==n.type[s]||r.offset[s]!==n.offset[s]||r.factor[s]!==n.factor[s])return!1}return!0}let D2e=class extends or{constructor(e){super(),this.vvSize=e?.size??null,this.vvColor=e?.color??null,this.vvOpacity=e?.opacity??null}};function N2e(t,e){const i=new D2e(t);return i.vvSize&&(i.vvSymbolAnchor=e.anchor,td(mR),Dtt(e.rotation[2],e.rotation[0],e.rotation[1],mR),i.vvSymbolRotationMatrix=i.vvSymbolRotationMatrix||nn(),rd(i.vvSymbolRotationMatrix,mR)),i}function Vtt(t,e,i){if(!t.vvSize)return i;Qn(A0,i);const r=t.vvSymbolRotationMatrix;zm(mR,r[0],r[1],r[2],0,r[3],r[4],r[5],0,r[6],r[7],r[8],0,0,0,0,1),qi(A0,A0,mR);for(let n=0;n<3;++n){const s=t.vvSize.offset[n]+e[0]*t.vvSize.factor[n];Mae[n]=_e(s,t.vvSize.minSize[n],t.vvSize.maxSize[n])}return mM(A0,A0,Mae),Kl(A0,A0,t.vvSymbolAnchor),A0}function cQ(t,e,i){if(!e.vvSize)return ae(t,1,1,1),t;for(let r=0;r<3;++r){const n=e.vvSize.offset[r]+i[0]*e.vvSize.factor[r];t[r]=_e(n,e.vvSize.minSize[r],e.vvSize.maxSize[r])}return t}function Ap(t,e){const i=t==null?0:e.attributes[t];return typeof i=="number"&&isFinite(i)?i:0}const A0=be(),Mae=E(),mR=be();function uQ(t){t.vertex.code.add(b`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(b`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`),t.vertex.code.add(b`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),t.vertex.code.add(b`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(b`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),t.vertex.code.add(b`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function Gtt(t){t.uniforms.add(new kt("screenSizePerspective",e=>F2e(e.screenSizePerspective)))}function UU(t){t.uniforms.add(new kt("screenSizePerspectiveAlignment",e=>F2e(e.screenSizePerspectiveAlignment||e.screenSizePerspective)))}function F2e(t){return ae(jtt,t.parameters.divisor,t.parameters.offset,t.minScaleFactor)}const jtt=E();function k2e(t,e){const i=t.vertex;e.hasVerticalOffset?(U2e(i),e.hasScreenSizePerspective&&(t.include(uQ),UU(i),Np(t.vertex,e)),i.code.add(b`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?b`vec3 worldNormal = normalize(worldPos + localOrigin);`:b`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?b`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:b`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):i.code.add(b`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const Htt=oi();function U2e(t){t.uniforms.add(new yi("verticalOffset",(e,i)=>{const{minWorldLength:r,maxWorldLength:n,screenLength:s}=e.verticalOffset,o=Math.tan(.5*i.camera.fovY)/(.5*i.camera.fullViewport[3]),a=i.camera.pixelRatio||1;return Gr(Htt,s*a,o,r,n)}))}const z2e=.5;function B2e(t,e){t.include(uQ),t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.NORMAL,"vec3"),t.attributes.add(O.AUXPOS1,"vec4");const i=t.vertex;zc(i,e),Np(i,e),i.uniforms.add(new yi("viewport",(r,n)=>n.camera.fullViewport),new Re("polygonOffset",r=>r.shaderPolygonOffset),new Re("cameraGroundRelative",(r,n)=>n.camera.aboveGround?1:-1)),e.hasVerticalOffset&&U2e(i),i.constants.add("smallOffsetAngle","float",.984807753012208),i.code.add(b`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.code.add(b`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${e.multipassEnabled?b.float(0):b`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),e.draped&&!e.hasVerticalOffset||tC(i),e.draped||(i.uniforms.add(new Re("perDistancePixelRatio",(r,n)=>Math.tan(n.camera.fovY/2)/(n.camera.fullViewport[2]/2))),i.code.add(b`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${b.float(z2e)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),e.screenCenterOffsetUnitsEnabled&&FC(i),e.hasScreenSizePerspective&&UU(i),i.code.add(b`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offset of labels with respect to objects.
      // It also pulls the label towards the viewer so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective&&(e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${e.hasVerticalOffset?b`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled?"":b`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled?e.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)}const oL=ks();function V2e(t,e,i,r,n,s){if(t.visible)if(t.boundingInfo){tt(t.type===wn.Mesh);const o=e.tolerance;G2e(t.boundingInfo,i,r,o,n,s)}else{const o=t.attributes.get(O.POSITION),a=o.indices;HM(i,r,0,a.length/3,a,o,void 0,n,s)}}const qtt=E();function G2e(t,e,i,r,n,s){if(t==null)return;const o=H2e(e,i,qtt);if(x1e(oL,t.bbMin),T1e(oL,t.bbMax),n?.applyToAabb(oL),dQ(oL,e,o,r)){const{primitiveIndices:a,position:l}=t,c=a?a.length:l.indices.length/3;if(c>Ztt){const h=t.getChildren();if(h!==void 0){for(const d of h)G2e(d,e,i,r,n,s);return}}HM(e,i,0,c,l.indices,l,a,n,s)}}const j2e=E();function HM(t,e,i,r,n,s,o,a,l){if(o)return Wtt(t,e,i,r,n,s,o,a,l);const{data:c,stride:h}=s,d=t[0],f=t[1],m=t[2],y=e[0]-d,_=e[1]-f,v=e[2]-m;for(let w=i,x=3*i;w<r;++w){let T=h*n[x++],S=c[T++],C=c[T++],A=c[T];T=h*n[x++];let R=c[T++],D=c[T++],N=c[T];T=h*n[x++];let k=c[T++],B=c[T++],L=c[T];a!=null&&([S,C,A]=a.applyToVertex(S,C,A,w),[R,D,N]=a.applyToVertex(R,D,N,w),[k,B,L]=a.applyToVertex(k,B,L,w));const z=R-S,j=D-C,H=N-A,X=k-S,P=B-C,I=L-A,V=_*I-P*v,q=v*X-I*y,Y=y*P-X*_,J=z*V+j*q+H*Y;if(Math.abs(J)<=Number.EPSILON)continue;const ee=d-S,me=f-C,Me=m-A,yt=ee*V+me*q+Me*Y;if(J>0){if(yt<0||yt>J)continue}else if(yt>0||yt<J)continue;const St=me*H-j*Me,ct=Me*z-H*ee,vt=ee*j-z*me,je=y*St+_*ct+v*vt;if(J>0){if(je<0||yt+je>J)continue}else if(je>0||yt+je<J)continue;const he=(X*St+P*ct+I*vt)/J;he>=0&&l(he,hQ(z,j,H,X,P,I,j2e),w,!1)}}function Wtt(t,e,i,r,n,s,o,a,l){const{data:c,stride:h}=s,d=t[0],f=t[1],m=t[2],y=e[0]-d,_=e[1]-f,v=e[2]-m;for(let w=i;w<r;++w){const x=o[w];let T=3*x,S=h*n[T++],C=c[S++],A=c[S++],R=c[S];S=h*n[T++];let D=c[S++],N=c[S++],k=c[S];S=h*n[T];let B=c[S++],L=c[S++],z=c[S];a!=null&&([C,A,R]=a.applyToVertex(C,A,R,w),[D,N,k]=a.applyToVertex(D,N,k,w),[B,L,z]=a.applyToVertex(B,L,z,w));const j=D-C,H=N-A,X=k-R,P=B-C,I=L-A,V=z-R,q=_*V-I*v,Y=v*P-V*y,J=y*I-P*_,ee=j*q+H*Y+X*J;if(Math.abs(ee)<=Number.EPSILON)continue;const me=d-C,Me=f-A,yt=m-R,St=me*q+Me*Y+yt*J;if(ee>0){if(St<0||St>ee)continue}else if(St>0||St<ee)continue;const ct=Me*X-H*yt,vt=yt*j-X*me,je=me*H-j*Me,he=y*ct+_*vt+v*je;if(ee>0){if(he<0||St+he>ee)continue}else if(he>0||St+he<ee)continue;const At=(P*ct+I*vt+V*je)/ee;At>=0&&l(At,hQ(j,H,X,P,I,V,j2e),x,!1)}}const $ae=E(),Iae=E();function hQ(t,e,i,r,n,s,o){return ae($ae,t,e,i),ae(Iae,r,n,s),lt(o,$ae,Iae),ye(o,o),o}function H2e(t,e,i){return ae(i,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}function dQ(t,e,i,r){return pQ(t,e,i,r,1/0)}function pQ(t,e,i,r,n){const s=(t[0]-r-e[0])*i[0],o=(t[3]+r-e[0])*i[0];let a=Math.min(s,o),l=Math.max(s,o);const c=(t[1]-r-e[1])*i[1],h=(t[4]+r-e[1])*i[1];if(l=Math.min(l,Math.max(c,h)),l<0||(a=Math.max(a,Math.min(c,h)),a>l))return!1;const d=(t[2]-r-e[2])*i[2],f=(t[5]+r-e[2])*i[2];return l=Math.min(l,Math.max(d,f)),!(l<0)&&(a=Math.max(a,Math.min(d,f)),!(a>l)&&a<n)}function q2e(t,e,i,r,n){let s=(i.screenLength||0)*t.pixelRatio;n!=null&&(s=Ett(s,r,e,n));const o=s*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return _e(o*e,i.minWorldLength||0,i.maxWorldLength!=null?i.maxWorldLength:1/0)}function W2e(t,e){const i=e?W2e(e):{};for(const r in t){let n=t[r];n?.forEach&&(n=Xtt(n)),n==null&&r in i||(i[r]=n)}return i}function Ytt(t,e){let i=!1;for(const r in e){const n=e[r];n!==void 0&&(Array.isArray(n)?t[r]===null?(t[r]=n.slice(),i=!0):EX(t[r],n)&&(i=!0):t[r]!==n&&(i=!0,t[r]=n))}return i}function Xtt(t){const e=[];return t.forEach(i=>e.push(i)),e}const Y2e={multiply:1,ignore:2,replace:3,tint:4},Ztt=1e3;let n1=class extends BM{constructor(e,i){super(),this.type=wn.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._vertexAttributeLocations=Si,this._pp0=Oe(0,0,1),this._pp1=Oe(0,0,0),this._parameters=W2e(e,i),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(e){return!1}setParameters(e,i=!0){Ytt(this._parameters,e)&&(this.validateParameters(this._parameters),i&&this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleForOutput(e.output)&&(!this.parameters.isDecoration||e.bindParameters.decorations===Uc.ON)&&(this.parameters.renderOccluded&e.renderOccludedMask)!=0}isVisibleForOutput(e){return!0}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){this.repository?.materialChanged(this)}intersectDraped(e,i,r,n,s,o){return this._pp0[0]=this._pp1[0]=n[0],this._pp0[1]=this._pp1[1]=n[1],this.intersect(e,i,r,this._pp0,this._pp1,s)}},X2e=class extends AJe{constructor(e,i,r){super(i,r),this.camera=e}};var Vr;(function(t){t[t.None=0]="None",t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"})(Vr||(Vr={}));let fQ=class extends or{constructor(){super(...arguments),this.renderOccluded=Vr.Occlude,this.isDecoration=!1}},Z2e=class{constructor(){this.factor=new Lae,this.factorAlignment=new Lae}},Lae=class{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}};function k5t(t,e,i,r=1){const{data:n,indices:s}=t,o=e.typedBuffer,a=e.typedBufferStride,l=s.length;if(i*=a,r===1)for(let c=0;c<l;++c)o[i]=n[s[c]],i+=a;else for(let c=0;c<l;++c){const h=n[s[c]];for(let d=0;d<r;d++)o[i]=h,i+=a}}function Dae(t,e,i){const{data:r,indices:n}=t,s=e.typedBuffer,o=e.typedBufferStride,a=n.length;i*=o;for(let l=0;l<a;++l){const c=2*n[l];s[i]=r[c],s[i+1]=r[c+1],i+=o}}function J2e(t,e,i,r){const{data:n,indices:s}=t,o=e.typedBuffer,a=e.typedBufferStride,l=s.length;if(i*=a,r==null||r===1)for(let c=0;c<l;++c){const h=3*s[c];o[i]=n[h],o[i+1]=n[h+1],o[i+2]=n[h+2],i+=a}else for(let c=0;c<l;++c){const h=3*s[c];for(let d=0;d<r;++d)o[i]=n[h],o[i+1]=n[h+1],o[i+2]=n[h+2],i+=a}}function aC(t,e,i,r=1){const{data:n,indices:s}=t,o=e.typedBuffer,a=e.typedBufferStride,l=s.length;if(i*=a,r===1)for(let c=0;c<l;++c){const h=4*s[c];o[i]=n[h],o[i+1]=n[h+1],o[i+2]=n[h+2],o[i+3]=n[h+3],i+=a}else for(let c=0;c<l;++c){const h=4*s[c];for(let d=0;d<r;++d)o[i]=n[h],o[i+1]=n[h+1],o[i+2]=n[h+2],o[i+3]=n[h+3],i+=a}}function Nae(t,e,i){const r=t.typedBuffer,n=t.typedBufferStride;e*=n;for(let s=0;s<i;++s)r[e]=0,r[e+1]=0,r[e+2]=0,r[e+3]=0,e+=n}function mQ(t,e,i,r,n=1){if(!e)return void J2e(t,i,r,n);const{data:s,indices:o}=t,a=i.typedBuffer,l=i.typedBufferStride,c=o.length,h=e[0],d=e[1],f=e[2],m=e[4],y=e[5],_=e[6],v=e[8],w=e[9],x=e[10],T=e[12],S=e[13],C=e[14];r*=l;let A=0,R=0,D=0;const N=R6(e)?k=>{A=s[k]+T,R=s[k+1]+S,D=s[k+2]+C}:k=>{const B=s[k],L=s[k+1],z=s[k+2];A=h*B+m*L+v*z+T,R=d*B+y*L+w*z+S,D=f*B+_*L+x*z+C};if(n===1)for(let k=0;k<c;++k)N(3*o[k]),a[r]=A,a[r+1]=R,a[r+2]=D,r+=l;else for(let k=0;k<c;++k){N(3*o[k]);for(let B=0;B<n;++B)a[r]=A,a[r+1]=R,a[r+2]=D,r+=l}}function gQ(t,e,i,r,n=1){if(!e)return void J2e(t,i,r,n);const{data:s,indices:o}=t,a=e,l=i.typedBuffer,c=i.typedBufferStride,h=o.length,d=a[0],f=a[1],m=a[2],y=a[4],_=a[5],v=a[6],w=a[8],x=a[9],T=a[10],S=!SZ(a),C=1e-6,A=1-C;r*=c;let R=0,D=0,N=0;const k=R6(a)?B=>{R=s[B],D=s[B+1],N=s[B+2]}:B=>{const L=s[B],z=s[B+1],j=s[B+2];R=d*L+y*z+w*j,D=f*L+_*z+x*j,N=m*L+v*z+T*j};if(n===1)if(S)for(let B=0;B<h;++B){k(3*o[B]);const L=R*R+D*D+N*N;if(L<A&&L>C){const z=1/Math.sqrt(L);l[r]=R*z,l[r+1]=D*z,l[r+2]=N*z}else l[r]=R,l[r+1]=D,l[r+2]=N;r+=c}else for(let B=0;B<h;++B)k(3*o[B]),l[r]=R,l[r+1]=D,l[r+2]=N,r+=c;else for(let B=0;B<h;++B){if(k(3*o[B]),S){const L=R*R+D*D+N*N;if(L<A&&L>C){const z=1/Math.sqrt(L);R*=z,D*=z,N*=z}}for(let L=0;L<n;++L)l[r]=R,l[r+1]=D,l[r+2]=N,r+=c}}function Jtt(t,e,i,r,n=1){if(!e)return void aC(t,i,r,n);const{data:s,indices:o}=t,a=e,l=i.typedBuffer,c=i.typedBufferStride,h=o.length,d=a[0],f=a[1],m=a[2],y=a[4],_=a[5],v=a[6],w=a[8],x=a[9],T=a[10],S=!SZ(a),C=1e-6,A=1-C;if(r*=c,n===1)for(let R=0;R<h;++R){const D=4*o[R],N=s[D],k=s[D+1],B=s[D+2],L=s[D+3];let z=d*N+y*k+w*B,j=f*N+_*k+x*B,H=m*N+v*k+T*B;if(S){const X=z*z+j*j+H*H;if(X<A&&X>C){const P=1/Math.sqrt(X);z*=P,j*=P,H*=P}}l[r]=z,l[r+1]=j,l[r+2]=H,l[r+3]=L,r+=c}else for(let R=0;R<h;++R){const D=4*o[R],N=s[D],k=s[D+1],B=s[D+2],L=s[D+3];let z=d*N+y*k+w*B,j=f*N+_*k+x*B,H=m*N+v*k+T*B;if(S){const X=z*z+j*j+H*H;if(X<A&&X>C){const P=1/Math.sqrt(X);z*=P,j*=P,H*=P}}for(let X=0;X<n;++X)l[r]=z,l[r+1]=j,l[r+2]=H,l[r+3]=L,r+=c}}function K2e(t,e,i,r,n=1){const{data:s,indices:o}=t,a=i.typedBuffer,l=i.typedBufferStride,c=o.length;if(r*=l,e!==s.length||e!==4)if(n!==1)if(e!==4)for(let h=0;h<c;++h){const d=3*o[h];for(let f=0;f<n;++f)a[r]=s[d],a[r+1]=s[d+1],a[r+2]=s[d+2],a[r+3]=255,r+=l}else for(let h=0;h<c;++h){const d=4*o[h];for(let f=0;f<n;++f)a[r]=s[d],a[r+1]=s[d+1],a[r+2]=s[d+2],a[r+3]=s[d+3],r+=l}else{if(e===4){for(let h=0;h<c;++h){const d=4*o[h];a[r]=s[d],a[r+1]=s[d+1],a[r+2]=s[d+2],a[r+3]=s[d+3],r+=l}return}for(let h=0;h<c;++h){const d=3*o[h];a[r]=s[d],a[r+1]=s[d+1],a[r+2]=s[d+2],a[r+3]=255,r+=l}}else{a[r]=s[0],a[r+1]=s[1],a[r+2]=s[2],a[r+3]=s[3];const h=new Uint32Array(i.typedBuffer.buffer,i.start),d=l/4,f=h[r/=4];r+=d;const m=c*n;for(let y=1;y<m;++y)h[r]=f,r+=d}}function Ktt(t,e,i){const{data:r,indices:n}=t,s=e.typedBuffer,o=e.typedBufferStride,a=n.length,l=r[0];i*=o;for(let c=0;c<a;++c)s[i]=l,i+=o}function Q2e(t,e,i,r,n=1){const s=e.typedBuffer,o=e.typedBufferStride;if(r*=o,n===1)for(let a=0;a<i;++a)s[r]=t[0],s[r+1]=t[1],s[r+2]=t[2],s[r+3]=t[3],r+=o;else for(let a=0;a<i;++a)for(let l=0;l<n;++l)s[r]=t[0],s[r+1]=t[1],s[r+2]=t[2],s[r+3]=t[3],r+=o}function Qtt(t,e,i,r,n,s){for(const o of e.fields.keys()){const a=t.attributes.get(o),l=a?.indices;if(a&&l)eEe(o,a,i,r,n,s);else if(o===O.OBJECTANDLAYERIDCOLOR&&t.objectAndLayerIdColor!=null){const c=t.attributes.get(O.POSITION)?.indices;if(c){const h=c.length,d=n.getField(o,Ia);Q2e(t.objectAndLayerIdColor,d,h,s)}}}}function eEe(t,e,i,r,n,s){switch(t){case O.POSITION:{tt(e.size===3);const o=n.getField(t,Ws);tt(!!o,`No buffer view for ${t}`),o&&mQ(e,i,o,s);break}case O.NORMAL:{tt(e.size===3);const o=n.getField(t,Ws);tt(!!o,`No buffer view for ${t}`),o&&gQ(e,r,o,s);break}case O.NORMALCOMPRESSED:{tt(e.size===2);const o=n.getField(t,zM);tt(!!o,`No buffer view for ${t}`),o&&Dae(e,o,s);break}case O.UV0:{tt(e.size===2);const o=n.getField(t,Jx);tt(!!o,`No buffer view for ${t}`),o&&Dae(e,o,s);break}case O.COLOR:case O.SYMBOLCOLOR:{const o=n.getField(t,Ia);tt(!!o,`No buffer view for ${t}`),tt(e.size===3||e.size===4),!o||e.size!==3&&e.size!==4||K2e(e,e.size,o,s);break}case O.COLORFEATUREATTRIBUTE:{const o=n.getField(t,xU);tt(!!o,`No buffer view for ${t}`),tt(e.size===1),o&&e.size===1&&Ktt(e,o,s);break}case O.TANGENT:{tt(e.size===4);const o=n.getField(t,Fp);tt(!!o,`No buffer view for ${t}`),o&&Jtt(e,r,o,s);break}case O.PROFILERIGHT:case O.PROFILEUP:case O.PROFILEVERTEXANDNORMAL:case O.FEATUREVALUE:{tt(e.size===4);const o=n.getField(t,Fp);tt(!!o,`No buffer view for ${t}`),o&&aC(e,o,s)}}}let U5t=class extends or{constructor(e){super(),this.slicePlaneLocalOrigin=e}};function eit(t,e){tEe(t,e,new kt("slicePlaneOrigin",(i,r)=>sEe(e,i,r)),new kt("slicePlaneBasis1",(i,r)=>UF(e,i,r,r.slicePlane?.basis1)),new kt("slicePlaneBasis2",(i,r)=>UF(e,i,r,r.slicePlane?.basis2)))}function Dn(t,e){tEe(t,e,new Yu("slicePlaneOrigin",(i,r)=>sEe(e,i,r)),new Yu("slicePlaneBasis1",(i,r)=>UF(e,i,r,r.slicePlane?.basis1)),new Yu("slicePlaneBasis2",(i,r)=>UF(e,i,r,r.slicePlane?.basis2)))}function tEe(t,e,...i){if(!e.hasSlicePlane){const o=b`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return e.hasSliceInVertexProgram&&t.vertex.code.add(o),void t.fragment.code.add(o)}e.hasSliceInVertexProgram&&t.vertex.uniforms.add(...i),t.fragment.uniforms.add(...i);const r=b`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,n=b`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,s=e.hasSliceHighlight?b`
        ${n}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:b`#define highlightSlice(_color_, _pos_) (_color_)`;e.hasSliceInVertexProgram&&t.vertex.code.add(r),t.fragment.code.add(r),t.fragment.code.add(s)}function iEe(t,e,i){return t.instancedDoublePrecision?ae(tit,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function rEe(t,e){return t!=null?de(zF,e.origin,t):e.origin}function nEe(t,e,i){return t.hasSliceTranslatedView?e!=null?Kl(iit,i.camera.viewMatrix,e):i.camera.viewMatrix:null}function sEe(t,e,i){if(i.slicePlane==null)return vo;const r=iEe(t,e,i),n=rEe(r,i.slicePlane),s=nEe(t,r,i);return s!=null?ke(zF,n,s):n}function UF(t,e,i,r){if(r==null||i.slicePlane==null)return vo;const n=iEe(t,e,i),s=rEe(n,i.slicePlane),o=nEe(t,n,i);return o!=null?(ue(CA,r,s),ke(zF,s,o),ke(CA,CA,o),de(CA,CA,zF)):r}const tit=E(),zF=E(),CA=E(),iit=be();function qM(t,e){const i=e.output===F.ObjectAndLayerIdColor,r=e.objectAndLayerIdColorInstanced;i&&(t.varyings.add("objectAndLayerIdColorVarying","vec4"),r?t.attributes.add(O.INSTANCEOBJECTANDLAYERIDCOLOR,"vec4"):t.attributes.add(O.OBJECTANDLAYERIDCOLOR,"vec4")),t.vertex.code.add(b`
     void forwardObjectAndLayerIdColor() {
      ${i?r?b`objectAndLayerIdColorVarying = instanceObjectAndLayerIdColor * 0.003921568627451;`:b`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:b``} }`),t.fragment.code.add(b`
      void outputObjectAndLayerIdColor() {
        ${i?b`fragColor = objectAndLayerIdColorVarying;`:b``} }`)}function zU(t){t.uniforms.add(new gm("alignPixelEnabled",(e,i)=>i.alignPixelEnabled)),t.code.add(b`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),t.code.add(b`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}function rit(t,e){const{vertex:i,fragment:r}=t;i.include(zU),e.multipassEnabled&&(i.include(PTe),t.varyings.add("depth","float")),i.code.add(b`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${e.multipassEnabled?b`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${e.multipassEnabled?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.include(Xc,e),r.code.add(b`
  void main() {
    fragColor = vec4(1);
    ${e.multipassEnabled?b`
        if(terrainDepthTest(depth)) {
          fragColor.g = 0.5;
        }`:""}
  }
  `)}function oEe(t){t.vertex.uniforms.add(new Re("renderTransparentlyOccludedHUD",(e,i)=>i.hudRenderStyle===Sc.Occluded?1:i.hudRenderStyle===Sc.NotOccluded?0:.75),new yi("viewport",(e,i)=>i.camera.fullViewport),new et("hudVisibilityTexture",(e,i)=>i.hudVisibility?.colorTexture)),t.vertex.include(zU),t.vertex.code.add(b`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}const aEe=Ft(1,1,0,1),yQ=Ft(1,0,1,1);function s1(t){t.fragment.uniforms.add(new et("depthTexture",(e,i)=>i.mainDepth)),t.fragment.constants.add("occludedHighlightFlag","vec4",aEe).add("unoccludedHighlightFlag","vec4",yQ),t.fragment.code.add(b`void outputHighlight() {
float sceneDepth = float(texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x);
if (gl_FragCoord.z > sceneDepth + 5e-7) {
fragColor = occludedHighlightFlag;
} else {
fragColor = unoccludedHighlightFlag;
}
}`)}let lEe=class extends dn{constructor(e,i,r){super(e,"vec4",Oi.Pass,(n,s,o)=>n.setUniform4fv(e,i(s,o)),r)}},jl=class extends dn{constructor(e,i,r){super(e,"float",Oi.Pass,(n,s,o)=>n.setUniform1fv(e,i(s,o)),r)}},WM=class extends D2e{constructor(){super(...arguments),this.renderOccluded=Vr.Occlude,this.isDecoration=!1}};const lE=8;function dy(t,e){const{vertex:i,attributes:r}=t;e.hasVvInstancing&&(e.vvSize||e.vvColor)&&r.add(O.INSTANCEFEATUREATTRIBUTE,"vec4"),e.vvSize?(i.uniforms.add(new kt("vvSizeMinSize",n=>n.vvSize.minSize)),i.uniforms.add(new kt("vvSizeMaxSize",n=>n.vvSize.maxSize)),i.uniforms.add(new kt("vvSizeOffset",n=>n.vvSize.offset)),i.uniforms.add(new kt("vvSizeFactor",n=>n.vvSize.factor)),i.uniforms.add(new qp("vvSymbolRotationMatrix",n=>n.vvSymbolRotationMatrix)),i.uniforms.add(new kt("vvSymbolAnchor",n=>n.vvSymbolAnchor)),i.code.add(b`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),i.code.add(b`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?b`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):i.code.add(b`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),e.vvColor?(i.constants.add("vvColorNumber","int",lE),i.uniforms.add(new jl("vvColorValues",n=>n.vvColor.values,lE),new lEe("vvColorColors",n=>n.vvColor.colors,lE)),i.code.add(b`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${e.hasVvInstancing?b`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):i.code.add(b`vec4 vvColor() { return vec4(1.0); }`)}const BF=.1,zo=.001;function nit(t){const e=new Ei,i=t.signedDistanceFieldEnabled;if(e.include(B2e,t),e.include(Dn,t),t.occlusionPass)return e.include(rit,t),e;const{vertex:r,fragment:n}=e;e.include(uQ),n.include(dd),n.include(Wm),e.include(dy,t),e.include(qM,t),e.include(oEe),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2"),e.varyings.add("voccluded","float"),r.uniforms.add(new yi("viewport",(c,h)=>h.camera.fullViewport),new Ki("screenOffset",(c,h)=>mi(cEe,2*c.screenOffset[0]*h.camera.pixelRatio,2*c.screenOffset[1]*h.camera.pixelRatio)),new Ki("anchorPosition",c=>VF(c)),new yi("materialColor",c=>c.color)),FC(r),i&&(r.uniforms.add(new yi("outlineColor",c=>c.outlineColor)),n.uniforms.add(new yi("outlineColor",c=>Fae(c)?c.outlineColor:Wu),new Re("outlineSize",c=>Fae(c)?c.outlineSize:0))),t.pixelSnappingEnabled&&r.include(zU),t.hasScreenSizePerspective&&(Gtt(r),UU(r)),t.debugDrawLabelBorder&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add(O.UV0,"vec2"),e.attributes.add(O.COLOR,"vec4"),e.attributes.add(O.SIZE,"vec2"),e.attributes.add(O.FEATUREATTRIBUTE,"vec4"),r.code.add(b`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${t.hasScreenSizePerspective?b`
            inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
            vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:b`
            inputSize = size;
            vec2 screenOffsetScaled = screenOffset;`}

      ${t.vvSize?"inputSize *= vvScale(featureAttribute).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);
      bool visible = testHUDVisibility(posProj);
      voccluded = visible ? 0.0 : 1.0;
    `);const s=b`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,o=t.pixelSnappingEnabled?i?b`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:b`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:b`posProj += quadOffset;`;r.code.add(b`
    ${t.occlusionTestEnabled?"if (visible) {":""}
    ${s}
    ${t.vvColor?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${t.output===F.ObjectAndLayerIdColor?b`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${b.float(zo)};
    ${i?`alphaDiscard = alphaDiscard && outlineColor.a < ${b.float(zo)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv;

    ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${t.occlusionTestEnabled?b`} else { vtc = vec2(0.0);
      ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),n.uniforms.add(new et("tex",c=>c.texture));const a=t.debugDrawLabelBorder?b`(isBorder > 0.0 ? 0.0 : ${b.float(BF)})`:b.float(BF),l=b`
    ${t.debugDrawLabelBorder?b`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${t.sampleSignedDistanceFieldTexelCenter?b`
      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;
      `:b`
      vec2 samplePos = vtc;
      `}

    ${i?b`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${b.float(zo)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        fragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        fragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:b`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          fragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${t.debugDrawLabelBorder?b`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;switch(t.output){case F.Color:n.code.add(b`
        void main() {
          ${l}
          ${t.transparencyPassType===it.FrontFace?"fragColor.rgb /= fragColor.a;":""}
        }`);break;case F.Alpha:n.code.add(b`
        void main() {
          ${l}
          fragColor = vec4(fragColor.a);
        }`);break;case F.ObjectAndLayerIdColor:n.code.add(b`
        void main() {
          ${l}
          outputObjectAndLayerIdColor();
        }`);break;case F.Highlight:n.constants.add("occludedHighlightFlag","vec4",aEe).add("unoccludedHighlightFlag","vec4",yQ),n.code.add(b`
        void main() {
          ${l}
          if (voccluded == 1.0) {
            fragColor = occludedHighlightFlag;
          } else {
            fragColor = unoccludedHighlightFlag;
          }
        }`)}return e}function Fae(t){return t.outlineColor[3]>0&&t.outlineSize>0}function VF(t,e=cEe){return t.textureIsSignedDistanceField?sit(t.anchorPosition,t.distanceFieldBoundingBox,e):gs(e,t.anchorPosition),e}function sit(t,e,i){e!=null?mi(i,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1]):mi(i,0,0)}const cEe=Ge(),oit=Object.freeze(Object.defineProperty({__proto__:null,build:nit,calculateAnchorPosForRendering:VF},Symbol.toStringTag,{value:"Module"})),Xu=Go(Te.SRC_ALPHA,Te.ONE,Te.ONE_MINUS_SRC_ALPHA,Te.ONE_MINUS_SRC_ALPHA),ait=Yc(Te.ONE,Te.ONE),uEe=Yc(Te.ZERO,Te.ONE_MINUS_SRC_ALPHA);function Zy(t){return t===it.FrontFace?null:t===it.Alpha?uEe:ait}function BU(t){return t===it.FrontFace?ec:null}const VU=5e5,GU={factor:-1,units:-2};function jU(t){return t?GU:null}function o1(t,e=Bi.LESS){return t===it.NONE||t===it.FrontFace?e:Bi.LEQUAL}let hEe=class dEe extends Fi{initializeConfiguration(e,i){i.spherical=e.viewingMode===Le.Global}initializeProgram(e){return new Mi(e.rctx,dEe.shader.get().build(this.configuration),Si)}initializePipeline(){const e=this.configuration.transparencyPassType,i=this.configuration,r=e===it.NONE,n=e===it.FrontFace,s=this.configuration.hasPolygonOffset?lit:null,o=(r||n)&&i.output!==F.Highlight&&(i.depthEnabled||i.occlusionPass)?ec:null;return Lt({blending:i.output===F.Color||i.output===F.Alpha||i.output===F.Highlight?r?cit:Zy(e):null,depthTest:{func:Bi.LEQUAL},depthWrite:o,colorWrite:Gt,polygonOffset:s})}get primitiveType(){return this.configuration.occlusionPass?ci.POINTS:ci.TRIANGLES}};hEe.shader=new Pi(oit,()=>ce(()=>import("./HUDMaterial.glsl-0fb7c1f6.js"),[],import.meta.url));const lit={factor:0,units:-4},cit=Yc(Te.ONE,Te.ONE_MINUS_SRC_ALPHA);let is=class extends fl{constructor(){super(...arguments),this.output=F.Color,this.transparencyPassType=it.NONE,this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}};u([U({count:F.COUNT})],is.prototype,"output",void 0),u([U({count:it.COUNT})],is.prototype,"transparencyPassType",void 0),u([U()],is.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([U()],is.prototype,"spherical",void 0),u([U()],is.prototype,"occlusionTestEnabled",void 0),u([U()],is.prototype,"signedDistanceFieldEnabled",void 0),u([U()],is.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),u([U()],is.prototype,"vvSize",void 0),u([U()],is.prototype,"vvColor",void 0),u([U()],is.prototype,"hasVerticalOffset",void 0),u([U()],is.prototype,"hasScreenSizePerspective",void 0),u([U()],is.prototype,"debugDrawLabelBorder",void 0),u([U()],is.prototype,"hasSlicePlane",void 0),u([U()],is.prototype,"hasPolygonOffset",void 0),u([U()],is.prototype,"depthEnabled",void 0),u([U()],is.prototype,"pixelSnappingEnabled",void 0),u([U()],is.prototype,"draped",void 0),u([U()],is.prototype,"multipassEnabled",void 0),u([U()],is.prototype,"cullAboveGround",void 0),u([U()],is.prototype,"occlusionPass",void 0),u([U()],is.prototype,"objectAndLayerIdColorInstanced",void 0),u([U({constValue:!0})],is.prototype,"hasSliceInVertexProgram",void 0),u([U({constValue:!1})],is.prototype,"hasVvInstancing",void 0);let lC=class extends n1{constructor(e){super(e,new wit),this._configuration=new is}getConfiguration(e,i){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.isDraped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=i.slot===le.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(e===F.Color||e===F.Alpha),e===F.Color&&(this._configuration.debugDrawLabelBorder=!!pr.LABELS_SHOW_BORDER),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(e,i,r,n,s,o){if(!(r.options.selectionMode&&r.options.hud&&e.visible&&r.point))return;const a=this.parameters,l=r.point,c=r.camera;let{scaleX:h,scaleY:d}=this._getScreenScale(e);h*=c.pixelRatio,d*=c.pixelRatio,rd(E9,i),e.attributes.has(O.FEATUREATTRIBUTE)&&dit(E9);const f=e.attributes.get(O.POSITION),m=e.attributes.get(O.SIZE),y=e.attributes.get(O.NORMAL),_=e.attributes.get(O.AUXPOS1);tt(f.size>=3);const v=VF(a),w=this.parameters.centerOffsetUnits==="screen";for(let x=0;x<f.data.length/f.size;x++){const T=x*f.size;ae(fa,f.data[T],f.data[T+1],f.data[T+2]),ke(fa,fa,i);const S=x*m.size;O0[0]=m.data[S]*h,O0[1]=m.data[S+1]*d,ke(fa,fa,c.viewMatrix);const C=x*_.size;if(ae(iu,_.data[C],_.data[C+1],_.data[C+2]),!w&&(fa[0]+=iu[0],fa[1]+=iu[1],iu[2]!==0)){const R=iu[2];ye(iu,fa),de(fa,fa,re(iu,iu,R))}const A=x*y.size;if(ae(AA,y.data[A],y.data[A+1],y.data[A+2]),this._normalAndViewAngle(AA,E9,c,C9),this._applyVerticalOffsetTransformationView(fa,C9,c,S9),c.applyProjection(fa,Ba),Ba[0]>-1){w&&(iu[0]||iu[1])&&(Ba[0]+=iu[0]*c.pixelRatio,iu[1]!==0&&(Ba[1]+=aQ(iu[1],S9.factorAlignment)*c.pixelRatio),c.unapplyProjection(Ba,fa)),Ba[0]+=this.parameters.screenOffset[0]*c.pixelRatio,Ba[1]+=this.parameters.screenOffset[1]*c.pixelRatio,Ba[0]=Math.floor(Ba[0]),Ba[1]=Math.floor(Ba[1]),P2e(O0,S9.factor,O0);const R=_it*c.pixelRatio;let D=0;if(a.textureIsSignedDistanceField&&(D=a.outlineSize*c.pixelRatio/2),kae(l,Ba[0],Ba[1],O0,R,D,a,v)){const N=r.ray;if(ke(Uae,fa,fs(mit,c.viewMatrix)),Ba[0]=l[0],Ba[1]=l[1],c.unprojectFromRenderScreen(Ba,fa)){const k=E();oe(k,N.direction);const B=1/xe(k);re(k,k,B),o(Mr(N.origin,fa)*B,k,-1,!0,1,Uae)}}}}}intersectDraped(e,i,r,n,s,o){const a=e.attributes.get(O.POSITION),l=e.attributes.get(O.SIZE),c=this.parameters,h=VF(c);let{scaleX:d,scaleY:f}=this._getScreenScale(e);d*=e.screenToWorldRatio,f*=e.screenToWorldRatio;const m=vit*e.screenToWorldRatio;for(let y=0;y<a.data.length/a.size;y++){const _=y*a.size,v=a.data[_],w=a.data[_+1],x=y*l.size;O0[0]=l.data[x]*d,O0[1]=l.data[x+1]*f;let T=0;c.textureIsSignedDistanceField&&(T=c.outlineSize*e.screenToWorldRatio/2),kae(n,v,w,O0,m,T,c,h)&&s(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new Tit(this)}_normalAndViewAngle(e,i,r,n){return Rtt(i)&&(i=rd(fit,i)),Nc(n.normal,e,i),ke(n.normal,n.normal,r.viewInverseTransposeMatrix),n.cosAngle=ge(pEe,bit),n}_updateScaleInfo(e,i,r){const n=this.parameters;n.screenSizePerspective!=null?Cae(r,i,n.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minScaleFactor=0),n.screenSizePerspectiveAlignment!=null?Cae(r,i,n.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minScaleFactor=e.factor.minScaleFactor)}applyShaderOffsetsView(e,i,r,n,s,o,a){const l=this._normalAndViewAngle(i,r,s,C9);return this._applyVerticalGroundOffsetView(e,l,s,a),this._applyVerticalOffsetTransformationView(a,l,s,o),this._applyPolygonOffsetView(a,l,n[3],s,a),this._applyCenterOffsetView(a,n,a),a}applyShaderOffsetsNDC(e,i,r,n,s){return this._applyCenterOffsetNDC(e,i,r,n),s!=null&&oe(s,n),this._applyPolygonOffsetNDC(n,i,r,n),n}_applyPolygonOffsetView(e,i,r,n,s){const o=n.aboveGround?1:-1;let a=Math.sign(r);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return oe(s,e);const c=_e(Math.abs(i.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/n.viewport[2];return re(s,e,l>0?h:1/h),s}_applyVerticalGroundOffsetView(e,i,r,n){const s=xe(e),o=r.aboveGround?1:-1,a=r.computeRenderPixelSizeAtDist(s)*z2e,l=re(fa,i.normal,o*a);return ue(n,e,l),n}_applyVerticalOffsetTransformationView(e,i,r,n){const s=this.parameters;if(!s.verticalOffset?.screenLength){if(s.screenSizePerspective||s.screenSizePerspectiveAlignment){const c=xe(e);this._updateScaleInfo(n,c,i.cosAngle)}else n.factor.scale=1,n.factorAlignment.scale=1;return e}const o=xe(e),a=s.screenSizePerspectiveAlignment??s.screenSizePerspective,l=q2e(r,o,s.verticalOffset,i.cosAngle,a);return this._updateScaleInfo(n,o,i.cosAngle),re(i.normal,i.normal,l),ue(e,e,i.normal)}_applyCenterOffsetView(e,i,r){const n=this.parameters.centerOffsetUnits!=="screen";return r!==e&&oe(r,e),n&&(r[0]+=i[0],r[1]+=i[1],i[2]&&(ye(AA,r),ue(r,r,re(AA,AA,i[2])))),r}_applyCenterOffsetNDC(e,i,r,n){const s=this.parameters.centerOffsetUnits!=="screen";return n!==e&&oe(n,e),s||(n[0]+=i[0]/r.fullWidth*2,n[1]+=i[1]/r.fullHeight*2),n}_applyPolygonOffsetNDC(e,i,r,n){const s=this.parameters.shaderPolygonOffset;if(e!==n&&oe(n,e),s){const o=r.aboveGround?1:-1,a=o*Math.sign(i[3]);n[2]-=(a||o)*s}return n}produces(e,i){if(i===F.Color||i===F.Alpha||i===F.Highlight||i===F.ObjectAndLayerIdColor){if(e===le.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:r,occlusionTest:n}=this.parameters;return e===(r?le.LABEL_MATERIAL:le.HUD_MATERIAL)||n&&e===le.OCCLUSION_PIXELS}return!1}createGLMaterial(e){return new uit(e)}calculateRelativeScreenBounds(e,i,r=Zt()){return hit(this.parameters,e,i,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}_getScreenScale(e){const i=e.attributes.get(O.FEATUREATTRIBUTE);if(i==null)return{scaleX:1,scaleY:1};const r=AJ(i.data,yit),[n,s]=cQ(git,this.parameters,r);return{scaleX:n,scaleY:s}}},uit=class extends xK{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(hEe,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}};function hit(t,e,i,r=pit){return gs(r,t.anchorPosition),r[0]*=-e[0],r[1]*=-e[1],r[0]+=t.screenOffset[0]*i,r[1]+=t.screenOffset[1]*i,r}function dit(t){const e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=1/Math.sqrt(e*e+i*i+r*r),d=1/Math.sqrt(n*n+s*s+o*o),f=1/Math.sqrt(a*a+l*l+c*c);return t[0]=e*h,t[1]=i*h,t[2]=r*h,t[3]=n*d,t[4]=s*d,t[5]=o*d,t[6]=a*f,t[7]=l*f,t[8]=c*f,t}function kae(t,e,i,r,n,s,o,a){let l=e-n-(a[0]>0?r[0]*a[0]:0),c=l+r[0]+2*n,h=i-n-(a[1]>0?r[1]*a[1]:0),d=h+r[1]+2*n;const f=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&f!=null&&(l+=r[0]*f[0],h+=r[1]*f[1],c-=r[0]*(1-f[2]),d-=r[1]*(1-f[3]),l-=s,c+=s,h-=s,d+=s),t[0]>l&&t[0]<c&&t[1]>h&&t[1]<d}const S9=new Z2e,pit=Ge(),fa=E(),AA=E(),Ba=oi(),pEe=E(),Uae=E(),E9=nn(),fit=nn(),mit=be(),iu=E(),git=oi(),yit=oi(),C9={normal:pEe,cosAngle:0},_it=1,vit=2,O0=[0,0],bit=Oe(0,0,1);let wit=class extends mTe{constructor(){super(...arguments),this.renderOccluded=Vr.Occlude,this.isDecoration=!1,this.color=Ft(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=pi(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=Ft(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}};const fEe=Hr().vec3f(O.POSITION).vec3f(O.NORMAL).vec2f(O.UV0).vec4u8(O.COLOR).vec2f(O.SIZE).vec4f(O.AUXPOS1).vec4f(O.FEATUREATTRIBUTE),xit=fEe.clone().vec4u8(O.OBJECTANDLAYERIDCOLOR);let Tit=class{constructor(e){this._material=e,this.vertexBufferLayout=ie("enable-feature:objectAndLayerId-rendering")?xit:fEe}elementCount(e){return 6*e.attributes.get(O.POSITION).indices.length}write(e,i,r,n,s){mQ(r.attributes.get(O.POSITION),e,n.position,s,6),gQ(r.attributes.get(O.NORMAL),i,n.normal,s,6);const o=r.attributes.get(O.UV0).data;let a,l,c,h;if(o==null||o.length<4){const w=this._material.parameters;a=0,l=0,c=w.texCoordScale[0],h=w.texCoordScale[1]}else a=o[0],l=o[1],c=o[2],h=o[3];c=Math.min(1.99999,c+1),h=Math.min(1.99999,h+1);let d=r.attributes.get(O.POSITION).indices.length,f=s;const m=n.uv0;for(let w=0;w<d;++w)m.set(f,0,a),m.set(f,1,l),f++,m.set(f,0,c),m.set(f,1,l),f++,m.set(f,0,c),m.set(f,1,h),f++,m.set(f,0,c),m.set(f,1,h),f++,m.set(f,0,a),m.set(f,1,h),f++,m.set(f,0,a),m.set(f,1,l),f++;K2e(r.attributes.get(O.COLOR),4,n.color,s,6);const{data:y,indices:_}=r.attributes.get(O.SIZE);d=_.length;const v=n.size;f=s;for(let w=0;w<d;++w){const x=y[2*_[w]],T=y[2*_[w]+1];for(let S=0;S<6;++S)v.set(f,0,x),v.set(f,1,T),f++}if(r.attributes.get(O.AUXPOS1)?aC(r.attributes.get(O.AUXPOS1),n.auxpos1,s,6):Nae(n.auxpos1,s,6*d),r.attributes.get(O.FEATUREATTRIBUTE)?aC(r.attributes.get(O.FEATUREATTRIBUTE),n.featureAttribute,s,6):Nae(n.featureAttribute,s,6*d),r.objectAndLayerIdColor!=null){const w=r.attributes.get(O.POSITION)?.indices;if(w){const x=w.length,T=n.getField(O.OBJECTANDLAYERIDCOLOR,Ia);Q2e(r.objectAndLayerIdColor,T,x,s,6)}}}};const nf=E(),NT=oi(),OA=oi(),A9=E(),Sit=be(),Eit=kn(),O9=js(),Cit=E(),Ait=Zt();class Oit{constructor(){this.aabr=Zt(),this.distance=0,this.culled=!1,this.visible=!1}}class Rit{constructor(e,i){this.graphics3DGraphic=e,this.slicePlaneEnabled=i,this.info={}}}var Tc;(function(t){t[t.Idle=0]="Idle",t[t.Process=1]="Process",t[t.Sort=2]="Sort",t[t.Deconflict=3]="Deconflict",t[t.NumStates=4]="NumStates"})(Tc||(Tc={}));class mEe{constructor(){this.camera=new ft,this.slicePlane=By(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),Wx(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let L2=class extends we{get dirty(){return this._dirty}get state(){return this._state}constructor(t){super(t),this._dirty=!1,this._runningViewState=new mEe,this._state=Tc.Idle,this._active=new Map,this._visible=new Map,this._iterators=new Iit,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==Tc.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const t=this._state/Tc.NumStates;return this._dirty?.5*t:t}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(t){switch(this._state){case Tc.Idle:this._startUpdate(),t.madeProgress();case Tc.Process:if(this._state=Tc.Process,!this._processActiveGraphics(t))return;case Tc.Sort:if(this._state=Tc.Sort,!this._sortVisibleGraphics(t))return;case Tc.Deconflict:if(this._state=Tc.Deconflict,!this._deconflictVisibleGraphics(t))return;default:_tt(this,this._visible),this._state=Tc.Idle,this.notifyChange("updating")}}modifyGraphics(t,e){e?t.forEach(i=>this.addToActiveGraphics(i)):t.forEach(i=>this.removeFromActiveGraphics(i)),this.setDirty()}layerSupportsDeconfliction(t){if(t==null||t.type!=="object3d")return!1;const e=t.stageObject;return(e?.geometries.length??0)!==1?!1:e?.geometries[0]?.material instanceof lC}_startUpdate(){vtt(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:t,fullHeight:e}=this._runningViewState.camera;this._initBins(t,e),this._resetIterators()}addToActiveGraphics(t){t.info[this.visibilityGroup]=new Oit,this._active.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromActiveGraphics(t){this._visible.delete(t.graphics3DGraphic.graphic.uid),Pit(t,this.visibilityGroup),delete t.info[this.visibilityGroup],this._active.delete(t.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(t){const e=this._ensureActiveGraphicsIterator(),i=xC(Sit,this._runningViewState.camera.projectionMatrix),r=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?Eit:null;let n=0;for(r!=null&&(ke(r,vo,this._runningViewState.camera.viewMatrix),r[3]=Wi(this.view.spatialReference).radius,n=Obe(r,vo));!t.done;){t.madeProgress();const s=e.next();if(s.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=s.value,a=o?.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,i,r,n),a.culled?this._visible.delete(o.graphics3DGraphic.graphic.uid):this._visible.set(o.graphics3DGraphic.graphic.uid,o))}return!1}_sortVisibleGraphics(t){const e=this._ensureSortGraphicsIterator();for(;!t.done;){const i=e.next();if(t.madeProgress(),i.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(t){const e=this._ensureVisibleGraphicsIterator(),i=this.visibilityGroup===mo.LABEL;for(;!t.done;){t.madeProgress();const r=e.next();if(r.done===!0)return this._resetVisibleGraphicsIterator(),!0;const n=r.value,s=n.info[this.visibilityGroup];if(!s||s.culled){this._setGraphicVisibility(n,!1);continue}const o=n.graphics3DGraphic,a=!i||o.isVisible();s.visible=a&&!this._isConflicted(n),s.visible&&this._addToBins(n),this._setGraphicVisibility(n,s.visible),wtt(s,s.visible)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=zae(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=zae(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=Mit(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(t,e,i,r){const n=t.graphics3DGraphic;if(n.destroyed)return;const s=t.info[this.visibilityGroup];if(!n.isVisible(mo.GRAPHIC,sa.DECONFLICTION))return void(s.culled=!0);const o=this.getGraphicsLayers(n);id(s.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometries[0].material;if(a==null&&(a=Nit,this._getProjectionInfo(l,e,a),a.isOutsideScreen||this._isCulledBySlice(t,nf)||i!=null&&this._isCulledByHorizon(a,i,r)))return void(s.culled=!0);this._expandBoundingRect(s,l,c,a)}a==null?s.culled=!0:(s.distance=a.distance,s.culled=!1)}_getProjectionInfo(t,e,i){const r=this._runningViewState.camera,n=t.stageObject,s=n.geometries[0],o=s.material,a=n.boundingVolumeWorldSpace.bounds;ke(nf,a,r.viewMatrix);const l=s.attributes,c=l.get(O.NORMAL).data,h=l.get(O.AUXPOS1).data;o.applyShaderOffsetsView(nf,c,n.transformation,h,r,i.scaleInfo,nf),Gr(NT,nf[0],nf[1],nf[2],1),Fu(OA,NT,r.projectionMatrix),re(i.positionNDC,OA,1/OA[3]),o.applyShaderOffsetsNDC(i.positionNDC,h,r,i.positionNDC,A9),i.distanceWithoutPolygonOffset=r.depthNDCToWorld(A9[2]),i.distance=A9[2]===i.positionNDC[2]?i.distanceWithoutPolygonOffset:r.depthNDCToWorld(i.positionNDC[2]),Gr(OA,i.positionNDC[0],i.positionNDC[1],i.positionNDC[2],1),Fu(NT,OA,e),dx(NT,NT,1/NT[3]),ae(i.positionView,nf[0],nf[1],nf[2])}_isCulledByHorizon(t,e,i){return oe(O9.direction,t.positionView),ae(O9.origin,0,0,0),!!e1(e,O9,Cit)&&t.distanceWithoutPolygonOffset>i}_isCulledBySlice(t,e){return t.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&FJ(this._runningViewState.slicePlane,e)}_expandBoundingRect(t,e,i,{positionNDC:r,scaleInfo:n}){const s=this._runningViewState.camera,o=e.getScreenSize(Lit);P2e(o,n.factor,o),o[0]*=s.pixelRatio,o[1]*=s.pixelRatio;const a=B5(i.calculateRelativeScreenBounds(o,n.factorAlignment.scale,Ait),xt(0,s.fullWidth,.5+.5*r[0]),xt(0,s.fullHeight,.5+.5*r[1])),l=this.marginFactor;if(l!==0){const c=l*Math.min(Oa(a),Wl(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}lv(t.aabr,a,t.aabr)}_isConflicted(t){const e=t.graphics3DGraphic.graphic.uid,i=t.info[this.visibilityGroup];let r=!0;for(let n=Math.floor(i.aabr[0]/this._accBinsSizeX);n<=Math.floor(i.aabr[2]/this._accBinsSizeX);n++)if(!(n<0||n>=this._accBinsNumX))for(let s=Math.floor(i.aabr[1]/this._accBinsSizeY);s<=Math.floor(i.aabr[3]/this._accBinsSizeY);s++){if(s<0||s>=this._accBinsNumY)continue;r=!1;const o=this._accBins[n][s];for(let a=0;a<o.length;a++){const l=o.data[a],c=l.info[this.visibilityGroup];if(c&&c.visible&&l.graphics3DGraphic.graphic.uid!==e&&(this.accNumTests++,I6(c.aabr,i.aabr)))return!0}}return r}_initBins(t,e){if(this._accBins==null){this._accBins=[];for(let i=0;i<this._accBinsNumX;i++){this._accBins.push([]);const r=this._accBins[this._accBins.length-1];for(let n=0;n<this._accBinsNumY;n++)r.push(new Ut)}}else for(let i=0;i<this._accBinsNumX;i++)for(let r=0;r<this._accBinsNumY;r++)this._accBins[i][r].clear();this._accBinsSizeX=t/this._accBinsNumX,this._accBinsSizeY=e/this._accBinsNumY,this.accNumTests=0}_addToBins(t){const e=t.info[this.visibilityGroup],i=Math.floor(e.aabr[0]/this._accBinsSizeX),r=Math.floor(e.aabr[2]/this._accBinsSizeX),n=Math.floor(e.aabr[1]/this._accBinsSizeY),s=Math.floor(e.aabr[3]/this._accBinsSizeY);for(let o=i;o<=r;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=n;a<=s;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(t)}_setGraphicVisibility(t,e){const i=t.graphics3DGraphic;i.destroyed||(i.setVisibilityFlag(this.visibilityGroup,sa.DECONFLICTION,e),this.visibilityGroup===mo.LABEL&&this.view.labeler.setLabelGraphicVisibility(i,e))}};function Pit(t,e){const i=t.graphics3DGraphic;i.destroyed||i.setVisibilityFlag(e,sa.DECONFLICTION,!0)}function*zae(t){if(Map.prototype.entries){const e=t.entries();for(let i=e.next();!i.done;i=e.next())yield i.value[1]}else yield*t.values()}function*Mit(t,e,i){e.clear(),t.forEach((n,s)=>{const o=e.pushNew();o.id=s,o.visible=n.graphics3DGraphic.getVisibilityFlag(i,sa.DECONFLICTION);const a=n.info?.[i];o.prio=n.graphics3DGraphic.deconflictionPriority,o.distance=a?a.distance:Number.MAX_VALUE}),yield;const r=e.iterableSort((n,s)=>n.prio!==s.prio?s.prio-n.prio:n.distance!==s.distance?n.distance-s.distance:n.visible!==s.visible?n.visible?-1:1:n.id-s.id);for(let n=r.next();!n.done;n=r.next())yield;e.forAll(n=>{const s=t.get(n.id);s&&(t.delete(n.id),t.set(n.id,s))}),e.clear()}u([p({constructOnly:!0})],L2.prototype,"view",void 0),u([p({type:Boolean,readOnly:!0})],L2.prototype,"updating",null),L2=u([M("esri.views.3d.layers.graphics.Deconflictor")],L2);class $it{constructor(){this.id=0,this.visible=!1,this.prio=0,this.distance=0}}class Iit{constructor(e=null,i=null,r=null){this.active=e,this.visible=i,this.sort=r,this.sortArray=new Ut({allocator:n=>n||new $it})}}const Lit=Ge();class Dit{constructor(){this.positionView=E(),this.positionNDC=E(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new Z2e}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}}const Nit=new Dit,Fit=2e3;let h4=class extends L2{constructor(e){super(e),this.visibilityGroup=mo.LABEL,this.marginFactor=.05,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return ca.YIELD;const i=performance.now();if(e.state!==Li.IDLE&&i-this._lastDeconfliction<Fit)return ca.YIELD;super.runTask(e),this.state===Tc.Idle&&(this._lastDeconfliction=i)}enabledChanged(e,i){this.modifyGraphics(i,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};u([p({constructOnly:!0})],h4.prototype,"parent",void 0),h4=u([M("esri.views.3d.layers.graphics.LabelDeconflictor")],h4);let Zq=class extends L2{constructor(){super(...arguments),this._contexts=new Map,this._viewState=new mEe,this.visibilityGroup=mo.GRAPHIC,this._marginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this.addHandles([ne(()=>this.view?.state?.camera,()=>{this._updateViewState(),this.setDirty()}),ne(()=>this.view?.map?.ground?.opacity,(e,i)=>{e!==1&&i!==1||this.setDirty()}),ne(()=>this.view?.slicePlane,()=>{this._updateSlicePlane(),this._slicePlaneChanged()},Xt)]),this._frameTask=this.view.resourceController.scheduler.registerTask(pt.GRAPHICS_DECONFLICTOR,this),this._labels=new h4({view:this.view,parent:this})}destroy(){this._labels=$e(this._labels),this._frameTask=Tr(this._frameTask)}get marginFactor(){return this._marginFactor}set marginFactor(e){this._marginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,i){const r=!(this._graphicSupportsDeconfliction(i)&&R9(e));i.setVisibilityFlag(mo.GRAPHIC,sa.DECONFLICTION,r)}_updateViewState(){this.view?.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;e!=null&&Vbe(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=e!=null}_slicePlaneChanged(){$u(this._contexts,(e,i)=>i.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){const i=this._getGraphicsContext(e);return{addGraphic:r=>this._addGraphic(e,i,r),removeGraphic:r=>this._removeGraphic(i,r),labelingInfoChange:()=>this._labels.enabledChanged(e,i),featureReductionChange:()=>this.enabledChanged(e,i),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,i),clear:()=>i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic))}}removeGraphicsOwner(e){const i=this._contexts.get(e);i&&(i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,i,r){const n=r.graphic.uid,s=new Rit(r,e.symbolCreationContext.slicePlaneEnabled);i.set(n,s),R9(e)&&this.addToActiveGraphics(s),e.labelsEnabled&&this._labels.addToActiveGraphics(s)}_removeGraphic(e,i){const r=i.graphic.uid,n=e.get(r);n&&(this.removeFromActiveGraphics(n),this._labels.removeFromActiveGraphics(n),e.delete(r),this.setDirty())}enabledChanged(e,i){const r=R9(e);r||kit(e),this.modifyGraphics(i,r)}_slicePlaneEnabledChanged(e,i){const r=e.symbolCreationContext.slicePlaneEnabled;i.forEach(n=>n.slicePlaneEnabled=r),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const i=e.layers;if(!i?.length)return!1;for(const r of i)if(this.layerSupportsDeconfliction(r))return!0;return!1}_getGraphicsContext(e){const i=this._contexts.get(e);if(i)return i;const r=new Map;return this._contexts.set(e,r),this.setDirty(),r}};function R9(t){const e=t.layer;return!(!e?.featureReduction||e.featureReduction.type!=="selection")}function kit(t){const e=t.graphics3DGraphics;e&&e.forEach(i=>i.setVisibilityFlag(mo.GRAPHIC,sa.DECONFLICTION,!0))}Zq=u([M("esri.views.3d.layers.graphics.GraphicsDeconflictor")],Zq);function gEe(t){return"declaredClass"in t}function Bae(t){return"declaredClass"in t}function Uit(t){return"declaredClass"in t}function zit(t,e){return t?Uit(t)?t:new vx({layer:e,sourceLayer:e,visible:t.visible,symbol:Q(t.symbol),attributes:Q(t.attributes),geometry:yEe(t.geometry)}):null}function yEe(t){return t==null?null:gEe(t)?t:bv(Bit(t))}function Bit(t){const{wkid:e,wkt:i,wkt2:r,latestWkid:n}=t.spatialReference,s={wkid:e,wkt:i,wkt2:r,latestWkid:n};switch(t.type){case"point":{const{x:o,y:a,z:l,m:c}=t;return{x:o,y:a,z:l,m:c,spatialReference:s}}case"polygon":{const{rings:o,hasZ:a,hasM:l}=t;return{rings:Vae(o),hasZ:a,hasM:l,spatialReference:s}}case"polyline":{const{paths:o,hasZ:a,hasM:l}=t;return{paths:Vae(o),hasZ:a,hasM:l,spatialReference:s}}case"extent":{const{xmin:o,xmax:a,ymin:l,ymax:c,zmin:h,zmax:d,mmin:f,mmax:m,hasZ:y,hasM:_}=t;return{xmin:o,xmax:a,ymin:l,ymax:c,zmin:h,zmax:d,mmin:f,mmax:m,hasZ:y,hasM:_,spatialReference:s}}case"multipoint":{const{points:o,hasZ:a,hasM:l}=t;return{points:vEe(o)?_Ee(o):o,hasZ:a,hasM:l,spatialReference:s}}default:return}}function Vae(t){return Vit(t)?t.map(e=>_Ee(e)):t}function _Ee(t){return t.map(e=>Array.from(e))}function Vit(t){for(const e of t)if(e.length!==0)return vEe(e);return!1}function vEe(t){return t.length>0&&(_C(t[0])||vC(t[0]))}function Git(t,e){if(!t)return null;let i;if(Bae(t)){if(e==null)return t.clone();if(Bae(e))return e.copy(t)}return e!=null?(i=e,i.x=t.x,i.y=t.y,i.spatialReference=t.spatialReference,t.hasZ?(i.z=t.z,i.hasZ=t.hasZ):(i.z=void 0,i.hasZ=!1),t.hasM?(i.m=t.m,i.hasM=!0):(i.m=void 0,i.hasM=!1)):(i=t1(t.x,t.y,t.z,t.spatialReference),t.hasM&&(i.m=t.m,i.hasM=!0)),i}function J5t(t){const{wkid:e,wkt:i,wkt2:r,latestWkid:n}=t,s={wkid:e,wkt:i,wkt2:r,latestWkid:n};return ze.fromJSON(s)}const _Q="__begin__",vQ="__end__",jit=new RegExp(_Q,"ig"),Hit=new RegExp(vQ,"ig"),Gae=new RegExp("^"+_Q,"i"),jae=new RegExp(vQ+"$","i"),GF='"',qit=GF+" + ",Wit=" + "+GF;function Yit(t){return t.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function Xit(t){return t.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function HU(t){const e={expression:"",type:"none"};return t.labelExpressionInfo?t.labelExpressionInfo.value?(e.expression=t.labelExpressionInfo.value,e.type="conventional"):t.labelExpressionInfo.expression&&(e.expression=t.labelExpressionInfo.expression,e.type="arcade"):t.labelExpression!=null&&(e.expression=Yit(t.labelExpression),e.type="conventional"),e}function Zit(t){const e=HU(t);if(!e)return null;switch(e.type){case"conventional":return Jq(e.expression);case"arcade":return e.expression}return null}function Jit(t){const e=HU(t);if(!e)return null;switch(e.type){case"conventional":return Qit(e.expression);case"arcade":return bQ(e.expression)}return null}function Jq(t){let e;return t?(e=s6(t,i=>_Q+'$feature["'+i+'"]'+vQ),e=Gae.test(e)?e.replace(Gae,""):GF+e,e=jae.test(e)?e.replace(jae,""):e+GF,e=e.replaceAll(jit,qit).replaceAll(Hit,Wit)):e='""',e}const Kit=/^\s*\{([^}]+)\}\s*$/i;function Qit(t){return t?.match(Kit)?.[1].trim()||null}const ert=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,trt=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,irt=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function bQ(t){if(!t)return null;let e=ert.exec(t)||trt.exec(t);return e?e[1]||e[3]:(e=irt.exec(t),e?e[2]:null)}const P9=K.getLogger("esri.layers.support.labelFormatUtils"),M9={type:"simple",evaluate:()=>null},rrt={getAttribute:(t,e)=>t.field(e)};async function bEe(t,e,i){if(!t||!t.symbol||!e)return M9;const r=t.where,n=HU(t);let s;if(n.type==="arcade"){const o=await E9e(n.expression,i,e);if(o==null)return M9;s={type:"arcade",evaluate(a,l){try{const c="attributes"in a?o.repurposeFeature(a):a;c.contextTimeZone=l??null;const h=o.evaluate({$view:{timeZone:l},$feature:c},o.services);if(h!=null)return h.toString()}catch(c){P9.error(new G("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:c,feature:a,expression:n}))}return null},needsHydrationToEvaluate:()=>bQ(n.expression)==null}}else s={type:"simple",evaluate:o=>n.expression.replaceAll(/{[^}]*}/g,a=>{const l=a.slice(1,-1),c=e.get(l);if(!c)return a;let h=null;return"attributes"in o?o&&o.attributes&&(h=o.attributes[c.name]):h=o.field(c.name),h==null?"":wEe(h,c)})};if(r){let o;try{o=await QZ(r,e)}catch(l){return P9.error(new G("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:r,error:l})),M9}const a=s.evaluate;s.evaluate=(l,c)=>{const h="attributes"in l?void 0:rrt;try{if(o.testFeature(l,h))return a(l,c)}catch(d){P9.error(new G("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:r,feature:l,error:d}))}return null}}return s}function wEe(t,e){if(t==null)return"";const i=e.domain;if(i){if(i.type==="codedValue"||i.type==="coded-value"){const n=t;for(const s of i.codedValues)if(s.code===n)return s.name}else if(i.type==="range"){const{max:n,min:s}=qve(e),o=+t;if(s!=null&&n!=null&&s<=o&&o<=n)return i.name}}let r=t;return t1e(e)?r=Rv(r,a9e("short-date")):uJ(e)&&(r=cP(+r)),r||""}const K5t=Object.freeze(Object.defineProperty({__proto__:null,createLabelFunction:bEe,formatField:wEe},Symbol.toStringTag,{value:"Module"}));function wQ(t,e){if(t.type==="point")return R0(t,e,!1);if(gEe(t))switch(t.type){case"extent":return R0(t.center,e,!1);case"polygon":return R0(t.centroid,e,!1);case"polyline":return R0(Hae(t),e,!0);case"mesh":return R0(t.origin,e,!1)}else switch(t.type){case"extent":return R0(nrt(t),e,!0);case"polygon":return R0(srt(t),e,!0);case"polyline":return R0(Hae(t),e,!0)}}function Hae(t){const e=t.paths[0];if(!e||e.length===0)return null;const i=w0e(e,b0e(e)/2);return t1(i[0],i[1],i[2],t.spatialReference)}function nrt(t){return t1(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),t.zmin!=null&&t.zmax!=null&&isFinite(t.zmin)&&isFinite(t.zmax)?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function srt(t){const e=t.rings[0];if(!e||e.length===0)return null;const i=x0e(t.rings,!!t.hasZ);return t1(i[0],i[1],i[2],t.spatialReference)}function R0(t,e,i){const r=i?t:Git(t);return e&&t?s_e(t,r,e)?r:null:r}function Q5t(t,e,i,r=0){if(t){e||(e=Zt());const n=t;let s=.5*n.width*(i-1),o=.5*n.height*(i-1);return n.width<1e-7*n.height?s+=o/20:n.height<1e-7*n.width&&(o+=s/20),Gr(e,n.xmin-s-r,n.ymin-o-r,n.xmax+s+r,n.ymax+o+r),e}return null}function xEe(t,e){for(let i=0;i<t.geometries.length;++i){const r=t.geometries[i].getMutableAttribute(O.AUXPOS1);r&&r.data[3]!==e&&(r.data[3]=e,t.geometryVertexAttributeUpdated(t.geometries[i],O.AUXPOS1))}}function gR(t,e,i=null){const r=$M(Hh);return t!=null&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),e!=null?r[3]=e:t!=null&&t.length>3&&(r[3]=t[3]),i&&(r[0]*=i,r[1]*=i,r[2]*=i,r[3]*=i),r}function eFt(t,e,i,r,n,s=[0,0,0,0]){for(let o=0;o<3;++o)s[o]=t?.[o]!=null?t[o]:i?.[o]!=null?i[o]:n[o];return s[3]=e??r??n[3],s}function qae(t=ey,e,i,r=1){const n=new Array(3);if(e==null||i==null)n[0]=1,n[1]=1,n[2]=1;else{let s,o=0;for(let a=2;a>=0;a--){const l=t[a];let c;const h=l!=null,d=a===0&&!s&&!h,f=i[a];l==="symbol-value"||d?c=f!==0?e[a]/f:1:h&&l!=="proportional"&&isFinite(l)&&(c=f!==0?l/f:1),c!=null&&(n[a]=c,s=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)n[a]==null?n[a]=s:n[a]===0&&(n[a]=.001*o)}for(let s=2;s>=0;s--)n[s]/=r;return Ta(n)}function ort(t){return t.isPrimitive!=null}function qU(t){return Kq(ort(t)?[t.width,t.depth,t.height]:t)?null:"Symbol sizes may not be negative values"}function Kq(t){const e=i=>i==null||i>=0;return Array.isArray(t)?t.every(e):e(t)}function art(t,e,i,r=be()){return t&&ME(r,r,-t/180*Math.PI),e&&PE(r,r,e/180*Math.PI),i&&C6(r,r,i/180*Math.PI),r}function xQ(t,e,i){if(i.minDemResolution!=null)return i.minDemResolution;const r=Da(e),n=Vx(t)*r,s=Gx(t)*r,o=Kv(t)*(e.isGeographic?1:r);return n===0&&s===0&&o===0?i.minDemResolutionForPoints:.01*Math.max(n,s,o)}function TEe(t,e,i,r,n,s,o,a,l,c,h){const d=mrt[h.mode];let f,m,y=0;if(rn(t,e,i,r,l.spatialReference,n,a))return d.requiresAlignment(h)?(y=d.applyElevationAlignmentBuffer(r,n,s,o,a,l,c,h),f=s,m=o):(f=r,m=n),rn(f,l.spatialReference,m,s,c.spatialReference,o,a)?y:void 0}function Bv(t,e,i,r,n){const s=(mF(t)?t.z:Bwe(t)?t.array[t.offset+2]:t[2])||0;switch(i.mode){case"on-the-ground":{const o=om(e,t,"ground")??0;return n.verticalDistanceToGround=0,n.sampledElevation=o,void(n.z=o)}case"relative-to-ground":{const o=om(e,t,"ground")??0,a=i.geometryZWithOffset(s,r);return n.verticalDistanceToGround=a,n.sampledElevation=o,void(n.z=a+o)}case"relative-to-scene":{const o=om(e,t,"scene")??0,a=i.geometryZWithOffset(s,r);return n.verticalDistanceToGround=a,n.sampledElevation=o,void(n.z=a+o)}case"absolute-height":{const o=i.geometryZWithOffset(s,r),a=om(e,t,"ground")??0;return n.verticalDistanceToGround=o-a,n.sampledElevation=a,void(n.z=o)}default:return void(n.z=0)}}function lrt(t,e,i,r){return Bv(t,e,i,r,D2),D2.z}function YM(t,e,i){return e==null||i==null?t.definedChanged:e==="on-the-ground"&&i==="on-the-ground"?t.staysOnTheGround:e===i||e!=="on-the-ground"&&i!=="on-the-ground"?xn.UPDATE:t.onTheGroundChanged}function cd(t){return t==="relative-to-ground"||t==="relative-to-scene"}function Vv(t){return t!=="absolute-height"}function crt(t,e,i,r,n){Bv(e,i,n,r,D2),xEe(t,D2.verticalDistanceToGround);const s=D2.sampledElevation,o=Qn(grt,t.transformation);return aL[0]=e.x,aL[1]=e.y,aL[2]=D2.z,Bc(e.spatialReference,aL,o,r.spatialReference)?t.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),s}function urt(t,e,i,r,n,s){let o=0;const a=s.spatialReference;e*=3,r*=3;for(let l=0;l<n;++l){const c=t[e],h=t[e+1],d=t[e+2],f=s.getElevation(c,h,d,a,"ground")??0;o+=f,i[r]=c,i[r+1]=h,i[r+2]=f,e+=3,r+=3}return o/n}function hrt(t,e,i,r,n,s,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,d=s.spatialReference;e*=3,r*=3;for(let f=0;f<n;++f){const m=t[e],y=t[e+1],_=t[e+2],v=s.getElevation(m,y,_,d,"ground")??0;l+=v,i[r]=m,i[r+1]=y,i[r+2]=h==null?_+v+c:v+c,e+=3,r+=3}return l/n}function drt(t,e,i,r,n,s,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,d=s.spatialReference;e*=3,r*=3;for(let f=0;f<n;++f){const m=t[e],y=t[e+1],_=t[e+2],v=s.getElevation(m,y,_,d,"scene")??0;l+=v,i[r]=m,i[r+1]=y,i[r+2]=h==null?_+v+c:v+c,e+=3,r+=3}return l/n}function prt(t){const e=t.meterUnitOffset,i=t.featureExpressionInfoContext;return e!==0||i!=null}function frt(t,e,i,r,n,s,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;e*=3,r*=3;for(let h=0;h<n;++h){const d=t[e],f=t[e+1],m=t[e+2];i[r]=d,i[r+1]=f,i[r+2]=c==null?m+l:l,e+=3,r+=3}return 0}let XM=class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};var xn;(function(t){t[t.NONE=0]="NONE",t[t.UPDATE=1]="UPDATE",t[t.RECREATE=2]="RECREATE"})(xn||(xn={}));const mrt={"absolute-height":{applyElevationAlignmentBuffer:frt,requiresAlignment:prt},"on-the-ground":{applyElevationAlignmentBuffer:urt,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:hrt,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:drt,requiresAlignment:()=>!0}},grt=be(),D2=new XM,aL=E();function TQ(t){return t.mapPositions!=null}function SEe(t,e,i,r,n){const s=t.stageObject,o=s.geometries;let a=0;for(const l of o){if(!TQ(l))continue;const{update:c,averageGeometrySampledElevation:h}=CEe(l,e,i,r,n);a+=h,c&&s.geometryVertexAttributeUpdated(l,O.POSITION)}return a/o.length}function Xw(t,e,i,r,n,s){const o=t.stageObject,a=e.centerPointInElevationSR;let l=0;o.usesVerticalDistanceToGround?(r(a,Vl),xEe(o,Vl.verticalDistanceToGround),l=Vl.sampledElevation):(r(a,Vl),e.mode!=="absolute-height"&&(l=Vl.sampledElevation));const c=Qn(yrt,s??o.transformation),h=ae(EEe,c[12],c[13],c[14]);pr.TESTS_DISABLE_OPTIMIZATIONS?(Bl[0]=a.x,Bl[1]=a.y,Bl[2]=Vl.z,Bc(a.spatialReference,Bl,c,n.spatialReference)&&(s?Qn(s,c):o.transformation=c)):n.setAltitudeOfTransformation(Vl.z,c);const d=SQ/n.unitInMeters;return(Math.abs(c[12]-h[0])>=d||Math.abs(c[13]-h[1])>=d||Math.abs(c[14]-h[2])>=d)&&(s?Qn(s,c):o.transformation=c),l}const yrt=be();function _rt(t,e,i,r,n){const s=t.graphics3DSymbolLayer.lodRenderer;if(s==null)return 0;const o=e.centerPointInElevationSR;r(o,Vl);const a=e.mode!=="absolute-height"?Vl.sampledElevation:0,l=s.instanceData,c=t.instanceIndex,h=brt;l.getGlobalTransform(c,h);const d=ae(EEe,h[12],h[13],h[14]);pr.TESTS_DISABLE_OPTIMIZATIONS?(Bl[0]=o.x,Bl[1]=o.y,Bl[2]=Vl.z,Bc(o.spatialReference,Bl,h,n.spatialReference)&&l.setGlobalTransform(c,h)):n.setAltitudeOfTransformation(Vl.z,h);const f=SQ/n.unitInMeters;return(pr.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(h[12]-d[0])>=f||Math.abs(h[13]-d[1])>=f||Math.abs(h[14]-d[2])>=f)&&l.setGlobalTransform(c,h),a}function vrt(t,e,i,r,n){const s=t.stageObject,o=s.geometries;if(o.length===0)return 0;let a=0,l=null,c=0,h=!1;for(const d of o){if(!TQ(d))continue;const f=d.attributes.get(O.POSITION);if(f!==l){const{update:m,averageGeometrySampledElevation:y}=CEe(d,e,i,r,n);c=y,l=f,h=m}h&&s.geometryVertexAttributeUpdated(d,O.POSITION),a+=c}return a/o.length}const SQ=.01,Bl=E(),hh=E(),FT=E(),brt=be(),EEe=E(),Vl=new XM;function CEe(t,e,i,r,n){let s=!1;const o=t.transformation,a=e.requiresSampledElevationInfo;hh[0]=o[12],hh[1]=o[13],hh[2]=o[14],t.invalidateBoundingInfo();const l=t.getMutableAttribute(O.POSITION),c=l.data,h=l.size,d=c.length/h,f=new nK(t.mapPositions,i);let m=0,y=0;for(let _=0;_<d;_++){if(FT[0]=c[m],FT[1]=c[m+1],FT[2]=c[m+2],r(f,Vl),a&&(y+=Vl.sampledElevation),pr.TESTS_DISABLE_OPTIMIZATIONS)c[m]=f.array[f.offset],c[m+1]=f.array[f.offset+1],c[m+2]=Vl.z,rn(c,i,m,c,n.spatialReference,m,1),c[m]-=hh[0],c[m+1]-=hh[1],c[m+2]-=hh[2],s=!0;else{Bl[0]=c[m]+hh[0],Bl[1]=c[m+1]+hh[1],Bl[2]=c[m+2]+hh[2],n.setAltitude(Bl,Vl.z),c[m]=Bl[0]-hh[0],c[m+1]=Bl[1]-hh[1],c[m+2]=Bl[2]-hh[2];const v=SQ/n.unitInMeters;(Math.abs(FT[0]-c[m])>=v||Math.abs(FT[1]-c[m+1])>=v||Math.abs(FT[2]-c[m+2])>=v)&&(s=!0)}m+=h,f.offset+=3}return y/=d,{update:s,averageGeometrySampledElevation:y}}function wrt(t){return!!t&&nC[t]!=null}function xrt(t){return 1/(nC[t]||1)}function Trt(){const t=Object.keys(nC);return t.sort(),t}const Srt=Trt(),Ert=K.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function Crt(t){return{cachedResult:t.cachedResult,arcade:t.arcade?{func:t.arcade.func,context:t.arcade.modules.arcadeUtils.createExecContext(null,{sr:t.arcade.context.spatialReference}),modules:t.arcade.modules}:null}}function iFt(t){const e=t?.expression;if(typeof e=="string"){const i=REe(e);if(i!=null)return{cachedResult:i}}return null}async function rFt(t,e,i,r){const n=t?.expression;if(typeof n!="string")return null;const s=REe(n);if(s!=null)return{cachedResult:s};const o=await Pv();Tt(i);const a=o.arcadeUtils,l=a.createSyntaxTree(n);return a.dependsOnView(l)?(r?.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:e}),modules:o}}}function AEe(t,e,i){return t.arcadeUtils.createFeature(e.attributes,e.geometry,i)}function WU(t,e){if(t!=null&&!OEe(t)){if(!e||!t.arcade)return void Ert.errorOncePerTick("Arcade support required but not provided");const i=e;i._geometry&&(i._geometry=yEe(i._geometry)),t.arcade.modules.arcadeUtils.updateExecContext(t.arcade.context,e)}}function Art(t){if(t!=null){if(OEe(t))return t.cachedResult;const e=t.arcade;let i=e?.modules.arcadeUtils.executeFunction(e.func,e.context);return typeof i!="number"&&(t.cachedResult=0,i=0),i}return 0}function nFt(t,e=!1){let i=t?.featureExpressionInfo;const r=i?.expression;return e||r==="0"||(i=null),i??null}const Ort={cachedResult:0};function OEe(t){return t.cachedResult!=null}function REe(t){return t==="0"?0:null}let jF=class PEe{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=xrt(e)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,i){const r=this.calculateOffsetRenderUnits(i);return this.featureExpressionInfoContext!=null?r:e+r}calculateOffsetRenderUnits(e){let i=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return r!=null&&(i+=Art(r)*this._metersPerElevationInfoUnit),i/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=wrt(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}updateFeatureExpressionInfoContext(e,i,r){if(e==null)return void(this._featureExpressionInfoContext=null);const n=e?.arcade;n&&i!=null&&r!=null?(this._featureExpressionInfoContext=Crt(e),WU(this._featureExpressionInfoContext,AEe(n.modules,i,r))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const i=new PEe;return e!=null&&i.setFromElevationInfo(e),i}},Rrt=class{constructor(e,i,r){this.graphic=e,this.renderingInfo=i,this.layer=r}};var qt;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OPAQUE=2]="OPAQUE"})(qt||(qt={}));let Prt=class{constructor(e,i,r){this.baseMaterial=e,this.edgeMaterials=i,this.properties=r}},Ym=class{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,i,r,n,s,o,a,l=null){this.graphics3DSymbolLayer=e,this.stageObject=i,this._uniqueGeometries=r,this._uniqueMaterials=n,this._sharedResource=s,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e;const i=e.stage;i.addMany(this._uniqueMaterials),i.addMany(this._uniqueGeometries),i.add(this.stageObject)}destroy(){if(!this._stageLayer)return;const e=this._stageLayer.stage;e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const i=e.renderer.edgeView;i?.hasObject(this.stageObject)&&i.removeObject(this.stageObject),this.stageObject.dispose(),this._sharedResource?.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(e,i){if(this._edgeState==null)return;const r=Wae(this._edgeState.baseMaterial);let n=!1;for(const s of this._edgeState.edgeMaterials)s.objectTransparency!==r&&(s.objectTransparency=r,n=!0);n&&this.resetEdgeObject(i),this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[e])}slicePlaneEnabledChanged(e,i){this._edgeState!=null&&(this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:e},!i),this._edgeState.properties.hasSlicePlane=e)}setVisibility(e){if(this._stageLayer!=null&&this._visible!==e&&(this._visible=e,this.stageObject.visible=e,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),this._edgeState)){const i=this._stageLayer.stage.renderer.ensureEdgeView();i.hasObject(this.stageObject)?i.updateObjectVisibility(this.stageObject,e):e&&this._addOrUpdateEdgeObject(i,!1)}}get visible(){return this._visible}alignWithElevation(e,i,r,n){if(this.elevationAligner==null)return;r!=null&&WU(this.elevationContext.featureExpressionInfoContext,r);const s=(o,a)=>Bv(o,e,this.elevationContext,i,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,s,i),this.resetEdgeObject(n)}alignWithAbsoluteElevation(e,i,r){const n=(s,o)=>{o.sampledElevation=e,o.verticalDistanceToGround=0,o.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,n,i),this.resetEdgeObject(r)}getCenterObjectSpace(e=E()){return oe(e,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(e=ks()){const i=this.stageObject.boundingVolumeObjectSpace;return x1e(e,i.min),T1e(e,i.max),e}computeAttachmentOrigin(e){const i=this.stageObject.effectiveTransformation;if(this.useObjectOriginAsAttachmentOrigin)e.render.origin[0]+=i[12],e.render.origin[1]+=i[13],e.render.origin[2]+=i[14],e.render.num++;else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(rg)&&(ke(rg,rg,i),ue(e.render.origin,e.render.origin,rg),e.render.num++)}async getProjectedBoundingBox(e,i,r,n,s){const o=this.getBoundingBoxObjectSpace(s),a=Mrt,l=_J(o)?1:a.length;for(let h=0;h<l;h++){const d=a[h];P0[0]=o[d[0]],P0[1]=o[d[1]],P0[2]=o[d[2]],ke(P0,P0,this.stageObject.transformation),P1[3*h]=P0[0],P1[3*h+1]=P0[1],P1[3*h+2]=P0[2]}if(!e(P1,0,l))return null;Pr(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let d=0;d<3;d++)o[d]=Math.min(o[d],P1[h+d]),o[d+3]=Math.max(o[d+3],P1[h+d]);c&&r.push({location:P1.slice(h,h+3),screenSpaceBoundingRect:c})}if(i?.service&&this.elevationContext.mode!=="absolute-height"){_p(o,rg);const h=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let d=0;if(i.useViewElevation)d=i.service.getElevation(rg[0],rg[1],h)??0;else try{const f=xQ(o,i.service.spatialReference,i);d=await i.service.queryElevation(rg[0],rg[1],n,f,h)??0}catch{}w1e(o,0,0,-this.alignedSampledElevation+d)}return o}addObjectState(e,i){e===Py.Highlight&&i.addObject(this.stageObject,this.stageObject.highlight()),e===Py.MaskOccludee&&i.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}resetEdgeObject(e){if(this._edgeState==null)return;const i=this._stageLayer.stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(i,e):i.removeObject(this.stageObject)}_addOrUpdateEdgeObject(e,i){const r=this._edgeState;if(r==null)return;const n=Wae(r.baseMaterial);for(const s of r.edgeMaterials)s.objectTransparency=n;e.addOrUpdateObject3D(this.stageObject,r.edgeMaterials,r.properties,!i).then(()=>this._stageLayer?.sync())}};function Wae(t){return t.isVisible()?t.parameters.transparent?qt.TRANSPARENT:qt.OPAQUE:qt.INVISIBLE}const P1=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],P0=E(),rg=E(),Mrt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];let MEe=class{constructor(e,i=null){this.labelText=i,this.elevationOffset=e??0}};const $Ee=3,Qq=3,IEe=10;let LEe=class{constructor(e,i=null){this.geometry=e,this.textures=i}},DEe=class{constructor(e,i,r){this.components=e,this.minScreenSpaceRadius=i,this.pivotOffset=r;const n=this.geometries;this.numVertices=n.reduce((s,o)=>s+o.attributes.get(O.POSITION).indices.length,0)}get geometries(){return t6(this.components.map(e=>e.geometry))}},NEe=class{constructor(e){this.levels=e,this.levels.sort((i,r)=>i.minScreenSpaceRadius===r.minScreenSpaceRadius?i.numVertices-r.numVertices:i.minScreenSpaceRadius-r.minScreenSpaceRadius)}};function lL(t){const e=[];return t.levels.forEach(i=>i.components.forEach(r=>e.push(r.geometry.material))),t6(e)}function Yae(t){const e=new Array;return t.levels.forEach(i=>i.components.forEach(r=>{r.textures!=null&&e.push(...r.textures)})),t6(e)}function Xae(t){const e=new Array;return t.levels.forEach(i=>i.components.forEach(r=>e.push(r.geometry))),t6(e)}function $rt(t){switch(t){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function FEe(t,e){const i=(r,n,s=!1)=>new NEe(r.map(o=>{const a=n(o.tesselation);return s&&hJe(a),new DEe([new LEe(a)],o.minScreenSpaceRadius)}));switch(t){case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],r=>lJe(e,.5,r,!0));case"cube":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>QZe(e,1));case"cone":return i($9,r=>moe(e,1,.5,r,!1),!0);case"inverted-cone":return i($9,r=>moe(e,1,.5,r,!0),!0);case"cylinder":return i($9,r=>uJe(e,1,.5,r,[0,0,1],[0,0,.5]));case"tetrahedron":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>aJe(e,1),!0);case"diamond":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>rJe(e,1),!0);default:return}}const $9=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];let Dh=class{constructor(e){this.estimated=!1,this.verticesPerFeature=e.verticesPerFeature??0,this.verticesPerCoordinate=e.verticesPerCoordinate??0,this.drawCallsPerFeature=e.drawCallsPerFeature??0,this.memory=e.memory??new kEe}},EQ=class extends Dh{constructor(e){super(e),this.estimated=!0}},Irt=class extends Dh{constructor(e,i){super(i),this.numComplexities=e}},Lrt=class extends EQ{constructor(e,i){super(i),this.numComplexities=e}},kEe=class{constructor(){this.bytesPerFeature=0,this.bytesPerFeatureLabel=0,this.resourceBytes=0,this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}};function Drt(t){return t.type==="fill"}function Nrt(t){return t.type==="extrude"}function Frt(t){return t&&t.enabled&&(Nrt(t)||Drt(t))&&t.edges!=null}function krt(t){return t&&t.enabled&&t.edges||null}function UEe(t,e){return Urt(krt(t),e)}function Urt(t,e){if(t==null)return null;const i=t.color!=null?AJ(Pe.toUnitRGBA(t.color)):Ft(0,0,0,0),r=Jn(t.size),n=Jn(t.extensionLength);switch(t.type){case"solid":return zrt({color:i,size:r,extensionLength:n,...e});case"sketch":return Brt({color:i,size:r,extensionLength:n,...e});default:return}}function zrt(t){return{...Vrt,...t,type:"solid"}}function Brt(t){return{...Grt,...t,type:"sketch"}}const Vrt={color:Ft(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:qt.OPAQUE,hasSlicePlane:!1},Grt={color:Ft(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:qt.OPAQUE,hasSlicePlane:!1};function ZM(t,e){switch(e.normalType){case Ni.Compressed:t.attributes.add(O.NORMALCOMPRESSED,"vec2"),t.vertex.code.add(b`vec3 normalModel() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
return vec3(normalCompressed + sign(normalCompressed) * min(z, 0.0), z);
}`);break;case Ni.Attribute:t.attributes.add(O.NORMAL,"vec3"),t.vertex.code.add(b`vec3 normalModel() {
return normal;
}`);break;case Ni.ScreenDerivative:t.fragment.code.add(b`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:e.normalType;case Ni.COUNT:case Ni.Ground:}}var Ni;(function(t){t[t.Attribute=0]="Attribute",t[t.Compressed=1]="Compressed",t[t.Ground=2]="Ground",t[t.ScreenDerivative=3]="ScreenDerivative",t[t.COUNT=4]="COUNT"})(Ni||(Ni={}));function zEe(t,e){const i=t.fragment;switch(i.code.add(b`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),e.doubleSidedMode){case hn.None:i.code.add(b`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case hn.View:i.code.add(b`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case hn.WindingOrder:i.code.add(b`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:e.doubleSidedMode;case hn.COUNT:}}var hn;(function(t){t[t.None=0]="None",t[t.View=1]="View",t[t.WindingOrder=2]="WindingOrder",t[t.COUNT=3]="COUNT"})(hn||(hn={}));let VC=class{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.attributes.get(O.POSITION).indices.length}write(e,i,r,n,s){Qtt(r,this.vertexBufferLayout,e,i,n,s)}};function YU(t,e){switch(e.normalType){case Ni.Attribute:case Ni.Compressed:t.include(ZM,e),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("vNormalView","vec3"),t.vertex.uniforms.add(new TP("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel),new qp("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal)),t.vertex.code.add(b`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case Ni.Ground:t.include(tE,e),t.varyings.add("vNormalWorld","vec3"),t.vertex.code.add(b`
        void forwardNormal() {
          vNormalWorld = ${e.spherical?b`normalize(vPositionWorldCameraRelative);`:b`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case Ni.ScreenDerivative:t.vertex.code.add(b`void forwardNormal() {}`);break;default:e.normalType;case Ni.COUNT:}}let BEe=class extends XTe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=nn()}},VEe=class extends ZTe{constructor(){super(...arguments),this.transformNormalGlobalFromModel=nn(),this.toMapSpace=oi()}};const CQ={func:Bi.LESS},HF={func:Bi.ALWAYS},$m={mask:255},GEe={mask:0},jrt=t=>({function:{func:Bi.NOTEQUAL,ref:t,mask:t},operation:{fail:tn.KEEP,zFail:tn.KEEP,zPass:tn.KEEP}}),Hrt=t=>({function:{func:Bi.ALWAYS,ref:t,mask:t},operation:{fail:tn.KEEP,zFail:tn.KEEP,zPass:tn.REPLACE}}),a1={function:{func:Bi.ALWAYS,ref:Zl.OutlineVisualElementMask,mask:Zl.OutlineVisualElementMask},operation:{fail:tn.KEEP,zFail:tn.KEEP,zPass:tn.ZERO}},Gv={function:{func:Bi.ALWAYS,ref:Zl.OutlineVisualElementMask,mask:Zl.OutlineVisualElementMask},operation:{fail:tn.KEEP,zFail:tn.KEEP,zPass:tn.REPLACE}},jEe={function:{func:Bi.EQUAL,ref:Zl.OutlineVisualElementMask,mask:Zl.OutlineVisualElementMask},operation:{fail:tn.KEEP,zFail:tn.KEEP,zPass:tn.KEEP}},HEe={function:{func:Bi.NOTEQUAL,ref:Zl.OutlineVisualElementMask,mask:Zl.OutlineVisualElementMask},operation:{fail:tn.KEEP,zFail:tn.KEEP,zPass:tn.KEEP}};function qEe({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:i,roughnessFactor:r,emissiveTexture:n,emissiveFactor:s,occlusionTexture:o}){return t==null&&e==null&&n==null&&(s==null||oa(s,vo))&&o==null&&(r==null||r===1)&&(i==null||i===1||i===0)}const XU=[1,1,.5],AQ=[0,.6,.2],qrt=[0,1,.2];function WEe(t){t.vertex.code.add(b`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}var Is;function Wrt(t){switch(t){case"multiply":default:return Is.Multiply;case"ignore":return Is.Ignore;case"replace":return Is.Replace;case"tint":return Is.Tint}}function YEe(t,e,i){if(t==null||e===Is.Ignore)return i[0]=255,i[1]=255,i[2]=255,void(i[3]=255);const r=_e(Math.round(t[3]*qF),0,qF),n=r===0||e===Is.Tint?0:e===Is.Replace?Yrt:Xrt;i[0]=_e(Math.round(t[0]*kT),0,kT),i[1]=_e(Math.round(t[1]*kT),0,kT),i[2]=_e(Math.round(t[2]*kT),0,kT),i[3]=r+n}(function(t){t[t.Multiply=1]="Multiply",t[t.Ignore=2]="Ignore",t[t.Replace=3]="Replace",t[t.Tint=4]="Tint"})(Is||(Is={}));const kT=255,qF=85,Yrt=qF,Xrt=2*qF;function XEe(t){t.vertex.code.add(b`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${b.int(Is.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${b.int(Is.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${b.int(Is.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${b.int(Is.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}let JM=class extends dn{constructor(e,i){super(e,"int",Oi.Pass,(r,n,s)=>r.setUniform1i(e,i(n,s)))}};function ZEe(t,e){e.hasSymbolColors?(t.include(XEe),t.attributes.add(O.SYMBOLCOLOR,"vec4"),t.varyings.add("colorMixMode","mediump float"),t.vertex.code.add(b`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(t.fragment.uniforms.add(new JM("colorMixMode",i=>Y2e[i.colorMixMode])),t.vertex.code.add(b`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function tT(t,e){e.hasVertexColors?(t.attributes.add(O.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(b`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(b`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):t.vertex.code.add(b`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function JEe(t){t.code.add(b`const float MAX_RGBA4_FLOAT =
15.0 / 16.0 +
15.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 / 16.0;
const vec4 FIXED_POINT_FACTORS_RGBA4 = vec4(1.0, 16.0, 16.0 * 16.0, 16.0 * 16.0 * 16.0);
vec4 floatToRgba4(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA4_FLOAT);
vec4 fixedPointU4 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS_RGBA4) * 16.0);
const float toU4AsFloat = 1.0 / 15.0;
return fixedPointU4 * toU4AsFloat;
}
const vec4 RGBA4_2_FLOAT_FACTORS = vec4(
15.0 / (16.0),
15.0 / (16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0 * 16.0)
);
float rgba4ToFloat(vec4 rgba) {
return dot(rgba, RGBA4_2_FLOAT_FACTORS);
}`)}function $y(t,e){switch(e.output){case F.Shadow:case F.ShadowHighlight:case F.ShadowExcludeHighlight:t.fragment.include(JEe),t.fragment.code.add(b`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
return depth + SLOPE_SCALE * m + BIAS;
}
void outputDepth(float _linearDepth) {
fragColor = floatToRgba4(_calculateFragDepth(_linearDepth));
}`);break;case F.Depth:t.fragment.include(dd),t.fragment.code.add(b`void outputDepth(float _linearDepth) {
fragColor = float2rgba(_linearDepth);
}`)}}function Zrt(t){t.fragment.code.add(b`
    #define discardOrAdjustAlpha(color) { if (color.a < ${b.float(zo)}) { discard; } }
  `)}let Zw=class extends dn{constructor(e,i){super(e,"float",Oi.Draw,(r,n,s)=>r.setUniform1f(e,i(n,s)))}};function Jw(t,e){KEe(t,e,new Re("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function Jrt(t,e){KEe(t,e,new Zw("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function KEe(t,e,i){const r=t.fragment;switch(e.alphaDiscardMode!==nr.Mask&&e.alphaDiscardMode!==nr.MaskBlend||r.uniforms.add(i),e.alphaDiscardMode){case nr.Blend:return t.include(Zrt);case nr.Opaque:r.code.add(b`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case nr.Mask:r.code.add(b`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case nr.MaskBlend:t.fragment.code.add(b`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function QEe(t,e){const{vertex:i,fragment:r}=t,n=e.hasColorTexture&&e.alphaDiscardMode!==nr.Opaque;switch(e.output){case F.Depth:case F.Shadow:case F.ShadowHighlight:case F.ShadowExcludeHighlight:case F.ObjectAndLayerIdColor:zc(i,e),t.include(Xl,e),t.include(mm,e),t.include(dy,e),t.include($y,e),t.include(Dn,e),t.include(qM,e),Sx(t),t.varyings.add("depth","float"),n&&r.uniforms.add(new et("tex",s=>s.texture)),i.code.add(b`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
forwardTextureCoordinates();
forwardObjectAndLayerIdColor();
}`),t.include(Jw,e),r.code.add(b`
          void main(void) {
            discardBySlice(vpos);
            ${n?b`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${e.output===F.ObjectAndLayerIdColor?b`outputObjectAndLayerIdColor();`:b`outputDepth(depth);`}
          }
        `);break;case F.Normal:{zc(i,e),t.include(Xl,e),t.include(ZM,e),t.include(YU,e),t.include(mm,e),t.include(dy,e),n&&r.uniforms.add(new et("tex",o=>o.texture)),e.normalType===Ni.ScreenDerivative&&t.varyings.add("vPositionView","vec3");const s=e.normalType===Ni.Attribute||e.normalType===Ni.Compressed;i.code.add(b`
          void main(void) {
            vpos = getVertexInLocalOriginSpace();

            ${s?b`vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:b`
                  // Get vertex position in camera space for screen-space derivative normals
                  vPositionView = (view * vec4(vpos, 1.0)).xyz;
                `}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),t.include(Dn,e),t.include(Jw,e),r.code.add(b`
          void main() {
            discardBySlice(vpos);
            ${n?b`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${e.normalType===Ni.ScreenDerivative?b`vec3 normal = screenDerivativeNormal(vPositionView);`:b`
                  vec3 normal = normalize(vNormalWorld);
                  if (gl_FrontFacing == false){
                    normal = -normal;
                  }`}
            fragColor = vec4(0.5 + 0.5 * normal, 1.0);
          }
        `);break}case F.Highlight:zc(i,e),t.include(Xl,e),t.include(mm,e),t.include(dy,e),n&&r.uniforms.add(new et("tex",s=>s.texture)),i.code.add(b`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();
}`),t.include(Dn,e),t.include(Jw,e),t.include(s1,e),r.code.add(b`
          void main() {
            discardBySlice(vpos);
            ${n?b`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}function eCe(t,e){const i=t.fragment;e.hasVertexTangents?(t.attributes.add(O.TANGENT,"vec4"),t.varyings.add("vTangent","vec4"),e.doubleSidedMode===hn.WindingOrder?i.code.add(b`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):i.code.add(b`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):i.code.add(b`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),e.textureCoordinateType!==Zn.None&&(t.include(wK,e),i.uniforms.add(e.pbrTextureBindType===Oi.Pass?new et("normalTexture",r=>r.textureNormal):new Yh("normalTexture",r=>r.textureNormal)),i.code.add(b`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;
return tangentSpace * rawNormal;
}`))}let tCe=class extends dn{constructor(e,i){super(e,"vec2",Oi.Draw,(r,n,s,o)=>r.setUniform2fv(e,i(n,s,o)))}};const I9=4;function Krt(){const t=new Ei,e=t.fragment;t.include(Na);const i=(I9+1)/2,r=1/(2*i*i);return e.include(od),e.uniforms.add(new et("depthMap",n=>n.depthTexture),new Yh("tex",n=>n.colorTexture),new tCe("blurSize",n=>n.blurSize),new Re("projScale",(n,s)=>{const o=Mr(s.camera.eye,s.camera.center);return o>5e4?Math.max(0,n.projScale-(o-5e4)):n.projScale}),new Ki("nearFar",(n,s)=>s.camera.nearFar)),e.code.add(b`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${b.float(r)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),t.outputs.add("fragBlur","float"),e.code.add(b`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${b.int(I9)}; r <= ${b.int(I9)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      fragBlur = b / w_total;
    }
  `),t}const Qrt=Object.freeze(Object.defineProperty({__proto__:null,build:Krt},Symbol.toStringTag,{value:"Module"}));let iCe=class rCe extends Fi{initializeProgram(e){return new Mi(e.rctx,rCe.shader.get().build(),Si)}initializePipeline(){return Lt({colorWrite:Gt})}};iCe.shader=new Pi(Qrt,()=>ce(()=>import("./SSAOBlur.glsl-13d03e99.js"),[],import.meta.url));const ent="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";let tnt=class extends or{constructor(){super(...arguments),this.projScale=1}},int=class extends tnt{constructor(){super(...arguments),this.intensity=1}},rnt=class extends or{},nnt=class extends rnt{constructor(){super(...arguments),this.blurSize=Ge()}};function ZU(t){t.fragment.uniforms.add(new yi("projInfo",(e,i)=>snt(i))),t.fragment.uniforms.add(new Ki("zScale",(e,i)=>ont(i))),t.fragment.code.add(b`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function snt(t){const e=t.camera.projectionMatrix;return e[11]===0?Gr(Zae,2/(t.camera.fullWidth*e[0]),2/(t.camera.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):Gr(Zae,-2/(t.camera.fullWidth*e[0]),-2/(t.camera.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}const Zae=oi();function ont(t){return t.camera.projectionMatrix[11]===0?mi(Jae,0,1):mi(Jae,1,0)}const Jae=Ge(),Kae=16;function ant(){const t=new Ei,e=t.fragment;return t.include(Na),e.include(od),t.include(ZU),e.uniforms.add(new Re("radius",(i,r)=>OQ(r.camera))),e.code.add(b`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),e.code.add(b`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),e.uniforms.add(new Ki("nearFar",(i,r)=>r.camera.nearFar),new et("normalMap",i=>i.normalTexture),new et("depthMap",i=>i.depthTexture),new Re("projScale",i=>i.projScale),new et("rnm",i=>i.noiseTexture),new Ki("rnmScale",(i,r)=>mi(Qae,r.camera.fullWidth/i.noiseTexture.descriptor.width,r.camera.fullHeight/i.noiseTexture.descriptor.height)),new Re("intensity",i=>i.intensity),new Ki("screenSize",(i,r)=>mi(Qae,r.camera.fullWidth,r.camera.fullHeight))),t.outputs.add("fragOcclusion","float"),e.code.add(b`
    void main(void) {
      fillSphere();
      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
        fragOcclusion = 0.0;
        return;
      }

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy, currentPixelDepth);

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
      bool isTerrain = norm4.w < 0.5;

      float sum = 0.0;
      vec3 tapPixelPos;

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${b.int(Kae)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        //don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        if (isTerrain) {
          if (texture(normalMap, tcTap).w < 0.5) {
            continue;
          }
        }

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum += aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${b.int(Kae)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;

      fragOcclusion = A;
    }
  `),t}function OQ(t){return Math.max(10,20*t.computeScreenPixelSizeAtDist(Math.abs(4*t.relativeElevation)))}const Qae=Ge(),lnt=Object.freeze(Object.defineProperty({__proto__:null,build:ant,getRadius:OQ},Symbol.toStringTag,{value:"Module"}));let nCe=class sCe extends Fi{initializeProgram(e){return new Mi(e.rctx,sCe.shader.get().build(),Si)}initializePipeline(){return Lt({colorWrite:Gt})}};nCe.shader=new Pi(lnt,()=>ce(()=>import("./SSAO.glsl-7b877bc3.js"),[],import.meta.url));const iO=2;let rO=class extends Qx{constructor(e){super(e),this._context=null,this._passParameters=new int,this._drawParameters=new nnt,this.produces=new Map([[le.SSAO,()=>this._produces()]])}_produces(){return this._enableTime!=null&&this._context!=null}consumes(){return this._produces()?NJe:PU}initializeRenderContext(e){this._context=e,this.addHandles([ne(()=>this.view.qualitySettings.ambientOcclusion||this._context?.isFeatureEnabled(hs.SSAO),i=>i?this._enable():this._disable(),Ji)])}uninitializeRenderContext(){this._disable(),this._context=null}_disable(){this._passParameters.noiseTexture=rt(this._passParameters.noiseTexture),this._enableTime=null}destroy(){this._disable()}_enable(){if(this._enableTime!=null||!this._context)return;const e=Uint8Array.from(atob(ent),r=>r.charCodeAt(0)),i=new Hi;i.wrapMode=Vt.CLAMP_TO_EDGE,i.pixelFormat=gt.RGB,i.wrapMode=Vt.REPEAT,i.hasMipmap=!0,i.width=32,i.height=32,this._passParameters.noiseTexture=new Nt(this._context.renderContext.rctx,i,e),this._ssaoTechnique==null&&(this._ssaoTechnique=this._context.techniqueRepository.acquire(nCe)),this._blurTechnique==null&&(this._blurTechnique=this._context.techniqueRepository.acquire(iCe)),this._enableTime=0,this._context?.requestRender()}renderNode(e,i,r){const n=e.bindParameters,s=n.linearDepth?.colorTexture,o=r?.normal?.colorTexture;if(this._enableTime==null||this._context==null||s==null||!o)return;if(!this._ssaoTechnique.compiled||!this._blurTechnique.compiled)return this._enableTime=e.time,void this._context.requestRender();this._enableTime===0&&(this._enableTime=e.time);const a=e.rctx,l=n.camera,c=this.view.qualitySettings.fadeDuration,h=c>0?Math.min(c,e.time-this._enableTime)/c:1;this._passParameters.normalTexture=o,this._passParameters.depthTexture=s,this._passParameters.projScale=1/l.computeScreenPixelSizeAtDist(1),this._passParameters.intensity=4*cnt/OQ(l)**6*h;const d=l.fullViewport[2],f=l.fullViewport[3],m=Math.round(d/iO),y=Math.round(f/iO),_=this._context.fbos,v=_.acquire(xi.RED,d,f);a.bindFramebuffer(v.fbo),a.setViewport(0,0,d,f),a.bindTechnique(this._ssaoTechnique,this._passParameters,n).bindDraw(this._drawParameters,n,this._passParameters),a.screen.draw();const w=a.bindTechnique(this._blurTechnique,this._passParameters,n);a.setViewport(0,0,m,y);const x=_.acquire(xi.RED,m,y);a.bindFramebuffer(x.fbo),this._drawParameters.colorTexture=v.colorTexture,mi(this._drawParameters.blurSize,0,iO/f),w.bindDraw(this._drawParameters,n,this._passParameters),a.setViewport(0,0,m,y),a.screen.draw(),v.release();const T=_.acquire(xi.RED,m,y);return a.bindFramebuffer(T.fbo),a.setViewport(0,0,d,f),a.setClearColor(1,1,1,0),a.clear(wr.COLOR_BUFFER_BIT),a.setViewport(0,0,m,y),this._drawParameters.colorTexture=x.colorTexture,mi(this._drawParameters.blurSize,iO/d,0),w.bindDraw(this._drawParameters,n,this._passParameters),a.screen.draw(),a.setViewport4fv(l.fullViewport),x.release(),h<1&&this._context.requestRender(),T}};u([p({constructOnly:!0})],rO.prototype,"view",void 0),u([p()],rO.prototype,"_context",void 0),rO=u([M("esri.views.3d.webgl-engine.effects.ssao.SSAO")],rO);const cnt=.5;function KM(t,e){const i=t.fragment;e.receiveAmbientOcclusion?(i.uniforms.add(new et("ssaoTex",(r,n)=>n.ssao?.colorTexture)),i.constants.add("blurSizePixelsInverse","float",1/iO),i.code.add(b`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).r;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):i.code.add(b`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function unt(t){const e=t.fragment.code;e.add(b`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),e.add(b`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),e.add(b`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function RQ(t,e){const i=t.fragment.code;t.include(FM),e.pbrMode!==ot.Normal&&e.pbrMode!==ot.Schematic&&e.pbrMode!==ot.Terrain&&e.pbrMode!==ot.TerrainWithWater||(i.add(b`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),i.add(b`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),e.pbrMode!==ot.Normal&&e.pbrMode!==ot.Schematic||(t.include(unt),i.add(b`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),i.add(b`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),i.add(b`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),i.add(b`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function hnt(t,e){const i=t.fragment.code;t.include(FM),i.add(b`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),i.add(b`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),i.add(b`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),i.add(b`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),i.add(b`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}function QM(t){t.constants.add("ambientBoostFactor","float",VTe)}function GC(t){t.uniforms.add(new Re("lightingGlobalFactor",(e,i)=>i.lighting.globalFactor))}function Ax(t,e){const i=t.fragment;switch(t.include(KM,e),e.pbrMode!==ot.Disabled&&t.include(RQ,e),t.include(SK,e),t.include(FM),i.code.add(b`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${e.pbrMode===ot.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),QM(i),GC(i),jy(i),i.code.add(b`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${e.spherical?b`normalize(vPosWorld)`:b`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),Gm(i),i.code.add(b`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),e.pbrMode){case ot.Disabled:case ot.WaterOnIntegratedMesh:case ot.Water:t.include(_F),i.code.add(b`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case ot.Normal:case ot.Schematic:i.code.add(b`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),i.code.add(b`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),e.useFillLights?i.uniforms.add(new gm("hasFillLights",(r,n)=>n.enableFillLights)):i.constants.add("hasFillLights","bool",!1),i.code.add(b`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0) ? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),i.uniforms.add(new Re("lightingSpecularStrength",(r,n)=>n.lighting.mainLight.specularStrength),new Re("lightingEnvironmentStrength",(r,n)=>n.lighting.mainLight.environmentStrength)),i.code.add(b`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
float normalDirectionModifier = mix(1., min(mix(0.1, 2.0, (inputs.NdotNG + 1.) * 0.5), 1.0), clamp(inputs.roughness * 5.0, 0.0 , 1.0));
inputs.skyRadianceToSurface = (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.groundRadianceToSurface = 0.5 * GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),i.code.add(b`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = _emission == vec3(0.0) ? _emission : pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${e.pbrMode!==ot.Schematic||e.hasColorTexture?b`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`:b`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case ot.Terrain:case ot.TerrainWithWater:t.include(_F),i.code.add(b`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluateTerrainLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:e.pbrMode;case ot.COUNT:}}let dnt=class extends dn{constructor(e,i,r){super(e,"mat4",Oi.Draw,(n,s,o,a)=>n.setUniformMatrix4fv(e,i(s,o,a)),r)}},pnt=class extends dn{constructor(e,i,r){super(e,"mat4",Oi.Pass,(n,s,o)=>n.setUniformMatrix4fv(e,i(s,o)),r)}},fnt=class extends or{constructor(){super(...arguments),this.origin=E()}},mnt=class extends fnt{},gnt=class extends or{constructor(){super(...arguments),this.modelTransformation=Kr}},PQ=class extends gnt{constructor(){super(...arguments),this.origin=E()}};function JU(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new pnt("shadowMapMatrix",(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),oCe(t))}function Ox(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new dnt("shadowMapMatrix",(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),oCe(t))}function oCe(t){const e=t.fragment;e.include(JEe),e.uniforms.add(new et("shadowMapTex",(i,r)=>r.shadowMap.depthTexture),new JM("numCascades",(i,r)=>r.shadowMap.numCascades),new yi("cascadeDistances",(i,r)=>r.shadowMap.cascadeDistances)),e.code.add(b`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, ivec2 textureSize, vec3 lvpos) {
float xScale = float(textureSize.y) / float(textureSize.x);
return vec2((float(i) + lvpos.x) * xScale, lvpos.y);
}
float readShadowMapDepth(ivec2 uv, sampler2D _depthTex) {
return rgba4ToFloat(texelFetch(_depthTex, uv, 0));
}
float posIsInShadow(ivec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, ivec2 texSize, sampler2D _depthTex) {
vec2 st = fract(uv * vec2(texSize) + vec2(0.5));
ivec2 base = ivec2(uv * vec2(texSize) - vec2(0.5));
float s00 = posIsInShadow(ivec2(base.x, base.y), lvpos, _depthTex);
float s10 = posIsInShadow(ivec2(base.x + 1, base.y), lvpos, _depthTex);
float s11 = posIsInShadow(ivec2(base.x + 1, base.y + 1), lvpos, _depthTex);
float s01 = posIsInShadow(ivec2(base.x, base.y + 1), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
ivec2 size = textureSize(shadowMapTex, 0);
vec2 uv = cascadeCoordinates(i, size, lvpos);
return filterShadow(uv, lvpos, size, shadowMapTex);
}`)}function Ma(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function aCe(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function d4(t,e,i,r,n,s,o,a,l){const c=new Float32Array(9);return c[0]=t,c[1]=e,c[2]=i,c[3]=r,c[4]=n,c[5]=s,c[6]=o,c[7]=a,c[8]=l,c}function ynt(t,e){return new Float32Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:aCe,create:Ma,createView:ynt,fromValues:d4},Symbol.toStringTag,{value:"Module"}));function _nt(t){t.vertex.uniforms.add(new qp("colorTextureTransformMatrix",e=>e.colorTextureTransformMatrix!=null?e.colorTextureTransformMatrix:Ma())),t.varyings.add("colorUV","vec2"),t.vertex.code.add(b`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function vnt(t){t.vertex.uniforms.add(new qp("normalTextureTransformMatrix",e=>e.normalTextureTransformMatrix!=null?e.normalTextureTransformMatrix:Ma())),t.varyings.add("normalUV","vec2"),t.vertex.code.add(b`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function bnt(t){t.vertex.uniforms.add(new qp("emissiveTextureTransformMatrix",e=>e.emissiveTextureTransformMatrix!=null?e.emissiveTextureTransformMatrix:Ma())),t.varyings.add("emissiveUV","vec2"),t.vertex.code.add(b`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function wnt(t){t.vertex.uniforms.add(new qp("occlusionTextureTransformMatrix",e=>e.occlusionTextureTransformMatrix!=null?e.occlusionTextureTransformMatrix:Ma())),t.varyings.add("occlusionUV","vec2"),t.vertex.code.add(b`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function xnt(t){t.vertex.uniforms.add(new qp("metallicRoughnessTextureTransformMatrix",e=>e.metallicRoughnessTextureTransformMatrix!=null?e.metallicRoughnessTextureTransformMatrix:Ma())),t.varyings.add("metallicRoughnessUV","vec2"),t.vertex.code.add(b`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function $P(t){t.include(Wm),t.code.add(b`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${b.int(Is.Multiply)}) {
        return allMixed;
      }
      if (mode == ${b.int(Is.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${b.int(Is.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${b.int(Is.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${b.int(Is.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function Tnt(t){const e=new Ei,{vertex:i,fragment:r,varyings:n}=e;if(zc(i,t),e.include(kM),n.add("vpos","vec3"),e.include(dy,t),e.include(YTe,t),e.include(k2e,t),t.hasColorTextureTransform&&e.include(_nt),t.output===F.Color||t.output===F.Alpha){t.hasNormalTextureTransform&&e.include(vnt),t.hasEmissionTextureTransform&&e.include(bnt),t.hasOcclusionTextureTransform&&e.include(wnt),t.hasMetallicRoughnessTextureTransform&&e.include(xnt),Np(i,t),e.include(ZM,t),e.include(Xl,t);const s=t.normalType===Ni.Attribute||t.normalType===Ni.Compressed;s&&t.offsetBackfaces&&e.include(WEe),e.include(eCe,t),e.include(YU,t),t.instancedColor&&e.attributes.add(O.INSTANCECOLOR,"vec4"),n.add("vPositionLocal","vec3"),e.include(mm,t),e.include(kC,t),e.include(ZEe,t),e.include(tT,t),i.uniforms.add(new yi("externalColor",o=>o.externalColor)),n.add("vcolorExt","vec4"),t.multipassEnabled&&n.add("depth","float"),i.code.add(b`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${b.float(zo)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = getVertexInLocalOriginSpace();
          vPositionLocal = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${s?b`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${t.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${s&&t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        ${t.hasColorTextureTransform?b`forwardColorUV();`:""}
        ${t.hasNormalTextureTransform?b`forwardNormalUV();`:""}
        ${t.hasEmissionTextureTransform?b`forwardEmissiveUV();`:""}
        ${t.hasOcclusionTextureTransform?b`forwardOcclusionUV();`:""}
        ${t.hasMetallicRoughnessTextureTransform?b`forwardMetallicRoughnessUV();`:""}
      }
    `)}switch(t.output){case F.Alpha:e.include(Dn,t),e.include(Jw,t),e.include(Xc,t),r.uniforms.add(new Re("opacity",s=>s.opacity),new Re("layerOpacity",s=>s.layerOpacity)),t.hasColorTexture&&r.uniforms.add(new et("tex",s=>s.texture)),r.include($P),r.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        ${t.hasColorTexture?b`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:b`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?b`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:b`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        fragColor = vec4(opacity_);
      }
    `);break;case F.Color:e.include(Dn,t),e.include(Ax,t),e.include(KM,t),e.include(Jw,t),e.include(t.instancedDoublePrecision?JU:Ox,t),e.include(Xc,t),Np(r,t),r.uniforms.add(i.uniforms.get("localOrigin"),new kt("ambient",s=>s.ambient),new kt("diffuse",s=>s.diffuse),new Re("opacity",s=>s.opacity),new Re("layerOpacity",s=>s.layerOpacity)),t.hasColorTexture&&r.uniforms.add(new et("tex",s=>s.texture)),e.include(TK,t),e.include(RQ,t),r.include($P),e.include(zEe,t),QM(r),GC(r),Gm(r),r.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        ${t.hasColorTexture?b`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:b`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${t.normalType===Ni.ScreenDerivative?b`
                vec3 normal = screenDerivativeNormal(vPositionLocal);`:b`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${t.pbrMode===ot.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${t.receiveShadows?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?b`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:b`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.hasNormalTexture?b`
                mat3 tangentSpace = ${t.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, ${t.hasNormalTextureTransform?b`normalUV`:"vuv0"});`:b`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${t.spherical?b`normalize(posWorld);`:b`vec3(0.0, 0.0, 1.0);`}

        ${t.snowCover?b`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${t.pbrMode===ot.Normal||t.pbrMode===ot.Schematic?b`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?b`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:b`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===it.Color?b`fragColor = premultiplyAlpha(fragColor);`:""}
      }
    `)}return e.include(QEe,t),e}const Snt=Object.freeze(Object.defineProperty({__proto__:null,build:Tnt},Symbol.toStringTag,{value:"Module"}));let Ent=class extends BEe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=Ta(XU),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=xr.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveFactor=Oe(0,0,0),this.instancedDoublePrecision=!1,this.normalType=Ni.Attribute,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Oe(.2,.2,.2),this.diffuse=Oe(.8,.8,.8),this.externalColor=Ft(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=E(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.transparent=!1,this.writeDepth=!0,this.customDepthTest=xx.Less,this.textureAlphaMode=nr.Blend,this.textureAlphaCutoff=BF,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=Vr.Occlude,this.isDecoration=!1}},Cnt=class extends VEe{constructor(){super(...arguments),this.origin=E(),this.slicePlaneLocalOrigin=this.origin}},MQ=class lCe extends Fi{initializeConfiguration(e,i){i.spherical=e.viewingMode===Le.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result,i.textureCoordinateType=i.hasColorTexture||i.hasMetallicRoughnessTexture||i.hasEmissionTexture||i.hasOcclusionTexture||i.hasNormalTexture?Zn.Default:Zn.None,i.objectAndLayerIdColorInstanced=i.instanced}initializeProgram(e){return this._initializeProgram(e,lCe.shader)}_initializeProgram(e,i){return new Mi(e.rctx,i.get().build(this.configuration),Si)}_convertDepthTestFunction(e){return e===xx.Lequal?Bi.LEQUAL:Bi.LESS}_makePipeline(e,i){const r=this.configuration,n=e===it.NONE,s=e===it.FrontFace;return Lt({blending:r.output!==F.Color&&r.output!==F.Alpha||!r.transparent?null:n?Xu:Zy(e),culling:Ant(r)?_U(r.cullFace):null,depthTest:{func:o1(e,this._convertDepthTestFunction(r.customDepthTest))},depthWrite:(n||s)&&r.writeDepth?ec:null,colorWrite:Gt,stencilWrite:r.hasOccludees?$m:null,stencilTest:r.hasOccludees?i?Gv:a1:null,polygonOffset:n||s?null:jU(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};function Ant(t){return t.cullFace!==xr.None||!t.hasSlicePlane&&!t.transparent&&!t.doubleSidedMode}MQ.shader=new Pi(Snt,()=>ce(()=>import("./DefaultMaterial.glsl-6762f3ca.js"),[],import.meta.url));let Bt=class extends fl{constructor(){super(...arguments),this.output=F.Color,this.alphaDiscardMode=nr.Opaque,this.doubleSidedMode=hn.None,this.pbrMode=ot.Disabled,this.cullFace=xr.None,this.transparencyPassType=it.NONE,this.normalType=Ni.Attribute,this.textureCoordinateType=Zn.None,this.customDepthTest=xx.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}};u([U({count:F.COUNT})],Bt.prototype,"output",void 0),u([U({count:nr.COUNT})],Bt.prototype,"alphaDiscardMode",void 0),u([U({count:hn.COUNT})],Bt.prototype,"doubleSidedMode",void 0),u([U({count:ot.COUNT})],Bt.prototype,"pbrMode",void 0),u([U({count:xr.COUNT})],Bt.prototype,"cullFace",void 0),u([U({count:it.COUNT})],Bt.prototype,"transparencyPassType",void 0),u([U({count:Ni.COUNT})],Bt.prototype,"normalType",void 0),u([U({count:Zn.COUNT})],Bt.prototype,"textureCoordinateType",void 0),u([U({count:xx.COUNT})],Bt.prototype,"customDepthTest",void 0),u([U()],Bt.prototype,"spherical",void 0),u([U()],Bt.prototype,"hasVertexColors",void 0),u([U()],Bt.prototype,"hasSymbolColors",void 0),u([U()],Bt.prototype,"hasVerticalOffset",void 0),u([U()],Bt.prototype,"hasSlicePlane",void 0),u([U()],Bt.prototype,"hasSliceHighlight",void 0),u([U()],Bt.prototype,"hasColorTexture",void 0),u([U()],Bt.prototype,"hasMetallicRoughnessTexture",void 0),u([U()],Bt.prototype,"hasEmissionTexture",void 0),u([U()],Bt.prototype,"hasOcclusionTexture",void 0),u([U()],Bt.prototype,"hasNormalTexture",void 0),u([U()],Bt.prototype,"hasScreenSizePerspective",void 0),u([U()],Bt.prototype,"hasVertexTangents",void 0),u([U()],Bt.prototype,"hasOccludees",void 0),u([U()],Bt.prototype,"multipassEnabled",void 0),u([U()],Bt.prototype,"hasModelTransformation",void 0),u([U()],Bt.prototype,"offsetBackfaces",void 0),u([U()],Bt.prototype,"vvSize",void 0),u([U()],Bt.prototype,"vvColor",void 0),u([U()],Bt.prototype,"receiveShadows",void 0),u([U()],Bt.prototype,"receiveAmbientOcclusion",void 0),u([U()],Bt.prototype,"textureAlphaPremultiplied",void 0),u([U()],Bt.prototype,"instanced",void 0),u([U()],Bt.prototype,"instancedColor",void 0),u([U()],Bt.prototype,"objectAndLayerIdColorInstanced",void 0),u([U()],Bt.prototype,"instancedDoublePrecision",void 0),u([U()],Bt.prototype,"doublePrecisionRequiresObfuscation",void 0),u([U()],Bt.prototype,"writeDepth",void 0),u([U()],Bt.prototype,"transparent",void 0),u([U()],Bt.prototype,"enableOffset",void 0),u([U()],Bt.prototype,"cullAboveGround",void 0),u([U()],Bt.prototype,"snowCover",void 0),u([U()],Bt.prototype,"hasColorTextureTransform",void 0),u([U()],Bt.prototype,"hasEmissionTextureTransform",void 0),u([U()],Bt.prototype,"hasNormalTextureTransform",void 0),u([U()],Bt.prototype,"hasOcclusionTextureTransform",void 0),u([U()],Bt.prototype,"hasMetallicRoughnessTextureTransform",void 0),u([U({constValue:!1})],Bt.prototype,"occlusionPass",void 0),u([U({constValue:!0})],Bt.prototype,"hasVvInstancing",void 0),u([U({constValue:!1})],Bt.prototype,"useCustomDTRExponentForWater",void 0),u([U({constValue:!1})],Bt.prototype,"supportsTextureAtlas",void 0),u([U({constValue:!0})],Bt.prototype,"useFillLights",void 0);function Ont(t){const e=new Ei,{vertex:i,fragment:r,varyings:n}=e;return zc(i,t),e.include(kM),n.add("vpos","vec3"),e.include(dy,t),e.include(YTe,t),e.include(k2e,t),t.output!==F.Color&&t.output!==F.Alpha||(Np(e.vertex,t),e.include(ZM,t),e.include(Xl,t),t.offsetBackfaces&&e.include(WEe),t.instancedColor&&e.attributes.add(O.INSTANCECOLOR,"vec4"),n.add("vNormalWorld","vec3"),n.add("localvpos","vec3"),t.multipassEnabled&&n.add("depth","float"),e.include(mm,t),e.include(kC,t),e.include(ZEe,t),e.include(tT,t),i.uniforms.add(new yi("externalColor",s=>s.externalColor)),n.add("vcolorExt","vec4"),i.code.add(b`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${b.float(zo)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = getVertexInLocalOriginSpace();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${t.multipassEnabled?b`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),t.output===F.Alpha&&(e.include(Dn,t),e.include(Jw,t),e.include(Xc,t),r.uniforms.add(new Re("opacity",s=>s.opacity),new Re("layerOpacity",s=>s.layerOpacity)),t.hasColorTexture&&r.uniforms.add(new et("tex",s=>s.texture)),r.include($P),r.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?b`terrainDepthTest(depth);`:""}
        ${t.hasColorTexture?b`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:b`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?b`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:b`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        fragColor = vec4(opacity_);
      }
    `)),t.output===F.Color&&(e.include(Dn,t),e.include(Ax,t),e.include(KM,t),e.include(Jw,t),e.include(t.instancedDoublePrecision?JU:Ox,t),e.include(Xc,t),Np(e.fragment,t),jy(r),QM(r),GC(r),r.uniforms.add(i.uniforms.get("localOrigin"),i.uniforms.get("view"),new kt("ambient",s=>s.ambient),new kt("diffuse",s=>s.diffuse),new Re("opacity",s=>s.opacity),new Re("layerOpacity",s=>s.layerOpacity)),t.hasColorTexture&&r.uniforms.add(new et("tex",s=>s.texture)),e.include(TK,t),e.include(RQ,t),r.include($P),Gm(r),r.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?b`terrainDepthTest(depth);`:""}
        ${t.hasColorTexture?b`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:b`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${t.pbrMode===ot.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?b`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:b`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.snowCover?b`albedo = mix(albedo, vec3(1), 0.9);`:b``}
        ${b`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${t.pbrMode===ot.Normal||t.pbrMode===ot.Schematic?t.spherical?b`vec3 normalGround = normalize(vpos + localOrigin);`:b`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:b``}
        ${t.pbrMode===ot.Normal||t.pbrMode===ot.Schematic?b`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?b`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:b`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===it.Color?b`fragColor = premultiplyAlpha(fragColor);`:b``}
      }
    `)),e.include(QEe,t),e}const Rnt=Object.freeze(Object.defineProperty({__proto__:null,build:Ont},Symbol.toStringTag,{value:"Module"}));let cCe=class uCe extends MQ{initializeConfiguration(e,i){super.initializeConfiguration(e,i),i.hasMetallicRoughnessTexture=!1,i.hasEmissionTexture=!1,i.hasOcclusionTexture=!1,i.hasNormalTexture=!1,i.hasModelTransformation=!1,i.normalType=Ni.Attribute,i.doubleSidedMode=hn.WindingOrder,i.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,uCe.shader)}};cCe.shader=new Pi(Rnt,()=>ce(()=>import("./RealisticTree.glsl-c411e6de.js"),[],import.meta.url));let kp=class extends n1{constructor(e){super(e,$nt),this.supportsEdges=!0,this._configuration=new Bt,this._vertexBufferLayout=Int(this.parameters)}isVisibleForOutput(e){return e!==F.Shadow&&e!==F.ShadowExcludeHighlight&&e!==F.ShadowHighlight||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||e.layerOpacity===0)return!1;const{hasInstancedColor:i,hasVertexColors:r,hasSymbolColors:n,vvColor:s}=e,o=e.colorMixMode==="replace",a=e.opacity>0,l=e.externalColor&&e.externalColor[3]>0,c=i||s||n;return r&&c?o||a:r?o?l:a:c?o||a:o?l:a}getConfiguration(e,i){return this._configuration.output=e,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=this.parameters.isInstanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this.parameters.customDepthTest!=null&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?xr.None:this.parameters.cullFace,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=this.parameters.modelTransformation!=null,e!==F.Color&&e!==F.Alpha||(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=hn.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?hn.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?hn.WindingOrder:hn.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=i.ssao!=null,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?ot.Schematic:ot.Normal:ot.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<VU,this._configuration.snowCover=this.hasSnowCover(i),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}intersect(e,i,r,n,s,o){if(this.parameters.verticalOffset!=null){const a=r.camera;ae(D9,i[12],i[13],i[14]);let l=null;switch(r.viewingMode){case Le.Global:l=ye(ele,D9);break;case Le.Local:l=oe(ele,Nnt)}let c=0;const h=de(Fnt,D9,a.eye),d=xe(h),f=re(h,h,1/d);let m=null;this.parameters.screenSizePerspective&&(m=ge(l,f)),c+=q2e(a,d,this.parameters.verticalOffset,m??0,this.parameters.screenSizePerspective),re(l,l,c),Nc(L9,l,r.transform.inverseRotation),n=de(Lnt,n,L9),s=de(Dnt,s,L9)}V2e(e,r,n,s,dH(r.verticalOffset),o)}produces(e,i){return i===F.Color||i===F.Alpha||i===F.Depth||i===F.Normal||i===F.Shadow||i===F.ShadowHighlight||i===F.ShadowExcludeHighlight||i===F.Highlight||i===F.ObjectAndLayerIdColor?e===(this.parameters.transparent?this.parameters.writeDepth?le.TRANSPARENT_MATERIAL:le.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:le.OPAQUE_MATERIAL)||e===le.DRAPED_MATERIAL:!1}createGLMaterial(e){return new Pnt(e)}createBufferWriter(){return new VC(this._vertexBufferLayout)}},Pnt=class extends xK{constructor(e){super({...e,...e.material.parameters})}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==F.Color&&this._output!==F.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e));const i=this._material.parameters;this.updateTexture(i.textureId);const r=e.camera.viewInverseTransposeMatrix;return ae(i.origin,r[3],r[7],r[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(i.treeRendering?cCe:MQ,e)}},Mnt=class extends Ent{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}};const $nt=new Mnt;function Int(t){const e=Hr().vec3f(O.POSITION);return t.normalType===Ni.Compressed?e.vec2i16(O.NORMALCOMPRESSED,{glNormalized:!0}):e.vec3f(O.NORMAL),t.hasVertexTangents&&e.vec4f(O.TANGENT),(t.textureId||t.normalTextureId||t.metallicRoughnessTextureId||t.emissiveTextureId||t.occlusionTextureId)&&e.vec2f(O.UV0),t.hasVertexColors&&e.vec4u8(O.COLOR),t.hasSymbolColors&&e.vec4u8(O.SYMBOLCOLOR),ie("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(O.OBJECTANDLAYERIDCOLOR),e}const Lnt=E(),Dnt=E(),Nnt=Oe(0,0,1),ele=E(),L9=E(),D9=E(),Fnt=E(),hCe=new EQ({});function zFt(t){return t.type==="web-style"?hCe:$Q(t.symbolLayers.toArray().map(e=>dCe(t,e)))}function $Q(t){let e=0,i=0,r=0,n=!1,s=0;const o=new kEe;for(const a of t)a!=null&&(e+=a.verticesPerFeature,i+=a.verticesPerCoordinate,r+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,n=n||a.estimated,++s);return n?new Lrt(s,{verticesPerFeature:e,verticesPerCoordinate:i,drawCallsPerFeature:r,memory:o}):new Irt(s,{verticesPerFeature:e,verticesPerCoordinate:i,drawCallsPerFeature:r,memory:o})}function BFt(t){const e=$Q(t);return e.numComplexities>0&&(e.verticesPerFeature/=e.numComplexities,e.verticesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities),e}const N9={};function dCe(t,e){const i=pCe(t,e),r=Frt(e)?2:0;switch(e.type){case"extrude":return new Dh({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:r,memory:i});case"fill":if(t.type==="mesh-3d")return new Dh({drawCallsPerFeature:r,memory:i});if(e.outline!=null&&e.outline.size>0)return new Dh({verticesPerFeature:-12,verticesPerCoordinate:9,memory:i});case"water":return new Dh({verticesPerFeature:-6,verticesPerCoordinate:3,memory:i});case"line":return new Dh({verticesPerFeature:-6,verticesPerCoordinate:6,memory:i});case"object":return e.resource?.href?new EQ({verticesPerFeature:100,memory:i}):{...knt(e.resource?.primitive??P1e),memory:i};case"path":{let n=0,s=0;switch(e.profile){case"circle":n=IEe;break;case"quad":n=4;break;default:return void(e.profile,void 0)}switch(e.join??"simple"){case"round":s=$Ee;break;case"miter":case"bevel":s=1;break;default:return}const o=2*n,a=n*s*2,l=a+o;let c=-2*a-o;switch(e.cap){case"none":break;case"butt":case"square":c+=2*(n-1);break;case"round":c+=2*(n*(Qq-1)*2+n);break;default:return}return new Dh({verticesPerFeature:c,verticesPerCoordinate:l,memory:i})}case"text":case"icon":return new Dh({verticesPerFeature:6,memory:i});default:return}}function pCe(t,e){const i=t.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?wl.EXTRUDE_EDGES:wl.EXTRUDE;case"fill":return e.outline!=null&&e.outline.size>0?wl.FILL_OUTLINE:wl.FILL;case"water":return wl.FILL;case"line":return e.join==="round"?wl.LINE_ROUND:wl.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return wl.PATH_ROUND_CIRCLE;case"quad":return wl.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return wl.PATH_MITER_CIRCLE;case"quad":return wl.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return i?wl.OBJECT_POINT:wl.OBJECT_POLYGON;case"icon":case"text":return i?wl.ICON_POINT:wl.ICON_POLYGON;default:return}}function knt(t){const e=N9[t];if(e)return e;const i=fCe(FEe(t,new kp({})).levels);return N9[t]=new Dh({verticesPerFeature:i}),N9[t]}function fCe(t){return t.reduce((e,i,r)=>e+i.numVertices*(1/10**r),0)/t.reduce((e,i,r)=>e+1/10**r,0)}const wl={ICON_POINT:{bytesPerFeature:2111.586639736967,bytesPerFeatureLabel:870.520855,resourceBytes:0,draped:{bytesPerFeature:1799.2619971817762,bytesPerFeatureLabel:857.4890149999999}},ICON_POLYGON:{bytesPerFeature:2829.8183316810564,bytesPerFeatureLabel:858.0951816666667,resourceBytes:0,draped:{bytesPerFeature:2521.242008227286,bytesPerFeatureLabel:869.6919750000001}},OBJECT_POINT:{bytesPerFeature:607.8007336777831,bytesPerFeatureLabel:715.7017950000001,resourceBytes:0,draped:{bytesPerFeature:607.8007336777831,bytesPerFeatureLabel:715.7017950000001}},OBJECT_POLYGON:{bytesPerFeature:1111.4123028075749,bytesPerFeatureLabel:684.5498416666667,resourceBytes:0,draped:{bytesPerFeature:1111.4123028075749,bytesPerFeatureLabel:684.5498416666667}},LINE_MITER:{bytesPerFeature:3053.034748007272,bytesPerFeatureLabel:804.5473016666666,resourceBytes:0,draped:{bytesPerFeature:2649.5661560225844,bytesPerFeatureLabel:843.3404083333334}},LINE_ROUND:{bytesPerFeature:3225.35183564197,bytesPerFeatureLabel:807.296835,resourceBytes:0,draped:{bytesPerFeature:2650.9229994933276,bytesPerFeatureLabel:861.108335}},PATH_MITER_CIRCLE:{bytesPerFeature:38664.832646351235,bytesPerFeatureLabel:862.95665,resourceBytes:0,draped:{bytesPerFeature:38664.832646351235,bytesPerFeatureLabel:862.95665}},PATH_ROUND_CIRCLE:{bytesPerFeature:42462.97022293504,bytesPerFeatureLabel:851.35885,resourceBytes:0,draped:{bytesPerFeature:42462.97022293504,bytesPerFeatureLabel:851.35885}},PATH_MITER_QUAD:{bytesPerFeature:25558.22153327986,bytesPerFeatureLabel:838.56885,resourceBytes:0,draped:{bytesPerFeature:25558.22153327986,bytesPerFeatureLabel:838.56885}},PATH_ROUND_QUAD:{bytesPerFeature:42274.86801764233,bytesPerFeatureLabel:867.5658500000001,resourceBytes:0,draped:{bytesPerFeature:42274.86801764233,bytesPerFeatureLabel:867.5658500000001}},FILL:{bytesPerFeature:3124.272297197038,bytesPerFeatureLabel:850.6966816666666,resourceBytes:0,draped:{bytesPerFeature:2630.99580851019,bytesPerFeatureLabel:845.464495}},FILL_OUTLINE:{bytesPerFeature:4501.643043274039,bytesPerFeatureLabel:866.3982816666668,resourceBytes:0,draped:{bytesPerFeature:3841.8870233416183,bytesPerFeatureLabel:854.9969683333334}},EXTRUDE:{bytesPerFeature:7545.975968446941,bytesPerFeatureLabel:859.7106016666668,resourceBytes:0,draped:{bytesPerFeature:7545.975968446941,bytesPerFeatureLabel:859.7106016666668}},EXTRUDE_EDGES:{bytesPerFeature:2872.306473115409,bytesPerFeatureLabel:604.556581666667,resourceBytes:0,draped:{bytesPerFeature:2872.306473115409,bytesPerFeatureLabel:604.556581666667}}};var Kn;(function(t){t[t.RecreateSymbol=0]="RecreateSymbol",t[t.RecreateGraphics=1]="RecreateGraphics",t[t.FastUpdate=2]="FastUpdate"})(Kn||(Kn={}));let IQ=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=Ru.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,i){return this._loadStatus===Ru.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===Ru.FAILED?(i&&i(this._loadError),this._loader??Promise.resolve()):(this._loader==null&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=Ru.LOADED},r=>{throw this._loadError=r,this._abortController=null,this._loadStatus=Ru.FAILED,!Tn(r)&&this.logger&&r.message&&this.logger.warn(r.message),r})),this._loader.then(e,i).catch(()=>{}),this._loader)}abortLoad(){this._abortController!=null?this._abortController=Gc(this._abortController):this._loadStatus===Ru.LOADING&&(this._loadStatus=Ru.FAILED),this._loader=null}};var Ru;(function(t){t[t.LOADING=0]="LOADING",t[t.LOADED=1]="LOADED",t[t.FAILED=2]="FAILED"})(Ru||(Ru={}));const UT=K.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let Xm=class extends IQ{constructor(e,i,r,n){super(r.schedule),this.symbol=e,this.symbolLayer=i,this._context=r,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this._materials=[],this.usedMemory=0,this.logger=UT,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=n.renderPriority,this._renderPriorityStep=n.renderPriorityStep,this._elevationContext=new jF,this.complexity=this.computeComplexity(),this.ignoreDrivers=n.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=tle(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const i=this._drivenProperties,r=tle(e);return r.color!==i.color||r.opacity!==i.opacity||r.opacityAlwaysOpaque!==i.opacityAlwaysOpaque||r.size!==i.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,i,r,n){const s=e.projectionSuccess,o="polygons"in e?e.polygons:null,a=`${n} geometry failed to be created`;let l=null;s?!this._logGeometryValidationWarnings(i,r,n)&&o&&o.length===0&&r==="rings"&&i.length>0&&i[0].length>2&&(l=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${a} (failed to project geometry to view spatial reference)`,l&&UT.warnOncePerTick(l)}_logGeometryValidationWarnings(e,i,r){const n=`${r} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(UT.warnOncePerTick(`${n} (no ${i} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(UT.warnOncePerTick(`${n} (${i} should be defined as a 2D array)`),!0)}_validateGeometry(e,i=null,r=null){if(i!=null&&!i.includes(e.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${e.type}`),!1;if(e.type==="point"){const n=e;if(!isFinite(n.x)||!isFinite(n.y))return UT.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return Unt}_defaultElevationInfoZ(){return znt}_updateElevationContext(){this._elevationInfoOverride!=null?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,i=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||i.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,i=new jF){const r=e.geometry,n=this.getDefaultElevationInfo(r);i.unit=this._elevationContext.unit!=null?this._elevationContext.unit:n.unit,i.mode=this.getGeometryElevationMode(r,n),i.offsetMeters=this._elevationContext.meterUnitOffset??n.offset??0;const s=!this._elevationOptions.supportsOnTheGround&&i.mode==="on-the-ground";s&&(i.mode="relative-to-ground",i.offsetMeters=0);const o=s?Ort:this._elevationContext.featureExpressionInfoContext;return i.updateFeatureExpressionInfoContext(o,e,this._context.layer),i}prepareSymbolLayerPatch(e){}updateGeometry(e,i){return!1}updateTransform(e,i,r,n){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,i=ile){let r=1;return this.draped||(r*=this._getLayerOpacity()),this._drivenProperties.opacity||(e!=null?r*=e.a:i.hasIntrinsicColor||(r=0)),r}_getCombinedOpacityAndColor(e,i=ile){const r=this._getCombinedOpacity(e,i);if(this._drivenProperties.color)return gR(null,r);const n=e!=null?Pe.toUnitRGB(e):ey;return gR(n,r)}_getVertexOpacityAndColor(e,i=null){const r=this._drivenProperties.color?e.color:null,n=this._drivenProperties.opacity?e.opacity:null,s=gR(r,n);return i&&(s[0]*=i,s[1]*=i,s[2]*=i,s[3]*=i),s}isFastUpdatesEnabled(){return this._fastUpdates!=null}computeComplexity(){return dCe(this.symbol,this.symbolLayer)}globalPropertyChanged(e,i,r){switch(e){case"opacity":return this.layerOpacityChanged(i,r),!0;case"elevationInfo":{const n=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(i,r,n)!==xn.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(i,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,i,r){let n=xn.UPDATE;return e.forEach(s=>{const o=i(s);if(o!=null){const a=s.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=r(o.elevationContext.mode)}else n=xn.RECREATE}),n}applyRendererDiff(e,i){return Kn.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const i=this._fastUpdates.visualVariables,r=i.size?Ap(i.size.field,e):0,n=i.color?Ap(i.color.field,e):0,s=i.opacity?Ap(i.opacity.field,e):0;return Ft(r,n,s,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&UT.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>({size:this._fastUpdates?.visualVariables.size?.field??null,color:this._fastUpdates?.visualVariables.color?.field??null,opacity:this._fastUpdates?.visualVariables.opacity?.field??null,rotation:this._fastUpdates?.visualVariables.rotation?.field??null});return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function tle(t){const e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return t&&"visualVariables"in t&&t.visualVariables&&t.visualVariables.forEach(i=>{switch(i.type){case"color":if(e.color=!0,i.stops)for(let r=0;r<i.stops.length;r++){const n=i.stops[r].color;n&&(e.opacity=!0,n.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0}}),e}const Unt={mode:"on-the-ground",offset:0,unit:"meters"},znt={mode:"absolute-height",offset:0,unit:"meters"},ile={hasIntrinsicColor:!1};let Jy=class extends BM{get geometries(){return this._geometries}get transformation(){return this._transformation??Kr}set transformation(e){this._transformation=Qn(this._transformation??be(),e),this._invalidateBoundingVolume(),this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(e){this._shaderTransformation=e?Qn(this._shaderTransformation??be(),e):null,this._invalidateBoundingVolume(),this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){return this.shaderTransformation??this.transformation}constructor(e={}){super(),this.type=wn.Object,this._shaderTransformation=null,this._parentLayer=null,this._visible=!0,this.castShadow=e.castShadow??!0,this.usesVerticalDistanceToGround=e.usesVerticalDistanceToGround??!1,this.graphicUid=e.graphicUid,this.layerUid=e.layerUid,e.isElevationSource&&(this.lastValidElevationBB=new mCe),this._geometries=e.geometries?Array.from(e.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){tt(this._parentLayer==null||e==null,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._emit("geometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const i=this._geometries.splice(e,1)[0];i&&(this._emit("geometryRemoved",{object:this,geometry:i}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttributeUpdated(e,i,r=!1){this._emit("attributesChanged",{object:this,geometry:e,attribute:i,sync:r}),lYe(i)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const i of this._geometries)i.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new CF(Py.MaskOccludee);for(const i of this._geometries)i.occludees=Tq(i.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const i of this._geometries)i.occludees=Sq(i.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new CF(Py.Highlight);for(const i of this._geometries)i.highlights=Tq(i.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const i of this._geometries)i.highlights=Sq(i.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,i){return qi(i,this.transformation,e.transformation)}getCombinedShaderTransformation(e,i=be()){return qi(i,this.effectiveTransformation,e.transformation)}get boundingVolumeWorldSpace(){return this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new rle,this._validateBoundingVolume(this._bvWorldSpace,yR.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace||(this._bvObjectSpace=this._bvObjectSpace||new rle,this._validateBoundingVolume(this._bvObjectSpace,yR.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,i){const r=i===yR.ObjectSpace;for(const n of this._geometries){const s=n.boundingInfo;s&&Bnt(s,e,r?n.transformation:this.getCombinedShaderTransformation(n))}Xi(e.bounds,e.min,e.max,.5);for(const n of this._geometries){const s=n.boundingInfo;if(s==null)continue;const o=r?n.transformation:this.getCombinedShaderTransformation(n),a=WE(o);ke(nle,s.center,o);const l=Mr(nle,e.bounds),c=s.radius*a;e.bounds[3]=Math.max(e.bounds[3],l+c)}}_invalidateBoundingVolume(){const e=this._bvWorldSpace?.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&e&&this._parentLayer.notifyObjectBBChanged(this,e)}_emit(e,i){this._parentLayer&&this._parentLayer.events.emit(e,i)}get test(){const e=this;return{hasGeometry:i=>e._geometries.includes(i),getGeometryIndex:i=>e._geometries.indexOf(i)}}},mCe=class{constructor(){this.min=Oe(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Oe(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},rle=class extends mCe{constructor(){super(...arguments),this.bounds=kn()}};function Bnt(t,e,i){const r=t.bbMin,n=t.bbMax;if(R6(i)){const s=ae(Vnt,i[12],i[13],i[14]);ue(ru,r,s),ue(Td,n,s);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],ru[o]),e.max[o]=Math.max(e.max[o],Td[o])}else if(ke(ru,r,i),oa(r,n))for(let s=0;s<3;++s)e.min[s]=Math.min(e.min[s],ru[s]),e.max[s]=Math.max(e.max[s],ru[s]);else{ke(Td,n,i);for(let s=0;s<3;++s)e.min[s]=Math.min(e.min[s],ru[s],Td[s]),e.max[s]=Math.max(e.max[s],ru[s],Td[s]);for(let s=0;s<3;++s){oe(ru,r),oe(Td,n),ru[s]=n[s],Td[s]=r[s],ke(ru,ru,i),ke(Td,Td,i);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],ru[o],Td[o]),e.max[o]=Math.max(e.max[o],ru[o],Td[o])}}}const Vnt=E(),ru=E(),Td=E(),nle=E();var yR;(function(t){t[t.WorldSpace=0]="WorldSpace",t[t.ObjectSpace=1]="ObjectSpace"})(yR||(yR={}));function LQ(t,e,i,r,n){const s=t.clippingExtent;if(Wc(e,ev,t.elevationProvider.spatialReference),s!=null&&!gJ(s,ev))return null;Wc(e,ev,t.renderCoordsHelper.spatialReference),i.localOrigin=t.localOriginFactory.getOrigin(ev);const o=new Jy({geometries:[i],castShadow:!1,layerUid:t.layer.uid,graphicUid:n,usesVerticalDistanceToGround:!0});return{object:o,sampledElevation:crt(o,e,t.elevationProvider,t.renderCoordsHelper,r)}}function IP(t,e,i){const r=t.elevationContext,n=i.spatialReference;Wc(e,ev,n),r.centerPointInElevationSR=t1(ev[0],ev[1],e.hasZ?ev[2]:0,n??null)}function LP(t){switch(t.type){case"point":return t;case"polygon":case"extent":return wQ(t);case"polyline":{const e=t.paths[0];if(!e||e.length===0)return null;const i=w0e(e,b0e(e)/2);return t1(i[0],i[1],i[2],t.spatialReference)}case"mesh":return t.origin}return null}const ev=E();function gCe(){return new Float32Array(2)}function Gnt(t){const e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}function Bh(t,e){const i=new Float32Array(2);return i[0]=t,i[1]=e,i}function jnt(t,e){return new Float32Array(t,e,2)}function yCe(){return gCe()}function _Ce(){return Bh(1,1)}function vCe(){return Bh(1,0)}function bCe(){return Bh(0,1)}const wCe=yCe(),xCe=_Ce(),Hnt=vCe(),qnt=bCe();Object.freeze(Object.defineProperty({__proto__:null,ONES:xCe,UNIT_X:Hnt,UNIT_Y:qnt,ZEROS:wCe,clone:Gnt,create:gCe,createView:jnt,fromValues:Bh,ones:_Ce,unitX:vCe,unitY:bCe,zeros:yCe},Symbol.toStringTag,{value:"Module"}));function Wnt(t){const e=new Ei,{vertex:i,fragment:r}=e;return i.include(zU),e.include(B2e,t),e.include(Dn,t),e.attributes.add(O.UV0,"vec2"),i.uniforms.add(new yi("viewport",(n,s)=>s.camera.fullViewport),new Re("lineSize",(n,s)=>n.size>0?Math.max(1,n.size)*s.camera.pixelRatio:0),new Ki("pixelToNDC",(n,s)=>mi(ole,2/s.camera.fullViewport[2],2/s.camera.fullViewport[3])),new Re("borderSize",(n,s)=>n.borderColor!=null?s.camera.pixelRatio:0),new Ki("screenOffset",(n,s)=>mi(ole,n.horizontalScreenOffset*s.camera.pixelRatio,0))),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),t.multipassEnabled&&e.varyings.add("depth","float"),t.occlusionTestEnabled&&e.include(oEe),t.hasScreenSizePerspective&&UU(i),i.code.add(b`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${t.occlusionTestEnabled?b`
      if (!testHUDVisibility(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${t.hasScreenSizePerspective?b`
      vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:b`vec2 screenOffsetScaled = screenOffset;`}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
      // correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${t.multipassEnabled?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${t.depthHudEnabled?t.depthHudAlignStartEnabled?b`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:b`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${t.hasScreenSizePerspective?b`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:b`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),r.uniforms.add(new yi("uColor",n=>sle(n.color)),new yi("borderColor",n=>sle(n.borderColor))),t.multipassEnabled&&(r.include(PTe,t),r.uniforms.add(new Ki("inverseViewport",(n,s)=>s.inverseViewport))),r.code.add(b`
    void main() {
      ${t.multipassEnabled?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line blends on top of the
      // border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${t.depthHudEnabled?b`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:b`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      fragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),e}function sle(t){return t??Wu}const ole=Ge(),Ynt=Object.freeze(Object.defineProperty({__proto__:null,build:Wnt},Symbol.toStringTag,{value:"Module"}));let TCe=class SCe extends Fi{initializeConfiguration(e,i){i.spherical=e.viewingMode===Le.Global}initializeProgram(e){return new Mi(e.rctx,SCe.shader.get().build(this.configuration),Si)}setPipelineState(e){const i=e?Bi.ALWAYS:Bi.LESS;return this.configuration.depthHudEnabled?Lt({depthTest:{func:i},depthWrite:ec}):Lt({blending:Go(Te.ONE,Te.SRC_ALPHA,Te.ONE_MINUS_SRC_ALPHA,Te.ONE_MINUS_SRC_ALPHA),depthTest:{func:i},colorWrite:Gt})}initializePipeline(){return this.setPipelineState(this.configuration.multipassEnabled)}};TCe.shader=new Pi(Ynt,()=>ce(()=>import("./LineCallout.glsl-d53ebc37.js"),[],import.meta.url));let Th=class extends fl{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.multipassEnabled=!1}};u([U()],Th.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([U()],Th.prototype,"spherical",void 0),u([U()],Th.prototype,"occlusionTestEnabled",void 0),u([U()],Th.prototype,"hasVerticalOffset",void 0),u([U()],Th.prototype,"hasScreenSizePerspective",void 0),u([U()],Th.prototype,"depthHudEnabled",void 0),u([U()],Th.prototype,"depthHudAlignStartEnabled",void 0),u([U()],Th.prototype,"hasSlicePlane",void 0),u([U()],Th.prototype,"multipassEnabled",void 0),u([U({constValue:!0})],Th.prototype,"hasSliceInVertexProgram",void 0),u([U({constValue:!1})],Th.prototype,"draped",void 0);let cL=class eW extends n1{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(e){super(e,new ECe),this._configuration=new Th,this._uniqueMaterialIdentifier=eW.uniqueMaterialIdentifier(this.parameters)}getPassParameters(){return this.parameters}getConfiguration(e,i){const r=i?.slot!==le.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.depthHudEnabled=r,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration}intersect(){}produces(e,i){if(i===F.Color)switch(e){case le.LINE_CALLOUTS:case le.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(e){return new Xnt(e)}createBufferWriter(){return new Jnt}validateParameters(e){const i=eW.uniqueMaterialIdentifier(e);i!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=i)}static uniqueMaterialIdentifier(e){return JSON.stringify({horizontalScreenOffset:e.horizontalScreenOffset??0,centerOffsetUnits:e.centerOffsetUnits||"world"})}},Xnt=class extends i1{beginSlot(e){return this.ensureTechnique(TCe,e)}},ECe=class extends fQ{constructor(){super(...arguments),this.horizontalScreenOffset=0,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const Znt=Hr().vec3f(O.POSITION).vec3f(O.NORMAL).vec2f(O.UV0).vec4f(O.AUXPOS1),ale=[Bh(0,0),Bh(1,0),Bh(0,1),Bh(1,0),Bh(1,1),Bh(0,1)];let Jnt=class{constructor(){this.vertexBufferLayout=Znt}elementCount(e){return 6*e.attributes.get(O.POSITION).indices.length}write(e,i,r,n,s){mQ(r.attributes.get(O.POSITION),e,n.position,s,6),gQ(r.attributes.get(O.NORMAL),i,n.normal,s,6),aC(r.attributes.get(O.AUXPOS1),n.auxpos1,s,6);for(let o=0;o<ale.length;++o)n.uv0.setVec(s+o,ale[o])}},CCe=class ACe extends Xm{constructor(e,i){super(e,null,i,Qnt),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new cL(this._materialParameters),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}_perInstanceMaterialParameters(e){const i=this._materialParameters;return i.horizontalScreenOffset=e.horizontalScreenOffset??0,i.centerOffsetUnits=e.centerOffsetUnits||"world",i}get _materialParameters(){const e=new ECe,i=this.symbol,r=i.callout;if(e.color=r.color!=null?Pe.toUnitRGBA(r.color):[0,0,0,0],e.color[3]*=this._getLayerOpacity(),e.size=Jn(r.size||0),i.verticalOffset){const{screenLength:o,minWorldLength:a,maxWorldLength:l}=i.verticalOffset;e.verticalOffset={screenLength:Jn(o),minWorldLength:a||0,maxWorldLength:l??1/0}}e.borderColor=r.border?.color!=null?Pe.toUnitRGBA(r.border.color):null;const n=i.symbolLayers.at(0).type==="object",s=i.type==="label-3d";return e.occlusionTest=!n,e.shaderPolygonOffset=n?0:void 0,e.depthHUDAlignStart=s,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return Knt}createGraphics3DGraphic(e){const i=e.renderingInfo,r=e.graphic,n=this.setGraphicElevationContext(r,new jF,i.elevationOffset||0),s=i.symbol,o=this._elevationContext.mode==="on-the-ground"&&(s.type==="cim"||!s.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(s.type!=="label-3d"&&o||s.type==="point-3d"&&s.symbolLayers.every(l=>l.type==="text"&&!D1e(l)))return null;const a=wQ(r.geometry);return a==null?null:this._createAs3DShape(a,n,i,r.uid)}layerOpacityChanged(){this._materials[0]?.setParameters(this._materialParameters)}layerElevationInfoChanged(e,i,r){const n=this._elevationContext.mode,s=YM(ACe.elevationModeChangeTypes,r,n);return s!==xn.UPDATE||e.forEach(o=>{const a=i(o);a!=null&&this.updateGraphicElevationContext(o.graphic,a)}),s}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,i,r=0){return super.setGraphicElevationContext(e,i),i.addOffsetRenderUnits(r),i}updateGraphicElevationContext(e,i){this.setGraphicElevationContext(e,i.elevationContext,i.metadata!=null?i.metadata.elevationOffset:0),i.needsElevationUpdates=cd(i.elevationContext.mode)}computeComplexity(){return new Dh({verticesPerFeature:6})}_createVertexData(e){const{translation:i,centerOffset:r}=e,n=new Ve(i?[i[0],i[1],i[2]]:[0,0,0],F9,3,!0),s=new Ve(r?[r[0],r[1],r[2],r[3]]:[0,0,0,1],F9,4,!0);return[[O.POSITION,n],[O.NORMAL,new Ve([0,0,1],F9,3,!0)],[O.AUXPOS1,s]]}_getOrCreateMaterial(e){const i=this._perInstanceMaterialParameters(e),r=cL.uniqueMaterialIdentifier(i);if(r===this._materials[0]?.uniqueMaterialIdentifier)return{material:this._materials[0],isUnique:!1};if(e.materialCollection!=null){let n=e.materialCollection.get(r);return n==null&&(n=new cL(i),e.materialCollection.add(r,n)),{material:n,isUnique:!1}}return{material:new cL(i),isUnique:!0}}_createAs3DShape(e,i,r,n){const s=this._context.layer.uid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:s}),a=this._getOrCreateMaterial(r),l=new ms(a.material,this._createVertexData(r),null,wn.Point,o),c=LQ(this._context,e,l,i,n);if(c==null)return null;const h=new Ym(this,c.object,[l],a.isUnique?[a.material]:null,null,Xw,i);return h.metadata=new MEe(r.elevationOffset),h.alignedSampledElevation=c.sampledElevation,h.needsElevationUpdates=cd(i.mode),IP(h,e,this._context.elevationProvider),h}};CCe.elevationModeChangeTypes={definedChanged:xn.UPDATE,staysOnTheGround:xn.UPDATE,onTheGroundChanged:xn.RECREATE};const F9=[0],Knt={mode:"relative-to-ground",offset:0},Qnt={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let est=class{constructor(e,i,r=E(),n=oi(),s=0,o="world",a=0,l=null){this.renderer=e,this.symbol=i,this.translation=r,this.centerOffset=n,this.horizontalScreenOffset=s,this.centerOffsetUnits=o,this.elevationOffset=a,this.materialCollection=l}},tst=class extends Rrt{};const lle=K.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function ist(t,e){if(!TJ(t))return lle.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${t.type}' does not support callouts`),null;if(!t.callout)return null;const i=rst[t.callout.type];return i?new i(t,e):(lle.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${t.callout.type}`),null)}const rst={line:CCe},DQ=(t,e,i)=>[e,i],cC=(t,e,i)=>[e,i,t[2]],NQ=(t,e,i)=>[e,i,t[2],t[3]];function QFt(t){return t?{originPosition:t.originPosition==="upper-left"?"upperLeft":t.originPosition==="lower-left"?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance]:[1,1],translate:t.extent!=null?[t.extent.xmin,t.extent.ymax]:[0,0]}:null}function nst({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function sst({scale:t,translate:e},i){return Math.round((e[1]-i)/t[1])}function OCe({scale:t,translate:e},i){return i*t[0]+e[0]}function RCe({scale:t,translate:e},i){return e[1]-i*t[1]}function PCe(t,e,i){const r=new Array(i.length);if(!i.length)return r;const[n,s]=t.scale;let o=OCe(t,i[0][0]),a=RCe(t,i[0][1]);r[0]=e(i[0],o,a);for(let l=1;l<i.length;l++){const c=i[l];o+=c[0]*n,a-=c[1]*s,r[l]=e(c,o,a)}return r}function MCe(t,e,i){const r=new Array(i.length);for(let n=0;n<i.length;n++)r[n]=PCe(t,e,i[n]);return r}function ost(t,e,i,r){return PCe(t,i?r?NQ:cC:r?cC:DQ,e)}function ast(t,e,i,r){return MCe(t,i?r?NQ:cC:r?cC:DQ,e)}function lst(t,e,i,r){return MCe(t,i?r?NQ:cC:r?cC:DQ,e)}function ekt(t,e,i,r,n){return e.x=nst(t,i.x),e.y=sst(t,i.y),e!==i&&(r&&(e.z=i.z),n&&(e.m=i.m)),e}function $Ce(t,e,i,r,n){return i!=null&&(e.points=ost(t,i.points,r,n)),e}function ICe(t,e,i,r,n){return i==null||(e.x=OCe(t,i.x),e.y=RCe(t,i.y),e!==i&&(r&&(e.z=i.z),n&&(e.m=i.m))),e}function LCe(t,e,i,r,n){return i!=null&&(e.rings=lst(t,i.rings,r,n)),e}function DCe(t,e,i,r,n){return i!=null&&(e.paths=ast(t,i.paths,r,n)),e}var tW;let nO=tW=class extends pe{constructor(t){super(t),this.name=null,this.code=null}clone(){return new tW({name:this.name,code:this.code})}};u([p({type:String,json:{write:!0}})],nO.prototype,"name",void 0),u([p({type:[String,Number],json:{write:!0}})],nO.prototype,"code",void 0),nO=tW=u([M("esri.layers.support.CodedValue")],nO);const cst=new Sr({inherited:"inherited",codedValue:"coded-value",range:"range"});let sO=class extends pe{constructor(e){super(e),this.name=null,this.type=null}};u([p({type:String,json:{write:!0}})],sO.prototype,"name",void 0),u([nt(cst)],sO.prototype,"type",void 0),sO=u([M("esri.layers.support.Domain")],sO);const KU=sO;var iW;let oO=iW=class extends KU{constructor(t){super(t),this.codedValues=null,this.type="coded-value"}getName(t){let e=null;if(this.codedValues){const i=String(t);this.codedValues.some(r=>(String(r.code)===i&&(e=r.name),!!e))}return e}clone(){return new iW({codedValues:Q(this.codedValues),name:this.name})}};u([p({type:[nO],json:{write:!0}})],oO.prototype,"codedValues",void 0),u([nt({codedValue:"coded-value"})],oO.prototype,"type",void 0),oO=iW=u([M("esri.layers.support.CodedValueDomain")],oO);const NCe=oO;var rW;let p4=rW=class extends KU{constructor(t){super(t),this.type="inherited"}clone(){return new rW}};u([nt({inherited:"inherited"})],p4.prototype,"type",void 0),p4=rW=u([M("esri.layers.support.InheritedDomain")],p4);const FCe=p4;var nW;let WS=nW=class extends KU{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new nW({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};u([p({json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range?.[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(t,e,i){e[i]=[this.minValue||0,t]}}}})],WS.prototype,"maxValue",void 0),u([p({json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range?.[0]},write:{target:"range",writer(t,e,i){e[i]=[t,this.maxValue||0]}}}})],WS.prototype,"minValue",void 0),u([nt({range:"range"})],WS.prototype,"type",void 0),WS=nW=u([M("esri.layers.support.RangeDomain")],WS);const kCe=WS,ust={key:"type",base:KU,typeMap:{range:kCe,"coded-value":NCe,inherited:FCe}};function hst(t){if(!t?.type)return null;switch(t.type){case"range":return kCe.fromJSON(t);case"codedValue":return NCe.fromJSON(t);case"inherited":return FCe.fromJSON(t)}return null}var sW;const dst=new Sr({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let Ka=sW=class extends pe{constructor(t){super(t),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=void 0,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(t,{description:e}){let i=null;try{i=e?JSON.parse(e):null}catch{}return i?.value??null}readValueType(t,{description:e}){let i=null;try{i=e?JSON.parse(e):null}catch{}return i?dst.fromJSON(i.fieldValueType):null}clone(){return new sW({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};u([p({type:String,json:{write:!0}})],Ka.prototype,"alias",void 0),u([p({type:[String,Number],json:{write:{allowNull:!0}}})],Ka.prototype,"defaultValue",void 0),u([p()],Ka.prototype,"description",void 0),u([wt("description")],Ka.prototype,"readDescription",null),u([p({types:ust,json:{read:{reader:hst},write:!0}})],Ka.prototype,"domain",void 0),u([p({type:Boolean,json:{write:!0}})],Ka.prototype,"editable",void 0),u([p({type:dr,json:{write:{overridePolicy:t=>({enabled:Number.isFinite(t)})}}})],Ka.prototype,"length",void 0),u([p({type:String,json:{write:!0}})],Ka.prototype,"name",void 0),u([p({type:Boolean,json:{write:!0}})],Ka.prototype,"nullable",void 0),u([nt(JZ)],Ka.prototype,"type",void 0),u([p()],Ka.prototype,"valueType",void 0),u([wt("valueType",["description"])],Ka.prototype,"readValueType",null),u([p({type:Boolean,json:{read:!1}})],Ka.prototype,"visible",void 0),Ka=sW=u([M("esri.layers.support.Field")],Ka);const QU=Ka;let ikt=class{constructor(e,i,r){this.uid=e,this.geometry=i,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null}};function nkt(t){return t.geometry!=null}let skt=class{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}};function akt(t){const e=nP.fromJSON(t.geometryType),i=ze.fromJSON(t.spatialReference),r=t.transform,n=t.features.map(s=>{const o=pst(s,e,i,t.objectIdFieldName),a=o.geometry;if(a!=null&&r)switch(a.type){case"point":o.geometry=ICe(r,a,a,a.hasZ,a.hasM);break;case"multipoint":o.geometry=$Ce(r,a,a,!!a.hasZ,!!a.hasM);break;case"polygon":o.geometry=LCe(r,a,a,!!a.hasZ,!!a.hasM);break;case"polyline":o.geometry=DCe(r,a,a,!!a.hasZ,!!a.hasM);break;case"extent":case"mesh":o.geometry=a}return o});return{geometryType:e,features:n,spatialReference:i,fields:t.fields?.map(s=>QU.fromJSON(s))??[],objectIdFieldName:t.objectIdFieldName,globalIdFieldName:t.globalIdFieldName,geohashFieldName:t.geohashFieldName,geometryProperties:t.geometryProperties,hasZ:t.hasZ,hasM:t.hasM,exceededTransferLimit:t.exceededTransferLimit,transform:null}}function pst(t,e,i,r){return{uid:zu(),objectId:r&&t.attributes?t.attributes[r]:null,attributes:t.attributes,geometry:fst(t.geometry,e,i),visible:!0}}function fst(t,e,i){if(t==null)return null;switch(e){case"point":{const r=t;return{x:r.x,y:r.y,z:r.z,m:r.m,hasZ:r.z!=null,hasM:r.m!=null,type:"point",spatialReference:i}}case"polyline":{const r=t;return{paths:r.paths,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polyline",spatialReference:i}}case"polygon":{const r=t;return{rings:r.rings,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polygon",spatialReference:i}}case"multipoint":{const r=t;return{points:r.points,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"multipoint",spatialReference:i}}}}function mst(t){if(t==null)return 0;let e=32;switch(t.type){case"point":e+=42;break;case"polyline":case"polygon":{let i=0;const r=2+(t.hasZ?1:0)+(t.hasM?1:0),n=t.type==="polyline"?t.paths:t.rings;for(const s of n)i+=s.length;e+=8*i*r+64,e+=128*i,e+=34,e+=32*(n.length+1);break}case"multipoint":{const i=2+(t.hasZ?1:0)+(t.hasM?1:0),r=t.points.length;e+=8*r*i+64,e+=128*r,e+=34,e+=32;break}case"extent":e+=98,t.hasM&&(e+=32),t.hasZ&&(e+=32);break;case"mesh":e+=gv(t.vertexAttributes.position,t.vertexAttributes.normal,t.vertexAttributes.uv,t.vertexAttributes.tangent)}return e}function lkt(t){let e=32;return e+=wme(t.attributes),e+=3,e+=8+mst(t.geometry),e}function ckt(t){if(t==null)return 0;switch(t.type){case"point":return 1;case"polyline":{let e=0;for(const i of t.paths)e+=i.length;return e}case"polygon":{let e=0;for(const i of t.rings)e+=i.length;return e}case"multipoint":return t.points.length;case"extent":return 2;case"mesh":{const e=t.vertexAttributes&&t.vertexAttributes.position;return e?e.length/3:0}default:return}}function ukt(t){if(t==null)return!1;switch(t.type){case"extent":case"point":return!0;case"polyline":for(const e of t.paths)if(e.length>0)return!0;return!1;case"polygon":for(const e of t.rings)if(e.length>0)return!0;return!1;case"multipoint":return t.points.length>0;case"mesh":return!t.loaded||t.vertexAttributes.position.length>0}}function hkt(t,e){switch(Pr(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[3]=t.x,e[1]=e[4]=t.y,t.hasZ&&(e[2]=e[5]=t.z);break;case"polyline":for(let i=0;i<t.paths.length;i++)uz(e,t.paths[i],!!t.hasZ);break;case"polygon":for(let i=0;i<t.rings.length;i++)uz(e,t.rings[i],!!t.hasZ);break;case"multipoint":uz(e,t.points,!!t.hasZ);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[3]=t.xmax,e[4]=t.ymax,t.zmin!=null&&(e[2]=t.zmin),t.zmax!=null&&(e[5]=t.zmax)}}function gst(t,e){switch(id(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[2]=t.x,e[1]=e[3]=t.y;break;case"polyline":for(let i=0;i<t.paths.length;i++)q8(e,t.paths[i]);break;case"polygon":for(let i=0;i<t.rings.length;i++)q8(e,t.rings[i]);break;case"multipoint":q8(e,t.points);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax}}function dkt(t,e){return t.objectId!=null?t.objectId:t.attributes&&e?t.attributes[e]:null}let Rx=class UCe{constructor(e=null,i={},r,n){this.geometry=e,this.attributes=i,this.centroid=r,this.objectId=n,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const e=new UCe(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}};function pkt(t){return!!t.geometry?.coords?.length}let fkt=class extends Rx{},yst=class zCe{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new zCe;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}},jv=class f4{constructor(e=[],i=[],r=!1){this.lengths=e??[],this.coords=i??[],this.hasIndeterminateRingOrder=r}static fromRect(e){const[i,r,n,s]=e,o=n-i,a=s-r;return new f4([5],[i,r,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,i)=>e+i)}forEachVertex(e){let i=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const n=this.lengths[r];for(let s=0;s<n;s++)e(this.coords[2*(s+i)],this.coords[2*(s+i)+1]);i+=n}}clone(e){return e?(e.set(this.coords),new f4(this.lengths.slice(),e,this.hasIndeterminateRingOrder)):new f4(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}};function La(t,e){return t?e?4:3:e?3:2}const e$=K.getLogger("esri.layers.graphics.featureConversionUtils"),BCe={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryEnvelope:0},_st=(t,e,i,r,n,s)=>{t[i]=n,t[i+1]=s},cle=(t,e,i,r,n,s)=>{t[i]=n,t[i+1]=s,t[i+2]=e[r+2]},vst=(t,e,i,r,n,s)=>{t[i]=n,t[i+1]=s,t[i+2]=e[r+3]},bst=(t,e,i,r,n,s)=>{t[i]=n,t[i+1]=s,t[i+2]=e[r+2],t[i+3]=e[r+3]};function FQ(t,e,i,r){if(t){if(i)return e&&r?bst:cle;if(e&&r)return vst}else if(e&&r)return cle;return _st}function k9({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function U9({scale:t,translate:e},i){return Math.round((e[1]-i)/t[1])}function z9({scale:t,translate:e},i,r){return i*t[r]+e[r]}function gkt(t,e,i){return t?e?i?zQ(t):kQ(t):i?UQ(t):e8(t):null}function e8(t){const e=t.coords;return{x:e[0],y:e[1]}}function VCe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function kQ(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function wst(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function UQ(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function xst(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function zQ(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function Tst(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function Sst(t,e,i,r){let n=e8;i&&r?n=zQ:i?n=kQ:r&&(n=UQ);for(const s of e){const{geometry:o,attributes:a}=s,l=o!=null?n(o):null;t.push({attributes:a,geometry:l})}return t}function BQ(t,e){return t&&e?Tst:t?wst:e?xst:VCe}function Est(t,e,i,r,n){const s=BQ(i,r);for(const{geometry:o,attributes:a}of e){const l=o!=null?s(new jv,o):null;t.push(new Rx(l,a,null,n?a[n]:void 0))}return t}function ykt(t,e,i=BQ(e.z!=null,e.m!=null)){return i(t,e)}function Cst(t,e,i,r){for(const{geometry:n,attributes:s}of e)t.push({attributes:s,geometry:n!=null?GCe(n,i,r):null});return t}function GCe(t,e,i){if(t==null)return null;const r=La(e,i),n=[];for(let s=0;s<t.coords.length;s+=r){const o=[];for(let a=0;a<r;a++)o.push(t.coords[s+a]);n.push(o)}return e?i?{points:n,hasZ:e,hasM:i}:{points:n,hasZ:e}:i?{points:n,hasM:i}:{points:n}}function Ast(t,e,i,r,n){const s=La(i,r);for(const{geometry:o,attributes:a}of e){const l=o!=null?jCe(new jv,o,s):null;t.push(new Rx(l,a,null,n?a[n]:void 0))}return t}function jCe(t,e,i=La(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const r=t.coords;let n=0;for(const s of e.points)for(let o=0;o<i;o++)r[n++]=s[o];return t}function Ost(t,e,i,r){for(const{geometry:n,attributes:s}of e)t.push({attributes:s,geometry:n!=null?HCe(n,i,r):null});return t}function HCe(t,e,i){if(!t)return null;const r=La(e,i),{coords:n,lengths:s}=t,o=[];let a=0;for(const l of s){const c=[];for(let h=0;h<l;h++){const d=[];for(let f=0;f<r;f++)d.push(n[a++]);c.push(d)}o.push(c)}return e?i?{paths:o,hasZ:e,hasM:i}:{paths:o,hasZ:e}:i?{paths:o,hasM:i}:{paths:o}}function Rst(t,e,i,r,n){const s=La(i,r);for(const{geometry:o,attributes:a}of e){const l=o!=null?qCe(new jv,o,s):null;t.push(new Rx(l,a,null,n?a[n]:void 0))}return t}function qCe(t,e,i=La(e.hasZ,e.hasM)){const{lengths:r,coords:n}=t;let s=0;for(const o of e.paths){for(const a of o)for(let l=0;l<i;l++)n[s++]=a[l];r.push(o.length)}return t}function Pst(t,e,i,r){for(const{geometry:n,attributes:s,centroid:o}of e){const a=n!=null?WCe(n,i,r):null;if(o!=null){const l=e8(o);t.push({attributes:s,centroid:l,geometry:a})}else t.push({attributes:s,geometry:a})}return t}function WCe(t,e,i){if(!t)return null;const r=La(e,i),{coords:n,lengths:s}=t,o=[];let a=0;for(const l of s){const c=[];for(let h=0;h<l;h++){const d=[];for(let f=0;f<r;f++)d.push(n[a++]);c.push(d)}o.push(c)}return e?i?{rings:o,hasZ:e,hasM:i}:{rings:o,hasZ:e}:i?{rings:o,hasM:i}:{rings:o}}function Mst(t,e,i,r,n){for(const{geometry:s,centroid:o,attributes:a}of e){const l=s!=null?YCe(new jv,s,i,r):null,c=n?a[n]:void 0;o!=null?t.push(new Rx(l,a,VCe(new jv,o),c)):t.push(new Rx(l,a,null,c))}return t}function YCe(t,e,i=e.hasZ,r=e.hasM){return $st(t,e.rings,i,r)}function $st(t,e,i,r){const n=La(i,r),{lengths:s,coords:o}=t;let a=0;py(t);for(const l of e){for(const c of l)for(let h=0;h<n;h++)o[a++]=c[h];s.push(l.length)}return t}const cE=[],_R=[];function _kt(t,e,i,r,n){cE[0]=t;const[s]=XCe(_R,cE,e,i,r,n);return Up(cE),Up(_R),s}function XCe(t,e,i,r,n,s){if(Up(t),!i){for(const o of e){const a=s?o.attributes[s]:void 0;t.push(new Rx(null,o.attributes,null,a))}return t}switch(i){case"esriGeometryPoint":return Est(t,e,r,n,s);case"esriGeometryMultipoint":return Ast(t,e,r,n,s);case"esriGeometryPolyline":return Rst(t,e,r,n,s);case"esriGeometryPolygon":return Mst(t,e,r,n,s);default:e$.error("convertToFeatureSet:unknown-geometry",new G(`Unable to parse unknown geometry type '${i}'`)),Up(t)}return t}function vkt(t,e,i,r){_R[0]=t,ZCe(cE,_R,e,i,r);const n=cE[0];return Up(cE),Up(_R),n}function Ist(t,e,i){if(t==null)return null;const r=new jv;return"hasZ"in t&&e==null&&(e=t.hasZ),"hasM"in t&&i==null&&(i=t.hasM),IZ(t)?BQ(e??t.z!=null,i??t.m!=null)(r,t):L6(t)?YCe(r,t,e,i):LZ(t)?qCe(r,t,La(e,i)):$Z(t)?jCe(r,t,La(e,i)):void e$.error("convertFromGeometry:unknown-geometry",new G(`Unable to parse unknown geometry type '${t}'`))}function Lst(t,e,i,r){const n=t&&("coords"in t?t:t.geometry);if(n==null)return null;switch(e){case"esriGeometryPoint":{let s=e8;return i&&r?s=zQ:i?s=kQ:r&&(s=UQ),s(n)}case"esriGeometryMultipoint":return GCe(n,i,r);case"esriGeometryPolyline":return HCe(n,i,r);case"esriGeometryPolygon":return WCe(n,i,r);default:return e$.error("convertToGeometry:unknown-geometry",new G(`Unable to parse unknown geometry type '${e}'`)),null}}function Dst(t,e){for(const i of e)t.push({attributes:i.attributes});return t}function ZCe(t,e,i,r,n){if(Up(t),i==null)return Dst(t,e);switch(i){case"esriGeometryPoint":return Sst(t,e,r,n);case"esriGeometryMultipoint":return Cst(t,e,r,n);case"esriGeometryPolyline":return Ost(t,e,r,n);case"esriGeometryPolygon":return Pst(t,e,r,n);default:e$.error("convertToFeatureSet:unknown-geometry",new G(`Unable to parse unknown geometry type '${i}'`))}return t}function bkt(t){const{objectIdFieldName:e,spatialReference:i,transform:r,fields:n,hasM:s,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:h,queryGeometry:d,queryGeometryType:f}=t,m={features:ZCe([],a,l,o,s),fields:n,geometryType:l,objectIdFieldName:e,spatialReference:i,uniqueIdField:h,queryGeometry:Lst(d,f,!1,!1)};return r&&(m.transform=r),c&&(m.exceededTransferLimit=c),s&&(m.hasM=s),o&&(m.hasZ=o),m}function wkt(t,e){const i=new yst,{hasM:r,hasZ:n,features:s,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:h,fields:d}=t;return d&&(i.fields=d),i.geometryType=l??null,i.objectIdFieldName=o??e??null,i.spatialReference=a??null,i.objectIdFieldName?(s&&XCe(i.features,s,l,n,r,i.objectIdFieldName),c&&(i.exceededTransferLimit=c),r&&(i.hasM=r),n&&(i.hasZ=n),h&&(i.transform=h),i):(e$.error(new G("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),i)}function xkt(t){const{transform:e,features:i,hasM:r,hasZ:n}=t;if(!e)return t;for(const s of i)s.geometry!=null&&hle(s.geometry,s.geometry,r,n,e),s.centroid!=null&&hle(s.centroid,s.centroid,r,n,e);return t.transform=null,t}function Tkt(t,e){const{geometryType:i,features:r,hasM:n,hasZ:s}=e;if(!t)return e;for(let o=0;o<r.length;o++){const a=r[o],l=a.weakClone();l.geometry=new jv,ule(l.geometry,a.geometry,n,s,i,t),a.centroid&&(l.centroid=new jv,ule(l.centroid,a.centroid,n,s,"esriGeometryPoint",t)),r[o]=l}return e.transform=t,e}function ule(t,e,i,r,n,s,o=i,a=r){if(py(t),!e?.coords.length)return null;const l=BCe[n],{coords:c,lengths:h}=e,d=La(i,r),f=La(i&&o,r&&a),m=FQ(i,r,o,a);if(!h.length)return m(t.coords,c,0,0,k9(s,c[0]),U9(s,c[1])),py(t,d,0),t;let y,_,v,w,x=0,T=0,S=T;for(const C of h){if(C<l)continue;let A=0;T=S,v=y=k9(s,c[x]),w=_=U9(s,c[x+1]),m(t.coords,c,T,x,v,w),A++,x+=d,T+=f;for(let R=1;R<C;R++,x+=d)v=k9(s,c[x]),w=U9(s,c[x+1]),v===y&&w===_||(m(t.coords,c,T,x,v-y,w-_),T+=f,A++,y=v,_=w);A>=l&&(t.lengths.push(A),S=T)}return Up(t.coords,S),t.coords.length?t:null}function Skt(t,e,i,r,n,s,o=i,a=r){if(py(t),!e?.coords.length)return null;const l=BCe[n],{coords:c,lengths:h}=e,d=La(i,r),f=La(i&&o,r&&a),m=FQ(i,r,o,a);if(!h.length)return m(t.coords,c,0,0,c[0],c[1]),py(t,d,0),t;let y=0;const _=s*s;for(const v of h){if(v<l){y+=v*d;continue}const w=t.coords.length/f,x=y,T=y+(v-1)*d;m(t.coords,c,t.coords.length,x,c[x],c[x+1]),oW(t.coords,c,d,_,m,x,T),m(t.coords,c,t.coords.length,T,c[T],c[T+1]);const S=t.coords.length/f-w;S>=l?t.lengths.push(S):Up(t.coords,w*f),y+=v*d}return t.coords.length?t:null}function Nst(t,e,i,r){const n=t[e],s=t[e+1],o=t[i],a=t[i+1],l=t[r],c=t[r+1];let h=o,d=a,f=l-h,m=c-d;if(f!==0||m!==0){const y=((n-h)*f+(s-d)*m)/(f*f+m*m);y>1?(h=l,d=c):y>0&&(h+=f*y,d+=m*y)}return f=n-h,m=s-d,f*f+m*m}function oW(t,e,i,r,n,s,o){let a,l=r,c=0;for(let h=s+i;h<o;h+=i)a=Nst(e,h,s,o),a>l&&(c=h,l=a);l>r&&(c-s>i&&oW(t,e,i,r,n,s,c),n(t,e,t.length,c,e[c],e[c+1]),o-c>i&&oW(t,e,i,r,n,c,o))}function Ekt(t,e,i,r){if(!e?.coords?.length)return null;const n=La(i,r);let s=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&e.coords){const c=e.coords;for(let h=0;h<c.length;h+=n){const d=c[h],f=c[h+1];s=Math.min(s,d),a=Math.max(a,d),o=Math.min(o,f),l=Math.max(l,f)}}return Sj(t)?jBe(t,s,o,a,l):CZ(s,o,a,l,t),t}function hle(t,e,i,r,n){const{coords:s,lengths:o}=e,a=La(i,r);if(!s.length)return t!==e&&py(t),t;o6(n);const{originPosition:l,scale:c,translate:h}=n,d=kst;d.originPosition=l;const f=d.scale;f[0]=c[0]??1,f[1]=-(c[1]??1),f[2]=c[2]??1,f[3]=c[3]??1;const m=d.translate;if(m[0]=h[0]??0,m[1]=h[1]??0,m[2]=h[2]??0,m[3]=h[3]??0,!o.length){for(let _=0;_<a;++_)t.coords[_]=z9(d,s[_],_);return t!==e&&py(t,a,0),t}let y=0;for(let _=0;_<o.length;_++){const v=o[_];t.lengths[_]=v;for(let T=0;T<a;++T)t.coords[y+T]=z9(d,s[y+T],T);let w=t.coords[y],x=t.coords[y+1];y+=a;for(let T=1;T<v;T++,y+=a){w+=s[y]*f[0],x+=s[y+1]*f[1],t.coords[y]=w,t.coords[y+1]=x;for(let S=2;S<a;++S)t.coords[y+S]=z9(d,s[y+S],S)}}return t!==e&&py(t,s.length,o.length),t}function Ckt(t,e,i,r,n,s){if(py(t),t.lengths.push(...e.lengths),i===n&&r===s)for(let o=0;o<e.coords.length;o++)t.coords.push(e.coords[o]);else{const o=La(i,r),a=FQ(i,r,n,s),l=e.coords;for(let c=0;c<l.length;c+=o)a(t.coords,l,t.coords.length,c,l[c],l[c+1])}return t}function Fst(t,e,i,r){let n=0,s=t[r*e],o=t[r*(e+1)];for(let a=1;a<i;a++){const l=s+t[r*(e+a)],c=o+t[r*(e+a)+1],h=(l-s)*(c+o);s=l,o=c,n+=h}return .5*n}function Akt(t,e){const{coords:i,lengths:r}=t;let n=0,s=0;for(let o=0;o<r.length;o++){const a=r[o];s+=Fst(i,n,a,e),n+=a}return Math.abs(s)}function py(t,e=0,i=0){Up(t.lengths,i),Up(t.coords,e)}function Up(t,e=0){t.length!==e&&(t.length=e)}const kst={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]},dle=new $a(Array,t=>H6(t,S1e),null,10,5),Ust=Zt();let zst=class{get labelLayers(){return this._labelLayers||tLe}get extent(){return this._extent}get isElevationSource(){return this.layers.some(e=>e?.isElevationSource)}constructor(e,i,r,n,s){this.graphic=e,this.graphics3DSymbol=i,this.layers=r,this._visibleFlags=sa.ALL_LABEL,this.deconflictionPriority=0,++i.referenced,this._featureExpressionFeature=s?AEe(s,e,n):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic(i=>{i.initialize(e),i.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers=null}addLabelGraphic(e,i){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(i),e.setVisibility(this.isVisible(mo.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(i=>{i.type==="draped"&&(e=!0)}),e}isVisible(e=mo.GRAPHIC,i){const r=i?this._visibleFlags|i|mo.LABEL*i:this._visibleFlags;return e===mo.GRAPHIC?(r&sa.ALL_GRAPHIC)===sa.ALL_GRAPHIC:(r&sa.ALL_LABEL)===sa.ALL_LABEL}setVisibilityFlag(e,i,r){const n=this.isVisible(e);r?this._visibleFlags|=e*i:this._visibleFlags&=~(e*i);const s=this.isVisible(e);if(n===s)return!1;if(e===mo.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(s));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(s));const o=this.isVisible(mo.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}getVisibilityFlag(e,i){return(this._visibleFlags&e*i)!=0}computeExtent(e){if(!this._extent){const i=this.graphic.geometry;if(i==null)return!1;this._extent=Zt(),gst(i,this._extent);const r=i.spatialReference;if(!Fn(r,e)&&!K6(this._extent,r,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,i){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,i)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,i,r){let n=e.geometry;return n.type!=="mesh"&&n.type!=="extent"||(n=Cm.fromExtent(n.type==="mesh"?n.extent:n)),Ist(n,i,r)}get usedMemory(){let e=wme(this.graphic.attributes);return this._forEachSymbolLayerGraphic(i=>e+=i.graphics3DSymbolLayer.usedMemory),e}computeAttachmentOrigin(){const e={render:{origin:E(),num:0},draped:{origin:Ge(),num:0}};for(const i of this.layers)i?.computeAttachmentOrigin(e);return e.render.num>1&&re(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&Lc(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,i,r,n,s){return s||(s={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),s.boundingBox?Pr(s.boundingBox):s.boundingBox=Pr(),s.requiresDrapedElevation=!1,await f6(this.layers,async o=>{if(o==null)return;const a=o.type==="draped"?i:e,l=dle.acquire(),c=await o.getProjectedBoundingBox(a,r,s.screenSpaceObjects,n,l);isFinite(c[2])&&isFinite(c[5])||(s.requiresDrapedElevation=!0),c&&jE(s.boundingBox,l),dle.release(l)}),VBe(s.boundingBox)||Y7(yJ(s.boundingBox,Ust))?s:null}needsElevationUpdates(){for(const e of this.layers)if(e!=null&&(e.type==="object3d"||e.type==="lod-instance")&&e.needsElevationUpdates)return!0;return this._labelLayers?.some(e=>e?.needsElevationUpdates??!1)??!1}alignWithElevation(e,i,r){this._forEachRenderedGraphic(n=>{n.type!=="object3d"&&n.type!=="lod-instance"||n.alignWithElevation(e,i,this._featureExpressionFeature,r)})}alignWithAbsoluteElevation(e,i,r){this._forEachRenderedGraphic(n=>{n.type==="object3d"&&n.alignWithAbsoluteElevation(e,i,r)})}addObjectStateSet(e,i){this._forEachSymbolLayerGraphic(r=>r.addObjectState(e,i))}removeObjectState(e){this._forEachSymbolLayerGraphic(i=>i.removeObjectState(e))}_forEachGraphicList(e,i){e?.forEach(r=>r&&i(r))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){const e=this;return{addLabelLayer:i=>{e._labelLayers||(e._labelLayers=new Array),e._labelLayers.push(i)}}}},Rkt=class{constructor(e,i){this.scheduler=e,this.schedule=i,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}},Bst=class{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}};var ple,fle,mle,aW={exports:{}};aW.exports,ple=aW,fle=function(){function t(P,I,V){V=V||2;var q,Y,J,ee,me,Me,yt,St=I&&I.length,ct=St?I[0]*V:P.length,vt=e(P,0,ct,V,!0),je=[];if(!vt||vt.next===vt.prev)return je;if(St&&(vt=l(P,I,vt,V)),P.length>80*V){q=J=P[0],Y=ee=P[1];for(var he=V;he<ct;he+=V)(me=P[he])<q&&(q=me),(Me=P[he+1])<Y&&(Y=Me),me>J&&(J=me),Me>ee&&(ee=Me);yt=(yt=Math.max(J-q,ee-Y))!==0?1/yt:0}return r(vt,je,V,q,Y,yt),je}function e(P,I,V,q,Y){var J,ee;if(Y===X(P,I,V,q)>0)for(J=I;J<V;J+=q)ee=z(J,P[J],P[J+1],ee);else for(J=V-q;J>=I;J-=q)ee=z(J,P[J],P[J+1],ee);if(ee&&C(ee,ee.next)){var me=ee.next;j(ee),ee=me}return ee}function i(P,I){if(!P)return P;I||(I=P);var V,q=P;do if(V=!1,q.steiner||!C(q,q.next)&&S(q.prev,q,q.next)!==0)q=q.next;else{var Y=q.prev;if(j(q),(q=I=Y)===q.next)break;V=!0}while(V||q!==I);return I}function r(P,I,V,q,Y,J,ee){if(P){!ee&&J&&y(P,q,Y,J);for(var me,Me,yt=P;P.prev!==P.next;)if(me=P.prev,Me=P.next,J?s(P,q,Y,J):n(P))I.push(me.i/V),I.push(P.i/V),I.push(Me.i/V),j(P),P=Me.next,yt=Me.next;else if((P=Me)===yt){ee?ee===1?r(P=o(i(P),I,V),I,V,q,Y,J,2):ee===2&&a(P,I,V,q,Y,J):r(i(P),I,V,q,Y,J,1);break}}}function n(P){var I=P.prev,V=P,q=P.next;if(S(I,V,q)>=0)return!1;for(var Y=P.next.next;Y!==P.prev;){if(x(I.x,I.y,V.x,V.y,q.x,q.y,Y.x,Y.y)&&S(Y.prev,Y,Y.next)>=0)return!1;Y=Y.next}return!0}function s(P,I,V,q){var Y=P.prev,J=P,ee=P.next;if(S(Y,J,ee)>=0)return!1;for(var me=Y.x<J.x?Y.x<ee.x?Y.x:ee.x:J.x<ee.x?J.x:ee.x,Me=Y.y<J.y?Y.y<ee.y?Y.y:ee.y:J.y<ee.y?J.y:ee.y,yt=Y.x>J.x?Y.x>ee.x?Y.x:ee.x:J.x>ee.x?J.x:ee.x,St=Y.y>J.y?Y.y>ee.y?Y.y:ee.y:J.y>ee.y?J.y:ee.y,ct=v(me,Me,I,V,q),vt=v(yt,St,I,V,q),je=P.prevZ,he=P.nextZ;je&&je.z>=ct&&he&&he.z<=vt;){if(je!==P.prev&&je!==P.next&&x(Y.x,Y.y,J.x,J.y,ee.x,ee.y,je.x,je.y)&&S(je.prev,je,je.next)>=0||(je=je.prevZ,he!==P.prev&&he!==P.next&&x(Y.x,Y.y,J.x,J.y,ee.x,ee.y,he.x,he.y)&&S(he.prev,he,he.next)>=0))return!1;he=he.nextZ}for(;je&&je.z>=ct;){if(je!==P.prev&&je!==P.next&&x(Y.x,Y.y,J.x,J.y,ee.x,ee.y,je.x,je.y)&&S(je.prev,je,je.next)>=0)return!1;je=je.prevZ}for(;he&&he.z<=vt;){if(he!==P.prev&&he!==P.next&&x(Y.x,Y.y,J.x,J.y,ee.x,ee.y,he.x,he.y)&&S(he.prev,he,he.next)>=0)return!1;he=he.nextZ}return!0}function o(P,I,V){var q=P;do{var Y=q.prev,J=q.next.next;!C(Y,J)&&A(Y,q,q.next,J)&&k(Y,J)&&k(J,Y)&&(I.push(Y.i/V),I.push(q.i/V),I.push(J.i/V),j(q),j(q.next),q=P=J),q=q.next}while(q!==P);return i(q)}function a(P,I,V,q,Y,J){var ee=P;do{for(var me=ee.next.next;me!==ee.prev;){if(ee.i!==me.i&&T(ee,me)){var Me=L(ee,me);return ee=i(ee,ee.next),Me=i(Me,Me.next),r(ee,I,V,q,Y,J),void r(Me,I,V,q,Y,J)}me=me.next}ee=ee.next}while(ee!==P)}function l(P,I,V,q){var Y,J,ee,me=[];for(Y=0,J=I.length;Y<J;Y++)(ee=e(P,I[Y]*q,Y<J-1?I[Y+1]*q:P.length,q,!1))===ee.next&&(ee.steiner=!0),me.push(w(ee));for(me.sort(c),Y=0;Y<me.length;Y++)V=i(V=d(me[Y],V),V.next);return V}function c(P,I){return P.x-I.x}function h(P){if(P.next.prev===P)return P;let I=P;for(;;){const V=I.next;if(V.prev===I||V===I||V===P)break;I=V}return I}function d(P,I){var V=f(P,I);if(!V)return I;var q=L(V,P),Y=i(V,V.next);let J=h(q);return i(J,J.next),Y=h(Y),h(I===V?Y:I)}function f(P,I){var V,q=I,Y=P.x,J=P.y,ee=-1/0;do{if(J<=q.y&&J>=q.next.y&&q.next.y!==q.y){var me=q.x+(J-q.y)*(q.next.x-q.x)/(q.next.y-q.y);if(me<=Y&&me>ee){if(ee=me,me===Y){if(J===q.y)return q;if(J===q.next.y)return q.next}V=q.x<q.next.x?q:q.next}}q=q.next}while(q!==I);if(!V)return null;if(Y===ee)return V;var Me,yt=V,St=V.x,ct=V.y,vt=1/0;q=V;do Y>=q.x&&q.x>=St&&Y!==q.x&&x(J<ct?Y:ee,J,St,ct,J<ct?ee:Y,J,q.x,q.y)&&(Me=Math.abs(J-q.y)/(Y-q.x),k(q,P)&&(Me<vt||Me===vt&&(q.x>V.x||q.x===V.x&&m(V,q)))&&(V=q,vt=Me)),q=q.next;while(q!==yt);return V}function m(P,I){return S(P.prev,P,I.prev)<0&&S(I.next,P,P.next)<0}function y(P,I,V,q){var Y=P;do Y.z===null&&(Y.z=v(Y.x,Y.y,I,V,q)),Y.prevZ=Y.prev,Y.nextZ=Y.next,Y=Y.next;while(Y!==P);Y.prevZ.nextZ=null,Y.prevZ=null,_(Y)}function _(P){var I,V,q,Y,J,ee,me,Me,yt=1;do{for(V=P,P=null,J=null,ee=0;V;){for(ee++,q=V,me=0,I=0;I<yt&&(me++,q=q.nextZ);I++);for(Me=yt;me>0||Me>0&&q;)me!==0&&(Me===0||!q||V.z<=q.z)?(Y=V,V=V.nextZ,me--):(Y=q,q=q.nextZ,Me--),J?J.nextZ=Y:P=Y,Y.prevZ=J,J=Y;V=q}J.nextZ=null,yt*=2}while(ee>1);return P}function v(P,I,V,q,Y){return(P=1431655765&((P=858993459&((P=252645135&((P=16711935&((P=32767*(P-V)*Y)|P<<8))|P<<4))|P<<2))|P<<1))|(I=1431655765&((I=858993459&((I=252645135&((I=16711935&((I=32767*(I-q)*Y)|I<<8))|I<<4))|I<<2))|I<<1))<<1}function w(P){var I=P,V=P;do(I.x<V.x||I.x===V.x&&I.y<V.y)&&(V=I),I=I.next;while(I!==P);return V}function x(P,I,V,q,Y,J,ee,me){return(Y-ee)*(I-me)-(P-ee)*(J-me)>=0&&(P-ee)*(q-me)-(V-ee)*(I-me)>=0&&(V-ee)*(J-me)-(Y-ee)*(q-me)>=0}function T(P,I){return P.next.i!==I.i&&P.prev.i!==I.i&&!N(P,I)&&(k(P,I)&&k(I,P)&&B(P,I)&&(S(P.prev,P,I.prev)||S(P,I.prev,I))||C(P,I)&&S(P.prev,P,P.next)>0&&S(I.prev,I,I.next)>0)}function S(P,I,V){return(I.y-P.y)*(V.x-I.x)-(I.x-P.x)*(V.y-I.y)}function C(P,I){return P.x===I.x&&P.y===I.y}function A(P,I,V,q){var Y=D(S(P,I,V)),J=D(S(P,I,q)),ee=D(S(V,q,P)),me=D(S(V,q,I));return Y!==J&&ee!==me||!(Y!==0||!R(P,V,I))||!(J!==0||!R(P,q,I))||!(ee!==0||!R(V,P,q))||!(me!==0||!R(V,I,q))}function R(P,I,V){return I.x<=Math.max(P.x,V.x)&&I.x>=Math.min(P.x,V.x)&&I.y<=Math.max(P.y,V.y)&&I.y>=Math.min(P.y,V.y)}function D(P){return P>0?1:P<0?-1:0}function N(P,I){var V=P;do{if(V.i!==P.i&&V.next.i!==P.i&&V.i!==I.i&&V.next.i!==I.i&&A(V,V.next,P,I))return!0;V=V.next}while(V!==P);return!1}function k(P,I){return S(P.prev,P,P.next)<0?S(P,I,P.next)>=0&&S(P,P.prev,I)>=0:S(P,I,P.prev)<0||S(P,P.next,I)<0}function B(P,I){var V=P,q=!1,Y=(P.x+I.x)/2,J=(P.y+I.y)/2;do V.y>J!=V.next.y>J&&V.next.y!==V.y&&Y<(V.next.x-V.x)*(J-V.y)/(V.next.y-V.y)+V.x&&(q=!q),V=V.next;while(V!==P);return q}function L(P,I){var V=new H(P.i,P.x,P.y),q=new H(I.i,I.x,I.y),Y=P.next,J=I.prev;return P.next=I,I.prev=P,V.next=Y,Y.prev=V,q.next=V,V.prev=q,J.next=q,q.prev=J,q}function z(P,I,V,q){var Y=new H(P,I,V);return q?(Y.next=q.next,Y.prev=q,q.next.prev=Y,q.next=Y):(Y.prev=Y,Y.next=Y),Y}function j(P){P.next.prev=P.prev,P.prev.next=P.next,P.prevZ&&(P.prevZ.nextZ=P.nextZ),P.nextZ&&(P.nextZ.prevZ=P.prevZ)}function H(P,I,V){this.i=P,this.x=I,this.y=V,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function X(P,I,V,q){for(var Y=0,J=I,ee=V-q;J<V;J+=q)Y+=(P[ee]-P[J])*(P[J+1]+P[ee+1]),ee=J;return Y}return t.deviation=function(P,I,V,q){var Y=I&&I.length,J=Y?I[0]*V:P.length,ee=Math.abs(X(P,0,J,V));if(Y)for(var me=0,Me=I.length;me<Me;me++){var yt=I[me]*V,St=me<Me-1?I[me+1]*V:P.length;ee-=Math.abs(X(P,yt,St,V))}var ct=0;for(me=0;me<q.length;me+=3){var vt=q[me]*V,je=q[me+1]*V,he=q[me+2]*V;ct+=Math.abs((P[vt]-P[he])*(P[je+1]-P[vt+1])-(P[vt]-P[je])*(P[he+1]-P[vt+1]))}return ee===0&&ct===0?0:Math.abs((ct-ee)/ee)},t.flatten=function(P){for(var I=P[0][0].length,V={vertices:[],holes:[],dimensions:I},q=0,Y=0;Y<P.length;Y++){for(var J=0;J<P[Y].length;J++)for(var ee=0;ee<I;ee++)V.vertices.push(P[Y][J][ee]);Y>0&&(q+=P[Y-1].length,V.holes.push(q))}return V},t},(mle=fle())!==void 0&&(ple.exports=mle);const uC=VM(aW.exports),t8=K.getLogger("esri.views.3d.support.buffer.math");function Vst(t,e,i){zp(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function zp(t,e,i,r=3,n=r){if(t.length/r!==Math.ceil(e.length/n))return t8.error("source and destination buffers need to have the same number of elements"),t;const s=t.length/r,o=i[0],a=i[1],l=i[2],c=i[4],h=i[5],d=i[6],f=i[8],m=i[9],y=i[10],_=i[12],v=i[13],w=i[14];let x=0,T=0;for(let S=0;S<s;S++){const C=e[x],A=e[x+1],R=e[x+2];t[T]=o*C+c*A+f*R+_,t[T+1]=a*C+h*A+m*R+v,t[T+2]=l*C+d*A+y*R+w,x+=n,T+=r}return t}function JCe(t,e,i){Bp(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function Bp(t,e,i,r=3,n=r){if(t.length/r!==Math.ceil(e.length/n))return void t8.error("source and destination buffers need to have the same number of elements");const s=t.length/r,o=i[0],a=i[1],l=i[2],c=i[3],h=i[4],d=i[5],f=i[6],m=i[7],y=i[8];let _=0,v=0;for(let w=0;w<s;w++){const x=e[_],T=e[_+1],S=e[_+2];t[v]=o*x+c*T+f*S,t[v+1]=a*x+h*T+m*S,t[v+2]=l*x+d*T+y*S,_+=n,v+=r}}function Gst(t,e,i){WF(t.typedBuffer,e,i,t.typedBufferStride)}function WF(t,e,i,r=3){const n=Math.min(t.length/r,e.count),s=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<n;c++)t[l]=i*s[a],t[l+1]=i*s[a+1],t[l+2]=i*s[a+2],a+=o,l+=r}function jst(t,e){i8(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function i8(t,e,i=3,r=i){const n=Math.min(t.length/i,e.length/r);let s=0,o=0;for(let a=0;a<n;a++){const l=e[s],c=e[s+1],h=e[s+2],d=l*l+c*c+h*h;if(d>0){const f=1/Math.sqrt(d);t[o]=f*l,t[o+1]=f*c,t[o+2]=f*h}s+=r,o+=i}}function Hst(t,e,i){const r=Math.min(t.count,e.count),n=t.typedBuffer,s=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;let l=0,c=0;for(let h=0;h<r;h++)n[c]=o[l]>>i,n[c+1]=o[l+1]>>i,n[c+2]=o[l+2]>>i,l+=a,c+=s}Object.freeze(Object.defineProperty({__proto__:null,normalize:i8,normalizeView:jst,scale:WF,scaleView:Gst,shiftRight:Hst,transformMat3:Bp,transformMat3View:JCe,transformMat4:zp,transformMat4View:Vst},Symbol.toStringTag,{value:"Module"}));function qst(t,e,i){return{objectId:t,target:e,distance:i,type:"vertex"}}function gle(t,e,i,r,n,s=!1){return{objectId:t,target:e,distance:i,type:"edge",start:r,end:n,draped:s}}var fy,Fo;function tv(t){return t&&t.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function DP(t){return t!=null&&!isNaN(t)&&isFinite(t)}function KCe(t){return t.valueExpression?fy.Expression:t.field&&typeof t.field=="string"?fy.Field:fy.Unknown}function Wst(t,e){const i=e||KCe(t),r=t.valueUnit||"unknown";return i===fy.Unknown?Fo.Constant:t.stops?Fo.Stops:t.minSize!=null&&t.maxSize!=null&&t.minDataValue!=null&&t.maxDataValue!=null?Fo.ClampedLinear:r==="unknown"?t.minSize!=null&&t.minDataValue!=null?t.minSize&&t.minDataValue?Fo.Proportional:Fo.Additive:Fo.Identity:Fo.RealWorldSize}(function(t){t.Unknown="unknown",t.Expression="expression",t.Field="field"})(fy||(fy={})),function(t){t.Unknown="unknown",t.Stops="stops",t.ClampedLinear="clamped-linear",t.Proportional="proportional",t.Additive="additive",t.Constant="constant",t.Identity="identity",t.RealWorldSize="real-world-size"}(Fo||(Fo={}));const Hv=K.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),yle=new vx,m4=Math.PI,QCe=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function eAe(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(y=>y.type==="color"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void Hv.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const n=typeof e=="number",s=n?null:e,o=s?.attributes;let a=n?e:null;const l=r.field,{ipData:c,hasExpression:h}=r.cache;let d=r.cache.compiledFunc;if(!l&&!h){const y=r.stops;return y&&y[0]&&y[0].color}if(typeof a!="number")if(h){if(i?.arcade==null)return void Hv.error("Use of arcade expressions requires an arcade context");const y={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},_=i.arcade.arcadeUtils,v=_.getViewInfo(y),w=_.createExecContext(s,v,i.timeZone);if(!d){const x=_.createSyntaxTree(r.valueExpression);d=_.createFunction(x),r.cache.compiledFunc=d}a=_.executeFunction(d,w)}else o&&(a=o[l]);const f=r.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||n||!isNaN(m)&&m!==0)){isNaN(m)||n||(a/=m);const y=GQ(a,c);if(y){const _=y[0],v=y[1],w=_===v?r.stops[_].color:Pe.blendColors(r.stops[_].color,r.stops[v].color,y[2],i?.color);return new Pe(w)}}}function tAe(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(y=>y.type==="opacity"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void Hv.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const n=typeof e=="number",s=n?null:e,o=s?.attributes;let a=n?e:null;const l=r.field,{ipData:c,hasExpression:h}=r.cache;let d=r.cache.compiledFunc;if(!l&&!h){const y=r.stops;return y&&y[0]&&y[0].opacity}if(typeof a!="number")if(h){if(i?.arcade==null)return void Hv.error("Use of arcade expressions requires an arcade context");const y={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},_=i.arcade.arcadeUtils,v=_.getViewInfo(y),w=_.createExecContext(s,v,i.timeZone);if(!d){const x=_.createSyntaxTree(r.valueExpression);d=_.createFunction(x),r.cache.compiledFunc=d}a=_.executeFunction(d,w)}else o&&(a=o[l]);const f=r.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||n||!isNaN(m)&&m!==0)){isNaN(m)||n||(a/=m);const y=GQ(a,c);if(y){const _=y[0],v=y[1];if(_===v)return r.stops[_].opacity;{const w=r.stops[_].opacity;return w+(r.stops[v].opacity-w)*y[2]}}}}function iAe(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(m=>m.type==="rotation"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void Hv.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const n=r.axis||"heading",s=n==="heading"&&r.rotationType==="arithmetic"?90:0,o=n==="heading"&&r.rotationType==="arithmetic"?-1:1,a=typeof e=="number"?null:e,l=a?.attributes,c=r.field,{hasExpression:h}=r.cache;let d=r.cache.compiledFunc,f=0;if(!c&&!h)return f;if(h){if(i?.arcade==null)return void Hv.error("Use of arcade expressions requires an arcade context");const m={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},y=i.arcade.arcadeUtils,_=y.getViewInfo(m),v=y.createExecContext(a,_,i.timeZone);if(!d){const w=y.createSyntaxTree(r.valueExpression);d=y.createFunction(w),r.cache.compiledFunc=d}f=y.executeFunction(d,v)}else l&&(f=l[c]||0);return f=typeof f!="number"||isNaN(f)?null:s+o*f,f}function Yst(t,e,i){const r=typeof e=="number",n=r?null:e,s=n?.attributes;let o=r?e:null;const{isScaleDriven:a}=t.cache;let l=t.cache.compiledFunc;if(a){const h=i?.scale,d=i?.view;o=h==null||d==="3d"?Xst(t):h}else if(!r)switch(t.inputValueType){case fy.Expression:{if(i?.arcade==null)return void Hv.error("Use of arcade expressions requires an arcade context");const h={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},d=i.arcade.arcadeUtils,f=d.getViewInfo(h),m=d.createExecContext(n,f,i.timeZone);if(!l){const y=d.createSyntaxTree(t.valueExpression);l=d.createFunction(y),t.cache.compiledFunc=l}o=d.executeFunction(l,m);break}case fy.Field:s&&(o=s[t.field]);break;case fy.Unknown:o=null}if(!DP(o))return null;if(r||!t.normalizationField)return o;const c=s?parseFloat(s[t.normalizationField]):null;return DP(c)&&c!==0?o/c:null}function Xst(t){let e=null,i=null;const r=t.stops;return r?(e=r[0].value,i=r[r.length-1].value):(e=t.minDataValue||0,i=t.maxDataValue||0),(e+i)/2}function r8(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(s=>s.type==="size"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void Hv.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const n=nAe(Yst(r,e,i),r,e,i,r.cache.ipData);return n==null||isNaN(n)?0:n}function Vc(t,e,i){return t==null?null:tv(t)?r8(t,e,i):DP(t)?t:null}function rAe(t,e,i){return DP(i)&&t>i?i:DP(e)&&t<e?e:t}function Zst(t,e,i,r){return t+((Vc(e.minSize,i,r)||e.minDataValue)??0)}function Jst(t,e,i){const r=t.stops;let n=r?.length&&r[0].size;return n==null&&(n=t.minSize),Vc(n,e,i)}function Kst(t,e,i,r){const n=(t-e.minDataValue)/(e.maxDataValue-e.minDataValue),s=Vc(e.minSize,i,r),o=Vc(e.maxSize,i,r),a=r?.shape;if(t<=e.minDataValue)return s;if(t>=e.maxDataValue)return o;if(s==null||o==null)return null;if(e.scaleBy==="area"&&a){const l=a==="circle",c=l?m4*(s/2)**2:s*s,h=c+n*((l?m4*(o/2)**2:o*o)-c);return l?2*Math.sqrt(h/m4):Math.sqrt(h)}return s+n*(o-s)}function Qst(t,e,i,r){const n=r?.shape,s=t/e.minDataValue,o=Vc(e.minSize,i,r),a=Vc(e.maxSize,i,r);let l=null;return l=n==="circle"?2*Math.sqrt(s*(o/2)**2):n==="square"||n==="diamond"||n==="image"?Math.sqrt(s*o**2):s*o,rAe(l,o,a)}function eot(t,e,i,r,n){const[s,o,a]=GQ(t,n);if(s===o)return Vc(e.stops?.[s].size,i,r);{const l=Vc(e.stops?.[s].size,i,r);return l+(Vc(e.stops?.[o].size,i,r)-l)*a}}function tot(t,e,i,r){const n=(r?.resolution??1)*nC[e.valueUnit],s=Vc(e.minSize,i,r),o=Vc(e.maxSize,i,r),{valueRepresentation:a}=e;let l=null;return l=a==="area"?2*Math.sqrt(t/m4)/n:a==="radius"||a==="distance"?2*t/n:t/n,rAe(l,s,o)}function nAe(t,e,i,r,n){switch(e.transformationType){case Fo.Additive:return Zst(t,e,i,r);case Fo.Constant:return Jst(e,i,r);case Fo.ClampedLinear:return Kst(t,e,i,r);case Fo.Proportional:return Qst(t,e,i,r);case Fo.Stops:return eot(t,e,i,r,n);case Fo.RealWorldSize:return tot(t,e,i,r);case Fo.Identity:return t;case Fo.Unknown:return null}}function iot(t,e,i){const{isScaleDriven:r}=t.cache;if(!(r&&i==="3d"||e))return null;const n={scale:e,view:i};let s=Vc(t.minSize,yle,n),o=Vc(t.maxSize,yle,n);if(s!=null||o!=null){if(s>o){const a=o;o=s,s=a}return{minSize:s,maxSize:o}}}function VQ(t,e,i){if(!t.visualVariables)return;const r=[],n=[],s=[],o=[],a=[];for(const l of t.visualVariables)switch(l.type){case"color":n.push(l);break;case"opacity":s.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return n.forEach(l=>{const c=eAe(l,e,i);r.push({variable:l,value:c})}),s.forEach(l=>{const c=tAe(l,e,i);r.push({variable:l,value:c})}),a.forEach(l=>{const c=iAe(l,e,i);r.push({variable:l,value:c})}),o.forEach(l=>{const c=r8(l,e,i);r.push({variable:l,value:c})}),r.filter(l=>l.value!=null)}function GQ(t,e){if(!e)return;let i=0,r=e.length-1;return e.some((n,s)=>t<n?(r=s,!0):(i=s,!1)),[i,r,(t-e[i])/(e[r]-e[i])]}function rot(t,e,i){const r=["proportional","proportional","proportional"];for(const n of t){const s=n.useSymbolValue?"symbol-value":r8(n,e,i);switch(n.axis){case"width":r[0]=s;break;case"depth":r[1]=s;break;case"height":r[2]=s;break;case"width-and-depth":r[0]=s,r[1]=s;break;case"all":case void 0:case null:r[0]=s,r[1]=s,r[2]=s;break;default:n.axis}}return r}const $kt=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:rot,getColor:eAe,getOpacity:tAe,getRotationAngle:iAe,getSize:r8,getSizeForValue:nAe,getSizeFromNumberOrVariable:Vc,getSizeRangeAtScale:iot,getVisualVariableValues:VQ,viewScaleRE:QCe},Symbol.toStringTag,{value:"Module"}));function n8(t,e){if(!t||t.symbol)return null;const i=e?.renderer;return t&&i!=null&&i.getObservationRenderer?i.getObservationRenderer(t):i}function not(t,e){if(t.symbol!=null)return t.symbol;const i=n8(t,e);return i!=null&&i.type!=="dot-density"?i.getSymbol(t,e):null}function Ikt(t,e){const i=n8(t,e),r=not(t,e);if(r==null)return null;const n={renderer:i,symbol:r};if(i==null||!("visualVariables"in i)||!i.visualVariables)return n;const s=VQ(i,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of s)switch(a.type){case"color":n.color=l.toRgba();break;case"size":if(a.target==="outline")n.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=h;break;case"depth":o[1]=h;break;case"height":o[2]=h;break;case"width-and-depth":o[0]=o[1]=h;break;default:o[0]=o[1]=o[2]=h}}break;case"opacity":n.opacity=l;break;case"rotation":switch(a.axis){case"tilt":n.tilt=l;break;case"roll":n.roll=l;break;default:n.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(n.size=o),n}async function sot(t,e){if(t.symbol!=null)return t.symbol;const i=n8(t,e);return i!=null?i.getSymbolAsync(t,e):null}async function Lkt(t,e){const i=n8(t,e),r=await sot(t,e);if(!r)return null;const n={renderer:i,symbol:r};if(!i||!("visualVariables"in i)||!i.visualVariables)return n;const s=VQ(i,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of s)if(a.type==="color")n.color=Pe.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")n.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=h:c==="depth"?o[1]=h:c==="height"?o[2]=h:o[0]=o[1]=c==="width-and-depth"?h:o[2]=h}else a.type==="opacity"?n.opacity=l:a.type==="rotation"&&a.axis==="tilt"?n.tilt=l:a.type==="rotation"&&a.axis==="roll"?n.roll=l:a.type==="rotation"&&(n.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(n.size=o),n}function oot(t,e=0){const i=t[e];return typeof i=="number"&&isFinite(i)?i:null}function aot(t){for(let e=0;e<3;e++){const i=t[e];if(typeof i=="number")return isFinite(i)?i:0}return 0}function lot(t,e,i,r){const n=(o=>!Array.isArray(o[0]))(e)?(o,a)=>e[3*o+a]:(o,a)=>e[o][a],s=r?Da(r)/M5(r):1;return IJ(t,(o,a)=>ae(o,n(a,0)*s,n(a,1)*s,n(a,2)),i)}function sAe(t,e,i){const r=lot(_le,t,e,i)?_le:[0,0,1];return Math.abs(r[2])>Math.cos(Dt(80))?an.Z:Math.abs(r[1])>Math.abs(r[0])?an.Y:an.X}const _le=Ii();function cot(t,e,i){const r=sAe(t,(e.length>0?e[0]:t.length/3)-1,i);if(r!==an.Z){t=t.slice();for(let n=0;n<t.length;n+=3)t[n+r]=t[n+2]}return uC(t,e,3)}function vle(t){const e=[[O.POSITION,new Ve(t.attributeData.position,t.indices,3,!0)]],i=r1(t.indices.length);return t.attributeData.colorFeature!=null?e.push([O.COLORFEATUREATTRIBUTE,new Ve([t.attributeData.colorFeature],i,1,!0)]):t.attributeData.color&&e.push([O.COLOR,new Ve(t.attributeData.color,i,4,!0)]),t.attributeData.uvMapSpace&&e.push([O.UVMAPSPACE,new Ve(t.attributeData.uvMapSpace,t.indices,4,!0)]),t.attributeData.boundingRect&&e.push([O.BOUNDINGRECT,new Ve(t.attributeData.boundingRect,t.indices,9,!0)]),new ms(t.material,e,t.mapPositions,wn.Mesh,t.attributeData.objectAndLayerIdColor)}function ble(t,e=null){const i=[[O.POSITION,new Ve(t.attributeData.position,t.indices,3,!0)],[O.UV0,new Ve(t.attributeData.uv0,t.indices,2,!0)]];return new ms(t.material,i,t.mapPositions,wn.Mesh,e)}function NP(t){switch(t.type){case"extent":if(t instanceof zi)return Cm.fromExtent(t);break;case"polygon":return t}return null}let s8=class{constructor(e,i,r){this.renderData=e,this.layerUid=i,this.graphicUid=r,this.outGeometries=new Array}};function lW(t,e,i){const r=Array.isArray(t),n=r?t.length/e:t.byteLength/(4*e),s=r?t:new Uint32Array(t,0,n*e),o=i?.minReduction??0,a=i?.originalIndices||null,l=a?a.length:0,c=i?.componentOffsets||null;let h=0;if(c)for(let A=0;A<c.length-1;A++){const R=c[A+1]-c[A];R>h&&(h=R)}else h=n;const d=Math.floor(1.1*h)+1;(sf==null||sf.length<2*d)&&(sf=new Uint32Array(Gye(2*d)));for(let A=0;A<2*d;A++)sf[A]=0;let f=0;const m=!!c&&!!a,y=m?l:n;let _=EF(n);const v=new Uint32Array(l),w=1.96;let x=o!==0?Math.ceil(4*w*w/(o*o)*o*(1-o)):y,T=1,S=c?c[1]:y;for(let A=0;A<y;A++){if(A===x){const L=1-f/A;if(L+w*Math.sqrt(L*(1-L)/A)<o)return null;x*=2}if(A===S){for(let L=0;L<2*d;L++)sf[L]=0;if(a)for(let L=c[T-1];L<c[T];L++)v[L]=_[a[L]];S=c[++T]}const R=m?a[A]:A,D=R*e,N=dot(s,D,e);let k=N%d,B=f;for(;sf[2*k+1]!==0;){if(sf[2*k]===N){const L=sf[2*k+1]-1;if(uot(s,D,L*e,e)){B=_[L];break}}k++,k>=d&&(k-=d)}B===f&&(sf[2*k]=N,sf[2*k+1]=R+1,f++),_[R]=B}if(o!==0&&1-f/n<o)return null;if(m){for(let A=c[T-1];A<v.length;A++)v[A]=_[a[A]];_=ym(v)}const C=r?new Array(f):new Uint32Array(f*e);f=0;for(let A=0;A<y;A++)_[A]===f&&(hot(s,(m?a[A]:A)*e,C,f*e,e),f++);if(a&&!m){const A=new Uint32Array(l);for(let R=0;R<A.length;R++)A[R]=_[a[R]];_=ym(A)}return{buffer:Array.isArray(C)?C:C.buffer,indices:_,uniqueCount:f}}function uot(t,e,i,r){for(let n=0;n<r;n++)if(t[e+n]!==t[i+n])return!1;return!0}function hot(t,e,i,r,n){for(let s=0;s<n;s++)i[r+s]=t[e+s]}function dot(t,e,i){let r=0;for(let n=0;n<i;n++)r=t[e+n]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let sf=null;function Nkt(t){const e=t$(t.rings,t.hasZ,Im.CCW_IS_HOLE,t.spatialReference),i=new Array;let r=0,n=0;for(const a of e.polygons){const l=a.count,c=a.index,h=Xh(e.position,3*c,3*l),d=a.holeIndices.map(m=>m-c),f=ym(uC(h,d,3));i.push({position:h,faces:f}),r+=h.length,n+=f.length}const s=pot(i,r,n),o=Array.isArray(s.position)?lW(s.position,3,{originalIndices:s.faces}):lW(s.position.buffer,6,{originalIndices:s.faces});return s.position=gSe(new Float64Array(o.buffer)),s.faces=o.indices,s}function pot(t,e,i){if(t.length===1)return t[0];const r=_o(e),n=new Array(i);let s=0,o=0,a=0;for(const l of t){for(let c=0;c<l.position.length;c++)r[s++]=l.position[c];for(const c of l.faces)n[o++]=c+a;a=s/3}return{position:r,faces:ym(n)}}function t$(t,e,i,r){const n=t.length,s=new Array(n),o=new Array(n),a=new Array(n);let l=0,c=0,h=0,d=0;for(let y=0;y<n;++y)d+=t[y].length;const f=_o(3*d);let m=0;for(let y=n-1;y>=0;y--){const _=t[y],v=i===Im.CCW_IS_HOLE&&fot(_,e,r);if(v&&n!==1)s[l++]=_;else{let w=_.length;for(let T=0;T<l;++T)w+=s[T].length;const x={index:m,pathLengths:new Array(l+1),count:w,holeIndices:new Array(l)};x.pathLengths[0]=_.length,_.length>0&&(a[h++]={index:m,count:_.length}),m=v?uL(_,_.length-1,-1,f,m,_.length,e):uL(_,0,1,f,m,_.length,e);for(let T=0;T<l;++T){const S=s[T];x.holeIndices[T]=m,x.pathLengths[T+1]=S.length,S.length>0&&(a[h++]={index:m,count:S.length}),m=uL(S,0,1,f,m,S.length,e)}l=0,x.count>0&&(o[c++]=x)}}for(let y=0;y<l;++y){const _=s[y];_.length>0&&(a[h++]={index:m,count:_.length}),m=uL(_,0,1,f,m,_.length,e)}return o.length=c,a.length=h,{position:f,polygons:o,outlines:a}}function uL(t,e,i,r,n,s,o){n*=3;for(let a=0;a<s;++a){const l=t[e];r[n++]=l[0],r[n++]=l[1],r[n++]=o?l[2]:0,e+=i}return n/3}function fot(t,e,i){if(e){const r=t.length-1,n=sAe(t,r,i);if(n===an.X)return!QD(t,an.Y,an.Z);if(n===an.Y)return!QD(t,an.X,an.Z)}return!QD(t,an.X,an.Y)}var Im;(function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(Im||(Im={}));var vR,YF,cW;(function(t){t[t.RasterImage=0]="RasterImage",t[t.Features=1]="Features"})(vR||(vR={})),function(t){t[t.MapLayer=0]="MapLayer",t[t.ViewLayer=1]="ViewLayer",t[t.Outline=2]="Outline",t[t.SnappingHint=3]="SnappingHint"}(YF||(YF={})),function(t){t[t.WithRasterImage=0]="WithRasterImage",t[t.WithoutRasterImage=1]="WithoutRasterImage"}(cW||(cW={}));var os,Vh,bR,Rs;(function(t){t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER"})(os||(os={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",t[t.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",t[t.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(Vh||(Vh={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(bR||(bR={})),function(t){t[t.FADING=0]="FADING",t[t.IMMEDIATE=1]="IMMEDIATE",t[t.UNFADED=2]="UNFADED"}(Rs||(Rs={}));let mot=class{constructor(e,i){this.vec3=e,this.id=i}};function XF(t,e,i,r){return new mot(Oe(t,e,i),r)}let wle=class{constructor(){this._extent=Zt(),this.resolution=0,this.renderLocalOrigin=XF(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new got}get extent(){return this._extent}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const i=.001*e.range;if(this._extent[0]-i<=e.min){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];B5(this._extent,e.range,0,r)}if(this._extent[2]+i>=e.max){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];B5(this._extent,-e.range,0,r)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,Sy(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const i=this.canvasGeometries.extents[e];if(i[0]!==i[2]&&i[1]!==i[3])return!0}return!1}},got=class{constructor(){this.extents=[Zt(),Zt(),Zt()],this.numViews=0}};var jr;(function(t){t[t.Color=0]="Color",t[t.ColorNoRasterImage=1]="ColorNoRasterImage",t[t.Highlight=2]="Highlight",t[t.WaterNormal=3]="WaterNormal",t[t.Occluded=4]="Occluded",t[t.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"})(jr||(jr={}));let yot=class{constructor(e,i){this._fbos=e,this._format=i}get valid(){return this._handle!=null}dispose(){this._handle=li(this._handle)}get texture(){return this._handle?.colorTexture}bind(e,i,r){this._handle&&this._handle.fbo.width===i&&this._handle.fbo.height===r||(this._handle?.release(),this._handle=this._fbos.acquire(this._format,i,r)),e.bindFramebuffer(this._handle?.fbo)}generateMipMap(){this._handle?.colorTexture?.descriptor?.hasMipmap&&this._handle?.colorTexture?.generateMipmap()}},zT=class{constructor(e,i,r,n=xi.RGBA_MIPMAP){this.output=i,this.content=r,this.fbo=new yot(e,n)}get valid(){return this.fbo.valid}},_ot=class{constructor(e){this.targets=[new zT(e,F.Color,jr.Color),new zT(e,F.Color,jr.ColorNoRasterImage),new zT(e,F.Highlight,jr.Highlight,xi.RGBA4),new zT(e,F.Normal,jr.WaterNormal),new zT(e,F.Color,jr.Occluded)],ie("enable-feature:objectAndLayerId-rendering")&&this.targets.push(new zT(e,F.ObjectAndLayerIdColor,jr.ObjectAndLayerIdColor))}getTexture(e){return this.targets[e]?.fbo.texture}dispose(){for(const e of this.targets)e.fbo.dispose()}computeValidity(){return this.targets.reduce((e,i,r)=>i.valid?e|=1<<r:e,0)}},jQ=class extends BEe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=E(),this.origin=this.slicePlaneLocalOrigin,this.modelTransformation=null}};var Dc;(function(t){t[t.Material=0]="Material",t[t.ShadowMap=1]="ShadowMap",t[t.Highlight=2]="Highlight"})(Dc||(Dc={}));let vot=class extends jQ{constructor(){super(...arguments),this.identifier=Dc.Material,this.output=F.Color,this.transparent=!1}},bot=class extends jQ{constructor(){super(...arguments),this.identifier=Dc.ShadowMap}},wot=class extends jQ{constructor(){super(...arguments),this.identifier=Dc.Highlight}};function xot(t){t.fragment.code.add(b`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function Tot(t){t.fragment.code.add(b`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function Sot(t,e){const i=t.fragment;i.include(od),i.uniforms.add(new Ki("nearFar",(r,n)=>n.camera.nearFar)),i.uniforms.add(new et("depthMap",(r,n)=>n.linearDepth?.colorTexture)),i.uniforms.add(new en("proj",(r,n)=>n.camera.projectionMatrix)),i.uniforms.add(new Re("invResolutionHeight",(r,n)=>1/n.camera.height)),i.uniforms.add(new en("reprojectionMatrix",(r,n)=>n.ssr.reprojectionMatrix)),i.code.add(b`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P = clamp(P + dP, vec2(0.0), vec2(0.999));
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}function oAe(t,e){t.include(hnt,e),t.include(yU),t.include(Tot),e.hasCloudsReflections&&t.include(yTe,e),e.hasScreenSpaceReflections&&t.include(Sot,e);const i=t.fragment;i.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),i.code.add(b`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),i.uniforms.add(new Re("lightingSpecularStrength",(r,n)=>n.lighting.mainLight.specularStrength),new Re("lightingEnvironmentStrength",(r,n)=>n.lighting.mainLight.environmentStrength)),i.code.add(b`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),e.hasCloudsReflections&&i.code.add(b`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),e.hasScreenSpaceReflections?(i.uniforms.add(new en("view",(r,n)=>n.camera.viewMatrix),new et("lastFrameColorTexture",(r,n)=>n.ssr.lastFrameColor?.colorTexture),new Re("fadeFactorSSR",(r,n)=>n.ssr.fadeFactor)),i.code.add(b`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):i.code.add(b`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),e.hasCloudsReflections?e.hasScreenSpaceReflections?i.code.add(b`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):i.code.add(b`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):i.code.add(b`return waterRenderedColor;
}`)}let ZF=class extends dn{constructor(e,i){super(e,"vec4",Oi.Draw,(r,n,s)=>r.setUniform4fv(e,i(n,s)))}};var cm;function Eot(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add(new ZF("overlayTexOffset",(n,s)=>Cot(n,s)),new ZF("overlayTexScale",(n,s)=>Aot(n,s))),r.constants.add("overlayOpacity","float",1),r.uniforms.add(new et("ovColorTex",(n,s)=>uW(n,s))),aAe(t,e)}function RA(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add(new xle("overlayTexOffset"),new xle("overlayTexScale")),r.uniforms.add(new Re("overlayOpacity",n=>n.overlayOpacity),new et("ovColorTex",(n,s)=>s.overlay?.getTexture(n.overlayContent))),aAe(t,e)}(function(t){t[t.Disabled=0]="Disabled",t[t.Enabled=1]="Enabled",t[t.EnabledWithWater=2]="EnabledWithWater",t[t.COUNT=3]="COUNT"})(cm||(cm={}));let xle=class extends dn{constructor(e){super(e,"vec4")}};function aAe(t,e){e.pbrMode!==ot.Water&&e.pbrMode!==ot.WaterOnIntegratedMesh&&e.pbrMode!==ot.TerrainWithWater||t.include(oAe,e);const{vertex:i,fragment:r}=t;t.varyings.add("vtcOverlay","vec4"),i.code.add(b`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),r.code.add(b`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),r.code.add(b`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),r.code.add(b`vec4 getOverlayColorTexel(vec4 texCoords) {
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y) * texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w) * texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),e.pbrMode!==ot.Water&&e.pbrMode!==ot.WaterOnIntegratedMesh&&e.pbrMode!==ot.TerrainWithWater||(jy(r),Gm(r),r.code.add(b`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function uW(t,e){return t.identifier===Dc.Material&&t.output===F.Color?e.overlay?.getTexture(jr.ColorNoRasterImage):t.identifier===Dc.Material&&t.output===F.ObjectAndLayerIdColor?e.overlay?.getTexture(jr.ObjectAndLayerIdColor):t.identifier===Dc.Highlight?e.overlay?.getTexture(jr.Highlight):null}function Cot(t,e){const i=e.overlay?.overlays[os.INNER]?.extent;z5(i)&&(tm[0]=t.toMapSpace[0]/Oa(i)-i[0]/Oa(i),tm[1]=t.toMapSpace[1]/Wl(i)-i[1]/Wl(i));const r=e.overlay?.overlays[os.OUTER]?.extent;return z5(r)&&(tm[2]=t.toMapSpace[0]/Oa(r)-r[0]/Oa(r),tm[3]=t.toMapSpace[1]/Wl(r)-r[1]/Wl(r)),tm}function Aot(t,e){const i=e.overlay?.overlays[os.INNER]?.extent;z5(i)&&(tm[0]=t.toMapSpace[2]/Oa(i),tm[1]=t.toMapSpace[3]/Wl(i));const r=e.overlay?.overlays[os.OUTER]?.extent;return z5(r)&&(tm[2]=t.toMapSpace[2]/Oa(r),tm[3]=t.toMapSpace[3]/Wl(r)),tm}const tm=oi();let lAe=class extends or{constructor(){super(...arguments),this.color=Ft(1,1,1,1)}};function Oot(){const t=new Ei;return t.include(Na),t.fragment.uniforms.add(new et("tex",e=>e.texture),new yi("uColor",e=>e.color)),t.fragment.code.add(b`void main() {
vec4 texColor = texture(tex, uv);
fragColor = texColor * uColor;
}`),t}const Rot=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:lAe,build:Oot},Symbol.toStringTag,{value:"Module"}));let cAe=class{constructor(e){this._context=e,this._perConstructorInstances=new BC,this._frameCounter=0,this._keepAliveFrameCount=Tle}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(e=>e.forEach(i=>i.technique.destroy())),this._perConstructorInstances.clear()}acquire(e,i=Mot){const r=i.key;let n=this._perConstructorInstances.get(e,r);if(n==null){const s=new e(this._context,i,()=>this.release(s));n=new Pot(s),this._perConstructorInstances.set(e,r,n)}return++n.refCount,n.technique}releaseAndAcquire(e,i,r){if(r!=null){if(i.key===r.key)return r;this.release(r)}return this.acquire(e,i)}release(e){if(e==null||this._perConstructorInstances.empty)return;const i=this._perConstructorInstances.get(e.constructor,e.key);i!=null&&(--i.refCount,i.refCount===0&&(i.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==Tle&&this._perConstructorInstances.forEach((e,i)=>{e.forEach((r,n)=>{r.refCount===0&&r.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(r.technique.destroy(),this._perConstructorInstances.delete(i,n))})})}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach((i,r)=>{const n=async(s,o)=>{const a=o.shader;a&&(await a.reload(),s.forEach(l=>l.technique.reload(this._context)))};e.push(n(i,r))}),await Promise.all(e)}},Pot=class{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}};const Tle=-1,Mot=new tc;let uAe=class{constructor(e,i,r,n){this._textureRepository=e,this._techniqueRepository=i,this.materialChanged=r,this.requestRender=n,this._id2glMaterialRef=new BC}dispose(){this._textureRepository.destroy()}acquire(e,i,r){if(this._ownMaterial(e),!e.produces(i,r))return null;let n=this._id2glMaterialRef.get(r,e.id);if(n==null){const s=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRepository:this._textureRepository,output:r});n=new $ot(s),this._id2glMaterialRef.set(r,e.id,n)}return n.ref(),n.glMaterial}release(e,i){const r=this._id2glMaterialRef.get(i,e.id);r!=null&&(r.unref(),r.referenced||(rt(r.glMaterial),this._id2glMaterialRef.delete(i,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&K.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},$ot=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,tt(this._refCnt>=0)}get referenced(){return this._refCnt>0}};const Iot=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","transformationChanged","shaderTransformationChanged","visibilityChanged","occlusionChanged","highlightChanged","geometryAdded","geometryRemoved","attributesChanged"];let hW=class g4{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,i){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new ao,this._objectCount=0,i&&(i.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=i.maximumObjectsPerNode),i.maximumDepth!==void 0&&(this._maximumDepth=i.maximumDepth))}destroy(){this._degenerateObjects.clear(),ao.clearPool(),dW[0]=null,M1.prune(),Fb.prune()}add(e,i=e.length){this._objectCount+=i,this._grow(e,i);const r=ao.acquire();for(let n=0;n<i;n++){const s=e[n];this._isDegenerate(s)?this._degenerateObjects.add(s):(r.init(this._root),this._add(s,r))}ao.release(r)}remove(e,i=null){this._objectCount-=e.length;const r=ao.acquire();for(const n of e){const s=i??qE(this.objectToBoundingSphere(n),kot);aO(s[3])?(r.init(this._root),this._remove(n,s,r)):this._degenerateObjects.delete(n)}ao.release(r),this._shrink()}update(e,i){if(!aO(i[3])&&this._isDegenerate(e))return;const r=Fot(e);this.remove(r,i),this.add(r)}forEachAlongRay(e,i,r){const n=th(e,i);this._forEachNode(this._root,s=>{if(!this._intersectsNode(n,s))return!1;const o=s.node;return o.terminals.forAll(a=>{this._intersectsObject(n,a)&&r(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(n,a)&&r(a)}),!0})}forEachAlongRayWithVerticalOffset(e,i,r,n){const s=th(e,i);this._forEachNode(this._root,o=>{if(!this._intersectsNodeWithOffset(s,o,n))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(s,l,n)&&r(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(s,l,n)&&r(l)}),!0})}forEach(e){this._forEachNode(this._root,i=>{const r=i.node;return r.terminals.forAll(e),r.residents!==null&&r.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,i,r,n=()=>!0,s=1/0){let o=1/0,a=1/0,l=null;const c=B9(e,i),h=d=>{if(--s,!n(d))return;const f=this.objectToBoundingSphere(d);if(!Q_(r,f))return;const m=$_(e,i,f),y=m-f[3],_=m+f[3];y<o&&(o=y,a=_,l=d)};return this._forEachNodeDepthOrdered(this._root,d=>{if(s<=0||!Q_(r,d.bounds)||(re(dh,c,d.halfSize),ue(dh,dh,d.bounds),$_(e,i,dh)>a))return!1;const f=d.node;return f.terminals.forAll(m=>h(m)),f.residents!==null&&f.residents.forAll(m=>h(m)),!0},e,i),l}forEachInDepthRange(e,i,r,n,s,o,a){let l=-1/0,c=1/0;const h={setRange:_=>{r===g4.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,_.near),c=Math.min(c,_.far)):(l=Math.max(l,-_.far),c=Math.min(c,-_.near))}};h.setRange(n);const d=$_(i,r,e),f=B9(i,r),m=B9(i,-r),y=_=>{if(!a(_))return;const v=this.objectToBoundingSphere(_),w=v,x=$_(i,r,w)-d,T=x-v[3],S=x+v[3];T>c||S<l||!Q_(o,v)||s(_,h)};this._forEachNodeDepthOrdered(this._root,_=>{if(!Q_(o,_.bounds)||(re(dh,f,_.halfSize),ue(dh,dh,_.bounds),$_(i,r,dh)-d>c)||(re(dh,m,_.halfSize),ue(dh,dh,_.bounds),$_(i,r,dh)-d<l))return!1;const v=_.node;return v.terminals.forAll(w=>y(w)),v.residents!==null&&v.residents.forAll(w=>y(w)),!0},i,r)}forEachNode(e){this._forEachNode(this._root,i=>e(i.node,i.bounds,i.halfSize,i.depth))}forEachNeighbor(e,i){const r=ly(i),n=i,s=l=>{const c=this.objectToBoundingSphere(l),h=ly(c),d=r+h;return!(qs(c,n)-d*d<=0)||e(l)};let o=!0;const a=l=>{o&&(o=s(l))};this._forEachNode(this._root,l=>{const c=ly(l.bounds),h=r+c;if(qs(l.bounds,n)-h*h>0)return!1;const d=l.node;return d.terminals.forAll(a),o&&d.residents!==null&&d.residents.forAll(a),o}),o&&this.forEachDegenerateObject(a)}_intersectsNode(e,i){return hL(i.bounds,2*-i.halfSize,Cu),hL(i.bounds,2*i.halfSize,Au),$se(e.origin,e.direction,Cu,Au)}_intersectsNodeWithOffset(e,i,r){return hL(i.bounds,2*-i.halfSize,Cu),hL(i.bounds,2*i.halfSize,Au),r.applyToMinMax(Cu,Au),$se(e.origin,e.direction,Cu,Au)}_intersectsObject(e,i){const r=this.objectToBoundingSphere(i);return!(r[3]>0)||Qj(r,e)}_intersectsObjectWithOffset(e,i,r){const n=this.objectToBoundingSphere(i);return!(n[3]>0)||Qj(r.applyToBoundingSphere(n),e)}_forEachNode(e,i){let r=ao.acquire().init(e);const n=[r];for(;n.length!==0;){if(r=n.pop(),i(r)&&!r.isLeaf())for(let s=0;s<r.node.children.length;s++)r.node.children[s]&&n.push(ao.acquire().init(r).advance(s));ao.release(r)}}_forEachNodeDepthOrdered(e,i,r,n=g4.DepthOrder.FRONT_TO_BACK){let s=ao.acquire().init(e);const o=[s];for(Not(r,n,Cle);o.length!==0;){if(s=o.pop(),i(s)&&!s.isLeaf())for(let a=7;a>=0;--a){const l=Cle[a];s.node.children[l]&&o.push(ao.acquire().init(s).advance(l))}ao.release(s)}}_remove(e,i,r){M1.clear();const n=r.advanceTo(i,(s,o)=>{M1.push(s.node),M1.push(o)})?r.node.terminals:r.node.residents;if(n.removeUnordered(e),n.length===0)for(let s=M1.length-2;s>=0;s-=2){const o=M1.data[s],a=M1.data[s+1];if(!this._purge(o,a))break}}_nodeIsEmpty(e){if(e.terminals.length!==0)return!1;if(e.residents!==null)return e.residents.length===0;for(let i=0;i<e.children.length;i++)if(e.children[i])return!1;return!0}_purge(e,i){return i>=0&&(e.children[i]=null),!!this._nodeIsEmpty(e)&&(e.residents===null&&(e.residents=new Ut({shrink:!0})),!0)}_add(e,i){i.advanceTo(this.objectToBoundingSphere(e))?i.node.terminals.push(e):(i.node.residents.push(e),i.node.residents.length>this._maximumObjectsPerNode&&i.depth<this._maximumDepth&&this._split(i))}_split(e){const i=e.node.residents;e.node.residents=null;for(let r=0;r<i.length;r++){const n=ao.acquire().init(e);this._add(i.at(r),n),ao.release(n)}}_grow(e,i){if(i!==0&&(Sle(e,i,r=>this.objectToBoundingSphere(r),ng),aO(ng[3])&&!this._fitsInsideTree(ng)))if(this._nodeIsEmpty(this._root.node))qE(ng,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const r=this._rootBoundsForRootAsSubNode(ng);this._placingRootViolatesMaxDepth(r)?this._rebuildTree(ng,r):this._growRootAsSubNode(r),ao.release(r)}}_rebuildTree(e,i){oe(G9,i.bounds),G9[3]=i.halfSize,Sle([e,G9],2,n=>n,j9);const r=ao.acquire().init(this._root);this._root.initFrom(null,j9,j9[3]),this._root.increaseHalfSize(1.25),this._forEachNode(r,n=>(this.add(n.node.terminals.data,n.node.terminals.length),n.node.residents!==null&&this.add(n.node.residents.data,n.node.residents.length),!0)),ao.release(r)}_placingRootViolatesMaxDepth(e){const i=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let r=0;return this._forEachNode(this._root,n=>(r=Math.max(r,n.depth),r+i<=this._maximumDepth)),r+i>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const i=e[3],r=e;let n=-1/0;const s=this._root.bounds,o=this._root.halfSize;for(let l=0;l<3;l++){const c=s[l]-o-(r[l]-i),h=r[l]+i-(s[l]+o),d=Math.max(0,Math.ceil(c/(2*o))),f=Math.max(0,Math.ceil(h/(2*o)))+1,m=2**Math.ceil(Math.log(d+f)*Math.LOG2E);n=Math.max(n,m),dL[l].min=d,dL[l].max=f}for(let l=0;l<3;l++){let c=dL[l].min,h=dL[l].max;const d=(n-(c+h))/2;c+=Math.ceil(d),h+=Math.floor(d);const f=s[l]-o-c*o*2;V9[l]=f+(h+c)*o}const a=n*o;return V9[3]=a*dAe,ao.acquire().initFrom(null,V9,a,0)}_growRootAsSubNode(e){const i=this._root.node;oe(ng,this._root.bounds),ng[3]=this._root.halfSize,this._root.init(e),e.advanceTo(ng,null,!0),e.node.children=i.children,e.node.residents=i.residents,e.node.terminals=i.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(e===-1)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let e=null;const i=this._root.node.children;let r=0,n=0;for(;n<i.length&&e==null;)r=n++,e=i[r];for(;n<i.length;)if(i[n++])return-1;return r}_isDegenerate(e){return!aO(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const i=this._root.bounds,r=this._root.halfSize;return e[3]<=r&&e[0]>=i[0]-r&&e[0]<=i[0]+r&&e[1]>=i[1]-r&&e[1]<=i[1]+r&&e[2]>=i[2]-r&&e[2]<=i[2]+r}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:i,_objectCount:r}=this,n=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:i,objectCount:r,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:n}}}_nodeToJSON(e){const i=e.children.map(s=>s?this._nodeToJSON(s):null),r=e.residents?.map(s=>this.objectToBoundingSphere(s)),n=e.terminals?.map(s=>this.objectToBoundingSphere(s));return{children:i,residents:r,terminals:n}}static fromJSON(e){const i=new g4(r=>r,{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return i._objectCount=e.objectCount,i._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),i}},ao=class YS{constructor(){this.bounds=kn(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,i,r,n=this.depth){return this.node=e??YS.createEmptyNode(),i!=null&&qE(i,this.bounds),this.halfSize=r,this.depth=n,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*dAe}advance(e){let i=this.node.children[e];i||(i=YS.createEmptyNode(),this.node.children[e]=i),this.node=i,this.halfSize/=2,this.depth++;const r=hAe[e];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,i,r=!1){for(;;){if(this.isTerminalFor(e))return i&&i(this,-1),!0;if(this.isLeaf()){if(!r)return i&&i(this,-1),!1;this.node.residents=null}const n=this._childIndex(e);i&&i(this,n),this.advance(n)}}isLeaf(){return this.node.residents!=null}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const i=this.bounds;return(i[0]<e[0]?1:0)+(i[1]<e[1]?2:0)+(i[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new Ut({shrink:!0}),residents:new Ut({shrink:!0})}}static acquire(){return YS._pool.acquire()}static release(e){YS._pool.release(e)}static clearPool(){YS._pool.prune()}};function Lot(t,e){t[0]=Math.min(t[0],e[0]-e[3]),t[1]=Math.min(t[1],e[1]-e[3]),t[2]=Math.min(t[2],e[2]-e[3])}function Dot(t,e){t[0]=Math.max(t[0],e[0]+e[3]),t[1]=Math.max(t[1],e[1]+e[3]),t[2]=Math.max(t[2],e[2]+e[3])}function hL(t,e,i){i[0]=t[0]+e,i[1]=t[1]+e,i[2]=t[2]+e}function Sle(t,e,i,r){if(e===1){const n=i(t[0]);qE(n,r)}else{Cu[0]=1/0,Cu[1]=1/0,Cu[2]=1/0,Au[0]=-1/0,Au[1]=-1/0,Au[2]=-1/0;for(let n=0;n<e;n++){const s=i(t[n]);aO(s[3])&&(Lot(Cu,s),Dot(Au,s))}Xi(r,Cu,Au,.5),r[3]=Math.max(Au[0]-Cu[0],Au[1]-Cu[1],Au[2]-Cu[2])/2}}function Not(t,e,i){if(!Fb.length)for(let r=0;r<8;++r)Fb.push({index:0,distance:0});for(let r=0;r<8;++r){const n=hAe[r];Fb.data[r].index=r,Fb.data[r].distance=$_(t,e,n)}Fb.sort((r,n)=>r.distance-n.distance);for(let r=0;r<8;++r)i[r]=Fb.data[r].index}function B9(t,e){let i,r=1/0;for(let n=0;n<8;++n){const s=$_(t,e,Ele[n]);s<r&&(r=s,i=Ele[n])}return i}function $_(t,e,i){return e*(t[0]*i[0]+t[1]*i[1]+t[2]*i[2])}function aO(t){return!isNaN(t)&&t!==-1/0&&t!==1/0&&t>0}ao._pool=new $a(ao),function(t){var e;(e=t.DepthOrder||(t.DepthOrder={}))[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(hW||(hW={}));const hAe=[Oe(-1,-1,-1),Oe(1,-1,-1),Oe(-1,1,-1),Oe(1,1,-1),Oe(-1,-1,1),Oe(1,-1,1),Oe(-1,1,1),Oe(1,1,1)],Ele=[Oe(-1,-1,-1),Oe(-1,-1,1),Oe(-1,1,-1),Oe(-1,1,1),Oe(1,-1,-1),Oe(1,-1,1),Oe(1,1,-1),Oe(1,1,1)],dAe=Math.sqrt(3),dW=[null];function Fot(t){return dW[0]=t,dW}const V9=kn(),dh=E(),Cu=E(),Au=E(),M1=new Ut,kot=kn(),ng=kn(),G9=kn(),j9=kn(),dL=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],Fb=new Ut,Cle=[0,0,0,0,0,0,0,0],wp=hW;var dv;(function(t){t[t.ASYNC=0]="ASYNC",t[t.SYNC=1]="SYNC"})(dv||(dv={}));let pAe=class extends BM{get objects(){return this._objects}constructor(e,i,r=""){super(),this.stage=e,this.apiLayerUid=r,this.type=wn.Layer,this.events=new Sn,this.visible=!0,this.pickable=!0,this.sliceable=!1,this._objects=new Ut,this._objectsAdded=new Ut,this._handles=new Ny,this.apiLayerUid=r,this.visible=i?.visible??!0,this.pickable=i?.pickable??!0,this.updatePolicy=i?.updatePolicy??dv.ASYNC,this._disableOctree=i?.disableOctree??!1,e.add(this);for(const n of Iot)this._handles.add(this.events.on(n,s=>e.handleEvent(n,s)))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),this._octree!=null&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),this._octree!=null&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const i of e)i.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),this._octree!=null&&this._objectsAdded.pushArray(e)}removeMany(e){const i=new Array;if(this._objects.removeUnorderedMany(e,e.length,i),i.length!==0){for(const r of i)r.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:i}),this._octree!=null){for(let r=0;r<i.length;)this._objectsAdded.removeUnordered(i[r])?(i[r]=i[i.length-1],i.length-=1):++r;this._octree.remove(i)}}}sync(){this.updatePolicy!==dv.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,i){this._octree==null||this._objectsAdded.includes(e)||this._octree.update(e,i)}getSpatialQueryAccelerator(){return this._octree==null&&this._objects.length>50&&!this._disableOctree?(this._octree=new wp(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):this._octree!=null&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}invalidateSpatialQueryAccelerator(){this._octree=$e(this._octree),this._objectsAdded.clear()}};function JF(t){return t!=null&&t.type===wn.Layer}var Zu,Px;(function(t){t[t.Draped=0]="Draped",t[t.Screen=1]="Screen",t[t.World=2]="World",t[t.COUNT=3]="COUNT"})(Zu||(Zu={})),function(t){t[t.Center=0]="Center",t[t.Tip=1]="Tip",t[t.COUNT=2]="COUNT"}(Px||(Px={}));let io=class extends fl{constructor(){super(...arguments),this.output=F.Color,this.transparencyPassType=it.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=Zu.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=Px.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}get draped(){return this.space===Zu.Draped}};u([U({count:F.COUNT})],io.prototype,"output",void 0),u([U({count:it.COUNT})],io.prototype,"transparencyPassType",void 0),u([U()],io.prototype,"occluder",void 0),u([U()],io.prototype,"hasSlicePlane",void 0),u([U()],io.prototype,"writeDepth",void 0),u([U({count:Zu.COUNT})],io.prototype,"space",void 0),u([U()],io.prototype,"hideOnShortSegments",void 0),u([U()],io.prototype,"hasCap",void 0),u([U({count:Px.COUNT})],io.prototype,"anchor",void 0),u([U()],io.prototype,"hasTip",void 0),u([U()],io.prototype,"vvSize",void 0),u([U()],io.prototype,"vvColor",void 0),u([U()],io.prototype,"vvOpacity",void 0),u([U()],io.prototype,"hasOccludees",void 0),u([U()],io.prototype,"multipassEnabled",void 0),u([U()],io.prototype,"cullAboveGround",void 0),u([U({constValue:!1})],io.prototype,"occlusionPass",void 0),u([U({constValue:!0})],io.prototype,"hasVvInstancing",void 0),u([U({constValue:!0})],io.prototype,"hasSliceTranslatedView",void 0);const Ale=8;function fAe(t,e){const i=t.vertex;i.uniforms.add(new Re("intrinsicWidth",r=>r.width)),e.vvSize?(t.attributes.add(O.SIZEFEATUREATTRIBUTE,"float"),i.uniforms.add(new kt("vvSizeMinSize",r=>r.vvSize.minSize),new kt("vvSizeMaxSize",r=>r.vvSize.maxSize),new kt("vvSizeOffset",r=>r.vvSize.offset),new kt("vvSizeFactor",r=>r.vvSize.factor)),i.code.add(b`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(t.attributes.add(O.SIZE,"float"),i.code.add(b`float getSize(){
return intrinsicWidth * size;
}`)),e.vvOpacity?(t.attributes.add(O.OPACITYFEATUREATTRIBUTE,"float"),i.constants.add("vvOpacityNumber","int",8),i.uniforms.add(new jl("vvOpacityValues",r=>r.vvOpacity.values,Ale),new jl("vvOpacityOpacities",r=>r.vvOpacity.opacityValues,Ale)),i.code.add(b`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):i.code.add(b`vec4 applyOpacity( vec4 color ){
return color;
}`),e.vvColor?(t.include(dy,e),t.attributes.add(O.COLORFEATUREATTRIBUTE,"float"),i.code.add(b`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(t.attributes.add(O.COLOR,"vec4"),i.code.add(b`vec4 getColor(){
return applyOpacity(color);
}`))}function FP(t,e,i=0){const r=_e(t,0,Bot);for(let n=0;n<4;n++)e[i+n]=Math.floor(256*Vot(r*Uot[n]))}function HQ(t,e=0){let i=0;for(let r=0;r<4;r++)i+=t[e+r]*zot[r];return i}const Uot=[1,256,65536,16777216],zot=[1/256,1/65536,1/16777216,1/4294967296],Bot=HQ(new Uint8ClampedArray([255,255,255,255]));function Vot(t){return t-Math.floor(t)}let mAe=class{constructor(e,i,r){this._createTexture=e,this._parametersKey=i,this._repository=new Map,this._orphanCache=r.newCache(`procedural-texture-repository:${zu()}`,n=>n.dispose())}destroy(){for(const[e,{texture:i}]of this._repository)i.dispose();this._repository.clear(),this._orphanCache.destroy()}swap(e,i=null){const r=this._acquire(e);return this.release(i),r}release(e){if(e==null)return;const i=this._parametersKey(e),r=this._repository.get(i);if(r&&(r.refCount--,r.refCount===0)){this._repository.delete(i);const{texture:n}=r,s=n.gpuMemoryUsage;this._orphanCache.put(i,n,s)}}_acquire(e){if(e==null)return null;const i=this._parametersKey(e),r=this._repository.get(i);if(r)return r.refCount++,r.texture;const n=this._orphanCache.pop(i)??this._createTexture(e),s=new Got(n);return this._repository.set(i,s),n}},Got=class{constructor(e){this.texture=e,this.refCount=1}};function jot(t,e){return new mAe(i=>{const{encodedData:r,textureSize:n}=Hot(i),s=new Hi;return s.internalFormat=gt.RGBA,s.width=n,s.height=1,s.wrapMode=Vt.REPEAT,new Nt(t,s,r)},i=>`${i.pattern.join(",")}-r${i.pixelRatio}`,e)}function Hot(t){const e=qQ(t),i=1/t.pixelRatio,r=gAe(t),n=yAe(t),s=(Math.floor(.5*(n-1))+.5)*i,o=[];let a=1;for(const f of e){for(let m=0;m<f;m++){const y=a*(Math.min(m,f-1-m)+.5)*i/s*.5+.5;o.push(y)}a=-a}const l=Math.round(e[0]/2),c=[...o.slice(l),...o.slice(0,l)],h=new Uint8Array(4*r);let d=0;for(const f of c)FP(f,h,d),d+=4;return{encodedData:h,textureSize:r}}function qQ(t){return t.pattern.map(e=>Math.round(e*t.pixelRatio))}function gAe(t){if(t==null)return 1;const e=qQ(t);return Math.floor(e.reduce((i,r)=>i+r))}function yAe(t){return qQ(t).reduce((e,i)=>Math.max(e,i))}function qot(t){return t==null?Wu:t.length===4?t:Gr(Wot,t[0],t[1],t[2],1)}const Wot=oi();function Yot(t,e){t.constants.add("stippleAlphaColorDiscard","float",.001),t.constants.add("stippleAlphaHighlightDiscard","float",.5),e.stippleEnabled?Xot(t,e):Zot(t)}function Xot(t,e){const i=!(e.draped&&e.stipplePreferContinuous),{vertex:r,fragment:n}=t;n.include(dd),e.draped||(Np(r,e),r.uniforms.add(new Re("worldToScreenPerDistanceRatio",(s,o)=>1/o.camera.perScreenPixelRatio)),r.code.add(b`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),t.varyings.add("vStippleDistance","float"),t.varyings.add("vStippleDistanceLimits","vec2"),t.varyings.add("vStipplePatternStretch","float"),r.code.add(b`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${Kot};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),r.code.add(b`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),r.code.add(b`
    if (segmentLengthPseudoScreen >= ${i?"patternLength":"1e4"}) {
  `),FC(r),r.code.add(b`float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
float segmentLengthScreenRounded = flooredRepetitions * patternLength;
float stretch = repetitions / flooredRepetitions;
vStipplePatternStretch = max(0.75, stretch);
return vec2(0.0, segmentLengthScreenRounded);
}
return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
}`),n.uniforms.add(new et("stipplePatternTexture",s=>s.stippleTexture),new Re("stipplePatternSDFNormalizer",s=>Jot(s.stipplePattern)),new Re("stipplePatternPixelSizeInv",s=>1/_Ae(s))),n.code.add(b`float getStippleSDF(out bool isClamped) {
float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;
float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv * vLineSizeInv;
u = fract(u);
float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;
return (sdf - 0.5) * vStipplePatternStretch + 0.5;
}
float getStippleSDF() {
bool ignored;
return getStippleSDF(ignored);
}
float getStippleAlpha() {
bool isClamped;
float stippleSDF = getStippleSDF(isClamped);
float antiAliasedResult = clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);
return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
}`),e.stippleOffColorEnabled?(n.uniforms.add(new yi("stippleOffColor",s=>qot(s.stippleOffColor))),n.code.add(b`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):n.code.add(b`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function Zot(t){t.fragment.code.add(b`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}function Jot(t){return t?(Math.floor(.5*(yAe(t)-1))+.5)/t.pixelRatio:1}function _Ae(t){const e=t.stipplePattern;return e?gAe(t.stipplePattern)/e.pixelRatio:1}const Kot=b.float(.4);async function Iy(t,e){const{data:i}=await _i(t,{responseType:"image",...e});return i}function Qot(){if(H9==null){const t=e=>ur(`esri/libs/basisu/${e}`);H9=ce(()=>import("./basis_transcoder-1abf80b3.js"),[],import.meta.url).then(e=>e.b).then(({default:e})=>e({locateFile:t}).then(i=>(i.initializeBasis(),delete i.then,i)))}return H9}let H9;var gw;(function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"})(gw||(gw={}));let Op=null,pL=null;async function vAe(){return pL==null&&(pL=Qot(),Op=await pL),pL}function eat(t,e){if(Op==null)return t.byteLength;const i=new Op.BasisFile(new Uint8Array(t)),r=wAe(i)?bAe(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),e):0;return i.close(),i.delete(),r}function tat(t,e){if(Op==null)return t.byteLength;const i=new Op.KTX2File(new Uint8Array(t)),r=xAe(i)?bAe(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),e):0;return i.close(),i.delete(),r}function bAe(t,e,i,r,n){const s=_K(e?Pn.COMPRESSED_RGBA8_ETC2_EAC:Pn.COMPRESSED_RGB8_ETC2),o=n&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(i*r*s*o)}function wAe(t){return t.getNumImages()>=1&&!t.isUASTC()}function xAe(t){return t.getFaces()>=1&&t.isETC1S()}async function iat(t,e,i){Op==null&&(Op=await vAe());const r=new Op.BasisFile(new Uint8Array(i));if(!wAe(r))return null;r.startTranscoding();const n=TAe(t,e,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),(s,o)=>r.getImageTranscodedSizeInBytes(0,s,o),(s,o,a)=>r.transcodeImage(a,0,s,o,0,0));return r.close(),r.delete(),n}async function rat(t,e,i){Op==null&&(Op=await vAe());const r=new Op.KTX2File(new Uint8Array(i));if(!xAe(r))return null;r.startTranscoding();const n=TAe(t,e,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),(s,o)=>r.getImageTranscodedSizeInBytes(s,0,0,o),(s,o,a)=>r.transcodeImage(a,s,0,0,o,0,-1,-1));return r.close(),r.delete(),n}function TAe(t,e,i,r,n,s,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=t.capabilities,[h,d]=l?r?[gw.ETC2_RGBA,Pn.COMPRESSED_RGBA8_ETC2_EAC]:[gw.ETC1_RGB,Pn.COMPRESSED_RGB8_ETC2]:c?r?[gw.BC3_RGBA,Pn.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[gw.BC1_RGB,Pn.COMPRESSED_RGB_S3TC_DXT1_EXT]:[gw.RGBA32,gt.RGBA],f=e.hasMipmap?i:Math.min(1,i),m=[];for(let y=0;y<f;y++)m.push(new Uint8Array(o(y,h))),a(y,h,m[y]);return e.internalFormat=d,e.hasMipmap=m.length>1,e.samplingMode=e.hasMipmap?zt.LINEAR_MIPMAP_LINEAR:zt.LINEAR,e.width=n,e.height=s,new Nt(t,e,{type:"compressed",levels:m})}const fL=K.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),nat=542327876,sat=131072,oat=4;function WQ(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function aat(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}const lat=WQ("DXT1"),cat=WQ("DXT3"),uat=WQ("DXT5"),hat=31,dat=0,pat=1,fat=2,mat=3,gat=4,yat=7,_at=20,vat=21;function bat(t,e,i){const r=wat(i,e.hasMipmap??!1);if(r==null)throw new Error("DDS texture data is null");const{textureData:n,internalFormat:s,width:o,height:a}=r;return e.samplingMode=n.levels.length>1?zt.LINEAR_MIPMAP_LINEAR:zt.LINEAR,e.hasMipmap=n.levels.length>1,e.internalFormat=s,e.width=o,e.height=a,new Nt(t,e,n)}function wat(t,e){const i=new Int32Array(t,0,hat);if(i[dat]!==nat)return fL.error("Invalid magic number in DDS header"),null;if(!(i[_at]&oat))return fL.error("Unsupported format, must contain a FourCC code"),null;const r=i[vat];let n,s;switch(r){case lat:n=8,s=Pn.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case cat:n=16,s=Pn.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case uat:n=16,s=Pn.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return fL.error("Unsupported FourCC code:",aat(r)),null}let o=1,a=i[gat],l=i[mat];!(3&a)&&!(3&l)||(fL.warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,h=l;let d,f;i[fat]&sat&&e!==!1&&(o=Math.max(1,i[yat]));let m=i[pat]+4;const y=[];for(let _=0;_<o;++_)f=(a+3>>2)*(l+3>>2)*n,d=new Uint8Array(t,m,f),y.push(d),m+=f,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:y},internalFormat:s,width:c,height:h}}let iT=class extends BM{get parameters(){return this._parameters}constructor(e,i){super(),this._data=e,this.type=wn.Texture,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this.events=new Sn,this._parameters={...Tat,...i},this._startPreload(e)}dispose(){this.unload(),this._data=this.frameUpdate=void 0}_startPreload(e){e!=null&&(e instanceof HTMLVideoElement?(this.frameUpdate=i=>this._frameUpdate(e,i),this._startPreloadVideoElement(e)):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(SE(e.src)||e.preload==="auto"&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const i=!e.paused;if(e.src=e.src,i&&e.autoplay){const r=()=>{e.removeEventListener("canplay",r),e.play()};e.addEventListener("canplay",r)}}}_startPreloadImageElement(e){Fm(e.src)||SE(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}_createDescriptor(e){const i=new Hi;return i.wrapMode=this._parameters.wrap??Vt.REPEAT,i.flipped=!this._parameters.noUnpackFlip,i.samplingMode=this._parameters.mipmap?zt.LINEAR_MIPMAP_LINEAR:zt.LINEAR,i.hasMipmap=!!this._parameters.mipmap,i.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha,i.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?e.parameters.maxMaxAnisotropy:1),i}get glTexture(){return this._glTexture}get memoryEstimate(){return this._glTexture?.gpuMemoryUsage||xat(this._data,this._parameters)}load(e){if(this._glTexture)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const i=this._data;return i==null?(this._glTexture=new Nt(e,this._createDescriptor(e),null),this._glTexture):(this._parameters.reloadable||(this._data=void 0),typeof i=="string"?this._loadFromURL(e,i):i instanceof Image?this._loadFromImageElement(e,i):i instanceof HTMLVideoElement?this._loadFromVideoElement(e,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this._loadFromImage(e,i):(i3(i)||G_(i))&&this._parameters.encoding===cy.DDS_ENCODING?this._loadFromDDSData(e,i):(i3(i)||G_(i))&&this._parameters.encoding===cy.KTX2_ENCODING?this._loadFromKTX2(e,i):(i3(i)||G_(i))&&this._parameters.encoding===cy.BASIS_ENCODING?this._loadFromBasis(e,i):G_(i)?this._loadFromPixelData(e,i):i3(i)?this._loadFromPixelData(e,new Uint8Array(i)):null)}_frameUpdate(e,i){return this._glTexture==null||e.readyState<wR.HAVE_CURRENT_DATA||i===e.currentTime?i:(this._glTexture.setData(e),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this._parameters.updateCallback&&this._parameters.updateCallback(),e.currentTime)}_loadFromDDSData(e,i){return this._glTexture=bat(e,this._createDescriptor(e),i),this._glTexture}_loadFromKTX2(e,i){return this._loadAsync(()=>rat(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromBasis(e,i){return this._loadAsync(()=>iat(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromPixelData(e,i){tt(this._parameters.width>0&&this._parameters.height>0);const r=this._createDescriptor(e);return r.pixelFormat=this._parameters.components===1?gt.LUMINANCE:this._parameters.components===3?gt.RGB:gt.RGBA,r.width=this._parameters.width??0,r.height=this._parameters.height??0,this._glTexture=new Nt(e,r,i),this._glTexture}_loadFromURL(e,i){return this._loadAsync(async r=>{const n=await Iy(i,{signal:r});return Tt(r),this._loadFromImage(e,n)})}_loadFromImageElement(e,i){return i.complete?this._loadFromImage(e,i):this._loadAsync(async r=>{const n=await Yge(i,i.src,!1,r);return Tt(r),this._loadFromImage(e,n)})}_loadFromVideoElement(e,i){return i.readyState>=wR.HAVE_CURRENT_DATA?this._loadFromImage(e,i):this._loadFromVideoElementAsync(e,i)}_loadFromVideoElementAsync(e,i){return this._loadAsync(r=>new Promise((n,s)=>{const o=()=>{i.removeEventListener("loadeddata",a),i.removeEventListener("error",l),Tr(c)},a=()=>{i.readyState>=wR.HAVE_CURRENT_DATA&&(o(),n(this._loadFromImage(e,i)))},l=h=>{o(),s(h||new G("Failed to load video"))};i.addEventListener("loadeddata",a),i.addEventListener("error",l);const c=Ms(r,()=>l(Ti()))}))}_loadFromImage(e,i){let r=i;if(!(r instanceof HTMLVideoElement)){const{maxTextureSize:o}=e.parameters;r=this._parameters.downsampleUncompressed?gXe(r,o):yXe(r,o)}const n=SAe(r);this._parameters.width=n.width,this._parameters.height=n.height;const s=this._createDescriptor(e);return s.pixelFormat=this._parameters.components===3?gt.RGB:gt.RGBA,s.width=n.width,s.height=n.height,this._glTexture=new Nt(e,s,r),this._glTexture}_loadAsync(e){const i=new AbortController;this._loadingController=i;const r=e(i.signal);this._loadingPromise=r;const n=()=>{this._loadingController===i&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null)};return r.then(n,n),r}unload(){if(this._glTexture=rt(this._glTexture),this._loadingController!=null){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}};function xat(t,e){if(t==null)return 0;if(i3(t)||G_(t))return e.encoding===cy.KTX2_ENCODING?tat(t,!!e.mipmap):e.encoding===cy.BASIS_ENCODING?eat(t,!!e.mipmap):t.byteLength;const{width:i,height:r}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?SAe(t):e;return(e.mipmap?4/3:1)*i*r*(e.components||4)||0}function SAe(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}var wR;(function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(wR||(wR={}));const Tat={wrap:{s:Vt.REPEAT,t:Vt.REPEAT},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1,downsampleUncompressed:!1},KF=128,YQ=.5;function Sat(t){return t==="cross"||t==="x"}function Eat(t,e=KF,i=e*YQ,r=0){const n=EAe(t,e,i,r);return new iT(n,{mipmap:!1,wrap:{s:Vt.CLAMP_TO_EDGE,t:Vt.CLAMP_TO_EDGE},width:e,height:e,components:4,noUnpackFlip:!0,reloadable:!0})}function EAe(t,e=KF,i=e*YQ,r=0){switch(t){case"circle":default:return Cat(e,i);case"square":return Aat(e,i);case"cross":return Rat(e,i,r);case"x":return Pat(e,i,r);case"kite":return Oat(e,i);case"triangle":return Mat(e,i);case"arrow":return $at(e,i)}}function Cat(t,e){const i=t/2-.5;return i$(t,OAe(i,i,e/2))}function Aat(t,e){return CAe(t,e,!1)}function Oat(t,e){return CAe(t,e,!0)}function Rat(t,e,i=0){return AAe(t,e,!1,i)}function Pat(t,e,i=0){return AAe(t,e,!0,i)}function Mat(t,e){return i$(t,RAe(t/2,e,e/2))}function $at(t,e){const i=e,r=e/2,n=t/2,s=.8*i,o=OAe(n,(t-e)/2-s,Math.sqrt(s*s+r*r)),a=RAe(n,i,r);return i$(t,(l,c)=>Math.max(a(l,c),-o(l,c)))}function CAe(t,e,i){return i&&(e/=Math.SQRT2),i$(t,(r,n)=>{let s=r-.5*t+.25,o=.5*t-n-.75;if(i){const a=(s+o)/Math.SQRT2;o=(o-s)/Math.SQRT2,s=a}return Math.max(Math.abs(s),Math.abs(o))-.5*e})}function AAe(t,e,i,r=0){e-=r,i&&(e*=Math.SQRT2);const n=.5*e;return i$(t,(s,o)=>{let a,l=s-.5*t,c=.5*t-o-1;if(i){const h=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=h}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>n?Math.sqrt((l-n)*(l-n)+c*c):c:c>n?Math.sqrt(l*l+(c-n)*(c-n)):l,a-=r/2,a})}function OAe(t,e,i){return(r,n)=>{const s=r-t,o=n-e;return Math.sqrt(s*s+o*o)-i}}function RAe(t,e,i){const r=Math.sqrt(e*e+i*i);return(n,s)=>{const o=Math.abs(n-t)-i,a=s-t+e/2+.75,l=(e*o+i*a)/r,c=-a;return Math.max(l,c)}}function i$(t,e){const i=new Uint8Array(4*t*t);for(let r=0;r<t;r++)for(let n=0;n<t;n++){const s=n+t*r;let o=e(n,r);o=o/t+.5,FP(o,i,4*s)}return i}const Kw=64,XQ=Kw/2,PAe=XQ/5,Iat=Kw/PAe,Lat=.25;function Dat(t,e){const i=EAe(t,Kw,XQ,PAe),r=new Hi;return r.internalFormat=gt.RGBA,r.width=Kw,r.height=Kw,r.wrapMode=Vt.CLAMP_TO_EDGE,new Nt(e,r,i)}function MAe(t,e){const{vertex:i,constants:r}=t;r.add("markerSizePerLineWidth","float",Iat),FC(i),i.uniforms.get("markerScale")==null&&i.constants.add("markerScale","float",1),i.code.add(b`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),e.space===Zu.World&&(i.constants.add("maxSegmentLengthFraction","float",.45),i.uniforms.add(new Re("perRenderPixelRatio",(n,s)=>s.camera.perRenderPixelRatio)),i.code.add(b`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))}var Zh;(function(t){t[t.BUTT=0]="BUTT",t[t.SQUARE=1]="SQUARE",t[t.ROUND=2]="ROUND",t[t.COUNT=3]="COUNT"})(Zh||(Zh={}));let fn=class extends fl{constructor(){super(...arguments),this.output=F.Color,this.capType=Zh.BUTT,this.transparencyPassType=it.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}};u([U({count:F.COUNT})],fn.prototype,"output",void 0),u([U({count:Zh.COUNT})],fn.prototype,"capType",void 0),u([U({count:it.COUNT})],fn.prototype,"transparencyPassType",void 0),u([U()],fn.prototype,"occluder",void 0),u([U()],fn.prototype,"hasSlicePlane",void 0),u([U()],fn.prototype,"hasPolygonOffset",void 0),u([U()],fn.prototype,"writeDepth",void 0),u([U()],fn.prototype,"draped",void 0),u([U()],fn.prototype,"stippleEnabled",void 0),u([U()],fn.prototype,"stippleOffColorEnabled",void 0),u([U()],fn.prototype,"stipplePreferContinuous",void 0),u([U()],fn.prototype,"roundJoins",void 0),u([U()],fn.prototype,"applyMarkerOffset",void 0),u([U()],fn.prototype,"vvSize",void 0),u([U()],fn.prototype,"vvColor",void 0),u([U()],fn.prototype,"vvOpacity",void 0),u([U()],fn.prototype,"falloffEnabled",void 0),u([U()],fn.prototype,"innerColorEnabled",void 0),u([U()],fn.prototype,"hasOccludees",void 0),u([U()],fn.prototype,"multipassEnabled",void 0),u([U()],fn.prototype,"cullAboveGround",void 0),u([U()],fn.prototype,"wireframe",void 0),u([U()],fn.prototype,"objectAndLayerIdColorInstanced",void 0),u([U({constValue:!1})],fn.prototype,"occlusionPass",void 0),u([U({constValue:!0})],fn.prototype,"hasVvInstancing",void 0),u([U({constValue:!0})],fn.prototype,"hasSliceTranslatedView",void 0);const QF=1;function Nat(t){const e=new Ei,{vertex:i,fragment:r}=e,n=t.multipassEnabled&&(t.output===F.Color||t.output===F.Alpha);e.include(FM),e.include(fAe,t),e.include(Yot,t);const s=t.applyMarkerOffset&&!t.draped;s&&(i.uniforms.add(new Re("markerScale",m=>m.markerScale)),e.include(MAe,{space:Zu.World,draped:!1})),t.output===F.Depth&&e.include($y,t),e.include(qM,t),zc(i,t),i.uniforms.add(new en("inverseProjectionMatrix",(m,y)=>y.camera.inverseProjectionMatrix),new Ki("nearFar",(m,y)=>y.camera.nearFar),new Re("miterLimit",m=>m.join!=="miter"?0:m.miterLimit),new yi("viewport",(m,y)=>y.camera.fullViewport)),i.constants.add("LARGE_HALF_FLOAT","float",65500),e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.SUBDIVISIONFACTOR,"float"),e.attributes.add(O.UV0,"vec2"),e.attributes.add(O.AUXPOS1,"vec3"),e.attributes.add(O.AUXPOS2,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),Nv(e),n&&e.varyings.add("depth","float");const o=t.stippleEnabled;o&&e.varyings.add("vLineSizeInv","float");const a=t.capType===Zh.ROUND,l=o||a;l&&e.varyings.add("vLineWidth","float");const c=t.innerColorEnabled||a;c&&e.varyings.add("vLineDistance","float");const h=t.stippleEnabled&&a,d=t.falloffEnabled||h;d&&e.varyings.add("vLineDistanceNorm","float"),a&&(e.varyings.add("vSegmentSDF","float"),e.varyings.add("vReverseSegmentSDF","float")),i.code.add(b`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),i.code.add(b`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),wU(e),i.code.add(b`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${n?"depth = pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),FC(i),i.code.add(b`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${l?b`vLineWidth = lineWidth;`:""}
      ${o?b`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);
  `),s&&i.code.add(b`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),i.code.add(b`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(t.stippleEnabled||a)&&i.code.add(b`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${a?b`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),i.code.add(b`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),t.roundJoins?i.code.add(b`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${t.stippleEnabled?b`min(1.0, subdivisionFactor * ${b.float((QF+2)/(QF+1))})`:b`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):i.code.add(b`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const f=t.capType!==Zh.BUTT;return i.code.add(b`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${f?b`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),i.code.add(b`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${d||c?b`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${c?b`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${d?b`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),a&&i.code.add(b`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),t.stippleEnabled&&(t.draped?i.uniforms.add(new Re("worldToScreenRatio",(m,y)=>1/y.screenToPCSRatio)):i.code.add(b`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),i.code.add(b`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),t.draped?i.code.add(b`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):i.code.add(b`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),i.uniforms.add(new Re("stipplePatternPixelSize",m=>_Ae(m))),i.code.add(b`float patternLength = lineSize * stipplePatternPixelSize;
vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);
vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);
if (segmentLengthScreenDouble >= 0.001) {
vec2 stippleDisplacement = pos.xy - segmentOrigin;
float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);
vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
}
vStippleDistanceLimits *= pos.w;
vStippleDistance *= pos.w;
vStippleDistanceLimits = isJoin ?
vStippleDistanceLimits :
isStartVertex ?
vec2(-1e34, vStippleDistanceLimits.y) :
vec2(vStippleDistanceLimits.x, 1e34);`)),i.code.add(b`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${t.wireframe&&!t.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),n&&e.include(Xc,t),e.include(Dn,t),r.include(Wm),r.code.add(b`
  void main() {
    discardBySlice(vpos);
    ${n?"terrainDepthTest(depth);":""}
  `),t.wireframe?r.code.add(b`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(a&&r.code.add(b`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${b.float(zo)}) {
        discard;
      }
    `),h?r.code.add(b`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${b.float(zo)}, stippleCoverage);
      `):r.code.add(b`float stippleAlpha = getStippleAlpha();`),t.output!==F.ObjectAndLayerIdColor&&r.code.add(b`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),r.uniforms.add(new yi("intrinsicColor",m=>m.color)),r.code.add(b`vec4 color = intrinsicColor * vColor;`),t.innerColorEnabled&&(r.uniforms.add(new yi("innerColor",m=>m.innerColor??m.color),new Re("innerWidth",(m,y)=>m.innerWidth*y.camera.pixelRatio)),r.code.add(b`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),r.code.add(b`vec4 finalColor = blendStipple(color, stippleAlpha);`),t.falloffEnabled&&(r.uniforms.add(new Re("falloff",m=>m.falloff)),r.code.add(b`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),r.code.add(b`
    ${t.output===F.ObjectAndLayerIdColor?b`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${b.float(zo)}) {
      discard;
    }

    ${t.output===F.Alpha?b`fragColor = vec4(finalColor.a);`:""}
    ${t.output===F.Color?b`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===F.Color&&t.transparencyPassType===it.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${t.output===F.Highlight?b`fragColor = vec4(1.0);`:""}
    ${t.output===F.Depth?b`outputDepth(linearDepth);`:""}
    ${t.output===F.ObjectAndLayerIdColor?b`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const Fat=Object.freeze(Object.defineProperty({__proto__:null,build:Nat,ribbonlineNumRoundJoinSubdivisions:QF},Symbol.toStringTag,{value:"Module"})),$Ae=new Map([[O.POSITION,0],[O.SUBDIVISIONFACTOR,1],[O.UV0,2],[O.AUXPOS1,3],[O.AUXPOS2,4],[O.COLOR,5],[O.COLORFEATUREATTRIBUTE,5],[O.SIZE,6],[O.SIZEFEATUREATTRIBUTE,6],[O.OPACITYFEATUREATTRIBUTE,7],[O.OBJECTANDLAYERIDCOLOR,8]]);let IAe=class LAe extends Fi{initializeProgram(e){return new Mi(e.rctx,LAe.shader.get().build(this.configuration),$Ae)}_makePipelineState(e,i){const r=this.configuration,n=e===it.NONE,s=e===it.FrontFace;return Lt({blending:r.output===F.Color||r.output===F.Alpha?n?Xu:Zy(e):null,depthTest:{func:o1(e)},depthWrite:n?r.writeDepth?ec:null:BU(e),colorWrite:Gt,stencilWrite:r.hasOccludees?$m:null,stencilTest:r.hasOccludees?i?Gv:a1:null,polygonOffset:n||s?r.hasPolygonOffset?Ole:null:GU})}initializePipeline(){const e=this.configuration;if(e.occluder){const i=e.hasPolygonOffset?Ole:null;this._occluderPipelineTransparent=Lt({blending:Xu,polygonOffset:i,depthTest:HF,depthWrite:null,colorWrite:Gt,stencilWrite:null,stencilTest:HEe}),this._occluderPipelineOpaque=Lt({blending:Xu,polygonOffset:i,depthTest:HF,depthWrite:null,colorWrite:Gt,stencilWrite:GEe,stencilTest:jEe}),this._occluderPipelineMaskWrite=Lt({blending:null,polygonOffset:i,depthTest:CQ,depthWrite:null,colorWrite:null,stencilWrite:$m,stencilTest:Gv})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?ci.LINES:ci.TRIANGLE_STRIP}getPipeline(e,i,r){return e?this._occludeePipelineState:this.configuration.occluder?r?this._occluderPipelineTransparent:i?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}};IAe.shader=new Pi(Fat,()=>ce(()=>import("./RibbonLine.glsl-75cb6d97.js"),[],import.meta.url));const Ole={factor:0,units:-4};var wc;(function(t){t[t.LEFT_JOIN_START=-2]="LEFT_JOIN_START",t[t.LEFT_JOIN_END=-1]="LEFT_JOIN_END",t[t.LEFT_CAP_START=-4]="LEFT_CAP_START",t[t.LEFT_CAP_END=-5]="LEFT_CAP_END",t[t.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",t[t.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",t[t.RIGHT_CAP_START=4]="RIGHT_CAP_START",t[t.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(wc||(wc={}));let N2=class extends n1{constructor(e){super(e,new Uat),this._configuration=new fn,this._vertexAttributeLocations=$Ae}getConfiguration(e,i){this._configuration.output=e,this._configuration.draped=i.slot===le.DRAPED_MATERIAL;const r=this.parameters.stipplePattern!=null&&e!==F.Highlight;return this._configuration.stippleEnabled=r,this._configuration.stippleOffColorEnabled=r&&this.parameters.stippleOffColor!=null,this._configuration.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=this.parameters.markerParameters!=null&&Bat(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&this.parameters.innerColor!=null,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===Vr.OccludeAndTransparentStencil,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,i,r,n,s,o){if(!r.options.selectionMode)return;const a=e.attributes.get(O.POSITION).data,l=e.attributes.get(O.SIZE);let c=this.parameters.width;if(this.parameters.vvSize){const _=e.attributes.get(O.SIZEFEATUREATTRIBUTE).data[0];c*=_e(this.parameters.vvSize.offset[0]+_*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else l&&(c*=l.data[0]);const h=n[0],d=n[1],f=(c/2+4)*e.screenToWorldRatio;let m=Number.MAX_VALUE,y=0;for(let _=0;_<a.length-5;_+=3){const v=a[_],w=a[_+1],x=h-v,T=d-w,S=a[_+3]-v,C=a[_+4]-w,A=_e((S*x+C*T)/(S*S+C*C),0,1),R=S*A-x,D=C*A-T,N=R*R+D*D;N<m&&(m=N,y=_/3)}m<f*f&&s(o.dist,o.normal,y,!1)}intersect(e,i,r,n,s,o){if(!r.options.selectionMode||!e.visible)return;if(!Bxe(i))return void K.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const a=e.attributes,l=a.get(O.POSITION).data;let c=this.parameters.width;if(this.parameters.vvSize){const x=a.get(O.SIZEFEATUREATTRIBUTE).data[0];c*=_e(this.parameters.vvSize.offset[0]+x*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else a.has(O.SIZE)&&(c*=a.get(O.SIZE).data[0]);const h=r.camera,d=Vat;gs(d,r.point);const f=c*h.pixelRatio/2+4*h.pixelRatio;ae(PA[0],d[0]-f,d[1]+f,0),ae(PA[1],d[0]+f,d[1]+f,0),ae(PA[2],d[0]+f,d[1]-f,0),ae(PA[3],d[0]-f,d[1]-f,0);for(let x=0;x<4;x++)if(!h.unprojectFromRenderScreen(PA[x],sg[x]))return;Ca(h.eye,sg[0],sg[1],W9),Ca(h.eye,sg[1],sg[2],Y9),Ca(h.eye,sg[2],sg[3],X9),Ca(h.eye,sg[3],sg[0],Z9);let m=Number.MAX_VALUE,y=0;const _=DAe(this.parameters,a)?l.length-2:l.length-5;for(let x=0;x<_;x+=3){xl[0]=l[x]+i[12],xl[1]=l[x+1]+i[13],xl[2]=l[x+2]+i[14];const T=(x+3)%l.length;if(Tl[0]=l[T]+i[12],Tl[1]=l[T+1]+i[13],Tl[2]=l[T+2]+i[14],hr(W9,xl)<0&&hr(W9,Tl)<0||hr(Y9,xl)<0&&hr(Y9,Tl)<0||hr(X9,xl)<0&&hr(X9,Tl)<0||hr(Z9,xl)<0&&hr(Z9,Tl)<0)continue;if(h.projectToRenderScreen(xl,I1),h.projectToRenderScreen(Tl,L1),I1[2]<0&&L1[2]>0){de(of,xl,Tl);const C=h.frustum,A=-hr(C[br.NEAR],xl)/ge(of,C[br.NEAR]);re(of,of,A),ue(xl,xl,of),h.projectToRenderScreen(xl,I1)}else if(I1[2]>0&&L1[2]<0){de(of,Tl,xl);const C=h.frustum,A=-hr(C[br.NEAR],Tl)/ge(of,C[br.NEAR]);re(of,of,A),ue(Tl,Tl,of),h.projectToRenderScreen(Tl,L1)}else if(I1[2]<0&&L1[2]<0)continue;I1[2]=0,L1[2]=0;const S=PJ(jw(I1,L1,Mle),d);S<m&&(m=S,oe(Rle,xl),oe(Ple,Tl),y=x/3)}const v=r.rayBegin,w=r.rayEnd;if(m<f*f){let x=Number.MAX_VALUE;if(vbe(jw(Rle,Ple,Mle),jw(v,w,Gat),$1)){de($1,$1,v);const T=xe($1);re($1,$1,1/T),x=T/Mr(v,w)}o(x,$1,y,!1)}}get _layout(){const e=Hr().vec3f(O.POSITION).f32(O.SUBDIVISIONFACTOR).vec2f(O.UV0).vec3f(O.AUXPOS1).vec3f(O.AUXPOS2);return this.parameters.vvSize?e.f32(O.SIZEFEATUREATTRIBUTE):e.f32(O.SIZE),this.parameters.vvColor?e.f32(O.COLORFEATUREATTRIBUTE):e.vec4f(O.COLOR),this.parameters.vvOpacity&&e.f32(O.OPACITYFEATUREATTRIBUTE),ie("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(O.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new zat(this._layout,this.parameters)}produces(e,i){return i===F.Color||i===F.Alpha||i===F.Highlight||i===F.Depth||i===F.ObjectAndLayerIdColor?e===le.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===Vr.OccludeAndTransparentStencil?e===le.OPAQUE_MATERIAL||e===le.OCCLUDER_MATERIAL||e===le.TRANSPARENT_OCCLUDER_MATERIAL:i===F.Color||i===F.Alpha?e===(this.parameters.writeDepth?le.TRANSPARENT_MATERIAL:le.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===le.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new kat(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),e.markerParameters!=null&&(e.markerScale=e.markerParameters.width/e.width)}},kat=class extends i1{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==F.Color&&this._output!==F.Alpha||this._updateOccludeeState(e);const i=this._material.parameters.stipplePattern;return this._stipplePattern!==i&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(i,this._stipplePattern)}),this._stipplePattern=i),this.ensureTechnique(IAe,e)}},Uat=class extends WM{constructor(){super(...arguments),this.width=0,this.color=Hh,this.join="miter",this.cap=Zh.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}},zat=class{constructor(e,i){this.vertexBufferLayout=e,this._parameters=i,this.numJoinSubdivisions=0;const r=i.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=QF+r}}_isClosed(e){return DAe(this._parameters,e.attributes)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const r=e.attributes.get(O.POSITION).indices.length/2+1,n=this._isClosed(e);let s=n?2:2*2;return s+=((n?r:r-1)-(n?0:1))*(2*this.numJoinSubdivisions+4),s+=2,this._parameters.wireframe&&(s=2+4*(s-2)),s}write(e,i,r,n,s){const o=jat,a=Hat,l=qat,c=r.attributes.get(O.POSITION),h=c.indices,d=c.data.length/3,f=r.attributes.get(O.DISTANCETOSTART)?.data;h&&h.length!==2*(d-1)&&console.warn("RibbonLineMaterial does not support indices");let m=1,y=0;const _=this.vertexBufferLayout.fields.has(O.SIZEFEATUREATTRIBUTE);_?y=r.attributes.get(O.SIZEFEATUREATTRIBUTE).data[0]:r.attributes.has(O.SIZE)&&(m=r.attributes.get(O.SIZE).data[0]);let v=[1,1,1,1],w=0;const x=this.vertexBufferLayout.fields.has(O.COLORFEATUREATTRIBUTE);x?w=r.attributes.get(O.COLORFEATUREATTRIBUTE).data[0]:r.attributes.has(O.COLOR)&&(v=r.attributes.get(O.COLOR).data);const T=ie("enable-feature:objectAndLayerId-rendering")?r.objectAndLayerIdColor:null;let S=0;const C=this.vertexBufferLayout.fields.has(O.OPACITYFEATUREATTRIBUTE);C&&(S=r.attributes.get(O.OPACITYFEATUREATTRIBUTE).data[0]);const A=new Float32Array(n.buffer),R=ie("enable-feature:objectAndLayerId-rendering")?new Uint8Array(n.buffer):null,D=this.vertexBufferLayout.stride/4;let N=s*D;const k=N;let B=0;const L=f?(I,V,q)=>B=f[q]:(I,V,q)=>B+=Mr(I,V),z=ie("enable-feature:objectAndLayerId-rendering"),j=(I,V,q,Y,J,ee,me)=>{if(A[N++]=V[0],A[N++]=V[1],A[N++]=V[2],A[N++]=Y,A[N++]=me,A[N++]=J,A[N++]=I[0],A[N++]=I[1],A[N++]=I[2],A[N++]=q[0],A[N++]=q[1],A[N++]=q[2],A[N++]=_?y:m,x)A[N++]=w;else{const Me=Math.min(4*ee,v.length-4);A[N++]=v[Me],A[N++]=v[Me+1],A[N++]=v[Me+2],A[N++]=v[Me+3]}C&&(A[N++]=S),z&&(T!=null&&(R[4*N]=T[0],R[4*N+1]=T[1],R[4*N+2]=T[2],R[4*N+3]=T[3]),N++)};N+=D,ae(a,c.data[0],c.data[1],c.data[2]),e&&ke(a,a,e);const H=this._isClosed(r);if(H){const I=c.data.length-3;ae(o,c.data[I],c.data[I+1],c.data[I+2]),e&&ke(o,o,e)}else ae(l,c.data[3],c.data[4],c.data[5]),e&&ke(l,l,e),j(a,a,l,1,wc.LEFT_CAP_START,0,0),j(a,a,l,1,wc.RIGHT_CAP_START,0,0),oe(o,a),oe(a,l);const X=H?0:1,P=H?d:d-1;for(let I=X;I<P;I++){const V=(I+1)%d*3;ae(l,c.data[V],c.data[V+1],c.data[V+2]),e&&ke(l,l,e),L(o,a,I),j(o,a,l,0,wc.LEFT_JOIN_END,I,B),j(o,a,l,0,wc.RIGHT_JOIN_END,I,B);const q=this.numJoinSubdivisions;for(let Y=0;Y<q;++Y){const J=(Y+1)/(q+1);j(o,a,l,J,wc.LEFT_JOIN_END,I,B),j(o,a,l,J,wc.RIGHT_JOIN_END,I,B)}j(o,a,l,1,wc.LEFT_JOIN_START,I,B),j(o,a,l,1,wc.RIGHT_JOIN_START,I,B),oe(o,a),oe(a,l)}H?(ae(l,c.data[3],c.data[4],c.data[5]),e&&ke(l,l,e),B=L(o,a,P),j(o,a,l,0,wc.LEFT_JOIN_END,X,B),j(o,a,l,0,wc.RIGHT_JOIN_END,X,B)):(B=L(o,a,P),j(o,a,a,0,wc.LEFT_CAP_END,P,B),j(o,a,a,0,wc.RIGHT_CAP_END,P,B)),q9(A,k+D,A,k,D),N=q9(A,N-D,A,N,D),this._parameters.wireframe&&this._addWireframeVertices(n,k,N,D)}_addWireframeVertices(e,i,r,n){const s=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT,r-i);let a=0;const l=c=>a=q9(o,c,s,a,n);for(let c=0;c<o.length-1;c+=2*n)l(c),l(c+2*n),l(c+1*n),l(c+2*n),l(c+1*n),l(c+3*n)}};function q9(t,e,i,r,n){for(let s=0;s<n;s++)i[r++]=t[e++];return r}function DAe(t,e){return t.isClosed?e.get(O.POSITION).indices.length>2:!1}function Bat(t){return t.anchor===Px.Tip&&t.hideOnShortSegments&&t.placement==="begin-end"&&t.worldSpace}const xl=E(),Tl=E(),of=E(),$1=E(),Vat=E(),I1=aa(),L1=aa(),Rle=E(),Ple=E(),Mle=Vp(),Gat=Vp(),jat=E(),Hat=E(),qat=E(),PA=[aa(),aa(),aa(),aa()],sg=[E(),E(),E(),E()],W9=Ii(),Y9=Ii(),X9=Ii(),Z9=Ii();let ZQ=class{constructor(e){this._originSR=e,this._rootOriginId="root/"+zu(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}getOrigin(e){const i=this._origins.get(this._rootOriginId);if(i==null){const h=XF(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,h),h}const r=this._gridSize,n=Math.round(e[0]/r),s=Math.round(e[1]/r),o=Math.round(e[2]/r),a=`${n}/${s}/${o}`;let l=this._origins.get(a);const c=.5*r;if(de(Co,e,i.vec3),Co[0]=Math.abs(Co[0]),Co[1]=Math.abs(Co[1]),Co[2]=Math.abs(Co[2]),Co[0]<c&&Co[1]<c&&Co[2]<c){if(l){const h=Math.max(...Co);if(de(Co,e,l.vec3),Co[0]=Math.abs(Co[0]),Co[1]=Math.abs(Co[1]),Co[2]=Math.abs(Co[2]),Math.max(...Co)<h)return l}return i}return l||(l=XF(n*r,s*r,o*r,a),this._origins.set(a,l)),l}_drawOriginBox(e,i=Ft(1,1,0,1)){const r=window.view,n=r._stage,s=i.toString();if(!this._objects.has(s)){this._material=new N2({width:2,color:i}),n.add(this._material);const m=new pAe(n,{pickable:!1}),y=new Jy({castShadow:!1});n.add(y),m.add(y),this._objects.set(s,y)}const o=this._objects.get(s),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),h=new Array,d=.5*this._gridSize;for(let m=0;m<l;m++)c[3*m]=e[0]+(1&a[m]?d:-d),c[3*m+1]=e[1]+(2&a[m]?d:-d),c[3*m+2]=e[2]+(4&a[m]?d:-d),m>0&&h.push(m-1,m);rn(c,this._originSR,0,c,r.renderSpatialReference,0,l);const f=new ms(this._material,[[O.POSITION,new Ve(c,h,3,!0)]],null,wn.Line);n.add(f),o.addGeometry(f)}get test(){const e=this;return{set gridSize(i){e._gridSize=i}}}};const Co=E();let NAe=class{constructor(e,i,r=null){this.rctx=e,this.sliceHelper=r,this.lastFrameCamera=new ft,this.output=F.Color,this.renderOccludedMask=$le,this.bindParameters=new bU(i,r!=null?r.plane:null),this.bindParameters.alignPixelEnabled=!0}resetRenderOccludedMask(){this.renderOccludedMask=$le}},Wat=class extends NAe{constructor(e,i,r,n){super(e,r,n),this.offscreenRenderingHelper=i,this.sliceHelper=n,this.time=0}};const $le=Vr.Occlude|Vr.OccludeAndTransparent|Vr.OccludeAndTransparentStencil;let lO=class extends ft{constructor(){super(...arguments),this._projectionMatrix=be()}get projectionMatrix(){return this._projectionMatrix}};u([p()],lO.prototype,"_projectionMatrix",void 0),u([p({readOnly:!0})],lO.prototype,"projectionMatrix",null),lO=u([M("esri.views.3d.webgl-engine.lib.CascadeCamera")],lO);var hC;(function(t){t[t.Highlight=0]="Highlight",t[t.Default=1]="Default"})(hC||(hC={}));let mL=class{constructor(){this.camera=new lO,this.lightMat=be()}},Yat=class{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}},JQ=class{get depthTexture(){return this._handle?.colorTexture}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return Gr(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}constructor(e,i){this._fbos=e,this._viewingMode=i,this._enabled=!1,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new Yat,this._projectionView=be(),this._projectionViewInverse=be(),this._modelViewLight=be(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=oi(),this._cascades=[new mL,new mL,new mL,new mL],this._lastOrigin=null,this._maxTextureWidth=Math.min(ie("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._handle=li(this._handle),this._discardSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=_e(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&this.depthTexture!=null}get cascades(){for(let e=0;e<this._numCascades;++e)K9[e]=this._cascades[e];return K9.length=this._numCascades,K9}start(e,i,r,n,s){tt(this.enabled);const{near:o,far:a}=this._clampNearFar(r);this._computeCascadeDistances(o,a,n),this._textureHeight=this._computeTextureHeight(e,s,n),this._setupMatrices(e,i);const{viewMatrix:l,projectionMatrix:c}=e;for(let h=0;h<this._numCascades;++h)this._constructCascade(h,c,l,i);this._lastOrigin=null,this.clear()}finish(){tt(this.enabled),this._handle?.releaseDepth()}getShadowMapMatrices(e){if(!this._lastOrigin||!oa(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||E(),oe(this._lastOrigin,e);for(let i=0;i<this._numCascades;++i){Kl(kle,this._cascades[i].lightMat,e);for(let r=0;r<16;++r)Ule[16*i+r]=kle[r]}}return Ule}moveSnapshot(e){tt(this.enabled),this._handle?.releaseDepth(),this._snapshots[e]?.release(),this._snapshots[e]=this._handle,this._handle=null}copySnapshot(e){const i=this._handle?.colorTexture?.descriptor;if(!this.enabled||!i)return;this._snapshots[e]?.release();const{width:r,height:n}=i;this._snapshots[e]=this._fbos.acquire(xi.RGBA4,r,n);const s=this._fbos.rctx;this._bindFbo();const o=s.bindTexture(this._snapshots[e]?.colorTexture,Nt.TEXTURE_UNIT_FOR_UPDATES);s.gl.copyTexSubImage2D(bn.TEXTURE_2D,0,0,0,0,0,r,n),s.bindTexture(o,Nt.TEXTURE_UNIT_FOR_UPDATES)}getSnapshot(e){return this.enabled?this._snapshots[e]?.colorTexture:null}clear(){const e=this._fbos.rctx;this._ensureFbo(),this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(wr.COLOR_BUFFER_BIT|wr.DEPTH_BUFFER_BIT)}_computeTextureHeight(e,i,r){const n=Math.min(window.devicePixelRatio,i)/e.pixelRatio,s=r?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,o=Ww(Math.floor(Math.max(e.fullWidth,e.fullHeight)*n*s));return Math.min(this._maxTextureWidth,this._numCascades*o)/this._numCascades}_ensureFbo(){this._handle?.fbo.width===this._textureWidth&&this._handle?.fbo.height===this._textureHeight||(this._handle?.release(),this._handle=this._fbos.acquire(xi.RGBA4,this._textureWidth,this._textureHeight)),this._handle.acquireDepth(As.DEPTH16_BUFFER)}_discardSnapshot(e){this._snapshots[e]=li(this._snapshots[e])}_discardSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){const e=this._fbos.rctx;e.unbindTexture(this.depthTexture),e.bindFramebuffer(this._handle?.fbo)}_constructCascade(e,i,r,n){const s=this._cascades[e],o=-this._cascadeDistances[e],a=-this._cascadeDistances[e+1],l=(i[10]*o+i[14])/Math.abs(i[11]*o+i[15]),c=(i[10]*a+i[14])/Math.abs(i[11]*a+i[15]);tt(l<c);for(let m=0;m<8;++m){Gr(Ile,m%4==0||m%4==3?-1:1,m%4==0||m%4==1?-1:1,m<4?l:c,1);const y=$h[m];Fu(y,Ile,this._projectionViewInverse),y[0]/=y[3],y[1]/=y[3],y[2]/=y[3]}Pa(J9,$h[0]),s.camera.viewMatrix=Kl(Xat,this._modelViewLight,J9);for(let m=0;m<8;++m)ke($h[m],$h[m],s.camera.viewMatrix);let h=$h[0][2],d=$h[0][2];for(let m=1;m<8;++m)h=Math.min(h,$h[m][2]),d=Math.max(d,$h[m][2]);h-=200,d+=200,s.camera.near=-d,s.camera.far=-h,Qat(r,n,h,d,s.camera),qi(s.lightMat,s.camera.projectionMatrix,s.camera.viewMatrix);const f=this._textureHeight;s.camera.viewport=[e*f,0,f,f]}_setupMatrices(e,i){qi(this._projectionView,e.projectionMatrix,e.viewMatrix),fs(this._projectionViewInverse,this._projectionView);const r=this._viewingMode===Le.Global?e.eye:ae(J9,0,0,1);A6(this._modelViewLight,[0,0,0],[-i[0],-i[1],-i[2]],r)}_clampNearFar(e){let{near:i,far:r}=e;return i<2&&(i=2),r<2&&(r=2),i>=r&&(i=2,r=4),{near:i,far:r}}_computeCascadeDistances(e,i,r){const n=r?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(uYe(i/e,4)),n);const s=(i-e)/this._numCascades,o=(i/e)**(1/this._numCascades);let a=e,l=e;for(let c=0;c<this._numCascades+1;++c)this._cascadeDistances[c]=xt(a,l,this.settings.splitSchemeLambda),a*=o,l+=s}get test(){return{cascades:this._cascades,textureHeight:this._textureHeight}}};const Xat=be(),Ile=oi(),$h=[];for(let t=0;t<8;++t)$h.push(oi());const Lle=Ge(),Dle=Ge(),Zat=Ge(),Nle=Ge(),Fle=Ge(),J9=E(),K9=[],kle=be(),Ule=Kr.concat(Kr,Kr,Kr,Kr),nu=Ge(),BT=Ge(),D1=[Ge(),Ge(),Ge(),Ge()],Us=Ge(),Q9=Ge(),M0=Ge(),MA=Ge(),VT=Ge(),GT=Ge(),gL=Ge();function Jat(t,e,i,r,n,s,o,a){mi(nu,0,0);for(let C=0;C<4;++C)sp(nu,nu,t[C]);Lc(nu,nu,.25),mi(BT,0,0);for(let C=4;C<8;++C)sp(BT,BT,t[C]);Lc(BT,BT,.25),zh(D1[0],t[4],t[5],.5),zh(D1[1],t[5],t[6],.5),zh(D1[2],t[6],t[7],.5),zh(D1[3],t[7],t[4],.5);let l=0,c=yF(D1[0],nu);for(let C=1;C<4;++C){const A=yF(D1[C],nu);A<c&&(c=A,l=C)}Qf(Us,D1[l],t[l+4]);const h=Us[0];let d,f;Us[0]=-Us[1],Us[1]=h,Qf(Q9,BT,nu),Ss(Q9,Us)<0&&pK(Us,Us),zh(Us,Us,Q9,i),xP(Us,Us),d=f=Ss(Qf(M0,t[0],nu),Us);for(let C=1;C<8;++C){const A=Ss(Qf(M0,t[C],nu),Us);A<d?d=A:A>f&&(f=A)}gs(r,nu),Lc(M0,Us,d-e),sp(r,r,M0);let m=-1,y=1,_=0,v=0;for(let C=0;C<8;++C){Qf(MA,t[C],r),xP(MA,MA);const A=Us[0]*MA[1]-Us[1]*MA[0];A>0?A>m&&(m=A,_=C):A<y&&(y=A,v=C)}TT(m>0,"leftArea"),TT(y<0,"rightArea"),Lc(VT,Us,d),sp(VT,VT,nu),Lc(GT,Us,f),sp(GT,GT,nu),gL[0]=-Us[1],gL[1]=Us[0];const w=SI(r,t[v],GT,sp(M0,GT,gL),1,n),x=SI(r,t[_],GT,M0,1,s),T=SI(r,t[_],VT,sp(M0,VT,gL),1,o),S=SI(r,t[v],VT,M0,1,a);TT(w,"rayRay"),TT(x,"rayRay"),TT(T,"rayRay"),TT(S,"rayRay")}function bi(t,e){return 3*e+t}const zle=Ge();function oc(t,e){return mi(zle,t[e],t[e+3]),zle}const Sl=Ge(),Xe=nn();function Kat(t,e,i,r,n){Qf(Sl,i,r),Lc(Sl,Sl,.5),Xe[0]=Sl[0],Xe[1]=Sl[1],Xe[2]=0,Xe[3]=Sl[1],Xe[4]=-Sl[0],Xe[5]=0,Xe[6]=Sl[0]*Sl[0]+Sl[1]*Sl[1],Xe[7]=Sl[0]*Sl[1]-Sl[1]*Sl[0],Xe[8]=1,Xe[bi(0,2)]=-Ss(oc(Xe,0),t),Xe[bi(1,2)]=-Ss(oc(Xe,1),t);let s=Ss(oc(Xe,0),i)+Xe[bi(0,2)],o=Ss(oc(Xe,1),i)+Xe[bi(1,2)],a=Ss(oc(Xe,0),r)+Xe[bi(0,2)],l=Ss(oc(Xe,1),r)+Xe[bi(1,2)];s=-(s+a)/(o+l),Xe[bi(0,0)]+=Xe[bi(1,0)]*s,Xe[bi(0,1)]+=Xe[bi(1,1)]*s,Xe[bi(0,2)]+=Xe[bi(1,2)]*s,s=1/(Ss(oc(Xe,0),i)+Xe[bi(0,2)]),o=1/(Ss(oc(Xe,1),i)+Xe[bi(1,2)]),Xe[bi(0,0)]*=s,Xe[bi(0,1)]*=s,Xe[bi(0,2)]*=s,Xe[bi(1,0)]*=o,Xe[bi(1,1)]*=o,Xe[bi(1,2)]*=o,Xe[bi(2,0)]=Xe[bi(1,0)],Xe[bi(2,1)]=Xe[bi(1,1)],Xe[bi(2,2)]=Xe[bi(1,2)],Xe[bi(1,2)]+=1,s=Ss(oc(Xe,1),e)+Xe[bi(1,2)],o=Ss(oc(Xe,2),e)+Xe[bi(2,2)],a=Ss(oc(Xe,1),i)+Xe[bi(1,2)],l=Ss(oc(Xe,2),i)+Xe[bi(2,2)],s=-.5*(s/o+a/l),Xe[bi(1,0)]+=Xe[bi(2,0)]*s,Xe[bi(1,1)]+=Xe[bi(2,1)]*s,Xe[bi(1,2)]+=Xe[bi(2,2)]*s,s=Ss(oc(Xe,1),e)+Xe[bi(1,2)],o=Ss(oc(Xe,2),e)+Xe[bi(2,2)],a=-o/s,Xe[bi(1,0)]*=a,Xe[bi(1,1)]*=a,Xe[bi(1,2)]*=a,n[0]=Xe[0],n[1]=Xe[1],n[2]=0,n[3]=Xe[2],n[4]=Xe[3],n[5]=Xe[4],n[6]=0,n[7]=Xe[5],n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=Xe[6],n[13]=Xe[7],n[14]=0,n[15]=Xe[8]}function Qat(t,e,i,r,n){const s=1/$h[0][3],o=1/$h[4][3];tt(s<o);let a=s+Math.sqrt(s*o);const l=Math.sin(Ys(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));a/=l,Jat($h,a,l,Lle,Dle,Zat,Nle,Fle),Kat(Lle,Dle,Nle,Fle,n.projectionMatrix),n.projectionMatrix[10]=2/(i-r),n.projectionMatrix[14]=-(i+r)/(i-r)}function elt(t){return Gp(t)&&t.intersector===Jr.TERRAIN&&!!t.target}let tlt=class extends cU{constructor(e,i,r){super(e,i),this.triangleNr=r}};function FAe(t){return Gp(t)&&t.intersector===Jr.OVERLAY&&!!t.target}let pW=class{constructor(){this.adds=new Ut,this.removes=new Ut,this.updates=new Ut({allocator:e=>e||new ilt,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},ilt=class{},rlt=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}};var Zr,Os;(function(t){t[t.ADD=0]="ADD",t[t.UPDATE=1]="UPDATE",t[t.REMOVE=2]="REMOVE"})(Zr||(Zr={})),function(t){t[t.NONE=0]="NONE",t[t.VISIBILITY=1]="VISIBILITY",t[t.GEOMETRY=2]="GEOMETRY",t[t.TRANSFORMATION=4]="TRANSFORMATION",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.OCCLUDEE=16]="OCCLUDEE"}(Os||(Os={}));function kAe(t){const e=new Map,i=r=>{let n=e.get(r);return n||(n=new rlt,e.set(r,n)),n};return t.removes.forAll(r=>{eB(r)&&i(r.material).removes.push(r)}),t.adds.forAll(r=>{eB(r)&&i(r.material).adds.push(r)}),t.updates.forAll(r=>{eB(r.renderGeometry)&&i(r.renderGeometry.material).updates.push(r)}),e}function eB(t){return t.geometry.indexCount>=1}let UAe=class{constructor(e,i){this._material=e,this._repository=i,this._map=new Map}dispose(){this._map.forEach((e,i)=>{e!=null&&this._repository.release(this._material,i)})}load(e,i,r){if(!this._material.produces(i,r))return null;this._map.has(r)||this._map.set(r,this._repository.acquire(this._material,i,r));const n=this._map.get(r);if(n!=null){if(n.ensureResources(e)===Lv.LOADED)return n;this._repository.requestRender()}return null}},fW=class extends VEe{constructor(e=E()){super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}};const nlt=Hr().vec3f(O.POSITION),slt=Hr().vec3f(O.POSITION).vec2f(O.UV0),olt=Hr().vec3f(O.POSITION).vec4u8(O.COLOR);Hr().vec3f(O.POSITION).vec4u8(O.OBJECTANDLAYERIDCOLOR);const alt=Hr().vec3f(O.POSITION).vec2f(O.UV0).vec4u8(O.OBJECTANDLAYERIDCOLOR);Hr().vec3f(O.POSITION).vec4u8(O.COLOR).vec4u8(O.OBJECTANDLAYERIDCOLOR);let KQ=class extends n1{intersect(e,i,r,n,s,o){return V2e(e,r,n,s,void 0,o)}};function Ble(t){t.fragment.uniforms.add(new et("texWaveNormal",e=>e.waveNormal),new et("texWavePerturbation",e=>e.wavePerturbation),new yi("waveParams",e=>Gr(llt,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset)),new Ki("waveDirection",e=>mi(clt,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity))),t.include(xot),t.fragment.code.add(b`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const llt=oi(),clt=Ge();function kP(t,e){e.spherical?t.vertex.code.add(b`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(b`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(b`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(b`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}function ult(t){const e=new Ei,{vertex:i,fragment:r}=e;zc(i,t),e.include(Xl,t),e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.UV0,"vec2");const n=new yi("waterColor",s=>s.color);if(t.output===F.Color&&t.isDraped)return e.varyings.add("vpos","vec3"),i.uniforms.add(n),i.code.add(b`
        void main(void) {
          if (waterColor.a < ${b.float(zo)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(n),r.code.add(b`void main() {
fragColor = waterColor;
}`),e;switch(t.output!==F.Color&&t.output!==F.Alpha||(e.include(kP,t),e.include(kC,t),e.varyings.add("vuv","vec2"),e.varyings.add("vpos","vec3"),e.varyings.add("vnormal","vec3"),e.varyings.add("vtbnMatrix","mat3"),t.multipassEnabled&&e.varyings.add("depth","float"),i.uniforms.add(n),i.code.add(b`
      void main(void) {
        if (waterColor.a < ${b.float(zo)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${t.output===F.Color?"forwardLinearDepth();":""}
      }
    `)),e.include(Xc,t),t.output){case F.Alpha:e.include(Dn,t),r.uniforms.add(n),r.code.add(b`
        void main() {
          discardBySlice(vpos);
          ${t.multipassEnabled?"terrainDepthTest(depth);":""}

          fragColor = vec4(waterColor.a);
        }
      `);break;case F.Color:e.include(_F),e.include(SK,{pbrMode:ot.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(Ble),e.include(Dn,t),e.include(Ox,t),e.include(oAe,t),r.uniforms.add(n,new Re("timeElapsed",s=>s.timeElapsed),i.uniforms.get("view"),i.uniforms.get("localOrigin")),Np(r,t),r.include(Wm),jy(r),Gm(r),r.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${t.receiveShadows?b`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        fragColor = delinearizeGamma(final);
        fragColor = highlightSlice(fragColor, vpos);
        ${t.transparencyPassType===it.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `);break;case F.Normal:e.include(kP,t),e.include(Ble,t),e.include(Dn,t),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),i.uniforms.add(n),i.code.add(b`
        void main(void) {
          if (waterColor.a < ${b.float(zo)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(new Re("timeElapsed",s=>s.timeElapsed)),r.code.add(b`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
fragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case F.Highlight:e.include(s1,t),e.varyings.add("vpos","vec3"),i.uniforms.add(n),i.code.add(b`
      void main(void) {
        if (waterColor.a < ${b.float(zo)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),e.include(Dn,t),r.code.add(b`void main() {
discardBySlice(vpos);
outputHighlight();
}`);break;case F.ObjectAndLayerIdColor:e.include(qM,t),e.varyings.add("vpos","vec3"),i.uniforms.add(n),i.code.add(b`
      void main(void) {
        if (waterColor.a < ${b.float(zo)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
        forwardObjectAndLayerIdColor();
      }
    `),e.include(Dn,t),r.code.add(b`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`)}return e}const hlt=Object.freeze(Object.defineProperty({__proto__:null,build:ult},Symbol.toStringTag,{value:"Module"}));let zAe=class BAe extends Fi{initializeConfiguration(e,i){i.spherical=e.viewingMode===Le.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Mi(e.rctx,BAe.shader.get().build(this.configuration),Si)}_setPipelineState(e){const i=this.configuration,r=e===it.NONE,n=e===it.FrontFace;return Lt({blending:i.output!==F.Normal&&i.output!==F.Highlight&&i.output!==F.ObjectAndLayerIdColor&&i.transparent?r?Xu:Zy(e):null,depthTest:{func:o1(e)},depthWrite:r?i.writeDepth?ec:null:BU(e),colorWrite:Gt,polygonOffset:r||n?null:jU(i.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};zAe.shader=new Pi(hlt,()=>ce(()=>import("./WaterSurface.glsl-be6ddad7.js"),[],import.meta.url));let zs=class extends fl{constructor(){super(...arguments),this.output=F.Color,this.transparencyPassType=it.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.objectAndLayerIdColorInstanced=!1,this.isDraped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}};u([U({count:F.COUNT})],zs.prototype,"output",void 0),u([U({count:it.COUNT})],zs.prototype,"transparencyPassType",void 0),u([U()],zs.prototype,"spherical",void 0),u([U()],zs.prototype,"receiveShadows",void 0),u([U()],zs.prototype,"hasSlicePlane",void 0),u([U()],zs.prototype,"transparent",void 0),u([U()],zs.prototype,"enableOffset",void 0),u([U()],zs.prototype,"writeDepth",void 0),u([U()],zs.prototype,"hasScreenSpaceReflections",void 0),u([U()],zs.prototype,"doublePrecisionRequiresObfuscation",void 0),u([U()],zs.prototype,"hasCloudsReflections",void 0),u([U()],zs.prototype,"objectAndLayerIdColorInstanced",void 0),u([U()],zs.prototype,"isDraped",void 0),u([U()],zs.prototype,"multipassEnabled",void 0),u([U()],zs.prototype,"cullAboveGround",void 0),u([U({constValue:!1})],zs.prototype,"occlusionPass",void 0),u([U({constValue:ot.Water})],zs.prototype,"pbrMode",void 0),u([U({constValue:!0})],zs.prototype,"useCustomDTRExponentForWater",void 0),u([U({constValue:!0})],zs.prototype,"highStepCount",void 0),u([U({constValue:!1})],zs.prototype,"useFillLights",void 0);let dlt=class extends i1{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){const i=e.ssr.lastFrameColor!=null;i!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:i})}_updateCloudsReflectionState(e){const i=e.cloudsFade.data!=null;i!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:i})}ensureResources(e){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(e)}beginSlot(e){return this._output===F.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(zAe,e)}},VAe=class extends KQ{constructor(e){super(e,new GAe),this._configuration=new zs,this._animation=new SSe}getConfiguration(e,i){return this._configuration.output=e,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.isDraped=this.parameters.isDraped,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<VU,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}update(e){const i=Math.min(e.camera.relativeElevation,e.camera.distance);this._animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*i<plt;const r=this._animation.advance(e);return this.setParameters({timeElapsed:DX(this._animation.time)*this.parameters.animationSpeed},!1),this._animation.enabled&&r}produces(e,i){switch(i){case F.Normal:return e===le.DRAPED_WATER;case F.Color:if(this.parameters.isDraped)return e===le.DRAPED_MATERIAL;break;case F.Alpha:break;case F.Highlight:case F.ObjectAndLayerIdColor:return e===le.OPAQUE_MATERIAL||e===le.DRAPED_MATERIAL;default:return!1}let r=le.OPAQUE_MATERIAL;return this.parameters.transparent&&(r=this.parameters.writeDepth?le.TRANSPARENT_MATERIAL:le.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===r}createGLMaterial(e){return new dlt(e)}createBufferWriter(){return new VC(ie("enable-feature:objectAndLayerId-rendering")?alt:slt)}get test(){return{animationEnabled:this._animation.enabled}}},GAe=class extends fQ{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=pi(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=Ft(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.origin=E(),this.modelTransformation=null}};const plt=35e3;let QQ=class{constructor(e=0,i=0){this.from=e,this.to=i}get numElements(){return this.to-this.from}};function Vle(t){const e=new Map;t.forAll(r=>e.set(r.from,r));let i=!0;for(;i;)i=!1,t.forEach(r=>{const n=e.get(r.to);n&&(r.to=n.to,e.delete(n.from),t.removeUnordered(n),i=!0)})}let Gle=class extends QQ{constructor(e,i,r){super(i,r),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.geometry.highlights!=null&&this.isVisible}get hasOccludees(){return this.geometry.occludees!=null}},flt=class{constructor(){this.first=0,this.count=0}},mlt=class{constructor(){this._numElements=0,this._instances=new Map,this.holes=new Ut({allocator:e=>e||new QQ,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=yL(),this.drawCommandsHighlight=yL(),this.drawCommandsOccludees=yL(),this.drawCommandsShadowHighlightRest=yL()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,i){this.deleteInstance(e),this._instances.set(e,i),this._numElements+=i.numElements}deleteInstance(e){const i=this._instances.get(e);i&&(this._numElements-=i.numElements,this._instances.delete(e))}updateInstance(e,i,r){const n=this._instances.get(e);n&&(this._numElements-=n.numElements,n.from=i,n.to=r,this._numElements+=n.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;if(!this.needsMultipleCommands()){const r=this.drawCommandsDefault.pushNew(),n=this.holes.front();return this.vao!=null&&this.holes.length===1&&n.to===Math.floor(this.vao.byteSize/e)?(r.first=0,void(r.count=n.from)):(r.first=1/0,r.count=0,this._instances.forEach(s=>{r.first=Math.min(r.first,s.from),r.count=Math.max(r.count,s.to)}),void(r.count-=r.first))}const i=Array.from(this._instances.values()).sort((r,n)=>r.from===n.from?r.to-n.to:r.from-n.from);for(const r of i)r.isVisible&&(jle(r.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,r),jle(r.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,r))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function glt(t){return t.vao!=null}function yL(){return new Ut({allocator:t=>t||new flt,deallocator:t=>t})}function jle(t,e){const i=t.back();if(i==null){const r=t.pushNew();return r.first=e.from,void(r.count=e.numElements)}if(ylt(i,e)){const r=e.from-i.first+e.numElements;i.count=r}else{const r=t.pushNew();r.first=e.from,r.count=e.numElements}}function ylt(t,e){return t.first+t.count>=e.from}let _lt=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach(e=>e.vao.dispose()),this.buffers.length=0}findBuffer(e){return this.buffers.find(i=>i.instances.has(e))}};const vlt=cR+1;let blt=class{constructor(e,i,r){this._rctx=e,this._locations=i,this._layout=r,this._cache=new DM(e.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(e){const i=e.toString();let r=this._cache.pop(i);return r||(r=new Hp(this._rctx,this._locations,{geometry:this._layout},{geometry:Ui.createVertex(this._rctx,Ri.STATIC_DRAW)}),r.vertexBuffers.geometry.setSize(e),r)}deleteVao(e){if(e==null)return;const i=e.byteSize.toString();this._cache.put(i,e,vlt)}},xR=class extends PSe{constructor(e){super(e),this._vaoCache=null,this._glMaterials=null,this._bufferWriter=null,this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this.priority=0,this.produces=new Map}dispose(){this._glMaterials=rt(this._glMaterials),this._dataByOrigin.forEach(e=>e.dispose()),this._dataByOrigin.clear(),this._vaoCache=rt(this._vaoCache)}initializeRenderContext(e,i){const{rctx:r}=e.renderContext;this._glMaterials=new UAe(this.material,i??e.materialRepository),this._bufferWriter=this.material.createBufferWriter(),this._vaoCache=new blt(r,this.material.vertexAttributeLocations,Kc(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this.material instanceof VAe}get isDecoration(){return this.material.parameters.isDecoration}get rendersOccluded(){return!this.isEmpty&&this.material.parameters.renderOccluded!==Vr.Occlude}get numGeometries(){let e=0;return this._dataByOrigin.forEach(i=>e+=i.buffers.reduce((r,n)=>r+n.instances.size,0)),e}get usedMemory(){let e=0;return this._dataByOrigin.forEach(i=>e+=i.buffers.reduce((r,n)=>r+n.vao.usedMemory,0)),e}forEachGeometry(e){this._dataByOrigin.forEach(i=>i.buffers.forEach(r=>r.instances.forEach(n=>e(n.geometry))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const i=this._bufferWriter;if(i===null)return;const r=i.vertexBufferLayout.stride/4;for(const n of e){const s=n.renderGeometry,o=this._dataByOrigin.get(s.localOrigin.id),a=o?.findBuffer(s.id);if(a==null)return;const l=a.instances.get(s.id);if(n.updateType&(Os.GEOMETRY|Os.TRANSFORMATION)){const c=bL(i.elementCount(l.geometry.geometry)*r),h=i.vertexBufferLayout.createView(c.buffer);this._writeGeometry(s,h,0),a.vao.vertexBuffers.geometry.setSubData(c,l.from*r,0,l.numElements*r)}n.updateType&(Os.HIGHLIGHT|Os.OCCLUDEE|Os.VISIBILITY)&&(a.drawCommandsDirty=!0)}}_computeDeltas(e,i){const r=new BC;for(const n of e){const s=n.localOrigin;if(s==null)continue;let o=r.get(s.id,null);o==null&&(o=new Hle(s.vec3),r.set(s.id,null,o)),o.changes.push(n)}for(const n of i){const s=n.localOrigin;if(s==null)continue;const o=this._dataByOrigin.get(s.id),a=o?.findBuffer(n.id);if(a==null)continue;let l=r.get(s.id,a);l==null&&(l=new Hle(s.vec3),r.set(s.id,a,l)),l.changes.push(n)}return r}_addAndRemoveGeometries(e,i){if(this._bufferWriter===null||this._vaoCache===null)return;const{_bufferWriter:r,_dataByOrigin:n}=this,s=r.vertexBufferLayout.stride/4,o=this._computeDeltas(e,i);o.forEach((a,l)=>{const c=a.get(null),h=c!=null?c.changes:[];o.delete(l,null);let d=n.get(l);if(a.forEach((f,m)=>{if(o.delete(l,m),m==null)return void tt(!1,"No VAO for removed geometries");if(m.instances.size===f.changes.length)return this._vaoCache.deleteVao(m.vao),WR(d.buffers,m),void(d.buffers.length===0&&h.length===0&&n.delete(l));const y=m.numElements,_=m.vao.byteSize/4,v=h.reduce((S,C)=>S+r.elementCount(C.geometry),0),w=f.changes.reduce((S,C)=>S+r.elementCount(C.geometry),0),x=Math.min((y+v-w)*s,vL),T=x>_;x>ek&&x<_/2?(f.changes.forEach(({id:S})=>m.deleteInstance(S)),m.instances.forEach(({geometry:S})=>h.push(S)),this._vaoCache.deleteVao(m.vao),WR(d.buffers,m)):T?this._applyAndRebuild(m,h,f):this._applyRemoves(m,f)}),h.length>0)for(d==null&&(d=new _lt(c.origin),n.set(l,d)),d.buffers.forEach(f=>this._applyAdds(f,h));h.length>0;)d.buffers.push(this._applyAndRebuild(new mlt,h,null))})}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.buffers.forEach(i=>{i.drawCommandsDirty&&(i.hasHiddenInstances=!1,i.hasHighlights=!1,i.hasOccludees=!1,$u(i.instances,r=>(i.updateDrawState(r),i.hasHiddenInstances&&i.hasHighlights&&i.hasOccludees)),i.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||i.hasHighlights,this._hasOccludees=this._hasOccludees||i.hasOccludees})})}_applyAndRebuild(e,i,r){if(r!=null)for(const y of r.changes)e.deleteInstance(y.id);const n=this._bufferWriter,s=n.vertexBufferLayout.stride,o=s/4,a=Math.floor(vL/o);let l=e.numElements;for(;i.length>0;){const y=i.pop(),_=n.elementCount(y.geometry);if(l+_>a&&l>0){i.push(y);break}l+=_;const v=new Gle(y,0,0);tt(e.instances.get(y.id)==null),e.addInstance(y.id,v)}const c=l*o,h=bL(c),d=n.vertexBufferLayout.createView(h.buffer);let f=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach((y,_)=>{this._writeGeometry(y.geometry,d,f);const v=f;f+=n.elementCount(y.geometry.geometry),e.updateInstance(_,v,f),e.updateDrawState(y)}),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(Yle(c)),e.vao.vertexBuffers.geometry.setSubData(h,0,0,f*o),e.holes.clear();const m=e.holes.pushNew();return m.from=f,m.to=Math.floor(e.vao.byteSize/s),e.updateDrawCommands(s),e}_applyRemoves(e,i){if(i.changes.length===0||this._bufferWriter===null)return;for(const a of i.changes){const l=a.id,c=e.instances.get(l);if(!c)continue;e.deleteInstance(l);const h=af.back();if(h){if(h.to===c.from){h.to=c.to;continue}if(h.from===c.to){h.from=c.from;continue}}const d=af.pushNew();d.from=c.from,d.to=c.to}Vle(af);const r=this._bufferWriter.vertexBufferLayout.stride/4,n=af.reduce((a,l)=>Math.max(a,l.numElements),0)*r,s=bL(n);s.fill(0,0,n);const o=e.vao.vertexBuffers.geometry;af.forAll(a=>o.setSubData(s,a.from*r,0,a.numElements*r)),e.holes.pushArray(af.data,af.length),af.forAll((a,l)=>af.data[l]=null),af.clear(),e.drawCommandsDirty=!0}_applyAdds(e,i){if(i.length===0||this._bufferWriter===null)return;if(!glt(e))return void this._applyAndRebuild(e,i,null);const r=this._bufferWriter,n=r.vertexBufferLayout.stride/4,s=e.numElements,o=i.reduce((w,x)=>w+r.elementCount(x.geometry),0),a=Math.min((s+o)*n,vL),l=4*a;if(e.vao.byteSize<Yle(vL-ek)&&l>e.vao.byteSize)return void this._applyAndRebuild(e,i,null);Vle(e.holes);const c=new Array;for(const w of i){const x=r.elementCount(w.geometry),T=wlt(e.holes,x);c.push(T)}const h=e.vao.vertexBuffers.geometry;let d=0,f=0,m=0;const y=bL(a),_=r.vertexBufferLayout.createView(y.buffer);i.forEach((w,x)=>{const T=c[x];if(T==null)return;if(m!==T){const A=m-f;A>0&&h.setSubData(y,f*n,0,A*n),f=T,d=0}const S=r.elementCount(w.geometry);this._writeGeometry(w,_,d),d+=S,m=T+S;const C=new Gle(w,T,T+S);tt(e.instances.get(w.id)==null),e.addInstance(w.id,C),e.drawCommandsDirty=!0});const v=m-f;v>0&&h.setSubData(y,f*n,0,v*n),QIe(i,(w,x)=>c[x]==null)}_writeGeometry(e,i,r){if(this._bufferWriter===null)return;const n=e.localOrigin.vec3;hYe(qle,-n[0],-n[1],-n[2]);const s=qi(xlt,qle,e.transformation);fs(_L,s),Hc(_L,_L),this._bufferWriter.write(s,_L,e.geometry,i,r)}updateAnimation(e){return this.material.update(e)}prepareTechnique(e){if(!this.material.shouldRender(e))return null;const{output:i,bindParameters:r}=e;if(!this.material.produces(r.slot,i))return null;const n=i===F.Highlight||i===F.ShadowHighlight;if(n&&!this._hasHighlights)return null;const s=i===F.ShadowExcludeHighlight,o=!(n||s);for(const a of this._dataByOrigin.values())for(const l of a.buffers){if(n&&!l.hasHighlights)continue;const c=(n?l.drawCommandsHighlight:s&&l.needsMultipleCommands()?l.drawCommandsShadowHighlightRest:l.drawCommandsDefault)||null,h=o&&l.drawCommandsOccludees||null;if(c?.length||h?.length){const d=this._glMaterials.load(e.rctx,r.slot,i),f=d!=null?d.beginSlot(r):null;if(f!=null)return f}}return null}renderNode(e,i){const{output:r,bindParameters:n}=e,s=r===F.Highlight||r===F.ShadowHighlight,o=r===F.ShadowExcludeHighlight,a=!(s||o),l=e.rctx,c=e.bindParameters.slot===le.OCCLUDER_MATERIAL,h=e.bindParameters.slot===le.TRANSPARENT_OCCLUDER_MATERIAL;l.runAppleAmdDriverHelper(),l.bindTechnique(i,this.material.parameters,n);for(const d of this._dataByOrigin.values())for(const f of d.buffers){if(s&&!f.hasHighlights)continue;const m=(s?f.drawCommandsHighlight:o&&f.needsMultipleCommands()?f.drawCommandsShadowHighlightRest:f.drawCommandsDefault)||null,y=a&&f.drawCommandsOccludees||null;(m?.length||y?.length)&&(i.program.bindDraw(new fW(d.origin),n,this.material.parameters),i.ensureAttributeLocations(f.vao),l.bindVAO(f.vao),m?.length&&(l.setPipelineState(i.getPipeline(!1,c,h)),m.forAll(_=>l.drawArrays(i.primitiveType,_.first,_.count))),y?.length&&(l.setPipelineState(i.getPipeline(!0,c,h)),y.forAll(_=>l.drawArrays(i.primitiveType,_.first,_.count))))}}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}};u([p({constructOnly:!0})],xR.prototype,"material",void 0),xR=u([M("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],xR);let Hle=class{constructor(e){this.origin=e,this.changes=new Array}};function wlt(t,e){let i;if(!t.some(n=>!(n.numElements<e)&&(i=n,!0)))return null;const r=i.from;return i.from+=e,i.from>=i.to&&t.removeUnordered(i),r}const qle=be(),xlt=be(),_L=be(),af=new Ut({allocator:t=>t||new QQ,deallocator:null}),ek=65536,tB=4*ek,Wle=1024,jAe=16777216,vL=jAe/4;let iB=new Float32Array(ek);function bL(t){return iB.length<t&&(iB=new Float32Array(t)),iB}function Yle(t){const e=4*t;return e<=Wle?Wle:e<tB?Gye(e):Math.max(Math.min(Math.ceil(1.5*e/tB)*tB,jAe),e)}let vu=class extends we{constructor(e){super(e),this._pending=new Tlt,this._changes=new pW,this._materialRenderers=new Ut,this._sortedMaterialRenderers=new Ut,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forAll(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._materialRenderers.some(e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.length===0&&this._geometries.size===0}getMemoryForMaterial(e){return e==null?0:this._materialRenderers.find(r=>r.material===e)?.usedMemory??0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=kAe(this._changes);let i=!1,r=!1,n=!1;return e.forEach((s,o)=>{let a=this._materialRenderers.find(h=>h.material===o);if(!a&&s.adds.length>0){const h=new xR({material:o});h.initializeRenderContext(this.rendererContext.pluginContext,this._materialRepository),a=h,this._materialRenderers.push(a),i=!0,r=!0,n=!0}if(!a)return;const l=r||a.hasHighlights,c=n||a.hasWater;a.modify(s),r=r||l!==a.hasHighlights,n=n||c!==a.hasWater,a.isEmpty&&(this._materialRenderers.removeUnordered(a),a.dispose(),i=!0)}),this._changes.clear(),i&&this._updateSortedMaterialRenderers(),r&&(this._hasHighlights=this._materialRenderers.some(s=>s.hasHighlights)),n&&(this._hasWater=this._materialRenderers.some(s=>s.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,i){if(e.length===0)return;const r=this._validateRenderGeometries(e);for(const s of r)this._geometries.set(s.id,s);const n=this._pending.empty;for(const s of r)this._pending.adds.add(s);n&&this.notifyChange("updating"),i===Zr.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,i){const r=this._pending.empty,n=this._pending.adds;for(const s of e)n.has(s)?(this._pending.removed.add(s),n.delete(s)):this._pending.removed.has(s)||this._pending.removes.add(s),this._geometries.delete(s.id);r&&!this._pending.empty&&this.notifyChange("updating"),i===Zr.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,i){const r=this._changes.updates.length===0;for(const n of e){const s=this._changes.updates.pushNew();s.renderGeometry=this._validateRenderGeometry(n),s.updateType=i}switch(r&&this._changes.updates.length>0&&this.notifyChange("updating"),i){case Os.TRANSFORMATION:case Os.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case Os.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let i=!1;return this._sortedMaterialRenderers.forAll(r=>i=r.updateAnimation(e)||i),i}shouldRender(e){return this._sortedMaterialRenderers.some(i=>i.prepareTechnique(e))}render(e){this._sortedMaterialRenderers.forAll(i=>{const r=i.prepareTechnique(e);r!=null&&i.renderNode(e,r)})}intersect(e,i,r,n,s){return this._geometries.forEach(o=>{if(n&&!n(o))return;this._intersectRenderGeometry(o,r,i,0,e,s);const a=this.rendererContext.longitudeCyclical;a&&(o.boundingSphere[0]-o.boundingSphere[3]<a.min&&this._intersectRenderGeometry(o,r,i,a.range,e,s),o.boundingSphere[0]+o.boundingSphere[3]>a.max&&this._intersectRenderGeometry(o,r,i,-a.range,e,s)),s++}),s}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear(),this._materialRenderers.forAll((e,i)=>{e.priority=i,this._sortedMaterialRenderers.push(e)}),this._sortedMaterialRenderers.sort((e,i)=>i.material.renderPriority===e.material.renderPriority?e.priority-i.priority:i.material.renderPriority-e.material.renderPriority)}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const i=this._changes.updates.data[e];this._pending.has(i.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,i,r,n,s,o){if(!e.visible)return;let a=0;n+=e.transformation[12],a=e.transformation[13],rB[0]=r[0]-n,rB[1]=r[1]-a,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,s,rB,(l,c,h)=>{Slt(i,h,e.material.renderPriority,o,s,e.layerUid,e.graphicUid)},i)}_notifyGraphicGeometryChanged(e){if(this.drapeSource.notifyGraphicGeometryChanged==null)return;let i;for(const r of e){const n=r.graphicUid;n!=null&&n!==i&&(this.drapeSource.notifyGraphicGeometryChanged(n),i=n)}}_notifyGraphicVisibilityChanged(e){if(this.drapeSource.notifyGraphicVisibilityChanged==null)return;let i;for(const r of e){const n=r.graphicUid;n!=null&&n!==i&&(this.drapeSource.notifyGraphicVisibilityChanged(n),i=n)}}_validateRenderGeometries(e){for(const i of e)this._validateRenderGeometry(i);return e}_validateRenderGeometry(e){return e.localOrigin==null&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};u([p()],vu.prototype,"drapeSource",void 0),u([p()],vu.prototype,"updating",null),u([p()],vu.prototype,"rctx",null),u([p({constructOnly:!0})],vu.prototype,"rendererContext",void 0),u([p()],vu.prototype,"_materialRepository",null),u([p()],vu.prototype,"_localOriginFactory",null),u([p({readOnly:!0})],vu.prototype,"isEmpty",null),u([p()],vu.prototype,"_materialRenderers",void 0),u([p()],vu.prototype,"_geometries",void 0),vu=u([M("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],vu);let Tlt=class{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};function Slt(t,e,i,r,n,s,o){const a=new tlt(s,o,e),l=c=>{c.set(Jr.OVERLAY,a,t.dist,t.normal,t.transformation,i,r)};if((n.results.min.drapedLayerOrder==null||i>=n.results.min.drapedLayerOrder)&&(n.results.min.dist==null||n.results.ground.dist<=n.results.min.dist)&&l(n.results.min),n.options.store!==Bo.MIN&&(n.results.max.drapedLayerOrder==null||i<n.results.max.drapedLayerOrder)&&(n.results.max.dist==null||n.results.ground.dist>n.results.max.dist)&&l(n.results.max),n.options.store===Bo.ALL){const c=iK(n.ray);l(c),n.results.all.push(c)}}const rB=Ge();let eee=class HAe extends Fi{initializeProgram(e){return new Mi(e.rctx,HAe.shader.get().build(),Si)}initializePipeline(){return this.configuration.hasAlpha?Lt({blending:Go(Te.SRC_ALPHA,Te.ONE,Te.ONE_MINUS_SRC_ALPHA,Te.ONE_MINUS_SRC_ALPHA),colorWrite:Gt}):Lt({colorWrite:Gt})}};eee.shader=new Pi(Rot,()=>ce(()=>import("./TextureOnly.glsl-8f5ffd26.js"),[],import.meta.url));let tee=class extends tc{constructor(){super(...arguments),this.hasAlpha=!1}};u([U()],tee.prototype,"hasAlpha",void 0);let qAe=class extends or{constructor(){super(...arguments),this.overlayIndex=os.INNER,this.opacity=1}};function Elt(){const t=new Ei;return t.include(Na),t.fragment.uniforms.add(new et("tex",e=>e.texture)),t.fragment.uniforms.add(new JM("overlayIdx",e=>e.overlayIndex)),t.fragment.uniforms.add(new Re("opacity",e=>e.opacity)),t.fragment.code.add(b`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;
}`),t}const Clt=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:qAe,build:Elt},Symbol.toStringTag,{value:"Module"}));let WAe=class YAe extends Fi{initializeProgram(e){return new Mi(e.rctx,YAe.shader.get().build(),Si)}initializePipeline(){return Lt({blending:Yc(Te.ONE,Te.ONE_MINUS_SRC_ALPHA),colorWrite:Gt})}};WAe.shader=new Pi(Clt,()=>ce(()=>import("./OverlayCompositing.glsl-10e37dcd.js"),[],import.meta.url));let Gd=class extends Qx{get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new qAe,this.hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new Ut,this._passParameters=new lAe,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new ft,this.worldToPCSRatio=1,this.events=new Sn,this.longitudeCyclical=null,this.produces=new Map([[le.DRAPED_MATERIAL,i=>i!==F.Highlight||this.hasHighlights],[le.DRAPED_WATER,()=>!0]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const e=this.view._stage.renderer.fboCache,i=this.view._stage.renderView,{waterTextureRepository:r,stippleTextureRepository:n,markerTextureRepository:s}=i;this._shaderTechniqueRepository=new cAe({rctx:this._rctx,viewingMode:Le.Local,stippleTextureRepository:n,markerTextureRepository:s,waterTextureRepository:r}),this._renderContext=new NAe(this._rctx,new JQ(e,this.view.state.viewingMode),null),this.addHandles([ne(()=>r.updating,()=>this.events.emit("content-changed"),Ji),ne(()=>this.spatialReference,o=>this._localOriginFactory=new ZQ(o),Ji),bo(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new uAe(i.textureRepository,this._shaderTechniqueRepository,o=>{(o.parameters.renderOccluded&tk)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed")),this._bindParameters.slot=le.DRAPED_MATERIAL,this._bindParameters.mainDepth=mXe(this._rctx),this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=it.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new CK(Oe(1,1,1))]),this.addHandles(this.view.resourceController.scheduler.registerTask(pt.STAGE,this))}destroy(){this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._debugTextureTechnique=li(this._debugTextureTechnique),this._passParameters.texture=rt(this._passParameters.texture),this._bindParameters.mainDepth=rt(this._bindParameters.mainDepth),this._shaderTechniqueRepository=$e(this._shaderTechniqueRepository),this.disposeOverlays()}initializeRenderContext(e){this.pluginContext=e}uninitializeRenderContext(){}renderNode(){}get updating(){return this._sortedDrapeSourceRenderersDirty||$u(this._renderers,e=>e.updating)}get hasOverlays(){return this._overlays!=null&&this._renderTargets!=null}getMemoryForMaterial(e){return Array.from(this._renderers.values()).reduce((i,r)=>i+r.getMemoryForMaterial(e),0)}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,vu)}createDrapeSourceRenderer(e,i,r){const n=this._renderers.get(e);n?.destroy();const s=new i({...r,rendererContext:this,drapeSource:e});return this._renderers.set(e,s),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles(ne(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),s}removeDrapeSourceRenderer(e){if(e==null)return;const i=this._renderers.get(e);i!=null&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),i.destroy())}computeValidity(){return this._renderTargets?.computeValidity()??0}releaseRenderTargets(){this._renderTargets?.dispose()}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&jD(e,i=>i.drapeTargetType===cW.WithoutRasterImage)}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=jD(e,i=>i.drapeSourceType===vR.Features),this._hasDrapedRasterSource=jD(e,i=>i.drapeSourceType===vR.RasterImage)):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,i,r=this._bindParameters.overlayStretch){this._overlays==null&&(this._renderTargets=new _ot(this.view._stage.renderer.fboCache),this._overlays=[new wle,new wle]),this.ensureDrapeTargets(e),this.ensureDrapeSources(i),this._bindParameters.overlayStretch=r}disposeOverlays(){this._overlays=null,this._renderTargets=rt(this._renderTargets),this.events.emit("textures-disposed")}getTexture(e){if(e!=null)return e===jr.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?this._renderTargets?.getTexture(jr.Color):this._renderTargets?.getTexture(e)}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,i){let r=!1;for(const[n,s]of this._renderers){if(e.done)break;(n.destroyed||i(n))&&s.commitChanges()&&(r=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers()),r&&(this._overlays!=null&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=$u(this._renderers,n=>n.hasHighlights),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(hl,e=>e.updatePolicy===dv.SYNC)}get isEmpty(){return!pr.OVERLAY_DRAW_DEBUG_TEXTURE&&!$u(this._renderers,e=>!e.isEmpty)}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}get mode(){return this.isEmpty?cm.Disabled:this._renderTargets?.getTexture(jr.WaterNormal)?cm.EnabledWithWater:this._renderTargets?.getTexture(jr.Color)?cm.Enabled:cm.Disabled}updateAnimation(e){let i=!1;return this._renderers.forEach(r=>i=r.updateAnimation(e)||i),i}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawOverlays(e){if(this._overlays&&this._renderTargets){for(const i of this._overlays)this.longitudeCyclical?i.setupGeometryViewsCyclical(this.longitudeCyclical):i.setupGeometryViewsDirect();for(const i of this._renderTargets.targets)(i.content!==jr.ColorNoRasterImage||this._needsColorWithoutRasterImage)&&(this._drawTarget(os.INNER,i,e),this._drawTarget(os.OUTER,i,e))}}_drawTarget(e,i,r){const n=this._overlays[e],s=n.canvasGeometries;if(s.numViews===0)return;const{alignPixelEnabled:o,contentPixelRatio:a}=r;this._screenToWorldRatio=a*n.mapUnitsPerPixel/this._bindParameters.overlayStretch;const l=i.output;if(this.isEmpty||l===F.Highlight&&!this.hasHighlights||l===F.Normal&&!this.hasWater||!n.hasSomeSizedView())return;const c=this._rctx;this._camera.pixelRatio=n.pixelRatio*a,this._renderContext.output=l,this._bindParameters.alignPixelEnabled=o,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=l===F.Normal?le.DRAPED_WATER:le.DRAPED_MATERIAL;const h=pr.OVERLAY_DRAW_DEBUG_TEXTURE&&i.content!==jr.Occluded;if(!h&&!this._sortedRenderers.some(({renderer:_})=>_.shouldRender(this._renderContext)))return;const d=n.resolution;this._rctx.setViewport(e===os.INNER?0:d,0,d,d);const f=2*n.resolution,m=n.resolution,y=i.fbo;if(y.bind(c,f,m),e===os.INNER&&(c.setClearColor(0,0,0,0),c.clearSafe(wr.COLOR_BUFFER_BIT)),i.content===jr.Occluded&&(this._renderContext.renderOccludedMask=tk),h)for(let _=0;_<s.numViews;_++)this._setViewParameters(s.extents[_],n),this._ensureDebugPatternResources(n.resolution,Olt[e]),this._rctx.bindTechnique(this._debugTextureTechnique,this._passParameters,null),this._rctx.screen.draw();this._sortedRenderers.forAll(({drapeSource:_,renderer:v})=>{if(i.content===jr.ColorNoRasterImage&&_.drapeSourceType===vR.RasterImage)return;const{fullOpacity:w}=_,x=w!=null&&w<1&&l===F.Color?this.bindTemporaryFramebuffer(f,m):null;for(let T=0;T<s.numViews;T++)this._setViewParameters(s.extents[T],n),v.render(this._renderContext);if(x){y.bind(c,f,m),this._overlayParameters.texture=x.colorTexture,this._overlayParameters.opacity=w,this._overlayParameters.overlayIndex=e;const T=this.pluginContext.techniqueRepository.acquire(WAe);this._rctx.bindTechnique(T,this._overlayParameters,this._renderContext.bindParameters),this._rctx.screen.draw(),T.release(),x.release()}}),c.bindFramebuffer(null),e===os.OUTER&&y.generateMipMap(),this._renderContext.resetRenderOccludedMask()}bindTemporaryFramebuffer(e,i){const r=this.view._stage.renderer.fboCache,n=r.acquire(xi.RGBA,e,i);return r.rctx.bindFramebuffer(n.fbo),r.rctx.clearSafe(wr.COLOR_BUFFER_BIT),n}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,i,r,n){let s=0;for(const o of this._renderers.values())s=o.intersect?.(e,i,r,n,s)??s}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers;this._renderers.forEach((i,r)=>{const n=e.indexOf(r.layer),s=n>=0,o=this._renderers.size*(r.renderGroup??(s?YF.MapLayer:YF.ViewLayer))+(s?n:0);this._sortedRenderers.push(new Alt(r,i,o))}),this._sortedRenderers.sort((i,r)=>i.index-r.index)}_setViewParameters(e,i){const r=this._camera;r.viewport=[0,0,i.resolution,i.resolution],n0e(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),gM(r.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=$u(this._renderers,i=>i.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateRendersOccluded(){const e=$u(this._renderers,i=>i.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_ensureDebugPatternResources(e,i){if(ae(this._passParameters.color,i[0],i[1],i[2]),this._passParameters.texture)return;const r=new Uint8Array(e*e*4);let n=0;for(let a=0;a<e;a++)for(let l=0;l<e;l++){const c=Math.floor(l/10),h=Math.floor(a/10);c<2||h<2||10*c>e-20||10*h>e-20?(r[n++]=255,r[n++]=255,r[n++]=255,r[n++]=255):(r[n++]=255,r[n++]=255,r[n++]=255,r[n++]=1&c&&1&h?1&l^1&a?0:255:1&c^1&h?0:128)}const s=new Hi(e);s.samplingMode=zt.NEAREST,this._passParameters.texture=new Nt(this._rctx,s,r);const o=new tee;o.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(eee,o)}get test(){return{drapedRenderers:Array.from(this._renderers.values()),getDrapeSourceRenderer:e=>this._renderers.get(e)}}};u([p()],Gd.prototype,"hasHighlights",void 0),u([p()],Gd.prototype,"_sortedDrapeSourceRenderersDirty",void 0),u([p({autoDestroy:!0})],Gd.prototype,"_shaderTechniqueRepository",void 0),u([p({constructOnly:!0})],Gd.prototype,"view",void 0),u([p()],Gd.prototype,"worldToPCSRatio",void 0),u([p()],Gd.prototype,"spatialReference",void 0),u([p({type:Boolean,readOnly:!0})],Gd.prototype,"updating",null),u([p()],Gd.prototype,"isEmpty",null),Gd=u([M("esri.views.3d.terrain.OverlayRenderer")],Gd);let Alt=class{constructor(e,i,r){this.drapeSource=e,this.renderer=i,this.index=r}};const Olt=[[1,.5,.5],[.5,.5,1]],iee=-2,tk=Vr.OccludeAndTransparent;function ree(t,e,i,r){const n=t$(t.rings,!!t.hasZ,Im.CCW_IS_HOLE,t.spatialReference),s=_o(n.position.length),o=TEe(n.position,t.spatialReference,0,s,0,n.position,0,n.position.length/3,e,i,r),a=o!=null;return new Mlt(n.position,s,JAe(n.polygons,n.position,s),ZAe(n.outlines,n.position,s),a,o)}function XAe(t,e){const i=t$(t.rings,!1,Im.CCW_IS_HOLE),r=rn(i.position,t.spatialReference,0,i.position,e,0,i.position.length/3);for(let n=2;n<i.position.length;n+=3)i.position[n]=iee;return{position:i.position,polygons:JAe(i.polygons,i.position),outlines:ZAe(i.outlines,i.position),projectionSuccess:r}}function ZAe(t,e,i=null){return t.filter(({count:r})=>r>1).map(({index:r,count:n})=>{const s=3*r,o=3*n;return i!=null?new KAe(r,n,Xh(e,s,o),Xh(i,s,o)):new nee(r,n,Xh(e,s,o))})}function JAe(t,e,i=null){const r=new Array;for(const{index:n,count:s,holeIndices:o,pathLengths:a}of t){if(s<=1)continue;const l=3*n,c=3*s,h=o.map(f=>f-n),d=i!=null?new Rlt(n,s,Xh(e,3*n,3*s),Xh(i,l,c),h,a):new Plt(n,s,Xh(e,3*n,3*s),h,a);r.push(d)}return r}let nee=class{constructor(e,i,r){this.index=e,this.count=i,this.position=r}},KAe=class extends nee{constructor(e,i,r,n){super(e,i,r),this.mapPositions=n}},Rlt=class extends KAe{constructor(e,i,r,n,s,o){super(e,i,r,n),this.holeIndices=s,this.pathLengths=o}},Plt=class extends nee{constructor(e,i,r,n,s){super(e,i,r),this.holeIndices=n,this.pathLengths=s}},Mlt=class{constructor(e,i,r,n,s,o){this.position=e,this.mapPositions=i,this.polygons=r,this.outlines=n,this.projectionSuccess=s,this.sampledElevation=o}};function Mx(t,e,i,r,n,s=2){const o=1/(Math.abs(i)+Math.abs(r)+Math.abs(n)),a=i*o,l=r*o,c=n<=0?(a>=0?1:-1)*(1-Math.abs(l)):a,h=n<=0?(l>=0?1:-1)*(1-Math.abs(a)):l,d=e*s;t[d]=Xle(c),t[d+1]=Xle(h)}function $lt(t){const e=t.length/3,i=new Int16Array(2*e);let r=0;for(let n=0;n<e;++n)Mx(i,n,t[r++],t[r++],t[r++]);return i}function Ilt(t,e,i,r=2){const n=i*r,s=Zle(e[n]),o=Zle(e[n+1]),a=1-Math.abs(s)-Math.abs(o);t[2]=a,a<0?(t[0]=(s>=0?1:-1)*(1-Math.abs(o)),t[1]=(o>=0?1:-1)*(1-Math.abs(s))):(t[0]=s,t[1]=o),ye(t,t)}function Xle(t){return _e(Math.round(32767*t),-32767,32767)}function Zle(t){return _e(t/32767,-1,1)}const Llt=["polygon","extent"];let Dlt=class extends Xm{constructor(e,i,r,n){super(e,i,r,n),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const a=qU(this._getSymbolSize());if(a)throw new G("graphics3dextrudesymbollayer:invalid-size",a)}const e=this.symbolLayer?.material?.color,i=this._getCombinedOpacityAndColor(e),r=Ta(i),n=i[3],s=n<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:r,ambient:r,opacity:n,transparent:s,cullFace:s?xr.None:xr.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0,normalType:Ni.Compressed};this._materials[bu.Main]=new kp(o),this._materials[bu.Bottom]=new kp({...o,cullFace:xr.Back}),this._context.stage.addMany(this._materials)}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,Llt,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),n=this.setGraphicElevationContext(i);return this._createAs3DShape(i,e.renderingInfo,r,n,i.uid)}layerOpacityChanged(e,i){const r=this.symbolLayer?.material?.color,n=this._getCombinedOpacity(r),s=n<1||this.needsDrivenTransparentPass;this._materials[bu.Main]?.setParameters({opacity:n,transparent:s}),this._materials[bu.Bottom]?.setParameters({opacity:n,transparent:s});const o=this._getLayerOpacity();e.forEach(a=>{const l=i(a);l?.layerOpacityChanged(o,this._context.isAsync)})}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,Vv)}slicePlaneEnabledChanged(e,i){return this._materials[bu.Main]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._materials[bu.Bottom]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach(r=>{const n=i(r);n?.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const e={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0};return this._materials[bu.Main]?.setParameters(e),this._materials[bu.Bottom]?.setParameters(e),!0}_getExtrusionSize(e){let i;return i=e.size&&this._drivenProperties.size?oot(e.size,2)??0:this._getSymbolSize(),i/=this._context.renderCoordsHelper.unitInMeters,i}applyRendererDiff(e,i){return this._drivenPropertiesChanged(i)?Kn.RecreateSymbol:Kn.RecreateGraphics}async queryForSnapping(e,i,r,n){const s=this._getExtrusionSize(r)*this._context.renderCoordsHelper.unitInMeters/M5(i),{objectId:o,target:a}=e,l=Q(a);switch(l.z=(l.z??0)+s,e.type){case"edge":{const{start:c,end:h}=e,d=Q(c),f=Q(h);return d.z=(d.z??0)+s,f.z=(f.z??0)+s,[gle(o,l,1/0,d,f)]}case"vertex":return[qst(o,l,1/0),gle(o,a,1/0,a,l)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,i,r,n,s){const o=NP(e.geometry);if(o==null)return null;if(o.rings.length===0||!o.rings.some(D=>D.length>0))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;const a=ree(o,this._context.elevationProvider,this._context.renderCoordsHelper,n);this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer");const l=wQ(o);if(l==null)return null;const c=new Array,h=new Array,d=ks(),f=be(),m=E(),y=this._context.renderCoordsHelper.viewingMode===Le.Global;y||this._context.renderCoordsHelper.worldUpAtPosition(null,m),Bc(o.spatialReference,[l.x,l.y,0],f,this._context.renderCoordsHelper.spatialReference);const _=be();fs(_,f);const v=nn();Oy(v,_);const{polygons:w,mapPositions:x,position:T}=a;for(const D of w){const N=D.count;if(this._context.clippingExtent&&(Pr(d),ku(d,D.mapPositions),!vp(d,this._context.clippingExtent)))continue;const k=uC(D.mapPositions,D.holeIndices,3);if(k.length===0)continue;const B=k.length,L=6*N,z=EF(L+B),j=EF(B),H=_o(3*L),X=_o(3*L),P=_o(3*L),I=_o(L);Nlt(T,x,k,D,H,P,X,I,z,j,this._getExtrusionSize(i),m,y),zp(H,H,_);const V=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),q=new Blt(H,P,$lt(X),I);c.push(Jle(this._materials[bu.Main],z,z.length-j.length,q,r,V),Jle(this._materials[bu.Bottom],j,0,q,r,V)),h.push(q.heights)}if(c.length===0)return null;const S=new Jy({geometries:c,layerUid:this._context.layer.uid,graphicUid:s,isElevationSource:!0});S.transformation=f;const C=UEe(this.symbolLayer,{opacity:this._getLayerOpacity()}),A=C!=null?{baseMaterial:this._materials[bu.Main],edgeMaterials:[C],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,R=new Ym(this,S,c,null,null,(D,N,k,B,L)=>Ult(D,N,k,B,L,h),n,A);return R.alignedSampledElevation=a.sampledElevation,R.needsElevationUpdates=Vv(n.mode),R}};function Jle(t,e,i,r,n,s){const o=r1(e.length),a=[[O.POSITION,new Ve(r.positions,e,3,!0)],[O.NORMALCOMPRESSED,new Ve(r.normals,e,2,!0)],[O.COLOR,new Ve(n,o,4,!0)]];return new ms(t,a,r.elevation,wn.Mesh,s,i)}function Nlt(t,e,i,r,n,s,o,a,l,c,h,d,f){const m=i.length/3;let y=0,_=2*r.count;Flt(t,e,r.index,r.count,i,0,m,n,s,o,a,l,c,_,h,d,f);let v=2*r.count;_=0,Kle(n,s,a,o,y,r.pathLengths[0],r.count,v,l,_,h),v+=4*r.pathLengths[0],_+=2*r.pathLengths[0],y+=r.pathLengths[0];for(let w=1;w<r.pathLengths.length;++w)Kle(n,s,a,o,y,r.pathLengths[w],r.count,v,l,_,h),v+=4*r.pathLengths[w],_+=2*r.pathLengths[w],y+=r.pathLengths[w]}function Flt(t,e,i,r,n,s,o,a,l,c,h,d,f,m,y,_,v){oe(El,_);const w=y>0?1:-1;let x=3*i,T=0,S=3*T,C=r,A=3*C;for(let N=0;N<r;++N)v&&(El[0]=t[x],El[1]=t[x+1],El[2]=t[x+2],ye(El,El)),a[S]=t[x],a[S+1]=t[x+1],a[S+2]=t[x+2],l[S]=e[x],l[S+1]=e[x+1],l[S+2]=e[x+2],c[S]=-w*El[0],c[S+1]=-w*El[1],c[S+2]=-w*El[2],h[T]=0,a[A]=t[x]+y*El[0],a[A+1]=t[x+1]+y*El[1],a[A+2]=t[x+2]+y*El[2],l[A]=e[x],l[A+1]=e[x+1],l[A+2]=e[x+2],c[A]=w*El[0],c[A+1]=w*El[1],c[A+2]=w*El[2],h[C]=y,S+=3,A+=3,x+=3,T+=1,C+=1;x=3*s,S=0,A=3*m;const R=y<0?nce:rce,D=y<0?rce:nce;for(let N=0;N<o;++N)f[S]=n[x+R[0]],f[S+1]=n[x+R[1]],f[S+2]=n[x+R[2]],d[A]=n[x+D[0]]+r,d[A+1]=n[x+D[1]]+r,d[A+2]=n[x+D[2]]+r,S+=3,A+=3,x+=3}function wL(t,e,i,r,n,s,o){r[s]=r[o],o*=3,t[s*=3]=t[o],t[s+1]=t[o+1],t[s+2]=t[o+2],e[s]=e[o],e[s+1]=e[o+1],e[s+2]=e[o+2],i[s]=n[0],i[s+1]=n[1],i[s+2]=n[2]}const $A=E();function Kle(t,e,i,r,n,s,o,a,l,c,h){let d=n,f=n+1,m=n+o,y=n+o+1,_=a,v=a+1,w=a+2*s,x=a+2*s+1;h<0&&(d=n+o+1,y=n),c*=3;for(let T=0;T<s;++T)T===s-1&&(h>0?(f=n,y=n+o):(f=n,d=n+o)),klt(t,d,f,m,$A),wL(t,e,r,i,$A,_,d),wL(t,e,r,i,$A,v,f),wL(t,e,r,i,$A,w,m),wL(t,e,r,i,$A,x,y),l[c++]=_,l[c++]=w,l[c++]=x,l[c++]=_,l[c++]=x,l[c++]=v,d++,f++,m++,y++,_+=2,v+=2,w+=2,x+=2}const nB=E(),Qle=E(),ece=E(),tce=E(),ice=E();function klt(t,e,i,r,n){e*=3,i*=3,r*=3,ae(nB,t[e++],t[e++],t[e++]),ae(Qle,t[i++],t[i++],t[i++]),ae(ece,t[r++],t[r++],t[r++]),de(tce,Qle,nB),de(ice,ece,nB),lt(n,ice,tce),ye(n,n)}const jT=E();function Ult(t,e,i,r,n,s){const o=t.stageObject,a=o.geometries,l=a.length,c=e.mode!=="absolute-height";let h=0;const d=o.transformation,f=xC(be(),d);for(let m=0;m<l;m+=2){const y=a[m];if(!TQ(y))continue;const _=y.getMutableAttribute(O.POSITION).data,v=s[m/2],w=new nK(y.mapPositions),x=_.length/3;let T=0,S=!1,C=0;for(let A=0;A<x;A++){jT[0]=_[T],jT[1]=_[T+1],jT[2]=_[T+2],r(w,xL),c&&(C+=xL.sampledElevation),pr.TESTS_DISABLE_OPTIMIZATIONS?(ae(ac,w.array[w.offset],w.array[w.offset+1],xL.z+v[T/3]),i!=null&&n.toRenderCoords(ac,i,ac),ke(ac,ac,f)):(ae(ac,_[T],_[T+1],_[T+2]),ke(ac,ac,d),n.setAltitude(ac,xL.z+v[T/3]),ke(ac,ac,f)),_[T]=ac[0],_[T+1]=ac[1],_[T+2]=ac[2];const R=zlt/n.unitInMeters;(Math.abs(jT[0]-_[T])>=R||Math.abs(jT[1]-_[T+1])>=R||Math.abs(jT[2]-_[T+2])>=R)&&(S=!0),w.offset+=3,T+=3}S&&(y.invalidateBoundingInfo(),o.geometryVertexAttributeUpdated(a[m],O.POSITION),a[m+1].invalidateBoundingInfo(),o.geometryVertexAttributeUpdated(a[m+1],O.POSITION)),h+=C/x}return h/l}const ac=E(),El=E(),xL=new XM,rce=[0,2,1],nce=[0,1,2],zlt=.01;var bu;(function(t){t[t.Main=0]="Main",t[t.Bottom=1]="Bottom"})(bu||(bu={}));class Blt{constructor(e,i,r,n){this.positions=e,this.elevation=i,this.normals=r,this.heights=n}}var sce,oce,mW={exports:{}};mW.exports,oce=function(){function t(n,s){function o(){this.constructor=n}o.prototype=s.prototype,n.prototype=new o}function e(n,s,o,a){var l=Error.call(this,n);return Object.setPrototypeOf&&Object.setPrototypeOf(l,e.prototype),l.expected=s,l.found=o,l.location=a,l.name="SyntaxError",l}function i(n,s,o){return o=o||" ",n.length>s?n:(s-=n.length,n+(o+=o.repeat(s)).slice(0,s))}function r(n,s){var o,a={},l=(s=s!==void 0?s:{}).grammarSource,c={start:Jm},h=Jm,d="none",f=")",m=",",y="(",_="%",v="px",w="cm",x="mm",T="in",S="pt",C="pc",A="deg",R="rad",D="grad",N="turn",k="#",B=".",L="e",z=/^[ \t\n\r]/,j=/^[a-z\-]/,H=/^[0-9a-fA-F]/,X=/^[+\-]/,P=/^[0-9]/,I=_l("none"),V=Js("none",!1),q=Js(")",!1),Y=Js(",",!1),J=_l("whitespace"),ee=u1([" ","	",`
`,"\r"],!1,!1),me=_l("function"),Me=Js("(",!1),yt=_l("identifier"),St=u1([["a","z"],"-"],!1,!1),ct=_l("percentage"),vt=Js("%",!1),je=_l("length"),he=Js("px",!1),At=Js("cm",!1),ve=Js("mm",!1),Fe=Js("in",!1),st=Js("pt",!1),_t=Js("pc",!1),Et=_l("angle"),$t=Js("deg",!1),qe=Js("rad",!1),Ot=Js("grad",!1),Jt=Js("turn",!1),Gi=_l("number"),dt=_l("color"),mt=Js("#",!1),ht=u1([["0","9"],["a","f"],["A","F"]],!1,!1),Kt=u1(["+","-"],!1,!1),Ht=u1([["0","9"]],!1,!1),Er=Js(".",!1),Qi=Js("e",!1),ui=function(){return[]},$i=function(W,fe){return{type:"function",name:W,parameters:fe||[]}},$r=function(W,fe){return fe.length>0?YC(W,fe,3):[W]},Cr=function(W){return{type:"quantity",value:W.value,unit:W.unit}},Ar=function(W){return{type:"color",colorType:W.type,value:W.value}},ki=function(W){return W},qr=function(){return ic()},Yi=function(W){return{value:W,unit:"%"}},fr=function(W){return{value:W,unit:"px"}},ar=function(W){return{value:W,unit:"cm"}},vi=function(W){return{value:W,unit:"mm"}},mr=function(W){return{value:W,unit:"in"}},Wr=function(W){return{value:W,unit:"pt"}},xo=function(W){return{value:W,unit:"pc"}},To=function(W){return{value:W,unit:"deg"}},So=function(W){return{value:W,unit:"rad"}},Eo=function(W){return{value:W,unit:"grad"}},sn=function(W){return{value:W,unit:"turn"}},Yr=function(W){return{value:W,unit:null}},er=function(){return{type:"hex",value:ic()}},Xs=function(W){return{type:"function",value:W}},qo=function(){return{type:"named",value:ic()}},Fa=function(){return parseFloat(ic())},se=0,Ir=0,gd=[{line:1,column:1}],Zs=0,yd=[],Ke=0;if("startRule"in s){if(!(s.startRule in c))throw new Error(`Can't start parsing from rule "`+s.startRule+'".');h=c[s.startRule]}function ic(){return n.substring(Ir,se)}function Js(W,fe){return{type:"literal",text:W,ignoreCase:fe}}function u1(W,fe,Ee){return{type:"class",parts:W,inverted:fe,ignoreCase:Ee}}function h1(){return{type:"end"}}function _l(W){return{type:"other",description:W}}function Zm(W){var fe,Ee=gd[W];if(Ee)return Ee;for(fe=W-1;!gd[fe];)fe--;for(Ee={line:(Ee=gd[fe]).line,column:Ee.column};fe<W;)n.charCodeAt(fe)===10?(Ee.line++,Ee.column=1):Ee.column++,fe++;return gd[W]=Ee,Ee}function d1(W,fe,Ee){var gi=Zm(W),ls=Zm(fe),Or={source:l,start:{offset:W,line:gi.line,column:gi.column},end:{offset:fe,line:ls.line,column:ls.column}};return Ee&&l&&typeof l.offset=="function"&&(Or.start=l.offset(Or.start),Or.end=l.offset(Or.end)),Or}function ei(W){se<Zs||(se>Zs&&(Zs=se,yd=[]),yd.push(W))}function r0(W,fe,Ee){return new e(e.buildMessage(W,fe),W,fe,Ee)}function Jm(){var W;return(W=n0())===a&&(W=ka()),W}function n0(){var W,fe;return Ke++,W=se,pn(),n.substr(se,4)===d?(fe=d,se+=4):(fe=a,Ke===0&&ei(V)),fe!==a?(pn(),Ir=W,W=ui()):(se=W,W=a),Ke--,W===a&&Ke===0&&ei(I),W}function ka(){var W,fe;if(W=[],(fe=rc())!==a)for(;fe!==a;)W.push(fe),fe=rc();else W=a;return W}function rc(){var W,fe,Ee,gi;return W=se,pn(),(fe=s0())!==a?(pn(),(Ee=Xp())===a&&(Ee=null),pn(),n.charCodeAt(se)===41?(gi=f,se++):(gi=a,Ke===0&&ei(q)),gi!==a?(pn(),Ir=W,W=$i(fe,Ee)):(se=W,W=a)):(se=W,W=a),W}function Xp(){var W,fe,Ee,gi,ls,Or,Ua,g1;if(W=se,(fe=Ks())!==a){for(Ee=[],gi=se,ls=pn(),n.charCodeAt(se)===44?(Or=m,se++):(Or=a,Ke===0&&ei(Y)),Or===a&&(Or=null),Ua=pn(),(g1=Ks())!==a?gi=ls=[ls,Or,Ua,g1]:(se=gi,gi=a);gi!==a;)Ee.push(gi),gi=se,ls=pn(),n.charCodeAt(se)===44?(Or=m,se++):(Or=a,Ke===0&&ei(Y)),Or===a&&(Or=null),Ua=pn(),(g1=Ks())!==a?gi=ls=[ls,Or,Ua,g1]:(se=gi,gi=a);Ir=W,W=$r(fe,Ee)}else se=W,W=a;return W}function Ks(){var W,fe;return W=se,(fe=f1())===a&&(fe=aT())===a&&(fe=m1())===a&&(fe=o0()),fe!==a&&(Ir=W,fe=Cr(fe)),(W=fe)===a&&(W=se,(fe=x$())!==a&&(Ir=W,fe=Ar(fe)),W=fe),W}function pn(){var W,fe;for(Ke++,W=[],z.test(n.charAt(se))?(fe=n.charAt(se),se++):(fe=a,Ke===0&&ei(ee));fe!==a;)W.push(fe),z.test(n.charAt(se))?(fe=n.charAt(se),se++):(fe=a,Ke===0&&ei(ee));return Ke--,fe=a,Ke===0&&ei(J),W}function s0(){var W,fe,Ee;return Ke++,W=se,(fe=p1())!==a?(n.charCodeAt(se)===40?(Ee=y,se++):(Ee=a,Ke===0&&ei(Me)),Ee!==a?(Ir=W,W=ki(fe)):(se=W,W=a)):(se=W,W=a),Ke--,W===a&&(fe=a,Ke===0&&ei(me)),W}function p1(){var W,fe,Ee;if(Ke++,W=se,fe=[],j.test(n.charAt(se))?(Ee=n.charAt(se),se++):(Ee=a,Ke===0&&ei(St)),Ee!==a)for(;Ee!==a;)fe.push(Ee),j.test(n.charAt(se))?(Ee=n.charAt(se),se++):(Ee=a,Ke===0&&ei(St));else fe=a;return fe!==a&&(Ir=W,fe=qr()),Ke--,(W=fe)===a&&(fe=a,Ke===0&&ei(yt)),W}function f1(){var W,fe,Ee;return Ke++,W=se,pn(),(fe=vl())!==a?(n.charCodeAt(se)===37?(Ee=_,se++):(Ee=a,Ke===0&&ei(vt)),Ee!==a?(Ir=W,W=Yi(fe)):(se=W,W=a)):(se=W,W=a),Ke--,W===a&&Ke===0&&ei(ct),W}function aT(){var W,fe,Ee;return Ke++,W=se,pn(),(fe=vl())!==a?(n.substr(se,2)===v?(Ee=v,se+=2):(Ee=a,Ke===0&&ei(he)),Ee!==a?(Ir=W,W=fr(fe)):(se=W,W=a)):(se=W,W=a),W===a&&(W=se,pn(),(fe=vl())!==a?(n.substr(se,2)===w?(Ee=w,se+=2):(Ee=a,Ke===0&&ei(At)),Ee!==a?(Ir=W,W=ar(fe)):(se=W,W=a)):(se=W,W=a),W===a&&(W=se,pn(),(fe=vl())!==a?(n.substr(se,2)===x?(Ee=x,se+=2):(Ee=a,Ke===0&&ei(ve)),Ee!==a?(Ir=W,W=vi(fe)):(se=W,W=a)):(se=W,W=a),W===a&&(W=se,pn(),(fe=vl())!==a?(n.substr(se,2)===T?(Ee=T,se+=2):(Ee=a,Ke===0&&ei(Fe)),Ee!==a?(Ir=W,W=mr(fe)):(se=W,W=a)):(se=W,W=a),W===a&&(W=se,pn(),(fe=vl())!==a?(n.substr(se,2)===S?(Ee=S,se+=2):(Ee=a,Ke===0&&ei(st)),Ee!==a?(Ir=W,W=Wr(fe)):(se=W,W=a)):(se=W,W=a),W===a&&(W=se,pn(),(fe=vl())!==a?(n.substr(se,2)===C?(Ee=C,se+=2):(Ee=a,Ke===0&&ei(_t)),Ee!==a?(Ir=W,W=xo(fe)):(se=W,W=a)):(se=W,W=a)))))),Ke--,W===a&&Ke===0&&ei(je),W}function m1(){var W,fe,Ee;return Ke++,W=se,(fe=vl())!==a?(n.substr(se,3)===A?(Ee=A,se+=3):(Ee=a,Ke===0&&ei($t)),Ee!==a?(Ir=W,W=To(fe)):(se=W,W=a)):(se=W,W=a),W===a&&(W=se,(fe=vl())!==a?(n.substr(se,3)===R?(Ee=R,se+=3):(Ee=a,Ke===0&&ei(qe)),Ee!==a?(Ir=W,W=So(fe)):(se=W,W=a)):(se=W,W=a),W===a&&(W=se,(fe=vl())!==a?(n.substr(se,4)===D?(Ee=D,se+=4):(Ee=a,Ke===0&&ei(Ot)),Ee!==a?(Ir=W,W=Eo(fe)):(se=W,W=a)):(se=W,W=a),W===a&&(W=se,(fe=vl())!==a?(n.substr(se,4)===N?(Ee=N,se+=4):(Ee=a,Ke===0&&ei(Jt)),Ee!==a?(Ir=W,W=sn(fe)):(se=W,W=a)):(se=W,W=a)))),Ke--,W===a&&(fe=a,Ke===0&&ei(Et)),W}function o0(){var W,fe;return Ke++,W=se,pn(),(fe=vl())!==a?(Ir=W,W=Yr(fe)):(se=W,W=a),Ke--,W===a&&Ke===0&&ei(Gi),W}function x$(){var W,fe,Ee,gi;if(Ke++,W=se,n.charCodeAt(se)===35?(fe=k,se++):(fe=a,Ke===0&&ei(mt)),fe!==a){if(Ee=[],H.test(n.charAt(se))?(gi=n.charAt(se),se++):(gi=a,Ke===0&&ei(ht)),gi!==a)for(;gi!==a;)Ee.push(gi),H.test(n.charAt(se))?(gi=n.charAt(se),se++):(gi=a,Ke===0&&ei(ht));else Ee=a;Ee!==a?(Ir=W,W=er()):(se=W,W=a)}else se=W,W=a;return W===a&&(W=se,(fe=rc())!==a&&(Ir=W,fe=Xs(fe)),(W=fe)===a&&(W=se,(fe=p1())!==a&&(Ir=W,fe=qo()),W=fe)),Ke--,W===a&&(fe=a,Ke===0&&ei(dt)),W}function vl(){var W,fe,Ee,gi,ls,Or,Ua;for(W=se,X.test(n.charAt(se))?(n.charAt(se),se++):Ke===0&&ei(Kt),fe=se,Ee=[],P.test(n.charAt(se))?(gi=n.charAt(se),se++):(gi=a,Ke===0&&ei(Ht));gi!==a;)Ee.push(gi),P.test(n.charAt(se))?(gi=n.charAt(se),se++):(gi=a,Ke===0&&ei(Ht));if(n.charCodeAt(se)===46?(gi=B,se++):(gi=a,Ke===0&&ei(Er)),gi!==a){if(ls=[],P.test(n.charAt(se))?(Or=n.charAt(se),se++):(Or=a,Ke===0&&ei(Ht)),Or!==a)for(;Or!==a;)ls.push(Or),P.test(n.charAt(se))?(Or=n.charAt(se),se++):(Or=a,Ke===0&&ei(Ht));else ls=a;ls!==a?fe=Ee=[Ee,gi,ls]:(se=fe,fe=a)}else se=fe,fe=a;if(fe===a)if(fe=[],P.test(n.charAt(se))?(Ee=n.charAt(se),se++):(Ee=a,Ke===0&&ei(Ht)),Ee!==a)for(;Ee!==a;)fe.push(Ee),P.test(n.charAt(se))?(Ee=n.charAt(se),se++):(Ee=a,Ke===0&&ei(Ht));else fe=a;if(fe!==a){if(Ee=se,n.charCodeAt(se)===101?(gi=L,se++):(gi=a,Ke===0&&ei(Qi)),gi!==a){if(X.test(n.charAt(se))?(ls=n.charAt(se),se++):(ls=a,Ke===0&&ei(Kt)),ls===a&&(ls=null),Or=[],P.test(n.charAt(se))?(Ua=n.charAt(se),se++):(Ua=a,Ke===0&&ei(Ht)),Ua!==a)for(;Ua!==a;)Or.push(Ua),P.test(n.charAt(se))?(Ua=n.charAt(se),se++):(Ua=a,Ke===0&&ei(Ht));else Or=a;Or!==a?Ee=gi=[gi,ls,Or]:(se=Ee,Ee=a)}else se=Ee,Ee=a;Ee===a&&(Ee=null),Ir=W,W=Fa()}else se=W,W=a;return W}function WC(W,fe){return W.map(function(Ee){return Ee[fe]})}function YC(W,fe,Ee){return[W].concat(WC(fe,Ee))}if((o=h())!==a&&se===n.length)return o;throw o!==a&&se<n.length&&ei(h1()),r0(yd,Zs<n.length?n.charAt(Zs):null,Zs<n.length?d1(Zs,Zs+1):d1(Zs,Zs))}return t(e,Error),e.prototype.format=function(n){var s="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<n.length;o++)if(n[o].source===this.location.source){a=n[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(l):l,h=this.location.source+":"+c.line+":"+c.column;if(a){var d=this.location.end,f=i("",c.line.toString().length," "),m=a[l.line-1],y=(l.line===d.line?d.column:m.length+1)-l.column||1;s+=`
 --> `+h+`
`+f+` |
`+c.line+" | "+m+`
`+f+" | "+i("",l.column-1," ")+i("",y,"^")}else s+=`
 at `+h}return s},e.buildMessage=function(n,s){var o={literal:function(m){return'"'+l(m.text)+'"'},class:function(m){var y=m.parts.map(function(_){return Array.isArray(_)?c(_[0])+"-"+c(_[1]):c(_)});return"["+(m.inverted?"^":"")+y.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(m){return m.description}};function a(m){return m.charCodeAt(0).toString(16).toUpperCase()}function l(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function c(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function h(m){return o[m.type](m)}function d(m){var y,_,v=m.map(h);if(v.sort(),v.length>0){for(y=1,_=1;y<v.length;y++)v[y-1]!==v[y]&&(v[_]=v[y],_++);v.length=_}switch(v.length){case 1:return v[0];case 2:return v[0]+" or "+v[1];default:return v.slice(0,-1).join(", ")+", or "+v[v.length-1]}}function f(m){return m?'"'+l(m)+'"':"end of input"}return"Expected "+d(n)+" but "+f(s)+" found."},{SyntaxError:e,parse:r}},(sce=mW).exports&&(sce.exports=oce());var Vlt=mW.exports;function QAe(t){if(!t||t.length===0)return null;if(typeof t=="string"){const i=ace(t);return i&&i.length!==0?i:null}const e=t.map(i=>{if(!Number.isFinite(i.scale)||i.scale<=0)throw new G("effect:invalid-scale","scale must be finite and greater than 0",{stop:i});return{scale:i.scale,effects:ace(i.value)}});e.sort((i,r)=>r.effects.length-i.effects.length);for(let i=0;i<e.length-1;i++){if(!gke(e[i].effects,e[i+1].effects))throw new G("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[i].effects,b:e[i+1].effects});yke(e[i].effects,e[i+1].effects)}return e.sort((i,r)=>r.scale-i.scale),e}function ace(t){let e;if(!t)return[];try{e=Vlt.parse(t)}catch(i){throw new G("effect:invalid-syntax","Invalid effect syntax",{value:t,error:i})}return e.map(i=>Glt(i))}function Glt(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return jlt(t);case"opacity":return Hlt(t);case"hue-rotate":return qlt(t);case"blur":return Wlt(t);case"drop-shadow":return Ylt(t);case"bloom":return Xlt(t)}}catch(e){throw e.details.filter=t,e}throw new G("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function jlt(t){let e=1;return jC(t.parameters,1),t.parameters.length===1&&(e=lp(t.parameters[0])),new q7(t.name,e)}function Hlt(t){let e=1;return jC(t.parameters,1),t.parameters.length===1&&(e=lp(t.parameters[0])),new g0e(e)}function qlt(t){let e=0;return jC(t.parameters,1),t.parameters.length===1&&(e=tct(t.parameters[0])),new f0e(e)}function Wlt(t){let e=0;return jC(t.parameters,1),t.parameters.length===1&&(e=aee(t.parameters[0]),r$(e,t.parameters[0])),new c0e(e)}function Ylt(t){const e=[];let i=null;for(const r of t.parameters)if(r.type==="color"){if(e.length&&Object.freeze(e),i)throw new G("effect:type-error","Accepts only one color",{});i=ict(r)}else{const n=aee(r);if(Object.isFrozen(e))throw new G("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(n),e.length===3&&r$(n,r)}if(e.length<2||e.length>3)throw new G("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new d0e(e[0],e[1],e[2]||0,i||e3e("black"))}function Xlt(t){let e=1,i=0,r=0;return jC(t.parameters,3),t.parameters[0]&&(e=lp(t.parameters[0])),t.parameters[1]&&(i=aee(t.parameters[1]),r$(i,t.parameters[1])),t.parameters[2]&&(r=lp(t.parameters[2])),new a0e(e,i,r)}function jC(t,e){if(t.length>e)throw new G("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function o8(t){if(t.type==="color")return"<color>";if(t.unit){if(t.unit in oee)return"<length>";if(t.unit in see)return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function r$(t,e){if(t<0)throw new G("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function Zlt(t){if(t.type!=="quantity"||t.unit!==null)throw new G("effect:type-error",`Expected <double>, Actual: ${o8(t)}`,{term:t})}function Jlt(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new G("effect:type-error",`Expected <double> or <percentage>, Actual: ${o8(t)}`,{term:t})}const see={deg:1,grad:.9,rad:180/Math.PI,turn:360};function Klt(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&see[t.unit]!=null))throw new G("effect:type-error",`Expected <angle>, Actual: ${o8(t)}`,{term:t})}const oee={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function Qlt(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&oee[t.unit]!=null))throw new G("effect:type-error",`Expected <length>, Actual: ${o8(t)}`,{term:t})}function lp(t){Jlt(t);const e=t.value;return r$(e,t),t.unit==="%"?.01*e:e}function ect(t){return Zlt(t),r$(t.value,t),t.value}function tct(t){return Klt(t),t.value*see[t.unit]||0}function aee(t){return Qlt(t),t.value*oee[t.unit]||0}function ict(t){switch(t.colorType){case"hex":return V5e(t.value);case"named":return e3e(t.value);case"function":return sct(t.value)}}function e3e(t){if(!Sye(t))throw new G("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return B5e(t)}const rct=/^rgba?/i,nct=/^hsla?/i;function sct(t){if(jC(t.parameters,4),rct.test(t.name))return[lp(t.parameters[0]),lp(t.parameters[1]),lp(t.parameters[2]),t.parameters[3]?lp(t.parameters[3]):1];if(nct.test(t.name))return Eye(ect(t.parameters[0]),lp(t.parameters[1]),lp(t.parameters[2]),t.parameters[3]?lp(t.parameters[3]):1);throw new G("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}function lee(t,e,i){try{return act(t)}catch(r){i?.messages?.push(r)}return null}function cee(t,e,i,r){try{const n=oct(t);Mp(i,n,e)}catch(n){r.messages&&r.messages.push(n)}}function oct(t){const e=QAe(t);return e?_ke(e)?e.map(i=>i.toJSON()):e.map(({scale:i,effects:r})=>({scale:i,value:r.map(n=>n.toJSON())})):null}function act(t){if(!t||t.length===0)return null;if(lct(t)){const e=[];for(const i of t)e.push({scale:i.scale,value:gW(i.value)});return e}return gW(t)}function lct(t){const e=t[0];return!!e&&"scale"in e}function gW(t){if(!t?.length)return"";const e=[];for(const i of t){let r=[];switch(i.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":r=[og(i,"amount")];break;case"blur":r=[og(i,"radius","pt")];break;case"hue-rotate":r=[og(i,"angle","deg")];break;case"drop-shadow":r=[og(i,"xoffset","pt"),og(i,"yoffset","pt"),og(i,"blurRadius","pt"),cct(i,"color")];break;case"bloom":r=[og(i,"strength"),og(i,"radius","pt"),og(i,"threshold")]}const n=`${i.type}(${r.filter(Boolean).join(" ")})`;QAe(n),e.push(n)}return e.join(" ")}function og(t,e,i){if(t[e]==null)throw new G("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});return i?t[e]+i:""+t[e]}function cct(t,e){if(t[e]==null)throw new G("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});const i=t[e];return`rgba(${i[0]||0}, ${i[1]||0}, ${i[2]||0}, ${i[3]/255||0})`}function uct(t){return typeof t=="function"}function Y6t(t,e,i,r){return uct(t)?t(e,i,r):t}function X6t(t){return[t.r,t.g,t.b,t.a]}const hct=` /-,
`;function lce(t){let e=t.length;for(;e--;)if(!hct.includes(t.charAt(e)))return!1;return!0}function dct(t,e){const i=[];let r=0,n=-1;do if(n=t.indexOf("[",r),n>=r){if(n>r){const s=t.substr(r,n-r);i.push([s,null,lce(s)])}if(r=n+1,n=t.indexOf("]",r),n>=r){if(n>r){const s=e[t.substr(r,n-r)];s&&i.push([null,s,!1])}r=n+1}}while(n!==-1);if(r<t.length-1){const s=t.substr(r);i.push([s,null,lce(s)])}return i}function pct(t,e,i){let r="",n=null;for(const s of e){const[o,a,l]=s;if(o)l?n=o:(n&&(r+=n,n=null),r+=o);else{const c=t.attributes[a];c&&(n&&(r+=n,n=null),r+=c)}}return fct(r,i)}function Z6t(t,e,i){const r=dct(e,t);return n=>pct(n,r,i)}function fct(t,e){switch(typeof t!="string"&&(t=String(t)),e){case"LowerCase":return t.toLowerCase();case"Allcaps":return t.toUpperCase();default:return t}}function J6t(t,e,i,r,n,s,o=!0){const a=e/n,l=i/s,c=Math.ceil(a/2),h=Math.ceil(l/2);for(let d=0;d<s;d++)for(let f=0;f<n;f++){const m=4*(f+(o?s-d-1:d)*n);let y=0,_=0,v=0,w=0,x=0,T=0,S=0;const C=(d+.5)*l;for(let A=Math.floor(d*l);A<(d+1)*l;A++){const R=Math.abs(C-(A+.5))/h,D=(f+.5)*a,N=R*R;for(let k=Math.floor(f*a);k<(f+1)*a;k++){let B=Math.abs(D-(k+.5))/c;const L=Math.sqrt(N+B*B);L>=-1&&L<=1&&(y=2*L*L*L-3*L*L+1,y>0&&(B=4*(k+A*e),S+=y*t[B+3],v+=y,t[B+3]<255&&(y=y*t[B+3]/250),w+=y*t[B],x+=y*t[B+1],T+=y*t[B+2],_+=y))}}r[m]=w/_,r[m+1]=x/_,r[m+2]=T/_,r[m+3]=S/v}}function t3e(t){return t?{r:t[0],g:t[1],b:t[2],a:t[3]/255}:{r:0,g:0,b:0,a:0}}function i3e(t){return t.data?.symbol??null}function yW(t){return t.type==="CIMVectorMarker"||t.type==="CIMPictureMarker"||t.type==="CIMBarChartMarker"||t.type==="CIMCharacterMarker"||t.type==="CIMPieChartMarker"||t.type==="CIMStackedBarChartMarker"}function _W(t){return t.type==="CIMGradientStroke"||t.type==="CIMPictureStroke"||t.type==="CIMSolidStroke"}function mct(t){return t!=null&&(t.type==="CIMGradientFill"||t.type==="CIMHatchFill"||t.type==="CIMPictureFill"||t.type==="CIMSolidFill"||t.type==="CIMWaterFill")}function ik(t){return t!=null&&(t.type==="CIMMarkerPlacementAlongLineRandomSize"||t.type==="CIMMarkerPlacementAlongLineSameSize"||t.type==="CIMMarkerPlacementAlongLineVariableSize"||t.type==="CIMMarkerPlacementAtExtremities"||t.type==="CIMMarkerPlacementAtMeasuredUnits"||t.type==="CIMMarkerPlacementAtRatioPositions"||t.type==="CIMMarkerPlacementOnLine"||t.type==="CIMMarkerPlacementOnVertices")}const K6t=(t,e=0)=>t==null||isNaN(t)?e:t,Q6t=t=>t.tintColor?t3e(t.tintColor):{r:255,g:255,b:255,a:1},eUt=t=>{if(!t)return!1;for(const e of t)switch(e.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function tUt(){return ce(()=>import("./geometryEngineJSON-0f73783f.js"),["./geometryEngineJSON-0f73783f.js","./geometryEngineBase-f6af2696.js","./geometryEngineJSON-84b52367.js","./json-48e3ea08.js"],import.meta.url)}function iUt(t){if(!t)return"normal";switch(t.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function rUt(t){if(!t)return"normal";switch(t.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function nUt(t){let e="normal",i="normal";if(t){const r=t.toLowerCase();r.includes("italic")?e="italic":r.includes("oblique")&&(e="oblique"),r.includes("bold")?i="bold":r.includes("light")&&(i="lighter")}return{style:e,weight:i}}function sUt(t){return t.underline?"underline":t.strikethrough?"line-through":"none"}function cce(t){if(!t)return null;switch(t.type){case"CIMPolygonSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const i=cce(e);if(i!=null)return i}break;case"CIMTextSymbol":return cce(t.symbol);case"CIMSolidFill":return t.color}}function uce(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const e=t.symbolLayers;if(e)for(const i of e){const r=uce(i);if(r!=null)return r}break}case"CIMTextSymbol":return uce(t.symbol);case"CIMSolidStroke":return t.color}}function hce(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const i=hce(e);if(i!==void 0)return i}break;case"CIMTextSymbol":return hce(t.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return t.width}}function oUt(t){switch(t){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function aUt(t){switch(t){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function lUt(t){return(t?Object.keys(t):[]).map(e=>({name:e,alias:e,type:typeof t[e]=="string"?"esriFieldTypeString":"esriFieldTypeDouble"}))}const cUt=t=>t.includes("data:image/svg+xml");function uUt(t){if(!t)return null;switch(t.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function r3e(t,e,i,r){if(t)if(t.type!=="CIMTextSymbol"){if(i&&t.effects)for(const n of t.effects)_ct(n,e);if(t.symbolLayers)for(const n of t.symbolLayers)switch(n.type){case"CIMPictureMarker":case"CIMVectorMarker":gct(n,e,r);break;case"CIMPictureStroke":case"CIMSolidStroke":!r?.preserveOutlineWidth&&n.width&&(n.width*=e);break;case"CIMPictureFill":n.height&&(n.height*=e),n.offsetX&&(n.offsetX*=e),n.offsetY&&(n.offsetY*=e);break;case"CIMHatchFill":r3e(n.lineSymbol,e,!0,{...r,preserveOutlineWidth:!1}),n.offsetX&&(n.offsetX*=e),n.offsetY&&(n.offsetY*=e),n.separation&&(n.separation*=e)}}else t.height!=null&&(t.height*=e)}function gct(t,e,i){if(t&&(t.markerPlacement&&yct(t.markerPlacement,e),t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.anchorPoint&&t.anchorPointUnits==="Absolute"&&(t.anchorPoint={x:t.anchorPoint.x*e,y:t.anchorPoint.y*e}),t.size=t.size!=null?t.size*e:0,t.type==="CIMVectorMarker"&&t.markerGraphics))for(const r of t.markerGraphics)t.scaleSymbolsProportionally||r3e(r.symbol,e,!0,i)}function yct(t,e){switch(ik(t)&&t.offset&&(t.offset*=e),t.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.placementTemplate&&t.placementTemplate.length){const i=t.placementTemplate.map(r=>r*e);t.placementTemplate=i}break;case"CIMMarkerPlacementAlongLineVariableSize":if(t.maxRandomOffset&&(t.maxRandomOffset*=e),t.placementTemplate&&t.placementTemplate.length){const i=t.placementTemplate.map(r=>r*e);t.placementTemplate=i}break;case"CIMMarkerPlacementOnLine":t.startPointOffset&&(t.startPointOffset*=e);break;case"CIMMarkerPlacementAtExtremities":t.offsetAlongLine&&(t.offsetAlongLine*=e);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":t.beginPosition&&(t.beginPosition*=e),t.endPosition&&(t.endPosition*=e);break;case"CIMMarkerPlacementPolygonCenter":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMMarkerPlacementInsidePolygon":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.stepX&&(t.stepX*=e),t.stepY&&(t.stepY*=e)}}function _ct(t,e){switch(t.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":t.width&&(t.width*=e);break;case"CIMGeometricEffectBuffer":t.size&&(t.size*=e);break;case"CIMGeometricEffectCut":t.beginCut&&(t.beginCut*=e),t.endCut&&(t.endCut*=e),t.middleCut&&(t.middleCut*=e);break;case"CIMGeometricEffectDashes":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.dashTemplate&&t.dashTemplate.length){const i=t.dashTemplate.map(r=>r*e);t.dashTemplate=i}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":t.length&&(t.length*=e);break;case"CIMGeometricEffectMove":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":t.offset&&(t.offset*=e);break;case"CIMGeometricEffectRegularPolygon":t.radius&&(t.radius*=e);break;case"CIMGeometricEffectTaperedPolygon":t.fromWidth&&(t.fromWidth*=e),t.length&&(t.length*=e),t.toWidth&&(t.toWidth*=e);break;case"CIMGeometricEffectWave":t.amplitude&&(t.amplitude*=e),t.period&&(t.period*=e)}}function n3e(t){const e=[];return vW(i3e(t),e),e.length?new Pe(t3e(e[0])):null}function vW(t,e){if(!t)return;let i;i=t.type==="CIMTextSymbol"?t.symbol:t;const r=t.type==="CIMPolygonSymbol";if(i?.symbolLayers){for(const n of i.symbolLayers)if(!(n.colorLocked||r&&(_W(n)||yW(n)&&n.markerPlacement&&ik(n.markerPlacement))))switch(n.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":n.tintColor&&dce(e,n.tintColor);break;case"CIMVectorMarker":n.markerGraphics?.forEach(s=>{vW(s.symbol,e)});break;case"CIMSolidStroke":case"CIMSolidFill":dce(e,n.color);break;case"CIMHatchFill":vW(n.lineSymbol,e)}}}function dce(t,e){for(const i of t)if(i.join(".")===e.join("."))return;t.push(e)}function hUt(t,e,i){e instanceof Pe||(e=new Pe(e));const r=i3e(t);r&&bW(r,e,i)}function bW(t,e,i){if(!t)return;let r;r=t.type==="CIMTextSymbol"?t.symbol:t;const n=r?.type==="CIMPolygonSymbol";if(r?.symbolLayers)for(const s of r.symbolLayers){if(s.colorLocked)continue;if(n){if(i){const{layersToColor:a}=i;if((_W(s)||yW(s)&&s.markerPlacement&&ik(s.markerPlacement))&&a==="fill"||mct(s)&&a==="outline")continue}else if(_W(s)||yW(s)&&s.markerPlacement&&ik(s.markerPlacement))continue}const o=e.toArray();switch(s.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":s.tintColor=o;break;case"CIMVectorMarker":s.markerGraphics?.forEach(a=>{bW(a.symbol,e,i)});break;case"CIMSolidStroke":case"CIMSolidFill":s.color=o;break;case"CIMHatchFill":bW(s.lineSymbol,e,i)}}}let s3e=class{constructor(e,i){this._storage=new rTe,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),i&&this._storage.registerRemoveFunc("",i)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,i,r=1){this._storage.put(this,e,i,r,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}};const o3e="picture-fill",a3e="simple-fill",vct="simple-line",l3e="simple-marker",bct="text",wct="cim",sB=new s3e(1e3);function pUt(t){const e=t.style;let i=null;if(t)switch(t.type){case l3e:e!=="cross"&&e!=="x"&&(i=t.color);break;case a3e:e==="solid"?i=t.color:e!=="none"&&(i={type:"pattern",x:0,y:0,src:ur(`esri/symbols/patterns/${e}.png`),width:5,height:5});break;case o3e:i={type:"pattern",src:t.url,width:Jn(t.width)*t.xscale,height:Jn(t.height)*t.yscale,x:Jn(t.xoffset),y:Jn(t.yoffset)};break;case bct:i=t.color;break;case wct:i=n3e(t)}return i}function fUt(t,e){const i=t+"-"+e;return sB.get(i)!==void 0?Promise.resolve(sB.get(i)):_i(t,{responseType:"image"}).then(r=>{const n=r.data,s=n.naturalWidth,o=n.naturalHeight,a=document.createElement("canvas");a.width=s,a.height=o;const l=a.getContext("2d");l.fillStyle=e,l.fillRect(0,0,s,o),l.globalCompositeOperation="destination-in",l.drawImage(n,0,0);const c=a.toDataURL();return sB.put(i,c),c})}function c3e(t){if(!t)return null;let e=null;switch(t.type){case a3e:case o3e:case l3e:e=c3e(t.outline);break;case vct:{const i=Jn(t.width);t.style!=null&&t.style!=="none"&&i!==0&&(e={color:t.color,style:xct(t.style),width:i,cap:t.cap,join:t.join==="miter"?Jn(t.miterLimit):t.join});break}default:e=null}return e}const xct=(()=>{const t={};return e=>{if(t[e])return t[e];const i=e.replaceAll("-","");return t[e]=i,i}})(),mUt=new Pe([128,128,128]),Tct=new Pe("white");function Sct(t){const e=t.symbolLayers?.at(-1);if(e&&"outline"in e)return e?.outline?.size}function gUt(t){if(!t)return 0;if(Mv(t)){const e=Sct(t);return e??0}return Ku(c3e(t)?.width)}function yUt(t){if(t==null||!("symbolLayers"in t)||t.symbolLayers==null)return!1;switch(t.type){case"point-3d":return t.symbolLayers.some(e=>e.type==="object");case"line-3d":return t.symbolLayers.some(e=>e.type==="path");case"polygon-3d":return t.symbolLayers.some(e=>e.type==="object"||e.type==="extrude");default:return!1}}function Ect(t){return t.resource?.href??""}function _Ut(t,e){if(!t)return null;let i=null;return Mv(t)?i=Cct(t):Z6(t)&&(i=t.type==="cim"?n3e(t):t.color?new Pe(t.color):null),i?UP(i,e):null}function Cct(t){const e=t.symbolLayers;if(!e)return null;let i=null;return e.forEach(r=>{r.type==="object"&&r.resource?.href||(i=r.type==="water"?r.color:r.material?r.material.color:null)}),i?new Pe(i):null}function UP(t,e){if(e==null||t==null)return t;const i=t.toRgba();return i[3]=i[3]*e,new Pe(i)}function Act(t,e,i){const r=t.symbolLayers;if(!r)return;const n=s=>UP(e=e??s??(i!=null?Tct:null),i);r.forEach(s=>{if(s.type!=="object"||!s.resource?.href||e)if(s.type==="water")s.color=n(s.color);else{const o=s.material!=null?s.material.color:null,a=n(o);s.material==null?s.material=new qu({color:a}):s.material.color=a,i!=null&&"outline"in s&&s.outline?.color!=null&&(s.outline.color=UP(s.outline.color,i))}})}function Oct(t,e,i){(e=e??t.color)&&(t.color=UP(e,i)),i!=null&&"outline"in t&&t.outline?.color&&(t.outline.color=UP(t.outline.color,i))}function vUt(t,e,i){t&&(e||i!=null)&&(e&&(e=new Pe(e)),Mv(t)?Act(t,e,i):Z6(t)&&Oct(t,e,i))}async function Rct(t,e){const i=t.symbolLayers;i&&await f6(i,async r=>Pct(r,e))}async function Pct(t,e){switch(t.type){case"extrude":$ct(t,e);break;case"icon":case"line":case"text":Mct(t,e);break;case"path":Lct(t,e);break;case"object":await Ict(t,e)}}function Mct(t,e){const i=u3e(e);i!=null&&(t.size=i)}function u3e(t){for(const e of t)if(typeof e=="number")return e;return null}function $ct(t,e){t.size=typeof e[2]=="number"?e[2]:0}async function Ict(t,e){const{resourceSize:i,symbolSize:r}=await Dct(t),n=h3e(e,i,r);t.width=TR(e[0],r[0],i[0],n),t.depth=TR(e[1],r[1],i[1],n),t.height=TR(e[2],r[2],i[2],n)}function Lct(t,e){const i=h3e(e,ey,[t.width,void 0,t.height]);t.width=TR(e[0],t.width,1,i),t.height=TR(e[2],t.height,1,i)}function h3e(t,e,i){for(let r=0;r<3;r++){const n=t[r];switch(n){case"symbol-value":{const s=i[r];return s!=null?s/e[r]:1}case"proportional":break;default:if(n&&e[r])return n/e[r]}}return 1}async function Dct(t){const{computeObjectLayerResourceSize:e}=await ce(()=>import("./symbolLayerUtils-9db01ca6.js"),[],import.meta.url),i=await e(t,10),{width:r,height:n,depth:s}=t,o=[r,s,n];let a=1;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/i[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=i[l]*a);return{resourceSize:i,symbolSize:o}}function TR(t,e,i,r){switch(t){case"proportional":return i*r;case"symbol-value":return e??i;default:return t}}function Nct(t,e){const i=u3e(e);if(i!=null)switch(t.type){case"simple-marker":t.size=i;break;case"picture-marker":{const r=t.width/t.height;r>1?(t.width=i,t.height=i*r):(t.width=i*r,t.height=i);break}case"simple-line":t.width=i;break;case"text":t.font.size=i}}async function bUt(t,e){if(t&&e)return Mv(t)?Rct(t,e):void(Z6(t)&&Nct(t,e))}function wUt(t,e,i){if(t&&e!=null)if(Mv(t)){const r=t.symbolLayers;r&&r.forEach(n=>{if(n&&n.type==="object")switch(i){case"tilt":n.tilt=e;break;case"roll":n.roll=e;break;default:n.heading=e}})}else Z6(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle=e))}function xUt(t){if(!t)return null;const e=t.effects.filter(i=>i.type!=="bloom").map(i=>i.toJSON());return gW(e)}function TUt(t){return t!=null&&t.type==="polygon-3d"&&t.symbolLayers.some(e=>e.type==="extrude")}async function SUt(t,e){return await t.fetchSymbol(e)||t.fetchCIMSymbol(e)}function Fct(t,e,i,r,n){if(t==null)return null;const s=t.referencesGeometry()&&n?kct(e,r,n):e,o=t.repurposeFeature(s);try{return t.evaluate({...i,$feature:o},t.services)}catch(a){return K.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const oB=new Map;function kct(t,e,i){const{transform:r,hasZ:n,hasM:s}=i;oB.has(e)||oB.set(e,Uct(e));const o=oB.get(e)(t.geometry,r,n,s);return{...t,geometry:o}}function Uct(t){const e={};switch(t){case"esriGeometryPoint":return(i,r,n,s)=>ICe(r,e,i,n,s);case"esriGeometryPolygon":return(i,r,n,s)=>LCe(r,e,i,n,s);case"esriGeometryPolyline":return(i,r,n,s)=>DCe(r,e,i,n,s);case"esriGeometryMultipoint":return(i,r,n,s)=>$Ce(r,e,i,n,s);default:return K.getLogger("esri.views.2d.support.arcadeOnDemand").error(new G("mapview-arcade",`Unable to handle geometryType: ${t}`)),i=>i}}const EUt=1.2,zct=Wu,Bct=4;let a8=class{constructor(e,i,r,n){this.graphics3DSymbolLayer=e,this.renderGeometries=i,this.boundingBox=r,this._drapeSourceRenderer=n,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(e){this.stage=e.stage}setVisibility(e){if(this.stage!=null&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,Zr.ADD);if(e||this._addedToStage){for(const i of this.renderGeometries)i.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Os.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,Zr.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=E()){return ae(e,0,0,0)}getBoundingBoxObjectSpace(e=ks()){return Pr(e)}addObjectState(e,i){e===Py.Highlight&&(this.renderGeometries.forEach(r=>{const n=r.geometry.addHighlight();i.addRenderGeometry(r,n,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Os.HIGHLIGHT))}removeObjectState(e){this.renderGeometries.forEach(i=>{e.removeRenderGeometry(i)})}removeRenderGeometryObjectState(e,i){e.geometry.removeHighlight(i),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Os.HIGHLIGHT)}computeAttachmentOrigin(e){for(const i of this.renderGeometries)i.geometry.computeAttachmentOrigin(HT)&&(e.draped.origin[0]+=HT[0],e.draped.origin[1]+=HT[1],e.draped.num++)}async getProjectedBoundingBox(e,i,r,n,s){Pr(s);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,e,pce,r),BBe(s,pce)}if(i){let o;_p(s,HT);const a=xQ(s,i.service.spatialReference,i);try{o=await i.service.queryElevation(HT[0],HT[1],n,a,"ground")}catch{}o!=null&&(s[2]=Math.min(s[2],o),s[5]=Math.max(s[5],o))}return s}_getRenderGeometryProjectedBoundingRect(e,i,r,n){if(this.boundingBox)H6(lf,this.boundingBox);else{const s=e.boundingSphere,o=s[3];lf[0]=s[0]-o,lf[1]=s[1]-o,lf[2]=s[2]-o,lf[3]=s[0]+o,lf[4]=s[1]+o,lf[5]=s[2]+o}return i(lf,0,2),this.calculateRelativeScreenBounds&&n.push({location:_p(lf),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),yJ(lf,r)}};const pce=Zt(),lf=ks(),HT=E();function rk(t,e,i){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=i,t.canvas}function d3e(t){const{size:e}=t.definition,i=t.fontString(e);let r=fce.get(i);if(!r){const n=rk(Gct,0,0).getContext("2d");t.setFontProperties(n,e);const s=n.measureText(jct);r=new Vct(s.actualBoundingBoxAscent,s.actualBoundingBoxDescent),fce.set(i,r)}return r}const fce=new Map;let Vct=class{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(e,i){this.maxAscent=e,this.maxDescent=i}};const Gct={canvas:null},jct=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})(),nk=1;let p3e=class{constructor(e,i,r,n){this.text=e,this._alignment=i,this._parameters=r,this._maxSize=n,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`,this._lines=e.replaceAll(" "," ").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let e=this._metrics.firstLineAscent;for(let i=0;i<this._lines.length-1;i++)e+=this._lineSpacing;return e+=this._metrics.lastLineDescent,Math.ceil(e+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(this._metricsCached==null){const e=rk(mce,TL,TL).getContext("2d");this._parameters.setFontProperties(e,this._fontSize);let i=2*this._haloSize;const r=this._parameters.definition.font;r.style!=="italic"&&r.style!=="oblique"&&r.weight!=="bold"&&r.weight!=="bolder"||(i+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let n,s,o=0,a=0,l=0;this._lines.forEach((f,m)=>{const y=e.measureText(f),_=y.width,v=_+i;this._textWidths.push(_),this._lineWidths.push(v),o=Math.max(o,v),a=Math.max(a,y.actualBoundingBoxAscent),l=Math.max(l,y.actualBoundingBoxDescent),m===0&&(n=y),m===this._lines.length-1&&(s=y)});const c=d3e(this._parameters);a=Math.max(a,c.maxAscent),l=Math.max(l,c.maxDescent);const h=n.actualBoundingBoxAscent,d=this._parameters.definition.font.decoration==="underline"?l:s.actualBoundingBoxDescent;this._metricsCached=new qct(h,d,a,l,o)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return this._midLineHeight*Hct}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,nk)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(this._renderPixelRatio==null){const e=this._parameters.definition.pixelRatio;this._renderPixelRatio=Math.min(e,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight))}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case pv.Left:return this._horizontalPadding;case pv.Center:return(this.displayWidth-this._lineWidths[e])/2;case pv.Right:return this.displayWidth-this._horizontalPadding-this._lineWidths[e]}}render(e,i,r){e.save();const n=i/=this.renderPixelRatio,s=r/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset+this._metrics.firstLineAscent;i+=o,r+=a;const l=this._haloSize>0;l&&this._renderHalo(e,n,s,o,a),this._parameters.setFontProperties(e,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const h=this._lines[c],d=this._getLineXOffset(c);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,h,i+d,r),this._renderLineDecoration(e,i+d,r,this._textWidths[c])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,h,i+this._getLineXOffset(c),r),this._renderLineDecoration(e,i+d,r,this._textWidths[c]),r+=this._lineSpacing}if(pr.TEXT_SHOW_BASELINE){e.strokeStyle=gce,e.setLineDash([2,2]),e.lineWidth=1;let c=s+a;for(let h=0;h<this._lines.length;++h)this._drawLine(e,[n,c],[n+this.displayWidth,c]),c+=this._lineSpacing}if(pr.TEXT_SHOW_BORDER&&(e.strokeStyle=gce,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[n,s],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,n,s,c),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,i,r,n,s=!1){if(this._parameters.definition.font.decoration==="none"||n===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":r+=2*a;break;case"line-through":r-=.33*this._midLineAscent}const l=s?this._haloSize:0;e.strokeStyle=s?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(a+2*l),e.beginPath(),e.moveTo(this._toRenderUnit(i-l),this._toRenderUnit(r)),e.lineTo(this._toRenderUnit(i+n+l),this._toRenderUnit(r)),e.stroke()}_roundedRect(e,i,r,n){i=this._toRenderUnit(i),r=this._toRenderUnit(r);const s=this.renderedWidth,o=this.renderedHeight;n!==0?(n=_e(n,0,Math.floor(o/2)),e.beginPath(),e.moveTo(i,r+n),e.arcTo(i,r,i+n,r,n),e.lineTo(i+s-n,r),e.arcTo(i+s,r,i+s,r+n,n),e.lineTo(i+s,r+o-n),e.arcTo(i+s,r+o,i+s-n,r+o,n),e.lineTo(i+n,r+o),e.arcTo(i,r+o,i,r+o-n,n),e.closePath()):e.rect(i,r,s,o)}_renderHalo(e,i,r,n,s){const o=this.renderedWidth,a=this.renderedHeight,l=rk(mce,Math.max(o,TL),Math.max(a,TL)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._parameters.setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const h=this._renderedHaloSize<3;c.lineJoin=h?"miter":"round",h?this._renderHaloEmulated(c,n,s):this._renderHaloNative(c,n,s);let d=s;for(let f=0;f<this._lines.length;++f){const m=this._getLineXOffset(f);this._renderLineDecoration(c,n+m,d,this._textWidths[f],!0),d+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,o,a,this._toRenderUnit(i),this._toRenderUnit(r),o,a),e.globalAlpha=1}_renderHaloEmulated(e,i,r){for(let n=0;n<this._lines.length;++n){const s=this._lines[n],o=this._getLineXOffset(n);for(const[a,l]of f3e)this._fillText(e,s,i+o+this._haloSize*a,r+this._haloSize*l);r+=this._lineSpacing}}_renderHaloNative(e,i,r){const n=2*this._haloSize;for(let s=0;s<this._lines.length;++s){const o=this._lines[s],a=this._getLineXOffset(s),l=5,c=.1;for(let h=0;h<l;h++){const d=1-(l-1)*c+h*c;e.lineWidth=this._toRenderUnit(d*n),this._strokeText(e,o,i+a,r)}r+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,i,r,n){e.fillText(i,this._toRenderUnit(r),this._toRenderUnit(n))}_strokeText(e,i,r,n){e.strokeText(i,this._toRenderUnit(r),this._toRenderUnit(n))}_drawLine(e,i,r){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.stroke()}_drawBox(e,i,r){const n=this._toRenderUnit(i[0]),s=this._toRenderUnit(i[1]),o=this._toRenderUnit(r[0]),a=this._toRenderUnit(r[1]),l=Math.floor(n)+.5,c=Math.ceil(n+o)-.5,h=Math.floor(s)+.5,d=Math.ceil(s+a)-.5;e.beginPath(),e.moveTo(l,h),e.lineTo(c,h),e.lineTo(c,d),e.lineTo(l,d),e.lineTo(l,h),e.stroke()}};const f3e=[];for(let e=0;e<360;e+=360/16)f3e.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);var pv;(function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"})(pv||(pv={}));const mce={canvas:null},Hct=.2,TL=512,gce="rgb(255, 0, 255, 0.5)";let qct=class{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(e,i,r,n,s){this.firstLineAscent=e,this.lastLineDescent=i,this.maxLineAscent=r,this.maxLineDescent=n,this.displayWidth=s}};const Wct=Object.freeze({left:0,center:.5,right:1}),y4=Object.freeze({"bottom-left":pi(0,0),bottom:pi(.5,0),"bottom-right":pi(1,0),left:pi(0,.5),center:pi(.5,.5),right:pi(1,.5),"top-left":pi(0,1),top:pi(.5,1),"top-right":pi(1,1)});function m3e(t){switch(t){case"left":return pv.Left;case"right":return pv.Right;default:return pv.Center}}function yce(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function Yct(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function Xct(t,e){switch(e){case"bottom":return t==="left"?"bottom-left":t==="right"?"bottom-right":"bottom";case"center":return t;case"top":return t==="left"?"top-left":t==="right"?"top-right":"top"}}function Zct(t){return t==="middle"?"center":t}function Jct(t,e){switch(t){case"top":return mi(e,0,nk);case"bottom":return mi(e,0,-nk);default:return gs(e,Ey)}}let dC=class{constructor(e,i={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=be(),this._shaderTransformation=null,this._boundingSphere=null,this.id=zu(),this.layerUid=i.layerUid,this.graphicUid=i.graphicUid,this.castShadow=i.castShadow??!1,i.objectShaderTransformation!=null&&this.objectShaderTransformationChanged(i.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){Qn(this._transformation,e),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){e==null?this._shaderTransformation=null:(this._shaderTransformation??(this._shaderTransformation=be()),qi(this._shaderTransformation,e,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){return this.boundingInfo?(this._boundingSphere==null&&(this._boundingSphere??(this._boundingSphere=kn()),ke(this._boundingSphere,this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*WE(this.shaderTransformation)),this._boundingSphere):Sbe}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation==null?this.transformation:this._shaderTransformation}get attributes(){return this.geometry.attributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}};const _ce=Oe(0,0,1),Kct=16,Qct=1.5,$w=YQ,eut=[$w/2,$w/2,1-$w/2,1-$w/2],tut=[KF*$w,KF*$w];let wW=class g3e extends Xm{getCachedSize(){return{size:this._getIconSize()}}constructor(e,i,r,n){super(e,i,r,n),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(e){this._validateOrThrow();const i=this._prepareMaterialParameters(),r=this._getPrimitive();if(r!=null)this._prepareResourcesPrimitive(i,r);else{const n=Ect(this.symbolLayer),s=_v(n);s&&s.mediaType==="application/json"?await this._prepareResourcesCIM(i,JSON.parse(s.data),e):await this._prepareResourcesHref(i,n,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=qU(this._getIconSize());if(e)throw new G("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,i=Math.round(e.size!=null?Jn(e.size):Kct);return this._drivenProperties.size?Math.max(i,64):i}_generateTextureCIM(e){const i=this._getGraphicHash(e);let r=i===""?null:this._cimSymbolTextures.get(i);if(!r){const n={scaleFactor:this._cimScaleFactorOrFunction},s=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol3D(this._cimLayers,e,"esriGeometryPoint",n,void 0,void 0);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",s.anchorPosition);const o={width:s.imageData.width,height:s.imageData.height};r=new iT(s.imageData,o),this._cimSymbolTextures.set(i,r),this._context.stage.add(r)}return r}_prepareMaterialParameters(){const e={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},i=this.symbol;if(iut(i)){const{screenLength:r,minWorldLength:n,maxWorldLength:s}=i.verticalOffset;e.verticalOffset={screenLength:Jn(r),minWorldLength:n||0,maxWorldLength:s??1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!0,e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,i){const r=this._getOutlineSize();if(aB(i)&&r===0)throw new Error("Nothing to render");if(this._outlineSize=r,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,this._context.sharedResources.textures!=null){const s=this._context.sharedResources.textures.fromData(`${i}-icon`,()=>Eat(i));this._textureHandle=s,e.textureId=s.texture.id}e.textureIsSignedDistanceField=!0,e.sampleSignedDistanceFieldTexelCenter=Sat(i),e.distanceFieldBoundingBox=eut;const n=this._getIconSize();this._size=[n,n],this._symbolTextureRatio=1/$w,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,i,r){this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const n=this._getIconSize(),s=n*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(this._context.sharedResources.textures!=null){const o=await jc(this._context.sharedResources.textures.fromUrl(i,s,{signal:r}));if(o.ok===!1)throw Gl(o.error),new G("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${i})`);this._textureHandle=o.value;const a=o.value.texture,l=a.parameters.width/a.parameters.height;this._size=l>1?[n,Math.round(n/l)]:[Math.round(n*l),n],e.textureId=a.id}this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,i,r){const n=new OC({data:i});if(!this._context.sharedResources.cimSymbolRasterizer){const h=(await ce(()=>import("./CIMSymbolRasterizer-1eb30544.js"),["./CIMSymbolRasterizer-1eb30544.js","./cimAnalyzer-eedeb732.js","./labelPoint-454a2ef5.js","./TileClipper-ae6eca9e.js","./definitions-24b8f578.js","./number-e491b09e.js","./BidiEngine-9a40f2f4.js","./rasterizingUtils-92b6527e.js"],import.meta.url)).CIMSymbolRasterizer;Tt(r),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new h(this._context.renderCoordsHelper.spatialReference,!0))}const s=this._context.layer.fields?this._context.layer.fields.map(h=>h.toJSON()):null;let o,a;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol3D(n,s,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:r}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const h=this._context.renderer;if(isNaN(h.scaleExpression)){const d=h.scaleExpression,f=await C9e(d,this._context.layer.spatialReference,s);a=(m,y,_)=>{const v=Fct(f,m,{$view:_},"esriGeometryPoint",y);return v!==null?v:1}}else o=Number(h.scaleExpression)}this._cimScaleFactorOrFunction=o||a||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];Tt(r);const c=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(h=>c.get(h).name),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||nVe}_getOutlineSize(){let e=0;const i=this.symbolLayer;return i.outline?.size!=null?Math.max(Jn(i.outline.size),0):(e=aB(this._getPrimitive())?Qct:0,Math.max(e,0))}_getOutlineColor(){const e=this._getLayerOpacity(),i=this.symbolLayer,r=i?.outline?.color;if(r!=null){const n=Pe.toUnitRGB(r),s=r.a*e;return[n[0],n[1],n[2],s]}return[0,0,0,0]}_getFillColor(){if(aB(this._getPrimitive()))return zct;const e=this._getPrimitive()==null,i=this.symbolLayer?.material?.color;return this._getCombinedOpacityAndColor(i,{hasIntrinsicColor:e})}_getAnchorPos(e,i){return e==="relative"?pi((i.x||0)+.5,.5-(i.y||0)):e in y4?y4[e]:y4.center}_createMaterialAndAddToStage(e,i){if(this._cimLayers){this._fastUpdates=null;let r=e.textureId?this._cimSymbolMaterials.get(e.textureId):null;return r||(r=new lC(e),this._cimSymbolMaterials.set(e.textureId??0,r),i.add(r)),r}return this._fastUpdates=sC(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates&&(e={...e,...this._fastUpdates.materialParameters}),this._materials[0]=new lC(e),i.add(this._materials[0]),this._materials[0]}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._materials.length=0,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(e=>this._context.stage.remove(e)),this._cimSymbolTextures.clear(),this._textureHandle=li(this._textureHandle)}_getScaleFactor(e,i){if(this._drivenProperties.size&&e.size){for(let r=0;r<3;r++){const n=e.size[r];n&&n!=="symbol-value"&&n!=="proportional"&&(e.size[r]=Jn(n))}if(e.size[0]==="symbol-value")return 1;if(isFinite(+e.size[0]))return+e.size[0]/i;if(isFinite(+e.size[2]))return+e.size[2]/i}return 1}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry))return null;let r,n=[0,0];if(this._cimLayers){if(!this._cimLayers.length)return null;const d=this._generateTextureCIM(i),f={textureId:d.id,...this._cimMaterialParametersInfo};r=this._createMaterialAndAddToStage(f,this._context.stage),n=[d.parameters.width,d.parameters.height]}else n=this._size,r=this._materials[0];const s=LP(i.geometry);if(s==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const o=e.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!this._fastUpdates?.visualVariables.size){const d=n[0]>n[1]?n[0]:n[1];l=this._getScaleFactor(o,d)}l*=this._symbolTextureRatio;const c=pi(n[0]*l,n[1]*l),h=this.setGraphicElevationContext(i);return this.ensureDrapedStatus(h.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(i,s,r,a,c,e.layer.uid):this._createAs3DShape(i,s,r,a,c,h,i.uid)}layerOpacityChanged(){const e=this._getFillColor(),i=this._getOutlineColor();this._forEachMaterial(r=>{r.setParameters({color:e}),r.setParameters({outlineColor:i})})}layerElevationInfoChanged(e,i,r){const n=this._elevationContext.mode,s=YM(g3e.elevationModeChangeTypes,r,n);if(s!==xn.UPDATE)return s;const o=cd(n)||n==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return this._getPrimitive()!=null}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables"||!oC(this._fastUpdates,i,this._fastVisualVariableConvertOptions()))return Kn.RecreateSymbol;this._materials[0]?.setParameters(this._fastUpdates.materialParameters)}return Kn.FastUpdate}_defaultElevationInfoNoZ(){return rut}_createAs3DShape(e,i,r,n,s,o,a){const l=this.getFastUpdateAttrValues(e),c=this._context.layer.uid,h=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:c}),d=Eq(r,_ce,null,n,s,nut,null,l,h),f=LQ(this._context,i,d,o,a);if(f==null)return null;const m=new Ym(this,f.object,[d],null,null,Xw,o);return m.alignedSampledElevation=f.sampledElevation,m.needsElevationUpdates=cd(o.mode)||o.mode==="absolute-height",m.getScreenSize=this._createScreenSizeGetter(s,l),m.calculateRelativeScreenBounds=y=>r.calculateRelativeScreenBounds(m.getScreenSize(),1,y),IP(m,i,this._context.elevationProvider),m}_createAsOverlay(e,i,r,n,s,o){r.renderPriority=this._renderPriority;const a=oi();Wc(i,a,this._context.overlaySR),a[2]=iee;const l=this._context.clippingExtent;if(l!=null&&!gJ(l,a))return null;const c=this.getFastUpdateAttrValues(e),h=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:e.uid,layerUid:this._context.layer.uid}),d=Eq(r,_ce,a,n,s,null,null,c,h),f=new dC(d,{layerUid:o,graphicUid:e.uid}),m=new a8(this,[f],null,this._context.drapeSourceRenderer);return m.getScreenSize=this._createScreenSizeGetter(s,c),m.calculateRelativeScreenBounds=y=>r.calculateRelativeScreenBounds(m.getScreenSize(),1,y),m}_createScreenSizeGetter(e,i){const r=this._outlineSize+2;if(this._fastUpdates&&i){const o=e[0]/this._symbolTextureRatio,a=e[1]/this._symbolTextureRatio;return(l=Ge())=>{const[c,h]=cQ(sut,this._fastUpdates.materialParameters,i);return l[0]=c*o+r,l[1]=h*a+r,l}}const n=e[0]/this._symbolTextureRatio+r,s=e[1]/this._symbolTextureRatio+r;return(o=Ge())=>(o[0]=n,o[1]=s,o)}_fastVisualVariableConvertOptions(){const e=Math.max(this._size[0],this._size[1]),i=Oe(e,e,e),r=Ku(1),n=e*r,s=Oe(n,n,n);return new jM({size:!0,color:!0,rotation:!0,opacity:!1},i,s,r)}_getGraphicHash(e){let i="";for(const r of this._cimRequiredFields)i+=r+e.attributes[r];return i}_forEachMaterial(e){this._materials.forEach(e),this._cimSymbolMaterials.forEach(e)}test(){return{...super.test(),material:this._materials[0]}}};function iut(t){return t&&t.type==="point-3d"&&t.hasVisibleVerticalOffset()}function aB(t){return t!=null&&(t==="cross"||t==="x")}wW.PRIMITIVE_SIZE=tut,wW.elevationModeChangeTypes={definedChanged:xn.UPDATE,staysOnTheGround:xn.NONE,onTheGroundChanged:xn.RECREATE};const rut={mode:"relative-to-ground",offset:0},nut=Ft(0,0,0,1),sut=E();function xW(t){switch(t){case"butt":return Zh.BUTT;case"square":return Zh.SQUARE;case"round":return Zh.ROUND;default:return null}}function vce(t){return t==="diamond"?"kite":t}function TW(t,e,i=null){const r=[],n=e.mapPositions;out(e,r);const s=r[0][1].data,o=r[0][1].indices.length,a=r1(o);return aut(e,r,a),uut(e,r,a),lut(e,r,a),cut(e,r,a),hut(e,r,a),dut(e,r,a),put(e,r,s),new ms(t,r,n,wn.Line,i)}function out(t,e){const{attributeData:{position:i},removeDuplicateStartEnd:r}=t,n=fut(i)&&r,s=i.length/3-(n?1:0),o=new Array(2*(s-1)),a=n?i.slice(0,-3):i;let l=0;for(let c=0;c<s-1;c++)o[l++]=c,o[l++]=c+1;e.push([O.POSITION,new Ve(a,o,3,n)])}function aut(t,e,i){if(t.attributeData.colorFeature!=null)return;const r=t.attributeData.color;e.push([O.COLOR,new Ve(r??Hh,i,4)])}function lut(t,e,i){t.attributeData.normal&&e.push([O.NORMAL,new Ve(t.attributeData.normal,i,3)])}function cut(t,e,i){t.attributeData.colorFeature!=null&&e.push([O.COLORFEATUREATTRIBUTE,new Ve([t.attributeData.colorFeature],i,1,!0)])}function uut(t,e,i){t.attributeData.sizeFeature==null&&e.push([O.SIZE,new Ve([t.attributeData.size??1],i,1,!0)])}function hut(t,e,i){t.attributeData.sizeFeature!=null&&e.push([O.SIZEFEATUREATTRIBUTE,new Ve([t.attributeData.sizeFeature],i,1,!0)])}function dut(t,e,i){t.attributeData.opacityFeature!=null&&e.push([O.OPACITYFEATUREATTRIBUTE,new Ve([t.attributeData.opacityFeature],i,1,!0)])}function put(t,e,i){if(t.overlayInfo==null||t.overlayInfo.renderCoordsHelper.viewingMode!==Le.Global||!t.overlayInfo.spatialReference.isGeographic)return;const r=_o(i.length),n=Wi(t.overlayInfo.spatialReference);for(let d=0;d<r.length;d+=3)BZ(i,d,r,d,n);const s=i.length/3,o=un(s+1);let a=mut,l=gut,c=0,h=0;ae(a,r[h++],r[h++],r[h++]),o[0]=0;for(let d=1;d<s+1;++d)d===s&&(h=0),ae(l,r[h++],r[h++],r[h++]),c+=zxe(a,l),o[d]=c,[a,l]=[l,a];e.push([O.DISTANCETOSTART,new Ve(o,e[0][1].indices,1,!0)])}function fut(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const mut=E(),gut=E();function MUt(t,e){if(t==null||t.length===0)return[];const i=[];return t.forEach(r=>{const n=r.length,s=_o(3*n);r.forEach((a,l)=>{s[3*l]=a[0],s[3*l+1]=a[1],s[3*l+2]=a[2]});const o={attributeData:{position:s,normal:e},removeDuplicateStartEnd:!1};i.push(o)}),i}function yut(t,e,i,r){const n=t.type==="polygon"?Im.CCW_IS_HOLE:Im.NONE,s=t.type==="polygon"?t.rings:t.paths,{position:o,outlines:a}=t$(s,!!t.hasZ,n,t.spatialReference),l=_o(o.length),c=TEe(o,t.spatialReference,0,l,0,o,0,o.length/3,e,i,r),h=c!=null;return{lines:h?y3e(a,o,l):[],projectionSuccess:h,sampledElevation:c}}function _ut(t,e){const i=t.type==="polygon"?Im.CCW_IS_HOLE:Im.NONE,r=t.type==="polygon"?t.rings:t.paths,{position:n,outlines:s}=t$(r,!1,i),o=rn(n,t.spatialReference,0,n,e,0,n.length/3);for(let a=2;a<n.length;a+=3)n[a]=iee;return{lines:o?y3e(s,n):[],projectionSuccess:o}}function y3e(t,e,i=null){const r=new Array;for(const{index:n,count:s}of t){if(s<=1)continue;const o=3*n,a=3*s;r.push({position:Xh(e,3*n,3*s),mapPositions:i!=null?Xh(i,o,a):void 0})}return r}function vut(t){const e=new Ei,i=t.multipassEnabled&&(t.output===F.Color||t.output===F.Alpha),r=t.space===Zu.World;e.include(fAe,t),e.include(MAe,t),t.output===F.Depth&&e.include($y,t);const{vertex:n,fragment:s}=e;return s.include(dd),zc(n,t),e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.UV0,"vec2"),e.attributes.add(O.AUXPOS1,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vUV","vec2"),e.varyings.add("vSize","float"),Nv(e),i&&e.varyings.add("depth","float"),t.hasTip&&e.varyings.add("vLineWidth","float"),n.uniforms.add(new Ki("nearFar",(o,a)=>a.camera.nearFar),new yi("viewport",(o,a)=>a.camera.fullViewport)),n.code.add(b`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),n.code.add(b`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),r?(e.attributes.add(O.NORMAL,"vec3"),tC(n),n.constants.add("tiltThreshold","float",.7),n.code.add(b`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):n.code.add(b`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),n.code.add(b`
      #define vecN ${r?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${r?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${t.anchor===Px.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),t.space===Zu.Screen&&(n.uniforms.add(new en("inverseProjectionMatrix",(o,a)=>a.camera.inverseProjectionMatrix)),n.code.add(b`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),n.code.add(b`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),n.uniforms.add(new Re("perScreenPixelRatio",(o,a)=>a.camera.perScreenPixelRatio)),n.code.add(b`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${t.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += perpendicular(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),FC(n),wU(e),n.code.add(b`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
clip(pos, prev);`),r?(t.hideOnShortSegments&&n.code.add(b`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),n.code.add(b`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(n.code.add(b`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),t.space===Zu.Screen&&n.code.add(b`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),n.code.add(b`
        ${i?"depth = pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${r?"":"vUV *= displacedPosScreen.w;"}

        ${t.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),i&&e.include(Xc,t),e.include(Dn,t),s.uniforms.add(new yi("intrinsicColor",o=>o.color),new et("tex",o=>o.markerTexture)),s.include(Wm),e.constants.add("texelSize","float",1/Kw),s.code.add(b`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),t.hasTip&&(e.constants.add("relativeMarkerSize","float",XQ/Kw),e.constants.add("relativeTipLineWidth","float",Lat),s.code.add(b`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${r?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),e.constants.add("symbolAlphaCutoff","float",zo),s.code.add(b`
  void main() {
    discardBySlice(vpos);
    ${i?"terrainDepthTest(depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${r?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${t.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    ${t.output===F.ObjectAndLayerIdColor?b`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${t.output===F.Alpha?b`fragColor = vec4(finalColor.a);`:""}
    ${t.output===F.Color?b`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===F.Color&&t.transparencyPassType===it.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${t.output===F.Highlight?b`fragColor = vec4(1.0);`:""}
    ${t.output===F.Depth?b`outputDepth(linearDepth);`:""}
  }
  `),e}const but=Object.freeze(Object.defineProperty({__proto__:null,build:vut},Symbol.toStringTag,{value:"Module"})),_3e=new Map([[O.POSITION,0],[O.UV0,1],[O.AUXPOS1,2],[O.NORMAL,3],[O.COLOR,4],[O.COLORFEATUREATTRIBUTE,4],[O.SIZE,5],[O.SIZEFEATUREATTRIBUTE,5],[O.OPACITYFEATUREATTRIBUTE,6]]);let v3e=class b3e extends Fi{initializeProgram(e){return new Mi(e.rctx,b3e.shader.get().build(this.configuration),_3e)}_makePipelineState(e,i){const r=this.configuration,n=e===it.NONE;return Lt({blending:r.output===F.Color||r.output===F.Alpha?n?Xu:Zy(e):null,depthTest:{func:o1(e)},depthWrite:n?r.writeDepth?ec:null:BU(e),colorWrite:Gt,stencilWrite:r.hasOccludees?$m:null,stencilTest:r.hasOccludees?i?Gv:a1:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=Lt({blending:Xu,depthTest:HF,depthWrite:null,colorWrite:Gt,stencilWrite:null,stencilTest:HEe}),this._occluderPipelineOpaque=Lt({blending:Xu,depthTest:HF,depthWrite:null,colorWrite:Gt,stencilWrite:GEe,stencilTest:jEe}),this._occluderPipelineMaskWrite=Lt({blending:null,depthTest:CQ,depthWrite:null,colorWrite:null,stencilWrite:$m,stencilTest:Gv})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e,i,r){return e?this._occludeePipelineState:this.configuration.occluder?r?this._occluderPipelineTransparent:i?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}};v3e.shader=new Pi(but,()=>ce(()=>import("./LineMarker.glsl-5d843c6d.js"),[],import.meta.url));let wut=class extends n1{constructor(e){super(e,new Tut),this._vertexAttributeLocations=_3e,this._configuration=new io,this._layout=this.createLayout()}getConfiguration(e,i){return this._configuration.output=e,this._configuration.space=i.slot===le.DRAPED_MATERIAL?Zu.Draped:this.parameters.worldSpace?Zu.World:Zu.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==Zh.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.occluder=this.parameters.renderOccluded===Vr.OccludeAndTransparentStencil,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const e=Hr().vec3f(O.POSITION).vec2f(O.UV0).vec3f(O.AUXPOS1);return this.parameters.worldSpace&&e.vec3f(O.NORMAL),this.parameters.vvSize?e.f32(O.SIZEFEATUREATTRIBUTE):e.f32(O.SIZE),this.parameters.vvColor?e.f32(O.COLORFEATUREATTRIBUTE):e.vec4f(O.COLOR),this.parameters.vvOpacity&&e.f32(O.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new Sut(this._layout,this.parameters)}produces(e,i){return i===F.Color||i===F.Alpha||i===F.Highlight||i===F.Depth?e===le.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===Vr.OccludeAndTransparentStencil?e===le.OPAQUE_MATERIAL||e===le.OCCLUDER_MATERIAL||e===le.TRANSPARENT_OCCLUDER_MATERIAL:i===F.Color||i===F.Alpha?e===(this.parameters.writeDepth?le.TRANSPARENT_MATERIAL:le.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===le.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new xut(e)}},xut=class extends xK{constructor(){super(...arguments),this._markerPrimitive=null}dispose(){super.dispose(),this._markerTextureRepository.release(this._markerPrimitive),this._markerPrimitive=null}_updateParameters(e){const i=this._material.parameters.markerPrimitive;return i!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextureRepository.swap(i,this._markerPrimitive)}),this._markerPrimitive=i),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(v3e,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==F.Color&&this._output!==F.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},Tut=class extends WM{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.markerPrimitive="arrow",this.placement="end",this.cap=Zh.BUTT,this.anchor=Px.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1,this.markerTexture=null}},Sut=class{constructor(e,i){this.vertexBufferLayout=e,this._parameters=i}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(e,i,r,n,s){const o=r.attributes.get(O.POSITION).data,a=o.length/3;let l=[1,0,0];const c=r.attributes.get(O.NORMAL);this._parameters.worldSpace&&c!=null&&(l=c.data);let h=1,d=0;this._parameters.vvSize?d=r.attributes.get(O.SIZEFEATUREATTRIBUTE).data[0]:r.attributes.has(O.SIZE)&&(h=r.attributes.get(O.SIZE).data[0]);let f=[1,1,1,1],m=0;this._parameters.vvColor?m=r.attributes.get(O.COLORFEATUREATTRIBUTE).data[0]:r.attributes.has(O.COLOR)&&(f=r.attributes.get(O.COLOR).data);let y=0;this._parameters.vvOpacity&&(y=r.attributes.get(O.OPACITYFEATUREATTRIBUTE).data[0]);const _=new Float32Array(n.buffer);let v=s*(this.vertexBufferLayout.stride/4);const w=(C,A,R,D)=>{if(_[v++]=C[0],_[v++]=C[1],_[v++]=C[2],_[v++]=R[0],_[v++]=R[1],_[v++]=A[0],_[v++]=A[1],_[v++]=A[2],this._parameters.worldSpace&&(_[v++]=l[0],_[v++]=l[1],_[v++]=l[2]),this._parameters.vvSize?_[v++]=d:_[v++]=h,this._parameters.vvColor)_[v++]=m;else{const N=Math.min(4*D,f.length-4);_[v++]=f[N],_[v++]=f[N+1],_[v++]=f[N+2],_[v++]=f[N+3]}this._parameters.vvOpacity&&(_[v++]=y)};let x;(function(C){C[C.ASCENDING=1]="ASCENDING",C[C.DESCENDING=-1]="DESCENDING"})(x||(x={}));const T=(C,A)=>{const R=ae(Eut,o[3*C],o[3*C+1],o[3*C+2]),D=Cut;let N=C+A;do ae(D,o[3*N],o[3*N+1],o[3*N+2]),N+=A;while(hx(R,D)&&N>=0&&N<a);e&&(ke(R,R,e),ke(D,D,e)),w(R,D,[-1,-1],C),w(R,D,[1,-1],C),w(R,D,[1,1],C),w(R,D,[-1,-1],C),w(R,D,[1,1],C),w(R,D,[-1,1],C)},S=this._parameters.placement;S!=="begin"&&S!=="begin-end"||T(0,x.ASCENDING),S!=="end"&&S!=="begin-end"||T(a-1,x.DESCENDING)}};const Eut=E(),Cut=E(),ma={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},Aut={dash:ma.dash,"dash-dot":[...ma.dash,...ma.dot],dot:ma.dot,"long-dash":ma["long-dash"],"long-dash-dot":[...ma["long-dash"],...ma.dot],"long-dash-dot-dot":[...ma["long-dash"],...ma.dot,...ma.dot],none:null,"short-dash":ma["short-dash"],"short-dash-dot":[...ma["short-dash"],...ma["short-dot"]],"short-dash-dot-dot":[...ma["short-dash"],...ma["short-dot"],...ma["short-dot"]],"short-dot":ma["short-dot"],solid:null},Out=8;function Rut(t,e){return t==null?t:{pattern:t.slice(),pixelRatio:e}}function NUt(t){return{pattern:[t,t],pixelRatio:2}}function w3e(t){return t!=null&&t.type==="style"?Put(t.style):null}function Put(t){return t!=null?Rut(Aut[t],Out):null}const Mut=["polyline","polygon","extent"],bce=new jM({size:!0,color:!0,rotation:!1,opacity:!0});let x3e=class T3e extends Xm{constructor(e,i,r,n){super(e,i,r,n)}async doLoad(){if(this._fastUpdates=sC(this._context.renderer,bce),!this._drivenProperties.size&&(this.symbolLayer.size!=null?this.symbolLayer.size:Ku(1))<0)throw new G("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values")}_getMaterialParameters(e,i=!1){const r=this._getCombinedOpacityAndColor(i&&this._markerColor||this._materialColor);this._patternHidesLine&&!i&&(r[3]=0);const n={width:this._computeMaterialWidth(this.symbolLayer?.size),color:r,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:xW(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:w3e(this.symbolLayer.pattern)};return this._fastUpdates?.visualVariables?{...n,...this._fastUpdates.materialParameters}:n}get _materialColor(){return this.symbolLayer.material?.color}get _markerColor(){return this.symbolLayer.marker?.color}get _lineMaterial(){return this._materials[On.Line]==null&&(this._materials[On.Line]=new N2(this._getMaterialParameters(!1)),this._context.stage.add(this._materials[On.Line])),this._materials[On.Line]}get _ringMaterial(){return this._materials[On.Ring]==null&&(this._materials[On.Ring]=new N2(this._getMaterialParameters(!0)),this._context.stage.add(this._materials[On.Ring])),this._materials[On.Ring]}get _wireframeLineMaterial(){return this._materials[On.LineWireframe]==null&&(this._materials[On.LineWireframe]=new N2({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._materials[On.LineWireframe])),this._materials[On.LineWireframe]}get _wireframeRingMaterial(){return this._materials[On.RingWireframe]==null&&(this._materials[On.RingWireframe]=new N2({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._materials[On.RingWireframe])),this._materials[On.RingWireframe]}get _markerMaterial(){return this._materials[On.Marker]==null&&this.symbolLayer.marker!=null&&(this._materials[On.Marker]=new wut({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,markerPrimitive:vce(this.symbolLayer.marker.style)}),this._context.stage.add(this._materials[On.Marker])),this._materials[On.Marker]}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._materials.length=0}_getDrivenSize(e){return this._drivenProperties.size&&e.size?Jn(aot(e.size)):1}_getDrivenColor(e){const i=Ft(1,1,1,1);return this._drivenProperties.color&&e.color&&(i[0]=e.color[0],i[1]=e.color[1],i[2]=e.color[2],e.color.length>0&&(i[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(i[3]=e.opacity),i}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,Mut,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,r,i.uid)}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables")return Kn.RecreateSymbol;{const n=this._fastUpdates;if(!oC(n,i,bce))return Kn.RecreateSymbol;this._forEachMaterial(s=>s?.setParameters(n.materialParameters))}}return Kn.FastUpdate}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const i=e.diff.diff,r={};i.size?.type==="complete"&&(r.width=this._computeMaterialWidth(i.size.newValue),delete i.size),i.cap?.type==="complete"&&(r.cap=xW(i.cap.newValue??"butt"),delete i.cap);const n=this._prepareMarkerPatch(e,i);this._prepareMaterialPatch(e,i,n),e.symbolLayerStatePatches.push(()=>this._forEachMaterial(s=>s?.setParameters(r)))}layerOpacityChanged(){this._forEachMaterial((e,i)=>this._updateMaterialLayerOpacity(e,i===On.Marker))}_forEachMaterial(e){this._materials.forEach(e)}_updateMaterialLayerOpacity(e,i=!1){if(e==null)return;const r=e.parameters.color,n=this.symbolLayer?.material?.color,s=this._patternHidesLine&&!i?0:this._getCombinedOpacity(n),o=Ft(r[0],r[1],r[2],s);e.setParameters({color:o})}layerElevationInfoChanged(e,i,r){const n=this._elevationContext.mode,s=YM(T3e.elevationModeChangeTypes,r,n);if(s!==xn.UPDATE)return s;const o=cd(n);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(i=>i?.setParameters(e)),!0}physicalBasedRenderingChanged(){return!0}_getGeometryAsPolygonOrPolyline(e){switch(e.type){case"extent":if(e instanceof zi)return Cm.fromExtent(e);break;case"polygon":case"polyline":return e}return null}_createAs3DShape(e,i,r){const n=e.graphic,s=this._getGeometryAsPolygonOrPolyline(n.geometry),o=s.type==="polygon"?s.rings:s.paths,a=new Array,l=ks(),c=yut(s,this._context.elevationProvider,this._context.renderCoordsHelper,i),h=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(c,o,h,"LineSymbol3DLayer");for(let m=0;m<c.lines.length;m++){const y=c.lines[m],_=y.position,v=y.mapPositions;if(this._context.clippingExtent!=null&&(Pr(l),ku(l,v),!vp(l,this._context.clippingExtent)))continue;const w=this._createGeometry(s.type==="polygon"?this._ringMaterial:this._lineMaterial,e,_,v,s.type,SR.ELEVATED,r);a.push(w),pr.LINE_WIREFRAMES&&a.push(w.instantiate({material:s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial})),this._markerMaterial!=null&&a.push(w.instantiate({material:this._markerMaterial}))}if(a.length===0)return null;const d=new Jy({geometries:a,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:r}),f=new Ym(this,d,a,null,null,vrt,i);return f.alignedSampledElevation=c.sampledElevation,f.needsElevationUpdates=cd(i.mode),f}_createGeometry(e,i,r,n,s,o,a){const l=o===SR.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,c=s==="polygon",h=this._fastUpdates?.visualVariables.color,d=this._fastUpdates?.visualVariables.size,f=this._fastUpdates?.visualVariables.opacity,m=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:this._context.layer.uid}),y={position:r,size:d?null:this._getDrivenSize(i.renderingInfo),color:h?null:this._getDrivenColor(i.renderingInfo),sizeFeature:d?Ap(d.field,i.graphic):null,colorFeature:h?Ap(h.field,i.graphic):null,opacityFeature:f?Ap(f.field,i.graphic):null};return TW(e,{overlayInfo:l,removeDuplicateStartEnd:c,mapPositions:n,attributeData:y},m)}_createAsOverlay(e,i){const r=e.graphic,n=this._getGeometryAsPolygonOrPolyline(r.geometry),s=n.type==="polygon"?n.rings:n.paths,o=n.type==="polygon"?this._ringMaterial:this._lineMaterial;o.renderPriority=this._renderPriority;const a=pr.LINE_WIREFRAMES?n.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial:null,l=this._markerMaterial;a!=null&&(a.renderPriority=this._renderPriority-.001),l!=null&&(l.renderPriority=this._renderPriority-.002);const c=new Array,h=ks(),d=Pr(),f=_ut(n,this._context.overlaySR),m=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(f,s,m,"LineSymbol3DLayer");for(const y of f.lines){if(Pr(h),ku(h,y.position),!vp(h,this._context.clippingExtent))continue;jE(d,h);const _=v=>{const w=this._createGeometry(v,e,y.position,void 0,n.type,SR.DRAPED,r.uid),x=new dC(w,{layerUid:i,graphicUid:r.uid});c.push(x)};if(l!=null){_(l);const v=this.symbolLayer.marker.placement;v!=="begin"&&v!=="begin-end"||ku(h,y.position,0,1),v!=="end"&&v!=="begin-end"||ku(h,y.position,y.position.length-3,1)}_(o),pr.LINE_WIREFRAMES&&_(a)}return new a8(this,c,d,this._context.drapeSourceRenderer)}get _patternHidesLine(){const e=this.symbolLayer.pattern;return e!=null&&e.type==="style"&&e.style==="none"}_computeMaterialWidth(e){return e=e??Ku(1),this._drivenProperties.size?this._fastUpdates?.visualVariables.size?Jn(1):1:Jn(e)}_prepareMaterialPatch(e,i,r){const n=i.material;if(n==null)return void(r.changed&&r.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._materials[On.Marker],e));if(n.type==="collection")return;const s=n.type==="complete"?n.newValue?.color:n.diff.color?.type==="complete"?n.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(s);r.useMaterialColor&&this._patchMaterialColor($M(o),this._materials[On.Marker],e),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._materials[On.Line],e),delete i.material}_prepareMarkerPatch(e,i){const r=i.marker,n=this._markerMaterial;if(r==null||r.type!=="partial"||r.diff==null||r.diff.placement!=null||r.diff.style!=null&&r.diff.style.type!=="complete"||r.diff.color!=null&&r.diff.color.type!=="complete"||n==null)return{changed:!1,useMaterialColor:this._markerColor==null};const s=r.diff.color,o=s!=null,a=o?s.newValue:null,l=a==null&&this._markerColor==null;a&&this._patchMaterialColor(this._getCombinedOpacityAndColor(a),n,e);const c=r.diff.style?.newValue;return c&&e.symbolLayerStatePatches.push(()=>n.setParameters({markerPrimitive:vce(c)})),delete i.marker,{changed:o,useMaterialColor:l}}_patchMaterialColor(e,i,r){i!=null&&r.symbolLayerStatePatches.push(()=>i.setParameters({color:e}))}};var SR,On;x3e.elevationModeChangeTypes={definedChanged:xn.RECREATE,staysOnTheGround:xn.NONE,onTheGroundChanged:xn.RECREATE},function(t){t[t.DRAPED=0]="DRAPED",t[t.ELEVATED=1]="ELEVATED"}(SR||(SR={})),function(t){t[t.Line=0]="Line",t[t.Ring=1]="Ring",t[t.LineWireframe=2]="LineWireframe",t[t.RingWireframe=3]="RingWireframe",t[t.Marker=4]="Marker"}(On||(On={}));function S3e(t,e,i){return rn(t,e,0,SL,i.spatialReference,0,1)?(i.x=SL[0],i.y=SL[1],i.z=SL[2],i):null}const SL=E();let IA=null,sk=!0;function lB(t,e,i){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(sk)try{return new ImageData(t,e)}catch{sk=!1}return E3e(t,e,i)}function $ut(t,e,i,r){if(!e||!i)throw new Error("Cannot construct image data without dimensions");if(sk)try{return new ImageData(t,e,i)}catch{sk=!1}const n=E3e(e,i,r);return n.data.set(t,0),n}function Iut(){return IA||(IA=document.createElement("canvas"),IA.width=1,IA.height=1),IA}function E3e(t,e,i){return i||(i=Iut()),i.getContext("2d").createImageData(t,e)}async function Lut(t,e){const i=window.URL.createObjectURL(t);try{const{data:r}=await _i(i,{...e,responseType:"image"});return r}catch(r){throw Tn(r)?r:new G("invalid-image",`Could not fetch requested image at ${i}`)}finally{window.URL.revokeObjectURL(i)}}async function FUt(t,e){const{arrayBuffer:i,mediaType:r}=await Dut(t,e),n=r==="image/png";if(r==="image/gif"){const{isAnimatedGIF:s,parseGif:o}=await ce(()=>import("./gif-ffe4f1a9.js"),[],import.meta.url);if(s(i))return o(i,e)}if(n){const{isAnimatedPNG:s,parseApng:o}=await ce(()=>import("./apng-fc2ea4b9.js"),[],import.meta.url);if(s(i))return o(i,e)}return Lut(new Blob([i],{type:r}),e)}async function Dut(t,e){const i=_v(t);if(i?.isBase64)return{arrayBuffer:Lge(i.data),mediaType:i.mediaType};const r=await _i(t,{responseType:"array-buffer",...e});return{arrayBuffer:r.data,mediaType:r.getHeader("Content-Type")}}var XS;const cB=new WeakMap;let Nut=0,Lf=XS=class extends pe{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,e,i,r){if(t instanceof HTMLImageElement){const n={type:"image-element",src:mx(t.src,r),crossOrigin:t.crossOrigin};e[i]=n}else if(t instanceof HTMLCanvasElement){const n=t.getContext("2d").getImageData(0,0,t.width,t.height),s={type:"canvas-element",imageData:this._encodeImageData(n)};e[i]=s}else if(t instanceof HTMLVideoElement){const n={type:"video-element",src:mx(t.src,r),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};e[i]=n}else if(t instanceof ImageData){const n={type:"image-data",imageData:this._encodeImageData(t)};e[i]=n}}readData(t){switch(t.type){case"image-element":{const e=new Image;return e.src=t.src,e.crossOrigin=t.crossOrigin,e}case"canvas-element":{const e=this._decodeImageData(t.imageData),i=document.createElement("canvas");return i.width=e.width,i.height=e.height,i.getContext("2d").putImageData(e,0,0),i}case"image-data":return this._decodeImageData(t.imageData);case"video-element":{const e=document.createElement("video");return e.src=t.src,e.crossOrigin=t.crossOrigin,e.autoplay=t.autoplay,e.loop=t.loop,e.muted=t.muted,e.preload=t.preload,e}default:return}}get transparent(){const t=this.data,e=this.url;if(t instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(t.getContext("2d").getImageData(0,0,t.width,t.height));if(t instanceof ImageData)return this._imageDataContainsTransparent(t);if(e){const i=e.substr(e.length-4,4).toLowerCase(),r=e.substr(0,15).toLocaleLowerCase();if(i===".png"||r==="data:image/png;")return!0}return!1}set transparent(t){this._overrideIfSome("transparent",t)}get contentHash(){const t=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e=(i="")=>`d:${i},t:${this.transparent},w:${t}`;return this.url!=null?e(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e(this.data.src):(cB.has(this.data)||cB.set(this.data,++Nut),e(cB.get(this.data))):e()}get memoryUsage(){let t=0;if(t+=this.url!=null?this.url.length:0,this.data!=null){const e=this.data;"data"in e?t+=e.data.byteLength:e instanceof HTMLImageElement?t+=e.naturalWidth*e.naturalHeight*3:e instanceof HTMLCanvasElement&&(t+=e.width*e.height*3)}return t}clone(){const t={url:this.url,data:this.data,wrap:this._cloneWrap()};return new XS(t)}cloneWithDeduplication(t){const e=t.get(this);if(e)return e;const i=this.clone();return t.set(this,i),i}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(t){let e="";for(let i=0;i<t.data.length;i++)e+=String.fromCharCode(t.data[i]);return{data:btoa(e),width:t.width,height:t.height}}_decodeImageData(t){const e=atob(t.data),i=new Uint8ClampedArray(e.length);for(let r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return $ut(i,t.width,t.height)}_imageDataContainsTransparent(t){for(let e=3;e<t.data.length;e+=4)if(t.data[e]!==255)return!0;return!1}static from(t){return typeof t=="string"?new XS({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new XS({data:t}):nx(XS,t)}};u([p({type:String,json:{write:Av}})],Lf.prototype,"url",null),u([p({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),p()],Lf.prototype,"data",null),u([Be("data")],Lf.prototype,"writeData",null),u([wt("data")],Lf.prototype,"readData",null),u([p({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],Lf.prototype,"transparent",null),u([p({json:{write:!0}})],Lf.prototype,"wrap",void 0),u([p({readOnly:!0})],Lf.prototype,"contentHash",null),Lf=XS=u([M("esri.geometry.support.MeshTexture")],Lf);const ER=Lf;let ZS=class extends es(pe){constructor(e){super(e),this.offset=[0,0],this.rotation=0,this.scale=[1,1]}};u([p({type:[Number],nonNullable:!0,json:{write:!0}})],ZS.prototype,"offset",void 0),u([p({type:Number,nonNullable:!0,json:{write:!0}})],ZS.prototype,"rotation",void 0),u([p({type:[Number],nonNullable:!0,json:{write:!0}})],ZS.prototype,"scale",void 0),ZS=u([M("esri.geometry.support.MeshTextureTransform")],ZS);const uE=ZS;var SW;let jd=SW=class extends pe{constructor(t){super(t),this.color=null,this.colorTexture=null,this.colorTextureTransform=null,this.normalTexture=void 0,this.normalTextureTransform=void 0,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const i=t!=null?t.get(this):null;if(i)return i;const r=new SW(this.clonePropertiesWithDeduplication(e));return t?.set(this,r),r}clonePropertiesWithDeduplication(t){return{color:this.color!=null?this.color.clone():null,colorTexture:this.colorTexture?.cloneWithDeduplication(t),normalTexture:this.normalTexture?.cloneWithDeduplication(t),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:this.colorTextureTransform?.clone(),normalTextureTransform:this.normalTextureTransform?.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let t=0;return t+=this.color!=null?16:0,this.colorTexture!=null&&(t+=this.colorTexture.memoryUsage),t+=this.colorTextureTransform!=null?20:0,this.normalTexture!=null&&(t+=this.normalTexture.memoryUsage),t+=this.normalTextureTransform!=null?20:0,t}};u([p({type:Pe,json:{write:!0}})],jd.prototype,"color",void 0),u([p({type:ER,json:{write:!0}})],jd.prototype,"colorTexture",void 0),u([p({type:uE,json:{write:!0}})],jd.prototype,"colorTextureTransform",void 0),u([p({type:ER,json:{write:!0}})],jd.prototype,"normalTexture",void 0),u([p({type:uE,json:{write:!0}})],jd.prototype,"normalTextureTransform",void 0),u([p({nonNullable:!0,json:{write:!0}})],jd.prototype,"alphaMode",void 0),u([p({nonNullable:!0,json:{write:!0}})],jd.prototype,"alphaCutoff",void 0),u([p({nonNullable:!0,json:{write:!0}})],jd.prototype,"doubleSided",void 0),jd=SW=u([M("esri.geometry.support.MeshMaterial")],jd);const uee=jd;var EW;let Sh=EW=class extends uee{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.emissiveTextureTransform=void 0,this.occlusionTexture=null,this.occlusionTextureTransform=void 0,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null,this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const i=t!=null?t.get(this):null;if(i)return i;const r=new EW(this.clonePropertiesWithDeduplication(e));return t?.set(this,r),r}getMemoryUsage(){let t=super.getMemoryUsage();return t+=this.emissiveColor!=null?16:0,this.emissiveTexture!=null&&(t+=this.emissiveTexture.memoryUsage),t+=this.emissiveTextureTransform!=null?20:0,this.occlusionTexture!=null&&(t+=this.occlusionTexture.memoryUsage),t+=this.occlusionTextureTransform!=null?20:0,this.metallicRoughnessTexture!=null&&(t+=this.metallicRoughnessTexture.memoryUsage),t+=this.metallicRoughnessTextureTransform!=null?20:0,t}clonePropertiesWithDeduplication(t){return{...super.clonePropertiesWithDeduplication(t),emissiveColor:this.emissiveColor?.clone(),emissiveTexture:this.emissiveTexture?.cloneWithDeduplication(t),emissiveTextureTransform:this.emissiveTextureTransform?.clone(),occlusionTexture:this.occlusionTexture?.cloneWithDeduplication(t),occlusionTextureTransform:this.occlusionTextureTransform?.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:this.metallicRoughnessTexture?.cloneWithDeduplication(t),metallicRoughnessTextureTransform:this.metallicRoughnessTextureTransform?.clone()}}};u([p({type:Pe,json:{write:!0}})],Sh.prototype,"emissiveColor",void 0),u([p({type:ER,json:{write:!0}})],Sh.prototype,"emissiveTexture",void 0),u([p({type:uE,json:{write:!0}})],Sh.prototype,"emissiveTextureTransform",void 0),u([p({type:ER,json:{write:!0}})],Sh.prototype,"occlusionTexture",void 0),u([p({type:uE,json:{write:!0}})],Sh.prototype,"occlusionTextureTransform",void 0),u([p({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Sh.prototype,"metallic",void 0),u([p({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Sh.prototype,"roughness",void 0),u([p({type:ER,json:{write:!0}})],Sh.prototype,"metallicRoughnessTexture",void 0),u([p({type:uE,json:{write:!0}})],Sh.prototype,"metallicRoughnessTextureTransform",void 0),Sh=EW=u([M("esri.geometry.support.MeshMaterialMetallicRoughness")],Sh);const C3e=Sh;var _4;const A3e="esri.geometry.support.MeshVertexAttributes",qT=K.getLogger(A3e);let ph=_4=class extends pe{constructor(t){super(t),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(t){return JS(t,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},qT)}castPosition(t){return t&&t instanceof Float32Array&&qT.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),JS(t,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},qT)}castUv(t){return JS(t,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},qT)}castNormal(t){return JS(t,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},qT)}castTangent(t){return JS(t,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},qT)}clone(){const t={position:Q(this.position),uv:Q(this.uv),normal:Q(this.normal),tangent:Q(this.tangent),color:Q(this.color)};return new _4(t)}clonePositional(){const t={position:Q(this.position),normal:Q(this.normal),tangent:Q(this.tangent),uv:this.uv,color:this.color};return new _4(t)}get memoryUsage(){let t=0;return t+=this.position.byteLength,this.uv!=null&&(t+=this.uv.byteLength),this.normal!=null&&(t+=this.normal.byteLength),this.tangent!=null&&(t+=this.tangent.byteLength),this.color!=null&&(t+=this.color.byteLength),t}};function uB(t,e,i,r){const{loggerTag:n,stride:s}=e;return t.length%s!=0?(r.error(n,`Invalid array length, expected a multiple of ${s}`),new i([])):t}function JS(t,e,i,r,n){if(!t)return t;if(t instanceof e)return uB(t,r,e,n);for(const s of i)if(t instanceof s)return uB(new e(t),r,e,n);if(Array.isArray(t))return uB(new e(t),r,e,n);{const s=i.map(o=>`'${o.name}'`);return n.error(`Failed to set property, expected one of ${s}, but got ${t.constructor.name}`),new e([])}}function LA(t,e,i){e[i]=Fut(t)}function Fut(t){const e=new Array(t.length);for(let i=0;i<t.length;i++)e[i]=t[i];return e}u([p({json:{write:LA}})],ph.prototype,"color",void 0),u([ai("color")],ph.prototype,"castColor",null),u([p({nonNullable:!0,json:{write:LA}})],ph.prototype,"position",void 0),u([ai("position")],ph.prototype,"castPosition",null),u([p({json:{write:LA}})],ph.prototype,"uv",void 0),u([ai("uv")],ph.prototype,"castUv",null),u([p({json:{write:LA}})],ph.prototype,"normal",void 0),u([ai("normal")],ph.prototype,"castNormal",null),u([p({json:{write:LA}})],ph.prototype,"tangent",void 0),u([ai("tangent")],ph.prototype,"castTangent",null),ph=_4=u([M(A3e)],ph);var cO;const O3e="esri.geometry.support.MeshComponent",kut=K.getLogger(O3e);let Df=cO=class extends pe{static from(t){return nx(cO,t)}constructor(t){super(t),this.faces=null,this.material=null,this.name=void 0,this.shading="source",this.trustSourceNormals=!1}castFaces(t){return JS(t,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},kut)}castMaterial(t){return nx(t&&typeof t=="object"&&("metallic"in t||"roughness"in t||"metallicRoughnessTexture"in t)?C3e:uee,t)}clone(){return new cO({faces:Q(this.faces),shading:this.shading,material:Q(this.material),trustSourceNormals:this.trustSourceNormals,name:this.name})}cloneWithDeduplication(t,e){const i={faces:Q(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,e):null,trustSourceNormals:this.trustSourceNormals,name:this.name};return new cO(i)}get memoryUsage(){let t=0;return this.faces!=null&&(t+=this.faces.byteLength),this.material!=null&&(t+=this.material.memoryUsage),t}};u([p({json:{write:!0}})],Df.prototype,"faces",void 0),u([ai("faces")],Df.prototype,"castFaces",null),u([p({type:uee,json:{write:!0}})],Df.prototype,"material",void 0),u([ai("material")],Df.prototype,"castMaterial",null),u([p()],Df.prototype,"name",void 0),u([p({type:String,json:{write:!0}})],Df.prototype,"shading",void 0),u([p({type:Boolean})],Df.prototype,"trustSourceNormals",void 0),Df=cO=u([M(O3e)],Df);const Uut=Df;let uO=class extends es(pe){constructor(e){super(e),this.type="georeferenced-relative",this.isRelative=!0,this.isGeoreferenced=!0,this.origin=E()}getOriginPoint(e){const[i,r,n]=this.origin;return new ut({x:i,y:r,z:n,spatialReference:e})}setOriginFromPoint({x:e,y:i,z:r}){this.origin=Oe(e,i,r??0)}};u([nt({georeferencedRelative:"georeferenced-relative"},{readOnly:!0})],uO.prototype,"type",void 0),u([p({type:[Number],nonNullable:!0,json:{write:!0}})],uO.prototype,"origin",void 0),uO=u([M("esri.geometry.support.MeshGeoreferencedRelativeVertexSpace")],uO);const zut=uO;let v4=class extends es(pe){constructor(){super({}),this.type="georeferenced",this.isRelative=!1,this.isGeoreferenced=!0}};u([nt({georeferenced:"georeferenced"},{readOnly:!0})],v4.prototype,"type",void 0),v4=u([M("esri.geometry.support.MeshGeoreferencedVertexSpace")],v4);const But=v4;let hO=class extends es(pe){constructor(e){super(e),this.type="local",this.isRelative=!0,this.isGeoreferenced=!1,this.origin=E()}getOriginPoint(e){const[i,r,n]=this.origin;return new ut({x:i,y:r,z:n,spatialReference:e})}setOriginFromPoint({x:e,y:i,z:r}){this.origin=Oe(e,i,r??0)}};u([nt({local:"local"},{readOnly:!0})],hO.prototype,"type",void 0),u([p({type:[Number],nonNullable:!0,json:{write:!0}})],hO.prototype,"origin",void 0),hO=u([M("esri.geometry.support.MeshLocalVertexSpace")],hO);const Vut=hO;var CW;let Nf=CW=class extends pe{constructor(t){super(t),this.translation=E(),this.rotationAxis=Ta(gTe),this.rotationAngle=0,this.scale=Oe(1,1,1)}get rotation(){return KN(this.rotationAxis,this.rotationAngle)}set rotation(t){this.rotationAxis=Qr(t),this.rotationAngle=xXe(t)}get localMatrix(){const t=be();return _P(wce,this.rotation,IH(this.rotation)),i0e(t,wce,this.translation,this.scale),t}get localMatrixInverse(){return fs(be(),this.localMatrix)}applyLocal(t,e){return ke(e,t,this.localMatrix)}applyLocalInverse(t,e){return ke(e,t,this.localMatrixInverse)}equals(t){return this===t||t!=null&&TZ(this.localMatrix,t.localMatrix)}clone(){const t={translation:Qr(this.translation),rotationAxis:Qr(this.rotationAxis),rotationAngle:this.rotationAngle,scale:Qr(this.scale)};return new CW(t)}};u([p({type:[Number],nonNullable:!0,json:{write:!0}})],Nf.prototype,"translation",void 0),u([p({type:[Number],nonNullable:!0,json:{write:!0}})],Nf.prototype,"rotationAxis",void 0),u([p({type:Number,nonNullable:!0,json:{write:!0}})],Nf.prototype,"rotationAngle",void 0),u([p({type:[Number],nonNullable:!0,json:{write:!0}})],Nf.prototype,"scale",void 0),u([p()],Nf.prototype,"rotation",null),u([p()],Nf.prototype,"localMatrix",null),u([p()],Nf.prototype,"localMatrixInverse",null),Nf=CW=u([M("esri.geometry.support.MeshTransform")],Nf);const wce=hd(),Gut=Nf;function R3e(t,e){return t.isGeographic||t.isWebMercator&&(e?.geographic??!0)}function VUt(t,e,i){const r=!t.isGeoreferenced;i?.geographic!=null&&i.geographic!==r&&K.getLogger(e).warnOnce(`Specifying the 'geographic' parameter (${i.geographic}) for a Mesh vertex space of type "${t.type}" is not supported. This parameter will be ignored.`)}const l8=K.getLogger("esri.geometry.support.meshUtils.normalProjection");function P3e(t,e,i,r,n){return u8(r)?(c8(my.TO_PCPF,Ws.fromTypedArray(t),ld.fromTypedArray(e),ld.fromTypedArray(i),r,Ws.fromTypedArray(n)),n):(l8.error("Cannot convert spatial reference to PCPF"),n)}function jut(t,e,i,r,n){return u8(r)?(c8(my.FROM_PCPF,Ws.fromTypedArray(t),ld.fromTypedArray(e),ld.fromTypedArray(i),r,Ws.fromTypedArray(n)),n):(l8.error("Cannot convert to spatial reference from PCPF"),n)}function Hut(t,e,i){return rn(t,e,0,i,LC(e),0,t.length/3),i}function qut(t,e,i){return rn(t,LC(i),0,e,i,0,t.length/3),e}function M3e(t,e,i){return Oy(co,i),Bp(e,t,co),ZJ(co)||i8(e,e),e}function $3e(t,e,i){if(Oy(co,i),Bp(e,t,co,4),ZJ(co)||i8(e,e,4),t!==e)for(let r=3;r<t.length;r+=4)e[r]=t[r];return e}function I3e(t,e,i,r,n){if(!u8(r))return l8.error("Cannot convert spatial reference to PCPF"),n;c8(my.TO_PCPF,Ws.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),ld.fromTypedArray(e),ld.fromTypedArray(i),r,Ws.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT));for(let s=3;s<t.length;s+=4)n[s]=t[s];return n}function Wut(t,e,i,r,n){if(!u8(r))return l8.error("Cannot convert to spatial reference from PCPF"),n;c8(my.FROM_PCPF,Ws.fromTypedArray(t,16),ld.fromTypedArray(e),ld.fromTypedArray(i),r,Ws.fromTypedArray(n,16));for(let s=3;s<t.length;s+=4)n[s]=t[s];return n}function c8(t,e,i,r,n,s){if(!e)return;const o=i.count,a=LC(n);if(L3e(n))for(let l=0;l<o;l++)r.getVec(l,EL),e.getVec(l,cf),Bc(a,EL,CL,a),rd(co,CL),t===my.FROM_PCPF&&nd(co,co),Nc(cf,cf,co),s.setVec(l,cf);else for(let l=0;l<o;l++){r.getVec(l,EL),e.getVec(l,cf),Bc(a,EL,CL,a),rd(co,CL);const c=$5(i.get(l,1));let h=Math.cos(c);t===my.TO_PCPF&&(h=1/h),co[0]*=h,co[1]*=h,co[2]*=h,co[3]*=h,co[4]*=h,co[5]*=h,t===my.FROM_PCPF&&nd(co,co),Nc(cf,cf,co),ye(cf,cf),s.setVec(l,cf)}return s}function u8(t){return L3e(t)||Yut(t)}function L3e(t){return t.isWGS84||aye(t)||km(t)||Um(t)}function Yut(t){return t.isWebMercator}var my;(function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"})(my||(my={}));const EL=E(),cf=E(),CL=be(),co=nn();function hee(t,e,i){return R3e(e.spatialReference,i)?Kut(t,e,i):Jut(t,e,i)}function D3e(t,e=Kr){const{position:i,normal:r,tangent:n}=t;return{position:zp(new Float64Array(i.length),i,e),normal:r!=null?M3e(r,new Float32Array(r.length),e):null,tangent:n!=null?$3e(n,new Float32Array(n.length),e):null}}function N3e(t,e,i,r){const{position:n,normal:s,tangent:o}=t;return e.isRelative?hee(D3e(t,i?.localMatrix),e.getOriginPoint(r),{geographic:!e.isGeoreferenced}):{position:n,normal:s,tangent:o}}function Xut(t,e,i){if(i?.useTransform){const{position:r,normal:n,tangent:s}=t,{x:o,y:a,z:l}=e,c=Oe(o,a,l??0);return{vertexAttributes:{position:r,normal:n,tangent:s},vertexSpace:i.geographic??1?new Vut({origin:c}):new zut({origin:c}),transform:new Gut}}return{vertexAttributes:hee(t,e,i),vertexSpace:new But,transform:null}}function AW(t,e,i){return R3e(e.spatialReference,i)?iht(t,e,i):k3e(t,e,i)}function Zut(t,e,i,r,n){if(!e.isRelative)return AW(t,r,n);const{spatialReference:s}=r,o=N3e(t,e,i,s);return r.equals(e.getOriginPoint(s))?k3e(o,r,n):AW(o,r,n)}function F3e({positions:t,transform:e,vertexSpace:i,inSpatialReference:r,outSpatialReference:n,outPositions:s,localMode:o}){const a=i.isRelative?i.origin:vo,l=i.isRelative?e?.localMatrix??Kr:Kr;if(i.isGeoreferenced){const f=s??_o(t.length);if(O6(l,Kr)?UZe(f,t):zp(f,t,l),!oa(a,vo)){const[m,y,_]=a;for(let v=0;v<f.length;v+=3)f[v]+=m,f[v+1]+=y,f[v+2]+=_}return rn(f,r,0,f,n,0,f.length/3),f}let c=r;const h=LC(r);c=n.isWebMercator&&o||!$p(r,h)?c:h,Bc(r,a,Iw,c),qi(Iw,Iw,l);const d=s??_o(t.length);return zp(d,t,Iw),rn(d,c,0,d,n,0,d.length/3),d}function Jut(t,e,i){const r=new Float64Array(t.position.length),n=t.position,s=e.x,o=e.y,a=e.z??0,l=dee(i?i.unit:null,e.spatialReference);for(let c=0;c<n.length;c+=3)r[c]=n[c]*l+s,r[c+1]=n[c+1]*l+o,r[c+2]=n[c+2]*l+a;return{position:r,normal:t.normal,tangent:t.tangent}}function Kut(t,e,i){const r=e.spatialReference,n=U3e(e,i,Iw),s=new Float64Array(t.position.length),o=Qut(t.position,n,r,s),a=Oy(z3e,n);return{position:o,normal:eht(o,s,t.normal,a,r),tangent:tht(o,s,t.tangent,a,r)}}function Qut(t,e,i,r){zp(r,t,e);const n=new Float64Array(t.length);return qut(r,n,i)}function eht(t,e,i,r,n){if(i==null)return null;const s=new Float32Array(i.length);return Bp(s,i,r),jut(s,t,e,n,s),s}function tht(t,e,i,r,n){if(i==null)return null;const s=new Float32Array(i.length);Bp(s,i,r,4);for(let o=3;o<s.length;o+=4)s[o]=i[o];return Wut(s,t,e,n,s),s}function k3e(t,e,i){const r=new Float64Array(t.position.length),n=t.position,s=e.x,o=e.y,a=e.z??0,l=dee(i?i.unit:null,e.spatialReference);for(let c=0;c<n.length;c+=3)r[c]=(n[c]-s)/l,r[c+1]=(n[c+1]-o)/l,r[c+2]=(n[c+2]-a)/l;return{position:r,normal:t.normal,tangent:t.tangent}}function iht(t,e,i){const r=e.spatialReference;U3e(e,i,Iw);const n=fs(oht,Iw),s=new Float64Array(t.position.length),o=rht(t.position,r,n,s),a=Oy(z3e,n);return{position:o,normal:nht(t.normal,t.position,s,r,a),tangent:sht(t.tangent,t.position,s,r,a)}}function U3e(t,e,i){Bc(t.spatialReference,[t.x,t.y,t.z??0],i,LC(t.spatialReference));const r=dee(e?e.unit:null,t.spatialReference);return mM(i,i,[r,r,r]),i}function rht(t,e,i,r){const n=Hut(t,e,r),s=new Float64Array(n.length);return zp(s,n,i),s}function nht(t,e,i,r,n){if(t==null)return null;const s=P3e(t,e,i,r,new Float32Array(t.length));return Bp(s,s,n),s}function sht(t,e,i,r,n){if(t==null)return null;const s=I3e(t,e,i,r,new Float32Array(t.length));return Bp(s,s,n,4),s}function dee(t,e){if(t==null)return 1;const i=M7(e);return 1/No(i,"meters",t)}const Iw=be(),oht=be(),z3e=nn(),GUt=Object.freeze(Object.defineProperty({__proto__:null,applyTransform:D3e,georeference:hee,georeferenceApplyTransform:N3e,georeferenceByTransform:Xut,project:F3e,ungeoreference:AW,ungeoreferenceByTransform:Zut},Symbol.toStringTag,{value:"Module"}));var CR;(function(t){t[t.EnableFastUpdates=0]="EnableFastUpdates",t[t.DisableFastUpdates=1]="DisableFastUpdates",t[t.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"})(CR||(CR={}));let B3e=class{constructor(e){this.data=e,this.type="encoded-mesh-texture",this.encoding=cy.KTX2_ENCODING}};function AR(t){return t?.type==="encoded-mesh-texture"}async function aht(t){const e=new Blob([t]),i=await e.text();return JSON.parse(i)}async function lht(t,e){if(e===cy.KTX2_ENCODING)return new B3e(t);const i=new Blob([t],{type:e}),r=URL.createObjectURL(i),n=new Image;if(ie("esri-iPhone"))return new Promise((s,o)=>{const a=()=>{c(),s(n)},l=h=>{c(),o(h)},c=()=>{URL.revokeObjectURL(r),n.removeEventListener("load",a),n.removeEventListener("error",l)};n.addEventListener("load",a),n.addEventListener("error",l),n.src=r});try{n.src=r,await n.decode()}catch{console.warn("Failed decoding HTMLImageElement")}return URL.revokeObjectURL(r),n}function im(t){if(t==null)return null;const e=t.offset!=null?t.offset:wCe,i=t.rotation!=null?t.rotation:0,r=t.scale!=null?t.scale:xCe,n=d4(1,0,0,0,1,0,e[0],e[1],1),s=d4(Math.cos(i),-Math.sin(i),0,Math.sin(i),Math.cos(i),0,0,0,1),o=d4(r[0],0,0,0,r[1],0,0,0,1),a=Ma();return XE(a,s,o),XE(a,n,a),a}let cht=class extends Ym{constructor(){super(...arguments),this._originalGeometries=[],this._fastTransformUpdatesEnabled=!1}get fastTransformUpdatesEnabled(){return this._fastTransformUpdatesEnabled}enableFastTransformUpdates(e,i){if(this._fastTransformUpdatesEnabled)return;this._fastTransformUpdatesEnabled=!0;const{stageObject:r}=this,n=r.geometries.slice();r.removeAllGeometries();const s=U5(hB,r.transformation),o=i.getOrigin(s);for(const a of n){const l=e(a.material),c=a.instantiate({material:l});c.localOrigin=o,r.addGeometry(c)}this._originalGeometries=n}disableFastTransformUpdates(e){if(!this._fastTransformUpdatesEnabled)return;this._fastTransformUpdatesEnabled=!1;const{stageObject:i}=this,r=i.geometries.map(n=>e(n.material));i.removeAllGeometries();for(let n=0;n<this._originalGeometries.length;n++){const s=this._originalGeometries[n],o=r[n];o.setParameters({modelTransformation:null}),o===s.material?i.addGeometry(s):i.addGeometry(s.instantiate({material:o}))}this._originalGeometries.length=0}updateFastLocalOrigin(e,i,r){if(!this._fastTransformUpdatesEnabled)return;const{stageObject:n}=this;if(n.geometries.length===0)return;const s=n.geometries[0].localOrigin,o=U5(hB,e),a=r.getOrigin(o);if(a===s)return;const l=i?.localMatrix??Kr;n.shaderTransformation=null,n.transformation=e,n.geometries.forEach(c=>{c.transformation=l,c.localOrigin=a})}updateTransform(e,i,r){const{stageObject:n}=this,s=i?.localMatrix??Kr;if(!this._fastTransformUpdatesEnabled)return n.shaderTransformation=null,n.transformation=e,n.geometries.forEach(m=>{m.transformation=s}),void(this._fastUpdateEdgeTransform()||this.resetEdgeObject(r));const o=n.transformation,a=n.geometries[0].transformation,l=e,c=s,h=qi(xce,o,a),d=qi(Tce,l,c),f=qi(Sce,d,fs(Sce,a));n.shaderTransformation=f,this._setFastMaterialTransformation({matA:h,matB:d}),this._fastUpdateEdgeTransform()||this.resetEdgeObject(r)}alignWithElevation(e,i,r,n){if(!this._fastTransformUpdatesEnabled)return void super.alignWithElevation(e,i,r,n);r!=null&&WU(this.elevationContext.featureExpressionInfoContext,r);const s=(y,_)=>Bv(y,e,this.elevationContext,i,_),{stageObject:o}=this;if(!o.geometries[0].material.parameters.modelTransformation)return;const a=o.transformation,l=o.geometries[0].transformation,c=qi(xce,a,l),h=o.effectiveTransformation,d=Qn(uht,h);this.alignedSampledElevation=Xw(this,this.elevationContext,e.spatialReference,s,i,d),o.shaderTransformation=d;const f=o.geometries[0].transformation,m=qi(Tce,d,f);this._setFastMaterialTransformation({matA:c,matB:m}),this._fastUpdateEdgeTransform()||this.resetEdgeObject(n)}_setFastMaterialTransformation({matA:e,matB:i}){const{stageObject:r}=this;if(r.geometries.length===0)return;const n=r.geometries[0].localOrigin,s=gM(hht,re(hB,n.vec3,-1)),o=qi(Ece,s,e),a=qi(Cce,s,i),l=fs(Ece,o),c=qi(Cce,a,l);for(const h of r.geometries)h.material.setParameters({modelTransformation:c})}_fastUpdateEdgeTransform(){return this._stageLayer.stage.renderer.ensureEdgeView().fastUpdateObject3DEdgesTransform(this.stageObject)}};const hB=E(),xce=be(),Tce=be(),uht=be(),Sce=be(),Ece=be(),Cce=be(),hht=be();let dht=class{constructor(){this._fastTransformOriginalMaterials=new Map,this._fastTransformClonedMaterials=new Map,this._graphicReferenceCount=0}enable(e,i,r){e.enableFastTransformUpdates(n=>{if(this._graphicReferenceCount<=1){if(this._fastTransformOriginalMaterials.has(n))return n;const o=i.byMaterial(n);return this._fastTransformOriginalMaterials.set(n,o),i.delete(n),n}const s=new kp(n.parameters);return r.stage.add(s),this._fastTransformClonedMaterials.set(s,n),s},r.localOriginFactory)}disable(e,i,r){const n=new Set,s=new Set;e.disableFastTransformUpdates(o=>{if(!this._fastTransformClonedMaterials.has(o)){const c=o,h=this._fastTransformOriginalMaterials.get(c);return i.has(h.uid)?(n.add(c),i.byUid(h.uid).material):(s.add(c),h.material)}const a=o,l=this._fastTransformClonedMaterials.get(a);return this._fastTransformClonedMaterials.delete(a),r.stage.remove(a),l});for(const o of n)this._fastTransformOriginalMaterials.delete(o),r.stage.remove(o);for(const o of s){const a=this._fastTransformOriginalMaterials.get(o);this._fastTransformOriginalMaterials.delete(o),i.set(a.uid,a)}}onAddGraphic(){this._graphicReferenceCount++}onRemoveGraphic(e,i,r){this._graphicReferenceCount--,this.disable(e,i,r)}forEachMaterialInfo(e){this._fastTransformOriginalMaterials.forEach(e)}forEachClonedMaterial(e){this._fastTransformClonedMaterials.forEach(e)}destroy(e){e.removeMany(Array.from(this._fastTransformClonedMaterials.keys())),e.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),({material:i})=>i)),this._fastTransformClonedMaterials.clear(),this._fastTransformOriginalMaterials.clear()}},pht=class{constructor(){this._byUid=new Map,this._byMaterial=new Map}get materials(){return Array.from(this._byUid.values(),e=>e.material)}byUid(e){return this._byUid.get(e)}byMaterial(e){return this._byMaterial.get(e)}set(e,i){this._byUid.set(e,i),this._byMaterial.set(i.material,i)}delete(e){const i=this._byMaterial.get(e)?.uid;i&&(this._byUid.delete(i),this._byMaterial.delete(e))}has(e){return this._byUid.has(e)}forEachMaterialInfo(e){this._byUid.forEach(e)}clear(){this._byUid.clear(),this._byMaterial.clear()}};function fht(t){const e=new Ei,{vertex:i,fragment:r}=e;return e.include(Xl,t),e.include(tT,t),zc(i,t),e.attributes.add(O.POSITION,"vec3"),e.varyings.add("vpos","vec3"),i.code.add(b`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);
}`),t.output===F.Highlight&&e.include(s1,t),e.include(Dn,t),r.uniforms.add(new Re("alphaCoverage",(n,s)=>Math.min(1,n.width*s.camera.pixelRatio))),t.hasVertexColors||r.uniforms.add(new yi("constantColor",n=>n.color)),r.code.add(b`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${t.hasVertexColors?"vColor":"constantColor"};

    ${t.output===F.ObjectAndLayerIdColor?b`color.a = 1.0;`:""}

    if (color.a < ${b.float(zo)}) {
      discard;
    }

    ${t.output===F.Color?b`fragColor = highlightSlice(color, vpos);`:""}
    ${t.output===F.Highlight?b`outputHighlight();`:""}
  }
  `),e}const mht=Object.freeze(Object.defineProperty({__proto__:null,build:fht},Symbol.toStringTag,{value:"Module"}));let V3e=class G3e extends Fi{initializeProgram(e){return new Mi(e.rctx,G3e.shader.get().build(this.configuration),Si)}initializePipeline(){const e=this.configuration,i=Go(Te.SRC_ALPHA,Te.ONE,Te.ONE_MINUS_SRC_ALPHA,Te.ONE_MINUS_SRC_ALPHA),r=(n,s=null,o=null)=>Lt({blending:s,depthTest:CQ,depthWrite:o,colorWrite:Gt,stencilWrite:e.hasOccludees?$m:null,stencilTest:e.hasOccludees?n?Gv:a1:null});return e.output===F.Color?(this._occludeePipelineState=r(!0,e.transparent?i:null,ec),r(!1,e.transparent?i:null,ec)):r(!1)}get primitiveType(){return ci.LINES}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};V3e.shader=new Pi(mht,()=>ce(()=>import("./NativeLine.glsl-9b9639f9.js"),[],import.meta.url));let KS=class extends fl{constructor(){super(...arguments),this.output=F.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.hasOccludees=!1}};u([U({count:F.COUNT})],KS.prototype,"output",void 0),u([U()],KS.prototype,"hasSlicePlane",void 0),u([U()],KS.prototype,"hasVertexColors",void 0),u([U()],KS.prototype,"transparent",void 0),u([U()],KS.prototype,"hasOccludees",void 0);let Ace=class extends n1{constructor(e){super(e,new yht),this._configuration=new KS}getConfiguration(e){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration}intersect(e,i,r,n,s,o){if(!r.options.selectionMode||!e.visible)return;if(!Bxe(i))return void K.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const a=e.attributes.get(O.POSITION).data,l=r.camera,c=vht;gs(c,r.point);const h=2;ae(DA[0],c[0]-h,c[1]+h,0),ae(DA[1],c[0]+h,c[1]+h,0),ae(DA[2],c[0]+h,c[1]-h,0),ae(DA[3],c[0]-h,c[1]-h,0);for(let _=0;_<4;_++)if(!l.unprojectFromRenderScreen(DA[_],ag[_]))return;Ca(l.eye,ag[0],ag[1],dB),Ca(l.eye,ag[1],ag[2],pB),Ca(l.eye,ag[2],ag[3],fB),Ca(l.eye,ag[3],ag[0],mB);let d=Number.MAX_VALUE,f=0;for(let _=0;_<a.length-5;_+=3){if(Cl[0]=a[_]+i[12],Cl[1]=a[_+1]+i[13],Cl[2]=a[_+2]+i[14],Al[0]=a[_+3]+i[12],Al[1]=a[_+4]+i[13],Al[2]=a[_+5]+i[14],hr(dB,Cl)<0&&hr(dB,Al)<0||hr(pB,Cl)<0&&hr(pB,Al)<0||hr(fB,Cl)<0&&hr(fB,Al)<0||hr(mB,Cl)<0&&hr(mB,Al)<0)continue;if(l.projectToRenderScreen(Cl,F1),l.projectToRenderScreen(Al,k1),F1[2]<0&&k1[2]>0){de(uf,Cl,Al);const w=l.frustum,x=-hr(w[br.NEAR],Cl)/ge(uf,w[br.NEAR]);re(uf,uf,x),ue(Cl,Cl,uf),l.projectToRenderScreen(Cl,F1)}else if(F1[2]>0&&k1[2]<0){de(uf,Al,Cl);const w=l.frustum,x=-hr(w[br.NEAR],Al)/ge(uf,w[br.NEAR]);re(uf,uf,x),ue(Al,Al,uf),l.projectToRenderScreen(Al,k1)}else if(F1[2]<0&&k1[2]<0)continue;F1[2]=0,k1[2]=0;const v=PJ(jw(F1,k1,Pce),c);v<d&&(d=v,oe(Oce,Cl),oe(Rce,Al),f=_/3)}const m=r.rayBegin,y=r.rayEnd;if(d<h*h){let _=Number.MAX_VALUE;if(vbe(jw(Oce,Rce,Pce),jw(m,y,_ht),N1)){de(N1,N1,m);const v=xe(N1);re(N1,N1,1/v),_=v/Mr(m,y)}o(_,N1,f,!1)}}intersectDraped(e,i,r,n,s,o){if(!r.options.selectionMode)return;const a=e.attributes.get(O.POSITION).data,l=e.attributes.get(O.SIZE),c=l?l.data[0]:0,h=n[0],d=n[1],f=((c+1)/2+4)*e.screenToWorldRatio;let m=Number.MAX_VALUE,y=0;for(let _=0;_<a.length-5;_+=3){const v=a[_],w=a[_+1],x=h-v,T=d-w,S=a[_+3]-v,C=a[_+4]-w,A=_e((S*x+C*T)/(S*S+C*C),0,1),R=S*A-x,D=C*A-T,N=R*R+D*D;N<m&&(m=N,y=_/3)}m<f*f&&s(o.dist,o.normal,y,!1)}produces(e,i){return!(i!==F.Color&&i!==F.Highlight&&i!==F.ObjectAndLayerIdColor||e!==le.OPAQUE_MATERIAL&&e!==le.DRAPED_MATERIAL)}createGLMaterial(e){return new ght(e)}createBufferWriter(){const e=this.parameters.hasVertexColors?olt:nlt;return new VC(e)}},ght=class extends i1{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===F.Color&&this._updateOccludeeState(e),this.ensureTechnique(V3e,e)}},yht=class extends fQ{constructor(){super(...arguments),this.color=Hh,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.hasOccludees=!1}};const Cl=E(),Al=E(),uf=E(),N1=E(),F1=aa(),k1=aa(),Oce=E(),Rce=E(),Pce=Vp(),_ht=Vp(),vht=E(),DA=[aa(),aa(),aa(),aa()],ag=[E(),E(),E(),E()],dB=Ii(),pB=Ii(),fB=Ii(),mB=Ii(),bht=["mesh"];class wht extends Xm{constructor(e,i,r,n){super(e,i,r,n),this._materialInfoCache=new pht,this._fastUpdateProcessor=new dht,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){pr.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new Ace({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new Ace({color:[0,1,1,1]}))}destroy(){super.destroy(),this._textures.forEach(e=>e.unload()),this._context.stage.removeMany(this._materialInfoCache.materials),this._context.stage.removeMany(Array.from(this._textures.values())),this._materialInfoCache.clear(),this._textures.clear(),this._fastUpdateProcessor.destroy(this._context.stage)}get materials(){return this._materialInfoCache.materials}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,bht,"fill on mesh-3d"))return null;const r=this.setGraphicElevationContext(i),n=e.renderingInfo;return this._createAs3DShape(i,n,r,i.uid)}onRemoveGraphic(e){this._fastUpdateProcessor.onRemoveGraphic(e,this._materialInfoCache,this._context)}layerOpacityChanged(e,i){const r=this._getLayerOpacity();this._updateMaterialParameters(n=>{n.material.setParameters({layerOpacity:r});const s=n.material.parameters;this._setMaterialTransparentParameter(s,n),n.material.setParameters({transparent:s.transparent})}),e.forEach(n=>i(n)?.layerOpacityChanged(r,this._context.isAsync))}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,Vv)}slicePlaneEnabledChanged(e,i){return this._updateMaterialParameters(({material:r})=>{r.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),e.forEach(r=>i(r)?.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._updateMaterialParameters(({material:i})=>i.setParameters({usePBR:e})),!0}updateTransform(e,i,r,n){const s=this._context.renderCoordsHelper.spatialReference,o=xht,{origin:a,transform:l}=r;switch(Bc(i,ae(Qs,a.x,a.y,a.z??0),o,s),n){case CR.EnableFastUpdates:this._fastUpdateProcessor.enable(e,this._materialInfoCache,this._context);break;case CR.DisableFastUpdates:this._fastUpdateProcessor.disable(e,this._materialInfoCache,this._context);break;case CR.UpdateFastLocalOrigin:e.updateFastLocalOrigin(o,l,this._context.localOriginFactory)}const{elevationContext:c}=e;c.centerPointInElevationSR=this._getCenterPointInElevationSR(o);const{elevationProvider:h,renderCoordsHelper:d}=this._context,f=(m,y)=>Bv(m,h,c,d,y);return e.alignedSampledElevation=Xw(e,c,h.spatialReference,f,d,o),e.updateTransform(o,l,this._context.isAsync),!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(e){return e==null?"-":e instanceof Pe?e.toHex():e.contentHash}_materialPropertiesDefault(e,i){const r=this._requiresSymbolVertexColors(),n=!!e.vertexAttributes.color,s=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:r,hasVertexColors:n,hasVertexTangents:s,uid:`vc:${n},vt:${s},vct${i},svc:${r}`}}_textureTransformUid(e){const{offset:i,scale:r,rotation:n}=e??Sht;return`${i[0]},${i[1]},${n},${r[0]},${r[1]}`}_materialProperties(e,i,r){const n=this._materialPropertiesDefault(e,r);if(!i.material)return n;const{color:s,colorTexture:o,colorTextureTransform:a,normalTexture:l,normalTextureTransform:c,doubleSided:h,alphaCutoff:d,alphaMode:f}=i.material,m=this._colorOrTextureUid(s),y=this._colorOrTextureUid(o),_=this._textureTransformUid(a),v=this._colorOrTextureUid(l),w=this._textureTransformUid(c);if(n.color=s,n.colorTexture=o,n.normalTexture=l,n.uid=`${n.uid},cmuid:${m},ctmuid:${y},cttuid:${_},ntmuid:${v},nttuid:${w},ds:${h},ac:${d},am:${f}`,i.material instanceof C3e){const{metallic:x,roughness:T,metallicRoughnessTexture:S,metallicRoughnessTextureTransform:C,emissiveColor:A,emissiveTexture:R,emissiveTextureTransform:D,occlusionTexture:N,occlusionTextureTransform:k}=i.material,B=this._colorOrTextureUid(S),L=this._textureTransformUid(C),z=this._colorOrTextureUid(A),j=this._colorOrTextureUid(R),H=this._textureTransformUid(D),X=this._colorOrTextureUid(N),P=this._textureTransformUid(k);n.metallic=x,n.roughness=T,n.metallicRoughnessTexture=S,n.emissiveColor=A,n.emissiveTexture=R,n.occlusionTexture=N,n.colorTextureTransform=this._convertTextureTransform(a),n.normalTextureTransform=this._convertTextureTransform(c),n.emissiveTextureTransform=this._convertTextureTransform(D),n.occlusionTextureTransform=this._convertTextureTransform(k),n.metallicRoughnessTextureTransform=this._convertTextureTransform(C),n.uid=`${n.uid},mrm:${x},mrr:${T},mrt:${B},mrtt:${L},emuid:${z},etmuid:${j},ett:${H},otmuid:${X},ott:${P}`}return n}_convertTextureTransform(e){if(!e)return null;const{scale:i,offset:r,rotation:n}=e;return{scale:i,offset:r,rotation:Dt(n)}}_setInternalColorValueParameters(e,i){i.diffuse=Pe.toUnitRGB(e),i.opacity=e.a}_getLoadableTextureResource(e){return e.data??e.url}_getInternalTextureId(e){return this._getInternalTexture(e,nr.Opaque)?.id}_getInternalTexture(e,i){const r=this._getLoadableTextureResource(e);if(!r)return null;const n=`${e.contentHash}/${i}`;let s=this._textures.get(n);if(!s){let o=null;const a=this._context.stage.renderView.renderingContext.parameters.maxMaxAnisotropy,l={wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0,maxAnisotropy:a,mipmap:a>1};AR(r)?(o=r.data,l.preMultiplyAlpha=!1,l.encoding=r.encoding):(o=r,l.preMultiplyAlpha=i!==nr.Opaque,l.downsampleUncompressed=this._context.graphicsCoreOwner.view.qualitySettings.graphics3D.uncompressedTextureDownsamplingEnabled),s=new iT(o,l),this._textures.set(n,s),s.load(this._context.stage.renderView.renderingContext),this._context.stage.add(s)}return s}_castTextureWrap(e="repeat"){if(typeof e=="string"){const i=this._castTextureWrapIndividual(e);return{s:i,t:i}}return{s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}}_castTextureWrapIndividual(e){switch(e){case"clamp":return Vt.CLAMP_TO_EDGE;case"mirror":return Vt.MIRRORED_REPEAT;default:return Vt.REPEAT}}_setInternalMaterialParameters(e,i){if(e.color!=null&&this._setInternalColorValueParameters(e.color,i),e.colorTexture!=null){const r=this._getInternalTexture(e.colorTexture,i.textureAlphaMode);r?(i.textureId=r.id,i.textureAlphaPremultiplied=!!r.parameters.preMultiplyAlpha):i.textureId=void 0}e.normalTexture&&(i.normalTextureId=this._getInternalTextureId(e.normalTexture)),e.emissiveColor&&(i.emissiveFactor=Pe.toUnitRGB(e.emissiveColor)),e.emissiveTexture&&(i.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),e.occlusionTexture&&(i.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),e.metallicRoughnessTexture&&(i.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture)),i.colorTextureTransformMatrix=im(e.colorTextureTransform),i.normalTextureTransformMatrix=im(e.normalTextureTransform),i.occlusionTextureTransformMatrix=im(e.occlusionTextureTransform),i.emissiveTextureTransformMatrix=im(e.emissiveTextureTransform),i.metallicRoughnessTextureTransformMatrix=im(e.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(e){const i=this._drivenProperties.color;let r=this.symbolLayer.material?.colorMixMode??null;if(i)e.externalColor=Hh;else{const n=this.symbolLayer.material?.color??null;n?e.externalColor=Pe.toUnitRGBA(n):(r=null,e.externalColor=Hh)}r&&(e.colorMixMode=r),e.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(e){const i=e.vertexAttributes.color;if(i==null)return!1;for(let r=3;r<i.length;r+=4)if(i[r]!==255)return!0;return!1}_getOrCreateMaterial(e,i){const r=i.material?.color,n=i.material?.colorTexture,s=i.material?.alphaMode,o=s==="blend",a=s!=="opaque"&&(this._hasTransparentVertexColors(e)||r!=null&&r.a<1||n?.transparent||o),l=this._materialProperties(e,i,a),c=this._materialInfoCache.byUid(l.uid);if(c)return c.material;const h={uid:l.uid,material:null,isComponentTransparent:a,alphaMode:i.material?i.material.alphaMode:"opaque"},d=qEe({normalTexture:l.normalTexture,metallicRoughnessTexture:l.metallicRoughnessTexture,metallicFactor:l.metallic,roughnessFactor:l.roughness,emissiveTexture:l.emissiveTexture,emissiveFactor:Pe.toUnitRGB(l.emissiveColor),occlusionTexture:l.occlusionTexture}),f={usePBR:this._usePBR(),isSchematic:d,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:vo,diffuse:ey,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:xr.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};f.mrrFactors=d?[...AQ]:[l.metallic,l.roughness,XU[2]],i.material&&(f.doubleSided=i.material.doubleSided,f.cullFace=i.material.doubleSided?xr.None:xr.Back,f.textureAlphaCutoff=i.material.alphaCutoff),this._setExternalMaterialParameters(f),this._setMaterialTransparentParameter(f,h),this._setInternalMaterialParameters(l,f);const m=new kp(f);return h.material=m,this._materialInfoCache.set(l.uid,h),this._context.stage.add(m),m}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,i){e.transparent=this.needsDrivenTransparentPass||i.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,i.alphaMode==="auto"?e.textureAlphaMode=e.transparent?nr.MaskBlend:nr.Opaque:e.textureAlphaMode=i.alphaMode==="opaque"?nr.Opaque:i.alphaMode==="mask"?nr.Mask:nr.Blend}_addDebugNormals(e,i){const r=i.length,n=e.spatialReference.isGeographic?20015077/180:1,s=.1*Math.max(e.extent.width*n,e.extent.height*n,e.extent.zmax-e.extent.zmin),o=[],a=[],l=[],c=[];for(let m=0;m<r;m++){const y=i[m],_=y.attributes.get(O.POSITION),v=y.attributes.get(O.NORMAL),w=_.data,x=_.indices,T=v.data,S=v.indices;for(let C=0;C<x.length;C++){const A=3*x[C],R=3*S[C];for(let D=0;D<3;D++)o.push(w[A+D]);for(let D=0;D<3;D++)o.push(w[A+D]+T[R+D]*s);if(a.push(a.length),a.push(a.length),C%3==0){this._calculateFaceNormal(w,x,C,XT),this._getFaceVertices(w,x,C,Qs,WT,YT),ue(Qs,Qs,WT),ue(Qs,Qs,YT),re(Qs,Qs,1/3);for(let D=0;D<3;D++)l.push(Qs[D]);for(let D=0;D<3;D++)l.push(Qs[D]+XT[D]*s);c.push(c.length),c.push(c.length)}}}const h=i[0].transformation,d=new ms(this._debugVertexNormalMaterial,[[O.POSITION,new Ve(o,a,3,!0)]],null,wn.Line);i.push(d),d.transformation=h;const f=new ms(this._debugFaceNormalMaterial,[[O.POSITION,new Ve(l,c,3,!0)]],null,wn.Line);f.transformation=h,i.push(f)}_createAs3DShape(e,i,r,n){const s=e.geometry;if(s.type!=="mesh")return null;const o=this._createGeometryInfo(s,i,n);if(o==null)return null;const{geometries:a,objectTransformation:l}=o;pr.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(s,a);const c=new Jy({geometries:a,layerUid:this._context.layer.uid,graphicUid:n});c.transformation=l;const h=UEe(this.symbolLayer,{opacity:this._getLayerOpacity()}),d=h?new Prt(a[0].material,[h],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,f=new cht(this,c,a,null,null,Xw,r,d);this._fastUpdateProcessor.onAddGraphic(),f.needsElevationUpdates=Vv(r.mode),f.useObjectOriginAsAttachmentOrigin=!0,r.centerPointInElevationSR=this._getCenterPointInElevationSR(c.transformation);const{elevationProvider:m,renderCoordsHelper:y}=this._context,_=(v,w)=>Bv(v,m,r,y,w);return f.alignedSampledElevation=Xw(f,r,m.spatialReference,_,y),f}_getCenterPointInElevationSR(e){const i=t1(0,0,0,this._context.elevationProvider.spatialReference!=null?this._context.elevationProvider.spatialReference:null);return S3e([e[12],e[13],e[14]],this._context.renderCoordsHelper.spatialReference,i),i}_createComponentNormals(e,i,r,n){switch(r.shading||"flat"){default:case"source":return this._createComponentNormalsSource(e,i,r,n);case"flat":return this._createComponentNormalsFlat(e,n);case"smooth":return this._createComponentNormalsSmooth(e,n)}}_createComponentNormalsSource(e,i,r,n){if(i==null)return this._createComponentNormalsFlat(e,n);let s=!1;if(!r.trustSourceNormals)for(let o=0;o<n.length;o+=3){this._calculateFaceNormal(e,n,o,XT);for(let a=0;a<3;a++){const l=3*n[o+a];Qs[0]=i[l],Qs[1]=i[l+1],Qs[2]=i[l+2],ge(XT,Qs)<0&&(i[l]=-i[l],i[l+1]=-i[l+1],i[l+2]=-i[l+2],s=!0)}}return new gB(i,n,s)}_createComponentNormalsFlat(e,i){const r=un(i.length),n=new Array(3*i.length);for(let s=0;s<i.length;s+=3){const o=this._calculateFaceNormal(e,i,s,XT);for(let a=0;a<3;a++)r[s+a]=o[a],n[s+a]=s/3}return new gB(r,n,!1)}_createComponentNormalsSmooth(e,i){const r={};for(let o=0;o<i.length;o+=3){const a=this._calculateFaceNormal(e,i,o,XT);for(let l=0;l<3;l++){const c=i[o+l];let h=r[c];h||(h={normal:E(),count:0},r[c]=h),ue(h.normal,h.normal,a),h.count++}}const n=un(3*i.length),s=new Array(3*i.length);for(let o=0;o<i.length;o++){const a=r[i[o]];a.count!==1&&(ye(a.normal,a.normal),a.count=1);for(let l=0;l<3;l++)n[3*o+l]=a.normal[l];s[o]=o}return new gB(n,s,!1)}_getFaceVertices(e,i,r,n,s,o){const a=3*i[r],l=3*i[r+1],c=3*i[r+2];n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],s[0]=e[l],s[1]=e[l+1],s[2]=e[l+2],o[0]=e[c],o[1]=e[c+1],o[2]=e[c+2]}_calculateFaceNormal(e,i,r,n){return this._getFaceVertices(e,i,r,Qs,WT,YT),de(WT,WT,Qs),de(YT,YT,Qs),lt(Qs,WT,YT),ye(n,Qs),n}_getOrCreateComponents(e){return e.components??Tht}_createPositionBuffer(e,i){let r=e.vertexAttributes.position;const n=i.reprojection===xc.ECEF?i.transformBeforeProject:null;if(n&&(r=zp(new Float64Array(r.length),r,n)),i.reprojection===xc.NONE)return i.needsBufferCopy?new Float64Array(r):r;const s=n?r:new Float64Array(r.length);return rn(r,e.spatialReference,0,s,this._context.renderCoordsHelper.spatialReference,0,r.length/3),s}_createNormalBuffer(e,i,r){let n=e.vertexAttributes.normal;if(n==null)return null;const s=r.reprojection===xc.ECEF?r.transformBeforeProject:null;if(s&&(n=M3e(n,new Float32Array(n.length),s)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===xc.NONE)return r.needsBufferCopy&&e.vertexAttributes.normal===n?new Float32Array(n):n;const o=e.vertexAttributes.position,a=s?n:new Float32Array(n.length);return P3e(n,o,i,e.spatialReference,a)}_createTangentBuffer(e,i,r){let n=e.vertexAttributes.tangent;if(n==null)return null;const s=r.reprojection===xc.ECEF?r.transformBeforeProject:null;if(s&&(n=$3e(n,new Float32Array(n.length),s)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===xc.NONE)return r.needsBufferCopy&&e.vertexAttributes.normal===n?new Float32Array(n):n;const o=e.vertexAttributes.position,a=s?n:new Float32Array(n.length);return I3e(n,o,i,e.spatialReference,a)}_createColorBuffer(e){return e.vertexAttributes.color}_createSymbolColorBuffer(e){if(this._requiresSymbolVertexColors()){const i=this._getVertexOpacityAndColor(e),r=Wrt(this.symbolLayer?.material?.colorMixMode),n=new Uint8Array(4);return YEe(i,r,n),n}return null}_createBuffers(e,i){const r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const n=e.vertexAttributes.normal,s=e.vertexAttributes.uv,o=e.vertexAttributes.tangent;if(n&&n.length!==r.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(o&&o.length/4!=r.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(s&&s.length/2!=r.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(e),l=this._createPositionBuffer(e,a),c=this._createColorBuffer(e),h=this._createSymbolColorBuffer(i),d=this._createNormalBuffer(e,l,a),f=this._createTangentBuffer(e,l,a);return{positionBuffer:l,normalBuffer:d,tangentBuffer:f,uvBuffer:s,colorBuffer:c,symbolColorBuffer:h,objectTransformation:a.reprojection===xc.NONE&&a.objectTransformation?a.objectTransformation:this._transformOriginLocal(e,l,d,f),geometryTransformation:a.reprojection===xc.NONE&&a.geometryTransformation?a.geometryTransformation:be()}}_computeReprojectionInfo(e){const{vertexSpace:i}=e,r=i.isRelative,n=i.isGeoreferenced?this._context.renderCoordsHelper.viewingMode===Le.Local?xc.NONE:xc.ECEF:xc.NONE;if(r){const{origin:s}=i,o=be(),a=e.transform?.localMatrix??Kr;if(n===xc.NONE)return Bc(e.spatialReference,s,o,this._context.renderCoordsHelper.spatialReference),{reprojection:n,objectTransformation:o,geometryTransformation:HE(a),needsBufferCopy:!1};const l=gM(be(),s);return qi(l,l,a),{reprojection:n,transformBeforeProject:l,needsBufferCopy:!0}}return{reprojection:n,needsBufferCopy:!0}}_transformOriginLocal(e,i,r,n){const s=this._context.renderCoordsHelper.spatialReference,o=e.anchor;AL[0]=o.x,AL[1]=o.y,AL[2]=o.z??0;const a=be();return Bc(e.spatialReference,AL,a,s),fs(Mce,a),zp(i,i,Mce),(r||n)&&(rd(NA,a),nd(NA,NA),r&&Bp(r,r,NA),n&&Bp(n,n,NA,4)),a}_validateFaces(e,i){const r=e.vertexAttributes.position.length/3,n=i.faces;if(n){let s=-1;for(let o=0;o<n.length;o++){const a=n[o];a>s&&(s=a)}if(r<=s)return this.logger.warn(`Vertex index ${s} is out of bounds of the mesh position buffer`),!1}else if(r%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(e,i){return i.faces??Kx(e.vertexAttributes.position.length/3)}_isOutsideClippingArea(e){if(!this._context.clippingExtent)return!1;const i=e.vertexAttributes?.position;if(!i)return!1;const r=this._context.elevationProvider.spatialReference,n=F3e({positions:i,transform:e.transform,vertexSpace:e.vertexSpace,inSpatialReference:e.spatialReference,outSpatialReference:r??e.spatialReference,localMode:this._context.stage.viewingMode===Le.Local}),s=n.length/3;return Pr(yB),ku(yB,n,0,s),!vp(yB,this._context.clippingExtent)}_createGeometryInfo(e,i,r){if(!$p(e.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(e))return null;const n=this._createBuffers(e,i);if(n==null)return null;const{positionBuffer:s,uvBuffer:o,colorBuffer:a,symbolColorBuffer:l,normalBuffer:c,tangentBuffer:h,objectTransformation:d,geometryTransformation:f}=n,m=this._getOrCreateComponents(e),y=new Array;let _=!1;const v=U5(Qs,d),w=this._context.localOriginFactory.getOrigin(v);for(const x of m){if(!this._validateFaces(e,x))return null;const T=this._getOrCreateFaces(e,x);if(T.length===0)continue;const S=this._createComponentNormals(s,c,x,T);S.didFlipNormals&&(_=!0);const C=[[O.POSITION,new Ve(s,T,3,!0)],[O.NORMAL,new Ve(S.normals,S.indices,3,!0)]];a&&C.push([O.COLOR,new Ve(a,T,4,!0)]),l&&C.push([O.SYMBOLCOLOR,new Ve(l,r1(T.length),4,!0)]),o&&C.push([O.UV0,new Ve(o,T,2,!0)]),h&&C.push([O.TANGENT,new Ve(h,T,4,!0)]);const A=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:r,layerUid:this._context.layer.uid}),R=this._getOrCreateMaterial(e,x),D=new ms(R,C,null,wn.Mesh,A);D.transformation=f,D.localOrigin=w,y.push(D)}return _&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:y,objectTransformation:d}}_updateMaterialParameters(e){this._materialInfoCache.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachClonedMaterial((i,r)=>{r.setParameters(i.parameters)})}test(){return{...super.test(),materials:this._materialInfoCache.materials}}}class gB{constructor(e,i,r){this.normals=e,this.indices=i,this.didFlipNormals=r}}const AL=E(),Qs=E(),WT=E(),YT=E(),XT=E(),Mce=be(),NA=nn(),xht=be(),yB=ks(),Tht=[new Uut],Sht=new uE;var xc;(function(t){t[t.NONE=0]="NONE",t[t.ECEF=1]="ECEF"})(xc||(xc={}));let Eht=class{constructor(e,i,r,n){this.graphics3DSymbolLayer=e,this.instanceIndex=i,this.elevationAligner=r,this.elevationContext=n,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const i=this._lodRenderer.instanceData;e!==i.getVisible(this.instanceIndex)&&i.setVisible(this.instanceIndex,e)}destroy(){this.instanceIndex!=null&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,i,r){if(this.elevationAligner){WU(this.elevationContext.featureExpressionInfoContext,r);const n=(o,a)=>Bv(o,e,this.elevationContext,i,a),s=this.elevationAligner(this,this.elevationContext,e.spatialReference,n,i);s!=null&&(this.alignedSampledElevation=s)}}getCenterObjectSpace(e=E()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,hf),ke(e,this._lodRenderer.baseBoundingSphere.center,hf)}getBoundingBoxObjectSpace(e=ks()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,hf);const i=this._lodRenderer.baseBoundingBox;Pr(e);for(let r=0;r<8;++r)ae(fh,1&r?i[3]:i[0],2&r?i[4]:i[1],4&r?i[5]:i[2]),ke(fh,fh,hf),Dp(e,fh);return e}computeAttachmentOrigin(e){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,hf),e.render.origin[0]+=hf[12],e.render.origin[1]+=hf[13],e.render.origin[2]+=hf[14],e.render.num++}async getProjectedBoundingBox(e,i,r,n,s){const o=this.getBoundingBoxObjectSpace(s),a=Cht,l=_J(o)?1:a.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,hf);for(let h=0;h<l;h++){const d=a[h];fh[0]=o[d[0]],fh[1]=o[d[1]],fh[2]=o[d[2]],ke(fh,fh,hf),U1[3*h]=fh[0],U1[3*h+1]=fh[1],U1[3*h+2]=fh[2]}if(!e(U1,0,l))return null;Pr(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let d=0;d<3;d++)o[d]=Math.min(o[d],U1[h+d]),o[d+3]=Math.max(o[d+3],U1[h+d]);c&&r.push({location:U1.slice(h,h+3),screenSpaceBoundingRect:c})}if(i&&(_p(o,_B),this.elevationContext.mode!=="absolute-height")){let h;const d=xQ(o,i.service.spatialReference,i);try{h=await i.service.queryElevation(_B[0],_B[1],n,d,"ground")}catch{}h!=null&&w1e(o,0,0,-this.alignedSampledElevation+h)}return o}addObjectState(e,i){if(e===Py.Highlight){const r=new CF(e);this._addHighlightId(r),i.addExternal(n=>{this._removeHighlightId(n)},r)}}removeObjectState(e){this._highlights.forEach(i=>e.remove(i))}_addHighlightId(e){this._highlights.add(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(e){this._highlights.delete(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}};const U1=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],fh=E(),_B=E(),Cht=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],hf=be();function Aht(t,e){const i=t.stageResources.geometries.map(n=>new LEe(n,t.stageResources.textures)),r=t.lodThreshold==null||t.lodThreshold===0&&e>0?Rht(i):t.lodThreshold;return new DEe(i,r,t.pivotOffset)}function Oht(t){return new NEe(t.map((e,i)=>Aht(e,i)))}function Rht(t){const e=t.reduce((i,{geometry:r})=>i+r.indexCount/3,0);return Math.sqrt(e*Pht/Math.PI)}const Pht=20;function Mht(t){return t=t||globalThis.location.hostname,$ht.some(e=>t?.match(e)!=null)}function OW(t,e){return t&&(e=e||globalThis.location.hostname)?e.match(j3e)!=null||e.match(q3e)!=null?t.replace("static.arcgis.com","staticdev.arcgis.com"):e.match(H3e)!=null||e.match(W3e)!=null?t.replace("static.arcgis.com","staticqa.arcgis.com"):t:t}const j3e=/^devext.arcgis.com$/,H3e=/^qaext.arcgis.com$/,q3e=/^[\w-]*\.mapsdevext.arcgis.com$/,W3e=/^[\w-]*\.mapsqa.arcgis.com$/,$ht=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,j3e,H3e,/^jsapps.esri.com$/,q3e,W3e];function Iht(t,e,i){if(t.count!==e.count)return void t8.error("source and destination buffers need to have the same number of elements");const r=t.count,n=i[0],s=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],d=i[7],f=i[8],m=i[9],y=i[10],_=i[11],v=i[12],w=i[13],x=i[14],T=i[15],S=t.typedBuffer,C=t.typedBufferStride,A=e.typedBuffer,R=e.typedBufferStride;for(let D=0;D<r;D++){const N=D*C,k=D*R,B=A[k],L=A[k+1],z=A[k+2],j=A[k+3];S[N]=n*B+l*L+f*z+v*j,S[N+1]=s*B+c*L+m*z+w*j,S[N+2]=o*B+h*L+y*z+x*j,S[N+3]=a*B+d*L+_*z+T*j}}function Lht(t,e,i){pee(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function pee(t,e,i,r=4,n=r){if(t.length/r!=e.length/n)return void t8.error("source and destination buffers need to have the same number of elements");const s=t.length/r,o=i[0],a=i[1],l=i[2],c=i[3],h=i[4],d=i[5],f=i[6],m=i[7],y=i[8];let _=0,v=0;for(let w=0;w<s;w++){const x=e[_],T=e[_+1],S=e[_+2],C=e[_+3];t[v]=o*x+c*T+f*S,t[v+1]=a*x+h*T+m*S,t[v+2]=l*x+d*T+y*S,t[v+3]=C,_+=n,v+=r}}function Dht(t,e){const i=Math.min(t.count,e.count),r=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride;for(let a=0;a<i;a++){const l=a*n,c=a*o,h=s[c],d=s[c+1],f=s[c+2],m=h*h+d*d+f*f;if(m>0){const y=1/Math.sqrt(m);r[l]=y*h,r[l+1]=y*d,r[l+2]=y*f}}}function Nht(t,e,i){ok(t.typedBuffer,e,i,t.typedBufferStride)}function ok(t,e,i,r=4){const n=Math.min(t.length/r,e.count),s=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<n;c++)t[l]=i*s[a],t[l+1]=i*s[a+1],t[l+2]=i*s[a+2],t[l+3]=i*s[a+3],a+=o,l+=r}Object.freeze(Object.defineProperty({__proto__:null,normalize:Dht,scale:ok,scaleView:Nht,transformMat3:pee,transformMat3View:Lht,transformMat4:Iht},Symbol.toStringTag,{value:"Module"}));function Fht(t,e){fee(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function fee(t,e,i=2,r=i){const n=e.length/2;let s=0,o=0;if(Kh(e)||sLe(e)){for(let l=0;l<n;++l)t[s]=e[o],t[s+1]=e[o+1],s+=i,o+=r;return}const a=oLe(e);if(nLe(e))for(let l=0;l<n;++l)t[s]=Math.max(e[o]/a,-1),t[s+1]=Math.max(e[o+1]/a,-1),s+=i,o+=r;else for(let l=0;l<n;++l)t[s]=e[o]/a,t[s+1]=e[o+1]/a,s+=i,o+=r}function kht(t,e,i,r){const n=t.typedBuffer,s=t.typedBufferStride,o=r?.count??t.count;let a=(r?.dstIndex??0)*s;for(let l=0;l<o;++l)n[a]=e,n[a+1]=i,a+=s}Object.freeze(Object.defineProperty({__proto__:null,fill:kht,normalizeIntegerBuffer:fee,normalizeIntegerBufferView:Fht},Symbol.toStringTag,{value:"Module"}));function Uht(t,e){n$(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function n$(t,e,i=3,r=i){const n=e.length/r;let s=0,o=0;for(let a=0;a<n;++a)t[s]=e[o],t[s+1]=e[o+1],t[s+2]=e[o+2],s+=i,o+=r}function zht(t,e,i,r,n){const s=t.typedBuffer,o=t.typedBufferStride,a=n?.count??t.count;let l=(n?.dstIndex??0)*o;for(let c=0;c<a;++c)s[l]=e,s[l+1]=i,s[l+2]=r,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:n$,copyView:Uht,fill:zht},Symbol.toStringTag,{value:"Module"}));function Bht(t,e){mee(t.typedBuffer,e,t.typedBufferStride)}function mee(t,e,i=4){const r=e.typedBuffer,n=e.typedBufferStride,s=e.count;let o=0,a=0;for(let l=0;l<s;++l)t[o]=r[a],t[o+1]=r[a+1],t[o+2]=r[a+2],t[o+3]=r[a+3],o+=i,a+=n}function Vht(t,e,i,r,n,s){const o=t.typedBuffer,a=t.typedBufferStride,l=s?.count??t.count;let c=(s?.dstIndex??0)*a;for(let h=0;h<l;++h)o[c]=e,o[c+1]=i,o[c+2]=r,o[c+3]=n,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:mee,copyView:Bht,fill:Vht},Symbol.toStringTag,{value:"Module"}));let Y3e=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,i){return this._load("json",e,i)}async loadBinary(e,i){return Fm(e)?(Tt(i),HX(e)):this._load("binary",e,i)}async loadImage(e,i){return this._load("image",e,i)}async _load(e,i,r){if(this._streamDataRequester==null)return(await _i(i,{responseType:Ght[e]})).data;const n=await jc(this._streamDataRequester.request(i,e,r));if(n.ok===!0)return n.value;throw Gl(n.error),new G("",`Request for resource failed: ${n.error}`)}};const Ght={image:"image",binary:"array-buffer",json:"json","image+type":void 0};function jht(t={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...t}}function Hht(t,e={}){return{data:t,parameters:{wrap:{s:Vt.REPEAT,t:Vt.REPEAT,...e.wrap},noUnpackFlip:!0,mipmap:!1,...e}}}function b4(t,e){const i=t.count;e||(e=new t.TypedArrayConstructor(i));for(let r=0;r<i;r++)e[r]=t.get(r);return e}Object.freeze(Object.defineProperty({__proto__:null,makeDense:b4},Symbol.toStringTag,{value:"Module"}));let $ce=class{constructor(e){this._data=e,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const e=this._offset4;return this._offset4+=1,this._dataUint32[e]}readUint8Array(e){const i=4*this._offset4;return this._offset4+=e/4,new Uint8Array(this._data,i,e)}remainingBytes(){return this._data.byteLength-4*this._offset4}};var OR,Ice;(function(t){t.SCALAR="SCALAR",t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4",t.MAT2="MAT2",t.MAT3="MAT3",t.MAT4="MAT4"})(OR||(OR={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(Ice||(Ice={}));const X3e={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},qht={pbrMetallicRoughness:X3e,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},Wht={ESRI_externalColorMixMode:"tint"},Lce=(t={})=>{const e={...X3e,...t.pbrMetallicRoughness},i=Yht({...Wht,...t.extras});return{...qht,...t,pbrMetallicRoughness:e,extras:i}};function Yht(t){switch(t.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:t.ESRI_externalColorMixMode,t.ESRI_externalColorMixMode="tint"}return t}const Xht={magFilter:zt.LINEAR,minFilter:zt.LINEAR_MIPMAP_LINEAR,wrapS:Vt.REPEAT,wrapT:Vt.REPEAT},Zht=t=>({...Xht,...t});function Jht(t){let e,i;return t.replace(/^(.*\/)?([^/]*)$/,(r,n,s)=>(e=n||"",i=s||"","")),{dirPart:e,filePart:i}}const OL={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};let Kht=class f_{constructor(e,i,r,n){if(this._context=e,this.uri=i,this.json=r,this._glbBuffer=n,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu"],this._baseUri=Jht(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),r.scenes==null)throw new G("gltf-loader-unsupported-feature","Scenes must be defined.");if(r.meshes==null)throw new G("gltf-loader-unsupported-feature","Meshes must be defined");if(r.nodes==null)throw new G("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(e,i,r){if(Fm(i)){const o=_v(i);if(o&&o.mediaType!=="model/gltf-binary")try{const l=JSON.parse(o.isBase64?atob(o.data):o.data);return new f_(e,i,l)}catch{}const a=HX(i);if(f_._isGLBData(a))return this._fromGLBData(e,i,a)}if(ndt.test(i)||r?.expectedType==="gltf"){const o=await e.loadJSON(i,r);return new f_(e,i,o)}const n=await e.loadBinary(i,r);if(f_._isGLBData(n))return this._fromGLBData(e,i,n);if(sdt.test(i)||r?.expectedType==="glb")throw new G("gltf-loader-invalid-glb","This is not a valid glb file.");const s=await e.loadJSON(i,r);return new f_(e,i,s)}static _isGLBData(e){if(e==null)return!1;const i=new $ce(e);return i.remainingBytes()>=4&&i.readUint32()===OL.MAGIC}static async _fromGLBData(e,i,r){const n=await f_._parseGLBData(r);return new f_(e,i,n.json,n.binaryData)}static async _parseGLBData(e){const i=new $ce(e);if(i.remainingBytes()<12)throw new G("gltf-loader-error","glb binary data is insufficiently large.");const r=i.readUint32(),n=i.readUint32(),s=i.readUint32();if(r!==OL.MAGIC)throw new G("gltf-loader-error","Magic first 4 bytes do not fit to expected glb value.");if(e.byteLength<s)throw new G("gltf-loader-error","glb binary data is smaller than header specifies.");if(n!==2)throw new G("gltf-loader-unsupported-feature","An unsupported glb container version was detected. Only version 2 is supported.");let o,a,l=0;for(;i.remainingBytes()>=8;){const c=i.readUint32(),h=i.readUint32();if(l===0){if(h!==OL.CHUNK_TYPE_JSON)throw new G("gltf-loader-error","First glb chunk must be JSON.");if(c<0)throw new G("gltf-loader-error","No JSON data found.");o=await aht(i.readUint8Array(c))}else if(l===1){if(h!==OL.CHUNK_TYPE_BIN)throw new G("gltf-loader-unsupported-feature","Second glb chunk expected to be BIN.");a=i.readUint8Array(c)}else K.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 glb chunks detected. Skipping.");l+=1}if(!o)throw new G("gltf-loader-error","No glb JSON chunk detected.");return{json:o,binaryData:a}}async getBuffer(e,i){const r=this.json.buffers[e];if(r.uri==null){if(this._glbBuffer==null)throw new G("gltf-loader-error","glb buffer not present");return this._glbBuffer}const n=await this._getBufferLoader(e,i);if(n.byteLength!==r.byteLength)throw new G("gltf-loader-error","Buffer byte lengths should match.");return n}async _getBufferLoader(e,i){const r=this._bufferLoaders.get(e);if(r)return r;const n=this.json.buffers[e].uri,s=this._context.loadBinary(this._resolveUri(n),i).then(o=>new Uint8Array(o));return this._bufferLoaders.set(e,s),s}async getAccessor(e,i){if(!this.json.accessors)throw new G("gltf-loader-unsupported-feature","Accessors missing.");const r=this.json.accessors[e];if(r?.bufferView==null)throw new G("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(r.type in[OR.MAT2,OR.MAT3,OR.MAT4])throw new G("gltf-loader-unsupported-feature",`AttributeType ${r.type} is not supported`);const n=this.json.bufferViews[r.bufferView],s=await this.getBuffer(n.buffer,i),o=tdt[r.type],a=idt[r.componentType],l=o*a,c=n.byteStride||l;return{raw:s.buffer,byteStride:c,byteOffset:s.byteOffset+(n.byteOffset||0)+(r.byteOffset||0),entryCount:r.count,isDenselyPacked:c===l,componentCount:o,componentByteSize:a,componentType:r.componentType,min:r.min,max:r.max,normalized:!!r.normalized}}async getIndexData(e,i){if(e.indices==null)return;const r=await this.getAccessor(e.indices,i);if(r.isDenselyPacked)switch(r.componentType){case Qe.UNSIGNED_BYTE:return new Uint8Array(r.raw,r.byteOffset,r.entryCount);case Qe.UNSIGNED_SHORT:return new Uint16Array(r.raw,r.byteOffset,r.entryCount);case Qe.UNSIGNED_INT:return new Uint32Array(r.raw,r.byteOffset,r.entryCount)}else switch(r.componentType){case Qe.UNSIGNED_BYTE:return b4(this._wrapAccessor(iC,r));case Qe.UNSIGNED_SHORT:return b4(this._wrapAccessor(CU,r));case Qe.UNSIGNED_INT:return b4(this._wrapAccessor(OU,r))}}async getPositionData(e,i){if(e.attributes.POSITION==null)throw new G("gltf-loader-unsupported-feature","No POSITION vertex data found.");const r=await this.getAccessor(e.attributes.POSITION,i);if(r.componentType!==Qe.FLOAT)throw new G("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+Qe[r.componentType]);if(r.componentCount!==3)throw new G("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+r.componentCount.toFixed());return this._wrapAccessor(Ws,r)}async getNormalData(e,i){if(e.attributes.NORMAL==null)throw new G("gltf-loader-error","No NORMAL vertex data found.");const r=await this.getAccessor(e.attributes.NORMAL,i);if(r.componentType!==Qe.FLOAT)throw new G("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+Qe[r.componentType]);if(r.componentCount!==3)throw new G("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+r.componentCount.toFixed());return this._wrapAccessor(Ws,r)}async getTangentData(e,i){if(e.attributes.TANGENT==null)throw new G("gltf-loader-error","No TANGENT vertex data found.");const r=await this.getAccessor(e.attributes.TANGENT,i);if(r.componentType!==Qe.FLOAT)throw new G("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+Qe[r.componentType]);if(r.componentCount!==4)throw new G("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+r.componentCount.toFixed());return new Fp(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*r.entryCount)}async getTextureCoordinates(e,i){if(e.attributes.TEXCOORD_0==null)throw new G("gltf-loader-error","No TEXCOORD_0 vertex data found.");const r=await this.getAccessor(e.attributes.TEXCOORD_0,i);if(r.componentCount!==2)throw new G("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+r.componentCount.toFixed());if(r.componentType===Qe.FLOAT)return this._wrapAccessor(Jx,r);if(!r.normalized)throw new G("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return rdt(r)}async getVertexColors(e,i){if(e.attributes.COLOR_0==null)throw new G("gltf-loader-error","No COLOR_0 vertex data found.");const r=await this.getAccessor(e.attributes.COLOR_0,i);if(r.componentCount!==4&&r.componentCount!==3)throw new G("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+r.componentCount.toFixed());if(r.componentCount===4){if(r.componentType===Qe.FLOAT)return this._wrapAccessor(Fp,r);if(r.componentType===Qe.UNSIGNED_BYTE)return this._wrapAccessor(Ia,r);if(r.componentType===Qe.UNSIGNED_SHORT)return this._wrapAccessor(UM,r)}else if(r.componentCount===3){if(r.componentType===Qe.FLOAT)return this._wrapAccessor(Ws,r);if(r.componentType===Qe.UNSIGNED_BYTE)return this._wrapAccessor(EU,r);if(r.componentType===Qe.UNSIGNED_SHORT)return this._wrapAccessor(AU,r)}throw new G("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+Qe[r.componentType])}hasPositions(e){return e.attributes.POSITION!==void 0}hasNormals(e){return e.attributes.NORMAL!==void 0}hasVertexColors(e){return e.attributes.COLOR_0!==void 0}hasTextureCoordinates(e){return e.attributes.TEXCOORD_0!==void 0}hasTangents(e){return e.attributes.TANGENT!==void 0}async getMaterial(e,i,r){let n=e.material?this._materialCache.get(e.material):void 0;if(!n){const s=e.material!=null?Lce(this.json.materials[e.material]):Lce(),o=s.pbrMetallicRoughness,a=this.hasVertexColors(e),l=this.getTexture(o.baseColorTexture,i),c=this.getTexture(s.normalTexture,i),h=r?this.getTexture(s.occlusionTexture,i):void 0,d=r?this.getTexture(s.emissiveTexture,i):void 0,f=r?this.getTexture(o.metallicRoughnessTexture,i):void 0,m=e.material!=null?e.material:-1;n={alphaMode:s.alphaMode,alphaCutoff:s.alphaCutoff,color:o.baseColorFactor,doubleSided:!!s.doubleSided,colorTexture:await l,normalTexture:await c,name:s.name,id:m,occlusionTexture:await h,emissiveTexture:await d,emissiveFactor:s.emissiveFactor,metallicFactor:o.metallicFactor,roughnessFactor:o.roughnessFactor,metallicRoughnessTexture:await f,hasVertexColors:a,ESRI_externalColorMixMode:s.extras.ESRI_externalColorMixMode,colorTextureTransform:o?.baseColorTexture?.extensions?.KHR_texture_transform,normalTextureTransform:s.normalTexture?.extensions?.KHR_texture_transform,occlusionTextureTransform:s.occlusionTexture?.extensions?.KHR_texture_transform,emissiveTextureTransform:s.emissiveTexture?.extensions?.KHR_texture_transform,metallicRoughnessTextureTransform:o?.metallicRoughnessTexture?.extensions?.KHR_texture_transform}}return n}async getTexture(e,i){if(!e)return;if((e.texCoord||0)!==0)throw new G("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const r=e.index,n=this.json.textures[r],s=Zht(n.sampler!=null?this.json.samplers[n.sampler]:{}),o=this._getTextureSourceId(n),a=this.json.images[o],l=await this._loadTextureImageData(r,n,i);return lge(this._textureCache,r,()=>{const c=d=>d===33071||d===33648||d===10497,h=d=>{throw new G("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${d}`)};return{data:l,wrapS:c(s.wrapS)?s.wrapS:h(s.wrapS),wrapT:c(s.wrapT)?s.wrapT:h(s.wrapT),minFilter:s.minFilter,name:a.name,id:r}})}getNodeTransform(e){if(e===void 0)return Qht;let i=this._nodeTransformCache.get(e);if(!i){const r=this.getNodeTransform(this._getNodeParent(e)),n=this.json.nodes[e];n.matrix?i=qi(be(),r,n.matrix):n.translation||n.rotation||n.scale?(i=HE(r),n.translation&&Kl(i,i,n.translation),n.rotation&&(RL[3]=JJ(RL,n.rotation),Fc(i,i,RL[3],RL)),n.scale&&mM(i,i,n.scale)):i=HE(r),this._nodeTransformCache.set(e,i)}return i}_wrapAccessor(e,i){return new e(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*(i.entryCount-1)+i.componentByteSize*i.componentCount)}_resolveUri(e){return ul(e,this._baseUri)}_getNodeParent(e){return this._nodeParentMap.get(e)}_checkVersionSupported(){const e=Ov.parse(this.json.asset.version,"glTF");edt.validate(e)}_checkRequiredExtensionsSupported(){const e=this.json;if(e.extensionsRequired&&!e.extensionsRequired.every(i=>this._supportedExtensions.includes(i)))throw new G("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((e,i)=>{e.children&&e.children.forEach(r=>{this._nodeParentMap.set(r,i)})})}async _loadTextureImageData(e,i,r){const n=this._textureLoaders.get(e);if(n)return n;const s=this._createTextureLoader(i,r);return this._textureLoaders.set(e,s),s}_getTextureSourceId(e){if(e.extensions!==void 0&&e.extensions.KHR_texture_basisu!==null)return e.extensions.KHR_texture_basisu.source;if(e.source!==null)return e.source;throw new G("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}async _createTextureLoader(e,i){const r=this._getTextureSourceId(e),n=this.json.images[r];if(n.uri){if(n.uri.endsWith(".ktx2")){const l=await this._context.loadBinary(this._resolveUri(n.uri),i);return new B3e(new Uint8Array(l))}return this._context.loadImage(this._resolveUri(n.uri),i)}if(n.bufferView==null)throw new G("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(n.mimeType==null)throw new G("gltf-loader-unsupported-feature","Image mimeType must be defined.");const s=this.json.bufferViews[n.bufferView],o=await this.getBuffer(s.buffer,i);if(s.byteStride!=null)throw new G("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const a=o.byteOffset+(s.byteOffset||0);return lht(new Uint8Array(o.buffer,a,s.byteLength),n.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const e=await iie(Array.from(this._bufferLoaders.values())),i=await iie(Array.from(this._textureLoaders.values()));return e.reduce((r,n)=>r+(n?.byteLength??0),0)+i.reduce((r,n)=>r+(n?AR(n)?n.data.byteLength:n.width*n.height*4:0),0)}};const Qht=Kye(be(),Math.PI/2),edt=new Ov(2,0,"glTF"),RL=hd(),tdt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},idt={[Qe.BYTE]:1,[Qe.UNSIGNED_BYTE]:1,[Qe.SHORT]:2,[Qe.UNSIGNED_SHORT]:2,[Qe.FLOAT]:4,[Qe.INT]:4,[Qe.UNSIGNED_INT]:4};function rdt(t){switch(t.componentType){case Qe.BYTE:return new RU(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Qe.UNSIGNED_BYTE:return new SU(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Qe.SHORT:return new zM(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Qe.UNSIGNED_SHORT:return new NK(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Qe.UNSIGNED_INT:return new FK(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Qe.FLOAT:return new Jx(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount)}}const ndt=/\.gltf$/i,sdt=/\.glb$/i;let odt=0;async function Z3e(t,e,i={},r=!0){const n=await Kht.load(t,e,i),s="gltf_"+odt++,o={lods:[],materials:new Map,textures:new Map,meta:adt(n)},a=!(!n.json.asset.extras||n.json.asset.extras.ESRI_type!=="symbolResource"),l=new Map;await ldt(n,async(h,d,f,m)=>{const y=l.get(f)??0;l.set(f,y+1);const _=h.mode!==void 0?h.mode:ci.TRIANGLES,v=_===ci.TRIANGLES||_===ci.TRIANGLE_STRIP||_===ci.TRIANGLE_FAN?_:null;if(v==null)return void K.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+ci[_]+"). Skipping primitive.");if(!n.hasPositions(h))return void K.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const w=n.getPositionData(h,i),x=n.getMaterial(h,i,r),T=n.hasNormals(h)?n.getNormalData(h,i):null,S=n.hasTangents(h)?n.getTangentData(h,i):null,C=n.hasTextureCoordinates(h)?n.getTextureCoordinates(h,i):null,A=n.hasVertexColors(h)?n.getVertexColors(h,i):null,R=n.getIndexData(h,i),D={name:m,transform:HE(d),attributes:{position:await w,normal:T?await T:null,texCoord0:C?await C:null,color:A?await A:null,tangent:S?await S:null},indices:await R,primitiveType:v,material:udt(o,await x,s)};let N=null;o.meta?.ESRI_lod!=null&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(N=o.meta.ESRI_lod.thresholds[f]),o.lods[f]=o.lods[f]||{parts:[],name:m,lodThreshold:N},o.lods[f].parts[y]=D});for(const h of o.lods)h.parts=h.parts.filter(d=>!!d);const c=await n.getLoadedBuffersSize();return{model:o,meta:{isEsriSymbolResource:a,uri:n.uri},customMeta:{},size:c}}function adt(t){const e=t.json;let i=null;return e.nodes.forEach(r=>{const n=r.extras;n!=null&&(n.ESRI_proxyEllipsoid||n.ESRI_lod)&&(i=n)}),i}async function ldt(t,e){const i=t.json,r=i.scenes[i.scene||0].nodes,n=r.length>1,s=[];for(const a of r){const l=i.nodes[a];s.push(o(a,0)),cdt(l)&&!n&&l.extensions.MSFT_lod.ids.forEach((c,h)=>o(c,h+1))}async function o(a,l){const c=i.nodes[a],h=t.getNodeTransform(a);if(c.weights!=null&&K.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),c.mesh!=null){const d=i.meshes[c.mesh];for(const f of d.primitives)s.push(e(f,h,l,d.name))}for(const d of c.children||[])s.push(o(d,l))}await Promise.all(s)}function cdt(t){return t.extensions?.MSFT_lod&&Array.isArray(t.extensions.MSFT_lod.ids)}function udt(t,e,i){const r=s=>{const o=`${i}_tex_${s&&s.id}${s?.name?"_"+s.name:""}`;if(s&&!t.textures.has(o)){const a=Hht(s.data,{wrap:{s:s.wrapS,t:s.wrapT},mipmap:hdt.has(s.minFilter),noUnpackFlip:!0});t.textures.set(o,a)}return o},n=`${i}_mat_${e.id}_${e.name}`;if(!t.materials.has(n)){const s=jht({color:[e.color[0],e.color[1],e.color[2]],opacity:e.color[3],alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,colorMixMode:e.ESRI_externalColorMixMode,textureColor:e.colorTexture?r(e.colorTexture):void 0,textureNormal:e.normalTexture?r(e.normalTexture):void 0,textureOcclusion:e.occlusionTexture?r(e.occlusionTexture):void 0,textureEmissive:e.emissiveTexture?r(e.emissiveTexture):void 0,textureMetallicRoughness:e.metallicRoughnessTexture?r(e.metallicRoughnessTexture):void 0,emissiveFactor:[e.emissiveFactor[0],e.emissiveFactor[1],e.emissiveFactor[2]],colorTextureTransform:e.colorTextureTransform,normalTextureTransform:e.normalTextureTransform,occlusionTextureTransform:e.occlusionTextureTransform,emissiveTextureTransform:e.emissiveTextureTransform,metallicRoughnessTextureTransform:e.metallicRoughnessTextureTransform,metallicFactor:e.metallicFactor,roughnessFactor:e.roughnessFactor});t.materials.set(n,s)}return n}const hdt=new Set([zt.LINEAR_MIPMAP_LINEAR,zt.LINEAR_MIPMAP_NEAREST]);function ddt(t,e){switch(e){case ci.TRIANGLES:return pdt(t);case ci.TRIANGLE_STRIP:return fdt(t);case ci.TRIANGLE_FAN:return mdt(t)}}function pdt(t){return typeof t=="number"?Kx(t):G_(t)?new Uint16Array(t):t}function fdt(t){const e=typeof t=="number"?t:t.length;if(e<3)return[];const i=e-2,r=EF(3*i);if(typeof t=="number"){let n=0;for(let s=0;s<i;s+=1)s%2==0?(r[n++]=s,r[n++]=s+1,r[n++]=s+2):(r[n++]=s+1,r[n++]=s,r[n++]=s+2)}else{let n=0;for(let s=0;s<i;s+=1)s%2==0?(r[n++]=t[s],r[n++]=t[s+1],r[n++]=t[s+2]):(r[n++]=t[s+1],r[n++]=t[s],r[n++]=t[s+2])}return r}function mdt(t){const e=typeof t=="number"?t:t.length;if(e<3)return new Uint16Array(0);const i=e-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if(typeof t=="number"){let a=0;for(let l=0;l<i;++l)r[a++]=0,r[a++]=l+1,r[a++]=l+2;return r}const n=t[0];let s=t[1],o=0;for(let a=0;a<i;++a){const l=t[a+2];r[o++]=n,r[o++]=s,r[o++]=l,s=l}return r}let gdt=class{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}},ydt=class{constructor(e,i,r){this.name=e,this.lodThreshold=i,this.pivotOffset=r,this.stageResources=new gdt,this.numberOfVertices=0}};const Rg=K.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function J3e(t,e){const i=await _dt(t,e),r=await Tdt(i.textureDefinitions??{},e);let n=0;for(const s in r)if(r.hasOwnProperty(s)){const o=r[s];n+=o?.image?o.image.width*o.image.height*4:0}return{resource:i,textures:r,size:n+xme(i)}}async function _dt(t,e){const i=e?.streamDataRequester;if(i)return vdt(t,i,e);const r=await jc(_i(t,e));if(r.ok===!0)return r.value.data;Gl(r.error),K3e(r.error)}async function vdt(t,e,i){const r=await jc(e.request(t,"json",i));if(r.ok===!0)return r.value;Gl(r.error),K3e(r.error.details.url)}function K3e(t){throw new G("",`Request for object resource failed: ${t}`)}function bdt(t){const e=t.params,i=e.topology;let r=!0;switch(e.vertexAttributes||(Rg.warn("Geometry must specify vertex attributes"),r=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const s=e.faces;if(s){if(e.vertexAttributes)for(const o in e.vertexAttributes){const a=s[o];a?.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(Rg.warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),r=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(Rg.warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),r=!1)):(Rg.warn(`Indexed geometry does not specify face indices for '${o}' attribute`),r=!1)}}else Rg.warn("Indexed geometries must specify faces"),r=!1;break}default:Rg.warn(`Unsupported topology '${i}'`),r=!1}t.params.material||(Rg.warn("Geometry requires material"),r=!1);const n=t.params.vertexAttributes;for(const s in n)n[s].values||(Rg.warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function wdt(t,e){const i=new Array,r=new Array,n=new Array,s=new BC,o=t.resource,a=Ov.parse(o.version||"1.0","wosr");Edt.validate(a);const l=o.model.name,c=o.model.geometries,h=o.materialDefinitions??{},d=t.textures;let f=0;const m=new Map;for(let y=0;y<c.length;y++){const _=c[y];if(!bdt(_))continue;const v=Sdt(_),w=_.params.vertexAttributes,x=[],T=z=>{if(_.params.topology==="PerAttributeArray")return null;const j=_.params.faces;for(const H in j)if(H===z)return j[H].values;return null},S=w[O.POSITION],C=S.values.length/S.valuesPerElement;for(const z in w){const j=w[z],H=j.values,X=T(z)??Kx(C);x.push([z,new Ve(H,X,j.valuesPerElement,!0)])}const A=v.texture,R=d&&d[A];if(R&&!m.has(A)){const{image:z,parameters:j}=R,H=new iT(z,j);r.push(H),m.set(A,H)}const D=m.get(A),N=D?D.id:void 0,k=v.material;let B=s.get(k,A);if(B==null){const z=h[k.substring(k.lastIndexOf("/")+1)].params;z.transparency===1&&(z.transparency=0);const j=R&&R.alphaChannelUsage,H=z.transparency>0||j==="transparency"||j==="maskAndTransparency",X=R?Q3e(R.alphaChannelUsage):void 0,P={ambient:Ta(z.diffuse),diffuse:Ta(z.diffuse),opacity:1-(z.transparency||0),transparent:H,textureAlphaMode:X,textureAlphaCutoff:.33,textureId:N,initTextureTransparent:!0,doubleSided:!0,cullFace:xr.None,colorMixMode:z.externalColorMixMode||"tint",textureAlphaPremultiplied:R?.parameters.preMultiplyAlpha??!1};e?.materialParameters&&Object.assign(P,e.materialParameters),B=new kp(P),s.set(k,A,B)}n.push(B);const L=new ms(B,x);f+=x.find(z=>z[0]===O.POSITION)?.[1]?.indices.length??0,i.push(L)}return{engineResources:[{name:l,stageResources:{textures:r,materials:n,geometries:i},pivotOffset:o.model.pivotOffset,numberOfVertices:f,lodThreshold:null}],referenceBoundingBox:xdt(i)}}function xdt(t){const e=Pr();return t.forEach(i=>{const r=i.boundingInfo;r!=null&&(Dp(e,r.bbMin),Dp(e,r.bbMax))}),e}async function Tdt(t,e){const i=new Array;for(const s in t){const o=t[s],a=o.images[0].data;if(!a){Rg.warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+s,h=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",d={noUnpackFlip:!0,wrap:{s:Vt.REPEAT,t:Vt.REPEAT},preMultiplyAlpha:Q3e(h)!==nr.Opaque},f=e!=null&&e.disableTextures?Promise.resolve(null):Iy(l,e);i.push(f.then(m=>({refId:c,image:m,parameters:d,alphaChannelUsage:h})))}const r=await Promise.all(i),n={};for(const s of r)n[s.refId]=s;return n}function Q3e(t){switch(t){case"mask":return nr.Mask;case"maskAndTransparency":return nr.MaskBlend;case"none":return nr.Opaque;default:return nr.Blend}}function Sdt(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const Edt=new Ov(1,2,"wosr"),ZT=2.1;async function eOe(t,e){const i=tOe(OW(t));if(i.fileType==="wosr"){const d=await(e.cache?e.cache.loadWOSR(i.url,e):J3e(i.url,e)),{engineResources:f,referenceBoundingBox:m}=wdt(d,e);return{lods:f,referenceBoundingBox:m,isEsriSymbolResource:!1,isWosr:!0}}const r=await(e.cache?e.cache.loadGLTF(i.url,e,!!e.usePBR):Z3e(new Y3e(e.streamDataRequester),i.url,e,e.usePBR)),n=r.model.meta?.ESRI_proxyEllipsoid,s=r.meta.isEsriSymbolResource&&n!=null&&r.meta.uri.includes("/RealisticTrees/");s&&!r.customMeta.esriTreeRendering&&(r.customMeta.esriTreeRendering=!0,Rdt(r,n));const o=!!e.usePBR,a=r.meta.isEsriSymbolResource?{usePBR:o,isSchematic:!1,treeRendering:s,mrrFactors:[...qrt]}:{usePBR:o,isSchematic:!1,treeRendering:!1,mrrFactors:[...XU]},l={...e.materialParameters,treeRendering:s},{engineResources:c,referenceBoundingBox:h}=iOe(r,a,l,e.skipHighLods&&i.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:i.specifiedLodIndex});return{lods:c,referenceBoundingBox:h,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1}}function tOe(t){const e=t.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return e?{fileType:"gltf",url:e[1],specifiedLodIndex:e[4]!=null?Number(e[4]):null}:t.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:t,specifiedLodIndex:null}:{fileType:"unknown",url:t,specifiedLodIndex:null}}function iOe(t,e,i,r){const n=t.model,s=new Array,o=new Map,a=new Map,l=n.lods.length,c=Pr();return n.lods.forEach((h,d)=>{const f=r.skipHighLods===!0&&(l>1&&d===0||l>3&&d===1)||r.skipHighLods===!1&&r.singleLodIndex!=null&&d!==r.singleLodIndex;if(f&&d!==0)return;const m=new ydt(h.name,h.lodThreshold,[0,0,0]);h.parts.forEach(y=>{const _=f?new kp({}):Cdt(n,y,m,e,i,o,a),{geometry:v,vertexCount:w}=Adt(y,_??new kp({})),x=v.boundingInfo;x!=null&&d===0&&(Dp(c,x.bbMin),Dp(c,x.bbMax)),_!=null&&(m.stageResources.geometries.push(v),m.numberOfVertices+=w)}),f||s.push(m)}),{engineResources:s,referenceBoundingBox:c}}function Cdt(t,e,i,r,n,s,o){const a=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),l=t.materials.get(e.material),c=e.attributes.texCoord0!=null,h=e.attributes.normal!=null;if(l==null)return null;const d=Odt(l.alphaMode);if(!s.has(a)){if(c){const C=(A,R=!1)=>{if(A!=null&&!o.has(A)){const D=t.textures.get(A);if(D!=null){const N=D.data;o.set(A,new iT(AR(N)?N.data:N,{...D.parameters,preMultiplyAlpha:!AR(N)&&R,encoding:AR(N)&&N.encoding!=null?N.encoding:void 0}))}}};C(l.textureColor,d!==nr.Opaque),C(l.textureNormal),C(l.textureOcclusion),C(l.textureEmissive),C(l.textureMetallicRoughness)}const m=l.color[0]**(1/ZT),y=l.color[1]**(1/ZT),_=l.color[2]**(1/ZT),v=l.emissiveFactor[0]**(1/ZT),w=l.emissiveFactor[1]**(1/ZT),x=l.emissiveFactor[2]**(1/ZT),T=l.textureColor!=null&&c?o.get(l.textureColor):null,S=qEe({normalTexture:l.textureNormal,metallicRoughnessTexture:l.textureMetallicRoughness,metallicFactor:l.metallicFactor,roughnessFactor:l.roughnessFactor,emissiveTexture:l.textureEmissive,emissiveFactor:l.emissiveFactor,occlusionTexture:l.textureOcclusion});s.set(a,new kp({...r,transparent:d===nr.Blend,customDepthTest:xx.Lequal,textureAlphaMode:d,textureAlphaCutoff:l.alphaCutoff,diffuse:[m,y,_],ambient:[m,y,_],opacity:l.opacity,doubleSided:l.doubleSided,doubleSidedType:"winding-order",cullFace:l.doubleSided?xr.None:xr.Back,hasVertexColors:!!e.attributes.color,hasVertexTangents:!!e.attributes.tangent,normalType:h?Ni.Attribute:Ni.ScreenDerivative,castShadows:!0,textureId:T?.id,colorMixMode:l.colorMixMode,normalTextureId:l.textureNormal!=null&&c?o.get(l.textureNormal).id:void 0,textureAlphaPremultiplied:T!=null&&!!T.parameters.preMultiplyAlpha,occlusionTextureId:l.textureOcclusion!=null&&c?o.get(l.textureOcclusion).id:void 0,emissiveTextureId:l.textureEmissive!=null&&c?o.get(l.textureEmissive).id:void 0,metallicRoughnessTextureId:l.textureMetallicRoughness!=null&&c?o.get(l.textureMetallicRoughness).id:void 0,emissiveFactor:[v,w,x],mrrFactors:S?[...AQ]:[l.metallicFactor,l.roughnessFactor,r.mrrFactors[2]],isSchematic:S,colorTextureTransformMatrix:im(l.colorTextureTransform),normalTextureTransformMatrix:im(l.normalTextureTransform),occlusionTextureTransformMatrix:im(l.occlusionTextureTransform),emissiveTextureTransformMatrix:im(l.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:im(l.metallicRoughnessTextureTransform),...n}))}const f=s.get(a);if(i.stageResources.materials.push(f),c){const m=y=>{y!=null&&i.stageResources.textures.push(o.get(y))};m(l.textureColor),m(l.textureNormal),m(l.textureOcclusion),m(l.textureEmissive),m(l.textureMetallicRoughness)}return f}function Adt(t,e){const i=t.attributes.position.count,r=ddt(t.indices||i,t.primitiveType),n=un(3*i),{typedBuffer:s,typedBufferStride:o}=t.attributes.position;zp(n,s,t.transform,3,o);const a=[[O.POSITION,new Ve(n,r,3,!0)]];if(t.attributes.normal!=null){const l=un(3*i),{typedBuffer:c,typedBufferStride:h}=t.attributes.normal;Oy(PL,t.transform),Bp(l,c,PL,3,h),a.push([O.NORMAL,new Ve(l,r,3,!0)])}if(t.attributes.tangent!=null){const l=un(4*i),{typedBuffer:c,typedBufferStride:h}=t.attributes.tangent;Oy(PL,t.transform),pee(l,c,PL,4,h),a.push([O.TANGENT,new Ve(l,r,4,!0)])}if(t.attributes.texCoord0!=null){const l=un(2*i),{typedBuffer:c,typedBufferStride:h}=t.attributes.texCoord0;fee(l,c,2,h),a.push([O.UV0,new Ve(l,r,2,!0)])}if(t.attributes.color!=null){const l=new Uint8Array(4*i);t.attributes.color.elementCount===4?t.attributes.color instanceof Fp?ok(l,t.attributes.color,255):t.attributes.color instanceof Ia?mee(l,t.attributes.color):t.attributes.color instanceof UM&&ok(l,t.attributes.color,1/256):(l.fill(255),t.attributes.color instanceof Ws?WF(l,t.attributes.color,255,4):t.attributes.color instanceof EU?n$(l,t.attributes.color.typedBuffer,4,t.attributes.color.typedBufferStride):t.attributes.color instanceof AU&&WF(l,t.attributes.color,1/256,4)),a.push([O.COLOR,new Ve(l,r,4,!0)])}return{geometry:new ms(e,a),vertexCount:i}}const PL=nn();function Odt(t){switch(t){case"BLEND":return nr.Blend;case"MASK":return nr.Mask;case"OPAQUE":case null:case void 0:return nr.Opaque}}function Rdt(t,e){for(let i=0;i<t.model.lods.length;++i){const r=t.model.lods[i];for(const n of r.parts){const s=n.attributes.normal;if(s==null)return;const o=n.attributes.position,a=o.count,l=E(),c=E(),h=E(),d=new Uint8Array(4*a),f=new Float64Array(3*a),m=fs(be(),n.transform);let y=0,_=0;for(let v=0;v<a;v++){o.getVec(v,c),s.getVec(v,l),ke(c,c,n.transform),de(h,c,e.center),D5(h,h,e.radius);const w=h[2],x=xe(h),T=Math.min(.45+.55*x*x,1);D5(h,h,e.radius),m!==null&&ke(h,h,m),ye(h,h),i+1!==t.model.lods.length&&t.model.lods.length>1&&Xi(h,h,l,w>-1?.2:Math.min(-4*w-3.8,1)),f[y]=h[0],f[y+1]=h[1],f[y+2]=h[2],y+=3,d[_]=255*T,d[_+1]=255*T,d[_+2]=255*T,d[_+3]=255,_+=4}n.attributes.normal=new Ws(f),n.attributes.color=new Ia(d)}}}const r8t=Object.freeze(Object.defineProperty({__proto__:null,fetch:eOe,gltfToEngineResources:iOe,parseUrl:tOe},Symbol.toStringTag,{value:"Module"})),Pdt=()=>!!ie("enable-feature:force-wosr"),n8t=()=>!!ie("enable-feature:direct-3d-object-feature-layer-display"),Mdt=()=>ie.add("enable-feature:direct-3d-object-feature-layer-display",!0,!0,!0),$dt=()=>ie.add("enable-feature:direct-3d-object-feature-layer-display",!1,!0,!0),s8t=()=>!!ie("enable-i3s-patching"),Idt=()=>ie.add("enable-i3s-patching",!0,!0,!0),Ldt=()=>ie.add("enable-i3s-patching",!1,!0,!0),o8t=()=>!!ie("enable-feature:SceneLayer-editing"),Ddt=(t="i3s-patching")=>{switch(Ldt(),$dt(),ie.add("enable-feature:SceneLayer-editing",!0,!0,!0),t){case"feature-layer-view":Mdt();break;case"i3s-patching":Idt()}};Ddt("i3s-patching");let vB={};async function Ndt(t,e){try{return{data:(await yee(t,e)).data,baseUrl:YX(t),styleUrl:t}}catch(i){return Gl(i),null}}function Fdt(t,e,i){const r=e.portal!=null?e.portal:Ds.getDefault();let n;const s=`${r.url} - ${r.user&&r.user.username} - ${t}`;return vB[s]||(vB[s]=kdt(t,r,i).then(o=>(n=o,o.fetchData())).then(o=>({data:o,baseUrl:n.itemUrl??"",styleName:t}))),vB[s]}function kdt(t,e,i){return e.load(i).then(()=>{const r=new Jf({disableExtraQuery:!0,query:`owner:${Dce} AND type:${Nce} AND typekeywords:"${t}"`});return e.queryItems(r,i)}).then(({results:r})=>{let n=null;const s=t.toLowerCase();if(r&&Array.isArray(r)){for(const o of r)if(o.typeKeywords?.some(l=>l.toLowerCase()===s)&&o.type===Nce&&o.owner===Dce){n=o;break}}if(!n)throw new G("symbolstyleutils:style-not-found",`The style '${t}' could not be found`,{styleName:t});return n.load(i)})}function gee(t,e,i){return t?.styleUrl!=null?Ndt(t.styleUrl,i):t?.styleName!=null?Fdt(t.styleName,e,i):Promise.reject(new G("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function rOe(t){return t===null||t.type==="CIMSymbolReference"?t:{type:"CIMSymbolReference",symbol:t}}function nOe(t,e,i=["gltf"]){if(e==="cimRef")return t.cimRef;if(t.formatInfos&&!Pdt())for(const r of i){const n=t.formatInfos.find(s=>s.type===r);if(n)return n.href}return t.webRef}function yee(t,e){const i={responseType:"json",query:{f:"json"},...e};return _i(Bu(t),i)}const Dce="esri_en",Nce="Style",Udt="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json",FA={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function zdt(t,e=FA){if(!t)return{symbol:null};const{retainId:i=FA.retainId,ignoreDrivers:r=FA.ignoreDrivers,hasLabelingContext:n=FA.hasLabelingContext,retainCIM:s=FA.retainCIM}=e;let o=null;if(Mv(t)||t instanceof Hx)o=t.clone();else if(t.type==="cim"){const a=t.data?.symbol?.type;if(a!=="CIMPointSymbol")return{error:new G("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${a||"unknown"}' is unsupported in 3D`,{symbol:t})};o=s?t.clone():ry.fromCIMSymbol(t)}else if(t instanceof ud)o=W6.fromSimpleLineSymbol(t);else if(t instanceof Qv)o=ry.fromSimpleMarkerSymbol(t);else if(t instanceof X6)o=ry.fromPictureMarkerSymbol(t);else if(t instanceof jx)o=e.geometryType&&e.geometryType==="mesh"?Y6.fromSimpleFillSymbol(t):MM.fromSimpleFillSymbol(t);else{if(!(t instanceof MC))return{error:new G("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${t.type||t.declaredClass}' is unsupported in 3D`,{symbol:t})};o=n?PC.fromTextSymbol(t):ry.fromTextSymbol(t)}return i&&o&&o.type!=="cim"&&(o.id=t.id),r&&Mv(o)&&o.symbolLayers.forEach(a=>a.ignoreDrivers=!0),{symbol:o}}function ak(t,e,i,r){const n=sOe(t,{},{context:r,isLabelSymbol:!1});n!=null&&(e[i]=n)}function Fce(t,e,i,r){const n=sOe(t,{},{context:r,isLabelSymbol:!0});n!=null&&(e[i]=n)}function kce(t){return t instanceof RC||t instanceof Hx}function sOe(t,e,i){if(t==null)return null;const{context:r,isLabelSymbol:n}=i,s=r?.origin,o=r?.messages;if(s==="web-scene"&&!kce(t)){const a=zdt(t,{retainCIM:!0,hasLabelingContext:n});return a.symbol!=null?a.symbol.write(e,r):(o?.push(new G("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:t,context:r,error:a.error})),null)}return(s==="web-map"||s==="portal-item"&&!xye(r?.layer))&&kce(t)?(o?.push(new G("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:t,context:r})),null):t.write(e,r)}function oOe(t,e){return gVe(t,null,e)}function Bdt(t,e,i,r){const n=t.name;return n==null?Promise.reject(new G("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):t.styleName&&t.styleName==="Esri2DPointSymbolsStyle"?Vdt(n,e,r):gee(t,e,r).then(s=>vee(s,n,e,i,nOe,r))}function _ee(t,e){return e.items.find(i=>i.name===t)}function vee(t,e,i,r,n,s){const o=i?.portal!=null?i.portal:Ds.getDefault(),a={portal:o,url:Nn(t.baseUrl),origin:"portal-item"},l=_ee(e,t.data);if(!l){const m=`The symbol name '${e}' could not be found`;return Promise.reject(new G("symbolstyleutils:symbol-name-not-found",m,{symbolName:e}))}let c=Cv(n(l,r),a),h=l.thumbnail?.href??null;const d=l.thumbnail?.imageData;Mht()&&(c=OW(c)??"",h=OW(h));const f={portal:o,url:Nn(YX(c)),origin:"portal-item"};return yee(c,s).then(m=>{const y=r==="cimRef"?rOe(m.data):m.data,_=oOe(y,f);if(_&&Mv(_)){if(h){const v=Cv(h,a);_.thumbnail=new Gw({url:v})}else d&&(_.thumbnail=new Gw({url:`data:image/png;base64,${d}`}));t.styleUrl?_.styleOrigin=new pP({portal:i.portal,styleUrl:t.styleUrl,name:e}):t.styleName&&(_.styleOrigin=new pP({portal:i.portal,styleName:t.styleName,name:e}))}return _})}function Vdt(t,e,i){const r=Udt.replaceAll(/\{SymbolName\}/gi,t),n=e.portal!=null?e.portal:Ds.getDefault();return yee(r,i).then(s=>{const o=rOe(s.data);return oOe(o,{portal:n,url:Nn(YX(r)),origin:"portal-item"})})}const Gdt=Object.freeze(Object.defineProperty({__proto__:null,fetchSymbolFromStyle:vee,getStyleItemFromStyle:_ee,resolveWebStyleSymbol:Bdt},Symbol.toStringTag,{value:"Module"}));async function jdt(t){if(t===null||t.styleName==null&&t.styleUrl==null)return null;const e=t.name;if(e==null)throw new G("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference");const i={portal:t.portal},r=await gee(t,i).catch(()=>null);if(r===null)return null;const n=_ee(e,r.data);if(n&&!n.formatInfos?.some(a=>a.type==="gltf_basisu"))return null;const s=await vee(r,e,i,"webRef",(a,l)=>nOe(a,l,["gltf_basisu","gltf"])).catch(()=>null);if(s===null||s.type!=="point-3d")return null;const o=s.symbolLayers.items[0];return o.type==="object"?o.resource:null}let Hdt=class{constructor(e,i,r){this._elementSize=i,this._buffer=Ui.createVertex(e,Ri.STATIC_DRAW),this.resize(r)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get usedMemory(){return this._array.byteLength+this._buffer.byteLength}copyRange(e,i,r,n=0){const s=new Uint8Array(this.array,e*this.elementSize,(i-e)*this.elementSize);new Uint8Array(r.array,n*this.elementSize).set(s)}transferAll(){this._buffer.setData(this._array)}transferRange(e,i){const r=e*this._elementSize,n=i*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),r,r,n)}resize(e){const i=e*this._elementSize,r=new ArrayBuffer(i);this._array&&(e>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=r,this._buffer.setSize(i),this._capacity=e}},qdt=class{constructor(e){this.modelOriginHi=e.getField(O.INSTANCEMODELORIGINHI,Ws),this.modelOriginLo=e.getField(O.INSTANCEMODELORIGINLO,Ws),this.model=e.getField(O.INSTANCEMODEL,Fv),this.modelNormal=e.getField(O.INSTANCEMODELNORMAL,Fv),this.featureAttribute=e.getField(O.INSTANCEFEATUREATTRIBUTE,Fp),this.color=e.getField(O.INSTANCECOLOR,Ia),this.objectAndLayerIdColor=e.getField(O.INSTANCEOBJECTANDLAYERIDCOLOR,Ia)}},Uce=class{constructor(e,i){this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=e,this._instanceBufferLayout=i,this._elementSize=i.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,i=this._tailIndex;return e>=i?e-i:e+this._capacity-i}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get usedMemory(){return this._buffer?.usedMemory??0}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){tt(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){tt(this._updating,"not updating"),this.size<qIe*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){tt(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),tt(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){tt(this._updating,"not updating"),tt(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(lk,Math.floor(this._capacity*e6));this._resize(e)}_shrink(){const e=Math.max(lk,Math.floor(this._capacity*HIe));this._resize(e)}_resize(e){if(tt(this._updating,"not updating"),e===this._capacity)return;const i=new Hdt(this._rctx,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const r=this.size,n=this._compactInstances(i);tt(n===r,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=n,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=i,this._view=new qdt(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const i=this._headIndex,r=this._tailIndex;return r<i?(this._buffer.copyRange(r,i,e),i-r):r>i?(this._buffer.copyRange(r,this._capacity,e),i>0&&this._buffer.copyRange(0,i,e,this._capacity-r),i+(this._capacity-r)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,i){e<i?this._buffer.transferRange(e,i):e>i&&(i>0&&this._buffer.transferRange(0,i),this._buffer.transferRange(e,this._capacity))}};const lk=64;var Br;function Wdt(t){let e=Hr().mat4f64(O.LOCALTRANSFORM).mat4f64(O.GLOBALTRANSFORM).vec4f64(O.BOUNDINGSPHERE).vec3f64(O.MODELORIGIN).mat3f(O.INSTANCEMODEL).mat3f(O.INSTANCEMODELNORMAL).vec2f(O.MODELSCALEFACTORS);return t.includes(O.FEATUREATTRIBUTE)&&(e=e.vec4f(O.FEATUREATTRIBUTE)),t.includes(O.COLOR)&&(e=e.vec4u8(O.COLOR)),t.includes(O.OBJECTANDLAYERIDCOLOR)&&(e=e.vec4u8(O.OBJECTANDLAYERIDCOLOR)),e=e.u8(O.STATE).u8(O.LODLEVEL),e}(function(t){t[t.ALLOCATED=1]="ALLOCATED",t[t.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",t[t.VISIBLE=4]="VISIBLE",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",t[t.REMOVE=32]="REMOVE",t[t.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",t[t.ACTIVE=18]="ACTIVE"})(Br||(Br={}));let zce=class{constructor(e){this.localTransform=e.getField(O.LOCALTRANSFORM,EP),this.globalTransform=e.getField(O.GLOBALTRANSFORM,EP),this.modelOrigin=e.getField(O.MODELORIGIN,ld),this.model=e.getField(O.INSTANCEMODEL,Fv),this.modelNormal=e.getField(O.INSTANCEMODELNORMAL,Fv),this.modelScaleFactors=e.getField(O.MODELSCALEFACTORS,Jx),this.boundingSphere=e.getField(O.BOUNDINGSPHERE,TU),this.featureAttribute=e.getField(O.FEATUREATTRIBUTE,Fp),this.color=e.getField(O.COLOR,Ia),this.objectAndLayerIdColor=e.getField(O.OBJECTANDLAYERIDCOLOR,Ia),this.state=e.getField(O.STATE,iC),this.lodLevel=e.getField(O.LODLEVEL,iC)}},QS=class extends we{constructor(e,i){super(e),this.events=new Sn,this._capacity=0,this._size=0,this._next=0,this._layout=Wdt(i),this._capacity=lk,this._buffer=this._layout.createBuffer(this._capacity),this._view=new zce(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,Br.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const i=this._view.state;tt(e>=0&&e<this._capacity&&(i.get(e)&Br.ALLOCATED)!=0,"invalid instance handle"),this._getStateFlag(e,Br.ACTIVE)?this._setStateFlags(e,Br.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const i=this._view.state;tt(e>=0&&e<this._capacity&&(i.get(e)&Br.ALLOCATED)!=0,"invalid instance handle"),i.set(e,0),this._size--}setLocalTransform(e,i,r=!0){this._view.localTransform.setMat(e,i),r&&this.updateModelTransform(e)}getLocalTransform(e,i){this._view.localTransform.getMat(e,i)}setGlobalTransform(e,i,r=!0){this._view.globalTransform.setMat(e,i),r&&this.updateModelTransform(e)}getGlobalTransform(e,i){this._view.globalTransform.getMat(e,i)}updateModelTransform(e){const i=this._view,r=lc,n=Sd;i.localTransform.getMat(e,Bce),i.globalTransform.getMat(e,bB);const s=qi(bB,bB,Bce);ae(r,s[12],s[13],s[14]),i.modelOrigin.setVec(e,r),rd(n,s),i.model.setMat(e,n);const o=x7e(lc,s);o.sort(),i.modelScaleFactors.set(e,0,o[1]),i.modelScaleFactors.set(e,1,o[2]),Xx(n,n),nd(n,n),i.modelNormal.setMat(e,n),this._setStateFlags(e,Br.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,i){const r=this._view;r.model.getMat(e,Sd),r.modelOrigin.getVec(e,lc),i[0]=Sd[0],i[1]=Sd[1],i[2]=Sd[2],i[3]=0,i[4]=Sd[3],i[5]=Sd[4],i[6]=Sd[5],i[7]=0,i[8]=Sd[6],i[9]=Sd[7],i[10]=Sd[8],i[11]=0,i[12]=lc[0],i[13]=lc[1],i[14]=lc[2],i[15]=1}applyShaderTransformation(e,i){this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i)}getCombinedModelTransform(e,i){return this.getModelTransform(e,i),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i),i}getCombinedLocalTransform(e,i){this._view.localTransform.getMat(e,i),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i)}getCombinedMaxScaleFactor(e){let i=this._view.modelScaleFactors.get(e,1);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(lc,this,e),i*=Math.max(lc[0],lc[1],lc[2])),i}getCombinedMedianScaleFactor(e){let i=this._view.modelScaleFactors.get(e,0);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(lc,this,e),i*=Ydt(lc[0],lc[1],lc[2])),i}getModel(e,i){this._view.model.getMat(e,i)}setFeatureAttribute(e,i){this._view.featureAttribute.setVec(e,i)}getFeatureAttribute(e,i){this._view.featureAttribute.getVec(e,i)}setColor(e,i){this._view.color.setVec(e,i)}setObjectAndLayerIdColor(e,i){this._view.objectAndLayerIdColor.setVec(e,i)}setVisible(e,i){i!==this.getVisible(e)&&(this._setStateFlag(e,Br.VISIBLE,i),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,Br.VISIBLE)}setHighlight(e,i){i!==this.getHighlight(e)&&(this._setStateFlag(e,Br.HIGHLIGHT,i),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,Br.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let i=0;for(let r=0;r<this._capacity;++r)this.getState(r)&e&&++i;return i}_setStateFlags(e,i){const r=this._view.state;i=r.get(e)|i,r.set(e,i)}_clearStateFlags(e,i){const r=this._view.state;i=r.get(e)&~i,r.set(e,i)}_setStateFlag(e,i,r){r?this._setStateFlags(e,i):this._clearStateFlags(e,i)}_getStateFlag(e,i){return!!(this._view.state.get(e)&i)}_grow(){this._capacity=Math.max(lk,Math.floor(this._capacity*e6)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new zce(this._buffer)}_findSlot(){const e=this._view.state;let i=this._next;for(;e.get(i)&Br.ALLOCATED;)i=i+1===this._capacity?0:i+1;return this._next=i+1===this._capacity?0:i+1,i}};function Ydt(t,e,i){return Math.max(Math.min(t,e),Math.min(Math.max(t,e),i))}u([p({constructOnly:!0})],QS.prototype,"shaderTransformation",void 0),u([p()],QS.prototype,"_size",void 0),u([p({readOnly:!0})],QS.prototype,"size",null),QS=u([M("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],QS);const lc=E(),Sd=nn(),Bce=be(),bB=be();let Xdt=class extends wp{constructor(e,i){super(r=>this._instanceData.view.boundingSphere.getVec(r,this._tmpSphere),{maximumDepth:25}),this._instanceData=e,this._boundingSphere=i,this._tmpSphere=kn(),this._tmpMat4=be()}addInstance(e){const i=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);ke(this._tmpSphere,this._boundingSphere.center,r),this._tmpSphere[3]=this._boundingSphere.radius*WE(r),i.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}},Zdt=class{constructor(e,i){this._worldSpaceRadius=e,this._minScreenSpaceRadii=i}selectLevel(e,i,r){const n=r.computeScreenPixelSizeAt(e),s=this._worldSpaceRadius*i/n;let o=0;for(let a=1;a<this._minScreenSpaceRadii.length;++a)s>=this._minScreenSpaceRadii[a]&&(o=a);return o}},Jdt=class extends cU{constructor(e,i,r,n,s,o){super(e,i),this.layerUid=e,this.graphicUid=i,this.geometryId=r,this.triangleNr=n,this.baseBoundingSphere=s,this.numLodLevels=o}};function bee(t){return Gp(t)&&t.intersector===Jr.LOD&&!!t.target}let Kdt=class{constructor(e,i){const r=e.renderContext.rctx,n=i.geometry;this._materialRepository=e.materialRepository,n.material.setParameters({instancedDoublePrecision:!0});const s=n.material.createBufferWriter(),o=s.vertexBufferLayout,a=s.elementCount(n),l=o.createBuffer(a);s.write(null,null,n,l,0),this.geometry=n,this.material=n.material,this.glMaterials=new UAe(n.material,this._materialRepository),this.vertexBufferLayout=o,this.vbo=Ui.createVertex(r,Ri.STATIC_DRAW,l.buffer),this.vao=new Hp(r,Si,{geometry:Kc(o)},{geometry:this.vbo}),this.vertexCount=a}destroy(){this.glMaterials.dispose(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,i,r,n,s,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,r,n,(h,d,f,m,y)=>{if(h>=0){if(i!=null&&!i(e.rayBegin,e.rayEnd,h))return;const _=new Jdt(o.layerUid,o.graphicUid(s),c,f,a,l);if((e.results.min.drapedLayerOrder==null||y>=e.results.min.drapedLayerOrder)&&(e.results.min.dist==null||h<e.results.min.dist)&&e.results.min.set(Jr.LOD,_,h,d,e.transform.transform,y),e.options.store!==Bo.MIN&&(e.results.max.drapedLayerOrder==null||y>=e.results.max.drapedLayerOrder)&&(e.results.max.dist==null||h>e.results.max.dist)&&e.results.max.set(Jr.LOD,_,h,d,e.transform.transform,y),e.options.store===Bo.ALL){const v=iK(e.results.min.ray);v.set(Jr.LOD,_,h,d,e.transform.transform,y),e.results.all.push(v)}}})}},Qdt=class aOe{static async create(e,i,r){const n=await Promise.allSettled(i.components.map(o=>e.controller.schedule(()=>new Kdt(e,o),r))),s=n.map(o=>o.status==="fulfilled"?o.value:null).filter(Yv);if(ps(r)||s.length!==n.length){s.forEach(o=>o.destroy()),Tt(r);for(const o of n)if(o.status==="rejected")throw o.reason}return new aOe(i.minScreenSpaceRadius,s)}constructor(e,i){this.minScreenSpaceRadius=e,this.components=i}destroy(){this.components.forEach(e=>e.destroy())}intersect(e,i,r,n,s,o,a){this.components.forEach(l=>l.intersect(e,i,r,n,s,o,this.boundingSphere,a))}get boundingBox(){if(this._boundingBox==null){const e=Pr();this.components.forEach(i=>{i.boundingInfo!=null&&(Dp(e,i.boundingInfo.bbMin),Dp(e,i.boundingInfo.bbMax))}),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(this._boundingSphere==null){const e=this.boundingBox,i=E();_p(e,i),this._boundingSphere={center:i,radius:.5*b1e(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((e,i)=>e+i.triangleCount,0)}};const ept=t=>{const e=t.baseBoundingSphere.radius,i=t.levels.map(r=>r.minScreenSpaceRadius);return new Zdt(e,i)};let Eh=class extends kJe{constructor(e,i){super(e),this.type=Jr.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[new Array],this._highlightRenderInstanceData=[new Array],this._allRenderInstanceData=[this._defaultRenderInstanceData[0],this._highlightRenderInstanceData[0]],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new ft,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.produces=new Map([[le.OPAQUE_MATERIAL,r=>this._produces(r)],[le.TRANSPARENT_MATERIAL,r=>!!this._hasTransparentLevels()&&this._produces(r)]]),this._instanceData=new QS({shaderTransformation:e.shaderTransformation},e.optionalFields),this.addHandles(i.registerTask(pt.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=ipt(this.optionalFields),this._glInstanceBufferLayout=Kc(this._instanceBufferLayout,1),this.addHandles([this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)}),this._instanceData.events.on("instance-visibility-changed",({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)}),this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))])}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get usedMemory(){return this._allRenderInstanceData.reduce((e,i)=>i.reduce((r,n)=>r+n.usedMemory,e),0)}get renderStats(){const e=this._instanceData.size,i=[];return this._levels.forEach((r,n)=>{const s=this._allRenderInstanceData[0][n].size+this._allRenderInstanceData[1][n].size,o=r.triangleCount;i.push({renderedInstances:s,renderedTriangles:s*o,trianglesPerInstance:o})}),{totalInstances:e,renderedInstances:i.reduce((r,n)=>r+n.renderedInstances,0),renderedTriangles:i.reduce((r,n)=>r+n.renderedTriangles,0),levels:i}}async initializeRenderContext(e,i){this._context=e;const r=e.renderContext.rctx,n=await Promise.allSettled(this.symbol.levels.map(o=>(this._defaultRenderInstanceData[0].push(new Uce(r,this._instanceBufferLayout)),this._highlightRenderInstanceData[0].push(new Uce(r,this._instanceBufferLayout)),Qdt.create(e,o,i)))),s=n.map(o=>o.status==="fulfilled"?o.value:null).filter(Yv);if(ps(i)||s.length!==n.length){s.forEach(o=>o.destroy()),Tt(i);for(const o of n)if(o.status==="rejected")throw o.reason}this._levels=s,this._levelSelector=ept(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData[0].forEach(e=>e.destroy()),this._highlightRenderInstanceData[0].forEach(e=>e.destroy())}_hasTransparentLevels(){return this._levels.some(e=>e.components.some(i=>i.material.produces(le.TRANSPARENT_MATERIAL,F.Color)))}hasHighlights(){return this._highlightRenderInstanceData[0].some(e=>e.size>0)}_produces(e){return e!==F.Highlight&&e!==F.ShadowHighlight||this.hasHighlights()}prepareRender(e){if(!pr.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const i=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),i||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(hl),this._needFullCycle=!1)}}prepareTechniques(e){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output))return null;const i=this._getInstanceDatas(e.output);if(!i)return null;const r=new Array;return i.forEach(n=>this.levels.forEach((s,o)=>{s.components.forEach(a=>r.push(this._beginComponent(e,n[o],a)))})),r}renderNode(e,i){const r=this._getInstanceDatas(e.output);if(!r||i==null)return;let n=0;e.rctx.bindVAO(),r.forEach(s=>this.levels.forEach((o,a)=>{o.components.forEach(l=>this._renderComponent(e,i[n++],s[a],l,a))}))}_getInstanceDatas(e){const i=e!==F.Highlight&&e!==F.ShadowHighlight,r=e!==F.ShadowExcludeHighlight;return i&&r?this._allRenderInstanceData:i?this._defaultRenderInstanceData:r?this._highlightRenderInstanceData:null}intersect(e,i,r,n){if(!this.baseMaterial.isVisible()||this._octree==null)return;const s=E();de(s,n,r);const o=a=>{this._instanceData.getCombinedModelTransform(a,jce),e.transform.set(jce),ke(Hce,r,e.transform.inverse),ke(qce,n,e.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),h=this._levels.length;tt((l&Br.ACTIVE)!=0,"invalid instance state"),tt(c>=0&&c<h,"invaid lod level"),this._levels[c].intersect(e,i,Hce,qce,a,this.metadata,h)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(o):this._octree.forEachAlongRay(r,s,o)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){if(this._octreeCached==null){const e=this._instanceData,i=e.view?.state;if(!i)return null;this._octreeCached=new Xdt(e,this.baseBoundingSphere);for(let r=0;r<e.capacity;++r)i.get(r)&Br.ACTIVE&&this._octreeCached.addInstance(r)}return this._octreeCached}_invalidateOctree(){this._octreeCached=$e(this._octreeCached)}queryDepthRange(e){if(this._octree==null)return{near:1/0,far:-1/0};const i=e.viewForward,r=this._octree.findClosest(i,wp.DepthOrder.FRONT_TO_BACK,e.frustum),n=this._octree.findClosest(i,wp.DepthOrder.BACK_TO_FRONT,e.frustum);if(r==null||n==null)return{near:1/0,far:-1/0};const s=e.eye,o=this._instanceData.view;o.boundingSphere.getVec(r,df),de(df,df,s);const a=ge(df,i)-df[3];o.boundingSphere.getVec(n,df),de(df,df,s);const l=ge(df,i)+df[3];return{near:Math.max(e.near,a),far:Math.min(e.far,l)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._allRenderInstanceData.forEach(e=>e.forEach(i=>i.startUpdateCycle()))}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:i,_camera:r,_levelSelector:n}=this;this._allRenderInstanceData.forEach(d=>d.forEach(f=>f.beginUpdate()));const s=this._instanceData,o=s.view;let a=s.size;const l=s.capacity;let c=this._instanceIndex;const h=Math.ceil(l/500);for(let d=0;d<a&&!e.done;++d){c===this._cycleStartIndex&&this._startUpdateCycle();const f=o.state.get(c);let m=0;if(!(f&Br.ALLOCATED)){c=c+1===l?0:c+1,a++;continue}const y=o.lodLevel.get(c);if(f&Br.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[0][y].freeTail(),f&Br.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[0][y].freeTail(),f&Br.REMOVE)s.freeInstance(c);else if(f&Br.VISIBLE){let _=0;i&&(o.modelOrigin.getVec(c,Gce),_=n.selectLevel(Gce,s.getCombinedMedianScaleFactor(c),r)),m=f&~(Br.ACTIVE|Br.TRANSFORM_CHANGED),_>=0&&(f&Br.HIGHLIGHT?(Vce(this._highlightRenderInstanceData[0][_],o,c),m|=Br.HIGHLIGHT_ACTIVE):(Vce(this._defaultRenderInstanceData[0][_],o,c),m|=Br.DEFAULT_ACTIVE)),o.state.set(c,m),o.lodLevel.set(c,_)}else m=f&~(Br.ACTIVE|Br.TRANSFORM_CHANGED),o.state.set(c,m);if(this._octreeCached!=null){const _=!!(f&Br.ACTIVE),v=!!(m&Br.ACTIVE);!_&&v?this._octreeCached.addInstance(c):_&&!v?this._octreeCached.removeInstance(c):_&&v&&f&Br.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(c),this._octreeCached.addInstance(c))}c=c+1===l?0:c+1,c%h==0&&e.madeProgress()}this._instanceIndex=c,this._allRenderInstanceData.forEach(d=>d.forEach(f=>f.endUpdate())),this._context.requestRender()}_beginComponent(e,i,r){if(i.size===0)return null;const n=r.glMaterials.load(e.rctx,e.bindParameters.slot,e.output);return n!=null?n.beginSlot(e.bindParameters):null}_renderComponent(e,i,r,n,s){if(!i)return;const{bindParameters:o,rctx:a}=e;a.runAppleAmdDriverHelper();const l=a.bindTechnique(i,n.material.parameters,o);a.bindVAO(n.vao),i.ensureAttributeLocations(n.vao),l.bindDraw(rpt,o,n.material.parameters),pr.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===F.Color&&(l.setUniform4fv("externalColor",Wce[Math.min(s,Wce.length-1)]),l.setUniform1i("colorMixMode",Y2e.replace));const c=r.capacity,h=r.headIndex,d=r.tailIndex,f=r.firstIndex,m=this._glInstanceBufferLayout,y=(_,v)=>{gK(a,Si,r.buffer,m,_),a.drawArraysInstanced(i.primitiveType,0,n.vertexCount,v-_),yK(a,Si,r.buffer,m)};n.material.parameters.transparent&&f!=null?h>d?(tt(f>=d&&f<=h,"invalid firstIndex"),y(f,h),y(d,f)):h<d&&(f<=h?(tt(f>=0&&f<=h,"invalid firstIndex"),y(f,h),y(d,c),y(0,f)):(tt(f>=d&&f<=c,"invalid firstIndex"),y(f,c),y(0,h),y(d,f))):h>d?y(d,h):h<d&&(y(0,h),y(d,c)),a.bindVAO(null)}};function Vce(t,e,i){const r=t.allocateHead();tpt(e,i,t.view,r)}function tpt(t,e,i,r){YZe(t.modelOrigin,e,i.modelOriginHi,i.modelOriginLo,r),i.model.copyFrom(r,t.model,e),i.modelNormal.copyFrom(r,t.modelNormal,e),t.color&&i.color&&i.color.copyFrom(r,t.color,e),t.objectAndLayerIdColor&&i.objectAndLayerIdColor&&i.objectAndLayerIdColor.copyFrom(r,t.objectAndLayerIdColor,e),t.featureAttribute&&i.featureAttribute&&i.featureAttribute.copyFrom(r,t.featureAttribute,e)}function ipt(t){let e=Hr().vec3f(O.INSTANCEMODELORIGINHI).vec3f(O.INSTANCEMODELORIGINLO).mat3f(O.INSTANCEMODEL).mat3f(O.INSTANCEMODELNORMAL);return t!=null&&t.includes("featureAttribute")&&(e=e.vec4f(O.INSTANCEFEATUREATTRIBUTE)),t!=null&&t.includes("color")&&(e=e.vec4u8(O.INSTANCECOLOR)),t!=null&&t.includes("objectAndLayerIdColor")&&(e=e.vec4u8(O.INSTANCEOBJECTANDLAYERIDCOLOR)),e}u([p({constructOnly:!0})],Eh.prototype,"symbol",void 0),u([p({constructOnly:!0})],Eh.prototype,"optionalFields",void 0),u([p({constructOnly:!0})],Eh.prototype,"metadata",void 0),u([p({constructOnly:!0})],Eh.prototype,"shaderTransformation",void 0),u([p()],Eh.prototype,"_instanceData",void 0),u([p()],Eh.prototype,"_cycleStartIndex",void 0),u([p({readOnly:!0})],Eh.prototype,"_enableLevelSelection",null),u([p()],Eh.prototype,"_updateCyclesWithStaticCamera",void 0),u([p({readOnly:!0})],Eh.prototype,"running",null),Eh=u([M("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],Eh);const Gce=E(),df=oi(),jce=be(),Hce=E(),qce=E(),Wce=[Ft(1,0,1,1),Ft(0,0,1,1),Ft(0,1,0,1),Ft(1,1,0,1),Ft(1,0,0,1)],rpt=new Cnt;let Yce=class{constructor(e,i,r,n,s,o,a,l,c,h,d,f){this.lodResources=e,this.lodRenderer=i,this.stageResources=r,this.originalMaterialParameters=n,this.resourceSize=s,this.isEsriSymbolResource=o,this.isWosr=a,this.resourceBoundingBox=l,this.symbolSize=c,this.extentPadding=h,this.physicalBasedRenderingEnabled=d,this.pivotOffset=f}},npt=class extends Xm{getCachedSize(){const[e,i,r]=this._resources!=null?this._resources.symbolSize:[1,1,1];return{width:e,depth:i,height:r}}constructor(e,i,r,n){super(e,i,r,n),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.skipHighSymbolLodsChanged=!1,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=r.physicalBasedRenderingEnabled}async doLoad(e){if(!this._drivenProperties.size&&qU(this.symbolLayer))throw new Error;if(this._isPrimitive){const i=this.symbolLayer.resource,r=i&&$rt(i.primitive)?i.primitive:P1e;this._resources=await this._createResourcesForPrimitive(r,e)}else{const i=await jdt(this.symbol.styleOrigin),r=i?.href??this.symbolLayer.resource.href;this._resources=await this._createResourcesForUrl(r,e)}this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return this._resources!=null?this._resources.extentPadding:0}get _isPrimitive(){return!this.symbolLayer.resource?.href}get lodRenderer(){return this._resources?.lodRenderer}get materials(){return this._resources?.stageResources.materials??[]}_setMaterialTransparencyParameters(e,i=this.symbolLayer?.material?.color){const r=this._getCombinedOpacity(i),n=r<1||this.needsDrivenTransparentPass;return e.transparent=n,e.opacity=r,e.cullFace=n?xr.None:xr.Back,e}async _createResourcesForPrimitive(e,i){const r=this.symbolLayer,n=ks(ZBe(e)),s=Ta(W$(n)),o=Ta(hz(s,r)),a=xe(o),l=!1,c=!1,h={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:[...AQ],ambient:ey,diffuse:ey,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},d=!!h.usePBR;this._setMaterialTransparencyParameters(h);const f=this.symbol;if(f.type==="point-3d"&&f.verticalOffset){const{screenLength:x,minWorldLength:T,maxWorldLength:S}=f.verticalOffset;h.verticalOffset={screenLength:Jn(x),minWorldLength:T||0,maxWorldLength:S??1/0},h.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(h.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)h.externalColor=Hh;else{const x=r.material!=null?r.material.color:null,T=x!=null?Pe.toUnitRGBA(x):Hh;h.externalColor=T}this._fastUpdates=sC(this._context.renderer,this._fastVisualVariableConvertOptions(n,o,s,null)),h.isInstanced=!0,this._fastUpdates?(Object.assign(h,this._fastUpdates.materialParameters),this._optionalFields.push(O.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(h.hasInstancedColor=!0,this._optionalFields.push(O.COLOR)),ie("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(O.OBJECTANDLAYERIDCOLOR);const m=new kp(h),y=FEe(e,m);if(!y)throw new Error(`Unknown object symbol primitive: ${e}`);const _=lL(y).map(x=>({opacity:1,transparent:x.parameters.transparent})),v=await this._createStageResources(y,d,i),w=await this._createLodRenderer(y,i);return new Yce(y,w,v,_,s,l,c,n,o,a,d,null)}async _createResourcesForUrl(e,i){const r={materialParameters:{isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=sC(this._context.renderer,this._fastVisualVariableConvertOptions(null,null,null,null)),this._fastUpdates?(Object.assign(r.materialParameters,this._fastUpdates.materialParameters),this._optionalFields.push(O.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(r.materialParameters.hasInstancedColor=!0,this._optionalFields.push(O.COLOR)),ie("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(O.OBJECTANDLAYERIDCOLOR);const n=this.symbol;if(n.type==="point-3d"&&n.verticalOffset){const{screenLength:k,minWorldLength:B,maxWorldLength:L}=n.verticalOffset;r.materialParameters.verticalOffset={screenLength:Jn(k),minWorldLength:B||0,maxWorldLength:L??1/0},r.materialParameters.castShadows=!1}const s=this._context.physicalBasedRenderingEnabled;r.signal=i,r.usePBR=s,r.skipHighLods=this._context.skipHighSymbolLods;const o=await eOe(e,r),a=o.isEsriSymbolResource,l=o.isWosr,c=Oht(o.lods),h=this._context,d=this.symbolLayer.material,f=this._getExternalColorParameters(d),m=this.symbolLayer?.material?.color,y=this._getCombinedOpacity(m,{hasIntrinsicColor:!0}),_=this.needsDrivenTransparentPass,v=lL(c),w=lL(c).map(k=>({opacity:k.parameters.opacity||1,transparent:k.parameters.transparent}));v.forEach(k=>{const B=k.parameters;k.setParameters(f);const L=B.opacity*y,z=L<1||_||B.transparent;k.setParameters({opacity:L,transparent:z}),h.screenSizePerspectiveEnabled&&k.setParameters({screenSizePerspective:h.sharedResources.screenSizePerspectiveSettings})});const x=o.referenceBoundingBox,T=Ta(W$(x)),S=Ta(c.levels[0].pivotOffset),C=Ta(hz(T,this.symbolLayer)),A=xe(C),R=this._fastUpdates;oC(R,this._context.renderer,this._fastVisualVariableConvertOptions(x,C,T,S))&&v.forEach(k=>k.setParameters(R.materialParameters));const D=await this._createStageResources(c,s,i),N=await this._createLodRenderer(c,i);return new Yce(c,N,D,w,T,a,l,x,C,A,s,S)}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,i,r){const n=this._context.stage,s=lL(e);i!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),n.addMany(s),this._addDisposeResource(()=>n.removeMany(s));const o=Yae(e);n.addMany(o),this._addDisposeResource(()=>{o.forEach(l=>l.unload()),n.removeMany(o)}),await Promise.all(o.map(l=>this._context.stage.schedule(()=>l.load(n.renderView.renderingContext),r))),Tt(r);const a=Xae(e);return n.addMany(a),this._addDisposeResource(()=>n.removeMany(a)),{materials:s,textures:o,geometries:a}}async _createLodRenderer(e,i){const r=this._context.stage,n={layerUid:this._context.layer.uid,graphicUid:l=>this._instanceIndexToGraphicUid.get(l),notifyGraphicGeometryChanged:l=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(l)),notifyGraphicVisibilityChanged:l=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(l))},s=this._fastUpdates,o=s?{applyTransform:(l,c,h)=>{l.getFeatureAttribute(c,ML),Qn(h,Vtt(s.materialParameters,ML,h))},scaleFactor:(l,c,h)=>{c.getFeatureAttribute(h,ML),cQ(l,s.materialParameters,ML)}}:null,a=new Eh({symbol:e,optionalFields:this._optionalFields,metadata:n,shaderTransformation:o},this._context.scheduler);return a.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{r.removeRenderPlugin(a),a.destroy()}),await r.addRenderPlugin(a,i),a}_getExternalColorParameters(e){const i={};return this._drivenProperties.color?i.externalColor=Hh:e?.color!=null?i.externalColor=Pe.toUnitRGBA(e.color):(i.externalColor=Hh,i.colorMixMode="ignore"),i}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(e=>e()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry))return null;const r=LP(i.geometry);if(r==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const n=this.setGraphicElevationContext(i),s=e.renderingInfo;return this._createAs3DShape(i,r,s,n,i.uid,e.layer.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(this._resources==null)return;const e=this._drivenProperties.opacity,i=!this._isPrimitive,r=this._resources.stageResources.materials,n=this._resources.originalMaterialParameters;for(let s=0;s<r.length;s++){const o=r[s],a=this.symbolLayer?.material?.color,l=n[s],c=this._getCombinedOpacity(a,{hasIntrinsicColor:i})*l.opacity,h=c<1||e||l.transparent;o.setParameters({opacity:c,transparent:h}),this._isPrimitive&&o.setParameters({cullFace:h?xr.None:xr.Back})}}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,Vv)}slicePlaneEnabledChanged(){if(this._resources==null)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(this._resources==null)return!0;const{stageResources:e,isWosr:i}=this._resources;for(const r of e.materials)this._isPrimitive?r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):i||r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this._hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this._hasLoadedPBRTextures=!0,!1)}applyRendererDiff(e,i){if(this._resources==null)return Kn.RecreateSymbol;const{stageResources:{materials:r},lodRenderer:n,resourceBoundingBox:s,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in e.diff){if(c!=="visualVariables"||!oC(this._fastUpdates,i,this._fastVisualVariableConvertOptions(s,o,a,l)))return Kn.RecreateSymbol;for(const h of r)h.setParameters(this._fastUpdates.materialParameters);n.notifyShaderTransformationChanged()}return Kn.FastUpdate}computeComplexity(){if(this._resources==null)return super.computeComplexity();const e=this._resources.lodResources,i=fCe(e.levels),r=a=>Array.from(a.attributes.values()).reduce((l,c)=>l+gv(c.data,c.indices),0),n=Xae(e).reduce((a,l)=>a+r(l),0),s=Yae(e).reduce((a,l)=>a+l.memoryEstimate,0)+n,o={...pCe(this.symbol,this.symbolLayer),resourceBytes:s};return new Dh({verticesPerFeature:i,memory:o})}_hasLodRenderer(){return this._resources!=null}_createAs3DShape(e,i,r,n,s,o){if(!this._hasLodRenderer()||this._resources==null)return null;const a=this.getFastUpdateAttrValues(e),l=this._context.clippingExtent;if(Wc(i,JT,this._context.elevationProvider.spatialReference),l!=null&&!gJ(l,JT))return null;const c=this._requiresTerrainElevation(n),h=this._computeGlobalTransform(i,n,wB,$L),d=this._computeLocalTransform(this._resources,this.symbolLayer,r,Xce),f=this._resources.lodRenderer.instanceData,m=f.addInstance();this._instanceIndexToGraphicUid.set(m,s),f.setLocalTransform(m,d,!1),f.setGlobalTransform(m,h),a&&f.setFeatureAttribute(m,a),this._fastUpdates==null&&this._hasPerInstanceColor()&&f.setColor(m,gR(r.color,r.opacity,255)),this._context.stage.renderView.objectAndLayerIdRenderHelper!=null&&f.setObjectAndLayerIdColor(m,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:s,layerUid:o}));const y=new Eht(this,m,_rt,n);return c&&(y.alignedSampledElevation=$L.sampledElevation),y.needsElevationUpdates=Vv(n.mode),IP(y,i,this._context.elevationProvider),y}_computeGlobalTransform(e,i,r,n){return Bv(e,this._context.elevationProvider,i,this._context.renderCoordsHelper,n),JT[0]=e.x,JT[1]=e.y,JT[2]=n.z,Bc(e.spatialReference,JT,r,this._context.renderCoordsHelper.spatialReference),r}_computeLocalTransform(e,i,r,n){return td(n),this._applyObjectRotation(r,!1,n),this._applyObjectRotation(i,!0,n),this._applyObjectScale(e,r,n),this._applyAnchor(e,i,n),n}_applyObjectScale(e,i,r){if(this._fastUpdates?.requiresShaderTransformation)return;const n=this._drivenProperties.size&&i.size?i.size:e.symbolSize,s=qae(n,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);s[0]===1&&s[1]===1&&s[2]===1||mM(r,r,s)}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const i=e.diff.diff;this._preparePatchTransform(e,i),this._preparePatchColor(e,i)}updateGeometry(e,i){if(this._resources==null)return!0;const r=i&&LP(i);if(r==null)return!1;const n=this.getGeometryElevationMode(i);return e.elevationContext.mode===n&&(this._computeGlobalTransform(r,e.elevationContext,wB,$L),this._requiresTerrainElevation(e.elevationContext)&&(e.alignedSampledElevation=$L.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,wB,!0),IP(e,r,this._context.elevationProvider),!0)}_preparePatchTransform(e,i){if(!(i.heading||i.tilt||i.roll||i.width||i.height||i.depth||i.anchor||i.anchorPosition)||this._resources==null)return;const r=(y,_,v)=>(y!=null&&y.type==="complete"?y.newValue:_)??v,n=r(i.heading,this.symbolLayer.heading,0),s=r(i.tilt,this.symbolLayer.tilt,0),o=r(i.roll,this.symbolLayer.roll,0),a=r(i.width,this.symbolLayer.width,void 0),l=r(i.height,this.symbolLayer.height,void 0),c=r(i.depth,this.symbolLayer.depth,void 0),h=r(i.anchor,this.symbolLayer.anchor,void 0),d=r(i.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete i.heading,delete i.tilt,delete i.roll,delete i.width,delete i.height,delete i.depth,delete i.anchor,delete i.anchorPosition;const f={heading:n,tilt:s,roll:o,anchor:h,anchorPosition:d},m=this._resources;this.loadStatus===Ru.LOADED&&e.symbolLayerStatePatches.push(()=>{m.symbolSize=Ta(hz(m.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),e.graphics3DGraphicPatches.push((y,_)=>{const v=this._computeLocalTransform(m,f,_,Xce),w=y.instanceIndex;m.lodRenderer.instanceData.setLocalTransform(w,v,!0)})}_preparePatchColor(e,i){if(!i.material||i.material.type!=="partial")return;const r=i.material.diff;if(!r.color||r.color.type!=="complete"||r.color.newValue==null||r.color.oldValue==null)return;const n=r.color.newValue,s=n!=null?Pe.toUnitRGBA(n):Hh;delete r.color;const o=this._resources;o!=null&&e.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,s),l=this._setMaterialTransparencyParameters({},n)):l=this._setMaterialTransparencyParameters({externalColor:s},n);for(const c of o.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(e){return e.mode!=="absolute-height"}_applyObjectRotation(e,i,r){if(!this._fastUpdates?.requiresShaderTransformation||!i)return art(e.heading,e.tilt,e.roll,r)}_computeAnchor(e,i,r){const n=E();switch(r.anchor){case"center":oe(n,_p(e)),Pa(n,n);break;case"top":{const s=_p(e);ae(n,-s[0],-s[1],-e[5]);break}case"bottom":{const s=_p(e);ae(n,-s[0],-s[1],-e[2]);break}case"relative":{const s=_p(e),o=W$(e),a=r.anchorPosition,l=a?Oe(a.x,a.y,a.z):vo;b6(n,o,l),ue(n,n,s),Pa(n,n);break}default:i!=null?Pa(n,i):oe(n,vo)}return n}_applyAnchor(e,i,r){if(this._fastUpdates?.requiresShaderTransformation)return;const n=this._computeAnchor(e.resourceBoundingBox,e.pivotOffset,i);n&&Kl(r,r,n)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,i,r,n){const s=e!=null?Ta(W$(e)):ey,o=e!=null?this._computeAnchor(e,n,this.symbolLayer):vo,a=this._context.renderCoordsHelper.unitInMeters,l=qae(i??void 0,i,r,a),c=Oe(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new jM({size:!0,color:!0,rotation:!0,opacity:!1},s,i??ey,a,o,l,c)}};const JT=E(),Xce=be(),wB=be(),ML=oi(),$L=new XM;let spt=class{constructor(e,i,r,n){this.vertices=e,this.positionsES=i,this.offset=n;const s=e.length,o=Math.floor(s/2),a=this.offset+3*o,l=r[a],c=r[a+1],h=r[a+2];this.origin=Oe(l,c,h),this.positions=un(3*s);const d=this.offset+3*s;for(let f=this.offset;f<d;f+=3)this.positions[f]=r[f]-l,this.positions[f+1]=r[f+1]-c,this.positions[f+2]=r[f+2]-h;this.updatePathVertexInformation()}get usedMemory(){return gv(this.positions)}updatePathVertexInformation(){const e=this.vertices.length,i=this.vertices[0];let r=this.offset;const n=this.positions;i.vRight[0]=n[r+3]-n[r],i.vRight[1]=n[r+4]-n[r+1],i.vRight[2]=n[r+5]-n[r+2],r+=3;let s=xe(i.vRight);i.vMinSiblingLength=s,ye(i.vRight,i.vRight);let o=i;for(let a=1;a<e;++a){const l=this.vertices[a];if(l.vLeft=o.vRight,a<e-1){l.vRight[0]=n[r+3]-n[r],l.vRight[1]=n[r+4]-n[r+1],l.vRight[2]=n[r+5]-n[r+2];const c=xe(l.vRight);l.vMinSiblingLength=Math.min(s,c),s=c,ye(l.vRight,l.vRight)}else oe(l.vRight,l.vLeft),l.vMinSiblingLength=s;o=l,r+=3}}},opt=class{constructor(e,i,r,n,s,o={}){this.path=e,this.profile=i,this.extruder=r,this.startCap=n,this.endCap=s,this.options=o,this._extrusionVertexCount=0;const a=this.path.vertices.length-2;this.numExtrusionProfiles=r.numProfilesPerJoin()*a+2,this.numVerticesTotal=i.vertices.length*this.numExtrusionProfiles,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.numVertices;this.numVerticesTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.numVertices;this.numVerticesTotal+=c,this.pathVertexData=BZe(1*this.numVerticesTotal),this.profileRightAxes=un(4*this.numVerticesTotal),this.profileUpAxes=un(4*this.numVerticesTotal),this.profileVertexAndNormals=un(4*this.numVerticesTotal),this.positions=SF(e.positions,e.offset,3*e.vertices.length),this._rebuildGeometry(),this.buildTopology()}get usedMemory(){return gv(this.pathVertexData,this.profileRightAxes,this.profileUpAxes,this.profileVertexAndNormals)+this.path.usedMemory+this.profile.usedMemory}emitVertex(e,i,r,n,s){const o=4*this._extrusionVertexCount;if(this.profileRightAxes[o]=i.right[0],this.profileRightAxes[o+1]=i.right[1],this.profileRightAxes[o+2]=i.right[2],this.profileUpAxes[o]=i.up[0],this.profileUpAxes[o+1]=i.up[1],this.profileUpAxes[o+2]=i.up[2],this.profileVertexAndNormals[o]=r[0],this.profileVertexAndNormals[o+1]=r[1],this.profileVertexAndNormals[o+2]=n[0],this.profileVertexAndNormals[o+3]=n[1],this.pathVertexData[this._extrusionVertexCount]=e,s){const a=this.path.vertices[e],l=a.maxStretchDistance;this.profileRightAxes[o+3]=a.rotationRight[0]*l,this.profileUpAxes[o+3]=a.rotationRight[1]*l}else this.profileRightAxes[o+3]=0,this.profileUpAxes[o+3]=0;++this._extrusionVertexCount}emitCapVertex(e,i,r,n,s,o){const a=4*this._extrusionVertexCount;this.profileRightAxes[a]=i.right[0],this.profileRightAxes[a+1]=i.right[1],this.profileRightAxes[a+2]=i.right[2],this.profileRightAxes[a+3]=s,this.profileUpAxes[a]=i.up[0],this.profileUpAxes[a+1]=i.up[1],this.profileUpAxes[a+2]=i.up[2],this.profileUpAxes[a+3]=o,this.profileVertexAndNormals[a]=r[0],this.profileVertexAndNormals[a+1]=r[1],this.profileVertexAndNormals[a+2]=n[0],this.profileVertexAndNormals[a+3]=n[1],this.pathVertexData[this._extrusionVertexCount]=e,++this._extrusionVertexCount}_rebuildGeometry(){this._extrusionVertexCount=0;const{positions:e,offset:i,vertices:r}=this.path;this.positions=SF(e,i,3*r.length);let n=0;const s=(a,l,c,h,d)=>this.emitCapVertex(n,a,l,c,h,d),o=(a,l,c,h)=>this.emitVertex(n,a,l,c,h);for(this.startCap.rebuildConnectingProfileGeometry(r[n],this.profile,s),n=1;n<r.length-1;++n)this.extruder.extrude(r[n],this.profile,o);this.endCap.rebuildConnectingProfileGeometry(r[n],this.profile,s),n=0,this.startCap.rebuildCapGeometry(r[n],s),n=r.length-1,this.endCap.rebuildCapGeometry(r[n],s)}buildTopology(){const e=this.profile.vertices.length,i=this.profile.numSegments,r=this.numExtrusionProfiles-1;let n=3*(2*(i*r));this.startCap.indexBufferStart=n,this.startCap.firstProfileVertexIndex=0,n+=this.startCap.numIndices,this.endCap.indexBufferStart=n,this.endCap.firstProfileVertexIndex=e*(this.numExtrusionProfiles-1);const s=new Array,o=new Array,a=new Array,l=(c,h,d)=>{s.push(c),s.push(h),s.push(d),o.push(c),o.push(h),o.push(d),a.push(this.pathVertexData[c]),a.push(this.pathVertexData[h]),a.push(this.pathVertexData[d])};for(let c=0;c<i;++c){const h=this.profile.indices[2*c],d=this.profile.indices[2*c+1];for(let f=0;f<r;++f){const m=f*e+h,y=(f+1)*e+d,_=f*e+d;l(m,(f+1)*e+h,y),l(m,y,_)}}this.startCap.buildTopology(this.path.vertices[0],l),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],l),this.vertexIndices=ym(s),this.normalIndices=ym(o),this.pathVertexIndices=ym(a)}onPathChanged(){this._rebuildGeometry()}},wee=class{rebuildConnectingProfileGeometry(e,i,r){for(let n=0;n<i.vertices.length;++n)r(e.frame,i.vertices[n],i.normals[n],0,0)}},Zce=class extends wee{constructor(){super(),this.numVertices=0,this.numIndices=0}rebuildCapGeometry(){}buildTopology(){}},IL=class extends wee{constructor(e,i=0,r=!1){super(),this.profile=e,this.profilePlaneOffset=i,this.flip=r}get numVertices(){return this.profile.vertices.length}get numIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,i,r){const n=this.profilePlaneOffset;for(let s=0;s<i.vertices.length;++s)r(e.frame,i.vertices[s],i.normals[s],n,0)}rebuildCapGeometry(e,i){const r=this.profile,n=this.flip?1:-1,s=this.profilePlaneOffset,o=lOe;mi(o,0,0);for(let a=0;a<r.vertices.length;++a)i(e.frame,r.vertices[a],o,s,n)}buildTopology(e,i){const r=this.profile,n=this.vertexBufferStart+r.indices[0];for(let s=1;s<r.numSegments;++s){const o=r.indices[2*s],a=r.indices[2*s+1],l=this.vertexBufferStart+o,c=this.vertexBufferStart+a;this.flip?i(c,l,n):i(n,l,c)}}},Jce=class extends wee{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}get numVertices(){let e=this.profile.vertices.length*(this.numSegments-1)+this.profile.poles.length;return this.breakNormals&&(e+=this.profile.vertices.length),e}get numIndices(){let e=0;const i=this.profile;e+=2*i.numSegments*(this.numSegments-1);for(let r=0;r<i.numSegments;++r){const n=i.indices[2*r],s=i.indices[2*r+1];i.poleIndices[n]===i.poleIndices[s]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,i){const r=this.profile,n=e.frame,s=.5*this.sign,o=apt,a=lOe;mi(a,0,0);for(const l of r.poles)l.normal?i(n,l.position,l.normal,s,0):i(n,l.position,a,s,this.sign);if(this.breakNormals)for(let l=0;l<r.vertices.length;++l)i(n,r.vertices[l],r.normals[l],0,0);for(let l=0;l<this.numSegments-1;++l){const c=(1-(l+1)/this.numSegments)*Math.PI*.5,h=Math.sin(c),d=Math.cos(c);for(let f=0;f<r.vertices.length;++f){const m=r.poles[r.poleIndices[f]];Qf(o,r.vertices[f],m.position),Lc(o,o,h),m.normal?(sp(o,o,m.position),i(n,o,m.normal,s*d,0)):(xP(a,o),Lc(a,a,h),sp(o,o,m.position),i(n,o,a,s*d,this.sign*d))}}}buildTopology(e,i){const r=this.profile,n=this.breakNormals?this.vertexBufferStart+r.poles.length:this.firstProfileVertexIndex,s=this.breakNormals?this.vertexBufferStart+r.poles.length+r.vertices.length:this.vertexBufferStart+r.poles.length;for(let o=0;o<r.numSegments;++o){const a=r.indices[2*o],l=r.indices[2*o+1],c=this.vertexBufferStart+r.poleIndices[a],h=this.vertexBufferStart+r.poleIndices[l];let d=n+a,f=n+l;for(let m=0;m<this.numSegments-1;++m){const y=s+m*r.vertices.length+a,_=s+m*r.vertices.length+l;this.flip?(i(y,f,d),i(f,y,_)):(i(d,f,y),i(_,y,f)),d=y,f=_}this.flip?(i(c,f,d),c!==h&&i(c,h,f)):(i(d,f,c),c!==h&&i(f,h,c))}}};const apt=Ge(),lOe=Ge();let lpt=class{numProfilesPerJoin(){return 1}extrude(e,i,r){for(let n=0;n<i.vertices.length;++n)r(e.frame,i.vertices[n],i.normals[n],!1)}},xB=class{constructor(e,i){this.cutoffAngle=e,this.numBendSubdivisions=i}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,i,r){const n=upt,{rotationAngle:s,rotationRight:o,frame:a}=e;if(Math.abs(s)>=this.cutoffAngle){const l=e.rotationFrameUp;for(let c=0;c<this.numBendSubdivisions+1;++c){Qu(Qce,.5*-s+c*s/this.numBendSubdivisions,l),cpt(n,a,Qce);for(let h=0;h<i.vertices.length;++h)Ss(i.vertices[h],o)*s>=0?r(n,i.vertices[h],i.normals[h],!1):r(a,e.applyMiterStretch(Kce,i.vertices[h]),i.normals[h],!0)}}else for(let l=0;l<this.numBendSubdivisions+1;++l)for(let c=0;c<i.vertices.length;++c){const h=Ss(i.vertices[c],o)*s>=0;r(a,e.applyMiterStretch(Kce,i.vertices[c]),i.normals[c],!h)}}},cOe=class{constructor(){this.up=E(),this.right=E()}};function cpt(t,e,i){ke(t.up,e.up,i),ke(t.right,e.right,i)}const Kce=Ge(),Qce=be(),upt=new cOe;let hpt=class extends ms{constructor(e,i,r,n,s,o){super(e,i,null,wn.Mesh,o),this.path=r,this.geometrySR=n,this.stencilWidth=s}};var _m;function uOe(t){return"path"in t}(function(t){t[t.World=0]="World",t[t.Path=1]="Path"})(_m||(_m={}));let hOe=class{constructor(e){this.builder=e}onPathChanged(e){this.builder.onPathChanged()}},dOe=class extends hOe{constructor(e){super(e),this.vertexAttributeColor=Ft(255,255,255,255),this.size=new Array,this.vertexAttributePosition=un(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Int16Array(2*this.builder.numVerticesTotal)}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;const{numVerticesTotal:i,pathVertexData:r,path:n,positions:s,profileRightAxes:o,profileUpAxes:a,profileVertexAndNormals:l}=this.builder;for(let c=0;c<i;++c){let h=r[c];const d=h===0||h===n.vertices.length-1;h*=3;const f=gpt;let m=0,y=0;const _=4*c,v=ae(ypt,o[_],o[_+1],o[_+2]),w=ae(_pt,a[_],a[_+1],a[_+2]),x=mi(eue,l[_]*e[0],l[_+1]*e[1]);if(d)lt(f,w,v),m=o[_+3]*e[0],y=a[_+3];else{const A=ppt,R=fpt;mi(A,o[_+3],a[_+3]);const D=dK(A);xP(A,A);const N=Ss(x,A);if(Math.abs(N)>D){mi(R,-A[1],A[0]);const k=Ss(x,R);Lc(A,A,D*Math.sign(N)),Lc(R,R,k),sp(x,A,R)}ae(f,0,0,0)}const T=ae(mpt,v[0]*x[0]+w[0]*x[1],v[1]*x[0]+w[1]*x[1],v[2]*x[0]+w[2]*x[1]),S=3*c;this.vertexAttributePosition[S]=s[h]+T[0]+f[0]*m,this.vertexAttributePosition[S+1]=s[h+1]+T[1]+f[1]*m,this.vertexAttributePosition[S+2]=s[h+2]+T[2]+f[2]*m;const C=mi(eue,l[_+2],l[_+3]);Mx(this.vertexAttributeNormal,c,v[0]*C[0]+w[0]*C[1]+f[0]*y,v[1]*C[0]+w[1]*C[1]+f[1]*y,v[2]*C[0]+w[2]*C[1]+f[2]*y)}}createGeometryData(){const e=this.builder.vertexIndices.length,{normalIndices:i,vertexIndices:r}=this.builder;return[[O.POSITION,new Ve(this.vertexAttributePosition,r,3,!0)],[O.NORMALCOMPRESSED,new Ve(this.vertexAttributeNormal,i,2,!0)],[O.COLOR,new Ve(this.vertexAttributeColor,r1(e),4)]]}onPathChanged(e){super.onPathChanged(e),this.bake(this.size)}intersect(e,i,r){const n=this.builder.vertexIndices,s=new LM(this.vertexAttributePosition,3),o=n.length/3;HM(e,i,0,o,n,s,void 0,void 0,r)}},dpt=class extends hOe{constructor(e,i,r,n){super(e),this.sizeAttributeValue=i,this.colorAttributeValue=r,this.opacityAttributeValue=n,this.vvData=null,this.baked=new dOe(e),this.vvData=un(4*this.builder.path.vertices.length);for(let s=0;s<this.builder.path.vertices.length;++s){this.vvData[4*s]=i,this.vvData[4*s+1]=r,this.vvData[4*s+2]=n;const o=s===0||s===this.builder.path.vertices.length-1;this.vvData[4*s+3]=o?1:0}}createGeometryData(){const{positions:e,profileRightAxes:i,profileUpAxes:r,profileVertexAndNormals:n,pathVertexIndices:s,vertexIndices:o}=this.builder;return[[O.POSITION,new Ve(e,s,3,!0)],[O.PROFILERIGHT,new Ve(i,o,4,!0)],[O.PROFILEUP,new Ve(r,o,4,!0)],[O.PROFILEVERTEXANDNORMAL,new Ve(n,o,4,!0)],[O.FEATUREVALUE,new Ve(this.vvData,s,4,!0)]]}onPathChanged(e){super.onPathChanged(e);const i=e.getMutableAttribute(O.POSITION);i&&(i.data=this.builder.positions)}};const eue=Ge(),ppt=Ge(),fpt=Ge(),mpt=E(),gpt=E(),ypt=E(),_pt=E();function vpt(t,e){let i=null;const r=t.vertices.length,n=.99619469809,s=E(),o=E(),a=E(),l=E(),c=E(),h=E(),d=Ii();let f=t.vertices[0];oe(o,e),ae(s,0,1,0),AF(f.vRight,o,s,s,a,o,n),oe(f.frame.up,o),oe(f.frame.right,a);const m=t.positions;let y=t.offset;i=f;for(let _=1;_<r;++_){f=t.vertices[_],ue(c,f.vLeft,f.vRight);let v=xe(c);v>0?(v=1/Math.sqrt(v),c[0]=c[0]*v,c[1]=c[1]*v,c[2]=c[2]*v):(c[0]=f.vRight[0],c[1]=f.vRight[1],c[2]=f.vRight[2]),h[0]=m[y]+i.frame.up[0],h[1]=m[y+1]+i.frame.up[1],h[2]=m[y+2]+i.frame.up[2],y+=3;const w=ae(bpt,m[y],m[y+1],m[y+2]);IM(w,c,d),qx(d,th(h,f.vLeft),l)?(l[0]-=m[y],l[1]-=m[y+1],l[2]-=m[y+2],ye(o,l),lt(a,c,o),ye(a,a)):AF(c,i.frame.up,i.frame.right,s,a,o,n),oe(f.frame.up,o),oe(f.frame.right,a),i=f}}const bpt=E();let pOe=class{constructor(){this.vertices=new Array,this.normals=new Array,this.indices=new Array,this.poles=new Array,this.poleIndices=new Array}addVertex(e,i){return this.vertices.push(U3(e)),this.normals.push(U3(i)),this.vertices.length-1}addPole(e,i=null){return this.poles.push({position:U3(e),normal:i?U3(i):null}),this.poles.length-1}addSegment(e,i=null){this.indices.push(e.v0),this.indices.push(e.v1),i&&(this.poleIndices.push(i.v0),this.poleIndices.push(i.v1))}get numSegments(){return this.indices.length/2}translate(e,i){for(const r of this.vertices)r[0]+=e,r[1]+=i;for(const r of this.poles)r.position[0]+=e,r.position[1]+=i}get usedMemory(){return this.vertices.length*gv(this.vertices[0])*2+gv(this.indices)}};const fOe={top:[0,-.5],bottom:[0,.5]};function TB(t){const i=IEe,r=new pOe,n={v0:0,v1:0};r.addPole(pi(0,0));for(let o=0;o<i;++o){const a=2*o*Math.PI/i,l=Math.cos(a),c=Math.sin(a),h=pi(l*.5,c*.5),d=pi(l,c);r.addVertex(h,d)}for(let o=0;o<i-1;++o){const a={v0:o,v1:o+1};r.addSegment(a,n)}const s={v0:i-1,v1:0};if(r.addSegment(s,n),t!=="center"){const o=fOe[t];r.translate(o[0],o[1])}return r}const wpt={center:TB("center"),top:TB("top"),bottom:TB("bottom")},xpt={center:SB("center"),top:SB("top"),bottom:SB("bottom")};function SB(t){const r=new pOe,n=pi(.5*-1,.5*-1),s=pi(.5*1,.5*-1),o=pi(.5*1,.5*1),a=pi(.5*-1,.5*1),l=pi(0,-1),c=pi(1,0),h=pi(0,1),d=pi(-1,0);if(r.addPole(pi(0,.5*1),h),r.addPole(pi(0,.5*1)),r.addPole(pi(0,.5*-1)),r.addPole(pi(0,.5*-1),l),r.addVertex(n,l),r.addVertex(s,l),r.addSegment({v0:0,v1:1},{v0:3,v1:3}),r.addVertex(s,c),r.addVertex(o,c),r.addSegment({v0:2,v1:3},{v0:2,v1:1}),r.addVertex(o,h),r.addVertex(a,h),r.addSegment({v0:4,v1:5},{v0:0,v1:0}),r.addVertex(a,d),r.addVertex(n,d),r.addSegment({v0:6,v1:7},{v0:1,v1:2}),t!=="center"){const f=fOe[t];r.translate(f[0],f[1])}return r}function Tpt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Spt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function mOe(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t}function Ept(t,e){if(t===e){const i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function Cpt(t,e){const i=e[0],r=e[1],n=e[2],s=e[3];let o=i*s-n*r;return o?(o=1/o,t[0]=s*o,t[1]=-r*o,t[2]=-n*o,t[3]=i*o,t):null}function Apt(t,e){const i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t}function Opt(t){return t[0]*t[3]-t[2]*t[1]}function gOe(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=i[0],l=i[1],c=i[2],h=i[3];return t[0]=r*a+s*l,t[1]=n*a+o*l,t[2]=r*c+s*h,t[3]=n*c+o*h,t}function Rpt(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+s*a,t[1]=n*l+o*a,t[2]=r*-a+s*l,t[3]=n*-a+o*l,t}function Ppt(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=i[0],l=i[1];return t[0]=r*a,t[1]=n*a,t[2]=s*l,t[3]=o*l,t}function Mpt(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t}function $pt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function Ipt(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function Lpt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2)}function Dpt(t,e,i,r){return t[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-t[2]*i[1],[t,e,i]}function Npt(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function yOe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function Fpt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function kpt(t,e){const i=t[0],r=t[1],n=t[2],s=t[3],o=e[0],a=e[1],l=e[2],c=e[3],h=jo();return Math.abs(i-o)<=h*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=h*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-l)<=h*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=h*Math.max(1,Math.abs(s),Math.abs(c))}function Upt(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function zpt(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t}const Bpt=gOe,Vpt=yOe;Object.freeze(Object.defineProperty({__proto__:null,LDU:Dpt,add:Npt,adjoint:Apt,copy:Tpt,determinant:Opt,equals:kpt,exactEquals:Fpt,frob:Lpt,fromRotation:Mpt,fromScaling:$pt,identity:Spt,invert:Cpt,mul:Bpt,multiply:gOe,multiplyScalar:Upt,multiplyScalarAndAdd:zpt,rotate:Rpt,scale:Ppt,set:mOe,str:Ipt,sub:Vpt,subtract:yOe,transpose:Ept},Symbol.toStringTag,{value:"Module"}));function _Oe(){return[1,0,0,1]}function Gpt(t){return[t[0],t[1],t[2],t[3]]}function jpt(t,e,i,r){return[t,e,i,r]}function Hpt(t,e){return new Float64Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:Gpt,create:_Oe,createView:Hpt,fromValues:jpt},Symbol.toStringTag,{value:"Module"}));let vOe=class{constructor(){this.vLeft=E(),this.vRight=E(),this.vMinSiblingLength=0,this.frame=new cOe}setFrameFromUpVector(e){oe(this.frame.up,e),ue(UA,this.vLeft,this.vRight),ye(UA,UA),re(rue,this.frame.up,ge(UA,this.frame.up)),de(LL,UA,rue),ye(LL,LL),lt(this.frame.right,LL,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}},qpt=class extends vOe{get rotationFrameUp(){return this.frame.up}get rotationRight(){return hbe}get rotationAngle(){return re($0,this.frame.up,ge(this.frame.up,this.vLeft)),de($0,this.vLeft,$0),Pa($0,$0),ye($0,$0),re(QT,this.frame.up,ge(this.frame.up,this.vRight)),de(QT,this.vRight,QT),ye(QT,QT),lt(ck,this.rotationFrameUp,this.vLeft),Math.sign(ge(ck,this.vRight))*(Math.PI-Ys(ge($0,QT)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(e,i){const r=this.rotationAngle;if(Math.abs(r)<=0)return i;const n=B7(Math.cos(.5*r));return mi(e,(n-1+1)*i[0],i[1])}},Wpt=class extends vOe{get rotationFrameUp(){const e=Math.sign(ge(this.frame.right,this.vRight));return lt(kA,this.vRight,this.vLeft),re(kA,kA,e),ye(kA,kA)}get rotationRight(){const e=this.rotationFrameUp,i=ge(e,this.frame.up),r=ge(e,this.frame.right);return re(KT,this.frame.up,-r),re(iue,this.frame.right,i),ue(KT,KT,iue),ye(KT,KT),Ypt(tue,this.frame,KT),tue}get rotationAngle(){const e=Math.sign(ge(this.frame.right,this.vRight));return Pa(ck,this.vLeft),-e*(Math.PI-Ys(ge(ck,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*B7(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(e,i){const r=this.rotationAngle;if(Math.abs(r)===0)return i;const n=B7(Math.cos(.5*r)),s=this.rotationRight,o=mOe(Zpt,1+(n-1)*s[0]*s[0],(n-1)*s[0]*s[1],(n-1)*s[0]*s[1],1+(n-1)*s[1]*s[1]);return Fxe(e,i,o)}};function Ypt(t,e,i){mi(t,ge(i,e.right),ge(i,e.up))}function Xpt(t){switch(t){case _m.World:return new qpt;case _m.Path:return new Wpt}}const kA=E(),tue=Ge(),KT=E(),iue=E(),ck=E(),$0=E(),QT=E(),rue=E(),UA=E(),LL=E(),Zpt=_Oe(),EB=8;function Jpt(t,e){const i=O.FEATUREVALUE;t.attributes.add(i,"vec4");const r=t.vertex;r.code.add(b`
  bool isCapVertex() {
    return ${i}.w == 1.0;
  }
  `),r.uniforms.add(new Ki("size",n=>n.size)),e.vvSize?(r.uniforms.add(new kt("vvSizeMinSize",n=>n.vvSize.minSize),new kt("vvSizeMaxSize",n=>n.vvSize.maxSize),new kt("vvSizeOffset",n=>n.vvSize.offset),new kt("vvSizeFactor",n=>n.vvSize.factor)),r.code.add(b`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${i}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):r.code.add(b`vec2 getSize(){
return size;
}`),e.vvOpacity?(r.constants.add("vvOpacityNumber","int",EB),r.uniforms.add(new jl("vvOpacityValues",n=>n.vvOpacity.values,EB),new jl("vvOpacityOpacities",n=>n.vvOpacity.opacityValues,EB)),r.code.add(b`
    vec4 applyOpacity(vec4 color) {
      float value = ${i}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):r.code.add(b`vec4 applyOpacity(vec4 color){
return color;
}`),e.vvColor?(r.constants.add("vvColorNumber","int",lE),r.uniforms.add(new jl("vvColorValues",n=>n.vvColor.values,lE),new lEe("vvColorColors",n=>n.vvColor.colors,lE)),r.code.add(b`
    vec4 getColor() {
      float value = ${i}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):r.code.add(b`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),t.include(kM),t.attributes.add(O.PROFILERIGHT,"vec4"),t.attributes.add(O.PROFILEUP,"vec4"),t.attributes.add(O.PROFILEVERTEXANDNORMAL,"vec4"),r.code.add(b`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),r.code.add(b`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),r.code.add(b`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),r.code.add(b`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}let Kpt=class extends WM{constructor(){super(...arguments),this.size=pi(1,1)}};function Qpt(t){const e=new Ei,{vertex:i,fragment:r}=e;switch(zc(i,t),e.varyings.add("vpos","vec3"),e.include(Jpt,t),t.output!==F.Color&&t.output!==F.Alpha||(e.include(Xl,t),e.include(Ox,t),e.include(kC,t),e.varyings.add("vnormal","vec3"),e.varyings.add("vcolor","vec4"),t.multipassEnabled&&e.varyings.add("depth","float"),i.code.add(b`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${t.output===F.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),e.include(Xc,t),t.output){case F.Alpha:e.include(Dn,t),r.uniforms.add(new Re("opacity",n=>n.opacity)),r.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        fragColor = vec4(combinedOpacity);
      }
    `);break;case F.Color:e.include(Dn,t),e.include(Ax,t),e.include(KM,t),e.include(Ox,t),e.include(zEe,t),Np(r,t),QM(r),GC(r),r.uniforms.add(i.uniforms.get("localOrigin"),new kt("ambient",n=>n.ambient),new kt("diffuse",n=>n.diffuse),new kt("specular",n=>n.specular),new Re("opacity",n=>n.opacity)),r.include(Wm),Gm(r),r.code.add(b`
        void main() {
          discardBySlice(vpos);
          ${t.multipassEnabled?"terrainDepthTest(depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          fragColor = vec4(shadedColor, combinedOpacity);
          fragColor = highlightSlice(fragColor, vpos);
          ${t.transparencyPassType===it.Color?"fragColor = premultiplyAlpha(fragColor);":""}
        }
      `);break;case F.Depth:case F.Shadow:case F.ShadowHighlight:case F.ShadowExcludeHighlight:e.include(Xl,t),Sx(e),e.varyings.add("depth","float"),i.code.add(b`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),e.include(Dn,t),e.include($y,t),r.code.add(b`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case F.Normal:e.include(Xl,t),e.include(kP,t),tC(i),e.varyings.add("vnormal","vec3"),i.code.add(b`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(Dn,t),r.code.add(b`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case F.Highlight:e.include(Xl,t),e.include(kP,t),e.varyings.add("vnormal","vec3"),i.code.add(b`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(Dn,t),e.include(s1,t),r.code.add(b`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return e}const eft=Object.freeze(Object.defineProperty({__proto__:null,build:Qpt},Symbol.toStringTag,{value:"Module"})),bOe=new Map([[O.POSITION,0],[O.PROFILERIGHT,1],[O.PROFILEUP,2],[O.PROFILEVERTEXANDNORMAL,3],[O.FEATUREVALUE,4]]);let tft=class extends Kpt{constructor(){super(...arguments),this.ambient=Oe(.2,.2,.2),this.diffuse=Oe(.8,.8,.8),this.specular=Oe(0,0,0),this.opacity=1,this.origin=E(),this.modelTransformation=null}},wOe=class xOe extends Fi{initializeConfiguration(e,i){i.spherical=e.viewingMode===Le.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Mi(e.rctx,xOe.shader.get().build(this.configuration),bOe)}initializePipeline(){const e=this.configuration.transparencyPassType,i=this.configuration,r=e===it.NONE,n=e===it.FrontFace;return Lt({blending:i.output!==F.Color&&i.output!==F.Alpha||!i.transparent?null:r?Xu:Zy(e),culling:i.hasSlicePlane&&!i.transparent&&i.doubleSidedMode!==hn.None?qxe:null,depthTest:{func:o1(e)},depthWrite:r||n?ec:null,colorWrite:Gt,stencilWrite:i.hasOccludees?$m:null,stencilTest:i.hasOccludees?a1:null,polygonOffset:r||n?null:GU})}};wOe.shader=new Pi(eft,()=>ce(()=>import("./Path.glsl-117a8a78.js"),[],import.meta.url));let bs=class extends fl{constructor(){super(...arguments),this.output=F.Color,this.doubleSidedMode=hn.None,this.transparencyPassType=it.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}};u([U({count:F.COUNT})],bs.prototype,"output",void 0),u([U({count:hn.COUNT})],bs.prototype,"doubleSidedMode",void 0),u([U({count:it.COUNT})],bs.prototype,"transparencyPassType",void 0),u([U()],bs.prototype,"spherical",void 0),u([U()],bs.prototype,"receiveShadows",void 0),u([U()],bs.prototype,"receiveAmbientOcclusion",void 0),u([U()],bs.prototype,"vvSize",void 0),u([U()],bs.prototype,"vvColor",void 0),u([U()],bs.prototype,"vvOpacity",void 0),u([U()],bs.prototype,"hasSlicePlane",void 0),u([U()],bs.prototype,"transparent",void 0),u([U()],bs.prototype,"hasOccludees",void 0),u([U()],bs.prototype,"multipassEnabled",void 0),u([U()],bs.prototype,"cullAboveGround",void 0),u([U()],bs.prototype,"doublePrecisionRequiresObfuscation",void 0),u([U({constValue:!1})],bs.prototype,"occlusionPass",void 0),u([U({constValue:ot.Disabled})],bs.prototype,"pbrMode",void 0),u([U({constValue:!0})],bs.prototype,"hasVvInstancing",void 0),u([U({constValue:!1})],bs.prototype,"useCustomDTRExponentForWater",void 0),u([U({constValue:!1})],bs.prototype,"useFillLights",void 0),u([U({constValue:!1})],bs.prototype,"hasColorTexture",void 0);let ift=class TOe extends n1{constructor(e){super(e,new nft),this.supportsEdges=!0,this._vertexAttributeLocations=bOe,this._configuration=new bs,this._vertexBufferLayout=TOe.getVertexBufferLayout()}getConfiguration(e,i){return this._configuration.output=e,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e!==F.Color&&e!==F.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?hn.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?hn.WindingOrder:hn.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=i.ssao!=null),this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(e){return e!==F.Shadow&&e!==F.ShadowExcludeHighlight&&e!==F.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(e,i,r,n,s,o){const a=e;if(!uOe(a))return;const l=a.path,c=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const{offset:v,factor:w,minSize:x,maxSize:T}=this.parameters.vvSize,S=l.sizeAttributeValue;c[0]*=_e(v[0]+S*w[0],x[0],T[0]),c[1]*=_e(v[2]+S*w[2],x[2],T[2])}const h=Math.max(c[0],c[1]),d=e.boundingInfo;if(d==null)return void this._intersectTriangles(l,c,n,s,o);const f=_x(d.bbMin[0]-h,d.bbMin[1]-h,d.bbMin[2]-h,d.bbMax[0]+h,d.bbMax[1]+h,d.bbMax[2]+h),m=[s[0]-n[0],s[1]-n[1],s[2]-n[2]],y=Math.sqrt(m[0]*m[0]+m[1]*m[1]+m[2]*m[2]),_=[y/m[0],y/m[1],y/m[2]];dQ(f,n,_,r.tolerance)&&this._intersectTriangles(l,c,n,s,o)}_intersectTriangles(e,i,r,n,s){e.baked.size&&e.baked.size[0]===i[0]&&e.baked.size[1]===i[1]||e.baked.bake(i),e.baked.intersect(r,n,s)}createBufferWriter(){return new VC(this._vertexBufferLayout)}produces(e,i){switch(i){case F.Shadow:case F.ShadowHighlight:case F.ShadowExcludeHighlight:if(!this.parameters.castShadows)return!1;case F.Color:case F.Alpha:case F.Depth:case F.Normal:case F.Highlight:case F.ObjectAndLayerIdColor:return e===(this.parameters.transparent?le.TRANSPARENT_MATERIAL:le.OPAQUE_MATERIAL)||e===le.DRAPED_MATERIAL;default:return!1}}createGLMaterial(e){return new rft(e)}static getVertexBufferLayout(){return Hr().vec3f(O.POSITION).vec4f(O.PROFILERIGHT).vec4f(O.PROFILEUP).vec4f(O.PROFILEVERTEXANDNORMAL).vec4f(O.FEATUREVALUE)}},rft=class extends i1{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}_updateShadowState(e){this.technique!=null&&e.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:e.shadowMap.enabled})}beginSlot(e){return this._output!==F.Color&&this._output!==F.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(wOe,e)}},nft=class extends tft{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}};const sft=["polyline"];let oft=class extends Xm{constructor(e,i,r,n){super(e,i,r,n),this._intrinsicSize=pi(1,1),this._upVectorAlignment=_m.Path,this._stencilWidth=.1,this.usedMemory=0,this.ensureDrapedStatus(!1)}async doLoad(){const e=this.symbolLayer.width!=null?this.symbolLayer.width:this.symbolLayer.height,i=this.symbolLayer.height!=null?this.symbolLayer.height:e;this._vvConvertOptions=new jM({size:!0,color:!0,rotation:!1,opacity:!0},[1,1,1],[e,1,i],this._context.renderCoordsHelper.unitInMeters),this._fastUpdates=this._context.renderer?.visualVariables?.length>0?sC(this._context.renderer,this._vvConvertOptions):null;const r=this.symbolLayer.anchor||"center";this._upVectorAlignment=this.symbolLayer.profileRotation==="heading"?_m.World:_m.Path;const n=this.symbolLayer.profile||"circle";switch(n){default:case"circle":this._profile=wpt[r];break;case"quad":this._profile=xpt[r]}switch(this.symbolLayer.join){case"round":this._extruder=new xB(0,$Ee);break;case"bevel":this._extruder=new xB(0,1);break;case"miter":this._extruder=new xB(.8*Math.PI,1);break;default:this._extruder=new lpt}const s=this.symbolLayer.cap||"butt";switch(s){case"none":this._startCap=new Zce,this._endCap=new Zce;break;case"butt":default:this._startCap=new IL(this._profile,0),this._endCap=new IL(this._profile,0,!0);break;case"square":this._startCap=new IL(this._profile,-.5),this._endCap=new IL(this._profile,.5,!0);break;case"round":{const f=n==="quad";this._startCap=new Jce({profile:this._profile,flip:!1,breakNormals:f,subdivisions:Qq}),this._endCap=new Jce({profile:this._profile,flip:!0,breakNormals:f,subdivisions:Qq});break}}const o=this.symbolLayer?.material?.color,a=this._getCombinedOpacityAndColor(o),l=Ta(a),c=a[3],h=c<1||this.needsDrivenTransparentPass,d={diffuse:l,ambient:l,opacity:c,transparent:h,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:h||s==="none"?xr.None:xr.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(mi(this._intrinsicSize,e,i),!Kq(this._intrinsicSize[0])||!Kq(this._intrinsicSize[1])))throw new G("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates?.visualVariables.size||Lc(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates){const f={...d,...this._fastUpdates.materialParameters,size:sbe(this._intrinsicSize)};this._materials[0]=new ift(f)}else d.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,d.normalType=Ni.Compressed,this._materials[0]=new kp(d);this._materials[0].setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials[0]=null,this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,sft,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i),n=e.renderingInfo;return this._createAs3DShape(i,n,r,i.uid)}layerOpacityChanged(){const e=this.symbolLayer?.material?.color,i=this._getCombinedOpacity(e),r=i<1||this.needsDrivenTransparentPass;this._materials[0]?.setParameters({opacity:i,transparent:r})}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,Vv)}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._materials[0]?.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables"||!oC(this._fastUpdates,i,this._vvConvertOptions))return Kn.RecreateSymbol;this._materials[0]?.setParameters(this._fastUpdates.materialParameters)}return Kn.FastUpdate}_getVertexData(e){let i=0;const r=e.paths,n=[],s=e.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const d of r)i+=d.length;const l=_o(3*i);let c,h=0;for(const d of r){n.push({offset:h,numVertices:d.length});for(const f of d)l[h++]=f[0],l[h++]=f[1],l[h++]=e.hasZ?f[2]:0}return o==null||s.equals(o)||rn(l,s,0,l,o,0,i)?(o==null||o.equals(a)?c=gSe(l):(c=_o(3*i),rn(l,o,0,c,a,0,i)),{pathVertexDataInfos:n,vertexDataES:l,vertexDataRS:c}):null}_createAs3DShape(e,i,r,n){this.usedMemory=0;const s=e.geometry,o=this._getVertexData(s);if(o==null)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(o.pathVertexDataInfos.length===0)return s.paths.length!==0&&s.paths.some(y=>y.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;const a=new Array,l=s.spatialReference,c=ks(),h=this._context.renderCoordsHelper,d=new nK(o.vertexDataES);for(const y of o.pathVertexDataInfos){const _=y.numVertices;if(_<2)continue;const v=y.offset;if(this._context.clippingExtent!=null&&(Pr(c),ku(c,o.vertexDataES,v,_),!vp(c,this._context.clippingExtent)))continue;const w=new Array,x=v+3*_;for(let N=v;N<x;N+=3){d.offset=N;const k=lrt(d,this._context.elevationProvider,r,h);ae($n,o.vertexDataRS[N],o.vertexDataRS[N+1],o.vertexDataRS[N+2]),h.setAltitude($n,k),o.vertexDataRS[N]=$n[0],o.vertexDataRS[N+1]=$n[1],o.vertexDataRS[N+2]=$n[2],w.push(Xpt(this._upVectorAlignment))}const T=new spt(w,o.vertexDataES,o.vertexDataRS,v);SOe(T,this._upVectorAlignment,this._context.renderCoordsHelper);const S=new opt(T,this._profile,this._extruder,this._startCap,this._endCap);let C=null;if(this._fastUpdates){const N=this._fastUpdates.visualVariables,k=Ap(N.size?.field,e)??0,B=Ap(N.color?.field,e)??0,L=Ap(N.opacity?.field,e)??0;C=new dpt(S,k,B,L)}else{const N=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const L=i.size;N[0]*=nue(L[0],L[2]==="symbol-value"?this.symbolLayer.height||0:L[2],this.symbolLayer.width||0),N[1]*=nue(L[2],L[0]==="symbol-value"?this.symbolLayer.width||0:L[0],this.symbolLayer.height||0)}let k;this._drivenProperties.color&&(k=i.color),this._drivenProperties.opacity&&i.opacity!=null&&(k=k?[k[0],k[1],k[2],i.opacity]:[1,1,1,i.opacity]);const B=new dOe(S);B.bake(N),k&&B.bakeVertexColors(k),C=B}const A=C.createGeometryData(),R=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),D=new hpt(this._materials[0],A,C,l,this._stencilWidth,R);D.transformation=Kl(be(),Kr,S.path.origin),a.push(D),this.usedMemory+=S.usedMemory}if(a.length===0)return null;const f=new Jy({geometries:a,layerUid:this._context.layer.uid,graphicUid:n}),m=new Ym(this,f,a,null,null,(y,_,v,w,x)=>lft(y,_,w,x,this._upVectorAlignment),r);return m.alignedSampledElevation=0,m.needsElevationUpdates=Vv(r.mode),m}};function SOe(t,e,i){const{origin:r,positions:n}=t;let s=t.offset;switch(e){default:case _m.World:for(const o of t.vertices)$n[0]=n[s++]+r[0],$n[1]=n[s++]+r[1],$n[2]=n[s++]+r[2],i.worldUpAtPosition($n,$n),o.setFrameFromUpVector($n);break;case _m.Path:$n[0]=n[s]+r[0],$n[1]=n[s+1]+r[1],$n[2]=n[s+2]+r[2],i.worldUpAtPosition($n,$n),vpt(t,$n)}}function nue(t,e,i){switch(t){case"symbol-value":return i;case"proportional":return e;default:return t}}function aft(t,e,i,r){let n=0;const{origin:s,vertices:o,positions:a,positionsES:l}=t,c=t.offset+3*o.length;for(let h=t.offset;h<c;h+=3)ae($n,l[h],l[h+1],l[h+2]),i($n,CB),n+=CB.sampledElevation,$n[0]=a[h]+s[0],$n[1]=a[h+1]+s[1],$n[2]=a[h+2]+s[2],r.setAltitude($n,CB.z),a[h]=$n[0]-s[0],a[h+1]=$n[1]-s[1],a[h+2]=$n[2]-s[2];return t.updatePathVertexInformation(),n/o.length}function lft(t,e,i,r,n){const s=t.stageObject,o=s.geometries;let a=0;for(const l of o){if(!uOe(l))continue;const c=l.path,h=c.builder.path;a+=aft(h,e,i,r),n!==_m.World&&SOe(h,n,r),c.onPathChanged(l),l.invalidateBoundingInfo(),s.geometryVertexAttributeUpdated(l,O.POSITION)}return a/o.length}const $n=E(),CB=new XM;function cft(t,e,i,r,n=1){if(i.isGeographic&&r===Le.Global){const c=_o(e.length),h=e.length,d=Wi(i);for(let f=0;f<h;f+=3)BZ(e,f,c,f,d);e=c}mi(Cs,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let c=0;c<e.length;c+=3)Cs[0]=Math.min(Cs[0],e[c]),Cs[1]=Math.min(Cs[1],e[c+1]);const s=Cs[0]%n,o=Cs[1]%n,a=Cs[0]-s,l=Cs[1]-o;for(let c=0;c<e.length;c+=3){const h=c/3*4;t[h]=(e[c]-a)/n,t[h+1]=(e[c+1]-l)/n,t[h+2]=a/n,t[h+3]=l/n}}function EOe(t,e,i,r,n=1){ae(z1,1,0,0),ae(B1,0,1,0),ae(tS,0,0,1),hft(AB,i),C7e(sue,i)&&uft(sue,z1,B1,tS,r,AB),mi(Cs,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),mi(V1,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let h=0;h<i.length;h+=3){ae(eS,i[h],i[h+1],i[h+2]);const d=ge(z1,eS),f=ge(B1,eS);Cs[0]=Math.min(Cs[0],d),Cs[1]=Math.min(Cs[1],f),V1[0]=Math.max(V1[0],d),V1[1]=Math.max(V1[1],f)}const s=ge(tS,AB);RB(I0,Cs[0],Cs[1],s,z1,B1,tS),RB(G1,V1[0],Cs[1],s,z1,B1,tS),RB(j1,Cs[0],V1[1],s,z1,B1,tS),de(G1,G1,I0),re(G1,G1,.5),de(j1,j1,I0),re(j1,j1,.5),ue(I0,I0,G1),ue(I0,I0,j1);const o=Cs[0]%n,a=Cs[1]%n,l=Cs[0]-o,c=Cs[1]-a;for(let h=0;h<i.length;h+=3){ae(eS,i[h],i[h+1],i[h+2]);const d=h/3,f=4*d;t[f]=(ge(z1,eS)-l)/n,t[f+1]=(ge(B1,eS)-c)/n,t[f+2]=l/n,t[f+3]=c/n;const m=9*d;for(let y=0;y<3;y++)e[m+y]=I0[y],e[m+y+3]=G1[y],e[m+y+6]=j1[y]}}const AB=E(),eS=E(),sue=Ii(),z1=E(),B1=E(),tS=E(),Cs=Ge(),V1=Ge(),I0=E(),G1=E(),j1=E();function uft(t,e,i,r,n,s){n!=null?(n.basisMatrixAtPosition(s,pf),ae(DL,pf[0],pf[1],pf[2]),ae(NL,pf[4],pf[5],pf[6]),ae(OB,pf[8],pf[9],pf[10])):(ae(DL,1,0,0),ae(NL,0,1,0),ae(OB,0,0,1));const o=t;ge(o,OB)<0&&re(o,o,-1),oe(r,o);const a=ge(o,NL),l=ge(o,DL);Math.abs(a)>Math.abs(l)?(ql(e,DL,o,-l),ye(e,e),lt(i,e,o),ye(i,i),re(i,i,-1)):(ql(i,NL,o,-a),ye(i,i),lt(e,i,o),ye(e,e))}const pf=be(),DL=E(),NL=E(),OB=E();function hft(t,e){ae(zA,0,0,0);for(let i=0;i<e.length-3;i+=3)zA[0]+=e[i],zA[1]+=e[i+1],zA[2]+=e[i+2];re(t,zA,1/(e.length/3-1))}const zA=E();function RB(t,e,i,r,n,s,o){ae(t,e*n[0]+i*s[0]+r*o[0],e*n[1]+i*s[1]+r*o[1],e*n[2]+i*s[2]+r*o[2])}function dft(t){const e=new Ei,{vertex:i,fragment:r,attributes:n,varyings:s}=e;zc(i,t),e.include(Xl,t),e.include(tT,t),e.include(dy,t),e.include(qM,t),n.add(O.POSITION,"vec3"),t.vvColor&&n.add(O.COLORFEATUREATTRIBUTE,"float"),s.add("vColor","vec4"),s.add("vpos","vec3");const o=t.multipassEnabled&&(t.output===F.Color||t.output===F.Alpha);o&&s.add("depth","float"),i.uniforms.add(new yi("eColor",c=>c.color));const a=t.output===F.Depth;a&&(e.include($y,t),Sx(e),Nv(e)),i.code.add(b`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${t.hasVertexColors?"vColor *= eColor;":t.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;"}
      ${o?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${a?b`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:b`transformPosition(proj, view, vpos);`}
    }
  `),e.include(Dn,t),o&&e.include(Xc,t),r.include(Wm);const l=t.output===F.Highlight;return l&&e.include(s1,t),r.code.add(b`
  void main() {
    discardBySlice(vpos);
    ${o?"terrainDepthTest(depth);":""}
    vec4 fColor = vColor;

    ${t.output===F.ObjectAndLayerIdColor?b`fColor.a = 1.0;`:""}

    if (fColor.a < ${b.float(zo)}) {
      discard;
    }

    ${t.output===F.Alpha?b`fragColor = vec4(fColor.a);`:""}

    ${t.output===F.Color?b`fragColor = highlightSlice(fColor, vpos); ${t.transparencyPassType===it.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
    ${l?b`outputHighlight();`:""};
    ${t.output===F.Depth?b`outputDepth(linearDepth);`:""};
    ${t.output===F.ObjectAndLayerIdColor?b`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const pft=Object.freeze(Object.defineProperty({__proto__:null,build:dft},Symbol.toStringTag,{value:"Module"}));let COe=class AOe extends Fi{initializeProgram(e){return new Mi(e.rctx,AOe.shader.get().build(this.configuration),Si)}_createPipeline(e,i){const r=this.configuration,n=e===it.NONE,s=e===it.FrontFace;return Lt({blending:r.output!==F.Color&&r.output!==F.Alpha||!r.transparent?null:n?Xu:Zy(e),culling:_U(r.cullFace),depthTest:{func:o1(e)},depthWrite:(n||s)&&r.writeDepth?ec:null,colorWrite:Gt,stencilWrite:r.hasOccludees?$m:null,stencilTest:r.hasOccludees?i?Gv:a1:null,polygonOffset:n||s?r.polygonOffset?fft:null:jU(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};COe.shader=new Pi(pft,()=>ce(()=>import("./ColorMaterial.glsl-8543b1b2.js"),[],import.meta.url));const fft={factor:1,units:1};let Mo=class extends fl{constructor(){super(...arguments),this.output=F.Color,this.cullFace=xr.None,this.transparencyPassType=it.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1}};u([U({count:F.COUNT})],Mo.prototype,"output",void 0),u([U({count:xr.COUNT})],Mo.prototype,"cullFace",void 0),u([U({count:it.COUNT})],Mo.prototype,"transparencyPassType",void 0),u([U()],Mo.prototype,"hasSlicePlane",void 0),u([U()],Mo.prototype,"hasVertexColors",void 0),u([U()],Mo.prototype,"transparent",void 0),u([U()],Mo.prototype,"polygonOffset",void 0),u([U()],Mo.prototype,"enableOffset",void 0),u([U()],Mo.prototype,"writeDepth",void 0),u([U()],Mo.prototype,"hasOccludees",void 0),u([U()],Mo.prototype,"multipassEnabled",void 0),u([U()],Mo.prototype,"cullAboveGround",void 0),u([U()],Mo.prototype,"objectAndLayerIdColorInstanced",void 0),u([U()],Mo.prototype,"vvColor",void 0),u([U({constValue:!1})],Mo.prototype,"occlusionPass",void 0),u([U({constValue:!0})],Mo.prototype,"hasVvInstancing",void 0),u([U({constValue:!1})],Mo.prototype,"vvSize",void 0),u([U({constValue:!1})],Mo.prototype,"vvOpacity",void 0);let oue=class extends KQ{constructor(e){super(e,new gft),this.supportsEdges=!0,this._configuration=new Mo}getConfiguration(e,i){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._isTransparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<VU,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}produces(e,i){return i===F.Color||i===F.Alpha||i===F.Highlight||i===F.Depth&&this.parameters.writeLinearDepth||i===F.ObjectAndLayerIdColor?e===le.DRAPED_MATERIAL?!0:i===F.Highlight?e===le.OPAQUE_MATERIAL:e===(this._isTransparent?this.parameters.writeDepth?le.TRANSPARENT_MATERIAL:le.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:le.OPAQUE_MATERIAL):!1}createGLMaterial(e){return new mft(e)}createBufferWriter(){const e=Hr().vec3f(O.POSITION);return ie("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(O.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(O.COLORFEATUREATTRIBUTE):e.vec4u8(O.COLOR),new VC(e)}get _isTransparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}},mft=class extends i1{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==F.Color&&this._output!==F.Alpha||this._updateOccludeeState(e),this.ensureTechnique(COe,e)}},gft=class extends WM{constructor(){super(...arguments),this.color=Wu,this.forceTransparentMode=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=xr.None,this.hasOccludees=!1}};var Uo;(function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Cross=2]="Cross",t[t.ForwardDiagonal=3]="ForwardDiagonal",t[t.BackwardDiagonal=4]="BackwardDiagonal",t[t.DiagonalCross=5]="DiagonalCross",t[t.COUNT=6]="COUNT"})(Uo||(Uo={}));const RW=.70710678118,aue=RW,yft=.08715574274;function _ft(t){const e=new Ei,i=t.multipassEnabled&&(t.output===F.Color||t.output===F.Alpha),{vertex:r,fragment:n,attributes:s,varyings:o}=e;zc(r,t),e.include(Xl,t),e.include(tT,t),e.include(dy,t),t.draped?r.uniforms.add(new Re("worldToScreenRatio",(c,h)=>1/h.screenToPCSRatio)):s.add(O.BOUNDINGRECT,"mat3"),s.add(O.POSITION,"vec3"),s.add(O.UVMAPSPACE,"vec4"),t.vvColor&&s.add(O.COLORFEATUREATTRIBUTE,"float"),o.add("vColor","vec4"),o.add("vpos","vec3"),o.add("vuv","vec2"),i&&o.add("depth","float"),r.uniforms.add(new yi("uColor",c=>c.color));const a=t.style===Uo.ForwardDiagonal||t.style===Uo.BackwardDiagonal||t.style===Uo.DiagonalCross;a&&r.code.add(b`
      const mat2 rotate45 = mat2(${b.float(RW)}, ${b.float(-aue)},
                                 ${b.float(aue)}, ${b.float(RW)});
    `),t.draped||(Np(r,t),r.uniforms.add(new Re("worldToScreenPerDistanceRatio",(c,h)=>1/h.camera.perScreenPixelRatio)),r.code.add(b`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),r.code.add(b`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),r.code.add(b`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${b.float(yft)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),r.code.add(b`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${a?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${a?" * rotate45":""};

      ${t.draped?"":b`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${b.float(t.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);const l=t.output===F.Depth;return l&&(e.include($y,t),Sx(e),Nv(e)),r.code.add(b`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${i?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      ${t.hasVertexColors?"vColor *= uColor;":t.vvColor?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      gl_Position = ${l?b`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:b`transformPosition(proj, view, vpos);`}
    }
  `),e.include(Dn,t),n.include(Wm),t.draped&&n.uniforms.add(new Re("texelSize",(c,h)=>1/h.camera.pixelRatio)),t.output===F.Highlight&&e.include(s1,t),i&&e.include(Xc,t),t.output!==F.Highlight&&(n.code.add(b`
      const float lineWidth = ${b.float(t.lineWidth)};
      const float spacing = ${b.float(t.patternSpacing)};
      const float spacingINV = ${b.float(1/t.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),t.draped||n.code.add(b`const int maxSamples = 5;
float sampleAA(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),n.code.add(b`
    void main() {
      discardBySlice(vpos);
      ${i?"terrainDepthTest(depth);":""}
      vec4 color = vColor;
      color = highlightSlice(color, vpos);

      ${t.output!==F.Highlight?b`color.a *= ${vft(t)};`:""}

      ${t.output===F.ObjectAndLayerIdColor?b`color.a = 1.0;`:""}

      if (color.a < ${b.float(zo)}) {
        discard;
      }

      ${t.output===F.Alpha?b`fragColor = vec4(color.a);`:""}

      ${t.output===F.Color?b`fragColor = color; ${t.transparencyPassType===it.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
      ${t.output===F.Highlight?b`outputHighlight();`:""}
      ${t.output===F.Depth?b`outputDepth(linearDepth);`:""};
    }
  `),e}function vft(t){function e(i){return t.draped?b`coverage(vuv.${i}, texelSize)`:b`sampleAA(vuv.${i})`}switch(t.style){case Uo.ForwardDiagonal:case Uo.Horizontal:return e("y");case Uo.BackwardDiagonal:case Uo.Vertical:return e("x");case Uo.DiagonalCross:case Uo.Cross:return b`
        1.0 - (1.0 - ${e("x")}) * (1.0 - ${e("y")})
      `;default:return"0.0"}}const bft=Object.freeze(Object.defineProperty({__proto__:null,build:_ft},Symbol.toStringTag,{value:"Module"}));let OOe=class ROe extends Fi{initializeProgram(e){return new Mi(e.rctx,ROe.shader.get().build(this.configuration),POe)}_setPipelineState(e,i){const r=this.configuration,n=e===it.NONE,s=e===it.FrontFace;return Lt({blending:r.output===F.Color||r.output===F.Alpha?n?Xu:Zy(e):null,culling:_U(r.cullFace),depthTest:{func:o1(e)},depthWrite:n?r.writeDepth?ec:null:BU(e),colorWrite:Gt,stencilWrite:r.hasOccludees?$m:null,stencilTest:r.hasOccludees?i?Gv:a1:null,polygonOffset:n||s?r.polygonOffset?wft:null:jU(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};OOe.shader=new Pi(bft,()=>ce(()=>import("./Pattern.glsl-ae51d47f.js"),[],import.meta.url));const wft={factor:1,units:1};let Bs=class extends fl{constructor(){super(...arguments),this.output=F.Color,this.cullFace=xr.None,this.transparencyPassType=it.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.multipassEnabled=!1,this.cullAboveGround=!1,this.vvColor=!1}};u([U({count:F.COUNT})],Bs.prototype,"output",void 0),u([U({count:xr.COUNT})],Bs.prototype,"cullFace",void 0),u([U({count:Uo.COUNT})],Bs.prototype,"style",void 0),u([U({count:it.COUNT})],Bs.prototype,"transparencyPassType",void 0),u([U()],Bs.prototype,"hasSlicePlane",void 0),u([U()],Bs.prototype,"hasVertexColors",void 0),u([U()],Bs.prototype,"polygonOffset",void 0),u([U()],Bs.prototype,"writeDepth",void 0),u([U()],Bs.prototype,"hasOccludees",void 0),u([U()],Bs.prototype,"patternSpacing",void 0),u([U()],Bs.prototype,"lineWidth",void 0),u([U()],Bs.prototype,"enableOffset",void 0),u([U()],Bs.prototype,"draped",void 0),u([U()],Bs.prototype,"multipassEnabled",void 0),u([U()],Bs.prototype,"cullAboveGround",void 0),u([U()],Bs.prototype,"vvColor",void 0),u([U({constValue:!1})],Bs.prototype,"occlusionPass",void 0),u([U({constValue:!1})],Bs.prototype,"hasVvInstancing",void 0),u([U({constValue:!1})],Bs.prototype,"vvSize",void 0),u([U({constValue:!1})],Bs.prototype,"vvOpacity",void 0);const POe=new Map([[O.POSITION,0],[O.COLOR,3],[O.UVMAPSPACE,4],[O.COLORFEATUREATTRIBUTE,5],[O.BOUNDINGRECT,6]]);let xee=class extends KQ{constructor(e){super(e,new Sft),this.supportsEdges=!0,this._vertexAttributeLocations=POe,this._configuration=new Bs}getConfiguration(e,i){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<VU,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}produces(e,i){return i===F.Color||i===F.Alpha||i===F.Highlight||i===F.Depth&&this.parameters.writeLinearDepth?e===le.DRAPED_MATERIAL?!0:i===F.Highlight?e===le.OPAQUE_MATERIAL:e===(this.parameters.writeDepth?le.TRANSPARENT_MATERIAL:le.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):!1}createGLMaterial(e){return new xft(e)}createBufferWriter(){const e=Hr().vec3f(O.POSITION).vec4f(O.UVMAPSPACE);return this.parameters.draped||e.mat3f(O.BOUNDINGRECT),this.parameters.vvColor?e.f32(O.COLORFEATUREATTRIBUTE):e.vec4u8(O.COLOR),new Tft(e)}},xft=class extends i1{_updateParameters(e){return this.ensureTechnique(OOe,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==F.Color&&this._output!==F.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},Tft=class extends VC{write(e,i,r,n,s){for(const o of this.vertexBufferLayout.fields.keys()){const a=r.attributes.get(o),l=a?.indices;if(a&&l)switch(o){case O.UVMAPSPACE:{tt(a.size===4);const c=n.getField(o,Fp);c&&aC(a,c,s);break}case O.BOUNDINGRECT:{tt(a.size===9);const c=n.getField(o,Fv);c&&this.writeBoundingRect(a,e,c,s);break}default:eEe(o,a,e,i,n,s)}}}writeBoundingRect(e,i,r,n){const{data:s,indices:o}=e,a=i,l=r.typedBuffer,c=r.typedBufferStride,h=o.length;n*=c;for(let d=0;d<h;++d){const f=9*o[d],m=s[f],y=s[f+1],_=s[f+2];l[n]=a[0]*m+a[4]*y+a[8]*_+a[12],l[n+1]=a[1]*m+a[5]*y+a[9]*_+a[13],l[n+2]=a[2]*m+a[6]*y+a[10]*_+a[14];for(let v=3;v<9;++v)l[n+v]=s[f+v];n+=c}}},Sft=class extends WM{constructor(){super(...arguments),this.color=Ft(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=xr.None,this.hasOccludees=!1,this.style=Uo.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}};function Eft(t,e){const i=t?.pattern??null;return i==null?new oue(e):i.style==="none"||i.style==="solid"?(i.style==="none"&&(e.color=Ft(0,0,0,0),e.forceTransparentMode=!0),new oue(e)):(e.style=Cft(i.style),new xee(e))}function Cft(t){switch(t){case"horizontal":return Uo.Horizontal;case"vertical":return Uo.Vertical;case"cross":return Uo.Cross;case"forward-diagonal":return Uo.ForwardDiagonal;case"backward-diagonal":return Uo.BackwardDiagonal;case"diagonal-cross":return Uo.DiagonalCross;default:return}}function Aft(t){return t.material instanceof xee&&!t.material.parameters.draped}function Oft(t,e){if(Aft(t)){const i=t.attributes.get(O.POSITION).data,r=t.getMutableAttribute(O.UVMAPSPACE).data,n=t.getMutableAttribute(O.BOUNDINGRECT).data;EOe(r,n,i,e)}}function Rft(t,e,i,r,n){const s=SEe(t,e,i,r,n),o=t.stageObject.geometries;for(const a of o)Oft(a,n);return s}const Pft=["polyline","polygon","extent"],lue=new jM({size:!1,color:!0,rotation:!1,opacity:!1});let MOe=class $Oe extends Xm{constructor(e,i,r,n){super(e,i,r,n),this._needsUV=!1}async doLoad(){this._fastUpdates=sC(this._context.renderer,lue)}_createMaterials(){if(this._materials.length>0)return;const e=this.symbolLayer?.material?.color,i=this._getCombinedOpacityAndColor(e);this._materials[Rn.Fill]=Eft(this.symbolLayer,{color:i,forceTransparentMode:this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled,...this._fastUpdates?.materialParameters}),this._needsUV=this._materials[Rn.Fill]instanceof xee;const r=this.symbolLayer.outline;if(this._isValidOutline(r)){const n=w3e(r.pattern);this._materials[Rn.Outline]=new N2({width:Jn(r.size),color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:n,cap:xW(r.patternCap||"butt")})}this._context.stage.addMany(this._materials)}_isValidOutline(e){return e?.size!=null&&e.size>0&&e.color!=null&&(e.pattern==null||e.pattern.type!=="style"||e.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,Pft,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),n=this.setGraphicElevationContext(i);return this.ensureDrapedStatus(n.mode==="on-the-ground"),this._createMaterials(),this.draped?this._createAsOverlay(i,r):this._createAs3DShape(i,r,n)}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables"||!oC(this._fastUpdates,i,lue))return Kn.RecreateSymbol;this._materials[Rn.Fill]?.setParameters(this._fastUpdates.materialParameters)}return Kn.FastUpdate}layerOpacityChanged(){if(this._materials[Rn.Fill]!=null){const e=this._materials[Rn.Fill].parameters.color,i=this.symbolLayer?.material?.color,r=this._getCombinedOpacity(i);this._materials[Rn.Fill].setParameters({color:[e[0],e[1],e[2],r],forceTransparentMode:this.needsDrivenTransparentPass})}if(this._materials[Rn.Outline]!=null){const e=this._materials[Rn.Outline].parameters.color;this._materials[Rn.Outline].setParameters({color:[e[0],e[1],e[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(e,i,r){const n=this._elevationContext.mode,s=YM($Oe.elevationModeChangeTypes,r,n);if(s!==xn.UPDATE)return s;const o=cd(n);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){if(this._materials[Rn.Fill]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._materials[Rn.Outline]){const e={hasSlicePlane:this._context.slicePlaneEnabled};this._materials[Rn.Outline].setParameters(e)}return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,i,r){const n=NP(e.geometry);if(!n)return null;const s=ree(n,this._context.elevationProvider,this._context.renderCoordsHelper,r),o=new Mft(s,i,this._context.layer.uid,e.uid),a=o.renderData.position.length/3;if(this._needsUV&&(o.uvMapSpace=un(4*a,!0),o.boundingRect=_o(9*a,!0),EOe(o.uvMapSpace,o.boundingRect,o.renderData.position,this._context.renderCoordsHelper)),o.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(o),this._createAs3DShapeFill(e,o),this._materials[Rn.Outline]&&this._createAs3DShapeOutline(o),this._logGeometryCreationWarnings(o.renderData,n.rings,"rings","FillSymbol3DLayer"),o.outGeometries.length===0)return null;const l=new Jy({geometries:o.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:e.uid}),c=new Ym(this,l,o.outGeometries,null,null,Rft,r);return c.alignedSampledElevation=o.renderData.sampledElevation,c.needsElevationUpdates=cd(r.mode),c}_createAs3DShapeFill(e,i){const r=i.renderData.polygons;for(const{position:n,mapPositions:s,holeIndices:o,index:a,count:l}of r){if(this._context.clippingExtent!=null&&(Pr(Ed),ku(Ed,s),!vp(Ed,this._context.clippingExtent)))continue;const c=cot(s,o,this._context.elevationProvider.spatialReference);if(c.length===0)continue;const h=this._fastUpdates?.visualVariables.color,d=vle({material:this._materials[Rn.Fill],indices:c,mapPositions:s,attributeData:{position:n,color:h?null:i.color,colorFeature:h?Ap(h.field,e):null,uvMapSpace:this._needsUV?SF(i.uvMapSpace,4*a,4*l):null,boundingRect:this._needsUV?Xh(i.boundingRect,9*a,9*l):null,objectAndLayerIdColor:i.objectAndLayerIdColor}});i.outGeometries.push(d)}}_createAs3DShapeOutline(e){if(this._materials[Rn.Outline]==null)return;const i=e.renderData.outlines;for(const{mapPositions:r,position:n}of i){if(this._context.clippingExtent!=null&&(Pr(Ed),ku(Ed,r),!vp(Ed,this._context.clippingExtent)))continue;const s=TW(this._materials[Rn.Outline],{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:r,attributeData:{position:n}},e.objectAndLayerIdColor);e.outGeometries.push(s)}}_createAsOverlay(e,i){const r=NP(e.geometry);if(r==null)return null;this._materials[Rn.Fill].renderPriority=this._renderPriority+this._renderPriorityStep/2,this._materials[Rn.Outline]!=null&&(this._materials[Rn.Outline].renderPriority=this._renderPriority);const n=XAe(r,this._context.overlaySR),s=new $ft(n,i,this._context.layer.uid,e.uid),o=s.renderData.position.length/3;return this._needsUV&&(s.uvMapSpace=un(4*o,!0),cft(s.uvMapSpace,s.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),s.outBoundingBox=Pr(),s.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(s),this._createAsOverlayFill(e,s),this._materials[Rn.Outline]&&this._createAsOverlayOutline(s),this._logGeometryCreationWarnings(s.renderData,r.rings,"rings","FillSymbol3DLayer"),s.outGeometries.length===0?null:new a8(this,s.outGeometries,s.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(e,i){const r=i.renderData.polygons;for(const{position:n,holeIndices:s,index:o,count:a}of r){const l=Pr(Ed);if(ku(l,n),!vp(l,this._context.clippingExtent))continue;const c=uC(n,s,3);if(c.length===0)continue;jE(i.outBoundingBox,l);const h=this._fastUpdates?.visualVariables.color,d=vle({material:this._materials[Rn.Fill],indices:c,attributeData:{position:n,color:h?null:i.color,colorFeature:h?Ap(h.field,e):null,uvMapSpace:this._needsUV?SF(i.uvMapSpace,4*o,4*a):null,objectAndLayerIdColor:i.objectAndLayerIdColor}});i.outGeometries.push(new dC(d,i))}}_createAsOverlayOutline(e){if(this._materials[Rn.Outline]==null)return;const i=e.renderData.outlines;for(let r=0;r<i.length;++r){const{position:n}=i[r];if(Pr(Ed),ku(Ed,n),!vp(Ed,this._context.clippingExtent))continue;jE(e.outBoundingBox,Ed);const s=TW(this._materials[Rn.Outline],{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:n}},e.objectAndLayerIdColor);e.outGeometries.push(new dC(s,e))}}_getOutlineOpacity(){const e=this.symbolLayer?.outline?.color;return(this.draped?1:this._getLayerOpacity())*(e!=null?e.a:0)}_getOutlineColor(){const e=this.symbolLayer?.outline?.color,i=this._getOutlineOpacity();return gR(e!=null?Pe.toUnitRGB(e):null,i)}test(){return{...super.test(),createAsOverlay:(e,i)=>this._createAsOverlay(e,i),createAs3DShape:(e,i,r)=>this._createAs3DShape(e,i,r)}}};MOe.elevationModeChangeTypes={definedChanged:xn.RECREATE,staysOnTheGround:xn.NONE,onTheGroundChanged:xn.RECREATE};const Ed=ks();let Mft=class extends s8{constructor(e,i,r,n){super(e,r,n),this.color=i}},$ft=class extends s8{constructor(e,i,r,n){super(e,r,n),this.color=i}};var Rn;(function(t){t[t.Fill=0]="Fill",t[t.Outline=1]="Outline"})(Rn||(Rn={}));let IOe=class{constructor(e,i="center",r=!1,n=Ge(),s=Ft(0,0,0,-1),o="world",a=E(),l=0){this.verticalOffset=e,this.anchor=i,this.hasLabelVerticalOffset=r,this.screenOffset=n,this.centerOffset=s,this.centerOffsetUnits=o,this.translation=a,this.elevationOffset=l}},LOe=class{constructor(e,i="center",r="center",n=null,s=Ge()){this.placement=e,this.horizontalPlacement=i,this.verticalPlacement=r,this.text=n,this.displaySize=s}};const Ift="arial-unicode-ms",cue="woff2",uue=new Map,DOe=new Set;let Lft=class{constructor(e,i){this.fontFace=e,this.promise=i}};async function Dft(t){const e=kft(t),i=uue.get(e);if(i)return i.promise;const r=new FontFace(t.family,`url('${Di.fontsUrl}/woff2/${e}.${cue}') format('${cue}')`,{style:t.style,weight:t.weight}),n=document.fonts;if(n.has(r)&&r.status==="loading")return r.loaded;const s=r.load().then(()=>(n.add(r),r));return uue.set(e,new Lft(r,s)),DOe.add(r),s}function Nft(t){return DOe.has(t)}function Fft(t){if(!t)return Ift;const e=t.toLowerCase().split(" ").join("-");switch(e){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return e}}function kft(t){const e=Uft(t)+zft(t);return Fft(t.family)+(e.length>0?e:"-regular")}function Uft(t){if(!t.weight)return"";switch(t.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function zft(t){if(!t.style)return"";switch(t.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}let NOe=class FOe{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=this._colorToRGBA(e.color),this.haloStyle=this._colorToRGB(e.halo.color),this.backgroundStyle=e.background.color[3]!==0?this._colorToRGBA(e.background.color):null}fontString(e){const i=this.definition.font,r="sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji";return`${i.style} ${i.weight} ${e}px ${i.family}, ${r}`}setFontProperties(e,i){e.font=this.fontString(i),e.textAlign="left",e.textBaseline="alphabetic"}_colorToRGB(e){return`rgb(${e.slice(0,3).map(i=>Math.floor(255*i)).toString()})`}_colorToRGBA(e){return`rgba(${e.slice(0,3).map(i=>Math.floor(255*i)).toString()},${e[3]})`}static async fromSymbol(e,i){const r=e?.material?.color,n=Pe.toUnitRGBA(r)??Wu,s=e.size!=null?Jn(e.size):12,o=e.lineHeight,a=e.background!=null?Pe.toUnitRGBA(e.background.color):Wu,l={family:e.font?.family??"sans-serif",decoration:e.font?.decoration??"none",weight:e.font?.weight??"normal",style:e.font?.style??"normal"},c=e.halo,h=c?.color!=null&&c.size>0?{size:Jn(c.size),color:Pe.toUnitRGBA(c.color)}:{size:0,color:Wu},d=new FOe({color:n,size:s,background:{color:a,padding:e.background!=null?[.65*s,.5*s]:[0,0],borderRadius:e.background!=null?s*(6/16):0},lineSpacingFactor:o,font:l,halo:h,pixelRatio:i});if(e.font){let f=!1;const m=d.fontString(s);try{f=(await document.fonts.load(m)).some(y=>!Nft(y))}catch{K.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${m}'. Some text symbology may be rendered using the default browser font.`)}if(!f&&!Bft.has(e.font.family))try{await Dft(e.font)}catch{}}return d}};const Bft=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),L0=4096;let Lw=class extends we{constructor(e){super(e),this.type=wn.Texture,this.id=zu(),this.events=new Sn,this._glTexture=null,this._atlas=new jft(256,256),this._needsRepack=!1,this._canRepack=!0,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view._stage,this._stage.add(this),this._updateCanvasElementSize(this._atlas),this._reset()}unload(){this._glTexture=rt(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get glTexture(){return this._glTexture}static get maxSize(){return RR=0,[L0-D0-RR,L0-D0-RR-hue]}load(e){if(this._glTexture)return this._glTexture;const i=new Hi;return i.wrapMode=Vt.CLAMP_TO_EDGE,i.samplingMode=zt.LINEAR_MIPMAP_LINEAR,i.hasMipmap=!0,i.preMultiplyAlpha=!0,i.maxAnisotropy=e.parameters.maxMaxAnisotropy,this._glTexture=new Nt(e,i,this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(pt.TEXT_TEXTURE_ATLAS,this),this.setDirty(),this._glTexture}dispose(){this._elements.clear(),this._elementsToRender.clear(),this._frameWorker=Tr(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=rt(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(e){this._canvas.setAttribute("width",e.width.toString()),this._canvas.setAttribute("height",e.height.toString())}_resizeAtlas(e,i){const{width:r,height:n}=this._atlas;r===e&&n===i||(this._atlas.width=e,this._atlas.height=i,this._glTexture?.resize(e,i),this._glTexture?.updateData(0,0,0,r,n,this._canvas),this._updateCanvasElementSize(this._atlas),this._elements.forEach(s=>{this._stageObjects.get(s.textRenderer.key)?.forEach(a=>PB(a,s))}),this._reset())}_reset(){this._elementsToRender.clear(),this._atlas.reset(),this._needsRepack=!0,this.setDirty()}_addAtlasElement(e,i,r,n){const s=this._atlas;if(s.width<r||s.height<n)return!1;let o=s.cursors.get(n);if(!o){if(s.height<s.nextY+n)return!1;o=[new due(s.nextY)],s.cursors.set(n,o),s.nextY+=n}let a=o.find(l=>s.width>=l.x+r);if(a==null){if(s.height<s.nextY+n)return!1;a=new due(s.nextY),s.nextY+=n,o.push(a)}return e.setNewPosition(a),this._elements.set(i,e),this._elementsToRender.set(i,e),a.x+=r,!0}_ensureStageObjects(e){const i=this._stageObjects.get(e);if(i)return i;const r=new Set;return this._stageObjects.set(e,r),r}_addStageObject(e,i){this._ensureStageObjects(e).add(i)}_removeStageObject(e,i){this._stageObjects.get(e)?.delete(i)&&(i.geometries[0].setAttributeData(O.SIZE,[0,0]),i.geometryVertexAttributeUpdated(i.geometries[0],O.SIZE),this._elementsToRender.delete(e))}_processAddition(e){const i=e.textRenderer.key;if(this._needsRepack)return void this._elements.set(i,e);const r=this._atlas,n=e.textRenderer.renderedWidth,s=e.textRenderer.renderedHeight,o=n+D0,a=s+D0+hue;if(!this._addAtlasElement(e,i,o,a)){if(this._canRepack)this._reset();else if(r.width<o){const l=Math.min(Ww(Math.max(o,1.5*r.width)),L0);this._resizeAtlas(l,r.height)}else{const l=r.nextY+a,c=Math.min(Ww(Math.max(l,1.5*r.height)),L0);if(c>r.height)this._resizeAtlas(r.width,c);else if(r.width<L0){const h=Math.min(Ww(1.5*r.width),L0);this._resizeAtlas(h,r.height)}}this._elements.set(i,e)}}_renderElement(e){const i=e.commitNewPosition();this._ctx.clearRect(i[0]-D0,i[1]-D0,e.textRenderer.renderedWidth+2*D0,e.textRenderer.renderedHeight+2*D0),e.textRenderer.render(this._ctx,i[0],i[1]),this._stageObjects.get(e.textRenderer.key)?.forEach(n=>PB(n,e))}get running(){return this.updating}runTask(e){if(this._glTexture==null)return ca.YIELD;for(;this._needsRepack&&(this._canRepack||this._atlas.height<L0&&this._atlas.height<L0);){this._canRepack=this._needsRepack=!1;const i=this._elements;this._elements=new Map,i.forEach(r=>this._processAddition(r)),e.madeProgress()}if(this._elementsToRender.size>0){for(const[i,r]of this._elementsToRender){if(e.done)break;this._renderElement(r),this._elementsToRender.delete(i),e.madeProgress()}this._glTexture.setData(this._canvas)}this.updating=this._elementsToRender.size>0}addTextTexture(e,i){const r=e.key;this._addStageObject(r,i);let n=this._elements.get(r);n==null&&(n=new Gft(this._atlas,e),this._processAddition(n),this.setDirty()),Vft(i,n),PB(i,n)}removeTextTexture(e,i){const r=e.key;if(!this._elements.get(r))return;this._removeStageObject(r,i);const n=this._stageObjects.get(r);n&&n.size!==0||this._elements.delete(r),n?.size===0&&this._stageObjects.delete(r),this._canRepack=!0}setDirty(){this._glTexture&&(this.updating=!0)}get test(){const{_elements:e,_stageObjects:i,_atlas:r}=this,n=this;return{elements:e,stageObjects:i,atlas:r,resizeAtlas:(s,o)=>n._resizeAtlas(s,o),run:s=>n.runTask(s)}}};function Vft(t,e){t.geometries[0].setAttributeData(O.SIZE,[e.textRenderer.displayWidth,e.textRenderer.displayHeight]),t.geometryVertexAttributeUpdated(t.geometries[0],O.SIZE)}function PB(t,e){t.geometries[0].setAttributeData(O.UV0,e.uv),t.geometryVertexAttributeUpdated(t.geometries[0],O.UV0,!0)}u([p({constructOnly:!0})],Lw.prototype,"view",void 0),u([p({type:Boolean})],Lw.prototype,"updating",void 0),Lw=u([M("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],Lw);const D0=2,hue=2;let Gft=class{constructor(e,i){this._atlas=e,this.textRenderer=i,this._uv=oi(),this._newPosition=[0,0]}get uv(){if(this._xOffset==null||this._yOffset==null)return Wu;const{renderedWidth:e,renderedHeight:i}=this.textRenderer;return Gr(this._uv,this._xOffset/this._atlas.width,(this._yOffset+i)/this._atlas.height,(this._xOffset+e)/this._atlas.width,this._yOffset/this._atlas.height)}setNewPosition(e){this._newPosition[0]=e.x,this._newPosition[1]=e.y}commitNewPosition(){return this._xOffset=this._newPosition[0],this._yOffset=this._newPosition[1],this._newPosition}get xOffset(){return this._xOffset}get yOffset(){return this._yOffset}},jft=class{constructor(e,i){this.width=e,this.height=i,this.cursors=new Map,this.nextY=0}reset(){this.cursors.clear(),this.nextY=RR}},due=class{constructor(e){this.y=e,this.x=RR}},RR=0,Hft=class{constructor(e,i,r){this._renderer=new p3e(e,i,r,Lw.maxSize)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const e=rk(qft,this._renderer.renderedWidth,this._renderer.renderedHeight),i=e.getContext("2d");return i.save(),this._renderer.render(i,0,0),i.restore(),new iT(e,{wrap:{s:Vt.CLAMP_TO_EDGE,t:Vt.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0})}};const qft={canvas:null},Wft=[0,0,1];let Yft=class extends Xm{constructor(e,i,r,n){super(e,i,r,n),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=qU(this.symbolLayer.size);if(e)throw new G("graphics3dtextsymbollayer:invalid-size",e)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await NOe.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const i=e.graphic,r=LP(i.geometry);if(r==null)return this.logger.warn(`unsupported geometry type for text symbol: ${i.geometry.type}`),null;const n=this.symbolLayer.text;if(n==null||n==="")return null;const s=TJ(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(s!=null&&!D1e(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const{verticalAlignment:o}=this.symbolLayer,a=new IOe(s);Jct(o,a.screenOffset);const l=new LOe(a,this.symbolLayer.horizontalAlignment,Zct(o));return this._createAs3DShape(i,r,n,l)}createLabel(e,i,r,n,s){const o=e.graphic,a=LP(o.geometry);if(a==null)return this.logger.warn(`unsupported geometry type for label: ${o.geometry.type}`),null;const l=i.text;return!l||/^\s+$/.test(l)?null:this._createAs3DShape(o,a,l,i,r,n,s)}setGraphicElevationContext(e,i,r=0){return super.setGraphicElevationContext(e,i),i.addOffsetRenderUnits(r),i}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,i){return pue(e,i,(r,n)=>{this.updateGraphicElevationContext(n,r)}),xn.UPDATE}slicePlaneEnabledChanged(e,i){return pue(e,i,r=>{for(const n of r.stageObject.geometries)n.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return!1}updateGraphicElevationContext(e,i){const r=i.elevationContext;this.setGraphicElevationContext(e,r,i.metadata!=null?i.metadata.elevationOffset:0),i.needsElevationUpdates=cd(r.mode)||r.mode==="absolute-height"}_defaultElevationInfoNoZ(){return Zft}_createAs3DShape(e,i,r,n,s=null,o=null,a=()=>n.placement.elevationOffset){const l=this.setGraphicElevationContext(e,new jF,n.placement.elevationOffset),c=e.geometry?.type==="polyline",h=e.uid;let d=null,f=null;if(o==null){const N=m3e(n.horizontalPlacement);d=new Hft(r,N,this._textRenderParameters);let k=null;if(this._context.sharedResources.textures!=null){f=this._context.sharedResources.textures.fromData(d.key,()=>d.create()),f.texture.events.on("unloaded",()=>k?.release());const B=this._context.stage.renderView.textureRepository.acquire(f.texture.id);if(B==null||Zc(B))return f.release(),null;k=B}}const m=Xft(d,n),y={occlusionTest:!0,screenOffset:n.placement.screenOffset,anchorPosition:m,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:n.placement.centerOffsetUnits,drawInSecondSlot:!0};if(o?y.textureId=o.id:f&&(y.textureId=f.texture.id),n.placement.verticalOffset!=null){const{screenLength:N,minWorldLength:k,maxWorldLength:B}=n.placement.verticalOffset;y.verticalOffset={screenLength:Jn(N),minWorldLength:k||0,maxWorldLength:B??1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:N,screenSizePerspectiveSettingsLabels:k}=this._context.sharedResources,B=d3e(this._textRenderParameters);y.screenSizePerspective=k.overrideFontHeight(B.maxHeight),y.screenSizePerspectiveAlignment=N}c&&(y.shaderPolygonOffset=1e-4),y.hasSlicePlane=this._context.slicePlaneEnabled;const _=(N,k)=>{const B=JSON.stringify(k);let L=N.get(B);return L==null&&(L=new lC(k),N.add(B,L)),L},v=s?_(s,y):new lC(y),w=n.placement.translation,x=d?pi(d.displayWidth,d.displayHeight):Ey,T=n.placement.centerOffset,S=Eq(v,Wft,w,null,x,T,[0,0],null),C=LQ(this._context,i,S,l,h);if(C==null)return null;const A=(N,k,B,L,z,j)=>{const H=a()||n.placement.elevationOffset,X=this.setGraphicElevationContext(e,k,H);return Xw(N,X,B,L,z,j)},R=new Ym(this,C.object,[S],s==null?[v]:null,f,A,l);R.alignedSampledElevation=C.sampledElevation,R.needsElevationUpdates=cd(l.mode)||l.mode==="absolute-height",R.getScreenSize=(N=Ge())=>(N[0]=d?d.displayWidth:n.displaySize[0],N[1]=d?d.displayHeight:n.displaySize[1],N);const D=new MEe(n.placement.elevationOffset,r);return R.metadata=D,IP(R,i,this._context.elevationProvider),R}};function pue(t,e,i){t&&t.forEach(r=>{const n=e(r);n!=null&&i(n,r.graphic)})}function Xft(t,e){if(e.verticalPlacement==="baseline"){const r=Wct[e.horizontalPlacement],n=t!=null?t.baselineAnchorY:0;return pi(r,n)}const i=Xct(e.horizontalPlacement,e.verticalPlacement);return y4[i]}const Zft={mode:"relative-to-ground",offset:0},Jft={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},Kft=["polyline","polygon","extent"];let PW=class kb extends Xm{constructor(e,i,r,n){super(e,i,r,n)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,Kft,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(i):this._createAs3DShape(i,r,i.uid)}ensureMaterial(){if(this._materials[0])return;const e=new GAe,i=this.symbolLayer.color;i!=null&&(e.color=Pe.toUnitRGBA(i));const r=this._getCombinedOpacity(i,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],r],e.transparent=r<1||this.needsDrivenTransparentPass,e.waveDirection=this.symbolLayer.waveDirection!=null?kb.headingVectorFromAngle(this.symbolLayer.waveDirection):pi(0,0);const n=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,s=Jft[n];e.waveStrength=s.waveStrength,e.waveTextureRepeat=s.textureRepeat,e.waveVelocity=s.waveVelocity,e.flowStrength=s.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.isDraped=this.draped,this._materials[0]=new VAe(e),this._context.stage.add(this._materials[0])}layerOpacityChanged(){if(this._materials[0]==null)return;const e=this._materials[0].parameters.color,i=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),r=i<1||this.needsDrivenTransparentPass;this._materials[0].setParameters({color:[e[0],e[1],e[2],i],transparent:r})}layerElevationInfoChanged(e,i,r){const n=this._elevationContext.mode,s=YM(kb.elevationModeChangeTypes,r,n);if(s!==xn.UPDATE)return s;const o=cd(n);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,i,r){const n=NP(e.geometry);if(n==null)return null;const s=ree(n,this._context.elevationProvider,this._context.renderCoordsHelper,i),o=s.position.length/3,a=_o(2*o);this._createUVCoordsFromVertices(a,s.mapPositions,o,this._context.elevationProvider.spatialReference);const l=new Qft(s,a,this._context.layer.uid,e.uid);if(l.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(l),this._create3DShapeGeometries(l),this._logGeometryCreationWarnings(l.renderData,n.rings,"rings","WaterSymbol3DLayer"),l.outGeometries.length===0)return null;const c=new Jy({geometries:l.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:r}),h=new Ym(this,c,l.outGeometries,null,null,SEe,i);return h.alignedSampledElevation=l.renderData.sampledElevation,h.needsElevationUpdates=cd(i.mode),h}_createUVCoordsFromVertices(e,i,r,n){const s=Da(n);id(N0);for(let l=0;l<r;l++)mi(fue,i[3*l],i[3*l+1]),AZ(N0,fue);dx(N0,N0,s);const o=N0[0]%kb.unitSizeOfTexture,a=N0[1]%kb.unitSizeOfTexture;FL[0]=N0[0]-o,FL[1]=N0[1]-a;for(let l=0;l<r;l++)e[2*l]=(i[3*l]*s-FL[0])/kb.unitSizeOfTexture,e[2*l+1]=(i[3*l+1]*s-FL[1])/kb.unitSizeOfTexture}_create3DShapeGeometries(e){const i=e.renderData.polygons,r=e.uvCoords;for(const{count:n,index:s,position:o,mapPositions:a,holeIndices:l}of i){if(this._context.clippingExtent!=null&&(Pr(H1),ku(H1,a),!vp(H1,this._context.clippingExtent)))continue;const c=uC(a,l,3);if(c.length===0)continue;const h=Xh(r,2*s,2*n),d=ble({material:this._materials[0],indices:c,mapPositions:a,attributeData:{position:o,uv0:h}},e.objectAndLayerIdColor);e.outGeometries.push(d)}}_createAsOverlay(e){const i=NP(e.geometry);if(i==null)return null;this._materials[0].renderPriority=this._renderPriority;const r=XAe(i,this._context.overlaySR),n=r.position.length/3,s=_o(2*n);this._createUVCoordsFromVertices(s,r.position,n,this._context.overlaySR);const o=new emt(r,s,this._context.layer.uid,e.uid);return o.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(o),o.outBoundingBox=Pr(),this._createAsOverlayWater(o),this._logGeometryCreationWarnings(o.renderData,i.rings,"rings","WaterSymbol3DLayer"),o.outGeometries.length===0?null:new a8(this,o.outGeometries,o.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(e){const i=e.uvCoords,r=e.renderData.polygons;for(const{position:n,holeIndices:s,index:o,count:a}of r){if(Pr(H1),ku(H1,n),!vp(H1,this._context.clippingExtent))continue;jE(e.outBoundingBox,H1);const l=uC(n,s,3);if(l.length===0)continue;const c=Xh(i,2*o,2*a),h=ble({material:this._materials[0],indices:l,attributeData:{position:n,uv0:c}},e.objectAndLayerIdColor);e.outGeometries.push(new dC(h,e))}}static headingVectorFromAngle(e){const i=Ge(),r=v6(e);return i[0]=Math.sin(r),i[1]=Math.cos(r),i}test(){return{...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}};PW.unitSizeOfTexture=100,PW.elevationModeChangeTypes={definedChanged:xn.RECREATE,staysOnTheGround:xn.NONE,onTheGroundChanged:xn.RECREATE};const FL=Ge(),N0=Zt(),fue=Ge(),H1=ks();let Qft=class extends s8{constructor(e,i,r,n){super(e,r,n),this.uvCoords=i}},emt=class extends s8{constructor(e,i,r,n){super(e,r,n),this.uvCoords=i}};function tmt(t,e,i,r){const n=rmt[t.type]?.[e.type]||imt[e.type];return n?new n(t,e,i,r):(K.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${e.type}`),null)}const imt={icon:wW,object:npt,line:x3e,path:oft,fill:MOe,extrude:Dlt,text:Yft,water:PW},rmt={"mesh-3d":{fill:wht}};let nmt=class extends IQ{set symbol(e){this._symbol=e,e.symbolLayers.forEach((i,r)=>{const n=this.symbolLayers[r];n!=null&&(n.symbol=e,n.symbolLayer=i)})}get symbol(){return this._symbol}constructor(e,i,r){super(i.schedule),this._symbol=e,this._context=i,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let i=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(i=this._backgroundLayers.concat(i));const r=i.length;for(;this.symbolLayers.length<i.length;)this.symbolLayers.push(null);this.symbolLayers.length=i.length;const n=[];for(let s=0;s<r;s++){const o=i.at(s);if(o.enabled===!1)continue;kL.renderPriority=1-(1+s)/r,kL.renderPriorityStep=1/r,kL.ignoreDrivers=o.ignoreDrivers;const a=tmt(this.symbol,o,this._context,kL),l=sM(e,()=>{this.symbolLayers[s]=null,a.destroy()});l&&n.push(l),this.symbolLayers[s]=a}if(await f6(this.symbolLayers,async(s,o)=>{if(s!=null)try{await s.load(),this._extentPadding+=Math.max(this._extentPadding,s.extentPadding)}catch{this.symbolLayers[o]=null}}),n.forEach(s=>s.remove()),Tt(e),this.symbolLayers.length&&!this.symbolLayers.some(s=>!!s))throw new Error}getSymbolLayerSize(e){const i=this.symbolLayers[e];return i!=null?i.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>e?.queryForSnapping)}createGraphics3DGraphic(e,i){const r=e.graphic,n=this.symbolLayers.map(o=>o?.createGraphics3DGraphic(e)??null),s=this._context.arcade||this._context.featureExpressionInfoContext?.arcade?.modules||null;return new zst(r,i||this,n,e.layer,s)}get complexity(){return $Q(this.symbolLayers.map(e=>e!=null?e.complexity:null))}globalPropertyChanged(e,i){const r=this.symbolLayers.length;for(let n=0;n<r;n++){const s=this.symbolLayers[n],o=a=>{const l=a.layers[n];return l instanceof Ym?l:null};if(s!=null&&!s.globalPropertyChanged(e,i,o))return!1}return!0}applyRendererDiff(e,i){return this.loadStatus!==Ru.LOADED?Kn.RecreateSymbol:this.symbolLayers.reduce((r,n)=>r!==Kn.RecreateSymbol&&n!=null?Math.min(r,n.applyRendererDiff(e,i)):r,Kn.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===Ru.FAILED||e.diff.type!=="partial")return;const i=e.diff.diff;if(!i.symbolLayers||i.symbolLayers.type!=="partial")return;const r=i.symbolLayers.diff;this.symbolLayers.forEach((n,s)=>{if(n==null)return;const o=r[s];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};n.prepareSymbolLayerPatch(a),e.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,c)=>{const h=l.layers[s];h!=null&&a.graphics3DGraphicPatches.forEach(d=>d(h,c))})}})}updateGeometry(e,i){return this._updateGeometryOrTransform(e,(r,n)=>r.updateGeometry(n,i))}updateTransform(e,i,r,n){return this._updateGeometryOrTransform(e,(s,o)=>s.updateTransform(o,i,r,n))}_updateGeometryOrTransform(e,i){for(let r=0;r<this.symbolLayers.length;r++){const n=this.symbolLayers[r];if(n==null)continue;const s=e.layers[r];if(!s||!i(n,s))return!1}return!0}onRemoveGraphic(e){for(let i=0;i<this.symbolLayers.length;i++){const r=this.symbolLayers[i];if(r==null)continue;const n=e.layers[i];n!=null&&r.onRemoveGraphic(n)}}getFastUpdateStatus(){let e=0,i=0,r=0;return this.symbolLayers.forEach(n=>{n!=null&&(n.loadStatus===Ru.LOADING?e++:n.isFastUpdatesEnabled()?r++:i++)}),{loading:e,slow:i,fast:r}}async queryForSnapping(e,i,r,n){const s=this.symbolLayers.filter(Yv).filter(a=>a.queryForSnapping!=null).map(a=>a.queryForSnapping(e,i,r,n)),o=await Promise.all(s);return Tt(n),o.flat()}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const e of this.symbolLayers)e?.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}};const kL=new Bst;let smt=class extends IQ{constructor(e,i,r){super(i),this.symbol=e,this._convert=r,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const i=await this.symbol.fetchSymbol({signal:e});i.id=this.symbol.id,this.graphics3DSymbol=this._convert(i),this.graphics3DSymbol!=null&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.complexity:hCe}globalPropertyChanged(e,i){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.globalPropertyChanged(e,i)}applyRendererDiff(e,i){return this.graphics3DSymbol!=null?this.graphics3DSymbol.applyRendererDiff(e,i):Kn.RecreateSymbol}prepareSymbolPatch(e){this.graphics3DSymbol!=null&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,i){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.updateGeometry(e,i)}updateTransform(e,i,r,n){return this.graphics3DSymbol?.updateTransform(e,i,r,n)??!1}onRemoveGraphic(){}getFastUpdateStatus(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){this.graphics3DSymbol!=null&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}};function Tee(t){return t instanceof smt?t.graphics3DSymbol:t instanceof nmt?t:null}const zP=K.getLogger("esri.views.3d.layers.graphics.labelPlacement");let omt=class{constructor(e,i,r,n=null){this.graphics3DGraphic=e,this.labelSymbol=i,this.labelClass=r,this.disablePlacement=n}};function mue(t){const e=mmt(t);if(e==null)return null;const i=amt(t,e);if(i==null)return null;const r=i.anchor,n=!!e.hasLabelVerticalOffset,s=e.verticalOffset;return cmt(new IOe(s,r,n),i,t)}function amt(t,e){if(e.anchor)return e;const i=t.labelClass.labelPlacement,r=xp[i],n=r||uk(t);return i&&!r&&zP.warnOncePerTick(`the requested label placement '${i}' is currently unsupported in SceneView.`),lmt(n,t)}function See(t){const e=t.graphics3DGraphic.graphics3DSymbol,i=Tee(e);return i!=null?i.symbol.symbolLayers.at(0):null}function lmt(t,e){const i=e.graphics3DGraphic.graphic.geometry;if(i==null)return null;if(e.disablePlacement!=null)return e.labelClass.labelPlacement?(zP.warnOncePerTick(gue(t?.placement,e.disablePlacement.logEntityDescription)),uk(e)):t;const r=i.type;switch(r){case"polyline":case"polygon":case"extent":case"multipoint":if(e.labelClass.labelPlacement)return zP.warnOncePerTick(gue(t?.placement,`'${r}' geometries`)),uk(e);break;case"point":case"mesh":return t}return t}function gue(t,e){return`the requested label placement '${t}' is currently unsupported for ${e} in SceneView.`}function uk(t){const e=t.graphics3DGraphic.graphic.geometry;if(e==null)return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:vo,anchor:"center"};case"polygon":{const i=See(t);return i!=null&&i.type==="extrude"?xp["above-center"]:{placement:"center-center",normalizedOffset:vo,anchor:"center"}}case"point":case"mesh":return xp["above-center"];default:return}}function cmt(t,e,i){const r=i.graphics3DGraphic.graphic.geometry;if(r==null)return null;switch(r.type){case"point":hmt(t,e,i);break;case"polygon":umt(t,e,i);break;case"mesh":Eee(t,e,i.graphics3DGraphic.layers[0])}const n=Bct-nk;return t.screenOffset[0]+=n*e.normalizedOffset[0],t.screenOffset[1]+=n*e.normalizedOffset[1],t}function umt(t,e,i){const r=See(i);if(r!=null)switch(r.type){case"extrude":{const n=i.graphics3DGraphic.layers[0];n!=null?(n.getBoundingBoxObjectSpace(PR),_p(PR,t.translation),t.translation[2]=Kv(PR)/2):ae(t.translation,0,0,0),Eee(t,e,n);break}}}function hmt(t,e,i){const r=See(i);if(r==null)return;const n=i.graphics3DGraphic.layers[0];switch(n!=null?n.getCenterObjectSpace(t.translation):ae(t.translation,0,0,0),r.type){case"icon":case"text":dmt(t,e,i,n);break;case"object":Eee(t,e,n)}}function dmt(t,e,i,r){const{graphics3DGraphic:n}=i,s=r!=null?r.getScreenSize():null;if(n.isDraped||s==null)t.hasLabelVerticalOffset||t.anchor==="center"||(xp[i.labelClass.labelPlacement]&&zP.warnOncePerTick(`the requested placement '${e.placement}' is currently unsupported for draped graphics`),t.anchor="center");else{const o=pmt(i);t.screenOffset[0]=s[0]/2*(e.normalizedOffset[0]-o[0]);const a=s[1]/2*(e.normalizedOffset[1]-o[1]);t.hasLabelVerticalOffset?(t.centerOffset[1]=a,t.centerOffsetUnits="screen"):t.screenOffset[1]=a}}function pmt(t,e=gmt){const{graphics3DGraphic:i}=t,r=i.layers[0],n=r?.stageObject.geometries[0].material??null;if(n&&n instanceof lC){const s=n.parameters.anchorPosition;e[0]=2*(s[0]-.5),e[1]=2*(s[1]-.5)}else e[0]=0,e[1]=0;return e}function Eee(t,e,i){const r=i!=null?i.getBoundingBoxObjectSpace(PR):PR,n=Oe(r[3]-r[0],r[4]-r[1],r[5]-r[2]),s=Math.sqrt(n[0]*n[0]+n[1]*n[1]);t.centerOffset[0]=s/2*e.normalizedOffset[0];const o=t.translation[2],a=n[2]/2*e.normalizedOffset[1];t.translation[2]=0,t.elevationOffset=o+a;const l=xe(n);t.centerOffset[2]=l/2*e.normalizedOffset[2]}function fmt(t){return t==="above-center"}function mmt(t){const e=t.labelClass.labelPlacement,{labelSymbol:i,graphics3DGraphic:r}=t,n=Tee(r.graphics3DSymbol),s=n?.symbol.type==="point-3d"?n.symbol:null,o=xp[e]||uk(t);return s!=null&&s.supportsCallout()&&s.hasVisibleVerticalOffset()&&!r.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:yue(s.verticalOffset),anchor:null,normalizedOffset:null}:!i||!i.hasVisibleVerticalOffset()||s!=null&&s.supportsCallout()&&s.verticalOffset&&!r.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:o&&fmt(o.placement)?{placement:"above-center",verticalOffset:yue(i.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(zP.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null)}function yue(t){const{screenLength:e,minWorldLength:i,maxWorldLength:r}=t;return{screenLength:e,minWorldLength:i,maxWorldLength:r}}const xp={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},_ue={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in _ue){const e=_ue[t],i=xp[t];e.forEach(r=>{xp[r]=i})}Object.freeze&&(Object.freeze(xp),Object.keys(xp).forEach(t=>{Object.freeze(xp[t]),Object.freeze(xp[t]?.normalizedOffset)}));const gmt=[0,0],PR=ks();let vue=class{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,i){this._materials.set(e,i),this._stage.add(i)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}},bue=class{constructor(e,i){this.labelingContext=e,this.graphics3DGraphic=i,this.hasGraphics3DResources=!1,this.visible=!1,this.addedToTextureAtlas=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},ymt=class{constructor(e,i,r,n,s){this.labelClass=e,this.graphics3DSymbol=i,this.graphics3DCalloutSymbolLayer=r,this.textRenderParameters=n,this.labelFunction=s,this.calloutSymbolLayerIndex=0}},_mt=class{constructor(e,i,r,n,s,o,a,l){this.layer=i,this.graphics3DCore=r,this.scaleVisibility=n,this.emptySymbolLabelSupported=s,this.elevationInfoOverride=o,this.disablePlacement=a,this.active=l,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new pAe(e,{pickable:!0,disableOctree:!0},i.uid)}destroy(){this.stageLayer.destroy()}},Ub=class extends we{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this.addHandles([ne(()=>this.view.state?.camera,()=>this.setDirty()),ne(()=>this.view.state?.rasterPixelRatio,()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(pt.LABELER,this)]),this._textTextureAtlas=new Lw({view:this.view}),this._hudMaterialCollection=new vue(this.view._stage),this._calloutMaterialCollection=new vue(this.view._stage)}dispose(){this.removeAllHandles(),this._textTextureAtlas=rt(this._textTextureAtlas),this._hudMaterialCollection=rt(this._hudMaterialCollection),this._calloutMaterialCollection=rt(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear()}destroy(){this.dispose(),Cd.graphic=null,Cd.renderingInfo=null,Cd.layer=null}_activateLabelingContext(e){e.graphics.forEach((i,r)=>{const n=new bue(e,i);this._labels.set(r,n),e.labelsToInitialize.set(r,n),i.setVisibilityFlag(mo.LABEL,sa.USER,!0)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((i,r)=>{i.setVisibilityFlag(mo.LABEL,sa.USER,!1),this.setLabelGraphicVisibility(i,!1),this._labels.delete(r)}),e.active=!1}_addLabelTextureToAtlas(e){for(const i of e.graphics3DGraphic.labelLayers){if(!i._labelClass)continue;const r=e.textRenderers[i._labelIndex];r&&(this._textTextureAtlas.addTextTexture(r,i.stageObject),e.addedToTextureAtlas=!0)}}_removeLabelTextureFromAtlas(e){for(const i of e.graphics3DGraphic.labelLayers){if(!i._labelClass)continue;const r=e.textRenderers[i._labelIndex];r!=null&&(this._textTextureAtlas.removeTextTexture(r,i.stageObject),e.addedToTextureAtlas=!1)}}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),ca.YIELD}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const i of this._labelingContexts)if(i.active)if(MB(i))this._dirty=!0;else if($B(i.labelClassContexts)){if(i.labelClassContexts===null){this._deactivateLabelingContext(i);continue}this._createLabelClassContext(i),this._dirty=!0}else $u(i.labelsToInitialize,(r,n)=>(this._ensureGraphics3DResources(r)&&(this._labels.set(n,r),this.deconflictor.setDirty(),e.madeProgress()),(r.visible&&r.textInitialized||!r.visible&&r.hasGraphics3DResources)&&(i.labelsToInitialize.delete(n),e.madeProgress()),e.done))&&(this._dirty=!0);this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){const i=e.labelClassAbortController?.signal;e.layer.when&&await e.layer.when(),Tt(i),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const r=e.graphics3DCore,n=r.layer,s=n.labelingInfo?.filter(o=>!!o.symbol);!s||s.length===0||(await f6(s,async(o,a)=>{const l=o.symbol,c=Tee(r.getOrCreateGraphics3DSymbol(l));if(c==null)return void K.getLogger(this).error("Failed to create Graphics3DSymbol for label");await c.load(),Tt(i);let h=null;TJ(l)&&l.hasVisibleCallout()&&(h=ist(l,r.symbolCreationContext),await h.load(),Tt(i));const d=await jc(bEe(o,e.layer.fieldsIndex,this.view.spatialReference));if(Tt(i),d.ok===!0){const f=await this._createTextRenderParameters(c.symbol);Tt(i),e.labelClassContexts[a]=new ymt(o,c,h,f,d.value)}else K.getLogger(this).error(`Label expression failed to evaluate: ${d.error}`)}),Tt(i))}async _createLabelClassContext(e){return e.labelClassPromise==null&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(i=>{if(Tn(i))throw i;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const i=e.symbolLayers.at(0);return i?.type!=="text"?null:NOe.fromSymbol(i,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(e){for(const r of e.labelClassContexts)--r.graphics3DSymbol.referenced;const i=e.labelClassAbortController;e.labelClassAbortController=new AbortController,Gc(i),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,i,r,n,s,o){const a=new LOe(r,yce(r.anchor),Yct(r.anchor),e.text,pi(e.displayWidth,e.displayHeight));return Cd.graphic=i,Cd.renderingInfo=null,Cd.layer=n,s.createLabel(Cd,a,this._hudMaterialCollection,this._textTextureAtlas,()=>{const l=mue(o);return l?l.elevationOffset:null})}_createLineCalloutGraphic(e,i,r,n,s){Cd.graphic=e,Cd.layer=s;const o=n.screenOffset[0];return Cd.renderingInfo=new est(null,i,n.translation,n.centerOffset,o,n.centerOffsetUnits,n.elevationOffset,this._calloutMaterialCollection),r.createGraphics3DGraphic(Cd)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const i=e.graphics3DGraphic;if(i.destroyed)return!1;this._ensureTextTextureResources(e);const r=e.labelingContext,n=r.labelClassContexts;if($B(n)||!r.emptySymbolLabelSupported&&i.layers.length===0)return!1;let s=!1;const o=i.graphic,a=r.layer,l=UL(r.layer);for(let c=0;c<n.length;c++){const h=e.textRenderers[c],d=e.textLabelPlacements[c];if(h==null||d==null)continue;const f=n[c],m=f.graphics3DSymbol,y=m.symbol&&m.symbol.type==="label-3d"?m.symbol:null,_=m.symbolLayers[0];if(!_)continue;_.setElevationInfoOverride(r.elevationInfoOverride);const v=new omt(i,y,f.labelClass),w=this._createTextSymbolGraphic(h,o,d,a,_,v);if(w==null)return!1;w._labelClass=f.labelClass,w._labelIndex=c,i.addLabelGraphic(w,r.stageLayer),i.deconflictionPriority=f.textRenderParameters?.definition.size??0,i.setVisibilityFlag(mo.LABEL,sa.USER,l),i.setVisibilityFlag(mo.LABEL,sa.SCALE_RANGE,!0),i.setVisibilityFlag(mo.LABEL,sa.DECONFLICTION,!1),s=!0;const x=f.graphics3DCalloutSymbolLayer;if(x&&d.hasLabelVerticalOffset){x.setElevationInfoOverride(r.elevationInfoOverride);const T=this._createLineCalloutGraphic(o,y,x,d,a);T!=null&&(f.calloutSymbolLayerIndex=i.labelLayers.length,i.addLabelGraphic(T,r.stageLayer))}break}return r.scaleVisibility&&s&&r.scaleVisibility.updateGraphicLabelScaleVisibility(i),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const i=e.labelingContext.labelClassContexts;for(const r of e.graphics3DGraphic.labelLayers){if(r._labelClass==null)continue;i[r._labelIndex].graphics3DSymbol.symbolLayers[0]?.onRemoveGraphic(r)}e.graphics3DGraphic.deconflictionPriority=0,e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){if(e.textInitialized)return;const i=e.labelingContext,r=i.labelClassContexts;if($B(r))return;const n=e.graphics3DGraphic.graphic;for(let s=0;s<r.length;s++){const o=r[s];if(e.textRenderers[s]=null,e.textLabelPlacements[s]=null,o?.textRenderParameters==null)continue;const a=o.labelFunction;let l;if(a.type==="arcade")try{const w=a.needsHydrationToEvaluate()?zit(n,i.layer):n;l=a.evaluate(w)}catch{l=null}else l=a.evaluate(n);if(l==null||l===""||/^\s+$/.test(l))continue;const c=o.graphics3DSymbol,h=c.symbol?.type==="label-3d"?c.symbol:null;if(!c.symbolLayers[0])continue;const d=e.graphics3DGraphic,f=o.labelClass,m=i.disablePlacement,y=mue({graphics3DGraphic:d,labelSymbol:h,labelClass:f,disablePlacement:m});if(y==null)continue;const _=yce(y.anchor),v=m3e(_);e.textRenderers[s]=new p3e(l,v,o.textRenderParameters,Lw.maxSize),e.textLabelPlacements[s]=y}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,i){const r=i.graphic.uid;if(e.graphics.set(r,i),e.active){const n=new bue(e,i);this._labels.set(r,n),e.labelsToInitialize.set(r,n)}this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,i){const r=i.graphic.uid,n=this._labels.get(r);e.graphics.delete(r),n&&(this._destroyGraphic(n,r),e.labelsToInitialize.delete(r),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,i){this._labels.delete(i),e.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,i){if(!i)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const r of i){const n=e.graphics.get(r);n&&(this._removeGraphic(e,n),this._addGraphic(e,n))}}_globalPropertyChanged(e,i){for(const r of i.labelClassContexts){const n=new Map;i.graphics.forEach(o=>n.set(o.graphic.uid,o));const s=o=>o.labelLayers[0];if(r.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,n,s),r.graphics3DCalloutSymbolLayer){const o=a=>a.labelLayers[r.calloutSymbolLayerIndex];r.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,n,o)}}}_visibilityInfoChange(e){const i=UL(e.layer);i&&!e.active&&this._activateLabelingContext(e),!i&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((i,r)=>{const n=this._labels.get(r);n&&(this._destroyGraphic(n,r),n.visible=!1,e.labelsToInitialize.set(r,n))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const i of this._labelingContexts)if(i.graphics3DCore===e)return i;return null}addGraphicsOwner(e,i,r){const n=r&&r.emptySymbolLabelSupported||!1,s=r?.elevationInfoOverride||null,o=r?.disablePlacement||null;if(this._findLabelingContext(e))return;const a=e.layer,l=new _mt(this.view._stage,a,e,i,n,s,o,UL(a));return this._labelingContexts.push(l),this.setDirty(),{addGraphic:c=>this._addGraphic(l,c),removeGraphic:c=>this._removeGraphic(l,c),featureReductionChange:()=>{},layerLabelsEnabled:()=>UL(l.layer),labelingInfoChange:c=>this._labelingInfoChange(l,c),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),clear:()=>{}}}removeGraphicsOwner(e){const i=this._findLabelingContext(e);if(!i)return;const r=this._labelingContexts.indexOf(i);this._labelingContexts.splice(r,1),i.graphics.forEach(n=>this._removeGraphic(i,n)),i.destroy(),this.setDirty()}setLabelGraphicVisibility(e,i){const r=e.graphic.uid,n=this._labels.get(r);n&&n.visible!==i&&(i&&!n.addedToTextureAtlas?(this._addLabelTextureToAtlas(n),n.textInitialized||n.labelingContext.labelsToInitialize.set(r,n)):!i&&n.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(n),n.visible=i,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._dirty||this._textTextureAtlas?.updating||this.deconflictor.updating||this._labelingContexts.some(e=>MB(e))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((i,r)=>i+(MB(r)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function MB(t){return!!t.labelClassPromise&&!!t.labelClassAbortController}function $B(t){return!t||t.length===0}function UL(t){return t.labelsVisible===!0&&!!t.labelingInfo?.some(e=>!!e.symbol)}u([p({constructOnly:!0})],Ub.prototype,"view",void 0),u([p({constructOnly:!0})],Ub.prototype,"deconflictor",void 0),u([p()],Ub.prototype,"_textTextureAtlas",void 0),u([p({type:Boolean,readOnly:!0})],Ub.prototype,"updating",null),Ub=u([M("esri.views.3d.layers.graphics.Labeler")],Ub);const Cd=new tst(null,null,null);let dO=class e2{constructor(e,i,r,n=null){this.lij=[0,0,0],this.extent=Zt(),this.resolution=0,this.loadPriority=0,this.measures={visibility:xa.VISIBLE_ON_SURFACE,screenRect:Zt(),distance:0,shouldSplit:!1},this.used=!1,n&&this.acquire(e,i,r,n)}acquire(e,i,r,n){this.tilingScheme=n,this.id=e2.id(e,i,r),this.lij[0]=e,this.lij[1]=i,this.lij[2]=r,n.getExtent(e,i,r,this.extent),this.resolution=n.resolutionAtLevel(e)}release(){this.tilingScheme=null}getChildren(e){const i=this.lij[0]+1,r=2*this.lij[1],n=2*this.lij[2];return e?(e[0].acquire(i,r,n,this.tilingScheme),e[1].acquire(i,r+1,n,this.tilingScheme),e[2].acquire(i,r,n+1,this.tilingScheme),e[3].acquire(i,r+1,n+1,this.tilingScheme),e):[new e2(i,r,n,this.tilingScheme),new e2(i,r+1,n,this.tilingScheme),new e2(i,r,n+1,this.tilingScheme),new e2(i,r+1,n+1,this.tilingScheme)]}copyMeasurementsFrom(e){this.measures.visibility=e.measures.visibility,this.measures.shouldSplit=e.measures.shouldSplit,this.measures.distance=e.measures.distance,Sy(e.measures.screenRect,this.measures.screenRect)}static id(e,i,r){return`${e}/${i}/${r}`}};var xa;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",t[t.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(xa||(xa={}));const kOe=.5*Math.PI,vmt=kOe/Math.PI*180;let bmt=class{constructor(e){this._renderCoordsHelper=e.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:E(),direction:E()};for(let i=0;i<4;i++)this._extent[i]={origin:E(),direction:E(),cap:{next:null,direction:E()}},this._planes[i]=Ii();this._planes[br.NEAR]=Ii(),this._planes[br.FAR]=Ii(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,i,r,n=!0){const s=this._extent;this._toRenderBoundingExtent(e,i,r),ue(this._center.origin,s[0].origin,s[2].origin),re(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),n||re(this._center.direction,this._center.direction,-1);for(let o=0;o<4;o++){const a=s[o];this._renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=s[o===3?0:o+1];a.cap.next=l.origin,Fy(a.cap.direction,a.origin,l.origin),gP(a.direction,a.cap.direction,a.origin,this._planes[o]),n||re(a.direction,a.direction,-1)}gP(s[0].cap.direction,s[1].cap.direction,s[0].origin,this._planes[br.NEAR]),n?iH(this._planes[br.NEAR],this._planes[br.FAR]):(iU(this._planes[br.FAR],this._planes[br.NEAR]),iH(this._planes[br.NEAR],this._planes[br.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=i,this._minGlobalAltitude=.9*Wi(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,i,r=!1){if(e==null)return!1;if(this._renderCoordsHelper.viewingMode===Le.Global){const s=this._maxSpanSpatialReference.isGeographic?vmt:kOe*i;if(this._maxSpan>s)return!0;if(e.altitude!=null&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(this._maxSpan===0){const s=this._extent[0];return!(r||!e.intersectsRay(th(s.origin,s.direction)))}for(let s=0;s<this._extent.length;s++){const o=this._extent[s];if(!r&&e.intersectsRay(th(o.origin,o.direction))||e.intersectsLineSegment(jw(o.origin,o.cap.next,xmt),o.cap.direction))return!0}const n=r?this._planes:this._planesWithoutFar;for(let s=0;s<e.lines.length;s++){const o=e.lines[s];if(tKe(n,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,i,r){OZ(e,Ad),Ad[2]=r,Bc(i,Ad,IB,this._renderCoordsHelper.spatialReference),fs(wue,IB),Pr(cc);for(const{x0:s,x1:o,y0:a,y1:l}of wmt)for(let c=0;c<5;c++){const h=c/4;Ad[0]=xt(e[s],e[o],h),Ad[1]=xt(e[a],e[l],h),Ad[2]=r,ua(Ad,i,Ad,this._renderCoordsHelper.spatialReference),ke(Ad,Ad,wue),Dp(cc,Ad)}ae(this._extent[0].origin,cc[0],cc[1],cc[2]),ae(this._extent[1].origin,cc[3],cc[1],cc[2]),ae(this._extent[2].origin,cc[3],cc[4],cc[2]),ae(this._extent[3].origin,cc[0],cc[4],cc[2]);for(let s=0;s<4;++s)ke(this._extent[s].origin,this._extent[s].origin,IB)}_toRenderBoundingExtentLocal(e,i,r){K6(e,i,lg,this._renderCoordsHelper.spatialReference),ae(this._extent[0].origin,lg[0],lg[1],r),ae(this._extent[1].origin,lg[2],lg[1],r),ae(this._extent[2].origin,lg[2],lg[3],r),ae(this._extent[3].origin,lg[0],lg[3],r)}_toRenderBoundingExtent(e,i,r){switch(this._renderCoordsHelper.viewingMode){case Le.Global:this._toRenderBoundingExtentGlobal(e,i,r);break;case Le.Local:this._toRenderBoundingExtentLocal(e,i,r);break;default:this._renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(e){if(hr(e.planes[br.NEAR],this._center.origin)<0&&ge(this._center.direction,e.direction)<0)return!0;for(let i=0;i<4;i++){const r=this._extent[i];if(hr(e.planes[br.NEAR],r.origin)<0&&ge(r.direction,e.direction)<0)return!0}return!1}};const wmt=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],Ad=E(),IB=be(),wue=be(),cc=ks(),lg=Zt(),xmt=Vp();let Tmt=class{constructor(e){this._renderCoordsHelper=e,this._surfaceElevation=0,this._cache=new Map,this._frustum=new U_(e),this._extendedFrustum=new U_(e),this._intersector=new bmt({renderCoordsHelper:e}),this._renderCoordsHelper=e}begin(e,i){this._surfaceElevation=i,this._aboveGround=this._renderCoordsHelper.getAltitude(e.eye)>i,this._frustum.update(e),this._shortenFrustumFarPlane(this._frustum),this._updateExtendedFrustum(e)}end(){this._cache.clear()}calculate(e){if(this._allTilesInvisible)return xa.INVISIBLE;const i=this._renderCoordsHelper.viewingMode===Le.Global&&e.lij[0]>=Smt&&e.lij[0]<Emt,r=this._getOrCalculateSingleTileVisibility(e,!i);return r!==xa.INVISIBLE&&i?this._calculateAggregatedChildrenVisibility(e):r}_shortenFrustumFarPlane(e){const i=U_.nearFarLineIndices,r=e.mutablePoints;for(const n of i){const[s,o]=n,a=r[s],l=r[o];de(su,l,a),re(su,su,Amt),ue(r[o],a,su)}e.updatePoints(r)}_calculateAggregatedChildrenVisibility(e){let i=xa.INVISIBLE;const r=this._cache.get(e.id);if(r!=null)return r;const n=Eue.acquire();e.getChildren(n);for(const s of n){const o=this.calculate(s);if(o!==xa.INVISIBLE&&(i=o,o===xa.VISIBLE_ON_SURFACE))break}return Eue.release(n),this._cache.set(e.id,i),i}_getOrCalculateSingleTileVisibility(e,i){const r=this._cache.get(e.id);if(r!=null)return r;const n=this._calculateSingleTileVisibility(e);return i&&this._cache.set(e.id,n),n}_calculateSingleTileVisibility(e){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===Le.Global&&e.lij[0]<Cmt?this._calculateSingleTileVisibilitySided(e,!1)===xa.INVISIBLE?this._calculateSingleTileVisibilitySided(e,!0):void 0:this._calculateSingleTileVisibilitySided(e,this._aboveGround)}_calculateSingleTileVisibilitySided(e,i){this._intersector.update(e.extent,e.tilingScheme.spatialReference,this._surfaceElevation,i);const r=Wi(e.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._extendedFrustum,r)?this._intersector.isVisibleInFrustum(this._frustum,r,!0)?xa.VISIBLE_ON_SURFACE:xa.VISIBLE_WHEN_EXTENDED:xa.INVISIBLE}_updateExtendedFrustum(e){this._extendedFrustum.update(e),this._shortenFrustumFarPlane(this._extendedFrustum);const i=this._renderCoordsHelper.worldUpAtPosition(e.eye,su);this._aboveGround||Pa(i,i);const r=Ys(-ge(i,e.viewForward));if(this._allTilesInvisible=r>(Math.PI+e.fovY)/2,this._allTilesInvisible||(this._hasExtendedFrustum=r>e.fovY/2,!this._hasExtendedFrustum))return;const n=this._extendedFrustumParameters(),s=this._extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=n.pointIndices[o],l=s[a],c=this._renderCoordsHelper.getAltitude(l);if(n.needsAltitudeAdjustment(c)){switch(this._renderCoordsHelper.worldUpAtPosition(l,su),a){case Ze.FAR_BOTTOM_LEFT:case Ze.FAR_TOP_LEFT:case Ze.NEAR_BOTTOM_LEFT:case Ze.NEAR_TOP_LEFT:rH(this._extendedFrustum.planes[br.LEFT],su,su);break;case Ze.FAR_BOTTOM_RIGHT:case Ze.FAR_TOP_RIGHT:case Ze.NEAR_BOTTOM_RIGHT:case Ze.NEAR_TOP_RIGHT:rH(this._extendedFrustum.planes[br.RIGHT],su,su)}re(su,su,n.direction),this._renderCoordsHelper.intersectInfiniteManifold(th(l,su),n.zWithMargin,l)}}if(this._extendedFrustum.updatePoints(s),Ca(s[Ze.NEAR_BOTTOM_LEFT],s[Ze.NEAR_BOTTOM_RIGHT],s[Ze.NEAR_TOP_RIGHT],Tue),Ca(s[Ze.NEAR_BOTTOM_RIGHT],s[Ze.NEAR_TOP_RIGHT],s[Ze.NEAR_TOP_LEFT],Sue),ge(Tue,Sue)<0){const o=this._extendedFrustum.mutablePoints;this._aboveGround?[o[Ze.NEAR_BOTTOM_LEFT],o[Ze.NEAR_BOTTOM_RIGHT]]=[o[Ze.NEAR_BOTTOM_RIGHT],o[Ze.NEAR_BOTTOM_LEFT]]:[o[Ze.NEAR_TOP_LEFT],o[Ze.NEAR_TOP_RIGHT]]=[o[Ze.NEAR_TOP_RIGHT],o[Ze.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const e=this._surfaceElevation-xue;return{zWithMargin:e,pointIndices:U_.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:i=>i>e}}_extendedFrustumParametersBelowSurface(){const e=this._surfaceElevation+xue;return{zWithMargin:e,pointIndices:U_.planePointIndices.top,direction:1,needsAltitudeAdjustment:i=>i<e}}};const Smt=2,Emt=6,Cmt=12,Amt=.95,xue=1,su=E(),Tue=Ii(),Sue=Ii(),Eue=new $a(Array,t=>{t.length!==4&&(t[0]=new dO,t[1]=new dO,t[2]=new dO,t[3]=new dO)},t=>{t[0].release(),t[1].release(),t[2].release(),t[3].release()});let Omt=class{constructor(e){this._camera=new ft,this._focusOnMap=[0,0],this._screenRect=Zt(),this._tileSize=e.tileSize,this._renderCoordsHelper=e.renderCoordsHelper,this._tilingScheme=e.tilingScheme,this._visibility=new Tmt(e.renderCoordsHelper)}begin(e,i,r){this._camera.copyFrom(e),this._surfaceElevation=r,this._focusOnMap[0]=i.x,this._focusOnMap[1]=i.y,CZ(0,0,e.fullWidth,e.fullHeight,this._screenRect),this._visibility.begin(this._camera,r)}end(){this._visibility.end()}updateTile(e){e.measures.visibility=this._visibility.calculate(e),e.measures.distance=zke(e.extent,this._focusOnMap),e.measures.visibility!==xa.INVISIBLE&&this._updateScreenMeasure(e)}_updateScreenMeasure(e){const i=Rmt,r=1<<i,n=e.measures.screenRect;id(n);let s=0;const o=e.lij[0]+i,a=e.lij[1]<<i,l=e.lij[2]<<i,c=this._tileSizeWithBias(e),h=c*c;for(let d=0;d<r;d++)for(let f=0;f<r;f++)if(s+=this._computeScreenArea(e,o,a+d,l+f,n),s>h)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}_tileSizeWithBias(e){return e.measures.visibility===xa.VISIBLE_WHEN_EXTENDED?this._tileSize*Pmt:this._tileSize}_computeScreenArea(e,i,r,n,s){const o=e.measures.visibility===xa.VISIBLE_WHEN_EXTENDED;this._projectToScreen(i,r,n,o,F0),id(LB);for(let a=0;a<4;a++)AZ(LB,F0[a]);return lv(s,LB,s),poe(F0[0],F0[1],F0[2])+poe(F0[0],F0[2],F0[3])}_projectToScreen(e,i,r,n,s){this._tilingScheme.ensureMaxLod(e),this._tilingScheme.getExtent(e,i,r,BA),this._toRenderCoords(BA,0,3,k0[0]),this._toRenderCoords(BA,2,3,k0[1]),this._toRenderCoords(BA,2,1,k0[2]),this._toRenderCoords(BA,0,1,k0[3]),n&&(this._projectToPlane(k0,this._camera.frustum[br.NEAR]),this._projectToPlane(k0,this._camera.frustum[br.TOP]),this._projectToPlane(k0,this._camera.frustum[br.BOTTOM]));for(let o=0;o<4;o++)this._camera.projectToRenderScreen(k0[o],Cue),this._camera.renderToScreen(Cue,s[o])}_projectToPlane(e,i){for(let n=0;n<4;n++)GA[n]=hr(i,e[n]);const r=Math.max(GA[0],GA[1],GA[2],GA[3]);if(r>0){const n=re(VA,i,-r);for(let s=0;s<4;s++)ue(e[s],e[s],n)}}_toRenderCoords(e,i,r,n){return VA[0]=e[i],VA[1]=e[r],VA[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(VA,this._tilingScheme.spatialReference,n),n}};const LB=Zt(),Rmt=2,Pmt=5,F0=[cn(),cn(),cn(),cn()],BA=Zt(),VA=E(),k0=[E(),E(),E(),E()],GA=[0,0,0,0],Cue=aa();function wzt(t,e,i){if(t==null||i==null)return!1;let r=!0;return Es[0]=t.xmin!=null?t.xmin:0,Es[1]=t.ymin!=null?t.ymin:0,Es[2]=t.zmin!=null?t.zmin:0,r=r&&rn(Es,t.spatialReference,0,e,i,0,1),Es[0]=t.xmax!=null?t.xmax:0,Es[1]=t.ymax!=null?t.ymax:0,Es[2]=t.zmax!=null?t.zmax:0,r=r&&rn(Es,t.spatialReference,0,e,i,3,1),t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.zmin==null&&(e[2]=-1/0),t.xmax==null&&(e[3]=1/0),t.ymax==null&&(e[4]=1/0),t.zmax==null&&(e[5]=1/0),r}function UOe(t,e,i){if(t==null||i==null)return!1;let r=!0;return Es[0]=t.xmin!=null?t.xmin:0,Es[1]=t.ymin!=null?t.ymin:0,Es[2]=t.zmin!=null?t.zmin:0,r=r&&rn(Es,t.spatialReference,0,Es,i,0,1),e[0]=Es[0],e[1]=Es[1],Es[0]=t.xmax!=null?t.xmax:0,Es[1]=t.ymax!=null?t.ymax:0,Es[2]=t.zmax!=null?t.zmax:0,r=r&&rn(Es,t.spatialReference,0,Es,i,0,1),e[2]=Es[0],e[3]=Es[1],t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.xmax==null&&(e[2]=1/0),t.ymax==null&&(e[3]=1/0),r}const Es=E();let Lo=class extends we{get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(e!=null&&!e.spatialReference.equals(this.viewState.spatialReference))return void K.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const i=this._get("filterExtent");if(i===e||i!=null&&e&&i.equals(e))return;const r=e!=null?e.clone():null;this._set("filterExtent",r),this._setDirty()}get _filterExtentRect(){if(this.filterExtent==null)return null;const e=Zt();return UOe(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(e){super(e),this.tiles=new Je,this.tileSize=512,this._idToTile=new Map,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new Ut}initialize(){this.addHandles([ne(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),Zi),ne(()=>[this.tileSize,this.cameraOnSurface?.location,this.tilingScheme,this.viewState?.contentCamera,this.focus?.location],()=>this._setDirty(),Ji)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(pt.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=Tr(this._frameWorker)}addClient(){const e=zu();return this._clients.add(e),this._clients.size===1&&this._setDirty(),Vi(()=>this._removeClient(e))}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(hl))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),this._frameWorker!=null&&(this._frameWorker.priority=pt.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),this._pendingTiles||this._frameWorker==null||(this._frameWorker.priority=pt.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new Omt({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:e}=this;return this._rootTileIds.map(i=>new dO(i[0],i[1],i[2],e))}_purgeHorizonTiles(e){e.sort((i,r)=>{const n=i.measures.screenRect,s=r.measures.screenRect;return n[1]+n[3]-(s[1]+s[3])}),id(zL);for(let i=0;i<e.length;i++)if(lv(zL,e.data[i].measures.screenRect,zL),Wl(zL)>Mmt)return e.data.slice(i,e.length);return[]}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:i}=this;for(;this._pendingTiles.length>0&&!e.done;){const r=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!I6(this._filterExtentRect,r.extent)||(this._tileMeasurements.updateTile(r),r.measures.visibility!==xa.INVISIBLE&&(r.measures.shouldSplit?(i.ensureMaxLod(r.lij[0]+1),this._pendingTiles.push(...r.getChildren())):this._newTiles.push(r)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const n of this.tiles.items)n.used=!1;const i=e.filter(n=>{const s=this._idToTile.get(n.id);return s?(s.copyMeasurementsFrom(n),s.used=!0):this._idToTile.set(n.id,n),!s}),r=this.tiles.items.filter(n=>!n.used&&(this._idToTile.delete(n.id),!0));this.tiles.removeMany(r),this.tiles.addMany(i),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,i)=>e.measures.visibility!==i.measures.visibility?e.measures.visibility===xa.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-i.measures.distance),this.tiles.forEach((e,i)=>e.loadPriority=i)}};u([p({constructOnly:!0})],Lo.prototype,"scheduler",void 0),u([p({constructOnly:!0})],Lo.prototype,"renderCoordsHelper",void 0),u([p({constructOnly:!0})],Lo.prototype,"tilingSchemeOwner",void 0),u([p({constructOnly:!0})],Lo.prototype,"cameraOnSurface",void 0),u([p({constructOnly:!0})],Lo.prototype,"focus",void 0),u([p({constructOnly:!0})],Lo.prototype,"viewState",void 0),u([p({constructOnly:!0})],Lo.prototype,"terrain",void 0),u([p()],Lo.prototype,"tiles",void 0),u([p()],Lo.prototype,"tileSize",void 0),u([p({readOnly:!0})],Lo.prototype,"tilingScheme",null),u([p()],Lo.prototype,"filterExtent",null),u([p({readOnly:!0})],Lo.prototype,"_filterExtentRect",null),u([p({readOnly:!0})],Lo.prototype,"_rootTileIds",null),u([p({value:!1})],Lo.prototype,"suspended",null),u([p({readOnly:!0})],Lo.prototype,"updating",null),Lo=u([M("esri.views.3d.layers.support.FeatureTileTree3D")],Lo);const zL=Zt(),Mmt=10;let mn=class extends we{constructor(){super(...arguments),this._propertiesPool=new Ry({camera:ft},this),this._lastSeenCameraProjectionValues=new ft,this.mode=Li.ANIMATING,this._cssCamera=new ft,this._camera=new ft,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new Sn,this.viewingMode=Le.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,i){this._set("viewingMode",e),this._set("spatialReference",i),this._set("constraints",new Og({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new Ry({camera:ft},this)}destroy(){this.cameraController=null,this._propertiesPool?.destroy(),this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===Le.Global){const e=Wi(this.spatialReference).radius;this.camera=new ft({eye:Oe(4*e,0,0),center:Oe(e,0,0),up:Oe(0,0,1)})}else this.camera=new ft({eye:Oe(0,0,100),center:Oe(0,0,0),up:Oe(0,1,0)})}get animation(){return this.cameraController instanceof OP&&this.cameraController.viewAnimation!=null?this.cameraController.viewAnimation:null}get camera(){return this._camera}get cssCamera(){const e=this._cssCamera.copyFrom(this.camera),{height:i,width:r,pixelRatio:n}=this.camera;return e.pixelRatio=1,e.height=Math.round(i/n),e.width=Math.round(r/n),e}set camera(e){e!==mh&&mh.copyFrom(e),mh.computeUp(this.viewingMode),this.events.emit("before-camera-change",mh);const i=this._camera;if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,mh)&&(this._lastSeenCameraProjectionValues.copyFrom(mh),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),!i.equals(mh)&&(this._camera=this._propertiesPool.get("camera").copyFrom(mh),this._cameraChanged=!i.almostEquals(mh),this._cameraChanged)){const r=age(()=>{this._cameraChanged=!1,r.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===Li.IDLE}get updating(){return this.mode!==Li.IDLE}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(e){this._contentCamera=e!=null?e.clone():null}get fixedContentCamera(){return this._contentCamera!=null}get isGlobal(){return this.viewingMode===Le.Global}get isLocal(){return this.viewingMode===Le.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(this.cameraController?.destroy(),e&&(this.removeHandles(Aue),this.addHandles(gl(()=>e.state===on.Finished||e.state===on.Stopped,()=>{this._set("cameraController",null),this.updateCamera(i=>e.onControllerEnd(i))},{sync:!0,once:!0}),Aue),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=on.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==on.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();mh.copyFrom(this._get("camera")),e(mh),this.camera=mh,this._processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,i){return e.fov!==i.fov||e.fullViewport[0]!==i.fullViewport[0]||e.fullViewport[1]!==i.fullViewport[1]||e.fullViewport[2]!==i.fullViewport[2]||e.fullViewport[3]!==i.fullViewport[3]||e.padding[ii.TOP]!==i.padding[ii.TOP]||e.padding[ii.RIGHT]!==i.padding[ii.RIGHT]||e.padding[ii.BOTTOM]!==i.padding[ii.BOTTOM]||e.padding[ii.LEFT]!==i.padding[ii.LEFT]}};u([p()],mn.prototype,"mode",void 0),u([p({readOnly:!0,type:QE})],mn.prototype,"animation",null),u([p({type:ft})],mn.prototype,"camera",null),u([p({type:ft})],mn.prototype,"cssCamera",null),u([p()],mn.prototype,"_cssCamera",void 0),u([p()],mn.prototype,"_camera",void 0),u([p({readOnly:!0})],mn.prototype,"pixelRatio",null),u([p()],mn.prototype,"rasterPixelRatio",void 0),u([p()],mn.prototype,"contentPixelRatio",void 0),u([p({readOnly:!0})],mn.prototype,"alignPixelEnabled",null),u([p({readOnly:!0})],mn.prototype,"updating",null),u([p({})],mn.prototype,"_contentCamera",void 0),u([p({type:ft})],mn.prototype,"contentCamera",null),u([p({readOnly:!0})],mn.prototype,"fixedContentCamera",null),u([p({readOnly:!0})],mn.prototype,"constraints",void 0),u([p({readOnly:!0})],mn.prototype,"events",void 0),u([p({readOnly:!0})],mn.prototype,"isGlobal",null),u([p({readOnly:!0})],mn.prototype,"isLocal",null),u([p({readOnly:!0})],mn.prototype,"viewingMode",void 0),u([p({readOnly:!0})],mn.prototype,"spatialReference",void 0),u([p()],mn.prototype,"navigating",null),u([p()],mn.prototype,"stationary",null),u([p()],mn.prototype,"_cameraChanged",void 0),u([p()],mn.prototype,"cameraController",null),mn=u([M("esri.views.3d.state.ViewState")],mn);const $mt=mn,mh=new ft,Aue="ViewStateHandles";let Imt=class{constructor(e,i,r){this.viewingMode=e,this._forEachLayer=i,this._view=r,this._externalIntersectionHandlers=new Ut,this._tolerance=JE,this._tmpRay=js(),this._tmpRegion=Zt(),this._validateHUDIntersector=sd(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,i,r){return this.intersectRay(this._getPickRay(e,this._tmpRay),Oue(this.viewingMode),i,r)}intersectScreenFreePointFallback(e,i,r){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),i,r)}intersectRayFreePointFallback(e,i,r){return this.intersectRay(e,Oue(this.viewingMode),i,r)||this._intersectRayFreePointLocal(e,i)}intersectRay(e,i,r,n){return i.options.selectionMode=!1,i.options.store=Bo.MIN,this.computeIntersection(e,i,n),!!i.results.min&&i.results.min.getIntersectionPoint(r)}getCenterRayWithSubpixelOffset(e,i,r=.5,n=.5){return e.getRenderCenter(GL,r,n),GL[0]+=.0466,GL[1]-=.0123,KK(e,GL,i)}intersectIntersectorScreen(e,i,r){this.computeIntersection(this._getPickRay(e,this._tmpRay),i,r)}intersectToolIntersectorScreen(e,i,r){const n=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(n,i,r)}intersectToolIntersectorRay(e,i,r){i.options.selectionMode=!0,this.computeIntersection(e,i,r);const n=i.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||Gp(n)&&n.intersector!==Jr.TERRAIN||(i.options.selectionMode=!1,this.computeIntersection(e,i,r))}setTolerance(e=JE){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((i,r)=>i.type===Jr.TERRAIN?1:r.type===Jr.TERRAIN?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((i,r)=>i.type===Jr.TERRAIN?1:r.type===Jr.TERRAIN?-1:0)}_getPickRay(e,i){const r=this._view.state.camera;return JK(r,e,i)}_intersectRayFreePointLocal(e,i){return this.viewingMode!==Le.Local||e==null||ue(i,e.origin,ye(Ne.get(),e.direction)),!1}intersectElevationFromScreen(e,i,r=0,n=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),i,r,n)}_intersectElevation(e,i,r=0,n=null){if(e==null)return null;const s=i!=null?i.mode:"absolute-height",o=i?.offset??0,a=s!=="on-the-ground"?o+r:0,l=a/this._view.renderCoordsHelper.unitInMeters;if(s==="absolute-height"){if(this._view.renderCoordsHelper.intersectInfiniteManifold(e,a,VL)){const x=this._view.computeMapPointFromVec3d(VL);return x.z??(x.z=0),x.z-=o,x}return null}const c=this._view.state.camera,h=Ne.get();c.projectToRenderScreen(e.origin,h);const d=new Rue(null,this._forEachLayer),f=this._view.slicePlane,m=f!=null?qne(f):null,y=sd(this.viewingMode);y.options.store=Bo.MIN,y.options.verticalOffset=l;const _=e.origin,v=ue(Ne.get(),_,e.direction);y.reset(_,v,c),y.point=h;const w=n?"type"in n&&n.type==="graphics"?x=>x.layerUid!==n.uid:x=>x.graphicUid!==n.uid:null;switch(s){case"relative-to-scene":{const x=T=>(!w||w(T))&&!!T.lastValidElevationBB;y.intersect(d.layers,h,this._tolerance,null,x),this._externalIntersectionHandlers.forAll(T=>{if(T.type===Jr.I3S||T.type===Jr.TERRAIN){const S=T.slicePlaneEnabled?m:null;T.intersect(y,S,y.rayBegin,y.rayEnd,h)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(x=>{if(x.isGround){const T=x.slicePlaneEnabled?m:null;x.intersect(y,T,y.rayBegin,y.rayEnd,h)}})}if(y.results.min.getIntersectionPoint(VL)){const x=this._view.computeMapPointFromVec3d(VL);return x.z=r,x}return null}computeIntersection(e,i,r){if(e==null)return;const n=this._view.state.camera,s=Ne.get();n.projectToRenderScreen(e.origin,s);const o=new Rue(r,this._forEachLayer);i.options.selectOpaqueTerrainOnly=!r||!("include"in r||"exclude"in r);const a=e.origin,l=ue(Ne.get(),e.origin,e.direction);i.reset(a,l,n),i.intersect(o.layers,s,this._tolerance);const c=this._view.slicePlane,h=c!=null?qne(c):null;i.intersect(o.sliceableLayers,s,this._tolerance,h);const d=r&&(r.requiresGroundFeedback||r.enableDraped);this._externalIntersectionHandlers.forAll(y=>{const _=y.layerUid,v=Array.isArray(_),w=v?_:[_];v&&(i.options.filteredLayerUids=[]);let x=!1;for(const T of w)o.filterLayerUid(T)?x=!0:v&&i.options.filteredLayerUids.push(T);if(i.options.isFiltered=!x,y.isGround&&d||!i.options.isFiltered){const T=y.slicePlaneEnabled?h:null;y.intersect(i,T,a,l,s)}});const f=Ne.get(),m=this._view.basemapTerrain;if(r&&r.enableDraped&&m.spatialReference!=null&&i.results.ground.getIntersectionPoint(f)){const y=m.overlayManager.renderer,_=this._view.renderCoordsHelper.spatialReference,v=Ne.get();this._view.renderCoordsHelper.fromRenderCoords(f,v,m.spatialReference),v[2]=this._view.elevationProvider?.getElevation(f[0],f[1],f[2],_,"ground")??0,y.intersect(i,v,i.results.ground,w=>o.filterRenderGeometry(w))}i.sortResults(),this._processHUDResults(i)}_processHUDResults(e){const i=e.results.hud;Sy(this._tmpRegion,J7);const r=this._view.state.camera,n=[],s=this._tmpRegion,o=w=>{const x=new Dmt(w);r.projectToRenderScreen(w.target.center,x.screenPoint),x.screenPoint[0]=Math.floor(x.screenPoint[0]),x.screenPoint[1]=Math.floor(x.screenPoint[1]),n.push(x),AZ(s,x.screenPoint)};e.sortResults(i.all),i.min.dist!=null&&o(i.min);for(const w of i.all)i.min.target.object!==w.target.object&&i.max.target.object!==w.target.object&&o(w);if(i.max.dist!=null&&i.max.target.object!==i.min.target.object&&o(i.max),!n.length)return;s[0]===s[2]&&(s[2]+=1),s[1]===s[3]&&(s[3]+=1);const a=r.fullWidth,l=r.fullHeight,c=Math.max(0,s[0]-pO),h=Math.max(0,s[1]-pO),d=Math.min(Oa(s)+2*pO,a-c),f=Math.min(Wl(s)+2*pO,l-h),m=new Uint8Array(d*f*4);this._view._stage.renderer.readHUDVisibility(c,h,d,f,m);let y=!0;const _=e.results.max.dist==null;let v=0;for(const w of n)for(const x of Lmt)if(m[4*(Math.min(w.screenPoint[0]+x[0],a)-s[0]+(Math.min(w.screenPoint[1]+x[1],l)-s[1])*d)]){y&&(e.results.min.copy(w.result),y=!1),_&&e.results.max.copy(w.result),e.options.store===Bo.ALL&&e.results.all.splice(v++,0,w.result);break}}};const pO=1,Lmt=(()=>{const t=[],e=pO;for(let i=-e;i<=e;i++)for(let r=-e;r<=e;r++)t.push([r+e,i+e]);return t})();let Dmt=class{constructor(e){this.result=e,this.screenPoint=aa()}},BL;function Oue(t){return BL&&BL.viewingMode===t||(BL=sd(t)),BL}let Rue=class{constructor(e,i){this.layers=new Array,this.sliceableLayers=new Array,this.include=e?.include,this.exclude=e?.exclude,i(r=>{r.pickable&&this.filterLayerUid(r.apiLayerUid)&&(r.sliceable?this.sliceableLayers:this.layers).push(r)})}filterLayerUid(e){const{include:i,exclude:r}=this;return e==null?i==null&&r==null:(i==null||i.has(e))&&(r==null||!r.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}};function Pue(t){return typeof t=="object"&&"intersect"in t}const VL=E(),GL=aa();let Azt=class{constructor(e,i){this.spatialReference=e,this._view=i}getElevation(e,i,r){return this._view.elevationProvider.getElevation(e,i,0,this.spatialReference,r)}async queryElevation(e,i,r,n,s){return this._view.elevationProvider.queryElevation(e,i,0,this.spatialReference,s,r,n)}},Nmt=class{constructor(e,i,r,n){this.spatialReference=i,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions={...n,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(pt.ELEVATION_QUERY,this)}destroy({completeTasks:e}={completeTasks:!1}){if(this._frameTask.remove(),this.running)if(e)this.runTask(hl);else for(const i of this._queries)i.result.reject(Ti())}queryElevation(e,i,r,n=0){const s=Hs(),o={x:e,y:i,minDemResolution:n,result:s,signal:r};return this._queries.push(o),Ms(r,()=>{CX(this._queries,o),s.reject(Ti())}),s.promise}get running(){return this._queries.length>0}runTask(e){const i=this._queries;this._queries=[];const r=this._getElevationQueryProvider();if(!r)return i.forEach(h=>h.result.reject()),void e.madeProgress();const n=i.map(h=>[h.x,h.y]),s=i.reduce((h,d)=>Math.min(h,d.minDemResolution),1/0),o=new TC({points:n,spatialReference:this.spatialReference}),a=i.length>1&&i.some(h=>!!h.signal)?new AbortController:null,l=a!=null?a.signal:i[0].signal;if(a!=null){let h=0;i.forEach(d=>Ms(d.signal,()=>{h++,d.result.reject(Ti()),h===i.length&&a.abort()}))}const c={...this._queryOptions,minDemResolution:s,signal:l};r.queryElevation(o,c).then(h=>{i.forEach((d,f)=>{d.signal!=null&&d.signal.aborted?d.result.reject(Ti()):d.result.resolve(h.geometry.points[f][2])})}).catch(h=>{i.forEach(d=>d.result.reject(h))}),e.madeProgress()}get test(){const e=this;return{update:()=>e._queries.length>0&&e.runTask(hl)}}},fO=class extends Sn.EventedMixin(we){get spatialReference(){return this.view?.basemapTerrain?.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQueryCached=$e(this._elevationQueryCached)}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,i,r,n,s){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const a=this.lastElevationQuery;if(e===a.x&&i===a.y&&r===a.z&&Fn(n,a.spatialReference)&&s===a.queryContext)return a.result}let o=null;return o=jL(o,this._im,e,i,r,n,s),o==null&&(o=jL(o,this._ground,e,i,r,n,s)),s==="scene"&&(o=jL(o,this._scene,e,i,r,n,s)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:i,z:r,spatialReference:n,queryContext:s,result:o}),o}getSphereElevationBounds(e,i){let r=1/0,n=-1/0;for(const s of[this._im,this._ground,this._scene])s.forEach(o=>{if(o.getSphereElevationBounds){const a=o.getSphereElevationBounds(e,i);a!=null&&(r=Math.min(r,a.min),n=Math.max(n,a.max))}});return{min:r,max:n}}getRootElevationBounds(){let e=1/0,i=-1/0;for(const r of[this._im,this._ground,this._scene])r.forEach(n=>{if(n.getRootElevationBounds){const s=n.getRootElevationBounds();s!=null&&(e=Math.min(e,s.min),i=Math.max(i,s.max))}});return{min:e,max:i}}async queryElevation(e,i,r,n,s,o=null,a=0){const l=this._getElevationQuery(n);try{const c=await l.queryElevation(e,i,o,a);return s==="scene"?jL(c,this._scene,e,i,r,n,s):c}catch(c){return Gl(c),this.getElevation(e,i,r,n,s)}}register(e,i){this.addHandles(i.on("elevation-change",r=>this.emit("elevation-change",r)),i),this._providersFromContext(e).push(i)}unregister(e){this.removeHandles(e);for(const i of[this._im,this._ground,this._scene]){const r=i.indexOf(e);r>-1&&i.splice(r,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}_getElevationQuery(e=this.view.spatialReference){const i=this._elevationQueryCached;if(i!=null&&Fn(e,i.spatialReference))return i;i?.destroy({completeTasks:!0});const{wkid:r,wkt:n,wkt2:s,latestWkid:o}=e,a=new Nmt(this.view.resourceController.scheduler,new ze({wkid:r,wkt:n,wkt2:s,latestWkid:o}),()=>this.view.map?.ground,{maximumAutoTileRequests:4});return this._elevationQueryCached=a,a}};function jL(t,e,i,r,n,s,o){for(const a of e){const l=a.getElevation(i,r,n,s,o);l!=null&&(t=t!=null?Math.max(l,t):l)}return t}u([p({constructOnly:!0})],fO.prototype,"view",void 0),u([p()],fO.prototype,"spatialReference",null),fO=u([M("esri.views.3d.support.CombinedElevationProvider")],fO);let BP=class MW{static isValidProfile(e){return e in MW.profiles}static getDefaultProfile(){return ie("esri-iPhone")?"low":"medium"}static apply(e,i){const r=MW.profiles[e];i.graphics3D.maxTotalNumberOfFeatures=r.graphics3D.maxTotalNumberOfFeatures,i.graphics3D.maxNumberOfDrawCalls=r.graphics3D.maxNumberOfDrawCalls,i.graphics3D.maxTotalNumberOfVertices=r.graphics3D.maxTotalNumberOfVertices,i.graphics3D.polygonLodFactor=r.graphics3D.polygonLodFactor,i.graphics3D.polylineLodFactor=r.graphics3D.polylineLodFactor,i.graphics3D.snapshotAvailable=r.graphics3D.snapshotAvailable,i.graphics3D.skipHighSymbolLods=r.graphics3D.skipHighSymbolLods,i.graphics3D.uncompressedTextureDownsamplingEnabled=r.graphics3D.uncompressedTextureDownsamplingEnabled;const n=i.sceneService.object,s=r.sceneService.object;n.lodFactor=s.lodFactor,n.lodCrossfadeinDuration=s.lodCrossfadeinDuration,n.lodCrossfadeoutDuration=s.lodCrossfadeoutDuration,n.lodCrossfadeUncoveredDuration=s.lodCrossfadeUncoveredDuration,i.sceneService.point.lodFactor=r.sceneService.point.lodFactor,i.sceneService.integratedMesh.lodFactor=r.sceneService.integratedMesh.lodFactor,i.sceneService.pointCloud.lodFactor=r.sceneService.pointCloud.lodFactor,i.sceneService.uncompressedTextureDownsamplingEnabled=r.sceneService.uncompressedTextureDownsamplingEnabled,i.tiledSurface.lodBias=r.tiledSurface.lodBias,i.tiledSurface.angledSplitBias=r.tiledSurface.angledSplitBias,i.tiledSurface.vtlContentZoom=r.tiledSurface.vtlContentZoom,i.tiledSurface.reduceTileLevelDifferences=r.tiledSurface.reduceTileLevelDifferences,i.tiledSurface.textureFadeDuration=r.tiledSurface.textureFadeDuration,i.heatmap.pixelRatio=r.heatmap.pixelRatio,i.heatmap.maxTotalNumberOfFeatures=r.heatmap.maxTotalNumberOfFeatures,i.fadeDuration=r.fadeDuration,i.antialiasingEnabled=r.antialiasingEnabled,i.physicallyBasedRenderingEnabled=r.physicalBasedRenderingEnabled,i.highQualityTransparency=r.highQualityTransparency,i.highResolutionAtmosphere=r.highResolutionAtmosphere,i.reflections=r.reflections,i.ambientOcclusion=r.ambientOcclusion,i.memoryLimit=r.memoryLimit,i.additionalCacheMemory=r.additionalCacheMemory,i.frameRate=r.frameRate,i.maximumPixelRatio=r.maximumPixelRatio}};BP.test={reset(){const t=zOe();for(const e of Object.keys(t))BP.profiles[e]=t[e]}};const jA={IPhone12Pro:120,GalaxyS20:200,FullHD:240,SurfacePro7:300,FullHDRetina:430};function zOe(){const t=!!ie("esri-mobile"),e=!!ie("ios"),i=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxNumberOfDrawCalls:8e3,maxTotalNumberOfVertices:255e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0,uncompressedTextureDownsamplingEnabled:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{object:{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,vtlContentZoom:.75,reduceTileLevelDifferences:!0,textureFadeDuration:0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200+jA.IPhone12Pro,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:625e4,polygonLodFactor:t?.8:1,polylineLodFactor:t?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:t},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:i},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:t},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,reduceTileLevelDifferences:!ie("disable-feature:reduce-map-tile-levels"),textureFadeDuration:i},fadeDuration:i,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:t?600+jA.GalaxyS20:750+jA.FullHD,additionalCacheMemory:t?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:125e5,polygonLodFactor:t?1.2:2,polylineLodFactor:t?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:i},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,reduceTileLevelDifferences:!ie("disable-feature:reduce-map-tile-levels"),textureFadeDuration:i},fadeDuration:i,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:t?900+jA.SurfacePro7:1500+jA.FullHDRetina,additionalCacheMemory:t?-150:0,frameRate:0,maximumPixelRatio:t?1:1/0}}}(function(t){t.profiles=zOe()})(BP||(BP={}));const w4=BP,BOe=new Pe([0,255,255]),VOe=1,GOe=.25,jOe=new Pe([0,0,0]),HOe=.4,qOe=.2;let Ff=class extends we{constructor(){super(...arguments),this.color=BOe.clone(),this.haloColor=null,this.haloOpacity=VOe,this.fillOpacity=GOe,this.shadowOpacity=HOe,this.shadowColor=jOe.clone(),this.shadowDifference=qOe}};u([p({type:Pe})],Ff.prototype,"color",void 0),u([p({type:Pe})],Ff.prototype,"haloColor",void 0),u([p()],Ff.prototype,"haloOpacity",void 0),u([p()],Ff.prototype,"fillOpacity",void 0),u([p()],Ff.prototype,"shadowOpacity",void 0),u([p({type:Pe})],Ff.prototype,"shadowColor",void 0),u([p()],Ff.prototype,"shadowDifference",void 0),Ff=u([M("esri.views.3d.support.HighlightOptions")],Ff);const WOe=Ff;function Fmt(t,e){return e?{...e,query:{...t??{},...e.query}}:{query:t}}function YOe(t){return typeof t=="string"?Nn(t):Q(t)}function kmt(t,e,i){const r={};for(const n in t){if(n==="declaredClass")continue;const s=t[n];if(s!=null&&typeof s!="function")if(Array.isArray(s)){r[n]=[];for(let o=0;o<s.length;o++)r[n][o]=kmt(s[o])}else if(typeof s=="object")if(s.toJSON){const o=s.toJSON(i?.[n]);r[n]=e?o:JSON.stringify(o)}else r[n]=e?s:JSON.stringify(s);else r[n]=s}return r}function Umt(t){return{geometryType:yM(t[0]),geometries:t.map(e=>e.toJSON())}}function XOe(t,e,i){const r=Qke(e);return t.map(n=>{const s=r.fromJSON(n);return s.spatialReference=i,s})}let zb=class extends pe{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(n=>n.toJSON()),i=this.geometries[0],r={};return r.outSR=R5(this.outSpatialReference),r.inSR=R5(i.spatialReference),r.geometries=JSON.stringify({geometryType:yM(i),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(r.transformForward=this.transformForward),r}};u([p()],zb.prototype,"geometries",void 0),u([p({json:{read:{source:"outSR"}}})],zb.prototype,"outSpatialReference",void 0),u([p()],zb.prototype,"transformation",void 0),u([p()],zb.prototype,"transformForward",void 0),zb=u([M("esri.rest.support.ProjectParameters")],zb);const Cee=zb,zmt=as(Cee);async function ZOe(t,e,i){e=zmt(e);const r=YOe(t),n={...r.query,f:"json",...e.toJSON()},s=e.outSpatialReference,o=yM(e.geometries[0]),a=Fmt(n,i);return _i(r.path+"/project",a).then(({data:{geometries:l}})=>XOe(l,o,s))}async function Aee(t=null,e){if(Di.geometryServiceUrl)return Di.geometryServiceUrl;if(!t)throw new G("internal:geometry-service-url-not-configured");let i;i="portal"in t?t.portal||Ds.getDefault():t,await i.load({signal:e});const r=i.helperServices?.geometry?.url;if(!r)throw new G("internal:geometry-service-url-not-configured");return r}async function Bmt(t,e,i=null,r){const n=await Aee(i,r),s=new Cee;s.geometries=[t],s.outSpatialReference=e;const o=await ZOe(n,s,{signal:r});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new G("internal:geometry-service-projection-failed")}const Vmt=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:Aee,projectGeometry:Bmt},Symbol.toStringTag,{value:"Module"}));let Gmt=class{constructor(e,i){this.spatialReference=i,this.unitInMeters=Da(this.spatialReference,Wi(this.spatialReference).metersPerDegree);const r=e&&"portalItem"in e?e.portalItem:void 0;this._geometryServiceURLPromise=Aee(r).catch(()=>{throw new G("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(e){const i=await this._geometryServiceURLPromise;let r,n=!0;Array.isArray(e[0])&&typeof e[0]!="number"?r=e:(r=[e],n=!1);const s=r.map(l=>l instanceof ut?l:new ut(l,this.spatialReference)),o=new Cee({geometries:s,outSpatialReference:ze.WGS84}),a=(await ZOe(i,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0).filter(l=>!!l);return n?a:a[0]}},wu=class extends we{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxNumberOfDrawCalls=17e3,this.maxTotalNumberOfVertices=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1,this.uncompressedTextureDownsamplingEnabled=!1}};u([p()],wu.prototype,"minTotalNumberOfFeatures",void 0),u([p()],wu.prototype,"maxTotalNumberOfFeatures",void 0),u([p()],wu.prototype,"maxNumberOfDrawCalls",void 0),u([p()],wu.prototype,"maxTotalNumberOfVertices",void 0),u([p()],wu.prototype,"snapshotAvailable",void 0),u([p()],wu.prototype,"polygonLodFactor",void 0),u([p()],wu.prototype,"polylineLodFactor",void 0),u([p()],wu.prototype,"skipHighSymbolLods",void 0),u([p()],wu.prototype,"uncompressedTextureDownsamplingEnabled",void 0),wu=u([M("esri.views.3d.support.QualitySettings.Graphics3DSettings")],wu);let vm=class extends we{constructor(){super(...arguments),this.lodFactor=1}};u([p()],vm.prototype,"lodFactor",void 0),vm=u([M("esri.views.3d.support.QualitySettings.LoDFactorSettings")],vm);let hk=class extends vm{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};hk=u([M("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],hk);let Gg=class extends we{constructor(){super(...arguments),this.object=new hk,this.point=new vm,this.integratedMesh=new vm,this.pointCloud=new vm,this.uncompressedTextureDownsamplingEnabled=!1}};u([p({type:hk})],Gg.prototype,"object",void 0),u([p({type:vm})],Gg.prototype,"point",void 0),u([p({type:vm})],Gg.prototype,"integratedMesh",void 0),u([p({type:vm})],Gg.prototype,"pointCloud",void 0),u([p()],Gg.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Gg=u([M("esri.views.3d.support.QualitySettings.SceneServiceSettings")],Gg);let jg=class extends we{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.vtlContentZoom=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=400}};u([p()],jg.prototype,"lodBias",void 0),u([p()],jg.prototype,"angledSplitBias",void 0),u([p()],jg.prototype,"vtlContentZoom",void 0),u([p()],jg.prototype,"reduceTileLevelDifferences",void 0),u([p()],jg.prototype,"textureFadeDuration",void 0),jg=u([M("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],jg);let F2=class extends we{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};u([p()],F2.prototype,"pixelRatio",void 0),u([p()],F2.prototype,"maxTotalNumberOfFeatures",void 0),F2=u([M("esri.views.3d.support.QualitySettings.HeatmapSettings")],F2);let Ko=class extends we{constructor(){super(...arguments),this.graphics3D=new wu,this.sceneService=new Gg,this.tiledSurface=new jg,this.heatmap=new F2,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.highResolutionAtmosphere=!1,this.reflections=!1,this.ambientOcclusion=!1,this.memoryLimit=750,this.additionalCacheMemory=0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};u([p({type:wu})],Ko.prototype,"graphics3D",void 0),u([p({type:Gg})],Ko.prototype,"sceneService",void 0),u([p({type:jg})],Ko.prototype,"tiledSurface",void 0),u([p({type:F2})],Ko.prototype,"heatmap",void 0),u([p()],Ko.prototype,"fadeDuration",void 0),u([p()],Ko.prototype,"antialiasingEnabled",void 0),u([p()],Ko.prototype,"physicallyBasedRenderingEnabled",void 0),u([p()],Ko.prototype,"highQualityTransparency",void 0),u([p()],Ko.prototype,"highResolutionAtmosphere",void 0),u([p()],Ko.prototype,"reflections",void 0),u([p()],Ko.prototype,"ambientOcclusion",void 0),u([p()],Ko.prototype,"memoryLimit",void 0),u([p()],Ko.prototype,"additionalCacheMemory",void 0),u([p()],Ko.prototype,"frameRate",void 0),u([p()],Ko.prototype,"maximumPixelRatio",void 0),Ko=u([M("esri.views.3d.support.QualitySettings.QualitySettings")],Ko);const Mue=Ko;function jmt(t){return _C(t)&&t.length>=3}function Hmt(t){return(vC(t)||Array.isArray(t))&&t.length>=3}function qmt(t){return jmt(t)||Hmt(t)}let Wmt=class $W{constructor(e,i,r,n){this.viewingMode=e,this.spatialReference=i,this.unitInMeters=r,this._coordinateSystem=n,this._tmpCoordinateSystem=J7e(n)}set extent(e){e&&K7e(this._coordinateSystem,e,this._coordinateSystem)}getAltitude(e){return oGe(this._coordinateSystem,e)}setAltitude(e,i,r=e){return Wbe(this._coordinateSystem,r,i,e)}setAltitudeOfTransformation(e,i){aGe(this._coordinateSystem,i,e,i)}worldUpAtPosition(e,i){return iGe(this._coordinateSystem,e,i)}worldBasisAtPosition(e,i,r){return rGe(this._coordinateSystem,e,i,r)}basisMatrixAtPosition(e,i){const r=this.worldBasisAtPosition(e,an.X,Ne.get()),n=this.worldBasisAtPosition(e,an.Y,Ne.get()),s=this.worldBasisAtPosition(e,an.Z,Ne.get());return zm(i,r[0],r[1],r[2],0,n[0],n[1],n[2],0,s[0],s[1],s[2],0,0,0,0,1),i}headingAtPosition(e,i){const r=this.worldUpAtPosition(e,Ne.get()),n=this.worldBasisAtPosition(e,an.Y,Ne.get()),s=Tbe(i,n,r);return ml(s)}intersectManifoldClosestSilhouette(e,i,r){return _z(this._coordinateSystem,i,this._tmpCoordinateSystem),sGe(this._tmpCoordinateSystem,e,r),r}intersectManifold(e,i,r){_z(this._coordinateSystem,i,this._tmpCoordinateSystem);const n=Ne.get();return nGe(this._tmpCoordinateSystem,e,n)?oe(r,n):null}intersectInfiniteManifold(e,i,r){if(this.viewingMode===Le.Global)return this.intersectManifold(e,i,r);_z(this._coordinateSystem,i,this._tmpCoordinateSystem);const n=this._tmpCoordinateSystem.value,s=Ne.get();return qx(n.plane,e,s)?oe(r,s):null}toRenderCoords(e,i,r){return mF(e)?Wc(e,i,this.spatialReference):ua(e,i,r,this.spatialReference)}fromRenderCoords(e,i,r=null){return mF(i)?(r!=null&&(i.spatialReference=r),S3e(e,this.spatialReference,i)):qmt(i)?ua(e,this.spatialReference,i,r)?i:null:Ay(e,this.spatialReference,i)}static create(e,i){switch(e){case Le.Local:return new $W(Le.Local,i,Da(i),tGe());case Le.Global:return new $W(Le.Global,i,1,eGe(i))}}static renderUnitScaleFactor(e,i){return M7(e)/M7(i)}};var rm;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.BASEMAP=1]="BASEMAP",t[t.I3S_INDEX=2]="I3S_INDEX",t[t.I3S_DATA=3]="I3S_DATA",t[t.SYMBOLOGY=4]="SYMBOLOGY"})(rm||(rm={}));const Ymt=(()=>{const t=new Array;return t[rm.ELEVATION]=10,t[rm.BASEMAP]=10,t[rm.I3S_INDEX]=10,t[rm.I3S_DATA]=10,t[rm.SYMBOLOGY]=5,t})(),Xmt=30;function JOe(t){return"usedMemory"in t&&"unloadedMemory"in t&&"ignoresMemoryFactor"in t}function Zmt(t){return new Qa({view:t})}const $ue=.1,HL=1,DB=1,Jmt=.75,Kmt=.6,Iue=1.3;let Qa=class extends we{constructor(e){super(e),this._quality=1,this._usedMemory=0,this._updating=!1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new rTe,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=750,this._additionalCacheMemory=0,this.addHandles(rx({prepare:()=>this._updateMemory()}))}destroy(){this._cacheStorage.destroy()}get maxMemory(){return this._maxMemory}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(HL),this._maxMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}set additionalCacheMemory(e){e!=null&&(this._additionalCacheMemory=e)}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}get usedCacheMemory(){return this._cacheStorage.size}newCache(e,i){return new WYe(e,this._cacheStorage,i)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<Kmt&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(HL);else if(e)(this._memoryPredicted>1.1*DB||this._usedMemory>DB)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>$ue&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/Iue),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._usedMemory>DB)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/Iue),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._usedMemory<Jmt&&this._quality<HL){this._stableQuality=this._quality;const i=.05;e=this._updateQuality(this._quality+i)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,$ue),HL))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){if(!this.view)return;this.view._stage?.renderer?.tick();let e=(this.view.basemapTerrain?.usedMemory??0)+(this.view._stage?.renderer?.usedMemory??0),i=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(o=>{if(JOe(o)){const a=o.ignoresMemoryFactor?this._quality:1;e+=o.usedMemory*a,i+=o.unloadedMemory*a}});const r=this._warnMemoryUsage==null||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),n=1048576*this.maxMemory;if(e>n&&r){this._warnMemoryUsage=e;const o=l=>(l/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",a=Math.round(100*this._quality);K.getLogger(this).warn(`Memory Limit exceeded! Limit: ${o(n)} Current: ${o(e)} Projected: ${o(e+i)} Quality: ${a}%`)}this._usedMemory=e/n,this._memoryPredicted=(e+i)/n;const s=n-e;this._cacheStorage.maxSize=Math.max(0,s+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const i=e._numQualityChanges;return e._numQualityChanges=0,i}}}};u([p({constructOnly:!0})],Qa.prototype,"view",void 0),u([p()],Qa.prototype,"maxMemory",null),u([p()],Qa.prototype,"additionalCacheMemory",null),u([p({readOnly:!0})],Qa.prototype,"memoryFactor",null),u([p({readOnly:!0})],Qa.prototype,"updating",null),u([p({readOnly:!0})],Qa.prototype,"usedMemory",null),u([p({readOnly:!0})],Qa.prototype,"usedCacheMemory",null),u([p()],Qa.prototype,"_quality",void 0),u([p()],Qa.prototype,"_usedMemory",void 0),u([p()],Qa.prototype,"_updating",void 0),u([p()],Qa.prototype,"_stableQuality",void 0),u([p()],Qa.prototype,"_maxMemory",void 0),u([p()],Qa.prototype,"_additionalCacheMemory",void 0),Qa=u([M("esri.views.3d.support.MemoryController")],Qa);let Qmt=class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}},egt=class{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new tgt}},tgt=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},igt=class{constructor(e,i,r,n){this._workerFunc=e,this._callbackFunc=i,this._maxTotalNumWorkers=r,this._totalNumWorkers=0,this._clients=n.map(s=>new egt(s))}destroy(){this._clients.length=0}hasQuota(e){const i=this._clients[e];return!!i&&(this._totalNumWorkers<this._maxTotalNumWorkers||i.numWorkers+i.tasks.length<i.typeWorkerQuota)}push(e){const i=this._clients[e.client];i&&(this._totalNumWorkers<this._maxTotalNumWorkers?(i.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(r,n)=>this._taskCallback(r,n))):i.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const i=this._clients[e.client];this._totalNumWorkers--,i&&(i.numWorkers--,i.statistics.requests++,i.statistics.size+=e.size||0,i.statistics.duration+=e.duration||0,i.statistics.speed=i.statistics.duration>0?i.statistics.size/i.statistics.duration:0,tt(i.numWorkers>=0)),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(i,r)=>this._taskCallback(i,r)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,i){e._cancelled||(this._callbackFunc(e,i),this._taskFinished(e))}getStatsForType(e){const i=this._clients[e];return i?{quota:i.typeWorkerQuota,workers:i.numWorkers,queueSize:i.tasks.length,requestStats:i.statistics}:null}get test(){const e=this;return{set workerFunc(i){e._workerFunc=i}}}},x4=class extends we{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,i,r){this._loadQueue=new igt((n,s)=>this._startLoading(n,s),(n,s)=>this._doneLoadingCB(n,s),e,i),r&&(this._frameTask=r.registerTask(pt.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=Tr(this._frameTask),this._tasks.forEach(e=>Gc(e.abortController)),this._loadQueue=$e(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,i,r,n={}){const s=Hs();s.__signal=n!=null?n.signal:null;const o=this._createOrUpdateTask(e,i,r,n,s);return Ms(n,()=>this._cancelRequest(o,s)),s.promise}_createTask(e,i,r,n,s,o){const a=new ogt(e,i,r,n,s);return this._updateTask(a,o),this._tasks.set(s,a),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(a),a}_cancelRequest(e,i){WR(e.resolvers,i),i.reject(Ti()),e.resolvers.length===0&&(e.status===Oh.DOWNLOADING&&(e.status=Oh.CANCELLED,this._loadQueue.cancel(e),e.abortController?.abort(),e.request=null,e.abortController=null),e.status=Oh.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,i){e.resolvers.push(i)}_createOrUpdateTask(e,i,r,n,s){const o=agt(n?.uid||e,i,r),a=this._tasks.get(o);return a?(this._updateTask(a,s),a):this._createTask(e,n,i,r,o,s)}_doneLoadingCB(e,i){this._loadQueue&&(tt(e.status===Oh.DOWNLOADING),e.status=Oh.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:i}):this._doneLoading(e,i))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const i=this._onLoadQueue.shift();Tt(i.task.abortController),i.task.abortController=null,i.callback(i.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const i=this._doneQueue.shift();i.task.status!==Oh.DOWNLOADED&&(i.err=i.err||Ti()),this._doneLoading(i.task,i.err),e.madeProgress()}}_doneLoading(e,i){if(i&&!Tn(i)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let r=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const n of e.resolvers)if(i)Tn(i)?n.reject(i):n.reject(new G("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${i}`,{url:e.url,error:i}));else{--r;const s=r>0?Q(e.result):e.result;n.resolve(s)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,i){if(e.status===Oh.CANCELLED)return!1;let r,n;switch(e.startTime=performance.now(),e.status=Oh.DOWNLOADING,e.docType){case"binary":n="array-buffer",r=0;break;case"image":n="image";break;case"image+type":n="array-buffer";break;default:n="json"}e.abortController=new AbortController;const s=e.abortController.signal;e.request=_i(e.url,{...e.options,responseType:n,timeout:r,signal:s});let o=()=>{};const a=c=>{e.duration=performance.now()-e.startTime,e.size=c instanceof ArrayBuffer?c.byteLength:e.size||0,e.result=c,this._frameTask?this._onLoadQueue.push({callback:i,task:e}):(e.abortController=null,i(e))},l=c=>{e.status===Oh.DOWNLOADING&&i(e,c),o()};return e.docType!=="image+type"?(e.request.then(c=>a(c.data),l),!0):(e.request.then(c=>{const h=c.data,d=ngt(h);if(n="image",e.size=h.byteLength,d==="unknown")return e.request=_i(e.url,{responseType:n,timeout:r,signal:s}),void e.request.then(y=>a(y.data),l);const f=new Blob([h],{type:d}),m=window.URL.createObjectURL(f);o=()=>window.URL.revokeObjectURL(m),e.request=_i(m,{responseType:n,timeout:r,signal:s}),e.request.then(y=>a(new Oee(y.data,d,o)),l)},l),!0)}get test(){return{loadQueue:this._loadQueue}}};u([p({readOnly:!0})],x4.prototype,"updating",void 0),x4=u([M("esri.views.3d.support.StreamDataLoader")],x4);const rgt={numRetries:0};function ngt(t){if(t.byteLength<2)return"unknown";const e=new Uint8Array(t,0,t.byteLength);return e[0]===137&&e[1]===80?"image/png":e[0]===71&&e[1]===73?"image/gif":e[0]===66&&e[1]===77?"image/bmp":e[0]===255&&e[1]===216?"image/jpeg":"unknown"}let Oee=class{constructor(e,i,r){this.image=e,this.type=i,this.release=r}get isOpaque(){return this.type==="image/jpeg"}};function sgt(t){return"image"in t&&"type"in t}let ogt=class extends Qmt{constructor(e,i,r,n,s){super(n),this.url=e,this.options=i,this.docType=r,this.key=s,this.result=null,this.status=Oh.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=rgt.numRetries}};function agt(t,e,i){return`${t}:${e}:${i}`}var Oh;(function(t){t[t.QUEUED=1]="QUEUED",t[t.DOWNLOADING=2]="DOWNLOADING",t[t.DOWNLOADED=3]="DOWNLOADED",t[t.CANCELLED=4]="CANCELLED"})(Oh||(Oh={}));let T4=class extends we{constructor(){super(...arguments),this.updating=!1}};function lgt(t){return new Hd({view:t})}u([p({readOnly:!0})],T4.prototype,"updating",void 0),T4=u([M("esri.views.3d.support.ResourceControllerMain")],T4);let Hd=class extends T4{constructor(){super(...arguments),this._immediateTask=zE,this._normalTask=zE,this._updatingObjects=UE([]),this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=BUe(),this._memoryController=Zmt(this.view),this._streamDataLoader=new x4,this._streamDataLoader.setup(Xmt,Ymt,this._scheduler),this.addHandles([ne(()=>this.view.state?.mode,e=>{e!=null&&(this._scheduler.state=e)},Zi),ne(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=rx({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(pt.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(pt.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=Tr(this._frameTask),this._streamDataLoader=$e(this._streamDataLoader),this._memoryController=$e(this._memoryController),this._scheduler=$e(this._scheduler),this.view=null}get updating(){return!!(this._memoryController?.updating||this._streamDataLoader?.updating||this._immediateTask?.updating)||this._updatingObjects?.value.some(e=>e.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const i=this._streamDataLoader;return{request:(r,n,s)=>i.request(r,n,e,s),get busy(){return!i.hasDownloadSlots(e)}}}addUpdatingObject(e){const i=this._updatingObjects;return i.value=[...i.value,e],Vi(()=>{i.value=i.value.filter(r=>r!==e)})}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(DX(e.deltaTime)),!this._scheduler)||(this._memoryController.update(),this._scheduler.updateBudget(e)&&this._scheduler.frame())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){return{getQueueStats:e=>this._streamDataLoader.test.loadQueue.getStatsForType(e)}}};u([p()],Hd.prototype,"view",void 0),u([p()],Hd.prototype,"_scheduler",void 0),u([p()],Hd.prototype,"_memoryController",void 0),u([p()],Hd.prototype,"_streamDataLoader",void 0),u([p()],Hd.prototype,"_immediateTask",void 0),u([p()],Hd.prototype,"_normalTask",void 0),u([p()],Hd.prototype,"_updatingObjects",void 0),u([p({readOnly:!0})],Hd.prototype,"updating",null),Hd=u([M("esri.views.3d.support.ResourceControllerImpl")],Hd);function cgt(t){return JOe(t)}function ugt(t){return"performanceInfo"in t}var Sa,at;(function(t){t[t.INSIDE=0]="INSIDE",t[t.INTERSECTS=1]="INTERSECTS",t[t.OUTSIDE=2]="OUTSIDE"})(Sa||(Sa={})),function(t){t[t.NORTH=0]="NORTH",t[t.NORTH_EAST=1]="NORTH_EAST",t[t.EAST=2]="EAST",t[t.SOUTH_EAST=3]="SOUTH_EAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTH_WEST=5]="SOUTH_WEST",t[t.WEST=6]="WEST",t[t.NORTH_WEST=7]="NORTH_WEST"}(at||(at={}));const iS=E(),hgt=E(),cg=E(),ug=E();function dgt(t,e,i=0){const r=t.extent;if(r==null)return!1;if(i===0)return E0e(r,e);const n=Math.min(r[2]-r[0],r[3]-r[1]);return Uke(r,e,i*n)}function qL(t,e,i,r){oe(iS,i),iS[r]=e[r];const n=de(iS,iS,e),s=de(hgt,t,e),o=ge(s,n),a=ge(n,n);let l;l=o<=0?e:a<=o?i:ue(iS,e,re(n,n,o/a));const c=de(iS,t,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function pgt(t,e,i){const r=t.extent;if(r==null)return 0;cg[0]=r[0],cg[1]=r[1],cg[2]=i,ug[0]=r[2],ug[1]=r[3],ug[2]=i;let n=1/0,s=1/0;return e[0]<cg[0]?n=qL(e,cg,ug,0):e[0]>ug[0]&&(n=qL(e,ug,cg,0)),e[1]<cg[1]?s=qL(e,cg,ug,1):e[1]>ug[1]&&(s=qL(e,ug,cg,1)),Math.min(n,s)}function fgt(t,e,i){if(t==null)return lK();if(t.spatialReference.isGeographic&&!Ev(t.spatialReference))return new G("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const r=$c.checkUnsupported(t);if(r!=null)return r;if(i==null)return new G("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const n=mgt(t,i);if(n)return n;const s=t.spatialReference;return e==null||s.equals(e)||e.isWGS84&&s.isWebMercator?null:new G("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")}function mgt(t,e){const i=t.lods,r=i[0].resolution*2**i[0].level,n=[r*t.size[0],r*t.size[1]],s=[t.origin.x,t.origin.y],o=S0e(e),a=Zt();$c.computeRowColExtent(o,n,s,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>O2){const c=i[0].scale*2**i[0].level;let h=Math.max((o[3]-o[1])/t.size[1],(o[2]-o[0])/t.size[0])*c/r;const d=Math.floor(Math.log(h)/Math.log(10));return h=Math.ceil(h/10**d)*10**d,new G("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+h.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:h,requiredNumRootTiles:l,allowedNumRootTiles:O2})}return null}const ggt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:fgt,isInsideExtent:dgt,tiltToExtentEdge:pgt},Symbol.toStringTag,{value:"Module"}));function ygt(){return!0}function _gt(){return 0}function vgt(t,e){if(t==null)return lK();const i=t.lods.length-1,r=t.spatialReference,n=Ev(r)||km(r)||Um(r);if(r.isWebMercator){if(!$c.makeWebMercatorAuxiliarySphere(i).compatibleWith(t))return new G("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!n)return new G("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!$c.makeGCSWithTileSize(t.spatialReference,t.size[0],i).compatibleWith(t))return t.spatialReference.isWGS84?new G("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new G("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return e==null||t.spatialReference.equals(e)?void 0:new G("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const bgt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:vgt,isInsideExtent:ygt,tiltToExtentEdge:_gt},Symbol.toStringTag,{value:"Module"})),wgt={[Le.Global]:bgt,[Le.Local]:ggt};function Wf(t,e){t||console.warn("Terrain: "+e)}let Ns=!1,dk=!1;function xgt(t){dk=t,Ns=Ns||t}function Tgt(t){Ns=t}function Se(t,e){if(Ns&&!t){const i=new Error().stack?.slice(5);throw console.warn("Terrain internal: "+(e??"")+" at "+i),new Error("Assertion failed"+(e?": "+e:""))}}function IW(t){return h8(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale,tilemapCache:null}:t.layer}function pk(t){return t?.type==="imagery-tile"||t?.type==="wcs"}function h8(t){return t?.type==="imagery-tile-3d"}function Ree(t){return t?.type==="tile-3d"}function pC(t){return t?.type==="vector-tile-3d"}function KOe(t){return t?.type==="wmts-3d"}function LW(t){return t?.type==="elevation-3d"}function HA(t){return t?.type==="group"}function VP(t){return t&&(Ree(t)||KOe(t)||h8(t)||pC(t))}function DW(t){return t&&(Ree(t)||h8(t)||pC(t)||KOe(t))}function GP(t){return DW(t)||LW(t)}function Sgt(t){const e=t?.sourceLayerInfo?.data;return e!=null&&"type"in e&&e.type==="raster-tile"}function Egt(t){return QOe(t?.sourceLayerInfo)||!!t?.isVTLBackground}function Cgt(t){const e=t?.sourceLayerInfo?.data;return e!=null&&"type"in e&&e.type==="tile-texture"}function Agt(t){const e=t?.sourceLayerInfo?.data;return e instanceof HTMLImageElement||e instanceof Oee||e instanceof HTMLCanvasElement||e instanceof ImageData}function QOe(t){return t?.data!=null&&"type"in t.data&&t.data.type==="vector-tile"}function hE(t){return t!=null&&"release"in t&&t.release(),null}function Lue(t){return t.fetchTile&&t.hasOverriddenFetchTile!==!1}function Pee(t,e,i,r){return wgt[r].checkIfTileInfoSupportedForViewSR(t,i,e)}function d8(t,e,i){let r=null,n=null;if(t?.type==="wmts"){const s=Ogt(t,e,i);r=s.tileInfo,n=s.fullExtent}else{n=pk(t)?t.getCompatibleFullExtent(e):t.fullExtent;const s=i===Le.Local;if(pk(t))r=t.getCompatibleTileInfo(e,n,s);else if(t?.type==="vector-tile"){const o=s&&!Rgt(e)||Pgt.force512VTL,a=t.tileInfo.spatialReference.isGeographic;r=o?t.tileInfo:t.tileInfo.getOrCreateCompatible(256,a?1:2)}else r=t.tileInfo}return r!=null&&n!=null&&Pee(r,n,e,i)==null?{tileInfo:r,fullExtent:n}:null}function Ogt(t,e,i){const r=E5e(t);if(r!=null){if(!Je.isCollection(r))return{tileInfo:r.tileInfo,fullExtent:r.fullExtent};{const n=r.find(s=>Pee(s.tileInfo,s.fullExtent,e,i)==null);if(n)return{tileInfo:n.tileInfo,fullExtent:n.fullExtent}}}return{tileInfo:null,fullExtent:null}}function Rgt(t){return t.isWGS84||t.isWebMercator||aye(t)||!EE(t)}const Pgt={force512VTL:!1};function Due(t){return"["+t[0]+","+t[1]+","+t[2]+"]"}function hg(t){return"("+t[0]+","+t[1]+","+t[2]+")"}function Gh(t,e,i=Igt){return Math.abs(t-e)<i}function fk(t){return t===at.NORTH_EAST?at.SOUTH_WEST:t===at.NORTH_WEST?at.SOUTH_EAST:t===at.SOUTH_WEST?at.NORTH_EAST:at.NORTH_WEST}function Mee(t){return t===at.NORTH?at.SOUTH:t===at.EAST?at.WEST:t===at.SOUTH?at.NORTH:at.EAST}function Mgt(t){return t===at.NORTH_WEST||t===at.SOUTH_WEST}function $gt(t){return t===at.NORTH_WEST||t===at.NORTH_EAST}function Nue(t){return t===at.NORTH_WEST||t===at.WEST||t===at.SOUTH_WEST}function Fue(t){return t===at.NORTH_EAST||t===at.EAST||t===at.SOUTH_EAST}function kue(t){return t===at.SOUTH_EAST||t===at.SOUTH||t===at.SOUTH_WEST}function Uue(t){return t===at.NORTH_EAST||t===at.NORTH||t===at.NORTH_WEST}const sy=[at.NORTH,at.EAST,at.SOUTH,at.WEST],mk=[at.NORTH_EAST,at.SOUTH_EAST,at.SOUTH_WEST,at.NORTH_WEST],Igt=1e-5;let Lgt=class{constructor(e,i){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer,this.memory=GP(e)?i.basemapTerrain.getUsedMemoryForLayerView(e):e.usedMemory,ugt(e)){const r=e.performanceInfo;this.displayedNumberOfFeatures=r.displayedNumberOfFeatures,this.maximumNumberOfFeatures=r.maximumNumberOfFeatures,this.totalNumberOfFeatures=r.totalNumberOfFeatures}}},Dgt=class{constructor(e){if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,this.cachedMemory=0,this.fboMemory=0,e.resourceController!=null){const i=e.resourceController.memoryController;this.totalMemory=(i.maxMemory??0)*nF.MEGABYTES,this.usedMemory=Math.round(i.usedMemory*this.totalMemory),this.quality=e.quality,this.load=e.resourceController.scheduler.load,this.cachedMemory=i.usedCacheMemory}this.terrainMemory=e.basemapTerrain?.usedMemory??0,this.edgesMemory=e?._stage?.renderer?.edgeView?.usedMemory??0,this.fboMemory=e?._stage?.renderer?.memoryInfo?.fbos??0,e.allLayerViews.items.forEach(i=>{(cgt(i)||GP(i))&&this.layerPerformanceInfos.push(new Lgt(i,e))}),this.layerPerformanceInfos.sort((i,r)=>r.memory-i.memory)}},Ngt=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",()=>{}),this._wosrMemCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,i,r){const n=r?`gltfPBR:${e}`:`gltf:${e}`,s=this._gltfMemCache.get(n);return s!=null?Promise.resolve(s):this._loadOnce(this._gltfLoading,this._gltfMemCache,n,o=>Z3e(new Y3e(o.streamDataRequester),e,o,r),i)}loadWOSR(e,i){const r=`wosr:${e}:${i.disableTextures}`,n=this._wosrMemCache.get(r);return n!=null?Promise.resolve(n):this._loadOnce(this._wosrLoading,this._wosrMemCache,r,s=>J3e(e,s),i)}async _loadOnce(e,i,r,n,s){Tt(s);const o=Ms(s,()=>this._abortLoad(e,r));let a=e.get(r);if(a)a.refCount++;else{const l=new AbortController;a={refCount:1,abortController:l,promise:n({...s,signal:l.signal})},e.set(r,a)}try{const l=await a.promise;return i.put(r,l,l.size),e.delete(r),Tt(s),l}finally{Tr(o)}}_abortLoad(e,i){const r=e.get(i);r!=null&&--r.refCount>0||(e.delete(i),r?.abortController.abort())}},k2=class extends we{constructor(e,i){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=i?.registerTask(pt.TEXTURE_UNLOAD)??zE}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask?.remove(),this._textureRequests?.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests?.clear()}get updating(){return this._frameTask.updating}fromData(e,i){const r=this.makeUid(e);let n=this._textureRequests.get(r);if(!n){const s=new eRe;s.texture=i(),this._stage&&(s.texture.load(this._stage.renderView.renderingContext),this._stage.add(s.texture)),this._textureRequests.set(r,s),n=s}return n.referenceCount++,{uid:r,texture:n.texture,release:()=>this._release(r)}}_release(e){const i=this._textureRequests.get(e);i?(i.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),i.referenceCount--,i.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const i=this._textureRequests.get(e);!i||i.referenceCount>0||(i.texture?.unload(),this._releaseTextureRequest(i),this._textureRequests.delete(e))}_releaseTextureRequest(e){e.texture?this._stage?.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,i=null){return i!=null?`${e}.${i}px`:e}};u([p()],k2.prototype,"_frameTask",void 0),u([p()],k2.prototype,"updating",null),k2=u([M("esri.views.3d.support.TextureCollection")],k2);let eRe=class{constructor(){this.referenceCount=0}},Fgt=class extends k2{constructor(e,i,r){super(i,r),this._streamDataRequester=e}async fromUrl(e,i,r){Tt(r);const n=r!=null?r.signal:null,s=this.makeUid(e,i);let o=this._textureRequests.get(s);if(!o){const a=new AbortController,l=this._streamDataRequester.request(e,"image",{uid:s,signal:a.signal});o=new eRe,o.abortController=a;const c=o;this._textureRequests.set(s,o),o.textureAsync=l.then(async h=>{const d=this._createTexture(e,h,i);return c.texture=d,c.abortController=null,await d.load(this._stage.renderView.renderingContext),this._stage.add(d),{uid:s,texture:d,release:()=>this._release(s)}},h=>{throw c.abortController=null,h})}o.referenceCount++;try{return await GLe(o.textureAsync,n)}catch(a){throw this._release(s),a}}_createTexture(e,i,r){const n={width:i.width,height:i.height,wrap:{s:Vt.CLAMP_TO_EDGE,t:Vt.CLAMP_TO_EDGE},preMultiplyAlpha:!0,reloadable:!0};if(Vge(e)){if(r||i.width===0&&i.height===0){const s=i.width?i.height/i.width:1;r=r||64,s>1?(i.width=Math.round(r/s),i.height=r):(i.width=r,i.height=Math.round(r*s))}this._stage.renderView?.renderingContext.driverTest.svgPremultipliesAlpha.result&&(n.preMultiplyAlpha=!1)}return new iT(i,n)}},kgt=class{constructor(e){this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester(rm.SYMBOLOGY),this.objectResourceCache=new Ngt((r,n)=>e.resourceController.memoryController.newCache(r,n)),this.textures=new Fgt(this.streamDataRequester,e.view._stage,e.resourceController.scheduler);const i=Wi(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=O2e(e.viewingMode,i),this.screenSizePerspectiveSettingsLabels=xtt(e.viewingMode,i)}destroy(){this.textures.destroy(),this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return Vi();this._graphicsOwners.push(e);const i=ne(()=>e.layer?.screenSizePerspectiveEnabled,()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),Vi(()=>{i.remove(),WR(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some(i=>i.layer?.screenSizePerspectiveEnabled===!0);if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new Ny;const i=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([ne(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,i,Zi),this._viewState.events.on("camera-projection-changed",i)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=$e(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;WL.distance=e.centerOnSurfaceInfrequent.distance,WL.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(WL),this.screenSizePerspectiveSettingsLabels.update(WL),this._view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}};const WL={distance:0,fovY:0};let t2=class{constructor(e,i,r=""){this.graphics=e,this._symbol=new ry({symbolLayers:new Je([new sm({material:{color:i},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new Uy({text:r,halo:{color:"white",size:1/.75},material:{color:i},size:12})])})}show(e,i){if(i==null)return;this.hide();const r=new ut({x:e[0],y:e[1],z:e[2],spatialReference:i});this._graphic=new vx({geometry:r,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){this._graphic!=null&&(this.graphics.remove(this._graphic),this._graphic=null)}},z_=class extends we{constructor(e){super(e)}};u([p({constructOnly:!0})],z_.prototype,"renderCoordsHelper",void 0),u([p({constructOnly:!0})],z_.prototype,"surface",void 0),u([p({constructOnly:!0})],z_.prototype,"state",void 0),z_=u([M("esri.views.3d.support.PointOfInterest")],z_);const Ugt=Array;let qd=class extends z_{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new Ry({location:ut,renderLocation:Ugt},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=E(),this._tmpPoint=new ut}initialize(){if(this.scheduler&&this.addHandles(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.addHandles(bo(()=>this.map?.ground?.layers,"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=$e(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,i=Mr(e.eye,this.renderLocation),r={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return wx(r,i,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map?.ground)return this._updateSurfaceAltitude(0),ca.YIELD;const e=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint,e);const i=(this._tmpPoint.z??0)>zgt&&this.renderCoordsHelper.viewingMode===Le.Global&&(e.isWGS84||e.isWebMercator);let r=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:r.signal,cache:this.cache,minDemResolution:i?Bgt:0}).then(n=>this._updateSurfaceAltitude(n.geometry.z??0)).catch(n=>{Tn(n)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===r&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),r=null}),this._pendingElevationQueryController=r,ca.YIELD}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(NB,this._estimatedSurfaceAltitude,this._camera.eye),oa(this._get("renderLocation"),NB)||(this._set("renderLocation",oe(this._propertiesPool.get("renderLocation"),NB)),this.notifyChange("renderLocation"))}};u([p({constructOnly:!0})],qd.prototype,"scheduler",void 0),u([p({constructOnly:!0})],qd.prototype,"cache",void 0),u([p({constructOnly:!0})],qd.prototype,"task",void 0),u([p({readOnly:!0})],qd.prototype,"location",null),u([p({constructOnly:!0})],qd.prototype,"map",void 0),u([p({readOnly:!0})],qd.prototype,"renderLocation",void 0),u([p({readOnly:!0})],qd.prototype,"scale",null),u([p({readOnly:!0})],qd.prototype,"updating",null),qd=u([M("esri.views.3d.support.CameraOnSurface")],qd);const NB=E(),zgt=1e5,Bgt=1e6,Vgt=Array;let Rh=class extends z_{constructor(e){super(e),this._propertiesPool=new Ry({location:ut,renderLocation:Vgt},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=E(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=Tr(this._frameWorker),this._propertiesPool=$e(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,ca.YIELD}_updateRenderLocation(){const e=jgt;let i=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const r=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!i&&r&&(i=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),i&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const n=Hgt;i&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,n)&&(oe(e,n),this._currentSurfaceAltitude=this._latestSurfaceAltitude),i?this.distance=Mr(this._camera.eye,e):(re(e,this._camera.viewForward,this._get("distance")),ue(e,e,this._camera.eye)),oa(this._get("renderLocation"),e)||this._set("renderLocation",oe(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,i){const r=this._camera;if(!this.renderCoordsHelper.intersectInfiniteManifold(r.ray,e,i))return!1;if(this.state.isGlobal){const n=Wi(this.renderCoordsHelper.spatialReference).radius,s=n+e,o=na(r.eye),a=o<s*s,l=Mr(r.eye,i);if(a&&l>n/4){const c=s-Math.sqrt(o);return re(i,r.viewForward,c),ue(i,i,r.eye),!0}}else{const n=this.surface?.ready?this.surface.extent:null;n!=null&&K6(n,this.surface?.spatialReference,qA,this.renderCoordsHelper.spatialReference)&&(i[0]=_e(i[0],qA[0],qA[2]),i[1]=_e(i[1],qA[1],qA[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,i){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,i)){if(pr.TESTS_DISABLE_OPTIMIZATIONS)return!0;const r=this._camera.eye,n=Mr(r,e),s=Mr(r,i);if(Math.abs(s-n)/n>Ggt)return!0}return!1}};u([p({constructOnly:!0})],Rh.prototype,"scheduler",void 0),u([p({constructOnly:!0})],Rh.prototype,"task",void 0),u([p()],Rh.prototype,"distance",void 0),u([p({constructOnly:!0})],Rh.prototype,"estimateSurfaceAltitudeAtCenter",void 0),u([p({readOnly:!0})],Rh.prototype,"location",null),u([p({readOnly:!0})],Rh.prototype,"renderLocation",void 0),u([p()],Rh.prototype,"updating",void 0),Rh=u([M("esri.views.3d.support.CenterOnSurface")],Rh);const Ggt=.05,jgt=E(),Hgt=E(),qA=Zt();let qgt=class{constructor(e){this._handles=new Ny,this.events=new Sn,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",i=>this._layerViewsChanged(i))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=$e(this._handles),this._contentLayerViews.destroy()}_layerViewsChanged(e){e.added.forEach(i=>{i.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(i.on("visible-geometry-changed",()=>this._contentChanged()),i.uid)}),e.removed.forEach(i=>this._handles.remove(i.uid))}_contentChanged(){this.events.emit("request-update",Wgt)}};const Wgt={},Ygt=Array;let kf=class extends z_{constructor(e){super(e),this._propertiesPool=new Ry({location:ut,renderLocation:Ygt},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.addHandles([ne(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),ne(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.addHandles(this.scheduler.registerTask(pt.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=$e(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),i=this.centerOnSurface.renderLocation,r=this.renderCoordsHelper,n=this.state.contentCamera;this._dirty=!1,r.worldUpAtPosition(i,zue);const s=Math.max(0,(Math.acos(ge(zue,n.viewForward))-.5*Math.PI)*(n.aboveGround?1:-1));if(Number.isNaN(s)){if(!e||!hx(e,i)){const c=this._propertiesPool.get("renderLocation");oe(c,i),this._set("renderLocation",c)}return ca.YIELD}const o=1-_e(s/(.5*Math.PI),0,1),a=o*o*o;this._calculateScreenHorizontalEdgeOnSurface(Bue);const l=this._propertiesPool.get("renderLocation");return Xi(l,i,Bue,a),e&&hx(e,l)||this._set("renderLocation",l),ca.YIELD}_calculateScreenHorizontalEdgeOnSurface(e){const i=this.state.contentCamera,r=i.getRenderCenter(aa());if(r[1]=i.aboveGround?i.padding[ii.BOTTOM]:i.fullHeight-i.padding[ii.TOP],this.estimateSurfaceIntersectionAtRenderPoint(r,e))return e;const n=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(i.unprojectFromRenderScreen(r,WA)){de(WA,WA,i.eye);const s=ye(WA,WA);if(this.renderCoordsHelper.intersectInfiniteManifold(th(i.eye,s),n,e))return e}return this.renderCoordsHelper.setAltitude(e,n,i.eye)}updateRenderLocation(){this._dirty=!0}};u([p()],kf.prototype,"_dirty",void 0),u([p({constructOnly:!0})],kf.prototype,"scheduler",void 0),u([p({constructOnly:!0})],kf.prototype,"centerOnSurface",void 0),u([p({constructOnly:!0})],kf.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),u([p({readOnly:!0})],kf.prototype,"updating",null),u([p({readOnly:!0})],kf.prototype,"location",null),u([p({readOnly:!0})],kf.prototype,"renderLocation",void 0),kf=u([M("esri.views.3d.support.pointsOfInterest.Focus")],kf);const zue=E(),WA=E(),Bue=E();let Pg=class extends we{get surface(){return this.view.map?.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=E();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null}initialize(){this.view.state.isLocal&&(this.addHandles([ne(()=>[this.surfaceView?.spatialReference,this.surfaceView?.extent],()=>this._update()),bo(()=>this.surface?.layers,"change",()=>this._update())]),this._update())}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),this.surfaceView?.extent==null||this.surfaceView.spatialReference==null)return void this._set("location",null);const e=OZ(this.surfaceView.extent),i=new ut({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(i,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(r=>{this._updateController=null,this._set("location",r.geometry)}).catch(r=>{Tn(r)||r&&r.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",r)})):this._set("location",i)}};u([p({constructOnly:!0})],Pg.prototype,"view",void 0),u([p({constructOnly:!0})],Pg.prototype,"cache",void 0),u([p()],Pg.prototype,"surface",null),u([p()],Pg.prototype,"surfaceView",null),u([p({readOnly:!0})],Pg.prototype,"location",void 0),u([p({readOnly:!0})],Pg.prototype,"renderLocation",null),Pg=u([M("esri.views.3d.terrain.StableSurfaceCenter")],Pg);let Mg=class extends we{constructor(e){super(e),this._tileGeometryUpdateExtent=id(),this._tileGeometryUpdateSpatialReference=null,this.events=new Sn,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(pt.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",Xgt),id(this._tileGeometryUpdateExtent),this._set("updating",!1)),ca.YIELD}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,lv(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let i=1;i<this.centerOnSurfaces.length;i++){const r=this.centerOnSurfaces[i];r.distance>e.distance&&(e=r)}return e}_centerIntersectsExtent(e,i){const r=this.state.contentCamera.eye,n=Zgt,s=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(r,q1,i),this.renderCoordsHelper.fromRenderCoords(s.renderLocation,W1,i),q1[0]<W1[0]?(n[0]=q1[0],n[2]=W1[0]):(n[0]=W1[0],n[2]=q1[0]),q1[1]<W1[1]?(n[1]=q1[1],n[3]=W1[1]):(n[1]=W1[1],n[3]=q1[1]),I6(n,e)}};u([p({constructOnly:!0})],Mg.prototype,"state",void 0),u([p({constructOnly:!0})],Mg.prototype,"centerOnSurfaces",void 0),u([p({constructOnly:!0})],Mg.prototype,"renderCoordsHelper",void 0),u([p({constructOnly:!0})],Mg.prototype,"scheduler",void 0),u([p({constructOnly:!0})],Mg.prototype,"surface",void 0),u([p({readOnly:!0})],Mg.prototype,"updating",void 0),Mg=u([M("esri.views.3d.support.SurfaceGeometryUpdates")],Mg);const Xgt={},q1=E(),W1=E(),Zgt=id();let Fl=class extends we{constructor(e){super(e),this._handles=new Ny,this._tmpRay=js(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new Ry({renderPointOfView:Jgt},this),this.renderPointOfView=E(),this._pois=new Array,this._debugCenters=new Map}initialize(){const{state:e,basemapTerrain:i,renderCoordsHelper:r,map:n}=this.view;this._surfaceIntersector=sd(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=Bo.MIN,this._contentIntersector=sd(e.viewingMode);const s=()=>this._estimateSurfaceAltitudeAtCenter(),o=this.view.resourceController.scheduler,a=this.view.basemapTerrain?.elevationQueryCache,l={state:e,scheduler:o,surface:i,renderCoordsHelper:r};this._set("centerOnSurfaceInfrequent",new Rh({...l,task:pt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnSurfaceFrequent",new Rh({...l,task:pt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnContent",new Rh({...l,task:pt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new qd({...l,cache:a,task:pt.POINT_OF_INTEREST_INFREQUENT,map:n})),this._set("surfaceGeometryUpdates",new Mg({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new qgt({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:r})),this._set("surfaceOrigin",new Pg({cache:a,view:this.view})),this._set("focus",new kf({state:e,scheduler:o,surface:i,renderCoordsHelper:r,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(h,d)=>this._estimateSurfaceIntersectionAtRenderPoint(h,this.view.state.contentCamera,d)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const c=this.view.graphics;this._debugCenters.set(this.centerOnContent,new t2(c,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new t2(c,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new t2(c,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new t2(c,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new t2(c,"green","Focus")),this._handles.add([ne(()=>e.contentCamera,h=>this._cameraChanged(h),Zi),ne(()=>i.extent,()=>this._updateCenterPointsOfInterest()),gl(()=>!i.updating,()=>this._updateCenterPointsOfInterest(),Zi),bo(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),bo(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),gl(()=>pr.SHOW_POI,h=>this._setDebug(h),Xt)]),this._cameraChanged(this.view.state.contentCamera);for(const h of this._pois)h.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){return!(!this.surfaceGeometryUpdates?.updating&&!this._pois.some(e=>e.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return e==null||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,rS,Qgt)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(rS):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(e==null)return this._surfaceAltitudeAtCenter;const i=e.origin,r=ue(rS,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,i,r),this._surfaceIntersector.results.min.getIntersectionPoint(rS)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(rS)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,i,r){const n=KK(i,e,Kgt);if(n==null)return null;const s=n.origin,o=ue(rS,n.origin,n.direction);return this._surfaceIntersector.resetWithRay(n,i),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,s,o),this._surfaceIntersector.results.min.getIntersectionPoint(r)?r:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const i=e.eye;oa(this.renderPointOfView,i)||this._set("renderPointOfView",oe(this._propertiesPool.get("renderPointOfView"),i))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(i=>i.hide()),void this._handles.remove("debug");for(const i of this._pois)this._handles.add(ne(()=>i.renderLocation,r=>this._debugCenters.get(i)?.show(r,i.renderCoordsHelper.spatialReference),Xt),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};u([p({readOnly:!0})],Fl.prototype,"centerOnContent",void 0),u([p({readOnly:!0})],Fl.prototype,"centerOnSurfaceFrequent",void 0),u([p({readOnly:!0})],Fl.prototype,"centerOnSurfaceInfrequent",void 0),u([p({readOnly:!0})],Fl.prototype,"cameraOnSurface",void 0),u([p({readOnly:!0})],Fl.prototype,"focus",void 0),u([p({readOnly:!0})],Fl.prototype,"renderPointOfView",void 0),u([p({readOnly:!0})],Fl.prototype,"surfaceOrigin",void 0),u([p({readOnly:!0})],Fl.prototype,"contentGeometryUpdates",void 0),u([p({readOnly:!0})],Fl.prototype,"surfaceGeometryUpdates",void 0),u([p({constructOnly:!0})],Fl.prototype,"view",void 0),u([p({readOnly:!0})],Fl.prototype,"updating",null),Fl=u([M("esri.views.3d.support.PointsOfInterest")],Fl);const Jgt=Array,rS=E(),Kgt=js(),Qgt={exclude:new Set([F_])},ih=(t=>t)(["operational-layers","basemap","ground"]),iv=new Je,MR=new WeakMap;function eyt(t){iyt(t)&&iv.push(new WeakRef(t))}function tyt(t){const e=iv.find(i=>i.deref()===t);e&&iv.remove(e)}function iyt(t){return t!=null&&typeof t=="object"&&"refreshInterval"in t&&"refresh"in t}function tRe(t,e){return Number.isFinite(t)&&Number.isFinite(e)?e<=0?t:tRe(e,t%e):0}let FB=0,YL=0;function ryt(){const t=Date.now();let e=!1;for(const i of iv){const r=i.deref();r?r.refreshInterval&&t-(MR.get(r)??0)+5>=6e4*r.refreshInterval&&(MR.set(r,t),r.refresh(t)):e=!0}if(e)for(let i=iv.length-1;i>=0;i--)iv.at(i).deref()||iv.removeAt(i)}nge(()=>{const t=Date.now();let e=0;for(const i of iv){const r=i.deref();r&&(e=tRe(Math.round(6e4*r.refreshInterval),e),r.refreshInterval?MR.get(r)||MR.set(r,t):MR.delete(r))}if(e!==YL){if(YL=e,clearInterval(FB),YL===0)return void(FB=0);FB=setInterval(ryt,YL)}});function nyt(t){return t!=null&&typeof t=="object"&&"refreshTimestamp"in t&&"refresh"in t}const Vue=.1,syt=t=>{let e=class extends t{constructor(...i){super(...i),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=aM(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||eyt(this)},()=>{})}destroy(){tyt(this)}castRefreshInterval(i){return i>=Vue?i:i<=0?0:Vue}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(i=Date.now()){YR(this._debounceHasDataChanged()).then(r=>{r&&this._set("refreshTimestamp",i),this.emit("refresh",{dataChanged:r})},r=>{K.getLogger(this).error(r),this.emit("refresh",{dataChanged:!1,error:r})})}async hasDataChanged(){return!0}get test(){const i=this;return{set refreshInterval(r){i._set("refreshInterval",r)}}}};return u([p({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:ih}}}}})],e.prototype,"refreshInterval",void 0),u([ai("refreshInterval")],e.prototype,"castRefreshInterval",null),u([p({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),u([p({readOnly:!0})],e.prototype,"refreshParameters",null),e=u([M("esri.layers.mixins.RefreshableLayer")],e),e};let oyt=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,i){this._store.put(e,i,i.values.byteLength+256)}},ayt=class{constructor(e,i,r,n){this._hasNoDataValues=null,this._minValue=null,this._maxValue=null,"pixelData"in e?(this.values=e.pixelData,this.width=e.width,this.height=e.height,this.noDataValue=e.noDataValue):(this.values=e,this.width=i,this.height=r,this.noDataValue=n)}get hasNoDataValues(){if(this._hasNoDataValues==null){const e=this.noDataValue;this._hasNoDataValues=this.values.includes(e)}return this._hasNoDataValues}get minValue(){return this._ensureBounds(),this._minValue}get maxValue(){return this._ensureBounds(),this._maxValue}_ensureBounds(){if(this._minValue!=null)return;const{noDataValue:e,values:i}=this;let r=1/0,n=-1/0,s=!0;for(const o of i)o===e?this._hasNoDataValues=!0:(r=o<r?o:r,n=o>n?o:n,s=!1);s?(this._minValue=0,this._maxValue=0):(this._minValue=r,this._maxValue=n>-3e38?n:0)}},iRe=class{constructor(e,i,r,n,s={}){this._mainMethod=i,this._transferLists=r,this._listeners=[],this._promise=HVe(e,{...s,schedule:n}).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,s.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>K.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${o}`))}on(e,i){const r={removed:!1,eventName:e,callback:i,threadHandle:null};return this._listeners.push(r),this._connectListener(r),Vi(()=>{r.removed=!0,CX(this._listeners,r),this._thread&&r.threadHandle!=null&&r.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(e,i){return this.invokeMethod(this._mainMethod,e,i)}invokeMethod(e,i,r){if(this._thread){const n=this._transferLists[e],s=n?n(i):[];return this._thread.invoke(e,i,{transferList:s,signal:r})}return this._promise?this._promise.then(()=>(Tt(r),this.invokeMethod(e,i,r))):Promise.reject(null)}broadcast(e,i){return this._thread?Promise.all(this._thread.broadcast(i,e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,i)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(i=>{e.removed||(e.threadHandle=i)})}},Gue=class extends iRe{constructor(e=null){super("LercWorker","_decode",{_decode:i=>[i.buffer]},e,{strategy:"dedicated"}),this.schedule=e,this.ref=0}decode(e,i,r){return e&&e.byteLength!==0?this.invoke({buffer:e,options:i},r):Promise.resolve(null)}release(){--this.ref<=0&&($R.forEach((e,i)=>{e===this&&$R.delete(i)}),this.destroy())}};const $R=new Map;function lyt(t=null){let e=$R.get(t);return e||(t!=null?(e=new Gue(i=>t.immediate.schedule(i)),$R.set(t,e)):(e=new Gue,$R.set(null,e))),++e.ref,e}var Pc,jue,Hue;(function(t){t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(Pc||(Pc={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.OUTLINE=2]="OUTLINE",t[t.LINE=3]="LINE",t[t.ICON=4]="ICON",t[t.CIRCLE=5]="CIRCLE",t[t.TEXT=6]="TEXT",t[t.TILEINFO=7]="TILEINFO"}(jue||(jue={})),function(t){t[t.PAINTER_CHANGED=0]="PAINTER_CHANGED",t[t.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",t[t.LAYER_CHANGED=2]="LAYER_CHANGED",t[t.LAYER_REMOVED=3]="LAYER_REMOVED",t[t.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(Hue||(Hue={}));let cyt=class{constructor(e){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}},_9t=class{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}};function b9t(t,e,i,r,n,s){const o=i-n;if(o>=0)return(e>>o)+(r-(s<<o))*(t>>o);const a=-o;return e-(s-(r<<a))*(t>>a)<<a}let w9t=class{constructor(e,i,r){this._rows=Math.ceil(i/r),this._columns=Math.ceil(e/r),this._cellSize=r,this.cells=new Array(this._rows);for(let n=0;n<this._rows;n++){this.cells[n]=new Array(this._columns);for(let s=0;s<this._columns;s++)this.cells[n][s]=[]}}getCell(e,i){const r=Math.min(Math.max(Math.floor(i/this._cellSize),0),this._rows-1),n=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][n]||null}getCellSpan(e,i,r,n){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(n/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function uyt(t,e,i,r,n,s){const o=e[r++];for(let a=0;a<o;a++){const l=new cyt(s);l.xTile=e[r++],l.yTile=e[r++],l.hash=e[r++],l.priority=e[r++];const c=e[r++];for(let f=0;f<c;f++){const m=e[r++],y=e[r++],_=e[r++],v=e[r++],w=!!e[r++],x=e[r++],T=i[r++],S=i[r++],C=e[r++],A=e[r++];l.colliders.push({xTile:m,yTile:y,dxPixels:_,dyPixels:v,hard:w,partIndex:x,width:C,height:A,minLod:T,maxLod:S})}const h=t[r++];for(let f=0;f<h;f++)l.textVertexRanges.push([t[r++],t[r++]]);const d=t[r++];for(let f=0;f<d;f++)l.iconVertexRanges.push([t[r++],t[r++]]);n.push(l)}return r}function T9t(t,e,i){for(const[r,n]of t.symbols)hyt(t,e,i,n,r)}function hyt(t,e,i,r,n){const s=t.layerData.get(n);if(s.type===Pc.SYMBOL){for(const o of r){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],h=c.startOpacity,d=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&d===0;const f=i?Math.floor(127*h)|d<<7:d?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.iconVertexRanges)for(let d=c;d<c+h;d+=4)s.iconOpacity[d/4]=l;if(o.selectedForRendering){const c=a.parts[1],h=c.startOpacity,d=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&d===0;const f=i?Math.floor(127*h)|d<<7:d?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.textVertexRanges)for(let d=c;d<c+h;d+=4)s.textOpacity[d/4]=l}s.lastOpacityUpdate=e,s.opacityChanged=!0}}let p8=class{constructor(e,i){this.layerUIDs=[],this.isDestroyed=!1,this._data=e;let r=1;const n=new Uint32Array(e);this.layerUIDs=[];const s=n[r++];for(let o=0;o<s;o++)this.layerUIDs[o]=n[r++];this.bufferDataOffset=r,i&&(this.layer=i.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return this._data==null}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(e){this._data!=null&&(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}},dyt=class extends p8{constructor(e,i){super(e,i),this.type=Pc.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const r=new Uint32Array(e);let n=this.bufferDataOffset;this.lineIndexStart=r[n++],this.lineIndexCount=r[n++];const s=r[n++];if(s>0){this.patternMap=new Map;for(let o=0;o<s;o++){const a=r[n++],l=r[n++],c=r[n++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=n}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=rt(this.vao)}doPrepareForRendering(e,i,r){const n=new Uint32Array(i),s=new Int32Array(n.buffer),o=n[r++],a=Ui.createVertex(e,Ri.STATIC_DRAW,new Int32Array(s.buffer,4*r,o));r+=o;const l=n[r++],c=Ui.createIndex(e,Ri.STATIC_DRAW,new Uint32Array(n.buffer,4*r,l));r+=l;const h=this.layer.lineMaterial;this.vao=new ad(e,h.getAttributeLocations(),h.getLayoutInfo(),{geometry:a},c)}},pyt=class extends p8{constructor(e,i){super(e,i),this.type=Pc.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const r=new Uint32Array(e);let n=this.bufferDataOffset;this.fillIndexStart=r[n++],this.fillIndexCount=r[n++],this.outlineIndexStart=r[n++],this.outlineIndexCount=r[n++];const s=r[n++];if(s>0){this.patternMap=new Map;for(let o=0;o<s;o++){const a=r[n++],l=r[n++],c=r[n++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=n}get memoryUsed(){return(this.data?.byteLength??0)+(this.fillVAO?.usedMemory??0)+(this.outlineVAO?.usedMemory??0)}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=rt(this.fillVAO),this.outlineVAO=rt(this.outlineVAO)}doPrepareForRendering(e,i,r){const n=new Uint32Array(i),s=new Int32Array(n.buffer),o=n[r++],a=Ui.createVertex(e,Ri.STATIC_DRAW,new Int32Array(s.buffer,4*r,o));r+=o;const l=n[r++],c=Ui.createIndex(e,Ri.STATIC_DRAW,new Uint32Array(n.buffer,4*r,l));r+=l;const h=n[r++],d=Ui.createVertex(e,Ri.STATIC_DRAW,new Int32Array(s.buffer,4*r,h));r+=h;const f=n[r++],m=Ui.createIndex(e,Ri.STATIC_DRAW,new Uint32Array(n.buffer,4*r,f));r+=f;const y=this.layer,_=y.fillMaterial,v=y.outlineMaterial;this.fillVAO=new ad(e,_.getAttributeLocations(),_.getLayoutInfo(),{geometry:a},c),this.outlineVAO=new ad(e,v.getAttributeLocations(),v.getLayoutInfo(),{geometry:d},m)}},fyt=class extends p8{constructor(e,i,r){super(e,i),this.type=Pc.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const n=new Uint32Array(e),s=new Int32Array(e),o=new Float32Array(e);let a=this.bufferDataOffset;this.isIconSDF=!!n[a++];const l=n[a++];for(let f=0;f<l;f++){const m=n[a++],y=n[a++],_=n[a++];this.iconPerPageElementsMap.set(m,[y,_])}const c=n[a++];for(let f=0;f<c;f++){const m=n[a++],y=n[a++],_=n[a++];this.glyphPerPageElementsMap.set(m,[y,_])}const h=n[a++],d=n[a++];this.iconOpacity=new Int32Array(h),this.textOpacity=new Int32Array(d),a=uyt(n,s,o,a,this.symbols,r),this.bufferDataOffset=a}get memoryUsed(){return(this.data?.byteLength??0)+(this.iconVAO?.usedMemory??0)+(this.textVAO?.usedMemory??0)+gv(this.iconOpacity)+gv(this.textOpacity)}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[i,r]of this.iconPerPageElementsMap)e+=r[1];for(const[i,r]of this.glyphPerPageElementsMap)e+=r[1];return e/3}doDestroy(){this.iconVAO=rt(this.iconVAO),this.textVAO=rt(this.textVAO)}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,i=this.iconVAO.vertexBuffers.opacity;e.length>0&&e.byteLength===i.byteLength&&i.setSubData(e,0,0,e.length);const r=this.textOpacity,n=this.textVAO.vertexBuffers.opacity;r.length>0&&r.byteLength===n.byteLength&&n.setSubData(r,0,0,r.length)}doPrepareForRendering(e,i,r){const n=new Uint32Array(i),s=new Int32Array(n.buffer),o=n[r++],a=Ui.createVertex(e,Ri.STATIC_DRAW,new Int32Array(s.buffer,4*r,o));r+=o;const l=n[r++],c=Ui.createIndex(e,Ri.STATIC_DRAW,new Uint32Array(n.buffer,4*r,l));r+=l;const h=n[r++],d=Ui.createVertex(e,Ri.STATIC_DRAW,new Int32Array(s.buffer,4*r,h));r+=h;const f=n[r++],m=Ui.createIndex(e,Ri.STATIC_DRAW,new Uint32Array(n.buffer,4*r,f));r+=f;const y=Ui.createVertex(e,Ri.STATIC_DRAW,this.iconOpacity.buffer),_=Ui.createVertex(e,Ri.STATIC_DRAW,this.textOpacity.buffer),v=this.layer,w=v.iconMaterial,x=v.textMaterial;this.iconVAO=new ad(e,w.getAttributeLocations(),w.getLayoutInfo(),{geometry:a,opacity:y},c),this.textVAO=new ad(e,x.getAttributeLocations(),x.getLayoutInfo(),{geometry:d,opacity:_},m)}},myt=class extends p8{constructor(e,i){super(e,i),this.type=Pc.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const r=new Uint32Array(e);let n=this.bufferDataOffset;this.circleIndexStart=r[n++],this.circleIndexCount=r[n++],this.bufferDataOffset=n}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=rt(this.vao)}doPrepareForRendering(e,i,r){const n=new Uint32Array(i),s=new Int32Array(n.buffer),o=n[r++],a=Ui.createVertex(e,Ri.STATIC_DRAW,new Int32Array(s.buffer,4*r,o));r+=o;const l=n[r++],c=Ui.createIndex(e,Ri.STATIC_DRAW,new Uint32Array(n.buffer,4*r,l));r+=l;const h=this.layer.circleMaterial;this.vao=new ad(e,h.getAttributeLocations(),h.getLayoutInfo(),{geometry:a},c)}};const R9t=!0,P9t=32,que=200,gyt=1/ie("mapview-transitions-duration");let yyt=class extends Sn{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){if(this._stage===e)return;const i=this._stage;this._stage=e,e?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):i?.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return this._transforms==null&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=Hs(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=Hs(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){this._fadeInResolver?.(),this._fadeInResolver=null,this._fadeOutResolver?.(),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale),this.setTransform(e.state)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){this.parent?.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(e,i){if(this.fadeTransitionEnabled){const r=this._fadeOutResolver||!this.visible?0:this.opacity,n=this.computedOpacity;if(n===r)this.computedVisible=this.visible;else{const s=e*gyt;this.computedOpacity=n>r?Math.max(r,n-s):Math.min(r,n+s),this.computedVisible=this.computedOpacity>0;const o=r===this.computedOpacity;this.inFadeTransition=!o,o||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},$x=class Bb{static getId(e,i,r,n){return typeof e=="object"?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${i}/${r}/${n}`}constructor(e,i,r,n){this.set(e,i,r,n)}get key(){return this}get id(){return this.toString()}set id(e){this.set(e)}get hash(){const e=4095&this.row,i=4095&this.col,r=63&this.level;return(3&this.world)<<30|i<<22|e<<8|r}acquire(e,i,r,n){this.set(e,i,r,n)}contains(e){const i=e.level-this.level;return i>=0&&this.row===e.row>>i&&this.col===e.col>>i&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new Bb(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,i,r,n){if(e==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof e=="object")this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if(typeof e=="string"){const[s,o,a,l]=e.split("/");this.level=parseFloat(s),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+e,this.row=+i,this.col=+r,this.world=+n||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new Bb(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const e=this.level+1,i=this.row<<1,r=this.col<<1,n=this.world;return[new Bb(e,i,r,n),new Bb(e,i,r+1,n),new Bb(e,i+1,r,n),new Bb(e,i+1,r+1,n)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}};$x.pool=new $a($x,null,null,25,50);let rRe=class extends yyt{constructor(e,i,r,n,s,o,a=s,l=o){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new $x(e),this.resolution=i,this.x=r,this.y=n,this.width=s,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(e){const i=this.resolution/(e.resolution*e.pixelRatio),r=this.transforms.tileMat3,[n,s]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*i,a=this.height/this.rangeY*i;HJ(r,o,0,0,0,a,0,n,s,1),XE(this.transforms.dvs,e.displayViewMat3,r)}},kB=class nRe extends rRe{constructor(e,i,r,n,s,o,a,l=null){super(e,i,r,n,s,o,4096,4096),this.styleRepository=a,this._memCache=l,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.id=e.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<que}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<que)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this._processed=!0}deleteLayerData(e){let i=!1;for(const r of e){const n=this.layerData.get(r);n&&(this._memoryUsedByLayerData-=n.memoryUsed,n.type===Pc.SYMBOL&&this.symbols.delete(r)&&(i=!0),n.destroy(),this.layerData.delete(r))}this._memCache?.updateSize(this.key.id,this,this._memoryUsedByLayerData),i&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerData.size>0}dispose(){this.status!=="unloaded"&&(sRe.delete(this),nRe._destroyRenderBuckets(this.layerData),this.layerData=null,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsed(){return this._memoryUsedByLayerData+256}changeDataImpl(e){let i=!1;if(e){const{bucketsWithData:r,emptyBuckets:n}=e,s=this._createRenderBuckets(r);if(n&&n.byteLength>0){const o=new Uint32Array(n);for(const a of o)this._deleteLayerData(a)}for(const[o,a]of s)this._deleteLayerData(o),a.type===Pc.SYMBOL&&(this.symbols.set(o,a.symbols),i=!0),this._memoryUsedByLayerData+=a.memoryUsed,this.layerData.set(o,a);this._memCache?.updateSize(this.key.id,this,this.memoryUsed)}this._hasSymbolBuckets=!1;for(const[r,n]of this.layerData)n.type===Pc.SYMBOL&&(this._hasSymbolBuckets=!0);i&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(i){i.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const i=this.resolution/(e.resolution*e.pixelRatio),r=this.width/this.rangeX*i,n=this.height/this.rangeY*i,s=[0,0];e.toScreen(s,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;qJ(o),dF(o,o,s),WJ(o,o,Math.PI*e.rotation/180),YJ(o,o,[r,n,1])}_createTransforms(){return{dvs:Ma(),tileMat3:Ma(),tileUnitsToPixels:Ma()}}static _destroyRenderBuckets(e){if(!e)return;const i=new Set;for(const r of e.values())i.has(r)||(r.destroy(),i.add(r));e.clear()}_createRenderBuckets(e){const i=new Map,r=new Map;for(const n of e){const s=this._deserializeBucket(n,r);for(const o of s.layerUIDs)i.set(o,s)}return i}_deserializeBucket(e,i){let r=i.get(e);if(r)return r;switch(new Uint32Array(e)[0]){case Pc.FILL:r=new pyt(e,this.styleRepository);break;case Pc.LINE:r=new dyt(e,this.styleRepository);break;case Pc.SYMBOL:r=new fyt(e,this.styleRepository,this);break;case Pc.CIRCLE:r=new myt(e,this.styleRepository)}return i.set(e,r),r}_deleteLayerData(e){if(!this.layerData.has(e))return;const i=this.layerData.get(e);this._memoryUsedByLayerData-=i.memoryUsed,i.destroy(),this.layerData.delete(e)}};const sRe=new Map;function _yt(){sRe.forEach((t,e)=>{console.log(`
${e.key}:`),t[0].forEach(i=>console.log(i)),console.log("========"),t[1].forEach(i=>console.log(i))})}const I9t={value:.5,readOnly:!0},vyt={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let U2=class{constructor(e=0,i=0){this.min=e,this.max=i,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},byt=class{constructor(e,i){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(i[2]-i[0]),this.dy=(e.width-1)/(i[3]-i[1]),this.x0=i[0],this.y1=i[3]}},wyt=class{constructor(e,i,r){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=i,this.samplerData=new byt(r,i)}computeMinMaxValue(e,i,r,n){n.min=1/0,n.max=-1/0,n.hasNoDataValues=!1;const s=e-this.level;if(s<=0)return n;const o=2**s;if(!(Math.floor(i/o)===this.i&&Math.floor(r/o)===this.j))return n;let a=1/0,l=-1/0;const c=this.samplerData.data.width,h=this.samplerData.data.values,d=.5*vP;let f=(c-1)/o,m=(r-this.j*o)*f,y=(i-this.i*o)*f;if(f<1){const _=Math.floor(m),v=Math.floor(y),w=_+v*c,x=h[w],T=h[w+1],S=h[w+c],C=h[w+c+1];if(x+T+S+C<d){const A=m-_,R=y-v,D=tI(x,T,S,C,A,R),N=tI(x,T,S,C,A+f,R),k=tI(x,T,S,C,A,R+f),B=tI(x,T,S,C,A+f,R+f);return n.min=Math.min(D,N,k,B),n.max=Math.max(D,N,k,B),n}m=_,y=v,f=1}else m=Math.floor(m),y=Math.floor(y),f=Math.ceil(f);for(let _=m;_<=m+f;_++)for(let v=y;v<=y+f;v++){const w=h[_+v*c];w<d?(a=Math.min(a,w),l=Math.max(l,w)):n.hasNoDataValues=!0}return n.min=a,n.max=l,n}};const xyt=.5*vP;function ln(t,e,i){if(i==null)return null;for(const r of i){if(!r)continue;const n=r.safeWidth;let s=_e(r.dy*(r.y1-e),0,n),o=_e(r.dx*(t-r.x0),0,n);const a=Math.floor(s),l=Math.floor(o),c=r.data.width,h=a*c+l,d=r.data.values,f=d[h],m=d[h+1],y=h+c,_=d[y],v=d[y+1];if(f+_+m+v<xyt){s-=a,o-=l;const w=f+(m-f)*o;return w+(_+(v-_)*o-w)*s}}return null}let Ah=class extends we{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(i=>{const r=i.layer;if(r.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const n=oRe(r.fullExtent,this.viewSpatialReference);n!=null&&e.push(S0e(n))}}),e}};function Tyt(t,e){return t===Le.Global?new NW(e):new FW(e)}u([p({readOnly:!0})],Ah.prototype,"layerViewsExtent",null),u([p({readOnly:!0})],Ah.prototype,"tiledLayersExtent",null),u([p({readOnly:!0})],Ah.prototype,"stencilEnabledExtents",null),u([p()],Ah.prototype,"viewSpatialReference",void 0),u([p()],Ah.prototype,"tilingScheme",void 0),u([p()],Ah.prototype,"defaultTiledLayersExtent",void 0),u([p({constructOnly:!0})],Ah.prototype,"layers",void 0),u([p({constructOnly:!0})],Ah.prototype,"layerViews",void 0),Ah=u([M("esri.views.3d.terrain.ExtentHelper")],Ah);let NW=class extends Ah{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?mxe:Lqe}};NW=u([M("esri.views.3d.terrain.ExtentHelperGlobal")],NW);let FW=class extends Ah{_computeLayerViewsExtent(){const e=id(),i=this.viewSpatialReference;this.layerViews.forEach(s=>{const o=s.layer;if(s.isResolved()&&(o.type!=="graphics"||!o.internal)){const a=oRe("fullExtentInLocalViewSpatialReference"in s&&s.fullExtentInLocalViewSpatialReference||s.layer.fullExtent,i);lv(e,a,e)}});const r=Y7(e)?e:null,n=this._get("layerViewsExtent");return Uw(r,n)?n:r}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const i=this.viewSpatialReference,r=id();this.layers.forEach(o=>{if(o.loaded&&HO(o)){const a=d8(o,i,Le.Local);if(a==null)return;const{tileInfo:l,fullExtent:c}=a;l!=null&&c!=null&&(pk(o)||e.compatibleWith(l)&&c.spatialReference.equals(e.spatialReference))&&lv(r,c,r)}}),lv(r,this.defaultTiledLayersExtent,r);const n=Y7(r)?r:null,s=this._get("tiledLayersExtent");return Uw(n,s)?s:n}};function oRe(t,e){return t==null||t.spatialReference.equals(e)?t:XO(t,t.spatialReference,e)}FW=u([M("esri.views.3d.terrain.ExtentHelperLocal")],FW);var Yt;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.MAP=1]="MAP"})(Yt||(Yt={}));const Vb=[Yt.ELEVATION,Yt.MAP];function aRe(){const t=globalThis.require?.modules;if(t){const e=Object.keys(t);for(const i of e)i.includes(".glsl")&&delete t[i]}}const lRe=1.3,Syt=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let U0,Il=class extends we{get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||pr.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return this._spatialReference!=null&&this._spatialReference.isGeographic&&!this.view.state.isLocal?Wi(this._spatialReference).metersPerDegree:1}get _overlayStretch(){return lRe/this.view.resolutionScale}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get rendersOccluded(){return this.renderer.rendersOccluded}constructor(e){super(e),this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=ie("esri-mobile")?2048:4096,this._animationTimeLast=0}initialize(){const e=this.view;this.renderer=new Gd({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),e._stage.renderer.renderPlugins.add(this.renderer);const i=()=>this.setDrawTexturesDirty();this._groundIntersector=sd(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this.addHandles([ne(()=>this.renderer.hasHighlights,i),this.renderer.events.on("has-water",r=>e._stage?.renderer.setParameters({hasOverlayWater:r})),this.renderer.events.on("renders-occluded",()=>{i(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",i),ne(()=>e.state.camera.pixelRatio,i),ne(()=>e.state.alignPixelEnabled,i),this.renderer.events.on("textures-disposed",()=>this.surface.requestRender()),ne(()=>[e.pointsOfInterest?.renderPointOfView,e.pointsOfInterest?.centerOnSurfaceFrequent?.location],()=>this.setPlacementDirty()),ne(()=>[e.state?.pixelRatio,e.state?.contentPixelRatio],()=>this.setPlacementDirty(),Zi),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(pt.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",r=>{this._updateOverlays(hl,r.camera,Ln.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlays(Ln.BACKGROUND,r)})]),e._stage.renderer.renderOverlay=r=>this._renderOverlay(r)}_renderOverlay(e){if(this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays)return this._dispatchAnimationUpdate(e),this._drawOverlays(Ln.UPDATE,this.view.state)}destroy(){this.view?._stage&&(this.view._stage.renderer.renderPlugins.remove(this.renderer),this.view._stage.renderer.renderOverlay=()=>{}),U0&&(U0.hide(),U0=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const i=this.view.renderSpatialReference;e!=null&&i!=null?(this._renderSR=i,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new wv(-20037508342787e-6,20037508342787e-6):new wv(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}registerDrapeSource(e,i,r){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const n=this.renderer.createDrapeSourceRenderer(e,i,r);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),n}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,vu)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&e.setDrapingExtent!=null&&this._spatialReference!=null&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this.view.state.contentCamera,Ln.UPDATE)}_updateOverlays(e,i,r){if(!this._spatialReference)return ca.YIELD;const n=this._computeOverlayResolution(i);this._computeOverlayExtents(i,n,ff),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources,ff.stretch);const s=this._updateOverlay(os.INNER,ff.inner,n,1*ff.pixelRatioAdjustment,ff.mapUnitsPerPixel),o=Oa(ff.inner)/Oa(ff.outer),a=this._updateOverlay(os.OUTER,ff.outer,n,o*ff.pixelRatioAdjustment,ff.mapUnitsPerPixel);s!==jf.EXTENT&&a!==jf.EXTENT||(this._drapeSources.forEach(l=>this._updateDrapeSourceExtent(l)),this.surface.updateTileOverlayParams(r)),s===jf.NONE&&a===jf.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const i=this.view.state.contentPixelRatio*this.view.resolutionScale,r=e.fullWidth/e.pixelRatio*i,n=e.fullHeight/e.pixelRatio*i,s=Math.ceil(1.5*Math.max(r,n));return Math.min(Ww(s),this._maxResolution)}_updateOverlay(e,i,r,n,s){if(this.renderer.overlays.length===0)return jf.NONE;const o=this.renderer.overlays[e],a=o.mapUnitsPerPixel;if(o.mapUnitsPerPixel=s,o.pixelRatio=n,Eyt(i,o.extent)&&r===o.resolution)return a===s?jf.NONE:jf.RERENDER_ONLY;Sy(o.extent,i),o.resolution=r;const l=OZ(o.extent);return o.renderLocalOrigin=XF(l[0],l[1],0,"OV_"+this._latestOriginId++),jf.EXTENT}setTileParameters(e){const i=e.renderData.overlay;if(this.renderer.overlays.length>0){const r=this.renderer.overlays[os.INNER],n=this.renderer.overlays[os.OUTER],s=e.extent;this._rectInsideRect(r.extent,s)||this._rectanglesOverlap(s,r.extent)||this._rectanglesOverlap(s,n.extent)?(this._setTileOverlayData(s,os.INNER,i),this._setTileOverlayData(s,os.OUTER,i)):(this._clearTileOverlayData(os.INNER,i),this._clearTileOverlayData(os.OUTER,i))}else this._clearTileOverlayData(os.INNER,i),this._clearTileOverlayData(os.OUTER,i)}overlayPixelSizeInMapUnits(e,i){if(this.renderer.overlays.length===0)return i();const r=this.renderer.overlays[os.INNER],n=this.renderer.overlays[os.OUTER],s=this._pointIsInExtent(e,r.extent)?r:n;return(s.extent[2]-s.extent[0])/s.resolution}_setTileOverlayData(e,i,r){if(this.renderer.overlays.length===0)return;const n=this.renderer.overlays[i].extent,s=Oa(n),o=Wl(n);let a=e[0];if(this._longitudeCyclical){a=this._longitudeCyclical.minimalMonotonic(n[0],a);const l=this._longitudeCyclical.minimalMonotonic(n[0],e[2]);a>l&&(a=l-(e[2]-e[0]))}r.setScale(i,Oa(e)/s,Wl(e)/o),r.setOffset(i,(a-n[0])/s,(e[1]-n[1])/o)}_clearTileOverlayData(e,i){i.setScale(e,-1,-1),i.setOffset(e,-1,-1)}async reloadShaders(){aRe(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(hl)}_dispatchAnimationUpdate(e){const i=e-this._animationTimeLast;if(i>=this.surface.view._stage.renderer.animationTimestep||this.view.state.forcedAnimationTime!=null||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const r=i/this.surface.view._stage.renderer.animationTimeDilation,n=new X2e(this.view.state.camera,r,this.view.state.forcedAnimationTime);this.renderer.updateAnimation(n)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,i,r,n){const s=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,Ryt,i,r);if(s==null)return!1;const o=s.origin,a=ue(XL,s.origin,s.direction);return this._groundIntersector.reset(o,a,e),this._groundIntersector.intersect([]),this.view.basemapTerrain.intersect(this._groundIntersector,null,o,a),this._groundIntersector.results.min.getIntersectionPoint(n)}_findHorizonBasedPointOfInterest(e,i){let r=.5;const n=.55,s=this.view.renderCoordsHelper.getAltitude(e.eye),o=this.view.pointsOfInterest.centerOnSurfaceFrequent,a=1e-5,l=_e(o.estimatedSurfaceAltitude,e.aboveGround?-1/0:s+a,e.aboveGround?s-a:1/0),c=e.aboveGround;if(this.view.viewingMode==="global"){const h=XL;IC(eU(tU,Wi(this.view.spatialReference).radius+l),th(e.eye,e.viewForward),h),de(h,h,e.eye);const d=xv.normalize(Tbe(e.viewForward,h,e.viewRight))/e.fovY+.5,f=d<=0||d>=1?.5:n;r=c?f*d:d+f*(1-d)}else{const h=.5*Math.PI-Math.acos(-e.viewForward[2]),d=Math.tan(h),f=Ft(0,d,1,0),m=Fu(f,f,e.projectionMatrix)[1],y=_e(.5+.5*m,0,1);r=y===1||y===0?.5:c?y*n:1-(1-y)*n}return!!this._intersectGroundFromView(e,.5,r,i)&&x6(i,e.eye)<o.distance*o.distance}_computeOverlayExtents(e,i,r){const n=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s=E();this._findHorizonBasedPointOfInterest(e,s)||oe(s,n),pr.OVERLAY_SHOW_CENTER?(U0==null&&(U0=new t2(this.view.graphics,"red")),U0.show(s,this._renderSR)):U0?.hide();const o=Math.max(.1,Mr(e.eye,s)),a=Uv(this.view.renderCoordsHelper,n,e.eye);this._overlaySREqualsRenderSR||ua(s,this._renderSR,s,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&this._spatialReference&&this._spatialReference.isGeographic,h=c&&this._spatialReference?1/Wi(this._spatialReference).metersPerDegree:1,d=this.view.state.contentPixelRatio,f=e.perScreenPixelRatio/d*o*h;r.mapUnitsPerPixel=f/this._worldToPCSRatio,r.stretch=this._overlayStretch;let m=i*f/2*r.stretch,y=!1,_=c?90:1/0;this._isSpherical&&l&&this._spatialReference&&(this._spatialReference.isWebMercator?(m/=Math.cos($5(s[1])),_=l[3]):(y=!0,m/=Wi(this._spatialReference).metersPerDegree,_=90),m>=_&&(m=_,s[1]=0,this._spatialReference.isWebMercator&&(s[0]=0)));let v=1;y&&(v=1/Math.max(.2,Math.cos(Math.abs(Dt(s[1])))),m*v>180&&(v=180/m),r.mapUnitsPerPixel*=v);const w=Math.log(2)/12;m=Math.exp(Math.round(Math.log(m)/w)*w);const x=m*v,T=32,S=.5*i/(T*x),C=.5*i/(T*m);s[0]=Math.round(s[0]*S)/S,s[1]=Math.round(s[1]*C)/C;const A=r.inner;A[0]=s[0]-x,A[1]=s[1]-m,A[2]=s[0]+x,A[3]=s[1]+m,this._isSpherical&&this._shiftExtentToFitBounds(A,1/0,_);const R=r.outer;if(6*x>Oa(l))Sy(R,l);else if(Math.PI/2-Math.abs(a-Math.PI/2)<=.25*Math.PI)R[0]=A[0]-x,R[1]=A[1]-m,R[2]=A[2]+x,R[3]=A[3]+m;else{ua(e.eye,this._renderSR,XL,this._spatialReference),Qf(Y1,s,XL);let N=-Math.atan2(Y1[1],Y1[0])+.125*Math.PI;N<0&&(N+=2*Math.PI);const k=Math.floor(N/(.25*Math.PI));dx(Y1,Syt[k],2*m),Y1[0]*=v,Y1[2]*=v,_Z(R,A,Y1)}if(this._isSpherical)R[0]=this._longitudeCyclical.clamp(R[0]),R[2]=this._longitudeCyclical.clamp(R[2]),R[1]=Math.max(R[1],-_),R[3]=Math.min(R[3],_);else{const N=X7(A,l,Ayt),k=X7(R,l,Oyt);Jie(N,k)&&(R[2]=R[0],R[3]=R[1])}const D=Math.abs(A[2]-A[0])/i;r.mapUnitsPerPixel=Math.max(r.mapUnitsPerPixel,D),r.pixelRatioAdjustment=r.mapUnitsPerPixel/D}_drawOverlays(e,i){if(!this.renderer.hasOverlays)return;if(!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return this.renderer;const r=this._drawTexturesDirty;this._drawTexturesDirty=this._drawTexturesAnimateDirty=!1;const n=this.renderer.computeValidity();return this.renderer.releaseRenderTargets(),this.renderer.drawOverlays(i),n!==this.renderer.computeValidity()&&this.surface.updateTileOverlayParams(Ln.UPDATE),r?(this.surface.requestRender(e),e===Ln.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(Ln.BACKGROUND),this.renderer}_rectanglesOverlap(e,i){return e!=null&&(this._longitudeCyclical?(this._longitudeCyclical.contains(i[0],i[2],e[0])||this._longitudeCyclical.contains(i[0],i[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],i[0]))&&!(e[1]>i[3]||e[3]<i[1]):I6(e,i))}_rectInsideRect(e,i){return i!=null&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],i[0])&&this._longitudeCyclical.contains(e[0],e[2],i[2])&&i[1]>e[1]&&i[3]<e[3]:Jie(e,i))}_pointIsInExtent(e,i){if(this._longitudeCyclical)return this._longitudeCyclical.contains(i[0],i[2],e.x)&&e.y>=i[1]&&e.y<=i[3];const r=e.x,n=e.y;return r>i[0]&&r<i[2]&&n>i[1]&&n<i[3]}_shiftExtentToFitBounds(e,i,r){let n=0,s=0;e[0]<-i?n=e[0]+i:e[2]>i&&(n=i-e[2]),e[1]<-r?s=e[1]+r:e[3]>r&&(s=r-e[3]),B5(e,n,s)}get test(){return{renderer:this.renderer,update:()=>this.runTask(hl)}}};function Eyt(t,e){const r=pr.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(t[2]-t[0],t[3]-t[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r&&Math.abs(e[2]-t[2])<=r&&Math.abs(e[3]-t[3])<=r}u([p()],Il.prototype,"_spatialReference",void 0),u([p({readOnly:!0})],Il.prototype,"running",null),u([p()],Il.prototype,"_placementDirty",void 0),u([p()],Il.prototype,"_contentUpdated",void 0),u([p()],Il.prototype,"_isSpherical",null),u([p()],Il.prototype,"_worldToPCSRatio",null),u([p({autoDestroy:!0})],Il.prototype,"renderer",void 0),u([p({constructOnly:!0})],Il.prototype,"view",void 0),u([p({constructOnly:!0})],Il.prototype,"surface",void 0),u([p()],Il.prototype,"suspended",null),u([p()],Il.prototype,"updating",null),u([p({type:Boolean})],Il.prototype,"rendersOccluded",null),Il=u([M("esri.views.3d.terrain.OverlayManager")],Il);let Cyt=class{constructor(){this.inner=Zt(),this.outer=Zt(),this.mapUnitsPerPixel=0,this.pixelRatioAdjustment=1,this.stretch=lRe}};const Y1=oi(),XL=E(),ff=new Cyt,Ayt=Zt(),Oyt=Zt(),Ryt=js();var jf;(function(t){t[t.NONE=0]="NONE",t[t.EXTENT=1]="EXTENT",t[t.RERENDER_ONLY=2]="RERENDER_ONLY"})(jf||(jf={}));let Pyt=class{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=Pr(),this.indexCount=0,this.numVerticesPerSide=0,this.uvRange=[0,0,1,1],this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}release(){this.vertexAttributes=li(this.vertexAttributes),this.indices=null}},Wue=class{constructor(e,i,r,n,s){this.attributes=e,this.localOrigin=i,this.index0=r,this.stride=n,this.count=s}getVertexIndex(e){return this.getAttributeIndex(e)}getAttributeIndex(e){return Se(0<=e&&e<this.count),this.index0+this.stride*e}_getVertexRaw(e,i){this.attributes.position.getVec(e,i)}getVertexPos(e,i){this._getVertexRaw(this.getAttributeIndex(i),e),ue(e,e,this.localOrigin)}getNormal(e,i){const{typedBuffer:r,typedBufferStride:n}=this.attributes.normalCompressed;Ilt(e,r,this.getAttributeIndex(i),n)}_setNormal(e,i,r,n){const{typedBuffer:s,typedBufferStride:o}=this.attributes.normalCompressed;Mx(s,e,i,r,n,o)}_setUV(e,i,r){Rp(this.attributes.uv0,e,i,r)}setNormalFromValues(e,i,r,n){this._setNormal(this.getAttributeIndex(e),i,r,n)}setVertexFromValuesRawPositionUV(e,i,r,n,s,o){const a=this.getAttributeIndex(e);this.attributes.position.setValues(a,i,r,n),this._setUV(a,s,o)}setVertexFromValuesRawPositionUVNormal(e,i,r,n,s,o,a,l,c){const h=this.getAttributeIndex(e);this.attributes.position.setValues(h,i,r,n),this._setUV(h,s,o),this._setNormal(h,a,l,c)}};const Yue=16384;function Rp(t,e,i,r){t.setValues(e,i*Yue,r*Yue)}function Jh(t,e,i,r){t<r[0]?r[0]=t:t>r[3]&&(r[3]=t),e<r[1]?r[1]=e:e>r[4]&&(r[4]=e),i<r[2]?r[2]=i:i>r[5]&&(r[5]=i)}let Myt=class{constructor(){this.sinLonLUT=new Array(B3+1),this.cosLonLUT=new Array(B3+1),this.sinLatLUT=new Array(B3+1),this.cosLatLUT=new Array(B3+1)}update(e,i,r){const n=i[0],s=i[2];for(let o=0;o<=e;o++){const a=o/e,l=n*(1-a)+s*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);const c=r(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}},ZL=class{constructor(){this.cornerTiles=[null,null,null,null],this.cornerTileSamplerVersions=[-1,-1,-1,-1]}},$yt=class{constructor(){this.cornerNeighborData=[new ZL,new ZL,new ZL,new ZL],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1],this.cornerPeerNeighbors=[null,null,null,null]}},Iyt=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.samplerDataVersion=0,this.neighborData=new $yt}},cRe=class S4{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=$e(this._current),this._next=$e(this._next),this._waiting=$e(this._waiting),this._delayed=$e(this._delayed)}get current(){if(this._current==null)return null;if(!this._isFadingEnabled){const i=this._delayed||this._waiting||this._next||this._current;i!==this._current&&(this._current=null,this.clear(),this._current=i)}let e=S4.test.fadeMoment;if(this._delayed!=null&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,gy.Immediate),this._delayed=null)),this._next!=null){e=e||performance.now();const i=this._fadeDuration,r=this._current!=null&&this._next.texture===this._current.texture,n=this._next.type!==Rs.FADING,s=e-this._fadeStart>=i;(r||n||s)&&($e(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(this._next==null)return 1;const e=S4.test.fadeMoment||performance.now(),i=Math.max(0,e-this._fadeStart),r=this._fadeDuration;return i>r?0:1-i/r}get isFading(){return this._next!=null||this._delayed!=null}push(e,i=gy.Immediate){this._delayed=$e(this._delayed),this._push(e,i)}_push(e,i){if(this._isFadingEnabled||this.clear(),this._current==null)return void(this._current=e);const r=S4.test.fadeMoment||performance.now();return i!==gy.Immediate?(this._delayed=e,void(this._delayedTime=r+i)):this._next==null?(this._next=e,void(this._fadeStart=this._alignFadeStart(r))):void(e!=null&&($e(this._waiting),this._waiting=e))}get _fadeDuration(){return this._waiting==null?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(e){const i=this._getFadeDuration();return e+i-e%i}get _isFadingEnabled(){return this._getFadeDuration()>0}};var gy;cRe.test={fadeMoment:0},function(t){t[t.Immediate=0]="Immediate",t[t.Delayed=5e3]="Delayed"}(gy||(gy={}));var fC;(function(t){t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT",t[t.NONE=0]="NONE",t[t.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(fC||(fC={}));let uRe=class{constructor(){this._queue=new Ut,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),e!=null&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){const e=this._last?.children;return e?.[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},Lyt=class{constructor(){this._q=new Ut}get done(){return this._q.length===0}reset(e){if(this._q.clear(),e!=null){this._q.pushArray(e);for(let i=0;i<this._q.length;++i){const r=this._q.data[i];r.isLeaf||this._q.pushArray(r.children)}}}next(){return this._q.pop()}};function IR(t,e,i){if(e?.fullExtent==null)return!1;const r=e.fullExtent,n=t.extent;if(i){if(n[0]<r.xmin||n[1]<r.ymin||n[2]>r.xmax||n[3]>r.ymax)return!1}else if(r.xmin>n[2]||r.ymin>n[3]||r.xmax<n[0]||r.ymax<n[1])return!1;const s=t.surface.tilingScheme.levels[t.level].scale,o=e.minScale;if(o>0&&s>1.00000001*o)return!1;const a=e.maxScale;return!(a>0&&s<.99999999*a)}function yy(t,e){const i=t.lij,r=e.lij;return i[0]-r[0]||i[1]-r[1]||i[2]-r[2]}function hRe(t,e,i=null){i==null||i.length===0?t===fC.BACK_TO_FRONT?e.sort(Dyt):e.sort(Nyt):e.sort((r,n)=>Fyt(r,n,t,i))}function Dyt(t,e){const i=e.screenDepth-t.screenDepth;if(i!==0)return i;const r=t.lij,n=e.lij;return r[0]-n[0]||r[1]-n[1]||r[2]-n[2]}function Nyt(t,e){const i=t.screenDepth-e.screenDepth;if(i!==0)return i;const r=t.lij,n=e.lij;return r[0]-n[0]||r[1]-n[1]||r[2]-n[2]}function dRe(t,e,i){const r=t.screenDepth,n=e.screenDepth;return r<n?-i:r>n?i:yy(t,e)}function Fyt(t,e,i,r){return Xue(t,r)===Xue(e,r)?dRe(t,e,i):t?i:-i}function Xue(t,e){for(const i of e)if(t.intersectsExtent(i))return!0;return!1}function kyt(t,e){const i=t.distanceToPOI-e.distanceToPOI;if(i!==0)return i;const r=t.lij,n=e.lij;return r[0]-n[0]||r[1]-n[1]||r[2]-n[2]}function Uyt(t,e){const i=t.length;for(let r=0;r<i;++r)t.at(r).updateDistanceToPOI(e);t.sort(kyt)}function zyt(t,e,i){let r=1,n=0,s=0;for(;t!==e;)if(r*=.5,n*=.5,s*=.5,1&t.lij[2]&&(n+=.5),!(1&t.lij[1])&&(s+=.5),(t=t.parent)==null)throw new Error("tile was not a descendant of upsampleTile");i.init(e,n,s,r)}function Byt(t){for(let e=0;e<t.length;e++){const i=t[e],r=i.parent;if(r)for(let n=0;n<4;n++){const s=r.children[n];if(s&&s!==i)return!0}}return!1}function Z9t(t,e){if(!t||!e||t[0]===e[0])return!1;const i=t[0]<e[0],r=i?t:e,n=i?e:t,s=1<<n[0]-r[0];return Math.floor(n[1]/s)===r[1]&&Math.floor(n[2]/s)===r[2]}let $ee=class{get updating(){return!!this._tileRequested}init(e,i,r,n){this.tile=e,this._layerIdx=i,this._layerClass=r,this._suspended=n,this._tileLayerInfo=e.getLayerInfo(i,r),this._tileRequested=null;const s=this._findAncestorWithData();this._setUpsampleTile(s)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e,i){this._setUpsampleTile(e,i),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,Rs.FADING,i):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return e!=null?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,i=this._layerClass,r=this.tile.surface.layerViewByIndex(e,i),n=IW(r),{minLevel:s,maxLevel:o}=r.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?IR:()=>!0;let h=this.tile;const d=h.level;let f;const m=this._tileLayerInfo.upsampleInfo,y=m!=null?m.tile.level:-1,_=m!=null&&y-d>=a,v=n?.tilemapCache,w=r.type==="vector-tile-3d"?r.schemaHelper:null;for(;h&&c(h,n,!1)&&h.level>=s;){const x=h.level,T=d-x,S=h.layerInfo[i][e];if(S.data&&T>=a){(!_||x>y)&&this._setUpsampleTile(h),S.dataInvalidated&&(f=h);break}const C=w?.getLevelRowColumn(h.lij)??h.lij;if(v?.getAvailability(C[0],C[1],h.lij[2])!=="unavailable"&&x<=o&&!S.data&&!S.dataMissing&&((!f||h.level===s||x%fxe==0||d-f.level<a)&&(f=h),T>=l))break;h=h.parent}if(f!=null&&d-f.level<a)if(m)f=null;else{const x=this._findAncestorWithData();x!=null&&(this._setUpsampleTile(x),f=x.layerInfo[i][e].dataInvalidated?x:null)}return f}_findAncestorWithData(){const e=this.tile.elevationLevel,i=this._desiredMinLevelDelta;let r;for(let n=this.tile;n;n=n.parent)if(n.hasLayerData(this._layerIdx,this._layerClass)){if(e-n.level>=i)return n;r=n}return r}_setUpsampleTile(e,i){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,Rs.FADING,i)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}},Vyt=class extends $ee{get _desiredMinLevelDelta(){throw Zue}get _progressiveLevelModulo(){throw Zue}dispose(){}};const Zue=new Error("Abstract method called on TileAgent"),uc=new Vyt;let pRe=class extends $ee{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return yH(this.tile.level)-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}},fRe=class extends $ee{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return fxe}};var Qw,Ix;(function(t){t[t.Stretch=0]="Stretch",t[t.Lut=1]="Lut",t[t.Hillshade=2]="Hillshade",t[t.COUNT=3]="COUNT"})(Qw||(Qw={})),function(t){t[t.Noop=0]="Noop",t[t.PerBand=1]="PerBand",t[t.COUNT=2]="COUNT"}(Ix||(Ix={}));function Gyt(t){t.fragment.uniforms.add(new et("u_colormap",e=>e.u_colormap),new Re("u_colormapOffset",e=>e.colormap.u_colormapOffset),new Re("u_colormapMaxIndex",e=>e.colormap.u_colormapMaxIndex),new Re("u_opacity",e=>e.common.u_opacity)),t.fragment.code.add(b`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)}function jyt(t){t.fragment.uniforms.add(new et("u_transformGrid",e=>e.u_transformGrid),new Ki("u_transformSpacing",e=>e.common.u_transformSpacing),new Ki("u_targetImageSize",e=>e.common.u_targetImageSize)),t.fragment.code.add(b`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)}let mRe=class extends or{constructor(){super(...arguments),this.scale=1,this.offset=Ey}};function gRe(t){t.attributes.add(O.POSITION,"vec2"),t.attributes.add(O.UV0,"vec2"),t.vertex.uniforms.add(new Re("scale",e=>e.scale)),t.vertex.uniforms.add(new Ki("offset",e=>e.offset)),t.varyings.add("uv","vec2"),t.varyings.add("vuv","vec2"),t.vertex.code.add(b`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}let Hyt=class extends mRe{constructor(e,i,r){super(),this.common=e,this.u_image=i,this.u_transformGrid=r}};function qyt(t,e){t.include(jyt),t.fragment.uniforms.add(new et("u_image",r=>r.u_image),new gm("u_flipY",r=>r.common.u_flipY),new gm("u_applyTransform",r=>r.common.u_applyTransform));const{requireBilinearWithNN:i}=e;i&&t.fragment.uniforms.add(new Ki("u_srcImageSize",r=>r.common.u_srcImageSize)),t.fragment.code.add(b`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`),i?t.fragment.code.add(b`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):t.fragment.code.add(b`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)}var Ie;(function(t){t[t.Normal=0]="Normal",t[t.Average=1]="Average",t[t.Lighten=2]="Lighten",t[t.Lighter=3]="Lighter",t[t.Plus=4]="Plus",t[t.Screen=5]="Screen",t[t.ColorDodge=6]="ColorDodge",t[t.Darken=7]="Darken",t[t.Multiply=8]="Multiply",t[t.ColorBurn=9]="ColorBurn",t[t.Overlay=10]="Overlay",t[t.SoftLight=11]="SoftLight",t[t.HardLight=12]="HardLight",t[t.VividLight=13]="VividLight",t[t.Hue=14]="Hue",t[t.Saturation=15]="Saturation",t[t.Luminosity=16]="Luminosity",t[t.Color=17]="Color",t[t.DestinationOver=18]="DestinationOver",t[t.DestinationAtop=19]="DestinationAtop",t[t.DestinationIn=20]="DestinationIn",t[t.DestinationOut=21]="DestinationOut",t[t.SourceAtop=22]="SourceAtop",t[t.SourceIn=23]="SourceIn",t[t.SourceOut=24]="SourceOut",t[t.Xor=25]="Xor",t[t.Difference=26]="Difference",t[t.Exclusion=27]="Exclusion",t[t.Minus=28]="Minus",t[t.Invert=29]="Invert",t[t.Reflect=30]="Reflect",t[t.COUNT=31]="COUNT"})(Ie||(Ie={}));const kW={normal:Ie.Normal,average:Ie.Average,lighten:Ie.Lighten,lighter:Ie.Lighter,screen:Ie.Screen,plus:Ie.Plus,"color-dodge":Ie.ColorDodge,darken:Ie.Darken,multiply:Ie.Multiply,"color-burn":Ie.ColorBurn,overlay:Ie.Overlay,"soft-light":Ie.SoftLight,"hard-light":Ie.HardLight,"vivid-light":Ie.VividLight,hue:Ie.Hue,saturation:Ie.Saturation,luminosity:Ie.Luminosity,color:Ie.Color,difference:Ie.Difference,exclusion:Ie.Exclusion,minus:Ie.Minus,invert:Ie.Invert,reflect:Ie.Reflect,"destination-over":Ie.DestinationOver,"destination-atop":Ie.DestinationAtop,"destination-in":Ie.DestinationIn,"destination-out":Ie.DestinationOut,"source-atop":Ie.SourceAtop,"source-in":Ie.SourceIn,"source-out":Ie.SourceOut,xor:Ie.Xor};function Wyt(t){return t===Ie.DestinationOver||t===Ie.DestinationAtop||t===Ie.DestinationIn||t===Ie.DestinationOut||t===Ie.SourceAtop||t===Ie.SourceIn||t===Ie.SourceOut||t===Ie.Xor}function Iee(t){t.code.add(b`
    float lineFactorAtPosition(float value) {
      float pos = value * ${b.float(257)};
      if(pos < 0.5 || pos > ${b.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}function Yyt(t,e){const i=e.blendMode;i!==Ie.Normal&&(i===Ie.Reflect&&t.code.add(b`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),i!==Ie.ColorDodge&&i!==Ie.VividLight||t.code.add(b`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),i!==Ie.ColorBurn&&i!==Ie.VividLight||t.code.add(b`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),i===Ie.Overlay&&t.code.add(b`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),i===Ie.HardLight&&t.code.add(b`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),i===Ie.SoftLight&&t.code.add(b`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),i===Ie.VividLight&&t.code.add(b`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),i!==Ie.Hue&&i!==Ie.Saturation&&i!==Ie.Color&&i!==Ie.Luminosity||(t.code.add(b`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),i!==Ie.Hue&&i!==Ie.Saturation||t.code.add(b`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),t.code.add(b`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${i===Ie.Multiply?b`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ie.Average?b`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ie.Lighten?b`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ie.Darken?b`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ie.Lighter?b`return vec4(cl * ol + cb * ob, ol + ob);`:i===Ie.Plus?b`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:i===Ie.Minus?b`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:i===Ie.Screen?b`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ie.Difference?b`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ie.Invert?b`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Ie.DestinationOver?b`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:i===Ie.DestinationAtop?b`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:i===Ie.DestinationOut?b`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:i===Ie.SourceAtop?b`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Ie.SourceOut?b`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:i===Ie.Xor?b`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:i===Ie.DestinationIn?b`return vec4(cb * ob * ol, ol * ob);`:i===Ie.SourceIn?b`return vec4(cl * ol * ob, ol * ob);`:i===Ie.Hue?b`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ie.Saturation?b`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ie.Color?b`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ie.Luminosity?b`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ie.Exclusion?b`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ie.Reflect?b`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ie.ColorDodge?b`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ie.ColorBurn?b`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ie.Overlay?b`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ie.SoftLight?b`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ie.HardLight?b`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ie.VividLight?b`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:b``}
    }
  `))}var ds,Uu,cp;(function(t){t[t.Composite=0]="Composite",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.GroupBackgroundComposite=3]="GroupBackgroundComposite",t[t.COUNT=4]="COUNT"})(ds||(ds={})),function(t){t[t.NotRequired=0]="NotRequired",t[t.Required=1]="Required",t[t.COUNT=2]="COUNT"}(Uu||(Uu={})),function(t){t[t.Off=0]="Off",t[t.On=1]="On",t[t.COUNT=2]="COUNT"}(cp||(cp={}));function yRe(t,e){const i=e.output===ds.GridComposite,r=e.output===ds.ColorComposite,n=e.output===ds.GroupBackgroundComposite,s=e.output===ds.Composite;i&&t.fragment.include(Iee),r&&t.fragment.uniforms.add(new kt("backgroundColor",c=>c.backgroundColor));const o=e.baseOpacityMode===Uu.Required;o&&t.fragment.uniforms.add(new Re("baseOpacity",c=>c.baseOpacity)),s&&t.fragment.uniforms.add(new et("fboColor",c=>c.fboTexture));const a=e.blendMode!==Ie.Normal,l=e.premultipliedSource===cp.On;t.fragment.include(Yyt,e),t.fragment.code.add(b`
    vec4 getBackground(vec2 uv) {
      return ${o?b`baseOpacity *`:""} ${n?b`vec4(0.0, 0.0, 0.0, 0.0)`:r?b`vec4(backgroundColor, 1.0)`:i?b`vec4(gridColor(uv), 1.0)`:b`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${a?b`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:b`
          float composeAlpha = colorLayer.a * opacity;
          return ${!l&&(s&&!o||n)?b`colorLayer * opacity;`:b`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}let f8=class extends Hyt{constructor(e,i,r,n,s,o){super(e,n,s),this.colormap=i,this.symbolizer=r,this.u_colormap=o,this.backgroundColor=vo,this.fboTexture=null,this.baseOpacity=1}},Xyt=class extends f8{},Zyt=class extends f8{};function Jyt(t){const e=new Ei;return e.include(gRe),e.include(qyt,t),e.include(Gyt,t),e.include(yRe,t),e.fragment.code.add(b`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`),t.colorizerType===Qw.Stretch?Qyt(e,t):t.colorizerType===Qw.Lut?Kyt(e):t.colorizerType===Qw.Hillshade&&e0t(e,t),e}function Kyt(t){t.fragment.code.add(b`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function Qyt(t,e){t.fragment.uniforms.add(new JM("u_bandCount",r=>r.symbolizer.u_bandCount),new jl("u_minCutOff",r=>r.symbolizer.u_minCutOff,3),new jl("u_maxCutOff",r=>r.symbolizer.u_maxCutOff,3),new jl("u_factor",r=>r.symbolizer.u_factor,3),new Re("u_minOutput",r=>r.symbolizer.u_minOutput),new Re("u_maxOutput",r=>r.symbolizer.u_maxOutput),new gm("u_useGamma",r=>r.symbolizer.u_useGamma),new jl("u_gamma",r=>r.symbolizer.u_gamma,3),new jl("u_gammaCorrection",r=>r.symbolizer.u_gammaCorrection,3),new Re("u_opacity",r=>r.common.u_opacity)),t.fragment.code.add(b`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const i=e.applyColormap?b`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:b`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;t.fragment.code.add(b`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${e.stretchType===Ix.Noop?b`
        fragColor = applyBackgroundBlend(currentPixel);`:b`
        if (currentPixel.a == 0.0) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${i}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function e0t(t,e){const i=t.fragment;i.uniforms.add(new et("u_image",n=>n.u_image),new JM("u_hillshadeType",n=>n.symbolizer.u_hillshadeType),new jl("u_sinZcosAs",n=>n.symbolizer.u_sinZcosAs,6),new jl("u_sinZsinAs",n=>n.symbolizer.u_sinZsinAs,6),new jl("u_cosZs",n=>n.symbolizer.u_cosZs,6),new jl("u_weights",n=>n.symbolizer.u_weights,6),new Ki("u_factor",n=>n.symbolizer.u_factor),new Re("u_minValue",n=>n.symbolizer.u_minValue),new Re("u_maxValue",n=>n.symbolizer.u_maxValue),new Ki("u_srcImageSize",n=>n.common.u_srcImageSize)),i.include(Wm),i.code.add(b`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),i.code.add(b`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const r=e.applyColormap?b`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:b`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;i.code.add(b`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${r}
    }
  `)}const t0t=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:Zyt,ColorizerStretchUniforms:Xyt,ColorizerUniforms:f8,build:Jyt},Symbol.toStringTag,{value:"Module"}));function i0t(t,e,i="nearest",r=!1){const n=!(r&&e.pixelType==="u8"),s=n?Fs.FLOAT:Fs.UNSIGNED_BYTE,o=e.pixels==null||e.pixels.length===0?null:n?e.getAsRGBAFloat():e.getAsRGBA(),a=t.capabilities.textureFloat?.textureFloatLinear,l=new Hi;return l.width=e.width,l.height=e.height,l.internalFormat=t.type===fi.WEBGL2&&n?We.RGBA32F:gt.RGBA,l.samplingMode=!a||i!=="bilinear"&&i!=="cubic"?zt.NEAREST:zt.LINEAR,l.dataType=s,l.wrapMode=Vt.CLAMP_TO_EDGE,new Nt(t,l,o)}function r0t(t,e){const{spacing:i,offsets:r,coefficients:n,size:[s,o]}=e,a=i[0]>1,l=new Hi;l.width=a?4*s:s,l.height=o,l.internalFormat=t.type===fi.WEBGL2?We.RGBA32F:gt.RGBA,l.dataType=Fs.FLOAT,l.samplingMode=zt.NEAREST,l.wrapMode=Vt.CLAMP_TO_EDGE;const c=new Float32Array(a?s*o*16:2*r.length);if(a&&n!=null)for(let h=0,d=0;h<n.length;h++)c[d++]=n[h],h%3==2&&(c[d++]=1);else for(let h=0;h<o;h++)for(let d=0;d<s;d++){const f=4*(h*s+d),m=2*(d*o+h);c[f]=r[m],c[f+1]=r[m+1],c[f+3]=r[m]===-1?0:1}return new Nt(t,l,c)}function Jue(t,e){const i=new Hi;return i.internalFormat=gt.RGBA,i.width=e.length/4,i.height=1,i.samplingMode=zt.NEAREST,i.wrapMode=Vt.CLAMP_TO_EDGE,new Nt(t,i,e)}function n0t(t,e,i,r=1,n=!0){return{u_flipY:n,u_applyTransform:!!t,u_opacity:r,u_transformSpacing:t?t.spacing:Ey,u_transformGridSize:t?t.size:Ey,u_targetImageSize:e,u_srcImageSize:i}}function s0t(t,e){return{u_colormapOffset:e||0,u_colormapMaxIndex:t?t.length/4-1:0}}function o0t(t){return{u_bandCount:t.bandCount,u_minOutput:t.outMin,u_maxOutput:t.outMax,u_minCutOff:t.minCutOff,u_maxCutOff:t.maxCutOff,u_factor:t.factor,u_useGamma:t.useGamma,u_gamma:t.gamma,u_gammaCorrection:t.gammaCorrection}}function a0t(t){return{u_hillshadeType:t.hillshadeType,u_sinZcosAs:t.sinZcosAs,u_sinZsinAs:t.sinZsinAs,u_cosZs:t.cosZs,u_weights:t.weights,u_factor:t.factor,u_minValue:t.minValue,u_maxValue:t.maxValue}}const Kue={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};let l0t=class{constructor(e,i,r=null,n=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=e,this.source=i,this.width=r||i.width,this.height=n||i.height}get source(){return this._source}set source(e){this._source=e,this._rasterTexture=rt(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...Kue,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||Kue}set symbolizerParameters(e){this._symbolizerParameters=e}get bandIds(){return this._bandIds}set bandIds(e){e!=null&&e.length>0?this._bandIds&&e.every((i,r)=>!!this._bandIds?.[r]&&i===this._bandIds[r])||(this._bandIds=e,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(e){if(this._interpolation=e,this._rasterTexture!=null){const i=this._getRasterTextureInterpolation(e);this._rasterTexture.setSamplingMode(i==="bilinear"?zt.LINEAR:zt.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid=e,this._transformGridTexture=rt(this._transformGridTexture),this._memoryUsed=null}bind(e){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((this._rasterTexture==null||this._dirty)&&this._updateRasterTexture(e,this.bandIds),this._rasterTexture!=null&&(this._updateColormapTexture(e),this.transformGrid&&this._transformGridTexture==null&&(this._transformGridTexture=r0t(e,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:e,transformGrid:i,width:r,height:n,opacity:s}=this,o=n0t(i,[r,n],[this.source.width,this.source.height],s),a=s0t(e.colormap,e.colormapOffset),l=this.symbolizerParameters.type==="stretch"?o0t(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?a0t(this.symbolizerParameters):null;return new f8(o,a,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get isBilinearWithStretchColorRamp(){const{symbolizerParameters:e}=this;return this.interpolation==="bilinear"&&e.colormap!=null&&e.type==="stretch"}get memoryUsage(){if(this._memoryUsed==null){const e=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=e.map(i=>i!=null?i.descriptor.width*i.descriptor.height*4:0).reduce((i,r)=>i+r,0)}return this._memoryUsed}release(){return this._rasterTexture=rt(this._rasterTexture),this._transformGridTexture=rt(this._transformGridTexture),this._colormapTexture=rt(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(e,i){const r=this.source?this.source.extractBands(i):null;if(!(r&&r.pixels&&r.pixels.length>0))return void(this._rasterTexture=rt(this._rasterTexture));const n=i==null&&this.bandIds==null||i!=null&&this.bandIds!=null&&i.join("")===this.bandIds.join("");if(this._rasterTexture!=null&&n)return;this._rasterTexture=rt(this._rasterTexture);const s=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=i0t(e,r,s,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(e){return this.symbolizerParameters.type==="lut"||e==="nearest"||e==="majority"||this.isBilinearWithStretchColorRamp?"nearest":"bilinear"}_updateColormapTexture(e){const i=this._colormap,r=this.symbolizerParameters.colormap;return r?i?r.length!==i.length||r.some((n,s)=>n!==i[s])?(this._colormapTexture=rt(this._colormapTexture),this._colormapTexture=Jue(e,r),void(this._colormap=r)):void 0:(this._colormapTexture=Jue(e,r),void(this._colormap=r)):(this._colormapTexture=rt(this._colormapTexture),void(this._colormap=null))}},E4=class{constructor(){this.waitingAgents=new Ut,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(e){const i=UB.acquire();return i._init(e),i}release(){this.dispose(),C4.delete(this),UB.release(this)}dispose(){this.loadingAgent=rt(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=hE(this._data)}static prune(){UB.prune(0)}_init(e){this.waitingAgents.clear(),this._data=hE(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=Gc(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){this._upsampleInfo!=null&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,i){if(e!==i&&i!=null){if(this._upsampleInfo==null)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===i)return;this._upsampleInfo.tile.unrefMapData()}i.refMapData(),zyt(e,i,this._upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(e){hE(this._data),this._data=e}};const UB=new $a(E4,null,()=>{}),C4=new Map;function c0t(){C4.size>0&&(console.log(`${C4.size} live TilePerLayerInfo allocations:`),C4.forEach(t=>console.log(t,`
`)))}let mO=class{constructor(e,i){this._texture=e,this._cache=i,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){if(--this._refCount,this._refCount===0)if(this._cache){const e=`${this._texture.descriptor.width} ${this._texture.descriptor.pixelFormat}`;this._cache.put(e,this)}else this.dispose()}dispose(){this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}get usedMemory(){return this._texture.gpuMemoryUsage}};var bt;(function(t){t[t.NONE=0]="NONE",t[t.SPLIT=1]="SPLIT",t[t.ELEVATION=2]="ELEVATION",t[t.MERGE=4]="MERGE",t[t.RENDERDATA=8]="RENDERDATA",t[t.GEOMETRY=16]="GEOMETRY",t[t.TEXTURE_NOFADING=32]="TEXTURE_NOFADING",t[t.TEXTURE_FADING=64]="TEXTURE_FADING"})(bt||(bt={}));const u0t=.1;let Lee=class{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=Zt(),this._elevationBounds=Ge(),this.layerInfo=[[],[]],this.extentInRadians=Zt(),this.centerAtSeaLevel=E(),this._center=[E(),kn(),E()],this.up=mZ(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=E()}static prune(){Dee.prune(0),Nee.prune(0),E4.prune()}get _isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[ss.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;const e=this.parent,i=e?.frustumVisibility??Sa.INTERSECTS;this._frustumVisibility=i===Sa.INSIDE?Sa.INSIDE:i===Sa.OUTSIDE?Sa.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const r=this._frustumVisibility!==Sa.OUTSIDE&&this._intersectsClippingArea;r!==this._visible&&(this._visible=r,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}get shouldLoad(){return this.isLeaf}init(e,i,r,n,s){this.lij[0]=e,this.lij[1]=i,this.lij[2]=r,this.ellipsoid=Wi(s.tilingScheme.spatialReference),s.tilingScheme.getExtent(e,i,r,this.extent),s.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,s.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[ss.MIDDLE][3]=0,this.elevationLevel=e,n&&n.elevationBounds?gs(this._elevationBounds,n.elevationBounds):mi(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=n,this.unsetChildren(),this._surface=s,this.updateVisibility();for(const o of Vb){const a=s.numLayers(o),l=this.layerInfo[o];for(const c of l)c.release();l.length=a;for(let c=0;c<a;c++)l[c]=E4.acquire(this._surface.upsampleInfoPool),o===Yt.ELEVATION&&this.findElevationBoundsForLayer(c,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(s.tilingScheme.pixelSize,B3)}dispose(){Wf(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const e of Vb){for(const i of this.layerInfo[e])i.release();this.layerInfo[e].length=0}this._parent=null;for(let e=0;e<4;++e)this._children[e]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const e=this._cachedMemory;e>0&&this._surface.upsampleMapCache.put(this.key,this,e)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[Yt.MAP].reduce((e,i)=>e+(i instanceof kB?i.memoryUsed/i.referenced:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const i=this._surface.tilingScheme.pixelSize;return i*i*4}_ensureUsedMemory(){if(this._usedMemory!=null)return this._usedMemory;this._usedMemory=this._baseUsedMemory,this._mapTileMemoryInternal=0;let e=0;for(const{data:r}of this.layerInfo[Yt.MAP])r instanceof kB?e+=this._getTerrainDataMemory(r):this._mapTileMemoryInternal+=this._getTerrainDataMemory(r);const i=this._cpuImageMemorySize;for(const r of this.layerInfo[Yt.ELEVATION])this._usedMemory+=r.data?i:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=this.renderData.texture?.usedMemory??0),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+e),this._usedMemory}getUsedMemoryForLayer(e,i){const r=this.layerInfo[e][i];return r?.data?e===Yt.MAP?this._isCached?0:this._getTerrainDataMemory(r.data):e===Yt.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(e){return e instanceof mO?e.texture.gpuMemoryUsage:e instanceof HTMLImageElement||e instanceof Oee?this._cpuImageMemorySize:e instanceof l0t?e.memoryUsage:e instanceof kB?e.memoryUsed/e.referenced:0}updateScreenDepth(e){const i=this._center[ss.MIDDLE],r=e,n=i[0],s=i[1],o=i[2],a=r[2]*n+r[6]*s+r[10]*o+r[14];this.screenDepth=a<0?0:a/(r[3]*n+r[7]*s+r[11]*o+r[15])}shouldSplit(e,i,r){if(!this.visible||e.frustum&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(e.frustum)===Sa.OUTSIDE))return bt.NONE;const n=this.level;de(KL,this._center[ss.MIDDLE],i);let s=na(KL),o=KL,a=ss.MIDDLE;de(zB,this._center[ss.TOP],i);const l=na(zB);l<s&&(s=l,o=zB,a=ss.TOP),de(BB,this._center[ss.BOTTOM],i);const c=na(BB);if(c<s&&(s=c,o=BB,a=ss.BOTTOM),this._edgeLen2>s&&n<e.maxLod)return bt.SPLIT;const h=r!=null?r-n:1/0,d=Math.sqrt(s),f=e.fovX*d*2,m=this._edgeLen/f,y=()=>{if(n<e.maxLod)return this.elevationLevel=n,bt.NONE;const R=n+Math.ceil(-Math.log2(e.relativeWidthLimit/m));return R!==this.elevationLevel?(this.elevationLevel=R,bt.ELEVATION):bt.NONE};if(h<=.5)return y();const _=ge(this.up,KL),v=this._elevationBounds[1]-this._elevationBounds[0],w=v/this.edgeLen;if(e.aboveGround&&_>0&&w<.001&&_/d-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-w>0)return bt.NONE;const x=r!=null?3-Math.min(h,2):1;if(m*x<e.relativeWidthLimit||n>=e.maxLod)return y();if(n<7)return bt.SPLIT;re(Ao,this.up,_),de(Ao,Ao,o);const T=na(Ao);if(T<=this.radius*this.radius)return bt.SPLIT;re(Ao,Ao,this.radius/Math.sqrt(T)),ue(Ao,Ao,this._center[a]),de(Ao,i,Ao);const S=Math.min(1,(Math.abs(ge(Ao,this.up))+.5*v+this._curvatureHeight)/xe(Ao)),C=u0t/e.angledSplitBias,A=e.fovY*d*2;return S*(this._edgeLen/A*x)<C*e.relativeHeightLimit?bt.NONE:bt.SPLIT}setChildren(e,i,r,n){Wf(!!(e&&i&&r&&n),"Null child passed"),this._children[0]=e,this._children[1]=i,this._children[2]=r,this._children[3]=n}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){return this.renderData?.hasGeometry??!1}load(){this.refMapData();for(const e of Vb)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(e){e.unloadTile(this);for(const i of Vb){const r=this.layerInfo[i];for(const n of r)n.loadingAgent&&n.loadingAgent!==uc&&(JL(n.loadingAgent),n.loadingAgent=null),n.pendingUpdates=0}this.resetPendingUpdate(bt.GEOMETRY),this.resetPendingUpdate(bt.TEXTURE_NOFADING),this.resetPendingUpdate(bt.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[Yt.MAP];for(const i of e)i.loadingAgent&&i.loadingAgent!==uc&&(JL(i.loadingAgent),i.loadingAgent=null),i.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(Uw(e,this._clippingArea))return!1;const i=this._intersectsClippingArea,r=this._isWithinClippingArea;e!=null?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const n=r&&this._isWithinClippingArea,s=!(r||i||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||n||s||this.setPendingUpdate(bt.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,i){return this.layerInfo[i][e]}hasLayerData(e,i){const r=this.layerInfo[i][e];return!(!r?.data||r.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of Vb){const i=this.layerInfo[e];for(const r of i)if(r.loadingAgent&&r.loadingAgent!==uc&&r.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(bt.SPLIT)||e!==Yt.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){this._pendingUpdates|=e,e===bt.SPLIT||e===bt.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,i,r){const n=this.layerInfo[i][e];if(n.waitingAgents.has(r))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),i,e),!0;if(n.waitingAgents.push(r),n.data&&!n.dataInvalidated){console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),i,e);const a=n.data&&"type"in n.data&&n.data.type==="vector-tile";return r.dataArrived(this,a),!0}if(n.requestPromise)return!0;Gc(n.requestAbort),n.requestAbort=new AbortController;const s=this._surface.requestTileData(this,e,i,n.requestAbort);if(!s)return n.requestAbort=null,!1;const o=()=>{n.requestPromise===s&&(n.requestPromise=null,n.requestAbort=null)};return n.requestPromise=s,s.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(e){return this.lij[0]===e[0]&&this.lij[1]===e[1]&&this.lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const i=this._children;return i[0]?i[0].findByLij(e)||i[1].findByLij(e)||i[2].findByLij(e)||i[3].findByLij(e):null}distanceToSquared(e){return na(de(Ao,this._center[ss.MIDDLE],e))}containsPoint(e){const i=this.extent;return e[0]>=i[0]&&e[1]>=i[1]&&e[0]<=i[2]&&e[1]<=i[3]}containsPointXY(e,i){const r=this.extent;return e>=r[0]&&i>=r[1]&&e<=r[2]&&i<=r[3]}unrequestLayerData(e,i,r){const n=this.layerInfo[i][e],s=n.waitingAgents,o=s.removeUnordered(r)!=null;Wf(o,"agent has not requested this piece of map data"),s.length<1&&(n.abortRequest(),this.setMemoryDirty())}dataArrived(e,i,r){const n=r!=null&&"type"in r&&r.type==="vector-tile",s=this.layerInfo[i][e];s.data=r,s.dataInvalidated=!1,s.waitingAgents.forAll(o=>o.dataArrived(this,n)),s.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,i,r){r.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${i}/${e} error ${r}`);const n=this.layerInfo[i][e];n.dataMissing=!0,n.waitingAgents.forAll(s=>s.dataMissing()),n.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,i,r){switch(r&&this.forEachLoadedNeighbor(n=>n.updateRenderData(e,i)),e){case Yt.MAP:return this._updateTexture(i);case Yt.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===Rs.FADING?bt.TEXTURE_NOFADING:bt.TEXTURE_FADING),this.setPendingUpdate(e===Rs.FADING?bt.TEXTURE_FADING:bt.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(bt.GEOMETRY);for(const e of this.layerInfo[Yt.ELEVATION])e.pendingUpdates|=bt.GEOMETRY}invalidateLayerData(e,i){this.layerInfo[i][e].invalidateSourceData(),this.restartAgents(i)}computeElevationBounds(){const e=this._elevationBounds,i=e[0],r=e[1];mi(e,1/0,-1/0);const n=this.layerInfo[Yt.ELEVATION];let s=!0;for(const o of n)o.elevationBounds!=null&&(e[0]=Math.min(e[0],o.elevationBounds.min),e[1]=Math.max(e[1],o.elevationBounds.max),o.elevationBounds.hasNoDataValues||(s=!1));s&&(e[0]=Math.min(e[0],0),e[1]=Math.max(e[1],0)),i===e[0]&&r===e[1]||(this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBounds,i=.5*(e[0]+e[1]),r=this._center;re(Ao,this.up,i),ue(r[ss.MIDDLE],this.centerAtSeaLevel,Ao),re(Ao,this.up,e[0]),ue(r[ss.TOP],this.centerAtSeaLevel,Ao),re(Ao,this.up,e[1]),ue(r[ss.BOTTOM],this.centerAtSeaLevel,Ao)}findElevationBoundsForLayer(e,i){const r=this.layerInfo[Yt.ELEVATION][e],n=yH(this.level),s=Math.max(this.elevationLevel-n,0),o=r.elevationBounds;if(o!=null&&o.level>=i&&o.level<=s)return;const a=this._surface.layerViewByIndex(e,Yt.ELEVATION),l=IW(a);if(!IR(this,l,!1))return;const c=d0t;let h=!1;const d=r.data;if(d&&d.level<=s){const f=r.data;c.min=f.samplerData.data.minValue,c.max=f.samplerData.data.maxValue,c.hasNoDataValues=f.samplerData.data.hasNoDataValues,c.level=this.level,h=!0}else{let f,m,y=0;for(let _=this._parent;_&&(!m||y<n)&&(y=this.elevationLevel-_.level,f=m||f,m=_.layerInfo[Yt.ELEVATION][e].data,!(!m&&f&&_.level<=s));_=_.parent);m=m||f,m&&(m.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],c),c.min!==1/0&&(c.level=m.level,h=!0))}h&&(r.elevationBounds==null&&(r.elevationBounds=new U2),r.elevationBounds.copyFrom(c))}modifyLayers(e,i,r){const n=this.layerInfo[r];for(const a of n)a.loadingAgent&&a.loadingAgent!==uc&&(JL(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<n.length;++a)e[a]===void 0&&n[a].release();const s=new Array(...n),o=i.length;n.length=o;for(let a=0;a<o;a++){const l=i[a];n[a]=l>-1?s[l]:E4.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,Rs.FADING))}updateAgents(e){if(this.renderData){const i=this.layerInfo[e];for(const r of i)r.loadingAgent===uc&&(r.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of Vb){const i=this._isSuspended(e);for(const r of this.layerInfo[e])r.loadingAgent&&r.loadingAgent!==uc&&(r.loadingAgent.setSuspension(i),r.loadingAgent===uc&&this.updateRenderData(e,Rs.FADING))}}removeLayerAgent(e,i){const r=this.layerInfo[i][e];r.loadingAgent&&r.loadingAgent!==uc&&r.loadingAgent.dispose(),r.loadingAgent=null}agentDone(e,i){const r=this.layerInfo[i][e];r.loadingAgent=uc,r.data||r.upsampleInfo!=null||this._createOrUpdateAgents(e+1,i)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||AE(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,i,r){for(let n=e;n<i;++n){const s=this._surface.layerViewByIndex(n,r);if(VP(s)&&s?.layer?.blendMode!=="normal"||AE(s?.layer?.parent)&&this._hasBlendableAncestor(s?.layer?.parent))return!0}return!1}_createOrUpdateAgents(e,i){const r=this.layerInfo[i];if(r.length===0)return;const n=this._isSuspended(i);for(let s=e;s<r.length;++s){const o=r[s];let a=!1;const l=this._surface.layerViewByIndex(s,i),c=IW(l);if(o.loadingAgent?IR(this,c,!1)?(o.loadingAgent!==uc&&o.loadingAgent.setSuspension(n),o.loadingAgent!==uc&&(a=o.loadingAgent.update())):o.dispose():IR(this,c,!1)&&(o.loadingAgent=h0t(this,s,i,n),a=o.loadingAgent.startLoading(),a?o.loadingAgent===uc&&this.setPendingUpdate(bt.GEOMETRY):(JL(o.loadingAgent),o.loadingAgent=uc)),o.loadingAgent===uc&&this.updateRenderData(i,Rs.FADING),!this._hasBlendModes(e,r.length,i)&&a&&l.isOpaque)return}}_isWithinExtent(e){const i=this.extent;return i[0]>=e[0]&&e[2]>=i[2]&&i[1]>=e[1]&&e[3]>=i[3]}intersectsExtent(e){const i=this.extent;return i[2]>=e[0]&&e[2]>=i[0]&&i[3]>=e[1]&&e[3]>=i[1]}getElevationVerticesPerSide(e){const i=this.elevationLevel-this.level,r=Math.max(this.level-e,yH(this.level)-i),n=_e(1+(this.maxTesselation>>r),2,this.maxTesselation+1),s=this.getDefaultVerticesPerSide();return Math.max(n,s)}get test(){return{cachedMemory:this._cachedMemory}}_findLIJ(e,i){if(!e)return null;const r=this.surface.rootTiles;if(r!=null){for(const n of r)if(p0t(n,e)){let s=n,o=e[0]-s.level-1;for(;o>=0&&!s.isLeaf&&!i(s);){const a=e[1]>>o&1,l=e[2]>>o&1;s=s.children[2*a+l],o--}return i(s)?s:null}}return null}findNeighborTile(e,i){const r=this.lij,n=this.getNeighborLIJ(r,e);return n?f0t(r,n)?i(this)?this:null:this._findLIJ(n,i):null}findCorner(e,i){const r=e===at.NORTH_EAST?1:e===at.NORTH_WEST?0:e===at.SOUTH_WEST?2:3;let n=this;for(;n.children[0]&&(!i||!i(n));)n=n.children[r];return n}findNeighborCornerTileExact(e,i){return this.findNeighborTile(e,r=>i(r)||r.level===this.level)?.findCorner(fk(e),i)||null}forAllSubtreeOnSide(e,i){const r=e===at.NORTH?[0,1]:e===at.NORTH_EAST?[1]:e===at.EAST?[1,3]:e===at.SOUTH_EAST?[3]:e===at.SOUTH?[2,3]:e===at.SOUTH_WEST?[2]:e===at.WEST?[0,2]:[0],n=s=>{const o=s.children;!i(s)&&o[0]&&r.forEach(a=>n(o[a]))};n(this)}getNeighborEdgeStartVertexIndex(e,i){if(!i)return 0;const r=this.level-i.level;if(Se(!Ns||r>=0),r===0)return 0;const n=2**r,s=(1&e)==1,o=s?0:1,a=i.lij[o+1]*n,l=this.lij[o+1],c=l-a,h=s?n-1-c:c;return Ns&&(Se(a<=l&&l<a+n),Se(0<=h&&h<n)),h}forEachLoadedNeighbor(e){const i=this.level,r=n=>n.level===i||n.isLoaded;sy.forEach(n=>{const s=this.findNeighborTile(n,r);s!=null&&s!==this&&s.forAllSubtreeOnSide(Mee(n),o=>!!o.isLoaded&&(e(o,n),!0))}),mk.forEach(n=>{const s=this.findNeighborTile(n,r)?.findCorner(fk(n),o=>o.isLoaded);Se(!s||UW(this,s,n)),s?.isLoaded&&e(s,n)})}getNeighborLIJ(e,i){const r=Uue(i)?-1:kue(i)?1:0,n=Nue(i)?-1:Fue(i)?1:0,s=[e[0],e[1]+r,e[2]+n];return s[1]<0?null:this.surface.isGlobal?this.wrapLIJ(s):s[2]<0?null:s}wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){const e=this.surface.extent,i=e?.[1]??null;return i!=null&&this.extent[1]+jo()>=i}checkGeometryWaterproofness(){dk&&(Se(this.isLoaded),this.renderData?.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const i=this.extent,r=this.surface.rootTilesExtent,n=.25*(i[2]-i[0]);if(Uue(e)&&i[3]+n>=r[3]||kue(e)&&i[1]-n<=r[1])return!1;const s=this.surface.isGlobal;return!(!s&&Nue(e)&&i[0]-n<=r[0])&&!(!s&&Fue(e)&&i[2]+n>=r[2])}updateDistanceToPOI(e){const i=this._lastPOI;if(this.distanceToPOI>=0&&i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2])return;oe(this._lastPOI,e);const r=this._center[ss.MIDDLE],n=e[0]-r[0],s=e[1]-r[1],o=e[2]-r[2];this.distanceToPOI=n*n+s*s+o*o}};function h0t(t,e,i,r){const n=i===Yt.ELEVATION?Nee.acquire():Dee.acquire();return n.init(t,e,i,r),n}function JL(t){t.dispose(),t instanceof pRe?Nee.release(t):t instanceof fRe&&Dee.release(t)}const Dee=new $a(fRe),Nee=new $a(pRe),d0t=new U2;var ss;function p0t(t,e){const i=t.level,r=e[0];if(i>r)return!1;const n=r-i,s=Math.floor(e[1]/2**n),o=Math.floor(e[2]/2**n);return s===t.lij[1]&&o===t.lij[2]}function f0t(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function m0t(t,e,i){if(t==null||e==null)return!1;if(t.level===0&&e.level===0&&(t.isEastEnd&&e.isWestEnd&&i===at.EAST||t.isWestEnd&&e.isEastEnd&&i===at.WEST))return!0;const r=Math.max(1e-6*(t.extent[2]-t.extent[0]),1);switch(i){case at.NORTH:return Gh(t.extent[3],e.extent[1],r);case at.SOUTH:return Gh(t.extent[1],e.extent[3],r);case at.EAST:return Gh(t.extent[2],e.extent[0],r)||Gh(t.extent[2],-e.extent[0],r);case at.WEST:return Gh(t.extent[0],e.extent[2],r)||Gh(t.extent[0],-e.extent[2],r)}}function UW(t,e,i){return t!=null&&e!=null&&e!==t&&(t.level>=e.level?Que(t,e,i):Que(e,t,fk(i)))}function Que(t,e,i){Se(t.level>=e.level);const r=Mgt(i),n=$gt(i),s=t.extent,o=e.extent,a=[r?s[0]:s[2],n?s[3]:s[1]],l=[r?o[2]:o[0],n?o[1]:o[3]],c=1e-5*(s[2]-s[0]),h=Gh(a[0],l[0],c)||t.surface.isGlobal&&Gh(a[0],-l[0],c),d=Gh(a[1],l[1],c);if(h&&d)return!0;if(t.level===e.level||!h&&!d)return Se(!1),!1;const f=h?ehe(o[1],o[3],s[1],s[3],c):ehe(o[0],o[2],s[0],s[2],c);return Se(f),f}function ehe(t,e,i,r,n){return t-n<=i&&i<=r&&r<=e+n}(function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM"})(ss||(ss={}));const KL=E(),zB=E(),BB=E(),Ao=E();let g0t=class{constructor(){this._scales=Ft(-1,-1,-1,-1),this._offsets=Ft(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,i,r){this._scales[2*e]=i,this._scales[2*e+1]=r}setOffset(e,i,r){this._offsets[2*e]=i,this._offsets[2*e+1]=r}get scales(){return this._scales}get offsets(){return this._offsets}};function y0t(t,e){t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),e.spherical?t.vertex.code.add(b`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):t.vertex.code.add(b`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),t.fragment.code.add(b`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}var um;(function(t){t[t.LayerOnly=0]="LayerOnly",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.COUNT=3]="COUNT"})(um||(um={}));let _0t=class extends PQ{constructor(){super(...arguments),this.overlayOpacity=1}};function v0t(t,e){const{vertex:i,fragment:r,varyings:n}=t;n.add("vtc","vec2"),i.uniforms.add(new the("texOffsetAndScale")),r.uniforms.add(new ihe("tex")),r.uniforms.add(new VB("textureOpacities"));const s=e.textureFadingEnabled&&!e.renderOccluded;s&&(i.uniforms.add(new the("nextTexOffsetAndScale")),n.add("nvtc","vec2"),r.uniforms.add(new ihe("texNext")),r.uniforms.add(new VB("nextTexOpacities")),r.uniforms.add(new b0t("fadeFactor")));const o=e.tileBlendInput===um.ColorComposite,a=e.tileBlendInput===um.GridComposite;a&&r.include(Iee),o&&r.uniforms.add(new VB("backgroundColor")),i.code.add(b`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${s?b`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:b``}
  }`),r.code.add(b`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${a||o?b`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${o?b`backgroundColor`:b`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:b`return color;`}
    }`),s?r.code.add(b`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):r.code.add(b`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)}let b0t=class extends dn{constructor(e){super(e,"float")}},VB=class extends dn{constructor(e){super(e,"vec3")}},the=class extends dn{constructor(e){super(e,"vec4")}},ihe=class extends dn{constructor(e){super(e,"sampler2D")}},_Re=class extends _0t{};function w0t(t){const e=new Ei,{vertex:i,fragment:r,varyings:n}=e;e.include(kM),e.include(ZM,t),e.include(mm,t);const s=()=>{e.include(kP,t),i.code.add(b`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};zc(i,t),e.include(Xl,t);const o=t.overlayMode!==cm.Disabled,a=o&&t.invisible;switch(t.output){case F.Color:{e.include(v0t,t),e.include(Ax,t),o&&e.include(RA,{...t,pbrMode:t.pbrMode===ot.Terrain?ot.TerrainWithWater:ot.Water});const l=t.overlayMode===cm.EnabledWithWater;l&&e.include(y0t,t),n.add("vnormal","vec3"),n.add("vpos","vec3"),n.add("vup","vec3"),s(),t.screenSizePerspective&&tC(i);const c=t.receiveShadows&&!t.renderOccluded;c&&e.include(kC,t),t.screenSizePerspective&&(n.add("screenSizeDistanceToCamera","float"),n.add("screenSizeCosAngle","float")),i.code.add(b`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${l?b`forwardVertexTangent(vnormal);`:b``}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${o?b`setOverlayVTC(uv);`:""}
          ${t.tileBorders?b`forwardTextureCoordinates();`:""}

          ${t.screenSizePerspective?b`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${c?b`forwardLinearDepth();`:""}

        }
      `),e.include(Dn,t),e.include(Ax,t),e.include(KM,t),e.include(Ox,t),Np(r,t),QM(r),GC(r),r.uniforms.add(i.uniforms.get("localOrigin"),new kt("viewDirection",(h,d)=>ye(rhe,ae(rhe,d.camera.viewMatrix[12],d.camera.viewMatrix[13],d.camera.viewMatrix[14])))),l&&r.uniforms.add(new et("ovWaterTex",(h,d)=>d.overlay?.getTexture(jr.WaterNormal)),new qTe("view",(h,d)=>Kl(x0t,d.camera.viewMatrix,h.origin))),r.code.add(b`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),jy(r),Gm(r),r.code.add(b`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${t.receiveShadows&&!t.renderOccluded?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${o?b`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${t.invisible?b`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${t.pbrMode===ot.Terrain||t.pbrMode===ot.TerrainWithWater?b`fragColor = vec4(evaluateTerrainLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:b`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${l?b`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${t.screenSizePerspective?b`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${t.visualizeNormals?t.spherical?b`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:b`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${t.tileBorders?b`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          fragColor = highlightSlice(fragColor, vpos);
        }
      `)}break;case F.Depth:a&&e.include(RA,t),e.include($y,t),Nv(e),Sx(e),i.code.add(b`
              void main(void) {
                ${a?b`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `),r.code.add(b`
              void main() {
                ${a?b`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case F.Shadow:case F.ShadowHighlight:case F.ShadowExcludeHighlight:e.include($y,t),Nv(e),Sx(e),i.code.add(b`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),r.code.add(b`void main() {
outputDepth(linearDepth);
}`);break;case F.Normal:a&&e.include(RA,t),n.add("vnormal","vec3"),tC(i),s(),i.code.add(b`
            void main(void) {
              ${a?b`setOverlayVTC(getUV0());`:""}
              gl_Position = transformPosition(proj, view, position);
              vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
            }
        `),r.code.add(b`
            void main() {
              ${a?b`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              vec3 normal = normalize(vnormal);
              if (gl_FrontFacing == false) {
                normal = -normal;
              }
              fragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
            }
        `);break;case F.Highlight:o&&e.include(RA,t),i.code.add(b`
          void main() {
            ${o?b`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),e.include(s1,t),r.code.add(b`
          void main() {
            ${o?b`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return t.output===F.ObjectAndLayerIdColor&&(o?(e.include(RA,{...t,pbrMode:ot.Disabled}),i.code.add(b`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),r.code.add(b`void main() {
fragColor = getOverlayColorTexel(vtcOverlay);
}`)):(i.code.add(b`void main(void) {}`),r.code.add(b`void main() {
fragColor = vec4(0.0);
}`))),e}const x0t=be(),rhe=E(),T0t=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:_Re,build:w0t},Symbol.toStringTag,{value:"Module"}));let vRe=class bRe extends Fi{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(e,i){i.spherical=e.viewingMode===Le.Global}initializeProgram(e){return new Mi(e.rctx,bRe.shader.get().build(this.configuration),wRe)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const i=this.configuration,r=i.backfaceCullingEnabled&&!i.renderOccluded;return Lt({blending:i.renderOccluded?Yc(Te.ONE,Te.ONE_MINUS_SRC_ALPHA):null,culling:r?mK:null,depthTest:i.renderOccluded?null:{func:Bi.LESS},depthWrite:i.renderOccluded?null:ec,colorWrite:Gt,stencilTest:e?jrt(Zl.IntegratedMeshMaskExcluded):null})}getPipeline(){return this.useStencil?this._stencilPipelineState:super.getPipeline()}};vRe.shader=new Pi(T0t,()=>ce(()=>import("./Terrain.glsl-e248bb97.js"),[],import.meta.url));const wRe=new Map([[O.POSITION,0],[O.UV0,1],[O.NORMALCOMPRESSED,2]]);let S0t=class{constructor(){this.geometry=new Pyt,this.intersectionData=null,this.geometryState=null,this._textureRef=new cRe(()=>this.tile.surface.textureFadeDuration),this.overlay=new g0t,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._dirtyEdgeResolutions=15,this._dirtyEdges=15,this._dirtyCorners=15}get tile(){return this._tile}init(e){this.clear(),this._tile=e;const i=this.geometry;i.indices=null,i.vertexAttributes=null,Pr(i.boundingBox),i.indexCount=0,i.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new Iyt,this.localOrigin=null,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this._wireframeChanged||this._clippingAreaChanged||this._samplerDataChanged||this._numVerticesPerSideChanged||this._dirtyCorners||this._dirtyEdgeResolutions||this._dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),Ns&&this.tile.intersectsClippingArea)for(let i=0;i<4;++i)Se(this.geometry.outerEdges[i].count===this.geometryState.neighborData.edgeResolutions[i]+1)}_calculateEdgeResolution(e,i){const r=this.tile,n=this.geometryState.numVerticesPerSide-1;if(!r.surface.isGlobal){const l=r.surface.extent;if(l!=null&&(e===0&&r.extent[3]>l[3]||e===1&&r.extent[2]>l[2]||e===2&&r.extent[1]<l[1]||e===3&&r.extent[0]<l[0]))return n}const s=r.level,o=sy[e];if(!i)return Se(r.surface?.rootTiles==null||r.surface.updatingRootTiles||!r.shouldHaveNeighbor(o)),n;if(i.isLoaded){const l=i,c=l.renderData.geometryState,h=s-l.level;if(Se(h>=0),h===0){const m=c.numVerticesPerSide-1;return Math.max(m,n)}const d=2**h,f=c.neighborData.edgeResolutions[(e+2)%4]/d;return Math.max(1,f)}Se(!i.isLeaf);let a=n;return i.forAllSubtreeOnSide(Mee(o),l=>l===r||(l.isLoaded?(a=Math.max(a,2**(l.level-s)),!0):(Se(!l.isLeaf),!1))),a}updateNeighborData(){const e=this.tile;if(!e.intersectsClippingArea)return;const i=e.renderData.geometryState.neighborData,r=a=>(a.isLoaded||a.level===e.level)&&a?.intersectsClippingArea,n=i.edgePeerNeighbors,s=i.edgePeerNeighborSamplerVersions;for(let a=0;a<4;++a){const l=e.findNeighborTile(sy[a],r),c=yw(e,l),h=c?.renderData?.geometryState.samplerDataVersion??-1,d=n[a],f=c!==yw(e,d),m=s[a]!==h;n[a]=l,(f||m)&&(s[a]=h,this._markEdgeDirty(a));const y=i.edgeResolutions[a],_=this._calculateEdgeResolution(a,l);Se(fx(_)),Se(_>=1),i.edgeResolutions[a]=_,y!==_&&this._markEdgeResolutionDirty(a)}const o=i.cornerPeerNeighbors;for(let a=0;a<4;++a){const l=e.findNeighborTile(mk[a],r);o[a]=l;const c=yw(e,n[a]),h=yw(e,n[(a+1)%4]),d=yw(e,l);Od[a]=d,Od[(a+1)%4]=h,Od[(a+2)%4]=e,Od[(a+3)%4]=c,Se(Od.some(_=>_?.isLoaded||_===e));const f=Od.reduce((_,v)=>Math.min(_,v?.level??1/0),1/0);Od.forEach((_,v)=>{_&&_?.level>f&&(Od[v]=null)}),Se(Od.some(_=>_?.isLoaded||_===e));const m=i.cornerNeighborData[a].cornerTiles,y=i.cornerNeighborData[a].cornerTileSamplerVersions;for(let _=0;_<4;++_){const v=Od[_],w=v?.renderData.geometryState.samplerDataVersion??-1,x=m[_]!==v,T=!x&&y[_]!==w;(x||T)&&(m[_]=v,y[_]=w,this._markCornerDirty(a))}Se(m.some(_=>_?.isLoaded||_===e))}Ns&&Se(this.geometryState.neighborData.edgeResolutions.every(a=>a>0));for(let a=0;a<4;++a)Od[a]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;Ns&&Se(!this.tile.intersectsClippingArea||this.geometryState.neighborData.edgeResolutions.every(l=>l>0)),this.intersectionData=null;const i=this.tile,r=this._vao,n=this.geometry.vertexAttributes,s=!r||!n||this._wireframeChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._dirtyEdgeResolutions,o=!s&&(this._dirtyEdges!==0||this._dirtyEdgeResolutions!==0),a=!o&&this._dirtyCorners!==0;s?(this.releaseGeometry(),this._createGeometry(e)):o||a?i.updateEdgeElevations():a?i.updateCornerElevations():console.warn("Update for no reason?"),this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._dirtyEdgeResolutions=0,this._dirtyEdges=0,this._dirtyCorners=0,this._clippingAreaChanged=!1,this._wireframeChanged=!1}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao=rt(this._vao),this.geometry.release(),!0)}ensureTexture(e,i,r){const n=i?gt.RGBA:gt.RGB;return this._texture==null||this._texture.descriptor.width===e&&this._texture.descriptor.pixelFormat===n||this.releaseTexture(),this._texture==null&&(this._texture=r(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){this._texture!=null&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}_markCornerDirty(e){const i=1<<e;this._dirtyCorners|=i}_markEdgeDirty(e){const i=1<<e;this._dirtyEdges|=i,this._markCornerDirty((e+0)%4),this._markCornerDirty((e+3)%4)}_markEdgeResolutionDirty(e){const i=1<<e;this._dirtyEdgeResolutions|=i,this._markEdgeDirty(e)}_markAllEdgesAndCornersDirty(){this._dirtyCorners=15,this._dirtyEdges=15,this._dirtyEdgeResolutions=15}updateGeometryState(){const e=this._getElevationInfo(),i=this.tile,r=e.samplerData?i.getElevationVerticesPerSide(e.maxTileLevel):i.getDefaultVerticesPerSide(),n=Math.max(r,5);let s=i.clippingArea;i.intersectsClippingArea&&!i.isWithinClippingArea||(s=null);const o=this.geometryState;let a=!1;o.numVerticesPerSide!==n&&(this._numVerticesPerSideChanged=!0,o.numVerticesPerSide=n,o.samplerDataVersion++,a=!0),e.changed&&(this._samplerDataChanged=!0,o.samplerData=e.samplerData,o.samplerDataVersion++,a=!0),vy(o.clippingArea,s)||(this._clippingAreaChanged=!0,o.clippingArea=s,a=!0);const l=i.surface.wireframe;return o.wireframe!==l&&(this._wireframeChanged=!0,o.wireframe=l,a=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const i=this.geometry.vertexAttributes,r=this.geometry.indices,n=e.gl;this._vao=new Hp(e,wRe,{geometry:Kc(i.layout)},{geometry:Ui.createVertex(e,n.STATIC_DRAW,i.buffer)},Ui.createIndex(e,n.STATIC_DRAW,r)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,i=gy.Immediate){e!=null&&e.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(e,i)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,i=this.tile.layerInfo[Yt.ELEVATION],r=i.length,n=new Array(r);let s=0,o=0,a=!1;for(let h=0;h<r;h++){const d=i[h];if(d.upsampleInfo!=null){const f=d.upsampleInfo.tile,m=f.layerInfo[Yt.ELEVATION][h].data,y=m&&m.samplerData;e&&e[s]===y||(a=!0),n[s++]=y,o=Math.max(o,f.lij[0])}else if(d.data){const f=this.tile.surface.layerViewByIndex(h,Yt.ELEVATION);if(IR(this.tile,f.layer,!1)){const m=d.data;e&&e[s]===m.samplerData||(a=!0),n[s++]=m.samplerData,o=this.tile.level}}}e!=null&&e.length!==s&&(a=!0);const l=s>0,c=l?n:null;return l&&(n.length=s),{changed:a,samplerData:c,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){const e=this.intersectionData?.estimatedMemoryUsage??0;return(this.geometry.indices?.byteLength??0)+(this.geometry.vertexAttributes?.byteLength??0)+e}get texture(){return this._texture}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){if(!Ns)return;const e=this.tile;if(!e.isLoaded||!e.intersectsClippingArea||e.level===0)return void Se(e?.isLoaded);const i=e.surface.extent;if(i!=null&&!e.intersectsExtent(i))return;const r=sy.map((a,l)=>i!=null&&(l<2?-1:1)*(e.extent[3-l]-i[3-l])<0),n=e.level;Se(this._dirtyCorners===0),Se(this._dirtyEdges===0),Se(this._dirtyEdgeResolutions===0),Se(!this._numVerticesPerSideChanged),Se(!this._samplerDataChanged),Se(!this._clippingAreaChanged),Se(!this._wireframeChanged);const s=mk.map(a=>e.findNeighborCornerTileExact(a,l=>!l.intersectsClippingArea||l.isLoaded||l.level===e.level)??null).map(a=>a?.intersectsClippingArea?a:null),o=this.geometryState.neighborData;for(let a=0;a<4;++a){const l=o.cornerPeerNeighbors[a],c=s[a];Se(c===l,`Tile[${e.lij}].corner[${a}] out of date: cur=[${l?.lij}] exp=[${c?.lij}]`)}sy.forEach((a,l)=>{if(r[l])return;const c=e.findNeighborTile(a,V=>(V.level===n||V?.isLoaded)&&V?.intersectsClippingArea);if(!c){const V=!e.surface.updatingRootTiles&&e.surface.rootTiles!=null&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(a);return void Se(!V)}Se(c.isLoaded||c.level===e.level),Se(c===this.geometryState.neighborData.edgePeerNeighbors[l]);const h=n-c.level;if(!c.isLoaded)return Se(!c.isLeaf),void Se(h===0);const d=c.renderData;Se(m0t(e,c,a)),Se(h>=0);const f=2**h;if(h<0)return void Se(!1);const m=e.renderData,y=m.geometry,_=y.outerEdges[l],v=y.numVerticesPerSide-1,w=d.geometry;if(!w)return void Se(!1);const x=this.geometryState.neighborData.edgePeerNeighbors[l];if(x?.isLoaded){const V=x.renderData;Se(x==x),Se(m.geometryState.neighborData.edgePeerNeighborSamplerVersions[l]===V.geometryState.samplerDataVersion),Se(this.geometryState.neighborData.edgePeerNeighborSamplerVersions[l]===V.geometryState.samplerDataVersion)}const T=(l+2)%4,S=w.outerEdges[T],C=_.count-1,A=S.count-1;Se(C*f===A,`Tile[${e.lij}]:e${l},res=${C} edgeRes mismatch with Neighbor[${c.lij}]:e${T},res=${A} (expected:${C*f})`);const R=e.extent,D=a===at.NORTH||a===at.SOUTH,N=S.count-1,k=N/2**h,B=_.count-1;if(k<1)return void Se(B===1);Se(k===B),Se(fx(k));const L=w.numVerticesPerSide-1;Se(h>0||k===Math.max(L,v));const z=e.getNeighborEdgeStartVertexIndex(l,c);Se(0<=z&&z<f);const j=z*k;Se(0<=j&&j<=N-k);let H=0,X=j;_.getVertexPos(mf,0),_.getVertexPos(gf,_.count-1);const P=Mr(mf,gf),I=Math.max(E0t,1e-4*P);for(let V=0;V<=k;++V){_.getVertexPos(mf,H),S.getVertexPos(gf,X);const q=V/k,Y=D?R[0]+q*(R[2]-R[0]):a===at.WEST?R[0]:R[2],J=D?a===at.SOUTH?R[1]:R[3]:R[1]+q*(R[3]-R[1]),ee=e.surface.extent;if(ee==null||$6(ee,Y,J)){const me=fM(mf,gf),Me=Cc(mf)-Ai.radius,yt=Cc(gf)-Ai.radius,St=me<I;if(!St){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${l}[${H}/${_.count}] and [${c.lij}].edge${T}[${X}/${S.count}]`),ee!=null&&console.warn("  surface extent= ",ee," x,y=",Y,",",J);const je=E();de(je,m.localOrigin,d.localOrigin),Cc(je)>0&&console.warn(`   localOrigins: ${m.localOrigin} vs ${d.localOrigin} d=${Cc(je)} [${je}]`),(()=>{const he=Qr(mf),At=Qr(gf);e.updateEdgeElevations(),c.updateEdgeElevations(),_.getVertexPos(mf,H),S.getVertexPos(gf,X);const ve=E();go(ve,mf,he),Cc(ve)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${he} vs ${mf} d=${Cc(ve)} [${ve}]`),go(ve,gf,At),Cc(ve)>0&&console.warn(`  XXX Neighbor[${c.lij}] edge out of date: ${At} vs ${gf} d=${Cc(ve)} [${ve}]`)})(),Se(St,`Mismatch in tile [${e.lij}].edge[${l}][${H}/${_.count}] vs neighbor [${c.lij}].edge[${T}][${X}/${S.count}] ${hg(mf)} vs ${hg(gf)}  dist=${me} h(t|n|d)=${Me}|${yt}|${yt-Me}`)}_.getNormal(nS,H),S.getNormal(sS,X),ye(nhe,nS),ye(she,sS);const ct=ge(nhe,she),vt=1-ct<.01||!1||e===c;if(!vt){const je=E();go(je,nS,sS);const he=()=>`Mismatch in tile edge normal ${Due(e.lij)} (${H}/${_.count-1}) edge ${l} vs neighbor ${Due(c.lij)}  (${X}/${S.count-1}) nedge ${T} :${hg(nS)} vs ${hg(sS)}  dot = ${ct} : ${hg(je)}`;console.warn("Mismatch in tile edge normal: ",he());{e.updateEdgeElevations(),c.updateEdgeElevations();const At=E(),ve=E();_.getNormal(At,H),S.getNormal(ve,X),hx(nS,At)||console.warn("Missing update in tile normal: ",hg(nS)," => ",hg(At)),hx(sS,ve)||console.warn("Missing update in neighbor normal: ",hg(sS)," => ",hg(ve))}Se(vt,he())}}H+=1,X+=1}})}};const mf=E(),gf=E(),nS=E(),sS=E(),nhe=E(),she=E(),E0t=1,Od=[null,null,null,null];function yw(t,e){return e?.isLoaded||e===t?e:null}const C0t=65536;function A0t(t,e){const i=t.tile,{extent:r,extentInRadians:n,surface:s}=i,o=t.localOrigin,a=t.geometryState,l=s.isWebMercator,c=a.numVerticesPerSide,h=c-1,d=(c-2)**2,f=l&&(e===Vh.HAS_SOUTH_POLE||e===Vh.HAS_BOTH_POLES),m=l&&(e===Vh.HAS_NORTH_POLE||e===Vh.HAS_BOTH_POLES),y=6,_=((f?1:0)+(m?1:0))*y*(h+1),v=a.neighborData,w=v.edgeResolutions.reduce((D,N)=>D+N+1,0),x=d+_+w,T=s.renderer.tileGeometryCache.acquire(x),S=t.geometry;S.numVerticesPerSide=a.numVerticesPerSide,S.vertexAttributes=T;const C=S.boundingBox;Pr(C);const A=Fee(t);Do.update(h,n,A),O0t(t),MRe(t,d),xRe(t);const R=[];if((()=>{let D=d+w;const N=o[0],k=o[1],B=o[2],L=i.ellipsoid.radius,z=r[1],j=r[3],H=(X,P)=>{const I=P*c;Jh(-N,-k,X*L-B,C),R.push({connectedRowOffset:I,connectedOuterEdgeOffset:X===1?0:2,rowOffset:D,latitudeResolution:y});const V=ERe(X===-1?z:j,L),q=X*Math.PI/2-V,Y=.99*(X===1?1:-1),J=L+0,{position:ee,uv0:me}=T,{typedBuffer:Me,typedBufferStride:yt}=T.normalCompressed;for(let St=1;St<=y;++St){const ct=V+q*(St/y),vt=Math.cos(ct),je=Math.sin(ct);for(let he=0;he<=h;he++){const At=he/h,ve=Do.sinLonLUT[he],Fe=Do.cosLonLUT[he]*vt,st=ve*vt,_t=je,Et=Fe*J-N,$t=st*J-k,qe=_t*J-B;Jh(Et,$t,qe,C),ee.setValues(D,Et,$t,qe),Rp(me,D,At,Y),Mx(Me,D,Fe,st,_t,yt),++D}}};f&&H(-1,0),m&&H(1,h)})(),PRe(S,a.numVerticesPerSide,R,[0,c-1],[0,c-1],a.wireframe),t.intersectionData=null,Ns)for(let D=0;D<4;++D)Se(S.outerEdges[D].count===v.edgeResolutions[D]+1)}function O0t(t){const e=t.tile;if(!e.intersectsClippingArea)return;const i=t.geometryState,r=i.numVerticesPerSide,n=r-2,s=r-1,o=t.geometry,a=o.vertexAttributes,l=a.position,c=a.uv0,{typedBuffer:h,typedBufferStride:d}=a.normalCompressed,f=e.extent,m=f[0],y=f[2],_=f[1],v=f[3],w=e.ellipsoid.radius,x=i.samplerData,T=t.localOrigin,S=T[0],C=T[1],A=T[2],R=l.typedBuffer,D=l.typedBufferStride,N=1/s,k=o.boundingBox;let B=0;if(1<=n){const L=N,z=_*(1-L)+v*L,j=Do.sinLatLUT[1],H=Do.cosLatLUT[1];for(let X=1;X<=n;X++){const P=X*N,I=m*(1-P)+y*P,V=Do.sinLonLUT[X],q=Do.cosLonLUT[X],Y=w+ln(I,z,x),J=Y*q*H-S,ee=Y*V*H-C,me=Y*j-A;Jh(J,ee,me,k);const Me=(X-1)*D;R[Me]=J,R[Me+1]=ee,R[Me+2]=me,Rp(c,X-1,P,L)}}for(let L=1;L<=n;L++){const z=L*N,j=_*(1-z)+v*z,H=Do.sinLatLUT[L],X=Do.cosLatLUT[L],P=L+1,I=P*N,V=_*(1-I)+v*I,q=Do.sinLatLUT[P],Y=Do.cosLatLUT[P],J=Do.sinLonLUT[0],ee=Do.cosLonLUT[0],me=w+ln(m,j,x);let Me=ee*X*me-S,yt=J*X*me-C,St=H*me-A;const ct=B*D;let vt=R[ct],je=R[ct+1],he=R[ct+2];for(let At=1;At<=n;At++){const ve=At*N,Fe=m*(1-ve)+y*ve,st=Do.sinLonLUT[At],_t=Do.cosLonLUT[At];let Et=0,$t=0,qe=0;if(At<n){const vi=(B+1)*D;Et=R[vi],$t=R[vi+1],qe=R[vi+2]}else{const vi=Do.sinLonLUT[s],mr=Do.cosLonLUT[s],Wr=w+ln(y,j,x);Et=mr*X*Wr-S,$t=vi*X*Wr-C,qe=H*Wr-A}const Ot=Me,Jt=yt,Gi=St;Me=vt,yt=je,St=he,vt=Et,je=$t,he=qe;const dt=Et-Ot,mt=$t-Jt,ht=qe-Gi;let Kt=0,Ht=0,Er=0;if(L>1){const vi=(B-n)*D;Kt=R[vi],Ht=R[vi+1],Er=R[vi+2]}else{const vi=Do.sinLatLUT[0],mr=Do.cosLatLUT[0],Wr=w+ln(Fe,_,x);Kt=_t*mr*Wr-S,Ht=st*mr*Wr-C,Er=vi*Wr-A}const Qi=w+ln(Fe,V,x),ui=_t*Y*Qi-S,$i=st*Y*Qi-C,$r=q*Qi-A;if(L<n){const vi=B+n,mr=vi*D;R[mr]=ui,R[mr+1]=$i,R[mr+2]=$r,Jh(ui,$i,$r,k),Rp(c,vi,ve,I)}const Cr=Kt-ui,Ar=Ht-$i,ki=Er-$r;let qr=_t*X,Yi=st*X,fr=H;fr*fr<.999&&(qr=ht*Ar-mt*ki,Yi=dt*ki-ht*Cr,fr=mt*Cr-dt*Ar);const ar=1/Math.sqrt(qr*qr+Yi*Yi+fr*fr);Mx(h,B,qr*ar,Yi*ar,fr*ar,d),++B}}}function R0t(t){t.tile.intersectsClippingArea&&(xRe(t),m8(t))}function P0t(t){t.tile.intersectsClippingArea&&(SRe(t),TRe(t,!0),m8(t))}function xRe(t){t.tile.intersectsClippingArea&&(SRe(t),TRe(t))}function TRe(t,e=!1){const i=t.geometryState,r=t.geometry,n=i.neighborData,s=t.tile,o=s.level,a=s.extent,l=s.ellipsoid.radius,c=s.extentInRadians,h=c[0],d=c[2],f=c[1],m=c[3],y=i.samplerData,_=a[0],v=a[2],w=a[1],x=a[3],T=Fee(t),S=r.boundingBox,C=t.localOrigin,A=C[0],R=C[1],D=C[2],N=r.vertexAttributes,k=N.position,B=k.typedBuffer,L=k.typedBufferStride,z=N.uv0;for(let j=0;j<4;++j){const H=j===1||j===3,X=n.edgeResolutions[j];Se(fx(X));const P=X+1,I=yw(s,n.edgePeerNeighbors[j]);if(LRe(s,I,j)){$Re(t,j,I);continue}const V=I!=null;Se(!V||I.level===s.level),Se(!V||yy(s,I)<=0);const q=I?.renderData,Y=q?.geometryState;if(Ns){const dt=s.surface;if(!I&&dt&&!dt.updatingRootTiles){const mt=sy[j],ht=s.findNeighborTile(mt,Kt=>Kt.isLoaded||Kt.isLeaf||Kt.level===s.level);ht?ht.intersectsClippingArea&&(Se(!ht.isLoaded),Se(!ht.isLeaf),Se(ht.level===o)):Se(dt?.rootTiles==null||!s.shouldHaveNeighbor(mt))}}const J=j===1?a[2]:a[0],ee=I?.extent,me=ee&&H?j===1?ee[0]:ee[2]:J,Me=j===0?a[3]:a[1],yt=j===1?1:0,St=j===0?1:0,ct=j===1?d:h,vt=j===0?m:f,je=Math.sin(ct),he=Math.cos(ct),At=Math.sin(vt),ve=Math.cos(vt),Fe=Y?.samplerData,st=V?(dt,mt,ht)=>.5*(ln(dt,mt,y)+ln(ht,mt,Fe)):(dt,mt,ht)=>ln(dt,mt,y),_t=r.outerEdges[j],Et=e&&P>3?P-3:1,$t=y!=null&&y.some(dt=>dt!=null),qe=Fe!=null&&Fe.some(dt=>dt!=null),Ot=$t||qe,Jt=1/X,Gi=_t.index0;Se(!ee||Gh(ee[2]-ee[0],a[2]-a[0])),(()=>{const dt=j===1?-1:j===3?1:0,mt=j===0?-1:j===2?1:0,ht=(a[2]-a[0])*Jt,Kt=dt*ht,Ht=mt*ht,Er=H?dt*((d-h)*Jt):0,Qi=H?0:mt*Jt,ui=St,$i=H?ct+Er:ct,$r=H?Math.sin($i):je,Cr=H?Math.cos($i):he,Ar=H?ct-Er:ct,ki=H?Math.sin(Ar):je,qr=H?Math.cos(Ar):he,Yi=H?vt:T(ui+Qi),fr=H?At:Math.sin(Yi),ar=H?ve:Math.cos(Yi),vi=H?vt:T(ui-Qi),mr=H?At:Math.sin(vi),Wr=H?ve:Math.cos(vi);let xo=0,To=0,So=0;{const er=0*Jt,Xs=H?J:_*(1-er)+v*er,qo=H?me:Xs,Fa=H?w*(1-er)+x*er:Me,se=H?ct:h*(1-er)+d*er,Ir=H?je:Math.sin(se),gd=H?he:Math.cos(se),Zs=H?T(er):vt,yd=H?Math.sin(Zs):At,Ke=H?Math.cos(Zs):ve,ic=l+st(Xs,Fa,qo);xo=gd*Ke*ic,To=Ir*Ke*ic,So=yd*ic}let Eo=0,sn=0,Yr=0;{const er=1*Jt,Xs=H?J:_*(1-er)+v*er,qo=H?me:Xs,Fa=H?w*(1-er)+x*er:Me,se=H?ct:h*(1-er)+d*er,Ir=H?je:Math.sin(se),gd=H?he:Math.cos(se),Zs=H?T(er):vt,yd=H?Math.sin(Zs):At,Ke=H?Math.cos(Zs):ve,ic=l+st(Xs,Fa,qo);Eo=gd*Ke*ic,sn=Ir*Ke*ic,Yr=yd*ic}for(let er=1;er<P-1;er+=Et){let Xs=0,qo=0,Fa=0;{const ka=(er+1)*Jt,rc=H?J:_*(1-ka)+v*ka,Xp=H?me:rc,Ks=H?w*(1-ka)+x*ka:Me,pn=H?ct:h*(1-ka)+d*ka,s0=H?je:Math.sin(pn),p1=H?he:Math.cos(pn),f1=H?T(ka):vt,aT=H?Math.sin(f1):At,m1=H?Math.cos(f1):ve,o0=l+st(rc,Ks,Xp);Xs=p1*m1*o0,qo=s0*m1*o0,Fa=aT*o0}const se=Xs,Ir=qo,gd=Fa,Zs=Eo,yd=sn,Ke=Yr;Eo=se,sn=Ir,Yr=gd;{const ka=Gi+er,rc=ka*L,Xp=Zs-A,Ks=yd-R,pn=Ke-D;B[rc]=Xp,B[rc+1]=Ks,B[rc+2]=pn,Jh(Xp,Ks,pn,S);const s0=er*Jt;Rp(z,ka,H?yt:s0,H?s0:St)}const ic=xo,Js=To,u1=So;xo=Zs,To=yd,So=Ke;const h1=Zs,_l=yd,Zm=Ke,d1=1/Math.sqrt(h1*h1+_l*_l+Zm*Zm),ei=Zm*d1;let r0=0,Jm=0,n0=0;if(Ot&&ei*ei<.999){let ka=0,rc=0,Xp=0;{const Ks=j===0?-1:1;ka=Ks*(se-ic),rc=Ks*(Ir-Js),Xp=Ks*(gd-u1)}{const Ks=er*Jt,pn=H?J:_*(1-Ks)+v*Ks,s0=H?me:pn,p1=H?w*(1-Ks)+x*Ks:Me,f1=H?ct:h*(1-Ks)+d*Ks,aT=H?je:Math.sin(f1),m1=H?he:Math.cos(f1),o0=H?T(Ks):vt,x$=H?Math.sin(o0):At,vl=H?Math.cos(o0):ve;let WC=h1,YC=_l,W=Zm;if(V){const fe=l+ln(s0-Kt,p1-Ht,Fe),Ee=H?vl:Wr;WC=(H?qr:m1)*Ee*fe,YC=(H?ki:aT)*Ee*fe,W=(H?x$:mr)*fe}{const fe=l+ln(pn+Kt,p1+Ht,y),Ee=H?vl:ar,gi=(H?Cr:m1)*Ee*fe,ls=(H?$r:aT)*Ee*fe,Or=(H?x$:fr)*fe;V||(WC=2*h1-gi,YC=2*_l-ls,W=2*Zm-Or);const Ua=j===3?-1:1,g1=Ua*(WC-gi),kte=Ua*(YC-ls),Ute=Ua*(W-Or);r0=Xp*kte-rc*Ute,Jm=ka*Ute-Xp*g1,n0=rc*g1-ka*kte;const M8=1/Math.sqrt(r0*r0+Jm*Jm+n0*n0);r0*=M8,Jm*=M8,n0*=M8}}}else r0=h1*d1,Jm=_l*d1,n0=Zm*d1;_t.setNormalFromValues(er,r0,Jm,n0)}})()}}function SRe(t){IRe(t)}function ERe(t,e){return Math.PI/2-2*Math.atan(Math.exp(-t/e))}function M0t(t,e,i,r){return ERe(t*(1-r)+e*r,i)}function $0t(t,e,i){return t*(1-i)+e*i}function Fee(t){const e=t.tile;if(e.surface.isWebMercator){const r=e.extent,n=e.ellipsoid.radius;return s=>M0t(r[1],r[3],n,s)}const i=e.extentInRadians;return r=>$0t(i[1],i[3],r)}function I0t(t,e){const i=t.tile,{extent:r,surface:n}=i,s=t.geometryState,o=r[0],a=r[1],l=r[2]-o,c=r[3]-a,h=s.clippingArea,d=h!=null?Math.max(0,(h[0]-o)/l):0,f=h!=null?Math.max(0,(h[1]-a)/c):0,m=h!=null?Math.min(1,(h[2]-o)/l):1,y=h!=null?Math.min(1,(h[3]-a)/c):1,_=s.numVerticesPerSide,v=(_-2)**2,w=v+s.neighborData.edgeResolutions.reduce((C,A)=>C+A+1,0),x=n.renderer.tileGeometryCache.acquire(w),T=t.geometry,S=T.boundingBox;Pr(S),T.numVerticesPerSide=s.numVerticesPerSide,T.vertexAttributes=x,Gr(T.uvRange,d,f,m,y),L0t(t),MRe(t,v),CRe(t),PRe(T,s.numVerticesPerSide,[],[0,_-1],[0,_-1],s.wireframe),t.intersectionData=null}function L0t(t){const e=t.tile;if(!e.intersectsClippingArea)return;const i=e.surface,r=t.geometryState,n=r.samplerData,s=t.localOrigin,o=i.isWebMercatorOnPlateeCarree,a=r.clippingArea,l=a??kee,c=e.extent,h=c[0],d=c[1],f=c[2],m=c[3],y=Math.max(h,l[0]),_=Math.min(f,l[2]),v=Math.max(d,l[1]),w=Math.min(m,l[3]),x=e.ellipsoid.radius,T=e.horizontalScale,S=r.numVerticesPerSide,C=S-1,A=S-2,R=t.geometry,D=R.vertexAttributes,N=D.position,k=D.uv0,{typedBuffer:B,typedBufferStride:L}=D.normalCompressed,z=R.uvRange,j=z[0],H=z[1],X=z[2],P=z[3],I=R.boundingBox,V=s[0],q=s[1],Y=s[2],J=N.typedBuffer,ee=N.typedBufferStride;let me=0;const Me=_e(d,v,w),yt=o?(Math.PI/2-2*Math.atan(Math.exp(-Me/x)))*x:Me*T,St=1/C,ct=_e(d*(1-St)+m*St,v,w);let vt=yt,je=o?(Math.PI/2-2*Math.atan(Math.exp(-ct/x)))*x:ct*T;for(let he=1;he<=A;he++){const At=he/C,ve=_e(d*(1-At)+m*At,v,w),Fe=_e(At,H,P),st=je,_t=(he-1)/C,Et=_e(d*(1-_t)+m*_t,v,w),$t=vt,qe=(he+1)/C,Ot=_e(d*(1-qe)+m*qe,v,w),Jt=o?(Math.PI/2-2*Math.atan(Math.exp(-Ot/x)))*x:Ot*T,Gi=_e(qe,H,P);vt=je,je=Jt;const dt=_e(h,y,_);let mt=dt*T,ht=ln(dt,ve,n);const Kt=1/C,Ht=_e(Kt,j,X),Er=_e(h*(1-Ht)+f*Ht,y,_);let Qi=Ht,ui=Er,$i=Er*T,$r=ln(Er,ve,n);if(he===1){const Cr=$i-V,Ar=vt-q,ki=$r-Y,qr=0*ee;J[qr]=Cr,J[qr+1]=Ar,J[qr+2]=ki,Jh(Cr,Ar,ki,I);const Yi=_e(Kt,j,X);Rp(k,me,Yi,Fe)}for(let Cr=1;Cr<=A;Cr++){const Ar=$i,ki=$r,qr=(Cr+1)/C,Yi=_e(qr,j,X),fr=_e(h*(1-qr)+f*qr,y,_),ar=ui;ui=fr;{const sn=me+1,Yr=sn*ee;if(he===1||Cr===A){const er=fr*T,Xs=ln(fr,ve,n);if(he===1&&Cr<A){const qo=er-V,Fa=st-q,se=Xs-Y;J[Yr]=qo,J[Yr+1]=Fa,J[Yr+2]=se,Jh(qo,Fa,se,I),Rp(k,sn,Yi,Fe)}$i=er,$r=Xs}else $i=J[Yr]+V,$r=J[Yr+2]+Y}const vi=$i,mr=$r,Wr=mt,xo=ht;mt=Ar,ht=ki;const To=(me-A)*ee,So=he===1?ln(ar,Et,n):J[To+2]+Y,Eo=ln(ar,Ot,n);if(he<A){const sn=me+A,Yr=sn*ee,er=Ar-V,Xs=Jt-q,qo=Eo-Y;J[Yr]=er,J[Yr+1]=Xs,J[Yr+2]=qo,Jh(er,Xs,qo,I);const Fa=Qi;Qi=Yi,Rp(k,sn,Fa,Gi)}{const sn=vi-Wr,Yr=$t-Jt,er=Yr*(mr-xo),Xs=sn*(So-Eo),qo=-Yr*sn,Fa=er*er+Xs*Xs+qo*qo;if(Fa===0)Mx(B,me,0,0,1,L);else{const se=1/Math.sqrt(Fa);Mx(B,me,er*se,Xs*se,qo*se,L)}}++me}}}function D0t(t,e){t.tile.intersectsClippingArea&&(ORe(t),ARe(t,!0),m8(t))}function N0t(t,e){t.tile.intersectsClippingArea&&(CRe(t),m8(t))}function CRe(t,e){t.tile.intersectsClippingArea&&(ORe(t),ARe(t,!1))}function ARe(t,e){const i=t.geometryState,r=i.neighborData,n=t.tile,s=n.surface,o=n.extent,a=i.clippingArea,l=a??kee,c=o[0],h=o[2],d=o[1],f=o[3],m=[f>l[3],h>l[2],d<l[1],c<l[0]],y=t.geometry,_=n.horizontalScale,v=RRe(s.isWebMercatorOnPlateeCarree,n.ellipsoid.radius,_),w=y.boundingBox,x=y.uvRange[0],T=y.uvRange[1],S=y.uvRange[2],C=y.uvRange[3],A=Math.max(c,l[0]),R=Math.min(h,l[2]),D=Math.max(d,l[1]),N=Math.min(f,l[3]),k=t.localOrigin,B=k[0],L=k[1],z=k[2],j=i.samplerData;for(let H=0;H<4;++H){const X=H===1||H===3,P=r.edgeResolutions[H];Se(fx(P));const I=P+1,V=m[H],q=yw(n,r.edgePeerNeighbors[H]);if(!V&&LRe(n,q,H)){$Re(t,H,q);continue}const Y=q!=null&&!V,J=q?.renderData,ee=J?.geometryState;if(Ns&&(Se(!Y||q.level===n.level),Se(!Y||yy(n,q)<=0),n&&!q&&!s.updatingRootTiles)){const dt=sy[H],mt=n.findNeighborTile(dt,ht=>ht.isLoaded||ht.isLeaf||ht.level===n.level);s.updatingRootTiles||(mt?mt.intersectsClippingArea&&(Se(!mt.isLoaded),Se(!mt.isLeaf),Se(mt.level===n.level)):Se(s?.rootTiles==null||!n.shouldHaveNeighbor(dt)))}const me=_e(H===1?h:c,A,R),Me=_e(H===0?f:d,D,N),yt=ee?.samplerData,St=y.outerEdges[H],ct=e&&I>3?I-3:1,vt=_e(H===1?1:0,x,S),je=_e(H===0?1:0,T,C),he=Y?(dt,mt)=>.5*(ln(dt,mt,yt)+ln(dt,mt,j)):(dt,mt)=>ln(dt,mt,j),At=(h-c)/P,ve=X?H===1?At:-At:0,Fe=X?0:H===0?At:-At,st=-ve,_t=-Fe;let Et=0,$t=0,qe=0;{const dt=0/P,mt=X?me:_e(c*(1-dt)+h*dt,A,R),ht=X?_e(d*(1-dt)+f*dt,D,N):Me,Kt=he(mt,ht);Et=mt*_,$t=v(ht),qe=Kt}let Ot=0,Jt=0,Gi=0;{const dt=1/P,mt=X?me:_e(c*(1-dt)+h*dt,A,R),ht=X?_e(d*(1-dt)+f*dt,D,N):Me,Kt=he(mt,ht);Ot=mt*_,Jt=v(ht),Gi=Kt}for(let dt=1;dt<I-1;dt+=ct){const mt=dt/P,ht=Ot,Kt=Jt,Ht=Gi;{const Yi=X?vt:_e(mt,x,S),fr=X?_e(mt,T,C):je,ar=ht-B,vi=Kt-L,mr=Ht-z;Jh(ht,vi,mr,w),St.setVertexFromValuesRawPositionUV(dt,ar,vi,mr,Yi,fr)}{const Yi=(dt+1)/P,fr=X?me:_e(c*(1-Yi)+h*Yi,A,R),ar=X?_e(d*(1-Yi)+f*Yi,D,N):Me,vi=he(fr,ar);Ot=fr*_,Jt=v(ar),Gi=vi}const Er=Ot,Qi=Gi,ui=Et,$i=$t,$r=qe;Et=ht,$t=Kt,qe=Ht;let Cr=0,Ar=0,ki=0;if(X){const Yi=Jt-Kt,fr=Qi-Ht,ar=$i-Kt,vi=$r-Ht,mr=_e(d*(1-mt)+f*mt,D,N),Wr=me+st,xo=Wr*_-ht,To=ln(Wr,mr,j)-Ht,So=H===3?-1:1;if(Cr=So*(-ar+Yi)*To,Ar=So*xo*(-vi+fr),ki=-So*xo*(-ar+Yi),Y){const Eo=me+ve,sn=Eo*_-ht;Cr=(-ar+Yi)*(To-(ln(Eo,mr,yt)-Ht)),Ar=(xo-sn)*(-vi+fr),ki=-(xo-sn)*(-ar+Yi)}}else{const Yi=Er-ht,fr=Qi-Ht,ar=ui-ht,vi=$r-Ht,mr=_e(c*(1-mt)+h*mt,A,R),Wr=Me+_t,xo=ln(mr,Wr,j)-Ht,To=v(Wr)-Kt,So=H===2?-1:1;if(Cr=So*To*(-vi+fr),Ar=So*(-ar+Yi)*xo,ki=-So*To*(-ar+Yi),Y){const Eo=mr,sn=Me+Fe,Yr=v(sn)-Kt;Cr=(-To+Yr)*(-vi+fr),Ar=(-ar+Yi)*(-xo+(ln(Eo,sn,yt)-Ht)),ki=-(-To+Yr)*(-ar+Yi)}}const qr=1/Math.sqrt(Cr*Cr+Ar*Ar+ki*ki);St.setNormalFromValues(dt,Cr*qr,Ar*qr,ki*qr)}}}function ORe(t,e){IRe(t)}function F0t(t,e){return(Math.PI/2-2*Math.atan(Math.exp(-t/e)))*e}function k0t(t,e){return t*e}function RRe(t,e,i){return t?r=>F0t(r,e):r=>k0t(r,i)}function PRe(t,e,i,r,n,s){const o=e-1,a=t.vertexAttributes.count,l=2*(Math.min(e-2,r[1])-Math.max(1,r[0]))*(Math.min(e-2,n[1])-Math.max(1,n[0])),c=sy.map((T,S)=>S===0&&n[1]<e-2||S===1&&r[1]<e-2||S===2&&n[0]>1||S===3&&r[0]>1),h=t.outerEdges.reduce((T,S,C)=>T+(c[C]?0:o-2+S.count-1),0),d=i.reduce((T,S)=>T+o*(2*(S.latitudeResolution-1)+1),0),f=s?2:1,m=3*(l+h+d)*f,y=a>=C0t?new Uint32Array(m):new Uint16Array(m);let _=0;const v=e-2,w=o-2;Se(w>=0);const x=(T,S,C,A,R,D)=>{const N=T*R,k=D[N],B=D[N+1],L=D[N+2],z=S*R,j=D[z],H=D[z+1],X=D[z+2],P=C*R,I=D[P],V=D[P+1],q=D[P+2],Y=A*R,J=D[Y],ee=D[Y+1],me=D[Y+2];return(j-J)*(j-J)+(H-ee)*(H-ee)+(X-me)*(X-me)>(k-I)*(k-I)+(B-V)*(B-V)+(L-q)*(L-q)};if(s){const T=(C,A,R)=>{y[_++]=C,y[_++]=A,y[_++]=A,y[_++]=R,y[_++]=R,y[_++]=C,Ns&&(Se(C<a),Se(A<a),Se(R<a),Se(_<=m))};(()=>{for(let C=Math.max(n[0],1)-1;C<Math.min(n[1],e-2)-1;++C){const A=C*v;for(let R=Math.max(r[0],1)-1;R<Math.min(r[1],e-2)-1;++R){const D=C*v+R,N=D+1,k=N+v,B=k-1,L=A+R,z=L+1,j=z+v,H=j-1,X=t.vertexAttributes.position.typedBuffer,P=t.vertexAttributes.position.typedBufferStride;x(L,z,j,H,P,X)?(T(D,N,k),T(k,B,D)):(T(D,N,B),T(B,k,N))}}})(),Se(_===3*l*f),(()=>{for(let C=0;C<4;++C){const A=_;if(c[C])continue;const R=t.outerEdges[C],D=t.innerEdges[C];let N=0,k=0;const B=R.count,L=D.count;Se(L===o-1);let z=0;const j=C===1||C===2?(H,X,P)=>T(H,X,P):(H,X,P)=>T(H,P,X);for(;N<B-1||k<L-1;){const H=D.getVertexIndex(k),X=R.getVertexIndex(N),P=N<B-1,I=k<L-1;P&&(!I||(P?0+o*(N+.5)/(B-1):0)<=(I?1+w*(k+.5)/(L-1):0))?(++N,Ns&&Se(N<B),j(H,X,R.getVertexIndex(N)),z++):(++k,Ns&&Se(k<L),j(H,X,D.getVertexIndex(k)),z++)}Ns&&(Se(N===B-1),Se(k===L-1),Se(z===B+L-2),Se(z===o-2+R.count-1),Se(_===A+3*z*f))}})(),Se(_===3*(l+h)*f);const S=C=>{const A=t.outerEdges[C.connectedOuterEdgeOffset];let R=A.getVertexIndex(0),D=A.stride;for(let N=0;N<C.latitudeResolution;++N){const k=N===0?C.rowOffset:R+e;for(let B=0;B<o;B++)T(R,R+1,k+B),N<C.latitudeResolution-1&&T(R+1,k+B+1,k+B),R+=D;R=k,D=1}};i.forEach(S)}else{(()=>{const S=Math.max(n[0],1)-1,C=Math.min(n[1],e-2)-1,A=Math.max(r[0],1)-1,R=Math.min(r[1],e-2)-1;for(let D=S;D<C;++D){const N=D*v;for(let k=A;k<R;++k){const B=N+k,L=B+1,z=L+v,j=z-1,H=t.vertexAttributes.position.typedBuffer,X=t.vertexAttributes.position.typedBufferStride;x(B,L,z,j,X,H)?(y[_]=B,y[_+1]=L,y[_+2]=z,y[_+3]=z,y[_+4]=j,y[_+5]=B):(y[_]=B,y[_+1]=L,y[_+2]=j,y[_+3]=j,y[_+4]=L,y[_+5]=z),_+=6}}})(),Se(_===3*l*f),(()=>{for(let S=0;S<4;++S){if(c[S])continue;const C=t.outerEdges[S],A=t.innerEdges[S];let R=0,D=0;const N=C.count,k=A.count;Se(k===o-1);const B=S===1||S===2,L=B?1:2,z=B?2:1,j=C.index0,H=C.stride,X=A.index0,P=A.stride;for(;R<N-1||D<k-1;){const I=X+D*P,V=j+R*H,q=R<N-1,Y=D<k-1,J=q&&(!Y||(q?0+o*(R+.5)/(N-1):0)<=(Y?1+w*(D+.5)/(k-1):0));J?++R:++D;const ee=J?V+H:I+P;y[_]=I,y[_+L]=V,y[_+z]=ee,_+=3}}})(),Se(_===3*(l+h)*f);const T=S=>{const C=t.outerEdges[S.connectedOuterEdgeOffset];let A=C.getVertexIndex(0),R=C.stride;for(let D=0;D<S.latitudeResolution;++D){const N=D===0?S.rowOffset:A+e;for(let k=0;k<o;k++){const B=N+k;y[_]=A,y[_+1]=A+1,y[_+2]=B,D<S.latitudeResolution-1?(y[_+3]=A+1,y[_+4]=B+1,y[_+5]=B,_+=6):_+=3,A+=R}A=N,R=1}};i.forEach(T)}Se(_===m),t.indices=y,t.indexCount=m}function MRe(t,e){const i=t.localOrigin,r=t.geometry,n=t.geometryState.neighborData.edgeResolutions,s=r.numVerticesPerSide-2,o=r.vertexAttributes;let a=e;for(let l=0;l<4;++l){{const c=l===0||l===2,h=(l===0?s-1:0)*s+(l===1?s-1:0),d=(c?0:1)*s+(c?1:0);r.innerEdges[l]=new Wue(o,i,h,d,s)}{const c=a,h=n[l]+1;r.outerEdges[l]=new Wue(o,i,c,1,h),a+=h}}}function $Re(t,e,i){const r=(e+2)%4,n=t.geometryState,s=t.tile,o=n.neighborData,a=s.level-i.level,l=e===1||e===3,c=o.edgeResolutions[e];Se(fx(c));const h=c+1,d=t.geometry,f=d.boundingBox,m=d.outerEdges[e],y=d.uvRange[0],_=d.uvRange[1],v=d.uvRange[2],w=d.uvRange[3],x=_e(e===1?1:0,y,v),T=_e(e===0?1:0,_,w),S=i.renderData,C=S.geometryState,A=S.geometry.outerEdges[r],R=s.getNeighborEdgeStartVertexIndex(e,i)*c,D=c*2**a;Se(C.neighborData.edgeResolutions[r]===D),Se(A.count-1===D);const N=S.localOrigin[0]-t.localOrigin[0],k=S.localOrigin[1]-t.localOrigin[1],B=S.localOrigin[2]-t.localOrigin[2],L=m.attributes,z=m.index0,j=m.stride,H=L.position.typedBuffer,X=L.position.typedBufferStride,P=L.normalCompressed.typedBuffer,I=L.normalCompressed.typedBufferStride,V=L.uv0,q=A.attributes,Y=A.index0,J=A.stride,ee=q.position.typedBuffer,me=q.position.typedBufferStride,Me=q.normalCompressed.typedBuffer,yt=q.normalCompressed.typedBufferStride;for(let St=1;St<h-1;++St){const ct=z+j*St,vt=Y+J*(R+St),je=ct*X,he=vt*me,At=ee[he]+N,ve=ee[he+1]+k,Fe=ee[he+2]+B;H[je]=At,H[je+1]=ve,H[je+2]=Fe,Jh(At,ve,Fe,f);const st=ct*I,_t=vt*yt;P[st]=Me[_t],P[st+1]=Me[_t+1];const Et=St/c,$t=l?x:_e(Et,y,v),qe=l?_e(Et,_,w):T;Rp(V,ct,$t,qe)}}function IRe(t){const e=t.geometryState,i=e.neighborData,r=t.localOrigin,n=i.cornerNeighborData,s=t.geometry,o=s.outerEdges,a=s.boundingBox,l=t.tile,c=t.tile.surface.view?.viewingMode==="local",h=l.ellipsoid.radius,d=l.extentInRadians,f=l.horizontalScale;let m=0,y=0,_=0;const v=(he,At,ve)=>{const Fe=d[At===0?1:3],st=d[he===0?0:2],_t=Math.cos(Fe),Et=Math.sin(Fe),$t=Math.sin(st),qe=Math.cos(st),Ot=h+ve;m=qe*_t*Ot,y=$t*_t*Ot,_=Et*Ot},w=c?(()=>{const he=t.geometryState.clippingArea,At=l.extent,ve=he!=null&&(At[3]>he[3]||At[2]>he[2]||At[1]<he[1]||At[0]<he[0]),Fe=RRe(l.surface.isWebMercatorOnPlateeCarree,l.ellipsoid.radius,f);return(st,_t,Et)=>{const $t=st===0?z[0]:z[2],qe=_t===0?z[1]:z[3],Ot=ve?_e($t,he[0],he[2]):$t,Jt=ve?_e(qe,he[1],he[3]):qe,Gi=Et;m=Ot*f,y=Fe(Jt),_=Gi}})():v;let x=0,T=0,S=0,C=0,A=0,R=0,D=0,N=0,k=0;const B=c&&t.tile.surface.isWebMercatorOnPlateeCarree,L=(he,At,ve,Fe,st)=>{let _t=0,Et=0,$t=0;if(c){const qe=At*f,Ot=B?(Math.PI/2-2*Math.atan(Math.exp(-ve/h)))*h:ve*f;_t=qe-m,Et=Ot-y,$t=Fe-_}else{const qe=Fee(he),Ot=he.tile,Jt=Ot.extent,Gi=Ot.extentInRadians,dt=(At-Jt[0])/(Jt[2]-Jt[0]),mt=(ve-Jt[1])/(Jt[3]-Jt[1]),ht=Gi[0]*(1-dt)+Gi[2]*dt,Kt=qe(mt),Ht=Math.cos(Kt),Er=Math.sin(Kt),Qi=Math.sin(ht),ui=Math.cos(ht),$i=h+Fe;_t=ui*Ht*$i-m,Et=Qi*Ht*$i-y,$t=Er*$i-_}switch(st){case 0:D+=_t,N+=Et,k+=$t;break;case 1:C-=_t,A-=Et,R-=$t;break;case 2:D-=_t,N-=Et,k-=$t;break;case 3:C+=_t,A+=Et,R+=$t}},z=l.extent,j=e.clippingArea??kee,H=z[0],X=z[2],P=z[1],I=z[3],V=[I>j[3],X>j[2],P<j[1],H<j[0]],q=Math.max(H,j[0]),Y=Math.min(X,j[2]),J=Math.max(P,j[1]),ee=Math.min(I,j[3]),me=he=>Math.max(j[0],Math.min(j[2],he)),Me=he=>Math.max(j[1],Math.min(j[3],he)),yt=s.uvRange[0],St=s.uvRange[1],ct=s.uvRange[2],vt=s.uvRange[3],je=he=>{const At=n[he].cornerTiles;x=0,T=0,S=1,C=0,A=0,R=0,D=0,N=0,k=0;let ve=1/0;for(let qe=0;qe<4;++qe)ve=Math.min(ve,At[qe]?.level??1/0);for(let qe=0;qe<4;++qe){const Ot=At[qe];YA[qe]=Ot?.level===ve?Ot:null}let Fe=1,st=0;for(let qe=0;qe<4;++qe){const Ot=YA[qe];Ot&&(Fe=Math.max(Fe,Ot?.renderData.geometryState.numVerticesPerSide),st=Ot.extent[2]-Ot.extent[0])}const _t=st,Et=Fe;Se(Et>1);const $t=_t/Et;for(let qe=0;qe<4;++qe){const Ot=YA[(qe+3)%4],Jt=YA[qe%4];if(!Ot&&!Jt)continue;const Gi=qe===0?1:qe===1?2:qe===2?3:0,dt=qe===0?2:qe===1?3:qe===2?0:1;if(Ot&&Jt){const mt=GB[qe][0]*$t,ht=GB[qe][1]*$t,Kt=Ot.extent,Ht=me(Kt[Gi===0||Gi===1?2:0]+mt),Er=Me(Kt[Gi===0||Gi===3?3:1]+ht),Qi=Jt.extent,ui=me(Qi[dt===0||dt===1?2:0]+mt),$i=Me(Qi[dt===0||dt===3?3:1]+ht),$r=Ot.renderData,Cr=Jt.renderData,Ar=ln(Ht,Er,$r.geometryState.samplerData),ki=ln(ui,$i,Cr.geometryState.samplerData);L($r,Ht,Er,.5*(Ar+ki),qe)}else{const mt=Ot??Jt,ht=Ot?Gi:dt,Kt=mt.extent,Ht=GB[qe],Er=me(Kt[ht===0||ht===1?2:0]+Ht[0]*$t),Qi=Me(Kt[ht===0||ht===3?3:1]+Ht[1]*$t),ui=mt.renderData,$i=ln(Er,Qi,ui.geometryState.samplerData);L(ui,Er,Qi,$i,qe)}}if(!c){const qe=Math.sqrt(m*m+y*y+_*_);x=m/qe,T=y/qe,S=_/qe}if(c||S*S<.999){const qe=Math.sqrt(C*C+A*A+R*R);C/=qe,A/=qe,R/=qe;const Ot=Math.sqrt(D*D+N*N+k*k);D/=Ot,N/=Ot,k/=Ot,x=R*N-A*k,T=C*k-R*D,S=A*D-C*N;const Jt=1/Math.sqrt(x*x+T*T+S*S);x*=Jt,T*=Jt,S*=Jt}};for(let he=0;he<4;++he){const At=he,ve=(he+1)%4,Fe=he===0||he===1?1:0,st=he===0||he===3?1:0,_t=_e(Fe,yt,ct),Et=_e(st,St,vt),$t=o[At],qe=he===0||he===3?$t.count-1:0,Ot=o[ve],Jt=he===0||he===1?Ot.count-1:0,Gi=n[he].cornerTiles;let dt=-1;for(let Kt=0;Kt<4;++Kt){const Ht=Gi[Kt];Ht&&(dt===-1||yy(Gi[dt],Ht)>0)&&(dt=Kt)}const mt=dt,ht=Gi[mt];if(ht!==l){const Kt=l.level-ht.level,Ht=2**Kt,Er=[ht.lij[0]+Kt,ht.lij[1]*Ht,ht.lij[2]*Ht],Qi=[Er[1]+Ht===l.lij[1],he===0&&(mt===1||mt===0&&ht!==Gi[3])||he===1&&(mt===0||mt===1&&ht!==Gi[2]),Er[1]===l.lij[1]+1,he===2&&(mt===3||mt===2&&ht!==Gi[1])||he===3&&(mt===2||mt===3&&ht!==Gi[0])],ui=Qi.reduce((ki,qr)=>ki+(qr?1:0),0);Se(ui===1||ui===2);let $i=-1,$r=-1;const Cr=ht.renderData;if(ui===1){const ki=Qi.findIndex(Yi=>Yi);Se(0<=ki&&ki<=3),$i=(ki+2)%4;const qr=t.geometryState.neighborData.edgeResolutions[ki];$r=l.getNeighborEdgeStartVertexIndex(ki,ht)*qr+qr*(ki===0&&he===0||ki===1&&he===0||ki===2&&he===1||ki===3&&he===3?1:0)}else{Se(Qi[1]||Qi[3]),$i=Qi[1]?3:1;const ki=Cr.geometryState.neighborData.edgeResolutions[$i];$r=he===0||he===3?0:ki}const Ar=Cr.geometry.outerEdges[$i];{const ki=$t.index0+qe*$t.stride,qr=Ot.index0+Jt*Ot.stride,Yi=Ar.index0+$r*Ar.stride;{const fr=Ar.attributes.position,ar=fr.typedBuffer,vi=Yi*fr.typedBufferStride,mr=t.localOrigin,Wr=Ar.localOrigin,xo=ar[vi]+Wr[0]-mr[0],To=ar[vi+1]+Wr[1]-mr[1],So=ar[vi+2]+Wr[2]-mr[2];Jh(xo,To,So,a);{const Eo=$t.attributes.position,sn=Eo.typedBuffer,Yr=ki*Eo.typedBufferStride;sn[Yr]=xo,sn[Yr+1]=To,sn[Yr+2]=So}{const Eo=Ot.attributes.position,sn=Eo.typedBuffer,Yr=qr*Eo.typedBufferStride;sn[Yr]=xo,sn[Yr+1]=To,sn[Yr+2]=So}}Rp($t.attributes.uv0,ki,_t,Et),Rp(Ot.attributes.uv0,qr,_t,Et);{const fr=Ar.attributes.normalCompressed.typedBuffer,ar=Yi*Ar.attributes.normalCompressed.typedBufferStride;{const vi=$t.attributes.normalCompressed,mr=vi.typedBuffer,Wr=ki*vi.typedBufferStride;mr[Wr]=fr[ar],mr[Wr+1]=fr[ar+1]}{const vi=Ot.attributes.normalCompressed,mr=vi.typedBuffer,Wr=qr*vi.typedBufferStride;mr[Wr]=fr[ar],mr[Wr+1]=fr[ar+1]}}}}else{const Kt=V[At],Ht=V[ve];let Er;if(Kt||Ht){const $r=_e(H*(1-Fe)+X*Fe,q,Y),Cr=_e(P*(1-st)+I*st,J,ee),Ar=e.samplerData;Er=ln($r,Cr,Ar)}else Er=U0t(Gi);w(Fe,st,Er),je(he);const Qi=m-r[0],ui=y-r[1],$i=_-r[2];Jh(Qi,ui,$i,a),$t.setVertexFromValuesRawPositionUVNormal(qe,Qi,ui,$i,_t,Et,x,T,S),Ot.setVertexFromValuesRawPositionUVNormal(Jt,Qi,ui,$i,_t,Et,x,T,S)}}for(let he=0;he<4;++he)YA[he]=null}function U0t(t){const e=t.reduce((s,o)=>Math.min(s,o?.level??1/0),1/0);Ns&&(Se(!t[0]||!t[2]||UW(t[0],t[2],at.SOUTH_WEST)),Se(!t[1]||!t[3]||UW(t[1],t[3],at.NORTH_WEST)));let i=0,r=0;for(let s=0;s<4;++s){const o=t[s];if(o&&o.level===e){const a=s===0||s===1,l=s===0||s===3,c=o.extent,h=c[a?0:2],d=c[l?1:3],f=o.renderData?.geometryState?.samplerData;r+=ln(h,d,f),i++}}const n=i?r/i:0;return Se(n!=null),n}function m8(t){const e=t.vao,i=t.geometry.vertexAttributes.position.typedBuffer;e.vertexBuffers.geometry.setSubData(i,0,0,i.length)}const GB=[[0,1],[1,0],[0,-1],[-1,0]],Do=new Myt,kee=CZ(-1/0,-1/0,1/0,1/0),YA=[null,null,null,null];function LRe(t,e,i){if(!e)return!1;const r=yy(t,e);return r>0||r===0&&i>=2}let z0t=class extends Lee{constructor(e,i,r,n,s){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=Zt(),this._baseUsedMemory=900,this.init(e,i,r,n,s)}init(e,i,r,n,s){super.init(e,i,r,n,s);const o=s.view.renderSpatialReference,a=s.spatialReference,l=o!=null&&nZ(o)&&a!=null&&a.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=l;const c=this.surface.isWebMercatorOnPlateeCarree,h=this._extentInRenderSR,d=this.extent;if(c){const f=Oe(d[0],d[1],0);ua(f,ze.WebMercator,f,ze.PlateCarree);const m=Oe(d[2],d[3],0);ua(m,ze.WebMercator,m,ze.PlateCarree),h[0]=f[0],h[1]=f[1],h[2]=m[0],h[3]=m[1]}else for(let f=0;f<4;++f)h[f]=d[f]*l;this.centerAtSeaLevel[0]=.5*(h[0]+h[2]),this.centerAtSeaLevel[1]=.5*(h[1]+h[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(h[2]-h[0],h[3]-h[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,i=.5*(e[2]-e[0]),r=.5*(e[3]-e[1]),n=Math.sqrt(i*i+r*r),s=.5*(this.elevationBounds[0]-this.elevationBounds[1]),o=Math.max(n,s);this._center[ss.MIDDLE][3]=o}_calculateFrustumVisibilityStatus(e){const i=this._aabb(),r=i[0],n=i[1],s=i[2],o=i[3],a=i[4],l=i[5];let c=!0;for(let h=0;h<6;h++){const d=e[h],f=d[0],m=d[1],y=d[2],_=d[3];if(f*(f>0?r:o)+m*(m>0?n:a)+y*(y>0?s:l)+_>=0)return Sa.OUTSIDE;c=c&&f*(f<0?r:o)+m*(m<0?n:a)+y*(y<0?s:l)+_<=0}return c?Sa.INSIDE:Sa.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return HBe(e[0],e[1],this.elevationBounds[0],e[2],e[3],this.elevationBounds[1])}intersectsRay(e,i,r,n){return QL[0]=1/i[0],QL[1]=1/i[1],QL[2]=1/i[2],pQ(this._aabb(),e,QL,r,n)}createGeometry(){I0t(this.renderData,this._horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){D0t(this.renderData,this._horizontalScaleFactor)}updateEdgeElevations(){N0t(this.renderData,this._horizontalScaleFactor)}get horizontalScale(){return this._horizontalScaleFactor}};const QL=E();let B0t=class{constructor(){this.extent=oi(),this.minLevel=0,this.maxLevel=0,this.callback=null}},A4=class extends we{constructor(){super(...arguments),this._queries=new Ut({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Ut({initialSize:30}),this._queryPool=new $a(B0t)}queryVisibleLevelRange(e,i,r,n){const s=this._queryPool.acquire();mp(s.extent,e),s.minLevel=i??-Number.MAX_VALUE,s.maxLevel=r??Number.MAX_VALUE,s.callback=n,this._queryQueue.push(s),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const i=this._queries.data[e];this._queryPool.release(i),i.callback(e>=this._queriesInvPtr),i.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const i=e.level;let r=0;for(;r<this._queriesInvPtr;){const n=this._queries.data[r],s=n.extent;i>=n.minLevel&&i<=n.maxLevel&&s[0]<=e.extent[2]&&s[2]>=e.extent[0]&&s[1]<=e.extent[3]&&s[3]>=e.extent[1]?(this._queries.swapElements(r,this._queriesInvPtr-1),this._queriesInvPtr--):r++}}};u([p()],A4.prototype,"updating",null),A4=u([M("esri.views.3d.terrain.ScaleRangeQueries")],A4);function V0t(t,e,i,r){const n=Math.cos(i);t[0]=Math.cos(e)*n*r,t[1]=Math.sin(e)*n*r,t[2]=Math.sin(i)*r}let G0t=class extends Lee{constructor(e,i,r,n,s){super(),this._convexHull=new Array(24),this._boundingSphere=kn(),this._baseUsedMemory=1816,this.init(e,i,r,n,s)}init(e,i,r,n,s){super.init(e,i,r,n,s);const o=this.ellipsoid.radius,a=this.extentInRadians[0],l=this.extentInRadians[1],c=this.extentInRadians[2],h=this.extentInRadians[3],d=xt(l,h,.5),f=xt(a,c,.5),m=e===0?0:Math.min(Math.abs(l),Math.abs(h));this._edgeLen=(c-a)*Math.cos(m)*o,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=o-Math.sqrt(o*o-this._edgeLen2/4),V0t(this.centerAtSeaLevel,f,d,this.ellipsoid.radius),ye(this.up,this.centerAtSeaLevel),this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)ae(e[ss.MIDDLE],0,0,0),ae(e[ss.TOP],0,0,0),ae(e[ss.BOTTOM],0,0,0),e[ss.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const i=e[ss.MIDDLE],r=this.convexHull;let n=0;for(let s=0;s<8;++s)n=Math.max(n,j0t(i,r,3*s));e[ss.MIDDLE][3]=Math.sqrt(n)}}_calculateFrustumVisibilityStatus(e){if(!Q_(e,this._boundingSphere))return Sa.OUTSIDE;if(this.lij[0]<10)return Sa.INTERSECTS;const i=this.convexHull,r=this.surface.view.state.camera.near;let n=!0;for(let s=0;s<NC;s++){const o=s===br.NEAR,a=e[s],l=a[0],c=a[1],h=a[2],d=a[3]-(o?r:0);let f=!1;for(let m=0;m<8;++m){const y=3*m;if(l*i[y]+c*i[y+1]+h*i[y+2]+d<0){if(f=!0,!n)break}else n=!1}if(!f)return Sa.OUTSIDE}return n?Sa.INSIDE:Sa.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){A0t(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),Ns&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,i=e,r=this.elevationBounds,n=this.ellipsoid.radius,s=r[1];if(this.level===0)ae(i,0,0,0),e[3]=n+s;else{const o=this.extentInRadians,a=.5*(o[0]+o[2]),l=o[1],c=o[3];X1(lhe,a,l,n),X1(che,a,c,n),ue(i,lhe,che);const h=.5*(r[0]+r[1]);re(i,i,(n+h)/Cc(i));const d=this.convexHull;let f=0;const m=(_,v)=>{const w=_[0]-d[3*v],x=_[1]-d[3*v+1],T=_[2]-d[3*v+2];return Math.sqrt(w*w+x*x+T*T)};for(let _=0;_<8;++_){const v=m(i,_);f=Math.max(f,v)}const y=f;e[3]=y+2}}_updateConvexHull(){const e=this.extentInRadians,i=this.ellipsoid.radius;if(this.level===0)return;const r=this.elevationBounds,n=this._getPatchType(),s=this.surface.isWebMercator,o=s&&n===Vh.HAS_NORTH_POLE,a=s&&n===Vh.HAS_SOUTH_POLE,l=a||o,c=Math.PI/2,h=e[0],d=e[2],f=a?-c:e[1],m=o?c:e[3],y=.5*(h+d),_=r[0],v=i+(l?Math.min(0,_-1):_),w=(X,P,I)=>X1(X,P,I,v),x=E(),T=E(),S=E(),C=E();w(x,h,f),w(T,h,m),w(S,d,m),w(C,d,f);const A=(X,P)=>{for(let I=0;I<3;++I)this._convexHull[3*P+I]=X[I]};A(x,0),A(T,1),A(S,2),A(C,3);const R=r[1],D=i+(l?Math.max(0,R+1):R),N=E(),k=E(),B=E();X1(k,y,m,v),X1(B,y,f,v),ue(N,k,B),ye(N,N);const L=E(),z=E(),j=(X,P)=>{go(z,X,P),ye(z,z);const I=-ge(X,L)/ge(z,L);Se(I>=0),re(z,z,I),ue(X,X,z)};if(2**this.lij[0]>2*this.lij[1]){const X=B,P=E();lt(P,ahe,X),ye(P,P),lt(L,X,P),ye(L,L),Se(Gh(ge(L,X)/Cc(X),0)),j(x,T),j(C,S),A(x,0),A(C,3)}else if(2**this.lij[0]!==2*this.lij[1]){const X=k,P=E();lt(P,ahe,X),ye(P,P),lt(L,P,X),ye(L,L),j(T,x),j(S,C),A(T,1),A(S,2)}const H=(X,P)=>{const I=D/ge(P,N);for(let V=0;V<3;++V)this._convexHull[3*X+V]=P[V]*I};H(4,x),H(5,T),H(6,S),H(7,C)}_getPatchType(){const e=this.lij[1],i=e===0,r=e===(1<<this.level)-1;return i?r?Vh.HAS_BOTH_POLES:Vh.HAS_NORTH_POLE:r?Vh.HAS_SOUTH_POLE:Vh.REGULAR}intersectsRay(e,i,r,n){const s=this._boundingSphere,o=s[3]+r,a=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],l=s[0]-e[0],c=s[1]-e[1],h=s[2]-e[2],d=(l*i[0]+c*i[1]+h*i[2])/a,f=i[0]*d-l,m=i[1]*d-c,y=i[2]*d-h;return f*f+m*m+y*y<o*o}getDefaultVerticesPerSide(){return this.level<ohe.length?ohe[this.level]+1:2}updateCornerElevations(){P0t(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){R0t(this.renderData),this._updateBoundingVolumes()}_checkBVs(){if(!Ns||this.level<=2)return;const e=this._boundingSphere,i=e[3],r=e,n=E(),s=this.ellipsoid.radius,o=this.elevationBounds;o[1],o[0];const a=s+o[0],l=1,c=0,h=this._center[ss.MIDDLE][3],d=this.convexHull,f=(ve,Fe)=>{for(let st=0;st<3;++st)ve[st]=d[3*Fe+st]};{const ve=E(),Fe=E(),st=E(),_t=E(),Et=E(),$t=(qe,Ot,Jt,Gi)=>{f(Fe,qe),f(st,Ot),f(_t,Jt),go(Fe,Fe,st),go(_t,_t,st),lt(ve,Fe,_t),ye(ve,ve);const dt=ge(ve,st);f(Et,Gi);const mt=ge(ve,Et),ht=Math.abs(mt-dt);Se(Gh(ht,0),`Non coplanar ${qe},${Ot},${Jt},${Gi} diff = ${ht}`)};$t(0,1,2,3),$t(4,5,6,7),$t(0,1,4,5),$t(1,2,5,6),$t(2,3,6,7),$t(3,0,7,4)}const m=_o(24),y=(ve,Fe,st)=>{const _t=4*ve;for(let Et=0;Et<3;++Et)m[_t+Et]=Fe[Et];m[_t+3]=st},_=E(),v=E(),w=E(),x=E(),T=(ve,Fe,st,_t)=>{f(_,Fe),f(v,st),f(w,_t),go(_,_,v),ye(_,_),go(w,w,v),ye(w,w),lt(x,_,w),ye(x,x);const Et=ge(x,v);y(ve,x,Et)};T(0,0,1,2),T(1,1,0,4),T(2,1,5,2),T(3,3,2,6),T(4,4,0,3),T(5,4,6,5);const S=1,C=(ve,Fe,st,_t)=>{const Et=4*ve;return m[Et]*Fe+m[Et+1]*st+m[Et+2]*_t-m[Et+3]},A=(ve,Fe,st,_t)=>C(ve,Fe,st,_t)>=-S,R=(ve,Fe)=>A(ve,Fe[0],Fe[1],Fe[2]),D=2**this.lij[0]>2*this.lij[1],N=(ve,Fe,st)=>Math.sqrt(DRe(ve,Fe,st,r[0],r[1],r[2]))<i,k=ve=>N(ve[0],ve[1],ve[2]),B=(ve,Fe)=>N(ve[Fe],ve[Fe+1],ve[Fe+2]),L=this.extentInRadians,z=.5*(L[0]+L[2]),j=L[1],H=L[3],X=E(),P=E();X1(X,z,H,a),X1(P,z,j,a);const I=D?"Upper":"Lower";let V=!0;for(let ve=0;ve<6;++ve){for(let Fe=0;Fe<8;++Fe){const st=3*Fe,_t=A(ve,d[st],d[st+1],d[st+2]);V&&(V=_t),Se(_t,`Tile[${this.lij}] Convex hull point ${Fe} outside of plane ${ve}`)}Se(R(ve,P),`Tile[${this.lij}] (${I}) bottom mid outside of plane ${ve}`),Se(R(ve,X),`Tile[${this.lij}] (${I}) top mid outside of plane ${ve}`)}Se(V,"Not all convex hull points are inside  convex hull polyhedron"),Se(k(P),`Tile[${this.lij}] (${I}) bottom mid outside of bounding sphere`),Se(k(X),`Tile[${this.lij}] (${I}) top mid outside of bounding sphere`);for(let ve=0;ve<8;++ve){const Fe=B(d,3*ve);Se(Fe,`Tile[${this.lij}] Convex hull point ${ve} outside of bounding sphere`)}for(let ve=0;ve<6;++ve)for(let Fe=0;Fe<8;++Fe){const st=3*Fe;A(ve,d[st],d[st+1],d[st+2])||console.error(`Tile[${this.lij}] Convex hull point ${Fe} outside of plane ${ve}`)}const q=this.extentInRadians,Y=Math.max(q[2]-q[0],q[3]-q[1]),J=Math.round(Y*s),ee=this.renderData;if(!ee)return;const{geometry:me,localOrigin:Me}=ee,yt=me.vertexAttributes?.position;if(!yt)return;const St=yt.count,ct=E(),vt=me.numVerticesPerSide-2,je=vt*vt,he=ee.geometryState.neighborData,At=he.edgeResolutions.reduce((ve,Fe)=>ve+Fe+1,0);for(let ve=0;ve<St;++ve){const Fe=ve<je,st=!Fe&&ve<je+At;let _t=!1,Et=-1;if(st){let ui=je;for(let $i=0;$i<4;++$i){const $r=he.edgeResolutions[$i];if(ve===ui||ve===ui+$r-1){_t=!0;break}if(ui+=$r,ve<ui){Et=$i;break}}}const $t=st?he.edgePeerNeighbors[Et]:null,qe=st&&$t&&yy(this,$t)>0;yt.getVec(ve,n),ue(ct,n,Me);const Ot=Cc(ct)-s;let Jt=0,Gi=!1;const dt=o[0]-Ot,mt=Ot-o[1],ht=dt>l,Kt=mt>l,Ht=ht||Kt,Er=()=>{const ui=Fe?"internal":st&&!_t?"edge":_t?"corner":"pole";return`Tile[${this.lij}].vertex[${ve}]:${ui}`+(ht?"(below)":Kt?"(above)":"")+(qe?"(Neighbor)":"")},Qi=fM(ct,r);if(Qi>=i+c){const ui=Qi-i;Ht||(console.error(`${Er()} is out of the bounding sphere by ${ui.toFixed(0)} / ${i.toFixed(0)}[tol=${c}] h=${Ot.toFixed(0)} / [${o[0].toFixed(0)}..${o[1].toFixed(0)}] (${(ui/i).toFixed(0)})`),Gi=!0)}for(let ui=0;ui<6;++ui)if(!A(ui,ct[0],ct[1],ct[2])){const $i=C(ui,ct[0],ct[1],ct[2]),$r=ve%vt,Cr=(ve-$r)/vt;ui===0&&dt||ui===5&&mt||(console.error(`${Er()} (${$r},${Cr})|${vt}] is out of the bounding trapezoid plane ${ui} h=${Math.round(Ot)} / [${Math.round(o[0])}..${Math.round(o[1])}] dist=${Math.round($i)} radii = ${Math.round(i)}/${Math.round(h)}} : maxL = ${J}`),++Jt)}if(Gi||Jt>0)break}}get convexHull(){return this._convexHull}};const ohe=[128,64,64,32,16,8,8,4];function j0t(t,e,i){return DRe(t[0],t[1],t[2],e[i],e[i+1],e[i+2])}function DRe(t,e,i,r,n,s){const o=r-t,a=n-e,l=s-i;return o*o+a*a+l*l}const X1=(t,e,i,r)=>{const n=Math.cos(e),s=Math.sin(e),o=Math.cos(i),a=Math.sin(i);t[0]=r*o*n,t[1]=r*o*s,t[2]=r*a},ahe=[0,0,1],lhe=E(),che=E();let Wd=class extends we{constructor(){super(...arguments),this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}};u([p()],Wd.prototype,"fovX",void 0),u([p()],Wd.prototype,"fovY",void 0),u([p()],Wd.prototype,"relativeWidthLimit",void 0),u([p()],Wd.prototype,"relativeHeightLimit",void 0),u([p()],Wd.prototype,"maxLod",void 0),u([p()],Wd.prototype,"angledSplitBias",void 0),u([p()],Wd.prototype,"aboveGround",void 0),u([p()],Wd.prototype,"frustum",void 0),Wd=u([M("esri.views.3d.terrain.SplitLimits")],Wd);const H0t=Hr().vec3f(O.POSITION).vec2i16(O.UV0).vec2i16(O.NORMALCOMPRESSED,{glNormalized:!0});let q0t=class{constructor(e){this._storage=new DM((i,r)=>e.newCache(i,r),"TileGeometry")}acquire(e){const r=Math.ceil(e/4)*4,n=this._storage.pop(uhe(r));if(n)return n;const s=H0t.createBuffer(r);return s.release=()=>this._release(s),s}_release(e){const i=e.count;this._storage.put(uhe(i),e)}clear(){this._storage.clear()}destroy(){this._storage.destroy()}};function uhe(t){return t.toString()}let NRe=class extends tc{constructor(){super(...arguments),this.blendMode=Ie.Normal}};u([U({count:Ie.COUNT})],NRe.prototype,"blendMode",void 0);let LR=class extends NRe{constructor(){super(...arguments),this.output=ds.Composite,this.baseOpacityMode=Uu.NotRequired,this.premultipliedSource=cp.Off}};u([U({count:ds.COUNT})],LR.prototype,"output",void 0),u([U({count:Uu.COUNT})],LR.prototype,"baseOpacityMode",void 0),u([U()],LR.prototype,"premultipliedSource",void 0);var Lx;function W0t(t){const e=new Ei;if(e.include(gRe),t.background===Lx.Only){const i=t.output===ds.ColorComposite;return i?e.fragment.uniforms.add(new kt("backgroundColor",r=>r.backgroundColor)):e.fragment.include(Iee),e.fragment.code.add(b`
    void main() {
      fragColor = vec4(${i?b`backgroundColor`:b`gridColor(uv)`}, 1.0);
    }
  `),e}return e.include(yRe,t),e.fragment.uniforms.add(new et("tex",i=>i.texture)),e.fragment.uniforms.add(new Re("opacity",i=>i.opacity)),e.fragment.code.add(b`void main() {
vec4 bgColor = getBackground(uv);
fragColor = blendLayers(bgColor, texture(tex, uv), opacity);
}`),e}(function(t){t[t.BelowLayer=0]="BelowLayer",t[t.Only=1]="Only",t[t.COUNT=2]="COUNT"})(Lx||(Lx={}));const Y0t=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return Lx},build:W0t},Symbol.toStringTag,{value:"Module"}));let X0t=class extends mRe{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=vo}},FRe=class kRe extends Fi{initializeProgram(e){return new Mi(e.rctx,kRe.shader.get().build(this.configuration),Si)}initializePipeline(){return Lt({blending:Yc(Te.ONE,Te.ONE_MINUS_SRC_ALPHA),colorWrite:Gt})}};FRe.shader=new Pi(Y0t,()=>ce(()=>import("./BlendLayers.glsl-a203b127.js"),[],import.meta.url));let URe=class extends LR{constructor(){super(...arguments),this.background=Lx.BelowLayer}};u([U()],URe.prototype,"background",void 0);let jB=class{constructor(e,i,r,n,s,o){this.texture=e,this.type=i,e.retain(),this.offsetAndScale=Ft(r.offset[0],r.offset[1],r.scale,r.scale),this.opacities=Oe(n,s,o)}destroy(){this.texture.release()}};function z0(t,e){return[t,e]}function Z1(t,e,i){return t[0]=e,t[1]=i,t}function Z0t(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t}const Rd=new $x("0/0/0/0");let J0t=class zRe{static create(e,i,r=null){const n=Sp(e.spatialReference),s=i.origin||z0(e.origin.x,e.origin.y),o=z0(e.size[0]*i.resolution,e.size[1]*i.resolution),a=z0(-1/0,-1/0),l=z0(1/0,1/0),c=z0(1/0,1/0);r!=null&&(Z1(a,Math.max(0,Math.floor((r.xmin-s[0])/o[0])),Math.max(0,Math.floor((s[1]-r.ymax)/o[1]))),Z1(l,Math.max(0,Math.floor((r.xmax-s[0])/o[0])),Math.max(0,Math.floor((s[1]-r.ymin)/o[1]))),Z1(c,l[0]-a[0]+1,l[1]-a[1]+1));const{cols:h,rows:d}=i;let f,m,y,_;return!r&&h&&d&&(Z1(a,h[0],d[0]),Z1(l,h[1],d[1]),Z1(c,h[1]-h[0]+1,d[1]-d[0]+1)),e.isWrappable?(f=z0(Math.ceil(Math.round((n.valid[1]-n.valid[0])/i.resolution)/e.size[0]),c[1]),m=z0(Math.floor((n.origin[0]-s[0])/o[0]),a[1]),y=z0(f[0]+m[0]-1,l[1]),_=!0):(m=a,y=l,f=c,_=!1),new zRe(i.level,i.resolution,i.scale,s,a,l,c,o,m,y,f,_)}constructor(e,i,r,n,s,o,a,l,c,h,d,f){this.level=e,this.resolution=i,this.scale=r,this.origin=n,this.first=s,this.last=o,this.size=a,this.norm=l,this.worldStart=c,this.worldEnd=h,this.worldSize=d,this.wrap=f}normalizeCol(e){if(!this.wrap)return e;const i=this.worldSize[0];return e<0?i-1-Math.abs((e+1)%i):e%i}denormalizeCol(e,i){return this.wrap?this.worldSize[0]*i+e:e}getWorldForColumn(e){return this.wrap?Math.floor(e/this.worldSize[0]):0}getFirstColumnForWorld(e){return e*this.worldSize[0]+this.first[0]}getLastColumnForWorld(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(e){return(e-this.origin[0])/this.norm[0]}getXForColumn(e){return this.origin[0]+e*this.norm[0]}getRowForY(e){return(this.origin[1]-e)/this.norm[1]}getYForRow(e){return this.origin[1]-e*this.norm[1]}getTileBounds(e,i,r=!1){Rd.set(i);const n=r?Rd.col:this.denormalizeCol(Rd.col,Rd.world),s=Rd.row;return Z0t(e,this.getXForColumn(n),this.getYForRow(s+1),this.getXForColumn(n+1),this.getYForRow(s)),e}getTileCoords(e,i,r=!1){Rd.set(i);const n=r?Rd.col:this.denormalizeCol(Rd.col,Rd.world);return Array.isArray(e)?Z1(e,this.getXForColumn(n),this.getYForRow(Rd.row)):(e.x=this.getXForColumn(n),e.y=this.getYForRow(Rd.row)),e}},zW=class{constructor(){this.spans=[]}acquire(e){this.lodInfo=e}release(){this.lodInfo=null,this.spans.length=0}forEach(e,i){const{spans:r,lodInfo:n}=this,{level:s}=n;if(r.length!==0)for(const{row:o,colFrom:a,colTo:l}of r)for(let c=a;c<=l;c++)e.call(i,s,o,n.normalizeCol(c),n.getWorldForColumn(c))}};zW.pool=new $a(zW);let HB=class{constructor(e,i,r){this.row=e,this.colFrom=i,this.colTo=r}};const Un=new $x("0/0/0/0");let K0t=class BRe{static create(e,i){e[1]>i[1]&&([e,i]=[i,e]);const[r,n]=e,[s,o]=i,a=s-r,l=o-n,c=l!==0?a/l:0,h=(Math.ceil(n)-n)*c,d=(Math.floor(n)-n)*c;return new BRe(r,Math.floor(n),Math.ceil(o),c,a<0?h:d,a<0?d:h,a<0?s:r,a<0?r:s)}constructor(e,i,r,n,s,o,a,l){this.x=e,this.ymin=i,this.ymax=r,this.invM=n,this.leftAdjust=s,this.rightAdjust=o,this.leftBound=a,this.rightBound=l}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}};const ou=[[0,0],[0,0],[0,0],[0,0]],Q0t=1e-6;let MBt=class{constructor(e,i=null,r=e.lods[0].level,n=e.lods[e.lods.length-1].level){this.tileInfo=e,this.fullExtent=i,this.scales=[],this._infoByScale={},this._infoByLevel={};const s=e.lods.filter(a=>a.level>=r&&a.level<=n);this.minScale=s[0].scale,this.maxScale=s[s.length-1].scale;const o=this._lodInfos=s.map(a=>J0t.create(e,a,i));s.forEach((a,l)=>{this._infoByLevel[a.level]=o[l],this._infoByScale[a.scale]=o[l],this.scales[l]=a.scale},this),this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel[typeof e=="number"?e:e.level]}getTileBounds(e,i,r=!1){Un.set(i);const n=this._infoByLevel[Un.level];return n?n.getTileBounds(e,Un,r):e}getTileCoords(e,i,r=!1){Un.set(i);const n=this._infoByLevel[Un.level];return n?n.getTileCoords(e,Un,r):e}getTileCoverage(e,i=192,r=!0,n="closest"){if(!r&&(e.scale>this.minScale||e.scale<this.maxScale))return null;const s=n==="closest"?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),o=zW.pool.acquire(s),a=this._wrap;let l,c,h,d=1/0,f=-1/0;const m=o.spans;ou[0][0]=ou[0][1]=ou[1][1]=ou[3][0]=-i,ou[1][0]=ou[2][0]=e.size[0]+i,ou[2][1]=ou[3][1]=e.size[1]+i;for(const w of ou)e.toMap(w,w),w[0]=s.getColumnForX(w[0]),w[1]=s.getRowForY(w[1]);const y=[];let _=3;for(let w=0;w<4;w++){if(ou[w][1]===ou[_][1]){_=w;continue}const x=K0t.create(ou[w],ou[_]);d=Math.min(x.ymin,d),f=Math.max(x.ymax,f),y[x.ymin]===void 0&&(y[x.ymin]=[]),y[x.ymin].push(x),_=w}if(d==null||f==null||f-d>100)return null;let v=[];for(l=d;l<f;){y[l]!=null&&(v=v.concat(y[l])),c=1/0,h=-1/0;for(let w=v.length-1;w>=0;w--){const x=v[w];c=Math.min(c,x.getLeftCol()),h=Math.max(h,x.getRightCol())}if(c=Math.floor(c),h=Math.floor(h),l>=s.first[1]&&l<=s.last[1])if(a)if(s.size[0]<s.worldSize[0]){const w=Math.floor(h/s.worldSize[0]);for(let x=Math.floor(c/s.worldSize[0]);x<=w;x++)m.push(new HB(l,Math.max(s.getFirstColumnForWorld(x),c),Math.min(s.getLastColumnForWorld(x),h)))}else m.push(new HB(l,c,h));else c>s.last[0]||h<s.first[0]||(c=Math.max(c,s.first[0]),h=Math.min(h,s.last[0]),m.push(new HB(l,c,h)));l+=1;for(let w=v.length-1;w>=0;w--){const x=v[w];x.ymax>=l?x.incrRow():v.splice(w,1)}}return o}getTileParentId(e){Un.set(e);const i=this._infoByLevel[Un.level],r=this._lodInfos.indexOf(i)-1;return r<0?null:(this._getTileIdAtLOD(Un,this._lodInfos[r],Un),Un.id)}getTileResolution(e){const i=this._infoByLevel[typeof e=="object"?e.level:e];return i?i.resolution:-1}getTileScale(e){const i=this._infoByLevel[e.level];return i?i.scale:-1}intersects(e,i){Un.set(i);const r=this._infoByLevel[Un.level],n=e.lodInfo;if(n.resolution>r.resolution){this._getTileIdAtLOD(Un,n,Un);const o=n.denormalizeCol(Un.col,Un.world);for(const a of e.spans)if(a.row===Un.row&&a.colFrom<=o&&a.colTo>=o)return!0}if(n.resolution<r.resolution){const[o,a,l,c]=e.spans.reduce((_,v)=>(_[0]=Math.min(_[0],v.row),_[1]=Math.max(_[1],v.row),_[2]=Math.min(_[2],v.colFrom),_[3]=Math.max(_[3],v.colTo),_),[1/0,-1/0,1/0,-1/0]),h=r.denormalizeCol(Un.col,Un.world),d=n.getColumnForX(r.getXForColumn(h)),f=n.getRowForY(r.getYForRow(Un.row)),m=n.getColumnForX(r.getXForColumn(h+1))-1,y=n.getRowForY(r.getYForRow(Un.row+1))-1;return!(d>c||m<l||f>a||y<o)}const s=n.denormalizeCol(Un.col,Un.world);return e.spans.some(o=>o.row===Un.row&&o.colFrom<=s&&o.colTo>=s)}normalizeBounds(e,i,r){if(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],this._wrap){const n=Sp(this.tileInfo.spatialReference),s=-r*(n.valid[1]-n.valid[0]);e[0]+=s,e[2]+=s}return e}getSmallestInfoForScale(e){const i=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>i[0])return this._infoByScale[i[0]];for(let r=1;r<i.length-1;r++)if(e>i[r]+Q0t)return this._infoByScale[i[r-1]];return this._infoByScale[i[i.length-1]]}getClosestInfoForScale(e){const i=this.scales;return this._infoByScale[e]||(e=i.reduce((r,n)=>Math.abs(n-e)<Math.abs(r-e)?n:r,i[0])),this._infoByScale[e]}scaleToLevel(e){const i=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(let r=i.length-1;r>=0;r--)if(e<i[r])return r===i.length-1?this._infoByScale[i[i.length-1]].level:this._infoByScale[i[r]].level+(i[r]-e)/(i[r]-i[r+1]);return this._infoByScale[i[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}_getTileIdAtLOD(e,i,r){const n=this._infoByLevel[r.level];return e.set(r),i.resolution<n.resolution?null:(i.resolution===n.resolution||(e.level=i.level,e.col=Math.floor(r.col*n.resolution/i.resolution+.01),e.row=Math.floor(r.row*n.resolution/i.resolution+.01)),e)}},qB=class{constructor(){this._map=new Map,this._observable=new hM}get size(){return Mt(this._observable),this._map.size}clear(){this._map.size>0&&(this._map.clear(),this._observable.notify())}delete(e){const i=this._map.delete(e);return i&&this._observable.notify(),i}entries(){return Mt(this._observable),this._map.entries()}forEach(e,i){Mt(this._observable),this._map.forEach((r,n)=>e.call(i,r,n,this),i)}get(e){return Mt(this._observable),this._map.get(e)}has(e){return Mt(this._observable),this._map.has(e)}keys(){return Mt(this._observable),this._map.keys()}set(e,i){return this._map.set(e,i),this._observable.notify(),this}values(){return Mt(this._observable),this._map.values()}[Symbol.iterator](){return Mt(this._observable),this._map[Symbol.iterator]()}get[Symbol.toStringTag](){return this._map[Symbol.toStringTag]}},e_t=class{constructor(e,i){this.item=e,this.controller=i,this.promise=null}},t_t=class{constructor(e){this._schedule=null,this._task=null,this._deferreds=new qB,this._controllers=new qB,this._processingItems=new qB,this._pausedSignal=UE(!1),this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new rF(e.peeker),this.process=e.process;const i=e.scheduler;e.priority&&i&&(this._task=i.registerTask(e.priority,this))}destroy(){this.clear(),this._schedule=Tr(this._schedule),this._task=Tr(this._task)}get updating(){return!!this._task?.updating||this.running}get length(){return this._processingItems.size+this._queue.length}abort(e){const i=this._controllers.get(e);i&&i.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach(i=>e.push(i)),this._controllers.clear(),e.forEach(i=>i.abort()),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach((i,r)=>e(r))}get(e){const i=this._deferreds.get(e);return i?i.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,i){const r=this.get(e);if(r)return r;const n=new AbortController;let s=null;i&&(s=Ms(i,()=>n.abort()));const o=()=>{const h=this._processingItems.get(e);h&&h.controller.abort(),a(),c.reject(Ti())},a=()=>{l.remove(),s?.remove(),this._deferreds.delete(e),this._controllers.delete(e),this._queue.remove(e),this._processingItems.delete(e),this._scheduleNext()},l=sM(n.signal,o),c=Hs();return this._deferreds.set(e,c),this._controllers.set(e,n),c.promise.then(a,a),this._queue.push(e),this._scheduleNext(),c.promise}last(){return this._queue.last()}peek(){return this._queue.peek()}popLast(){return this._queue.popLast()}reset(){const e=[];this._processingItems.forEach(i=>e.push(i)),this._processingItems.clear();for(const i of e)this._queue.push(i.item),i.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}get running(){return!this._pausedSignal.value&&this._queue.length>0&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_scheduleNext(){this._task||this._pausedSignal.value||this._schedule||(this._schedule=Ux(()=>{this._schedule=null,this._next()}))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,i){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(i))}_processError(e,i){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(i))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(e==null)return;let i;const r=new AbortController,n=new e_t(e,r);this._processingItems.set(e,n);try{i=this.process(e,r.signal)}catch(s){this._processError(n,s)}Zc(i)?(n.promise=i,i.then(s=>this._processResult(n,s),s=>this._processError(n,s))):this._processResult(n,i)}get test(){return{update:e=>this.runTask(e)}}};function i_t(t,e){return t.length=0,e.forEach(i=>t.push(i)),t}const WB=new Set,eD=[],oS=new Map,hhe=[0,0];let J1=class extends we{constructor(e){super(e),this._keyToItem=new Map,this.concurrency=6,this.strategy="scale-first",this.tileInfoView=null}initialize(){const{concurrency:e,process:i,strategy:r}=this;this._queue=new t_t({concurrency:e,process:(n,s)=>{const o=this._keyToItem.get(n);return i(o,{signal:s})},peeker:r==="scale-first"?n=>this._peekByScaleFirst(n):n=>this._peekByCenterFirst(n)})}destroy(){this.clear(),this._queue=$e(this._queue)}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}abort(e){const i=typeof e=="string"?e:e.id;this._queue.abort(i)}clear(){this._queue.clear(),this._keyToItem.clear()}has(e){return typeof e=="string"?this._keyToItem.has(e):this._keyToItem.has(e.id)}isOngoing(e){const i=typeof e=="string"?e:e.id;return this.has(i)&&this._queue.isOngoing(i)}pause(){this._queue.pause()}push(e){const i=e.key.id;if(this._queue.has(i))return this._queue.get(i);const r=this._queue.push(i),n=()=>{this._keyToItem.delete(i)};return this._keyToItem.set(i,e),r.then(n,n),r}reset(){this._queue.reset()}resume(){this._queue.resume()}_peekByScaleFirst(e){if(!this.state)return e.values().next().value;const i=this.tileInfoView;let r=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY;e.forEach(h=>{const d=this._keyToItem.get(h),f=this.tileInfoView.getTileScale(d.key);oS.has(f)||(oS.set(f,[]),r=Math.max(f,r),n=Math.min(f,n)),oS.get(f).push(d.key),WB.add(f)});let s=this.state.scale;oS.has(s)||(i_t(eD,WB),eD.sort((h,d)=>h-d),s=eD.reduce((h,d)=>Math.abs(d-s)<Math.abs(h-s)?d:h,eD[0])),s=Math.min(s,r),s=Math.max(s,n);const o=oS.get(s),a=i.getClosestInfoForScale(s),l=a.getColumnForX(this.state.center[0]),c=a.getRowForY(this.state.center[1]);return o.sort((h,d)=>{const f=a.denormalizeCol(h.col,h.world),m=a.denormalizeCol(d.col,d.world);return Math.sqrt((l-f)*(l-f)+(c-h.row)*(c-h.row))-Math.sqrt((l-m)*(l-m)+(c-d.row)*(c-d.row))}),WB.clear(),oS.clear(),o[0].id}_peekByCenterFirst(e){if(!this.state)return e.values().next().value;const i=this.tileInfoView,r=this.state.center;let n,s=Number.POSITIVE_INFINITY;return e.forEach(o=>{const a=this._keyToItem.get(o);i.getTileCoords(hhe,a.key);const l=Iv(hhe,r);l<s&&(s=l,n=a.key)}),n.id}};u([p({constructOnly:!0})],J1.prototype,"concurrency",void 0),u([p({constructOnly:!0})],J1.prototype,"process",void 0),u([p()],J1.prototype,"state",void 0),u([p({constructOnly:!0})],J1.prototype,"strategy",void 0),u([p({constructOnly:!0})],J1.prototype,"tileInfoView",void 0),J1=u([M("esri.views.2d.tiling.TileQueue")],J1);new $x(0,0,0,0);function r_t(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function n_t(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function s_t(t,e,i,r,n,s,o){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=s,t[5]=o,t}function VRe(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5];let l=i*s-r*n;return l?(l=1/l,t[0]=s*l,t[1]=-r*l,t[2]=-n*l,t[3]=i*l,t[4]=(n*a-s*o)*l,t[5]=(r*o-i*a)*l,t):null}function o_t(t){return t[0]*t[3]-t[1]*t[2]}function GRe(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=i[0],h=i[1],d=i[2],f=i[3],m=i[4],y=i[5];return t[0]=r*c+s*h,t[1]=n*c+o*h,t[2]=r*d+s*f,t[3]=n*d+o*f,t[4]=r*m+s*y+a,t[5]=n*m+o*y+l,t}function Uee(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=Math.sin(i),h=Math.cos(i);return t[0]=r*h+s*c,t[1]=n*h+o*c,t[2]=r*-c+s*h,t[3]=n*-c+o*h,t[4]=a,t[5]=l,t}function jRe(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=i[0],h=i[1];return t[0]=r*c,t[1]=n*c,t[2]=s*h,t[3]=o*h,t[4]=a,t[5]=l,t}function zee(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=i[0],h=i[1];return t[0]=r,t[1]=n,t[2]=s,t[3]=o,t[4]=r*c+s*h+a,t[5]=n*c+o*h+l,t}function a_t(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t[4]=0,t[5]=0,t}function l_t(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function Bee(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function c_t(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function u_t(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)}function h_t(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t}function HRe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}function d_t(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t}function p_t(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t}function f_t(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function m_t(t,e){const i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=e[0],c=e[1],h=e[2],d=e[3],f=e[4],m=e[5],y=jo();return Math.abs(i-l)<=y*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-c)<=y*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-h)<=y*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(s-d)<=y*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(o-f)<=y*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-m)<=y*Math.max(1,Math.abs(a),Math.abs(m))}const g_t=GRe,y_t=HRe;Object.freeze(Object.defineProperty({__proto__:null,add:h_t,copy:r_t,determinant:o_t,equals:m_t,exactEquals:f_t,frob:u_t,fromRotation:a_t,fromScaling:l_t,fromTranslation:Bee,identity:n_t,invert:VRe,mul:g_t,multiply:GRe,multiplyScalar:d_t,multiplyScalarAndAdd:p_t,rotate:Uee,scale:jRe,set:s_t,str:c_t,sub:y_t,subtract:HRe,translate:zee},Symbol.toStringTag,{value:"Module"}));function qRe(){const t=new Float32Array(6);return t[0]=1,t[3]=1,t}function __t(t){const e=new Float32Array(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function v_t(t,e,i,r,n,s){const o=new Float32Array(6);return o[0]=t,o[1]=e,o[2]=i,o[3]=r,o[4]=n,o[5]=s,o}function b_t(t,e){return new Float32Array(t,e,6)}function WRe(t,e,i,r){const n=e[r],s=e[r+1];t[r]=i[0]*n+i[2]*s+i[4],t[r+1]=i[1]*n+i[3]*s+i[5]}function w_t(t,e,i,r=0,n=0,s=2){const o=n||e.length/s;for(let a=r;a<o;a++)WRe(t,e,i,a*s)}Object.freeze(Object.defineProperty({__proto__:null,clone:__t,create:qRe,createView:b_t,fromValues:v_t,transform:WRe,transformMany:w_t},Symbol.toStringTag,{value:"Module"}));function O4(){return[1,0,0,1,0,0]}function x_t(t){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function T_t(t,e,i,r,n,s){return[t,e,i,r,n,s]}function S_t(t,e){return new Float64Array(t,e,6)}Object.freeze(Object.defineProperty({__proto__:null,clone:x_t,create:O4,createView:S_t,fromValues:T_t},Symbol.toStringTag,{value:"Module"}));function E_t(t){return t instanceof Float32Array&&t.length>=2}function C_t(t){return Array.isArray(t)&&t.length>=2}function tD(t){return E_t(t)||C_t(t)}const iD={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new gp({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:ze.WebMercator}),minus180Line:new gp({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:ze.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new gp({paths:[[[180,-180],[180,180]]],spatialReference:ze.WGS84}),minus180Line:new gp({paths:[[[-180,-180],[-180,180]]],spatialReference:ze.WGS84})}};function Dw(t,e){return Math.ceil((t-e)/(2*e))}function YRe(t,e){const i=DR(t);for(const r of i)for(const n of r)n[0]+=e;return t}function DR(t){return L6(t)?t.rings:t.paths}async function A_t(t,e,i,r){const n=YOe(t),s=e[0].spatialReference,o={...r,responseType:"json",query:{...n.query,f:"json",sr:R5(s),target:JSON.stringify({geometryType:yM(e[0]),geometries:e}),cutter:JSON.stringify(i)}},a=await _i(n.path+"/cut",o),{cutIndexes:l,geometries:c=[]}=a.data;return{cutIndexes:l,geometries:c.map(h=>{const d=bv(h);return d.spatialReference=s,d})}}async function O_t(t,e,i){const r=typeof t=="string"?Nn(t):t,n=e[0].spatialReference,s=yM(e[0]),o={...i,query:{...r.query,f:"json",sr:R5(n),geometries:JSON.stringify(Umt(e))}},{data:a}=await _i(r.path+"/simplify",o);return XOe(a.geometries,s,n)}const XRe=K.getLogger("esri.geometry.support.normalizeUtils");function R_t(t){return t.type==="polygon"}function P_t(t){return t[0].type==="polygon"}function M_t(t){return t[0].type==="polyline"}function $_t(t,e){if(!(t instanceof gp||t instanceof Cm)){const n="straightLineDensify: the input geometry is neither polyline nor polygon";throw XRe.error(n),new G(n)}const i=DR(t),r=[];for(const n of i){const s=[];r.push(s),s.push([n[0][0],n[0][1]]);for(let o=0;o<n.length-1;o++){const a=n[o][0],l=n[o][1],c=n[o+1][0],h=n[o+1][1],d=Math.sqrt((c-a)*(c-a)+(h-l)*(h-l)),f=(h-l)/d,m=(c-a)/d,y=d/e;if(y>1){for(let x=1;x<=y-1;x++){const T=x*e,S=m*T+a,C=f*T+l;s.push([S,C])}const _=(d+Math.floor(y-1)*e)/2,v=m*_+a,w=f*_+l;s.push([v,w])}s.push([c,h])}}return R_t(t)?new Cm({rings:r,spatialReference:t.spatialReference}):new gp({paths:r,spatialReference:t.spatialReference})}function dhe(t,e,i){if(e){const r=$_t(t,1e6);t=w2(r,!0)}return i&&(t=YRe(t,i)),t}function phe(t,e,i){if(Array.isArray(t)){const r=t[0];if(r>e){const n=Dw(r,e);t[0]=r+n*(-2*e)}else if(r<i){const n=Dw(r,i);t[0]=r+n*(-2*i)}}else{const r=t.x;if(r>e){const n=Dw(r,e);t=t.clone().offset(n*(-2*e),0)}else if(r<i){const n=Dw(r,i);t=t.clone().offset(n*(-2*i),0)}}return t}function I_t(t,e){let i=-1;for(let r=0;r<e.cutIndexes.length;r++){const n=e.cutIndexes[r],s=e.geometries[r],o=DR(s);for(let a=0;a<o.length;a++){const l=o[a];l.some(c=>{if(c[0]<180)return!0;{let h=0;for(let f=0;f<l.length;f++){const m=l[f][0];h=m>h?m:h}h=Number(h.toFixed(9));const d=-360*Dw(h,180);for(let f=0;f<l.length;f++){const m=s.getPoint(a,f);s.setPoint(a,f,m.clone().offset(d,0))}return!0}})}if(n===i){if(P_t(t))for(const a of DR(s))t[n]=t[n].addRing(a);else if(M_t(t))for(const a of DR(s))t[n]=t[n].addPath(a)}else i=n,t[n]=s}return t}async function L_t(t,e,i){if(!Array.isArray(t))return L_t([t],e);e&&typeof e!="string"&&XRe.warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const r=typeof e=="string"?e:e?.url??Di.geometryServiceUrl;let n,s,o,a,l,c,h,d,f=0;const m=[],y=[];for(const S of t)if(S!=null)if(n||(n=S.spatialReference,s=Sp(n),o=n.isWebMercator,c=o?102100:4326,a=iD[c].maxX,l=iD[c].minX,h=iD[c].plus180Line,d=iD[c].minus180Line),s)if(S.type==="mesh")y.push(S);else if(S.type==="point")y.push(phe(S.clone(),a,l));else if(S.type==="multipoint"){const C=S.clone();C.points=C.points.map(A=>phe(A,a,l)),y.push(C)}else if(S.type==="extent"){const C=S.clone()._normalize(!1,!1,s);y.push(C.rings?new Cm(C):C)}else if(S.extent){const C=S.extent,A=Dw(C.xmin,l)*(2*a);let R=A===0?S.clone():YRe(S.clone(),A);C.offset(A,0),C.intersects(h)&&C.xmax!==a?(f=C.xmax>f?C.xmax:f,R=dhe(R,o),m.push(R),y.push("cut")):C.intersects(d)&&C.xmin!==l?(f=C.xmax*(2*a)>f?C.xmax*(2*a):f,R=dhe(R,o,360),m.push(R),y.push("cut")):y.push(R)}else y.push(S.clone());else y.push(S);else y.push(S);let _=Dw(f,a),v=-90;const w=_,x=new gp;for(;_>0;){const S=360*_-180;x.addPath([[S,v],[S,-1*v]]),v*=-1,_--}if(m.length>0&&w>0){const S=I_t(m,await A_t(r,m,x,i)),C=[],A=[];for(let N=0;N<y.length;N++){const k=y[N];if(k!=="cut")A.push(k);else{const B=S.shift(),L=t[N];L!=null&&L.type==="polygon"&&L.rings&&L.rings.length>1&&B.rings.length>=L.rings.length?(C.push(B),A.push("simplify")):A.push(o?ov(B):B)}}if(!C.length)return A;const R=await O_t(r,C,i),D=[];for(let N=0;N<A.length;N++){const k=A[N];k!=="simplify"?D.push(k):D.push(o?ov(R.shift()):R.shift())}return D}const T=[];for(let S=0;S<y.length;S++){const C=y[S];if(C!=="cut")T.push(C);else{const A=m.shift();T.push(o===!0?ov(A):A)}}return T}function D_t(t,e,i){const r=Sp(i);if(r==null)return t;const[n,s]=r.valid,o=2*s;let a=0,l=0;e>s?a=Math.ceil(Math.abs(e-s)/o):e<n&&(a=-Math.ceil(Math.abs(e-n)/o)),t>s?l=Math.ceil(Math.abs(t-s)/o):t<n&&(l=-Math.ceil(Math.abs(t-n)/o));let c=t+(a-l)*o;const h=c-e;return h>s?c-=o:h<n&&(c+=o),c}const N_t=96,F_t=39.37;function Vee(t,e){return e.type?mi(t,e.x,e.y):gs(t,e)}function k_t(t){return Da(t)}function U_t(t,e){const i=t.targetGeometry,r=e.targetGeometry;return i.x=r.x,i.y=r.y,i.spatialReference=r.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}const z_t=function(){const t=Ge();return function(e,i,r){const n=i.targetGeometry;Vee(t,n);const s=.5*g8(i);return e.xmin=t[0]-s*r[0],e.ymin=t[1]-s*r[1],e.xmax=t[0]+s*r[0],e.ymax=t[1]+s*r[1],e.spatialReference=n.spatialReference,e}}();function g8(t){return t.scale*B_t(t.targetGeometry)}function B_t(t){return t!=null&&Ra(t.spatialReference)?1/(k_t(t.spatialReference)*F_t*N_t):1}function V_t(t){return v6(t.rotation)||0}const Gee=function(){const t=Ge(),e=Ge(),i=Ge();return function(r,n,s,o,a,l){return pK(t,n),Lc(e,s,.5*l),mi(i,1/o*l,-1/o*l),Bee(r,e),a&&Uee(r,r,a),jRe(r,r,i),zee(r,r,t),r}}(),G_t=function(){const t=Ge();return function(e,i,r,n){const s=g8(i),o=V_t(i);return Vee(t,i.targetGeometry),Gee(e,t,r,s,o,n)}}(),j_t=function(){const t=Ge();return function(e,i,r,n){const s=g8(i);return Vee(t,i.targetGeometry),Gee(e,t,r,s,0,n)}}();function H_t(t){const e=Sp(t);return e?e.valid[1]-e.valid[0]:0}function q_t(t,e){return Math.round(H_t(t)/e)}var BW;const Va=[0,0];let m_=BW=class extends pe{constructor(t){super(t),this._viewpoint2D={center:Ge(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new zi,this.id=0,this.inverseTransform=O4(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=O4(),this.transformNoRotation=O4(),this.displayMat3=Ma(),this.displayViewMat3=Ma(),this.viewMat3=Ma(),this.viewMat2d=qRe(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(t){this._set("pixelRatio",t),this._update()}set size(t){this._set("size",t),this._update()}set viewpoint(t){if(t){const e=this._viewpoint2D,i=t.targetGeometry;e.center[0]=i.x,e.center[1]=i.y,e.rotation=t.rotation,e.scale=t.scale,e.spatialReference=i.spatialReference}this._update()}copy(t){const e=this.size,i=this.viewpoint;return i&&e?(this.viewpoint=U_t(i,t.viewpoint),this._set("size",gs(e,t.size))):(this.viewpoint=t.viewpoint.clone(),this._set("size",[t.size[0],t.size[1]])),this._set("pixelRatio",t.pixelRatio),this}clone(){return new BW({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(t,e,i){return tD(e)?d_(t,e,this.inverseTransform):(Va[0]=e,Va[1]=i,d_(t,Va,this.inverseTransform))}toScreen(t,e,i){return tD(e)?d_(t,e,this.transform):(Va[0]=e,Va[1]=i,d_(t,Va,this.transform))}toScreenNoRotation(t,e,i){return tD(e)?d_(t,e,this.transformNoRotation):(Va[0]=e,Va[1]=i,d_(t,Va,this.transformNoRotation))}toScreenClosest(t,e,i){tD(e)?(Va[0]=e[0],Va[1]=e[1]):(Va[0]=e,Va[1]=i);const[r]=Va,{center:n,extent:s,spatialReference:o,transform:a}=this;return(r<s.xmin||r>s.xmax)&&(Va[0]=D_t(r,n[0],o)),d_(t,Va,a)}getScreenTransform(t,e){const{center:i}=this._viewpoint2D,r=this._get("pixelRatio")||1,n=this._get("size");return Gee(t,i,n,e,0,r),t}_update(){const{center:t,spatialReference:e,scale:i,rotation:r}=this._viewpoint2D,n=this._get("pixelRatio")||1,s=this._get("size"),o=new qc({targetGeometry:new ut(t[0],t[1],e),scale:i,rotation:r});if(this._set("viewpoint",o),!s||!e||!i)return;this.resolution=g8(o),this.rotation=r,this.scale=i,this.spatialReference=e,gs(this.center,t);const a=s[0]!==0?2/s[0]:0,l=s[1]!==0?-2/s[1]:0;HJ(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=qJ(this.viewMat3),h=Bh(s[0]/2,s[1]/2),d=Bh(-s[0]/2,-s[1]/2),f=v6(r);dF(c,c,h),WJ(c,c,f),dF(c,c,d),XE(this.displayViewMat3,this.displayMat3,c);const m=Bee(this.viewMat2d,h);return Uee(m,m,f),zee(m,m,d),z_t(this.extent,o,s),G_t(this.transform,o,s,n),VRe(this.inverseTransform,this.transform),j_t(this.transformNoRotation,o,s,n),this.worldScreenWidth=q_t(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};u([p({readOnly:!0})],m_.prototype,"id",void 0),u([p({value:1,json:{write:!0}})],m_.prototype,"pixelRatio",null),u([p({json:{write:!0}})],m_.prototype,"size",null),u([p()],m_.prototype,"spatialReference",void 0),u([p({type:qc,json:{write:!0}})],m_.prototype,"viewpoint",null),m_=BW=u([M("esri.views.2d.ViewState")],m_);const W_t=m_;var VW,GW,fhe,mhe,ghe,yhe,_he,vhe,bhe,whe,xhe,The,She,Ehe,Che,Ahe,Ohe,Rhe,Phe,Mhe,$he,Ihe,Lhe,Dhe,Nhe,Fhe,khe,Uhe,zhe,Bhe,Vhe,Ghe,jhe,Hhe,qhe,Whe,Yhe,Xhe,Zhe,Jhe,Khe,Qhe,ede,tde,ide,rde,nde,sde,ode,ade,lde,cde,ude,hde,dde,pde,fde,mde,gde,yde,_de;(function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE",t[t.UNKNOWN=4]="UNKNOWN"})(VW||(VW={})),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER",t[t.UNKNOWN=4]="UNKNOWN"}(GW||(GW={})),function(t){t[t.SCREEN=0]="SCREEN",t[t.MAP=1]="MAP"}(fhe||(fhe={})),function(t){t[t.Tint=0]="Tint",t[t.Ignore=1]="Ignore",t[t.Multiply=99]="Multiply"}(mhe||(mhe={})),function(t){t.Both="Both",t.JustBegin="JustBegin",t.JustEnd="JustEnd",t.None="None"}(ghe||(ghe={})),function(t){t[t.Mosaic=0]="Mosaic",t[t.Centered=1]="Centered"}(yhe||(yhe={})),function(t){t[t.Normal=0]="Normal",t[t.Superscript=1]="Superscript",t[t.Subscript=2]="Subscript"}(_he||(_he={})),function(t){t[t.MSSymbol=0]="MSSymbol",t[t.Unicode=1]="Unicode"}(vhe||(vhe={})),function(t){t[t.Unspecified=0]="Unspecified",t[t.TrueType=1]="TrueType",t[t.PSOpenType=2]="PSOpenType",t[t.TTOpenType=3]="TTOpenType",t[t.Type1=4]="Type1"}(bhe||(bhe={})),function(t){t[t.Display=0]="Display",t[t.Map=1]="Map"}(whe||(whe={})),function(t){t.None="None",t.Loop="Loop",t.Oscillate="Oscillate"}(xhe||(xhe={})),function(t){t[t.Z=0]="Z",t[t.X=1]="X",t[t.Y=2]="Y"}(The||(The={})),function(t){t[t.XYZ=0]="XYZ",t[t.ZXY=1]="ZXY",t[t.YXZ=2]="YXZ"}(She||(She={})),function(t){t[t.Rectangle=0]="Rectangle",t[t.RoundedRectangle=1]="RoundedRectangle",t[t.Oval=2]="Oval"}(Ehe||(Ehe={})),function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.Screen=2]="Screen",t[t.Multiply=3]="Multiply",t[t.Add=4]="Add"}(Che||(Che={})),function(t){t[t.TTB=0]="TTB",t[t.RTL=1]="RTL",t[t.BTT=2]="BTT"}(Ahe||(Ahe={})),function(t){t[t.None=0]="None",t[t.SignPost=1]="SignPost",t[t.FaceNearPlane=2]="FaceNearPlane"}(Ohe||(Ohe={})),function(t){t[t.Float=0]="Float",t[t.String=1]="String",t[t.Boolean=2]="Boolean"}(Rhe||(Rhe={})),function(t){t[t.Intersect=0]="Intersect",t[t.Subtract=1]="Subtract"}(Phe||(Phe={})),function(t){t.OpenEnded="OpenEnded",t.Block="Block",t.Crossed="Crossed"}(Mhe||(Mhe={})),function(t){t.FullGeometry="FullGeometry",t.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",t.ReversedFirstSegment="ReversedFirstSegment",t.PerpendicularToSecondSegment="PerpendicularToSecondSegment",t.SecondSegmentWithTicks="SecondSegmentWithTicks",t.DoublePerpendicular="DoublePerpendicular",t.OppositeToFirstSegment="OppositeToFirstSegment",t.TriplePerpendicular="TriplePerpendicular",t.HalfCircleFirstSegment="HalfCircleFirstSegment",t.HalfCircleSecondSegment="HalfCircleSecondSegment",t.HalfCircleExtended="HalfCircleExtended",t.OpenCircle="OpenCircle",t.CoverageEdgesWithTicks="CoverageEdgesWithTicks",t.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",t.GapExtentMidline="GapExtentMidline",t.Chevron="Chevron",t.PerpendicularWithArc="PerpendicularWithArc",t.ClosedHalfCircle="ClosedHalfCircle",t.TripleParallelExtended="TripleParallelExtended",t.ParallelWithTicks="ParallelWithTicks",t.Parallel="Parallel",t.PerpendicularToFirstSegment="PerpendicularToFirstSegment",t.ParallelOffset="ParallelOffset",t.OffsetOpposite="OffsetOpposite",t.OffsetSame="OffsetSame",t.CircleWithArc="CircleWithArc",t.DoubleJog="DoubleJog",t.PerpendicularOffset="PerpendicularOffset",t.LineExcludingLastSegment="LineExcludingLastSegment",t.MultivertexArrow="MultivertexArrow",t.CrossedArrow="CrossedArrow",t.ChevronArrow="ChevronArrow",t.ChevronArrowOffset="ChevronArrowOffset",t.PartialFirstSegment="PartialFirstSegment",t.Arch="Arch",t.CurvedParallelTicks="CurvedParallelTicks",t.Arc90Degrees="Arc90Degrees"}($he||($he={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square",t.TrueBuffer="TrueBuffer"}(Ihe||(Ihe={})),function(t){t.ClosePath="ClosePath",t.ConvexHull="ConvexHull",t.RectangularBox="RectangularBox"}(Lhe||(Lhe={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(Dhe||(Dhe={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square"}(Nhe||(Nhe={})),function(t){t.Fast="Fast",t.Accurate="Accurate"}(Fhe||(Fhe={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(khe||(khe={})),function(t){t.Sinus="Sinus",t.Square="Square",t.Triangle="Triangle",t.Random="Random"}(Uhe||(Uhe={})),function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Force=2]="Force"}(zhe||(zhe={})),function(t){t[t.Buffered=0]="Buffered",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.AlongLine=3]="AlongLine"}(Bhe||(Bhe={})),function(t){t[t.Linear=0]="Linear",t[t.Rectangular=1]="Rectangular",t[t.Circular=2]="Circular",t[t.Buffered=3]="Buffered"}(Vhe||(Vhe={})),function(t){t[t.Discrete=0]="Discrete",t[t.Continuous=1]="Continuous"}(Ghe||(Ghe={})),function(t){t[t.AcrossLine=0]="AcrossLine",t[t.AloneLine=1]="AloneLine"}(jhe||(jhe={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Center=2]="Center",t[t.Justify=3]="Justify"}(Hhe||(Hhe={})),function(t){t[t.Base=0]="Base",t[t.MidPoint=1]="MidPoint",t[t.ThreePoint=2]="ThreePoint",t[t.FourPoint=3]="FourPoint",t[t.Underline=4]="Underline",t[t.CircularCW=5]="CircularCW",t[t.CircularCCW=6]="CircularCCW"}(qhe||(qhe={})),function(t){t.Butt="Butt",t.Round="Round",t.Square="Square"}(Whe||(Whe={})),function(t){t.NoConstraint="NoConstraint",t.HalfPattern="HalfPattern",t.HalfGap="HalfGap",t.FullPattern="FullPattern",t.FullGap="FullGap",t.Custom="Custom"}(Yhe||(Yhe={})),function(t){t[t.None=-1]="None",t[t.Custom=0]="Custom",t[t.Circle=1]="Circle",t[t.OpenArrow=2]="OpenArrow",t[t.ClosedArrow=3]="ClosedArrow",t[t.Diamond=4]="Diamond"}(Xhe||(Xhe={})),function(t){t[t.ExtraLeading=0]="ExtraLeading",t[t.Multiple=1]="Multiple",t[t.Exact=2]="Exact"}(Zhe||(Zhe={})),function(t){t.Bevel="Bevel",t.Round="Round",t.Miter="Miter"}(Jhe||(Jhe={})),function(t){t[t.Default=0]="Default",t[t.String=1]="String",t[t.Numeric=2]="Numeric"}(Khe||(Khe={})),function(t){t[t.InsidePolygon=0]="InsidePolygon",t[t.PolygonCenter=1]="PolygonCenter",t[t.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(Qhe||(Qhe={})),function(t){t[t.Tint=0]="Tint",t[t.Replace=1]="Replace",t[t.Multiply=2]="Multiply"}(ede||(ede={})),function(t){t[t.ClipAtBoundary=0]="ClipAtBoundary",t[t.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",t[t.DoNotTouchBoundary=2]="DoNotTouchBoundary",t[t.DoNotClip=3]="DoNotClip"}(tde||(tde={})),function(t){t.NoConstraint="NoConstraint",t.WithMarkers="WithMarkers",t.WithFullGap="WithFullGap",t.WithHalfGap="WithHalfGap",t.Custom="Custom"}(ide||(ide={})),function(t){t.Fixed="Fixed",t.Random="Random",t.RandomFixedQuantity="RandomFixedQuantity"}(rde||(rde={})),function(t){t.LineMiddle="LineMiddle",t.LineBeginning="LineBeginning",t.LineEnd="LineEnd",t.SegmentMidpoint="SegmentMidpoint"}(nde||(nde={})),function(t){t.OnPolygon="OnPolygon",t.CenterOfMass="CenterOfMass",t.BoundingBoxCenter="BoundingBoxCenter"}(sde||(sde={})),function(t){t[t.Low=0]="Low",t[t.Medium=1]="Medium",t[t.High=2]="High"}(ode||(ode={})),function(t){t[t.MarkerCenter=0]="MarkerCenter",t[t.MarkerBounds=1]="MarkerBounds"}(ade||(ade={})),function(t){t[t.None=0]="None",t[t.PropUniform=1]="PropUniform",t[t.PropNonuniform=2]="PropNonuniform",t[t.DifUniform=3]="DifUniform",t[t.DifNonuniform=4]="DifNonuniform"}(lde||(lde={})),function(t){t.Tube="Tube",t.Strip="Strip",t.Wall="Wall"}(cde||(cde={})),function(t){t[t.Random=0]="Random",t[t.Increasing=1]="Increasing",t[t.Decreasing=2]="Decreasing",t[t.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(ude||(ude={})),function(t){t[t.Relative=0]="Relative",t[t.Absolute=1]="Absolute"}(hde||(hde={})),function(t){t[t.Normal=0]="Normal",t[t.LowerCase=1]="LowerCase",t[t.Allcaps=2]="Allcaps"}(dde||(dde={})),function(t){t[t.LTR=0]="LTR",t[t.RTL=1]="RTL"}(pde||(pde={})),function(t){t.Draft="Draft",t.Picture="Picture",t.Text="Text"}(fde||(fde={})),function(t){t[t.Top=0]="Top",t[t.Center=1]="Center",t[t.Baseline=2]="Baseline",t[t.Bottom=3]="Bottom"}(mde||(mde={})),function(t){t[t.Right=0]="Right",t[t.Upright=1]="Upright"}(gde||(gde={})),function(t){t[t.Small=0]="Small",t[t.Medium=1]="Medium",t[t.Large=2]="Large"}(yde||(yde={})),function(t){t[t.Calm=0]="Calm",t[t.Rippled=1]="Rippled",t[t.Slight=2]="Slight",t[t.Moderate=3]="Moderate"}(_de||(_de={}));var jW,_w,HW,gk,qW,yk,WW,vw,YW;(function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(jW||(jW={})),function(t){t[t.VISIBLE=0]="VISIBLE",t[t.NONE=1]="NONE"}(_w||(_w={})),function(t){t[t.POINT=0]="POINT",t[t.LINE=1]="LINE",t[t.LINE_CENTER=2]="LINE_CENTER"}(HW||(HW={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT",t[t.AUTO=2]="AUTO"}(gk||(gk={})),function(t){t[t.AUTO=0]="AUTO",t[t.LEFT=1]="LEFT",t[t.CENTER=2]="CENTER",t[t.RIGHT=3]="RIGHT"}(qW||(qW={})),function(t){t[t.CENTER=0]="CENTER",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.TOP_LEFT=5]="TOP_LEFT",t[t.TOP_RIGHT=6]="TOP_RIGHT",t[t.BOTTOM_LEFT=7]="BOTTOM_LEFT",t[t.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(yk||(yk={})),function(t){t[t.NONE=0]="NONE",t[t.UPPERCASE=1]="UPPERCASE",t[t.LOWERCASE=2]="LOWERCASE"}(WW||(WW={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT"}(vw||(vw={})),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(YW||(YW={}));let Pd=class{};Pd.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:_w.VISIBLE}},Pd.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:_w.VISIBLE}},Pd.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:_w.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:VW.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:GW.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}},Pd.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:_w.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:HW.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:yk.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:gk.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:yk.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:qW.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:gk.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:WW.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[YW.HORIZONTAL]}},Pd.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:_w.VISIBLE}},Pd.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}},Pd.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:vw.MAP}},Pd.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:vw.MAP},"line-width":{type:"number",minimum:0,default:1}},Pd.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:vw.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:vw.MAP}},Pd.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}},Pd.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:vw.MAP}};let Y_t=class extends rRe{_createTransforms(){return{dvs:Ma(),tileMat3:Ma()}}};const X_t=.125;let Z_t=class{constructor(){this._renderParams={context:null,drawPhase:1,state:new W_t({viewpoint:new qc({targetGeometry:new ut(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null,stencilSymbols:!0,is3D:!0,backgroundColor:null},this._backgroundTile=new Y_t(new $x(0,0,0,0),0,0,0,512,512,4096,4096)}dispose(){this._renderParams=null}renderBackground(e,i,r,n,s,o,a,l,c,h){const d=this._backgroundTile;this._updateRenderParams(e,i,d,r,s,o,a,l,c,h),this._renderParams.stencilSymbols=!1,r.drawBackground(this._renderParams,d,n)}renderContent(e,i,r,n,s,o,a,l,c,h,d,f){this._stencilSymbols(e,i,r,n,s,o,a,Math.round(1/l),c,h,d,f);let m=1;r.stencilRef=m++,e.setStencilFunction(Bi.EQUAL,r.stencilRef,255),this._render(e,i,r,s,o,a,l,c,h,d,f),n.forAll(y=>{y.sourceLayerInfo.data.stencilRef=m++,this._renderSymbols(e,y.sourceLod,y.sourceLayerInfo.data,s,o,a,Math.round(1/l),y.offset,h,d,f)})}_stencilSymbols(e,i,r,n,s,o,a,l,c,h,d,f){let m=1;r.stencilRef=m++,e.setDepthTestEnabled(!1),e.setDepthWriteEnabled(!1),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(tn.KEEP,tn.KEEP,tn.REPLACE),e.setStencilWriteMask(255),e.setStencilFunction(Bi.ALWAYS,r.stencilRef,255),this._stencilTileSymbols(e,i,r,s,o,a,l,c,h,d,f);for(const y of n.toArray()){const{sourceLod:_,offset:v,sourceLayerInfo:w}=y;w.data.stencilRef=m++,e.setStencilFunction(Bi.ALWAYS,w.data.stencilRef,255),this._stencilTileSymbols(e,_,w.data,s,o,a,l,v,h,d,f)}e.setStencilWriteMask(0),e.setBlendingEnabled(!0),e.setDepthTestEnabled(!0),e.setColorMask(!0,!0,!0,!0)}_renderSymbols(e,i,r,n,s,o,a,l,c,h,d){e.setStencilFunction(Bi.EQUAL,r.stencilRef,255),this._render(e,i,r,n,s,o,a,l,c,h,d,jW.SYMBOL)}_render(e,i,r,n,s,o,a,l,c,h,d,f){this._updateRenderParams(e,i,r,n,o,a,l,c,h,d),this._renderParams.stencilSymbols=!1,n.drawTile(this._renderParams,r,s,f)}_stencilTileSymbols(e,i,r,n,s,o,a,l,c,h,d){this._updateRenderParams(e,i,r,n,o,a,l,c,h,d),this._renderParams.stencilSymbols=!0,r.triangleCount=0,n.drawSymbols(this._renderParams,r,s)}_updateRenderParams(e,i,r,n,s,o,a,l,c,h){"type"in r&&r.type==="vector-tile"&&!r.stage&&r.attachWithContext(e);const d=i[0]-s.getLevelShift(i[0]),f=this._renderParams;f.context=e,f.painter=n,f.glyphMosaic=n.glyphMosaic,f.spriteMosaic=n.spriteMosaic,f.pixelRatio=c*h,f.displayLevel=d,f.requiredLevel=d;const m=s.getScale(i[0]),[y,_]=s.getOffset(i,o*m),v=X_t*o*m/l,w=r.transforms.dvs;w[0]=v,w[4]=-v,w[6]=-1-y-a[0]*o*2,w[7]=1+_+(1-a[1])*o*2-2,f.state.size[0]=l/h,f.state.size[1]=l/h,f.state.pixelRatio=h}},ZRe=class JRe extends Fi{initializeProgram(e){return new Mi(e.rctx,JRe.shader.get().build(this.configuration),Si)}initializePipeline(){return Lt({blending:Yc(Te.ONE,Te.ONE_MINUS_SRC_ALPHA),colorWrite:Gt})}};ZRe.shader=new Pi(t0t,()=>ce(()=>import("./RasterColorizer.glsl-5d7e1501.js"),[],import.meta.url));let gO=class extends LR{constructor(){super(...arguments),this.colorizerType=Qw.Stretch,this.stretchType=Ix.Noop,this.applyColormap=!0,this.requireBilinearWithNN=!1}};u([U({count:Qw.COUNT})],gO.prototype,"colorizerType",void 0),u([U({count:Ix.COUNT})],gO.prototype,"stretchType",void 0),u([U()],gO.prototype,"applyColormap",void 0),u([U()],gO.prototype,"requireBilinearWithNN",void 0);let vde=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const i=this._fbos.get(e);if(i)return i;const r=new jp(this._rctx,new Hi(e),new HN(fo.DEPTH24_STENCIL8,e));return this._fbos.set(e,r),r}};const J_t=K.getLogger("esri.views.3d.terrain");let K_t=class{constructor(e,i){this._rctx=e,this._techniqueRepository=i,this._fbos=[],this._vectorTileHelper=new Z_t,this._bindParameters=new bU(null,null),this._blendLayersTechniqueConfig=new URe,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=qm(this._rctx,NM)}dispose(){this._fbos.forEach(rt),this._fbos=null,this._vtFBO=rt(this._vtFBO),this._vaoQuad=rt(this._vaoQuad),this._vectorTileHelper=rt(this._vectorTileHelper),this._backgroundTechnique=li(this._backgroundTechnique),this._applyOpacityTechnique=li(this._applyOpacityTechnique),this._blendLayersTechnique=li(this._blendLayersTechnique)}_getBlendLayersTechnique(e,i,r,n=cp.Off,s=Lx.BelowLayer){return this._blendLayersTechniqueConfig.output=i,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=r,this._blendLayersTechniqueConfig.premultipliedSource=n,this._blendLayersTechniqueConfig.background=s,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(FRe,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(e,i){const r=this._getBlendLayersTechnique(Ie.Normal,i?ds.ColorComposite:ds.GridComposite,Uu.NotRequired,cp.Off,Lx.Only),n=this._rctx.bindTechnique(r,e,this._bindParameters);this._render(n)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(ci.TRIANGLE_STRIP,0,uy(this._vaoQuad,"geometry"))}drawGroup(e,i,r,n,s,o=cp.On){i===ds.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(r).colorTexture),e.texture=this.currentFBO(r).colorTexture,this.closeGroup(r);const a=this._getBlendLayersTechnique(n,i,s,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawRasterData(e,i,r,n,s,o=cp.Off){if(e.texture==null)return;e.fboTexture=i===ds.GroupBackgroundComposite||n===Ie.Normal&&s===Uu.NotRequired&&o===cp.Off?null:this.switch(r).colorTexture;const a=this._getBlendLayersTechnique(n,i,s,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawImageryTileData(e,i,r,n,s,o){const a=o.sourceLayerInfo.data;if(!a.source||(o.tile.surface.layerViewByIndex(o.layerIndex,Yt.MAP).ensureSymbolizerParameters(a),!a.bind(this._rctx)))return;e.fboTexture=n===Ie.Normal&&s===Uu.NotRequired?null:this.switch(r).colorTexture;const l=this._getRasterColorizerTechnique(a,i,n,s);a.opacity=e.opacity;const c=a.getUniforms();c.scale=o.scale,c.offset=o.offset,c.backgroundColor=e.backgroundColor,c.fboTexture=e.fboTexture,c.baseOpacity=e.baseOpacity;const h=this._rctx.bindTechnique(l,c,null);this._render(h)}_getRasterColorizerTechnique(e,i,r,n){const s=e.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(s.type);return this._rasterColorizerConfig==null&&(this._rasterColorizerConfig=new gO,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=i,this._rasterColorizerConfig.blendMode=r,this._rasterColorizerConfig.baseOpacityMode=n,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!s.colormap,this._rasterColorizerConfig.requireBilinearWithNN=e.isBilinearWithStretchColorRamp,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?Ix.Noop:Ix.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(ZRe,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(e,i,r,n,s,o,a,l,c){const h=this._rctx,d=o.sourceLayerInfo.data,f=o.tile.surface.layerViewByIndex(o.layerIndex,Yt.MAP),m=s===Uu.Required||e.opacity<1||n!==Ie.Normal||i!==ds.Composite,y=m?cp.On:cp.Off,_=this._getBlendLayersTechnique(n,i,s,y);h.setPipelineState(_.getPipeline());let v=null,w=null;m?(w=this.currentFBO(r),this._vtFBO==null&&(this._vtFBO=new vde(this._rctx)),v=this._vtFBO.get(r),h.bindFramebuffer(v),this._clearCurrentFBO()):c&&h.clearSafe(wr.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.renderBackground(h,o.sourceLod,f.painter,f.layer.styleRepository,f.schemaHelper,Math.round(1/o.scale),o.offset,l,a,f.contentZoom),d&&this._vectorTileHelper.renderContent(h,o.sourceLod,d,o.vtlNeighborInfos,f.painter,f.layer.styleRepository,f.schemaHelper,Math.round(1/o.scale),o.offset,l,a,f.contentZoom)}catch(x){J_t.warnOnce("A render call containing vector tiles did not resolve correctly.",x)}return v==null||(h.bindFramebuffer(w),e.texture=v.colorTexture,e.offset=Ey,e.scale=1,this.drawRasterData(e,i,r,n,s,y),c)}copyFBOToTexture(e){const i=this._rctx,r=i.bindTexture(e.texture,Nt.TEXTURE_UNIT_FOR_UPDATES),n=e.descriptor;i.gl.copyTexImage2D(bn.TEXTURE_2D,0,n.pixelFormat,0,0,n.width,n.height,0),e.generateMipmap(),i.bindTexture(r,Nt.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setStencilWriteMask(255),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.setClearStencil(0),this._rctx.clearSafe(wr.COLOR_BUFFER_BIT|wr.DEPTH_BUFFER_BIT|wr.STENCIL_BUFFER_BIT)}_initFBO(e,i,r){this._rctx.bindFramebuffer(e),r&&(this._rctx.setViewport(0,0,i,i),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,i=0,r=!0){if(this._current=i,i>=this._fbos.length)for(let n=this._fbos.length;n<=i;n++)this._fbos.push(new vde(this._rctx));this._initFBO(this._fbos[i].get(e),e,r)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const i=this.currentFBO(e),r=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),i}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const i=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(i),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},Q_t=class{constructor(){this.sourceLod=[0,0,0],this.offset=[0,0],this.scale=1,this.layerIndex=0,this.isVTLBackground=!1,this.vtlNeighborInfos=new Ut({allocator:e=>e||new evt})}},evt=class{constructor(){this.sourceLayerInfo=null,this.sourceLod=[0,0,0],this.offset=[-1,0]}},tvt=class{constructor(e,i,r,n,s,o){this.start=e,this.end=i,this.blendMode=r,this.opacity=n,this.output=s,this.baseOpacity=o}},ivt=class{constructor(e,i,r,n){this._rctx=e,this.tileSize=i,this._techniques=r,this._cache=n,this._passParameters=new X0t,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new K_t(this._rctx,this._techniques),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=rt(this._composition),this._backgroundTexture=li(this._backgroundTexture)}get backgroundIsGrid(){return this._backgroundColor==null}get backgroundColor(){return this._backgroundColor}updateTileTexture(e,i){if(!e.renderData)return;const r=e.surface,n=r.baseOpacity;let s=0,o=0,a=this.tileSize,l=!1,c=!1;const h=r.view.state.contentPixelRatio;let d=!1;_k.clear(),aS.length=0;const f=e.layerInfo[Yt.MAP];let m=0,y=null;for(;m<f.length;m++){const v=r.layerViewByIndex(m,Yt.MAP),w=v.layer.opacity,x=v.fullOpacity;if(c=c||XD(v.layer),VP(v)){let C=v.layer.blendMode!=="normal";if(AE(v.layer.parent)){const A=XW(v.layer.parent);A!=null&&A!==""&&(C=KRe(v.layer.parent)||C)}C&&(d=C,l=!1)}if(w===0&&!d){f[m].pendingUpdates&=~(bt.TEXTURE_NOFADING&bt.TEXTURE_FADING);continue}++o;const T=pC(v),S=YB(e,m,T);if(S){if(f[m].pendingUpdates&=~(bt.TEXTURE_NOFADING&bt.TEXTURE_FADING),AE(v.layer.parent)){const C=XW(v.layer.parent);C!=null&&C!==""&&QRe(v.layer.parent,m)}T?a=Math.max(a,this.tileSize*h):n===1&&x===1&&(v.isOpaque||this._dataToTexture(S)&&S.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++s,y===null&&(y=m)}}const _=a/this.tileSize;s!==0&&y!==null?s===1&&!d&&this._useLayerTexture(e,y)||this._composeMapLayers(e,i,m-1,c,a,_,!l||d,_k,d):this._useBackgroundTexture(e,o)}_ensureBackgroundTexture(e){return this._backgroundTexture==null&&(this._backgroundTexture=this._buildTexture(e,!1),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bind(e),this._passParameters.offset=Ey,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,this.backgroundColor!=null),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1),this._backgroundTexture}_useBackgroundTexture(e,i){const r=this._ensureBackgroundTexture(this.tileSize);let n=gy.Immediate;(e.surface.view.layerViewManager.updating||i>0)&&(n=gy.Delayed);const s=e.renderData;s.textureReference==null&&(n=gy.Immediate),s.setTextureReference(new jB(r,Rs.FADING,bde,e.surface.baseOpacity,0,1),n)}_useLayerTexture(e,i){const r=e.surface.layerViewByIndex(i,Yt.MAP),n=XD(r.layer),s=n?e.surface.baseOpacity:1,o=n?1:e.surface.baseOpacity,a=r.fullOpacity,l=YB(e,i,!1);return!!this._dataToTexture(l)&&(e.renderData.setTextureReference(new jB(l.sourceLayerInfo.data,Rs.FADING,l,s,o,a)),!0)}_composeMapLayers(e,i,r,n,s,o,a,l,c){this._composition.ensureBuffer(s);const h=e.surface.baseOpacity;let d=!1,f=zt.LINEAR_MIPMAP_LINEAR,m=!1,y=0;for(let x=r;x>=0;x--){const T=e.surface.layerViewByIndex(x,Yt.MAP),S=pC(T),C=YB(e,x,S),A=T.layer.opacity;if(!C||A===0&&!c)continue;const R=!XD(T.layer)&&!d;R&&(d=!0);let D=!1;l.forEach(z=>{z.start===x&&(z.output=n?ds.Composite:a&&R?this.backgroundIsGrid?ds.GridComposite:ds.ColorComposite:ds.Composite,z.baseOpacity=R?h:1,aS.push(z),this._composition.openGroup(s),D=!0)}),this._passParameters.baseOpacity=R&&!D&&h<1?h:1;const N=this._passParameters.baseOpacity<1?Uu.Required:Uu.NotRequired,k=y===0,B=D?ds.GroupBackgroundComposite:a&&k?this.backgroundIsGrid?ds.GridComposite:ds.ColorComposite:ds.Composite,L=kW[VP(T)?T.layer.blendMode:"normal"];for(this._passParameters.opacity=A,Egt(C)?m=this._composition.drawVectorData(this._passParameters,B,s,L,N,C,o,this.tileSize,m):Sgt(C)?(this._composition.drawImageryTileData(this._passParameters,B,s,L,N,C),this._hasNearestInterpolation(C)&&(f=zt.NEAREST)):this._dataToTexture(C)&&(this._passParameters.texture=C.sourceLayerInfo.data.texture,this._passParameters.offset=C.offset,this._passParameters.scale=C.scale,this._composition.drawRasterData(this._passParameters,B,s,L,N));aS.length>0&&aS[aS.length-1].end===x;){const z=aS.pop();this._passParameters.baseOpacity=z.baseOpacity;const j=this._passParameters.baseOpacity<1?Uu.Required:Uu.NotRequired;this._passParameters.opacity=z.opacity,this._passParameters.offset=Ey,this._passParameters.scale=1,this._composition.drawGroup(this._passParameters,z.output,s,kW[z.blendMode],j)}y++}const _=e.renderData,v=c||d&&h<1,w=_.ensureTexture(s,v,()=>this._buildTexture(s,v,f));this._composition.copyFBOToTexture(w),this._composition.unbind(),_.setTextureReference(new jB(w,i,bde,d?1:h,0,1))}_hasNearestInterpolation(e){const i=e.sourceLayerInfo.data;return!!i.source&&i.interpolation==="nearest"}_dataToTexture(e){if(Agt(e)){const i=e.sourceLayerInfo;i.data=this._buildTexture(i.data,!0),e.tile.setMemoryDirty()}return Cgt(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,i,r=zt.LINEAR_MIPMAP_LINEAR){if(e==null)return null;const n=new Hi;n.wrapMode=Vt.CLAMP_TO_EDGE,n.samplingMode=r,n.maxAnisotropy=this._maxAnisotropy,n.preMultiplyAlpha=!0,n.flipped=!0,n.hasMipmap=!0,i||(n.pixelFormat=gt.RGB);const s=this._rctx;let o;if(typeof e=="number"){n.width=n.height=e;const l=`${e} ${n.pixelFormat}`;o=this._cache.pop(l),o?o.retain():o=new mO(new Nt(s,n),this._cache)}else if(sgt(e)){n.isOpaque=e.isOpaque,n.isOpaque&&(n.pixelFormat=gt.RGB);const l=`${e} ${n.pixelFormat}`;o=this._cache.pop(l),o?(o.retain(),o.texture.setData(e.image)):o=new mO(new Nt(s,n,e.image),this._cache),e.release()}else try{n.width=e.width,n.height=e.height,o=new mO(new Nt(s,n,e))}catch{o=new mO(cTe(s)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const a=s.bindTexture(o.texture,Nt.TEXTURE_UNIT_FOR_UPDATES);return o.generateMipmap(),s.bindTexture(a,Nt.TEXTURE_UNIT_FOR_UPDATES),o}get test(){return{backgroundTexture:this._backgroundTexture}}};function YB(t,e,i){ga.layerIndex=e,ga.vtlNeighborInfos.clear();const r=t.layerInfo[Yt.MAP][e];if(mi(ga.offset,0,0),ga.tile=t,ga.scale=1,ga.sourceLod=t.lij,ga.sourceLayerInfo=r,ga.isVTLBackground=i,r.data)return i&&t.forEachLoadedNeighbor((s,o)=>{if(s.level!==t.level)return;const a=s.layerInfo[Yt.MAP][e];if(!QOe(a)||r.data===a.data)return;const l=ga.vtlNeighborInfos.pushNew();l.offset=$g[o],l.sourceLod=s.lij,l.sourceLayerInfo=a}),ga;const n=r.upsampleInfo;if(n){const s=n.tile.layerInfo[Yt.MAP][e];return ga.tile=n.tile,gs(ga.offset,n.offset),ga.scale=n.scale,ga.sourceLod=n.tile.lij,ga.sourceLayerInfo=s,ga}return i?ga:null}function XW(t){return t.uid}function KRe(t){let e=t.blendMode!=="normal";return AE(t.parent)&&(e=KRe(t.parent)||e),e}function QRe(t,e){AE(t.parent)&&QRe(t.parent,e);const i=XW(t);if(i!=null&&i!==""){const r=_k.get(i);r?r.start=e:_k.set(i,new tvt(e,e,t.blendMode,t.opacity,ds.Composite,1))}}const _k=new Map,aS=new Array,ga=new Q_t,bde={offset:[0,0],scale:1},$g=new Array;$g[at.NORTH]=[0,-1],$g[at.NORTH_EAST]=[-1,-1],$g[at.EAST]=[-1,0],$g[at.SOUTH_EAST]=[-1,1],$g[at.SOUTH]=[0,1],$g[at.SOUTH_WEST]=[1,1],$g[at.WEST]=[1,0],$g[at.NORTH_WEST]=[1,-1];const ePe=200,XB=40,rvt=.8,nvt=10,yO=1e-6;function svt(t,e,i){const r=e,n=i;let s=0,o=1/0;for(let a=0;a<3;++a){{const l=t[a];if(r[a]<l){if(n[a]<=yO)return!1;const c=(l-r[a])/n[a];s=Math.max(s,c)}else if(n[a]<=-yO){const c=(l-r[a])/n[a];o=Math.min(o,c)}if(s>o)return!1}{const l=t[a+3];if(r[a]>l){if(n[a]>=-yO)return!1;const c=(l-r[a])/n[a];s=Math.max(s,c)}else if(n[a]>=yO){const c=(l-r[a])/n[a];o=Math.min(o,c)}if(s>o)return!1}}return!0}let wde=class{constructor(e,i,r,n,s){this.aabb=e,this.axis=i,this.d=r,this.midStartIndex=n,this.rightStartIndex=s}},jee=class ZW{constructor(e,i,r,n){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=i,this.positions=n,this._rayDirection=E(),this.bspNodeTree=new Array;const s=r-i,o=s<=tPe?new Uint16Array(s):new Uint32Array(s);this.indices=o;for(let a=0;a<s;++a)o[a]=a;{const a=uvt(e,i,r,n.data,n.stride),l=_e(Math.log2(s/XB),2,nvt),c=(h,d,f)=>{const m=lvt(o,a,h,d),y=d-h;if(y<=XB){const S=new wde(m,void 0,0,h,d);return this.bspNodeTree.push(S),S}const{axis:_,midValue:v}=cvt(m),w=avt(o,a,h,d,_,v),x=(S,C)=>{if(f>l)return;const A=C-S;return A<XB||A>=rvt*y?void 0:c(S,C,f+1)},T=new wde(m,_,v,w.next,w.mid);return this.bspNodeTree.push(T),T.leftNode=x(h,w.next),T.rightNode=x(w.mid,d),T};c(0,s,0),this.triangleVertexIndices=hvt(o,e,i,r)}}intersectRayTriangleRange(e,i){{if(e>=i)return;const r=this.triangleVertexIndices,n=this.positions.data,s=this.positions.stride,o=this._rayOrigin,a=o[0],l=o[1],c=o[2],h=this._rayDirection,d=h[0],f=h[1],m=h[2];for(let y=e,_=3*e;y<i;++y){let v=r[_++]*s;const w=n[v++],x=n[v++],T=n[v];v=r[_++]*s;const S=n[v++],C=n[v++],A=n[v];v=r[_++]*s;const R=S-w,D=C-x,N=A-T,k=n[v++]-w,B=n[v++]-x,L=n[v]-T,z=f*L-B*m,j=m*k-L*d,H=d*B-k*f,X=R*z+D*j+N*H;if(Math.abs(X)<=Number.EPSILON)continue;const P=a-w,I=l-x,V=c-T,q=P*z+I*j+V*H;if(X>0){if(q<0||q>X)continue}else if(q>0||q<X)continue;const Y=I*N-D*V,J=V*R-N*P,ee=P*D-R*I,me=d*Y+f*J+m*ee;if(X>0){if(me<0||q+me>X)continue}else if(me>0||q+me<X)continue;const Me=(k*Y+B*J+L*ee)/X;if(Me>=0){const yt=this.indices[y]+this.firstTriangleIndex,St=hQ(R,D,N,k,B,L,ovt);this._callback(Me,St,yt,!1)}}}ZW.numFacesTested+=i-e}intersectRay(e,i){ZW.numFacesTested=0;const r=Oe(e.r0[0],e.r0[1],e.r0[2]),n=Oe(e.r1[0],e.r1[1],e.r1[2]),s=n[0]-r[0],o=n[1]-r[1],a=n[2]-r[2];if(s*s+o*o+a*a<yO)return;this._rayOrigin=r;const l=this._rayDirection;l[0]=s,l[1]=o,l[2]=a;const c=this.triangleVertexIndices.length/3;this._callback=i;const h=this.bspNodeTree[0];this.intersectRayBSP(h,0,c)}intersectRayBSP(e,i,r){const n=this._rayOrigin,s=this._rayDirection;if(!svt(e.aabb,n,s))return;const o=e.axis,a=e.d;if(n[o]<a||s[o]<0){const l=i,c=e.midStartIndex;if(l<c){const h=e.leftNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),n[o]>a||s[o]>0){const l=e.rightStartIndex,c=r;if(l<c){const h=e.rightNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}};jee.numFacesTested=0;const ovt=E(),lS=[1/0,1/0,1/0],cS=[-1/0,-1/0,-1/0];function avt(t,e,i,r,n,s){let o=i,a=r;for(;o<a;){const c=t[o];e[6*c+n+3]<=s?++o:(--a,t[o]=t[a],t[a]=c)}let l=o;for(a=r;l<a;){const c=t[a-1];e[6*c+n]>=s?--a:(t[a-1]=t[l],t[l]=c,++l)}return{next:o,mid:l}}function lvt(t,e,i,r){if(r<=i)return _x(NaN,NaN,NaN,NaN,NaN,NaN);{const n=6*t[i];for(let s=0;s<3;++s)lS[s]=e[n+0+s],cS[s]=e[n+3+s]}for(let n=i+1;n<r;++n){const s=6*t[n];for(let o=0;o<3;++o)lS[o]=Math.min(lS[o],e[s+0+o]),cS[o]=Math.max(cS[o],e[s+3+o])}return _x(lS[0],lS[1],lS[2],cS[0],cS[1],cS[2])}function cvt(t){const e=t[3]-t[0],i=t[4]-t[1],r=t[5]-t[2],n=e>i?e>r?0:i>r?1:2:i>r?1:r>e?2:0;return{axis:n,midValue:(t[n]+t[n+3])/2}}function uvt(t,e,i,r,n){const s=i-e,o=new Float32Array(6*s);for(let a=0;a<s;++a){const l=3*(a+e),c=t[l]*n,h=t[l+1]*n,d=t[l+2]*n;for(let f=0;f<3;++f){const m=r[c+f],y=r[h+f],_=r[d+f];o[6*a+f]=Math.min(m,y,_),o[6*a+3+f]=Math.max(m,y,_)}}return o}function hvt(t,e,i,r){const n=r-i;let s=0;for(let a=i;a<r;++a)for(let l=0;l<3;++l)s=Math.max(e[3*a+l],s);const o=s<=tPe?new Uint16Array(3*n):new Uint32Array(3*n);for(let a=0;a<n;++a){const l=3*(t[a]+i);for(let c=0;c<3;++c){const h=e[l+c];o[3*a+c]=h}}return o}const tPe=65535;let Vn=class extends fl{constructor(){super(...arguments),this.output=F.Color,this.overlayMode=cm.Disabled,this.tileBlendInput=um.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.invisible=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=ot.Terrain}};u([U({count:F.COUNT})],Vn.prototype,"output",void 0),u([U({count:cm.COUNT})],Vn.prototype,"overlayMode",void 0),u([U({count:um.COUNT})],Vn.prototype,"tileBlendInput",void 0),u([U()],Vn.prototype,"spherical",void 0),u([U()],Vn.prototype,"doublePrecisionRequiresObfuscation",void 0),u([U()],Vn.prototype,"receiveShadows",void 0),u([U()],Vn.prototype,"hasSlicePlane",void 0),u([U()],Vn.prototype,"backfaceCullingEnabled",void 0),u([U()],Vn.prototype,"textureFadingEnabled",void 0),u([U()],Vn.prototype,"renderOccluded",void 0),u([U()],Vn.prototype,"hasScreenSpaceReflections",void 0),u([U()],Vn.prototype,"hasCloudsReflections",void 0),u([U()],Vn.prototype,"invisible",void 0),u([U()],Vn.prototype,"tileBorders",void 0),u([U()],Vn.prototype,"visualizeNormals",void 0),u([U()],Vn.prototype,"screenSizePerspective",void 0),u([U()],Vn.prototype,"receiveAmbientOcclusion",void 0),u([U({count:ot.COUNT})],Vn.prototype,"pbrMode",void 0),u([U({constValue:Ni.Compressed})],Vn.prototype,"normalType",void 0),u([U({constValue:Zn.Compressed})],Vn.prototype,"textureCoordinateType",void 0),u([U({constValue:!1})],Vn.prototype,"highStepCount",void 0),u([U({constValue:!1})],Vn.prototype,"useCustomDTRExponentForWater",void 0),u([U({constValue:!1})],Vn.prototype,"useFillLights",void 0),u([U({constValue:!0})],Vn.prototype,"hasColorTexture",void 0);const ZB=7,dvt=10,JB=ks();var ll;(function(t){t[t.Opaque=0]="Opaque",t[t.Semitransparent=1]="Semitransparent",t[t.TransparentWithDraped=2]="TransparentWithDraped",t[t.Empty=3]="Empty"})(ll||(ll={}));let Yd=class extends PSe{get _isGlobal(){return this._stage.viewingMode===Le.Global}get _techniques(){return this._context.techniqueRepository}get _rctx(){return this._context.renderContext.rctx}constructor(e,i,r,n,s){super({}),this._overlayRenderer=e,this._stage=i,this._allTiles=r,this._ellipsoidRadius=n,this.type=Jr.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new Vn,this._passParameters=new _Re,this._renderDataPool=new $a(S0t),this._visiblePatchesByOrigin=new Map,this._allPatchesByOrigin=new Map,this._patchesByOriginDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new uRe,this._transparencyState=ll.Opaque,this._castShadows=!1,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.renderOccludedFlags=Vr.Occlude,this.produces=new Map([[le.OPAQUE_TERRAIN,()=>this._produces()],[le.TRANSPARENT_TERRAIN,()=>this._produces()],[le.OCCLUDED_TERRAIN,()=>this._produces()]]),this._tileTextureCache=new DM((o,a)=>s.newCache(o,a),"TileTexture"),this.tileGeometryCache=new q0t(s)}normalizeCtorArgs(){return{}}initialize(){this._stage.addRenderPlugin(this)}destroy(){this._stage.removeRenderPlugin(this),this._tileTextureCache.destroy(),this.tileGeometryCache.destroy()}_produces(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}consumes(){return this._overlayRenderer.hasWater?ASe:PU}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set visible(e){this._set("visible",!!e),this.setDirty()}set transparency(e){this._transparencyState!==e&&(this._techniqueConfiguration.invisible=e===ll.TransparentWithDraped||e===ll.Empty,this._transparencyState=e,this.setNeedsRender())}get transparency(){return this._transparencyState}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(e){this._techniqueConfiguration.visualizeNormals!==e&&(this._techniqueConfiguration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}get layerUid(){return F_}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._techniqueConfiguration.pbrMode!==e&&(this._techniqueConfiguration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?tk:Vr.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}setTileSize(e){this._tileSize=e,this._tileRenderer!=null&&(this._tileRenderer.tileSize=e),this.setDirty()}_prepareTileForLoading(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometryState(e),this.updateTileTexture(e,bt.TEXTURE_FADING)}updateTileTexture(e,i){this._tileRenderer!=null&&(this._tileRenderer.updateTileTexture(e,i===bt.TEXTURE_FADING?Rs.FADING:Rs.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(i))}updateTileGeometryState(e){for(const r of e.layerInfo[Yt.ELEVATION])r.pendingUpdates&=~bt.GEOMETRY;e.resetPendingUpdate(bt.GEOMETRY);const i=e.renderData.updateGeometryState();return i&&this.setDirty(),i}updateGeometryIfNeeded(e){e.isLoaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const i=e.renderData;i&&(i.releaseGeometry(),this._renderDataPool.release(i),i.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const i=dvt-ZB,r=Math.max(0,Math.floor((e.level-i)/ZB)*ZB);if(this._isGlobal&&r===0)return vo;for(;e.parent&&e.level>r;)e=e.parent;return e.centerAtSeaLevel}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=Ln.UPDATE){this._patchesByOriginDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=Ln.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=Ln.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._tileRenderer=new ivt(this._rctx,this._tileSize,this._techniques,this._tileTextureCache),this.updateTileBackground(),this._emptyTex=cTe(this._rctx)}uninitializeRenderContext(){this._emptyTex=rt(this._emptyTex),this._tileRenderer=rt(this._tileRenderer)}intersect(e,i,r,n){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==ll.Opaque)return;const s=pvt,o=fvt;de(s,n,r),ae(o,1/s[0],1/s[1],1/s[2]);const a=e.results.min,l=e.results.max,c=e.results.ground,h=e.options.store===Bo.MIN,d=!!e.results.ground.target,f=GHe(e.verticalOffset),m=e.tolerance;let y,_=h&&a.dist!=null?a.dist:1/0;const v=x=>{const T=x.renderData;if(!T?.vao)return;const S=T.geometry;H6(JB,S.boundingBox);const C=T.localOrigin;f!=null&&(f.localOrigin=C,f.applyToAabb(JB));const A=JB;if(uS[0]=r[0]-C[0],uS[1]=r[1]-C[1],uS[2]=r[2]-C[2],!pQ(A,uS,o,m,_))return;const R=(H,X,P)=>{H.set(this.type,x,X,P,Kr),_=h&&a.dist!=null?a.dist:1/0},D=(H,X)=>{if(X!=null&&H>=0&&(e.options.backfacesTerrain||ge(X,s)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||i==null||i(r,n,H))){if((c.dist==null||H<c.dist)&&R(c,H,X),e.options.isFiltered)return;e.options.store===Bo.ALL&&(y==null?(y=iK(e.ray),R(y,H,X),e.results.all.push(y)):H<y.dist&&R(y,H,X)),(a.dist==null||H<a.dist)&&R(a,H,X),e.options.store!==Bo.MIN&&(l.dist==null||H>l.dist)&&R(l,H,X)}},N=mvt;de(N,n,C);const k=S.indices,B=S.vertexAttributes,L=B.getField(O.POSITION,Ws),z=new LM(L.typedBuffer,3,B.stride/4),j=S.indexCount/3;if(!f&&j>ePe){const H=x.renderData;H.intersectionData==null&&(H.intersectionData=new jee(k,0,j,z)),H.intersectionData.intersectRay({r0:uS,r1:N},D)}else HM(uS,N,0,j,k,z,null,f,D)},w=this._rootTiles;w!=null&&(()=>{const x=this._tileIterator;x.reset(w);const T=e.options.invisibleTerrain;for(let S=x.next();S;S=x.next())!(S.visible||T&&S.intersectsClippingArea)||f==null&&!S.intersectsRay(r,s,m,_)||d&&this._useStencilForTile(S)?x.skipSubtree():v(S)})()}processScaleRangeQueries(e,i){if(!i.done)for(this._updatePatchGroups();e.updating&&!i.done;){e.prepare();for(const r of this._visiblePatchesByOrigin.values())for(const n of r)n.renderData?.textureReference!=null&&e.queriesForTile(n);e.process(),i.madeProgress()}}prepareTechnique(e){const i=ie("enable-feature:terrain-shadows")&&e.bindParameters.shadowMap.enabled;if(i!==this._castShadows&&(this._castShadows=i,this._patchesByOriginDirty=!0),e.bindParameters.slot===le.OCCLUDED_TERRAIN){if(!(e.renderOccludedMask&tk))return null}else{const r=this.transparency===ll.Opaque?le.OPAQUE_TERRAIN:le.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==r)return null}if(this.transparency===ll.Empty)return null;switch(e.output){case F.Color:return this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.lastFrameColor!=null,this._techniqueConfiguration.hasCloudsReflections=e.bindParameters.cloudsFade.data!=null,this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssao!=null,this._techniqueConfiguration.overlayMode=this._overlayRenderer.mode,this._updateTechnique(F.Color,e.bindParameters.slot===le.OCCLUDED_TERRAIN);case F.Shadow:case F.ShadowExcludeHighlight:return this._castShadows?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(F.Shadow,!1)):null;case F.Depth:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(F.Depth,!1);case F.Normal:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(F.Normal,!1);case F.ObjectAndLayerIdColor:return this._updateTechnique(F.ObjectAndLayerIdColor,!1);case F.Highlight:return this._overlayRenderer.hasHighlights?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(F.Highlight,!1)):null}return null}renderNode(e,i){switch(this._updatePatchGroups(),i.useStencil=!1,e.output){case F.Color:{const r=e.bindParameters.slot===le.OCCLUDED_TERRAIN?jr.Occluded:jr.Color;this._renderMaterialPass(e,i,r);break}case F.Depth:case F.Normal:this._renderAuxiliaryPass(e,i,jr.Color,this._visiblePatchesByOrigin);break;case F.Highlight:this._renderAuxiliaryPass(e,i,jr.Highlight,this._visiblePatchesByOrigin);break;case F.Shadow:case F.ShadowExcludeHighlight:this._renderAuxiliaryPass(e,i,null,this._allPatchesByOrigin);break;case F.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,i,jr.ObjectAndLayerIdColor,this._visiblePatchesByOrigin)}}updateTileBackground(e){if(this._tileRenderer==null)return;const i=this._tileRenderer;let r;if(e!=null){const n=Pe.toUnitRGBA(e);r=Oe(n[0]||0,n[1]||0,n[2]||0)}i.setBackground(r),this._allTiles.forAll(n=>i.updateTileTexture(n,Rs.FADING)),this._techniqueConfiguration.tileBlendInput=i.backgroundIsGrid?um.GridComposite:i.backgroundColor!=null?um.ColorComposite:um.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchesByOriginDirty&&(this._rebuildPatchGroups(),this._patchesByOriginDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==fC.NONE){const e=Array.from(this._visiblePatchesByOrigin.values()),i=this._stencilEnabledLayerExtents;for(const r of e)hRe(this.renderOrder,r,i);e.sort((r,n)=>dRe(r[0],n[0],this.renderOrder)),this._visiblePatchesByOrigin=new Map(e.map(r=>[r[0].renderData.localOrigin,r])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){const e=this._rootTiles;if(e!=null){e[0]?.surface.checkAllTilesWaterproofness(),this._visiblePatchesByOrigin.clear(),this._allPatchesByOrigin.clear();for(const i of e)this._rebuildPatchGroupsForRootTile(i)}}_rebuildPatchGroupsForRootTile(e){const i=this._tileIterator;for(i.resetOne(e);!i.done;){const r=i.next(),n=r.renderData;if(!n){this._numTilesCulled++;continue}const s=n.localOrigin;if(this._castShadows){let a=this._allPatchesByOrigin.get(s);a||(a=new Array,this._allPatchesByOrigin.set(s,a)),a.push(r)}if(!r.visible){this._numTilesCulled++,i.skipSubtree();continue}let o=this._visiblePatchesByOrigin.get(s);o||(o=new Array,this._visiblePatchesByOrigin.set(s,o)),o.push(r),i.skipSubtree()}}_useStencilForTile(e){for(const i of this._stencilEnabledLayerExtents)if(e.intersectsExtent(i))return!0;return!1}_renderAuxiliaryPass(e,i,r,n){const s=e.rctx;this._passParameters.overlayContent=r,s.bindTechnique(i,this._passParameters,e.bindParameters);const o=this._stencilEnabledLayerExtents.length>0;n.forEach(a=>{const l=a[0].renderData.localOrigin;i.program.bindDraw(new fW(l),e.bindParameters,this._passParameters);for(let c=0;c<a.length;c++)this._renderPatch(e,i,a[c],ci.TRIANGLES,o,r)}),e.rctx.bindVAO(null)}_renderMaterialPass(e,i,r){const{rctx:n}=e;this._passParameters.overlayContent=r,n.bindTechnique(i,this._passParameters,e.bindParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0;const s=e.bindParameters.camera,o=i.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const f=O2e(this._stage.viewingMode,this._ellipsoidRadius),m=this.pointsOfInterest.centerOnSurfaceFrequent.distance;f.update({distance:m,fovY:s.fovY})}const a=this._stencilEnabledLayerExtents.length>0,l=r===jr.Occluded;l&&(o.bindTexture("tex",this._emptyTex),o.setUniform3fv("textureOpacities",vo),o.setUniform4fv("texOffsetAndScale",Wu));const c=this._tileRenderer?.backgroundColor!=null?this._tileRenderer.backgroundColor:vo;this._techniqueConfiguration.tileBlendInput===um.ColorComposite&&o.setUniform3fv("backgroundColor",c);const h=this.wireframe?ci.LINES:ci.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&o.bindTexture("texNext",this._emptyTex);const d=this._visiblePatchesByOrigin;for(const f of d.values()){const m=f[0].renderData.localOrigin;i.program.bindDraw(new fW(m),e.bindParameters,this._passParameters),this._numOriginsRendered++;for(const y of f){const _=y.renderData,v=_.textureReference;if(v!=null){if(!l){o.setUniform4fv("texOffsetAndScale",v.offsetAndScale),o.bindTexture("tex",v.texture.texture);const w=_.textureFadeFactor,x=w<1?_.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&x!=null&&w<1?(o.setUniform1f("fadeFactor",w),o.setUniform4fv("nextTexOffsetAndScale",x.offsetAndScale),o.setUniform3fv("nextTexOpacities",x.opacities),o.bindTexture("texNext",x.texture.texture)):o.setUniform1f("fadeFactor",1),_.textureIsFading&&this.setNeedsRender(),o.setUniform3fv("textureOpacities",v.opacities)}this._renderPatch(e,i,y,h,a,r),y.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,i,r,n,s,o){const a=r.renderData,l=a.vao,c=l?.indexBuffer;if(c==null)return void(Ns&&console.error("Rendered tile with no indices: ",r.lij," : ",a));const h=i.program;o==null||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(h,a.overlay),s&&(i.useStencil=this._useStencilForTile(r),e.rctx.setPipelineState(i.getPipeline()));const d=a.geometry.indexCount;e.rctx.bindVAO(l),h.assertCompatibleVertexAttributeLocations(l),e.rctx.drawElements(n,d,c.indexType,0)}_bindOverlayPatchData(e,i){e.setUniform4fv("overlayTexOffset",i.offsets),e.setUniform4fv("overlayTexScale",i.scales)}_updateTechnique(e,i){return this._techniqueConfiguration.output=e,this._techniqueConfiguration.renderOccluded=i,this._shaderTechnique=this._techniques.releaseAndAcquire(vRe,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this._tileRenderer}}};u([p({readOnly:!0})],Yd.prototype,"_isGlobal",null),u([p({value:!1})],Yd.prototype,"renderingDisabled",null),u([p({value:!0})],Yd.prototype,"visible",null),u([p()],Yd.prototype,"renderPatchBorders",null),u([p()],Yd.prototype,"visualizeNormals",null),u([p()],Yd.prototype,"cullBackFaces",null),u([p({value:fC.FRONT_TO_BACK})],Yd.prototype,"renderOrder",null),u([p()],Yd.prototype,"wireframe",null),Yd=u([M("esri.views.3d.terrain.TerrainRenderer")],Yd);const pvt=E(),fvt=E(),uS=E(),mvt=E();let gvt=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},Uf=class extends we{constructor(e){super(e)}initialize(){this.addHandles([this.layers.on("change",()=>this._update()),ne(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())]),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._waitTask=null,this.layers.destroy()}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(i=>!(!HO(i)||i.isRejected())&&!(i.isFulfilled()&&!yvt(i,this.viewSpatialReference,this.viewingMode))&&(e=i,!(i?.type==="vector-tile"||pk(i)))),e)if(e.isResolved()){const i=d8(e,this.viewSpatialReference,this.viewingMode);if(i!=null){const r=new $c(i.tileInfo);this._lockTilingScheme(r)}}else this._updateWhen(e)}_updateWhen(e){const i=e.when().catch(()=>{}).then(()=>{i!==this._waitTask||this.destroyed||this._update()});this._waitTask=i}_lockTilingScheme(e){if(this.viewingMode===Le.Global){const i=e.levels.length-1;e.spatialReference.isWebMercator?e=$c.makeWebMercatorAuxiliarySphere(i):Ev(e.spatialReference)&&(e=$c.makeGCSWithTileSize(e.spatialReference,e.pixelSize,i))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this.removeAllHandles(),this.addHandles(ne(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===Le.Global){const e=this.extentHelper.viewSpatialReference,i=Ev(e)||km(e)||Um(e);e.isWebMercator?this.tilingScheme=$c.WebMercatorAuxiliarySphere:i&&(this.tilingScheme=$c.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;e==null||Uw(e,this.extent)||(this.tilingScheme=$c.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function yvt(t,e,i){return d8(t,e,i)!=null}u([p()],Uf.prototype,"tilingScheme",void 0),u([p({readOnly:!0})],Uf.prototype,"extent",void 0),u([p({value:!1})],Uf.prototype,"tilingSchemeLocked",void 0),u([p({constructOnly:!0})],Uf.prototype,"viewSpatialReference",void 0),u([p({constructOnly:!0})],Uf.prototype,"layers",void 0),u([p({constructOnly:!0})],Uf.prototype,"extentHelper",void 0),u([p({constructOnly:!0})],Uf.prototype,"viewingMode",void 0),Uf=u([M("esri.views.3d.terrain.TilingSchemeLogic")],Uf);let _vt=class{constructor(){this.offset=Ge(),this.scale=0,this.tile=null}init(e,i,r,n){this.tile=e,this.offset[0]=i,this.offset[1]=r,this.scale=n}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}};var R4;let jt=R4=class extends Sn.EventedMixin(we){constructor(t){super(t),this._scaleRangeQueries=new A4,this._iteratorPool=new $a(uRe,e=>e.remove=()=>this._iteratorPool.release(e)),this._postorderIterator=new Lyt,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._usedMemory=null,this._performanceInfo=new gvt,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=E(),this._eyePosSurfaceSR=E(),this._splitLimits=new Wd,this._frustum=SP(),this._viewProjectionMatrix=be(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._watchUpdatingTracking=new Cp,this._frameTask=zE,this._allTiles=new Ut,this._upsampleInfoPool=new $a(_vt),this._shouldEmitChangeEvent=!1,this._rootTilesExtent=Zt(),this.updatingProgress=.5,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=ze.WebMercator,this.visibleElevationBounds=new U2(1/0,-1/0),this.rootTileElevationBounds=new U2(1/0,-1/0),this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._isWebMercator=!1,this._isWebMercatorOnPlateeCarree=!1,this.overlayManager=new Il({...t,surface:this}),this._isGlobal=!t.view?.state?.isLocal,this._tileConstructor=this._isGlobal?G0t:z0t}initialize(){const t=this.view,e=t.resourceController;this._lercDecoder=lyt(e);const i=e.memoryController;this._tileCache=new DM((l,c)=>i.newCache(l,c),"terrain-tile"),this._upsampleMapCache=i.newCache("terrain-upsample",l=>l.unloadMapData()),this._elevationQueryCache=new oyt(i.newCache("elevation-query"));const r=this.overlayManager;this._renderer=new Yd(r.renderer,t._stage,this._allTiles,Wi(t.spatialReference).radius,i),this.addHandles([ne(()=>r.rendersOccluded,l=>this._renderer.setRenderOccludedOverlay(l)),ne(()=>r.renderer.isEmpty,()=>this._evaluateTransparency()),ne(()=>this.renderer.visible,l=>this.suspended=!l)],"overlayManager"),this.addHandles([ne(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?Rs.UNFADED:Rs.IMMEDIATE)},Ji),ne(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?Rs.UNFADED:Rs.IMMEDIATE),Ji),ne(()=>this.backgroundColor,(l,c)=>{l?.equals(c)||(this._handleLayerViewChanges(),this._renderer.updateTileBackground(l))},Zi),ne(()=>this.snapLevel,()=>this._viewChanged=!0,Zi),ne(()=>this.view.pointsOfInterest,l=>{this._renderer.pointsOfInterest=l,this._watchUpdatingTracking.removeAll(),l&&this._watchUpdatingTracking.add(()=>l.focus.renderLocation,()=>this._allTilesSorted=!1)}),ne(()=>pr.TERRAIN_TILE_TREE_SHOW_TILES,l=>{l&&!this._treeDebugger?ce(()=>import("./TerrainTileTree3DDebugger-161d9a2d.js"),["./TerrainTileTree3DDebugger-161d9a2d.js","./TileTreeDebugger-e948c757.js"],import.meta.url).then(({TerrainTileTree3DDebugger:c})=>{!this._treeDebugger&&pr.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new c({view:t}))}):l||(this._treeDebugger=$e(this._treeDebugger))},Xt)]);const{spatialReference:n}=t;this._extentHelper=Tyt(this.viewingMode,{layers:t.map.allLayers,layerViews:t.allLayerViews,viewSpatialReference:n});const s=new rP({getCollections:()=>t.defaultsFromMap?.mapCollections?.map(({layers:l})=>l),getChildrenFunction:l=>l&&"layers"in l?l.layers:null}),o=new Uf({layers:s,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:n});this._set("tilingSchemeLogic",o),this._updateTilingScheme(),this._elevationDataRequester=e.createStreamDataRequester(rm.ELEVATION),this._mapDataRequester=e.createStreamDataRequester(rm.BASEMAP);const a=e.scheduler;this._frameTask=a.registerTask(pt.TERRAIN_SURFACE,this),this.addHandles([ne(()=>this._extentHelper.stencilEnabledExtents,l=>this._renderer.setStencilEnabledLayerExtents(l),Xt),ne(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),Zi),ne(()=>this.extent,()=>this._updateRootTiles(),Xt),t.on("resize",()=>this._viewChangeUpdate()),ne(()=>{const l=t.state;return[this._lodBias,this.lodSnapping,t.quality,l.camera,l.contentCamera,l.fixedContentCamera]},()=>this._viewChangeUpdate(),Ji),ne(()=>t.qualitySettings?.tiledSurface?.textureFadeDuration,l=>this._renderer.textureFadingEnabled=l>0,Xt),ne(()=>t.qualitySettings?.physicallyBasedRenderingEnabled,l=>this._renderer.pbrMode=l?ot.Terrain:ot.Disabled,Xt),ne(()=>this._userClippingExtent,()=>this._updateClippingExtent(),Zi)]),this.addHandles(t.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges(),this._renderer.updateTileBackground(this.backgroundColor)}destroy(){this._frameTask.remove(),this._watchUpdatingTracking.destroy(),this._lercDecoder=li(this._lercDecoder),this._removeAllTiles(),this._set("tilingSchemeLogic",$e(this.tilingSchemeLogic)),this._basemapLayerViewHandles.forEach((t,e)=>this._unregisterTiledLayerView(e)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",$e(this.overlayManager)),this._tileCache=$e(this._tileCache),Lee.prune(),this._treeDebugger=$e(this._treeDebugger),this._renderer=$e(this._renderer),this._iteratorPool=$e(this._iteratorPool),this._upsampleMapCache=$e(this._upsampleMapCache),this._elevationQueryCache=$e(this._elevationQueryCache),this._set("view",null),this._extentHelper=$e(this._extentHelper),this._upsampleInfoPool=$e(this._upsampleInfoPool),_yt(),c0t()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){if(this.lodSnapping===bR.ON){const t=this.view,e=this.tilingScheme,i=t.pointsOfInterest?.cameraOnSurface?.scale;if(e&&i){const r=t.state.contentCamera;let n=mU(t,r.eye,r.viewForward,r.up).tilt;n>90&&(n=180-n);const s=2*(n/90)**2,o=e.levelAtScale(i)-s,a=Math.min(o+t.qualitySettings.tiledSurface.lodBias,this._splitLimits.maxLod||1/0);return a<=0?null:a}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?bR.ON:bR.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:t}=this,{clippingArea:e}=this.view;if(e==null||t==null)return null;const i=Zt(),r=UOe(e,i,t)?i:null,n=this._get("extent");return Uw(r,n)?n:r}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const t=X7(this.groundExtent,this._userClippingExtent,Zt()),e=this._get("extent");return Uw(t,e)?e:t}get groundExtent(){return this._tilingSchemeExtent!=null?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){return this.tilingSchemeLogic?.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||this._watchUpdatingTracking?.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||this.overlayManager?.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){return this.view?.map?.ground?.opacity??1}set baseOpacity(t){this.view.map.ground.opacity=t}get viewingMode(){return this.view.state.viewingMode}get ready(){return this._rootTiles!=null}set renderOrder(t){this._renderer.renderOrder=t,this._set("renderOrder",t)}get rootTiles(){return this._rootTiles}get spatialReference(){return this.tilingScheme?.spatialReference??null}get backgroundColor(){return this.view?.map?.ground?.surfaceColor}set backgroundColor(t){this.view.map.ground.surfaceColor=t}set slicePlaneEnabled(t){this._renderer.slicePlaneEnabled=t,this._set("slicePlaneEnabled",t),this._evaluateTransparency()}get tilingSchemeLocked(){return this.tilingSchemeLogic?.tilingSchemeLocked??!1}get wireframe(){return this._renderer?.wireframe}set wireframe(t){t!==this._renderer.wireframe&&(this._renderer.wireframe=t,this._updateAllTileGeometries())}get opaque(){return this._renderer.transparency===ll.Opaque}set suspended(t){this._set("suspended",t),this._viewChangeUpdate()}get textureFadeDuration(){return this.view.qualitySettings.tiledSurface.textureFadeDuration??0}intersect(t,e,i,r){this._renderer.intersect(t,e,i,r)}getElevation(t,e,i,r){const n=this._rootTiles;if(!n?.length||n[0].layerInfo[Yt.ELEVATION].length===0)return null;const s=Ol;return s[0]=t,s[1]=e,s[2]=i,ua(s,r,s,this._spatialReference)?Tde(n,s[0],s[1]):(K.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null)}getElevations(t,e,i){const r=this._rootTiles,n=r?r[0].layerInfo[Yt.ELEVATION].length:0;if(r?.length&&n!==0)for(let s=0;s<e;++s){const o=3*s;i(s,Tde(r,t[o],t[o+1]))}else for(let s=0;s<e;++s)i(s,null)}getScale(t){if(!this.tilingScheme)return null;if(!Wc(t,Ol,this.spatialReference))return K.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const e=this._rootTiles;if(e!=null){for(const i of e)if(i?.containsPoint(Ol)){let r=i;for(;r.children[0]&&!r.rendered;){const n=r.children[0].extent;let s=0;Ol[0]>n[2]&&(s+=1),Ol[1]<n[1]&&(s+=2),r=r.children[s]}return this._getLodBiasCorrectedScale(r.level)}}return 1/0}getSphereElevationBounds(t,e){if(Ol[0]=t[0],Ol[1]=t[1],Ol[2]=t[2],Ol[3]=t[3],!ua(Ol,e,Ol,this.tilingScheme?.spatialReference))return K.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let i=1/0,r=-1/0;const n=o=>{if(o&&Zie(o.extent,Ol))if(o.isLeaf||o.rendered)i=Math.min(i,o.elevationBounds[0]),r=Math.max(r,o.elevationBounds[1]);else for(const a of o.children)n(a)},s=this._rootTiles;if(s!=null)for(const o of s)n(o);return{min:i,max:r}}getRootElevationBounds(){return{min:this.rootTileElevationBounds.min,max:this.rootTileElevationBounds.max}}getSphereScale(t,e){if(!this.tilingScheme)return null;if(!Wc(t,Ol,this.spatialReference))return K.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;Ol[3]=e;let i=null;const r=s=>{if(s&&Zie(s.extent,Ol)){const o=s.children;if(o[0]&&!s.rendered)for(const a of o)r(a);else{const a=this._getLodBiasCorrectedScale(s.level);i=i==null?a:Math.min(i,a)}}},n=this._rootTiles;if(n!=null)for(const s of n)r(s);return i}queryVisibleScaleRange(t,e,i,r){const n=e?this.tilingScheme.levelAtScale(e):0,s=i?this.tilingScheme.levelAtScale(i):1/0,o=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(t,n+o,s+o,r)}_evaluateTransparency(){const t=this.baseOpacity,e=this.overlayManager.renderer.isEmpty,i=this._renderer.transparency,r=this._allSurfaceLayersTransparent()?e?ll.Empty:ll.TransparentWithDraped:t>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?ll.Opaque:ll.Semitransparent,n=i!==r;return n&&(this._renderer.transparency=r,this.view?._stage?.renderer.setParameters({terrainTransparency:this._renderer.transparency})),n}_updateTilingScheme(){const t=this.tilingSchemeLogic.tilingScheme;if(t===this.tilingScheme)return;Wf(!!t,"tiling scheme cannot be reset to undefined"),this._isGlobal=!this.view?.state?.isLocal,this.tilingScheme&&this._removeAllTiles();const e=t?.spatialReference??ze.WebMercator;this._spatialReference=e,this._isWebMercator=!!e?.isWebMercator,this._isWebMercatorOnPlateeCarree=this._isWebMercator&&nZ(this.view?.renderSpatialReference),this._set("tilingScheme",t),this._updateClippingExtent(),t&&(this._updateTiledLayers(),this._renderer.setTileSize(t.pixelSize),this.overlayManager.setSpatialReference(t.spatialReference),this._updateRootTiles())}_acquireTile(t,e,i,r){const n=this._tileCache.pop(R4._tileMemcacheKey);return n?(n.init(t,e,i,r,this),n):new this._tileConstructor(t,e,i,r,this)}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:t,tilingScheme:e}=this;if(!e)return;const i=wvt;let r=e.rootTilesInExtent(t,i,5*O2);if(this._rootTiles!=null){if(r.length>O2)return void K.getLogger(this).warn(Dqe);const n=this._rootTiles.map(o=>o.lij),s=WIe(n,r,xde);if(this._updatingRootTiles=!0,s.removed.length>0||s.added.length>0){const o=this._rootTiles.filter(a=>!(s.removed.findIndex(l=>xde(l,a.lij))>-1)||(this._purgeTile(a),!1));s.added.forEach(a=>o.push(this._newRootTile(a))),this._setRootTiles(o)}}else this._updatingRootTiles=!0,r.length>O2&&(K.getLogger(this).warn(Nqe),r=e.rootTilesInExtent(t,i,O2)),this._setRootTiles(r.map(n=>this._newRootTile(n)));Uw(i,this._rootTilesExtent)||(this._rootTilesExtent=Zt(i)),this.renderer.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const t=this._allTiles.filter(e=>e.isLoaded&&e.intersectsClippingArea);t.forEach(e=>this._renderer.updateTileGeometryState(e)),t.forEach(e=>e.renderData.updateNeighborData()),this._updateTilesGeometries(t),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(t){if(t.length===0)return;t.sort(yy);const e=this.renderer;t.forEach(i=>e.updateGeometryIfNeeded(i)),t.forEach(i=>this._pendingTilesForElevationUpdateEvent.add(i))}_shouldSplit(t){return t.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===bt.SPLIT}_newRootTile(t){const e=this._acquireTile(0,t[1],t[2],null);return this._shouldSplit(e)&&e.setPendingUpdate(bt.SPLIT),this._loadTile(e),this._markTileToUpdate(e),this._updateRootTileElevationBounds(),e}_setRootTiles(t){if(this._rootTiles=t,this._allTiles.clear(),t!=null){const e=this._iteratorPool.acquire();for(e.reset(t);!e.done;)this._allTiles.push(e.next());e.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(t)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this.renderer.visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(t){t.updateClippingStatus(this.extent)&&t.resetPendingUpdate(bt.GEOMETRY)&&this._updateTileGeometryState(t)}_updateTilesVisibility(t){if(t==null)return;const e=Byt(t),i=this.visibleElevationBounds;let r=e?i.min:1/0,n=e?i.max:-1/0;const s=this.extent,o=this._viewProjectionMatrix;this.setTileTreeDirty();const a=this._iteratorPool.acquire();for(a.reset(t);!a.done;){const l=a.next();l.updateClippingStatus(s)&&l.resetPendingUpdate(bt.GEOMETRY)&&this._updateTileGeometryState(l),l.setPendingUpdate(bt.RENDERDATA),l.computeVisibility(),l.updateScreenDepth(o),l.renderData&&(r=Math.min(l.elevationBounds[0],r),n=Math.max(l.elevationBounds[1],n))}a.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._updatePendingTileGeometries(),isFinite(r)&&isFinite(n)&&(i.min!==r||i.max!==n)&&(this.visibleElevationBounds=new U2(r,n))}_updateRootTileElevationBounds(){let t=1/0,e=-1/0;const i=this._rootTiles;i?.forEach(({elevationBounds:n})=>{t=Math.min(t,n[0]),e=Math.max(e,n[1])});const r=this.rootTileElevationBounds;r.min===t&&r.max===e||(this.rootTileElevationBounds=new U2(t,e))}_updateViewDependentParameters(){const{camera:t,contentCamera:e}=this.view.state,i=Math.tan(.5*e.fovX),r=Math.tan(.5*e.fovY),n=this.tilingScheme.pixelSize,s=2**-this._lodBias*t.pixelRatio;this._splitLimits.aboveGround=t.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=r,this._splitLimits.relativeWidthLimit=n/t.width*this.maxTextureScale*s,this._splitLimits.relativeHeightLimit=n/t.height*this.maxTextureScale*s,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?this._splitLimits.frustum=wF(this._splitLimits.frustum??SP(),e.frustum):this._splitLimits.frustum=null,wF(this._frustum,t.frustum),qi(this._viewProjectionMatrix,e.projectionMatrix,e.viewMatrix),oe(this._eyePosRenderSR,e.eye),ua(t.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(t){t.rendered&&!t.shouldLoad&&(iPe(t)?this._loadChildren(t):bvt(t)&&this._loadParent(t))}_updateTileGeometryState(t){t.updateVisibility(),this._renderer.updateTileGeometryState(t)&&this._markTileToUpdate(t),this._usedMemory=null}_markAllTileNeighborsForGeometryUpdate(t){t.forEachLoadedNeighbor(e=>this._pendingTilesToUpdate.add(e))}_updateTileTexture(t,e){const i=t.resetPendingUpdate(bt.TEXTURE_FADING)?bt.TEXTURE_FADING:!!t.resetPendingUpdate(bt.TEXTURE_NOFADING)&&bt.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(t,i),this._usedMemory=null,e.madeProgress())}_emitElevationUpdateEventForTiles(){if(!this._shouldEmitChangeEvent)return;const t=QB.extent;id(t),this._pendingTilesForElevationUpdateEvent.forEach(e=>lv(t,e.extent,t)),this._pendingTilesForElevationUpdateEvent.clear(),QB.spatialReference=this.spatialReference,this.emit("elevation-change",QB),this._shouldEmitChangeEvent=!1}runTask(t){this._handleLayerViewChanges(t),this._frameTask.processQueue(t),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,t),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(t),this._sortTiles(t);const e=!this.view.state.fixedContentCamera;this._mergeAndSplit(t,e),this._updateElevation(t),this._updateTextures(t),e||this._mergeAndSplit(t,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._updatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),t.done&&t.hasProgressed&&this.requestUpdate(),this.notifyChange("updatingProgressValue")}_updateAllTilesStatus(t){if(!this._viewChanged||!this._rootTiles||t.done)return;this._viewChanged=!1;const e=this._iteratorPool.acquire();e.reset(this._rootTiles);const i=this.snapLevel,r=this._splitLimits,n=this._eyePosRenderSR;for(;!e.done;){const s=e.next(),o=s.shouldSplit(r,n,i);if(o!==bt.SPLIT){if(s.resetPendingUpdate(bt.SPLIT)&&s.updateAgentSuspension(),o===bt.ELEVATION&&s.updateAgents(Yt.ELEVATION),e.skipSubtree(),!s.isLeaf){s.setPendingUpdate(bt.MERGE),s.resetPendingUpdate(bt.SPLIT);const a=this._iteratorPool.acquire();a.resetOne(s);const l=this._viewProjectionMatrix;for(let c=a.next();!a.done;c=a.next())this._updateClippingStatus(c),c.updateVisibility(),c.updateScreenDepth(l);a.remove()}}else s.resetPendingUpdate(bt.MERGE),s.isLeaf&&(s.setPendingUpdate(bt.SPLIT),e.skipSubtree()),s.rendered&&s.setPendingUpdate(bt.RENDERDATA)}e.remove(),this.requestUpdate(),(this._shortBatches||!this._oneBatchPerFrameTask)&&this._updatePendingTileGeometries(),t.madeProgress()}_sortTiles(t){t.done||this._allTilesSorted||(Uyt(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),t.madeProgress())}_markTileToUpdate(t){Se(t.isLoaded),t.intersectsClippingArea&&(this._pendingTilesToUpdate.add(t),this._markAllTileNeighborsForGeometryUpdate(t))}_updatePendingTileGeometries(){const t=this._pendingTilesToUpdate,e=Array.from(t.keys()).filter(n=>n.isLoaded&&n.intersectsClippingArea);if(e.length===0)return void t.clear();const i=(n,s)=>{!s?.isLoaded||!s.intersectsClippingArea||s.level<n.level||t.has(s)||(t.add(s),e.push(s),s.renderData.updateNeighborData())};e.sort(yy);const r=e.length;for(let n=0;n<r;++n){const s=e[n];Se(s.isLoaded),Se(s.intersectsClippingArea);const o=s.renderData;o.updateNeighborData();const a=o._dirtyEdgeResolutions,l=o.geometryState.neighborData.cornerPeerNeighbors,c=h=>{const d=mk[h];i(s,l[h]?.findCorner(fk(d),f=>f.isLoaded))};for(let h=0;h<4;++h)if(a&1<<h){const d=o.geometryState.neighborData.edgePeerNeighbors[h];d&&d?.level>=s.level&&d.forAllSubtreeOnSide(Mee(sy[h]),f=>!(!f.isLoaded||!f.intersectsClippingArea)&&(Se(t.has(f)||yy(s,f)<0),i(s,f),!0)),c((h+1)%4),c(h)}}t.clear(),this._updateTilesGeometries(e),this._shouldEmitChangeEvent=!0,Ns&&dk&&this.checkAllTilesWaterproofness()}_mergeAndSplit(t,e){if(this.suspended||t.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let i=!1;const r=this.view.state.fixedContentCamera;let n=!1;for(;!t.done;){n=!0;let s=!1;const o=!this._allTiles.some(a=>{if(!i&&!r&&!a.visible)return t.done;let l=a;if(a.resetPendingUpdate(bt.MERGE)){if(!e)return a.setPendingUpdate(bt.MERGE),t.done;for(;l.parent?.resetPendingUpdate(bt.MERGE);)l=l.parent;this._mergeTile(l),s=!0,t.madeProgress()}else a.resetPendingUpdate(bt.SPLIT)&&(this._splitTile(a),s=!0,t.madeProgress());return!t.done&&l===a&&a.resetPendingUpdate(bt.RENDERDATA)&&(this._updateRenderData(a),t.madeProgress()),t.done});if(s&&(this._allTilesSorted=!1,this._allTilesDirty=!0),o){if(!i){i=!0;continue}if(!s)break}else this._allTilesDirty=!0}n?t.madeProgress():this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries(),this._sortTiles(t)}_updateElevation(t){t.done||(this._allTiles.some(e=>(e.resetPendingUpdate(bt.GEOMETRY)&&(this._updateTileGeometryState(e),this._updateTileTexture(e,t),this._shortBatches&&this._updatePendingTileGeometries(),t.madeProgress()),t.done)),!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries())}_updateTextures(t){t.done||this._allTiles.some(e=>(this._updateTileTexture(e,t),t.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(Ln.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const t=this.view.quality;return this.view.qualitySettings.tiledSurface.lodBias-(1-t)*Iqe}_getLodBiasCorrectedScale(t){const e=this.tilingScheme.levels,i=_e(t-this._lodBias,0,e.length-1),r=i-Math.floor(i);return e[Math.floor(i)].scale*(1-r)+e[Math.ceil(i)].scale*r}_removeAllTiles(){this._rootTiles!=null&&(this._rootTiles.forEach(t=>this._purgeTile(t)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.renderer.visible=!1}_purgeDescendantTiles(t){if(!t.children[0])return!1;let e=!1;for(let i=0;i<4;++i)e=this._purgeTile(t.children[i])||e;return t.unsetChildren(),e}_purgeTile(t){const e=this._purgeDescendantTiles(t)||t.rendered;return this._allTiles.removeUnordered(t),this._unloadTile(t),this._tileCache.put(R4._tileMemcacheKey,t),e}_unloadTile(t){this._pendingTilesToUpdate.delete(t),this._pendingTilesForElevationUpdateEvent.delete(t),t.unload(this._renderer)}_splitTile(t){Wf(t.isLeaf,"tile that is already split should not be split again!");const e=t.level+1,i=2*t.lij[1],r=2*t.lij[2];t.setChildren(this._createTile(e,i,r,t),this._createTile(e,i,r+1,t),this._createTile(e,i+1,r,t),this._createTile(e,i+1,r+1,t)),t.setPendingUpdate(bt.RENDERDATA),t.updateAgentSuspension(),this._allTiles.pushArray(t.children),this._allTilesDirty=!0,++this._performanceInfo.numSplit}_emitTileScaleChange(t,e=t.level){rD.spatialReference=this.spatialReference,rD.extent=t.extent,rD.scale=this._getLodBiasCorrectedScale(e),this.emit("scale-change",rD)}_createTile(t,e,i,r){Wf(!!r,"_createTile sanity check");const n=this._acquireTile(t,e,i,r);return n.updateClippingStatus(this.extent),n.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(n)&&n.setPendingUpdate(bt.SPLIT),n}get _shortBatches(){return this.view.state.mode!==Li.IDLE}_mergeTile(t){Wf(!t.hasPendingUpdate(bt.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(t)&&(Wf(!t.renderData,"_mergeTile sanity check"),this._loadTile(t),this._markTileToUpdate(t),this._emitTileScaleChange(t),this._shortBatches&&this._updatePendingTileGeometries()),this._allTilesDirty=!0,++this._performanceInfo.numMerged}_loadChildren(t){Wf(t.rendered,"parent should be rendered"),this._unloadTile(t);const e=t.children;e.forEach(i=>this._loadTile(i)),e.forEach(i=>this._pendingTilesToUpdate.add(i)),this._markAllTileNeighborsForGeometryUpdate(t),this._emitTileScaleChange(t,t.level+1),this._shortBatches&&this._updatePendingTileGeometries()}_loadParent(t){const e=t.parent;this._unloadChildren(e),this._loadTile(e),this._markTileToUpdate(e),this._emitTileScaleChange(e,e.level),this._shortBatches&&this._updatePendingTileGeometries()}_unloadChildren(t){const e=t.children;if(e[0])for(let i=0;i<4;++i){const r=e[i];this._unloadChildren(r),this._unloadTile(r)}}_loadTile(t){t.load(),t.setPendingUpdate(bt.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(t)}_elevationDataArrived(t,e,i){const r=new wyt(t.lij,t.extent,i);t.dataArrived(e,Yt.ELEVATION,r);const n=[t],s=t.level,o=this._iteratorPool.acquire();for(o.reset(n);!o.done;){const a=o.next();a.findElevationBoundsForLayer(e,s),a.computeElevationBounds()}s===0&&this._updateRootTileElevationBounds(),o.remove(),this._updateTilesVisibility(n)}_handleLayerViewChanges(t=hl){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let e=!1;const i=new Set;let r=-1;for(const n of this.view.allLayerViews.items)if(i.add(n.uid),GP(n)||HA(n))if(this._basemapLayerViewHandles.has(n.uid)&&!HA(n)){const s=this._layerClassFromLayerView(n),o=this._getLayerIdxByUID(s,n.uid);o!=null&&((o<r||r==null)&&(e=!0),r=o)}else this._registerTiledLayerView(n),n.layer.loaded&&(e=!0);this._basemapLayerViewHandles.forEach((n,s)=>{i.has(s)||(this._unregisterTiledLayerView(s),e=!0)}),e&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),t.madeProgress()}_allSurfaceLayersTransparent(){let t=this.view.map?.ground?.opacity===0;for(const e of this.view.allLayerViews.items)if(DW(e)&&!XD(e.layer)&&e.fullOpacity!==0)return t=!1,t;return t}_hasCompositeBlendMode(){for(const t of this.view.allLayerViews.items)if((VP(t)||HA(t))&&Wyt(kW[t.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(t){return LW(t)?Yt.ELEVATION:Yt.MAP}_registerTiledLayerView(t){const e=[];if((VP(t)||HA(t))&&e.push(ne(()=>t.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(Rs.UNFADED)})),!HA(t)){const i=this._layerClassFromLayerView(t);e.push(ne(()=>t.suspended,()=>this._updateTiledLayers())),e.push(ne(()=>t.fullOpacity,()=>this._updateTileTextures(Rs.UNFADED))),e.push(ne(()=>"effectiveScaleRange"in t.layer?t.layer.effectiveScaleRange:null,()=>this._restartAllAgents(i))),e.push(t.on("data-changed",()=>{const r=this._getLayerIdxByUID(i,t.uid);r!=null&&this._invalidateLayerData(r,i)}))}this._unregisterTiledLayerView(t.uid),this._basemapLayerViewHandles.set(t.uid,e)}_unregisterTiledLayerView(t){const e=this._basemapLayerViewHandles.get(t);if(e){for(const i of e)i.remove();this._basemapLayerViewHandles.delete(t)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const t=this.view.allLayerViews,e=[[],[]];let i=null;t.forEach(r=>{if(!r.layer||r.suspended||!GP(r)||!r.fullExtent)return;const n=this._layerClassFromLayerView(r);if(n===Yt.MAP){const s=r.displayLevelRange.maxLevel;s!==1/0&&(i===null||s>i)&&(i=s)}e[n].push(r)});for(const r of Vb){const n=this._layerViews[r],s=e[r];s.reverse();const o=s.length;let a=n.length!==o;const l=new Array(o),c=new Array(n.length);this._layerIndexByUid[r].clear();for(let h=0;h<o;h++){const d=s[h].uid;this._layerIndexByUid[r].set(d,h);const f=n.indexOf(s[h]);l[h]=f,h!==f&&(a=!0),f>-1&&(c[f]=h)}if(a){const h=this._postorderIterator;for(h.reset(this._rootTiles);!h.done;)h.next().modifyLayers(c,l,r);this._layerViews[r]=s,this._restartAllAgents(r),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&this._viewChangeUpdate()}_restartAllAgents(t){const e=this._postorderIterator;for(e.reset(this._rootTiles);!e.done;){const i=e.next();i.restartAgents(t),t===Yt.ELEVATION&&i.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(t,e){return this._layerViews[e][t]}numLayers(t){return this._layerViews[t].length}_updateTileTextures(t){this._allTiles.forAll(e=>{e.updateAgents(Yt.MAP),t===Rs.IMMEDIATE?this.renderer.updateTileTexture(e,bt.TEXTURE_NOFADING):e.updateRenderData(Yt.MAP,t)}),this._evaluateTransparency()}_invalidateLayerData(t,e){this._allTiles.forAll(i=>i.removeLayerAgent(t,e)),this._allTiles.forAll(i=>i.invalidateLayerData(t,e))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(t=Ln.UPDATE){this.renderer.setNeedsRender(t)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(t,e,i,r){const n=this.layerViewByIndex(e,i),s=n.layer;return!s.tilemapCache||pC(n)?this._requestTileData(t,i,n,r):(++this._asyncWorkItems,s.tilemapCache.fetchAvailability(t.lij[0],t.lij[1],t.lij[2],{...r,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(o=>{throw--this._asyncWorkItems,Tt(r),Tn(o)||this._dataMissing(t,i,n,{notInTilemap:!0}),o}).then(()=>this._frameTask.schedule(()=>this._requestTileData(t,i,n,r),r.signal)))}_requestTileData(t,e,i,r){return e===Yt.ELEVATION?LW(i)?this._requestElevationTileData(t,i,r):Promise.reject():DW(i)?this._requestMapTileData(t,i,r):Promise.reject()}_requestElevationTileData(t,e,i){++this._asyncWorkItems;const r=o=>{if(ps(i))return;const a=this._layerIndexByUid[Yt.ELEVATION].get(e.uid);a!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(t,a,o)):K.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",Yt.ELEVATION,t.lij.toString())},n=o=>{Tn(o)||(this._dataMissing(t,Yt.ELEVATION,e,o),this.requestUpdate())};if(Lue(e.layer))return e.layer.fetchTile(t.lij[0],t.lij[1],t.lij[2],{noDataValue:vP,signal:i.signal}).then(o=>{if(!ps(i))return this._frameTask.schedule(()=>r(o),i.signal,n);K.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},n).finally(()=>{--this._asyncWorkItems});const s=e.getTileUrl(t.lij[0],t.lij[1],t.lij[2]);return this._elevationDataRequester.request(s,"binary",i).then(o=>this._lercDecoder.decode(o,{noDataValue:vP},i.signal)).then(o=>{o?r(new ayt(o)):n(new Error("LERC decoding failed"))},n).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(t,e,i){++this._asyncWorkItems;const r=(c,h)=>{--this._asyncWorkItems,hE(h),ps(i)||(this._dataMissing(t,Yt.MAP,e,c),this.requestUpdate())},n=c=>h=>r(h,c),s=c=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),ps(i)?hE(c):this._mapTileDataArrived(t,e,c)},i.signal,n(c)).catch(n(c)),o=(c,h=null)=>this._frameTask.schedule(()=>r(c,h));if(pC(e)){const c=e.schemaHelper.getLevelRowColumn(t.lij);return e.fetchTile(c[0],c[1],c[2],i).then(s,o)}if(h8(e))return e.fetchTile(t.lij[0],t.lij[1],t.lij[2],i).then(s,o);if(Ree(e)&&Lue(e.layer))return e.layer.fetchTile(t.lij[0],t.lij[1],t.lij[2],i).then(c=>{if(ps(i))return K.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void o(Ti());s(c)},o);let a=e.getTileUrl(t.lij[0],t.lij[1],t.lij[2]);nyt(e.layer)&&e.layer.refreshTimestamp&&(a+=`${a.includes("?")?"&":"?"}_ts=${e.layer.refreshTimestamp}`);const l=e.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(a,l,i).then(s,o)}_mapTileDataArrived(t,e,i){const r=this._getLayerIdxByUID(Yt.MAP,e.uid);r!=null?t.dataArrived(r,Yt.MAP,i):(hE(i),K.getLogger(this).warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(t,e){return this._layerIndexByUid[t].get(e)}_dataMissing(t,e,i,r){const n=this._getLayerIdxByUID(e,i.uid);n!=null?t.dataMissing(n,e,r):K.getLogger(this).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(t){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(e=>{e.renderData&&this.overlayManager.setTileParameters(e)}),this._renderer.setNeedsRender(t))}get performanceInfo(){const t=this._performanceInfo;return t.numNodes=this._allTiles.length,t.numLeaves=t.numVisible=t.numRendered=t.numLoadedPerLevel.length=t.numRenderedPerLevel.length=0,this._allTiles.forAll(e=>{e.isLeaf&&t.numLeaves++;const i=e.level;e.renderData&&(t.numLoadedPerLevel[i]=(t.numLoadedPerLevel[i]||0)+1),e.visible&&(t.numVisible++,e.rendered&&(t.numRenderedPerLevel[i]=(t.numRenderedPerLevel[i]||0)+1,t.numRendered++))}),t}get usedMemory(){return this.tilingScheme?(this._usedMemory==null&&(this._usedMemory=this._recalculateUsedMemory()),this._usedMemory??0):0}_recalculateUsedMemory(){return this.tilingScheme?Math.round(this._allTiles.reduce((t,e)=>t+e.usedMemory,0)):null}getUsedMemoryForLayerView(t){let e=0;const i=this._layerClassFromLayerView(t),r=this._getLayerIdxByUID(i,t.uid);return r!=null&&this._allTiles.forAll(n=>e+=n.getUsedMemoryForLayer(i,r)),e}getTile(t){if(t==null||this._rootTiles==null)return null;const e=t.split("/").map(o=>+o);if(e[0]===0)return this._rootTiles.find(o=>o.lij[1]===e[1]&&o.lij[2]===e[2]);const i=2**e[0],r=Math.floor(e[1]/i),n=Math.floor(e[2]/i);let s;if(this._rootTiles.some(o=>o.lij[1]===r&&o.lij[2]===n&&(s=o,!0)),s){let o=1<<e[0]-1;for(;s.lij[0]<e[0];){let a=e[1]&o?2:0;if((e[2]&o)>0&&a++,!s.children[a])return null;s=s.children[a],o>>=1}return Wf(s.lij[0]===e[0]&&s.lij[1]===e[1]&&s.lij[2]===e[2],"not the right tile?"),s}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(t){this._renderer.renderPatchBorders=t}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(t){this._renderer.visualizeNormals=t}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(t){this._renderer.renderingDisabled=t}get test(){const t=this;return{renderer:t._renderer,lercDecoder:t._lercDecoder,forceReload:()=>{t._rootTiles!=null&&t._rootTiles.length>0&&(t._mergeTile(t._rootTiles[0]),t._viewChangeUpdate())},getTiles:()=>t._allTiles.toArray(),getRenderedTiles(){KB.clear(),t._allTiles.forAll(i=>{i.visible&&i.rendered&&KB.push(i)});const e=KB.toArray();return hRe(t.renderOrder,e),e},lockTilingScheme(e,i){t._extentHelper.defaultTiledLayersExtent=i,t.tilingSchemeLogic.test.lockTilingScheme(e)}}}checkAllTilesWaterproofness(){if(!dk)return;const t=this._rootTiles;if(t==null)return;const e=s=>s?.renderData?.geometry?.indices?.length>0,i=(s,o)=>{e(s)&&console.error("Tile[",s.lij,"] has geometry although parent[",o.lij,"] has geom")},r=s=>{if(s.intersectsClippingArea)if(s.renderData&&!s.renderData.geometryState&&console.error("Tile[",s.lij,"] has renderData but not geometryState"),s.renderData&&!s.renderData.geometry&&console.error("Tile[",s.lij,"] has renderData but not geometryInfo"),!s.renderData?.geometry||(s.renderData.geometry.indices?.length??0)>0||console.error("Tile[",s.lij,"] has renderData but no indices - geometryInfo: ",s.renderData.geometry),e(s)){s.checkGeometryWaterproofness();for(const o of s.children)i(o,s)}else if(s.isLeaf)console.error("Tile[",s.lij,"] has no geometry and no children, from root to leaf");else for(const o of s.children)r(o)},n=s=>{const o=s.parent?.visible??!0,a=s.visible;s.computeVisibility();const l=s.visible;if(a!==l&&o&&console.error(" Tile[",s.lij,"] has out of date visibility: ",a," instead of ",l),!s.isLeaf)for(const c of s.children)n(c)};for(const s of t)r(s),n(s)}get isGlobal(){return this._isGlobal}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateeCarree(){return this._isWebMercatorOnPlateeCarree}isEastEndWrap(t){return this.isGlobal&&t[2]===this.lijEastEnd(t[0])-1}isWestEndWrap(t){return this.isGlobal&&t[2]===0}lijEastEnd(t){return 2**(t+(this.spatialReference!=null&&this.spatialReference.isGeographic?1:0))}wrapEastWest(t){const e=this.lijEastEnd(t[0]),i=t[2];if(0<=i&&i<e)return t;if(!this.isGlobal)return null;const r=(i+(i<0?e:0))%e;return[t[0],t[1],r]}enableInternalChecks(t){Tgt(t)}enableWaterproofnessChecks(t){xgt(t)}};jt._tileMemcacheKey="TerrainTileMemcache",u([p()],jt.prototype,"_renderer",void 0),u([p({constructOnly:!0})],jt.prototype,"_scaleRangeQueries",void 0),u([p({constructOnly:!0})],jt.prototype,"view",void 0),u([p({constructOnly:!0})],jt.prototype,"overlayManager",void 0),u([p()],jt.prototype,"_hasPendingUpdates",void 0),u([p()],jt.prototype,"_asyncWorkItems",void 0),u([p()],jt.prototype,"_allTilesDirty",void 0),u([p()],jt.prototype,"_allTilesSorted",void 0),u([p()],jt.prototype,"_viewChanged",void 0),u([p()],jt.prototype,"_splitLimits",void 0),u([p({readOnly:!0})],jt.prototype,"_watchUpdatingTracking",void 0),u([p()],jt.prototype,"_frameTask",void 0),u([p({readOnly:!0})],jt.prototype,"snapLevel",null),u([p({readOnly:!0})],jt.prototype,"lodSnapping",null),u([p()],jt.prototype,"_userClippingExtent",null),u([p()],jt.prototype,"_rootTilesExtent",void 0),u([p({readOnly:!0})],jt.prototype,"extent",null),u([p({readOnly:!0})],jt.prototype,"groundExtent",null),u([p({readOnly:!0})],jt.prototype,"_tilingSchemeExtent",null),u([p({readOnly:!0})],jt.prototype,"updating",null),u([p({readOnly:!0})],jt.prototype,"running",null),u([p(vyt)],jt.prototype,"updatingProgress",void 0),u([p({readOnly:!0})],jt.prototype,"updatingProgressValue",null),u([p()],jt.prototype,"_maxNumUpdating",void 0),u([p()],jt.prototype,"baseOpacity",null),u([p()],jt.prototype,"hasCompositeBlendMode",void 0),u([p({readOnly:!0})],jt.prototype,"viewingMode",null),u([p()],jt.prototype,"maxTextureScale",void 0),u([p({readOnly:!0})],jt.prototype,"ready",null),u([p({value:fC.FRONT_TO_BACK})],jt.prototype,"renderOrder",null),u([p({readOnly:!0})],jt.prototype,"rootTiles",null),u([p()],jt.prototype,"_rootTiles",void 0),u([p({readOnly:!0})],jt.prototype,"spatialReference",null),u([p({type:Pe})],jt.prototype,"backgroundColor",null),u([p({value:!1})],jt.prototype,"slicePlaneEnabled",null),u([p({readOnly:!0})],jt.prototype,"tilingScheme",void 0),u([p({readOnly:!0})],jt.prototype,"tilingSchemeLocked",null),u([p({readOnly:!0})],jt.prototype,"tilingSchemeLogic",void 0),u([p()],jt.prototype,"wireframe",null),u([p({value:!1})],jt.prototype,"suspended",null),u([p()],jt.prototype,"textureFadeDuration",null),u([p()],jt.prototype,"visibleElevationBounds",void 0),u([p()],jt.prototype,"rootTileElevationBounds",void 0),u([p()],jt.prototype,"_layerViewsDirty",void 0),u([p()],jt.prototype,"renderPatchBorders",null),u([p()],jt.prototype,"visualizeNormals",null),u([p()],jt.prototype,"renderingDisabled",null),jt=R4=u([M("esri.views.3d.terrain.TerrainSurface")],jt);const vvt=jt;function xde(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function iPe(t){const e=t.children;if(!e[0])return!1;for(const i of e)if(i.shouldLoad)return!0;for(const i of e)if(iPe(i))return!0;return!1}function bvt(t){return t.isLeaf&&(t.parent?.shouldLoad??!1)}const Ol=oi(),wvt=Zt(),KB=new Ut,QB={spatialReference:null,extent:Zt(),context:"ground"},rD={spatialReference:null,extent:null,scale:0};function Tde(t,e,i){for(const r of t){if(!r.containsPointXY(e,i))continue;let n=r;for(;n&&!n.renderData;){const o=(e>n.extentMidX?1:0)+(i<n.extentMidY?2:0);n=n.children[o]}const s=n?.renderData?.geometryState.samplerData??null;return ln(e,i,s)}return null}let xvt=class{constructor(e,i,r,n){this.operation=e,this.geometry=i,this.states=r,this.sync=n}},_O=class extends we{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(e,i){const r=this._dirtyGeomRecords.get(e);r&&(r.forEach((n,s)=>{const o=this._ensureGeomRecord(e,s);n.forEach(({geometry:a,operation:l,states:c},h)=>{let d=!1;if(l===Zr.UPDATE){const f=o.get(h);if(f){if(c&Os.TRANSFORMATION){const m=this.model.getObject(s);this.model.updateRenderGeometryTransformation(m,a,f)&&(d=!0)}d||i.updates.push({renderGeometry:f,updateType:c})}else tt(!1,"ModelDirtySet.commitLayer: invalid update")}if(l===Zr.REMOVE||d){const f=o.get(h);f?(i.removes.push(f),o.delete(h)):l===Zr.REMOVE&&tt(!1,"ModelDirtySet.commitLayer: invalid remove")}if(l===Zr.ADD||d){const f=this.model.getObject(s);if(f!=null){const m=this.model.getRenderGeometry(f,a);i.adds.push(m),o.set(h,m)}}}),o.size===0&&this._residentGeomRecords.get(e).delete(s)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this.dirty=this._hasDirtyGeometryRecords)}commitSyncUpdates(e,i){const r=this._dirtyGeomRecords.get(e);r&&r.forEach((n,s)=>{const o=this._ensureGeomRecord(e,s);n.forEach(({geometry:a,operation:l,states:c,sync:h},d)=>{let f=!1;if(l===Zr.UPDATE&&h){const m=o.get(d);if(m){if(c&Os.TRANSFORMATION){const y=this.model.getObject(s);this.model.updateRenderGeometryTransformation(y,a,m)&&(f=!0)}f||i.updates.push({renderGeometry:m,updateType:c})}else tt(!1,"ModelDirtySet.commitSyncUpdates: invalid update")}})})}getResidentRenderGeometries(e,i){const r=this._residentGeomRecords.get(e);r&&r.forEach(n=>n.forEach(s=>i.push(s)))}_objectStateChanged(e,i){for(const r of i.geometries)this._updateOrCreateDirtyRecord(i,r,null,Zr.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(Os.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(Os.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(Os.OCCLUDEE,e)}attributesChanged({object:e,geometry:i,sync:r}){this._updateOrCreateDirtyRecord(e,i,null,Zr.UPDATE,Os.GEOMETRY,r)}layerAdded(e){e.objects.forAll(i=>this._layerObjectAdded(e,i))}layerRemoved(e){e.objects.forAll(i=>this._layerObjectRemoved(e,i))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,i){const r=e.id;for(const n of i.geometries)this._geometryAdded(i,n,r)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const i of e.objects)this._layerObjectAdded(e.layer,i)}layerObjectsRemoved(e){for(const i of e.objects)this._layerObjectRemoved(e.layer,i)}_layerObjectRemoved(e,i){const r=e.id;for(const n of i.geometries)this._geometryRemoved(i,n,r)}transformationChanged(e){const i=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(i,r).forEach(n=>{this._updateOrCreateDirtyRecord(e,n.geometry,i,Zr.UPDATE,Os.TRANSFORMATION)})}shaderTransformationChanged(e){const i=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(i,r).forEach(n=>{n.objectShaderTransformationChanged(e.shaderTransformation)})}geometryAdded(e){this._geometryAdded(e.object,e.geometry)}_geometryAdded(e,i,r=null){this._updateOrCreateDirtyRecord(e,i,r,Zr.ADD)}geometryRemoved(e){this._geometryRemoved(e.object,e.geometry)}_geometryRemoved(e,i,r=null){this._updateOrCreateDirtyRecord(e,i,r,Zr.REMOVE)}_updateOrCreateDirtyRecord(e,i,r,n,s=Os.NONE,o=!1){r=r??this._getParentLayerId(e);const a=e.id,l=i.id,c=this._ensureDirtyRecord(r,a),h=c.get(l);if(h){const d=h.operation;d===Zr.REMOVE&&n===Zr.ADD&&h.states!==Os.NONE?h.operation=Zr.UPDATE:d===Zr.REMOVE&&n===Zr.ADD||d===Zr.ADD&&n===Zr.REMOVE?c.delete(l):d!==Zr.UPDATE||n!==Zr.REMOVE&&n!==Zr.UPDATE?(tt((d===Zr.REMOVE||d===Zr.ADD)&&n===Zr.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),h.states|=s):(h.operation=n,h.states|=s),h.sync=h.sync||o}else c.set(l,new xvt(n,i,s,o));this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,i){let r=this._residentGeomRecords.get(e);r||(r=new Map,this._residentGeomRecords.set(e,r));let n=r.get(i);return n||(n=new Map,r.set(i,n)),n}get _hasDirtyGeometryRecords(){return $u(this._dirtyGeomRecords,e=>$u(e,i=>i&&i.size>0))}_ensureDirtyRecord(e,i){let r=this._dirtyGeomRecords.get(e);r||(r=new Map,this._dirtyGeomRecords.set(e,r));let n=r.get(i);return n||(n=new Map,r.set(i,n)),n}_getParentLayerId(e){return e.parentLayer?e.parentLayer.id:iDe}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let i="";return this._dirtyGeomRecords.forEach((r,n)=>{r.forEach((s,o)=>{i.length>0&&(i+=`
`),i+=n+"."+o;const a=[];s.forEach(l=>{const c=l.operation;a[c]||(a[c]=[]),a[c].push(l.geometry.id)});for(let l=0;l<a.length;l++)if(a[l]){i+=" "+e[l-1]+": ";for(let c=0;c<a[l].length;c++)i+=a[l][c]+", "}})}),i}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((i,r)=>i+r.size,0)},commit:i=>e._dirtyGeomRecords.forEach((r,n)=>e.commitLayer(n,i))}}};u([p({constructOnly:!0})],_O.prototype,"model",void 0),u([p()],_O.prototype,"dirty",void 0),_O=u([M("esri.views.3d.webgl-engine.lib.ModelDirtySet")],_O);const Tvt=_O;let P4=class extends we{constructor(){super(...arguments),this.dirtySet=new Tvt({model:this}),this._content=new Map,this._originFactory=new ZQ(null)}getObject(e){return this._content.get(e)}add(e){const i=e.id;tt(!this._content.has(i),"Model/Stage already contains object to be added"),this._content.set(i,e),JF(e)&&this.dirtySet.layerAdded(e)}remove(e){return!!this._content.has(e.id)&&(this._content.delete(e.id),JF(e)&&this.dirtySet.layerRemoved(e),!0)}addMany(e){for(const i of e)i&&(tt(!this._content.has(i.id),"Model/Stage already contains object to be added"),this._content.set(i.id,i))}removeMany(e){for(const i of e)i&&(tt(this._content.has(i.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(i.id))}has(e){return this._content.has(e.id)}forEachOfType(e,i){this._content.forEach(r=>{r.type===e&&i(r)})}getRenderGeometry(e,i){const r=new dC(i,{castShadow:e.castShadow,objectShaderTransformation:e.shaderTransformation});r.transformation=e.getCombinedStaticTransformation(i,Sde);const{localOrigin:n}=i;return r.localOrigin=n??this._originFactory.getOrigin(r.boundingSphere),r}updateRenderGeometryTransformation(e,i,r){if(e==null)return!1;r.transformation=e.getCombinedStaticTransformation(i,Sde);const n=this._originFactory.getOrigin(r.boundingSphere);return r.localOrigin!==n}getStats(){const e={},i=Array.from(this._content.values());for(let r=0;r<wn.COUNT;++r)e[r]=i.filter(n=>n.type===r).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};u([p({constructOnly:!0})],P4.prototype,"dirtySet",void 0),P4=u([M("esri.views.3d.webgl-engine.parts.Model")],P4);const Sde=be();let Svt=class{constructor(e){this._totalCount=e,this._indexRanges=[0,e]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return this._indexRanges.length===0}componentCount(){const e=this._indexRanges;let i=0;for(let r=0;r<e.length;r+=2)i+=e[r+1];return i}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=Evt(e)}forEachComponent(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const n=i[r],s=n+i[r+1];for(let o=n;o<s;o++)if(!e(o))return!1}return!0}forEachComponentRange(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const n=i[r];if(!e(n,n+i[r+1]))return!1}return!0}computeOffsetRanges(e){const i=new Array(this._indexRanges.length),r=this._indexRanges;for(let n=0;n<r.length;n+=2){const s=r[n],o=s+r[n+1],a=e[s],l=e[o];i[n]=a,i[n+1]=l-a}return i}};function Evt(t){const e=new Array;if(t.length===0)return e;let i=t[0],r=1;for(let n=1;n<t.length;n++){const s=t[n];i+r===s?r+=1:(e.push(i),e.push(r),i=s,r=1)}return e.push(i),e.push(r),e}let Cvt=class{constructor(e,i){this.offsets=i,this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null;const r=this.count;this.visibility=new Svt(r),this.materialDataBuffer=e.getBuffer(r),this.materialDataIndices=new Uint16Array(r);for(let n=0;n<r;n++)this.materialDataIndices[n]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return this.cachedGeometryRanges==null&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return this.highlightCounts==null?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return this.highlightCounts==null?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((this.cachedHighlightRanges==null||this.cachedDefaultRanges==null)&&this.highlightCounts!=null){const{highlightRanges:e,defaultRanges:i}=Avt(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=e,this.cachedDefaultRanges=i}}};function Avt(t,e,i){const r=[],n=[];let s=i.length,o=i.length;return e.forEachComponent(a=>(t[a]>0?(s!==a-1&&(r.length&&r.push(i[s+1]-r[r.length-1]),r.push(i[a])),s=a):(o!==a-1&&(n.length&&n.push(i[o+1]-n[n.length-1]),n.push(i[a])),o=a),!0)),r.length&&r.push(i[s+1]-r[r.length-1]),n.length&&n.push(i[o+1]-n[n.length-1]),{highlightRanges:r,defaultRanges:n}}let vO=class extends we{constructor(){super(...arguments),this.visible=dE.Hidden}destroy(){this.intersectionGeometry=$e(this.intersectionGeometry)}};var dE;u([p({autoDestroy:!0})],vO.prototype,"renderable",void 0),u([p({autoDestroy:!0})],vO.prototype,"components",void 0),vO=u([M("esri.views.3d.webgl-engine.collections.Component.ComponentObject")],vO),function(t){t[t.Hidden=0]="Hidden",t[t.Visible=1]="Visible"}(dE||(dE={}));function Ovt(t,e,i,r){if(i>=e)return t;t==null&&(t=Rvt());const n=t.isVisibleBit;let s=t.data;const o=nPe(s),a=i/o|0,l=i-o*a,c=(e-1)/o|0,h=s,d=r===n;if(!(i<h.length*o)&&d){const f=a+1,m=Math.ceil(h.length*e6),y=c+1;let _=Math.max(f,m);_=Math.min(_,y),s=new Uint32Array(_),s.set(h)}return a<s.length&&(s[a]=Mvt(s[a],l,d)),t.data=s,t}function rPe(t,e){if(t==null)return!0;const{isVisibleBit:i,data:r}=t,n=nPe(r);return e<r.length*n?Pvt(i,r,e,n):!t.isVisibleBit}function Rvt(t=!0){return{isVisibleBit:!t,data:new Uint32Array(0)}}function Pvt(t,e,i,r){const n=i/r|0,s=i-n*r;return $vt(e[n],s)===t}function nPe(t){return t.BYTES_PER_ELEMENT*8}function Mvt(t,e,i){return t&~(1<<e)|(i?1:0)<<e}function $vt(t,e){return(t&1<<e)!=0}let Ivt=class{constructor(e,i){this._components=i,this._indices=e.indices?ym(e.indices):Kx(e.positions.length/3),this._positions=e.positions,this._componentIntersectionData=new Array(i.count)}destroy(){this._positions=null,this._indices=null,this._componentIntersectionData.length=0,this._perComponentAabbs=null}getComponentAabb(e,i){this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs());for(let r=0;r<6;r++)i[r]=this._perComponentAabbs[6*e+r];return i}getComponentPositions(e,i){i.indices=this._indices,i.data=this._positions,i.stride=3,i.startIndex=this._components.offsets[e],i.endIndex=this._components.offsets[e+1]}intersect(e,i,r,n,s,o,a){const l=new LM(this._positions,3),c=this._indices,h=this._components.offsets,d=H2e(e,i,Lvt),f=e[2],m=i[2];this._components.visibility.forEachComponent(y=>{if(!rPe(this._components.pickability,y))return!0;const _=this.getComponentAabb(y,Dvt);if(o!=null){const T=o[y];s!=null?s.componentOffset=T:(e[2]=f-T,i[2]=m-T)}if(s?.applyToAabb(_),!dQ(_,e,d,r))return!0;const v=h[y]/3,w=h[y+1]/3,x=(T,S,C)=>a(y,T,Nc(S,S,n),C);return s==null&&w-v>ePe?(this._componentIntersectionData[y]==null&&(this._componentIntersectionData[y]=new jee(this._indices,v,w,l)),this._componentIntersectionData[y].intersectRay({r0:e,r1:i},x)):HM(e,i,v,w,c,l,void 0,s,x),!0})}_computePerComponentAabbs(){const e=this._components.count,i=un(6*e),r=this._indices,n=this._positions,s=this._components.offsets;let o=0;for(let a=0;a<e;a++){const l=s[a],c=s[a+1];let h=1/0,d=1/0,f=1/0,m=-1/0,y=-1/0,_=-1/0;for(let v=l;v<c;v++){const w=3*r[v],x=n[w],T=n[w+1],S=n[w+2];h=Math.min(h,x),d=Math.min(d,T),f=Math.min(f,S),m=Math.max(m,x),y=Math.max(y,T),_=Math.max(_,S)}i[o++]=h,i[o++]=d,i[o++]=f,i[o++]=m,i[o++]=y,i[o++]=_}return i}get positions(){return this._positions}get indices(){return this._indices}};const Lvt=E(),Dvt=ks();let Nvt=class{constructor(e,i,r){this.material=e,this.geometry=i,this.meta=r}destroy(){this.material.dispose(),this.geometry.dispose()}},Fvt=class{constructor(e,i,r,n){this.vao=e,this.primitiveType=i,this.parameters=r,this.indexed=n}dispose(){this.vao.dispose()}},Hee=class{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}};function kvt(t,e){return{near:t,far:e}}function s$(t){return t?jP(t,1/0,-1/0):kvt(1/0,-1/0)}function jP(t,e,i){return t.near=e,t.far=i,t}function mC(t,e){e!=null&&(t.near=Math.min(t.near,e.near),t.far=Math.max(t.far,e.far))}function nD(t,e){return t.near<=e&&e<=t.far}const JW={near:0,far:0};function Uvt(t,e){const i=s$(),{eye:r,frustum:n,viewForward:s}=t;e.forAll(o=>{const a=o.offsetObb!=null?o.offsetObb:o.obb,l=ge(go(du,a.center,r),s),c=dU(a,s);if(nD(i,l-c)&&nD(i,l+c))return;const h=jvt(a,n);if(h===-1)return;if(h===0)return dg.far=l+c,dg.near=l-c,void mC(i,dg);const d=sD.pushNew();d.near=l-c,d.far=l+c,d.mask=h,d.object=o});for(let o=0;o<sD.length;o++){const a=sD.data[o];if(nD(i,a.near)&&nD(i,a.far))continue;dg.far=a.far,dg.near=1/0,Gvt(a.object.offsetObb!=null?a.object.offsetObb:a.object.obb,r,zvt,c=>{let h=Bvt;for(let d=0;d<sPe&&c.length>0;d++){if(!(a.mask&1<<d))continue;Vvt(n[d],c,h);const f=c;c=h,h=f}for(let d=0;d<c.length;d+=3){ae(kl,c.data[d],c.data[d+1],c.data[d+2]);const f=ge(go(kl,kl,r),s);dg.near=Math.min(dg.near,f)}})===0&&(dg.near=0),mC(i,dg)}return sD.length=0,i}const sD=new Ut({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=null,t)}),dg=s$(),kl=E(),K1=E(),zvt=new Ut({deallocator:null}),Bvt=new Ut({deallocator:null});function Vvt(t,e,i){i.length=0;const r=e.length-3;eV(kl,e,r);const n=hr(t,kl);n<=0&&(i.push(kl[0]),i.push(kl[1]),i.push(kl[2]));let s=0,o=n;for(;s<r;s+=3){eV(K1,e,s);const a=hr(t,K1);o*a<0&&(Xi(kl,K1,kl,a/(a-o)),Ul(i,kl)),a<=0&&Ul(i,K1),o=a,oe(kl,K1)}o*n<0&&(eV(K1,e,r),Xi(kl,K1,kl,n/(n-o)),Ul(i,kl))}function eV(t,e,i){return ae(t,e.data[i],e.data[i+1],e.data[i+2])}function Ul(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2])}function Gvt(t,e,i,r){bx(Cde,t.quaternion),go(du,e,t.center),pm(du,du,Cde);const n=8*((du[0]<-t.halfSize[0]?-1:du[0]>t.halfSize[0]?1:0)+3*(du[1]<-t.halfSize[1]?-1:du[1]>t.halfSize[1]?1:0)+9*(du[2]<-t.halfSize[2]?-1:du[2]>t.halfSize[2]?1:0)+13),s=Ede[n];if(s===0)return s;XJ(oD,t.quaternion),YJ(oD,oD,t.halfSize);const o=(a,l)=>{const c=Ede[n+l+1];return ae(a,((1&c)<<1)-1,(2&c)-1,((4&c)>>1)-1),Nc(a,a,oD),ue(a,t.center,a)};return i.length=0,Ul(i,o(tV,0)),Ul(i,o(Ade,1)),Ul(i,o(du,2)),Ul(i,o(Ode,3)),r(i),s===1||(i.length=0,Ul(i,tV),Ul(i,Ode),Ul(i,o(du,4)),Ul(i,o(Rde,5)),r(i),s===2||(i.length=0,Ul(i,tV),Ul(i,Rde),Ul(i,o(du,6)),Ul(i,Ade),r(i))),s}const Ede=(()=>{const t=new Array(216);let e=0;const i=r=>{for(let n=0;n<r.length;n++)t[e+n]=r[n];e+=8};return i([3,0,6,2,3,1,5,4]),i([2,0,2,3,1,5,4,0]),i([3,1,0,2,3,7,5,4]),i([2,0,1,3,2,6,4,0]),i([1,0,1,3,2,0,0,0]),i([2,1,5,7,3,2,0,0]),i([3,2,0,1,3,7,6,4]),i([2,2,0,1,3,7,6,0]),i([3,3,0,1,5,7,6,2]),i([2,0,1,5,4,6,2,0]),i([1,0,1,5,4,0,0,0]),i([2,1,3,7,5,4,0,0]),i([1,0,2,6,4,0,0,0]),i([0,0,0,0,0,0,0,0]),i([1,1,3,7,5,0,0,0]),i([2,2,3,7,6,4,0,0]),i([1,2,3,7,6,0,0,0]),i([2,3,1,5,7,6,2,0]),i([3,4,0,1,5,7,6,2]),i([2,5,7,6,4,0,1,0]),i([3,5,0,1,3,7,6,4]),i([2,4,5,7,6,2,0,0]),i([1,4,5,7,6,0,0,0]),i([2,5,1,3,7,6,4,0]),i([3,6,0,2,3,7,5,4]),i([2,6,2,3,7,5,4,0]),i([3,7,6,2,3,1,5,4]),t})(),sPe=4;function jvt(t,e){let i=0;for(let r=0;r<sPe;r++){const n=Ab(t,e[r]);if(n>0)return-1;n===0&&(i|=1<<r)}return i}const oD=nn(),Cde=hd(),du=E(),tV=E(),Ade=E(),Ode=E(),Rde=E();let Hvt=class{constructor(e){this._objects=e}submit(e,i){this._objects.preSubmit(i),this._objects.visibleObjects.forAll(r=>r.renderable.material.submit(e,i,r))}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?Uvt(e,this._objects.visibleObjects):null}};function qvt(t){const e=Hr().vec3f(O.POSITION);return t.normals&&e.vec2i16(O.NORMALCOMPRESSED,{glNormalized:!0}),t.textureCoordinates===Zn.Default?e.vec2f(O.UV0):t.textureCoordinates===Zn.Atlas&&(e.vec2f(O.UV0),e.vec4u16(O.UVREGION,{glNormalized:!0})),t.colors&&e.vec4u8(O.COLOR,{glNormalized:!0}),e}let Wvt=class{constructor(){this.externalColor=oi(),this.externalColorMixMode=Is.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}},Yvt=class extends dn{constructor(e,i){super(e,"int",Oi.Draw,(r,n,s)=>r.setUniform1i(e,i(n,s)))}};var bm;(function(t){t[t.Uniform=0]="Uniform",t[t.Varying=1]="Varying",t[t.COUNT=2]="COUNT"})(bm||(bm={}));const qee=429496.7296;function oPe(t,e){FP(t/qee*.5+.5,e)}function Xvt(t,e){switch(e.componentData){case bm.Varying:return Zvt(t,e);case bm.Uniform:return Jvt(t);case bm.COUNT:return;default:e.componentData}}function Zvt(t,e){const{vertex:i,fragment:r}=t;i.include(dd),i.uniforms.add(new Yh("componentColorTex",s=>s.componentParameters.texture.texture)),t.attributes.add(O.COMPONENTINDEX,"float"),t.varyings.add("vExternalColorMixMode","mediump float"),t.varyings.add("vExternalColor","vec4");const n=e.output===F.ObjectAndLayerIdColor;n&&t.varyings.add("vObjectAndLayerIdColor","vec4"),t.include(XEe),i.constants.add("elevationScale","float",2*qee),i.constants.add("stride","float",ie("enable-feature:objectAndLayerId-rendering")?3:2),i.code.add(b`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),i.code.add(b`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${n?b`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:b`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),r.code.add(b`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${n?b`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function Jvt(t){const{vertex:e,fragment:i}=t;e.uniforms.add(new ZF("externalColor",r=>r.componentParameters.externalColor)),i.uniforms.add(new Yvt("externalColorMixMode",r=>r.componentParameters.externalColorMixMode)),t.varyings.add("vExternalColor","vec4"),e.code.add(b`float readElevationOffset() {
return 0.0;
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),i.code.add(b`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}`)}var Du;function Kvt(t,e){const i=t.vertex;switch(i.code.add(b`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),e.vertexDiscardMode){case Du.None:i.code.add(b`#define vertexDiscardByOpacity(_opacity_) {}`);break;case Du.Opaque:i.code.add(b`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case Du.Transparent:i.code.add(b`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case Du.COUNT:break;default:e.vertexDiscardMode}}(function(t){t[t.None=0]="None",t[t.Transparent=1]="Transparent",t[t.Opaque=2]="Opaque",t[t.COUNT=3]="COUNT"})(Du||(Du={}));var wm;function dVt(t){return t&&km(t)?wm.Mars:t&&Um(t)?wm.Moon:wm.Earth}(function(t){t[t.Earth=1]="Earth",t[t.Mars=2]="Mars",t[t.Moon=3]="Moon",t[t.COUNT=4]="COUNT"})(wm||(wm={}));var Mu;(function(t){t[t.None=0]="None",t[t.NoOverlay=1]="NoOverlay",t[t.ColorOverlay=2]="ColorOverlay",t[t.ColorOverlayWithWater=3]="ColorOverlayWithWater",t[t.COUNT=4]="COUNT"})(Mu||(Mu={}));let di=class extends tc{constructor(){super(...arguments),this.output=F.Color,this.textureCoordinateType=Zn.None,this.componentData=bm.Uniform,this.cullFace=xr.Back,this.vertexDiscardMode=Du.None,this.doubleSidedMode=hn.WindingOrder,this.alphaDiscardMode=nr.Opaque,this.integratedMeshMode=Mu.None,this.transparencyPassType=it.NONE,this.ellipsoidMode=wm.Earth,this.pbrMode=ot.Disabled,this.normalType=Ni.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1}};u([U({count:F.COUNT})],di.prototype,"output",void 0),u([U({count:Zn.COUNT})],di.prototype,"textureCoordinateType",void 0),u([U({count:bm.COUNT})],di.prototype,"componentData",void 0),u([U({count:xr.COUNT})],di.prototype,"cullFace",void 0),u([U({count:Du.COUNT})],di.prototype,"vertexDiscardMode",void 0),u([U({count:hn.COUNT})],di.prototype,"doubleSidedMode",void 0),u([U({count:nr.COUNT})],di.prototype,"alphaDiscardMode",void 0),u([U({count:Mu.COUNT})],di.prototype,"integratedMeshMode",void 0),u([U({count:it.COUNT})],di.prototype,"transparencyPassType",void 0),u([U({count:wm.COUNT})],di.prototype,"ellipsoidMode",void 0),u([U({count:ot.COUNT})],di.prototype,"pbrMode",void 0),u([U({count:Ni.COUNT})],di.prototype,"normalType",void 0),u([U()],di.prototype,"spherical",void 0),u([U()],di.prototype,"doublePrecisionRequiresObfuscation",void 0),u([U()],di.prototype,"hasVertexColors",void 0),u([U()],di.prototype,"hasNormals",void 0),u([U()],di.prototype,"hasSlicePlane",void 0),u([U()],di.prototype,"hasColorTexture",void 0),u([U()],di.prototype,"receiveAmbientOcclusion",void 0),u([U()],di.prototype,"receiveShadows",void 0),u([U()],di.prototype,"blendingEnabled",void 0),u([U()],di.prototype,"hasScreenSpaceReflections",void 0),u([U()],di.prototype,"hasPolygonOffset",void 0),u([U()],di.prototype,"hasMetallicRoughnessTexture",void 0),u([U()],di.prototype,"hasEmissionTexture",void 0),u([U()],di.prototype,"hasOcclusionTexture",void 0),u([U()],di.prototype,"hasNormalTexture",void 0),u([U()],di.prototype,"hasOccludees",void 0),u([U()],di.prototype,"multipassEnabled",void 0),u([U()],di.prototype,"cullAboveGround",void 0),u([U()],di.prototype,"hasCloudsReflections",void 0),u([U()],di.prototype,"snowCover",void 0),u([U()],di.prototype,"objectAndLayerIdColor",void 0),u([U({constValue:!1})],di.prototype,"occlusionPass",void 0),u([U({constValue:Oi.Draw})],di.prototype,"pbrTextureBindType",void 0),u([U({constValue:!0})],di.prototype,"hasSliceHighlight",void 0),u([U({constValue:!1})],di.prototype,"hasSliceInVertexProgram",void 0),u([U({constValue:!1})],di.prototype,"useCustomDTRExponentForWater",void 0),u([U({constValue:!1})],di.prototype,"hasVertexTangents",void 0),u([U({constValue:!0})],di.prototype,"supportsTextureAtlas",void 0),u([U({constValue:!1})],di.prototype,"highStepCount",void 0),u([U({constValue:!1})],di.prototype,"instancedDoublePrecision",void 0),u([U({constValue:!1})],di.prototype,"hasModelTransformation",void 0),u([U({constValue:!0})],di.prototype,"useFillLights",void 0),u([U({constValue:!1})],di.prototype,"objectAndLayerIdColorInstanced",void 0);function Pde(t,e){t.include(tT,e),t.fragment.include($P);const i=t.fragment;i.uniforms.add(new ZF("baseColor",r=>r.baseColor)),i.uniforms.add(new Zw("objectOpacity",r=>r.objectOpacity)),e.hasVertexColors?i.code.add(b`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):i.code.add(b`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),i.code.add(b`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function Mde(t,e){const i=t.fragment;switch(e.doubleSidedMode){case hn.None:i.code.add(b`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case hn.View:t.include(tE,e),i.code.add(b`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case hn.WindingOrder:i.code.add(b`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:e.doubleSidedMode;case hn.COUNT:}switch(e.normalType){case Ni.Attribute:case Ni.Compressed:t.include(YU,e),i.code.add(b`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case Ni.ScreenDerivative:t.include(tE,e),i.code.add(b`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case Ni.Ground:e.spherical?(t.include(tE,e),i.code.add(b`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):i.code.add(b`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),i.code.add(b`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:e.normalType;case Ni.COUNT:}}function Qvt(t,e){const i=t.fragment;if(e.hasColorTexture&&(e.output===F.Color||e.alphaDiscardMode!==nr.Opaque)){t.include(wK,e);const r=e.textureCoordinateType===Zn.Atlas;i.uniforms.add(new Yh("baseColorTexture",n=>n.texture)),r?(t.include(fTe),i.code.add(b`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, vuv0, vuvRegion);
}`)):i.code.add(b`vec4 readBaseColorTexture() {
return texture(baseColorTexture, vuv0);
}`)}else i.code.add(b`vec4 readBaseColorTexture() { return vec4(1.0); }`)}function e1t(t){const e=new Ei;e.include(tE,t),e.include(YU,t),e.include(tT,t),e.include(mm,t),e.include(kC,t),e.include(Xvt,t),e.include(Jrt,t),e.include(eit,t),e.include(Qvt,t),e.include(Kvt,t);const{vertex:i,fragment:r}=e;t.pbrMode!==ot.Normal&&t.pbrMode!==ot.Schematic||(e.include(TK,t),t.hasNormalTexture&&e.include(eCe,t));const n=t.output===F.Shadow||t.output===F.ShadowHighlight||t.output===F.ShadowExcludeHighlight;n&&t.componentData===bm.Varying?i.code.add(b`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):i.code.add(b`#define discardShadows(castShadows) {}`);const s=t.integratedMeshMode===Mu.ColorOverlay||t.integratedMeshMode===Mu.ColorOverlayWithWater,o=s&&t.output===F.Color&&t.pbrMode===ot.WaterOnIntegratedMesh;return s&&(e.include(Ax,t),e.include(Eot,t),t.spherical?i.code.add(b`
      const float invEllipsoidRadius = ${b.float(1/(t.ellipsoidMode===wm.Earth?Ai.radius:t.ellipsoidMode===wm.Mars?dm.radius:Ty.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):i.code.add(b`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),o&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3")),i.code.add(b`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${t.output===F.ObjectAndLayerIdColor?b`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${b.float(zo)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${t.output===F.ObjectAndLayerIdColor?b`forwardObjectAndLayerIdColor();`:""}
      ${o?t.spherical?b`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:b`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${s?b`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),t.output===F.Alpha&&(r.include(od),e.include(Xc,t),e.include(Pde,t),s&&r.uniforms.add(new et("ovColorTex",(a,l)=>uW(a,l))),r.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.multipassEnabled?b`terrainDepthTest(vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?b`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        fragColor = vec4(materialColor.a);
      }
    `)),t.output===F.Color&&(r.include(od),e.include(Xc,t),e.include(Pde,t),e.include(Mde,t),e.include(Ax,t),t.receiveShadows?(e.include(JU,t),r.code.add(b`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):r.code.add(b`float evaluateShadow() { return 0.0; }`),s&&r.uniforms.add(new et("ovColorTex",(a,l)=>uW(a,l))),r.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.multipassEnabled?b`terrainDepthTest(vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?b`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),t.pbrMode===ot.Normal||t.pbrMode===ot.Schematic?(Gm(r),r.code.add(b`
        ${t.pbrMode===ot.Normal?b`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),t.hasNormalTexture?r.code.add(b`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):r.code.add(b`vec3 shadingNormal = normalVertex;`),r.code.add(b`${t.spherical?b`vec3 normalGround = normalize(positionWorld());`:b`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),r.code.add(b`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * evaluateAmbientOcclusionInverse();

        ${t.snowCover?b`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${s?b` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(t.receiveShadows?r.code.add(b`float shadow = evaluateShadow();`):t.spherical?(GC(r),r.code.add(b`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):r.code.add(b`float shadow = 0.0;`),o&&r.uniforms.add(new et("ovNormalTex",(a,l)=>l.overlay?.getTexture(jr.WaterNormal))),t.snowCover&&r.code.add(b`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`),r.code.add(b`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${s?b` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${o?b`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),r.code.add(b`
        fragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${t.transparencyPassType===it.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `)),(t.output===F.Depth||n)&&(e.include($y,t),r.code.add(b`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),t.output===F.Normal&&(e.include(Mde,t),r.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material to influence ambient occlusion,
        // see the ssao fragment shader
        float alpha = ${t.normalType===Ni.Ground?"0.0":"1.0"};
        fragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),t.output===F.ObjectAndLayerIdColor&&e.fragment.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${s?b`fragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `),t.output===F.Highlight&&(e.include(s1),r.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${s?b`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  fragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),e}const t1t=Object.freeze(Object.defineProperty({__proto__:null,build:e1t},Symbol.toStringTag,{value:"Module"}));let aPe=class lPe extends Fi{initializeConfiguration(e,i){i.spherical=e.viewingMode===Le.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Mi(e.rctx,lPe.shader.get().build(this.configuration),cPe)}_setPipelineState(e){const i=this.configuration,r=i.integratedMeshMode!==Mu.None,n=e===it.NONE,s=e===it.FrontFace;return Lt({blending:i.output!==F.Color&&i.output!==F.Alpha||!i.blendingEnabled?null:n?Xu:Zy(e),culling:_U(i.cullFace),depthTest:{func:o1(e)},depthWrite:n||s?ec:null,colorWrite:Gt,stencilWrite:r||i.hasOccludees?$m:null,stencilTest:r?Hrt(Zl.IntegratedMeshMaskExcluded):i.hasOccludees?a1:null,polygonOffset:n||s?i.hasPolygonOffset?{factor:2,units:2}:null:GU})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};aPe.shader=new Pi(t1t,()=>ce(()=>import("./ComponentShader.glsl-ee31eb90.js"),[],import.meta.url));const cPe=new Map([[O.POSITION,0],[O.NORMAL,1],[O.NORMALCOMPRESSED,1],[O.COLOR,2],[O.UV0,3],[O.UVREGION,4],[O.COMPONENTINDEX,5]]);let i1t=class extends or{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},Wee=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function _n(t={}){return(e,i)=>{const r=e._parameterCount??0;if(e._parameterCount=r+1,t.vectorOps){const n=t.vectorOps;Object.defineProperty(e,i,{get(){return this[r]},set(s){const o=this[r];if(o==null)this[r]=s;else{if(n.equals(o,s))return;n.copy(o,s)}this._setDirty()}})}else Object.defineProperty(e,i,{get(){return this[r]},set(n){this[r]!==n&&(t.dispose&&this[r]&&this[r].dispose(),this[r]=n,this._setDirty())}})}}function $de(){return(t,e)=>{const i=t._parameterCount??0;t._parameterCount=i+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(i),Object.defineProperty(t,e,{get(){return this[i]},set(r){this[i]!==r&&(this[i]=r,this._setDirty())}})}}let y8=class{constructor(e){this._low=E(),this._high=E(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){oe(this._low,oe(Ide,e));const i=go(Ide,e,this._low);oe(this._high,i)}get(e){return ue(e,this._low,this._high)}getLowScaled(e){return re(e,this._low,1)}};const Ide=Mn();let ro=class extends i1t{constructor(e,i){super(),this.toMapSpace=i,this.baseColor=Ft(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=Ta(XU),this.emissiveFactor=Oe(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new M4,this.componentParameters=new NR,this.textureAlphaCutoff=BF,this.alphaDiscardMode=nr.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=wm.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new di;const r=new y8(e.position),n=aCe(e.rotationScale);Xx(n,n),this.transformNormalGlobalFromModel=tbe(nd(n,n)),this.transformWorldFromModelTL=r.low,this.transformWorldFromModelTH=r.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this._technique=li(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return this.baseColorTexture!=null?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return this.metallicRoughnessTexture!=null?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return this.emissionTexture!=null?this.emissionTexture.glTexture:null}get textureOcclusion(){return this.occlusionTexture!=null?this.occlusionTexture.glTexture:null}get textureNormal(){return this.normalTexture!=null?this.normalTexture.glTexture:null}prepareTechnique(e,i,r,n){const s=this._techniqueConfiguration;s.hasVertexColors=n.colors,s.hasNormals=n.normals,s.textureCoordinateType=n.textureCoordinates,s.hasMetallicRoughnessTexture=this.metallicRoughnessTexture!=null,s.hasEmissionTexture=this.emissionTexture!=null,s.hasOcclusionTexture=this.occlusionTexture!=null,s.hasNormalTexture=this.normalTexture!=null,s.transparencyPassType=i.identifier===Dc.Material&&r.transparencyPassType!=null?r.transparencyPassType:it.NONE,s.multipassEnabled=i.identifier===Dc.Material&&r.multipassEnabled,s.cullAboveGround=i.identifier===Dc.Material&&r.multipassTerrain.cullAboveGround,s.ellipsoidMode=this.ellipsoidMode,s.componentData=this.componentParameters.type,s.cullFace=this.commonMaterialParameters.cullFace,s.doubleSidedMode=this.commonMaterialParameters.doubleSided?hn.View:hn.None,s.hasColorTexture=this.baseColorTexture!=null;const o=this._computeWhichMaterialPass();if(s.blendingEnabled=o===il.Transparent||o===il.OpaqueAndTransparent,s.alphaDiscardMode=this.alphaDiscardMode,s.integratedMeshMode=this.isIntegratedMesh?s1t(r)?n1t(r)?Mu.ColorOverlayWithWater:Mu.ColorOverlay:Mu.NoOverlay:Mu.None,s.hasPolygonOffset=this.polygonOffsetEnabled,s.pbrMode=s.integratedMeshMode===Mu.ColorOverlayWithWater?ot.WaterOnIntegratedMesh:this.usePBR?this.hasParametersFromSource?ot.Schematic:ot.Normal:ot.Disabled,s.normalType=s.integratedMeshMode===Mu.None?s.hasNormals?Ni.Compressed:Ni.ScreenDerivative:Ni.Ground,s.hasSlicePlane=r.slicePlane!=null&&this.commonMaterialParameters.hasSlicePlane,i.identifier===Dc.ShadowMap)s.output=F.Shadow,s.vertexDiscardMode=Du.None;else if(i.identifier===Dc.Highlight)s.output=F.Highlight,s.vertexDiscardMode=Du.None;else{switch(o===il.OpaqueAndTransparent?s.vertexDiscardMode=i.transparent?Du.Opaque:Du.Transparent:s.vertexDiscardMode=Du.None,s.output=i.output,s.receiveAmbientOcclusion=!1,s.receiveShadows=!1,i.output){case F.Color:s.receiveAmbientOcclusion=r.ssao!=null,s.hasOccludees=r.hasOccludees,s.receiveShadows=r.shadowMap.ready,s.hasScreenSpaceReflections=r.ssr.lastFrameColor!=null,s.hasCloudsReflections=r.cloudsFade.data!=null;break;case F.Alpha:s.hasOccludees=r.hasOccludees;break;case F.ObjectAndLayerIdColor:s.objectAndLayerIdColor=!0}s.snowCover=this.hasSnowCover(r)}return this._technique=e.releaseAndAcquire(aPe,s,this._technique),this._setClean(),this._technique}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}submit(e,i,r){if(this.objectOpacity===0)return;const n=r.renderable.geometry,s=r.components,o=r.renderable.meta.cameraDepthSquared,a=s.geometryRanges,l=s.highlightRanges,c=s.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case il.Opaque:e.materialOpaque.submitDraw(this,n,a,o);break;case il.Transparent:e.materialTransparent.submitDraw(this,n,a,o);break;case il.OpaqueAndTransparent:e.materialOpaque.submitDraw(this,n,a,o),e.materialTransparent.submitDraw(this,n,a,o);break;case il.IntegratedMesh:e.materialIntegratedMesh.submitDraw(this,n,a,o),r1t(i)&&e.highlightIntegratedMesh.submitDraw(this,n,a,o)}const h=this.componentParameters.castShadows!==Gs.None;h&&e.shadowMap.submitDraw(this,n,a,o),l!=null&&(e.highlight.submitDraw(this,n,l,o),h&&e.highlightShadowMap.submitDraw(this,n,l,o)),h&&c!=null&&e.defaultShadowMap.submitDraw(this,n,c,o)}_computeWhichMaterialPass(){return this.isIntegratedMesh?il.IntegratedMesh:this.objectOpacity<1?il.Transparent:this.componentParameters.opaqueOverride===Gs.All?il.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===nr.Blend||this.alphaDiscardMode===nr.MaskBlend?il.Transparent:this.componentParameters.transparent===Gs.None?il.Opaque:this.componentParameters.transparent===Gs.All?il.Transparent:il.OpaqueAndTransparent}};var il,Gs;u([_n({vectorOps:Vye})],ro.prototype,"baseColor",void 0),u([_n()],ro.prototype,"usePBR",void 0),u([_n()],ro.prototype,"hasParametersFromSource",void 0),u([_n({vectorOps:Uie})],ro.prototype,"mrrFactors",void 0),u([_n({vectorOps:Uie})],ro.prototype,"emissiveFactor",void 0),u([_n({dispose:!0})],ro.prototype,"baseColorTexture",void 0),u([_n({dispose:!0})],ro.prototype,"metallicRoughnessTexture",void 0),u([_n({dispose:!0})],ro.prototype,"emissionTexture",void 0),u([_n({dispose:!0})],ro.prototype,"occlusionTexture",void 0),u([_n({dispose:!0})],ro.prototype,"normalTexture",void 0),u([_n()],ro.prototype,"objectOpacity",void 0),u([$de()],ro.prototype,"commonMaterialParameters",void 0),u([$de()],ro.prototype,"componentParameters",void 0),u([_n()],ro.prototype,"textureAlphaCutoff",void 0),u([_n()],ro.prototype,"alphaDiscardMode",void 0),u([_n()],ro.prototype,"isIntegratedMesh",void 0),u([_n()],ro.prototype,"polygonOffsetEnabled",void 0),u([_n()],ro.prototype,"ellipsoidMode",void 0),u([_n()],ro.prototype,"hasOccludees",void 0),function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.OpaqueAndTransparent=2]="OpaqueAndTransparent",t[t.IntegratedMesh=3]="IntegratedMesh"}(il||(il={}));let M4=class extends Wee{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=xr.Back,this.hasSlicePlane=!0}};u([_n()],M4.prototype,"doubleSided",void 0),u([_n()],M4.prototype,"cullFace",void 0),u([_n()],M4.prototype,"hasSlicePlane",void 0);let NR=class extends Wee{constructor(){super(...arguments),this.externalColor=Ft(1,1,1,1),this.externalColorMixMode=Is.Multiply,this.castShadows=Gs.All}get transparent(){return this.externalColor[3]<1?Gs.All:Gs.None}get opaqueOverride(){return this.externalColorMixMode===Is.Replace&&this.externalColor[3]===1?Gs.All:Gs.None}get visible(){return this.externalColor[3]>0?Gs.All:Gs.None}get type(){return bm.Uniform}};u([_n({vectorOps:Vye})],NR.prototype,"externalColor",void 0),u([_n()],NR.prototype,"externalColorMixMode",void 0),u([_n()],NR.prototype,"castShadows",void 0),function(t){t[t.All=0]="All",t[t.Some=1]="Some",t[t.None=2]="None"}(Gs||(Gs={}));let bO=class extends Wee{constructor(){super(...arguments),this.texture=null,this.transparent=Gs.None,this.opaqueOverride=Gs.None,this.castShadows=Gs.None}get type(){return bm.Varying}};function r1t(t){return t.overlay?.getTexture(jr.Highlight)!=null}function n1t(t){return t.overlay?.getTexture(jr.WaterNormal)!=null}function s1t(t){return t.overlay?.getTexture(jr.ColorNoRasterImage)!=null}u([_n()],bO.prototype,"texture",void 0),u([_n()],bO.prototype,"transparent",void 0),u([_n()],bO.prototype,"opaqueOverride",void 0),u([_n()],bO.prototype,"castShadows",void 0);const vk=Hr().vec3f(O.POSITION).u16(O.COMPONENTINDEX),uPe=Hr().vec2u8(O.SIDENESS),o1t=Kc(uPe),KW=Hr().vec3f(O.POSITION0).vec3f(O.POSITION1).vec3f(O.NORMAL).u16(O.COMPONENTINDEX).u8(O.VARIANTOFFSET,{glNormalized:!0}).u8(O.VARIANTSTROKE).u8(O.VARIANTEXTENSION,{glNormalized:!0}),QW=Hr().vec3f(O.POSITION0).vec3f(O.POSITION1).vec3f(O.NORMALA).vec3f(O.NORMALB).u16(O.COMPONENTINDEX).u8(O.VARIANTOFFSET,{glNormalized:!0}).u8(O.VARIANTSTROKE).u8(O.VARIANTEXTENSION,{glNormalized:!0}),hPe=new Map([[O.POSITION0,0],[O.POSITION1,1],[O.COMPONENTINDEX,2],[O.VARIANTOFFSET,3],[O.VARIANTSTROKE,4],[O.VARIANTEXTENSION,5],[O.NORMAL,6],[O.NORMALA,6],[O.NORMALB,7],[O.SIDENESS,8]]);function Lde(t,e,i){const r=e/3,n=new Uint32Array(i+1),s=new Uint32Array(i+1),o=(w,x)=>{w<x?n[w+1]++:s[x+1]++};for(let w=0;w<r;w++){const x=t[3*w],T=t[3*w+1],S=t[3*w+2];o(x,T),o(T,S),o(S,x)}let a=0,l=0;for(let w=0;w<i;w++){const x=n[w+1],T=s[w+1];n[w+1]=a,s[w+1]=l,a+=x,l+=T}const c=new Uint32Array(6*r),h=n[i],d=(w,x,T)=>{if(w<x){const S=n[w+1]++;c[2*S]=x,c[2*S+1]=T}else{const S=s[x+1]++;c[2*h+2*S]=w,c[2*h+2*S+1]=T}};for(let w=0;w<r;w++){const x=t[3*w],T=t[3*w+1],S=t[3*w+2];d(x,T,w),d(T,S,w),d(S,x,w)}const f=(w,x)=>{const T=2*w,S=x-w;for(let C=1;C<S;C++){const A=c[T+2*C],R=c[T+2*C+1];let D=C-1;for(;D>=0&&c[T+2*D]>A;D--)c[T+2*D+2]=c[T+2*D],c[T+2*D+3]=c[T+2*D+1];c[T+2*D+2]=A,c[T+2*D+3]=R}};for(let w=0;w<i;w++)f(n[w],n[w+1]),f(h+s[w],h+s[w+1]);const m=new Int32Array(3*r),y=(w,x)=>w===t[3*x]?0:w===t[3*x+1]?1:w===t[3*x+2]?2:-1,_=(w,x)=>{const T=y(w,x);m[3*x+T]=-1},v=(w,x,T,S)=>{const C=y(w,x);m[3*x+C]=S;const A=y(T,S);m[3*S+A]=x};for(let w=0;w<i;w++){let x=n[w];const T=n[w+1];let S=s[w];const C=s[w+1];for(;x<T&&S<C;){const A=c[2*x],R=c[2*h+2*S];A===R?(v(w,c[2*x+1],R,c[2*h+2*S+1]),x++,S++):A<R?(_(w,c[2*x+1]),x++):(_(R,c[2*h+2*S+1]),S++)}for(;x<T;)_(w,c[2*x+1]),x++;for(;S<C;)_(c[2*h+2*S],c[2*h+2*S+1]),S++}return m}let dPe=class{updateSettings(e){this.settings=e,this._edgeHashFunction=e.reducedPrecision?l1t:a1t}write(e,i,r){const n=this._edgeHashFunction(r);lD.seed=n;const s=lD.getIntRange(0,255),o=lD.getIntRange(0,this.settings.variants-1),a=.7,l=lD.getFloat(),c=255*(.5*c1t(-(1-Math.min(l/a,1))+Math.max(0,l-a)/(1-a),1.2)+.5);e.position0.setVec(i,r.position0),e.position1.setVec(i,r.position1),e.componentIndex.set(i,r.componentIndex),e.variantOffset.set(i,s),e.variantStroke.set(i,o),e.variantExtension.set(i,c)}trim(e,i){return e.slice(0,i)}};const Yee=new Float32Array(6),bk=new Uint32Array(Yee.buffer),rv=new Uint32Array(1);function a1t(t){const e=Yee;e[0]=t.position0[0],e[1]=t.position0[1],e[2]=t.position0[2],e[3]=t.position1[0],e[4]=t.position1[1],e[5]=t.position1[2],rv[0]=5381;for(let i=0;i<bk.length;i++)rv[0]=31*rv[0]+bk[i];return rv[0]}function l1t(t){const e=Yee;e[0]=hS(t.position0[0]),e[1]=hS(t.position0[1]),e[2]=hS(t.position0[2]),e[3]=hS(t.position1[0]),e[4]=hS(t.position1[1]),e[5]=hS(t.position1[2]),rv[0]=5381;for(let i=0;i<bk.length;i++)rv[0]=31*rv[0]+bk[i];return rv[0]}const Dde=1e4;function hS(t){return Math.round(t*Dde)/Dde}function c1t(t,e){const i=t<0?-1:1;return Math.abs(t)**e*i}let wk=class{constructor(){this._commonWriter=new dPe}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return KW.createBuffer(e)}write(e,i,r){this._commonWriter.write(e,i,r),ue(aD,r.faceNormal0,r.faceNormal1),ye(aD,aD),e.normal.setVec(i,aD)}trim(e,i){return this._commonWriter.trim(e,i)}};wk.Layout=KW,wk.glLayout=Kc(KW,1);let xk=class{constructor(){this._commonWriter=new dPe}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return QW.createBuffer(e)}write(e,i,r){this._commonWriter.write(e,i,r),e.normalA.setVec(i,r.faceNormal0),e.normalB.setVec(i,r.faceNormal1)}trim(e,i){return this._commonWriter.trim(e,i)}};xk.Layout=QW,xk.glLayout=Kc(QW,1);const aD=E(),lD=new kO,Gb=-1;var Tk;function u1t(t,e,i,r=g1t){const n=t.vertices.position,s=t.vertices.componentIndex,o=Dt(r.anglePlanar),a=Dt(r.angleSignificantEdge),l=Math.cos(a),c=Math.cos(o),h=eY.edge,d=h.position0,f=h.position1,m=h.faceNormal0,y=h.faceNormal1,_=m1t(t),v=f1t(t),w=v.length/4,x=e.allocate(w);let T=0;const S=w,C=i.allocate(S);let A=0,R=0,D=0;const N=ZIe(0,w),k=new Float32Array(w);k.forEach((H,X,P)=>{n.getVec(v[4*X],d),n.getVec(v[4*X+1],f),P[X]=Mr(d,f)}),N.sort((H,X)=>k[X]-k[H]);const B=new Array,L=new Array;for(let H=0;H<w;H++){const X=N[H],P=k[X],I=v[4*X],V=v[4*X+1],q=v[4*X+2],Y=v[4*X+3],J=Y===Gb;if(n.getVec(I,d),n.getVec(V,f),J)ae(m,_[3*q],_[3*q+1],_[3*q+2]),oe(y,m),h.componentIndex=s.get(I),h.cosAngle=ge(m,y);else{if(ae(m,_[3*q],_[3*q+1],_[3*q+2]),ae(y,_[3*Y],_[3*Y+1],_[3*Y+2]),h.componentIndex=s.get(I),h.cosAngle=ge(m,y),d1t(h,c))continue;h.cosAngle<-.9999&&oe(y,m)}R+=P,D++,J||h1t(h,l)?(e.write(x,T++,h),B.push(P)):p1t(h,o)&&(i.write(C,A++,h),L.push(P))}const z=new Float32Array(B.reverse()),j=new Float32Array(L.reverse());return{regular:{instancesData:e.trim(x,T),lodInfo:{lengths:z}},silhouette:{instancesData:i.trim(C,A),lodInfo:{lengths:j}},averageEdgeLength:R/D}}function h1t(t,e){return t.cosAngle<e}function d1t(t,e){return t.cosAngle>e}function p1t(t,e){const i=Ys(t.cosAngle),r=eY.fwd,n=eY.ortho;return Fy(r,t.position1,t.position0),i*(ge(lt(n,t.faceNormal0,t.faceNormal1),r)>0?-1:1)>e}function f1t(t){const e=t.faces.length/3,i=t.faces,r=t.neighbors;let n=0;for(let a=0;a<e;a++){const l=r[3*a],c=r[3*a+1],h=r[3*a+2],d=i[3*a],f=i[3*a+1],m=i[3*a+2];n+=l===Gb||d<f?1:0,n+=c===Gb||f<m?1:0,n+=h===Gb||m<d?1:0}const s=new Int32Array(4*n);let o=0;for(let a=0;a<e;a++){const l=r[3*a],c=r[3*a+1],h=r[3*a+2],d=i[3*a],f=i[3*a+1],m=i[3*a+2];(l===Gb||d<f)&&(s[o++]=d,s[o++]=f,s[o++]=a,s[o++]=l),(c===Gb||f<m)&&(s[o++]=f,s[o++]=m,s[o++]=a,s[o++]=c),(h===Gb||m<d)&&(s[o++]=m,s[o++]=d,s[o++]=a,s[o++]=h)}return s}function m1t(t){const e=t.faces.length/3,i=t.vertices.position,r=t.faces,n=iV.v0,s=iV.v1,o=iV.v2,a=new Float32Array(3*e);for(let l=0;l<e;l++){const c=r[3*l],h=r[3*l+1],d=r[3*l+2];i.getVec(c,n),i.getVec(h,s),i.getVec(d,o),de(s,s,n),de(o,o,n),lt(n,s,o),ye(n,n),a[3*l]=n[0],a[3*l+1]=n[1],a[3*l+2]=n[2]}return a}(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH"})(Tk||(Tk={}));const eY={edge:{position0:E(),position1:E(),faceNormal0:E(),faceNormal1:E(),componentIndex:0,cosAngle:0},ortho:E(),fwd:E()},iV={v0:E(),v1:E(),v2:E()},g1t={anglePlanar:4,angleSignificantEdge:35};function y1t(t){const e=_1t(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return Nde.updateSettings(t.writerSettings),Fde.updateSettings(t.writerSettings),u1t(e,Nde,Fde)}function _1t(t,e,i,r){if(e){const o=Lde(i,r,t.count);return new v1t(i,r,o,t)}const n=lW(t.buffer,t.stride/4,{originalIndices:i,originalIndicesLength:r}),s=Lde(n.indices,r,n.uniqueCount);return{faces:n.indices,facesLength:n.indices.length,neighbors:s,vertices:vk.createView(n.buffer)}}let v1t=class{constructor(e,i,r,n){this.faces=e,this.facesLength=i,this.neighbors=r,this.vertices=n}};const Nde=new wk,Fde=new xk,EVt=Hr().vec3f(O.POSITION0).vec3f(O.POSITION1),b1t=Hr().vec3f(O.POSITION0).vec3f(O.POSITION1).u16(O.COMPONENTINDEX);let w1t=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},x1t=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this.textureWidth=4096,this._dirty=!0;const r=new Hi(this.textureWidth,1);r.samplingMode=zt.NEAREST,r.wrapMode=Vt.CLAMP_TO_EDGE,this._texture=new Nt(this._rctx,r),this._data=new Ia(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,i,r,n,s,o){const a=e*this._fieldCount+i;this._dirty=!0,this._data.set(a,0,r),this._data.set(a,1,n),this._data.set(a,2,s),this._data.set(a,3,o)}setDataElement(e,i,r,n){const s=e*this._fieldCount+i;this._dirty=!0,this._data.set(s,r,n)}getDataElement(e,i,r){const n=e*this._fieldCount+i;return this._dirty=!0,this._data.get(n,r)}resizeToFit(e){const i=(e+1)*this._fieldCount;if(i>this._data.count){const r=Math.ceil(i/this.textureWidth)*this.textureWidth,n=new Ia(new ArrayBuffer(4*r));n.typedBuffer.set(this._data.typedBuffer),this._data=n}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,i=this._texture.descriptor.height;this._data.count>e*i&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const pPe=65536;let T1t=class{constructor(e,i=1){this.textureBuffer=new x1t(e,i),this._indexManager=new w1t(pPe)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},fPe=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const r of this._buffers)if(r.availableCount>=e)return r;if(e>pPe)return null;const i=new T1t(this._rctx,this._fieldCount);return this._buffers.push(i),i}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const kde=K.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");let S1t=class{constructor(e,i){this._renderManager=e,this._viewingMode=i,this._objects=[new Ut,new Ut],this._renderSubmit=new Hvt(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=ie("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new fPe(e.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){tt(this._objects[dE.Hidden].length===0&&this._objects[dE.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy();const e=this._objects.flatMap(i=>i.toArray());for(const i of e)i?.destroy()}createObject(e){const i=new vO;return i.toMapSpace=e.toMapSpace,i.transform=e.transform,i.obb=tse(e.obb),i.components=new Cvt(this._componentBufferManager,ym(e.geometry.componentOffsets)),i.renderable=this._createRenderable(e,i.components),i.intersectionGeometry=new Ivt(e.geometry.positionData,i.components),this._objects[i.visible].push(i),i}destroyObject(e){const i=e;this._objects[i.visible].removeUnordered(i),i.destroy(),this._notifyDirty()}setObjectVisibility(e,i){const r=e;i!==r.visible&&(this._objects[r.visible].removeUnordered(r),this._objects[i].push(r),r.visible=i,this._notifyDirty())}preSubmit(e){const i=e.camera.eye;this.visibleObjects.forAll(r=>r.renderable.meta.cameraDepthSquared=qs(i,r.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,i){const r=e.renderable.material;i(r),r.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,i){const r=e;r.components.visibility.reset(i),r.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,i){return e.components.visibility.forEachComponent(i)}getComponentCount(e){const i=e,r=i.components.visibility.componentCount();return{visible:r,invisible:i.components.count-r}}setComponentData(e,i){const r=e,n=r.renderable.material,s=r.components,o=s.materialDataBuffer,a=s.materialDataIndices,l=new Wvt,c=o.textureBuffer,h=new Uint8Array(4),d=new Uint32Array(h.buffer);let f=0,m=0,y=0,_=s.verticalOffsets,v=1/0,w=-1/0,x=!1,T=!1,S=0;for(let C=0;C<s.count;C++){i(C,l),f+=+(l.externalColor[3]<1),m+=+(l.externalColorMixMode===Is.Replace&&l.externalColor[3]===1),y+=+l.castShadows,YEe(l.externalColor,l.externalColorMixMode,h),h[2]=254&h[2]|+l.castShadows,c.setData(a[C],0,h[0],h[1],h[2],h[3]),x||(x=C>0&&S!==d[0]),S=d[0],T||(T=l.elevationOffset!==0),T&&_==null&&(_=new Array(C).fill(0)),_!=null&&(_[C]=l.elevationOffset),v=Math.min(v,l.elevationOffset),w=Math.max(w,l.elevationOffset),oPe(l.elevationOffset,h),c.setData(a[C],1,h[0],h[1],h[2],h[3]);const A=l.objectAndLayerIdColor;A!=null&&c.setData(a[C],2,A[0],A[1],A[2],A[3]),l.pickable!==rPe(s.pickability,C)&&(s.pickability=Ovt(s.pickability,s.count,C,l.pickable))}s.verticalOffsets=T?_:null,r.offsetObb=T?Awe(r.obb,v,w,this._viewingMode,r.offsetObb!=null?r.offsetObb:tse(r.obb)):null,x||T||this._hasObjectAndLayerId?(n.componentParameters=new bO,n.componentParameters.castShadows=rV(y,s.count),n.componentParameters.transparent=rV(f,s.count),n.componentParameters.opaqueOverride=rV(m,s.count),n.componentParameters.texture=c,c.updateTexture()):(n.componentParameters=new NR,n.componentParameters.castShadows=l.castShadows?Gs.All:Gs.None,n.componentParameters.externalColor=l.externalColor,n.componentParameters.externalColorMixMode=l.externalColorMixMode),this._notifyDirty()}getComponentAabb(e,i,r,n=!1){e.intersectionGeometry.getComponentAabb(i,r);const s=e,o=s.components.verticalOffsets;if(n||o==null)return r;const a=o[i];if(this._viewingMode===Le.Local||a===0)return r[2]+=a,r[5]+=a,r;const l=VHe(a);return l.localOrigin=s.transform.position,l.applyToAabb(r)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,i,r){return e.intersectionGeometry.getComponentPositions(i,r)}intersect(e,i,r,n,s,o){const a=e;s!=null&&(s.localOrigin=a.transform.position);const l=Xx(Ude,a.transform.rotationScale);go(cD,i,a.transform.position),go(uD,r,a.transform.position),Nc(cD,cD,l),Nc(uD,uD,l);const c=nd(Ude,l);return a.intersectionGeometry.intersect(cD,uD,n,c,s,a.components.verticalOffsets,o)}addEdges(e,i,r,n){const s=e,{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets;return i.addComponentObject(e,s.transform,{center:s.obb.center,radius:FHe(s.obb)},a,o,l,r,n)}async extractEdgeInformation(e,i,r){const n=e,s=n.components.visibility;if(s.allInvisible())return{buffer:b1t.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets,c=vk.createBuffer(a.length/3);n$(c.position.typedBuffer,a,c.position.typedBufferStride,3),JCe(c.position,c.position,n.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const h=c.count,d=this._computeVisibilityIndices(o,s,l,h);return{origin:Qr(n.transform.position),buffer:await i.extractComponentsEdgeLocations({indices:d,indicesLength:d.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},r)}}_setComponentIndices(e,i,r){let n=0;for(let s=0;s<r.length-1;s++){const o=r[s],a=r[s+1];for(let l=o;l<a;l++){const c=i?i[l]:l;e.set(c,n)}n++}}_computeVisibilityIndices(e,i,r,n){if(e&&i.allVisible())return e;let s=0;i.forEachComponentRange((l,c)=>(s+=r[c]-r[l],!0));const o=Kh(e)?new Array(s):e?.BYTES_PER_ELEMENT===2||n<=65536?new Uint16Array(s):new Uint32Array(s);let a=0;return i.forEachComponentRange((l,c)=>{const h=r[l],d=r[c];for(let f=h;f<d;f++)o[a++]=e?e[f]:f;return!0}),o}addComponentHighlight(e,i){const r=e.components;r.highlightCounts==null&&(r.highlightCounts=new Uint32Array(r.count+1)),r.highlightCounts[i]++===0&&(r.highlightsDirty(),this._notifyDirty()),r.highlightCounts[r.count]++}removeComponentHighlight(e,i){const r=e.components;if(r.highlightCounts==null)return void kde.warn("Removing non-existing highlight.");const n=r.highlightCounts[i],s=r.highlightCounts[r.count];if(n!==0){if(n>1)return r.highlightCounts[i]=n-1,void(r.highlightCounts[r.count]=s-1);r.highlightCounts[i]=0,r.highlightsDirty(),this._notifyDirty(),s===1?r.highlightCounts=null:r.highlightCounts[r.count]=s-1}else kde.warn("Removing non-existing highlight.")}clearHighlights(e){const i=e.components;i.highlightCounts!=null&&(i.highlightCounts=null,i.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[dE.Visible]}_createRenderable(e,i){const r=this._renderManager.rctx,n=e.geometry,s=n.vertices.layoutParameters,o=Ui.createVertex(r,Ri.STATIC_DRAW,n.vertices.data),a=n.indices?Ui.createIndex(r,Ri.STATIC_DRAW,n.indices):null,l=Kc(qvt(s)),c=new Uint16Array(n.vertices.count);for(let _=0;_<i.count;_++){const v=i.offsets[_],w=i.offsets[_+1],x=i.materialDataIndices[_];if(n.indices!=null)for(let T=v;T<w;T++)c[n.indices[T]]=x;else for(let T=v;T<w;T++)c[T]=x}const h=Ui.createVertex(r,Ri.STATIC_DRAW,c.buffer),d=new ro(e.transform,e.toMapSpace),f=new ad(r,cPe,{data:l,componentIndices:E1t},{data:o,componentIndices:h},a),m=new Fvt(f,ci.TRIANGLES,s,a!=null),y={cameraDepthSquared:.5,gpuMemoryEstimate:o.byteLength+h.byteLength+(a!=null?a.byteLength:0)};return new Nvt(d,m,y)}_notifyDirty(){this._renderManager.notifyDirty()}};const E1t=Kc(Hr().u16(O.COMPONENTINDEX));function rV(t,e){return t===e?Gs.All:t===0?Gs.None:Gs.Some}const Ude=Ma(),cD=E(),uD=E();let Xee=class extends or{constructor(){super(...arguments),this.opacity=1}};function C1t(t){const e=new Ei;return e.include(Na),e.fragment.uniforms.add(new et("tex",i=>i.texture)),t.hasOpacityFactor&&e.fragment.uniforms.add(new Re("opacity",i=>i.opacity)),e.fragment.code.add(b`
    void main() {
      fragColor = texture(tex, uv) ${t.hasOpacityFactor?"* opacity":""};
    }`),e}const A1t=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:Xee,build:C1t},Symbol.toStringTag,{value:"Module"}));var Ea;(function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.PremultipliedAlpha=2]="PremultipliedAlpha",t[t.COUNT=3]="COUNT"})(Ea||(Ea={}));let Sk=class extends tc{constructor(){super(...arguments),this.alphaMode=Ea.None,this.hasOpacityFactor=!1}};u([U({count:Ea.COUNT})],Sk.prototype,"alphaMode",void 0),u([U()],Sk.prototype,"hasOpacityFactor",void 0);let Zee=class mPe extends Fi{initializeProgram(e){return new Mi(e.rctx,mPe.shader.get().build(this.configuration),Si)}initializePipeline(){switch(this.configuration.alphaMode){case Ea.None:return Lt({colorWrite:Gt});case Ea.Alpha:return Lt({blending:Go(Te.SRC_ALPHA,Te.ONE,Te.ONE_MINUS_SRC_ALPHA,Te.ONE_MINUS_SRC_ALPHA),colorWrite:Gt});case Ea.PremultipliedAlpha:case Ea.COUNT:return Lt({blending:Yc(Te.ONE,Te.ONE_MINUS_SRC_ALPHA),colorWrite:Gt})}}};Zee.shader=new Pi(A1t,()=>ce(()=>import("./Compositing.glsl-6dfb2970.js"),[],import.meta.url));let gPe=class extends or{};function O1t(){const t=new Ei;return t.include(Na),t.fragment.uniforms.add(new et("tex",e=>e.texture)),t.fragment.code.add(b`void main() {
fragColor = vec4(1.0 - texture(tex, uv).a);
}`),t}const R1t=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:gPe,build:O1t},Symbol.toStringTag,{value:"Module"}));let yPe=class _Pe extends Fi{initializeProgram(e){return new Mi(e.rctx,_Pe.shader.get().build(),Si)}initializePipeline(){return Lt({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}};yPe.shader=new Pi(R1t,()=>ce(()=>import("./HUDCompositing.glsl-627cb510.js"),[],import.meta.url));let vPe=class extends or{};function P1t(){const t=new Ei;return t.include(Na),t.fragment.uniforms.add(new et("colorTexture",e=>e.colorTexture),new et("alphaTexture",e=>e.alphaTexture),new et("frontFaceTexture",e=>e.frontFaceTexture)),t.fragment.code.add(b`void main() {
vec4 srcColor = texture(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture(alphaTexture, uv).r;
vec4 frontFace = texture(frontFaceTexture, uv);
fragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`),t}const M1t=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:vPe,build:P1t},Symbol.toStringTag,{value:"Module"}));let bPe=class wPe extends Fi{initializeProgram(e){return new Mi(e.rctx,wPe.shader.get().build(),Si)}initializePipeline(){return Lt({blending:Go(Te.SRC_ALPHA,Te.ONE,Te.ONE_MINUS_SRC_ALPHA,Te.ONE_MINUS_SRC_ALPHA),colorWrite:Gt})}};bPe.shader=new Pi(M1t,()=>ce(()=>import("./OITCompositing.glsl-096dab64.js"),[],import.meta.url));let $1t=class{constructor(e,i){this._rctx=e,this._techniqueRepository=i,this._configuration=new Sk,this._passParameters=new Xee,this._oitParameters=new vPe,this._hudParameters=new gPe}compositeOIT(e,i,r,n){this._oitParameters.colorTexture=i,this._oitParameters.alphaTexture=r,this._oitParameters.frontFaceTexture=n;const s=this._techniqueRepository.acquire(bPe);this._rctx.bindTechnique(s,this._oitParameters,e),this._rctx.screen.draw(),s.release()}compositeHUD(e,i){this._hudParameters.texture=i;const r=this._techniqueRepository.acquire(yPe);this._rctx.bindTechnique(r,this._hudParameters,e),this._rctx.screen.draw(),r.release()}composite(e,i,r=Ea.None,n=1){this._configuration.alphaMode=r,this._configuration.hasOpacityFactor=n!==1,this._passParameters.texture=i,this._passParameters.opacity=n;const s=this._techniqueRepository.acquire(Zee,this._configuration);this._rctx.bindTechnique(s,this._passParameters,e),this._rctx.screen.draw(),s.release()}};const I1t=1e4,tY=100,L1t=500,D1t=500,N1t=.1;function F1t(t,e,i){return HQ(e,t)*(i[1]-i[0])+i[0]}function k1t(t,e,i){let r=0;if(!e.some(s=>(r+=s.numGeometries,r>=I1t)))return q1t.compute(t,e);const n=s$();return i.forAll(s=>mC(n,U1t(t,s))),n}function U1t(t,e){if(!e.visible)return;const i=s$(),r=e.getSpatialQueryAccelerator();return r?z1t(i,t,r):B1t(i,t,e.objects),i}function z1t(t,e,i){const r=e.eye,n=e.viewForward,s=e.frustum,o=l=>l.visible,a=i.objectCount;if(a<L1t)jP(Ih,e.near,Math.min(t.near,e.far)),i.forEachInDepthRange(r,n,wp.DepthOrder.FRONT_TO_BACK,Ih,(l,c)=>{iY(t,e,l),Ih.far=t.near,c.setRange(Ih)},s,o),jP(Ih,Math.max(t.far,e.near),e.far),i.forEachInDepthRange(r,n,wp.DepthOrder.BACK_TO_FRONT,Ih,(l,c)=>{iY(t,e,l),Ih.near=t.far,c.setRange(Ih)},s,o);else{const l=Math.max(Math.min(a,D1t),Math.ceil(a*N1t)),c=i.findClosest(n,wp.DepthOrder.FRONT_TO_BACK,s,o,l),h=i.findClosest(n,wp.DepthOrder.BACK_TO_FRONT,s,o,l);c&&h&&(zde(t,e,c.boundingVolumeWorldSpace.bounds),zde(t,e,h.boundingVolumeWorldSpace.bounds))}}function B1t(t,e,i){dS.clear(),i.forAll(r=>{r.visible&&r.geometries.length!==0&&dS.add(r)}),dS.empty||(dS.sort(e),jP(Ih,e.near,Math.min(t.near,e.far)),dS.forEachInDepthRange(Ih,wp.DepthOrder.FRONT_TO_BACK,(r,n)=>{n<t.near&&iY(t,e,r)}),jP(Ih,Math.max(t.far,e.near),e.far),dS.forEachInDepthRange(Ih,wp.DepthOrder.BACK_TO_FRONT,(r,n,s)=>{t.far=Math.max(t.far,s)}))}function iY(t,e,i){if(!i.visible||!Q_(e.frustum,i.boundingVolumeWorldSpace.bounds))return;const r=i.transformation,n=H1t;i.geometries.forEach(s=>{qi(n,r,s.transformation);const o=WE(n);xPe(t,e,s.boundingInfo,n,o)})}function xPe(t,e,i,r,n){if(i==null)return;ke(ol,i.center,r);const{eye:s,viewForward:o}=e,a=o[0]*(ol[0]-s[0])+o[1]*(ol[1]-s[1])+o[2]*(ol[2]-s[2]);if(ol[3]=i.radius*n,!(a-ol[3]>t.near&&a+ol[3]<t.far)&&Q_(e.frustum,ol))if(i.radius>tY&&i.getChildren())for(const l of i.getChildren())xPe(t,e,l,r,n);else rY.unionDepthRangeWithAABB(t,e.viewProjectionMatrix,r,i.bbMin,i.bbMax)}function zde(t,e,i){const r=e.eye,n=e.viewForward,s=(i[0]-r[0])*n[0]+(i[1]-r[1])*n[1]+(i[2]-r[2])*n[2];t.near=Math.min(t.near,s-i[3]),t.far=Math.max(t.far,s+i[3])}let V1t=class{constructor(){this._items=new Ut({allocator:e=>e||{object:null,distance:0,near:0,far:0},deallocator:e=>(e.object=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().object=e}sort(e){const i=e.eye,r=e.viewForward;this._items.forAll(n=>{const s=n.object.boundingVolumeWorldSpace.bounds,o=(s[0]-i[0])*r[0]+(s[1]-i[1])*r[1]+(s[2]-i[2])*r[2];n.distance=o,n.near=o-s[3],n.far=o+s[3]}),this._items.sort((n,s)=>n.distance-s.distance)}forEachInDepthRange(e,i,r){if(i===wp.DepthOrder.FRONT_TO_BACK)for(let n=0;n<this._items.length;++n){const s=this._items.data[n];s.far<e.near||s.near>e.far||r(s.object,s.near,s.far)}else for(let n=this._items.length-1;n>=0;--n){const s=this._items.data[n];s.far<e.near||s.near>e.far||r(s.object,s.near,s.far)}}},G1t=class{constructor(){this._view=be(),this._viewProj=be(),this._frustum=SP(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(e,i){this._reset(),Qn(this._view,e.viewMatrix),qi(this._viewProj,e.projectionMatrix,this._view),wF(this._frustum,e.frustum);const r=this._view,n=r[2],s=r[6],o=r[10],a=r[14];i.forAll(f=>f.forEachGeometry(m=>{if(!m.visible||!m.castShadow)return;const y=m.boundingSphere,_=n*y[0]+s*y[1]+o*y[2]+a,v=_-y[3],w=_+y[3];this._geometries.push(m),this._near.push(-w),this._far.push(-v)}));const l=new Hee;if(this._geometries.length===0)return l;for(let f=0;f<this._geometries.length;++f)this._near[f]>l.far&&(l.far=this._near[f]),this._near[f]>2&&this._far[f]<l.near&&(l.near=this._far[f]);const c=this._looseRange;c.near=Math.max(.5*l.near,2),c.far=2*l.far;let h=0,d=0;for(let f=0;f<this._geometries.length;++f)this._near[f]<l.near&&(this._near[f]>=c.near?l.near=this._near[f]:this._nearCandidates[h++]=f),this._far[f]>l.far&&(this._far[f]<=c.far?l.far=this._far[f]:this._farCandidates[d++]=f);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((f,m)=>this._near[f]<this._near[m]?-1:this._near[f]>this._near[m]?1:0),this._farCandidates.sort((f,m)=>this._far[f]<this._far[m]?1:this._far[f]>this._far[m]?-1:0);for(let f=0;f<this._nearCandidates.length;++f){const m=this._nearCandidates[f];if(this._near[m]<l.near){const y=this._geometries[m],_=y.boundingInfo;this._includeNearBoundingInfoRec(_,y.shaderTransformation,l)}}for(let f=0;f<this._farCandidates.length;++f){const m=this._farCandidates[f];if(this._far[m]>l.far){const y=this._geometries[m],_=y.boundingInfo;this._includeFarBoundingInfoRec(_,y.shaderTransformation,l)}}return this._reset(),l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(e,i,r){if(e==null)return;const n=e.center;ke(ol,n,i);const s=WE(i),o=ol[0],a=ol[1],l=ol[2],c=e.radius*s,h=this._frustum;if(h[0][0]*o+h[0][1]*a+h[0][2]*l+h[0][3]>c||h[1][0]*o+h[1][1]*a+h[1][2]*l+h[1][3]>c||h[2][0]*o+h[2][1]*a+h[2][2]*l+h[2][3]>c||h[3][0]*o+h[3][1]*a+h[3][2]*l+h[3][3]>c)return;const d=this._view[2]*o+this._view[6]*a+this._view[10]*l+this._view[14],f=d+c;if(!(-(d-c)<2||-f>=r.near))if(-f>this._looseRange.near)r.near=-f;else{if(c>tY){const m=e.getChildren();if(m!==void 0){for(const y of m)this._includeNearBoundingInfoRec(y,i,r);return}}rY.unionDepthRangeWithAABB(r,this._viewProj,i,e.bbMin,e.bbMax)}}_includeFarBoundingInfoRec(e,i,r){if(e==null)return;let n=e.radius;const s=e.center;ke(ol,s,i);const o=WE(i),a=ol[0],l=ol[1],c=ol[2];n*=o;const h=this._frustum;if(h[0][0]*a+h[0][1]*l+h[0][2]*c+h[0][3]>n||h[1][0]*a+h[1][1]*l+h[1][2]*c+h[1][3]>n||h[2][0]*a+h[2][1]*l+h[2][2]*c+h[2][3]>n||h[3][0]*a+h[3][1]*l+h[3][2]*c+h[3][3]>n)return;const d=this._view[2]*a+this._view[6]*l+this._view[10]*c+this._view[14]-n;if(!(-d<=r.far))if(-d<this._looseRange.far)r.far=-d;else{if(n>tY){const f=e.getChildren();if(f!==void 0){for(const m of f)this._includeFarBoundingInfoRec(m,i,r);return}}rY.unionDepthRangeWithAABB(r,this._viewProj,i,e.bbMin,e.bbMax)}}},j1t=class{constructor(){this._modelViewProj=be(),this._clipPosition=[oi(),oi(),oi(),oi(),oi(),oi(),oi(),oi()]}unionDepthRangeWithAABB(e,i,r,n,s){const o=this._modelViewProj;qi(o,i,r);let a=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],h=l===0||l===3||l===4||l===7?n[0]:s[0],d=l===0||l===1||l===4||l===5?n[1]:s[1],f=l<4?n[2]:s[2];c[0]=o[0]*h+o[4]*d+o[8]*f+o[12],c[1]=o[1]*h+o[5]*d+o[9]*f+o[13],c[2]=o[2]*h+o[6]*d+o[10]*f+o[14],c[3]=o[3]*h+o[7]*d+o[11]*f+o[15]}for(let l=0;l<12;++l){const c=this._clipPosition[nV[l][0]],h=this._clipPosition[nV[l][1]],d=this._clipPosition[nV[l][2]],f=this._clipTriangle(c,h,d);let m=!0;for(let y=0;y<f.length;++y)if(f[y][3]>=2){m=!1;break}if(!m){a=!0;for(let y=0;y<f.length;++y){const _=f[y][3];Number.isFinite(_)&&(e.near=Math.min(_,e.near),e.far=Math.max(_,e.far))}}}return a}_inside(e,i){return i===0?e[0]>=-e[3]:i===1?e[1]>=-e[3]:i===2?e[0]<=e[3]:i===3?e[1]<=e[3]:void tt(!1)}_intersect(e,i,r){let n=0;return r===0?n=(-e[3]-e[0])/(i[0]-e[0]+i[3]-e[3]):r===1?n=(-e[3]-e[1])/(i[1]-e[1]+i[3]-e[3]):r===2?n=(e[3]-e[0])/(i[0]-e[0]-i[3]+e[3]):r===3&&(n=(e[3]-e[1])/(i[1]-e[1]-i[3]+e[3])),T6(oi(),e,i,n)}_clipTriangle(e,i,r){let n=[e,i,r];for(let s=0;s<4;++s){const o=n;n=[];for(let a=0;a<o.length;++a){const l=o[a],c=o[(a+1)%o.length];this._inside(c,s)?(this._inside(l,s)||n.push(this._intersect(l,c,s)),n.push(c)):this._inside(l,s)&&n.push(this._intersect(l,c,s))}}return n}};const nV=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],ol=kn(),H1t=be(),Ih=s$(),dS=new V1t,q1t=new G1t,rY=new j1t;let W1t=class{},Y1t=class extends or{constructor(){super(...arguments),this.textures=new W1t}};function X1t(){const t=new Ei;return t.attributes.add(O.POSITION,"vec2"),t.vertex.uniforms.add(new yi("drawPosition",(e,i)=>Z1t(e,i))),t.varyings.add("vUV","vec2"),t.vertex.code.add(b`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),t.fragment.uniforms.add(new et("textureInput",e=>e.textures.input)),t.fragment.uniforms.add(new et("textureMask",e=>e.textures.mask)),t.fragment.uniforms.add(new et("textureOverlay",e=>e.textures.overlay)),t.fragment.uniforms.add(new gm("maskEnabled",e=>e.magnifier.maskEnabled)),t.fragment.uniforms.add(new gm("overlayEnabled",e=>e.magnifier.overlayEnabled)),t.fragment.code.add(b`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),t}function Z1t(t,e){const i=e.camera.pixelRatio,r=t.magnifier.offset.x*i,n=t.magnifier.offset.y*i;fp(t.magnifier.position,Bde);const s=e.camera.screenToRender(Bde,J1t),o=Math.ceil(i*t.magnifier.size),a=e.camera.fullWidth,l=e.camera.fullHeight;return Gr(K1t,(s[0]+r)/a*2-1,(s[1]-n)/l*2-1,o/a*2,o/l*2)}const Bde=cn(),J1t=Jye(),K1t=oi();async function Q1t(t){const e=ce(()=>import("./mask-svg-023bbc42.js"),[],import.meta.url),i=ce(()=>import("./overlay-svg-d62383f3.js"),[],import.meta.url),r=Iy((await e).default,{signal:t}),n=Iy((await i).default,{signal:t}),s={mask:await r,overlay:await n};return Tt(t),s}let i2=class extends we{constructor(){super(...arguments),this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new Y1t,this.events=new Sn,this.attributeLocations=new Map([[O.POSITION,0]]),this._tmpScreenPoint=cn(),this._tmpRenderPoint=Jye()}get updating(){return this._imageSources==null&&this._imageLoadTask!=null&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this.removeAllHandles(),this._magnifier=e;const i=()=>{this._updateResourceLoading(),this.events.emit("request-render")};this._magnifier!=null&&this.addHandles(ne(()=>this._magnifier?.version,i)),i()}get enabled(){return this._validMagnifier!=null}get _validMagnifier(){return this._magnifier!=null&&this._magnifier.visible&&this._magnifier.position!=null&&this._magnifier.size>0?this._magnifier:null}get _factor(){return this._magnifier!=null&&this._magnifier.factor||1}destroy(){this._magnifier=null,this._imageLoadTask!=null&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,i){const r=this._validMagnifier;if(r==null)return;const n=i.camera.pixelRatio,s=Math.ceil(n*r.size);if(this._updateResources(e,s),this._resources==null)return;const o=this._passParameters.textures,a=Math.ceil(1/this._factor*s);o.input.resize(a,a),fp(r.position,this._tmpScreenPoint);const l=i.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),c=i.camera.fullWidth,h=i.camera.fullHeight,d=.5*a,f=.5*a;l[0]=_e(l[0],d,c-d-1),l[1]=_e(l[1],f,h-f-1);const m=Math.floor(l[0]-d),y=Math.floor(l[1]-f),_=this._resources.program;_.bindTexture("textureInput",o.input),e.gl.copyTexImage2D(o.input.descriptor.target,0,o.input.descriptor.pixelFormat,m,y,a,a,0),this._passParameters.magnifier=r,e.useProgram(_),_.bindPass(this._passParameters,i),e.bindVAO(this._resources.vao),e.setPipelineState(this._resources.pipelineState),e.drawArrays(ci.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(e==null)return;const i=e.maskUrl,r=e.overlayUrl;this._imageLoadTask==null||this._imageLoadTask.maskUrl===i&&this._imageLoadTask.overlayUrl===r||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),this._imageSources==null&&this._imageLoadTask==null&&(this._imageLoadTask={maskUrl:i,overlayUrl:r,task:Xv(async n=>{const s=i==null||r==null?Q1t(n):null,o=i!=null?Iy(i,{signal:n}):s.then(l=>l.mask),a=r!=null?Iy(r,{signal:n}):s.then(l=>l.overlay);this._imageSources={mask:await o,overlay:await a},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,i){if(!this.enabled)return void this._disposeResources();if(this._resources!=null){if(this._passParameters.textures.size!==i){const n=this._createTextureResources(e,i);if(n==null)return void this._disposeResources();this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=n}return}const r=this._createTextureResources(e,i);r!=null&&(this._resources={program:this._createProgram(e),vao:qm(e,vK,this.attributeLocations,0,1),pipelineState:Lt({blending:Yc(Te.ONE,Te.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:Gt})},this._passParameters.textures=r)}_disposeResources(){this._resources!=null&&(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,i){if(this._imageSources==null)return null;this._imageSources.overlay.width=i,this._imageSources.overlay.height=i,this._imageSources.mask.width=i,this._imageSources.mask.height=i;const r=new Hi;r.internalFormat=gt.RGBA,r.wrapMode=Vt.CLAMP_TO_EDGE,r.flipped=!0,r.preMultiplyAlpha=!Vge(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result;const n=new Nt(e,r,this._imageSources.overlay);r.pixelFormat=r.internalFormat=gt.ALPHA,r.preMultiplyAlpha=!1;const s=new Nt(e,r,this._imageSources.mask);return r.pixelFormat=r.internalFormat=gt.RGBA,r.flipped=!1,{input:new Nt(e,r),mask:s,overlay:n,size:i}}_createProgram(e){return new Mi(e,X1t(),this.attributeLocations)}};u([p()],i2.prototype,"_imageSources",void 0),u([p()],i2.prototype,"_imageLoadTask",void 0),u([p({readOnly:!0})],i2.prototype,"updating",null),i2=u([M("esri/views/3d/webgl-engine/lib/MagnifierHelper")],i2);let ebt=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new Ia(new ArrayBuffer(4)),this._uidToRenderColor=new Map,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new Map,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,i,r,n,s,o=null,a=null,l=null){if(!(e&&i&&r&&n)||(this._layerUidToId.set(n,r),this._layerUidToPopupEnabled.set(n,s),!s))return;let c=this._layerUidToGraphicsUidToObjectId.get(n);c||(c=new Map,this._layerUidToGraphicsUidToObjectId.set(n,c)),c.set(i,{objectId:e,attributeNodeId:o,attributeIndex:a,subLayerId:l})}getObjectAndLayerIdColor(e){const i=this.getObjectAndLayerIdColorArray(e);return Ft(i.get(0,1),i.get(0,2),i.get(0,3),255)}getObjectAndLayerIdColorArray(e){if(!e.layerUid||!e.graphicUid)return this.colorZero;const i=this._layerUidToPopupEnabled.get(e.layerUid);if(i===void 0)return K.getLogger(this).warn("popupEnabled is undefined for layerUid "+e.layerUid),this.colorZero;if(i===!1)return this.colorZero;let r=this._uidToRenderColor.get(e.layerUid);r||(r=new Map,this._uidToRenderColor.set(e.layerUid,r));let n=r.get(e.graphicUid);if(!n){for(;!n;){const o=Math.floor(16777214*Math.random())+1;this._colorToUID.has(o)||(n=o)}if(n>16777215)throw new Error("Object ID Overflow");r.set(e.graphicUid,n),this._colorToUID.set(n,e)}const s=new ArrayBuffer(4);return new DataView(s).setUint32(0,n,!1),new Ia(s)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[i,r]of this._colorToUID.entries()){const n=this._layerUidToGraphicsUidToObjectId.get(r.layerUid);let s=null;n?(s=n.get(r.graphicUid),s||K.getLogger(this).warn("getColorMapping: no entry found for graphicsId "+r.graphicUid)):K.getLogger(this).warn("getColorMapping: no entry found for layerUid "+r.layerUid);const o=this._layerUidToId.get(r.layerUid);o||K.getLogger(this).warn("no layerId found for uid "+r.layerUid),s&&o&&e.set(i,s.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:s.objectId,lid:o,attrId:s.attributeNodeId,attrIdx:s.attributeIndex,subLayerId:s.subLayerId}:{type:"object-and-layer-id",oid:s.objectId,lid:o})}return e}};var HP;(function(t){t[t.FrontToBack=0]="FrontToBack",t[t.BackToFront=1]="BackToFront"})(HP||(HP={}));let B0=class{constructor(e,i,r=HP.FrontToBack){this._rctx=e,this._techniqueRepository=i,this._sorting=r,this._draws=new Ut({initialSize:32,allocator:n=>n||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,i,r,n){const s=this._draws.pushNew();s.geometry=i,s.geometryRanges=r,s.material=e,s.depthSquaredHint=n,s.indexType=(i.indexed?i.vao.indexBuffer.indexType:null)??0}prepare(e,i){return this._draws.map(r=>r.material.prepareTechnique(this._techniqueRepository,e,i,r.geometry.parameters))}dispatch(e,i,r){const n=this._rctx;this._previouslyBoundDraw.clear();let s=null;const o=this._draws.length;for(let a=0;a<o;a++){const l=r[a];l===s&&l.configuration.transparencyPassType===it.NONE||(n.bindTechnique(l,e,i),s=l);const c=this._draws.data[a],h=c.geometry;n.bindVAO(h.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.program.bindDraw(c.material,i,e),this._previouslyBoundDraw.set(l,c.material));const d=c.geometryRanges,f=d.length;if(c.indexType!==0){const m=$4.get(c.indexType);for(let y=0;y<f;y+=2){const _=d[y],v=d[y+1];n.drawElements(h.primitiveType,v,c.indexType,_*m)}}else for(let m=0;m<f;m+=2){const y=d[m],_=d[m+1];n.drawArrays(h.primitiveType,y,_)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===HP.FrontToBack?1:-1;this._draws.sort((i,r)=>{const n=e*(i.depthSquaredHint-r.depthSquaredHint);return n!==0?n:i.geometry.vao.byteSize-r.geometry.vao.byteSize})}get count(){return this._draws.length}};const $4=new Map;$4.set(Qe.UNSIGNED_BYTE,1),$4.set(Qe.UNSIGNED_SHORT,2),$4.set(Qe.UNSIGNED_INT,4);let nY=class extends FJe{constructor(){super({}),this._passes=null,this.produces=new Map([[le.OPAQUE_MATERIAL,e=>this._produces(e)],[le.TRANSPARENT_MATERIAL,e=>!!(this._passes&&this._passes.materialTransparent.count>0)&&this._produces(e)],[le.INTEGRATED_MESH,e=>this._produces(e)]]),this._materialPassParameters=new vot,this._shadowPassParameters=new bot,this._highlightPassParameters=new wot,this._systems=new Set}initializeRenderContext(e){this._context=e;const i=e.renderContext.rctx,r=e.techniqueRepository;this._passes={materialOpaque:new B0(i,r),materialTransparent:new B0(i,r,HP.BackToFront),materialIntegratedMesh:new B0(i,r),shadowMap:new B0(i,r),highlight:new B0(i,r),highlightIntegratedMesh:new B0(i,r),highlightShadowMap:new B0(i,r),defaultShadowMap:new B0(i,r)}}get rctx(){return this._context.renderContext.rctx}uninitializeRenderContext(){}dispose(){this._context=null,this._systems.clear()}register(e){this._systems.add(e)}_produces(e){return this._systems.size!==0&&this._passes!==null&&(e===F.Highlight?this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0:e!==F.ShadowHighlight||this._passes.highlight.count>0)}prepareRender(e){if(this._systems.size!==0&&this._passes!==null){for(const i of Object.values(this._passes))i.prepareSubmit();this._systems.forEach(i=>i.submit(this._passes,e.bindParameters));for(const i of Object.values(this._passes))i.finishSubmit();this._context.techniqueRepository.frameUpdate()}}prepareTechniques(e){if(this._systems.size===0)return null;const i=e.output===F.Shadow||e.output===F.ShadowHighlight||e.output===F.ShadowExcludeHighlight?this._shadowPassParameters:e.output===F.Highlight?this._highlightPassParameters:this._materialPassParameters,r=e.bindParameters;return this._updateParameters(r.camera,i,r.slot===le.TRANSPARENT_MATERIAL),this._materialPassParameters.output=e.output,this._invoke(e,(n,s)=>n.prepare(s,e.bindParameters))}renderNode(e,i){this._invoke(e,(r,n)=>r.dispatch(n,e.bindParameters,i))}_invoke(e,i){if(this._passes===null)return null;switch(e.bindParameters.slot){case le.OPAQUE_MATERIAL:switch(e.output){case F.Color:case F.Depth:case F.Normal:case F.ObjectAndLayerIdColor:return i(this._passes.materialOpaque,this._materialPassParameters);case F.Highlight:return i(this._passes.highlight,this._highlightPassParameters);case F.Shadow:return i(this._passes.shadowMap,this._shadowPassParameters);case F.ShadowHighlight:return i(this._passes.highlightShadowMap,this._shadowPassParameters);case F.ShadowExcludeHighlight:return i(this._passes.defaultShadowMap,this._shadowPassParameters)}break;case le.TRANSPARENT_MATERIAL:switch(e.output){case F.Color:case F.Alpha:case F.Depth:case F.Normal:case F.ObjectAndLayerIdColor:return i(this._passes.materialTransparent,this._materialPassParameters)}break;case le.INTEGRATED_MESH:switch(e.output){case F.Color:case F.Depth:case F.Normal:case F.ObjectAndLayerIdColor:return i(this._passes.materialIntegratedMesh,this._materialPassParameters);case F.Highlight:return i(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}queryDepthRange(e){const i=new Hee;return this._systems.forEach(r=>mC(i,r.queryShadowCasterDepthRange(e))),i}_updateParameters(e,i,r){const n=e.viewInverseTransposeMatrix;ae(sV,n[3],n[7],n[11]),oV.set(sV),oe(i.transformWorldFromViewTH,oV.high),oe(i.transformWorldFromViewTL,oV.low),oe(i.slicePlaneLocalOrigin,sV),rd(i.transformViewFromCameraRelativeRS,e.viewMatrix),Qn(i.transformProjFromView,e.projectionMatrix),i.identifier===Dc.Material&&(this._materialPassParameters.transparent=r,nd(Vde,i.transformViewFromCameraRelativeRS),Xx(i.transformNormalViewFromGlobal,Vde))}};nY=u([M("esri.views.3d.webgl-engine.core.renderPasses.RenderPassManager")],nY);const sV=E(),Vde=nn(),oV=new y8;let tbt=class{constructor(e=null,i=null,r=null){this.composite=e,this.normal=i,this.highlight=r}},I4=class extends we{constructor(e){super({}),this._context=e,this._renderPlugins=new Ut,this._slots=new Array;for(let i=0;i<le.MAX_SLOTS;++i)this._slots[i]=[]}normalizeCtorArgs(){return{}}add(e,i){const r=()=>{if(i?.aborted)throw e.uninitializeRenderContext(),Ti();this._renderPlugins.push(e),e.produces.forEach((s,o)=>{this._slots[o].push(e)}),this._context.requestRender(),this.notifyChange("updating")},n=e.initializeRenderContext(this._context,i);if(Zc(n))return n.then(r);r()}remove(e){if(this._renderPlugins.removeUnordered(e)!=null){for(let i=0;i<this._slots.length;++i)this._slots[i]=this._slots[i].filter(r=>r!==e);e.uninitializeRenderContext(),this._context.requestRender(),this.notifyChange("updating")}}prepareRender(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this._context.renderContext)})}updateAnimation(e){let i=!1;return this._renderPlugins.forAll(r=>{r.updateAnimation&&(i=r.updateAnimation(e)||i)}),i}renderFeatureChanged(){this._renderPlugins.forAll(e=>{e.renderFeatureChanged&&e.renderFeatureChanged()})}prepare(e){this._context.renderContext.bindParameters.slot=e,this._slots[e].forEach(i=>{const r=i.produces.get(e);r&&r(F.Color)&&(Gde(i)&&i.prepareTechnique(this._context.renderContext),jde(i)&&i.prepareTechniques(this._context.renderContext))})}_getRenderables(e){this._context.renderContext.bindParameters.slot=e;const i=new Map;return this._slots[e].forEach(r=>{const n=r.produces.get(e);if(n&&n(F.Color)&&(!r.isDecoration||this._context.renderContext.bindParameters.decorations!==Uc.OFF))if(Gde(r)){const s=r.prepareTechnique(this._context.renderContext);s!=null&&i.set(r,s)}else if(jde(r)){const s=r.prepareTechniques(this._context.renderContext);s!=null&&i.set(r,s)}else i.set(r,null)}),i}render(e,i=null,r=null){return this._getRenderables(e).forEach((n,s)=>r=s.renderNode(this._context.renderContext,n,i,r)),r}renderComposition(e,i){const r=this._getRenderables(e);let n=null;return r.forEach((s,o)=>{const a=o.renderNode(this._context.renderContext,s,i,null);n?.release(),n=a,i.composite=n}),n}queryDepthRange(e){const i=new Hee;return this._renderPlugins.forAll(r=>{const n=r.queryDepthRange?.(e);mC(i,n)}),i}get updating(){return this._renderPlugins.some(e=>e.running)}produces(e,i=F.Color){return this._slots[e].some(r=>{const n=r.produces.get(e);return!!n&&n(i)})}consumes(e){return this._renderPlugins.some(i=>i.consumes().required.includes(e))}get hasDecorations(){return this._renderPlugins.some(e=>e.isDecoration)}get renderOccludedFlags(){return this._renderPlugins.reduce((e,i)=>e|i.renderOccludedFlags,Vr.None)}get usedMemory(){return this._renderPlugins.reduce((e,i)=>e+(i.usedMemory??0),0)}};function Gde(t){return"prepareTechnique"in t}function jde(t){return"prepareTechniques"in t}u([p({readOnly:!0})],I4.prototype,"updating",null),I4=u([M("esri.views.3d.webgl-engine.lib.RenderPluginManager")],I4);let r2=class extends Qx{constructor(e){super(e),this._context=null,this.opacity=1,this.alphaMode=Ea.None,this._blitConfiguration=new Sk,this._blitParameters=new Xee,this.produces=new Map([[le.BLIT,()=>this._context!=null]])}consumes(){return OSe}initializeRenderContext(e){this._context=e}uninitializeRenderContext(){this._context=null}destroy(){}renderNode(e,i,r,n){const s=r?.composite?.colorTexture;if(!this._context||!s)return n;const o=this._context.techniqueRepository.acquire(Zee,this._blitConfiguration);return o?.compiled?(e.rctx.bindFramebuffer(n?.fbo),this._blitParameters.texture=s,this._blitParameters.opacity=this.opacity,e.rctx.bindTechnique(o,this._blitParameters,e.bindParameters),e.rctx.screen.draw(),o.release(),n):(this._context.requestRender(),n)}};u([p()],r2.prototype,"_context",void 0),u([p()],r2.prototype,"opacity",void 0),u([p()],r2.prototype,"alphaMode",void 0),r2=u([M("esri.views.3d.webgl-engine.effects.blit.Blit")],r2);let TPe=class extends or{};function ibt(){const t=new Ei,{outputs:e,fragment:i}=t;return t.include(Na),i.uniforms.add(new Yh("textureInput",r=>r.input)),i.constants.add("outlineSize","int",Math.ceil(Jee/2)),e.add("fragGrid","vec2"),i.code.add(b`
    void main() {
      float red = 0.0;
      float green = 1.0;
      int cellSize = ${b.int(Hf)};
      vec2 texelSize = 1.0 / vec2(textureSize(textureInput, 0));
      vec2 offset = floor(gl_FragCoord.xy) * vec2(float(cellSize));

      for(int x = -outlineSize; x < cellSize + outlineSize; x += 2) {
        for(int y = -outlineSize; y < cellSize + outlineSize; y += 2) {
          vec2 coord = (offset + vec2(float(x), float(y))) * texelSize;
          vec4 value = texture(textureInput, coord);
          float mx = floor(max(value.g, value.b));

          red = max(red, ceil(value.r));
          green = min(green, mx);
          if(red == 1.0 && green == 0.0) {
            fragGrid = vec2(red, green);
            return;
          }
        }
      }
      fragGrid = vec2(red, green);
    }`),t}const Hf=32,Jee=9,SPe=.4,rbt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:TPe,blurSize:SPe,build:ibt,gridCellPixelSize:Hf,outlineSize:Jee},Symbol.toStringTag,{value:"Module"}));function nbt(){const t=new Ei,{vertex:e,fragment:i}=t,r=e.code,n=i.code;return t.attributes.add(O.POSITION,"vec2"),t.varyings.add("uv","vec2"),t.attributes.add(O.UV0,"vec2"),e.uniforms.add(new et("coverageTex",s=>s.coverageTexture),new Ki("coverageRounding",s=>s.coverageRounding)),r.add(b`void main() {
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),i.uniforms.add(new et("tex",s=>s.blurTexture),new et("highlightTexture",s=>s.highlightTexture),new yi("uColor",s=>s.color),new yi("haloColor",s=>s.haloColor),new yi("opacities",s=>Gr(sbt,s.haloOpacity,s.haloOpacityOccluded,s.fillOpacity,s.fillOpacityOccluded))),i.constants.add("outlineSize","float",Jee),i.constants.add("blurSize","float",SPe),n.add(b`void main() {
vec4 blurredHighlightValue = texture(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture(highlightTexture, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - (outlineSize - blurSize) / outlineSize;
float outlineFactor = smoothstep(0.0, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
fragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),t}const sbt=oi(),obt=Object.freeze(Object.defineProperty({__proto__:null,build:nbt},Symbol.toStringTag,{value:"Module"}));let EPe=class CPe extends Fi{initializeProgram(e){return new Mi(e.rctx,CPe.shader.get().build(),Si)}initializePipeline(){return Lt({blending:Go(Te.SRC_ALPHA,Te.ONE,Te.ONE_MINUS_SRC_ALPHA,Te.ONE_MINUS_SRC_ALPHA),colorWrite:Gt})}};EPe.shader=new Pi(obt,()=>ce(()=>import("./HighlightApply.glsl-81d8942d.js"),[],import.meta.url));let APe=class extends or{constructor(){super(...arguments),this.blurSize=Ge()}};function abt(){const t=new Ei,{attributes:e,varyings:i,vertex:r,fragment:n}=t;return e.add(O.POSITION,"vec2"),e.add(O.UV0,"vec2"),i.add("blurCoordinate","vec3"),r.uniforms.add(new et("coverageTex",s=>s.coverageTexture),new Ki("coverageRounding",s=>s.coverageRounding)),r.code.add(b`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), cov.g);
}`),n.uniforms.add(new tCe("blurSize",s=>s.blurSize),new Yh("tex",s=>s.blurInputTexture)),n.code.add(b`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture(tex, uv);
if (blurCoordinate.z == 1.0) {
fragColor = center;
} else {
vec4 sum = center * 0.204164;
sum += texture(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture(tex, uv - blurSize * 3.294215) * 0.093913;
fragColor = sum;
}
}`),t}const lbt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:APe,build:abt},Symbol.toStringTag,{value:"Module"}));let OPe=class RPe extends Fi{initializeProgram(e){return new Mi(e.rctx,RPe.shader.get().build(),Si)}initializePipeline(){return Lt({colorWrite:Gt})}};OPe.shader=new Pi(lbt,()=>ce(()=>import("./HighlightBlur.glsl-841a1322.js"),[],import.meta.url));let PPe=class MPe extends Fi{initializeProgram(e){return new Mi(e.rctx,MPe.shader.get().build(),Si)}initializePipeline(){return Lt({colorWrite:Gt})}};PPe.shader=new Pi(rbt,()=>ce(()=>import("./HighlightDownsample.glsl-076742fe.js"),[],import.meta.url));let cbt=class extends or{constructor(){super(...arguments),this.color=Ft(1,0,1,1),this.haloColor=Ft(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.coverageRounding=pi(1,1)}},wO=class extends Qx{constructor(e){super(e),this._context=null,this._passParameters=new cbt,this._downsampleDrawParameters=new TPe,this._blurDrawParameters=new APe,this._blurColorFormat=ie("mac")?xi.RGBA:xi.RGBA4,this._grid={coverage:null,vao:null,verticalCellCount:0,horizontalCellCount:0,viewportWidth:0,viewportHeight:0},this.produces=new Map([[le.HIGHLIGHT,()=>!0]])}consumes(){return RSe}initializeRenderContext(e){this._context=e,this._blurTechnique==null&&(this._blurTechnique=this._context.techniqueRepository.acquire(OPe)),this._downsampleTechnique==null&&(this._downsampleTechnique=this._context.techniqueRepository.acquire(PPe)),this._applyTechnique==null&&(this._applyTechnique=this._context.techniqueRepository.acquire(EPe)),this.addHandles([ne(()=>this.view.highlightOptions.color,i=>{this._passParameters.color=wP(i??BOe),this.view.highlightOptions.haloColor||(this._passParameters.haloColor=this._passParameters.color),this._context.requestRender()},Ji),ne(()=>this.view.highlightOptions.haloColor,i=>{this._passParameters.haloColor=i!=null?wP(i):this._passParameters.color,this._context.requestRender()},Ji),ne(()=>this.view.highlightOptions.haloOpacity,i=>{this._passParameters.haloOpacity=i??VOe,this._passParameters.haloOpacityOccluded=.25*this._passParameters.haloOpacity,this._context.requestRender()},Ji),ne(()=>this.view.highlightOptions.fillOpacity,i=>{this._passParameters.fillOpacity=i??GOe,this._passParameters.fillOpacityOccluded=.25*this._passParameters.fillOpacity,this._context.requestRender()},Ji)])}uninitializeRenderContext(){this._context=null}dispose(){this._blurTechnique=li(this._blurTechnique),this._downsampleTechnique=li(this._downsampleTechnique),this._applyTechnique=li(this._applyTechnique),this._grid.coverage=li(this._grid.coverage),this._grid.vao=rt(this._grid.vao)}renderNode(e,i,r,n){const s=r?.highlight?.colorTexture;if(!this._context||!s)return;if(!(this._blurTechnique.compiled&&this._downsampleTechnique.compiled&&this._applyTechnique.compiled))return void this._context.requestRender();const o=e.bindParameters.camera,a=o.fullWidth,l=o.fullHeight,c=o.pixelRatio,h=Math.ceil(a/c),d=Math.ceil(l/c),f=this._context.fbos,m=f.rctx;this._gridUpdateResources(s),this._gridComputeCoverage(s,e.bindParameters),this._passParameters.highlightTexture=s,this._passParameters.coverageTexture=this._grid.coverage?.colorTexture;const{width:y,height:_}=s.descriptor;mi(this._passParameters.coverageRounding,y/(Math.ceil(y/Hf)*Hf),_/(Math.ceil(_/Hf)*Hf));const v=m.bindTechnique(this._blurTechnique,this._passParameters,e.bindParameters),w=this._grid.vao;m.bindVAO(w);const x=f.acquire(this._blurColorFormat,h,d);m.bindFramebuffer(x.fbo),m.setViewport(0,0,h,d),m.clear(wr.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=s,mi(this._blurDrawParameters.blurSize,1/h,0),v.bindDraw(this._blurDrawParameters,e.bindParameters,this._passParameters),m.drawArrays(this._blurTechnique.primitiveType,0,uy(w,"geometry"));const T=f.acquire(this._blurColorFormat,h,d);m.bindFramebuffer(T.fbo),m.clear(wr.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=x.colorTexture,mi(this._blurDrawParameters.blurSize,0,1/d),v.bindDraw(this._blurDrawParameters,e.bindParameters,this._passParameters),m.drawArrays(this._blurTechnique.primitiveType,0,uy(w,"geometry")),m.bindFramebuffer(n?.fbo),m.setViewport4fv(o.fullViewport),this._passParameters.blurTexture=T.colorTexture,m.bindTechnique(this._applyTechnique,this._passParameters,e.bindParameters),m.drawArrays(this._applyTechnique.primitiveType,0,uy(w,"geometry")),T.release(),x.release()}_gridUpdateResources(e){if(!this._context)return;const i=this._context.fbos.rctx,r=this._grid,n=Math.ceil(e.descriptor.height/Hf),s=Math.ceil(e.descriptor.width/Hf);if(r.vao&&r.verticalCellCount===n&&r.horizontalCellCount===s)return;r.verticalCellCount=n,r.horizontalCellCount=s;const o=n+1,a=s+1,l=1/n,c=1/s,h=new Float32Array(6*4*o*a);let d=0;for(let f=0;f<o;f++)for(let m=0;m<a;m++)h[d++]=(m-.5)*c*2-1,h[d++]=(f-.5)*l*2-1,h[d++]=m*c,h[d++]=f*l,h[d++]=(m+.5)*c*2-1,h[d++]=(f-.5)*l*2-1,h[d++]=m*c,h[d++]=f*l,h[d++]=(m-.5)*c*2-1,h[d++]=(f+.5)*l*2-1,h[d++]=m*c,h[d++]=f*l,h[d++]=(m-.5)*c*2-1,h[d++]=(f+.5)*l*2-1,h[d++]=m*c,h[d++]=f*l,h[d++]=(m+.5)*c*2-1,h[d++]=(f-.5)*l*2-1,h[d++]=m*c,h[d++]=f*l,h[d++]=(m+.5)*c*2-1,h[d++]=(f+.5)*l*2-1,h[d++]=m*c,h[d++]=f*l;r.vao?.dispose(),r.vao=new Hp(i,Si,{geometry:NM},{geometry:Ui.createVertex(i,Ri.STATIC_DRAW,h)})}_gridComputeCoverage(e,i){if(!this._context)return;const r=this._context.fbos.rctx,n=this._grid,s=e.descriptor,o=Math.ceil(s.width/Hf),a=Math.ceil(s.height/Hf);n.coverage?.release(),n.coverage=this._context.fbos.acquire(xi.RG,o,a),this._downsampleDrawParameters.input=e,r.bindFramebuffer(n.coverage.fbo),r.bindTechnique(this._downsampleTechnique,this._passParameters,i).bindDraw(this._downsampleDrawParameters,i,this._passParameters),r.setViewport(0,0,o,a),r.screen.draw()}get test(){return{coverage:this._grid.coverage}}};u([p()],wO.prototype,"_context",void 0),u([p()],wO.prototype,"view",void 0),wO=u([M("esri.views.3d.webgl-engine.effects.highlight.Highlight")],wO);let Kee=class extends tc{constructor(){super(...arguments),this.receiveShadows=!0}};u([U()],Kee.prototype,"receiveShadows",void 0);const ubt=.99999,hbt=.025;function dbt(t){const e=new Ei;e.include(Ox,t),e.include(ZU),e.include(Na);const i=e.fragment;return i.include(dd),i.include(od),i.uniforms.add(new et("defaultDepthTex",(r,n)=>n.shadowMap.getSnapshot(hC.Default)),new et("highlightDepthTex",(r,n)=>n.shadowMap.getSnapshot(hC.Highlight)),new et("depthMap",(r,n)=>n.linearDepth?.colorTexture),new et("highlightTexture",r=>r.highlight),new yi("uColor",r=>r.shadowColor),new Ki("nearFar",(r,n)=>n.camera.nearFar),new Re("opacity",r=>r.shadowOpacity),new Re("occludedOpacity",r=>r.occludedShadowOpacity),new Re("terminationFactor",r=>r.opacityElevation*r.dayNightTerminator),new kt("lightingMainDirectionView",(r,n)=>ye(qde,ke(qde,n.lighting.mainLight.direction,n.camera.viewInverseTransposeMatrix))),new en("inverseViewMatrix",(r,n)=>fs(Hde,Kl(Hde,n.camera.viewMatrix,n.camera.center)))),i.constants.add("unoccludedHighlightFlag","vec4",yQ),i.code.add(b`
    vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, ivec2 iuv) {
      float leftPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(-1, 0), 0), nearFar);
      float rightPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(1, 0), 0), nearFar);
      float bottomPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(0, -1), 0), nearFar);
      float topPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(0, 1), 0), nearFar);

      bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
      bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);

      vec3 fragCoordHorizontal = pickLeft
                                  ? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
                                  : vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
      vec3 fragCoordVertical = pickBottom
                                  ? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
                                  : vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);

      vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
      vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);

      vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
      // Flip normal depending on triangle winding order for consistency
      return pickLeft == pickBottom ? normal : -normal;
    }

    void main(void) {
      vec4 highlightInfo = texture(highlightTexture, uv);
      float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
      if (visiblyHighlighted > ${b.float(ubt)}) {
        discard;
      }

      ivec2 iuv = ivec2(uv * vec2(textureSize(depthMap, 0)));
      float depth = rgba2float(texelFetch(depthMap, iuv, 0));
      // 0.0 is the clear value of depthMap, which means nothing has been drawn there and we should discard
      if (depth == 0.0) {
        discard;
      }

      float currentPixelDepth = linearDepthFromFloat(depth, nearFar);

      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        discard;
      }

      vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
      vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;

      mat4 shadowMatrix;
      float linearDepth = -currentPixelDepth;
      int i = chooseCascade(linearDepth, shadowMatrix);

      if (i >= numCascades) {
        discard;
      }

      vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
        discard;
      }

      ivec2 texSize = textureSize(highlightDepthTex, 0);
      ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));

      float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
      bool shadowHighlight = depthHighlight < lvpos.z;

      if (!shadowHighlight) {
        discard;
      }

      float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
      bool shadowDefault = depthDefault < lvpos.z;

      vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, iuv);
      bool shaded = dot(normal, lightingMainDirectionView) < ${b.float(hbt)};

      float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
      fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
    }
  `),e}const Hde=be(),qde=E(),pbt=Object.freeze(Object.defineProperty({__proto__:null,build:dbt},Symbol.toStringTag,{value:"Module"}));let fbt=class extends PQ{constructor(){super(...arguments),this.shadowColor=Ft(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},$Pe=class IPe extends Fi{constructor(e){super(e,new Kee,()=>this.destroy())}initializeProgram(e){return new Mi(e.rctx,IPe.shader.get().build(this.configuration),Si)}initializePipeline(){return Lt({blending:Go(Te.SRC_ALPHA,Te.ONE,Te.ONE_MINUS_SRC_ALPHA,Te.ONE_MINUS_SRC_ALPHA),colorWrite:Gt,depthTest:null,depthWrite:null})}get primitiveType(){return ci.TRIANGLE_STRIP}};$Pe.shader=new Pi(pbt,()=>ce(()=>import("./ShadowHighlight.glsl-48d8a978.js"),[],import.meta.url));const mbt=.001953125,gbt=4e4,ybt=5e4;let n2=class extends Qx{constructor(e){super(e),this._maxOpacity=1,this._passParameters=new fbt,this._drawParameters=new mnt,this._shadowDifference=.2,this._context=null,this.produces=new Map([[le.SHADOW_HIGHLIGHT,()=>this._isVisible]])}consumes(){return RSe}initializeRenderContext(e){this._context=e,this.addHandles([ne(()=>this.view.highlightOptions.shadowOpacity,i=>{this._passParameters.shadowOpacity=i??HOe,this._updateOccludedShadowOpacity(),this._updateMaxOpacity()},Ji),ne(()=>this.view.highlightOptions.shadowDifference,i=>{this._shadowDifference=i??qOe,this._updateOccludedShadowOpacity(),this._updateMaxOpacity()},Ji),ne(()=>this.view.highlightOptions.shadowColor,i=>{this._passParameters.shadowColor=wP(i??jOe),this._updateMaxOpacity()},Ji)])}_updateOccludedShadowOpacity(){this._passParameters.occludedShadowOpacity=this._passParameters.shadowOpacity*(1-this._shadowDifference)}_updateMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3]}uninitializeRenderContext(){this._context=null}enable(){this._context&&this._technique==null&&(this._technique=this._context.techniqueRepository.acquire($Pe))}renderNode(e,i,r,n){const s=r?.highlight?.colorTexture;if(!(this._context&&r&&s&&this._isVisible))return;if(!this._technique?.compiled)return void this._context.requestRender();const o=e.bindParameters;if(!o.shadowMap.enabled||!o.linearDepth)return;const a=e.rctx,l=this._technique;this._passParameters.highlight=s,this._drawParameters.origin=o.camera.center,a.bindFramebuffer(n?.fbo),a.bindTechnique(l,this._passParameters,o).bindDraw(this._drawParameters,o,this._passParameters),a.screen.draw()}updateParameters(e,i){this._passParameters.opacityElevation=1-tP(gbt,ybt,e.relativeElevation);const r=this.viewingMode===Le.Global?ye(Wde,e.center):ae(Wde,0,0,1),n=ge(r,i);this._passParameters.dayNightTerminator=tP(0,1,_e(30*n,0,1)),this._isVisible&&this.enable()}get _isVisible(){const{opacityElevation:e,dayNightTerminator:i}=this._passParameters;return this._maxOpacity*e*i>=mbt}};u([p()],n2.prototype,"_context",void 0),u([p()],n2.prototype,"view",void 0),u([p()],n2.prototype,"viewingMode",void 0),n2=u([M("esri.views.3d.webgl-engine.effects.highlight.ShadowHighlight")],n2);const Wde=E(),pS={maxSearchSteps:8,maxDistanceAreaTex:16};function _bt(){const t=new Ei;return t.include(Na),t.fragment.uniforms.add(new et("edgesTexture",e=>e.inputTexture)),t.fragment.uniforms.add(new et("areaTexture",e=>e.areaTexture)),t.fragment.uniforms.add(new et("searchTexture",e=>e.searchTexture)),t.fragment.code.add(b`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 sampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset, vec2 resolution) {
        return texture(tex, coord + offset.x * resolution, 0.0);
      }

      float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
        e.r = bias + e.r * scale;
        return 255.0 * texture( searchTex, e, 0.0 ).r;
      }

      float searchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${b.int(pS.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float searchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${b.int(pS.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float searchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${b.int(pS.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${b.int(pS.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${b.int(pS.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture( areaTex, texcoord, 0.0 ).rg;
      }

      void main() {
        vec2 size = vec2(textureSize(edgesTexture, 0));
        vec2 resolution = 1.0 / size;
        vec2 pixelCoord = uv * size;
        vec4 offsets[2];
        offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        vec4 maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${b.int(pS.maxSearchSteps)} );

        ivec4 subsampleIndices = ivec4(0.0);
        vec4 weights = vec4(0.0);
        vec2 e = texture( edgesTexture, uv ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = searchXLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x, resolution );
          coords.y = offsets[1].y;
          d.x = coords.x;
          float e1 = texture( edgesTexture, coords, 0.0 ).r;
          coords.x = searchXRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y, resolution );
          d.y = coords.x;
          d = d * size.x - pixelCoord.x;
          vec2 sqrt_d = sqrt( abs(d) );
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ), resolution).r;
          weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = searchYUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z, resolution );
          coords.x = offsets[0].x;
          d.x = coords.y;
          float e1 = texture( edgesTexture, coords, 0.0 ).g;
          coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w, resolution );
          d.y = coords.y;
          d = d * size.y - pixelCoord.y;
          vec2 sqrt_d = sqrt(abs(d));
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0), resolution).g;
          weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
        }
        fragColor = weights;
      }
    `),t}const vbt=Object.freeze(Object.defineProperty({__proto__:null,build:_bt},Symbol.toStringTag,{value:"Module"}));let LPe=class DPe extends Fi{initializeProgram(e){return new Mi(e.rctx,DPe.shader.get().build(),Si)}initializePipeline(){return Lt({colorWrite:Gt})}};LPe.shader=new Pi(vbt,()=>ce(()=>import("./BlendWeights.glsl-6cd4d6e9.js"),[],import.meta.url));function bbt(){const t=new Ei;return t.include(Na),t.fragment.uniforms.add(new et("blendWeightsTexture",e=>e.inputTexture),new et("colorTexture",e=>e.color)),t.fragment.code.add(b`void main() {
vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
vec4 offsets = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets.zw).g;
a.a = texture(blendWeightsTexture, offsets.xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}
}`),t}const wbt=Object.freeze(Object.defineProperty({__proto__:null,build:bbt},Symbol.toStringTag,{value:"Module"}));let NPe=class FPe extends Fi{initializeProgram(e){return new Mi(e.rctx,FPe.shader.get().build(),Si)}initializePipeline(){return Lt({colorWrite:Gt})}};NPe.shader=new Pi(wbt,()=>ce(()=>import("./Blur.glsl-e07f5898.js"),[],import.meta.url));const Yde={threshold:.05,localConstrastAdaption:2};function xbt(){const t=new Ei;return t.include(Na),t.fragment.uniforms.add(new et("colorTexture",e=>e.color)),t.outputs.add("fragEdges","vec2"),t.fragment.code.add(b`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
      vec4 offsets[3];
      offsets[0] = vec4(uv.x - resolution.x, uv.y, uv.x, uv.y + resolution.y);
      offsets[1] = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
      offsets[2] = vec4(uv.x - 2.0 * resolution.x, uv.y, uv.x, uv.y + 2.0 * resolution.y);

      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture(colorTexture, uv).rgb;

      vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${b.float(Yde.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges *= step(maxDelta, float(${b.float(Yde.localConstrastAdaption)}) * delta.xy);

      fragEdges = edges;
    }
  `),t}const Tbt=Object.freeze(Object.defineProperty({__proto__:null,build:xbt},Symbol.toStringTag,{value:"Module"}));let kPe=class UPe extends Fi{initializeProgram(e){return new Mi(e.rctx,UPe.shader.get().build(),Si)}initializePipeline(){return Lt({colorWrite:Gt})}};kPe.shader=new Pi(Tbt,()=>ce(()=>import("./EdgeDetect.glsl-20c1c4e9.js"),[],import.meta.url));let Sbt=class extends or{},jb=class extends Qx{constructor(e){super(e),this._context=null,this._areaTexture=null,this._searchTexture=null,this._isEnabled=!1,this._smaaParameters=new Sbt,this.produces=new Map([[le.ANTIALIASING,()=>this._isEnabled&&this._context!=null]])}consumes(){return OSe}get updating(){return this._abortController!=null}initializeRenderContext(e){this._context=e,this.addHandles([ne(()=>this.view.qualitySettings.antialiasingEnabled,i=>i||this._context?.isFeatureEnabled(hs.Antialiasing)?this.enable():this.disable(),Ji)])}renderFeatureChanged(){this.view.qualitySettings.antialiasingEnabled||this._context?.isFeatureEnabled(hs.Antialiasing)?this.enable():this.disable()}uninitializeRenderContext(){this.disable(),this._context=null}enable(){if(this._isEnabled||!this._context||this._abortController)return;if(this._edgeTechnique==null&&(this._edgeTechnique=this._context.techniqueRepository.acquire(kPe)),this._blendTechnique==null&&(this._blendTechnique=this._context.techniqueRepository.acquire(LPe)),this._blurTechnique==null&&(this._blurTechnique=this._context.techniqueRepository.acquire(NPe)),this._areaTexture&&this._searchTexture)return void(this._isEnabled=!0);this._abortController=new AbortController;const e=this._abortController.signal;ce(()=>import("./SMAAData-660b7d34.js"),[],import.meta.url).then(i=>this._loadTextures(this._context,i,e)).then(()=>{this._context?.requestRender(),this._abortController=null}).catch(i=>{Tn(i)||this._disposeTextures()})}_loadTextures(e,i,r){return Tt(r),e?Promise.all([Iy(i.areaTexture).then(n=>Xde(e.fbos.rctx,zt.LINEAR,gt.RGB,n)),Iy(i.searchTexure).then(n=>Xde(e.fbos.rctx,zt.NEAREST,gt.LUMINANCE,n))]).then(([n,s])=>{ps(r)?(n.dispose(),s.dispose(),Tt(r)):(this._areaTexture=n,this._searchTexture=s,this._isEnabled=!0)}):Promise.reject()}_disposeTextures(){this._areaTexture=rt(this._areaTexture),this._searchTexture=rt(this._searchTexture)}disable(){this._abortController=Gc(this._abortController),this._isEnabled=!1}destroy(){this.disable(),this._disposeTextures()}renderNode(e,i,r,n){const s=r?.composite?.colorTexture;if(!(this._isEnabled&&this._context&&r&&s))return n;if(!(this._edgeTechnique?.compiled&&this._blendTechnique?.compiled&&this._blurTechnique?.compiled))return this._context.requestRender(),n;const o=s.descriptor.width,a=s.descriptor.height,l=this._context.fbos,c=e.rctx;c.setViewport(0,0,o,a);const h=l.acquire(xi.RG,o,a);c.bindFramebuffer(h.fbo),c.setClearColor(0,0,0,1),c.clear(wr.COLOR_BUFFER_BIT),this._smaaParameters.color=s,c.bindTechnique(this._edgeTechnique,this._smaaParameters),c.screen.draw();const d=l.acquire(xi.RGBA,o,a);return c.bindFramebuffer(d.fbo),c.setClearColor(0,0,1,1),c.clear(wr.COLOR_BUFFER_BIT),this._smaaParameters.inputTexture=h.colorTexture,this._smaaParameters.areaTexture=this._areaTexture,this._smaaParameters.searchTexture=this._searchTexture,c.bindTechnique(this._blendTechnique,this._smaaParameters),c.screen.draw(),c.bindFramebuffer(n?.fbo),h.release(),c.setClearColor(0,1,0,1),c.clear(wr.COLOR_BUFFER_BIT),this._smaaParameters.inputTexture=d.colorTexture,c.bindTechnique(this._blurTechnique,this._smaaParameters),c.screen.draw(),d.release(),n}};function Xde(t,e,i,r){const n=new Hi;return n.pixelFormat=i,n.wrapMode=Vt.CLAMP_TO_EDGE,n.width=r.width,n.height=r.height,n.samplingMode=e,new Nt(t,n,r)}u([p()],jb.prototype,"view",void 0),u([p()],jb.prototype,"_context",void 0),u([p()],jb.prototype,"_abortController",void 0),u([p({readOnly:!0})],jb.prototype,"updating",null),jb=u([M("esri.views.3d.webgl-engine.effects.smaa.SMAA")],jb);let Ebt=class{constructor(){this._step=Kde,this._dilation=1,this._firstIdleTime=0}frame(e,i){if(i?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,ie("disable-feature:high-quality-idle"))this._dilation=1;else{const n=i?performance.now()-this._firstIdleTime:0;if(n>=Zde+Abt)return this._step=1/0,void(this._dilation=1);this._dilation=n>=Zde?Obt:1}const r=_e(e/Cbt,Kde,Pbt);this._step===1/0?this._step=r:this._step=this._step*Jde+r*(1-Jde)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}};const Cbt=.5,Zde=12e4,Abt=1e4,Obt=10,Jde=.9,Rbt=30,Kde=1e3/1,Pbt=1e3/Rbt;let Mbt=class{constructor(e,i){this._fbos=e,this.compositingHelper=i,this._width=4,this._height=4}dispose(){this._color=li(this._color),this.releaseBuffers()}get framebuffer(){return this.color.detachDepth(),this.color.attachDepth(this.depth),this.color.fbo}get colorTexture(){return this.color.colorTexture}get depthTexture(){return this.depth.attachment}initializeFrame(e,i,r){this._fbos.interactive=!r;const n=this._fbos.rctx;this._width=e.fullWidth,this._height=e.fullHeight,Pw(this,n.parameters.maxTextureSize);const s=this._color;return this._color=null,this.releaseBuffers(),this.bindFbo(),n.setClearStencil(0),n.setClearColor(i[0],i[1],i[2],i[3]),n.clearSafe(wr.COLOR_BUFFER_BIT|wr.DEPTH_BUFFER_BIT|wr.STENCIL_BUFFER_BIT),s}releaseBuffers(){this._color?.detachDepth(),this._depth=li(this._depth)}renderHUDVisibility(e,i,r){return e?.fbo.width===this._width&&e?.fbo.height===this._height||(e?.release(),e=this._fbos.acquire(xi.RGBA4,this._width,this._height)),e.attachDepth(r||this.depth),this._fbos.rctx.bindFramebuffer(e.fbo),this.renderToFBO(i,$bt),e.detachDepth(),e}compositeToHUDVisibility(e,i){this._fbos.rctx.bindFramebuffer(e.hudVisibility?.fbo),this.compositingHelper.compositeHUD(e,i)}renderOITPass(e,i,r){let n,s;switch(i){case it.Color:n=this._fbos.acquire(xi.RGBA16F,this._width,this._height),s=[0,0,0,0];break;case it.Alpha:n=this._fbos.acquire(xi.R16F,this._width,this._height),s=[1,1,1,1];break;case it.FrontFace:n=this._fbos.acquire(xi.RGBA,this._width,this._height),s=[0,0,0,0]}return r?(n.acquireDepth(As.DEPTH16_BUFFER),this._fbos.rctx.bindFramebuffer(n.fbo),this.renderToFBO(e,s,!0,!0),n.releaseDepth()):(n.attachDepth(this.depth),this._fbos.rctx.bindFramebuffer(n.fbo),this.renderToFBO(e,s),n.detachDepth()),n}compositeToFramebuffer(e,i,r,n){this.bindFbo(),this.compositingHelper.composite(e,i,r,n)}compositeTransparentOntoOpaque(e,i,r,n,s){s?(this._fbos.rctx.bindFramebuffer(s.fbo),this._fbos.rctx.setClearColor(0,0,0,1e-13),this._fbos.rctx.clearSafe(wr.COLOR_BUFFER_BIT)):this.bindFbo(),this.compositingHelper.compositeOIT(e,i.colorTexture,r.colorTexture,n.colorTexture)}renderDepthDetached(e){this._bindTarget(this.color),e(),this._bindTarget(this.color,this.depth)}renderToCachedFBO(e,i,r,n=xi.RGBA,s=As.DEPTH16_BUFFER,o=this._width,a=this._height,l=null){return e?.fbo.width===o&&e?.fbo.height===a||(e=li(e)),e=e??this._fbos.acquire(n,o,a),s!=null&&e.acquireDepth(s),l?.forEach(c=>{e.acquireColor(c.format,c.attachment)}),this._fbos.rctx.bindFramebuffer(e.fbo),this.renderToFBO(i,r,!0,!0),e}renderToFBO(e,i,r=!1,n=!1){const s=this._fbos.rctx;let o=0;if(i){const l=Math.max(1e-13,i[3]);s.setClearColor(i[0],i[1],i[2],l),o|=wr.COLOR_BUFFER_BIT}r&&(o|=wr.DEPTH_BUFFER_BIT),n===!1?n=0:(n===!0&&(n=255),o|=wr.STENCIL_BUFFER_BIT),o&&s.clearSafe(o,n),e(),s.gl.flush()}renderToTargets(e,i,r,n,s=!1,o=!1){this._bindTarget(i,r),this.renderToFBO(e,n,s,o),i.detachDepth()}bindFbo(){this._bindTarget(this.color,this.depth)}_bindTarget(e,i){e.detachDepth(),e.attachDepth(i),this._fbos.rctx.bindFramebuffer(e.fbo)}get width(){return this._width}get height(){return this._height}get color(){return this._color||(this._color=this._fbos.acquire(xi.RGBA,this._width,this._height)),this._color}get depth(){return this._depth||(this._depth=this._fbos.acquireDepth(As.DEPTH_STENCIL_TEXTURE,this._width,this._height)),this._depth}};const $bt=[0,1,0,1],_8=255,Ibt=1/_8;function Lbt(t){const e=new Ei,i=e.fragment;return i.include(dd),i.include(od),e.include(ZU),e.include(Na),e.include(JU,t),i.uniforms.add(new et("depthMap",(r,n)=>n.linearDepth?.colorTexture),new en("inverseViewMatrix",(r,n)=>fs(Qde,Kl(Qde,n.camera.viewMatrix,n.camera.center))),new Ki("nearFar",(r,n)=>n.camera.nearFar)),i.constants.add("sampleValue","float",Ibt),e.outputs.add("sampleCount","float"),i.code.add(b`void main(void) {
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
ivec2 texSize = textureSize(shadowMapTex, 0);
ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
sampleCount = sampleValue;
}`),e}const Qde=be(),Dbt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:_8,build:Lbt},Symbol.toStringTag,{value:"Module"}));var gC;(function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"})(gC||(gC={}));let sY=class extends tc{constructor(){super(...arguments),this.visualization=gC.Gradient,this.bandsEnabled=!1}};u([U({count:gC.COUNT})],sY.prototype,"visualization",void 0),u([U()],sY.prototype,"bandsEnabled",void 0);let zPe=class extends or{constructor(e){super(),this._data=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=$M(Nbt),this.bandSize=.1,this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}};const Nbt=Ft(.01,0,.25,1);function Fbt(t){const e=new Ei,i=e.fragment;i.include(dd),i.include(od),e.include(ZU),e.include(Na);const{visualization:r,bandsEnabled:n}=t;i.constants.add("inverseSampleValue","float",_8),i.uniforms.add(new et("shadowCastMap",a=>a.shadowCastMap),new Re("sampleScale",a=>a.sampleScale),new Re("opacityFromElevation",a=>a.opacityFromElevation),new yi("uColor",a=>a.color));const s=r===gC.Gradient,o=r===gC.Threshold;return s&&n?i.uniforms.add(new Re("bandSize",a=>a.bandSize)):o&&i.uniforms.add(new Re("threshold",a=>a.threshold)),i.code.add(b`
      void main(void) {
        float record = texture(shadowCastMap, uv).r;
        float pixelSamples = record * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${o?b`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${s&&n?b`strength = ceil(strength / bandSize) * bandSize;`:""}

        fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${s?b`* strength`:""});
      }
    `),e}const kbt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:zPe,build:Fbt},Symbol.toStringTag,{value:"Module"}));let BPe=class VPe extends Fi{constructor(e,i){super(e,i,()=>this.destroy())}initializeProgram(e){return new Mi(e.rctx,VPe.shader.get().build(this.configuration),Si)}initializePipeline(){return Lt({blending:Xu,colorWrite:Gt,depthTest:null,depthWrite:null})}get primitiveType(){return ci.TRIANGLE_STRIP}};BPe.shader=new Pi(kbt,()=>ce(()=>import("./ShadowCastVisualize.glsl-6400132e.js"),[],import.meta.url));const Ubt=4e4,zbt=5e4,GPe=1/512;let L4=class extends we{constructor(e,i,r,n){super({}),this._techniqueRepository=e,this._rctx=i,this._data=r,this._requestRender=n,this._passParameters=new zPe(this._data),this._techniqueConfig=new sY,this._enabled=!1,this._vao=qm(i)}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=rt(this._vao),this._techniqueRepository.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(BPe,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const i=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(i,this._passParameters,e),this._rctx.drawArrays(i.primitiveType,0,uy(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>GPe}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const i=this._passParameters.color;W2(e,i)||(mp(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};u([p()],L4.prototype,"opacityFromElevation",null),L4=u([M("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],L4);let jPe=class HPe extends Fi{constructor(e){super(e,new Kee,()=>this.destroy())}initializeProgram(e){return new Mi(e.rctx,HPe.shader.get().build(this.configuration),Si)}initializePipeline(){return Lt({blending:Go(Te.ONE,Te.ONE,Te.ONE,Te.ONE),colorWrite:Gt,depthTest:null,depthWrite:null})}get primitiveType(){return ci.TRIANGLE_STRIP}};jPe.shader=new Pi(Dbt,()=>ce(()=>import("./ShadowCastAccumulate.glsl-11b4aec9.js"),[],import.meta.url));let Ll=class extends we{constructor(e,i,r,n,s,o){super({}),this.fbos=e,this._stage=r,this._prepareForShadowMapPass=n,this._renderToShadowMap=s,this._requestRender=o,this._progress=0,this._sampleCount=0,this._passParameters=new PQ,this._cachedLightDirections=[],this._depthRange=JW,this._previewing=!1,this._cameraForcedForScreenshot=!1,this._shadowAccumulatorKey="shadowAccumulator",this._rctx=e.rctx,this._bindParameters=new bU(new JQ(e,r.viewingMode),null),this._bindParameters.shadowMap.enabled=!0,this._vao=qm(this._rctx),this._accumulationRenderer=new L4(i,this._rctx,this,o);const a=this._stage.view.resourceController.scheduler;this.addHandles([a.registerTask(pt.SHADOW_ACCUMULATOR,this),ne(()=>r.renderView,l=>{this.removeHandles(epe),l!=null&&this.addHandles(l.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),epe)},Ji),ne(()=>this._previewing,()=>this._requestRenderIfEnabled(),Zi)],this._shadowAccumulatorKey)}normalizeCtorArgs(){return{}}dispose(){this._disable(),this.removeHandles(this._shadowAccumulatorKey),this._accumulationRenderer=rt(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=rt(this._fbo),this._vao=rt(this._vao),this._accumulationTechniqueCached=li(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo?.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(this._accumulationTechniqueCached==null){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new jPe(e)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._fbo!=null&&this._sampleCount>0}get canAccumulate(){return this._bindParameters.linearDepth?.colorTexture!==null&&this._depthRange!==JW&&this._opacityFromElevation>GPe}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const i=this._cachedLightDirections;if(vy(i,e,hx))return;const r=Math.min(_8,e.length);i.length=r,this._sampleCount=r;for(let n=0;n<r;++n)i[n]=oe(i[n]??E(),e[n]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,i,r,n){if(this._depthRange=i,this._updateCamera(r),this._bindParameters.contentCamera=n,this._bindParameters.linearDepth=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const s=this._cameraForcedForScreenshot?this._sampleCount:Math.min(Bbt,this._sampleCount-this._progress);for(let o=0;o<s;++o)this._accumulateShadow();this._cameraForcedForScreenshot=!1,this._requestRender()}render(e){this._accumulationRenderer.render(e)}setOptions(e){if(e.enabled!==void 0){const i=this._fbo!=null;e.enabled!==i&&(e.enabled?this._enable():this._disable())}e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,i){return!this._isActive||!this._fbo||this._progress<1||e<0||e>=this._fbo.width||i<0||i>=this._fbo.height?0:(this._fbo.readPixels(e,i,1,1,gt.RED,Fs.UNSIGNED_BYTE,tpe),tpe[0]/this._progress)}_enable(){this._progress=0;const e=new Hi;e.pixelFormat=gt.RED,e.internalFormat=We.R8,e.wrapMode=Vt.CLAMP_TO_EDGE,this._fbo=new jp(this._rctx,e)}_disable(){this._fbo=rt(this._fbo)}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(wr.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._lightDirections[this._progress++],this._depthRange);const e=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,uy(this._vao,"geometry"))}_updateCamera(e){!e.equals(this._bindParameters.camera)&&this._fbo&&(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-tP(Ubt,zbt,e.relativeElevation))}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};u([p()],Ll.prototype,"_progress",void 0),u([p()],Ll.prototype,"_sampleCount",void 0),u([p()],Ll.prototype,"_fbo",void 0),u([p()],Ll.prototype,"_depthRange",void 0),u([p()],Ll.prototype,"_previewing",void 0),u([p()],Ll.prototype,"_accumulationRenderer",void 0),u([p()],Ll.prototype,"_isRefining",null),u([p()],Ll.prototype,"_isActive",null),u([p()],Ll.prototype,"canAccumulate",null),u([p()],Ll.prototype,"_isDoneAccumulating",null),u([p()],Ll.prototype,"_opacityFromElevation",null),u([p()],Ll.prototype,"running",null),Ll=u([M("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],Ll);const Bbt=6,epe="renderView",tpe=new Uint8Array(1),ipe=By();let Vbt=class{constructor(){this._plane=By()}get isEnabled(){return!Bbe(this.plane,ipe)}get plane(){return this._plane}set plane(e){Wx(e||ipe,this._plane)}};function Gbt(t,e){const i=-t[0],r=-t[1],n=-t[2],s=e[3],o=e[7],a=e[11],l=e[15];e[0]+=s*i,e[1]+=s*r,e[2]+=s*n,e[4]+=o*i,e[5]+=o*r,e[6]+=o*n,e[8]+=a*i,e[9]+=a*r,e[10]+=a*n,e[12]+=l*i,e[13]+=l*r,e[14]+=l*n}function jbt(t,e){const i=t[0],r=t[1],n=t[2];e[12]+=i*e[0]+r*e[4]+n*e[8],e[13]+=i*e[1]+r*e[5]+n*e[9],e[14]+=i*e[2]+r*e[6]+n*e[10],e[14]+=i*e[3]+r*e[7]+n*e[11]}let Hbt=class{constructor(e){this._factory=e,this._originData=new Map}acquire(e){return this.register(this._factory.getOrigin(e))}register(e){const i=this._originData.get(e.id)||new qbt(e);return i.refCount++,this._originData.has(i.origin.id)||this._originData.set(i.origin.id,i),i}release(e){e.refCount--,e.refCount===0&&this._originData.delete(e.origin.id)}updateViewMatrices(e){this._originData.forEach(i=>{Qn(i.viewMatrix,e),jbt(i.origin.vec3,i.viewMatrix)})}},qbt=class{constructor(e){this.origin=e,this.refCount=0,this.viewMatrix=be()}},Wbt=class extends XTe{constructor(e,i){super(),this.distanceFalloffFactor=e,this.transparency=i,this.transformNormalViewFromGlobal=nn()}},Ybt=class extends ZTe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=nn(),this.slicePlaneLocalOrigin=E(),this.transformNormalGlobalFromModel=nn()}};function Xbt(t){const e=b`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;t.code.add(e)}const Zbt=pi(.5,-4e-4);function Jbt(t,e){const i=t.vertex;i.include(Xbt),i.constants.add("depthBias","vec2",Zbt),i.uniforms.add(new Ki("inverseViewport",(r,n)=>n.inverseViewport)),e.legacy?(i.uniforms.add(new en("proj",(r,n)=>n.camera.projectionMatrix)),i.code.add(b`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(i.uniforms.add(new qp("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal),new en("transformProjFromView",r=>r.transformProjFromView)),i.code.add(b`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),i.code.add(b`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function Kbt(t,e){const i=t.fragment;i.constants.add("coverageTestThreshold","float",.01),e.antialiasing?i.code.add(b`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):i.code.add(b`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function Qbt(t,e){const i=t.vertex;e.silhouette?(i.code.add(b`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),e.legacy?i.code.add(b`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):i.code.add(b`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):i.code.add(b`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function ewt(t,e){const i=t.vertex;i.include(dd),i.uniforms.add(new Re("distanceFalloffFactor",r=>r.distanceFalloffFactor)),i.code.add(b`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),i.uniforms.add(new Yh("componentDataTex",r=>r.componentDataTexture)),t.attributes.add(O.COMPONENTINDEX,"float"),i.constants.add("componentColorFieldOffset","float",0),i.constants.add("componentOtherFieldOffset","float",1),i.constants.add("componentVerticalOffsetFieldOffset","float",2),i.constants.add("componentFieldCount","float",3),i.constants.add("lineWidthFractionFactor","float",8),i.constants.add("extensionLengthOffset","float",128),i.constants.add("verticalOffsetScale","float",2*qee),i.code.add(b`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float texSize = float(textureSize(componentDataTex, 0).x);
float colIndex = mod(fieldIndex, texSize);
float rowIndex = floor(fieldIndex / texSize);
return vec2(colIndex, rowIndex) + 0.5;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
float verticalOffset;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
float verticalOffset = (rgba2float(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) - 0.5) * verticalOffsetScale;
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5,
verticalOffset
);
}`),e.legacy?i.code.add(b`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(i.uniforms.add(new TP("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel)),i.code.add(b`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),e.silhouette?(t.attributes.add(O.NORMALA,"vec3"),t.attributes.add(O.NORMALB,"vec3"),i.code.add(b`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(t.attributes.add(O.NORMAL,"vec3"),i.code.add(b`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),e.legacy?i.code.add(b`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(i.include(AK,e),i.uniforms.add(new qp("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new TP("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new Yu("transformWorldFromModelTL",r=>r.transformWorldFromModelTL),new Yu("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new kt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new kt("transformWorldFromViewTH",r=>r.transformWorldFromViewTH)),i.code.add(b`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${e.spherical?b`normalize(transformWorldFromModelTL + rotatedModelPosition);`:b`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),i.uniforms.add(new en("transformProjFromView",(r,n)=>n.camera.projectionMatrix)),i.code.add(b`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),i.code.add(b`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function twt(t){return t.mode===Ls.SKETCH||t.mode===Ls.MIXED}var Ls,bw;(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH",t[t.MIXED=2]="MIXED",t[t.COUNT=3]="COUNT"})(Ls||(Ls={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.SILHOUETTE=1]="SILHOUETTE"}(bw||(bw={}));function Qee(t,e){const i=t.vertex;switch(t.attributes.add(O.SIDENESS,"vec2"),e.mode===Ls.MIXED?i.code.add(b`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):i.code.add(b`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),e.mode){case Ls.MIXED:i.code.add(b`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case Ls.SKETCH:i.code.add(b`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Ls.SOLID:i.code.add(b`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Ls.COUNT:break;default:e.mode}}function iwt(t,e){const i=t.vertex;switch(t.include(Qee,e),e.mode){case Ls.SOLID:i.code.add(b`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case Ls.SKETCH:i.uniforms.add(new Zw("strokesAmplitude",r=>r.strokesTexture.amplitude)),i.code.add(b`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case Ls.MIXED:i.uniforms.add(new Zw("strokesAmplitude",r=>r.strokesTexture.amplitude)),i.code.add(b`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function rwt(t,e){t.include(Qee,e);const{vertex:i,fragment:r}=t;switch(twt(e)&&(i.uniforms.add(new Yh("strokesTexture",n=>n.strokesTexture.texture)),i.uniforms.add(new Zw("strokesLog2Resolution",n=>Math.log2(n.strokesTexture.resolution)),new Zw("strokeVariants",n=>n.strokesTexture.variants)),t.varyings.add("vStrokeUV","vec2"),r.uniforms.add(new Yh("strokesTexture",n=>n.strokesTexture.texture),new Zw("strokesNormalizationScale",n=>n.strokesTexture.normalizationScale)),i.code.add(b`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) / vec2(textureSize(strokesTexture, 0));
vStrokeUV.x += variantOffset;
}`),t.fragment.include(dd),r.code.add(b`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),e.mode){case Ls.SOLID:i.code.add(b`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),r.code.add(b`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case Ls.SKETCH:i.code.add(b`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),r.code.add(b`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case Ls.MIXED:t.varyings.add("vType","float"),i.code.add(b`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),r.code.add(b`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function nwt(t){const e=new Ei,{vertex:i,fragment:r}=e;return t.legacy&&i.uniforms.add(new rpe("model"),new rpe("localView")),e.include(Jbt,t),e.include(ewt,t),e.include(iwt,t),e.include(Qee,t),e.include(rwt,t),e.include(Dn,t),e.include(Qbt,t),e.include(Kbt,t),e.include(Xc,t),e.varyings.add("vColor","vec4"),e.varyings.add("vRadius","float"),e.varyings.add("vPosition","vec3"),e.varyings.add("vWorldPosition","vec3"),t.multipassEnabled&&e.varyings.add("vViewPos","vec3"),e.varyings.add("vLineLengthPixels","float"),e.varyings.add("vSizeFalloffFactor","float"),i.uniforms.add(new Ki("pixelToNDC",(n,s)=>mi(swt,2/s.camera.fullViewport[2],2/s.camera.fullViewport[3])),new yi("viewport",(n,s)=>s.camera.fullViewport),new Re("pixelRatio",(n,s)=>s.camera.pixelRatio)),e.attributes.add(O.POSITION0,"vec3"),e.attributes.add(O.POSITION1,"vec3"),e.attributes.add(O.VARIANTOFFSET,"float"),e.attributes.add(O.VARIANTSTROKE,"float"),e.attributes.add(O.VARIANTEXTENSION,"float"),i.code.add(b`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      ${t.multipassEnabled?"vViewPos = viewPos;":""}

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      ${t.antialiasing?b`
        const float aaPaddingPixels = 1.0;

        // Line size with padding
        float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
        float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;`:b`
        float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
        float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;`}

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${t.mode===Ls.SKETCH?b`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:t.mode===Ls.MIXED?b`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `),r.code.add(b`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${t.multipassEnabled?"terrainDepthTest(vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      fragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `),e}const swt=Ge();let rpe=class extends dn{constructor(e){super(e,"mat4")}};const owt=Object.freeze(Object.defineProperty({__proto__:null,build:nwt},Symbol.toStringTag,{value:"Module"}));let qPe=class WPe extends Fi{initializeProgram(e){return new Mi(e.rctx,WPe.shader.get().build(this.configuration),hPe)}initializePipeline(e){return e.blendMinMax?Lt({blending:Go(Te.ONE,Te.ONE,Te.ZERO,Te.ONE,Pm.ADD,e.blendMinMax.MAX),depthTest:{func:Bi.LEQUAL},colorWrite:Gt}):Lt({depthTest:{func:Bi.LEQUAL},depthWrite:ec,colorWrite:Gt})}};qPe.shader=new Pi(owt,()=>ce(()=>import("./EdgeShader.glsl-1bee318f.js"),[],import.meta.url));let Xd=class extends fl{constructor(){super(...arguments),this.mode=Ls.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.spherical=!1}};u([U({count:Ls.COUNT})],Xd.prototype,"mode",void 0),u([U()],Xd.prototype,"hasSlicePlane",void 0),u([U()],Xd.prototype,"silhouette",void 0),u([U()],Xd.prototype,"legacy",void 0),u([U()],Xd.prototype,"antialiasing",void 0),u([U()],Xd.prototype,"doublePrecisionRequiresObfuscation",void 0),u([U()],Xd.prototype,"multipassEnabled",void 0),u([U()],Xd.prototype,"cullAboveGround",void 0),u([U()],Xd.prototype,"spherical",void 0),u([U({constValue:!1})],Xd.prototype,"occlusionPass",void 0);const awt=8,aV=128,lwt={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},cwt={solid:Ls.SOLID,sketch:Ls.SKETCH,uber:Ls.MIXED};let lV=class YPe{constructor(e,i,r){this._rctx=e,this._shaderTechniqueRepository=i,this._configuration=new Xd,this.refCount=0,this._renderables=new Set,this._sortedRenderables={[qt.TRANSPARENT]:{[qt.TRANSPARENT]:new Ut,[qt.OPAQUE]:new Ut},[qt.OPAQUE]:{[qt.TRANSPARENT]:new Ut,[qt.OPAQUE]:new Ut}},this._renderablesDirty=!1,this._drawParameters=new Ybt,this._settings={...lwt,...r},this.key=YPe.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const n=this._settings.strokesTexture.variants;this.writerSettings={variants:n,reducedPrecision:pr.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=cwt[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this._rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=e.driverTest.doublePrecisionRequiresObfuscation.result,this._configuration.spherical=r.spherical}dispose(){this._technique=li(this._technique)}addRenderable(e){this._renderables.add(e),this._renderablesDirty=!0}removeRenderable(e){this._renderables.delete(e),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(e,i){this._renderablesDirty&&this._sortRenderables();const r=this._sortedRenderables[i];r[qt.TRANSPARENT].forAll(e),r[qt.OPAQUE].forAll(e)}updateTechnique(e,i){return this._configuration.multipassEnabled=!!e.multipassEnabled,this._configuration.cullAboveGround=!!e.multipassTerrain.cullAboveGround,this._configuration.silhouette=i,this._technique=this._shaderTechniqueRepository.releaseAndAcquire(qPe,this._configuration,this._technique),this._technique}bindRegularEdges(e,i){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(i,!1),e,i)}bindSilhouetteEdges(e,i){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(i,!0),e,i)}renderRegularEdges(e,i,r,n,s){this._render(e,i,i.regular.vao,r,n,s)}renderSilhouetteEdges(e,i,r,n,s){this._render(e,i,i.silhouette.vao,r,n,s)}_render(e,i,r,n,s,o){o>0&&(this._bindDraw(e,i,n,s),this._rctx.bindVAO(r),this._rctx.drawArraysInstanced(ci.TRIANGLE_FAN,0,4,o))}_bindDraw(e,i,r,n){if(this._drawParameters.componentDataTexture=i.components.buffer.textureBuffer.texture,this._drawParameters.strokesTexture=this._settings.strokesTexture,"origin"in i.transform)this._lastOriginId!==i.transform.origin.origin.id&&(e.setUniformMatrix4fv("localView",i.transform.origin.viewMatrix),this._lastOriginId=i.transform.origin.origin.id),e.setUniformMatrix4fv("model",i.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=i.transform.origin.origin.vec3;else{const s=new y8(i.transform.position),o=nd(npe,Xx(npe,i.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=s.low,this._drawParameters.transformWorldFromModelTH=s.high,this._drawParameters.transformWorldFromModelRS=i.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=o;const a=n.camera.viewInverseTransposeMatrix;ae(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}e.bindDraw(this._drawParameters,n,r)}_sortRenderables(){this._renderablesDirty=!1,this._sortedRenderables[qt.TRANSPARENT][qt.TRANSPARENT].clear(),this._sortedRenderables[qt.TRANSPARENT][qt.OPAQUE].clear(),this._sortedRenderables[qt.OPAQUE][qt.TRANSPARENT].clear(),this._sortedRenderables[qt.OPAQUE][qt.OPAQUE].clear(),this._renderables.forEach(i=>{i.objectTransparency!==qt.INVISIBLE&&i.edgeTransparency!==qt.INVISIBLE&&this._sortedRenderables[i.objectTransparency][i.edgeTransparency].push(i)});const e=(i,r)=>"origin"in i.transform?"origin"in r.transform?i.transform.origin.origin.id<r.transform.origin.origin.id?-1:i.transform.origin.origin.id>r.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[qt.TRANSPARENT][qt.TRANSPARENT].sort(e),this._sortedRenderables[qt.TRANSPARENT][qt.OPAQUE].sort(e),this._sortedRenderables[qt.OPAQUE][qt.TRANSPARENT].sort(e),this._sortedRenderables[qt.OPAQUE][qt.OPAQUE].sort(e)}static getKey(e,i,r){return`edges-t:${e}:${i}:${r}`}};const npe=Ma();function g7t(t,e){return e.push(t.buffer),{buffer:t.buffer,layout:new NZe(t.layout)}}function hD(t){return new dSe(t.layout).createView(t.buffer)}let uwt=class extends iRe{constructor(e){super("EdgeProcessingWorker","extract",{extract:i=>[i.dataBuffer],extractComponentsEdgeLocations:i=>[i.dataBuffer],extractEdgeLocations:i=>[i.dataBuffer]},e)}async process(e,i,r){if(r)return y1t(e);const n=await this.invoke(new cV(e),i);return this._unpackOutput(n)}async extractEdgeLocations(e,i){const r=await this.invokeMethod("extractEdgeLocations",new cV(e),i);return hD(r)}async extractComponentsEdgeLocations(e,i){const r=await this.invokeMethod("extractComponentsEdgeLocations",new cV(e),i);return hD(r)}_unpackOutput(e){return{regular:{instancesData:hD(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:hD(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}}},cV=class{constructor(e){this.dataBuffer=e.data.buffer,this.writerSettings=e.writerSettings,this.skipDeduplicate=e.skipDeduplicate,this.indices=Kh(e.indices)?e.indices:e.indices.buffer,this.indicesType=Kh(e.indices)?"Array":r6(e.indices)?"Uint32Array":"Uint16Array",this.indicesLength=e.indicesLength}};function hwt(t){const i=XA.resolution,r=i/2,n=new Uint8Array(4*i*i),s=4*i*r,o=XA.amplitude,a=2*o,l=4*i,c=Math.log2(i)+1,h=XA.strokes.length;let d=(c-1)*h*l;for(const{distance:m,pressure:y}of XA.strokes){let _=m,v=y,w=d;for(let x=0;x<c;x++){x!==0&&(_=spe(_,qP.DISTANCE),v=spe(v,qP.PRESSURE));for(let T=0;T<XA.resolution;T++){const S=.5+(_?_[T%_.length]/a:0),C=v?v[T%v.length]:1;FP(S,n,w),FP(C,n,w+s),w+=4}w-=l*(h+1)}d+=l}const f=new Nt(t,new Hi(i),n);return new pwt(i,a,o,h,f)}function spe(t,e){if(!t)return null;const i=t.length/2,r=dwt*i,n=new Array(i);let s=0;const o=e===qP.PRESSURE;for(let a=0;a<t.length;a+=2){const l=(t[a]+t[a+1])/2;n[s++]=o?Math.min(r,1-(1-l)*ope):Math.min(r,l*ope)}return n}var qP;(function(t){t[t.DISTANCE=0]="DISTANCE",t[t.PRESSURE=1]="PRESSURE"})(qP||(qP={}));const dwt=.1,ope=.5;let pwt=class{constructor(e,i,r,n,s){this.resolution=e,this.normalizationScale=i,this.amplitude=r,this.variants=n,this.texture=s}dispose(){this.texture=rt(this.texture)}};const XA={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function ape(t){let e=null;for(const i of t){const r=i.type;if(fwt(i)){if(e==null)e=r;else if(e!==r)return"uber"}}return e??"uber"}function lpe(t){let e=qt.INVISIBLE;for(const{material:i}of t)if(XPe(i)){if(i.color[3]*i.opacity<1)return qt.TRANSPARENT;e=qt.OPAQUE}return e}function cpe(t){let e=qt.INVISIBLE;for(const{material:i}of t)if(XPe(i)){switch(i.objectTransparency){case qt.TRANSPARENT:case qt.INVISIBLE:return qt.TRANSPARENT;case qt.OPAQUE:if(i.opacity<1)return qt.TRANSPARENT}e=qt.OPAQUE}return e}function XPe(t){return t.size*t.color[3]*t.opacity>0}function fwt(t){return t.size*t.color[3]>0}function upe(t,e,i,r){for(let n=0;n<t.length;n++){const s=t[n].index,o=e[n],a=e[n+1];if(r)for(let l=o;l<a;l++){const c=r[l];i.set(c,s)}else for(let l=o;l<a;l++)i.set(l,s)}}let Zd=class extends we{constructor(t){super(t),this._updatingHandles=new Cp,this._perObjectData=new Map,this._perObjectDataEvictionCache=new Set,this._renderers=new Map,this._gpuMemoryUsage=0,this._workerAbort=new AbortController,this._tmpModelPosition=E(),this._localOrigins=new Hbt(new ZQ(t.renderSR))}initialize(){this._worker=new uwt(this.schedule),this._componentColorManager=new fPe(this.rctx,3);const t=uPe.createBuffer(4);for(let e=0;e<4;e++)t.sideness.set(e,0,e===0||e===3?0:1),t.sideness.set(e,1,e===0||e===1?0:1);this._verticesBufferObject=Ui.createVertex(this.rctx,Ri.STATIC_DRAW,t.buffer)}destroy(){this.destroyed||(this._perObjectData.forEach(t=>this._discardObjectEntry(t)),this._perObjectData.clear(),this._strokesTexture=rt(this._strokesTexture),this._componentColorManager=$e(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=rt(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy(),this._set("schedule",vwt))}get updating(){return this._updatingHandles.updating}get usedMemory(){return this._gpuMemoryUsage}shouldRender(){return this._renderers.size>0}async addComponentObject(t,e,i,r,n,s,o,a){if(this.hasObject(t))return this.getObjectMemoryUsage(t);let l;const c=new dpe(new Promise(d=>l=d),i.center,i.radius);this._perObjectData.set(t,c);const h=await this._updatingHandles.addPromise(this._addComponentGeometry(e,c,r,n,s,o,a));return this.setNeedsRender(),l(),h}async addOrUpdateObject3D(t,e,i,r){if(this.destroyed)return void K.getLogger(this).warn("Attempt to add an object to a destroyed instance");const n=this._perObjectData.get(t);let s;n?.renderables.length>0&&this._perObjectDataEvictionCache.add(n);const o=t.boundingVolumeWorldSpace.bounds,a=new dpe(new Promise(c=>s=c),o,ly(o));this._perObjectData.set(t,a);const l=new Array;if(i.mergeGeometries&&t.geometries.length>1&&mwt(t))l.push(this._addObjectMergedGeometries(t,a,e,i,r));else for(let c=0;c<t.geometries.length;c++){const h=t.geometries[c];h.material.supportsEdges&&l.push(this._addGeometry(t,a,h,e[0],i,r))}await this._updatingHandles.addPromise(Promise.all(l)),this._perObjectDataEvictionCache.delete(a),this._discardObjectEntry(n),this.setNeedsRender(),s()}fastUpdateObject3DEdgesTransform(t){if(this.destroyed)return!1;const e=this._perObjectData.get(t);if(!e)return!1;const{geometries:i}=t,{renderables:r}=e;if(i.length===0||r.length===0)return!0;if(r.length>1)return!1;const[n]=r,s=n.transform;if(!(s instanceof uV))return!1;const[o]=i;if(o.localOrigin!==s.origin.origin)return!1;const a=be(),l=this._computeModelTransformWithLocalOrigin(t,o,a);return n.transform=new uV(a,l),this.setNeedsRender(),!0}_discardObjectEntry(t){t&&(t.renderables.length&&(t.renderables.forEach(e=>this._removeRenderable(e)),this.setNeedsRender()),t.loaded=null)}hasObject(t){return this._perObjectData.has(t)}async updateAllComponentOpacities(t,e){const i=await this._updatingHandles.addPromise(this._getObjectEntry(t));if(i==null)return;const r=e instanceof Array?n=>e[n]:()=>e;i.renderables.forEach(n=>{const s=n.components.meta.length;for(let o=0;o<s;o++){const a=r(o),l=n.components.meta[o],c=l.index;l.material.opacity=a,n.components.buffer.textureBuffer.setDataElement(c,1,3,255*a)}this._updateTransparency(n)}),this.setNeedsRender()}async getObjectMemoryUsage(t){const e=await this._getObjectEntry(t);return e!=null?e.renderables.reduce((i,r)=>i+r.statistics.gpuMemoryUsage,0):0}async updateAllComponentMaterials(t,e,i,r){const n=t instanceof Jy,s=!!i.hasSlicePlane,o=ape(e),a=lV.getKey(o,s,n),l=await this._updatingHandles.addPromise(this._getObjectEntry(t));l!=null&&(l.renderables.forEach(c=>{if(a!==c.rendererKey){const h=this._renderers.get(c.rendererKey),d=this._acquireRenderer(o,s,n);h.removeRenderable(c),--h.refCount,c.rendererKey=a,d.addRenderable(c)}for(let h=0;h<e.length;h++)c.components.meta[h].material=e[h];r&&this._updateComponentBuffer(c.components),this._updateTransparency(c)}),this.setNeedsRender())}async updateAllVerticalOffsets(t,e){const i=await this._updatingHandles.addPromise(this._getObjectEntry(t));i!=null&&(i.renderables.forEach(r=>{const n=r.components.meta;for(let s=0;s<n.length;s++)r.components.meta[s].verticalOffset=e?.[s]??0;this._updateComponentBuffer(r.components)}),this.setNeedsRender())}async updateObjectVisibility(t,e){const i=await this._updatingHandles.addPromise(this._getObjectEntry(t));i!=null&&(i.renderables.forEach(r=>r.visible=e),this.setNeedsRender())}removeObject(t){const e=this._perObjectData.get(t);e&&(this._perObjectData.delete(t),this._discardObjectEntry(e))}async _getObjectEntry(t){const e=this._perObjectData.get(t);if(!e)throw new Error("no object");return await e.loaded,e.loaded==null?null:e}render(t,e){if(this._componentColorManager==null)return;this._localOrigins.updateViewMatrices(t.camera.viewMatrix);const i=t.camera.viewInverseTransposeMatrix,r=E(),n=new y8;let s=0,o=0;if(this._renderers.forEach(l=>{if(l.refCount===0)return this._renderers.delete(l.key),void l.dispose();let c=!0,h=!0;l.forEachRenderable(d=>{d.visible&&(s+=d.statistics.averageEdgeLength,o++,c&&d.regular&&(l.updateTechnique(t,!1),c=!1),h&&d.silhouette&&(l.updateTechnique(t,!0),h=!1))},e)}),this._componentColorManager.garbageCollect(),this._componentColorManager.updateTextures(),o===0)return;const a=new Wbt(40*s/o,e);ae(r,i[3],i[7],i[11]),n.set(r),oe(a.transformWorldFromViewTH,n.high),oe(a.transformWorldFromViewTL,n.low),rd(a.transformViewFromCameraRelativeRS,t.camera.viewMatrix),nd(gpe,a.transformViewFromCameraRelativeRS),Xx(a.transformNormalViewFromGlobal,gpe),a.transformProjFromView=t.camera.projectionMatrix,this._updateObjectCameraDistances(t),this._renderers.forEach(l=>{this._renderRegularEdges(l,t,a),this._renderSilhouetteEdges(l,t,a)})}_updateTransparency(t){const e=lpe(t.components.meta),i=cpe(t.components.meta);e===t.edgeTransparency&&i===t.objectTransparency||(t.edgeTransparency=e,t.objectTransparency=i,this._renderers.get(t.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(t,e,i){t.getCombinedShaderTransformation(e,i);const r=e.localOrigin!=null?this._localOrigins.register(e.localOrigin):this._localOrigins.acquire(ae(this._tmpModelPosition,i[12],i[13],i[14]));return e.localOrigin=r.origin,Gbt(r.origin.vec3,i),r}_updateComponentBuffer(t){const{meta:e,buffer:i}=t,r=new Uint8Array(4);for(let n=0;n<e.length;n++){const s=e[n].material,o=e[n].index,a=_e(Math.round(s.size*awt),0,255),l=_e(s.extensionLength,-aV,255-aV)+aV,c=s.type==="solid"?Tk.SOLID:Tk.SKETCH,h=255*s.opacity,d=s.color,f=255*d[0],m=255*d[1],y=255*d[2],_=255*d[3];i.textureBuffer.setData(o,0,f,m,y,_),i.textureBuffer.setData(o,1,a,l,c,h),oPe(e[n].verticalOffset,r),i.textureBuffer.setData(o,2,r[0],r[1],r[2],r[3])}}_createComponentBuffers(t){if(this._componentColorManager==null)return null;const e=new Array,i=this._componentColorManager.getBuffer(t.length);for(let n=0;n<t.length;n++){const s=t[n],o=i.acquireIndex();e.push({index:o,verticalOffset:0,material:s})}const r=new gwt(i,e);return this._updateComponentBuffer(r),r}_extractEdges(t,e,i,r,n,s=n.length){return this._worker.process({data:e,indices:n,indicesLength:s,writerSettings:t,skipDeduplicate:i},this._workerAbort.signal,r)}_createRenderable(t,e,i,r,n){const s=c=>this._verticesBufferObject!=null?new ywt(new Hp(this.rctx,hPe,{vertices:o1t,instances:c===bw.REGULAR?wk.glLayout:xk.glLayout},{vertices:this._verticesBufferObject,instances:Ui.createVertex(this.rctx,Ri.STATIC_DRAW,c===bw.REGULAR?t.regular.instancesData.buffer:t.silhouette.instancesData.buffer)}),c===bw.REGULAR?t.regular.lodInfo:t.silhouette.lodInfo):null,o=t.regular.lodInfo.lengths.length>0?s(bw.REGULAR):null,a=t.silhouette.lodInfo.lengths.length>0?s(bw.SILHOUETTE):null,l=(o?.vao.usedMemory??0)+(a?.vao.usedMemory??0);return new _wt(o,a,{gpuMemoryUsage:l,externalMemoryUsage:n,averageEdgeLength:t.averageEdgeLength},i,lpe(e.meta),cpe(e.meta),e,r)}async _addGeometry(t,e,i,r,n,s){if(i.edgeIndicesLength<=0)return;const o=i.attributes.get(O.POSITION),a=be(),l=this._computeModelTransformWithLocalOrigin(t,i,a),c=new mpe(o,a,l);return this._addPositionData(e,c,i.edgeIndicesLength,r,n,s)}async _addPositionData(t,e,i,r,n,s=!1){if(t.loaded==null)return;const o=this._createComponentBuffers([r]);if(o==null)return;const a=this._acquireRenderer(r.type,!!n.hasSlicePlane,!0),{modelTransform:l,origin:c}=e,h=e.position.indices,d=e.position,f=d.data.length/d.size,m=vk.createBuffer(f);for(let v=0;v<f;v++)m.position.set(v,0,d.data[v*d.size]),m.position.set(v,1,d.data[v*d.size+1]),m.position.set(v,2,d.data[v*d.size+2]);upe(o.meta,[0,m.componentIndex.count],m.componentIndex);const y=await this._updatingHandles.addPromise(this._extractEdges(a.writerSettings,m,!1,s,h,i));if(t.loaded==null)return;const _=this._createRenderable(y,o,new uV(l,c),a.key,!1);t.renderables.push(_),a.addRenderable(_),this._gpuMemoryUsage+=_.statistics.gpuMemoryUsage}async _addComponentGeometry(t,e,i,r,n,s,o){if(e.loaded==null)return 0;const a=this._createComponentBuffers(s);if(a==null)return 0;const l=ape(s),c=this._acquireRenderer(l,o.hasSlicePlane||!1,!1),h=vk.createBuffer(i.length/3);n$(h.position.typedBuffer,i,h.position.typedBufferStride,3),upe(a.meta,n,h.componentIndex,r);const d=!0,f=c.writerSettings,m=await this._updatingHandles.addPromise(this._extractEdges(f,h,d,!1,r));if(e.loaded==null)return 0;const y=this._createRenderable(m,a,t,c.key,!0);return e.renderables.push(y),c.addRenderable(y),y.statistics.gpuMemoryUsage}async _addObjectMergedGeometries(t,e,i,r,n){const s=new Map;let o=0,a=null,l=0;const c=t.geometries.filter(x=>{if(x.edgeIndicesLength<=0||!x.material.supportsEdges)return!1;!a&&x.localOrigin&&(a=x);const T=x.attributes.get(O.POSITION);return l+=T.data.length/T.size,o+=x.edgeIndicesLength,!0});if(c.length===0)return;const h=l>=65536?Uint32Array:Uint16Array,d=o?new h(o):null,f=[];let m=0;c.forEach(x=>{const T=x.attributes.get(O.POSITION),S=T.indices;let C=s.get(T.data);if(C==null){C=f.length/3;for(let A=0;A<T.data.length;A+=T.size)f.push(T.data[A]),f.push(T.data[A+1]),f.push(T.data[A+2]);s.set(T.data,C)}for(let A=0;A<x.edgeIndicesLength;A++)d[m++]=C+S[A]});const y=a||t.geometries[0],_=be(),v=this._computeModelTransformWithLocalOrigin(t,y,_);for(let x=0;x<t.geometries.length;x++)t.geometries[x].localOrigin=v.origin;const w=new mpe(new Ve(f,d,3),_,v);await this._updatingHandles.addPromise(this._addPositionData(e,w,d.length,i[0],r,n))}_acquireRenderer(t,e,i){const r=lV.getKey(t,e,i);let n=this._renderers.get(r);return this._strokesTexture==null&&(this._strokesTexture=hwt(this.rctx)),n||(n=new lV(this.rctx,this.techniqueRepository,{type:t,hasSlicePlane:e,strokesTexture:this._strokesTexture,legacy:i,spherical:this.viewingMode===Le.Global}),this._renderers.set(r,n)),++n.refCount,n}_removeRenderable(t){hpe(t.regular),hpe(t.silhouette);const e=this._renderers.get(t.rendererKey);if(e){e.removeRenderable(t),--e.refCount,"origin"in t.transform&&this._localOrigins.release(t.transform.origin),this._gpuMemoryUsage-=t.statistics.externalMemoryUsage?0:t.statistics.gpuMemoryUsage;for(const i of t.components.meta)t.components.buffer.releaseIndex(i.index)}}_updateObjectCameraDistances(t){const e=t.camera.eye,i=t.camera.viewForward,r=E(),n=s=>{go(r,s.center,e);const o=ge(r,i),a=s.radius,l=o<-a?1/0:o<a?0:o-a;s.renderables.forEach(c=>c.distanceToCamera=l)};this._perObjectData.forEach(n),this._perObjectDataEvictionCache.forEach(n)}_renderRegularEdges(t,e,i){const r=t.bindRegularEdges(i,e),n=i.transparency,s=e.camera.perScreenPixelRatio;t.forEachRenderable(o=>{if(!ppe(o)||!o.visible)return;const a=dD(o.regular.lod.lengths,o.distanceToCamera,s);t.renderRegularEdges(r,o,i,e,a)},n)}_renderSilhouetteEdges(t,e,i){const r=t.bindSilhouetteEdges(i,e),n=i.transparency,s=e.camera.perScreenPixelRatio;t.forEachRenderable(o=>{if(!fpe(o)||!o.visible)return;const a=dD(o.silhouette.lod.lengths,o.distanceToCamera,s);t.renderSilhouetteEdges(r,o,i,e,a)},n)}get test(){return{hasRenderedPrimitives:t=>{let e=!1;const i=t.perScreenPixelRatio,r=(n,s)=>n.forEachRenderable(o=>{o.visible&&!e&&(ppe(o)&&(e=dD(o.regular.lod.lengths,o.distanceToCamera,i)>0),!e&&fpe(o)&&(e=dD(o.silhouette.lod.lengths,o.distanceToCamera,i)>0))},s);return this._renderers.forEach(n=>{e||(r(n,qt.OPAQUE),r(n,qt.TRANSPARENT))}),e},getObjectData:t=>this._perObjectData.get(t)}}};function hpe(t){t!=null&&(t.vao.vertexBuffers.instances.dispose(),t.vao.disposeVAOOnly(),t.vao=null)}function mwt(t){let e=null,i=null;for(let r=0;r<t.geometries.length;r++){const n=t.geometries[r];if(n.material.supportsEdges){if(e){if(!vy(e,n.transformation))return!1}else e=n.transformation;if(i||n.localOrigin==null){if(i?.localOrigin!=null&&n.localOrigin!=null&&i.localOrigin.id!==n.localOrigin.id)return!1}else i=n}}return!0}u([p({constructOnly:!0})],Zd.prototype,"rctx",void 0),u([p({constructOnly:!0})],Zd.prototype,"renderSR",void 0),u([p({constructOnly:!0})],Zd.prototype,"viewingMode",void 0),u([p({constructOnly:!0})],Zd.prototype,"techniqueRepository",void 0),u([p({constructOnly:!0})],Zd.prototype,"setNeedsRender",void 0),u([p({constructOnly:!0})],Zd.prototype,"schedule",void 0),u([p({readOnly:!0})],Zd.prototype,"_updatingHandles",void 0),u([p({readOnly:!0})],Zd.prototype,"updating",null),Zd=u([M("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],Zd);class dpe{constructor(e,i,r){this.center=i,this.radius=r,this.renderables=new Array,this.loaded=e,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}}class gwt{constructor(e,i){this.buffer=e,this.meta=i}}class ywt{constructor(e,i){this.vao=e,this.lod=i}}let uV=class{constructor(e,i){this.modelMatrix=e,this.origin=i}};class _wt{constructor(e,i,r,n,s,o,a,l){this.regular=e,this.silhouette=i,this.statistics=r,this.transform=n,this.edgeTransparency=s,this.objectTransparency=o,this.components=a,this.rendererKey=l,this.distanceToCamera=0,this.visible=!0}}function ppe(t){return t.regular!=null}function fpe(t){return t.silhouette!=null}function dD(t,e,i){const r=e*i,n=JIe(t,r,!0);return n===-1?r<t[0]?t.length:0:t.length-n}class mpe{constructor(e,i,r){this.position=e,this.modelTransform=i,this.origin=r}}const gpe=nn(),vwt=()=>Promise.reject();function Wp(t){return window.WebGL2RenderingContext&&t instanceof window.WebGL2RenderingContext}let ype=class{constructor(e,i,r,n,s,o,a,l,c){this.createQuery=e,this.deleteQuery=i,this.resultAvailable=r,this.getResult=n,this.disjoint=s,this.beginTimeElapsed=o,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=c}},Ig=!1;function bwt(t,e){if(e.disjointTimerQuery)return null;let i=t.getExtension("EXT_disjoint_timer_query_webgl2");return i&&Wp(t)?new ype(()=>t.createQuery(),r=>{t.deleteQuery(r),Ig=!1},r=>t.getQueryParameter(r,t.QUERY_RESULT_AVAILABLE),r=>t.getQueryParameter(r,t.QUERY_RESULT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{Ig||(Ig=!0,t.beginQuery(i.TIME_ELAPSED_EXT,r))},()=>{t.endQuery(i.TIME_ELAPSED_EXT),Ig=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>t.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):(i=t.getExtension("EXT_disjoint_timer_query"),i?new ype(()=>i.createQueryEXT(),r=>{i.deleteQueryEXT(r),Ig=!1},r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_AVAILABLE_EXT),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_EXT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{Ig||(Ig=!0,i.beginQueryEXT(i.TIME_ELAPSED_EXT,r))},()=>{i.endQueryEXT(i.TIME_ELAPSED_EXT),Ig=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):null)}function wwt(t,e){const i=t.capabilities.disjointTimerQuery;return i==null?null:new xwt(i,e)}let xwt=class{constructor(e,i){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,i.forEach(r=>{const n=this._timer.createQuery(),s=this._timer.createQuery();this._queryPool.push(n,s),this._queryResults.set(r,null)})}start(){Ig||(this._currentQuery=this._queryPool.pop(),this._currentQuery!=null&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||this._currentQuery==null||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const i=this._queryResults.get(e);if(i==null)return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(i))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const r=this._timer.getResult(i)/1e6;return this._queryPool.unshift(i),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,r}abort(){this._currentQuery!=null&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){this._currentQuery!=null&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{e!=null&&this._timer.deleteQuery(e)})}};var Dr;(function(t){t.OVERLAY="overlay",t.PREPARE="prepare",t.SHADOW_MAP="shadow map",t.LINEAR_DEPTH="linear depth",t.ACCUMULATED_SHADOWS="accumulated shadows",t.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",t.SSAO="SSAO",t.OPAQUE="opaque",t.OPAQUE_EDGES="opaque edges",t.VOXEL="voxel",t.TRANSPARENT="transparent",t.TRANSPARENT_EDGES="transparent edges",t.HUD_VISIBILITY="HUD visibility",t.TRANSPARENT_TERRAIN="transparent terrain",t.ENVIRONMENT="environment",t.LASER_LINES="laser lines",t.OCCLUDED="occluded",t.ANTIALIASING="antialiasing",t.HIGHLIGHTS="highlights",t.HUD="HUD",t.HUD_OCCLUDED="HUD occluded",t.FINISH="finish"})(Dr||(Dr={}));const _pe="Total";let Twt=class{constructor(e){this._rctx=e,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new Qg(_pe),this._cpuTimeSamplers=new Map(Object.values(Dr).map(i=>[i,new Qg(i)])),this._enableGPUTimer=0,this._totalGPUTime=new Qg("GPU"),this._gpuTimeSamplers=new Map(Object.values(Dr).map(i=>[i,new Qg(i)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return this._gpuTimerPool!=null}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(this._gpuTimerPool==null){const i=[...Object.values(Dr),_pe];this._gpuTimerPool=wwt(this._rctx,i)}if(this._gpuTimerPool==null)return{hasGPUTimerSupport:!1,remove:()=>{}};++this._enableGPUTimer;let e=!1;return{hasGPUTimerSupport:!0,remove:()=>{e||(e=!0,--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=rt(this._gpuTimerPool)))}}}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),this._gpuTimerPool&&this._gpuTimerPool.start()}advance(e){const i=performance.now();if(this._cpuTimeSamplers.get(e).record(i-this._lastTimeStampCPU),this._lastTimeStampCPU=i,this._gpuTimerPool){const r=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).record(r),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool){const i=this._gpuTimerPool.stop(Dr.FINISH);this._gpuTimeSamplers.get(Dr.FINISH).record(i),this._rctx.gl.flush()}const e=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+e,this._totalCPUTime.record(e),this._gpuTimerPool&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((i,r)=>i+(r.last||0),0)),++this._totalFrameCount}},pu=class extends we{get _bindParameters(){return this._renderContext.bindParameters}updateRenderFeatures(t=null,e=!ie("disable-feature:high-quality-idle")){this._renderStateFeatures=d9(e,t),this.notifyChange("_renderStateFeatures"),this._renderPlugins.renderFeatureChanged(),this._requestRender()}isFeatureEnabled(t,e=this._state){return this._renderStateFeatures.get(e,t)??!1}setFeatureEnabled(t,e,i){this._renderStateFeatures.set(e,t,i),this.notifyChange("_renderStateFeatures"),this._requestRender()}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(hs.HighQualityTransparency)}get hasReflections(){return this.hasWater&&(this._ssrEnabled||this.isFeatureEnabled(hs.WaterReflection))}get hasDecorations(){return this._materialRenderersHas.decorations||this._renderPlugins.hasDecorations}get hasHighlights(){return this._materialRenderersHas.highlights||this._renderPlugins.produces(le.OPAQUE_MATERIAL,F.Highlight)||this._renderPlugins.produces(le.DRAPED_MATERIAL,F.Highlight)}get hasShadowHighlights(){return this._materialRenderersHas.highlights||this._renderPlugins.produces(le.OPAQUE_MATERIAL,F.ShadowHighlight)}get _magnifierEnabled(){return this._bindParameters.decorations===Uc.ON&&this._magnifierHelper.enabled}get fullResolutionAtmosphere(){return this._stage.view.qualitySettings.highResolutionAtmosphere||this.isFeatureEnabled(hs.HighResolutionAtmosphere)}get hasWater(){return this._materialRenderersHas.water||this._hasOverlayWater}constructor(t,e,i,r,n,s,o,a){super({}),this._stage=t,this._techniqueRepository=r,this._rctx=n,this._compositingHelper=s,this._magnifierHelper=o,this._requestRender=a,this._materialRenderers=new Ut,this._needsTransparentPass=!1,this._materialRenderersHas={hudElements:!1,highlights:!1,water:!1,decorations:!1,occludees:!1},this._hasOverlayWater=!1,this.renderOverlay=l=>{},this._isRendering=!1,this._backgroundColor=Ft(0,0,0,1),this._sliceHelper=new Vbt,this._state=Li.IDLE,this._highQualityTransparencyEnabled=!0,this._terrainTransparency=ll.Opaque,this._ssrEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new Ebt,this._renderHiddenTransparentEdges=()=>{},this._pluginInput=new tbt,this._releaseGeometryLinearDepth=l=>l?.release(),this._geometryLinearDepthFormat=As.DEPTH16_BUFFER,this.fboCache=new uXe(n),this._renderStateFeatures=d9(!ie("disable-feature:high-quality-idle"),t.view.qualityProfile),this._offscreen=new Mbt(this.fboCache,this._compositingHelper),this.performanceInfo=new Twt(this._rctx),this._shadowMap=new JQ(this.fboCache,t.viewingMode),this._highlight=new wO({view:t.view}),this._shadowHighlight=new n2({view:t.view,viewingMode:t.viewingMode}),this._shadowAccumulator=new Ll(this.fboCache,r,t,l=>{const c=this.shadowsEnabled;this._shadowMap.enabled=!0,this._prepare(l.camera,l.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=c},(l,c,h)=>{l.shadowMap.start(l.camera,c,h,!0,this._stage.view.qualitySettings.maximumPixelRatio),this._renderShadowCascades(F.Shadow,l.shadowMap),l.shadowMap.finish(),l.camera.setGLViewport(this._rctx),this._prepare(l.camera,l.contentCamera)},a),this._ssao=new rO({view:this._stage.view}),this._renderContext=new Wat(this._rctx,this._offscreen,this._shadowMap,this._sliceHelper),this._renderPlugins=new I4({renderContext:this._renderContext,techniqueRepository:r,textureRepository:i,materialRepository:e,requestRender:a,controller:t,fbos:this.fboCache,isFeatureEnabled:l=>this.isFeatureEnabled(l)}),this.renderPassManager=new nY,this._renderPlugins.add(this.renderPassManager),this._smaa=new jb({view:this._stage.view}),this._renderPlugins.add(this._smaa),this._blit=new r2({opacity:1,alphaMode:Ea.None}),this._renderPlugins.add(this._blit),this._renderPlugins.add(this._ssao),this._renderPlugins.add(this._highlight),this._renderPlugins.add(this._shadowHighlight),this.addHandles([ne(()=>this._stage.view.state.camera,()=>a(),Ji),ne(()=>pr.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,l=>{this._renderHiddenTransparentEdges=l?()=>this._renderEdges(qt.TRANSPARENT):()=>{},a()},Xt),ne(()=>this._stage.view.environment.background?.color,l=>{const c=l?wP(l):Wu;Gr(this._backgroundColor,c[0]*c[3],c[1]*c[3],c[2]*c[3],c[3]),a()},Ji)])}normalizeCtorArgs(){return{}}destroy(){this._smaa.destroy(),this._blit.destroy(),this._gpuTimerHandle=Tr(this._gpuTimerHandle),this._materialRenderers.forAll(t=>t.dispose()),this._materialRenderers.clear(),this._offscreen.dispose(),this._shadowMap.dispose(),this._ssao.destroy(),this._highlight.dispose(),this._shadowHighlight.destroy(),this._shadowAccumulator.dispose(),this._edgeView=$e(this._edgeView),this.renderPassManager.dispose(),this._releaseFBOs(),this._disposeOffscreenBuffers(),this.fboCache.destroy(),_Se.prune()}_releaseFBOs(){this._bindParameters.ssr.lastFrameColor=li(this._bindParameters.ssr.lastFrameColor),this._bindParameters.multipassTerrain.linearDepth=li(this._bindParameters.multipassTerrain.linearDepth),this._bindParameters.multipassGeometry.linearDepth=li(this._bindParameters.multipassGeometry.linearDepth)}_disposeOffscreenBuffers(){this._offscreen.dispose(),this._disposeBindBuffers()}_disposeBindBuffers(){this._shadowMap.disposeOffscreenBuffers(),this._bindParameters.linearDepth=li(this._bindParameters.linearDepth),this._bindParameters.hudVisibility=li(this._bindParameters.hudVisibility)}get updating(){return this._smaa.updating||this._edgeView!=null&&this._edgeView.updating||this._shadowAccumulator.running||this._renderPlugins.updating||!this.isCameraFinal}ensureEdgeView(){if(this._edgeView==null){const t=this._stage.view.resourceController;this._edgeView=new Zd({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._techniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:Swt(t)}),this.addHandles(ne(()=>this._edgeView?.updating,()=>this._requestRender(),Zi)),this._requestRender()}return this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return O6(this._bindParameters.ssr.reprojectionMatrix,Kr)}set _reprojectionMatrix(t){EX(this._bindParameters.ssr.reprojectionMatrix,t)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){return!!this._shadowMap?.enabled}setParameters(t){const{_shadowMap:e,_bindParameters:i}=this;if(t.qualitySettings?.reflections!==void 0&&this._ssrEnabled!==t.qualitySettings.reflections&&(this._ssrEnabled=t.qualitySettings.reflections,this._requestRender()),t.shadowMap!==void 0&&this._shadowMap.enabled!==t.shadowMap&&(this._shadowMap.enabled=t.shadowMap,this._requestRender()),t.shadowMapMaxCascades!==void 0&&e.maxCascades!==t.shadowMapMaxCascades&&(e.maxCascades=t.shadowMapMaxCascades,this._requestRender()),t.environment!=null){t.environment.weather!=null&&(this._bindParameters.weather=t.environment.weather,this._bindParameters.weatherVisible=!!t.weatherVisible);const r=t.environment.lighting.type!=="virtual";i.enableFillLights!==r&&(i.enableFillLights=r,this._requestRender())}t.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==t.highQualityTransparency&&(this._highQualityTransparencyEnabled=t.highQualityTransparency,this._requestRender()),t.hasOverlayWater!==void 0&&this._hasOverlayWater!==t.hasOverlayWater&&(this._hasOverlayWater=t.hasOverlayWater,this._requestRender()),t.slicePlane!==void 0&&this._sliceHelper.plane!==t.slicePlane&&(this._sliceHelper.plane=t.slicePlane,this._requestRender()),t.terrainTransparency!==void 0&&this._terrainTransparency!==t.terrainTransparency&&(this._terrainTransparency=t.terrainTransparency,this._requestRender()),t.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(t.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(t,e){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:i,removes:r,updates:n}=t;if(i.length===0&&r.length===0&&n.length===0)return;const s=kAe(t);let o=!1;s.forEach((a,l)=>{if(e.done)return;let c=this._materialRenderers.find(h=>h.material===l);if(c==null&&a.adds.length>0){const h=new xR({material:l});h.initializeRenderContext(this._renderPlugins._context),c=h,this._materialRenderers.push(c)}c&&(c.modify(a),c.isEmpty&&(o=!0)),a.removes.forEach(h=>t.removes.removeUnordered(h)),a.adds.forEach(h=>t.adds.removeUnordered(h)),a.updates.forEach(h=>t.updates.removeUnordered(h)),e.madeProgress()}),o&&this._materialRenderers.filterInPlace(a=>!a.isEmpty||(a.dispose(),!1)),this._updateHasFlags(),this._requestRender()}_updateHasFlags(){const t=this._materialRenderersHas;t.decorations=!1,t.highlights=!1,t.hudElements=!1,t.water=!1,t.occludees=!1,this._materialRenderers.forAll(e=>{t.highlights||(t.highlights=e.hasHighlights),t.occludees||(t.occludees=e.hasOccludees),t.water||(t.water=e.hasWater),t.decorations||(t.decorations=e.isDecoration),t.hudElements||(t.hudElements=e.material.produces(le.LINE_CALLOUTS_HUD_DEPTH,F.Color)||e.material.produces(le.HUD_MATERIAL,F.Color)||e.material.produces(le.LABEL_MATERIAL,F.Color))}),this._bindParameters.hasOccludees=t.occludees}updateAnimation(t){const e=this._hasAnimations;return this._hasAnimations=!1,this._materialRenderers.forAll(i=>this._hasAnimations=i.updateAnimation(t)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(t)||this._hasAnimations,this._hasAnimations!==e&&(this._gpuTimerHandle=e?Tr(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}tick(){this.fboCache.clean()}render(t,e,i,r,n){const s=t!=null;this._isRendering=!0,this.performanceInfo.startFrame(),this.fboCache.frame(),this._disposeBindBuffers();const o=this._offscreen,{camera:a,contentCamera:l,mode:c,alignPixelEnabled:h}=i;this._state=c,this._bindParameters.overlay=this.renderOverlay(n),this.performanceInfo.advance(Dr.OVERLAY),this._renderContext.time=n,this._bindParameters.transparencyPassType=it.NONE,this._bindParameters.alignPixelEnabled=h,this._bindParameters.decorations=r;const d=By(this._sliceHelper.plane);r===Uc.OFF&&(this._sliceHelper.plane=null),a.setGLViewport(this._rctx);const f=o.initializeFrame(a,this._backgroundColor,s);this.hasReflections?this._bindParameters.ssr.lastFrameColor=f:f?.release(),this._prepare(a,l),this._renderPlugins.prepareRender(),this.performanceInfo.advance(Dr.PREPARE);const m=this._computeDepthRange(a);this._renderShadowMap(a,this._bindParameters.lighting.mainLight.direction,m),this.performanceInfo.advance(Dr.SHADOW_MAP),this._ensureBindParameters(a,l);const y=this._renderPlugins.produces(le.OPAQUE_TERRAIN)&&(this._terrainTransparency===ll.Semitransparent||this._terrainTransparency===ll.TransparentWithDraped),_=this._highQualityTransparency&&y,v=this._needsTransparentPass||this._renderPlugins.produces(le.TRANSPARENT_MATERIAL);this._prepareShaders(_,v),this._renderLinearDepth(),this.performanceInfo.advance(Dr.LINEAR_DEPTH),this._renderShadowAccumulation(m,a,l),this.performanceInfo.advance(Dr.ACCUMULATED_SHADOWS),this._ensureBindParametersSSR(n),this._renderSSAO(),this.performanceInfo.advance(Dr.SSAO),this._renderContext.output=F.Color,o.bindFbo(),this._renderOpaqueGeometry(),this._renderPlugins.render(le.ENVIRONMENT_OPAQUE),this.performanceInfo.advance(Dr.OPAQUE),this._renderTerrainLinearDepth(_),this._setMultipassTerrain(_),this._renderEdges(qt.OPAQUE),this.performanceInfo.advance(Dr.OPAQUE_EDGES),o.bindFbo(),this._renderPlugins.render(le.VOXEL),this.performanceInfo.advance(Dr.VOXEL),this._renderHiddenTransparentEdges(),v&&(this._oitEnabled?this._renderOITPass(z2.Geometry):this._renderTransparentMaterial()),this.performanceInfo.advance(Dr.TRANSPARENT);const w=this._renderGeometryLinearDepth(_);this._renderHUDVisibility(w),_||this._renderInternalSlot(le.LINE_CALLOUTS),this.performanceInfo.advance(Dr.HUD_VISIBILITY),this._renderObjectAndLayerIdColor(e),this.performanceInfo.advance(Dr.OBJECT_AND_LAYER_ID_COLOR),this._renderEdges(qt.TRANSPARENT,w),this._releaseGeometryLinearDepth(w),this.performanceInfo.advance(Dr.TRANSPARENT_EDGES);const x=y?this._renderTransparentTerrain():null;x&&this._bindParameters.hudVisibility&&(_?this._renderLineCallouts(Sc.Occluded):o.compositeToHUDVisibility(this._bindParameters,x.colorTexture),this._renderHUD(Sc.Occluded,o.color),this.performanceInfo.advance(Dr.HUD_OCCLUDED)),this.performanceInfo.advance(Dr.TRANSPARENT_TERRAIN),this._setTerrainCulling(!1),x&&(o.compositeToFramebuffer(this._bindParameters,x.colorTexture,Ea.PremultipliedAlpha,1),x.release(),_&&(this._renderEdges(qt.OPAQUE),this.performanceInfo.advance(Dr.OPAQUE_EDGES),v&&(this._oitEnabled?this._renderOITPass(z2.Geometry):this._renderTransparentMaterial()),this.performanceInfo.advance(Dr.TRANSPARENT),this._renderEdges(qt.TRANSPARENT),this.performanceInfo.advance(Dr.TRANSPARENT_EDGES))),this._bindParameters.ssao=li(this._bindParameters.ssao),_&&this._renderLineCallouts(Sc.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),o.bindFbo(),this._renderInternalSlot(le.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderPlugins.render(le.ENVIRONMENT_TRANSPARENT),this.performanceInfo.advance(Dr.ENVIRONMENT),this._renderLaserlines(),this.performanceInfo.advance(Dr.LASER_LINES),this._renderOccluded(),this.performanceInfo.advance(Dr.OCCLUDED);const T=this._magnifierEnabled&&t==null?this.fboCache.acquire(xi.RGBA,this._offscreen.width,this._offscreen.height):null,S=this._renderComposite(T??t,this._offscreen.color)??t;this.performanceInfo.advance(Dr.ANTIALIASING),this._renderHUD(Sc.NotOccluded,S),this.performanceInfo.advance(Dr.HUD),this._renderHighlights(S,this._bindParameters),this.performanceInfo.advance(Dr.HIGHLIGHTS),this._magnifierEnabled&&this._magnifierHelper.render(this._rctx,this._bindParameters),S!==t&&(this._rctx.bindFramebuffer(t?.fbo),this._compositingHelper.composite(this._bindParameters,T?.colorTexture,Ea.None)),T!==t&&T?.release(),this.onPostRender&&this.onPostRender(),this._releaseFBOs(),this._offscreen.releaseBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=d,this._isRendering=!1,this.performanceInfo.finishFrame(),s&&(this._releaseFBOs(),this._disposeOffscreenBuffers())}_prepareShaders(t,e){this._renderContext.output=F.Color,this._prepareOpaqueGeometrySlots(),this._setMultipassTerrain(t),this._renderPlugins.prepare(le.TRANSPARENT_TERRAIN),this._setMultipassTerrain(!1),t||this._prepareInternalSlots(this._materialRenderers,le.LINE_CALLOUTS),e&&this._prepareTransparencySlots(),this._prepareInternalSlots(this._materialRenderers,le.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderPlugins.prepare(le.ENVIRONMENT_TRANSPARENT),this._renderPlugins.prepare(le.LASERLINES),this._rctx.gl.flush()}_renderObjectAndLayerIdColor(t){if(t==null||!ie("enable-feature:objectAndLayerId-rendering"))return;const e=this._renderContext.output;this._rctx.bindFramebuffer(t.fbo),this._offscreen.renderToFBO(()=>this._renderAllGeometry(F.ObjectAndLayerIdColor),[0,0,0,0],!0,!0),this._rctx.bindFramebuffer(t.fbo),this._offscreen.renderToFBO(()=>{this._bindParameters.hudRenderStyle=Sc.NotOccluded,this._renderInternalSlot(le.HUD_MATERIAL)},void 0,!0,!0),this._renderContext.output=e}finish(t){this._hasAnimations||this._animationTimestep.clear();const e=this.performanceInfo.gpuSamplingEnabled,i=t===Ln.BACKGROUND;if(i||e){const r=i?this.performanceInfo.elapsedTime:0,n=e?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),s=Math.max(r,n);this._animationTimestep.frame(s,i)}}readDepthPixels(t,e,i){const r=this._bindParameters.linearDepth?.fbo;if(r?.colorTexture)return void r.readPixels(e[0],e[1],e[2],e[3],gt.RGBA,Fs.UNSIGNED_BYTE,i);const n=this.fboCache.acquire(xi.RGBA,this._offscreen.width,this._offscreen.height).acquireDepth(As.DEPTH16_BUFFER);this._rctx.bindFramebuffer(n.fbo),this._ensureBindParameters(t,t),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const s=wr.COLOR_BUFFER_BIT|wr.DEPTH_BUFFER_BIT|wr.STENCIL_BUFFER_BIT;this._rctx.clearSafe(s),this._renderAllGeometry(F.Depth),n.fbo.readPixels(e[0],e[1],e[2],e[3],gt.RGBA,Fs.UNSIGNED_BYTE,i),n.release()}readHUDVisibility(t,e,i,r,n){this._bindParameters.hudVisibility?.fbo.readPixels(t,e,i,r,gt.RGBA,Fs.UNSIGNED_BYTE,n)}readAccumulatedShadow(t){return this._shadowAccumulator.readAccumulatedShadow(t[0],t[1])}_setMultipassTerrain(t){this._setMultipassEnabled(t),this._setTerrainCulling(t)}_setMultipassEnabled(t){this._bindParameters.multipassEnabled=t}_setTerrainCulling(t){this._bindParameters.multipassTerrain.cullAboveGround=t}_renderEdges(t,e){const i=this._edgeView;if(i?.shouldRender()){const{width:r,height:n,depth:s}=this._offscreen,o=this.fboCache.acquire(xi.RGBA,r,n),a=()=>i.render(this._bindParameters,t);this._offscreen.renderToTargets(a,o,e??s,vpe),this._offscreen.compositeToFramebuffer(this._bindParameters,o.colorTexture,Ea.Alpha,1),o.release()}}_renderShadowMap(t,e,i){const r=this._shadowMap;r.enabled&&(r.start(t,e,i,this.isFeatureEnabled(hs.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._shadowHighlight.updateParameters(t,e),this._needsShadowHighlight?(this._renderShadowCascades(F.ShadowHighlight,this._shadowMap),r.moveSnapshot(hC.Highlight),r.clear(),this._renderShadowCascades(F.ShadowExcludeHighlight,this._shadowMap),r.copySnapshot(hC.Default),this._renderShadowCascades(F.ShadowHighlight,this._shadowMap)):this._renderShadowCascades(F.Shadow),r.finish(),t.setGLViewport(this._rctx))}_renderShadowCascades(t,e=this._shadowMap){for(const i of e.cascades)i.camera.setGLViewport(this._rctx),this._prepare(i.camera,i.camera),this._renderAllGeometry(t)}get _needsLinearDepth(){return this._renderPlugins.consumes(F.Depth)||this.hasReflections||this._needsShadowHighlight||this._needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?(this._bindParameters.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.linearDepth,()=>this._renderAllGeometry(F.Depth),[0,0,0,0],xi.RGBA,As.DEPTH_STENCIL_BUFFER),this._bindParameters.linearDepth.releaseDepth(),this._offscreen.bindFbo()):this._bindParameters.linearDepth=li(this._bindParameters.linearDepth)}_renderTerrainLinearDepth(t){if(t){const e=this._renderContext.output;this._renderContext.output=F.Depth,this._bindParameters.multipassTerrain.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.multipassTerrain.linearDepth,()=>this._renderTransparentTerrain(),[-1e10,-1e10,-1e10,1]),this._bindParameters.multipassTerrain.linearDepth.releaseDepth(),this._renderContext.output=e}else this._bindParameters.multipassTerrain.linearDepth=li(this._bindParameters.multipassTerrain.linearDepth)}_renderGeometryLinearDepth(t){if(!t)return void(this._bindParameters.multipassGeometry.linearDepth=li(this._bindParameters.multipassGeometry.linearDepth));const e=this._renderContext.output;return this._bindParameters.multipassGeometry.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.multipassGeometry.linearDepth,()=>this._renderOpaqueGeometryAndTransparentMaterial(F.Depth),[1,1,1,1],xi.RGBA,this._geometryLinearDepthFormat),this._renderContext.output=e,this._bindParameters.multipassGeometry.linearDepth.detachDepth()}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(t){if(!this._needsDepthRange)return JW;const e=k1t(t,this._materialRenderers,this._stage.layers);return mC(e,this._renderPlugins.queryDepthRange(t)),e.near=Math.max(t.near,e.near),e.far=Math.min(t.far,e.far),e}_renderAllGeometry(t){this._renderContext.output=t,this._renderPlugins.prepare(le.TRANSPARENT_TERRAIN),this._renderOpaqueGeometryAndTransparentMaterial(t),this._renderTransparentTerrain()}_renderOpaqueGeometryAndTransparentMaterial(t){this._renderContext.output=t,this._renderPlugins.prepare(le.TRANSPARENT_MATERIAL),this._renderOpaqueGeometry(),this._renderTransparentMaterial()}_renderSSAO(){if(!this._renderPlugins.produces(le.SSAO))return;const t=this._offscreen.renderToCachedFBO(null,()=>this._renderAllGeometry(F.Normal),[0,0,0,0],xi.RGBA4,As.DEPTH24_BUFFER);t.releaseDepth(),this._offscreen.bindFbo(),this._pluginInput.normal=t,this._bindParameters.ssao=this._renderPlugins.render(le.SSAO,this._pluginInput),t.release()}_prepareOpaqueGeometrySlots(){this._renderPlugins.prepare(le.INTEGRATED_MESH),this._renderPlugins.prepare(le.OPAQUE_TERRAIN),this._renderPlugins.prepare(le.OPAQUE_MATERIAL),this._renderPlugins.prepare(le.ENVIRONMENT_OPAQUE),this._prepareInternalSlots(this._materialRenderers,le.OPAQUE_MATERIAL)}_renderOpaqueGeometry(){this._renderPlugins.render(le.INTEGRATED_MESH),this._renderPlugins.render(le.OPAQUE_TERRAIN),this._renderInternalSlot(le.OPAQUE_MATERIAL),this._renderPlugins.render(le.OPAQUE_MATERIAL)}_renderTransparentMaterial(){this._renderInternalSlot(le.TRANSPARENT_MATERIAL),this._renderPlugins.render(le.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){if(!this._renderPlugins.produces(le.TRANSPARENT_TERRAIN))return;const t=()=>this._renderPlugins.render(le.TRANSPARENT_TERRAIN,null);if(this._renderContext.output!==F.Color)return void t();const{width:e,height:i,depth:r}=this._offscreen,n=this.fboCache.acquire(xi.RGBA,e,i);return this._offscreen.renderToTargets(t,n,r,[0,0,0,0]),n}_renderHUDVisibility(t){this._shouldRenderInternalSlot(this._materialRenderers,le.OCCLUSION_PIXELS)?(this._bindParameters.hudVisibility=this._offscreen.renderHUDVisibility(this._bindParameters.hudVisibility,()=>this._renderInternalSlot(le.OCCLUSION_PIXELS),t),this._offscreen.bindFbo()):this._bindParameters.hudVisibility=li(this._bindParameters.hudVisibility)}_renderLineCallouts(t){if(this._bindParameters.hudRenderStyle=t,t===Sc.Occluded){const e=()=>this._renderInternalSlot(le.LINE_CALLOUTS),{width:i,height:r,color:n}=this._offscreen,s=this.fboCache.acquireDepth(As.DEPTH16_BUFFER,i,r);this._offscreen.renderToTargets(e,n,s,void 0,!0,!0),s.release()}else this._renderInternalSlot(le.LINE_CALLOUTS)}_renderLaserlines(){if(this._renderPlugins.render(le.LASERLINES),this._renderPlugins.produces(le.LASERLINES_CONTRAST_CONTROL)){const t=this._offscreen,{width:e,height:i,depth:r}=t,n=this.fboCache.acquire(xi.RGBA,e,i),s=()=>this._renderPlugins.render(le.LASERLINES_CONTRAST_CONTROL);t.renderToTargets(s,n,r,vpe),t.compositeToFramebuffer(this._bindParameters,n.colorTexture,Ea.PremultipliedAlpha,1),n.release()}}_renderHUD(t,e){if(this._materialRenderersHas.hudElements)if(this._oitEnabled){const i=this._renderOITPass(z2.HUD,t);this._rctx.bindFramebuffer(e?.fbo),this._compositingHelper.composite(this._bindParameters,i.colorTexture,Ea.PremultipliedAlpha),i.release()}else if(t===Sc.Occluded){const i=()=>this._renderHUDElements(t),{width:r,height:n,color:s}=this._offscreen,o=this.fboCache.acquireDepth(As.DEPTH16_BUFFER,r,n);this._offscreen.renderToTargets(i,s,o,void 0,!0,!0),o.release()}else this._rctx.bindFramebuffer(null),e?.acquireDepth(As.DEPTH16_BUFFER),this._rctx.bindFramebuffer(e?.fbo),this._renderHUDElements(t),e?.releaseDepth()}_renderHUDElements(t){this._bindParameters.hudRenderStyle=t,this._prepareInternalSlots(this._materialRenderers,le.LINE_CALLOUTS_HUD_DEPTH,le.HUD_MATERIAL,le.LABEL_MATERIAL),this._renderInternalSlot(le.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(le.HUD_MATERIAL),this._renderInternalSlot(le.LABEL_MATERIAL)}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._renderPlugins.produces(le.SHADOW_HIGHLIGHT)&&this.hasShadowHighlights}_renderHighlights(t,e){if(!this.hasHighlights||e.decorations===Uc.OFF)return;const i=()=>{this._renderAllGeometry(F.Highlight),this._rctx.clearSafe(wr.DEPTH_BUFFER_BIT),this._renderHUDElements(Sc.Both)},r=this._offscreen.renderToCachedFBO(null,i,[0,0,0,0],xi.RGBA4,As.DEPTH_STENCIL_BUFFER);r.releaseDepth(),this._needsShadowHighlight&&(this._pluginInput.highlight=r,this._renderPlugins.render(le.SHADOW_HIGHLIGHT,this._pluginInput,t)),this._renderPlugins.produces(le.HIGHLIGHT)&&(this._pluginInput.composite=null,this._pluginInput.normal=null,this._pluginInput.highlight=r,this._renderPlugins.render(le.HIGHLIGHT,this._pluginInput,t)),r.release()}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_renderShadowAccumulation(t,e,i){this._needsShadowCast&&this._bindParameters.linearDepth?.colorTexture&&this._shadowAccumulator.renderAccumulation(this._bindParameters.linearDepth,t,e,i)}_prepareTransparencySlots(){this._renderContext.output=F.Alpha,this._bindParameters.transparencyPassType=it.Alpha,this._prepareInternalSlots(this._materialRenderers,le.TRANSPARENT_MATERIAL),this._renderPlugins.prepare(le.TRANSPARENT_MATERIAL),this._renderContext.output=F.Color,this._bindParameters.transparencyPassType=it.Color,this._prepareInternalSlots(this._materialRenderers,le.TRANSPARENT_MATERIAL),this._renderPlugins.prepare(le.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=it.FrontFace,this._prepareInternalSlots(this._materialRenderers,le.TRANSPARENT_MATERIAL),this._renderPlugins.prepare(le.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=it.NONE}_renderOITPass(t,e=Sc.Both){const i=t===z2.HUD,r=i?this.fboCache.acquire(xi.RGBA,this._offscreen.width,this._offscreen.height):null,n=i?()=>this._renderHUDElements(e):()=>this._renderTransparentMaterial(),s=this._renderContext.output;this._renderContext.output=F.Alpha,this._bindParameters.transparencyPassType=it.Alpha;const o=this._offscreen.renderOITPass(n,it.Alpha,i);this._renderContext.output=F.Color,this._bindParameters.transparencyPassType=it.Color;const a=this._offscreen.renderOITPass(n,it.Color,i);this._bindParameters.transparencyPassType=it.FrontFace;const l=this._offscreen.renderOITPass(n,it.FrontFace,i);return this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,a,o,l,r),r?.releaseDepth(),l.release(),a.release(),o.release(),this._bindParameters.transparencyPassType=it.NONE,this._renderContext.output=s,r}_renderOccluded(){let t=0;au.clear(),this._materialRenderers.forAll(s=>{s.material&&s.material.isVisible()&&s.material.parameters.renderOccluded===Vr.OccludeAndTransparentStencil&&(t|=s.material.parameters.renderOccluded,au.push(s))});const e=this._offscreen,i=(s,o,a,l,c)=>{if(!(t&o))return;const{width:h,height:d,depth:f}=e,m=this.fboCache.acquire(xi.RGBA,h,d);e.renderToTargets(a,m,f,[0,0,0,0],l,c),e.compositeToFramebuffer(this._bindParameters,m.colorTexture,Ea.PremultipliedAlpha,s),m.release()};au.length!==0&&(this._prepareInternalSlots(au,le.OCCLUDER_MATERIAL,le.TRANSPARENT_OCCLUDER_MATERIAL),this._renderInternalSlot(le.OCCLUDER_MATERIAL,au),i(.5,Vr.OccludeAndTransparentStencil,()=>this._renderInternalSlot(le.TRANSPARENT_OCCLUDER_MATERIAL,au),!1,!1)),au.clear(),this._materialRenderers.forAll(s=>{s.material&&s.material.isVisible()&&(s.material.parameters.renderOccluded===Vr.OccludeAndTransparent||s.material.parameters.renderOccluded===Vr.Transparent||s.material.parameters.renderOccluded===Vr.Opaque)&&(t|=s.material.parameters.renderOccluded,au.push(s))});const r=this._renderPlugins.renderOccludedFlags;if(t|=r,!t)return;const n=s=>{this._renderContext.renderOccludedMask=s,this._prepareInternalSlots(au,le.OPAQUE_MATERIAL,le.TRANSPARENT_MATERIAL,le.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),r>Vr.Occlude&&this._renderPlugins.render(le.OCCLUDED_TERRAIN),this._renderInternalSlot(le.OPAQUE_MATERIAL,au),this._renderInternalSlot(le.TRANSPARENT_MATERIAL,au),this._renderInternalSlot(le.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,au),this._renderContext.resetRenderOccludedMask()};this._renderContext.output=F.Color,i(.5,Vr.OccludeAndTransparent,()=>n(Vr.OccludeAndTransparent),!0,Zl.OutlineVisualElementMask),i(.5,Vr.Transparent,()=>n(Vr.Transparent),!0,Zl.OutlineVisualElementMask),i(1,Vr.Opaque,()=>n(Vr.Opaque),!0,Zl.OutlineVisualElementMask),au.clear()}_renderComposite(t,e){this._renderPlugins.consumes(F.CompositeColor)&&(this._pluginInput.composite=e);let i=null;const r=this._renderPlugins.produces(le.COMPOSITE);r&&(i=this._renderPlugins.renderComposition(le.COMPOSITE,this._pluginInput),this._pluginInput.composite=i);const n=this._renderPlugins.produces(le.ANTIALIASING),s=this._renderPlugins.render(n?le.ANTIALIASING:le.BLIT,this._pluginInput,t);return r&&i?.release(),s}_prepare(t,e){this._needsTransparentPass=this._materialRenderers.some(i=>i.material.produces(le.TRANSPARENT_MATERIAL,F.Color)),this._bindParameters.camera=t,this._bindParameters.contentCamera=e}_ensureBindParameters(t,e){this._bindParameters.camera=t,this._bindParameters.contentCamera=e;const i=this._renderContext.offscreenRenderingHelper;this._bindParameters.mainColor=i.colorTexture,this._bindParameters.mainDepth=i.depthTexture}_ensureBindParametersSSR(t){if(this._bindParameters.ssr.lastFrameColor){this._ssrEnableTime==null&&(this._ssrEnableTime=t),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=Kr:(fs(wpe,this._bindParameters.camera.viewMatrix),fs(bpe,this._bindParameters.camera.projectionMatrix),qi(fS,wpe,bpe),qi(fS,this._renderContext.lastFrameCamera.viewMatrix,fS),qi(fS,this._renderContext.lastFrameCamera.projectionMatrix,fS),this._reprojectionMatrix=fS);const e=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=e>0?Math.min(e,t-this._ssrEnableTime)/e:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._reprojectionMatrix=Kr,this._ssrEnableTime=null}_shouldRenderInternalSlot(t,e){return this._bindParameters.slot=e,t.some(i=>i.prepareTechnique(this._renderContext)!=null)}_prepareInternalSlots(t,...e){for(const i of e)this._bindParameters.slot=i,t.forAll(r=>r.prepareTechnique(this._renderContext)!=null)}_renderInternalSlot(t,e=this._materialRenderers){this._bindParameters.slot=t,e.forAll(i=>{const r=i.prepareTechnique(this._renderContext);r&&i.renderNode(this._renderContext,r)})}get memoryInfo(){return{fbos:this.fboCache.usedMemory,vaos:this._materialRenderers.reduce((t,e)=>t+e.usedMemory,0),plugins:this._renderPlugins.usedMemory}}getMemoryForMaterial(t){return t==null?0:this._materialRenderers.find(i=>i.material===t)?.usedMemory??0}get usedMemory(){return this.fboCache.usedMemory+(this.edgeView?.usedMemory??0)+this._renderPlugins.usedMemory}get test(){const t=this;return{offscreen:this._offscreen,shadowMap:this._shadowMap,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,resetRenderStateFeatures:()=>{t._renderStateFeatures=d9(),this._renderPlugins.renderFeatureChanged(),this._requestRender()},releaseGeometryLinearDepth(e){t._releaseGeometryLinearDepth=e??(i=>i?.release()),t._geometryLinearDepthFormat=e?As.DEPTH_STENCIL_TEXTURE:As.DEPTH16_BUFFER},getFramebufferTexture:e=>{switch(e){case B2.Color:return t._offscreen.colorTexture;case B2.LinearDepth:return t._bindParameters.linearDepth?.colorTexture;case B2.ShadowMap:return t._shadowMap.depthTexture;case B2.HudVisibility:return t._bindParameters.hudVisibility?.colorTexture}}}}};var z2,B2;u([p()],pu.prototype,"_renderPlugins",void 0),u([p()],pu.prototype,"_shadowAccumulator",void 0),u([p()],pu.prototype,"_state",void 0),u([p()],pu.prototype,"_renderStateFeatures",void 0),u([p({readOnly:!0})],pu.prototype,"fullResolutionAtmosphere",null),u([p()],pu.prototype,"_smaa",void 0),u([p()],pu.prototype,"_blit",void 0),u([p({autoDestroy:!0})],pu.prototype,"_edgeView",void 0),u([p()],pu.prototype,"updating",null),u([p()],pu.prototype,"isCameraFinal",null),pu=u([M("esri.views.3d.webgl-engine.lib.Renderer")],pu),function(t){t[t.Geometry=0]="Geometry",t[t.HUD=1]="HUD"}(z2||(z2={})),function(t){t[t.Color=0]="Color",t[t.LinearDepth=1]="LinearDepth",t[t.ShadowMap=2]="ShadowMap",t[t.HudVisibility=3]="HudVisibility"}(B2||(B2={}));const vpe=[0,0,0,0],au=new Ut,bpe=be(),wpe=be(),fS=be();function Swt(t){return e=>t.immediate.schedule(e)}let Ewt=class{constructor(e){this._rctx=e,this._vao=pXe(e)}destroy(){this._vao=rt(this._vao)}draw(){this._vao!=null&&(this._rctx.bindVAO(this._vao),this._rctx.drawArrays(ci.TRIANGLES,0,3))}get test(){return{cachedWebGLObjects:hV(this._vao?.glName)+hV(this._vao?.indexBuffer?.glName)+hV(this._vao?.vertexBuffers.geometry)}}};function hV(t){return t!=null?1:0}let ZPe=class JPe{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:`#version 300 es
    precision highp float;

    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,fragment:`#version 300 es
    precision highp float;

    out vec4 fragColor;

    void main(void) {
      fragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`}}_createHelperProgram(){const e=JPe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}_createIndexbuffer(){return Ui.createIndex(this._rctx,Ri.STATIC_DRAW,new Uint32Array([0]))}run(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,Ct.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(ci.POINTS,1,Qe.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}get test(){return{cachedWebGLObjects:this._indexBuffer?.glName?1:0}}},xpe=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:Te.ONE,dstRGB:Te.ZERO,srcAlpha:Te.ONE,dstAlpha:Te.ZERO},this.blendEquation={mode:Pm.ADD,modeAlpha:Pm.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=bp.BACK,this.frontFace=eC.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=Bi.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:bp.FRONT_AND_BACK,func:Bi.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:bp.FRONT_AND_BACK,fail:tn.KEEP,zFail:tn.KEEP,zPass:tn.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},Cwt=class{constructor(e){this._allocations=new Map,e?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(e){this._allocations.set(e,new Error().stack)}remove(e){this._allocations.delete(e)}get information(){let e="";if(this._allocations.size>0){e+=`${this._allocations.size} live object allocations:
`;const i=new Map;this._allocations.forEach(r=>{i.set(r,(i.get(r)??0)+1)}),i.forEach((r,n)=>{const s=n.split(`
`);s.shift(),s.shift(),e+=`${r}: ${s.shift()}
`,s.forEach(o=>e+=`   ${o}
`)})}return e}};const Awt={RECORD_ALLOCATIONS:!1};let Owt=class{constructor(){for(this._current=new Array,this._allocations=new Cwt(Awt.RECORD_ALLOCATIONS);this._current.length<Yn.COUNT;)this._current.push(0)}increment(e,i,r=1){this._current[e]+=r,this._allocations.add(i)}decrement(e,i,r=1){this._current[e]-=r,this._allocations.remove(i)}get current(){return this._current}get total(){return this.current.reduce((e,i,r)=>e+(r<Yn.UNCOUNTED?i:0),0)}get resourceInformation(){let e="";if(this.total>0){e+=`Live objects:
`;for(let i=0;i<Yn.COUNT;++i){const r=this._current[i];r>0&&(e+=`${Yn[i]}: ${r}
`)}}return e+=this._allocations.information,e}},Rwt=class{constructor(e,i,r){const n=i.textureFilterAnisotropic,s=r.maxAnisotropy??1/0;this.versionString=e.getParameter(e.VERSION),this.maxVertexTextureImageUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxVertexAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxMaxAnisotropy=n?Math.min(e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY),s):1,this.maxTextureImageUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxRenderbufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),this.maxViewportDims=e.getParameter(e.MAX_VIEWPORT_DIMS),Wp(e)?(this.maxUniformBufferBindings=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=e.getParameter(e.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=e.getParameter(e.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=e.getParameter(e.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=e.getParameter(e.MAX_SAMPLES)):(this.maxUniformBufferBindings=0,this.maxVertexUniformBlocks=0,this.maxFragmentUniformBlocks=0,this.maxUniformBlockSize=0,this.uniformBufferOffsetAlignment=1,this.maxArrayTextureLayers=1,this.maxSamples=1)}};const Pwt=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var Tpe,KPe={exports:{}};(Tpe=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(KPe.exports=Tpe);const Mwt=VM(KPe.exports);var Spe,oY={exports:{}};oY.exports,Spe=oY,function(t){var e=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];e!==void 0&&(Spe.exports=e)}();const Epe=VM(oY.exports);var QPe={exports:{}};(function(t){(function(e){var i=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();i!==void 0&&(t.exports=i)})()})(QPe);const $wt=VM(QPe.exports);var Md=999,Cpe=9999,dV=0,pV=1,Ape=2,Ope=3,Rpe=4,pD=5,Iwt=6,Lwt=7,Dwt=8,Ppe=9,Nwt=10,Mpe=11,Fwt=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function kwt(){var t,e,i,r=0,n=0,s=Md,o=[],a=[],l=1,c=0,h=0,d=!1,f=!1,m="";return function(L){return a=[],L!==null?_(L.replace?L.replace(/\r\n/g,`
`):L):v()};function y(L){L.length&&a.push({type:Fwt[s],data:L,position:h,line:l,column:c})}function _(L){var z;for(r=0,i=(m+=L).length;t=m[r],r<i;){switch(z=r,s){case dV:r=C();break;case pV:r=S();break;case Ape:r=T();break;case Ope:r=A();break;case Rpe:r=N();break;case Mpe:r=D();break;case pD:r=k();break;case Cpe:r=B();break;case Ppe:r=x();break;case Md:r=w()}z!==r&&(m[z]===`
`?(c=0,++l):++c)}return n+=r,m=m.slice(r),a}function v(L){return o.length&&y(o.join("")),s=Nwt,y("(eof)"),a}function w(){return o=o.length?[]:o,e==="/"&&t==="*"?(h=n+r-1,s=dV,e=t,r+1):e==="/"&&t==="/"?(h=n+r-1,s=pV,e=t,r+1):t==="#"?(s=Ape,h=n+r,r):/\s/.test(t)?(s=Ppe,h=n+r,r):(d=/\d/.test(t),f=/[^\w_]/.test(t),h=n+r,s=d?Rpe:f?Ope:Cpe,r)}function x(){return/[^\s]/g.test(t)?(y(o.join("")),s=Md,r):(o.push(t),e=t,r+1)}function T(){return t!=="\r"&&t!==`
`||e==="\\"?(o.push(t),e=t,r+1):(y(o.join("")),s=Md,r)}function S(){return T()}function C(){return t==="/"&&e==="*"?(o.push(t),y(o.join("")),s=Md,r+1):(o.push(t),e=t,r+1)}function A(){if(e==="."&&/\d/.test(t))return s=pD,r;if(e==="/"&&t==="*")return s=dV,r;if(e==="/"&&t==="/")return s=pV,r;if(t==="."&&o.length){for(;R(o););return s=pD,r}if(t===";"||t===")"||t==="("){if(o.length)for(;R(o););return y(t),s=Md,r+1}var L=o.length===2&&t!=="=";if(/[\w_\d\s]/.test(t)||L){for(;R(o););return s=Md,r}return o.push(t),e=t,r+1}function R(L){for(var z,j,H=0;;){if(z=Epe.indexOf(L.slice(0,L.length+H).join("")),j=Epe[z],z===-1){if(H--+L.length>0)continue;j=L.slice(0,1).join("")}return y(j),h+=j.length,(o=o.slice(j.length)).length}}function D(){return/[^a-fA-F0-9]/.test(t)?(y(o.join("")),s=Md,r):(o.push(t),e=t,r+1)}function N(){return t==="."||/[eE]/.test(t)?(o.push(t),s=pD,e=t,r+1):t==="x"&&o.length===1&&o[0]==="0"?(s=Mpe,o.push(t),e=t,r+1):/[^\d]/.test(t)?(y(o.join("")),s=Md,r):(o.push(t),e=t,r+1)}function k(){return t==="f"&&(o.push(t),e=t,r+=1),/[eE]/.test(t)||t==="-"&&/[eE]/.test(e)?(o.push(t),e=t,r+1):/[^\d]/.test(t)?(y(o.join("")),s=Md,r):(o.push(t),e=t,r+1)}function B(){if(/[^\d\w_]/.test(t)){var L=o.join("");return s=Mwt.indexOf(L)>-1?Dwt:$wt.indexOf(L)>-1?Lwt:Iwt,y(o.join("")),s=Md,r}return o.push(t),e=t,r+1}}function Uwt(t){var e=kwt(),i=[];return i=(i=i.concat(e(t))).concat(e(null))}function zwt(t){return Uwt(t)}function Bwt(t){return t.map(e=>e.type!=="eof"?e.data:"").join("")}const fV=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]);function Vwt(t,e="100",i="300 es"){const r=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const n of t)if(n.type==="preprocessor"){const s=r.exec(n.data);if(s){const o=s[1].replaceAll(/\s\s+/g," ");if(o===i)return o;if(o===e)return n.data="#version "+i,e;throw new Error("unknown glsl version: "+o)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:`
`}),null}function Gwt(t,e){for(let i=e-1;i>=0;i--){const r=t[i];if(r.type!=="whitespace"&&r.type!=="block-comment"){if(r.type!=="keyword")break;if(r.data==="attribute"||r.data==="in")return!0}}return!1}function xO(t,e,i,r){r=r||i;for(const n of t)if(n.type==="ident"&&n.data===i)return r in e?e[r]++:e[r]=0,xO(t,e,r+"_"+e[r],r);return i}function eMe(t,e,i="afterVersion"){function r(l,c){for(let h=c;h<l.length;h++){const d=l[h];if(d.type==="operator"&&d.data===";")return h}return null}function n(l){let c=-1,h=0,d=-1;for(let f=0;f<l.length;f++){const m=l[f];if(m.type==="preprocessor"&&(/\#(if|ifdef|ifndef)\s+.+/.test(m.data)?++h:/\#endif\s*.*/.test(m.data)&&--h),i!=="afterVersion"&&i!=="afterPrecision"||m.type==="preprocessor"&&m.data.startsWith("#version")&&(d=Math.max(d,f)),i==="afterPrecision"&&m.type==="keyword"&&m.data==="precision"){const y=r(l,f);if(y===null)throw new Error("precision statement not followed by any semicolons!");d=Math.max(d,y)}c<d&&h===0&&(c=f)}return c+1}const s={data:`
`,type:"whitespace"},o=l=>l<t.length&&/[^\r\n]$/.test(t[l].data);let a=n(t);o(a-1)&&t.splice(a++,0,s);for(const l of e)t.splice(a++,0,l);o(a-1)&&o(a)&&t.splice(a,0,s)}function jwt(t,e,i,r="lowp"){eMe(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function Hwt(t,e,i,r,n="lowp"){eMe(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:n},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function qwt(t,e){let i,r,n=-1;for(let s=e;s<t.length;s++){const o=t[s];if(o.type==="operator"&&(o.data==="["&&(i=s),o.data==="]")){r=s;break}o.type==="integer"&&(n=parseInt(o.data,10))}return i&&r&&t.splice(i,r-i+1),n}function $pe(t,e){if(t.startsWith("#version 300"))return t;const i=zwt(t);if(Vwt(i,"100","300 es")==="300 es")return t;let r=null,n=null;const s={},o={};for(let a=0;a<i.length;++a){const l=i[a];switch(l.type){case"keyword":e===Pu.VERTEX_SHADER&&l.data==="attribute"?l.data="in":l.data==="varying"&&(l.data=e===Pu.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(l.data.trim())&&(l.data=l.data.replaceAll(/(2D|Cube|EXT)/g,"")),e===Pu.FRAGMENT_SHADER&&l.data==="gl_FragColor"&&(r||(r=xO(i,s,"fragColor"),jwt(i,r,"vec4")),l.data=r),e===Pu.FRAGMENT_SHADER&&l.data==="gl_FragData"){const c=qwt(i,a+1),h=xO(i,s,"fragData");Hwt(i,h,"vec4",c,"mediump"),l.data=h}else e===Pu.FRAGMENT_SHADER&&l.data==="gl_FragDepthEXT"&&(n||(n=xO(i,s,"gl_FragDepth")),l.data=n);break;case"ident":if(Pwt.includes(l.data)){if(e===Pu.VERTEX_SHADER&&Gwt(i,a))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");l.data in o||(o[l.data]=xO(i,s,l.data)),l.data=o[l.data]}}}for(let a=i.length-1;a>=0;--a){const l=i[a];if(l.type==="preprocessor"){const c=l.data.match(/\#extension\s+(.*)\:/);if(c&&c[1]&&fV.has(c[1].trim())){const f=i[a+1];i.splice(a,f&&f.type==="whitespace"?2:1)}const h=l.data.match(/\#ifdef\s+(.*)/);h&&h[1]&&fV.has(h[1].trim())&&(l.data="#if 1");const d=l.data.match(/\#ifndef\s+(.*)/);d&&d[1]&&fV.has(d[1].trim())&&(l.data="#if 0")}}return Wwt(t,Bwt(i))}function Wwt(t,e){return e}const Ywt=4294967295;let Xwt=class{constructor(e,i,r,n,s=new Map){this._context=e,this._locations=n,this._uniformBlockBindings=s,this._refCount=1,this._compiled=!1,this._linesOfCode=0,this._nameToUniformLocation=new Map,this._nameToUniform1=new Map,this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),i.length===0&&console.error("Shaders source should not be empty!"),this._context.type===fi.WEBGL2&&(i=$pe(i,Pu.VERTEX_SHADER),r=$pe(r,Pu.FRAGMENT_SHADER)),this._vShader=Ipe(this._context,Pu.VERTEX_SHADER,i),this._fShader=Ipe(this._context,Pu.FRAGMENT_SHADER,r),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(Yn.Shader,this),MH()&&(this.vertexShader=i,this.fragmentShader=r);const o=this._context.gl,a=o.createProgram();if(o.attachShader(a,this._vShader),o.attachShader(a,this._fShader),this._locations.forEach((l,c)=>o.bindAttribLocation(a,l,c)),o.linkProgram(a),MH()&&!o.getProgramParameter(a,o.LINK_STATUS)&&console.error(`Could not link shader
validated: ${o.getProgramParameter(a,o.VALIDATE_STATUS)}, gl error ${o.getError()}, vertex: ${o.getShaderParameter(this._vShader,o.COMPILE_STATUS)}, fragment: ${o.getShaderParameter(this._fShader,o.COMPILE_STATUS)}, info log: ${o.getProgramInfoLog(a)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===fi.WEBGL2){const l=o;for(const[c,h]of this._uniformBlockBindings){const d=l.getUniformBlockIndex(a,c);d<Ywt&&l.uniformBlockBinding(a,d,h)}}this._glName=a,this._context.instanceCounter.increment(Yn.Program,this)}get glName(){return this._glName}get hasGLName(){return this._glName!=null}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return e==null||this.glName==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl,i=this._context.instanceCounter;this._nameToUniformLocation.forEach(r=>r&&i.decrement(Yn.Uniform,r)),this._nameToUniformLocation.clear(),this._vShader&&(this._linesOfCode>0&&(i.decrement(Yn.LinesOfCode,this._vShader,this._linesOfCode),this._linesOfCode=0),e.deleteShader(this._vShader),this._vShader=null,i.decrement(Yn.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,i.decrement(Yn.Program,this))}ref(){++this._refCount}_getUniformLocation(e){const i=this._nameToUniformLocation.get(e);if(i!==void 0)return i;if(this.glName){const r=this._context.gl.getUniformLocation(this.glName,e);return this._nameToUniformLocation.set(e,r),r&&this._context.instanceCounter.increment(Yn.Uniform,r),r}return null}hasUniform(e){return this._getUniformLocation(e)!=null}setUniform1i(e,i){const r=this._nameToUniform1.get(e);r!==void 0&&i===r||(this._context.gl.uniform1i(this._getUniformLocation(e),i),this._nameToUniform1.set(e,i))}setUniform1iv(e,i){yf(this._nameToUniform1v,e,i)&&this._context.gl.uniform1iv(this._getUniformLocation(e),i)}setUniform2iv(e,i){yf(this._nameToUniform2,e,i)&&this._context.gl.uniform2iv(this._getUniformLocation(e),i)}setUniform3iv(e,i){yf(this._nameToUniform3,e,i)&&this._context.gl.uniform3iv(this._getUniformLocation(e),i)}setUniform4iv(e,i){yf(this._nameToUniform4,e,i)&&this._context.gl.uniform4iv(this._getUniformLocation(e),i)}setUniform1f(e,i){const r=this._nameToUniform1.get(e);r!==void 0&&i===r||(this._context.gl.uniform1f(this._getUniformLocation(e),i),this._nameToUniform1.set(e,i))}setUniform1fv(e,i){yf(this._nameToUniform1v,e,i)&&this._context.gl.uniform1fv(this._getUniformLocation(e),i)}setUniform2f(e,i,r){const n=this._nameToUniform2.get(e);n===void 0?(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),this._nameToUniform2.set(e,[i,r])):i===n[0]&&r===n[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),n[0]=i,n[1]=r)}setUniform2fv(e,i){yf(this._nameToUniform2,e,i)&&this._context.gl.uniform2fv(this._getUniformLocation(e),i)}setUniform3f(e,i,r,n){const s=this._nameToUniform3.get(e);s===void 0?(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,n),this._nameToUniform3.set(e,[i,r,n])):i===s[0]&&r===s[1]&&n===s[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,n),s[0]=i,s[1]=r,s[2]=n)}setUniform3fv(e,i){yf(this._nameToUniform3,e,i)&&this._context.gl.uniform3fv(this._getUniformLocation(e),i)}setUniform4f(e,i,r,n,s){const o=this._nameToUniform4.get(e);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,n,s),this._nameToUniform4.set(e,[i,r,n,s])):o!==void 0&&i===o[0]&&r===o[1]&&n===o[2]&&s===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,n,s),o[0]=i,o[1]=r,o[2]=n,o[3]=s)}setUniform4fv(e,i){yf(this._nameToUniform4,e,i)&&this._context.gl.uniform4fv(this._getUniformLocation(e),i)}setUniformMatrix3fv(e,i,r=!1){yf(this._nameToUniformMatrix3,e,i)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(e),r,i)}setUniformMatrix4fv(e,i,r=!1){yf(this._nameToUniformMatrix4,e,i)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(e),r,i)}stop(){}};function Ipe(t,e,i){const r=t.gl,n=r.createShader(e);return r.shaderSource(n,i),r.compileShader(n),MH()&&!r.getShaderParameter(n,r.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===Pu.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(r.getShaderInfoLog(n)),console.error(Zwt(i))),n}function Zwt(t){let e=2;return t.replaceAll(`
`,()=>`
`+Jwt(e++)+":")}function Jwt(t){return t>=1e3?t.toString():("  "+t).slice(-3)}function yf(t,e,i){const r=t.get(e);return r?EX(r,i):(t.set(e,Array.from(i)),!0)}let Kwt=class{constructor(e){this._rctx=e,this._store=new BC}dispose(){this._store.forEach(e=>e.forEach(i=>i.dispose())),this._store.clear()}acquire(e,i,r,n){const s=this._store.get(e,i);if(s!=null)return s.ref(),s;const o=new Xwt(this._rctx,e,i,r,n);return o.ref(),this._store.set(e,i,o),o}get test(){let e=0;return this._store.forEach(i=>i.forEach(r=>e+=r.hasGLName?2:1)),{cachedWebGLProgramObjects:e}}},o$=class{constructor(){this._result=!1}dispose(){this._program=rt(this._program)}get result(){return this._program!=null&&(this._result=this._test(this._program),this.dispose()),this._result}},Qwt=class extends o${constructor(e){super(),this._rctx=e,this._helperProgram=null,this._rctx.type===fi.WEBGL2&&ie("mac")&&ie("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){super.dispose(),this._helperProgram?.dispose(),this._helperProgram=null}_test(e){const i=this._rctx,r=i.getBoundFramebufferObject(),{x:n,y:s,width:o,height:a}=i.getViewport();i.resetState();const l=new Hi(1);l.wrapMode=Vt.CLAMP_TO_EDGE,l.samplingMode=zt.NEAREST;const c=new jp(i,l),h=Ui.createIndex(this._rctx,Ri.STATIC_DRAW,new Uint8Array([0]));i.bindFramebuffer(c),i.setViewport(0,0,1,1),i.useProgram(this._helperProgram),i.bindBuffer(h,Ct.ELEMENT_ARRAY_BUFFER),i.drawElements(ci.POINTS,1,Qe.UNSIGNED_BYTE,0),i.useProgram(e),i.bindVAO(null),i.drawArrays(ci.TRIANGLES,0,258);const d=new Uint8Array(4);return c.readPixels(0,0,1,1,gt.RGBA,Fs.UNSIGNED_BYTE,d),i.setViewport(n,s,o,a),i.bindFramebuffer(r),c.dispose(),h.dispose(),d[0]===255}_prepareProgram(){const i=`#version 300 es
    precision highp float;

    out float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${b.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,r=`#version 300 es
    precision highp float;

    in float triangleId;

    out vec4 fragColor;

    void main(void) {
      fragColor = triangleId == ${b.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(i,r,new Map([]))}_prepareHelperProgram(){const e=ZPe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}},ext=class extends o${constructor(e){super(),this._rctx=e,this._program=Lpe(this._rctx,!1),this._obfuscated=Lpe(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=rt(this._obfuscated)}_test(e){if(ie("force-double-precision-obfuscation"))return!0;if(this._obfuscated==null)return!1;const i=this._runProgram(e),r=this._runProgram(this._obfuscated);return i!==0&&(r===0||i/r>5)}_runProgram(e){const i=this._rctx;i.resetState();const r=new Hi(1);r.wrapMode=Vt.CLAMP_TO_EDGE,r.samplingMode=zt.NEAREST;const n=new jp(i,r),s=Ui.createVertex(i,Ri.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new ad(i,new Map([["position",0]]),{geometry:[new Vo("position",2,Qe.UNSIGNED_SHORT,0,4)]},{geometry:s}),a=Oe(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),l=Oe(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),c=new Float32Array(6);UH(a,c,3);const h=new Float32Array(6);UH(l,h,3),i.useProgram(e),e.setUniform3f("u_highA",c[0],c[2],c[4]),e.setUniform3f("u_lowA",c[1],c[3],c[5]),e.setUniform3f("u_highB",h[0],h[2],h[4]),e.setUniform3f("u_lowB",h[1],h[3],h[5]),i.bindFramebuffer(n),i.setViewport(0,0,1,1),i.bindVAO(o),i.drawArrays(ci.TRIANGLE_STRIP,0,4);const d=new Uint8Array(4);n.readPixels(0,0,1,1,gt.RGBA,Fs.UNSIGNED_BYTE,d),o.dispose(),n.dispose();const f=(a[2]-l[2])/25,m=HQ(d);return Math.abs(f-m)}};function Lpe(t,e){const i=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,r=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `;return t.programCache.acquire(i,r,new Map([["position",0]]))}let txt=class extends o${constructor(e){if(super(),this._rctx=e,!e.gl)return;if(e.type===fi.WEBGL1)return void(this._result=!(!e.capabilities.textureFloat?.textureFloat||!e.capabilities.colorBufferFloat?.textureFloat));if(!(e.capabilities.textureFloat?.textureFloat&&e.capabilities.colorBufferFloat?.textureFloat&&e.capabilities.colorBufferFloat?.floatBlend))return;const i=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}_test(e){const i=this._rctx,r=new Hi(1);r.wrapMode=Vt.CLAMP_TO_EDGE,r.dataType=Fs.FLOAT,r.internalFormat=We.RGBA32F,r.samplingMode=zt.NEAREST;const n=new jp(i,r),s=Ui.createVertex(i,Ri.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new ad(i,new Map([["a_pos",0]]),{geometry:[new Vo("a_pos",2,Qe.UNSIGNED_SHORT,0,4)]},{geometry:s});i.useProgram(e);const a=i.getBoundFramebufferObject(),{x:l,y:c,width:h,height:d}=i.getViewport();i.bindFramebuffer(n),i.setViewport(0,0,1,1),i.bindVAO(o),i.drawArrays(ci.TRIANGLE_STRIP,0,4);const f=Lt({blending:uEe});i.setPipelineState(f),i.drawArrays(ci.TRIANGLE_STRIP,0,4);const m=i.gl.getError();return i.setViewport(l,c,h,d),i.bindFramebuffer(a),o.dispose(),n.dispose(),m!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}},ixt=class extends o${constructor(e){super(),this._rctx=e;const i=`
      precision highp float;
      attribute vec2 a_pos;
      uniform highp sampler2D u_texture;
      varying vec4 v_color;

      float getBit(in float bitset, in int bitIndex) {
        float offset = pow(2.0, float(bitIndex));
        return mod(floor(bitset / offset), 2.0);
      }

      void main() {
        vec4 value = texture2D(u_texture, vec2(0.0));
        float bit = getBit(value.x * 255.0, 1);

        v_color = bit * vec4(1.0);
        gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
      }
      `,r=`
      precision highp float;
      varying vec4 v_color;

      void main() {
        gl_FragColor = v_color;
      }
      `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}_test(e){const i=this._rctx,r=new Hi(1);r.wrapMode=Vt.CLAMP_TO_EDGE,r.samplingMode=zt.NEAREST;const n=new jp(i,r),s=new Uint8Array(4),o=Ui.createVertex(i,Ri.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),a=new ad(i,new Map([["a_position",0]]),{geometry:[new Vo("a_position",2,Qe.SHORT,0,4)]},{geometry:o});i.useProgram(e);const l=new Nt(i,r,new Uint8Array([2,255,0,0]));e.setUniform1i("u_texture",0),i.bindTexture(l,0);const c=i.getBoundFramebufferObject();i.bindFramebuffer(n),i.useProgram(e);const{x:h,y:d,width:f,height:m}=i.getViewport();i.setViewport(0,0,1,1),i.bindVAO(a),i.drawArrays(ci.TRIANGLE_STRIP,0,4),i.setViewport(h,d,f,m),n.readPixels(0,0,1,1,gt.RGBA,Fs.UNSIGNED_BYTE,s),a.dispose(),n.dispose();const y=s[0]!==255||s[1]!==255||s[2]!==255||s[3]!==255;return y&&K.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${s[0]}.${s[1]}.${s[2]}.${s[3]}]`),i.bindFramebuffer(c),y}};new Vo("a_pos",2,Qe.BYTE,0,2);new Vo("a_pos",2,Qe.BYTE,0,4),new Vo("a_tex",2,Qe.BYTE,2,4);const rxt={geometry:[new Vo("a_pos",2,Qe.UNSIGNED_SHORT,0,4)]};let nxt=class extends o${constructor(e){super(),this._rctx=e;const i=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
    precision highp float;

    varying vec2 v_uv;

    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(e){const i=this._rctx;if(!i.gl)return e.dispose(),!0;const r=new Hi(1);r.wrapMode=Vt.CLAMP_TO_EDGE,r.samplingMode=zt.NEAREST;const n=new jp(i,r),s=Ui.createVertex(i,Ri.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new ad(i,new Map([["a_pos",0]]),rxt,{geometry:s}),a=new Hi;a.samplingMode=zt.LINEAR,a.wrapMode=Vt.CLAMP_TO_EDGE;const l=new Nt(i,a,TO);i.useProgram(e),i.bindTexture(l,0),e.setUniform1i("u_texture",0);const c=i.getBoundFramebufferObject(),{x:h,y:d,width:f,height:m}=i.getViewport();i.bindFramebuffer(n),i.setViewport(0,0,1,1),i.setClearColor(0,0,0,0),i.setBlendingEnabled(!1),i.clearSafe(wr.COLOR_BUFFER_BIT),i.bindVAO(o),i.drawArrays(ci.TRIANGLE_STRIP,0,4);const y=new Uint8Array(4);return n.readPixels(0,0,1,1,gt.RGBA,Fs.UNSIGNED_BYTE,y),o.dispose(),n.dispose(),l.dispose(),i.setViewport(h,d,f,m),i.bindFramebuffer(c),y[0]!==255}};const TO=new Image;TO.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",TO.width=5,TO.height=5,TO.decode();let sxt=class{constructor(e){this.rctx=e,this.floatBufferBlend=new txt(e),this.svgPremultipliesAlpha=new nxt(e),this.doublePrecisionRequiresObfuscation=new ext(e),this.ignoresSamplerPrecision=new ixt(e),this.drawArraysRequiresIndicesTypeReset=new Qwt(e)}dispose(){this.ignoresSamplerPrecision.dispose(),this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}};function oxt(t,e){if(e.disjointTimerQuery)return null;if(Wp(t))return{drawBuffers:t.drawBuffers.bind(t),MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS};if(e.drawBuffers)return null;const i=t.getExtension("WEBGL_draw_buffers");return i?{drawBuffers:i.drawBuffersWEBGL.bind(i),MAX_DRAW_BUFFERS:i.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:i.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function axt(t,e){if(e.compressedTextureETC)return null;const i=t.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function lxt(t,e){if(e.compressedTextureS3TC)return null;const i=t.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function cxt(t,e){if(Wp(t))return{MIN:t.MIN,MAX:t.MAX};if(e.blendMinMax)return null;{const i=t.getExtension("EXT_blend_minmax");return i?{MIN:i.MIN_EXT,MAX:i.MAX_EXT}:null}}function uxt(t,e){if(e.textureFilterAnisotropic)return null;const i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}function hxt(t,e){if(Wp(t))return{textureFloat:!0,textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:t.HALF_FLOAT,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F};if(t instanceof WebGLRenderingContext){const i=!e.textureHalfFloat&&t.getExtension("OES_texture_half_float");return{textureFloat:!e.textureFloat&&!!t.getExtension("OES_texture_float"),textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!!i,textureHalfFloatLinear:!e.textureHalfFloatLinear&&!!t.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:i?i.HALF_FLOAT_OES:void 0}}return null}function dxt(t,e){if(Wp(t)){const i=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),r=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),n=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return i||r||n?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!n,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}if(t instanceof WebGLRenderingContext){const i=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float"),r=!e.colorBufferFloat&&t.getExtension("WEBGL_color_buffer_float"),n=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return i||r||n?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!n,RGBA16F:i?i.RGBA16F_EXT:void 0,RGB16F:i?i.RGB16F_EXT:void 0,RGBA32F:r?r.RGBA32F_EXT:void 0}:null}return null}function Dpe(t,e,i,r,n){if(r&&Wp(t))return!0;if(e[i])return!1;for(const s of n)if(t.getExtension(s))return!0;return!1}function pxt(t,e){if(!Wp(t)||e.textureNorm16)return null;const i=t.getExtension("EXT_texture_norm16");return i?{R16:i.R16_EXT,RG16:i.RG16_EXT,RGB16:i.RGB16_EXT,RGBA16:i.RGBA16_EXT,R16_SNORM:i.R16_SNORM_EXT,RG16_SNORM:i.RG16_SNORM_EXT,RGB16_SNORM:i.RGB16_SNORM_EXT,RGBA16_SNORM:i.RGBA16_SNORM_EXT}:null}function fxt(t,e){const i=e.loseContext&&t.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}function mxt(t,e){if(Wp(t))return{createVertexArray:t.createVertexArray.bind(t),deleteVertexArray:t.deleteVertexArray.bind(t),bindVertexArray:t.bindVertexArray.bind(t)};if(e.vao)return null;const i=t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object");return i?{createVertexArray:i.createVertexArrayOES.bind(i),deleteVertexArray:i.deleteVertexArrayOES.bind(i),bindVertexArray:i.bindVertexArrayOES.bind(i)}:null}let gxt=class{constructor(e,i){this._gl=e,this._vertexArrayObject=null,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._textureFloat=null,this._colorBufferFloat=null,this._minMaxBlending=null,this._loseContext=null,this._drawBuffers=null,this._textureNorm16=null,this._depthTexture=null,this._textureFloatLinear=null,this._disabledExtensions=i.disabledExtensions||{},this._debugWebGLExtensions=i.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=oxt(this._gl,this._disabledExtensions)),this._drawBuffers}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=mxt(this._gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=axt(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=lxt(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=uxt(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=bwt(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=hxt(this._gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=dxt(this._gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=cxt(this._gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=Dpe(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get loseContext(){return this._loseContext||(this._loseContext=fxt(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=pxt(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=Dpe(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(e){return this[e]}},yxt=class{constructor(e,i){this.gl=e,this.instanceCounter=new Owt,this.programCache=new Kwt(this),this._state=new xpe,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=Wp(e)?fi.WEBGL2:fi.WEBGL1,this._loadExtensions(),this.configure(i)}get gl2(){return this.type===fi.WEBGL1?null:this.gl}configure(e){this._capabilities=new gxt(this.gl,e),this._parameters=new Rwt(this.gl,this._capabilities,e),Nt.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;const i=this.gl.getParameter(this.gl.VIEWPORT);this._state=new xpe,this._state.viewport={x:i[0],y:i[1],width:i[2],height:i[3]},this._stateTracker=new HYe({setBlending:r=>{if(r){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(r.opRgb,r.opAlpha),this.setBlendFunctionSeparate(r.srcRgb,r.dstRgb,r.srcAlpha,r.dstAlpha);const n=r.color;this.setBlendColor(n.r,n.g,n.b,n.a)}else this.setBlendingEnabled(!1)},setCulling:r=>{r?(this.setFaceCullingEnabled(!0),this.setCullFace(r.face),this.setFrontFace(r.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:r=>{r?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(r.factor,r.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:r=>{r?(this.setDepthTestEnabled(!0),this.setDepthFunction(r.func)):this.setDepthTestEnabled(!1)},setStencilTest:r=>{if(r){this.setStencilTestEnabled(!0);const n=r.function;this.setStencilFunction(n.func,n.ref,n.mask);const s=r.operation;this.setStencilOp(s.fail,s.zFail,s.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:r=>{r?(this.setDepthWriteEnabled(!0),this.setDepthRange(r.zNear,r.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:r=>{r?this.setColorMask(r.r,r.g,r.b,r.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:r=>{r?this.setStencilWriteMask(r.mask):this.setStencilWriteMask(0)},setDrawBuffers:r=>{const{drawBuffers:n}=this._capabilities;if(r)n?.drawBuffers(r.buffers);else{const{drawFramebuffer:s}=this._state;s===null||s.colorAttachments.length===0?n?.drawBuffers([RH.BACK]):n?.drawBuffers([zl.COLOR_ATTACHMENT0])}}}),this.enforceState(),rt(this._driverTest),this._driverTest=new sxt(this)}dispose(){rt(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(Ct.ARRAY_BUFFER),this.unbindBuffer(Ct.ELEMENT_ARRAY_BUFFER),this.type===fi.WEBGL2&&(this.unbindBuffer(Ct.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Ct.PIXEL_PACK_BUFFER),this.unbindBuffer(Ct.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Ct.COPY_READ_BUFFER),this.unbindBuffer(Ct.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,op()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){this._state.program?.stop(),this._state.program=null}externalTextureUnitUpdate(e,i){for(let r=0;r<e.length;++r)this._state.textureUnitMap[e[r]]=null;i>=0&&(this._state.activeTexture=i)}externalVertexArrayObjectUpdate(){const e=this.capabilities.vao;e&&(e.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,i,r,n){e===this._state.blendColor.r&&i===this._state.blendColor.g&&r===this._state.blendColor.b&&n===this._state.blendColor.a||(this.gl.blendColor(e,i,r,n),this._state.blendColor.r=e,this._state.blendColor.g=i,this._state.blendColor.b=r,this._state.blendColor.a=n,this._stateTracker.invalidateBlending())}setBlendFunction(e,i){e===this._state.blendFunction.srcRGB&&i===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,i),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=i,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,i,r,n){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===r&&this._state.blendFunction.dstRGB===i&&this._state.blendFunction.dstAlpha===n||(this.gl.blendFuncSeparate(e,i,r,n),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=n,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,i){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===i||(this.gl.blendEquationSeparate(e,i),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=i,this._stateTracker.invalidateBlending())}setColorMask(e,i,r,n){this._state.colorMask.r===e&&this._state.colorMask.g===i&&this._state.colorMask.b===r&&this._state.colorMask.a===n||(this.gl.colorMask(e,i,r,n),this._state.colorMask.r=e,this._state.colorMask.g=i,this._state.colorMask.b=r,this._state.colorMask.a=n,this._stateTracker.invalidateColorWrite())}setClearColor(e,i,r,n){this._state.clearColor.r===e&&this._state.clearColor.g===i&&this._state.clearColor.b===r&&this._state.clearColor.a===n||(this.gl.clearColor(e,i,r,n),this._state.clearColor.r=e,this._state.clearColor.g=i,this._state.clearColor.b=r,this._state.clearColor.a=n)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,i){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===i||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=i,this.gl.polygonOffset(e,i),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,i,r,n){this._state.scissorRect.x===e&&this._state.scissorRect.y===i&&this._state.scissorRect.width===r&&this._state.scissorRect.height===n||(this.gl.scissor(e,i,r,n),this._state.scissorRect.x=e,this._state.scissorRect.y=i,this._state.scissorRect.width=r,this._state.scissorRect.height=n)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,i){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===i||(this.gl.depthRange(e,i),this._state.depthRange.zNear=e,this._state.depthRange.zFar=i,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,i,r){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===r||(this.gl.stencilFunc(e,i,r),this._state.stencilFunction.face=bp.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,i,r,n){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===i&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===n||(this.gl.stencilFuncSeparate(e,i,r,n),this._state.stencilFunction.face=e,this._state.stencilFunction.func=i,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=n,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,i,r){this._state.stencilOperation.face===bp.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===r||(this.gl.stencilOp(e,i,r),this._state.stencilOperation.face=bp.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,i,r,n){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===i&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===n||(this.gl.stencilOpSeparate(e,i,r,n),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=i,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=n,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,i=!1){const r=this._state.activeTexture;return e>=0&&(i||e!==this._state.activeTexture)&&(this.gl.activeTexture(Mz+e),this._state.activeTexture=e),r}clear(e){e&&this.gl.clear(e)}clearSafe(e,i=255){e&&(e&wr.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),e&wr.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),e&wr.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(i),this.gl.clear(e))}drawArrays(e,i,r){op()&&(this._numOfDrawCalls++,this._numOfTriangles+=Npe(e,r)),this.gl.drawArrays(e,i,r),em(this.gl)}drawArraysInstanced(e,i,r,n){this.gl2?.drawArraysInstanced(e,i,r,n),em(this.gl)}drawElements(e,i,r,n){if(op()&&(this._numOfDrawCalls++,this._numOfTriangles+=Npe(e,i)),this.gl.drawElements(e,i,r,n),op()){const s=JYe(this);if(s){const o=this.getBoundVAO(),a=o?.indexBuffer,l=o?.vertexBuffers,c={indexBuffer:a,vertexBuffers:l},h={mode:e,count:i,type:r,offset:n},d=a?.size??0,f=n+i,m=d<f?`. Buffer is too small. Attempted to draw index ${f} of ${d}`:"";console.error(`drawElements: ${s}${m}`,{args:h,vao:c})}}}logInfo(){op()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){op()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,i,r,n){r=Math.max(Math.round(r),1),n=Math.max(Math.round(n),1);const s=this._state.viewport;s.x===e&&s.y===i&&s.width===r&&s.height===n||(s.x=e,s.y=i,s.width=r,s.height=n,this.gl.viewport(e,i,r,n))}setViewport4fv(e){this.setViewport(e[0],e[1],e[2],e[3])}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){this._state.program!==e&&(this._state.program?.stop(),this._state.program=e,this.gl.useProgram(e?.glName??null))}bindTexture(e,i,r=!1){(i>=this.parameters.maxTextureImageUnits||i<0)&&console.error("Input texture unit is out of range of available units!");const n=this._state.textureUnitMap[i];return e?.glName==null?(n!=null&&(this.setActiveTexture(i,r),this.gl.bindTexture(n.descriptor.target,null)),this._state.textureUnitMap[i]=null,n):r||n!==e?(this.setActiveTexture(i,r),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[i]=e,n):(e.isDirty&&(this.setActiveTexture(i,r),e.applyChanges()),n)}unbindTexture(e){if(e!=null)for(let i=0;i<this.parameters.maxTextureImageUnits;i++)this._state.textureUnitMap[i]===e&&(this.bindTexture(null,i),this._state.textureUnitMap[i]=null)}bindFramebuffer(e,i=!1){if(i||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(this._stateTracker.invalidateDrawBuffers(),e==null)return this.gl.bindFramebuffer(ta.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);e.initializeAndBind(ta.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,i,r=!1){const n=i===ta.READ_FRAMEBUFFER,s=n?this._state.readFramebuffer:this._state.drawFramebuffer;(r||s!==e)&&(e==null?this.gl.bindFramebuffer(i,null):e.initializeAndBind(i),n?this._state.readFramebuffer=e??null:this._state.drawFramebuffer=e??null)}blitFramebuffer(e,i,r=0,n=0,s=e.width,o=e.height,a=0,l=0,c=i.width,h=i.height,d=wr.COLOR_BUFFER_BIT,f=zt.NEAREST){this.bindFramebufferSeparate(e,ta.READ_FRAMEBUFFER),this.bindFramebufferSeparate(i,ta.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(r,n,s,o,a,l,c,h,d,f)}bindBuffer(e,i){if(e)switch(i??(i=e.bufferType),i){case Ct.ARRAY_BUFFER:this._state.vertexBuffer=hc(this.gl,e,i,this._state.vertexBuffer);break;case Ct.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=hc(this.gl,e,i,this._state.indexBuffer);break;case Ct.UNIFORM_BUFFER:this._state.uniformBuffer=hc(this.gl,e,i,this._state.uniformBuffer);break;case Ct.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=hc(this.gl,e,i,this._state.pixelPackBuffer);break;case Ct.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=hc(this.gl,e,i,this._state.pixelUnpackBuffer);break;case Ct.COPY_READ_BUFFER:this._state.copyReadBuffer=hc(this.gl,e,i,this._state.copyReadBuffer);break;case Ct.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=hc(this.gl,e,i,this._state.copyWriteBuffer)}}bindRenderbuffer(e){const i=this.gl;e||(i.bindRenderbuffer(i.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(i.bindRenderbuffer(i.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,i){if(i>=this.parameters.maxUniformBufferBindings||i<0)return console.error("Uniform buffer binding point is out of range!"),null;const r=this._state.uniformBufferBindingPoints;let n=r[i];return n==null&&(n={buffer:null,offset:0,size:0},r[i]=n),n}bindBufferBase(e,i,r){const n=this._getBufferBinding(e,i);n!=null&&(n.buffer===r&&n.offset===0&&n.size===0||(this.gl.bindBufferBase(e,i,r?r.glName:null),n.buffer=r,n.offset=0,n.size=0))}bindBufferRange(e,i,r,n,s){const o=this._getBufferBinding(e,i);if(o!=null&&!(o.buffer===r&&o.offset===n&&o.size===s)){if(n%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(e,i,r.glName,n,s),o.buffer=r,o.offset=n,o.size=s}}bindUBO(e,i,r,n){i!=null?(op()&&(n??i.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),i.initialize(),r!==void 0&&n!==void 0?this.bindBufferRange(Ct.UNIFORM_BUFFER,e,i.buffer,r,n):this.bindBufferBase(Ct.UNIFORM_BUFFER,e,i.buffer)):this.bindBufferBase(Ct.UNIFORM_BUFFER,e,null)}unbindUBO(e){for(let i=0,r=this._state.uniformBufferBindingPoints.length;i<r;i++){const n=this._state.uniformBufferBindingPoints[i];n!=null&&n.buffer===e.buffer&&this.bindBufferBase(Ct.UNIFORM_BUFFER,i,null)}}unbindBuffer(e){switch(e){case Ct.ARRAY_BUFFER:this._state.vertexBuffer=hc(this.gl,null,e,this._state.vertexBuffer);break;case Ct.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=hc(this.gl,null,e,this._state.indexBuffer);break;case Ct.UNIFORM_BUFFER:this._state.uniformBuffer=hc(this.gl,null,e,this._state.uniformBuffer);break;case Ct.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=hc(this.gl,null,e,this._state.pixelPackBuffer);break;case Ct.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=hc(this.gl,null,e,this._state.pixelUnpackBuffer);break;case Ct.COPY_READ_BUFFER:this._state.copyReadBuffer=hc(this.gl,null,e,this._state.copyReadBuffer);break;case Ct.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=hc(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){e!=null?this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e):this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null)}async clientWaitAsync(e=10){const i=this.gl,r=i.fenceSync(PH.SYNC_GPU_COMMANDS_COMPLETE,0);if(!r)throw new Error("Client wait failed, could not create sync object");let n;this.instanceCounter.increment(Yn.Sync,r),i.flush();do await XR(e),n=i.clientWaitSync(r,0,0);while(n===vF.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(Yn.Sync,r),i.deleteSync(r),n===vF.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=ta.FRAMEBUFFER){return e===ta.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(Ct.ARRAY_BUFFER),this.unbindBuffer(Ct.ELEMENT_ARRAY_BUFFER),this.type===fi.WEBGL2&&(this.unbindBuffer(Ct.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Ct.PIXEL_PACK_BUFFER),this.unbindBuffer(Ct.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Ct.COPY_READ_BUFFER),this.unbindBuffer(Ct.COPY_WRITE_BUFFER));for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(Te.ONE,Te.ZERO),this.setBlendEquation(Pm.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(bp.BACK),this.setFrontFace(eC.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(Bi.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(Bi.ALWAYS,0,0),this.setStencilOp(tn.KEEP,tn.KEEP,tn.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){const e=this.capabilities.vao;e&&e.bindVertexArray(null);const{gl:i,gl2:r}=this;for(let s=0;s<this.parameters.maxVertexAttributes;s++)i.disableVertexAttribArray(s);if(this._state.vertexBuffer?i.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):i.bindBuffer(Ct.ARRAY_BUFFER,null),this._state.indexBuffer?i.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):i.bindBuffer(Ct.ELEMENT_ARRAY_BUFFER,null),r!=null){this._state.uniformBuffer?r.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):r.bindBuffer(Ct.UNIFORM_BUFFER,null);for(let s=0;s<this._parameters.maxUniformBufferBindings;s++){const o=this._state.uniformBufferBindingPoints[s];if(o!=null){const{buffer:a,offset:l,size:c}=o;a!==null?l===0&&c===0?r.bindBufferBase(Ct.UNIFORM_BUFFER,s,a.glName):r.bindBufferRange(Ct.UNIFORM_BUFFER,s,a.glName,l,c):r.bindBufferBase(Ct.UNIFORM_BUFFER,s,null)}}this._state.pixelPackBuffer?r.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):r.bindBuffer(Ct.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?r.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):r.bindBuffer(Ct.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?r.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):r.bindBuffer(Ct.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?r.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):r.bindBuffer(Ct.COPY_WRITE_BUFFER,null),r.bindFramebuffer(ta.READ_FRAMEBUFFER,null),r.readBuffer(r.BACK),this._state.readFramebuffer&&(r.bindFramebuffer(ta.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),r.readBuffer(zl.COLOR_ATTACHMENT0)),r.bindFramebuffer(ta.DRAW_FRAMEBUFFER,this._state.drawFramebuffer?.glName??null)}else this._state.readFramebuffer=this._state.drawFramebuffer,i.bindFramebuffer(ta.FRAMEBUFFER,this._state.drawFramebuffer?.glName??null);if(e&&this._state.vertexArrayObject){const s=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(s)}i.useProgram(this._state.program?.glName??null),i.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),i.bindRenderbuffer(i.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?i.enable(this.gl.BLEND):i.disable(this.gl.BLEND),i.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),i.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),i.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),i.clearDepth(this._state.clearDepth),i.clearStencil(this._state.clearStencil),i.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),i.cullFace(this._state.cullFace),i.depthFunc(this._state.depthFunction),i.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),i.depthMask(this._state.depthWrite),i.frontFace(this._state.frontFace),i.lineWidth(1),this._state.faceCulling===!0?i.enable(i.CULL_FACE):i.disable(i.CULL_FACE),i.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?i.enable(i.POLYGON_OFFSET_FILL):i.disable(i.POLYGON_OFFSET_FILL),i.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?i.enable(i.SCISSOR_TEST):i.disable(i.SCISSOR_TEST),i.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),i.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST),i.stencilMask(this._state.stencilWriteMask);for(let s=0;s<this.parameters.maxTextureImageUnits;s++){i.activeTexture(Mz+s),i.bindTexture(bn.TEXTURE_2D,null),i.bindTexture(bn.TEXTURE_CUBE_MAP,null),this.type===fi.WEBGL2&&(i.bindTexture(bn.TEXTURE_3D,null),i.bindTexture(bn.TEXTURE_2D_ARRAY,null));const o=this._state.textureUnitMap[s];o!=null&&i.bindTexture(o.descriptor.target,o.glName)}i.activeTexture(Mz+this._state.activeTexture);const n=this._state.viewport;i.viewport(n.x,n.y,n.width,n.height),this.resetInfo()}_loadExtensions(){this.type===fi.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}};function hc(t,e,i,r){return e?r!==e&&t.bindBuffer(i,e.glName):t.bindBuffer(i,null),e}function Npe(t,e){switch(t){case ci.POINTS:return 2*e;case ci.TRIANGLES:return e/3;case ci.TRIANGLE_STRIP:case ci.TRIANGLE_FAN:return e-2;default:return 0}}let _xt=class extends yxt{constructor(e,i,r){super(e,i),this.gl=e,this.newCache=r,this._appleAmdDriverHelper=null,this._refCount=1,this.screen=new Ewt(this)}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}dispose(){super.dispose(),this._appleAmdDriverHelper?.dispose(),this.screen.destroy()}bindTechnique(e,i,r,n){return this.useProgram(e.program),this.setPipelineState(e.getPipeline(!!n)),e.program.bindPass(i,r),e.program}runAppleAmdDriverHelper(){this.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper??(this._appleAmdDriverHelper=new ZPe(this)),this._appleAmdDriverHelper.run())}get test(){return{cachedWebGLObjects:this.programCache.test.cachedWebGLProgramObjects+this.screen.test.cachedWebGLObjects+(this._appleAmdDriverHelper?.test.cachedWebGLObjects??0)}}};function Fpe(t){return!!t.frameUpdate}let s2=class extends we{constructor(e,i,r){super({}),this._stage=e,this._techniqueRepository=i,this._rctx=r,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new Sn,this._frameTask=e.view.resourceController.scheduler.registerTask(pt.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(wn.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return this._textureTechnique==null&&(this._textureTechnique=this._techniqueRepository.acquire(eee,new tee)),this._textureTechnique}acquire(e){const i=this._textures.get(e);return i?(i.ref(),i.loadingPromise??i):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(i=>{const r=i.texture.frameUpdate(i.previousToken);r>=0&&r!==i.previousToken&&(i.previousToken=r,e=!0)}),e&&this.events.emit("changed",Ln.BACKGROUND)}_createNewRef(e){const i=this._stage.getObject(e);if(i==null)return tt(i!==void 0),null;const r=i.events.on("unloaded",()=>{r.remove(),this._onTextureUnloaded(e)}),n=new vxt(e,()=>{this._frameTask.schedule(()=>{n.isUnreferenced&&i.unload()})});return this._textures.set(e,n),n.ref(),i.glTexture?(this._updateGLTexture(n,i.glTexture),Fpe(i)&&this._frameUpdates.set(e,{texture:i,previousToken:-1}),n):(this._loadingCount++,n.loadingPromise=this._stage.schedule(()=>{const s=i.load(this._rctx),o=l=>(this._loadingCount--,n.loadingPromise=null,this._updateGLTexture(n,l),Fpe(i)&&this._frameUpdates.set(e,{texture:i,previousToken:-1}),n),a=l=>(this._loadingCount--,n.loadingPromise=null,Tn(l)||K.getLogger(this).error(l),null);return Zc(s)?s.then(o,a):o(s)}),n.loadingPromise)}_updateGLTexture(e,i){e.glTexture=i,this.events.emit("changed",Ln.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};u([p()],s2.prototype,"_loadingCount",void 0),u([p()],s2.prototype,"_frameTask",void 0),u([p()],s2.prototype,"updating",null),s2=u([M("esri.views.3d.webgl-engine.lib.TextureRepository")],s2);let vxt=class{constructor(e,i){this.id=e,this._release=i,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(K.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}};function bxt(t,e){return new mAe(i=>Dat(i,t),i=>i,e)}let SO=class extends we{constructor(){super(...arguments),this._passParameters=new wxt,this._resourcesTask=null}get passParameters(){return this._passParameters}destroy(){this._resourcesTask=Gc(this._resourcesTask),this._passParameters.waveNormal=rt(this._passParameters.waveNormal),this._passParameters.wavePerturbation=rt(this._passParameters.wavePerturbation)}get updating(){return!!this._resourcesTask&&!this._resourcesTask.finished}ensureResources(e){return this._resourcesTask||(this._resourcesTask=Xv(async i=>{await Promise.allSettled([this._loadImageResource(e,ur("esri/images/materials/water/normals.jpg"),r=>this._passParameters.waveNormal=r,i),this._loadImageResource(e,ur("esri/images/materials/water/perturbation.jpg"),r=>this._passParameters.wavePerturbation=r,i)])})),this._resourcesTask.finished?Lv.LOADED:Lv.LOADING}async _loadImageResource(e,i,r,n){try{const s=await Iy(i,{signal:n});Tt(n);const o=new Hi(s.width,s.height);o.pixelFormat=gt.RGB,o.samplingMode=zt.LINEAR_MIPMAP_LINEAR,o.hasMipmap=!0,o.maxAnisotropy=8,r(new Nt(e,o,s))}catch(s){K.getLogger(this).error("Failed to load water material normal texture.",s)}}};u([p()],SO.prototype,"_resourcesTask",void 0),u([p({type:Boolean,readOnly:!0})],SO.prototype,"updating",null),SO=u([M("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],SO);let wxt=class extends or{};const kpe=2048,xxt=1.5,Txt=8;function Sxt(t,e){const{format:i,quality:r,rotation:n,disableDecorations:s}=t||{},o=ete(t,e.padding),a=Mxt(t,{width:e.width-o.left-o.right,height:e.height-o.top-o.bottom}),{width:l,height:c}=Pxt(t,a),h=Lxt(i),d=Uxt[h];return{format:h,quality:_e(r??d,0,100),area:a,width:l,height:c,rotation:n,disableDecorations:!!s,ignoreBackground:!!t?.ignoreBackground,ignorePadding:!!t?.ignorePadding}}function Ext(t,e){const i=Sxt(t,e),r=i.area,n=i.width/r.width,s=ete(i,e.padding),o=s.left+s.right,a=s.top+s.bottom,l=e.width-o,c=e.height-a,h=Math.floor(l*n+o),d=Math.floor(c*n+a),f=t?.layers??[],m=i.ignoreBackground,y=i.ignorePadding;return{framebufferWidth:h,framebufferHeight:d,region:{x:Math.floor(r.x*n)+s.left,y:Math.floor(r.y*n)+s.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:n,layers:f,disableDecorations:i.disableDecorations,ignoreBackground:m,ignorePadding:y,objectAndLayerIdColor:!1}}function mV(t,e,i){const{ctx:r,canvas:n}=tMe(t,i),s=r.getImageData(0,0,t.width,t.height),o=Axt(n,e);return iMe(n),{dataUrl:o,data:s}}function gV(t,e){const{ctx:i,canvas:r}=tMe(t,e),n=i.getImageData(0,0,t.width,t.height);return iMe(r),n}function tMe(t,e){const i=Cxt();e.premultipliedAlpha&&Nxt(t),i.width=t.width,i.height=t.height;const r=i.getContext("2d",{willReadFrequently:!0});return r.putImageData(t,0,0),e.flipY&&Dxt(r),{ctx:r,canvas:i}}function iMe(t){t.width=0,t.height=0}function Cxt(){return yV==null&&(yV=document.createElement("canvas")),yV}let yV=null;function Axt(t,e){const i=Fxt[e.format],r=e.quality/100;return t.toDataURL(i,r)}function Oxt(t,e,i,r=0,n=0,s=t.width-r,o=t.height-n,a=!1){const{data:l}=t,{width:c,height:h,data:d}=e,f=s/c,m=o/h,y=Math.ceil(f/2),_=Math.ceil(m/2),v=t.width;for(let w=0;w<h;w++)for(let x=0;x<c;x++){const T=4*(x+(a?h-w-1:w)*c);let S=0,C=0,A=0,R=0,D=0,N=0;const k=(w+.5)*m;for(let B=Math.floor(w*m);B<(w+1)*m;B++){const L=Math.abs(k-(B+.5))/_,z=(x+.5)*f,j=L*L;for(let H=Math.floor(x*f);H<(x+1)*f;H++){const X=Math.abs(z-(H+.5))/y,P=Math.sqrt(j+X*X);if(P>=1)continue;let I=2*P*P*P-3*P*P+1;const V=4*(r+H+(n+B)*v);N+=I*l[V+3],C+=I,!i&&l[V+3]<255&&(I=I*l[V+3]/255),A+=I*l[V],R+=I*l[V+1],D+=I*l[V+2],S+=I}}d[T]=A/S,d[T+1]=R/S,d[T+2]=D/S,d[T+3]=N/C}return e}function Rxt(t,e,i){if(!e)return t;const{framebufferWidth:r,framebufferHeight:n,pixelRatio:s,region:o}=t,a=ete(t,i),l=a.left+a.right,c=a.top+a.bottom,h=r-l,d=n-c,f=Math.min(Txt,Math.min((kpe-l)/h,(kpe-c)/d));return f<xxt?t:{...t,framebufferWidth:Math.round(h*f)+l,framebufferHeight:Math.round(d*f)+c,pixelRatio:s*f,resample:{region:{x:Math.round((o.x-a.left)*f)+a.left,y:Math.round((o.y-a.top)*f)+a.top,width:Math.round(o.width*f),height:Math.round(o.height*f)},width:r,height:n}}}function Pxt(t,e){if(!t)return e;const i=t.width,r=t.height;if(i!=null&&r!=null)return{width:Math.floor(i),height:Math.floor(r)};if(i==null&&r==null)return e;const n=e.width/e.height;return r==null?{width:Math.floor(i),height:Math.floor(i/n)}:{width:Math.floor(r*n),height:Math.floor(r)}}function Mxt(t,e){const i={x:0,y:0,width:e.width,height:e.height};if(t?.area){t.area.x!=null&&(i.x=Math.floor(t.area.x)),t.area.y!=null&&(i.y=Math.floor(t.area.y));const r=t.area.width!=null?Math.floor(t.area.width):null,n=t.area.height!=null?Math.floor(t.area.height):null;if(i.width=e.width-i.x,i.height=e.height-i.y,r!=null&&n!=null)i.width=Math.min(i.width,r),i.height=Math.min(i.height,n);else if(r==null&&n!=null){const s=Math.min(i.width,r);i.height=s/i.width*i.height,i.width=s}else if(r!=null&&n==null){const s=Math.min(i.height,n);i.width=s/i.height*i.width,i.height=s}}return $xt(Ixt(i,t),e)}function $xt(t,e){const i=Math.floor(Math.max(t.x,0)),r=Math.floor(Math.max(t.y,0)),n={x:i,y:r,width:Math.floor(Math.min(t.width,e.width-i)),height:Math.floor(Math.min(t.height,e.height-r))},s=n.width/n.height,o=t.width/t.height;if(o===s)return n;if(o>s){const c=Math.floor(n.width/o),h=n.height-c;return{x:n.x,y:Math.floor(n.y+h/2),width:n.width,height:c}}const a=Math.floor(n.height*o),l=n.width-a;return{x:Math.floor(n.x+l/2),y:n.y,width:a,height:n.height}}function Ixt(t,e){if(e?.width==null||e.height==null)return t;const i=e.width/e.height,r=t.width/t.height;if(r===i)return t;if(r<i){const s=Math.floor(t.height*i);return t.x-=(s-t.width)/2,t.width=s,t}const n=Math.floor(t.width/i);return t.y-=(n-t.height)/2,t.height=n,t}function ete(t,e){return!e||t&&t.ignorePadding?zxt:e}function Lxt(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return kxt}}function Dxt(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function Nxt(t){const e=t.data,i=e.length;for(let r=0;r<i;r+=4){const n=e[r+3];if(n!==255&&n>0){const s=255/n;e[r]=e[r]*s,e[r+1]=e[r+1]*s,e[r+2]=e[r+2]*s}}}const Fxt={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},Upe=98,kxt="png",Uxt={png:100,jpg:Upe,jpeg:Upe},zxt={top:0,right:0,bottom:0,left:0};let Bxt=class{constructor(e,i,r){this.parameters=e,this.frameHasDecorations=i,this.fbos=r}},Vxt=class{constructor(e,i,r){this._rctx=e,this._renderFunctions=i,this._forceCameraHook=r,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(Ln.BACKGROUND);const i=Hs();return this._screenshotQueue.push({settings:e,resolver:i}),i.promise}update(e,i){for(const r of this._screenshotQueue){if(this._rctx==null){r.resolver.reject();continue}const n={...r.settings,pixelRatio:r.settings.pixelRatio*e.parameters.camera.pixelRatio},s=this._renderScreenshot(e,n,i);r.resolver(s)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,i,r){e.width=i.width,e.height=i.height;const n=e.getContext("2d"),s=r.pixelRatio;return n.save(),n.translate(0,i.height),n.scale(1,-1),r.region&&n.translate(-r.region.x,-r.region.y),n.scale(s,s),i=this._renderFunctions.renderOverlay(e,r.disableDecorations?Uc.OFF:Uc.ON,i),n.restore(),i}_readbackScreenshot(e,i){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},i):this._readbackScreenshotImmediate(e,i)}_readbackScreenshotResampled(e,i){const{framebufferWidth:r,framebufferHeight:n,region:s,resample:o}=e,a=this._ensureScreenshotEncodeCanvas();let l=lB(r,n,a);this._rctx.gl.readPixels(0,0,r,n,gt.RGBA,Qe.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),i(),l=this._renderScreenshotOverlay(a,l,{...e,region:void 0});const c=lB(s.width,s.height,a);return Oxt(l,c,!0,o.region.x,n-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(e,i){const{framebufferHeight:r,region:n}=e,s=this._ensureScreenshotEncodeCanvas(),o=lB(n.width,n.height,s);return this._rctx.gl.readPixels(n.x,r-(n.y+n.height),n.width,n.height,gt.RGBA,Qe.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),i(),this._renderScreenshotOverlay(s,o,e)}_renderScreenshot(e,i,r){const n=e.parameters.camera,s={width:i.framebufferWidth,height:i.framebufferHeight};Pw(s,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));let o=!1;const a=i.disableDecorations&&e.frameHasDecorations,l=s.width!==n.fullWidth||s.height!==n.fullHeight,c=i.ignorePadding&&n.pixelRatio!==i.pixelRatio,h=l||a||c||i.objectAndLayerIdColor;let d=null;i.objectAndLayerIdColor&&(d=e.fbos.acquire(xi.RGBA,s.width,s.height),d.acquireDepth(As.DEPTH_STENCIL_BUFFER));let f=null;if(h){const v=n.clone();if(i.ignorePadding){const C=$M(v.padding);for(let A=0;A<4;A++)C[A]=Math.round(C[A]/v.pixelRatio*i.pixelRatio);v.padding=C}v.fullWidth=s.width,v.fullHeight=s.height,v.pixelRatio=i.pixelRatio;const w=n.fovX-v.fovX,x=n.fovY-v.fovY;w<0&&w<x?v.fovX=n.fovX:x<0&&x<w&&(v.fovY=n.fovY);const T={camera:v,contentCamera:v,mode:Li.IDLE,alignPixelEnabled:!0,contentPixelRatio:v.pixelRatio};this._forceCameraHook(T),o=!0,f=e.fbos.acquire(xi.RGBA,s.width,s.height);const S=i.disableDecorations?Uc.OFF:Uc.ON;this._renderFunctions.renderScene(f,d,T,S,r)}const m=()=>{this._rctx.bindFramebuffer(null),f?.release()};this._rctx.bindFramebuffer(f?.fbo);const y=this._readbackScreenshot(i,m);let _=null;if(i.objectAndLayerIdColor){const v=()=>{this._rctx.bindFramebuffer(null),d?.release()};this._rctx.bindFramebuffer(d?.fbo),_=this._readbackScreenshot(i,v),this._rctx.bindFramebuffer(null)}if(h&&!this._rctx.contextAttributes.alpha)for(let v=3;v<y.data.length;v+=4)y.data[v]=255;if(_&&!this._rctx.contextAttributes.alpha)for(let v=3;v<_.data.length;v+=4)_.data[v]=255;return o&&this._forceCameraHook(e.parameters),[y,_]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}},$o=class extends we{constructor(e){super({}),this.events=new Sn,this.waterTextureRepository=new SO,this._magnifierHelper=new i2,this.objectAndLayerIdRenderHelper=ie("enable-feature:objectAndLayerId-rendering")?new ebt:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode,this._initializeContext(e),this.addHandles([ne(()=>this.waterTextureRepository?.updating,()=>this.requestRender(),Xt),ne(()=>e.view.qualityProfile,n=>this.renderer?.updateRenderFeatures(n),Ji),this._magnifierHelper.events.on("request-render",()=>this.requestRender())]);const{memoryController:i}=e.view.resourceController;this.stippleTextureRepository=jot(this._rctx,i),this.markerTextureRepository=bxt(this._rctx,i),this._shaderTechniqueRepository=new cAe({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this.stippleTextureRepository,waterTextureRepository:this.waterTextureRepository,markerTextureRepository:this.markerTextureRepository}),this._textureRepository=new s2(e,this._shaderTechniqueRepository,this._rctx),this.addHandles(this._textureRepository.events.on("changed",n=>this.requestRender(n))),this._materialRepository=new uAe(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new $1t(this._rctx,this._shaderTechniqueRepository),this.renderer=new pu(e,this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,n=>this.requestRender(n));const r={renderScene:(n,s,o,a,l)=>this.renderer.render(n,s,o,a,l),requestRenderScene:n=>this.requestRender(n),prepareOverlay:()=>e.options.screenshot.prepareOverlay(),renderOverlay:(n,s,o)=>e.options.screenshot.renderOverlay(n,s,o)};this._screenshotManager=new Vxt(this._rctx,r,n=>this.events.emit("force-camera-for-screenshot",n)),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=Tr(this._frameTask),this._shaderTechniqueRepository=$e(this._shaderTechniqueRepository)}requestRender(e=Ln.UPDATE){this._needsRender=!0,e===Ln.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(i=>i[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,i,r,n,s,o=s){const a=n.constrainWindowSize(i,r,s*n.pixelRatio,o*n.pixelRatio),l=this._ensureDepthBuffer(a);this.renderer.readDepthPixels(n,a,l);let c=Number.MAX_VALUE;for(let h=0;h<a[2]*a[3];h++){const d=F1t(4*h,l,n.nearFar);c>d&&d!==n.nearFar[0]&&d!==n.nearFar[1]&&(c=d)}if(e){const h=e.pickDepth(i*n.pixelRatio,r*n.pixelRatio,n);h!=null&&c>h&&h!==n.nearFar[0]&&h!==n.nearFar[1]&&(c=h)}return c===Number.MAX_VALUE?void 0:c}_ensureDepthBuffer(e){const i=4*e[2]*e[3];return(this._tmpDepthBuffer==null||this._tmpDepthBuffer.byteLength<i)&&(this._tmpDepthBuffer=new Uint8Array(i)),this._tmpDepthBuffer}async reloadShaders(){aRe(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}_registerFrameTask(e){const i=e.view.state;let r=!1,n=Ln.BACKGROUND,s=!1;const o={preRender:({time:a})=>{r=this.updating,n=this._needsUpdate?Ln.UPDATE:Ln.BACKGROUND,e.commitSyncLayers();const l=a-this._lastAnimationUpdate;if(l>this.renderer.animationTimestep||i.forcedAnimationTime!=null||r||this._needsRender){const c=l/this.renderer.animationTimeDilation,h=new X2e(i.camera,c,i.forcedAnimationTime);this.renderer.updateAnimation(h)&&this.requestRender(Ln.BACKGROUND),this._lastAnimationUpdate=a}},render:({time:a})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&i.camera.fullWidth>0&&i.camera.fullHeight>0){const l=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(null,null,i,Uc.ON,a),s=!0,l&&this.renderer.hasReflections&&(this.requestRender(Ln.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:a})=>{const l=this.renderer.hasSlicePlane||this._magnifierHelper.enabled||this.renderer.hasDecorations||this.renderer.hasHighlights,c=new Bxt(i,l,this.renderer.fboCache);this._textureRepository.update(),this._screenshotManager.update(c,a)},finish:()=>{s&&(this.renderer.finish(i.mode===Li.IDLE?n:Ln.UPDATE),s=!1)}};this._frameTask=rx(o)}_initializeContext(e){const i=e.options;this._canvas=i.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const r={alpha:i.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:i.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:i.preserveDrawingBuffer??!1},n=XYe("3d",this._canvas,r);n!=null&&Wp(n)?(this._rctx=this._newRenderingContext(n,e),this._loadShaderOnlyExtensions(),!i.alpha&&this._rctx.contextAttributes.alpha&&K.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&ie("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)):K.getLogger(this).error("A WebGL2 context could not be created.")}_newRenderingContext(e,i){const r={disabledExtensions:i.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:i.options.debugWebGLExtensions||{},maxAnisotropy:8},n=(s,o)=>i.view.resourceController.memoryController.newCache(s,o);return new _xt(e,r,n)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloat")}getObjectAndLayerIdColor(e){return this.objectAndLayerIdRenderHelper!=null?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(e):null}get componentObjectCollection(){return this._componentObjectCollection==null&&(this._componentObjectCollection=new S1t(this.renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};u([p({type:Boolean,readOnly:!0})],$o.prototype,"updating",null),u([p({autoDestroy:!0})],$o.prototype,"_rctx",void 0),u([p({autoDestroy:!0})],$o.prototype,"_container",void 0),u([p({autoDestroy:!0})],$o.prototype,"_canvas",void 0),u([p({autoDestroy:!0})],$o.prototype,"stippleTextureRepository",void 0),u([p({autoDestroy:!0})],$o.prototype,"markerTextureRepository",void 0),u([p({autoDestroy:!0})],$o.prototype,"waterTextureRepository",void 0),u([p({autoDestroy:!0})],$o.prototype,"_magnifierHelper",void 0),u([p({readOnly:!0})],$o.prototype,"objectAndLayerIdRenderHelper",void 0),u([p({autoDestroy:!0})],$o.prototype,"_textureRepository",void 0),u([p({autoDestroy:!0,readOnly:!0})],$o.prototype,"renderer",void 0),u([p({autoDestroy:!0})],$o.prototype,"_screenshotManager",void 0),u([p()],$o.prototype,"componentObjectCollection",null),u([p({autoDestroy:!0})],$o.prototype,"_componentObjectCollection",void 0),u([p()],$o.prototype,"_needsUpdate",void 0),u([p()],$o.prototype,"_needsWaterReflectionUpdate",void 0),$o=u([M("esri.views.3d.webgl-engine.parts.RenderView")],$o);let fu=class extends we{constructor(e){super(e),this._model=new P4,this._layers=new Ut,this._asyncChangeSet=new pW,this._syncChangeSet=new pW,this._layerSyncSet=new Set}initialize(){this._set("renderView",new $o(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(pt.STAGE,this),this.addHandles(this._frameTask)}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){return this.renderView?.renderer}add(e){this._model.add(e),JF(e)&&this._addLayer(e),this.renderView.requestRender()}remove(e){e!=null&&!this.destroyed&&this._model.remove(e)&&(JF(e)&&this._removeLayer(e),this.renderView.requestRender())}addMany(e){e!=null&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){e!=null&&(this._model?.removeMany(e),this.renderView?.requestRender())}forEachOfType(e,i){this._model.forEachOfType(e,i)}handleEvent(e,i){this.destroyed||(this._model.dirtySet[e](i),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){this._frameTask.processQueue(e),this._commit(e)}_commit(e){const i=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{if(e.done)return;const n=this._layerSyncSet.has(r.id)||r.updatePolicy===dv.SYNC,s=n?this._syncChangeSet:this._asyncChangeSet;i.commitLayer(r.id,s),this._layerSyncSet.delete(r.id),s.empty||(this.renderer.modify(s,n?hl:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,hl),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{e.done||this._layerSyncSet.has(r.id)||r.updatePolicy!==dv.ASYNC||(i.commitLayer(r.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(i=>{this._layerSyncSet.has(i.id)||i.updatePolicy===dv.SYNC?(e.commitLayer(i.id,this._syncChangeSet),this._layerSyncSet.delete(i.id)):e.commitSyncUpdates(i.id,this._syncChangeSet)});for(const i of this._layerSyncSet)e.commitLayer(i,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,hl),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,hl),this.renderView.requestRender())}schedule(e,i){return this._frameTask.schedule(e,i)}reschedule(e,i){return this._frameTask.reschedule(e,i)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,hl))}addRenderPlugin(e,i){const r=this.renderer.renderPlugins.add(e,i),n=()=>{Pue(e)&&this.view.sceneIntersectionHelper.addIntersectionHandler(e)};if(Zc(r))return r.then(n);n()}removeRenderPlugin(e){this.destroyed||(Pue(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.renderPlugins.remove(e))}get performanceInfo(){return this._model.getStats()}get test(){const e=this;return{getCount:i=>e._model.test.content.filter(r=>r.type===i).length,model:e._model}}};fu.DebugSettings={endFrameContentValidation:!1},u([p({constructOnly:!0})],fu.prototype,"view",void 0),u([p({constructOnly:!0})],fu.prototype,"options",void 0),u([p({readOnly:!0})],fu.prototype,"viewingMode",null),u([p({constructOnly:!0})],fu.prototype,"container",void 0),u([p({readOnly:!0})],fu.prototype,"updating",null),u([p({constructOnly:!0})],fu.prototype,"_model",void 0),u([p({autoDestroy:!0})],fu.prototype,"renderView",void 0),u([p({readOnly:!0})],fu.prototype,"renderer",null),u([p({readOnly:!0})],fu.prototype,"running",null),fu=u([M("esri.views.3d.webgl-engine.Stage")],fu);let X7t=class extends cU{constructor(e,i,r,n){super(i,r),this.point=e,this.createGraphic=n}};function rMe(t){return Gp(t)&&t.intersector===Jr.PCL&&!!t.target}let J7t=class extends ywe{constructor(e,i,r,n,s){super(e),this.layerUid=e,this.sublayerUid=i,this.nodeIndex=r,this.componentIndex=n,this.triangleNr=s}},Q7t=class extends cU{constructor(e,i,r){super(i,null),this.point=e,this.createVoxelGraphic=r}};function v8(t){return Gp(t)&&t.intersector===Jr.I3S&&!!t.target}function nMe(t){return Gp(t)&&t.intersector===Jr.VOXEL&&!!t.target}function zpe(t,e){return uU(t)||hU(t)?WP(t.target?.object,e):elt(t)?e.map?.ground:rMe(t)||v8(t)||FAe(t)||nMe(t)?WP(t.target,e):null}function tGt(t,e){const i=aY(t,e);return i!=null&&i.type==="graphic"?i.graphic:null}function aY(t,e){if(t==null)return null;if(uU(t)||hU(t))return Bpe(t.target?.object,e);if(rMe(t)){const i=t.target.createGraphic();return{type:"graphic",graphic:i,layer:i.layer}}if(nMe(t)){const i=t.target.createVoxelGraphic();return{type:"graphic",graphic:i,layer:i.layer}}return FAe(t)||bee(t)?Bpe(t.target,e):v8(t)?Gxt(t.target,e):null}function Bpe(t,e){if(t?.graphicUid==null)return null;const i=WP(t,e);if(i==null)return null;if(i===e.graphics)return e.graphicsView==null||typeof t.graphicUid!="number"?null:e.graphicsView.getHit(t.graphicUid);const r=e.allLayerViews.find(n=>n.layer===i);return!r||r.suspended||t.graphicUid==null?null:"getHit"in r?r.getHit(t.graphicUid):null}function Gxt(t,e){const i=WP(t,e);if(i==null)return null;const r=e.allLayerViews.find(n=>n.layer===i);return r&&!r.suspended&&"getGraphicFromIntersectorTarget"in r?Hxt(r.getGraphicFromIntersectorTarget(t)):null}function jxt(t,e){const i=WP(t,e);if(i==null)return null;const r=e.allLayerViews.find(n=>n.layer===i);return r&&!r.suspended&&"getAABBFromIntersectorTarget"in r?r.getAABBFromIntersectorTarget(t):null}function Hxt(t){return t!=null?{type:"graphic",graphic:t,layer:t.layer}:null}function WP(t,e){return t?.layerUid==null?null:e.graphicsView!=null&&t.layerUid===e.graphicsView.processor.layer.id?e.graphics:e.map.findLayerByUid(t.layerUid)}function iGt(t,e){if(uU(t)||hU(t))return ly(t.target.object.boundingVolumeWorldSpace.bounds);if(bee(t)){t0e(fD,t.transformation);const i=Math.max(fD[0],fD[1],fD[2]);return t.target.baseBoundingSphere.radius*i}if(v8(t)){const i=jxt(t.target,e);return i?.5*b1e(i):null}return null}function rGt(t){return!uU(t)&&!hU(t)&&(bee(t)?t.target.numLodLevels>1:!!v8(t))}const fD=E();async function qxt(t,e){if(t.type==="2d")return t.hitTest(e);const i=await t.hitTest(e);if(i.results.length===0)return i;const r=(i.results[0].distance??0)*(1+Wxt),n=i.results.findIndex(s=>(s.distance??0)>r);return n!==-1&&(i.results=i.results.slice(0,n)),i}const Wxt=.05;function nGt(t){return t&&typeof t.highlight=="function"}function Yxt(t){return t&&typeof t.maskOccludee=="function"}function sGt(t,e,i){return t==null||t>i&&(e===0||t<e)}function oGt(t,e){return t!=null&&t>0||e!=null&&e>0}function aGt(t){const e=t.effectiveScaleRange;return{minScale:e?.minScale??0,maxScale:e?.maxScale??0}}let _V,vV;function Xxt(t){const e=nTe(t);for(;e.length>1;){const i=Vpe(e.shift());if(i.available)return i}return Vpe(e.shift())}function Vpe(t){switch(t){case fi.WEBGL1:return Zxt();case fi.WEBGL2:return Jxt()}}function Zxt(){return _V||(_V=eTt()),_V}function Jxt(){return vV||(vV=tTt()),vV}let sMe=class{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}},Kxt=class extends sMe{constructor(){super(...arguments),this.type=fi.WEBGL1}},Qxt=class extends sMe{constructor(){super(...arguments),this.type=fi.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}};function oMe(t,e){if(t===fi.WEBGL1&&typeof WebGLRenderingContext>"u"||t===fi.WEBGL2&&typeof WebGL2RenderingContext>"u")return null;const i=document.createElement("canvas");if(!i)return null;let r=$H(i,t,{failIfMajorPerformanceCaveat:!0});if(r==null&&(r=$H(i,t),r!=null&&(e.majorPerformanceCaveat=!0)),r==null)return r;if(t===fi.WEBGL1){const s=r.getParameter(r.VERSION),o=s?.match(/^WebGL\s+([\d.]*)/);if(o){const a=parseFloat(o[1]);e.available=a>=.94}}else e.available=!0;e.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),e.supportsVertexShaderSamplers=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const n=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT);return n&&(e.supportsHighPrecisionFragment=n.precision>0),r}function eTt(){const t=new Kxt,e=oMe(fi.WEBGL1,t);return e==null||(t.supportsElementIndexUint=e.getExtension("OES_element_index_uint")!==null,t.supportsStandardDerivatives=e.getExtension("OES_standard_derivatives")!==null,t.supportsInstancedArrays=e.getExtension("ANGLE_instanced_arrays")!==null,t.supportsTextureFloat=e.getExtension("OES_texture_float")!==null,t.supportsTextureHalfFloat=e.getExtension("OES_texture_half_float")!==null,t.supportsColorBufferFloat=e.getExtension("WEBGL_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=e.getExtension("EXT_color_buffer_half_float")!==null),t}function tTt(){const t=new Qxt,e=oMe(fi.WEBGL2,t);return e==null||(t.supportsColorBufferFloat=e.getExtension("EXT_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=t.supportsColorBufferFloat||e.getExtension("EXT_color_buffer_half_float")!==null),t}function iTt(t){const e=Xxt(t);if(!e.available)return new G("webgl:required",t==="3d"?"WebGL2 is required but not supported.":"WebGL is required but not supported.",new Error().stack);if(t==="3d"&&e.majorPerformanceCaveat)return new G("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!e.supportsHighPrecisionFragment)return new G("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!e.supportsVertexShaderSamplers)return new G("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(e.type===fi.WEBGL1){if(!e.supportsElementIndexUint)return new G("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!e.supportsStandardDerivatives)return new G("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!e.supportsInstancedArrays)return new G("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function rTt(t){return t&&"nodeType"in t}function nTt(t){return t&&typeof t.render=="function"}const Gpe={component:"esri-component"};let Hb=class extends we{constructor(){super(...arguments),this.widget=null}destroy(){this.node=null,this.widget?.destroy()}get id(){return this._get("id")??this.widget?.id??this.node?.id}set id(e){this._set("id",e)}set node(e){const i=this._get("node");e!==i&&(e&&e.classList.add(Gpe.component),i&&i.classList.remove(Gpe.component),this._set("node",e))}castNode(e){return this.widget?.destroy(),e?typeof e=="string"||rTt(e)?(this._set("widget",null),J6(e)):(nTt(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};u([p()],Hb.prototype,"id",null),u([p()],Hb.prototype,"node",null),u([ai("node")],Hb.prototype,"castNode",null),u([p({readOnly:!0})],Hb.prototype,"widget",void 0),Hb=u([M("esri.views.ui.Component")],Hb);const D4=Hb,aMe="calcite-mode-";function sTt(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replaceAll(/\s|'|"/g,"")}function oTt(){return sTt().startsWith("dark")}function aTt(){return`${aMe}${oTt()?"dark":"light"}`}function lTt(t){cTt(t),t.classList.add(aTt())}function cTt(t){Array.from(t.classList).forEach(e=>{e.startsWith(aMe)&&t.classList.remove(e)})}const uTt={left:0,top:0,bottom:0,right:0},lMe={bottom:30,top:15,right:15,left:15},pg="esri-ui",dc={ui:pg,corner:`${pg}-corner`,innerContainer:`${pg}-inner-container`,manualContainer:`${pg}-manual-container`,cornerContainer:`${pg}-corner-container`,topLeft:`${pg}-top-left`,topRight:`${pg}-top-right`,bottomLeft:`${pg}-bottom-left`,bottomRight:`${pg}-bottom-right`};function hTt(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function mD(t){return t===0?"0":`${t}px`}function bV(t){const e=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(e===null||e===Object.prototype)&&("component"in t||"index"in t||"position"in t)?t:null}function wV(t,{top:e,bottom:i,left:r,right:n}){t.style.top=e,t.style.bottom=i,t.style.left=r,t.style.right=n}let zf=class extends Sn.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._locale=Gu(),this.view=null,this._applyViewPadding=()=>{const i=this.container;i&&wV(i,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const i=this._innerContainer;i&&wV(i,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([ne(()=>[this.view?.padding,this.container],this._applyViewPadding,Xt),ne(()=>this.padding,this._applyUIPadding,Xt),ne(()=>[this.container,this._locale],([e,i])=>{e&&e.setAttribute("lang",i)},Xt),uZ(e=>{this._locale=e})])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentMap.clear()}set container(e){const i=this._get("container");e!==i&&(e&&(e.classList.add(dc.ui),lTt(e),this._attachContainers(e)),i&&(i.classList.remove(dc.ui),wV(i,{top:"",bottom:"",left:"",right:""}),X1e(i)),this._set("container",e))}get height(){const e=this.view?.height??0;if(e===0)return e;const i=this._getViewPadding(),{top:r,bottom:n}=i;return Math.max(e-r-n,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...lMe,...e}}get width(){const e=this.view?.width??0;if(e===0)return e;const i=this._getViewPadding(),{left:r,right:n}=i;return Math.max(e-r-n,0)}add(e,i){let r,n,s;if(Array.isArray(e))return void e.forEach(a=>this.add(a,i));const o=bV(e);o&&({index:r,position:i,component:e,key:n}=o),i&&typeof i=="object"&&({index:r,key:n,position:i,internal:s}=i),!e||i&&!this._isValidPosition(i)||this._add(e,i,r,n,s)}remove(e,i){if(!e)return;if(Array.isArray(e))return e.map(n=>this.remove(n,i));const r=this._find(e);if(r){if(this._componentMap.has(r)&&this._componentMap.get(r)?.key!==i)return;const n=this._components.indexOf(r);return r.node.parentNode?.removeChild(r.node),this._componentMap.delete(r),this._components.splice(n,1)[0]}}empty(e,i={removeInternal:!1}){if(Array.isArray(e)){for(const s of e)this.empty(s,i);return}const r=this._positionNameToContainerLookup[e??"manual"],n=Array.prototype.slice.call(r.children).map(s=>this._findByNode(s)).filter(s=>s==null?!1:!(this._componentMap.get(s)?.internal??!1)||i.removeInternal);for(const s of n)this.remove(s)}move(e,i){if(Array.isArray(e)&&e.forEach(o=>this.move(o,i)),!e)return;let r;const n=bV(e)||bV(i);if(n&&(r=n.index,i=n.position,e=n.component||e),i&&!this._isValidPosition(i))return;const s=this.remove(e);s&&this.add(s,{position:i,index:r})}find(e){if(!e)return null;const i=this._findById(e);return i&&(i.widget||i.node)}getComponents(e,i={includeInternal:!1}){return e?Array.isArray(e)?e.flatMap(r=>this._getComponentsAtPosition(r,i)):this._getComponentsAtPosition(e,i):this._components.filter(r=>i.includeInternal||!this._componentMap.get(r)?.internal).map(({widget:r,node:n})=>r??n)}getPosition(e){for(const i in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[i].contains(e))return i;return null}_add(e,i,r,n,s){e instanceof D4||(e=new D4({node:e})),this._place({component:e,position:i,index:r}),this._components.push(e),this._componentMap.set(e,{key:n,internal:s})}_find(e){return e?e instanceof D4?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.view?.padding??uTt}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(dc.innerContainer,dc.cornerContainer);const i=document.createElement("div");i.classList.add(dc.innerContainer,dc.manualContainer);const r=document.createElement("div");r.classList.add(dc.topLeft,dc.corner),e.appendChild(r);const n=document.createElement("div");n.classList.add(dc.topRight,dc.corner),e.appendChild(n);const s=document.createElement("div");s.classList.add(dc.bottomLeft,dc.corner),e.appendChild(s);const o=document.createElement("div");o.classList.add(dc.bottomRight,dc.corner),e.appendChild(o),this._innerContainer=e,this._manualContainer=i;const a=dje();this._cornerNameToContainerLookup={"top-left":r,"top-right":n,"bottom-left":s,"bottom-right":o,"top-leading":a?n:r,"top-trailing":a?r:n,"bottom-leading":a?o:s,"bottom-trailing":a?s:o},this._positionNameToContainerLookup={manual:i,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const i=e.position??"manual",{component:r,index:n}=e,s=this._positionNameToContainerLookup[i],o=n!=null&&n>-1;if(hTt(r.widget)&&r.widget.startup(),!o)return void s.appendChild(r.node);const a=Array.from(s.children);if(n===0)return void(s.firstChild?pne(r.node,s.firstChild):s.appendChild(r.node));n>=a.length?s.appendChild(r.node):pne(r.node,a[n])}_toPixelPosition(e){return{top:mD(e.top),left:mD(e.left),right:mD(e.right),bottom:mD(e.bottom)}}_findByComponent(e){return this._components.find(i=>i===e)??null}_findById(e){return this._components.find(({id:i})=>i===e)??null}_findByNode(e){return this._components.find(({node:i})=>i===e)??null}_getComponentsAtPosition(e,i){const r=this._positionNameToContainerLookup[e];return Array.prototype.slice.call(r.children).map(n=>this._findByNode(n)).filter(Yv).filter(n=>i.includeInternal||!this._componentMap.get(n)?.internal).map(({widget:n,node:s})=>n??s)}};u([p()],zf.prototype,"_locale",void 0),u([p()],zf.prototype,"container",null),u([p()],zf.prototype,"height",null),u([p({value:lMe})],zf.prototype,"padding",null),u([ai("padding")],zf.prototype,"castPadding",null),u([p()],zf.prototype,"view",void 0),u([p()],zf.prototype,"width",null),zf=u([M("esri.views.ui.UI")],zf);const dTt=zf,pTt={handleInterceptedEvent:(t,e,i,r)=>(t.scheduleRender(),e.properties[`on${r.type}`].apply(e.properties.bind||i,[r]))},fTt={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{e.charAt(0)==="-"?t.style.setProperty(e,i):t.style[e]=i}},mTt=t=>({...fTt,...t}),gTt=(t,e)=>{const i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i},yTt=(t,e)=>t.find(e),jpe=(t,e,i=!1)=>{let r=t;return e.forEach((n,s)=>{const o=r?.children?yTt(r.children,a=>a.domNode===n):void 0;i&&!o&&s!==e.length-1||(r=o)}),r},_Tt=t=>{let e;const i={...pTt,...t},r=mTt(i),n=r.performanceLogger;let s,o=!0,a=!1;const l=[],c=[],h=(f,m,y)=>{let _;r.eventHandlerInterceptor=(w,x,T,S)=>function(C){let A;n("domEvent",C);const R=gTt(C.currentTarget,_.domNode),D=R.some(k=>customElements.get(k?.tagName?.toLowerCase()));if(C.eventPhase===Event.CAPTURING_PHASE||!D)R.reverse(),A=jpe(_.getLastRender(),R);else{const k=C.composedPath(),B=k.slice(k.indexOf(C.currentTarget),k.indexOf(_.domNode)).reverse();A=jpe(_.getLastRender(),B,!0)}let N;return A&&(N=i.handleInterceptedEvent(e,A,this,C)),n("domEventProcessed",C),N},i.postProcessProjectionOptions?.(r);const v=y();_=f(m,v,r),r.eventHandlerInterceptor=void 0,l.push(_),c.push(y),i.afterFirstVNodeRendered&&i.afterFirstVNodeRendered(_,v)};let d=()=>{if(s=void 0,o){o=!1,n("renderStart",void 0);for(let f=0;f<l.length;f++){const m=c[f]();n("rendered",void 0),l[f].update(m),n("patched",void 0)}n("renderDone",void 0),o=!0}};return i.modifyDoRenderImplementation&&(d=i.modifyDoRenderImplementation(d,l,c)),e={renderNow:d,scheduleRender:()=>{s||a||(s=requestAnimationFrame(d))},stop:()=>{s&&(cancelAnimationFrame(s),s=void 0),a=!0},resume:()=>{a=!1,o=!0,e.scheduleRender()},append:(f,m)=>{h(K_.append,f,m)},insertBefore:(f,m)=>{h(K_.insertBefore,f,m)},merge:(f,m)=>{h(K_.merge,f,m)},replace:(f,m)=>{h(K_.replace,f,m)},detach:f=>{for(let m=0;m<c.length;m++)if(c[m]===f)return c.splice(m,1),l.splice(m,1)[0];throw new Error("renderFunction was not found")}},e},o2={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let a2,cMe,b8,uMe=!1,Ek=!1,tte=!1,Ou=!1,Hpe=null,lY=!1;const ite=t=>{const e=new URL(t,ha.$resourcesUrl$);return e.origin!==c$.location.origin?e.href:e.pathname},vTt=t=>ha.$resourcesUrl$=t,Dx=(t,e="")=>()=>{},qpe="http://www.w3.org/1999/xlink",Wpe={},bTt="http://www.w3.org/2000/svg",wTt="http://www.w3.org/1999/xhtml",xTt=t=>t!=null,rte=t=>(t=typeof t,t==="object"||t==="function");function TTt(t){var e,i,r;return(r=(i=(e=t.head)===null||e===void 0?void 0:e.querySelector('meta[name="csp-nonce"]'))===null||i===void 0?void 0:i.getAttribute("content"))!==null&&r!==void 0?r:void 0}const Ae=(t,e,...i)=>{let r=null,n=null,s=null,o=!1,a=!1;const l=[],c=d=>{for(let f=0;f<d.length;f++)r=d[f],Array.isArray(r)?c(r):r!=null&&typeof r!="boolean"&&((o=typeof t!="function"&&!rte(r))&&(r=String(r)),o&&a?l[l.length-1].$text$+=r:l.push(o?Ck(null,r):r),a=o)};if(c(i),e){e.key&&(n=e.key),e.name&&(s=e.name);{const d=e.className||e.class;d&&(e.class=typeof d!="object"?d:Object.keys(d).filter(f=>d[f]).join(" "))}}if(typeof t=="function")return t(e===null?{}:e,l,ETt);const h=Ck(t,null);return h.$attrs$=e,l.length>0&&(h.$children$=l),h.$key$=n,h.$name$=s,h},Ck=(t,e)=>{const i={$flags$:0,$tag$:t,$text$:e,$elm$:null,$children$:null};return i.$attrs$=null,i.$key$=null,i.$name$=null,i},md={},STt=t=>t&&t.$tag$===md,ETt={forEach:(t,e)=>t.map(Ype).forEach(e),map:(t,e)=>t.map(Ype).map(e).map(CTt)},Ype=t=>({vattrs:t.$attrs$,vchildren:t.$children$,vkey:t.$key$,vname:t.$name$,vtag:t.$tag$,vtext:t.$text$}),CTt=t=>{if(typeof t.vtag=="function"){const i=Object.assign({},t.vattrs);return t.vkey&&(i.key=t.vkey),t.vname&&(i.name=t.vname),Ae(t.vtag,i,...t.vchildren||[])}const e=Ck(t.vtag,t.vtext);return e.$attrs$=t.vattrs,e.$children$=t.vchildren,e.$key$=t.vkey,e.$name$=t.vname,e},ATt=t=>eSt.map(e=>e(t)).find(e=>!!e),OTt=(t,e)=>t!=null&&!rte(t)?e&4?t==="false"?!1:t===""||!!t:e&2?parseFloat(t):e&1?String(t):t:t,RTt=t=>t,fv=(t,e,i)=>{const r=RTt(t);return{emit:n=>PTt(r,e,{bubbles:!!(i&4),composed:!!(i&2),cancelable:!!(i&1),detail:n})}},PTt=(t,e,i)=>{const r=ha.ce(e,i);return t.dispatchEvent(r),r},Xpe=new WeakMap,MTt=(t,e,i)=>{let r=Ok.get(t);rSt&&i?(r=r||new CSSStyleSheet,typeof r=="string"?r=e:r.replaceSync(e)):r=e,Ok.set(t,r)},$Tt=(t,e,i,r)=>{var n;let s=hMe(e,i);const o=Ok.get(s);if(t=t.nodeType===11?t:Pp,o)if(typeof o=="string"){t=t.head||t;let a=Xpe.get(t),l;if(a||Xpe.set(t,a=new Set),!a.has(s)){{l=Pp.createElement("style"),l.innerHTML=o;const c=(n=ha.$nonce$)!==null&&n!==void 0?n:TTt(Pp);c!=null&&l.setAttribute("nonce",c),t.insertBefore(l,t.querySelector("link"))}a&&a.add(s)}}else t.adoptedStyleSheets.includes(o)||(t.adoptedStyleSheets=[...t.adoptedStyleSheets,o]);return s},ITt=t=>{const e=t.$cmpMeta$,i=t.$hostElement$,r=e.$flags$,n=Dx("attachStyles",e.$tagName$),s=$Tt(i.shadowRoot?i.shadowRoot:i.getRootNode(),e,t.$modeName$);r&10&&(i["s-sc"]=s,i.classList.add(s+"-h"),r&2&&i.classList.add(s+"-s")),n()},hMe=(t,e)=>"sc-"+(e&&t.$flags$&32?t.$tagName$+"-"+e:t.$tagName$),Zpe=(t,e,i,r,n,s)=>{if(i!==r){let o=efe(t,e),a=e.toLowerCase();if(e==="class"){const l=t.classList,c=Jpe(i),h=Jpe(r);l.remove(...c.filter(d=>d&&!h.includes(d))),l.add(...h.filter(d=>d&&!c.includes(d)))}else if(e==="style"){for(const l in i)(!r||r[l]==null)&&(l.includes("-")?t.style.removeProperty(l):t.style[l]="");for(const l in r)(!i||r[l]!==i[l])&&(l.includes("-")?t.style.setProperty(l,r[l]):t.style[l]=r[l])}else if(e!=="key")if(e==="ref")r&&r(t);else if(!t.__lookupSetter__(e)&&e[0]==="o"&&e[1]==="n")e[2]==="-"?e=e.slice(3):efe(c$,a)?e=a.slice(2):e=a[2]+e.slice(3),i&&ha.rel(t,e,i,!1),r&&ha.ael(t,e,r,!1);else{const l=rte(r);if((o||l&&r!==null)&&!n)try{if(t.tagName.includes("-"))t[e]=r;else{const h=r??"";e==="list"?o=!1:(i==null||t[e]!=h)&&(t[e]=h)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(e=a,c=!0),r==null||r===!1?(r!==!1||t.getAttribute(e)==="")&&(c?t.removeAttributeNS(qpe,e):t.removeAttribute(e)):(!o||s&4||n)&&!l&&(r=r===!0?"":r,c?t.setAttributeNS(qpe,e,r):t.setAttribute(e,r))}}},LTt=/\s/,Jpe=t=>t?t.split(LTt):[],dMe=(t,e,i,r)=>{const n=e.$elm$.nodeType===11&&e.$elm$.host?e.$elm$.host:e.$elm$,s=t&&t.$attrs$||Wpe,o=e.$attrs$||Wpe;for(r in s)r in o||Zpe(n,r,s[r],void 0,i,e.$flags$);for(r in o)Zpe(n,r,s[r],o[r],i,e.$flags$)},Ak=(t,e,i,r)=>{const n=e.$children$[i];let s=0,o,a,l;if(uMe||(tte=!0,n.$tag$==="slot"&&(a2&&r.classList.add(a2+"-s"),n.$flags$|=n.$children$?2:1)),n.$text$!==null)o=n.$elm$=Pp.createTextNode(n.$text$);else if(n.$flags$&1)o=n.$elm$=Pp.createTextNode("");else{if(Ou||(Ou=n.$tag$==="svg"),o=n.$elm$=Pp.createElementNS(Ou?bTt:wTt,n.$flags$&2?"slot-fb":n.$tag$),Ou&&n.$tag$==="foreignObject"&&(Ou=!1),dMe(null,n,Ou),xTt(a2)&&o["s-si"]!==a2&&o.classList.add(o["s-si"]=a2),n.$children$)for(s=0;s<n.$children$.length;++s)a=Ak(t,n,s,o),a&&o.appendChild(a);n.$tag$==="svg"?Ou=!1:o.tagName==="foreignObject"&&(Ou=!0)}return o["s-hn"]=b8,n.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=cMe,o["s-sn"]=n.$name$||"",l=t&&t.$children$&&t.$children$[i],l&&l.$tag$===n.$tag$&&t.$elm$&&YP(t.$elm$,!1)),o},YP=(t,e)=>{ha.$flags$|=1;const i=t.childNodes;for(let r=i.length-1;r>=0;r--){const n=i[r];n["s-hn"]!==b8&&n["s-ol"]&&(mMe(n).insertBefore(n,nte(n)),n["s-ol"].remove(),n["s-ol"]=void 0,tte=!0),e&&YP(n,e)}ha.$flags$&=-2},pMe=(t,e,i,r,n,s)=>{let o=t["s-cr"]&&t["s-cr"].parentNode||t,a;for(o.shadowRoot&&o.tagName===b8&&(o=o.shadowRoot);n<=s;++n)r[n]&&(a=Ak(null,i,n,t),a&&(r[n].$elm$=a,o.insertBefore(a,nte(e))))},fMe=(t,e,i,r,n)=>{for(;e<=i;++e)(r=t[e])&&(n=r.$elm$,_Me(r),Ek=!0,n["s-ol"]?n["s-ol"].remove():YP(n,!0),n.remove())},DTt=(t,e,i,r)=>{let n=0,s=0,o=0,a=0,l=e.length-1,c=e[0],h=e[l],d=r.length-1,f=r[0],m=r[d],y,_;for(;n<=l&&s<=d;)if(c==null)c=e[++n];else if(h==null)h=e[--l];else if(f==null)f=r[++s];else if(m==null)m=r[--d];else if(gD(c,f))l2(c,f),c=e[++n],f=r[++s];else if(gD(h,m))l2(h,m),h=e[--l],m=r[--d];else if(gD(c,m))(c.$tag$==="slot"||m.$tag$==="slot")&&YP(c.$elm$.parentNode,!1),l2(c,m),t.insertBefore(c.$elm$,h.$elm$.nextSibling),c=e[++n],m=r[--d];else if(gD(h,f))(c.$tag$==="slot"||m.$tag$==="slot")&&YP(h.$elm$.parentNode,!1),l2(h,f),t.insertBefore(h.$elm$,c.$elm$),h=e[--l],f=r[++s];else{for(o=-1,a=n;a<=l;++a)if(e[a]&&e[a].$key$!==null&&e[a].$key$===f.$key$){o=a;break}o>=0?(_=e[o],_.$tag$!==f.$tag$?y=Ak(e&&e[s],i,o,t):(l2(_,f),e[o]=void 0,y=_.$elm$),f=r[++s]):(y=Ak(e&&e[s],i,s,t),f=r[++s]),y&&mMe(c.$elm$).insertBefore(y,nte(c.$elm$))}n>l?pMe(t,r[d+1]==null?null:r[d+1].$elm$,i,r,s,d):s>d&&fMe(e,n,l)},gD=(t,e)=>t.$tag$===e.$tag$?t.$tag$==="slot"?t.$name$===e.$name$:t.$key$===e.$key$:!1,nte=t=>t&&t["s-ol"]||t,mMe=t=>(t["s-ol"]?t["s-ol"]:t).parentNode,l2=(t,e)=>{const i=e.$elm$=t.$elm$,r=t.$children$,n=e.$children$,s=e.$tag$,o=e.$text$;let a;o===null?(Ou=s==="svg"?!0:s==="foreignObject"?!1:Ou,s==="slot"||dMe(t,e,Ou),r!==null&&n!==null?DTt(i,r,e,n):n!==null?(t.$text$!==null&&(i.textContent=""),pMe(i,null,e,n,0,n.length-1)):r!==null&&fMe(r,0,r.length-1),Ou&&s==="svg"&&(Ou=!1)):(a=i["s-cr"])?a.parentNode.textContent=o:t.$text$!==o&&(i.data=o)},gMe=t=>{const e=t.childNodes;let i,r,n,s,o,a;for(r=0,n=e.length;r<n;r++)if(i=e[r],i.nodeType===1){if(i["s-sr"]){for(o=i["s-sn"],i.hidden=!1,s=0;s<n;s++)if(a=e[s].nodeType,e[s]["s-hn"]!==i["s-hn"]||o!==""){if(a===1&&o===e[s].getAttribute("slot")){i.hidden=!0;break}}else if(a===1||a===3&&e[s].textContent.trim()!==""){i.hidden=!0;break}}gMe(i)}},pp=[],yMe=t=>{let e,i,r,n,s,o,a=0;const l=t.childNodes,c=l.length;for(;a<c;a++){if(e=l[a],e["s-sr"]&&(i=e["s-cr"])&&i.parentNode)for(r=i.parentNode.childNodes,n=e["s-sn"],o=r.length-1;o>=0;o--)i=r[o],!i["s-cn"]&&!i["s-nr"]&&i["s-hn"]!==e["s-hn"]&&(Kpe(i,n)?(s=pp.find(h=>h.$nodeToRelocate$===i),Ek=!0,i["s-sn"]=i["s-sn"]||n,s?s.$slotRefNode$=e:pp.push({$slotRefNode$:e,$nodeToRelocate$:i}),i["s-sr"]&&pp.map(h=>{Kpe(h.$nodeToRelocate$,i["s-sn"])&&(s=pp.find(d=>d.$nodeToRelocate$===i),s&&!h.$slotRefNode$&&(h.$slotRefNode$=s.$slotRefNode$))})):pp.some(h=>h.$nodeToRelocate$===i)||pp.push({$nodeToRelocate$:i}));e.nodeType===1&&yMe(e)}},Kpe=(t,e)=>t.nodeType===1?t.getAttribute("slot")===null&&e===""||t.getAttribute("slot")===e:t["s-sn"]===e?!0:e==="",_Me=t=>{t.$attrs$&&t.$attrs$.ref&&t.$attrs$.ref(null),t.$children$&&t.$children$.map(_Me)},NTt=(t,e)=>{const i=t.$hostElement$,r=t.$cmpMeta$,n=t.$vnode$||Ck(null,null),s=STt(e)?e:Ae(null,null,e);b8=i.tagName,r.$attrsToReflect$&&(s.$attrs$=s.$attrs$||{},r.$attrsToReflect$.map(([o,a])=>s.$attrs$[a]=i[o])),s.$tag$=null,s.$flags$|=4,t.$vnode$=s,s.$elm$=n.$elm$=i.shadowRoot||i,a2=i["s-sc"],cMe=i["s-cr"],uMe=(r.$flags$&1)!==0,Ek=!1,l2(n,s);{if(ha.$flags$|=1,tte){yMe(s.$elm$);let o,a,l,c,h,d,f=0;for(;f<pp.length;f++)o=pp[f],a=o.$nodeToRelocate$,a["s-ol"]||(l=Pp.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(f=0;f<pp.length;f++)if(o=pp[f],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,h=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(d=l["s-nr"],d&&d["s-sn"]===a["s-sn"]&&c===d.parentNode&&(d=d.nextSibling,!d||!d["s-nr"])){h=d;break}(!h&&c!==a.parentNode||a.nextSibling!==h)&&a!==h&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,h))}else a.nodeType===1&&(a.hidden=!0)}Ek&&gMe(s.$elm$),ha.$flags$&=-2,pp.length=0}},FTt=(t,e)=>{},ste=(t,e)=>(t.$flags$|=16,FTt(t,t.$ancestorComponent$),sSt(()=>kTt(t,e))),kTt=(t,e)=>{const i=t.$hostElement$,r=Dx("scheduleUpdate",t.$cmpMeta$.$tagName$),n=i;let s;return e?s=pE(n,"componentWillLoad"):s=pE(n,"componentWillUpdate"),s=Qpe(s,()=>pE(n,"componentWillRender")),r(),Qpe(s,()=>UTt(t,n,e))},UTt=async(t,e,i)=>{const r=t.$hostElement$,n=Dx("update",t.$cmpMeta$.$tagName$);r["s-rc"],i&&ITt(t);const s=Dx("render",t.$cmpMeta$.$tagName$);zTt(t,e,r),s(),n(),BTt(t)},zTt=(t,e,i)=>{try{Hpe=e,e=e.render&&e.render(),t.$flags$&=-17,t.$flags$|=2,(o2.hasRenderFn||o2.reflect)&&(o2.vdomRender||o2.reflect)&&(o2.hydrateServerSide||NTt(t,e))}catch(a){l$(a,t.$hostElement$)}return Hpe=null,null},BTt=t=>{const e=t.$cmpMeta$.$tagName$,i=t.$hostElement$,r=Dx("postUpdate",e),n=i;t.$ancestorComponent$,pE(n,"componentDidRender"),t.$flags$&64?(pE(n,"componentDidUpdate"),r()):(t.$flags$|=64,pE(n,"componentDidLoad"),r())},ote=t=>{{const e=a$(t),i=e.$hostElement$.isConnected;return i&&(e.$flags$&18)===2&&ste(e,!1),i}},pE=(t,e,i)=>{if(t&&t[e])try{return t[e](i)}catch(r){l$(r)}},Qpe=(t,e)=>t&&t.then?t.then(e):e(),VTt=(t,e)=>a$(t).$instanceValues$.get(e),GTt=(t,e,i,r)=>{const n=a$(t),s=t,o=n.$instanceValues$.get(e),a=n.$flags$,l=s;i=OTt(i,r.$members$[e][0]);const c=Number.isNaN(o)&&Number.isNaN(i);if(i!==o&&!c){n.$instanceValues$.set(e,i);{if(r.$watchers$&&a&128){const d=r.$watchers$[e];d&&d.map(f=>{try{l[f](i,o,e)}catch(m){l$(m,s)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(i,o,e)===!1)return;ste(n,!1)}}}},jTt=(t,e,i)=>{if(e.$members$){t.watchers&&(e.$watchers$=t.watchers);const r=Object.entries(e.$members$),n=t.prototype;r.map(([s,[o]])=>{(o&31||o&32)&&Object.defineProperty(n,s,{get(){return VTt(this,s)},set(a){GTt(this,s,a,e)},configurable:!0,enumerable:!0})});{const s=new Map;n.attributeChangedCallback=function(o,a,l){ha.jmp(()=>{const c=s.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(n.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},t.observedAttributes=r.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return s.set(l,o),a[0]&512&&e.$attrsToReflect$.push([o,l]),l})}}return t},HTt=async(t,e,i,r,n)=>{if(!(e.$flags$&32)&&(n=t.constructor,e.$flags$|=32,customElements.whenDefined(i.$tagName$).then(()=>e.$flags$|=128),n.style)){let o=n.style;typeof o!="string"&&(o=o[e.$modeName$=ATt(t)]);const a=hMe(i,e.$modeName$);if(!Ok.has(a)){const l=Dx("registerStyles",i.$tagName$);MTt(a,o,!!(i.$flags$&1)),l()}}e.$ancestorComponent$,(()=>ste(e,!0))()},qTt=t=>{},WTt=t=>{if(!(ha.$flags$&1)){const e=a$(t),i=e.$cmpMeta$,r=Dx("connectedCallback",i.$tagName$);e.$flags$&1?(bMe(t,e,i.$listeners$),qTt(e.$lazyInstance$)):(e.$flags$|=1,i.$flags$&12&&YTt(t),i.$members$&&Object.entries(i.$members$).map(([n,[s]])=>{if(s&31&&t.hasOwnProperty(n)){const o=t[n];delete t[n],t[n]=o}}),HTt(t,e,i)),r()}},YTt=t=>{const e=t["s-cr"]=Pp.createComment("");e["s-cn"]=!0,t.insertBefore(e,t.firstChild)},XTt=t=>{if(!(ha.$flags$&1)){const e=a$(t);e.$rmListeners$&&(e.$rmListeners$.map(i=>i()),e.$rmListeners$=void 0)}},rh=(t,e)=>{const i={$flags$:e[0],$tagName$:e[1]};i.$members$=e[2],i.$listeners$=e[3],i.$watchers$=t.$watchers$,i.$attrsToReflect$=[];const r=t.prototype.connectedCallback,n=t.prototype.disconnectedCallback;return Object.assign(t.prototype,{__registerHost(){QTt(this,i)},connectedCallback(){WTt(this),r&&r.call(this)},disconnectedCallback(){XTt(this),n&&n.call(this)},__attachShadow(){this.attachShadow({mode:"open",delegatesFocus:!!(i.$flags$&16)})}}),t.is=i.$tagName$,jTt(t,i)},vMe=(t,e)=>e,bMe=(t,e,i,r)=>{i&&i.map(([n,s,o])=>{const a=JTt(t,n),l=ZTt(e,o),c=KTt(n);ha.ael(a,s,l,c),(e.$rmListeners$=e.$rmListeners$||[]).push(()=>ha.rel(a,s,l,c))})},ZTt=(t,e)=>i=>{try{o2.lazyLoad||t.$hostElement$[e](i)}catch(r){l$(r)}},JTt=(t,e)=>e&4?Pp:e&8?c$:e&16?Pp.body:t,KTt=t=>tSt?{passive:(t&1)!==0,capture:(t&2)!==0}:(t&2)!==0,wMe=new WeakMap,a$=t=>wMe.get(t),QTt=(t,e)=>{const i={$flags$:0,$hostElement$:t,$cmpMeta$:e,$instanceValues$:new Map};return bMe(t,i,e.$listeners$),wMe.set(t,i)},efe=(t,e)=>e in t,l$=(t,e)=>(0,console.error)(t,e),Ok=new Map,eSt=[],c$=typeof window<"u"?window:{},Pp=c$.document||{head:{}},nh=c$.HTMLElement||class{},ha={$flags$:0,$resourcesUrl$:"",jmp:t=>t(),raf:t=>requestAnimationFrame(t),ael:(t,e,i,r)=>t.addEventListener(e,i,r),rel:(t,e,i,r)=>t.removeEventListener(e,i,r),ce:(t,e)=>new CustomEvent(t,e)},tSt=(()=>{let t=!1;try{Pp.addEventListener("e",null,Object.defineProperty({},"passive",{get(){t=!0}}))}catch{}return t})(),iSt=t=>Promise.resolve(t),rSt=(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})(),cY=[],xMe=[],TMe=(t,e)=>i=>{t.push(i),lY||(lY=!0,e&&ha.$flags$&4?nSt(uY):ha.raf(uY))},tfe=t=>{for(let e=0;e<t.length;e++)try{t[e](performance.now())}catch(i){l$(i)}t.length=0},uY=()=>{tfe(cY),tfe(xMe),(lY=cY.length>0)&&ha.raf(uY)},nSt=t=>iSt().then(t),pGt=TMe(cY,!1),sSt=TMe(xMe,!0);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */function oSt(t){return t.map(e=>{let i="";for(let r=0;r<e;r++)i+=((1+Math.random())*65536|0).toString(16).substring(1);return i}).join("-")}const SMe=()=>oSt([2,1,1,1,3]);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const EMe="calcite-mode-auto",CMe="calcite-mode-dark",aSt="calcite-mode-light",hY={autoMode:EMe,darkMode:CMe,lightMode:aSt,rtl:"calcite--rtl",calciteAnimate:"calcite-animate",calciteAnimateIn:"calcite-animate__in",calciteAnimateInUp:"calcite-animate__in-up",calciteAnimateInDown:"calcite-animate__in-down",calciteAnimateInRight:"calcite-animate__in-right",calciteAnimateInLeft:"calcite-animate__in-left",calciteAnimateInScale:"calcite-animate__in-scale"};/*!
* tabbable 6.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var AMe=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],Rk=AMe.join(","),OMe=typeof Element>"u",Nx=OMe?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,Pk=!OMe&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t?.ownerDocument},Mk=function t(e,i){var r;i===void 0&&(i=!0);var n=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"inert"),s=n===""||n==="true",o=s||i&&e&&t(e.parentNode);return o},lSt=function(e){var i,r=e==null||(i=e.getAttribute)===null||i===void 0?void 0:i.call(e,"contenteditable");return r===""||r==="true"},RMe=function(e,i,r){if(Mk(e))return[];var n=Array.prototype.slice.apply(e.querySelectorAll(Rk));return i&&Nx.call(e,Rk)&&n.unshift(e),n=n.filter(r),n},PMe=function t(e,i,r){for(var n=[],s=Array.from(e);s.length;){var o=s.shift();if(!Mk(o,!1))if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,c=t(l,!0,r);r.flatten?n.push.apply(n,c):n.push({scopeParent:o,candidates:c})}else{var h=Nx.call(o,Rk);h&&r.filter(o)&&(i||!e.includes(o))&&n.push(o);var d=o.shadowRoot||typeof r.getShadowRoot=="function"&&r.getShadowRoot(o),f=!Mk(d,!1)&&(!r.shadowRootFilter||r.shadowRootFilter(o));if(d&&f){var m=t(d===!0?o.children:d.children,!0,r);r.flatten?n.push.apply(n,m):n.push({scopeParent:o,candidates:m})}else s.unshift.apply(s,o.children)}}return n},MMe=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},$Me=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||lSt(e))&&!MMe(e)?0:e.tabIndex},cSt=function(e,i){var r=$Me(e);return r<0&&i&&!MMe(e)?0:r},uSt=function(e,i){return e.tabIndex===i.tabIndex?e.documentOrder-i.documentOrder:e.tabIndex-i.tabIndex},IMe=function(e){return e.tagName==="INPUT"},hSt=function(e){return IMe(e)&&e.type==="hidden"},dSt=function(e){var i=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(r){return r.tagName==="SUMMARY"});return i},pSt=function(e,i){for(var r=0;r<e.length;r++)if(e[r].checked&&e[r].form===i)return e[r]},fSt=function(e){if(!e.name)return!0;var i=e.form||Pk(e),r=function(a){return i.querySelectorAll('input[type="radio"][name="'+a+'"]')},n;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")n=r(window.CSS.escape(e.name));else try{n=r(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var s=pSt(n,e.form);return!s||s===e},mSt=function(e){return IMe(e)&&e.type==="radio"},gSt=function(e){return mSt(e)&&!fSt(e)},ySt=function(e){var i,r=e&&Pk(e),n=(i=r)===null||i===void 0?void 0:i.host,s=!1;if(r&&r!==e){var o,a,l;for(s=!!((o=n)!==null&&o!==void 0&&(a=o.ownerDocument)!==null&&a!==void 0&&a.contains(n)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!s&&n;){var c,h,d;r=Pk(n),n=(c=r)===null||c===void 0?void 0:c.host,s=!!((h=n)!==null&&h!==void 0&&(d=h.ownerDocument)!==null&&d!==void 0&&d.contains(n))}}return s},ife=function(e){var i=e.getBoundingClientRect(),r=i.width,n=i.height;return r===0&&n===0},_St=function(e,i){var r=i.displayCheck,n=i.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var s=Nx.call(e,"details>summary:first-of-type"),o=s?e.parentElement:e;if(Nx.call(o,"details:not([open]) *"))return!0;if(!r||r==="full"||r==="legacy-full"){if(typeof n=="function"){for(var a=e;e;){var l=e.parentElement,c=Pk(e);if(l&&!l.shadowRoot&&n(l)===!0)return ife(e);e.assignedSlot?e=e.assignedSlot:!l&&c!==e.ownerDocument?e=c.host:e=l}e=a}if(ySt(e))return!e.getClientRects().length;if(r!=="legacy-full")return!0}else if(r==="non-zero-area")return ife(e);return!1},vSt=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var i=e.parentElement;i;){if(i.tagName==="FIELDSET"&&i.disabled){for(var r=0;r<i.children.length;r++){var n=i.children.item(r);if(n.tagName==="LEGEND")return Nx.call(i,"fieldset[disabled] *")?!0:!n.contains(e)}return!0}i=i.parentElement}return!1},$k=function(e,i){return!(i.disabled||Mk(i)||hSt(i)||_St(i,e)||dSt(i)||vSt(i))},dY=function(e,i){return!(gSt(i)||$Me(i)<0||!$k(e,i))},bSt=function(e){var i=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(i)||i>=0)},wSt=function t(e){var i=[],r=[];return e.forEach(function(n,s){var o=!!n.scopeParent,a=o?n.scopeParent:n,l=cSt(a,o),c=o?t(n.candidates):a;l===0?o?i.push.apply(i,c):i.push(a):r.push({documentOrder:s,tabIndex:l,item:n,isScope:o,content:c})}),r.sort(uSt).reduce(function(n,s){return s.isScope?n.push.apply(n,s.content):n.push(s.content),n},[]).concat(i)},xSt=function(e,i){i=i||{};var r;return i.getShadowRoot?r=PMe([e],i.includeContainer,{filter:dY.bind(null,i),flatten:!1,getShadowRoot:i.getShadowRoot,shadowRootFilter:bSt}):r=RMe(e,i.includeContainer,dY.bind(null,i)),wSt(r)},fGt=function(e,i){i=i||{};var r;return i.getShadowRoot?r=PMe([e],i.includeContainer,{filter:$k.bind(null,i),flatten:!0,getShadowRoot:i.getShadowRoot}):r=RMe(e,i.includeContainer,$k.bind(null,i)),r},mGt=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return Nx.call(e,Rk)===!1?!1:dY(i,e)},TSt=AMe.concat("iframe").join(","),gGt=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return Nx.call(e,TSt)===!1?!1:$k(i,e)};const SSt={getShadowRoot:!0};function ESt(t){return rT(t,`.${hY.darkMode}, .${hY.lightMode}`)?.classList.contains("calcite-mode-dark")?"dark":"light"}function LMe(t){const e="dir",i=`[${e}]`,r=rT(t,i);return r?r.getAttribute(e):"ltr"}function ate(t){return t.getRootNode()}function yGt(t){const e=ate(t);return"host"in e?e:null}function DMe(t){return t.host||null}function NMe(t,{selector:e,id:i}){function r(n){if(!n)return null;n.assignedSlot&&(n=n.assignedSlot);const s=ate(n),o=i?"getElementById"in s?s.getElementById(i):null:e?s.querySelector(e):null,a=DMe(s);return o||(a?r(a):null)}return r(t)}function rT(t,e){function i(r){return r?r.closest(e)||i(DMe(ate(r))):null}return i(t)}function CSt(t,e){return FMe(t,e)}function FMe(t,e){if(!t)return;const i=e(t);if(i!==void 0)return i;const{parentNode:r}=t;return FMe(r instanceof ShadowRoot?r.host:r,e)}function ASt(t,e){return!!CSt(e,i=>i===t?!0:void 0)}function OSt(t){return typeof t?.setFocus=="function"}async function lte(t){if(t)return OSt(t)?t.setFocus():t.focus()}function _Gt(t){t&&(xSt(t,SSt)[0]||t).focus()}const XP=":not([slot])";function vGt(t,e,i){e&&!Array.isArray(e)&&typeof e!="string"&&(i=e,e=null);const r=e?Array.isArray(e)?e.map(n=>`[slot="${n}"]`).join(","):`[slot="${e}"]`:XP;return i?.all?RSt(t,r,i):PSt(t,r,i)}function kMe(t,e){return t?Array.from(t.children||[]).filter(i=>i?.matches(e)):[]}function RSt(t,e,i){let r=e===XP?kMe(t,XP):Array.from(t.querySelectorAll(e));r=i&&i.direct===!1?r:r.filter(s=>s.parentElement===t),r=i?.matches?r.filter(s=>s?.matches(i.matches)):r;const n=i?.selector;return n?r.map(s=>Array.from(s.querySelectorAll(n))).reduce((s,o)=>[...s,...o],[]).filter(s=>!!s):r}function PSt(t,e,i){let r=e===XP?kMe(t,XP)[0]||null:t.querySelector(e);r=i&&i.direct===!1||r?.parentElement===t?r:null,r=i?.matches?r?.matches(i.matches)?r:null:r;const n=i?.selector;return n?r?.querySelector(n):r}function bGt(t,e,i){if(typeof e=="string"&&e!=="")return e;if(e==="")return t[i]}function ex(t){return(!!t).toString()}function wGt(t){return ip(t)||$St(t)}function MSt(t){return ISt(t).filter(e=>e.nodeType===Node.TEXT_NODE).map(e=>e.textContent).join("").trim()}function $St(t){return!!MSt(t)}function ISt(t){return t.target.assignedNodes({flatten:!0})}function ip(t){return!!cte(t).length}function cte(t){return t.target.assignedElements({flatten:!0})}function xGt(t){return!!(t.isPrimary&&t.button===0)}const yD=(t,e,i,r=!0)=>{const n=t.indexOf(e),s=n===0,o=n===t.length-1;r&&(i=i==="previous"&&s?"last":i==="next"&&o?"first":i);let a;return i==="previous"?a=t[n-1]||t[r?t.length-1:n]:i==="next"?a=t[n+1]||t[r?0:n]:i==="last"?a=t[t.length-1]:a=t[0],lte(a),a};function LSt(t,e){if(t.parentNode!==e.parentNode)return!1;const i=Array.from(t.parentNode.children);return i.indexOf(t)<i.indexOf(e)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */function rfe(){const{classList:t}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,i=()=>t.contains(CMe)||t.contains(EMe)&&e?"dark":"light",r=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),n=o=>{s!==o&&r(o),s=o};let s=i();r(s),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>n(o.matches?"dark":"light")),new MutationObserver(()=>n(i())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function DSt(){typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document&&(document.readyState==="interactive"?rfe():document.addEventListener("DOMContentLoaded",()=>rfe(),{once:!0}))}const NSt=DSt;NSt();let UMe;function FSt(){try{ite(".")}catch{vTt(ul(ur(UMe)))}}function ute(t){const e=[];for(const i of Object.keys(t))customElements.get(`calcite-${i}`)||e.push(t[i]?.());return e.length>0?Promise.all(e):null}UMe="components/assets";const zMe=Symbol("widget"),BMe=Symbol("widget-test-data"),kSt=[],USt={},Ik=new WeakMap;function VMe(t,e){let i=e.children;if(i?.length)for(let n=0;n<i.length;++n)i[n]=VMe(t,i[n]);else i=kSt;const r=e.vnodeSelector;if(Lk(r)){const n=e.properties||USt,s=n.key||r;return{vnodeSelector:"div",properties:{key:s,afterCreate:zSt,afterUpdate:BSt,afterRemoved:GMe,parentWidget:t,widgetConstructor:r,widgetProperties:{...n,key:s,children:i}},children:void 0,text:void 0,domNode:null}}return e}function zSt(t,e,i,{parentWidget:r,widgetConstructor:n,widgetProperties:s}){const o=new n(s);o.container=t,Ik.set(t,o),o.afterCreate?.(o,t),r.addHandles(Vi(()=>GMe(t))),queueMicrotask(()=>{o[BMe].projector.renderNow()})}function BSt(t,e,i,{widgetProperties:r}){const n=Ik.get(t);n&&(n.set(r),n.afterUpdate?.(n,t))}function GMe(t){const e=Ik.get(t);e&&(e.afterRemoved?.(e,t),e.destroy(),Ik.delete(t))}function Lk(t){return typeof t=="function"&&t[zMe]}const vn={arrowDown:"esri-icon-arrow-down",arrowUp:"esri-icon-arrow-up",basemap:"esri-icon-basemap",bookmark:"esri-icon-bookmark",calendar:"esri-icon-calendar",checkMark:"esri-icon-check-mark",checkboxUnchecked:"esri-icon-checkbox-unchecked",close:"esri-icon-close",collapse:"esri-icon-collapse",defaultAction:"esri-icon-default-action",description:"esri-icon-description",directions:"esri-icon-directions",dockBottom:"esri-icon-dock-bottom",dockLeft:"esri-icon-dock-left",dockRight:"esri-icon-dock-right",down:"esri-icon-down",downArrow:"esri-icon-down-arrow",download:"esri-icon-download",dragHorizontal:"esri-icon-drag-horizontal",dragVertical:"esri-icon-drag-vertical",duplicate:"esri-icon-duplicate",edit:"esri-icon-edit",elevationProfile:"esri-icon-elevation-profile",environmentSettings:"esri-icon-environment-settings",erase:"esri-icon-erase",error:"esri-icon-error",expand:"esri-icon-expand",fontFallbackText:"esri-icon-font-fallback-text",forward:"esri-icon-forward",gear:"esri-icon-gear",handleHorizontal:"esri-icon-handle-horizontal",handleVertical:"esri-icon-handle-vertical",home:"esri-icon-home",icon:"esri-icon",launchLinkExternal:"esri-icon-launch-link-external",layerList:"esri-icon-layer-list",layers:"esri-icon-layers",left:"esri-icon-left",leftArrows:"esri-icon-left-arrow",leftTriangleArrow:"esri-icon-left-triangle-arrow",lineOfSight:"esri-icon-line-of-sight",link:"esri-icon-link",linkExternal:"esri-icon-link-external",linkHorizontal:"esri-icon-link-horizontal",loadingIndicator:"esri-icon-loading-indicator",locate:"esri-icon-locate",locateCircled:"esri-icon-locate-circled",locked:"esri-icon-locked",mapPin:"esri-icon-map-pin",maximize:"esri-icon-maximize",measure:"esri-icon-measure",measureArea:"esri-icon-measure-area",measureBuildingHeightShadow:"esri-icon-measure-building-height-shadow",measureLine:"esri-icon-measure-line",menu:"esri-icon-menu",minimize:"esri-icon-minimize",minus:"esri-icon-minus",nonVisible:"esri-icon-non-visible",northNavigation:"esri-icon-north-navigation",noticeTriangle:"esri-icon-notice-triangle",organization:"esri-icon-organization",pan:"esri-icon-pan",pan2:"esri-icon-pan2",partlyCloudy:"esri-icon-partly-cloudy",pause:"esri-icon-pause",play:"esri-icon-play",playCircled:"esri-icon-play-circled",plus:"esri-icon-plus",polyline:"esri-icon-polyline",printer:"esri-icon-printer",radioChecked:"esri-icon-radio-checked",radioUnchecked:"esri-icon-radio-unchecked",refresh:"esri-icon-refresh",reverse:"esri-icon-reverse",right:"esri-icon-right",rightArrow:"esri-icon-right-arrow",rightTriangleArrow:"esri-icon-right-triangle-arrow",rotate:"esri-icon-rotate",save:"esri-icon-save",search:"esri-icon-search",settings2:"esri-icon-settings2",slice:"esri-icon-slice",swap:"esri-icon-swap",table:"esri-icon-table",timeClock:"esri-icon-time-clock",tracking:"esri-icon-tracking",trash:"esri-icon-trash",unlockedLinkHorizontal:"esri-icon-unlocked-link-horizontal",up:"esri-icon-up",upArrow:"esri-icon-up-arrow",upDownArrows:"esri-icon-up-down-arrows",urbanModel:"esri-icon-urban-model",vertexGps:"esri-icon-vertex-gps",visible:"esri-icon-visible",zoomInFixed:"esri-icon-zoom-in-fixed",zoomInMagnifyingGlass:"esri-icon-zoom-in-magnifying-glass",zoomOutFixed:"esri-icon-zoom-out-fixed",zoomToObject:"esri-icon-zoom-to-object"},nfe=new Set;function VSt(t){nfe.add(t),t.finally(()=>nfe.delete(t))}var jMe;const GSt="esri.widgets.Widget";let jSt=0;const HSt={widgetIcon:vn.checkboxUnchecked};function HMe(t,e){for(const i in e)t[i]!=null&&(typeof t[i]=="object"&&typeof e[i]=="object"?HMe(t[i],e?.[i]):t[i]=e[i]);return t}const qSt=_Tt({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,i=/capture$/i;t.eventHandlerInterceptor=(r,n,s,o)=>{const a=e?.(r,n,s,o),l=i.test(r);if(!((r=r.replace(i,"")).toLowerCase()in s)||l){const c=r[2].toLowerCase()+r.slice(3),h=m=>a?.call(s,m);s.addEventListener(c,h,l);const d=()=>s.removeEventListener(c,h,l),f=o.afterRemoved;o.afterRemoved=m=>{f?.(m),d()}}return a}},handleInterceptedEvent(t,e,i,r){const{eventPhase:n,type:s}=r,o=n===Event.CAPTURING_PHASE;let a=`on${s}${o?"capture":""}`;const l=e.properties;(l&&a in l||(a=`on${s[0].toUpperCase()}${s.slice(1)}${o?"Capture":""}`,l&&a in l))&&(lwe(),t.scheduleRender(),l[a].call(l.bind||i,r))}});let xV=!1,no=class extends p6(Sn.EventedAccessor){constructor(e,i){super(e,i),this._attached=!1,this._projector=qSt,this._readyForTrueRender=!1,this.iconClass=HSt.widgetIcon,this.icon=null,this.key=this,this._loadLocale=aM(async()=>{if(this._messageBundleProps?.length){const a=await Promise.allSettled(this._messageBundleProps.map(async({bundlePath:l,propertyName:c})=>{if(this.destroyed)return;let h=await pZ(l);this.uiStrings&&Object.keys(this.uiStrings)&&(h=HMe(Q(h),this.uiStrings)),this[c]=h}));if(this.destroyed)return;for(const l of a)l.status==="rejected"&&K.getLogger(this).error("widget-intl:locale-error",this.declaredClass,l.reason)}await this.loadLocale()}),FSt();const r="esri-widget-uid-"+YZ(),n=this.render.bind(this);this._trackingTarget=new u6(()=>this.scheduleRender());const s=()=>{if(!this._readyForTrueRender||this.destroyed)return null;const a=n();let{properties:l}=a;l||(a.properties=l={});const{key:c}=l;if(c||(l.key=r),Lk(a.vnodeSelector)){if(!this.visible)return{vnodeSelector:"div",properties:{key:`${r}-hidden`,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0}}else this.visible?l.styles||(l.styles={}):(l.class="",l.styles={display:"none"}),l.styles.display||(l.styles.display="");let h=0;return a.children?.forEach(d=>{if(Lk(d.vnodeSelector))return;let{properties:f}=d;f||(d.properties=f={}),f.key||(f.key=`${this.id}--${h++}`)}),VMe(this,a)};this.render=()=>{if(xV)return s();let a=lje(this)??null;if(a)return a;this._trackingTarget.clear(),xV=!0;try{a=by(this._trackingTarget,s)}catch(l){throw console.error(l),l}finally{xV=!1}return a&&cje(this,a),a};const o=this.beforeFirstRender();o?this._resourcesFetch=o.then(()=>{this._readyForTrueRender=!0,this._postInitialize()}):(this._resourcesFetch=Promise.resolve().then(()=>{this._postInitialize()}),this._readyForTrueRender=!0),this.addResolvingPromise(this._resourcesFetch),VSt(this._resourcesFetch)}normalizeCtorArgs(e,i){const r={...e};return i&&(r.container=i),r}postInitialize(){}beforeFirstRender(){const e=this.loadDependencies();return this._messageBundleProps?.length||e?Promise.all([e,this._loadLocale()]).then(()=>{}).catch(tie):null}loadDependencies(){return null}loadLocale(){return null}destroy(){this.destroyed||($e(this._trackingTarget),$e(this.viewModel),this._detach(this.container),this._set("container",null),this._emitter.clear(),this.render=()=>null,this._projector=null,wz(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return J6(e)}get domNode(){return this.container}set domNode(e){this.container=e}get id(){return this._get("id")||this.container?.id||Date.now().toString(16)+"-widget-"+jSt++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(jMe=zMe,BMe)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(wz(this),this._projector.scheduleRender())}own(e){Nme(K.getLogger(this.declaredClass),"`Widget.own()` is deprecated in favor of Widget.addHandles()'",{replacement:"Widget.addHandles()",version:"4.28"}),this.addHandles(e)}classes(...e){return hje.apply(this,e)}renderNow(){wz(this),this._projector.renderNow()}_postInitialize(){if(this.destroyed)return;this.scheduleRender(),this._delegatedEventNames?.length&&this.addHandles(ne(()=>this.viewModel,(i,r)=>{r&&this.removeHandles("delegated-events"),i&&l6(i)&&this.addHandles(this._delegatedEventNames.map(n=>oy(i,n,s=>{this.emit(n,s)})),"delegated-events")},Ji)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(tie),this.scheduleRender()};this.addHandles([uZ(e),ne(()=>this.uiStrings,e),gl(()=>this.container,i=>{this.destroyed||this._attach(i)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){this._attached&&(this._projector.detach(this.render),this._attached=!1),e?.parentNode?.removeChild(e)}};no[jMe]=!0,u([p()],no.prototype,"_readyForTrueRender",void 0),u([p({value:null})],no.prototype,"container",null),u([ai("container")],no.prototype,"castContainer",null),u([p()],no.prototype,"iconClass",void 0),u([p()],no.prototype,"icon",void 0),u([p()],no.prototype,"id",null),u([p()],no.prototype,"label",null),u([p()],no.prototype,"renderable",null),u([p()],no.prototype,"uiStrings",void 0),u([p()],no.prototype,"viewModel",void 0),u([p({value:!0})],no.prototype,"visible",null),u([p()],no.prototype,"key",void 0),u([p()],no.prototype,"children",void 0),u([p()],no.prototype,"afterCreate",void 0),u([p()],no.prototype,"afterUpdate",void 0),u([p()],no.prototype,"afterRemoved",void 0),no=u([M(GSt)],no);const Yp=no;function sfe(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function WSt(t,e){return t.length!==e.length||t.some((i,r)=>i.text!==e[r].text)}function _D(t,e,i){!i||!e||t.find(r=>r.layerView===e&&r.text===i)||t.push({text:i,layerView:e})}function YSt(t){return t.type==="bing-maps"}const V0=[];let c2=class extends we{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.removeHandles("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new Je,this.view=null,this._allLayerViewsChange=i=>{this.removeHandles("suspension");const r=this.view?.allLayerViews;r&&this.addHandles(r.map(n=>ne(()=>[n.suspended,n.layer?.attributionVisible],()=>this._updateAttributionItems())).toArray(),"suspension"),i?.removed&&i.removed.forEach(n=>{this._pendingAttributions.delete(n),this._fetchedAttributionData.delete(n)}),this._updateAttributionItems()},this.addHandles([bo(()=>this.view?.allLayerViews,"change",i=>this._allLayerViewsChange(i),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),gl(()=>this.view?.stationary===!0,()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.view?.ready?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.view,i=e?.allLayerViews;V0.length=0,e&&i?(i.forEach(r=>{if(r.suspended||!r.layer?.attributionVisible)return;const n=r.layer;if(sfe(n,"user"))return void _D(V0,r,n.copyright);if(n.hasAttributionData){if(this._fetchedAttributionData.has(r)){const o=this._fetchedAttributionData.get(r);return void(o?_D(V0,r,this._getDynamicAttribution(o,e,n)):sfe(n)&&_D(V0,r,n.copyright))}return void this._fetchAttributionData(r)}const s="portalItem"in n?n.portalItem?.accessInformation:void 0;_D(V0,r,s||n.copyright)}),WSt(this.items,V0)&&(this.items.removeAll(),this.items.addMany(V0)),V0.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const i=await jc(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const r=i.ok?this._createContributionIndex(i.value,YSt(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,r)}this._updateAttributionItems()}_createContributionIndex(e,i){const r=e.contributors,n={};if(!r)return n;for(let s=0;s<r.length;s++){const o=r[s],a=o.coverageAreas;if(!a)return;for(const l of a){const c=l.bbox,h=l.zoomMin-(i&&l.zoomMin?1:0),d=l.zoomMax-(i&&l.zoomMax?1:0),f=new zi({xmin:c[1],ymin:c[0],xmax:c[3],ymax:c[2],spatialReference:ze.WGS84}),m={extent:ov(f),attribution:o.attribution||"",score:l.score!=null?l.score:100,id:s};for(let y=h;y<=d;y++)n[y]??(n[y]=[]),n[y].push(m)}}return n.maxKey=Math.max.apply(null,Object.keys(n)),n}_getDynamicAttribution(e,i,r){const{extent:n,scale:s}=i;let o=r.tileInfo?.scaleToZoom(s)??0;if(o=Math.min(e.maxKey??0,Math.round(o)),!n||o==null||o<=-1)return"";const a=e[o],l=dM(n.center.clone().normalize(),i.spatialReference),c=new Set;return a?a.filter(h=>{const d=h.id,f=!c.has(d)&&l&&h.extent&&cZ(h.extent,l);return f&&c.add(d),f}).sort((h,d)=>d.score-h.score||h.objectId-d.objectId).map(h=>h.attribution).join(", "):""}};u([p({readOnly:!0,type:Je})],c2.prototype,"items",void 0),u([p({readOnly:!0})],c2.prototype,"state",null),u([p()],c2.prototype,"view",void 0),c2=u([M("esri.widgets.Attribution.AttributionViewModel")],c2);const qMe=c2,Ps={anchor:"esri-widget__anchor",anchorDisabled:"esri-widget__anchor--disabled",button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",disabled:"esri-disabled",disabledElement:"esri-disabled-element",empty:"esri-widget__content--empty",emptyIllustration:"esri-widget__content-illustration--empty",heading:"esri-widget__heading",hidden:"esri-hidden",input:"esri-input",interactive:"esri-interactive",loader:"esri-widget__loader",loaderAnimation:"esri-widget__loader-animation",loaderText:"esri-widget__loader-text",menu:"esri-menu",menuHeader:"esri-menu__header",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuList:"esri-menu__list",noBookmarksIcon:"esri-widget__no-bookmark-icon",panel:"esri-widget--panel",panelHeightOnly:"esri-widget--panel-height-only",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",rotating:"esri-rotating",secondaryTick:"secondary-tick",select:"esri-select",table:"esri-widget__table",widget:"esri-widget",widgetButton:"esri-widget--button",widgetButtonActive:"esri-widget--button-active",widgetDisabled:"esri-widget--disabled"};function Zf(){return function(t,e){if(!t[e])throw new TypeError(`Cannot auto bind undefined function '${String(e)}'`);return{value:ZSt(t[e])}}}function XSt(t){const e=t?.type;return t instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function ZSt(t){return function(e,...i){XSt(e)?gje(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):t.call(this,e,...i)}}function Lm(t){return(e,i)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:i})}}var JSt=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}},WMe=function(t,e){for(var i=0,r=t.length;i<r;i++){var n=t[i];Array.isArray(n)?WMe(n,e):n!=null&&n!==!1&&(n.hasOwnProperty("vnodeSelector")||(n=JSt(n)),e.push(n))}},KSt=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(i.length===1&&typeof i[0]=="string")return{vnodeSelector:t,properties:e||void 0,children:void 0,text:i[0],domNode:null};var n=[];return WMe(i,n),{vnodeSelector:t,properties:e||void 0,children:n,text:void 0,domNode:null}};function Ce(t,e,...i){return typeof t!="function"||Lk(t)?KSt(t,e,...i):t(e,...i)}function EGt(...t){return t}const mS="esri-attribution",Q1={base:mS,poweredBy:`${mS}__powered-by`,sources:`${mS}__sources`,open:`${mS}--open`,sourcesOpen:`${mS}__sources--open`,link:`${mS}__link`,widgetIcon:vn.description};let el=class extends Yp{constructor(e,i){super(e,i),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(r=>r.forEach(({target:n})=>this._checkSourceTextOverflow(n))),this.iconClass=Q1.widgetIcon,this.icon=null,this.itemDelimiter=" | ",this.messages=null,this.viewModel=new qMe}initialize(){this.addHandles(bo(()=>this.viewModel?.items,"change",()=>this.scheduleRender()))}destroy(){this._resizeObserver?.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,i)=>(e.includes(i.text)||e.push(i.text),e),[]).join(this.itemDelimiter)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[Q1.open]:this._isOpen};return Ce("div",{bind:this,class:this.classes(Q1.base,Ps.widget,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return Ce("div",{class:Q1.poweredBy},"Powered by"," ",Ce("a",{class:Q1.link,href:"http://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){const e=this._isOpen,i=this._isInteractive,r=i?0:void 0,{attributionText:n}=this,s={[Q1.sourcesOpen]:e,[Ps.interactive]:i};return Ce("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(Q1.sources,s),innerHTML:n,tabIndex:r})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let i=!1;const{clientHeight:r,clientWidth:n,scrollWidth:s}=e,o=s>n,a=this._attributionTextOverflowed!==o;if(this._attributionTextOverflowed=o,a&&(i=!0),this._isOpen){const l=r<this._prevSourceNodeHeight;this._prevSourceNodeHeight=r,l&&(this._isOpen=!1,i=!0)}i&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};u([p()],el.prototype,"_isOpen",void 0),u([p()],el.prototype,"_isInteractive",null),u([p()],el.prototype,"_attributionTextOverflowed",void 0),u([p()],el.prototype,"_prevSourceNodeHeight",void 0),u([p({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],el.prototype,"attributionText",null),u([p()],el.prototype,"iconClass",void 0),u([p()],el.prototype,"icon",void 0),u([p()],el.prototype,"itemDelimiter",void 0),u([p()],el.prototype,"label",null),u([p(),Lm("esri/widgets/Attribution/t9n/Attribution")],el.prototype,"messages",void 0),u([p()],el.prototype,"view",null),u([p({type:qMe})],el.prototype,"viewModel",void 0),u([Zf()],el.prototype,"_toggleState",null),el=u([M("esri.widgets.Attribution")],el);const QSt=el;function e2t(t){return t?.spatialReference?.isWebMercator||t?.spatialReference?.isGeographic||!1}const t2t=t=>{let e=class extends t{constructor(...i){super(...i),this.goToOverride=null,this.view=null}callGoTo(i){const{view:r}=this;return o6(r),this.goToOverride?this.goToOverride(r,i):r.goTo(i.target,i.options)}};return u([p()],e.prototype,"goToOverride",void 0),u([p()],e.prototype,"view",void 0),e=u([M("esri.widgets.support.GoTo")],e),e},i2t="esri.widgets.CompassViewModel";let qb=class extends t2t(we){constructor(e){super(e),this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this.addHandles(ne(()=>this.view,this._updateRotationWatcher,Xt))}destroy(){this.view=null}get canShowNorth(){return e2t(this.view)}get state(){return!this.view?.ready||this.view.type==="2d"&&!this.view.constraints.rotationEnabled?"disabled":this.canShowNorth?"compass":"rotation"}reset(){if(!this.view?.ready)return;const e={};this.view?.type==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const i=-e.heading;this.orientation={x:0,y:0,z:i}}_updateRotationWatcher(e){this.removeAllHandles(),e&&this.addHandles(e.type==="2d"?ne(()=>e?.rotation,this._updateForRotation,Xt):ne(()=>e?.camera,this._updateForCamera,Xt))}};u([p({readOnly:!0})],qb.prototype,"canShowNorth",null),u([p()],qb.prototype,"orientation",void 0),u([p({readOnly:!0})],qb.prototype,"state",null),u([p()],qb.prototype,"view",void 0),qb=u([M(i2t)],qb);const YMe=qb,ofe="esri-compass",TV={base:ofe,widgetIcon:vn.locateCircled,iconContainer:`${ofe}__icon-container`};let Bf=class extends Yp{constructor(e,i){super(e,i),this.iconClass=TV.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new YMe,this._reset=()=>{this.viewModel.reset()},this._toRotationTransform=r=>({transform:`rotateZ(${r.z}deg)`})}loadDependencies(){return ute({button:()=>ce(()=>import("./calcite-button-30a8bd75.js"),[],import.meta.url),icon:()=>ce(()=>import("./calcite-icon-d39f2d3b.js"),[],import.meta.url)})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:i}=this.viewModel,r=i==="rotation"?"arrow-up":"compass-needle",{messages:n}=this;return Ce("div",{class:this.classes(TV.base,Ps.widget)},Ce("calcite-button",{"aria-label":n.reset,class:Ps.widgetButton,disabled:i==="disabled",kind:"neutral",onclick:this._reset,round:!0,scale:"s",title:n.reset},Ce("div",{"aria-hidden":"true",class:TV.iconContainer,title:n.reset},Ce("calcite-icon",{icon:r,scale:"m",styles:this._toRotationTransform(e)}))))}};u([p()],Bf.prototype,"goToOverride",null),u([p()],Bf.prototype,"iconClass",void 0),u([p()],Bf.prototype,"icon",void 0),u([p()],Bf.prototype,"label",null),u([p(),Lm("esri/widgets/Compass/t9n/Compass")],Bf.prototype,"messages",void 0),u([p()],Bf.prototype,"view",null),u([p({type:YMe})],Bf.prototype,"viewModel",void 0),Bf=u([M("esri.widgets.Compass")],Bf);const r2t=Bf,gS="esri-navigation-toggle",fg={base:gS,widgetIcon:vn.pan2,button:`${gS}__button`,activeButton:`${gS}__button--active`,panButton:`${gS}__button--pan`,rotateButton:`${gS}__button--rotate`,isLayoutHorizontal:`${gS}--horizontal`};let u2=class extends we{constructor(e){super(e),this.navigationMode="pan",this.view=null}initialize(){this.addHandles(gl(()=>this.view?.inputManager,()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){return this.view?.ready&&this.view?.type==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){const e=this.view?.inputManager;e&&(e.primaryDragAction=this.navigationMode==="pan"?"pan":"rotate")}};u([p({readOnly:!0})],u2.prototype,"state",null),u([p()],u2.prototype,"navigationMode",void 0),u([p()],u2.prototype,"view",void 0),u2=u([M("esri.widgets.NavigationToggleViewModel")],u2);const XMe=u2;let Jd=class extends Yp{constructor(e,i){super(e,i),this.iconClass=fg.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new XMe}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}toggle(){return this.viewModel.toggle()}render(){const e=this.viewModel?.state==="disabled",i=this.viewModel?.navigationMode==="pan",r={[Ps.disabled]:e,[fg.isLayoutHorizontal]:this.layout==="horizontal"},n={[fg.activeButton]:i},s={[fg.activeButton]:!i},o=e?-1:0,a=this.messages.toggle;return Ce("div",{"aria-label":a,bind:this,class:this.classes(fg.base,Ps.widget,r),onclick:this._toggle,onkeydown:this._toggle,tabIndex:o,title:a},Ce("div",{class:this.classes(fg.button,Ps.widgetButton,fg.panButton,n)},Ce("span",{class:vn.pan})),Ce("div",{class:this.classes(fg.button,Ps.widgetButton,fg.rotateButton,s)},Ce("span",{class:vn.rotate})))}_toggle(){this.toggle()}};u([p()],Jd.prototype,"iconClass",void 0),u([p()],Jd.prototype,"icon",void 0),u([p()],Jd.prototype,"label",null),u([p({value:"vertical"})],Jd.prototype,"layout",null),u([p(),Lm("esri/widgets/NavigationToggle/t9n/NavigationToggle")],Jd.prototype,"messages",void 0),u([p()],Jd.prototype,"view",null),u([p({type:XMe})],Jd.prototype,"viewModel",void 0),u([Zf()],Jd.prototype,"_toggle",null),Jd=u([M("esri.widgets.NavigationToggle")],Jd);const n2t=Jd,Yo="esri-feature",s2t={base:Yo,container:`${Yo}__size-container`,title:`${Yo}__title`,main:`${Yo}__main-container`,btn:`${Yo}__button`,icon:`${Yo}__icon`,content:`${Yo}__content`,contentNode:`${Yo}__content-node`,contentNodeText:`${Yo}__content-node--text`,contentElement:`${Yo}__content-element`,text:`${Yo}__text`,lastEditedInfo:`${Yo}__last-edited-info`,fields:`${Yo}__fields`,fieldHeader:`${Yo}__field-header`,fieldData:`${Yo}__field-data`,fieldDataDate:`${Yo}__field-data--date`,loadingSpinnerContainer:`${Yo}__loading-container`,spinner:`${Yo}__loading-spinner`};let Lg=class extends Yp{constructor(){super(...arguments),this.enabled=!0,this.iconClass=null,this.icon=null,this.title=""}render(){const e=this.enabled?0:-1,i={[Ps.disabled]:!this.enabled,[Ps.interactive]:this.enabled};return Ce("div",{bind:this,class:this.classes(Ps.widgetButton,Ps.widget,i),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},Ce("span",{"aria-hidden":"true",class:this.classes(s2t.icon,this.iconClass??""),role:"presentation"}),Ce("span",{class:vn.fontFallbackText},this.title))}_triggerAction(){this.action.call(this)}};u([p()],Lg.prototype,"action",void 0),u([p()],Lg.prototype,"enabled",void 0),u([p()],Lg.prototype,"iconClass",void 0),u([p()],Lg.prototype,"icon",void 0),u([p()],Lg.prototype,"title",void 0),u([Zf()],Lg.prototype,"_triggerAction",null),Lg=u([M("esri.widgets.IconButton")],Lg);const afe=Lg;let Wb=class extends we{get canZoomIn(){if(!this.view?.ready)return!1;const i=this.view?.constraints?.effectiveMaxScale;return i===0||this._scale>i}get canZoomOut(){const{view:e}=this;if(!e?.ready)return!1;const r=e.constraints?.effectiveMinScale;return r===0||this._scale<r}get _scale(){const e=this.view?.animation?.target;return(e&&"then"in e?void 0:e?.scale)??this.view?.scale??0}};u([p({readOnly:!0})],Wb.prototype,"canZoomIn",null),u([p({readOnly:!0})],Wb.prototype,"canZoomOut",null),u([p()],Wb.prototype,"view",void 0),u([p()],Wb.prototype,"_scale",null),Wb=u([M("esri.widgets.Zoom.ZoomConditions2D")],Wb);const o2t=Wb;let h2=class extends we{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};u([p({readOnly:!0})],h2.prototype,"canZoomIn",null),u([p({readOnly:!0})],h2.prototype,"canZoomOut",null),u([p()],h2.prototype,"view",void 0),h2=u([M("esri.widgets.Zoom.ZoomConditions3D")],h2);const a2t=h2;let g_=class extends we{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return this._zoomConditions!=null&&this._zoomConditions.canZoomIn}get canZoomOut(){return this._zoomConditions!=null&&this._zoomConditions?.canZoomOut}get state(){return this.view?.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new o2t({view:e}):e.type==="3d"&&(this._zoomConditions=new a2t({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():YR(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():YR(e.goTo({zoomFactor:.5}))}};u([p()],g_.prototype,"_zoomConditions",void 0),u([p()],g_.prototype,"canZoomIn",null),u([p()],g_.prototype,"canZoomOut",null),u([p({readOnly:!0})],g_.prototype,"state",null),u([p()],g_.prototype,"view",null),g_=u([M("esri.widgets.Zoom.ZoomViewModel")],g_);const ZMe=g_,SV={base:"esri-zoom",widgetIcon:vn.zoomInMagnifyingGlass,horizontalLayout:"esri-zoom--horizontal"};let Vf=class extends Yp{constructor(e,i){super(e,i),this.iconClass=SV.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new ZMe}initialize(){this._zoomInButton=new afe({action:this.zoomIn.bind(this),iconClass:vn.plus}),this._zoomOutButton=new afe({action:this.zoomOut.bind(this),iconClass:vn.minus})}destroy(){this._zoomInButton=$e(this._zoomInButton),this._zoomOutButton=$e(this._zoomOutButton)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e=this.viewModel,i={[SV.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:r,canZoomOut:n}=e;this._zoomInButton.enabled=r,this._zoomOutButton.enabled=n;const{zoomIn:s,zoomOut:o}=this.messages;return this._zoomInButton.title=s,this._zoomOutButton.title=o,Ce("div",{class:this.classes(SV.base,Ps.widget,i)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};u([p()],Vf.prototype,"iconClass",void 0),u([p()],Vf.prototype,"icon",void 0),u([p()],Vf.prototype,"label",null),u([p({value:"vertical"})],Vf.prototype,"layout",null),u([p(),Lm("esri/widgets/Zoom/t9n/Zoom")],Vf.prototype,"messages",void 0),u([p()],Vf.prototype,"view",null),u([p({type:ZMe})],Vf.prototype,"viewModel",void 0),Vf=u([M("esri.widgets.Zoom")],Vf);const l2t=Vf;function c2t(t){return t?.view!==void 0}let N4=class extends dTt{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=i=>{this.components.forEach(r=>{const n=this._find(r),s=n?.widget;c2t(s)&&(s.view=i)})},this._componentsWatcher=(i,r)=>{this._removeComponents(r),this._addComponents(i),this._adjustPadding(i)}}initialize(){this.addHandles([ne(()=>this.components,this._componentsWatcher,Xt),ne(()=>this.view,this._updateViewAwareWidgets,Xt)])}_add(e,i,r,n,s){let o=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;o=this._createComponent(e)}super._add(o,i,r,n,s)}_removeComponents(e){e.forEach(i=>{const r=this._find(i);r&&(this.remove(r),r.destroy())})}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:i}=this.padding;this.padding=i}}_addComponents(e){this.constructed&&e.forEach(i=>this.add(this._createComponent(i),this._defaultPositionLookup[i]))}_createComponent(e){const i=this._createWidget(e);return new D4({id:e,node:i})}_createWidget(e){const{view:i}=this;switch(e){case"attribution":return new QSt({view:i});case"compass":return new r2t({view:i});case"navigation-toggle":return new n2t({view:i});case"zoom":return new l2t({view:i})}}};u([p()],N4.prototype,"components",void 0),N4=u([M("esri.views.ui.DefaultUI")],N4);const JMe=N4;let F4=class extends JMe{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};u([p()],F4.prototype,"components",void 0),F4=u([M("esri.views.ui.3d.DefaultUI3D")],F4);const KMe=F4;let He=class extends mGe(Kqe(Mje(yWe))){constructor(t){super(t),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._resolveWhenReady=[],this._propertiesPool=new Ry({slicePlane:Lbe},this),this._resourceController=lgt(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new Zq({view:this}),this.labeler=new Ub({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new YE,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new fw,this.environmentManager=new Bd,this.floors=new Je,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new bWe({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new $mt,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new KMe,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new WOe,jVe(),t?.environment||(this._defaults.environment=new jS,this.environment=this._defaults.environment);const e=(i=null)=>{i!=null&&i.type===cr.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async r=>{try{await r.when()}catch{}this._updatingChanged()}))};this.addHandles([bo(()=>this.map?.allLayers,"after-changes",i=>e(i),{onListenerAdd:()=>e(),onListenerRemove:()=>e(),sync:!0}),this.allLayerViews.on("after-changes",i=>this._updateUpdatingMonitors(i)),ne(()=>this.map,i=>{i&&"load"in i&&i.load&&i.load().catch(()=>{})})]),this.inputManager=new ytt({view:this}),this.stateManager=new vs({view:this})}initialize(){this.groundView=new zqe({view:this}),this._updateUpdatingMonitors();const t=()=>this._updateDefaultToMapOptions();this.addHandles(bo(()=>this.map?.allLayers,"after-changes",t,{onListenerAdd:t,onListenerRemove:t})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)},Xt),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)},Xt),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,e=>ZLe(e>0?1e3/Math.ceil(e):0),Xt),this.updatingHandles.add(()=>this.map?.ground,t,Ji),this.updatingHandles.add(()=>this.map?.ground?.opacity,()=>this._updateDefaultHitTestOptions(),Ji),this.addHandles(ne(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),Zi))}destroy(){this.destroyed||(this.updatingHandles.removeAll(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=$e(this.sharedSymbolResources),this._set("labeler",$e(this.labeler)),this._set("deconflictor",$e(this.deconflictor)),this._resourceController=$e(this._resourceController),this._set("stateManager",$e(this.stateManager)),this._set("inputManager",$e(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",$e(this.environmentManager)),this._set("environment",$e(this.environment)),this.groundView=$e(this.groundView),this._exitBasemapTerrain(),this._stage?.destroy())}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){return this.basemapTerrain?.spatialReference}get animation(){return this.state?.animation}get camera(){return this.stateManager?.camera}set camera(t){this.stateManager&&(this.stateManager.camera=t)}get contentCamera(){return this.stateManager?.contentCamera}set contentCamera(t){this.stateManager&&(this.stateManager.contentCamera=t)}installContentCameraReset(t={sticky:!1}){return this.stateManager.installContentCameraReset(t)}get center(){return this.stateManager?.center}set center(t){this.stateManager&&(this.stateManager.center=t)}get clippingArea(){if(this.viewingMode==="global")return null;const t=this.map;let e=this._userClippingArea||qte(t,"clippingArea");return!this._userClippingArea&&!qte(t,"clippingEnabled")||e==null?(this._clippingArea=null,null):e instanceof zi?this.spatialReference&&(e=vD(e,this.spatialReference),e==null)?(K.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(e=e.clone(),e.intersection(this._groundAndLayersExtent)==null&&(e.xmin=e.xmax,e.ymin=e.ymax),e.zmin=void 0,e.zmax=void 0,e.equals(this._clippingArea)||(this._clippingArea=e),this._clippingArea):(K.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(t){this.ready&&this.viewingMode==="global"&&t!=null?K.getLogger(this).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=t}get renderDataExtent(){if(this.state.viewingMode===Le.Global)return null;const t=this.renderSpatialReference,e=this.dataExtent;return e==null||t==null||e.spatialReference.equals(t)?e:vD(e,t)}get dataExtent(){let t=this._groundAndLayersExtent;const e=this.spatialReference||ze.WGS84,i=vD(this.clippingArea,e);i!=null&&(t=t!=null?t.intersection(i):i);const r=this._get("dataExtent");return t!=null&&t.equals(r)?r:t}get _groundAndLayersExtent(){const t=this.spatialReference||ze.WGS84;let e;const i=s=>{const o=vD(s,t);o!=null&&(e!=null?e.union(o):e=o.clone())},r=this.basemapTerrain;if(r?.spatialReference){const s=r.groundExtent;i(new zi({xmin:s[0],ymin:s[1],zmin:0,xmax:s[2],ymax:s[3],zmax:0,spatialReference:r.spatialReference}))}if(this.map){const s=o=>{o.fullExtent==null||o.type==="graphics"&&o.internal||i(o.fullExtent)};this.map.allLayers.forEach(o=>s(o))}if(e==null)return null;e.hasZ?(e.zmin=Math.min(0,e.zmin??0),e.zmax=Math.max(0,e.zmax??0)):(e.zmin=0,e.zmax=0);const n=this._get("_groundAndLayersExtent");return e.equals(n)?n:e}set environment(t){t!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",t)}castEnvironment(t){return t?t instanceof jS?t:t instanceof kE?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(t):jS.fromWebsceneEnvironment(t):as(jS,t):new jS}get extent(){return this.stateManager?.extent}set extent(t){this.stateManager&&(this.stateManager.extent=t)}get screenCenter(){return this.stateManager?.screenCenter}get frustum(){return this.stateManager?.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||(this.toolViewManager?.interacting??!1)}get stationary(){return!this.animation&&!this.resizing&&(this.state==null||this.state.stationary)}get navigating(){return this.state?.navigating??!1}get padding(){return this.stateManager?.padding}set padding(t){this.stateManager&&(this.stateManager.padding=t)}set qualityProfile(t){w4.isValidProfile(t)&&(w4.apply(t,this.qualitySettings),this._set("qualityProfile",t))}get qualityProfile(){return this._get("qualityProfile")||w4.getDefaultProfile()}set slicePlane(t){if(this._stage!=null&&this._stage.renderer.setParameters({slicePlane:t}),t==null)return void this._set("slicePlane",null);const e=this._propertiesPool.get("slicePlane");Wx(t,e),this._set("slicePlane",e)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?cGe(this.scale,this.spatialReference):0}get scale(){return this.stateManager?.scale}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get heightModelInfo(){const t=this.getDefaultHeightModelInfo();return t!=null?zx.deriveUnitFromSR(t,this.spatialReference):null}get updating(){if(this.destroyed)return!1;let t=0,e=this.layerViewManager.updating,i=e?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(n=>{if(n.isFulfilled()){if(n.updating){if(e=!0,n.suspended||GP(n))return;++i,t+=n.updatingProgress}}else++i});for(const n of this._updatingObjects)n!=null&&n.updating&&(i+=.1,t+=.5*.1);for(const n of this._updatingObjectsWithProgress)n!=null&&n.updating&&(++i,t+=n.updatingProgress);const r=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;if(e=!!(e||i>0||this.updatingHandles.updating||!this.ready||!this.stationary||r||this._createGraphicsViewController||this.inputManager?.updating||this.map?.allLayers?.some(n=>!n.isFulfilled())||this.textures?.updating),e?(this._numUpdating=Math.max(i,this._numUpdating),t+=this._numUpdating-i):this._numUpdating=0,this._numUpdating>0?t/=this._numUpdating:t=e?0:1,this._get("updatingProgress")!==t){const n=performance.now();if(t<1){const s=Math.min((n-this._lastUpdateTime)/2e3,1);t=this.updatingProgress*(1-s)+t*s}this._set("updatingProgress",t),this._lastUpdateTime=e&&t<1?n:0}return e}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){const t=this._predeterminedViewingMode;if(t!=null)return J8(t);const e=this.spatialReference;return e?this.defaultsFromMap?.viewingMode!=null&&e.equals(this.defaultsFromMap.spatialReference)?J8(this.defaultsFromMap.viewingMode):lP(e,Le.Global)?"global":"local":"global"}set viewingMode(t){this.ready?K.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",t)}get viewpoint(){return this.stateManager?.viewpoint}set viewpoint(t){this.stateManager&&(this.stateManager.viewpoint=t)}get zoom(){return this.stateManager.zoom}set zoom(t){this.stateManager&&(this.stateManager.zoom=t)}get resourceController(){return this._resourceController}get quality(){return this._resourceController?.memoryController?.memoryFactor??1}get resolutionScale(){return Math.sqrt(Math.min(1,this.quality/.75))}get performanceInfo(){return new Dgt(this)}on(t,e,i,r){return this.viewEvents.on(t,e,i,r)||super.on(t,e)}hasEventListener(t){return super.hasEventListener(t)||this.viewEvents.hasHandler(t)}toMap(t,e){if(!this.ready)return K.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;const i=e?this.externalToInternalIntersectOptions(e):this._defaultToMapOptions,r=i.graphics!=null&&(i.graphics.include!=null||i.graphics.exclude!=null),n=wse(t)?bse(this,t):t,s=fp(n);i.enableDraped=i.include&&!i.include.has(F_)||i.exclude&&i.exclude.has(F_);const o=this.sceneIntersectionHelper,a=sd(this.state.viewingMode);if(a.options.selectionMode=!0,a.options.store=r?Bo.ALL:Bo.MIN,o.intersectIntersectorScreen(s,a,i),r){for(const l of a.results.all){const c=aY(l,this);if(c==null)return this._intersectResultToMapPoint(l);if(c.type!=="graphic"||this._testGraphicUidFilter(i.graphics,c.graphic))return this._intersectResultToMapPoint(l)}return null}return this._intersectResultToMapPoint(a.results.min)}toScreen(t){if(!this.ready)return K.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;const e=(t.z==null?om(this.elevationProvider,t):null)??0;return Wc(t,yS,this.renderSpatialReference,e),this.state.camera.projectToScreen(yS,EV),ed(EV[0],EV[1])}pixelSizeAt(t){return this.ready?t?(Wc(t,yS,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(yS)):0:(K.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(t){const e=this.basemapTerrain.overlayManager;return e?e.overlayPixelSizeInMapUnits(t,()=>this.pixelSizeAt(t)):1}hitTest(t,e){if(!this.ready)return K.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;const i=wse(t)?bse(this,t):t,r=cn(i.x,i.y),n=e?this.externalToInternalIntersectOptions(e):this._defaultHitTestOptions;n.requiresGroundFeedback=!0,n.enableDraped=!0;const s=sd(this.state.viewingMode);s.options.selectionMode=!0,s.options.store=Bo.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(r,s,n);const o=this._intersectResultsToHits(s.results.all,n.graphics),a=s.results.ground,l=zpe(a,this),c=l!=null&&"type"in l&&l.type==="integrated-mesh"?l:null,h={screenPoint:i,results:o,ground:{mapPoint:this._intersectResultToMapPoint(a),distance:Gp(a)?a.distanceInRenderSpace:0,layer:c}};return pr.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(h.intersector=s),Promise.resolve(h)}async popupHitTest(t){const{results:e,ground:i}=await qxt(this,t);let r=null;return!(e.length===0||Math.abs((e[0].distance??0)-i.distance)<1e-5)||i.layer&&i.layer.type==="integrated-mesh"||(r=i.mapPoint),{results:e,screenPoint:t,mapPoint:r}}goTo(t,e){return this.updatingHandles.addPromise(this.stateManager.goTo(t,e))}async whenAnalysisView(t){if(t.parent==null)throw new G("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:t});switch(t.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(t.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(t)}}whenLayerView(t){return super.whenLayerView(t)}async takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(e);return mV(i,e,this._pixelFormat())}async _takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(e);return gV(i,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(t){const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshotWithOID(e);return[gV(i[0],this._pixelFormat()),gV(i[1],this._pixelFormat())]}_completeSettings(t){const e=Ext(t,this);return e.pixelRatio/=this.state.pixelRatio,Rxt(e,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:t=>this._takeScreenshot(t),takeScreenshotWithObjectAndLayerId:t=>this._takeScreenshotWithObjectAndLayerId(t)}}async takeScreenshotWithObjectAndLayerId(t){if(!ie("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshotWithOID(e),r=mV(i[0],e,this._pixelFormat()),n=this._completeSettings(t);return n.format="png",[r,mV(i[1],n,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(this._stage.renderView.objectAndLayerIdRenderHelper==null)throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(t){return this.updatingHandles.addPromise(t)}importLayerView(t){return Ose.importLayerView(t)}hasLayerViewModule(t){return Ose.hasLayerViewModule(t)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){return this.map&&"initialViewProperties"in this.map&&this.map.initialViewProperties?.spatialReference||this.defaultsFromMap?.spatialReference||this.defaultsFromMap?.ready&&this._initialDefaultSpatialReference||null}async validate(){let t=iTt(this.type);const e=ie("safari");if(e&&e<9&&(t=new G("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:e})),t!=null)throw K.getLogger(this).warn("#validate()",t.message),t}get _predeterminedViewingMode(){const t=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties?.viewingMode:null)??null;return t!=null?cre(t):null}getSpatialReferenceSupport({spatialReference:t,layer:e}){const i=this._predeterminedViewingMode;if(i!=null)return this._validateSpatialReferenceForViewingMode(t,e,i)?{constraints:this._makeSpatialReferenceConstraints(t,e,i)}:null;const r=this._validateSpatialReferenceForViewingMode(t,e,Le.Local),n=this._validateSpatialReferenceForViewingMode(t,e,Le.Global);return r||n?r&&n?{constraints:this._makeSpatialReferenceConstraints(t,e,null)}:r?{constraints:this._makeSpatialReferenceConstraints(t,e,Le.Local)}:{constraints:this._makeSpatialReferenceConstraints(t,e,Le.Global)}:null}_validateSpatialReferenceForViewingMode(t,e,i){return!!lP(t,i)&&(e==null||!!Nie(e)||(!HO(e)||d8(e,t,i)!=null)&&(!Die(e)||i!==Le.Global))}_makeSpatialReferenceConstraints(t,e,i){if(e==null)return[{spatialReference:t,viewingMode:i}];const r=t.isWebMercator,n=t.isWGS84;return Nie(e)&&(r||n)?!n||i===Le.Local||Pee(e.tileInfo,e.fullExtent,t,Le.Global)===null?[{spatialReference:t,viewingMode:i},{spatialReference:ze.WebMercator,viewingMode:i}]:[{spatialReference:r?ze.WGS84:ze.WebMercator,viewingMode:i}]:HO(e)||Die(e)||!r&&!n?HO(e)&&r&&i!==Le.Global?[{spatialReference:t,viewingMode:i},{spatialReference:ze.WGS84,viewingMode:Le.Local}]:[{spatialReference:t,viewingMode:i}]:[{spatialReference:t,viewingMode:i},{spatialReference:r?ze.WGS84:ze.WebMercator,viewingMode:i}]}_validateSpatialReference(t){const e=this.getSpatialReferenceSupport({spatialReference:t})!=null,i=this._predeterminedViewingMode;return e||(i!=null?K.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${J8(i)} viewing mode.`):t.isGeographic&&K.getLogger(this).warnOnce("Spatial reference is geographic but not supported.")),e}whenReady(){return new Promise(t=>{this.ready?t(this):this._resolveWhenReady.push(t)})}computeMapPointFromVec3d(t,e){let i=this.spatialReference||ze.WGS84;return ua(t,this.renderSpatialReference,t,i)||(i=ze.WGS84,ua(t,this.renderSpatialReference,t,i)),e?(e.x=t[0],e.y=t[1],e.z=t[2],e.spatialReference=i):e=new ut(t,i),e}trackGraphicState(t){if(!t.graphic)return K.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const e=this.getViewForGraphic(t.graphic);let i=null,r=!1;const n=s=>{!r&&s!=null&&"processor"in s&&s.processor?.type==="graphics-3d"&&s.processor.graphicsCore&&(i=s.processor.graphicsCore.trackGraphicState(t))};return e!=null?n(e):this.whenViewForGraphic(t.graphic,{waitForLayer:!0}).then(s=>n(s),()=>{}).catch(()=>{}),Vi(()=>{r=!0,i!=null&&(i.remove(),i=null)})}highlight(t){if(Array.isArray(t))return yv(t.map(i=>this.highlight(i)));if(Je.isCollection(t))return yv(t.toArray().map(i=>this.highlight(i)));const e=this.getViewForGraphic(t);return e&&"highlight"in e?e.highlight(t):Vi()}maskOccludee(t){if(!t)return K.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const e=this.getViewForGraphic(t);let i=null,r=!1;const n=s=>{!r&&s!=null&&Yxt(s)&&(i=s.maskOccludee(t))};return e!=null?n(e):this.whenViewForGraphic(t,{waitForLayer:!0}).then(s=>n(s),()=>{}).catch(()=>{}),Vi(()=>{r=!0,i!=null&&(i.remove(),i=null)})}getViewForGraphic(t){return t.layer===this.graphics?this.graphicsView:t.layer?this.allLayerViews.find(e=>e.layer===t.layer):null}graphicChanged(t){this.graphicsView!=null&&this.graphicsView.graphicChanged(t)}async whenViewForGraphic(t,e){if(t.layer===this)return await Tv(()=>this.graphicsView),this.graphicsView;if(!t.layer||!this.map)throw new G("no-view-for-graphic");return e&&e.waitForLayer&&!this.map.allLayers.includes(t.layer)?new Promise((i,r)=>{const n=this.map.allLayers.on("change",s=>{s.added.includes(t.layer)&&(n.remove(),this.whenLayerView(t.layer).then(i,r))})}):this.whenLayerView(t.layer)}externalToInternalIntersectOptions(t){const e=this._externalToInternalRenderItems(t.include,FR.INCLUDE),i=this._externalToInternalRenderItems(t.exclude,FR.EXCLUDE);return{include:e.layerUids,exclude:i.layerUids,graphics:{include:e.graphicUids,exclude:i.graphicUids}}}_intersectResultToMapPoint(t,e){return t.getIntersectionPoint(yS)?(e=this.computeMapPointFromVec3d(yS,e),t.intersector===Jr.TERRAIN&&this.basemapTerrain&&(e.z=om(this.basemapTerrain,e)??0),e):null}_intersectResultsToHits(t,e){const i=new Array;let r=null;for(let n=0;n<t.length;n++){const s=t[n],o=zpe(s,this);if(o!=null&&(o===this.map.ground||"type"in o&&o.type==="integrated-mesh"))break;const a=aY(s,this);if(a==null)continue;if(a.type==="graphic"){if(r==null&&n!==t.length-1&&(r=new Set),r!=null){const h=this._getGraphicFilterUid(a.graphic);if(r.has(h))continue;r.add(h)}if(!this._testGraphicUidFilter(e,a.graphic))continue}const l=this._intersectResultToMapPoint(s),c=s.distanceInRenderSpace;if(a.type==="media"){const h=a.element.toSource(l);i.push({...a,mapPoint:l,distance:c,sourcePoint:h})}else i.push({...a,mapPoint:l,distance:c})}return i}_getGraphicFilterUid(t){const e=t.sourceLayer,i=t.layer,r=e&&"objectIdField"in e?e:i&&"objectIdField"in i?i:e;if(r){const n=r.objectIdField??pGe,s=t.attributes?.[n];if(s)return`o-${r.id}-${s}`}return`u-${t.uid}`}_testGraphicUidFilter(t,e){const i=this._getGraphicFilterUid(e);return t==null||(t.include==null||t.include.has(i))&&(t.exclude==null||!t.exclude.has(i))}_externalToInternalRenderItems(t,e,i={layerUids:void 0,graphicUids:void 0}){if(!t)return i;if(t instanceof vx)u2t(i,this._getGraphicFilterUid(t)),e===FR.INCLUDE&&(this.graphicsView!=null&&t.layer===this?ZA(i,this.graphicsView.processor.layer.id):t.layer&&ZA(i,t.layer.uid));else if(e7(t))for(const r of t)r===this.graphics&&this.graphicsView!=null?ZA(i,this.graphicsView.processor.layer.id):r===this.map.ground?ZA(i,F_):this._externalToInternalRenderItems(r,e,i);else"uid"in t&&ZA(i,t.uid);return i}_initBasemapTerrain(){this._set("basemapTerrain",new vvt({view:this})),this._set("elevationProvider",new fO({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new Fl({view:this})),this._set("featureTiles",new Lo({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const t=()=>{const e=this.basemapTerrain?.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const i=this.basemapTerrain.extent!=null&&this.basemapTerrain.spatialReference!=null?Bm(M6(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;this.clippingArea!=null?this.featureTiles.filterExtent=this.clippingArea.intersection(i):this.featureTiles.filterExtent=i}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add(()=>pr.FEATURE_TILE_TREE_SHOW_TILES,e=>{e&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(ce(()=>import("./FeatureTileTree3DDebugger-70e27b55.js"),["./FeatureTileTree3DDebugger-70e27b55.js","./TileTreeDebugger-e948c757.js"],import.meta.url)).then(({FeatureTileTree3DDebugger:i})=>{!this._featureTreeDebugger&&pr.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new i({view:this}))}):e||!this._featureTreeDebugger||pr.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},Ji),this.updatingHandles.add(()=>this.clippingArea,t,Ji),this.updatingHandles.add(()=>this.basemapTerrain.extent,t,Ji)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const t=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(t)||this._set("mapCoordsHelper",new Gmt(this.map,t));const e=this.state.isGlobal,i=lGe(e,t);i!==this.renderSpatialReference&&(this._set("renderCoordsHelper",Wmt.create(this.state.viewingMode,i)),e||this.addHandles(ne(()=>this.basemapTerrain?.extent,r=>{const n=this.renderCoordsHelper.spatialReference;r==null||r[0]===0&&r[1]===0&&r[2]===0&&r[3]===0||!K6(r,this.basemapTerrain.spatialReference,lfe,n)||(this.renderCoordsHelper.extent=lfe)},Zi),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(JE/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(t=null){t!=null&&t.type===cr.MOVE||(this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(e=>{e.destroyed||(this.addHandles(ne(()=>[e.updating,e.updatingProgress],()=>this._updatingChanged(),Zi),"updatingMonitors"),e.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(t,e,i){if(!this.overlay||!this.overlay.hasVisibleItems)return i;const r=t.getContext("2d");return r.putImageData(i,0,0),this.overlay.renderCanvas(t,{disableDecorations:e===Uc.OFF}),r.getImageData(0,0,i.width,i.height)}_initStage(){const t={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(r,n,s)=>this._renderScreenshotOverlay(r,n,s)}},e=new Imt(this.state.viewingMode,r=>this._stage.layers.forAll(r),this);this._set("sceneIntersectionHelper",e);const i=J6(this.surface);this._stage=new fu({view:this,options:t,container:i}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,r=>this._stage.renderer.setParameters({highQualityTransparency:r}),Xt),ne(()=>this.magnifier,r=>this._stage.renderView.magnifier=r,Ji),this.on("pointer-move",()=>this._stage?.renderer.resetAnimation()),oy(this._stage.renderView.canvas,"webglcontextlost",r=>this.fatalError=new G("webgl-context-lost",r.statusMessage))],"stage"),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(JE/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=$e(this._stage),this.removeHandles("stage"),this._set("canvas",null)}_initSurface(t){this._exitSurface(),this.state.init(t,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new kgt({view:this,viewingMode:t,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.removeHandles("graphics-view"),this._createGraphicsViewController=new AbortController;const t=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(t,t),this._updatingChanged()}async _createGraphicsViewAsync(t){const e=(await ce(()=>import("./GraphicsView3D-6d8917d9.js"),["./GraphicsView3D-6d8917d9.js","./GraphicsProcessor-25439ae2.js","./Graphics3DObjectStates-d17b3cec.js","./rendererConversion-f2d7d312.js","./optimizedFeatureQueryEngineAdapter-68a83ac4.js","./PooledRBush-a82b8470.js","./quickselect-cd6fa001.js","./popupUtils-85d853d6.js"],import.meta.url)).default;Tt(t),await Tv(()=>this.basemapTerrain?.ready,t),this._set("graphicsView",new e({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.removeHandles("graphics-view"),this.graphicsView!=null&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const t=cre(this.viewingMode);if(t===Le.Global&&(this._clippingArea=null),this._initSurface(t),this._set("ready",!0),this.addHandles(bo(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const{map:i}=this,r=i&&"initialViewProperties"in i?i.initialViewProperties?.environment:void 0;r&&(this.environment=r)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect(),this._set("textures",new k2(this._stage,this.resourceController.scheduler));const e=this._resolveWhenReady;this._resolveWhenReady=[],e.forEach(i=>i(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.removeHandles("graphics-view"),this._set("textures",$e(this.textures)),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(F_);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(t.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(F_);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&t.opacity<1&&this._defaultHitTestOptions.exclude.add(t.uid)}}};function ZA(t,e){t.layerUids||(t.layerUids=new Set),t.layerUids.add(e)}function u2t(t,e){t.graphicUids||(t.graphicUids=new Set),t.graphicUids.add(e)}function vD(t,e){return t!=null&&$p(t.spatialReference,e)?Bm(t,e):null}var FR;He.type="3d",u([p()],He.prototype,"_userClippingArea",void 0),u([p()],He.prototype,"_resourceController",void 0),u([p()],He.prototype,"_stage",void 0),u([p({readOnly:!0})],He.prototype,"deconflictor",void 0),u([p({readOnly:!0})],He.prototype,"labeler",void 0),u([p(Jj(YE,"analyses"))],He.prototype,"analyses",void 0),u([p({type:QE,readOnly:!0})],He.prototype,"animation",null),u([p({readOnly:!0})],He.prototype,"basemapTerrain",void 0),u([p({readOnly:!0})],He.prototype,"elevationProvider",void 0),u([p()],He.prototype,"camera",null),u([p({type:eh})],He.prototype,"contentCamera",null),u([p({readOnly:!0})],He.prototype,"canvas",void 0),u([p({type:ut})],He.prototype,"center",null),u([p({type:zi})],He.prototype,"clippingArea",null),u([p({type:fw})],He.prototype,"constraints",void 0),u([p({type:zi,readOnly:!0})],He.prototype,"renderDataExtent",null),u([p({type:zi,readOnly:!0})],He.prototype,"dataExtent",null),u([p({type:zi,readOnly:!0})],He.prototype,"_groundAndLayersExtent",null),u([p({value:null,type:jS})],He.prototype,"environment",null),u([ai("environment")],He.prototype,"castEnvironment",null),u([p({readOnly:!0})],He.prototype,"environmentManager",void 0),u([p({type:zi})],He.prototype,"extent",null),u([p()],He.prototype,"floors",void 0),u([p()],He.prototype,"screenCenter",null),u([p()],He.prototype,"frustum",null),u([p({type:Number,readOnly:!0})],He.prototype,"fullOpacity",void 0),u([p({readOnly:!0})],He.prototype,"graphicsView",void 0),u([p({readOnly:!0})],He.prototype,"analysisViewManager",void 0),u([p()],He.prototype,"groundView",void 0),u([p({type:Boolean})],He.prototype,"initialExtentRequired",null),u([p()],He.prototype,"_defaultsFromMapSettings",null),u([p()],He.prototype,"interacting",null),u([p()],He.prototype,"stationary",null),u([p()],He.prototype,"navigating",null),u([p()],He.prototype,"map",void 0),u([p({readOnly:!0})],He.prototype,"mapCoordsHelper",void 0),u([p()],He.prototype,"padding",null),u([p({type:Fl,readOnly:!0})],He.prototype,"pointsOfInterest",void 0),u([p({type:Lo,readOnly:!0})],He.prototype,"featureTiles",void 0),u([p()],He.prototype,"_featureTreeDebugger",void 0),u([p({type:Boolean})],He.prototype,"screenSizePerspectiveEnabled",void 0),u([p({constructOnly:!0})],He.prototype,"deactivatedWebGLExtensions",void 0),u([p({constructOnly:!0})],He.prototype,"debugWebGLExtensions",void 0),u([p({constructOnly:!0})],He.prototype,"renderCanvas",void 0),u([p({constructOnly:!0})],He.prototype,"state",void 0),u([p({readOnly:!0})],He.prototype,"inputManager",void 0),u([p({readOnly:!0})],He.prototype,"stateManager",void 0),u([p({type:["low","medium","high"]})],He.prototype,"qualityProfile",null),u([p({type:Mue,get(){let t=this._get("qualitySettings");return t||(t=new Mue,w4.apply(this.qualityProfile,t)),t}})],He.prototype,"qualitySettings",void 0),u([p()],He.prototype,"slicePlane",null),u([p({readOnly:!0})],He.prototype,"typeSpecificPreconditionsReady",null),u([p({readOnly:!0})],He.prototype,"renderCoordsHelper",void 0),u([p({readOnly:!0})],He.prototype,"sceneIntersectionHelper",void 0),u([p({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],He.prototype,"resolution",null),u([p({type:Number})],He.prototype,"scale",null),u([p()],He.prototype,"heightModelInfo",null),u([p()],He.prototype,"spatialReference",void 0),u([p({type:Boolean,constructOnly:!0})],He.prototype,"alphaCompositingEnabled",void 0),u([p({constructOnly:!0})],He.prototype,"preserveDrawingBufferEnabled",void 0),u([p({type:Boolean})],He.prototype,"supersampleScreenshotsEnabled",void 0),u([p({readOnly:!0})],He.prototype,"type",void 0),u([p(),ai(t=>t instanceof JMe?t:nx(KMe,t))],He.prototype,"ui",void 0),u([p({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.updating","toolViewManager.updating","analysisViewManager.updating","state.updating","textures.updating"]})],He.prototype,"updating",null),u([p()],He.prototype,"_updatingObjects",null),u([p()],He.prototype,"_updatingObjectsWithProgress",null),u([p({type:Number,readOnly:!0,dependsOn:["updating"]})],He.prototype,"updatingProgress",void 0),u([p({type:["global","local"]})],He.prototype,"viewingMode",null),u([p({type:qc})],He.prototype,"viewpoint",null),u([p({type:Number})],He.prototype,"zoom",null),u([p({type:WOe})],He.prototype,"highlightOptions",void 0),u([p({readOnly:!0})],He.prototype,"quality",null),u([p({readOnly:!0})],He.prototype,"resolutionScale",null),u([p()],He.prototype,"textures",void 0),He=u([M("esri.views.SceneView")],He),function(t){t[t.INCLUDE=0]="INCLUDE",t[t.EXCLUDE=1]="EXCLUDE"}(FR||(FR={}));const yS=E(),EV=cn(),lfe=Zt(),h2t=He;function d2t(t){return e=>{e.hasOwnProperty("_delegatedEventNames")||(e._delegatedEventNames=e._delegatedEventNames?e._delegatedEventNames.slice():[]);const i=e._delegatedEventNames,r=Array.isArray(t)?t:p2t(t);i.push(...r)}}function p2t(t){return t.split(",").map(e=>e.trim())}function fE(t){return t&&typeof t.render=="function"}function f2t(t){return t&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}let y_=class extends we{constructor(e){super(e),this._viewpointHandle=null,this.group=null}initialize(){this.addHandles(bo(()=>this.view?.ui,"expand",e=>{const{target:i}=e;i&&i!==this&&i.expanded&&i.group&&i.group===this.group&&this._collapse()}))}destroy(){this._viewpointHandle=null,this.view=null}set autoCollapse(e){this._set("autoCollapse",e),this._watchViewpoint()}set expanded(e){const i=!!e;this._set("expanded",i);const r=this.view?.ui;r&&r.emit("expand",{target:this}),this._viewpointHandleChange(i)}get state(){return this.view?.ready?"ready":"disabled"}set view(e){this._get("view")!==e&&(this._set("view",e),e&&gl(()=>e.ready,()=>{this.view===e&&this._watchViewpoint()},{once:!0,initial:!0}))}_viewpointHandleChange(e){this._viewpointHandle&&(e?gl(()=>this.view?.stationary,()=>this._viewpointHandle?.resume(),{once:!0,initial:!0}):this._viewpointHandle.pause())}_watchViewpoint(){const e="viewpoint";this.removeHandles(e),this._viewpointHandle=null;const{autoCollapse:i,view:r}=this;if(!r||!i)return;const n=l6e(()=>r.type==="3d"?r.camera:r.viewpoint,()=>this._collapse());this.addHandles(n,e),this._viewpointHandle=n}_collapse(){this.expanded=!1}};u([p({value:!1})],y_.prototype,"autoCollapse",null),u([p({value:!1})],y_.prototype,"expanded",null),u([p()],y_.prototype,"group",void 0),u([p({readOnly:!0})],y_.prototype,"state",null),u([p({value:null})],y_.prototype,"view",null),y_=u([M("esri.widgets.Expand.ExpandViewModel")],y_);const QMe=y_,pc="esri-expand",Ga={base:pc,modeAuto:`${pc}--auto`,modeDrawer:`${pc}--drawer`,modeFloating:`${pc}--floating`,container:`${pc}__container`,containerExpanded:`${pc}__container--expanded`,panel:`${pc}__panel`,icon:"esri-collapse__icon",iconExpanded:`${pc}__icon--expanded`,iconNumber:`${pc}__icon-number`,iconNumberExpanded:`${pc}__icon-number--expanded`,content:`${pc}__content`,contentExpanded:`${pc}__content--expanded`,expandMask:`${pc}__mask`,expandMaskExpanded:`${pc}__mask--expanded`};let An=class extends Yp{constructor(e,i){super(e,i),this.closeOnEsc=!0,this.collapseIcon=null,this.collapseTooltip="",this.content="",this.expandTooltip="",this.iconClass=null,this.icon=null,this.iconNumber=0,this.messages=null,this.messagesCommon=null,this.mode="auto",this.viewModel=new QMe,this._handleKeyDown=r=>{const{closeOnEsc:n,_toggleButtonEl:s,expanded:o}=this;!o||!n||r.target===s||r.key!=="Escape"||(typeof n=="function"?n(r):n)&&(this.expanded=!1,s?.focus())}}loadDependencies(){return ute({icon:()=>ce(()=>import("./calcite-icon-d39f2d3b.js"),[],import.meta.url)})}get contentId(){return`${this.id}_controls_content`}get expandTitle(){const{expanded:e,messagesCommon:i,collapseTooltip:r,expandTooltip:n}=this;return(e?r||i?.collapse:n||i?.expand)??""}get autoCollapse(){return this.viewModel.autoCollapse}set autoCollapse(e){this.viewModel.autoCollapse=e}get collapseIconClass(){return vn.collapse}set collapseIconClass(e){this._overrideIfSome("collapseIconClass",e)}get expanded(){return this.viewModel.expanded}set expanded(e){this.viewModel.expanded=e}get expandIconClass(){return fE(this.content)?this.content.iconClass:vn.expand}set expandIconClass(e){this._overrideIfSome("expandIconClass",e)}get expandIcon(){return fE(this.content)?this.content.icon:void 0}set expandIcon(e){this._overrideIfSome("expandIcon",e)}get group(){return this.viewModel.group}set group(e){this.viewModel.group=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}expand(){this.viewModel.expanded=!0}collapse(){this.viewModel.expanded=!1}toggle(){this.viewModel.expanded=!this.viewModel.expanded}render(){const{mode:e}=this,i={[Ga.modeAuto]:e==="auto",[Ga.modeDrawer]:e==="drawer",[Ga.modeFloating]:e==="floating"};return Ce("div",{class:this.classes(Ga.base,Ps.widget,i),onkeydown:this._handleKeyDown},this._renderMask(),this._renderContainer())}_renderContainer(){const{expanded:e}=this,i={[Ga.containerExpanded]:e};return Ce("div",{class:this.classes(Ga.container,i)},this._renderPanel(),this._renderContent())}_renderMask(){const{expanded:e}=this,i={[Ga.expandMaskExpanded]:e};return Ce("div",{bind:this,class:this.classes(Ga.expandMask,i),onclick:this._toggle})}_renderBadgeNumber(){const{expanded:e,iconNumber:i}=this;return i&&!e?Ce("span",{class:Ga.iconNumber,key:"expand__icon-number"},i):null}_renderPanelNumber(){const{iconNumber:e,expanded:i}=this;return e&&i?Ce("span",{class:this.classes(Ga.iconNumber,Ga.iconNumberExpanded),key:"expand__expand-icon-number"},e):null}_renderIcon(){const e=(this.expanded?this.collapseIcon:this.expandIcon)??"";return Ce("calcite-icon",{icon:e,key:"icon",scale:"s"})}_renderLegacyIcon(){const{collapseIconClass:e,expandIconClass:i,expanded:r}=this,n={[Ga.iconExpanded]:r};return i!=null&&(n[i]=!r),e!=null&&(n[e]=e===i||r),Ce("span",{"aria-hidden":"true",class:this.classes(Ga.icon,n),key:"legacy-icon"})}_renderTitle(){return Ce("span",{class:vn.fontFallbackText},this.expandTitle)}_renderExpandButton(){const{expanded:e,expandTitle:i,expandIcon:r,collapseIcon:n,contentId:s}=this;return Ce("div",{afterCreate:this._storeToggleButtonEl,"aria-controls":s,"aria-expanded":e?"true":"false",bind:this,class:Ps.widgetButton,onclick:this._toggle,onkeydown:this._toggle,role:"button",tabIndex:0,title:i},this._renderBadgeNumber(),!e&&r!=null||e&&n!=null?this._renderIcon():this._renderLegacyIcon(),this._renderTitle())}_renderPanel(){return Ce("div",{class:Ga.panel},this._renderExpandButton(),this._renderPanelNumber())}_renderContent(){const{expanded:e,contentId:i,content:r}=this,n={[Ga.contentExpanded]:e},s={id:i,role:"region",class:this.classes(Ga.content,n)};return typeof r=="string"?Ce("div",{innerHTML:r,key:"content__string",...s}):fE(r)?Ce("div",{key:"content__widget",...s},r.render()):r instanceof HTMLElement?Ce("div",{afterCreate:this._attachToNode,bind:r,key:"content__html-element",...s}):f2t(r)?Ce("div",{afterCreate:this._attachToNode,bind:r.domNode,key:"content__node",...s}):null}_toggle(){this.toggle()}_attachToNode(e){const i=this;e.appendChild(i)}_storeToggleButtonEl(e){this._toggleButtonEl=e}};u([p({readOnly:!0})],An.prototype,"contentId",null),u([p({readOnly:!0})],An.prototype,"expandTitle",null),u([p()],An.prototype,"autoCollapse",null),u([p()],An.prototype,"closeOnEsc",void 0),u([p()],An.prototype,"collapseIconClass",null),u([p()],An.prototype,"collapseIcon",void 0),u([p()],An.prototype,"collapseTooltip",void 0),u([p()],An.prototype,"content",void 0),u([p()],An.prototype,"expanded",null),u([p()],An.prototype,"expandIconClass",null),u([p()],An.prototype,"expandIcon",null),u([p()],An.prototype,"expandTooltip",void 0),u([p()],An.prototype,"group",null),u([p()],An.prototype,"iconClass",void 0),u([p()],An.prototype,"icon",void 0),u([p()],An.prototype,"iconNumber",void 0),u([p()],An.prototype,"label",null),u([p(),Lm("esri/widgets/Expand/t9n/Expand")],An.prototype,"messages",void 0),u([p(),Lm("esri/t9n/common")],An.prototype,"messagesCommon",void 0),u([p()],An.prototype,"mode",void 0),u([p()],An.prototype,"view",null),u([p({type:QMe})],An.prototype,"viewModel",void 0),u([Zf()],An.prototype,"_toggle",null),An=u([M("esri.widgets.Expand")],An);const m2t=An;var pY;let __=pY=class extends CM{constructor(t){super(t),this.displayValueEnabled=!1,this.max=1,this.min=0,this.step=.1,this.type="slider",this.value=null}clone(){return new pY({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,displayValueEnabled:this.displayValueEnabled,max:this.max,min:this.min,step:this.step,value:this.value})}};u([p()],__.prototype,"displayValueEnabled",void 0),u([p()],__.prototype,"max",void 0),u([p()],__.prototype,"min",void 0),u([p()],__.prototype,"step",void 0),u([p()],__.prototype,"value",void 0),__=pY=u([M("esri.support.Action.ActionSlider")],__);const g2t=__,e$e={hide:"hide",hideChildren:"hide-children"};function Dk(t){if(t)return t.listMode!=null?t.listMode:void 0}function y2t(t){return t!=null&&"minScale"in t&&t.minScale!=null?t.minScale:void 0}function _2t(t){return t!=null&&"maxScale"in t&&t.maxScale!=null?t.maxScale:void 0}function v2t(t){if(!t)return"inherited";const e=E2t(hte(t)?t.layer:t);return e!=null?e?"independent":"inherited":"visibilityMode"in t&&t.visibilityMode!=null?t.visibilityMode:"independent"}function t$e(t){if(t&&(!("type"in t)||t.type!=="wmts")&&t.listMode!==e$e.hideChildren)return"sublayers"in t?"sublayers":"layers"in t?"layers":void 0}function b2t(t){const e=(t?.layer&&hte(t.layer)?t.layer.layer:void 0)??t?.layer;return!!e&&(C2t(e)??!0)}function w2t(t){return Dk(t)!==e$e.hide}function x2t(t,e){if(!t||e==null||isNaN(e))return!1;const i=y2t(t),r=_2t(t),n=i!=null&&!isNaN(i)&&i>0&&e>i,s=r!=null&&!isNaN(r)&&r>0&&e<r;return n||s}function i$e(t,e){t?.sort((i,r)=>{const n="uid"in i?e.indexOf(i.uid):-1,s="uid"in r?e.indexOf(r.uid):-1;return n>s?-1:n<s?1:0})}function T2t(t,e){const i=t?.layer;if(!i)return;const r=t$e(i);if(!r)return;let n;r==="layers"&&"layers"in i?n=i.layers:r==="sublayers"&&"sublayers"in i&&(n=i.sublayers),i$e(n,e)}function cfe(t){const e=t?.layer;return e&&"layers"in e?e.layers:null}function CV(t,e){const i=t.layer?.uid;return i!=null?e.find(r=>r.layer?.uid===i):null}function S2t(t){const e=hte(t)?t:null,i=t?.parent,r=i!=null&&"type"in i&&i.type==="map-image"?e?.source:null,n="";return r&&i?{layer:i,title:n,sublayerIds:[r.mapLayerId]}:{layer:t,title:n}}function hte(t){return t!=null&&"layer"in t&&t.layer!=null}function E2t(t){const e=r$e(t);return e!=null&&"supportsSublayerVisibility"in e?e.supportsSublayerVisibility:void 0}function C2t(t){const e=r$e(t);return e!=null&&"supportsDynamicLayers"in e?e.supportsDynamicLayers:void 0}function r$e(t){return t&&"capabilities"in t&&t.capabilities!=null&&"exportMap"in t.capabilities?t.capabilities.exportMap:void 0}const n$e="esri-layer-list-panel",JA=`${n$e}__content`,mg={base:n$e,content:JA,contentLegend:`${JA}--legend`,contentString:`${JA}--string`,contentElement:`${JA}--html-element`,contentWidget:`${JA}--widget`},A2t="legends";let Ch=class extends vM(Yp){constructor(e,i){super(e,i),this._legend=null,this.content=null,this.image=null,this.listItem=null,this.open=!1,this.visible=!0}initialize(){this.addHandles(ne(()=>this.content,e=>this._createLegend(e),Xt))}destroy(){this._legend=$e(this._legend)}get className(){const{image:e}=this,i=this._getFirstWidget();return this._get("className")||(!e&&i?i.iconClass??"":"")}set className(e){this._override("className",e)}get disabled(){const{listItem:e,_legend:i,content:r}=this;return!e||!(Array.isArray(r)&&r.length>1)&&!!i&&(!i.activeLayerInfos?.length||!e.visibleAtCurrentScale||!e.visible)}set disabled(e){this._overrideIfSome("disabled",e)}get title(){const e=this._getFirstWidget();return this._get("title")||(e?.label??"")}set title(e){this._override("title",e)}render(){return Ce("div",{class:mg.base},this._renderContents())}_renderContent(e){const{_legend:i,disabled:r}=this;return!e||r?null:e==="legend"&&i?Ce("div",{class:this.classes(mg.content,mg.contentLegend),key:i},i.render()):typeof e=="string"?Ce("div",{class:this.classes(mg.content,mg.contentString),innerHTML:e,key:e}):fE(e)?Ce("div",{class:this.classes(mg.content,mg.contentWidget),key:e},e.render()):e instanceof HTMLElement?Ce("div",{afterCreate:this._attachToNode,bind:e,class:this.classes(mg.content,mg.contentElement),key:e}):null}_renderContents(){const{content:e}=this;return Array.isArray(e)?e.map(i=>this._renderContent(i)):this._renderContent(e)}_getLegendOptions(){const{listItem:e}=this;if(!e)return{};const{layer:i,view:r}=e;return i&&r?{view:r,layerInfos:[S2t(i)]}:{}}async _createLegend(e){if(!this._hasLegend(e)||this._legend)return;const{default:i}=await ce(()=>import("./Legend-799f6242.js"),["./Legend-799f6242.js","./ExportImageParameters-669c498d.js","./floorFilterUtils-73949d2d.js","./sublayerUtils-453a6830.js","./pixelRangeUtils-367cd051.js","./rendererConversion-f2d7d312.js","./utils-e4f79b61.js","./symbolUtils-67cc8a74.js"],import.meta.url),{listItem:r}=this,n=new i(this._getLegendOptions());this._legend=n,this.notifyChange("className"),this.notifyChange("title");const s=ne(()=>[r?.view,r?.layer,r?.layer?.source,r?.layer?.parent],()=>this._updateLegend(n),Xt);this.addHandles(s,A2t),this.scheduleRender()}_hasLegend(e){const i="legend";return e===i||e!=null&&!!Array.isArray(e)&&e.includes(i)}_attachToNode(e){e.appendChild(this)}_updateLegend(e){e.set(this._getLegendOptions()),this.scheduleRender()}_getWidget(e){return e==="legend"?this._legend:fE(e)?e:null}_getFirstWidget(){const{content:e}=this;if(Array.isArray(e)){let i=null;return e.some(r=>{const n=this._getWidget(r);return n&&(i=n),!!n}),i}return this._getWidget(e)}};u([p()],Ch.prototype,"_legend",void 0),u([p()],Ch.prototype,"className",null),u([p()],Ch.prototype,"content",void 0),u([p()],Ch.prototype,"disabled",null),u([p()],Ch.prototype,"image",void 0),u([p()],Ch.prototype,"listItem",void 0),u([p()],Ch.prototype,"title",null),u([p()],Ch.prototype,"open",void 0),u([p()],Ch.prototype,"visible",void 0),Ch=u([M("esri.widgets.LayerList.ListItemPanel")],Ch);const s$e=Ch;var EO;const O2t=Je.ofType({key:"type",defaultKeyValue:"button",base:CM,typeMap:{button:u1e,toggle:h1e,slider:g2t}}),o$e=Je.ofType(O2t),bD="layer",AV="child-list-mode",R2t="hide",P2t="esri.widgets.LayerList.ListItem";let gn=EO=class extends vM(we){constructor(t){super(t),this.actionsSections=new o$e,this.actionsOpen=!1,this.checkPublishStatusEnabled=!1,this.children=new(Je.ofType(EO)),this.childrenSortable=!0,this.hidden=!1,this.layer=null,this.layerView=null,this.listItemCreatedFunction=null,this.open=!1,this.panel=null,this.parent=null,this.sortable=!0,this.view=null}initialize(){if(this.addHandles([ne(()=>this.layer,t=>this._watchLayerProperties(t),Xt),ne(()=>this.checkPublishStatusEnabled,t=>this._updateChildrenPublishing(t),Xt),ne(()=>this.view,t=>this._updateChildrenView(t),Xt),ne(()=>this.panel,t=>this._setListItemOnPanel(t),Xt),ne(()=>[this.layer,this.view],()=>this._getLayerView(),Xt)]),typeof this.listItemCreatedFunction=="function"){const t={item:this};this.listItemCreatedFunction.call(null,t)}}destroy(){this.view=null}get connectionStatus(){const{layerView:t,publishing:e}=this;if(!e&&t&&"connectionStatus"in t)return t.connectionStatus}get error(){return this.layer?.loadError}get incompatible(){const{layerView:t}=this;return!(!t||!("spatialReferenceSupported"in t))&&!t.spatialReferenceSupported}castPanel(t){return this.panel?.open&&!t.hasOwnProperty("open")&&(t.open=!0),t?new s$e(t):null}get title(){const t=Hl(this,"layer.layer");return(!t||t&&Hl(this,"layer.layer.loaded"))&&Hl(this,"layer.title")||Hl(this,"layer.attributes.title")||""}set title(t){this._override("title",t)}get publishing(){const{layer:t,checkPublishStatusEnabled:e}=this;return e&&t&&"publishingInfo"in t&&t.publishingInfo?.status==="publishing"}get updating(){const{layerView:t,connectionStatus:e,layer:i,publishing:r}=this;return!r&&!e&&(t?t.updating:i?.loadStatus==="loading"||!1)}get visible(){return this.layer?.visible}set visible(t){const e=this.layer;e&&(e.visible=t)}get visibleAtCurrentScale(){return!x2t(this.layer,this.view?.scale)}get visibilityMode(){return v2t(this.layer)}clone(){return new EO({actionsSections:this.actionsSections.clone(),actionsOpen:this.actionsOpen,checkPublishStatusEnabled:this.checkPublishStatusEnabled,children:this.children.clone(),layer:this.layer,listItemCreatedFunction:this.listItemCreatedFunction,open:this.open,panel:this.panel,title:this.title,view:this.view,visible:this.visible})}_setListItemOnPanel(t){t&&(t.listItem=this)}_updateChildrenPublishing(t){const e=this.children;e&&e.forEach(i=>i.checkPublishStatusEnabled=t)}_updateChildrenView(t){const e=this.children;e&&e.forEach(i=>i.view=t)}_addChildren(t){if(this.removeHandles(AV),this.children.removeAll(),!t)return;t.forEach(i=>{this.addHandles(ne(()=>i.listMode,()=>this._addChildren(t)),AV)});const e=t.filter(i=>Dk(i)!==R2t);this.children.addMany(this._makeChildren(e))}_watchSublayerChanges(t){t&&this.addHandles(t.on("change",()=>{this._addChildren(t)}),bD)}_initializeChildLayers(t){this._addChildren(t),this._watchSublayerChanges(t)}_makeChildren(t){return t.map(e=>w2t(e)?new EO({layer:e,checkPublishStatusEnabled:this.checkPublishStatusEnabled,listItemCreatedFunction:this.listItemCreatedFunction,parent:this,view:this.view}):null).filter(Yv).reverse()}_watchLayerProperties(t){if(this.removeHandles(bD),this.removeHandles(AV),!t)return;if(this.addHandles(ne(()=>t.listMode,()=>this._watchLayerProperties(t)),bD),Dk(t)==="hide-children")return void this.children.removeAll();const e=t$e(t);e&&this.addHandles(ne(()=>t[e],i=>{t.hasOwnProperty(e)&&this._initializeChildLayers(i)},Xt),bD)}async _getLayerView(){const{layer:t,view:e}=this;if(t&&e)try{const i=await e.whenLayerView(t);if(i.layer!==this.layer)return;this._set("layerView",i)}catch{}}};u([p({type:o$e})],gn.prototype,"actionsSections",void 0),u([p()],gn.prototype,"actionsOpen",void 0),u([p()],gn.prototype,"checkPublishStatusEnabled",void 0),u([p({type:Je})],gn.prototype,"children",void 0),u([p()],gn.prototype,"childrenSortable",void 0),u([p({readOnly:!0})],gn.prototype,"connectionStatus",null),u([p({readOnly:!0})],gn.prototype,"error",null),u([p()],gn.prototype,"hidden",void 0),u([p({readOnly:!0})],gn.prototype,"incompatible",null),u([p()],gn.prototype,"layer",void 0),u([p({readOnly:!0})],gn.prototype,"layerView",void 0),u([p()],gn.prototype,"listItemCreatedFunction",void 0),u([p()],gn.prototype,"open",void 0),u([p({type:s$e})],gn.prototype,"panel",void 0),u([ai("panel")],gn.prototype,"castPanel",null),u([p()],gn.prototype,"parent",void 0),u([p()],gn.prototype,"sortable",void 0),u([p()],gn.prototype,"title",null),u([p({readOnly:!0})],gn.prototype,"publishing",null),u([p({readOnly:!0})],gn.prototype,"updating",null),u([p()],gn.prototype,"view",void 0),u([p()],gn.prototype,"visible",null),u([p({readOnly:!0})],gn.prototype,"visibleAtCurrentScale",null),u([p({readOnly:!0})],gn.prototype,"visibilityMode",null),gn=EO=u([M(P2t)],gn);const dte=gn,$d={view:"view",viewLayers:"view-layers",mapLayers:"map-layers",layerViews:"layer-views",layerListMode:"layer-list-mode"},M2t="hide",a$e=Je.ofType(dte);let v_=class extends Sn.EventedAccessor{constructor(e){super(e),this.checkPublishStatusEnabled=!1,this.listItemCreatedFunction=null,this.operationalItems=new a$e,this.view=null}initialize(){this.addHandles([ne(()=>[this.view,this.view?.ready],()=>this._viewHandles(),Xt),ne(()=>[this.listItemCreatedFunction,this.checkPublishStatusEnabled],()=>this._recompileList())],$d.view)}destroy(){this.view=null,this.operationalItems.removeAll()}get state(){const{view:e}=this;return e?.ready?"ready":e?"loading":"disabled"}triggerAction(e,i){e&&!e.disabled&&this.emit("trigger-action",{action:e,item:i})}moveListItem(e,i,r,n){const s=e?.layer;if(!s)return;const o=this.view?.map?.layers,a=i?cfe(i):o,l=r?cfe(r):o;if(!a||!l)return;const{operationalItems:c}=this,h=i?.children||c,d=r?.children||c,f=l.length-n;e.parent=r||null,h.includes(e)&&h.remove(e),a.includes(s)&&a.remove(s),d.includes(e)||d.add(e,f),l.includes(s)||l.add(s,f)}_createLayerViewHandles(e){this.removeHandles($d.layerViews),this._compileList(),e&&this.addHandles(e.on("change",()=>this._compileList()),$d.layerViews)}_createMapLayerHandles(e){this.removeHandles($d.mapLayers),this._compileList(),e&&this.addHandles(e.on("change",()=>this._compileList()),$d.mapLayers)}_createListItem(e){const{view:i,listItemCreatedFunction:r,checkPublishStatusEnabled:n}=this;return new dte({checkPublishStatusEnabled:n,layer:e,listItemCreatedFunction:r,view:i})}_removeAllItems(){this.operationalItems.removeAll()}_getViewableLayers(e){if(e)return e.filter(i=>Dk(i)!==M2t)}_watchLayersListMode(e){this.removeHandles($d.layerListMode),e&&e.forEach(i=>{"listMode"in i&&this.addHandles(ne(()=>i.listMode,()=>this._compileList()),$d.layerListMode)})}_compileList(){const e=this.view?.map?.layers;this._watchLayersListMode(e);const i=this._getViewableLayers(e);i?.length?(this._createNewItems(i),this._removeItems(i),this._sortItems(i)):this._removeAllItems()}_createNewItems(e){const{operationalItems:i}=this;e.forEach(r=>{i.find(n=>n.layer===r)||i.add(this._createListItem(r))})}_removeItems(e){const{operationalItems:i}=this,r=[];i.forEach(n=>{n&&e&&e.includes(n.layer)||r.push(n)}),i.removeMany(r)}_sortItems(e){const{operationalItems:i}=this;i.sort((r,n)=>{const s=e.indexOf(r.layer),o=e.indexOf(n.layer);return s>o?-1:s<o?1:0})}_recompileList(){this._removeAllItems(),this._compileList()}_viewHandles(){const{view:e}=this;this.removeHandles([$d.mapLayers,$d.layerViews,$d.viewLayers]),this._recompileList(),e&&e.ready&&this.addHandles([ne(()=>this.view?.map?.allLayers,i=>this._createMapLayerHandles(i),Xt),ne(()=>this.view?.allLayerViews,i=>this._createLayerViewHandles(i),Xt)],$d.viewLayers)}};u([p()],v_.prototype,"checkPublishStatusEnabled",void 0),u([p()],v_.prototype,"listItemCreatedFunction",void 0),u([p({type:a$e})],v_.prototype,"operationalItems",void 0),u([p({readOnly:!0})],v_.prototype,"state",null),u([p()],v_.prototype,"view",void 0),v_=u([M("esri.widgets.LayerList.LayerListViewModel")],v_);const l$e=v_;/**!
 * Sortable 1.15.0
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function ufe(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),i.push.apply(i,r)}return i}function Dm(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?ufe(Object(i),!0).forEach(function(r){$2t(t,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ufe(Object(i)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))})}return t}function k4(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?k4=function(e){return typeof e}:k4=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k4(t)}function $2t(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Ly(){return Ly=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},Ly.apply(this,arguments)}function I2t(t,e){if(t==null)return{};var i={},r=Object.keys(t),n,s;for(s=0;s<r.length;s++)n=r[s],!(e.indexOf(n)>=0)&&(i[n]=t[n]);return i}function L2t(t,e){if(t==null)return{};var i=I2t(t,e),r,n;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(n=0;n<s.length;n++)r=s[n],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}var D2t="1.15.0";function _y(t){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(t)}var Ky=_y(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),u$=_y(/Edge/i),hfe=_y(/firefox/i),kR=_y(/safari/i)&&!_y(/chrome/i)&&!_y(/android/i),c$e=_y(/iP(ad|od|hone)/i),u$e=_y(/chrome/i)&&_y(/android/i),h$e={capture:!1,passive:!1};function Nr(t,e,i){t.addEventListener(e,i,!Ky&&h$e)}function _r(t,e,i){t.removeEventListener(e,i,!Ky&&h$e)}function Nk(t,e){if(e){if(e[0]===">"&&(e=e.substring(1)),t)try{if(t.matches)return t.matches(e);if(t.msMatchesSelector)return t.msMatchesSelector(e);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(e)}catch{return!1}return!1}}function N2t(t){return t.host&&t!==document&&t.host.nodeType?t.host:t.parentNode}function Yf(t,e,i,r){if(t){i=i||document;do{if(e!=null&&(e[0]===">"?t.parentNode===i&&Nk(t,e):Nk(t,e))||r&&t===i)return t;if(t===i)break}while(t=N2t(t))}return null}var dfe=/\s+/g;function mu(t,e,i){if(t&&e)if(t.classList)t.classList[i?"add":"remove"](e);else{var r=(" "+t.className+" ").replace(dfe," ").replace(" "+e+" "," ");t.className=(r+(i?" "+e:"")).replace(dfe," ")}}function ri(t,e,i){var r=t&&t.style;if(r){if(i===void 0)return document.defaultView&&document.defaultView.getComputedStyle?i=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(i=t.currentStyle),e===void 0?i:i[e];!(e in r)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),r[e]=i+(typeof i=="string"?"":"px")}}function mE(t,e){var i="";if(typeof t=="string")i=t;else do{var r=ri(t,"transform");r&&r!=="none"&&(i=r+" "+i)}while(!e&&(t=t.parentNode));var n=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return n&&new n(i)}function d$e(t,e,i){if(t){var r=t.getElementsByTagName(e),n=0,s=r.length;if(i)for(;n<s;n++)i(r[n],n);return r}return[]}function xm(){var t=document.scrollingElement;return t||document.documentElement}function ko(t,e,i,r,n){if(!(!t.getBoundingClientRect&&t!==window)){var s,o,a,l,c,h,d;if(t!==window&&t.parentNode&&t!==xm()?(s=t.getBoundingClientRect(),o=s.top,a=s.left,l=s.bottom,c=s.right,h=s.height,d=s.width):(o=0,a=0,l=window.innerHeight,c=window.innerWidth,h=window.innerHeight,d=window.innerWidth),(e||i)&&t!==window&&(n=n||t.parentNode,!Ky))do if(n&&n.getBoundingClientRect&&(ri(n,"transform")!=="none"||i&&ri(n,"position")!=="static")){var f=n.getBoundingClientRect();o-=f.top+parseInt(ri(n,"border-top-width")),a-=f.left+parseInt(ri(n,"border-left-width")),l=o+s.height,c=a+s.width;break}while(n=n.parentNode);if(r&&t!==window){var m=mE(n||t),y=m&&m.a,_=m&&m.d;m&&(o/=_,a/=y,d/=y,h/=_,l=o+h,c=a+d)}return{top:o,left:a,bottom:l,right:c,width:d,height:h}}}function pfe(t,e,i){for(var r=nv(t,!0),n=ko(t)[e];r;){var s=ko(r)[i],o=void 0;if(i==="top"||i==="left"?o=n>=s:o=n<=s,!o)return r;if(r===xm())break;r=nv(r,!1)}return!1}function yC(t,e,i,r){for(var n=0,s=0,o=t.children;s<o.length;){if(o[s].style.display!=="none"&&o[s]!==ni.ghost&&(r||o[s]!==ni.dragged)&&Yf(o[s],i.draggable,t,!1)){if(n===e)return o[s];n++}s++}return null}function pte(t,e){for(var i=t.lastElementChild;i&&(i===ni.ghost||ri(i,"display")==="none"||e&&!Nk(i,e));)i=i.previousElementSibling;return i||null}function Ph(t,e){var i=0;if(!t||!t.parentNode)return-1;for(;t=t.previousElementSibling;)t.nodeName.toUpperCase()!=="TEMPLATE"&&t!==ni.clone&&(!e||Nk(t,e))&&i++;return i}function ffe(t){var e=0,i=0,r=xm();if(t)do{var n=mE(t),s=n.a,o=n.d;e+=t.scrollLeft*s,i+=t.scrollTop*o}while(t!==r&&(t=t.parentNode));return[e,i]}function F2t(t,e){for(var i in t)if(t.hasOwnProperty(i)){for(var r in e)if(e.hasOwnProperty(r)&&e[r]===t[i][r])return Number(i)}return-1}function nv(t,e){if(!t||!t.getBoundingClientRect)return xm();var i=t,r=!1;do if(i.clientWidth<i.scrollWidth||i.clientHeight<i.scrollHeight){var n=ri(i);if(i.clientWidth<i.scrollWidth&&(n.overflowX=="auto"||n.overflowX=="scroll")||i.clientHeight<i.scrollHeight&&(n.overflowY=="auto"||n.overflowY=="scroll")){if(!i.getBoundingClientRect||i===document.body)return xm();if(r||e)return i;r=!0}}while(i=i.parentNode);return xm()}function k2t(t,e){if(t&&e)for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}function OV(t,e){return Math.round(t.top)===Math.round(e.top)&&Math.round(t.left)===Math.round(e.left)&&Math.round(t.height)===Math.round(e.height)&&Math.round(t.width)===Math.round(e.width)}var UR;function p$e(t,e){return function(){if(!UR){var i=arguments,r=this;i.length===1?t.call(r,i[0]):t.apply(r,i),UR=setTimeout(function(){UR=void 0},e)}}}function U2t(){clearTimeout(UR),UR=void 0}function f$e(t,e,i){t.scrollLeft+=e,t.scrollTop+=i}function m$e(t){var e=window.Polymer,i=window.jQuery||window.Zepto;return e&&e.dom?e.dom(t).cloneNode(!0):i?i(t).clone(!0)[0]:t.cloneNode(!0)}var Nu="Sortable"+new Date().getTime();function z2t(){var t=[],e;return{captureAnimationState:function(){if(t=[],!!this.options.animation){var r=[].slice.call(this.el.children);r.forEach(function(n){if(!(ri(n,"display")==="none"||n===ni.ghost)){t.push({target:n,rect:ko(n)});var s=Dm({},t[t.length-1].rect);if(n.thisAnimationDuration){var o=mE(n,!0);o&&(s.top-=o.f,s.left-=o.e)}n.fromRect=s}})}},addAnimationState:function(r){t.push(r)},removeAnimationState:function(r){t.splice(F2t(t,{target:r}),1)},animateAll:function(r){var n=this;if(!this.options.animation){clearTimeout(e),typeof r=="function"&&r();return}var s=!1,o=0;t.forEach(function(a){var l=0,c=a.target,h=c.fromRect,d=ko(c),f=c.prevFromRect,m=c.prevToRect,y=a.rect,_=mE(c,!0);_&&(d.top-=_.f,d.left-=_.e),c.toRect=d,c.thisAnimationDuration&&OV(f,d)&&!OV(h,d)&&(y.top-d.top)/(y.left-d.left)===(h.top-d.top)/(h.left-d.left)&&(l=V2t(y,f,m,n.options)),OV(d,h)||(c.prevFromRect=h,c.prevToRect=d,l||(l=n.options.animation),n.animate(c,y,d,l)),l&&(s=!0,o=Math.max(o,l),clearTimeout(c.animationResetTimer),c.animationResetTimer=setTimeout(function(){c.animationTime=0,c.prevFromRect=null,c.fromRect=null,c.prevToRect=null,c.thisAnimationDuration=null},l),c.thisAnimationDuration=l)}),clearTimeout(e),s?e=setTimeout(function(){typeof r=="function"&&r()},o):typeof r=="function"&&r(),t=[]},animate:function(r,n,s,o){if(o){ri(r,"transition",""),ri(r,"transform","");var a=mE(this.el),l=a&&a.a,c=a&&a.d,h=(n.left-s.left)/(l||1),d=(n.top-s.top)/(c||1);r.animatingX=!!h,r.animatingY=!!d,ri(r,"transform","translate3d("+h+"px,"+d+"px,0)"),this.forRepaintDummy=B2t(r),ri(r,"transition","transform "+o+"ms"+(this.options.easing?" "+this.options.easing:"")),ri(r,"transform","translate3d(0,0,0)"),typeof r.animated=="number"&&clearTimeout(r.animated),r.animated=setTimeout(function(){ri(r,"transition",""),ri(r,"transform",""),r.animated=!1,r.animatingX=!1,r.animatingY=!1},o)}}}}function B2t(t){return t.offsetWidth}function V2t(t,e,i,r){return Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))/Math.sqrt(Math.pow(e.top-i.top,2)+Math.pow(e.left-i.left,2))*r.animation}var _S=[],RV={initializeByDefault:!0},h$={mount:function(e){for(var i in RV)RV.hasOwnProperty(i)&&!(i in e)&&(e[i]=RV[i]);_S.forEach(function(r){if(r.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),_S.push(e)},pluginEvent:function(e,i,r){var n=this;this.eventCanceled=!1,r.cancel=function(){n.eventCanceled=!0};var s=e+"Global";_S.forEach(function(o){i[o.pluginName]&&(i[o.pluginName][s]&&i[o.pluginName][s](Dm({sortable:i},r)),i.options[o.pluginName]&&i[o.pluginName][e]&&i[o.pluginName][e](Dm({sortable:i},r)))})},initializePlugins:function(e,i,r,n){_S.forEach(function(a){var l=a.pluginName;if(!(!e.options[l]&&!a.initializeByDefault)){var c=new a(e,i,e.options);c.sortable=e,c.options=e.options,e[l]=c,Ly(r,c.defaults)}});for(var s in e.options)if(e.options.hasOwnProperty(s)){var o=this.modifyOption(e,s,e.options[s]);typeof o<"u"&&(e.options[s]=o)}},getEventProperties:function(e,i){var r={};return _S.forEach(function(n){typeof n.eventProperties=="function"&&Ly(r,n.eventProperties.call(i[n.pluginName],e))}),r},modifyOption:function(e,i,r){var n;return _S.forEach(function(s){e[s.pluginName]&&s.optionListeners&&typeof s.optionListeners[i]=="function"&&(n=s.optionListeners[i].call(e[s.pluginName],r))}),n}};function G2t(t){var e=t.sortable,i=t.rootEl,r=t.name,n=t.targetEl,s=t.cloneEl,o=t.toEl,a=t.fromEl,l=t.oldIndex,c=t.newIndex,h=t.oldDraggableIndex,d=t.newDraggableIndex,f=t.originalEvent,m=t.putSortable,y=t.extraEventProperties;if(e=e||i&&i[Nu],!!e){var _,v=e.options,w="on"+r.charAt(0).toUpperCase()+r.substr(1);window.CustomEvent&&!Ky&&!u$?_=new CustomEvent(r,{bubbles:!0,cancelable:!0}):(_=document.createEvent("Event"),_.initEvent(r,!0,!0)),_.to=o||i,_.from=a||i,_.item=n||i,_.clone=s,_.oldIndex=l,_.newIndex=c,_.oldDraggableIndex=h,_.newDraggableIndex=d,_.originalEvent=f,_.pullMode=m?m.lastPutMode:void 0;var x=Dm(Dm({},y),h$.getEventProperties(r,e));for(var T in x)_[T]=x[T];i&&i.dispatchEvent(_),v[w]&&v[w].call(e,_)}}var j2t=["evt"],fc=function(e,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=r.evt,s=L2t(r,j2t);h$.pluginEvent.bind(ni)(e,i,Dm({dragEl:Ue,parentEl:ws,ghostEl:wi,rootEl:ns,nextEl:Yb,lastDownEl:U4,cloneEl:us,cloneHidden:B_,dragStarted:CO,putSortable:ba,activeSortable:ni.active,originalEvent:n,oldIndex:V2,oldDraggableIndex:zR,newIndex:xu,newDraggableIndex:I_,hideGhostForTarget:v$e,unhideGhostForTarget:b$e,cloneNowHidden:function(){B_=!0},cloneNowShown:function(){B_=!1},dispatchSortableEvent:function(a){Dl({sortable:i,name:a,originalEvent:n})}},s))};function Dl(t){G2t(Dm({putSortable:ba,cloneEl:us,targetEl:Ue,rootEl:ns,oldIndex:V2,oldDraggableIndex:zR,newIndex:xu,newDraggableIndex:I_},t))}var Ue,ws,wi,ns,Yb,U4,us,B_,V2,xu,zR,I_,wD,ba,d2=!1,Fk=!1,kk=[],eb,Id,PV,MV,mfe,gfe,CO,vS,BR,VR=!1,xD=!1,z4,ja,$V=[],fY=!1,Uk=[],w8=typeof document<"u",TD=c$e,yfe=u$||Ky?"cssFloat":"float",H2t=w8&&!u$e&&!c$e&&"draggable"in document.createElement("div"),g$e=function(){if(w8){if(Ky)return!1;var t=document.createElement("x");return t.style.cssText="pointer-events:auto",t.style.pointerEvents==="auto"}}(),y$e=function(e,i){var r=ri(e),n=parseInt(r.width)-parseInt(r.paddingLeft)-parseInt(r.paddingRight)-parseInt(r.borderLeftWidth)-parseInt(r.borderRightWidth),s=yC(e,0,i),o=yC(e,1,i),a=s&&ri(s),l=o&&ri(o),c=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+ko(s).width,h=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+ko(o).width;if(r.display==="flex")return r.flexDirection==="column"||r.flexDirection==="column-reverse"?"vertical":"horizontal";if(r.display==="grid")return r.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(s&&a.float&&a.float!=="none"){var d=a.float==="left"?"left":"right";return o&&(l.clear==="both"||l.clear===d)?"vertical":"horizontal"}return s&&(a.display==="block"||a.display==="flex"||a.display==="table"||a.display==="grid"||c>=n&&r[yfe]==="none"||o&&r[yfe]==="none"&&c+h>n)?"vertical":"horizontal"},q2t=function(e,i,r){var n=r?e.left:e.top,s=r?e.right:e.bottom,o=r?e.width:e.height,a=r?i.left:i.top,l=r?i.right:i.bottom,c=r?i.width:i.height;return n===a||s===l||n+o/2===a+c/2},W2t=function(e,i){var r;return kk.some(function(n){var s=n[Nu].options.emptyInsertThreshold;if(!(!s||pte(n))){var o=ko(n),a=e>=o.left-s&&e<=o.right+s,l=i>=o.top-s&&i<=o.bottom+s;if(a&&l)return r=n}}),r},_$e=function(e){function i(s,o){return function(a,l,c,h){var d=a.options.group.name&&l.options.group.name&&a.options.group.name===l.options.group.name;if(s==null&&(o||d))return!0;if(s==null||s===!1)return!1;if(o&&s==="clone")return s;if(typeof s=="function")return i(s(a,l,c,h),o)(a,l,c,h);var f=(o?a:l).options.group.name;return s===!0||typeof s=="string"&&s===f||s.join&&s.indexOf(f)>-1}}var r={},n=e.group;(!n||k4(n)!="object")&&(n={name:n}),r.name=n.name,r.checkPull=i(n.pull,!0),r.checkPut=i(n.put),r.revertClone=n.revertClone,e.group=r},v$e=function(){!g$e&&wi&&ri(wi,"display","none")},b$e=function(){!g$e&&wi&&ri(wi,"display","")};w8&&!u$e&&document.addEventListener("click",function(t){if(Fk)return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),Fk=!1,!1},!0);var tb=function(e){if(Ue){e=e.touches?e.touches[0]:e;var i=W2t(e.clientX,e.clientY);if(i){var r={};for(var n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);r.target=r.rootEl=i,r.preventDefault=void 0,r.stopPropagation=void 0,i[Nu]._onDragOver(r)}}},Y2t=function(e){Ue&&Ue.parentNode[Nu]._isOutsideThisEl(e.target)};function ni(t,e){if(!(t&&t.nodeType&&t.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.el=t,this.options=e=Ly({},e),t[Nu]=this;var i={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(t.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return y$e(t,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(o,a){o.setData("Text",a.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:ni.supportPointer!==!1&&"PointerEvent"in window&&!kR,emptyInsertThreshold:5};h$.initializePlugins(this,t,i);for(var r in i)!(r in e)&&(e[r]=i[r]);_$e(e);for(var n in this)n.charAt(0)==="_"&&typeof this[n]=="function"&&(this[n]=this[n].bind(this));this.nativeDraggable=e.forceFallback?!1:H2t,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?Nr(t,"pointerdown",this._onTapStart):(Nr(t,"mousedown",this._onTapStart),Nr(t,"touchstart",this._onTapStart)),this.nativeDraggable&&(Nr(t,"dragover",this),Nr(t,"dragenter",this)),kk.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),Ly(this,z2t())}ni.prototype={constructor:ni,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(vS=null)},_getDirection:function(e,i){return typeof this.options.direction=="function"?this.options.direction.call(this,e,i,Ue):this.options.direction},_onTapStart:function(e){if(e.cancelable){var i=this,r=this.el,n=this.options,s=n.preventOnFilter,o=e.type,a=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,l=(a||e).target,c=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||l,h=n.filter;if(iEt(r),!Ue&&!(/mousedown|pointerdown/.test(o)&&e.button!==0||n.disabled)&&!c.isContentEditable&&!(!this.nativeDraggable&&kR&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=Yf(l,n.draggable,r,!1),!(l&&l.animated)&&U4!==l)){if(V2=Ph(l),zR=Ph(l,n.draggable),typeof h=="function"){if(h.call(this,e,l,this)){Dl({sortable:i,rootEl:c,name:"filter",targetEl:l,toEl:r,fromEl:r}),fc("filter",i,{evt:e}),s&&e.cancelable&&e.preventDefault();return}}else if(h&&(h=h.split(",").some(function(d){if(d=Yf(c,d.trim(),r,!1),d)return Dl({sortable:i,rootEl:d,name:"filter",targetEl:l,fromEl:r,toEl:r}),fc("filter",i,{evt:e}),!0}),h)){s&&e.cancelable&&e.preventDefault();return}n.handle&&!Yf(c,n.handle,r,!1)||this._prepareDragStart(e,a,l)}}},_prepareDragStart:function(e,i,r){var n=this,s=n.el,o=n.options,a=s.ownerDocument,l;if(r&&!Ue&&r.parentNode===s){var c=ko(r);if(ns=s,Ue=r,ws=Ue.parentNode,Yb=Ue.nextSibling,U4=r,wD=o.group,ni.dragged=Ue,eb={target:Ue,clientX:(i||e).clientX,clientY:(i||e).clientY},mfe=eb.clientX-c.left,gfe=eb.clientY-c.top,this._lastX=(i||e).clientX,this._lastY=(i||e).clientY,Ue.style["will-change"]="all",l=function(){if(fc("delayEnded",n,{evt:e}),ni.eventCanceled){n._onDrop();return}n._disableDelayedDragEvents(),!hfe&&n.nativeDraggable&&(Ue.draggable=!0),n._triggerDragStart(e,i),Dl({sortable:n,name:"choose",originalEvent:e}),mu(Ue,o.chosenClass,!0)},o.ignore.split(",").forEach(function(h){d$e(Ue,h.trim(),IV)}),Nr(a,"dragover",tb),Nr(a,"mousemove",tb),Nr(a,"touchmove",tb),Nr(a,"mouseup",n._onDrop),Nr(a,"touchend",n._onDrop),Nr(a,"touchcancel",n._onDrop),hfe&&this.nativeDraggable&&(this.options.touchStartThreshold=4,Ue.draggable=!0),fc("delayStart",this,{evt:e}),o.delay&&(!o.delayOnTouchOnly||i)&&(!this.nativeDraggable||!(u$||Ky))){if(ni.eventCanceled){this._onDrop();return}Nr(a,"mouseup",n._disableDelayedDrag),Nr(a,"touchend",n._disableDelayedDrag),Nr(a,"touchcancel",n._disableDelayedDrag),Nr(a,"mousemove",n._delayedDragTouchMoveHandler),Nr(a,"touchmove",n._delayedDragTouchMoveHandler),o.supportPointer&&Nr(a,"pointermove",n._delayedDragTouchMoveHandler),n._dragStartTimer=setTimeout(l,o.delay)}else l()}},_delayedDragTouchMoveHandler:function(e){var i=e.touches?e.touches[0]:e;Math.max(Math.abs(i.clientX-this._lastX),Math.abs(i.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){Ue&&IV(Ue),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;_r(e,"mouseup",this._disableDelayedDrag),_r(e,"touchend",this._disableDelayedDrag),_r(e,"touchcancel",this._disableDelayedDrag),_r(e,"mousemove",this._delayedDragTouchMoveHandler),_r(e,"touchmove",this._delayedDragTouchMoveHandler),_r(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,i){i=i||e.pointerType=="touch"&&e,!this.nativeDraggable||i?this.options.supportPointer?Nr(document,"pointermove",this._onTouchMove):i?Nr(document,"touchmove",this._onTouchMove):Nr(document,"mousemove",this._onTouchMove):(Nr(Ue,"dragend",this),Nr(ns,"dragstart",this._onDragStart));try{document.selection?B4(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,i){if(d2=!1,ns&&Ue){fc("dragStarted",this,{evt:i}),this.nativeDraggable&&Nr(document,"dragover",Y2t);var r=this.options;!e&&mu(Ue,r.dragClass,!1),mu(Ue,r.ghostClass,!0),ni.active=this,e&&this._appendGhost(),Dl({sortable:this,name:"start",originalEvent:i})}else this._nulling()},_emulateDragOver:function(){if(Id){this._lastX=Id.clientX,this._lastY=Id.clientY,v$e();for(var e=document.elementFromPoint(Id.clientX,Id.clientY),i=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(Id.clientX,Id.clientY),e!==i);)i=e;if(Ue.parentNode[Nu]._isOutsideThisEl(e),i)do{if(i[Nu]){var r=void 0;if(r=i[Nu]._onDragOver({clientX:Id.clientX,clientY:Id.clientY,target:e,rootEl:i}),r&&!this.options.dragoverBubble)break}e=i}while(i=i.parentNode);b$e()}},_onTouchMove:function(e){if(eb){var i=this.options,r=i.fallbackTolerance,n=i.fallbackOffset,s=e.touches?e.touches[0]:e,o=wi&&mE(wi,!0),a=wi&&o&&o.a,l=wi&&o&&o.d,c=TD&&ja&&ffe(ja),h=(s.clientX-eb.clientX+n.x)/(a||1)+(c?c[0]-$V[0]:0)/(a||1),d=(s.clientY-eb.clientY+n.y)/(l||1)+(c?c[1]-$V[1]:0)/(l||1);if(!ni.active&&!d2){if(r&&Math.max(Math.abs(s.clientX-this._lastX),Math.abs(s.clientY-this._lastY))<r)return;this._onDragStart(e,!0)}if(wi){o?(o.e+=h-(PV||0),o.f+=d-(MV||0)):o={a:1,b:0,c:0,d:1,e:h,f:d};var f="matrix(".concat(o.a,",").concat(o.b,",").concat(o.c,",").concat(o.d,",").concat(o.e,",").concat(o.f,")");ri(wi,"webkitTransform",f),ri(wi,"mozTransform",f),ri(wi,"msTransform",f),ri(wi,"transform",f),PV=h,MV=d,Id=s}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!wi){var e=this.options.fallbackOnBody?document.body:ns,i=ko(Ue,!0,TD,!0,e),r=this.options;if(TD){for(ja=e;ri(ja,"position")==="static"&&ri(ja,"transform")==="none"&&ja!==document;)ja=ja.parentNode;ja!==document.body&&ja!==document.documentElement?(ja===document&&(ja=xm()),i.top+=ja.scrollTop,i.left+=ja.scrollLeft):ja=xm(),$V=ffe(ja)}wi=Ue.cloneNode(!0),mu(wi,r.ghostClass,!1),mu(wi,r.fallbackClass,!0),mu(wi,r.dragClass,!0),ri(wi,"transition",""),ri(wi,"transform",""),ri(wi,"box-sizing","border-box"),ri(wi,"margin",0),ri(wi,"top",i.top),ri(wi,"left",i.left),ri(wi,"width",i.width),ri(wi,"height",i.height),ri(wi,"opacity","0.8"),ri(wi,"position",TD?"absolute":"fixed"),ri(wi,"zIndex","100000"),ri(wi,"pointerEvents","none"),ni.ghost=wi,e.appendChild(wi),ri(wi,"transform-origin",mfe/parseInt(wi.style.width)*100+"% "+gfe/parseInt(wi.style.height)*100+"%")}},_onDragStart:function(e,i){var r=this,n=e.dataTransfer,s=r.options;if(fc("dragStart",this,{evt:e}),ni.eventCanceled){this._onDrop();return}fc("setupClone",this),ni.eventCanceled||(us=m$e(Ue),us.removeAttribute("id"),us.draggable=!1,us.style["will-change"]="",this._hideClone(),mu(us,this.options.chosenClass,!1),ni.clone=us),r.cloneId=B4(function(){fc("clone",r),!ni.eventCanceled&&(r.options.removeCloneOnHide||ns.insertBefore(us,Ue),r._hideClone(),Dl({sortable:r,name:"clone"}))}),!i&&mu(Ue,s.dragClass,!0),i?(Fk=!0,r._loopId=setInterval(r._emulateDragOver,50)):(_r(document,"mouseup",r._onDrop),_r(document,"touchend",r._onDrop),_r(document,"touchcancel",r._onDrop),n&&(n.effectAllowed="move",s.setData&&s.setData.call(r,n,Ue)),Nr(document,"drop",r),ri(Ue,"transform","translateZ(0)")),d2=!0,r._dragStartId=B4(r._dragStarted.bind(r,i,e)),Nr(document,"selectstart",r),CO=!0,kR&&ri(document.body,"user-select","none")},_onDragOver:function(e){var i=this.el,r=e.target,n,s,o,a=this.options,l=a.group,c=ni.active,h=wD===l,d=a.sort,f=ba||c,m,y=this,_=!1;if(fY)return;function v(I,V){fc(I,y,Dm({evt:e,isOwner:h,axis:m?"vertical":"horizontal",revert:o,dragRect:n,targetRect:s,canSort:d,fromSortable:f,target:r,completed:x,onMove:function(Y,J){return SD(ns,i,Ue,n,Y,ko(Y),e,J)},changed:T},V))}function w(){v("dragOverAnimationCapture"),y.captureAnimationState(),y!==f&&f.captureAnimationState()}function x(I){return v("dragOverCompleted",{insertion:I}),I&&(h?c._hideClone():c._showClone(y),y!==f&&(mu(Ue,ba?ba.options.ghostClass:c.options.ghostClass,!1),mu(Ue,a.ghostClass,!0)),ba!==y&&y!==ni.active?ba=y:y===ni.active&&ba&&(ba=null),f===y&&(y._ignoreWhileAnimating=r),y.animateAll(function(){v("dragOverAnimationComplete"),y._ignoreWhileAnimating=null}),y!==f&&(f.animateAll(),f._ignoreWhileAnimating=null)),(r===Ue&&!Ue.animated||r===i&&!r.animated)&&(vS=null),!a.dragoverBubble&&!e.rootEl&&r!==document&&(Ue.parentNode[Nu]._isOutsideThisEl(e.target),!I&&tb(e)),!a.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),_=!0}function T(){xu=Ph(Ue),I_=Ph(Ue,a.draggable),Dl({sortable:y,name:"change",toEl:i,newIndex:xu,newDraggableIndex:I_,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),r=Yf(r,a.draggable,i,!0),v("dragOver"),ni.eventCanceled)return _;if(Ue.contains(e.target)||r.animated&&r.animatingX&&r.animatingY||y._ignoreWhileAnimating===r)return x(!1);if(Fk=!1,c&&!a.disabled&&(h?d||(o=ws!==ns):ba===this||(this.lastPutMode=wD.checkPull(this,c,Ue,e))&&l.checkPut(this,c,Ue,e))){if(m=this._getDirection(e,r)==="vertical",n=ko(Ue),v("dragOverValid"),ni.eventCanceled)return _;if(o)return ws=ns,w(),this._hideClone(),v("revert"),ni.eventCanceled||(Yb?ns.insertBefore(Ue,Yb):ns.appendChild(Ue)),x(!0);var S=pte(i,a.draggable);if(!S||K2t(e,m,this)&&!S.animated){if(S===Ue)return x(!1);if(S&&i===e.target&&(r=S),r&&(s=ko(r)),SD(ns,i,Ue,n,r,s,e,!!r)!==!1)return w(),S&&S.nextSibling?i.insertBefore(Ue,S.nextSibling):i.appendChild(Ue),ws=i,T(),x(!0)}else if(S&&J2t(e,m,this)){var C=yC(i,0,a,!0);if(C===Ue)return x(!1);if(r=C,s=ko(r),SD(ns,i,Ue,n,r,s,e,!1)!==!1)return w(),i.insertBefore(Ue,C),ws=i,T(),x(!0)}else if(r.parentNode===i){s=ko(r);var A=0,R,D=Ue.parentNode!==i,N=!q2t(Ue.animated&&Ue.toRect||n,r.animated&&r.toRect||s,m),k=m?"top":"left",B=pfe(r,"top","top")||pfe(Ue,"top","top"),L=B?B.scrollTop:void 0;vS!==r&&(R=s[k],VR=!1,xD=!N&&a.invertSwap||D),A=Q2t(e,r,s,m,N?1:a.swapThreshold,a.invertedSwapThreshold==null?a.swapThreshold:a.invertedSwapThreshold,xD,vS===r);var z;if(A!==0){var j=Ph(Ue);do j-=A,z=ws.children[j];while(z&&(ri(z,"display")==="none"||z===wi))}if(A===0||z===r)return x(!1);vS=r,BR=A;var H=r.nextElementSibling,X=!1;X=A===1;var P=SD(ns,i,Ue,n,r,s,e,X);if(P!==!1)return(P===1||P===-1)&&(X=P===1),fY=!0,setTimeout(Z2t,30),w(),X&&!H?i.appendChild(Ue):r.parentNode.insertBefore(Ue,X?H:r),B&&f$e(B,0,L-B.scrollTop),ws=Ue.parentNode,R!==void 0&&!xD&&(z4=Math.abs(R-ko(r)[k])),T(),x(!0)}if(i.contains(Ue))return x(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){_r(document,"mousemove",this._onTouchMove),_r(document,"touchmove",this._onTouchMove),_r(document,"pointermove",this._onTouchMove),_r(document,"dragover",tb),_r(document,"mousemove",tb),_r(document,"touchmove",tb)},_offUpEvents:function(){var e=this.el.ownerDocument;_r(e,"mouseup",this._onDrop),_r(e,"touchend",this._onDrop),_r(e,"pointerup",this._onDrop),_r(e,"touchcancel",this._onDrop),_r(document,"selectstart",this)},_onDrop:function(e){var i=this.el,r=this.options;if(xu=Ph(Ue),I_=Ph(Ue,r.draggable),fc("drop",this,{evt:e}),ws=Ue&&Ue.parentNode,xu=Ph(Ue),I_=Ph(Ue,r.draggable),ni.eventCanceled){this._nulling();return}d2=!1,xD=!1,VR=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),mY(this.cloneId),mY(this._dragStartId),this.nativeDraggable&&(_r(document,"drop",this),_r(i,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),kR&&ri(document.body,"user-select",""),ri(Ue,"transform",""),e&&(CO&&(e.cancelable&&e.preventDefault(),!r.dropBubble&&e.stopPropagation()),wi&&wi.parentNode&&wi.parentNode.removeChild(wi),(ns===ws||ba&&ba.lastPutMode!=="clone")&&us&&us.parentNode&&us.parentNode.removeChild(us),Ue&&(this.nativeDraggable&&_r(Ue,"dragend",this),IV(Ue),Ue.style["will-change"]="",CO&&!d2&&mu(Ue,ba?ba.options.ghostClass:this.options.ghostClass,!1),mu(Ue,this.options.chosenClass,!1),Dl({sortable:this,name:"unchoose",toEl:ws,newIndex:null,newDraggableIndex:null,originalEvent:e}),ns!==ws?(xu>=0&&(Dl({rootEl:ws,name:"add",toEl:ws,fromEl:ns,originalEvent:e}),Dl({sortable:this,name:"remove",toEl:ws,originalEvent:e}),Dl({rootEl:ws,name:"sort",toEl:ws,fromEl:ns,originalEvent:e}),Dl({sortable:this,name:"sort",toEl:ws,originalEvent:e})),ba&&ba.save()):xu!==V2&&xu>=0&&(Dl({sortable:this,name:"update",toEl:ws,originalEvent:e}),Dl({sortable:this,name:"sort",toEl:ws,originalEvent:e})),ni.active&&((xu==null||xu===-1)&&(xu=V2,I_=zR),Dl({sortable:this,name:"end",toEl:ws,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){fc("nulling",this),ns=Ue=ws=wi=Yb=us=U4=B_=eb=Id=CO=xu=I_=V2=zR=vS=BR=ba=wD=ni.dragged=ni.ghost=ni.clone=ni.active=null,Uk.forEach(function(e){e.checked=!0}),Uk.length=PV=MV=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":Ue&&(this._onDragOver(e),X2t(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],i,r=this.el.children,n=0,s=r.length,o=this.options;n<s;n++)i=r[n],Yf(i,o.draggable,this.el,!1)&&e.push(i.getAttribute(o.dataIdAttr)||tEt(i));return e},sort:function(e,i){var r={},n=this.el;this.toArray().forEach(function(s,o){var a=n.children[o];Yf(a,this.options.draggable,n,!1)&&(r[s]=a)},this),i&&this.captureAnimationState(),e.forEach(function(s){r[s]&&(n.removeChild(r[s]),n.appendChild(r[s]))}),i&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,i){return Yf(e,i||this.options.draggable,this.el,!1)},option:function(e,i){var r=this.options;if(i===void 0)return r[e];var n=h$.modifyOption(this,e,i);typeof n<"u"?r[e]=n:r[e]=i,e==="group"&&_$e(r)},destroy:function(){fc("destroy",this);var e=this.el;e[Nu]=null,_r(e,"mousedown",this._onTapStart),_r(e,"touchstart",this._onTapStart),_r(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(_r(e,"dragover",this),_r(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(i){i.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),kk.splice(kk.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!B_){if(fc("hideClone",this),ni.eventCanceled)return;ri(us,"display","none"),this.options.removeCloneOnHide&&us.parentNode&&us.parentNode.removeChild(us),B_=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(B_){if(fc("showClone",this),ni.eventCanceled)return;Ue.parentNode==ns&&!this.options.group.revertClone?ns.insertBefore(us,Ue):Yb?ns.insertBefore(us,Yb):ns.appendChild(us),this.options.group.revertClone&&this.animate(Ue,us),ri(us,"display",""),B_=!1}}};function X2t(t){t.dataTransfer&&(t.dataTransfer.dropEffect="move"),t.cancelable&&t.preventDefault()}function SD(t,e,i,r,n,s,o,a){var l,c=t[Nu],h=c.options.onMove,d;return window.CustomEvent&&!Ky&&!u$?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=e,l.from=t,l.dragged=i,l.draggedRect=r,l.related=n||e,l.relatedRect=s||ko(e),l.willInsertAfter=a,l.originalEvent=o,t.dispatchEvent(l),h&&(d=h.call(c,l,o)),d}function IV(t){t.draggable=!1}function Z2t(){fY=!1}function J2t(t,e,i){var r=ko(yC(i.el,0,i.options,!0)),n=10;return e?t.clientX<r.left-n||t.clientY<r.top&&t.clientX<r.right:t.clientY<r.top-n||t.clientY<r.bottom&&t.clientX<r.left}function K2t(t,e,i){var r=ko(pte(i.el,i.options.draggable)),n=10;return e?t.clientX>r.right+n||t.clientX<=r.right&&t.clientY>r.bottom&&t.clientX>=r.left:t.clientX>r.right&&t.clientY>r.top||t.clientX<=r.right&&t.clientY>r.bottom+n}function Q2t(t,e,i,r,n,s,o,a){var l=r?t.clientY:t.clientX,c=r?i.height:i.width,h=r?i.top:i.left,d=r?i.bottom:i.right,f=!1;if(!o){if(a&&z4<c*n){if(!VR&&(BR===1?l>h+c*s/2:l<d-c*s/2)&&(VR=!0),VR)f=!0;else if(BR===1?l<h+z4:l>d-z4)return-BR}else if(l>h+c*(1-n)/2&&l<d-c*(1-n)/2)return eEt(e)}return f=f||o,f&&(l<h+c*s/2||l>d-c*s/2)?l>h+c/2?1:-1:0}function eEt(t){return Ph(Ue)<Ph(t)?1:-1}function tEt(t){for(var e=t.tagName+t.className+t.src+t.href+t.textContent,i=e.length,r=0;i--;)r+=e.charCodeAt(i);return r.toString(36)}function iEt(t){Uk.length=0;for(var e=t.getElementsByTagName("input"),i=e.length;i--;){var r=e[i];r.checked&&Uk.push(r)}}function B4(t){return setTimeout(t,0)}function mY(t){return clearTimeout(t)}w8&&Nr(document,"touchmove",function(t){(ni.active||d2)&&t.cancelable&&t.preventDefault()});ni.utils={on:Nr,off:_r,css:ri,find:d$e,is:function(e,i){return!!Yf(e,i,e,!1)},extend:k2t,throttle:p$e,closest:Yf,toggleClass:mu,clone:m$e,index:Ph,nextTick:B4,cancelNextTick:mY,detectDirection:y$e,getChild:yC};ni.get=function(t){return t[Nu]};ni.mount=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];e[0].constructor===Array&&(e=e[0]),e.forEach(function(r){if(!r.prototype||!r.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(r));r.utils&&(ni.utils=Dm(Dm({},ni.utils),r.utils)),h$.mount(r)})};ni.create=function(t,e){return new ni(t,e)};ni.version=D2t;var lo=[],AO,gY,yY=!1,LV,DV,zk,OO;function rEt(){function t(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return t.prototype={dragStarted:function(i){var r=i.originalEvent;this.sortable.nativeDraggable?Nr(document,"dragover",this._handleAutoScroll):this.options.supportPointer?Nr(document,"pointermove",this._handleFallbackAutoScroll):r.touches?Nr(document,"touchmove",this._handleFallbackAutoScroll):Nr(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(i){var r=i.originalEvent;!this.options.dragOverBubble&&!r.rootEl&&this._handleAutoScroll(r)},drop:function(){this.sortable.nativeDraggable?_r(document,"dragover",this._handleAutoScroll):(_r(document,"pointermove",this._handleFallbackAutoScroll),_r(document,"touchmove",this._handleFallbackAutoScroll),_r(document,"mousemove",this._handleFallbackAutoScroll)),_fe(),V4(),U2t()},nulling:function(){zk=gY=AO=yY=OO=LV=DV=null,lo.length=0},_handleFallbackAutoScroll:function(i){this._handleAutoScroll(i,!0)},_handleAutoScroll:function(i,r){var n=this,s=(i.touches?i.touches[0]:i).clientX,o=(i.touches?i.touches[0]:i).clientY,a=document.elementFromPoint(s,o);if(zk=i,r||this.options.forceAutoScrollFallback||u$||Ky||kR){NV(i,this.options,a,r);var l=nv(a,!0);yY&&(!OO||s!==LV||o!==DV)&&(OO&&_fe(),OO=setInterval(function(){var c=nv(document.elementFromPoint(s,o),!0);c!==l&&(l=c,V4()),NV(i,n.options,c,r)},10),LV=s,DV=o)}else{if(!this.options.bubbleScroll||nv(a,!0)===xm()){V4();return}NV(i,this.options,nv(a,!1),!1)}}},Ly(t,{pluginName:"scroll",initializeByDefault:!0})}function V4(){lo.forEach(function(t){clearInterval(t.pid)}),lo=[]}function _fe(){clearInterval(OO)}var NV=p$e(function(t,e,i,r){if(e.scroll){var n=(t.touches?t.touches[0]:t).clientX,s=(t.touches?t.touches[0]:t).clientY,o=e.scrollSensitivity,a=e.scrollSpeed,l=xm(),c=!1,h;gY!==i&&(gY=i,V4(),AO=e.scroll,h=e.scrollFn,AO===!0&&(AO=nv(i,!0)));var d=0,f=AO;do{var m=f,y=ko(m),_=y.top,v=y.bottom,w=y.left,x=y.right,T=y.width,S=y.height,C=void 0,A=void 0,R=m.scrollWidth,D=m.scrollHeight,N=ri(m),k=m.scrollLeft,B=m.scrollTop;m===l?(C=T<R&&(N.overflowX==="auto"||N.overflowX==="scroll"||N.overflowX==="visible"),A=S<D&&(N.overflowY==="auto"||N.overflowY==="scroll"||N.overflowY==="visible")):(C=T<R&&(N.overflowX==="auto"||N.overflowX==="scroll"),A=S<D&&(N.overflowY==="auto"||N.overflowY==="scroll"));var L=C&&(Math.abs(x-n)<=o&&k+T<R)-(Math.abs(w-n)<=o&&!!k),z=A&&(Math.abs(v-s)<=o&&B+S<D)-(Math.abs(_-s)<=o&&!!B);if(!lo[d])for(var j=0;j<=d;j++)lo[j]||(lo[j]={});(lo[d].vx!=L||lo[d].vy!=z||lo[d].el!==m)&&(lo[d].el=m,lo[d].vx=L,lo[d].vy=z,clearInterval(lo[d].pid),(L!=0||z!=0)&&(c=!0,lo[d].pid=setInterval(function(){r&&this.layer===0&&ni.active._onTouchMove(zk);var H=lo[this.layer].vy?lo[this.layer].vy*a:0,X=lo[this.layer].vx?lo[this.layer].vx*a:0;typeof h=="function"&&h.call(ni.dragged.parentNode[Nu],X,H,t,zk,lo[this.layer].el)!=="continue"||f$e(lo[this.layer].el,X,H)}.bind({layer:d}),24))),d++}while(e.bubbleScroll&&f!==l&&(f=nv(f,!1)));yY=c}},30),w$e=function(e){var i=e.originalEvent,r=e.putSortable,n=e.dragEl,s=e.activeSortable,o=e.dispatchSortableEvent,a=e.hideGhostForTarget,l=e.unhideGhostForTarget;if(i){var c=r||s;a();var h=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:i,d=document.elementFromPoint(h.clientX,h.clientY);l(),c&&!c.el.contains(d)&&(o("spill"),this.onSpill({dragEl:n,putSortable:r}))}};function fte(){}fte.prototype={startIndex:null,dragStart:function(e){var i=e.oldDraggableIndex;this.startIndex=i},onSpill:function(e){var i=e.dragEl,r=e.putSortable;this.sortable.captureAnimationState(),r&&r.captureAnimationState();var n=yC(this.sortable.el,this.startIndex,this.options);n?this.sortable.el.insertBefore(i,n):this.sortable.el.appendChild(i),this.sortable.animateAll(),r&&r.animateAll()},drop:w$e};Ly(fte,{pluginName:"revertOnSpill"});function mte(){}mte.prototype={onSpill:function(e){var i=e.dragEl,r=e.putSortable,n=r||this.sortable;n.captureAnimationState(),i.parentNode&&i.parentNode.removeChild(i),n.animateAll()},drop:w$e};Ly(mte,{pluginName:"removeOnSpill"});ni.mount(new rEt);ni.mount(mte,fte);function vfe(t,e,i){t.splice(i,0,t.splice(e,1)[0])}const nEt=Je.ofType(dte),bfe="data-sort-filter",wfe="data-layer-uid",sEt="layerUid",Gn="esri-layer-list",ts=`${Gn}__item`,Pt={base:Gn,widgetIcon:vn.layers,newUI:`${Gn}--new-ui`,noItems:`${Gn}__no-items`,list:`${Gn}__list`,listRoot:`${Gn}__list--root`,listExclusive:`${Gn}__list--exclusive`,listEmpty:`${Gn}__list--empty`,listEmptyState:`${Gn}__list-empty-state`,listEmptyStateDragEnabled:`${Gn}__list-empty-state--drag-enabled`,listInherited:`${Gn}__list--inherited`,listIndependent:`${Gn}__list--independent`,item:ts,itemContent:`${ts}-content`,itemMessage:`${ts}--has-message`,itemInvisible:`${ts}--invisible`,itemInvisibleAtScale:`${ts}--invisible-at-scale`,itemChildren:`${ts}--has-children`,itemSelectable:`${ts}--selectable`,itemContainer:`${ts}-container`,actionsMenu:`${ts}-actions-menu`,actionsMenuItem:`${ts}-actions-menu-item`,actionsMenuItemActive:`${ts}-actions-menu-item--active`,actions:`${ts}-actions`,actionsList:`${ts}-actions-list`,action:`${ts}-action`,actionIcon:`${ts}-action-icon`,actionImage:`${ts}-action-image`,actionTitle:`${ts}-action-title`,actionToggle:`${Gn}__action-toggle`,actionToggleOn:`${Gn}__action-toggle--on`,label:`${ts}-label`,message:`${ts}-message`,title:`${ts}-title`,statusIndicator:`${Gn}__status-indicator`,publishing:`${Gn}__publishing`,updating:`${Gn}__updating`,connectionStatus:`${Gn}__connection-status`,connectionStatusConnected:`${Gn}__connection-status--connected`,toggleVisible:`${ts}-toggle`,toggleVisibleIcon:`${ts}-toggle-icon`,toggleIcon:`${ts}-toggle-icon`,radioIcon:`${ts}-radio-icon`,childToggle:`${Gn}__child-toggle`,childToggleOpen:`${Gn}__child-toggle--open`,childOpened:`${Gn}__child-toggle-icon--opened`,childClosed:`${Gn}__child-toggle-icon--closed`,childClosed_RTL:`${Gn}__child-toggle-icon--closed-rtl`,sortableChosen:`${Gn}--chosen`},G0={actions:"actions",actionSection:"action-section",items:"items"},KA={exclusive:"exclusive",inherited:"inherited",independent:"independent"};function x$e(t){const{actionsOpen:e,children:i}=t;e&&(t.actionsOpen=!1),i.forEach(r=>x$e(r))}const FV="root",xfe={statusIndicators:!0,errors:!1};let yn=class extends Yp{constructor(e,i){super(e,i),this._sortableNodes=new Map,this._sortableMap=new Map,this._focusSortUid=null,this._tooltipReferenceMap=new Map,this.visibleItems=null,this.iconClass=Pt.widgetIcon,this.icon=null,this.listItemCanGiveFunction=null,this.listItemCanReceiveFunction=null,this.messages=null,this.messagesCommon=null,this.multipleSelectionEnabled=!1,this.selectionEnabled=!1,this.selectedItems=new nEt,this.style="classic",this.viewModel=new l$e,this.visibleElements={...xfe},this._onSortableSort=({to:r,from:n,item:s,newIndex:o})=>{n&&r&&(n===r?this._sortLayers(this._sortableMap.get(n.dataset.group)):this._moveLayerFromChildList({to:r,from:n,item:s,newIndex:o}))},this._sortableCanSort=(r,n)=>!(!r.el.dataset.group||!n.el.dataset.group),this._sortableCanPull=(r,n,s)=>{const{listItemCanGiveFunction:o}=this,a={selected:Xo(s),from:Xo(n.el),to:Xo(r.el)};return!this._sortableCanSort(r,n)||typeof o!="function"||o.call(null,a)},this._sortableCanPut=(r,n,s)=>{const{listItemCanReceiveFunction:o}=this,a={selected:Xo(s),from:Xo(n.el),to:Xo(r.el)};return!this._sortableCanSort(r,n)||typeof o!="function"||o.call(null,a)},this._onSortableEnd=({oldIndex:r,from:n,to:s,item:o})=>{n!==s&&n.insertBefore(o,n.children[r])}}initialize(){const e=this.operationalItems;this._setVisibleItems(e),this.addHandles([bo(()=>this.operationalItems,"change",()=>this._itemsChanged(e)),ne(()=>this.visibleElements,()=>this._itemsChanged(e)),ne(()=>this.selectionEnabled,()=>this._toggleAllSorting(),Xt)])}loadDependencies(){return ute({icon:()=>ce(()=>import("./calcite-icon-d39f2d3b.js"),[],import.meta.url),tooltip:()=>ce(()=>import("./calcite-tooltip-ea77f617.js"),["./calcite-tooltip-ea77f617.js","./FloatingArrow-e9ccc34e.js","./debounce-a16039dc.js","./openCloseComponent-4ef64318.js"],import.meta.url)})}destroy(){this._destroySortables(),this._tooltipReferenceMap.clear()}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get listItemCreatedFunction(){return this.viewModel.listItemCreatedFunction}set listItemCreatedFunction(e){this.viewModel.listItemCreatedFunction=e}get operationalItems(){return this.viewModel.operationalItems}set operationalItems(e){this.viewModel.operationalItems=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}castVisibleElements(e){return{...xfe,...e}}triggerAction(e,i){return this.viewModel.triggerAction(e,i)}render(){const{visibleItems:e,style:i}=this,r=this.viewModel?.state,n={[Pt.newUI]:i==="modern",[Ps.hidden]:r==="loading",[Ps.disabled]:r==="disabled"},s=this._renderItemTooltips(),o=this._renderItems();return Ce("div",{class:this.classes(Pt.base,Ps.widget,Ps.panel,n)},e.length?[s,o]:this._renderNoItems())}_renderItemTooltip(e){const{_tooltipReferenceMap:i,messages:r}=this;return e?Ce("calcite-tooltip",{referenceElement:i.get(e.uid)},r.layerIncompatibleTooltip):null}_renderItemTooltipNodes(e){const{incompatible:i,children:r}=e;return[i?this._renderItemTooltip(e):null,...!i&&r?r.toArray().map(n=>this._renderItemTooltipNodes(n)):[]]}_renderItemTooltips(){return this.visibleItems.toArray().map(e=>this._renderItemTooltipNodes(e))??[]}_renderNoItems(){return Ce("div",{class:Pt.noItems},this.messages.noItemsToDisplay)}_renderItems(){const{visibleItems:e,selectionEnabled:i,messages:r}=this;return Ce("ul",{afterCreate:this._sortNodeCreated,afterRemoved:this._sortNodeRemoved,afterUpdate:this._sortNodeCreated,"aria-label":r.widgetLabel,bind:this,class:this.classes(Pt.list,Pt.listRoot,Pt.listIndependent),"data-group":FV,role:i?"listbox":void 0},e.map(n=>this._renderItem(n,null)).toArray())}_renderActionsMenuIcon(e,i){const{messagesCommon:r}=this,n={[Pt.actionsMenuItemActive]:e.actionsOpen};return Ce("div",{"aria-controls":i,"aria-label":r.options,bind:this,class:this.classes(Pt.actionsMenuItem,n),"data-item":e,key:"actions-menu-toggle",onclick:this._toggleActionsOpen,onkeydown:this._toggleActionsOpen,role:"button",tabIndex:0,title:r.options},Ce("span",{"aria-hidden":"true",class:vn.handleHorizontal}))}_renderActionsMenu(e,i,r,n){const{panel:s}=e,o=s&&s.visible?this._renderPanelButton(s):null,a=r===1&&this._getSingleActionButton(i),l=a?this._renderAction({item:e,action:a,singleAction:!0}):null,c=!a&&r?this._renderActionsMenuIcon(e,n):null;return c||o||a?Ce("div",{class:Pt.actionsMenu,key:"actions-menu"},o,l,c):null}_renderChildList(e,i){const{selectionEnabled:r}=this,{visibilityMode:n,children:s}=e,o=this._hasChildren(e),a=!o&&r&&e.layer?.type==="group",{exclusive:l,inherited:c}=KA,h={[Pt.listEmpty]:!o,[Pt.listExclusive]:n===l,[Pt.listInherited]:n===c,[Pt.listIndependent]:n!==c&&n!==l},d={[Pt.listEmptyState]:!0,[Pt.listEmptyStateDragEnabled]:r};return o||a?o?Ce("ul",{afterCreate:this._sortNodeCreated,afterRemoved:this._sortNodeRemoved,afterUpdate:this._sortNodeCreated,"aria-expanded":e.open?"true":"false",bind:this,class:this.classes(Pt.list,h),"data-group":e.uid,"data-item":e,hidden:!e.open&&!a||null,id:i,key:"list-items",role:r?"listbox":n===l?"radiogroup":"group"},s?.map(f=>this._renderItem(f,e)).toArray()):Ce("div",{afterCreate:this._sortNodeCreated,afterRemoved:this._sortNodeRemoved,afterUpdate:this._sortNodeCreated,bind:this,class:this.classes(d),"data-group":e.uid,"data-item":e,id:i,key:"list-items"},this.messages.noItemsToDisplay):null}_renderChildrenToggle(e,i){const{messagesCommon:r}=this,n=this._hasChildren(e),s={[Pt.childToggleOpen]:e.open},o=e.open?r.collapse:r.expand;return n?Ce("span",{"aria-controls":i,"aria-label":o,class:this.classes(Pt.childToggle,s),"data-item":e,key:"toggle-children",onclick:this._toggleChildrenClick,onkeydown:this._toggleChildrenClick,role:"button",tabIndex:0,title:o},Ce("span",{"aria-hidden":"true",class:this.classes(Pt.childClosed,vn.rightTriangleArrow)}),Ce("span",{"aria-hidden":"true",class:this.classes(Pt.childOpened,vn.downArrow)}),Ce("span",{"aria-hidden":"true",class:this.classes(Pt.childClosed_RTL,vn.leftTriangleArrow)})):null}_renderItemMessage(e){return e.error?Ce("div",{class:Pt.message,key:"esri-layer-list__error",role:"alert"},Ce("span",{"aria-hidden":"true",class:vn.noticeTriangle}),this.messages.layerError):e.incompatible?Ce("div",{class:Pt.message,key:"esri-layer-list__incompatible",role:"alert"},Ce("span",{afterCreate:i=>this._setTooltipReference(i,e),"aria-hidden":"true",bind:this,class:vn.noticeTriangle,tabIndex:0}),this.messages.layerIncompatible):null}_renderItemContent(e,i,r){const{id:n}=this,s=`${n}_${e.uid}`,o=`${s}_actions`,a=`${s}__list`,{panel:l}=e,c=this._filterActions(e.actionsSections),h=this._countActions(c);return[Ce("div",{class:Pt.itemContainer,key:"list-item-container"},this._renderChildrenToggle(e,a),this._renderLabel(e,i,r),this._renderActionsMenu(e,c,h,o)),this._renderItemMessage(e),h?this._renderActionsSections(e,c,o):null,l&&l.open&&!l.disabled?l.render():null,this._renderChildList(e,a)]}_renderItem(e,i){const{style:r,id:n,selectionEnabled:s,selectedItems:o}=this,a=`${`${n}_${e.uid}`}__title`,l=this._hasMessage(e),c=this._hasChildren(e),h={[Pt.itemChildren]:c,[Pt.itemMessage]:!!l,[Pt.itemInvisible]:r==="modern"&&!e.visible,[Pt.itemInvisibleAtScale]:!e.visibleAtCurrentScale,[Pt.itemSelectable]:s};if(s){const d={[wfe]:e.layer?.uid,[bfe]:(!e.sortable).toString()};return Ce("li",{afterCreate:this._focusListItem,afterUpdate:this._focusListItem,"aria-labelledby":a,"aria-selected":CV(e,o)?"true":"false",bind:this,class:this.classes(Pt.item,h),"data-group":i?i.uid:FV,"data-item":e,key:`item-with-selection-${e.uid}`,onclick:this._toggleSelection,onkeydown:this._selectionKeydown,role:"option",tabIndex:0,...d},this._renderItemContent(e,i,a))}return Ce("li",{afterCreate:this._focusListItem,afterUpdate:this._focusListItem,"aria-labelledby":a,bind:this,class:this.classes(Pt.item,h),key:`item-no-selection-${e.uid}`},this._renderItemContent(e,i,a))}_renderConnectionIcon(e){const{connectionStatus:i}=e;return i!=null?Ce("calcite-icon",{icon:i==="connected"?"beacon":"offline",scale:"s"}):null}_renderItemStatus(e,i){const{visibleElements:r}=this;if(!r.statusIndicators)return null;const{connectionStatus:n,publishing:s,updating:o}=e,a=o&&!i,l=!!n;return Ce("span",{class:this.classes({[Pt.statusIndicator]:!0,[Pt.publishing]:s,[Pt.updating]:a,[Pt.connectionStatus]:l,[Pt.connectionStatusConnected]:l&&n==="connected"}),key:"layer-item-status"},this._renderConnectionIcon(e))}_renderItemTitle(e,i){const{messages:r}=this;if(!e)return null;const n=e.title||r.untitledLayer,s=e.visibleAtCurrentScale?n:`${n} (${r.layerInvisibleAtScale})`;return Ce("span",{"aria-label":s,class:Pt.title,id:i,key:"layer-title-container",title:s},n)}_renderItemToggleIcon({visible:e},i){const{style:r}=this,{exclusive:n}=KA,s=i?.visibilityMode,o=r==="modern",a=s===n,l={[Pt.toggleVisibleIcon]:o,[Pt.toggleIcon]:o&&!a,[Pt.radioIcon]:o&&a,[vn.radioChecked]:a&&e,[vn.radioUnchecked]:a&&!e,[vn.visible]:!a&&e,[vn.nonVisible]:!a&&!e};return Ce("span",{"aria-hidden":"true",class:this.classes(l),key:"item-toggle-icon"})}_renderItemToggle(e,i,r){const{selectionEnabled:n,messages:s}=this,{exclusive:o}=KA,a=i?.visibilityMode,l=a===o?"radio":"switch";return Ce("span",n?{"aria-checked":e.visible?"true":"false","aria-labelledby":r,bind:this,class:Pt.toggleVisible,"data-item":e,"data-parent-visibility":a,key:"item-toggle-selection-enabled",onclick:this._toggleVisibility,onkeydown:this._toggleVisibility,role:l,tabIndex:0,title:s.layerVisibility}:{class:Pt.toggleVisible,key:"item-toggle"},this._renderItemToggleIcon(e,i))}_renderLabel(e,i,r){const{selectionEnabled:n,style:s,messages:o}=this,{inherited:a,exclusive:l}=KA,c=i?.visibilityMode,h=c===l?"radio":"switch",d=this._renderItemTitle(e,r),f=this._renderItemStatus(e,i),m=this._renderItemToggle(e,i,r),y=s==="modern"?[d,f,m]:[m,d,f],_=Ce("div",n?{class:Pt.label,key:`item-label-no-selection-${e.uid}`}:{"aria-checked":e.visible?"true":"false","aria-labelledby":r,bind:this,class:Pt.label,"data-item":e,"data-parent-visibility":c,key:`item-label-with-selection-${e.uid}`,onclick:this._toggleVisibility,onkeydown:this._toggleVisibility,role:h,tabIndex:0,title:o.layerVisibility},y);return c===a||e.error?Ce("div",{class:Pt.label,key:`item-label-container-${e.uid}`},this._renderItemTitle(e,r),this._renderItemStatus(e,i)):_}_renderPanelButton(e){const{className:i,open:r,title:n,image:s,disabled:o}=e,a=s||i?i:vn.defaultAction,l=this._getIconImageStyles(e),c={[Pt.actionsMenuItemActive]:r&&!o},h={[Pt.actionImage]:!!l["background-image"],[Ps.disabledElement]:e.disabled};return a&&(h[a]=!!a),Ce("div",{"aria-disabled":e.disabled.toString(),"aria-label":n,bind:this,class:this.classes(Pt.actionsMenuItem,c),"data-panel":e,key:`panel-${e.uid}`,onclick:this._triggerPanel,onkeydown:this._triggerPanel,role:"button",tabIndex:e.disabled?void 0:0,title:n},Ce("span",{class:this.classes(h),styles:l}))}_renderActionsSections(e,i,r){const n=i.toArray().map((s,o)=>Ce("ul",{class:Pt.actionsList,key:`${e}-action-section-${o}`},this._renderActionSection(e,s)));return Ce("div",{"aria-expanded":e.actionsOpen?"true":"false",class:Pt.actions,hidden:!e.actionsOpen||null,id:r,key:"actions-section",role:"group"},n)}_renderActionSection(e,i){return(i&&i.toArray()).map(r=>this._renderAction({item:e,action:r}))}_renderActionIcon(e){const{active:i,className:r}=e,n=this._getIconImageStyles(e),s=e.type!=="button"||e.image||r?r:vn.defaultAction,o={[Pt.actionImage]:!i&&!!n["background-image"],[vn.loadingIndicator]:i,[Ps.rotating]:i};return s&&!i&&(o[s]=!0),Ce("span",{"aria-hidden":"true",class:this.classes(Pt.actionIcon,o),key:"action-icon",styles:n})}_renderActionTitle(e,i){return i?null:Ce("span",{class:Pt.actionTitle,key:"action-title"},e)}_renderAction(e){const{item:i,action:r,singleAction:n}=e,{active:s,disabled:o,title:a}=r,l={[Pt.actionsMenuItem]:n&&r.type==="button",[Pt.action]:s||!n&&r.type!=="toggle",[Pt.actionToggle]:!s&&r.type==="toggle",[Pt.actionToggleOn]:!s&&r.type==="toggle"&&r.value,[Ps.disabledElement]:o},c=[this._renderActionIcon(r),this._renderActionTitle(a,n)];return n?Ce("div",{"aria-label":a??void 0,bind:this,classes:l,"data-action":r,"data-item":i,key:`single-action-${r.uid}`,onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:0,title:a??void 0},c):Ce("li",{"aria-label":a??void 0,bind:this,classes:l,"data-action":r,"data-item":i,key:`action-${r.uid}`,onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:0,title:a??void 0},c)}_setTooltipReference(e,i){this._tooltipReferenceMap.set(i.uid,e),this.scheduleRender()}_hasMessage(e){return!!e.error||e.incompatible}_hasChildren(e){return!!e.children.length&&!this._hasMessage(e)}_sortNodeRemoved(e){const{_sortableMap:i}=this,r=e.dataset.group,n=i.get(r);n&&n.destroy(),i.delete(r)}_destroySortables(){const{_sortableMap:e,_sortableNodes:i}=this;e.forEach(r=>r&&r.destroy()),e.clear(),i.clear()}_moveLayerFromChildList({to:e,from:i,item:r,newIndex:n}){const s=Xo(r),o=Xo(e),a=Xo(i);this.viewModel.moveListItem(s,a,o,n)}_sortLayers(e){if(!e)return;const i=Xo(e.el),r=e.toArray();i?T2t(i,r):i$e(this.view?.map?.layers,r)}_toggleSorting(e,i){const{_sortableMap:r,selectionEnabled:n}=this,s=r.get(i),o=Xo(e),a=(i===FV||o?.childrenSortable&&b2t(o))&&n;if(s)s.option("disabled",!a);else if(a){const l=ni.create(e,{dataIdAttr:wfe,group:{name:i,pull:this._sortableCanPull,put:this._sortableCanPut},filter:`[${bfe}="true"]`,fallbackTolerance:4,onSort:this._onSortableSort,onEnd:this._onSortableEnd,disabled:!a,chosenClass:Pt.sortableChosen});r.set(i,l)}}_toggleAllSorting(){this._sortableNodes.forEach((e,i)=>this._toggleSorting(e,i))}_sortNodeCreated(e){const i=e.dataset.group;i&&(this._sortableNodes.set(i,e),this._toggleSorting(e,i))}_setVisibleItems(e){this.visibleItems=e.filter(i=>!i.hidden&&(this.visibleElements.errors||!i.error))}_getSingleActionButton(e){return e.reduce(i=>i).filter(i=>i&&i.type==="button").at(0)}_focusListItem(e){const{_focusSortUid:i}=this;if(!e||!i)return;Xo(e)?.layer?.uid===i&&(e.focus(),this._focusSortUid=null)}_watchActionSectionChanges(e){this.addHandles(e.on("change",this.scheduleRender.bind(this)),G0.actionSection),e.forEach(i=>this._renderOnActionChanges(i))}_renderOnActionChanges(e){e.type!=="toggle"?e.type!=="slider"?this.addHandles(ne(()=>[e?.className,e?.image,e?.id,e?.title,e?.visible],()=>this.scheduleRender(),Xt),G0.actions):this.addHandles(ne(()=>[e?.className,e?.id,e?.title,e?.visible,e?.value,e?.displayValueEnabled,e?.max,e?.min,e?.step],()=>this.scheduleRender(),Xt),G0.actions):this.addHandles(ne(()=>[e?.className,e?.image,e?.id,e?.title,e?.visible,e?.value],()=>this.scheduleRender(),Xt),G0.actions)}_renderOnItemChanges(e){this.addHandles([ne(()=>[e?.actionsOpen,e?.visible,e?.open,e?.updating,e?.connectionStatus,e?.publishing,e?.title,e?.visibleAtCurrentScale,e?.error,e?.visibilityMode,e?.panel,e?.panel?.title,e?.panel?.content,e?.panel?.className,e?.sortable,e?.childrenSortable],()=>this.scheduleRender(),Ji),ne(()=>[e?.hidden,e?.error],()=>this._setVisibleItems(this.operationalItems)),e.actionsSections.on("change",()=>this.scheduleRender()),e.children.on("change",()=>this.scheduleRender())],G0.items),e.children.forEach(i=>this._renderOnItemChanges(i)),e.actionsSections.forEach(i=>this._watchActionSectionChanges(i))}_itemsChanged(e){this.removeHandles(G0.items),this.removeHandles(G0.actions),this.removeHandles(G0.actionSection),e.forEach(i=>this._renderOnItemChanges(i)),this._tooltipReferenceMap.clear(),this._setVisibleItems(e),this.scheduleRender()}_filterActions(e){return e.map(i=>i.filter(r=>r.visible))}_countActions(e){return e.reduce((i,r)=>i+r.length,0)}_getIconImageStyles(e){const i=e.declaredClass==="esri.widgets.LayerList.ListItemPanel"||e.declaredClass==="esri.support.Action.ActionButton"||e.declaredClass==="esri.support.Action.ActionToggle"?e.image:null;return{"background-image":i?`url("${i}")`:void 0}}_selectionKeydown(e){const i=["ArrowDown","ArrowUp"],r=Jme(e);if(!i.includes(r))return void this._toggleSelection(e);e.stopPropagation();const n=e.currentTarget,s=Xo(n),{_sortableMap:o,selectedItems:a}=this,l=n.dataset.group,c=o.get(l);if(!c||!s)return;const h=CV(s,a),d=c.toArray(),f=e.target,m=d.indexOf(f.dataset[sEt]);if(m!==-1){if(r==="ArrowDown"){const y=m+1;if(y>=d.length)return;h?(vfe(d,m,y),c.sort(d),this._sortLayers(c),this._focusSortUid=s.layer?.uid):(this._focusSortUid=s.layer?.uid,this.scheduleRender())}if(r==="ArrowUp"){const y=m-1;if(y<=-1)return;h?(vfe(d,m,y),c.sort(d),this._sortLayers(c),this._focusSortUid=s.layer?.uid):(this._focusSortUid=s.layer?.uid,this.scheduleRender())}}}_toggleActionsOpen(e){const i=Xo(e.currentTarget);if(!i)return;const{actionsOpen:r}=i,n=!r;n&&this.operationalItems.forEach(s=>x$e(s)),i.actionsOpen=n,e.stopPropagation()}_triggerPanel(e){const i=oEt(e.currentTarget);e.stopPropagation(),i&&!i.disabled&&(i.open=!i.open)}_triggerAction(e){const i=e.currentTarget,r=aEt(i),n=Xo(i);r&&n&&(r.type==="toggle"&&(r.value=!r.value),this.triggerAction(r,n),e.stopPropagation())}_toggleVisibility(e){const i=e.currentTarget,r=i.getAttribute("data-parent-visibility"),n=Xo(i);n&&(r===KA.exclusive&&n.visible||(n.visible=!n.visible),e.stopPropagation())}_toggleChildrenClick(e){const i=Xo(e.currentTarget);i&&(i.open=!i.open,e.stopPropagation())}_toggleSelection(e){e.stopPropagation();const{multipleSelectionEnabled:i,selectedItems:r}=this,n=Xo(e.currentTarget);if(!n)return;const s=CV(n,r),{length:o}=r;if(!i)return o&&!(s&&o===1)?(r.removeAll(),void r.add(n)):void(s?r.remove?.(s):r.add(n));s?r.remove?.(s):r.add(n)}get test(){return{visibleItems:this.visibleItems}}};function Xo(t){return t?.["data-item"]}function oEt(t){return t?.["data-panel"]}function aEt(t){return t?.["data-action"]}u([p()],yn.prototype,"visibleItems",void 0),u([p()],yn.prototype,"iconClass",void 0),u([p()],yn.prototype,"icon",void 0),u([p()],yn.prototype,"label",null),u([p()],yn.prototype,"listItemCanGiveFunction",void 0),u([p()],yn.prototype,"listItemCanReceiveFunction",void 0),u([p()],yn.prototype,"listItemCreatedFunction",null),u([p(),Lm("esri/widgets/LayerList/t9n/LayerList")],yn.prototype,"messages",void 0),u([p(),Lm("esri/t9n/common")],yn.prototype,"messagesCommon",void 0),u([p()],yn.prototype,"multipleSelectionEnabled",void 0),u([p()],yn.prototype,"operationalItems",null),u([p()],yn.prototype,"selectionEnabled",void 0),u([p()],yn.prototype,"selectedItems",void 0),u([p()],yn.prototype,"style",void 0),u([p()],yn.prototype,"view",null),u([d2t("trigger-action"),p({type:l$e})],yn.prototype,"viewModel",void 0),u([p()],yn.prototype,"visibleElements",void 0),u([ai("visibleElements")],yn.prototype,"castVisibleElements",null),u([Zf()],yn.prototype,"_toggleActionsOpen",null),u([Zf()],yn.prototype,"_triggerPanel",null),u([Zf()],yn.prototype,"_triggerAction",null),u([Zf()],yn.prototype,"_toggleVisibility",null),u([Zf()],yn.prototype,"_toggleChildrenClick",null),u([Zf()],yn.prototype,"_toggleSelection",null),yn=u([M("esri.widgets.LayerList")],yn);const lEt=yn;var cEt=Object.defineProperty,uEt=Object.getOwnPropertyDescriptor,hEt=(t,e,i,r)=>{for(var n=r>1?void 0:r?uEt(e,i):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(n=(r?o(e,i,n):o(n))||n);return r&&n&&cEt(e,i,n),n};let Bk=class extends Yp{constructor(t){super(t)}};Bk=hEt([M("arcgis-core-template..Widget")],Bk);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */function dEt(){return navigator.userAgentData}function pEt(){const t=dEt();return t?.brands?t.brands.map(({brand:e,version:i})=>`${e}/${i}`).join(" "):navigator.userAgent}const nT=/firefox/i.test(pEt()),d$=nT?new WeakMap:null;function fEt(){const{disabled:t}=this;t||HTMLElement.prototype.click.call(this)}function T$e(t){const e=t.target;if(nT&&!d$.get(e))return;const{disabled:i}=e;i&&t.preventDefault()}const S$e=["mousedown","mouseup","click"];function E$e(t){if(nT&&!d$.get(t.target))return;const{disabled:e}=t.target;e&&(t.stopImmediatePropagation(),t.preventDefault())}const Vk={capture:!0};function x8(t,e=!1){if(t.disabled){t.el.setAttribute("tabindex","-1"),t.el.setAttribute("aria-disabled","true"),t.el.contains(document.activeElement)&&document.activeElement.blur(),C$e(t);return}O$e(t),typeof e=="function"?t.el.setAttribute("tabindex",e.call(t)?"0":"-1"):e===!0?t.el.setAttribute("tabindex","0"):e===!1&&t.el.removeAttribute("tabindex"),t.el.removeAttribute("aria-disabled")}function C$e(t){t.el.click=fEt,mEt(nT?A$e(t):t.el)}function mEt(t){t&&(t.addEventListener("pointerdown",T$e,Vk),S$e.forEach(e=>t.addEventListener(e,E$e,Vk)))}function A$e(t){return d$.get(t.el)}function O$e(t){delete t.el.click,gEt(nT?A$e(t):t.el)}function gEt(t){t&&(t.removeEventListener("pointerdown",T$e,Vk),S$e.forEach(e=>t.removeEventListener(e,E$e,Vk)))}function T8(t){if(!t.disabled||!nT)return;const e=t.el.parentElement||t.el;d$.set(t.el,e),C$e(t)}function S8(t){nT&&(d$.delete(t.el),O$e(t))}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const R$e=new WeakMap,P$e=new WeakMap;function Qy(t){P$e.set(t,new Promise(e=>R$e.set(t,e)))}function e0(t){R$e.get(t)()}function yEt(t){return P$e.get(t)}async function t0(t){return await yEt(t),ote(t),new Promise(e=>requestAnimationFrame(()=>e()))}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */function M$e(t){return t==="Enter"||t===" "}const $$e=["0","1","2","3","4","5","6","7","8","9"];/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */function qv(t,e,i){const r=_Et(t);return new r(e,i)}function _Et(t){class e extends window.MutationObserver{constructor(r){super(r),this.observedEntry=[],this.callback=r}observe(r,n){return this.observedEntry.push({target:r,options:n}),super.observe(r,n)}unobserve(r){const n=this.observedEntry.filter(s=>s.target!==r);this.observedEntry=[],this.callback(super.takeRecords(),this),this.disconnect(),n.forEach(s=>this.observe(s.target,s.options))}}return function(){return t==="intersection"?window.IntersectionObserver:t==="mutation"?e:window.ResizeObserver}()}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const vEt=new RegExp("\\.(0+)?$"),bEt=new RegExp("0+$");class Fr{constructor(e){if(e instanceof Fr)return e;const[i,r]=CEt(e).split(".").concat("");this.value=BigInt(i+r.padEnd(Fr.DECIMALS,"0").slice(0,Fr.DECIMALS))+BigInt(Fr.ROUNDED&&r[Fr.DECIMALS]>="5"),this.isNegative=e.charAt(0)==="-"}getIntegersAndDecimals(){const e=this.value.toString().replace("-","").padStart(Fr.DECIMALS+1,"0"),i=e.slice(0,-Fr.DECIMALS),r=e.slice(-Fr.DECIMALS).replace(bEt,"");return{integers:i,decimals:r}}toString(){const{integers:e,decimals:i}=this.getIntegersAndDecimals();return`${this.isNegative?"-":""}${e}${i.length?"."+i:""}`}formatToParts(e){const{integers:i,decimals:r}=this.getIntegersAndDecimals(),n=e.numberFormatter.formatToParts(BigInt(i));return this.isNegative&&n.unshift({type:"minusSign",value:e.minusSign}),r.length&&(n.push({type:"decimal",value:e.decimal}),r.split("").forEach(s=>n.push({type:"fraction",value:s}))),n}format(e){const{integers:i,decimals:r}=this.getIntegersAndDecimals(),n=`${this.isNegative?e.minusSign:""}${e.numberFormatter.format(BigInt(i))}`,s=r.length?`${e.decimal}${r.split("").map(o=>e.numberFormatter.format(Number(o))).join("")}`:"";return`${n}${s}`}add(e){return Fr.fromBigInt(this.value+new Fr(e).value)}subtract(e){return Fr.fromBigInt(this.value-new Fr(e).value)}multiply(e){return Fr._divRound(this.value*new Fr(e).value,Fr.SHIFT)}divide(e){return Fr._divRound(this.value*Fr.SHIFT,new Fr(e).value)}}Fr.DECIMALS=100;Fr.ROUNDED=!0;Fr.SHIFT=BigInt("1"+"0".repeat(Fr.DECIMALS));Fr._divRound=(t,e)=>Fr.fromBigInt(t/e+(Fr.ROUNDED?t*BigInt(2)/e%BigInt(2):BigInt(0)));Fr.fromBigInt=t=>Object.assign(Object.create(Fr.prototype),{value:t,isNegative:t<BigInt(0)});function gte(t){return!(!t||isNaN(Number(t)))}function GGt(t){return!t||!AEt(t)?"":Gk(t,e=>{let i=!1;const r=e.split("").filter((n,s)=>n.match(/\./g)&&!i?(i=!0,!0):n.match(/\-/g)&&s===0?!0:$$e.includes(n)).join("");return gte(r)?new Fr(r).toString():""})}const I$e=/^([-0])0+(?=\d)/,wEt=/(?!^\.)\.$/,xEt=/(?!^-)-/g,TEt=/^-\b0\b\.?0*$/,SEt=/0*$/,jGt=t=>Gk(t,e=>{const i=e.replace(xEt,"").replace(wEt,"").replace(I$e,"$1");return gte(i)?TEt.test(i)?i:EEt(i):e});function EEt(t){const e=t.split(".")[1],i=new Fr(t).toString(),[r,n]=i.split(".");return e&&n!==e?`${r}.${e}`:i}function Gk(t,e){if(!t)return t;const i=t.toLowerCase().indexOf("e")+1;return i?t.replace(/[eE]*$/g,"").substring(0,i).concat(t.slice(i).replace(/[eE]/g,"")).split(/[eE]/).map((r,n)=>e(n===1?r.replace(/\./g,""):r)).join("e").replace(/^e/,"1e"):e(t)}function CEt(t){const e=t.split(/[eE]/);if(e.length===1)return t;const i=+t;if(Number.isSafeInteger(i))return`${i}`;const r=t.charAt(0)==="-",n=+e[1],s=e[0].split("."),o=(r?s[0].substring(1):s[0])||"",a=s[1]||"",l=(d,f)=>{const m=Math.abs(f)-d.length,y=m>0?`${"0".repeat(m)}${d}`:d;return`${y.slice(0,f)}.${y.slice(f)}`},c=(d,f)=>{const m=f>d.length?`${d}${"0".repeat(f-d.length)}`:d;return`${m.slice(0,f)}.${m.slice(f)}`},h=n>0?`${o}${c(a,n)}`:`${l(o,n)}${a}`;return`${r?"-":""}${h.charAt(0)==="."?"0":""}${h.replace(vEt,"").replace(I$e,"")}`}function AEt(t){return $$e.some(e=>t.includes(e))}function HGt(t,e,i){const r=e.split(".")[1];if(r){const n=r.match(SEt)[0];if(n&&i.delocalize(t).length!==e.length&&r.indexOf("e")===-1){const s=i.decimal;return t=t.includes(s)?t:`${t}${s}`,t.padEnd(t.length+n.length,i.localize("0"))}}return t}const Wv="en",OEt=["ar","bg","bs","ca","cs","da","de","el",Wv,"es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","no","nl","pl","pt-BR","pt-PT","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-CN","zh-HK","zh-TW"],REt=["ar","bg","bs","ca","cs","da","de","de-AT","de-CH","el",Wv,"en-AU","en-CA","en-GB","es","es-MX","et","fi","fr","fr-CH","he","hi","hr","hu","id","it","it-CH","ja","ko","lt","lv","mk","no","nl","pl","pt","pt-PT","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-CN","zh-HK","zh-TW"],PEt=["arab","arabext","bali","beng","deva","fullwide","gujr","guru","hanidec","khmr","knda","laoo","latn","limb","mlym","mong","mymr","orya","tamldec","telu","thai","tibt"],L$e=t=>PEt.includes(t),kV=new Intl.NumberFormat().resolvedOptions().numberingSystem,D$e=kV==="arab"||!L$e(kV)?"latn":kV,MEt=t=>L$e(t)?t:D$e;function N$e(t,e="cldr"){const i=e==="cldr"?REt:OEt;return t?i.includes(t)?t:(t=t.toLowerCase(),t==="nb"?"no":e==="t9n"&&t==="pt"?"pt-BR":(t.includes("-")&&(t=t.replace(/(\w+)-(\w+)/,(r,n,s)=>`${n}-${s.toUpperCase()}`),i.includes(t)||(t=t.split("-")[0])),t==="zh"?"zh-CN":i.includes(t)?t:(console.warn(`Translations for the "${t}" locale are not available and will fall back to the default, English (en).`),Wv))):Wv}const ZP=new Set;function p$(t){$Et(t),ZP.size===0&&F$e?.observe(document.documentElement,{attributes:!0,attributeFilter:["lang"],subtree:!0}),ZP.add(t)}function $Et(t){t.effectiveLocale=IEt(t)}function f$(t){ZP.delete(t),ZP.size===0&&F$e.disconnect()}const F$e=qv("mutation",t=>{t.forEach(e=>{const i=e.target;ZP.forEach(r=>{if(!ASt(i,r.el))return;const s=rT(r.el,"[lang]");if(!s){r.effectiveLocale=Wv;return}const o=s.lang;r.effectiveLocale=s.hasAttribute("lang")&&o===""?Wv:o})})});function IEt(t){return t.el.lang||rT(t.el,"[lang]")?.lang||document.documentElement.lang||Wv}class LEt{constructor(){this.delocalize=e=>this._numberFormatOptions?Gk(e,i=>i.replace(new RegExp(`[${this._minusSign}]`,"g"),"-").replace(new RegExp(`[${this._group}]`,"g"),"").replace(new RegExp(`[${this._decimal}]`,"g"),".").replace(new RegExp(`[${this._digits.join("")}]`,"g"),this._getDigitIndex)):e,this.localize=e=>this._numberFormatOptions?Gk(e,i=>gte(i.trim())?new Fr(i.trim()).format(this).replace(new RegExp(`[${this._actualGroup}]`,"g"),this._group):i):e}get group(){return this._group}get decimal(){return this._decimal}get minusSign(){return this._minusSign}get digits(){return this._digits}get numberFormatter(){return this._numberFormatter}get numberFormatOptions(){return this._numberFormatOptions}set numberFormatOptions(e){if(e.locale=N$e(e?.locale),e.numberingSystem=MEt(e?.numberingSystem),!this._numberFormatOptions&&e.locale===Wv&&e.numberingSystem===D$e&&Object.keys(e).length===2||JSON.stringify(this._numberFormatOptions)===JSON.stringify(e))return;this._numberFormatOptions=e,this._numberFormatter=new Intl.NumberFormat(this._numberFormatOptions.locale,this._numberFormatOptions),this._digits=[...new Intl.NumberFormat(this._numberFormatOptions.locale,{useGrouping:!1,numberingSystem:this._numberFormatOptions.numberingSystem}).format(9876543210)].reverse();const i=new Map(this._digits.map((n,s)=>[n,s])),r=new Intl.NumberFormat(this._numberFormatOptions.locale,{numberingSystem:this._numberFormatOptions.numberingSystem}).formatToParts(-123456789e-1);this._actualGroup=r.find(n=>n.type==="group").value,this._group=this._actualGroup.trim().length===0||this._actualGroup==" "?" ":this._actualGroup,this._decimal=r.find(n=>n.type==="decimal").value,this._minusSign=r.find(n=>n.type==="minusSign").value,this._getDigitIndex=n=>i.get(n)}}const qGt=new LEt;/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const ED={};async function DEt(t,e){const i=`${e}_${t}`;return ED[i]||(ED[i]=fetch(ite(`./assets/${e}/t9n/messages_${t}.json`)).then(r=>(r.ok||Tfe(),r.json())).catch(()=>Tfe())),ED[i]}function Tfe(){throw new Error("could not fetch component message bundle")}function yte(t){t.messages={...t.defaultMessages,...t.messageOverrides}}async function m$(t){t.defaultMessages=await k$e(t,t.effectiveLocale),yte(t)}async function k$e(t,e){const{el:i}=t,n=i.tagName.toLowerCase().replace("calcite-","");return DEt(N$e(e,"t9n"),n)}async function g$(t,e){t.defaultMessages=await k$e(t,e),yte(t)}function y$(t){t.onMessagesChange=NEt}function _$(t){t.onMessagesChange=void 0}function NEt(){yte(this)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const FEt={icon:"icon",flipRtl:"flip-rtl"},UV={},zV={},U$e={s:16,m:24,l:32};async function kEt({icon:t,scale:e}){const i=U$e[e],r=UEt(t),n=r.charAt(r.length-1)==="F",o=`${n?r.substring(0,r.length-1):r}${i}${n?"F":""}`;if(UV[o])return UV[o];zV[o]||(zV[o]=fetch(ite(`./assets/icon/${o}.json`)).then(l=>l.json()).catch(()=>(console.error(`"${o}" is not a valid calcite-ui-icon name`),"")));const a=await zV[o];return UV[o]=a,a}function UEt(t){const e=!isNaN(Number(t.charAt(0))),i=t.split("-");if(i.length>0){const n=/[a-z]/i;t=i.map((s,o)=>s.replace(n,function(l,c){return o===0&&c===0?l:l.toUpperCase()})).join("")}return e?`i${t}`:t}const zEt=":host{display:inline-flex;color:var(--calcite-ui-icon-color)}:host([scale=s]){block-size:1rem;inline-size:1rem;min-inline-size:1rem;min-block-size:1rem}:host([scale=m]){block-size:1.5rem;inline-size:1.5rem;min-inline-size:1.5rem;min-block-size:1.5rem}:host([scale=l]){block-size:2rem;inline-size:2rem;min-inline-size:2rem;min-block-size:2rem}.flip-rtl{transform:scaleX(-1)}.svg{display:block}:host([hidden]){display:none}[hidden]{display:none}",BEt=rh(class extends nh{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.icon=null,this.flipRtl=!1,this.scale="m",this.textLabel=void 0,this.pathData=void 0,this.visible=!1}connectedCallback(){this.waitUntilVisible(()=>{this.visible=!0,this.loadIconPathData()})}disconnectedCallback(){this.intersectionObserver?.disconnect(),this.intersectionObserver=null}async componentWillLoad(){this.loadIconPathData()}render(){const{el:t,flipRtl:e,pathData:i,scale:r,textLabel:n}=this,s=LMe(t),o=U$e[r],a=!!n,l=[].concat(i||"");return Ae(md,{"aria-hidden":ex(!a),"aria-label":a?n:null,role:a?"img":null},Ae("svg",{"aria-hidden":"true",class:{[FEt.flipRtl]:s==="rtl"&&e,svg:!0},fill:"currentColor",height:"100%",viewBox:`0 0 ${o} ${o}`,width:"100%",xmlns:"http://www.w3.org/2000/svg"},l.map(c=>typeof c=="string"?Ae("path",{d:c}):Ae("path",{d:c.d,opacity:"opacity"in c?c.opacity:1}))))}async loadIconPathData(){const{icon:t,scale:e,visible:i}=this;!t||!i||(this.pathData=await kEt({icon:t,scale:e}))}waitUntilVisible(t){if(this.intersectionObserver=qv("intersection",e=>{e.forEach(i=>{i.isIntersecting&&(this.intersectionObserver.disconnect(),this.intersectionObserver=null,t())})},{rootMargin:"50px"}),!this.intersectionObserver){t();return}this.intersectionObserver.observe(this.el)}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{icon:["loadIconPathData"],scale:["loadIconPathData"]}}static get style(){return zEt}},[1,"calcite-icon",{icon:[513],flipRtl:[516,"flip-rtl"],scale:[513],textLabel:[1,"text-label"],pathData:[32],visible:[32]}]);function l1(){if(typeof customElements>"u")return;["calcite-icon"].forEach(e=>{switch(e){case"calcite-icon":customElements.get(e)||customElements.define(e,BEt);break}})}l1();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const VEt='@charset "UTF-8";@media (prefers-reduced-motion: reduce){:root{--calcite-internal-duration-factor:0}}:host{position:relative;margin-inline:auto;display:none;align-items:center;justify-content:center;opacity:1;min-block-size:var(--calcite-loader-size);font-size:var(--calcite-loader-font-size);stroke:var(--calcite-ui-brand);stroke-width:3;fill:none;transform:scale(1, 1);animation:loader-color-shift calc(var(--calcite-internal-animation-timing-slow) / var(--calcite-internal-duration-factor) * 2 / var(--calcite-internal-duration-factor)) alternate-reverse infinite linear;padding-block:var(--calcite-loader-padding, 4rem)}:host([scale=s]){--calcite-loader-font-size:var(--calcite-font-size--2);--calcite-loader-size:2rem;--calcite-loader-size-inline:0.75rem}:host([scale=m]){--calcite-loader-font-size:var(--calcite-font-size-0);--calcite-loader-size:4rem;--calcite-loader-size-inline:1rem}:host([scale=l]){--calcite-loader-font-size:var(--calcite-font-size-2);--calcite-loader-size:6rem;--calcite-loader-size-inline:1.5rem}:host([no-padding]){padding-block:0px}:host{display:flex}.loader__text{display:block;text-align:center;font-size:var(--calcite-font-size--2);line-height:1rem;color:var(--calcite-ui-text-1);margin-block-start:calc(var(--calcite-loader-size) + 1.5rem)}.loader__percentage{position:absolute;display:block;text-align:center;color:var(--calcite-ui-text-1);font-size:var(--calcite-loader-font-size);inline-size:var(--calcite-loader-size);inset-inline-start:50%;margin-inline-start:calc(var(--calcite-loader-size) / 2 * -1);line-height:0.25;transform:scale(1, 1)}.loader__svgs{position:absolute;overflow:visible;opacity:1;inline-size:var(--calcite-loader-size);block-size:var(--calcite-loader-size);inset-inline-start:50%;margin-inline-start:calc(var(--calcite-loader-size) / 2 * -1);animation-iteration-count:infinite;animation-timing-function:linear;animation-duration:calc(var(--calcite-internal-animation-timing-slow) / var(--calcite-internal-duration-factor) * 6.66 / var(--calcite-internal-duration-factor));animation-name:loader-clockwise}.loader__svg{position:absolute;inset-block-start:0px;transform-origin:center;overflow:visible;inset-inline-start:0;inline-size:var(--calcite-loader-size);block-size:var(--calcite-loader-size);animation-iteration-count:infinite;animation-timing-function:linear}@supports (display: grid){.loader__svg--1{animation-name:loader-offset-1}.loader__svg--2{animation-name:loader-offset-2}.loader__svg--3{animation-name:loader-offset-3}}:host([type=determinate]){animation:none;stroke:var(--calcite-ui-border-3)}:host([type=determinate]) .loader__svgs{animation:none}:host([type=determinate]) .loader__svg--3{animation:none;stroke:var(--calcite-ui-brand);stroke-dasharray:150.79632;transform:rotate(-90deg);transition:all var(--calcite-internal-animation-timing-fast) linear}:host([inline]){position:relative;margin:0px;animation:none;stroke:currentColor;stroke-width:2;padding-block:0px;block-size:var(--calcite-loader-size-inline);min-block-size:var(--calcite-loader-size-inline);inline-size:var(--calcite-loader-size-inline);margin-inline-end:calc(var(--calcite-loader-size-inline) * 0.5);vertical-align:calc(var(--calcite-loader-size-inline) * -1 * 0.2)}:host([inline]) .loader__svgs{inset-block-start:0px;margin:0px;inset-inline-start:0;inline-size:var(--calcite-loader-size-inline);block-size:var(--calcite-loader-size-inline)}:host([inline]) .loader__svg{inline-size:var(--calcite-loader-size-inline);block-size:var(--calcite-loader-size-inline)}:host([complete]){opacity:0;transform:scale(0.75, 0.75);transform-origin:center;transition:opacity var(--calcite-internal-animation-timing-medium) linear 1000ms, transform var(--calcite-internal-animation-timing-medium) linear 1000ms}:host([complete]) .loader__svgs{opacity:0;transform:scale(0.75, 0.75);transform-origin:center;transition:opacity calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms}:host([complete]) .loader__percentage{color:var(--calcite-ui-brand);transform:scale(1.05, 1.05);transform-origin:center;transition:color var(--calcite-internal-animation-timing-medium) linear, transform var(--calcite-internal-animation-timing-medium) linear}.loader__svg--1{stroke-dasharray:27.9252444444 139.6262222222;animation-duration:calc(var(--calcite-internal-animation-timing-slow) / var(--calcite-internal-duration-factor) * 4.8 / var(--calcite-internal-duration-factor))}@keyframes loader-offset-1{0%{stroke-dasharray:27.9252444444 251.3272;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222 139.6262222222;stroke-dashoffset:-83.7757333333}100%{stroke-dasharray:27.9252444444 251.3272;stroke-dashoffset:-279.2524444444}}.loader__svg--2{stroke-dasharray:55.8504888889 139.6262222222;animation-duration:calc(var(--calcite-internal-animation-timing-slow) / var(--calcite-internal-duration-factor) * 6.4 / var(--calcite-internal-duration-factor))}@keyframes loader-offset-2{0%{stroke-dasharray:55.8504888889 223.4019555556;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222 139.6262222222;stroke-dashoffset:-97.7383555556}100%{stroke-dasharray:55.8504888889 223.4019555556;stroke-dashoffset:-279.2524444444}}.loader__svg--3{stroke-dasharray:13.9626222222 139.6262222222;animation-duration:calc(var(--calcite-internal-animation-timing-slow) / var(--calcite-internal-duration-factor) * 7.734 / var(--calcite-internal-duration-factor))}@keyframes loader-offset-3{0%{stroke-dasharray:13.9626222222 265.2898222222;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222 139.6262222222;stroke-dashoffset:-76.7944222222}100%{stroke-dasharray:13.9626222222 265.2898222222;stroke-dashoffset:-279.2524444444}}@keyframes loader-color-shift{0%{stroke:var(--calcite-ui-brand)}33%{stroke:var(--calcite-ui-brand-press)}66%{stroke:var(--calcite-ui-brand-hover)}100%{stroke:var(--calcite-ui-brand)}}@keyframes loader-clockwise{100%{transform:rotate(360deg)}}:host([hidden]){display:none}[hidden]{display:none}',GEt=rh(class extends nh{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.inline=!1,this.label=void 0,this.scale="m",this.type=void 0,this.value=0,this.text=""}render(){const{el:t,inline:e,label:i,scale:r,text:n,type:s,value:o}=this,a=t.id||SMe(),l=.45,c=e?this.getInlineSize(r):this.getSize(r),h=c*l,d=`0 0 ${c} ${c}`,f=s==="determinate",m=2*h*Math.PI,y=o/100*m,_=m-y,v=Math.floor(o),w={"aria-valuenow":v,"aria-valuemin":0,"aria-valuemax":100,complete:v===100},x={r:h,cx:c/2,cy:c/2},T={"stroke-dasharray":`${y} ${_}`};return Ae(md,{"aria-label":i,id:a,role:"progressbar",...f?w:{}},Ae("div",{class:"loader__svgs"},Ae("svg",{"aria-hidden":"true",class:"loader__svg loader__svg--1",viewBox:d},Ae("circle",{...x})),Ae("svg",{"aria-hidden":"true",class:"loader__svg loader__svg--2",viewBox:d},Ae("circle",{...x})),Ae("svg",{"aria-hidden":"true",class:"loader__svg loader__svg--3",viewBox:d,...f?{style:T}:{}},Ae("circle",{...x}))),n&&Ae("div",{class:"loader__text"},n),f&&Ae("div",{class:"loader__percentage"},o))}getSize(t){return{s:32,m:56,l:80}[t]}getInlineSize(t){return{s:12,m:16,l:20}[t]}get el(){return this}static get style(){return VEt}},[1,"calcite-loader",{inline:[516],label:[1],scale:[513],type:[513],value:[2],text:[1]}]);function v$(){if(typeof customElements>"u")return;["calcite-loader"].forEach(e=>{switch(e){case"calcite-loader":customElements.get(e)||customElements.define(e,GEt);break}})}v$();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const gg={button:"button",buttonTextVisible:"button--text-visible",buttonCompact:"button--compact",indicatorText:"indicator-text",iconContainer:"icon-container",slotContainer:"slot-container",slotContainerHidden:"slot-container--hidden",textContainer:"text-container",textContainerVisible:"text-container--visible"},jEt={tooltip:"tooltip"},HEt=`:host{box-sizing:border-box;background-color:var(--calcite-ui-foreground-1);color:var(--calcite-ui-text-2);font-size:var(--calcite-font-size--1)}:host *{box-sizing:border-box}:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-ui-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:flex;background-color:transparent;--calcite-action-indicator-color:var(--calcite-ui-brand)}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.button{position:relative;margin:0px;display:flex;inline-size:auto;cursor:pointer;align-items:center;justify-content:flex-start;border-style:none;background-color:var(--calcite-ui-foreground-1);fill:var(--calcite-ui-text-3);font-family:var(--calcite-sans-family);font-size:var(--calcite-font-size--2);line-height:1rem;font-weight:var(--calcite-font-weight-medium);color:var(--calcite-ui-text-3);outline-color:transparent;text-align:unset;flex:1 0 auto}.button:hover{background-color:var(--calcite-ui-foreground-2);fill:var(--calcite-ui-text-1);color:var(--calcite-ui-text-1)}.button:focus{background-color:var(--calcite-ui-foreground-2);fill:var(--calcite-ui-text-1);color:var(--calcite-ui-text-1);outline:2px solid var(--calcite-ui-focus-color, var(--calcite-ui-brand));outline-offset:calc(
            -2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-ui-focus-offset-invert),
                1
              )
            )
          )}.button:active{background-color:var(--calcite-ui-foreground-3)}.button .icon-container{pointer-events:none;margin:0px;display:flex;align-items:center;justify-content:center;min-inline-size:1rem;min-block-size:1rem}.button .text-container{margin:0px;inline-size:0px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;line-height:1.5rem;opacity:0;transition-property:opacity;transition-duration:150ms;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-property:margin;transition-property:inline-size}.button .text-container--visible{inline-size:auto;flex:1 1 auto;opacity:1;margin-inline-end:1rem}:host([scale=s]) .button{padding-inline:0.5rem;padding-block:0.25rem;font-size:var(--calcite-font-size--2);line-height:1rem;font-weight:var(--calcite-font-weight-normal)}:host([scale=s]) .button--text-visible .icon-container{margin-inline-end:0.5rem}:host([scale=m]) .button{padding-inline:1rem;padding-block:0.75rem;font-size:var(--calcite-font-size--1);line-height:1rem;font-weight:var(--calcite-font-weight-normal)}:host([scale=m]) .button--text-visible .icon-container{margin-inline-end:0.75rem}:host([scale=l]) .button{padding:1.25rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;font-weight:var(--calcite-font-weight-normal)}:host([scale=l]) .button--text-visible .icon-container{margin-inline-end:1rem}:host([alignment=center]) .button{justify-content:center}:host([alignment=end]) .button{justify-content:flex-end}:host([alignment=center]) .button .text-container--visible,:host([alignment=end]) .button .text-container--visible{flex:0 1 auto}:host([scale=s][compact]) .button,:host([scale=m][compact]) .button,:host([scale=l][compact]) .button{padding-inline:0px}.slot-container{display:flex}.slot-container--hidden{display:none}.button--text-visible{inline-size:100%}:host([active]) .button,:host([active]) .button:hover,:host([active]) .button:focus,:host([active][loading]) .button{background-color:var(--calcite-ui-foreground-3);fill:var(--calcite-ui-text-1);color:var(--calcite-ui-text-1)}:host([active]) .button:active{background-color:var(--calcite-ui-foreground-1)}:host([appearance=transparent]) .button{background-color:transparent;transition-property:box-shadow;transition-duration:150ms;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1)}:host([appearance=transparent]) .button:hover,:host([appearance=transparent]) .button:focus{background-color:transparent;box-shadow:0 0 0 2px var(--calcite-ui-border-1) inset}:host([active][appearance=transparent]) .button,:host([active][appearance=transparent]) .button:hover,:host([active][appearance=transparent]) .button:focus{background-color:var(--calcite-ui-foreground-3);fill:var(--calcite-ui-text-1);color:var(--calcite-ui-text-1)}:host([appearance=transparent][loading]) .button,:host([appearance=transparent][disabled]) .button{background-color:transparent}:host([loading]) .button,:host([loading]) .button:hover,:host([loading]) .button:focus{background-color:var(--calcite-ui-foreground-1)}:host([loading]) .button .text-container,:host([loading]) .button:hover .text-container,:host([loading]) .button:focus .text-container{opacity:var(--calcite-ui-opacity-disabled)}:host([loading]) calcite-loader[inline]{color:var(--calcite-ui-text-3);margin-inline-end:0px}:host([disabled]) .button,:host([disabled]) .button:hover,:host([disabled]) .button:focus{cursor:default;background-color:var(--calcite-ui-foreground-1);opacity:var(--calcite-ui-opacity-disabled)}:host([disabled][active]) .button,:host([disabled][active]) .button:hover,:host([disabled][active]) .button:focus{background-color:var(--calcite-ui-foreground-3);opacity:var(--calcite-ui-opacity-disabled)}:host([indicator]) .button::after{content:"";position:absolute;block-size:0.5rem;inline-size:0.5rem;border-radius:9999px;border-width:2px;background-color:var(--calcite-action-indicator-color);border-color:var(--calcite-ui-foreground-1);inset-block-end:0.75rem;inset-inline-end:0.75rem}:host([indicator]) .button--text-visible::after{inset-block-end:auto}:host([indicator]) .button:hover::after,:host([indicator]) .button:focus::after{border-color:var(--calcite-ui-foreground-1)}:host([indicator][scale=s]) .button::after{inset-block-end:0.25rem;inset-inline-end:0.25rem}:host([indicator][scale=s]) .button--text-visible::after{inset-block-end:auto;inset-inline-end:0.5rem}:host([indicator][active]) .button::after{border-color:var(--calcite-ui-foreground-3)}.indicator-text{position:absolute;inline-size:1px;block-size:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}:host([hidden]){display:none}[hidden]{display:none}`,qEt=rh(class extends nh{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.mutationObserver=qv("mutation",()=>ote(this)),this.guid=`calcite-action-${SMe()}`,this.indicatorId=`${this.guid}-indicator`,this.buttonId=`${this.guid}-button`,this.handleTooltipSlotChange=t=>{const i=t.target.assignedElements({flatten:!0}).filter(r=>r?.matches("calcite-tooltip"))[0];i&&(i.referenceElement=this.buttonEl)},this.active=!1,this.alignment=void 0,this.appearance="solid",this.compact=!1,this.disabled=!1,this.icon=void 0,this.iconFlipRtl=!1,this.indicator=!1,this.label=void 0,this.loading=!1,this.scale="m",this.text=void 0,this.textEnabled=!1,this.messages=void 0,this.messageOverrides=void 0,this.effectiveLocale="",this.defaultMessages=void 0}onMessagesChange(){}effectiveLocaleChange(){g$(this,this.effectiveLocale)}connectedCallback(){T8(this),p$(this),y$(this),this.mutationObserver?.observe(this.el,{childList:!0,subtree:!0})}async componentWillLoad(){Qy(this),await m$(this)}componentDidLoad(){e0(this)}disconnectedCallback(){S8(this),f$(this),_$(this),this.mutationObserver?.disconnect()}componentDidRender(){x8(this)}async setFocus(){await t0(this),this.buttonEl?.focus()}renderTextContainer(){const{text:t,textEnabled:e}=this,i={[gg.textContainer]:!0,[gg.textContainerVisible]:e};return t?Ae("div",{class:i,key:"text-container"},t):null}renderIndicatorText(){const{indicator:t,messages:e,indicatorId:i,buttonId:r}=this;return Ae("div",{"aria-labelledby":r,"aria-live":"polite",class:gg.indicatorText,id:i,role:"region"},t?e.indicator:null)}renderIconContainer(){const{loading:t,icon:e,scale:i,el:r,iconFlipRtl:n}=this,s=i==="l"?"m":"s",o=i==="l"?"l":"m",a=t?Ae("calcite-loader",{inline:!0,label:this.messages.loading,scale:o}):null,l=e?Ae("calcite-icon",{flipRtl:n,icon:e,scale:s}):null,c=a||l,h=c||r.children?.length,d=Ae("div",{class:{[gg.slotContainer]:!0,[gg.slotContainerHidden]:t}},Ae("slot",null));return h?Ae("div",{"aria-hidden":"true",class:gg.iconContainer,key:"icon-container"},c,d):null}render(){const{active:t,compact:e,disabled:i,loading:r,textEnabled:n,label:s,text:o,indicator:a,indicatorId:l,buttonId:c,messages:h}=this,d=`${s||o}${a?` (${h.indicator})`:""}`,f={[gg.button]:!0,[gg.buttonTextVisible]:n,[gg.buttonCompact]:e};return Ae(md,null,Ae("button",{"aria-busy":ex(r),"aria-controls":a?l:null,"aria-disabled":ex(i),"aria-label":d,"aria-pressed":ex(t),class:f,disabled:i,id:c,ref:m=>this.buttonEl=m},this.renderIconContainer(),this.renderTextContainer()),Ae("slot",{name:jEt.tooltip,onSlotchange:this.handleTooltipSlotChange}),this.renderIndicatorText())}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{messageOverrides:["onMessagesChange"],effectiveLocale:["effectiveLocaleChange"]}}static get style(){return HEt}},[1,"calcite-action",{active:[516],alignment:[513],appearance:[513],compact:[516],disabled:[516],icon:[1],iconFlipRtl:[516,"icon-flip-rtl"],indicator:[516],label:[1],loading:[516],scale:[513],text:[1],textEnabled:[516,"text-enabled"],messages:[1040],messageOverrides:[1040],effectiveLocale:[32],defaultMessages:[32],setFocus:[64]}]);function _te(){if(typeof customElements>"u")return;["calcite-action","calcite-icon","calcite-loader"].forEach(e=>{switch(e){case"calcite-action":customElements.get(e)||customElements.define(e,qEt);break;case"calcite-icon":customElements.get(e)||l1();break;case"calcite-loader":customElements.get(e)||v$();break}})}_te();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */(function(t){if(typeof t.requestSubmit=="function")return;t.requestSubmit=function(r){r?(e(r,this),r.click()):(r=document.createElement("input"),r.type="submit",r.hidden=!0,this.appendChild(r),r.click(),this.removeChild(r))};function e(r,n){r instanceof HTMLElement||i(TypeError,"parameter 1 is not of type 'HTMLElement'"),r.type=="submit"||i(TypeError,"The specified element is not a submit button"),r.form==n||i(DOMException,"The specified element is not owned by this form element","NotFoundError")}function i(r,n,s){throw new r("Failed to execute 'requestSubmit' on 'HTMLFormElement': "+n+".",s)}})(HTMLFormElement.prototype);const _Y="hidden-form-input";function vte(t){return"checked"in t}const vY=new WeakMap,bte=new WeakSet;function WEt(t,e){if(rT(e.parentElement,"[form]"))return!0;const r="calciteInternalFormComponentRegister";let n=!1;return t.addEventListener(r,s=>{n=s.composedPath().some(o=>bte.has(o)),s.stopPropagation()},{once:!0}),e.dispatchEvent(new CustomEvent(r,{bubbles:!0,composed:!0})),n}function YEt(t){const{formEl:e}=t;return e?(e.requestSubmit(),!0):!1}function XEt(t){t.formEl?.reset()}function ZEt(t){const{el:e,value:i}=t,r=z$e(t);if(!r||WEt(r,e))return;t.formEl=r,t.defaultValue=i,vte(t)&&(t.defaultChecked=t.checked);const n=(t.onFormReset||JEt).bind(t);r.addEventListener("reset",n),vY.set(t.el,n),bte.add(e)}function z$e(t){const{el:e,form:i}=t;return i?NMe(e,{id:i}):rT(e,"form")}function JEt(){if(vte(this)){this.checked=this.defaultChecked;return}this.value=this.defaultValue}function KEt(t){const{el:e,formEl:i}=t;if(!i)return;const r=vY.get(e);i.removeEventListener("reset",r),vY.delete(e),t.formEl=null,bte.delete(e)}const B$e=t=>{t.target.dispatchEvent(new CustomEvent("calciteInternalHiddenInputChange",{bubbles:!0}))},Sfe=t=>t.removeEventListener("change",B$e);function QEt(t){const{el:e,formEl:i,name:r,value:n}=t,{ownerDocument:s}=e,o=e.querySelectorAll(`input[slot="${_Y}"]`);if(!i||!r){o.forEach(d=>{Sfe(d),d.remove()});return}const a=Array.isArray(n)?n:[n],l=[],c=new Set;o.forEach(d=>{const f=a.find(m=>m==d.value);f!=null?(c.add(f),Efe(t,d,f)):l.push(d)});let h;a.forEach(d=>{if(c.has(d))return;let f=l.pop();f||(f=s.createElement("input"),f.slot=_Y),h||(h=s.createDocumentFragment()),h.append(f),f.addEventListener("change",B$e),Efe(t,f,d)}),h&&e.append(h),l.forEach(d=>{Sfe(d),d.remove()})}function Efe(t,e,i){const{defaultValue:r,disabled:n,form:s,name:o,required:a}=t;e.defaultValue=r,e.disabled=n,e.name=o,e.required=a,e.tabIndex=-1,s?e.setAttribute("form",s):e.removeAttribute("form"),vte(t)?(e.checked=t.checked,e.defaultChecked=t.defaultChecked,e.value=t.checked?i||"on":""):e.value=i||"",t.syncHiddenFormInput?.(e)}const eCt=({component:t})=>(QEt(t),Ae("slot",{name:_Y}));/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const V$e="calciteInternalLabelClick",E8="calciteInternalLabelConnected",jk="calciteInternalLabelDisconnected",Cfe="calcite-label",JP=new WeakMap,GR=new WeakMap,KP=new WeakMap,Hk=new WeakMap,gE=new WeakSet,tCt=t=>{const{id:e}=t,i=e&&NMe(t,{selector:`${Cfe}[for="${e}"]`});if(i)return i;const r=rT(t,Cfe);return!r||iCt(r,t)?null:r};function iCt(t,e){let i;const r="custom-element-ancestor-check",n=o=>{o.stopImmediatePropagation();const a=o.composedPath();i=a.slice(a.indexOf(e),a.indexOf(t))};return t.addEventListener(r,n,{once:!0}),e.dispatchEvent(new CustomEvent(r,{composed:!0,bubbles:!0})),t.removeEventListener(r,n),i.filter(o=>o!==e&&o!==t).filter(o=>o.tagName?.includes("-")).length>0}function wte(t){const e=tCt(t.el);if(GR.has(e)&&e===t.labelEl||!e&&gE.has(t))return;const i=nCt.bind(t);if(e){t.labelEl=e;const r=JP.get(e)||[];r.push(t),JP.set(e,r.sort(j$e)),GR.has(t.labelEl)||(GR.set(t.labelEl,Afe),t.labelEl.addEventListener(V$e,Afe)),gE.delete(t),document.removeEventListener(E8,KP.get(t)),Hk.set(t,i),document.addEventListener(jk,i)}else gE.has(t)||(i(),document.removeEventListener(jk,Hk.get(t)))}function G$e(t){if(gE.delete(t),document.removeEventListener(E8,KP.get(t)),document.removeEventListener(jk,Hk.get(t)),KP.delete(t),Hk.delete(t),!t.labelEl)return;const e=JP.get(t.labelEl);e.length===1&&(t.labelEl.removeEventListener(V$e,GR.get(t.labelEl)),GR.delete(t.labelEl)),JP.set(t.labelEl,e.filter(i=>i!==t).sort(j$e)),t.labelEl=null}function j$e(t,e){return LSt(t.el,e.el)?-1:1}function H$e(t){return t.label||t.labelEl?.textContent?.trim()||""}function Afe(t){const e=t.detail.sourceEvent.target,i=JP.get(this),r=i.find(o=>o.el===e);if(i.includes(r))return;const s=i[0];s.disabled||s.onLabelClick(t)}function rCt(){gE.has(this)&&wte(this)}function nCt(){gE.add(this);const t=KP.get(this)||rCt.bind(this);KP.set(this,t),document.addEventListener(E8,t)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const sCt=["lang","role","aria-expanded"],qk=new Map;let yE;function q$e(t,e,i=!1){const{el:r}=t,n=i?t.globalAttributes:{};e.filter(s=>!!sCt.includes(s)&&!!r.hasAttribute(s)).forEach(s=>{const o=r.getAttribute(s);o!==null&&(n[s]=o)}),t.globalAttributes=n}function W$e(t){t.forEach(({target:e})=>{const[i,r]=qk.get(e);q$e(i,r.attributeFilter)})}function Y$e(t,e){const{el:i}=t,r={attributeFilter:e};qk.set(i,[t,r]),q$e(t,e,!0),yE||(yE=qv("mutation",W$e)),yE.observe(i,r)}function X$e(t){qk.delete(t.el),W$e(yE.takeRecords()),yE.disconnect();for(const[e,[,i]]of qk.entries())yE.observe(e,i)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const lu={buttonLoader:"calcite-button--loader",content:"content",contentSlotted:"content--slotted",icon:"icon",iconStart:"icon--start",iconEnd:"icon--end",loadingIn:"loading-in",loadingOut:"loading-out",iconStartEmpty:"icon-start-empty",iconEndEmpty:"icon-end-empty",buttonPadding:"button-padding",buttonPaddingShrunk:"button-padding--shrunk"},oCt=`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-ui-opacity-disabled)}:host([loading]) *,:host([disabled]) *,:host([loading]) ::slotted(*),:host([disabled]) ::slotted(*){pointer-events:none}:host{display:inline-block;inline-size:auto;vertical-align:middle}:host([round]){border-radius:50px}:host([round]) a,:host([round]) button{border-radius:50px}:host button,:host a{outline-color:transparent}:host button:focus,:host a:focus{outline:2px solid var(--calcite-ui-focus-color, var(--calcite-ui-brand));outline-offset:calc(
            2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-ui-focus-offset-invert),
                1
              )
            )
          )}:host button,:host a{--calcite-button-content-margin-internal:0.5rem;--calcite-button-padding-x-internal:7px;--calcite-button-padding-y-internal:3px;padding-block:var(--calcite-button-padding-y-internal);padding-inline:var(--calcite-button-padding-x-internal);position:relative;box-sizing:border-box;display:flex;block-size:100%;inline-size:100%;cursor:pointer;-webkit-user-select:none;user-select:none;-webkit-appearance:none;appearance:none;align-items:center;justify-content:center;border-radius:0px;border-style:none;text-align:center;font-family:inherit;font-weight:var(--calcite-font-weight-normal);text-decoration-line:none;transition:color var(--calcite-animation-timing) ease-in-out, background-color var(--calcite-animation-timing) ease-in-out, box-shadow var(--calcite-animation-timing) ease-in-out, outline-color var(--calcite-internal-animation-timing-fast) ease-in-out}:host button:hover,:host a:hover{text-decoration-line:none}:host button span,:host a span{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.content{margin-inline:var(--calcite-button-content-margin-internal)}.icon-start-empty .content{margin-inline-start:unset}.icon-end-empty .content{margin-inline-end:unset}:host([scale=m]) button,:host([scale=m]) a{--calcite-button-content-margin-internal:0.75rem}:host([scale=l]) button,:host([scale=l]) a{--calcite-button-content-margin-internal:1rem}:host([width=auto]){inline-size:auto}:host([width=half]){inline-size:50%}:host([width=full]){inline-size:100%}:host([alignment=center]:not([width=auto])) a,:host([alignment=center]:not([width=auto])) button{justify-content:center}:host([alignment=start]:not([width=auto])) a,:host([alignment=start]:not([width=auto])) button{justify-content:flex-start}:host([alignment=end]:not([width=auto])) a,:host([alignment=end]:not([width=auto])) button{justify-content:flex-end}:host([alignment*=space-between]:not([width=auto])) a,:host([alignment*=space-between]:not([width=auto])) button{justify-content:space-between}:host([alignment=icon-start-space-between]:not([width=auto])) .icon--start{margin-inline-end:auto}:host([alignment=icon-start-space-between]:not([width=auto])) a,:host([alignment=icon-start-space-between]:not([width=auto])) button{text-align:unset}:host([alignment=icon-end-space-between]:not([width=auto])) .icon--end{margin-inline-start:auto}:host([alignment=icon-end-space-between]:not([width=auto])) a,:host([alignment=icon-end-space-between]:not([width=auto])) button{text-align:unset}:host([alignment=center]) a:not(.content--slotted) .icon--start+.icon--end,:host([alignment=center]) button:not(.content--slotted) .icon--start+.icon--end{margin-inline-start:var(--calcite-button-content-margin-internal)}.icon{position:relative;margin:0px;display:inline-flex;font-weight:var(--calcite-font-weight-normal);line-height:inherit}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}:host([loading]) button,:host([loading]) a{opacity:var(--calcite-ui-opacity-disabled)}@keyframes loader-in{0%{inline-size:0;opacity:0;transform:scale(0.5)}100%{inline-size:1em;opacity:1;transform:scale(1)}}@keyframes loader-out{0%{inline-size:1em;opacity:1;transform:scale(1)}100%{inline-size:0;opacity:0;transform:scale(0.5)}}.calcite-button--loader{display:flex}.calcite-button--loader calcite-loader{margin:0px;transition:inline-size var(--calcite-internal-animation-timing-slow) ease-in-out, opacity var(--calcite-internal-animation-timing-slow) ease-in-out, transform var(--calcite-internal-animation-timing-slow) ease-in-out}.calcite-button--loader calcite-loader.loading-in{animation-name:loader-in;animation-duration:var(--calcite-internal-animation-timing-slow)}.calcite-button--loader calcite-loader.loading-out{animation-name:loader-out;animation-duration:var(--calcite-internal-animation-timing-slow)}:host([loading]) button.content--slotted .calcite-button--loader calcite-loader,:host([loading]) a.content--slotted .calcite-button--loader calcite-loader{margin-inline-end:var(--calcite-button-content-margin-internal)}:host([loading]) button:not(.content--slotted) .icon--start,:host([loading]) button:not(.content--slotted) .icon--end,:host([loading]) a:not(.content--slotted) .icon--start,:host([loading]) a:not(.content--slotted) .icon--end{display:none}:host([appearance]) button,:host([appearance]) a{border-width:1px;border-style:solid;border-color:transparent}:host([kind=brand]) button,:host([kind=brand]) a{background-color:var(--calcite-ui-brand);color:var(--calcite-ui-text-inverse)}:host([kind=brand]) button:hover,:host([kind=brand]) button:focus,:host([kind=brand]) a:hover,:host([kind=brand]) a:focus{background-color:var(--calcite-ui-brand-hover)}:host([kind=brand]) button:active,:host([kind=brand]) a:active{background-color:var(--calcite-ui-brand-press)}:host([kind=brand]) button calcite-loader,:host([kind=brand]) a calcite-loader{color:var(--calcite-ui-text-inverse)}:host([kind=danger]) button,:host([kind=danger]) a{background-color:var(--calcite-ui-danger);color:var(--calcite-ui-text-inverse)}:host([kind=danger]) button:hover,:host([kind=danger]) button:focus,:host([kind=danger]) a:hover,:host([kind=danger]) a:focus{background-color:var(--calcite-ui-danger-hover)}:host([kind=danger]) button:active,:host([kind=danger]) a:active{background-color:var(--calcite-ui-danger-press)}:host([kind=danger]) button calcite-loader,:host([kind=danger]) a calcite-loader{color:var(--calcite-ui-text-inverse)}:host([kind=neutral]) button,:host([kind=neutral]) a{background-color:var(--calcite-ui-foreground-3);color:var(--calcite-ui-text-1)}:host([kind=neutral]) button:hover,:host([kind=neutral]) button:focus,:host([kind=neutral]) a:hover,:host([kind=neutral]) a:focus{background-color:var(--calcite-ui-foreground-2)}:host([kind=neutral]) button:active,:host([kind=neutral]) a:active{background-color:var(--calcite-ui-foreground-1)}:host([kind=neutral]) button calcite-loader,:host([kind=neutral]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([kind=inverse]) button,:host([kind=inverse]) a{color:var(--calcite-ui-text-inverse);background-color:var(--calcite-ui-inverse)}:host([kind=inverse]) button:hover,:host([kind=inverse]) button:focus,:host([kind=inverse]) a:hover,:host([kind=inverse]) a:focus{background-color:var(--calcite-ui-inverse-hover)}:host([kind=inverse]) button:active,:host([kind=inverse]) a:active{background-color:var(--calcite-ui-inverse-press)}:host([kind=inverse]) button calcite-loader,:host([kind=inverse]) a calcite-loader{color:var(--calcite-ui-text-inverse)}:host([appearance=outline-fill]) button,:host([appearance=outline-fill]) a{border-width:1px;border-style:solid;background-color:var(--calcite-ui-foreground-1);box-shadow:inset 0 0 0 1px transparent}:host([appearance=outline-fill][kind=brand]) button,:host([appearance=outline-fill][kind=brand]) a{border-color:var(--calcite-ui-brand);background-color:var(--calcite-ui-foreground-1);color:var(--calcite-ui-brand)}:host([appearance=outline-fill][kind=brand]) button:hover,:host([appearance=outline-fill][kind=brand]) a:hover{border-color:var(--calcite-ui-brand-hover);color:var(--calcite-ui-brand-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-brand-hover)}:host([appearance=outline-fill][kind=brand]) button:focus,:host([appearance=outline-fill][kind=brand]) a:focus{border-color:var(--calcite-ui-brand);color:var(--calcite-ui-brand);box-shadow:inset 0 0 0 2px var(--calcite-ui-brand)}:host([appearance=outline-fill][kind=brand]) button:active,:host([appearance=outline-fill][kind=brand]) a:active{border-color:var(--calcite-ui-brand-press);color:var(--calcite-ui-brand-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-brand-press)}:host([appearance=outline-fill][kind=brand]) button calcite-loader,:host([appearance=outline-fill][kind=brand]) a calcite-loader{color:var(--calcite-ui-brand)}:host([appearance=outline-fill][kind=danger]) button,:host([appearance=outline-fill][kind=danger]) a{border-color:var(--calcite-ui-danger);background-color:var(--calcite-ui-foreground-1);color:var(--calcite-ui-danger)}:host([appearance=outline-fill][kind=danger]) button:hover,:host([appearance=outline-fill][kind=danger]) a:hover{border-color:var(--calcite-ui-danger-hover);color:var(--calcite-ui-danger-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-danger-hover)}:host([appearance=outline-fill][kind=danger]) button:focus,:host([appearance=outline-fill][kind=danger]) a:focus{border-color:var(--calcite-ui-danger);color:var(--calcite-ui-danger);box-shadow:inset 0 0 0 2px var(--calcite-ui-danger)}:host([appearance=outline-fill][kind=danger]) button:active,:host([appearance=outline-fill][kind=danger]) a:active{border-color:var(--calcite-ui-danger-press);color:var(--calcite-ui-danger-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-danger-press)}:host([appearance=outline-fill][kind=danger]) button calcite-loader,:host([appearance=outline-fill][kind=danger]) a calcite-loader{color:var(--calcite-ui-danger)}:host([appearance=outline-fill][kind=neutral]) button,:host([appearance=outline-fill][kind=neutral]) a{background-color:var(--calcite-ui-foreground-1);color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-border-1)}:host([appearance=outline-fill][kind=neutral]) button:hover,:host([appearance=outline-fill][kind=neutral]) a:hover{box-shadow:inset 0 0 0 1px var(--calcite-ui-foreground-3)}:host([appearance=outline-fill][kind=neutral]) button:focus,:host([appearance=outline-fill][kind=neutral]) a:focus{box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3)}:host([appearance=outline-fill][kind=neutral]) button:active,:host([appearance=outline-fill][kind=neutral]) a:active{box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3)}:host([appearance=outline-fill][kind=neutral]) button calcite-loader,:host([appearance=outline-fill][kind=neutral]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=outline-fill][kind=inverse]) button,:host([appearance=outline-fill][kind=inverse]) a{background-color:var(--calcite-ui-foreground-1);color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-inverse)}:host([appearance=outline-fill][kind=inverse]) button:hover,:host([appearance=outline-fill][kind=inverse]) a:hover{border-color:var(--calcite-ui-inverse-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-inverse-hover)}:host([appearance=outline-fill][kind=inverse]) button:focus,:host([appearance=outline-fill][kind=inverse]) a:focus{border-color:var(--calcite-ui-inverse);box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse)}:host([appearance=outline-fill][kind=inverse]) button:active,:host([appearance=outline-fill][kind=inverse]) a:active{border-color:var(--calcite-ui-inverse-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse-press)}:host([appearance=outline-fill][kind=inverse]) button calcite-loader,:host([appearance=outline-fill][kind=inverse]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=outline]) button,:host([appearance=outline]) a{border-width:1px;border-style:solid;background-color:transparent;box-shadow:inset 0 0 0 1px transparent}:host([appearance=outline][kind=brand]) button,:host([appearance=outline][kind=brand]) a{border-color:var(--calcite-ui-brand);background-color:transparent;color:var(--calcite-ui-brand)}:host([appearance=outline][kind=brand]) button:hover,:host([appearance=outline][kind=brand]) a:hover{border-color:var(--calcite-ui-brand-hover);color:var(--calcite-ui-brand-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-brand-hover)}:host([appearance=outline][kind=brand]) button:focus,:host([appearance=outline][kind=brand]) a:focus{border-color:var(--calcite-ui-brand);color:var(--calcite-ui-brand);box-shadow:inset 0 0 0 2px var(--calcite-ui-brand)}:host([appearance=outline][kind=brand]) button:active,:host([appearance=outline][kind=brand]) a:active{border-color:var(--calcite-ui-brand-press);color:var(--calcite-ui-brand-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-brand-press)}:host([appearance=outline][kind=brand]) button calcite-loader,:host([appearance=outline][kind=brand]) a calcite-loader{color:var(--calcite-ui-brand)}:host([appearance=outline][kind=danger]) button,:host([appearance=outline][kind=danger]) a{border-color:var(--calcite-ui-danger);background-color:transparent;color:var(--calcite-ui-danger)}:host([appearance=outline][kind=danger]) button:hover,:host([appearance=outline][kind=danger]) a:hover{border-color:var(--calcite-ui-danger-hover);color:var(--calcite-ui-danger-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-danger-hover)}:host([appearance=outline][kind=danger]) button:focus,:host([appearance=outline][kind=danger]) a:focus{border-color:var(--calcite-ui-danger);color:var(--calcite-ui-danger);box-shadow:inset 0 0 0 2px var(--calcite-ui-danger)}:host([appearance=outline][kind=danger]) button:active,:host([appearance=outline][kind=danger]) a:active{border-color:var(--calcite-ui-danger-press);color:var(--calcite-ui-danger-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-danger-press)}:host([appearance=outline][kind=danger]) button calcite-loader,:host([appearance=outline][kind=danger]) a calcite-loader{color:var(--calcite-ui-danger)}:host([appearance=outline][kind=neutral]) button,:host([appearance=outline][kind=neutral]) a{background-color:transparent;color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-border-1)}:host([appearance=outline][kind=neutral]) button:hover,:host([appearance=outline][kind=neutral]) a:hover{box-shadow:inset 0 0 0 1px var(--calcite-ui-foreground-3)}:host([appearance=outline][kind=neutral]) button:focus,:host([appearance=outline][kind=neutral]) a:focus{box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3)}:host([appearance=outline][kind=neutral]) button:active,:host([appearance=outline][kind=neutral]) a:active{box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3)}:host([appearance=outline][kind=neutral]) button calcite-loader,:host([appearance=outline][kind=neutral]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=outline][kind=inverse]) button,:host([appearance=outline][kind=inverse]) a{background-color:transparent;color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-inverse)}:host([appearance=outline][kind=inverse]) button:hover,:host([appearance=outline][kind=inverse]) a:hover{border-color:var(--calcite-ui-inverse-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-inverse-hover)}:host([appearance=outline][kind=inverse]) button:focus,:host([appearance=outline][kind=inverse]) a:focus{border-color:var(--calcite-ui-inverse);box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse)}:host([appearance=outline][kind=inverse]) button:active,:host([appearance=outline][kind=inverse]) a:active{border-color:var(--calcite-ui-inverse-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse-press)}:host([appearance=outline][kind=inverse]) button calcite-loader,:host([appearance=outline][kind=inverse]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=outline-fill][split-child=primary]) button,:host([appearance=outline][split-child=primary]) button{border-inline-end-width:0;border-inline-start-width:1px}:host([appearance=outline-fill][split-child=secondary]) button,:host([appearance=outline][split-child=secondary]) button{border-inline-start-width:0;border-inline-end-width:1px}:host([appearance=transparent]:not(.enable-editing-button)) button,:host([appearance=transparent]:not(.enable-editing-button)) a{background-color:transparent}:host([appearance=transparent]:not(.enable-editing-button)) button:hover,:host([appearance=transparent]:not(.enable-editing-button)) button:focus,:host([appearance=transparent]:not(.enable-editing-button)) a:hover,:host([appearance=transparent]:not(.enable-editing-button)) a:focus{background-color:var(--calcite-button-transparent-hover)}:host([appearance=transparent]:not(.enable-editing-button)) button:active,:host([appearance=transparent]:not(.enable-editing-button)) a:active{background-color:var(--calcite-button-transparent-press)}:host([appearance=transparent][kind=brand]) button,:host([appearance=transparent][kind=brand]) a{color:var(--calcite-ui-brand)}:host([appearance=transparent][kind=brand]) button:hover,:host([appearance=transparent][kind=brand]) a:hover{color:var(--calcite-ui-brand-hover)}:host([appearance=transparent][kind=brand]) button:focus,:host([appearance=transparent][kind=brand]) a:focus{color:var(--calcite-ui-brand)}:host([appearance=transparent][kind=brand]) button:active,:host([appearance=transparent][kind=brand]) a:active{color:var(--calcite-ui-brand-press)}:host([appearance=transparent][kind=brand]) button calcite-loader,:host([appearance=transparent][kind=brand]) a calcite-loader{color:var(--calcite-ui-brand)}:host([appearance=transparent][kind=danger]) button,:host([appearance=transparent][kind=danger]) a{color:var(--calcite-ui-danger)}:host([appearance=transparent][kind=danger]) button:hover,:host([appearance=transparent][kind=danger]) a:hover{color:var(--calcite-ui-danger-hover)}:host([appearance=transparent][kind=danger]) button:focus,:host([appearance=transparent][kind=danger]) a:focus{color:var(--calcite-ui-danger)}:host([appearance=transparent][kind=danger]) button:active,:host([appearance=transparent][kind=danger]) a:active{color:var(--calcite-ui-danger-press)}:host([appearance=transparent][kind=danger]) button calcite-loader,:host([appearance=transparent][kind=danger]) a calcite-loader{color:var(--calcite-ui-danger)}:host([appearance=transparent][kind=neutral]:not(.cancel-editing-button)) button,:host([appearance=transparent][kind=neutral]:not(.cancel-editing-button)) a,:host([appearance=transparent][kind=neutral]:not(.cancel-editing-button)) calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=transparent][kind=neutral].cancel-editing-button) button{border-block-start-width:1px;border-block-end-width:1px;color:var(--calcite-ui-text-3);border-block-start-color:var(--calcite-ui-border-input);border-block-end-color:var(--calcite-ui-border-input);border-block-style:solid}:host([appearance=transparent][kind=neutral].cancel-editing-button) button:not(.content--slotted){--calcite-button-padding-y-internal:0}:host([appearance=transparent][kind=neutral].cancel-editing-button) button:hover{color:var(--calcite-ui-text-1)}:host([appearance=transparent][kind=neutral].enable-editing-button) button{background-color:transparent}:host(.confirm-changes-button) button:focus,:host(.cancel-editing-button) button:focus,:host(.enable-editing-button) button:focus{outline-offset:-2px}:host([appearance=transparent][kind=inverse]) button,:host([appearance=transparent][kind=inverse]) a,:host([appearance=transparent][kind=inverse]) calcite-loader{color:var(--calcite-ui-text-inverse)}:host([scale=s]) button.content--slotted,:host([scale=s]) a.content--slotted{font-size:var(--calcite-font-size--2);line-height:1rem}:host([scale=s][appearance=transparent]) button.content--slotted,:host([scale=s][appearance=transparent]) a.content--slotted{--calcite-button-padding-x-internal:0.5rem}:host([scale=s]) button,:host([scale=s]) a{--calcite-button-padding-y-internal:3px}:host([scale=m]) button.content--slotted,:host([scale=m]) a.content--slotted{--calcite-button-padding-x-internal:11px;font-size:var(--calcite-font-size--1);line-height:1rem}:host([scale=m]) button,:host([scale=m]) a{--calcite-button-padding-y-internal:7px}:host([scale=m][appearance=transparent]) button.content--slotted,:host([scale=m][appearance=transparent]) a.content--slotted{--calcite-button-padding-x-internal:0.75rem}:host([scale=l]) button.content--slotted,:host([scale=l]) a.content--slotted{--calcite-button-padding-x-internal:15px;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=l]) .button-padding{--calcite-button-padding-x-internal:1rem;--calcite-button-padding-y-internal:11px}:host([scale=l]) .button-padding--shrunk{--calcite-button-padding-y-internal:9px}:host([scale=s]) button:not(.content--slotted),:host([scale=s]) a:not(.content--slotted){--calcite-button-padding-x-internal:0.125rem;--calcite-button-padding-y-internal:3px;inline-size:1.5rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-block-size:1.5rem}:host([scale=m]) button:not(.content--slotted),:host([scale=m]) a:not(.content--slotted){--calcite-button-padding-x-internal:0.125rem;--calcite-button-padding-y-internal:7px;inline-size:2rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-block-size:2rem}:host([scale=l]) button:not(.content--slotted),:host([scale=l]) a:not(.content--slotted){--calcite-button-padding-x-internal:0.125rem;--calcite-button-padding-y-internal:9px;inline-size:2.75rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-block-size:2.75rem}:host([scale=l][appearance=transparent]) button:not(.content--slotted),:host([scale=l][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-y-internal:0.625rem}:host([scale=s][icon-start][icon-end]) button:not(.content--slotted),:host([scale=s][icon-start][icon-end]) a:not(.content--slotted){--calcite-button-padding-x-internal:23px;block-size:1.5rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=s][icon-start][icon-end][appearance=transparent]) button:not(.content--slotted),:host([scale=s][icon-start][icon-end][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-x-internal:1.5rem}:host([scale=m][icon-start][icon-end]) button:not(.content--slotted),:host([scale=m][icon-start][icon-end]) a:not(.content--slotted){--calcite-button-padding-x-internal:2rem;block-size:2rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=m][icon-start][icon-end][appearance=transparent]) button:not(.content--slotted),:host([scale=m][icon-start][icon-end][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-x-internal:33px}:host([scale=l][icon-start][icon-end]) button:not(.content--slotted),:host([scale=l][icon-start][icon-end]) a:not(.content--slotted){--calcite-button-padding-x-internal:43px;block-size:2.75rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=l][icon-start][icon-end]) button:not(.content--slotted) .icon--start+.icon--end,:host([scale=l][icon-start][icon-end]) a:not(.content--slotted) .icon--start+.icon--end{margin-inline-start:1rem}:host([scale=l][icon-start][icon-end][appearance=transparent]) button:not(.content--slotted),:host([scale=l][icon-start][icon-end][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-x-internal:2.75rem}:host([hidden]){display:none}[hidden]{display:none}`,aCt=rh(class extends nh{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.mutationObserver=qv("mutation",()=>this.updateHasContent()),this.resizeObserver=qv("resize",()=>this.setTooltipText()),this.handleClick=()=>{const{type:t}=this;this.href||(t==="submit"?YEt(this):t==="reset"&&XEt(this))},this.setTooltipText=()=>{const{contentEl:t}=this;t&&(this.tooltipText=t.offsetWidth<t.scrollWidth?this.el.innerText:null)},this.setChildEl=t=>{this.childEl=t,t&&this.resizeObserver?.observe(t)},this.alignment="center",this.appearance="solid",this.label=void 0,this.kind="brand",this.disabled=!1,this.form=void 0,this.href=void 0,this.iconEnd=void 0,this.iconFlipRtl=void 0,this.iconStart=void 0,this.loading=!1,this.name=void 0,this.rel=void 0,this.round=!1,this.scale="m",this.splitChild=!1,this.target=void 0,this.type="button",this.width="auto",this.messages=void 0,this.messageOverrides=void 0,this.hasContent=!1,this.hasLoader=!1,this.effectiveLocale="",this.defaultMessages=void 0,this.tooltipText=void 0,this.globalAttributes={ariaExpanded:void 0}}loadingChanged(t,e){t&&!e&&(this.hasLoader=!0),!t&&e&&window.setTimeout(()=>{this.hasLoader=!1},300)}onMessagesChange(){}async connectedCallback(){T8(this),p$(this),y$(this),Y$e(this,["aria-expanded"]),this.hasLoader=this.loading,this.setupTextContentObserver(),wte(this),this.formEl=z$e(this)}disconnectedCallback(){this.mutationObserver?.disconnect(),S8(this),G$e(this),f$(this),_$(this),this.resizeObserver?.disconnect(),this.formEl=null,X$e(this)}async componentWillLoad(){Qy(this),this.updateHasContent(),await m$(this)}componentDidLoad(){e0(this),this.setTooltipText()}componentDidRender(){x8(this)}render(){const t=this.href?"a":"button",e=t,i=this.hasLoader?Ae("div",{class:lu.buttonLoader},Ae("calcite-loader",{class:this.loading?lu.loadingIn:lu.loadingOut,inline:!0,label:this.messages.loading,scale:this.scale==="l"?"m":"s"})):null,r=!this.iconStart&&!this.iconEnd,n=Ae("calcite-icon",{class:{[lu.icon]:!0,[lu.iconStart]:!0},flipRtl:this.iconFlipRtl==="start"||this.iconFlipRtl==="both",icon:this.iconStart,scale:this.scale==="l"?"m":"s"}),s=Ae("calcite-icon",{class:{[lu.icon]:!0,[lu.iconEnd]:!0},flipRtl:this.iconFlipRtl==="end"||this.iconFlipRtl==="both",icon:this.iconEnd,scale:this.scale==="l"?"m":"s"}),o=Ae("span",{class:lu.content,ref:a=>this.contentEl=a},Ae("slot",null));return Ae(e,{"aria-label":this.loading?this.messages.loading:H$e(this),"aria-live":"polite",class:{[lu.buttonPadding]:r,[lu.buttonPaddingShrunk]:!r,[lu.contentSlotted]:this.hasContent,[lu.iconStartEmpty]:!this.iconStart,[lu.iconEndEmpty]:!this.iconEnd},disabled:this.disabled||this.loading,href:t==="a"&&this.href,name:t==="button"&&this.name,onClick:this.handleClick,ref:this.setChildEl,rel:t==="a"&&this.rel,tabIndex:this.disabled||this.loading?-1:null,target:t==="a"&&this.target,title:this.tooltipText,type:t==="button"&&this.type,...this.globalAttributes},i,this.iconStart?n:null,this.hasContent?o:null,this.iconEnd?s:null)}async setFocus(){await t0(this),this.childEl?.focus()}effectiveLocaleChange(){g$(this,this.effectiveLocale)}updateHasContent(){const t=this.el.textContent.trim().length>0||this.el.childNodes.length>0;this.hasContent=this.el.childNodes.length===1&&this.el.childNodes[0]?.nodeName==="#text"?this.el.textContent?.trim().length>0:t}setupTextContentObserver(){this.mutationObserver?.observe(this.el,{childList:!0,subtree:!0})}onLabelClick(){this.handleClick(),this.setFocus()}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{loading:["loadingChanged"],messageOverrides:["onMessagesChange"],effectiveLocale:["effectiveLocaleChange"]}}static get style(){return oCt}},[1,"calcite-button",{alignment:[513],appearance:[513],label:[1],kind:[513],disabled:[516],form:[513],href:[513],iconEnd:[513,"icon-end"],iconFlipRtl:[513,"icon-flip-rtl"],iconStart:[513,"icon-start"],loading:[516],name:[513],rel:[513],round:[516],scale:[513],splitChild:[520,"split-child"],target:[513],type:[513],width:[513],messages:[1040],messageOverrides:[1040],hasContent:[32],hasLoader:[32],effectiveLocale:[32],defaultMessages:[32],tooltipText:[32],globalAttributes:[32],setFocus:[64]}]);function lCt(){if(typeof customElements>"u")return;["calcite-button","calcite-icon","calcite-loader"].forEach(e=>{switch(e){case"calcite-button":customElements.get(e)||customElements.define(e,aCt);break;case"calcite-icon":customElements.get(e)||l1();break;case"calcite-loader":customElements.get(e)||v$();break}})}lCt();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const Ofe=new Set;let _E;const Z$e={childList:!0};function cCt(t){_E||(_E=qv("mutation",J$e)),_E.observe(t.el,Z$e)}function uCt(t){Ofe.delete(t.el),J$e(_E.takeRecords()),_E.disconnect();for(const[e]of Ofe.entries())_E.observe(e,Z$e)}function J$e(t){t.forEach(({target:e})=>{ote(e)})}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const mc={title:"title",close:"close",imageContainer:"image-container",chipIcon:"chip-icon",textSlotted:"text--slotted",container:"container",imageSlotted:"image--slotted",closable:"closable",multiple:"multiple",selectable:"selectable",selectIcon:"select-icon",selectIconActive:"select-icon--active",nonInteractive:"non-interactive",isCircle:"is-circle"},hCt={image:"image"},CD={close:"x",unchecked:"circle",checkedSingle:"circle-f",checked:"check-circle-f"},dCt=`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-ui-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host([scale=s]){block-size:1.5rem;font-size:var(--calcite-font-size--2);--calcite-chip-spacing-s-internal:0.25rem;--calcite-chip-spacing-l-internal:0.5rem}:host([scale=s]) .close,:host([scale=s]) .select-icon--active{block-size:1rem;inline-size:1rem}:host([scale=s]) .image-container{block-size:1.25rem;inline-size:1.25rem}:host([scale=s]) .container.is-circle{block-size:1.5rem;inline-size:1.5rem}:host([scale=m]){block-size:2rem;font-size:var(--calcite-font-size--1);--calcite-chip-spacing-s-internal:0.375rem;--calcite-chip-spacing-l-internal:0.5rem}:host([scale=m]) .close,:host([scale=m]) .image-container,:host([scale=m]) .select-icon--active{block-size:1.5rem;inline-size:1.5rem}:host([scale=m]) .container.is-circle{block-size:2rem;inline-size:2rem}:host([scale=l]){block-size:2.75rem;font-size:var(--calcite-font-size-0);--calcite-chip-spacing-s-internal:0.5rem;--calcite-chip-spacing-l-internal:0.75rem}:host([scale=l]) .image-container,:host([scale=l]) .close,:host([scale=l]) .select-icon--active{block-size:2rem;inline-size:2rem}:host([scale=l]) .container.is-circle{block-size:2.75rem;inline-size:2.75rem}:host{display:inline-flex;cursor:default;border-radius:9999px}.container{box-sizing:border-box;display:inline-flex;block-size:100%;max-inline-size:100%;align-items:center;justify-content:center;border-radius:9999px;border-width:1px;border-style:solid;border-color:var(--calcite-ui-border-1);font-weight:var(--calcite-font-weight-medium);outline-color:transparent}.container:not(.is-circle){padding-inline:var(--calcite-chip-spacing-s-internal)}.container.selectable{cursor:pointer}.container:not(.non-interactive):focus{outline:2px solid var(--calcite-ui-focus-color, var(--calcite-ui-brand));outline-offset:calc(
            2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-ui-focus-offset-invert),
                1
              )
            )
          )}:host([scale=s]) .container.image--slotted{padding-inline-start:calc(0.125rem / 2)}:host([scale=s]) .container.is-circle{padding-inline:0}.container.text--slotted .title{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding-inline:var(--calcite-chip-spacing-s-internal)}.container:not(.text--slotted) .title{display:none}.container:not(.image--slotted) .image-container{display:none}.container.closable{padding-inline-end:calc(var(--calcite-chip-spacing-l-internal) / 2)}.container:not(.is-circle).image--slotted{padding-inline-start:calc(var(--calcite-chip-spacing-l-internal) / 2)}.container:not(.is-circle).image--slotted .image-container{margin-inline-end:var(--calcite-chip-spacing-s-internal)}.container:not(.is-circle).image--slotted .image-container~.chip-icon{margin-inline-start:var(--calcite-chip-spacing-s-internal)}.container:not(.is-circle).selectable:not(.text--slotted) .chip-icon{margin-inline-end:var(--calcite-chip-spacing-s-internal)}.container:not(.is-circle):not(.selectable):not(.text--slotted) .chip-icon{margin-inline-start:var(--calcite-chip-spacing-s-internal)}.container:not(.is-circle):not(.text--slotted) .chip-icon{margin-inline-end:var(--calcite-chip-spacing-s-internal)}.container:not(.is-circle):not(.text-slotted).image--slotted .image-container{margin-inline-end:var(--calcite-chip-spacing-s-internal)}.container:not(.is-circle):not(.closable):not(.text--slotted).image--slotted.selectable .image-container{margin-inline-end:0}.container:not(.is-circle):not(.closable):not(.text--slotted).image--slotted.selectable .image-container~.chip-icon{margin-inline-start:calc(var(--calcite-chip-spacing-s-internal) * 2)}.chip-icon{position:relative;margin-block:0px;display:inline-flex;transition-duration:150ms;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);margin-inline:var(--calcite-chip-spacing-s-internal)}.image-container{display:inline-flex;overflow:hidden;align-items:center;justify-content:center;pointer-events:none}.close{margin:0px;cursor:pointer;align-items:center;border-style:none;background-color:transparent;color:var(--calcite-ui-text-1);outline-color:transparent;transition:all var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s;-webkit-appearance:none;display:flex;border-radius:50%;align-content:center;justify-content:center;--calcite-chip-transparent-hover:var(--calcite-button-transparent-hover);--calcite-chip-transparent-press:var(--calcite-button-transparent-press)}.close:hover{background-color:var(--calcite-chip-transparent-hover)}.close:focus{background-color:var(--calcite-chip-transparent-hover);outline:2px solid var(--calcite-ui-focus-color, var(--calcite-ui-brand));outline-offset:calc(
            -2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-ui-focus-offset-invert),
                1
              )
            )
          )}.close:active{background-color:var(--calcite-chip-transparent-press)}.close calcite-icon{color:inherit}.select-icon{align-self:center;justify-content:center;align-items:center;display:flex;inset-block-start:-1px;position:relative;visibility:hidden;inline-size:0;opacity:0;transition:opacity 0.15s ease-in-out, inline-size 0.15s ease-in-out}.select-icon.select-icon--active{visibility:visible;opacity:0.5}.container:not(.is-circle).image--slotted .select-icon.select-icon--active{margin-inline-end:var(--calcite-chip-spacing-s-internal)}:host([selected]) .select-icon{opacity:1}.container:hover .select-icon--active{opacity:1}slot[name=image]::slotted(*){display:flex;block-size:100%;inline-size:100%;overflow:hidden;border-radius:50%}:host([kind=neutral]){background-color:var(--calcite-ui-foreground-2);color:var(--calcite-ui-text-1)}:host([kind=neutral]) .container{border-color:transparent}:host([kind=neutral]) .close{color:var(--calcite-ui-text-3)}:host([kind=neutral]) .chip-icon{color:var(--calcite-ui-icon-color, var(--calcite-ui-text-3))}:host([kind=inverse]){background-color:var(--calcite-ui-inverse);color:var(--calcite-ui-text-inverse)}:host([kind=inverse]) .container{border-color:transparent}:host([kind=inverse]) .close{color:var(--calcite-ui-text-inverse)}:host([kind=inverse]) .chip-icon{color:var(--calcite-ui-icon-color, var(--calcite-ui-text-inverse))}:host([kind=brand]){background-color:var(--calcite-ui-brand);color:var(--calcite-ui-text-inverse)}:host([kind=brand]) .container{border-color:transparent}:host([kind=brand]) .close{color:var(--calcite-ui-text-inverse)}:host([kind=brand]) .chip-icon{color:var(--calcite-ui-icon-color, var(--calcite-ui-text-inverse))}:host([appearance=outline-fill]),:host([appearance=outline]){background-color:var(--calcite-ui-foreground-1);color:var(--calcite-ui-text-1)}:host([appearance=outline-fill]) .close,:host([appearance=outline]) .close{color:var(--calcite-ui-text-3)}:host([appearance=outline-fill]) .chip-icon,:host([appearance=outline]) .chip-icon{color:var(--calcite-ui-icon-color, var(--calcite-ui-text-3))}:host([appearance=outline-fill]){background-color:var(--calcite-ui-foreground-1)}:host([appearance=outline]){background-color:transparent}:host([kind=neutral][appearance=outline-fill]) .container,:host([kind=neutral][appearance=outline]) .container{border-color:var(--calcite-ui-border-1)}:host([kind=inverse][appearance=outline-fill]) .container,:host([kind=inverse][appearance=outline]) .container{border-color:var(--calcite-ui-border-inverse)}:host([kind=brand][appearance=outline-fill]) .container,:host([kind=brand][appearance=outline]) .container{border-color:var(--calcite-ui-brand)}:host([kind=brand][appearance=solid]) button,:host([kind=inverse][appearance=solid]) button{outline-color:var(--calcite-ui-text-inverse)}:host([closed]){display:none}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}:host([hidden]){display:none}[hidden]{display:none}`,pCt=rh(class extends nh{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.calciteChipClose=fv(this,"calciteChipClose",6),this.calciteChipSelect=fv(this,"calciteChipSelect",6),this.calciteInternalChipKeyEvent=fv(this,"calciteInternalChipKeyEvent",6),this.mutationObserver=qv("mutation",()=>this.updateHasText()),this.close=()=>{this.calciteChipClose.emit(),this.selected=!1,this.closed=!0},this.closeButtonKeyDownHandler=t=>{M$e(t.key)&&(t.preventDefault(),this.close())},this.handleSlotImageChange=t=>{this.hasImage=ip(t)},this.handleEmittingEvent=()=>{this.interactive&&this.calciteChipSelect.emit()},this.disabled=!1,this.appearance="solid",this.kind="neutral",this.closable=!1,this.icon=void 0,this.iconFlipRtl=!1,this.scale="m",this.label=void 0,this.value=void 0,this.closed=!1,this.selectionMode="none",this.selected=!1,this.messageOverrides=void 0,this.messages=void 0,this.interactive=!1,this.defaultMessages=void 0,this.effectiveLocale=void 0,this.hasText=!1,this.hasImage=!1}onMessagesChange(){}effectiveLocaleChange(){g$(this,this.effectiveLocale)}connectedCallback(){cCt(this),T8(this),p$(this),y$(this),this.mutationObserver?.observe(this.el,{childList:!0,subtree:!0})}componentDidLoad(){e0(this)}componentDidRender(){x8(this)}disconnectedCallback(){uCt(this),S8(this),f$(this),_$(this),this.mutationObserver?.disconnect()}async componentWillLoad(){Qy(this),await m$(this),this.updateHasText()}keyDownHandler(t){if(t.target===this.el)switch(t.key){case" ":case"Enter":this.handleEmittingEvent(),t.preventDefault();break;case"ArrowRight":case"ArrowLeft":case"Home":case"End":this.calciteInternalChipKeyEvent.emit(t),t.preventDefault();break}}clickHandler(){!this.interactive&&this.closable&&this.closeButtonEl.focus()}async setFocus(){await t0(this),!this.disabled&&this.interactive?this.containerEl?.focus():!this.disabled&&this.closable&&this.closeButtonEl?.focus()}updateHasText(){this.hasText=this.el.textContent.trim().length>0}renderChipImage(){return Ae("div",{class:mc.imageContainer},Ae("slot",{name:hCt.image,onSlotchange:this.handleSlotImageChange}))}renderSelectionIcon(){const t=this.selectionMode==="multiple"&&this.selected?CD.checked:this.selectionMode==="multiple"?CD.unchecked:this.selected?CD.checkedSingle:void 0;return Ae("div",{class:{[mc.selectIcon]:!0,[mc.selectIconActive]:this.selectionMode==="multiple"||this.selected}},Ae("calcite-icon",{icon:t,scale:this.scale==="l"?"m":"s"}))}renderCloseButton(){return Ae("button",{"aria-label":this.messages.dismissLabel,class:mc.close,onClick:this.close,onKeyDown:this.closeButtonKeyDownHandler,tabIndex:this.disabled?-1:0,ref:t=>this.closeButtonEl=t},Ae("calcite-icon",{icon:CD.close,scale:this.scale==="l"?"m":"s"}))}renderIcon(){return Ae("calcite-icon",{class:mc.chipIcon,flipRtl:this.iconFlipRtl,icon:this.icon,scale:this.scale==="l"?"m":"s"})}render(){const t=this.disabled||!this.disabled&&!this.interactive,e=this.selectionMode==="multiple"&&this.interactive?"checkbox":this.selectionMode!=="none"&&this.interactive?"radio":this.interactive?"button":void 0;return Ae(md,null,Ae("div",{"aria-checked":this.selectionMode!=="none"&&this.interactive?ex(this.selected):void 0,"aria-disabled":t?ex(this.disabled):void 0,"aria-label":this.label,class:{[mc.container]:!0,[mc.textSlotted]:this.hasText,[mc.imageSlotted]:this.hasImage,[mc.selectable]:this.selectionMode!=="none",[mc.multiple]:this.selectionMode==="multiple",[mc.closable]:this.closable,[mc.nonInteractive]:!this.interactive,[mc.isCircle]:!this.closable&&!this.hasText&&(!this.icon||!this.hasImage)&&(this.selectionMode==="none"||!!this.selectionMode&&this.selectionMode!=="multiple"&&!this.selected)},onClick:this.handleEmittingEvent,role:e,tabIndex:t?-1:0,ref:i=>this.containerEl=i},this.selectionMode!=="none"&&this.renderSelectionIcon(),this.renderChipImage(),this.icon&&this.renderIcon(),Ae("span",{class:mc.title},Ae("slot",null)),this.closable&&this.renderCloseButton()))}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{messageOverrides:["onMessagesChange"],effectiveLocale:["effectiveLocaleChange"]}}static get style(){return dCt}},[1,"calcite-chip",{disabled:[516],appearance:[513],kind:[513],closable:[516],icon:[513],iconFlipRtl:[516,"icon-flip-rtl"],scale:[513],label:[1],value:[8],closed:[1540],selectionMode:[1,"selection-mode"],selected:[1540],messageOverrides:[1040],messages:[1040],interactive:[4],defaultMessages:[32],effectiveLocale:[32],hasText:[32],hasImage:[32],setFocus:[64]},[[0,"keydown","keyDownHandler"],[0,"click","clickHandler"]]]);function fCt(){if(typeof customElements>"u")return;["calcite-chip","calcite-icon"].forEach(e=>{switch(e){case"calcite-chip":customElements.get(e)||customElements.define(e,pCt);break;case"calcite-icon":customElements.get(e)||l1();break}})}fCt();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const mCt={container:"container"},gCt=":host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-ui-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:flex}:host([alignment=start]){text-align:start}:host([alignment=end]){text-align:end}:host([alignment=center]){text-align:center}:host([scale=s]) .container{gap:0.25rem;font-size:var(--calcite-font-size--2);line-height:1rem;margin-block-end:var(--calcite-label-margin-bottom, 0.5rem)}:host([scale=m]) .container{gap:0.5rem;font-size:var(--calcite-font-size--1);line-height:1rem;margin-block-end:var(--calcite-label-margin-bottom, 0.75rem)}:host([scale=l]) .container{gap:0.5rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;margin-block-end:var(--calcite-label-margin-bottom, 1rem)}:host .container{margin-inline:0px;margin-block-start:0px;inline-size:100%;line-height:1.375;color:var(--calcite-ui-text-1)}:host([layout=default]) .container{display:flex;flex-direction:column}:host([layout=inline]) .container,:host([layout=inline-space-between]) .container{display:flex;flex-direction:row;align-items:center;gap:0.5rem}:host([layout=inline][scale=l]) .container{gap:0.75rem}:host([layout=inline-space-between]) .container{justify-content:space-between}:host([disabled])>.container{opacity:var(--calcite-ui-opacity-disabled)}:host([disabled]) ::slotted(*[disabled]),:host([disabled]) ::slotted(*[disabled] *){--tw-bg-opacity:1}:host([disabled]) ::slotted(calcite-input-message:not([active])){--tw-bg-opacity:0}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}:host([hidden]){display:none}[hidden]{display:none}",yCt=rh(class extends nh{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.calciteInternalLabelClick=fv(this,"calciteInternalLabelClick",2),this.labelClickHandler=t=>{this.calciteInternalLabelClick.emit({sourceEvent:t})},this.alignment="start",this.for=void 0,this.scale="m",this.layout="default"}connectedCallback(){document.dispatchEvent(new CustomEvent(E8))}disconnectedCallback(){document.dispatchEvent(new CustomEvent(jk))}render(){return Ae(md,{onClick:this.labelClickHandler},Ae("div",{class:mCt.container},Ae("slot",null)))}get el(){return this}static get style(){return gCt}},[1,"calcite-label",{alignment:[513],for:[513],scale:[513],layout:[513]}]);function _Ct(){if(typeof customElements>"u")return;["calcite-label"].forEach(e=>{switch(e){case"calcite-label":customElements.get(e)||customElements.define(e,yCt);break}})}_Ct();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const vCt=":host{display:flex}ul{margin:0px;display:inline-flex;block-size:100%;align-items:center;padding:0px}:host([layout=vertical]) ul{display:flex;inline-size:100%;flex-direction:column}:host([hidden]){display:none}[hidden]{display:none}",bCt=rh(class extends nh{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.menuItems=[],this.handleMenuSlotChange=t=>{this.menuItems=cte(t),this.setMenuItemLayout(this.menuItems,this.layout)},this.label=void 0,this.layout="horizontal",this.messageOverrides=void 0,this.messages=void 0,this.defaultMessages=void 0,this.effectiveLocale="",this.globalAttributes={role:"menubar"}}handleLayoutChange(t){this.setMenuItemLayout(this.menuItems,t)}onMessagesChange(){}effectiveLocaleChange(){g$(this,this.effectiveLocale)}connectedCallback(){p$(this),y$(this),Y$e(this,["role"])}async componentWillLoad(){Qy(this),await m$(this)}componentDidLoad(){e0(this)}disconnectedCallback(){f$(this),_$(this),X$e(this)}async setFocus(){await t0(this),this.el.focus()}calciteInternalNavMenuItemKeyEvent(t){const e=t.target,i=t.detail.children,r=t.detail.event.key;t.stopPropagation(),r==="ArrowDown"?e.layout==="vertical"?yD(this.menuItems,e,"next",!1):t.detail.isSubmenuOpen&&i[0].setFocus():r==="ArrowUp"?this.layout==="vertical"?yD(this.menuItems,e,"previous",!1):t.detail.isSubmenuOpen&&i[i.length-1].setFocus():r==="ArrowRight"?this.layout==="horizontal"?yD(this.menuItems,e,"next",!1):t.detail.isSubmenuOpen&&i[0].setFocus():r==="ArrowLeft"?this.layout==="horizontal"?yD(this.menuItems,e,"previous",!1):t.detail.isSubmenuOpen&&this.focusParentElement(t.target):r==="Escape"&&this.focusParentElement(t.target),t.preventDefault()}focusParentElement(t){const e=t.parentElement;e&&(lte(e),e.open=!1)}setMenuItemLayout(t,e){t.forEach(i=>{i.layout=e,this.globalAttributes.role==="menubar"&&(i.isTopLevelItem=!0,i.topLevelMenuLayout=this.layout)})}render(){return Ae(md,null,Ae("ul",{"aria-label":this.label,...this.globalAttributes},Ae("slot",{onSlotchange:this.handleMenuSlotChange})))}static get delegatesFocus(){return!0}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{layout:["handleLayoutChange"],messageOverrides:["onMessagesChange"],effectiveLocale:["effectiveLocaleChange"]}}static get style(){return vCt}},[17,"calcite-menu",{label:[1],layout:[513],messageOverrides:[1040],messages:[1040],defaultMessages:[32],effectiveLocale:[32],globalAttributes:[32],setFocus:[64]},[[0,"calciteInternalMenuItemKeyEvent","calciteInternalNavMenuItemKeyEvent"]]]);function K$e(){if(typeof customElements>"u")return;["calcite-menu"].forEach(e=>{switch(e){case"calcite-menu":customElements.get(e)||customElements.define(e,bCt);break}})}K$e();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const En={container:"container",content:"content",dropdownVertical:"dropdown--vertical",dropdownMenuItems:"dropdown-menu-items",dropdownAction:"dropdown-action",layoutVertical:"layout--vertical",hoverHrefIcon:"hover-href-icon",icon:"icon",iconBreadcrumb:"icon--breadcrumb",iconDropdown:"icon--dropdown",iconEnd:"icon--end",iconStart:"icon--start",isParentVertical:"parent--vertical",itemContent:"item-content",open:"open",nested:"nested",textContainer:"text-container"},wCt=`:host{position:relative;box-sizing:border-box;display:flex;align-items:center;flex-shrink:0}:host .container,:host .item-content,:host .content{min-block-size:3rem}:host([layout=vertical]){inline-size:100%}:host(:not([layout=vertical])){block-size:100%}.container,.item-content{display:flex;block-size:100%;inline-size:100%;flex-direction:row;align-items:stretch}.content{position:relative;box-sizing:border-box;display:flex;block-size:100%;inline-size:100%;cursor:pointer;align-items:center;justify-content:center;background-color:var(--calcite-ui-foreground-1);padding-inline:1rem;font-size:var(--calcite-font-size-0);color:var(--calcite-ui-text-2);outline:2px solid transparent;outline-offset:2px;text-decoration:none;border-block-end:0.125rem solid transparent;padding-block-start:0.125rem}.content:hover{background-color:var(--calcite-ui-foreground-2);color:var(--calcite-ui-text-2)}.content:focus{background-color:var(--calcite-ui-foreground-2);color:var(--calcite-ui-text-2);outline:2px solid var(--calcite-ui-focus-color, var(--calcite-ui-brand));outline-offset:calc(
            -2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-ui-focus-offset-invert),
                1
              )
            )
          )}.content:active{background-color:var(--calcite-ui-foreground-3);color:var(--calcite-ui-text-1)}.content span{display:inline-flex}.content.layout--vertical{display:flex;inline-size:100%;justify-content:flex-start;padding-block:1rem;border-block-end:0;border-inline-end:0.25rem solid transparent}:host([active]) .content{color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-brand)}:host([active]) .content .icon{--calcite-ui-icon-color:var(--calcite-ui-brand)}:host([layout=vertical]) .content{padding-inline:0.75rem}.icon--start{margin-inline-end:0.75rem}.icon--end{margin-inline-start:0.75rem}:host([layout=vertical]) .icon--end{margin-inline-start:auto;padding-inline-start:0.75rem}.icon--dropdown{position:relative;margin-inline-start:auto;margin-inline-end:0px;padding-inline-start:0.5rem;--calcite-ui-icon-color:var(--calcite-ui-text-3)}:host([layout=vertical]) .icon--end~.icon--dropdown{margin-inline-start:0.75rem}:host([layout=vertical]) .hover-href-icon{padding-inline-start:0.5rem}:host([layout=vertical]) .hover-href-icon~.icon--end{margin-inline-start:0.5rem}:host([layout=vertical]) .hover-href-icon~.icon--breadcrumb{margin-inline-start:0.75rem}.icon--breadcrumb{margin-inline-end:0px;padding-inline-start:0.5rem;--calcite-ui-icon-color:var(--calcite-ui-text-3)}:host([layout=vertical]) .icon--breadcrumb{margin-inline-start:auto}:host([layout=vertical]) .icon--breadcrumb~.icon--dropdown{margin-inline-start:0.5rem}:host([layout=vertical]) .icon--end~.icon--breadcrumb{margin-inline-start:0.5rem}:host([breadcrumb]) .content{padding-inline-end:0.75rem}calcite-action{position:relative;block-size:auto;border-inline-start:1px solid var(--calcite-ui-foreground-1)}calcite-action:after{position:absolute;inset-inline-start:-1px;display:block;inline-size:1px;content:"";inset-block:0.75rem;background-color:var(--calcite-ui-border-3)}calcite-action:hover:after{block-size:100%;inset-block:0}.content:focus~calcite-action,.content:hover~calcite-action{color:var(--calcite-ui-text-1);border-inline-start:1px solid var(--calcite-ui-border-3)}.container:hover .dropdown-action{background-color:var(--calcite-ui-foreground-2)}.dropdown-menu-items{position:absolute;display:none;block-size:auto;min-inline-size:100%;flex-direction:column;overflow:visible;border:1px solid var(--calcite-ui-border-3);background:var(--calcite-ui-foreground-1);inset-block-start:100%;z-index:var(--calcite-app-z-index-dropdown)}.dropdown-menu-items.open{display:block}.dropdown-menu-items.nested{position:absolute;inset-block-start:-1px;transform:translateX(calc(100% - 2px))}.parent--vertical{flex-direction:column}.dropdown--vertical.dropdown-menu-items{position:relative;border-radius:0px;box-shadow:none;inset-block-start:0;transform:none}.dropdown--vertical.dropdown-menu-items:last-of-type{border-inline:0}:host([layout=vertical]:last-of-type) .dropdown-menu-items{border-block-end:0}:host([slot=submenu-item]) .parent--vertical{padding-inline-start:1.5rem}.dropdown-menu-items.nested.calcite--rtl{transform:translateX(calc(-100% + 2px))}.dropdown--vertical.dropdown-menu-items.nested.calcite--rtl{transform:none}.hover-href-icon{position:relative;inset-inline-end:0.25rem;margin-inline-start:auto;opacity:0;transition:all var(--calcite-internal-animation-timing-medium) ease-in-out}.content:focus .hover-href-icon,.content:hover .hover-href-icon{inset-inline-end:-0.25rem;opacity:1}:host([hidden]){display:none}[hidden]{display:none}`,xCt=rh(class extends nh{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.calciteInternalMenuItemKeyEvent=fv(this,"calciteInternalMenuItemKeyEvent",7),this.calciteMenuItemSelect=fv(this,"calciteMenuItemSelect",7),this.clickHandler=t=>{(this.href&&t.target===this.dropdownActionEl||!this.href&&this.hasSubmenu)&&(this.open=!this.open),this.selectMenuItem(t)},this.handleMenuItemSlotChange=t=>{this.submenuItems=cte(t),this.submenuItems.forEach(e=>{e.topLevelMenuLayout||(e.topLevelMenuLayout=this.topLevelMenuLayout)}),this.hasSubmenu=this.submenuItems.length>0},this.keyDownHandler=async t=>{if(t.key===" "||t.key==="Enter")this.selectMenuItem(t),this.hasSubmenu&&(!this.href||this.href&&t.target===this.dropdownActionEl)&&(this.open=!this.open),t.preventDefault();else if(t.key==="Escape"){if(this.open){this.open=!1;return}this.calciteInternalMenuItemKeyEvent.emit({event:t}),t.preventDefault()}else if(t.key==="ArrowDown"||t.key==="ArrowUp"){if(t.preventDefault(),(t.target===this.dropdownActionEl||!this.href)&&this.hasSubmenu&&!this.open&&this.layout==="horizontal"){this.open=!0;return}this.calciteInternalMenuItemKeyEvent.emit({event:t,children:this.submenuItems,isSubmenuOpen:this.open&&this.hasSubmenu})}else if(t.key==="ArrowLeft")t.preventDefault(),this.calciteInternalMenuItemKeyEvent.emit({event:t,children:this.submenuItems,isSubmenuOpen:!0});else if(t.key==="ArrowRight"){if(t.preventDefault(),(t.target===this.dropdownActionEl||!this.href)&&this.hasSubmenu&&!this.open&&this.layout==="vertical"){this.open=!0;return}this.calciteInternalMenuItemKeyEvent.emit({event:t,children:this.submenuItems,isSubmenuOpen:this.open&&this.hasSubmenu})}},this.active=void 0,this.breadcrumb=void 0,this.href=void 0,this.iconEnd=void 0,this.iconFlipRtl=void 0,this.iconStart=void 0,this.isTopLevelItem=!1,this.label=void 0,this.layout=void 0,this.messageOverrides=void 0,this.messages=void 0,this.open=!1,this.rel=void 0,this.target=void 0,this.text=void 0,this.topLevelMenuLayout=void 0,this.defaultMessages=void 0,this.effectiveLocale="",this.hasSubmenu=!1,this.submenuItems=void 0}onMessagesChange(){}effectiveLocaleChange(){g$(this,this.effectiveLocale)}async setFocus(){await t0(this),this.anchorEl.focus()}handleClickOut(t){this.topLevelMenuLayout!=="vertical"&&this.hasSubmenu&&this.open&&!t.composedPath().includes(this.el)&&(this.open=!1)}handleFocusOut(t){this.topLevelMenuLayout!=="vertical"&&!this.el.contains(t.relatedTarget)&&(this.open=!1)}connectedCallback(){p$(this),y$(this)}async componentWillLoad(){Qy(this),await m$(this)}componentDidLoad(){e0(this)}disconnectedCallback(){f$(this),_$(this)}blurHandler(){this.isFocused=!1}focusHandler(t){const e=t.target;this.isFocused=!0,e.open&&!this.open&&(e.open=!1)}selectMenuItem(t){t.target!==this.dropdownActionEl&&this.calciteMenuItemSelect.emit()}renderIconStart(){return Ae("calcite-icon",{class:`${En.icon} ${En.iconStart}`,flipRtl:this.iconFlipRtl==="start"||this.iconFlipRtl==="both",icon:this.iconStart,key:En.iconStart,scale:"s"})}renderIconEnd(){return Ae("calcite-icon",{class:`${En.icon} ${En.iconEnd}`,flipRtl:this.iconFlipRtl==="end"||this.iconFlipRtl==="both",icon:this.iconEnd,key:En.iconEnd,scale:"s"})}renderBreadcrumbIcon(t){return Ae("calcite-icon",{class:`${En.icon} ${En.iconBreadcrumb}`,icon:t==="rtl"?"chevron-left":"chevron-right",key:En.iconBreadcrumb,scale:"s"})}renderDropdownIcon(t){const e=t==="rtl"?"chevron-left":"chevron-right";return Ae("calcite-icon",{class:`${En.icon} ${En.iconDropdown}`,icon:this.topLevelMenuLayout==="vertical"||this.isTopLevelItem?this.open?"chevron-up":"chevron-down":e,key:En.iconDropdown,scale:"s"})}renderDropdownAction(t){const e=t==="rtl"?"chevron-left":"chevron-right";return Ae("calcite-action",{class:En.dropdownAction,icon:this.topLevelMenuLayout==="vertical"||this.isTopLevelItem?this.open?"chevron-up":"chevron-down":e,key:En.dropdownAction,onClick:this.clickHandler,onKeyDown:this.keyDownHandler,text:this.messages.open,ref:i=>this.dropdownActionEl=i})}renderSubmenuItems(t){return Ae("calcite-menu",{class:{[En.dropdownMenuItems]:!0,[En.open]:this.open,[En.nested]:!this.isTopLevelItem,[hY.rtl]:t==="rtl",[En.dropdownVertical]:this.topLevelMenuLayout==="vertical"},label:this.messages.submenu,layout:"vertical",role:"menu"},Ae("slot",{name:"submenu-item",onSlotchange:this.handleMenuItemSlotChange}))}renderHrefIcon(t){return Ae("calcite-icon",{class:En.hoverHrefIcon,icon:t==="rtl"?"arrow-left":"arrow-right",key:En.hoverHrefIcon,scale:"s"})}renderItemContent(t){const e=this.href&&(this.topLevelMenuLayout==="vertical"||!this.isTopLevelItem);return Ae(vMe,null,this.iconStart&&this.renderIconStart(),Ae("div",{class:En.textContainer},Ae("span",null,this.text)),e&&this.renderHrefIcon(t),this.iconEnd&&this.renderIconEnd(),this.breadcrumb?this.renderBreadcrumbIcon(t):null,!this.href&&this.hasSubmenu?this.renderDropdownIcon(t):null)}render(){const t=LMe(this.el);return Ae(md,{onBlur:this.blurHandler,onFocus:this.focusHandler},Ae("li",{class:{[En.container]:!0,[En.isParentVertical]:this.topLevelMenuLayout==="vertical"},role:"none"},Ae("div",{class:En.itemContent},Ae("a",{"aria-current":this.isFocused?"page":!1,"aria-expanded":this.open,"aria-haspopup":this.hasSubmenu,"aria-label":this.label,class:{[En.layoutVertical]:this.layout==="vertical",[En.content]:!0},href:this.href,onClick:this.clickHandler,onKeyDown:this.keyDownHandler,rel:this.rel,role:"menuitem",tabIndex:this.isTopLevelItem?0:-1,target:this.target,ref:e=>this.anchorEl=e},this.renderItemContent(t)),this.href&&this.hasSubmenu?this.renderDropdownAction(t):null),this.renderSubmenuItems(t)))}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{messageOverrides:["onMessagesChange"],effectiveLocale:["effectiveLocaleChange"]}}static get style(){return wCt}},[1,"calcite-menu-item",{active:[516],breadcrumb:[516],href:[1],iconEnd:[513,"icon-end"],iconFlipRtl:[513,"icon-flip-rtl"],iconStart:[513,"icon-start"],isTopLevelItem:[4,"is-top-level-item"],label:[1],layout:[513],messageOverrides:[1040],messages:[1040],open:[1540],rel:[513],target:[513],text:[1],topLevelMenuLayout:[1,"top-level-menu-layout"],defaultMessages:[32],effectiveLocale:[32],hasSubmenu:[32],submenuItems:[32],setFocus:[64]},[[8,"click","handleClickOut"],[0,"focusout","handleFocusOut"]]]);function TCt(){if(typeof customElements>"u")return;["calcite-menu-item","calcite-action","calcite-icon","calcite-loader","calcite-menu"].forEach(e=>{switch(e){case"calcite-menu-item":customElements.get(e)||customElements.define(e,xCt);break;case"calcite-action":customElements.get(e)||_te();break;case"calcite-icon":customElements.get(e)||l1();break;case"calcite-loader":customElements.get(e)||v$();break;case"calcite-menu":customElements.get(e)||K$e();break}})}TCt();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const yg={container:"container",containerContent:"container-content",hasProgress:"progress-bar",hide:"hide",primary:"primary",secondary:"secondary",tertiary:"tertiary"},Ha={logo:"logo",user:"user",progress:"progress",navigationAction:"navigation-action",contentStart:"content-start",contentEnd:"content-end",contentCenter:"content-center",navSecondary:"navigation-secondary",navTertiary:"navigation-tertiary"},SCt={hamburger:"hamburger"},ECt=":host([hidden]){display:none}[hidden]{display:none}.container{margin-inline:auto;display:flex;inline-size:100%;flex-direction:column;margin-block:0;margin-inline:auto;background-color:var(--calcite-navigation-background, var(--calcite-ui-foreground-1))}.container.primary,.container.secondary,.container.tertiary{border-block-end:1px solid;border-block-end-color:var(--calcite-navigation-border-color, var(--calcite-ui-border-3))}.user,.logo{display:flex}.hide{display:none}.primary{block-size:4rem}.secondary{block-size:3rem}.tertiary{block-size:3rem}.container-content{margin-inline:auto;display:flex;block-size:100%;inline-size:100%;margin-block:0;inline-size:var(--calcite-navigation-width, 100%);max-inline-size:100%}.container-content.progress-bar{margin-block-start:0.125rem}slot[name]{display:flex;flex-direction:row}slot[name=navigation-secondary]::slotted(calcite-navigation),slot[name=navigation-tertiary]::slotted(calcite-navigation){inline-size:100%}slot[name=content-start]::slotted(*),slot[name=content-center]::slotted(*),slot[name=content-end]::slotted(*){display:flex;flex-direction:row;align-items:center}slot[name=progress],slot[name=progress] calcite-progress{inset-block-start:0;inset-inline:0}slot[name=content-end]{margin-inline-start:auto}slot[name=content-start]{margin-inline-end:auto}slot[name=content-end],slot[name=logo]~slot[name=user],slot[name=user]:only-child{margin-inline-start:auto}slot[name=content-center]{margin-inline-start:auto;margin-inline-end:auto}slot[name=content-start]~slot[name=content-center]{margin-inline-start:0px}slot[name=content-start]~slot[name=content-end],slot[name=content-center]~slot[name=content-end],slot[name=content-center]~slot[name=user],slot[name=content-end]~slot[name=user]{margin:0px}",CCt=rh(class extends nh{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.calciteNavigationActionSelect=fv(this,"calciteNavigationActionSelect",6),this.actionClickHandler=()=>{this.calciteNavigationActionSelect.emit()},this.handleUserSlotChange=t=>{this.isPrimaryLevel()&&(this.userSlotHasElements=ip(t))},this.handleLogoSlotChange=t=>{this.isPrimaryLevel()&&(this.logoSlotHasElements=ip(t))},this.handleContentStartSlotChange=t=>{this.isPrimaryLevel()&&(this.primaryContentStartSlotHasElements=ip(t))},this.handleContentEndSlotChange=t=>{this.isPrimaryLevel()&&(this.primaryContentEndSlotHasElements=ip(t))},this.handleContentCenterSlotChange=t=>{this.isPrimaryLevel()&&(this.primaryContentCenterSlotHasElements=ip(t))},this.handleSecondarySlotChange=t=>{this.secondarySlotHasElements=ip(t)},this.handleTertiarySlotChange=t=>{this.tertiarySlotHasElements=ip(t)},this.handleMenuActionSlotChange=t=>{this.isPrimaryLevel()&&(this.navigationActionSlotHasElements=ip(t),this.navigationActionSlotHasElements&&(this.navigationAction=!1))},this.handleProgressSlotChange=t=>{this.isPrimaryLevel()&&(this.progressSlotHasElement=ip(t))},this.label=void 0,this.navigationAction=!1,this.logoSlotHasElements=void 0,this.navigationActionSlotHasElements=void 0,this.primaryContentCenterSlotHasElements=void 0,this.primaryContentEndSlotHasElements=void 0,this.primaryContentStartSlotHasElements=void 0,this.progressSlotHasElement=void 0,this.secondarySlotHasElements=void 0,this.tertiarySlotHasElements=void 0,this.userSlotHasElements=void 0}async setFocus(){return await t0(this),this.navigationActionEl?.setFocus()}componentWillLoad(){Qy(this)}componentDidLoad(){e0(this)}isPrimaryLevel(){return this.el.slot!==Ha.navSecondary&&this.el.slot!==Ha.navTertiary}renderMenuAction(){return Ae("slot",{name:Ha.navigationAction,onSlotchange:this.handleMenuActionSlotChange},this.navigationAction&&Ae("calcite-action",{icon:SCt.hamburger,onClick:this.actionClickHandler,text:this.label,ref:t=>this.navigationActionEl=t}))}render(){const t=this.logoSlotHasElements||this.userSlotHasElements||this.navigationActionSlotHasElements||this.primaryContentCenterSlotHasElements||this.primaryContentEndSlotHasElements||this.primaryContentStartSlotHasElements||this.navigationAction,e=this.el.slot;return Ae(md,null,Ae("div",{class:{[yg.container]:!0,[yg.secondary]:e===Ha.navSecondary,[yg.tertiary]:e===Ha.navTertiary,[yg.primary]:t}},Ae("div",{class:{[yg.hide]:!this.progressSlotHasElement,[Ha.progress]:!0}},Ae("slot",{name:Ha.progress,onSlotchange:this.handleProgressSlotChange})),Ae("div",{class:{[yg.containerContent]:!0,[yg.hasProgress]:this.progressSlotHasElement}},this.renderMenuAction(),Ae("div",{class:{[yg.hide]:!this.logoSlotHasElements,[Ha.logo]:!0}},Ae("slot",{name:Ha.logo,onSlotchange:this.handleLogoSlotChange})),Ae("slot",{name:Ha.contentStart,onSlotchange:this.handleContentStartSlotChange}),Ae("slot",{name:Ha.contentCenter,onSlotchange:this.handleContentCenterSlotChange}),Ae("slot",{name:Ha.contentEnd,onSlotchange:this.handleContentEndSlotChange}),Ae("div",{class:{[yg.hide]:!this.userSlotHasElements,[Ha.user]:!0}},Ae("slot",{name:Ha.user,onSlotchange:this.handleUserSlotChange})))),Ae(vMe,null,Ae("slot",{name:Ha.navSecondary,onSlotchange:this.handleSecondarySlotChange}),Ae("slot",{name:Ha.navTertiary,onSlotchange:this.handleTertiarySlotChange})))}get el(){return this}static get style(){return ECt}},[1,"calcite-navigation",{label:[1],navigationAction:[516,"navigation-action"],logoSlotHasElements:[32],navigationActionSlotHasElements:[32],primaryContentCenterSlotHasElements:[32],primaryContentEndSlotHasElements:[32],primaryContentStartSlotHasElements:[32],progressSlotHasElement:[32],secondarySlotHasElements:[32],tertiarySlotHasElements:[32],userSlotHasElements:[32],setFocus:[64]}]);function ACt(){if(typeof customElements>"u")return;["calcite-navigation","calcite-action","calcite-icon","calcite-loader"].forEach(e=>{switch(e){case"calcite-navigation":customElements.get(e)||customElements.define(e,CCt);break;case"calcite-action":customElements.get(e)||_te();break;case"calcite-icon":customElements.get(e)||l1();break;case"calcite-loader":customElements.get(e)||v$();break}})}ACt();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const j0={container:"container",heading:"heading",description:"description",anchor:"anchor",image:"image",standalone:"standalone"},OCt=`:host{display:inline-flex;outline:2px solid transparent;outline-offset:2px}.anchor{margin:0px;display:flex;cursor:pointer;align-items:center;justify-content:center;font-size:var(--calcite-font-size-0);line-height:1.25rem;text-decoration-line:none;outline-color:transparent;transition:all var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s;border-block-end:2px solid transparent}.anchor:hover,.anchor:focus{background-color:var(--calcite-ui-foreground-2)}.anchor:focus{outline:2px solid var(--calcite-ui-focus-color, var(--calcite-ui-brand));outline-offset:calc(
            -2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-ui-focus-offset-invert),
                1
              )
            )
          )}.anchor:active{background-color:var(--calcite-ui-foreground-3)}.image{margin:0px;display:flex;block-size:1.75rem;padding-inline:1rem}.image~.container{padding-inline-start:0px}:host(:active) .anchor{color:var(--calcite-ui-text-1)}:host([active]) .anchor{color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-brand);--calcite-ui-icon-color:var(--calcite-ui-brand)}.container{margin-block-start:0.125rem;display:flex;flex-direction:column;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding-inline:1rem;text-align:start}.heading{margin-inline-start:0px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:var(--calcite-font-size-0);font-weight:var(--calcite-font-weight-medium);color:var(--calcite-ui-text-1)}.standalone{font-size:var(--calcite-font-size-1)}.description{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:var(--calcite-ui-text-2);font-size:var(--calcite-font-size--1)}:host([hidden]){display:none}[hidden]{display:none}`,RCt=rh(class extends nh{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.active=void 0,this.href=void 0,this.label=void 0,this.rel=void 0,this.description=void 0,this.target=void 0,this.heading=void 0,this.thumbnail=void 0}async setFocus(){await t0(this),this.href&&this.el.focus()}componentWillLoad(){Qy(this)}componentDidLoad(){e0(this)}render(){const{heading:t,description:e,thumbnail:i}=this;return Ae(md,null,Ae("a",{class:j0.anchor,href:this.href,rel:this.rel,target:this.target},i&&Ae("img",{alt:this.label||"",class:j0.image,src:i}),(t||e)&&Ae("div",{class:j0.container},t&&Ae("span",{"aria-label":this.heading,class:{[j0.heading]:!0,[j0.standalone]:!this.description},key:j0.heading},t),e&&Ae("span",{"aria-label":this.description,class:j0.description,key:j0.description},e))))}static get delegatesFocus(){return!0}get el(){return this}static get style(){return OCt}},[17,"calcite-navigation-logo",{active:[516],href:[513],label:[1],rel:[513],description:[1],target:[513],heading:[1],thumbnail:[1],setFocus:[64]}]);function PCt(){if(typeof customElements>"u")return;["calcite-navigation-logo"].forEach(e=>{switch(e){case"calcite-navigation-logo":customElements.get(e)||customElements.define(e,RCt);break}})}PCt();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const MCt=/^#[0-9A-F]{3}$/i,$Ct=/^#[0-9A-F]{6}$/i,ICt=/^#[0-9A-F]{4}$/i,LCt=/^#[0-9A-F]{8}$/i;function bY(t,e=!1){return DCt(t,e)||NCt(t,e)}function Q$e(t,e,i){return t?t.length===e&&i.test(t):!1}function DCt(t,e=!1){return Q$e(t,e?5:4,e?ICt:MCt)}function NCt(t,e=!1){return Q$e(t,e?9:7,e?LCt:$Ct)}function FCt(t,e=!1){if(!bY(t,e))return null;t=t.replace("#","");let i,r,n,s;if(t.length===3||t.length===4){const[a,l,c,h]=t.split("");i=parseInt(`${a}${a}`,16),r=parseInt(`${l}${l}`,16),n=parseInt(`${c}${c}`,16),s=parseInt(`${h}${h}`,16)/255}else i=parseInt(t.slice(0,2),16),r=parseInt(t.slice(2,4),16),n=parseInt(t.slice(4,6),16),s=parseInt(t.slice(6,8),16)/255;return isNaN(s)?{r:i,g:r,b:n}:{r:i,g:r,b:n,a:s}}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */function kCt(t){let e=0;for(let r=0;r<t.length;r++)e=t.charCodeAt(r)+((e<<5)-e);let i="#";for(let r=0;r<3;r++){const n=e>>r*8&255;i+=("00"+n.toString(16)).substr(-2)}return i}function UCt(t){let{r:e,g:i,b:r}=t;e/=255,i/=255,r/=255;const n=Math.max(e,i,r),s=Math.min(e,i,r),o=n-s;if(n===s)return 0;let a=(n+s)/2;switch(n){case e:a=(i-r)/o+(i<r?6:0);break;case i:a=(r-e)/o+2;break;case r:a=(e-i)/o+4;break}return Math.round(a*60)}function zCt(t){return UCt(FCt(t))}const BCt=":host{display:inline-block;overflow:hidden;border-radius:50%}:host([scale=s]){block-size:1.5rem;inline-size:1.5rem;font-size:var(--calcite-font-size--3)}:host([scale=m]){block-size:2rem;inline-size:2rem;font-size:var(--calcite-font-size--2)}:host([scale=l]){block-size:2.75rem;inline-size:2.75rem;font-size:var(--calcite-font-size-0)}.icon{display:flex}.background{display:flex;block-size:100%;inline-size:100%;align-items:center;justify-content:center;border-radius:50%}.initials{font-weight:var(--calcite-font-weight-bold);text-transform:uppercase;color:var(--calcite-ui-text-2)}.thumbnail{block-size:100%;inline-size:100%;border-radius:50%}:host([hidden]){display:none}[hidden]{display:none}",VCt=rh(class extends nh{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.scale="m",this.thumbnail=void 0,this.fullName=void 0,this.username=void 0,this.userId=void 0,this.label=void 0,this.thumbnailFailedToLoad=!1}render(){return this.determineContent()}determineContent(){if(this.thumbnail&&!this.thumbnailFailedToLoad)return Ae("img",{alt:this.label||"",class:"thumbnail",onError:()=>this.thumbnailFailedToLoad=!0,src:this.thumbnail});const t=this.generateInitials(),e=this.generateFillColor();return Ae("span",{"aria-label":this.label||this.fullName,class:"background",role:"figure",style:{backgroundColor:e}},t?Ae("span",{"aria-hidden":"true",class:"initials"},t):Ae("calcite-icon",{class:"icon",icon:"user",scale:this.scale}))}generateFillColor(){const{userId:t,username:e,fullName:i,el:r}=this,n=ESt(r),s=t&&`#${t.substr(t.length-6)}`,o=e||i||"",a=s&&bY(s)?s:kCt(o);return!t&&!o||!bY(a)?"var(--calcite-ui-foreground-2)":`hsl(${zCt(a)}, 60%, ${n==="dark"?20:90}%)`}generateInitials(){const{fullName:t,username:e}=this;return t?t.trim().split(" ").map(i=>i.substring(0,1)).join(""):e?e.substring(0,2):!1}get el(){return this}static get style(){return BCt}},[1,"calcite-avatar",{scale:[513],thumbnail:[513],fullName:[513,"full-name"],username:[513],userId:[513,"user-id"],label:[1],thumbnailFailedToLoad:[32]}]);function eIe(){if(typeof customElements>"u")return;["calcite-avatar","calcite-icon"].forEach(e=>{switch(e){case"calcite-avatar":customElements.get(e)||customElements.define(e,VCt);break;case"calcite-icon":customElements.get(e)||l1();break}})}eIe();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const bS={textContainer:"text-container",fullName:"full-name",username:"username",button:"button"},GCt=`:host{display:inline-flex;outline:2px solid transparent;outline-offset:2px}:host .button{background-color:transparent;border:none;margin:0px;display:flex;cursor:pointer;align-items:center;justify-content:center;font-family:var(--calcite-sans-family);font-size:var(--calcite-font-size-0);line-height:1.25rem;outline-color:transparent;transition:all var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s;border-block-end:2px solid transparent}:host(:hover) .button,:host(:focus) .button{background-color:var(--calcite-ui-foreground-2)}:host(:focus) .button{outline:2px solid var(--calcite-ui-focus-color, var(--calcite-ui-brand));outline-offset:calc(
            -2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-ui-focus-offset-invert),
                1
              )
            )
          )}:host(:active) .button{background-color:var(--calcite-ui-foreground-3);color:var(--calcite-ui-text-1)}calcite-avatar{padding-inline:1rem}calcite-avatar~.text-container{padding-inline-start:0px}:host([active]) .button{border-color:var(--calcite-ui-brand);color:var(--calcite-ui-text-1);--calcite-ui-icon-color:var(--calcite-ui-brand)}.text-container{margin-block-start:0.125rem;display:flex;flex-direction:column;padding-inline:1rem;text-align:start}.full-name{margin-inline-start:0px;font-size:var(--calcite-font-size-0);font-weight:var(--calcite-font-weight-medium);color:var(--calcite-ui-text-1)}.username{color:var(--calcite-ui-text-2);font-size:var(--calcite-font-size--1)}:host([hidden]){display:none}[hidden]{display:none}`,jCt=rh(class extends nh{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.active=void 0,this.fullName=void 0,this.label=void 0,this.textDisabled=!1,this.thumbnail=void 0,this.userId=void 0,this.username=void 0}async setFocus(){await t0(this),this.el.focus()}componentWillLoad(){Qy(this)}componentDidLoad(){e0(this)}render(){return Ae(md,null,Ae("button",{"aria-label":this.label,class:bS.button},Ae("calcite-avatar",{"full-name":this.fullName,label:this.label,thumbnail:this.thumbnail,"user-id":this.userId,username:this.username}),(this.fullName||this.username)&&!this.textDisabled&&Ae("div",{class:bS.textContainer},this.fullName&&Ae("span",{class:bS.fullName,key:bS.fullName},this.fullName),this.username&&Ae("span",{class:bS.username,key:bS.username},this.username))))}static get delegatesFocus(){return!0}get el(){return this}static get style(){return GCt}},[17,"calcite-navigation-user",{active:[516],fullName:[1,"full-name"],label:[1],textDisabled:[516,"text-disabled"],thumbnail:[1],userId:[1,"user-id"],username:[1],setFocus:[64]}]);function HCt(){if(typeof customElements>"u")return;["calcite-navigation-user","calcite-avatar","calcite-icon"].forEach(e=>{switch(e){case"calcite-navigation-user":customElements.get(e)||customElements.define(e,jCt);break;case"calcite-avatar":customElements.get(e)||eIe();break;case"calcite-icon":customElements.get(e)||l1();break}})}HCt();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const qCt=`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-ui-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host([scale=s]) .container{block-size:0.75rem}:host([scale=s]) .track{block-size:0.75rem;inline-size:1.5rem}:host([scale=s]) .handle{block-size:0.5rem;inline-size:0.5rem}:host([scale=m]) .container{block-size:1rem}:host([scale=m]) .track{block-size:1rem;inline-size:2rem}:host([scale=m]) .handle{block-size:0.75rem;inline-size:0.75rem}:host([scale=l]) .container{block-size:1.5rem}:host([scale=l]) .track{block-size:1.5rem;inline-size:3rem}:host([scale=l]) .handle{block-size:1.25rem;inline-size:1.25rem}:host{position:relative;display:inline-block;inline-size:auto;cursor:pointer;-webkit-user-select:none;user-select:none;vertical-align:middle;tap-highlight-color:transparent}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.container{outline-width:0px}.track{pointer-events:none;position:relative;box-sizing:border-box;display:inline-block;border-radius:9999px;border-width:1px;border-style:solid;border-color:var(--calcite-ui-border-2);background-color:var(--calcite-ui-foreground-2);vertical-align:top;outline-color:transparent}:host(:focus) .track{outline:2px solid var(--calcite-ui-focus-color, var(--calcite-ui-brand));outline-offset:calc(
            2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-ui-focus-offset-invert),
                1
              )
            )
          )}.handle{pointer-events:none;position:absolute;display:block;border-radius:9999px;border-width:2px;border-style:solid;border-color:var(--calcite-ui-border-input);background-color:var(--calcite-ui-foreground-1);transition-property:all;transition-duration:150ms;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);inset-block-start:-1px;inset-inline:-1px auto}:host(:hover) .handle,:host(:focus) .handle{border-color:var(--calcite-ui-brand);box-shadow:inset 0 0 0 1px var(--calcite-ui-brand)}:host([checked]) .track{border-color:var(--calcite-ui-brand-hover);background-color:var(--calcite-ui-brand)}:host([checked]) .handle{border-color:var(--calcite-ui-brand);inset-inline:auto -1px}:host([checked]:hover) .track{border-color:var(--calcite-ui-brand-hover);background-color:var(--calcite-ui-brand)}:host([checked]:hover) .handle{border-color:var(--calcite-ui-brand-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-brand-hover)}@media (forced-colors: active){:host([checked]) .track{background-color:canvasText}}::slotted(input[slot=hidden-form-input]){margin:0 !important;opacity:0 !important;outline:none !important;padding:0 !important;position:absolute !important;inset:0 !important;transform:none !important;-webkit-appearance:none !important;z-index:-1 !important}:host([hidden]){display:none}[hidden]{display:none}`,WCt=rh(class extends nh{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.calciteSwitchChange=fv(this,"calciteSwitchChange",6),this.keyDownHandler=t=>{!this.disabled&&M$e(t.key)&&(this.toggle(),t.preventDefault())},this.clickHandler=()=>{this.disabled||this.toggle()},this.setSwitchEl=t=>{this.switchEl=t},this.disabled=!1,this.form=void 0,this.label=void 0,this.name=void 0,this.scale="m",this.checked=!1,this.value=void 0}async setFocus(){await t0(this),lte(this.switchEl)}syncHiddenFormInput(t){t.type="checkbox"}onLabelClick(){this.disabled||(this.toggle(),this.setFocus())}toggle(){this.checked=!this.checked,this.calciteSwitchChange.emit()}connectedCallback(){T8(this),wte(this),ZEt(this)}componentWillLoad(){Qy(this)}componentDidLoad(){e0(this)}disconnectedCallback(){S8(this),G$e(this),KEt(this)}componentDidRender(){x8(this)}render(){return Ae(md,{onClick:this.clickHandler,onKeyDown:this.keyDownHandler},Ae("div",{"aria-checked":ex(this.checked),"aria-label":H$e(this),class:"container",role:"switch",tabIndex:0,ref:this.setSwitchEl},Ae("div",{class:"track"},Ae("div",{class:"handle"})),Ae(eCt,{component:this})))}get el(){return this}static get style(){return qCt}},[1,"calcite-switch",{disabled:[516],form:[513],label:[1],name:[513],scale:[513],checked:[1540],value:[8],setFocus:[64]}]);function YCt(){if(typeof customElements>"u")return;["calcite-switch"].forEach(e=>{switch(e){case"calcite-switch":customElements.get(e)||customElements.define(e,WCt);break}})}YCt();var XCt=Object.defineProperty,ZCt=Object.getOwnPropertyDescriptor,xte=(t,e,i,r)=>{for(var n=r>1?void 0:r?ZCt(e,i):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(n=(r?o(e,i,n):o(n))||n);return r&&n&&XCt(e,i,n),n};let QP=class extends Bk{constructor(t){super(t),this.userMenuOpen=!1,this.closeUserMenu=()=>{this.userMenuOpen=!1};const e=t.store.view.container;e.addEventListener("mousedown",this.closeUserMenu),this.addHandles([{remove:()=>{e.removeEventListener("mousedown",this.closeUserMenu)}}])}signOut(){this.store.userStore.signOut(),this.closeUserMenu()}openScene(){const t=this.store.map.portalItem.itemPageUrl;t&&window.open(t,"new")}render(){const t=this.userMenuOpen?"":"hide",e=!this.store.canGoLive;return this.store.isLive,this.store.isChangingLiveState,Ce("div",null,Ce("calcite-navigation",{slot:"header"},Ce("calcite-navigation-logo",{slot:"logo",heading:this.store.map.portalItem.title,description:"ArcGIS Maps SDK for JavaScript",thumbnail:"./icon-64.svg",onclick:()=>{this.openScene()}}),Ce("calcite-label",{disabled:e,layout:"inline",slot:"content-center"},Ce("calcite-chip",{icon:"refresh",class:this.store.isLive||this.store.isChangingLiveState?"refresh":"refresh active"},"Refresh"),Ce("calcite-switch",{onCalciteSwitchChange:()=>this.store.toggleLiveMode(),scale:"l"}),Ce("calcite-chip",{icon:"activity-monitor",class:this.store.isLive&&!this.store.isChangingLiveState?"live active":"live"},"Live")),this.renderUserProfile()),Ce("calcite-menu",{id:"user-menu",layout:"vertical",label:"Application menu",class:t},Ce("calcite-menu-item",{"icon-start":"sign-out",text:"Sign Out",onclick:()=>this.signOut()})))}renderUserProfile(){const t=this.store.userStore;if(t.authenticated){const e=t.user;return Ce("calcite-navigation-user",{slot:"user",active:this.userMenuOpen,onclick:()=>{this.userMenuOpen=!this.userMenuOpen},thumbnail:e?.thumbnailUrl,"full-name":e?.fullName,username:e?.username})}else return Ce("calcite-menu",{slot:"content-end"},Ce("calcite-menu-item",{onclick:()=>t.signIn(),text:"Sign in","icon-start":"user","text-enabled":!0}))}};xte([p()],QP.prototype,"store",2);xte([p()],QP.prototype,"userMenuOpen",2);QP=xte([M("arcgis-core-template.Header")],QP);const JCt=QP;var KCt=Object.defineProperty,QCt=Object.getOwnPropertyDescriptor,tIe=(t,e,i,r)=>{for(var n=r>1?void 0:r?QCt(e,i):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(n=(r?o(e,i,n):o(n))||n);return r&&n&&KCt(e,i,n),n};let Wk=class extends Bk{postInitialize(){const t=this.store.view,e=new lEt({view:t});t.ui.add(new m2t({view:t,content:e}),"bottom-right")}render(){return Ce("div",null,Ce(JCt,{store:this.store}))}};tIe([p()],Wk.prototype,"store",2);Wk=tIe([M("arcgis-core-template.App")],Wk);const eAt=Wk;var wY;let RO=wY=class extends pe{constructor(t){super(t),this.minValue=0,this.maxValue=0}clone(){return new wY({minValue:this.minValue,maxValue:this.maxValue})}};u([p({type:Number,json:{write:!0}})],RO.prototype,"minValue",void 0),u([p({type:Number,json:{write:!0}})],RO.prototype,"maxValue",void 0),RO=wY=u([M("esri.renderer.support.AuthoringInfoClassBreakInfo")],RO);var xY;let L_=xY=class extends pe{constructor(t){super(t),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new xY({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:Q(this.classBreakInfos)})}};u([p({type:String,json:{write:!0}})],L_.prototype,"field",void 0),u([p({type:String,json:{write:!0}})],L_.prototype,"normalizationField",void 0),u([p({type:String,json:{write:!0}})],L_.prototype,"label",void 0),u([p({type:[RO],json:{write:!0}})],L_.prototype,"classBreakInfos",void 0),L_=xY=u([M("esri.renderers.support.AuthoringInfoFieldInfo")],L_);var TY;const AD=new Sr({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),OD=new Sr({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),Rfe={key:t=>typeof t=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},Pfe=["high-to-low","above-and-below","centered-on","extremes"],Mfe=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],$fe=["seconds","minutes","hours","days","months","years"];let _c=TY=class extends pe{constructor(t){super(t),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(t){return typeof t=="string"||typeof t=="number"?t:null}castStartTime(t){return typeof t=="string"||typeof t=="number"?t:null}get style(){return this.type==="color"?this._get("style"):null}set style(t){this._set("style",t)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(t){this._set("theme",t)}clone(){return new TY({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};u([p({types:Rfe,json:{write:!0}})],_c.prototype,"endTime",void 0),u([ai("endTime")],_c.prototype,"castEndTime",null),u([p({type:String,json:{write:!0}})],_c.prototype,"field",void 0),u([p({type:Number,json:{write:!0}})],_c.prototype,"maxSliderValue",void 0),u([p({type:Number,json:{write:!0}})],_c.prototype,"minSliderValue",void 0),u([p({types:Rfe,json:{write:!0}})],_c.prototype,"startTime",void 0),u([ai("startTime")],_c.prototype,"castStartTime",null),u([p({type:AD.apiValues,value:null,json:{type:AD.jsonValues,read:AD.read,write:AD.write}})],_c.prototype,"style",null),u([p({type:Mfe,value:null,json:{type:Mfe,origins:{"web-scene":{type:Pfe,write:{writer:(t,e)=>{Pfe.includes(t)&&(e.theme=t)}}}},write:!0}})],_c.prototype,"theme",null),u([p({type:OD.apiValues,json:{type:OD.jsonValues,read:OD.read,write:OD.write}})],_c.prototype,"type",void 0),u([p({type:$fe,json:{type:$fe,write:!0}})],_c.prototype,"units",void 0),_c=TY=u([M("esri.renderers.support.AuthoringInfoVisualVariable")],_c);const tAt=_c;let G4=class extends pe{constructor(e){super(e),this.type=null}};u([p({readOnly:!0,json:{read:!1,write:!0}})],G4.prototype,"type",void 0),G4=u([M("esri.rest.support.ColorRamp")],G4);const Tte=G4;var SY;let Xb=SY=class extends Tte{constructor(t){super(t),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new SY({fromColor:Q(this.fromColor),toColor:Q(this.toColor),algorithm:this.algorithm})}};u([nt({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],Xb.prototype,"algorithm",void 0),u([p({type:Pe,json:{type:[dr],write:!0}})],Xb.prototype,"fromColor",void 0),u([p({type:Pe,json:{type:[dr],write:!0}})],Xb.prototype,"toColor",void 0),u([p({type:["algorithmic"]})],Xb.prototype,"type",void 0),Xb=SY=u([M("esri.rest.support.AlgorithmicColorRamp")],Xb);const Ste=Xb;var EY;let PO=EY=class extends Tte{constructor(t){super(t),this.colorRamps=null,this.type="multipart"}clone(){return new EY({colorRamps:Q(this.colorRamps)})}};u([p({type:[Ste],json:{write:!0}})],PO.prototype,"colorRamps",void 0),u([p({type:["multipart"]})],PO.prototype,"type",void 0),PO=EY=u([M("esri.rest.support.MultipartColorRamp")],PO);const iIe=PO,iAt={key:"type",base:Tte,typeMap:{algorithmic:Ste,multipart:iIe}};function rAt(t){return t?.type?t.type==="algorithmic"?Ste.fromJSON(t):t.type==="multipart"?iIe.fromJSON(t):null:null}var CY;const ib=new Sr({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),RD=new Sr({pieChart:"pie-chart",classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),Ife=new Sr({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),Lfe=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],nAt=["high-to-low","above-and-below","above","below","90-10"],sAt=["flow-line","wave-front"],oAt=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let cs=CY=class extends pe{constructor(t){super(t),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const t=this._get("classificationMethod"),e=this.type;return e&&e!=="relationship"?e==="class-breaks-size"||e==="class-breaks-color"?t||"manual":null:t}set classificationMethod(t){this._set("classificationMethod",t)}readColorRamp(t){return t?rAt(t):void 0}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(t){this._set("fields",t)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(t){this._set("field1",t)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(t){this._set("field2",t)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(t){this._set("flowTheme",t)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(t){this._set("focus",t)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(t){this._set("numClasses",t)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(t){this._set("statistics",t)}get standardDeviationInterval(){const t=this.type;return t&&t!=="relationship"&&t!=="class-breaks-size"&&t!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(t){this._set("standardDeviationInterval",t)}get type(){return this._get("type")}set type(t){let e=t;t==="classed-size"?e="class-breaks-size":t==="classed-color"&&(e="class-breaks-color"),this._set("type",e)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(t){this._set("univariateSymbolStyle",t)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(t){this._set("univariateTheme",t)}clone(){return new CY({classificationMethod:this.classificationMethod,colorRamp:Q(this.colorRamp),fadeRatio:Q(this.fadeRatio),fields:this.fields?.slice(0),field1:Q(this.field1),field2:Q(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(t=>t.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};u([p({type:ib.apiValues,value:null,json:{type:ib.jsonValues,read:ib.read,write:ib.write,origins:{"web-document":{default:"manual",type:ib.jsonValues,read:ib.read,write:ib.write}}}})],cs.prototype,"classificationMethod",null),u([p({types:iAt,json:{write:!0}})],cs.prototype,"colorRamp",void 0),u([wt("colorRamp")],cs.prototype,"readColorRamp",null),u([p({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],cs.prototype,"fadeRatio",void 0),u([p({type:[String],value:null,json:{write:!0}})],cs.prototype,"fields",null),u([p({type:L_,value:null,json:{write:!0}})],cs.prototype,"field1",null),u([p({type:L_,value:null,json:{write:!0}})],cs.prototype,"field2",null),u([p({type:sAt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],cs.prototype,"flowTheme",null),u([p({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],cs.prototype,"focus",null),u([p({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],cs.prototype,"isAutoGenerated",void 0),u([p({type:Number,value:null,json:{type:dr,write:!0}})],cs.prototype,"numClasses",null),u([p({type:Lfe,json:{type:Lfe,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],cs.prototype,"lengthUnit",void 0),u([p({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],cs.prototype,"maxSliderValue",void 0),u([p({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],cs.prototype,"minSliderValue",void 0),u([p({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],cs.prototype,"statistics",null),u([p({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],cs.prototype,"standardDeviationInterval",null),u([p({type:RD.apiValues,value:null,json:{type:RD.jsonValues,read:RD.read,write:RD.write,origins:{"web-scene":{type:Ife.jsonValues,write:{writer:Ife.write,overridePolicy:t=>({enabled:t!=="flow"})}}}}})],cs.prototype,"type",null),u([p({type:[tAt],json:{write:!0}})],cs.prototype,"visualVariables",void 0),u([p({type:oAt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],cs.prototype,"univariateSymbolStyle",null),u([p({type:nAt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],cs.prototype,"univariateTheme",null),cs=CY=u([M("esri.renderers.support.AuthoringInfo")],cs);const Ete=cs,BV=new Sr({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let MO=class extends pe{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const i=new Set;return await this.collectRequiredFields(i,e),Array.from(i).sort()}getSymbol(e,i){}async getSymbolAsync(e,i){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};u([p({type:Ete,json:{write:!0}})],MO.prototype,"authoringInfo",void 0),u([p({type:BV.apiValues,readOnly:!0,json:{type:BV.jsonValues,read:!1,write:{writer:BV.write,ignoreOrigin:!0}}})],MO.prototype,"type",void 0),MO=u([M("esri.renderers.Renderer")],MO);const i0=MO;function aAt(t){return t.match(lAt)?.[1]?.replace(/\\'/g,"'")??null}const lAt=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;var AY;let vE=AY=class extends pe{constructor(){super(...arguments),this.title=null}clone(){return new AY({title:this.title})}};u([p({type:String,json:{write:!0}})],vE.prototype,"title",void 0),vE=AY=u([M("esri.renderers.support.LegendOptions")],vE);var OY;let j4=OY=class extends vE{constructor(){super(...arguments),this.showLegend=null}clone(){return new OY({title:this.title,showLegend:this.showLegend})}};u([p({type:Boolean,json:{write:!0}})],j4.prototype,"showLegend",void 0),j4=OY=u([M("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],j4);const rIe=j4,VV=new Sr({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let Kd=class extends pe{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(K.getLogger(this).error(".field: field must be a string value"),null):lM(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};u([p()],Kd.prototype,"index",void 0),u([p({type:VV.apiValues,readOnly:!0,json:{read:VV.read,write:VV.write}})],Kd.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],Kd.prototype,"field",void 0),u([ai("field")],Kd.prototype,"castField",null),u([p({type:String,json:{write:!0}})],Kd.prototype,"valueExpression",void 0),u([p({type:String,json:{write:!0}})],Kd.prototype,"valueExpressionTitle",void 0),u([p({readOnly:!0})],Kd.prototype,"arcadeRequired",null),u([p({type:rIe,json:{write:!0}})],Kd.prototype,"legendOptions",void 0),Kd=u([M("esri.renderers.visualVariables.VisualVariable")],Kd);const b$=Kd;var RY;let Zb=RY=class extends pe{constructor(t){super(t),this.color=null,this.label=null,this.value=null}writeValue(t,e,i){e[i]=t??0}clone(){return new RY({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};u([p({type:Pe,json:{type:[dr],write:!0}})],Zb.prototype,"color",void 0),u([p({type:String,json:{write:!0}})],Zb.prototype,"label",void 0),u([p({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],Zb.prototype,"value",void 0),u([Be("value")],Zb.prototype,"writeValue",null),Zb=RY=u([M("esri.renderers.visualVariables.support.ColorStop")],Zb);const cAt=Zb;var PY;let Jb=PY=class extends b${constructor(t){super(t),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value),this._set("stops",t)}clone(){return new PY({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions?.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([p({readOnly:!0})],Jb.prototype,"cache",null),u([p({type:["color"],json:{type:["colorInfo"]}})],Jb.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],Jb.prototype,"normalizationField",void 0),u([p({type:[cAt],json:{write:!0}})],Jb.prototype,"stops",null),Jb=PY=u([M("esri.renderers.visualVariables.ColorVariable")],Jb);const nIe=Jb;var MY;let b_=MY=class extends pe{constructor(t){super(t),this.label=null,this.opacity=null,this.value=null}readOpacity(t,e){return RE(e.transparency)}writeOpacity(t,e,i){e[i]=S6(t)}clone(){return new MY({label:this.label,opacity:this.opacity,value:this.value})}};u([p({type:String,json:{write:!0}})],b_.prototype,"label",void 0),u([p({type:Number,json:{type:dr,write:{target:"transparency"}}})],b_.prototype,"opacity",void 0),u([wt("opacity",["transparency"])],b_.prototype,"readOpacity",null),u([Be("opacity")],b_.prototype,"writeOpacity",null),u([p({type:Number,json:{write:!0}})],b_.prototype,"value",void 0),b_=MY=u([M("esri.renderers.visualVariables.support.OpacityStop")],b_);const uAt=b_;var $Y;let Kb=$Y=class extends b${constructor(t){super(t),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value),this._set("stops",t)}clone(){return new $Y({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions?.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([p({readOnly:!0})],Kb.prototype,"cache",null),u([p({type:["opacity"],json:{type:["transparencyInfo"]}})],Kb.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],Kb.prototype,"normalizationField",void 0),u([p({type:[uAt],json:{write:!0}})],Kb.prototype,"stops",null),Kb=$Y=u([M("esri.renderers.visualVariables.OpacityVariable")],Kb);const sIe=Kb;var IY;let Dg=IY=class extends b${constructor(t){super(t),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(t,e,i,r){if(r?.messages){const n=`visualVariables[${this.index}]`;r.messages.push(new G("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpressionTitle",context:r}))}}clone(){return new IY({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions?.clone()})}};u([p({readOnly:!0})],Dg.prototype,"cache",null),u([p({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],Dg.prototype,"axis",void 0),u([p({type:["rotation"],json:{type:["rotationInfo"]}})],Dg.prototype,"type",void 0),u([p({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],Dg.prototype,"rotationType",void 0),u([p({type:String,json:{write:!0}})],Dg.prototype,"valueExpressionTitle",void 0),u([Be("web-scene","valueExpressionTitle")],Dg.prototype,"writeValueExpressionTitleWebScene",null),Dg=IY=u([M("esri.renderers.visualVariables.RotationVariable")],Dg);const oIe=Dg;var LY;let p2=LY=class extends pe{constructor(t){super(t),this.label=null,this.size=null,this.value=null}clone(){return new LY({label:this.label,size:this.size,value:this.value})}};u([p({type:String,json:{write:!0}})],p2.prototype,"label",void 0),u([p({type:Number,cast:sr,json:{write:!0}})],p2.prototype,"size",void 0),u([p({type:Number,json:{write:!0}})],p2.prototype,"value",void 0),p2=LY=u([M("esri.renderers.visualVariables.support.SizeStop")],p2);const f2=p2;var DY;let H4=DY=class extends rIe{constructor(){super(...arguments),this.customValues=null}clone(){return new DY({title:this.title,showLegend:this.showLegend,customValues:this.customValues?.slice(0)})}};u([p({type:[Number],json:{write:!0}})],H4.prototype,"customValues",void 0),H4=DY=u([M("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],H4);const hAt=H4;var NY;const PD=new Sr({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),FY=new Sr({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function Dfe(t){if(t!=null)return typeof t=="string"||typeof t=="number"?sr(t):t.type==="size"?tv(t)?t:(delete(t={...t}).type,new yr(t)):void 0}function Nfe(t,e,i){if(typeof t!="object")return t;const r=new yr;return r.read(t,i),r}let yr=NY=class extends b${constructor(t){super(t),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:this.valueExpression!=null&&QCe.test(this.valueExpression)}}set expression(t){K.getLogger(this).warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),t==="view.scale"?(this.valueExpression="$view.scale",this._set("expression",t)):this._set("expression",null)}set index(t){tv(this.maxSize)&&(this.maxSize.index=`visualVariables[${t}].maxSize`),tv(this.minSize)&&(this.minSize.index=`visualVariables[${t}].minSize`),this._set("index",t)}get inputValueType(){return KCe(this)}set maxDataValue(t){t&&this.stops&&(K.getLogger(this).warn("cannot set maxDataValue when stops is not null."),t=null),this._set("maxDataValue",t)}set maxSize(t){t&&this.stops&&(K.getLogger(this).warn("cannot set maxSize when stops is not null."),t=null),this._set("maxSize",t)}castMaxSize(t){return Dfe(t)}readMaxSize(t,e,i){return Nfe(t,e,i)}set minDataValue(t){t&&this.stops&&(K.getLogger(this).warn("cannot set minDataValue when stops is not null."),t=null),this._set("minDataValue",t)}set minSize(t){t&&this.stops&&(K.getLogger(this).warn("cannot set minSize when stops is not null."),t=null),this._set("minSize",t)}castMinSize(t){return Dfe(t)}readMinSize(t,e,i){return Nfe(t,e,i)}get arcadeRequired(){return!!this.valueExpression||this.minSize!=null&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize!=null&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(t){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value):t&&(K.getLogger(this).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),t=null),this._set("stops",t)}get transformationType(){return Wst(this,this.inputValueType)}readValueExpression(t,e){return t||e.expression&&"$view.scale"}writeValueExpressionWebScene(t,e,i,r){if(t==="$view.scale"){if(r?.messages){const n=this.index,s=typeof n=="string"?n:`visualVariables[${n}]`;r.messages.push(new G("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpression",context:r}))}}else e[i]=t}readValueUnit(t){return t?FY.read(t):null}clone(){return new NY({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:tv(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:tv(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops?.map(t=>t.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions?.clone()})}flipSizes(){if(this.transformationType===Fo.ClampedLinear){const{minSize:t,maxSize:e}=this;return this.minSize=e,this.maxSize=t,this}if(this.transformationType===Fo.Stops){const t=this.stops;if(!t)return this;const e=t.map(r=>r.size).reverse(),i=t.length;for(let r=0;r<i;r++)t[r].size=e[r];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops?.map(t=>t.value||0)}};u([p({readOnly:!0})],yr.prototype,"cache",null),u([p({type:PD.apiValues,json:{type:PD.jsonValues,origins:{"web-map":{read:!1}},read:PD.read,write:PD.write}})],yr.prototype,"axis",void 0),u([p({type:String,value:null,json:{read:!1}})],yr.prototype,"expression",null),u([p()],yr.prototype,"index",null),u([p({type:String,readOnly:!0})],yr.prototype,"inputValueType",null),u([p({type:hAt,json:{write:!0}})],yr.prototype,"legendOptions",void 0),u([p({type:Number,value:null,json:{write:!0}})],yr.prototype,"maxDataValue",null),u([p({type:Number,value:null,json:{write:!0}})],yr.prototype,"maxSize",null),u([ai("maxSize")],yr.prototype,"castMaxSize",null),u([wt("maxSize")],yr.prototype,"readMaxSize",null),u([p({type:Number,value:null,json:{write:!0}})],yr.prototype,"minDataValue",null),u([p({type:Number,value:null,json:{write:!0}})],yr.prototype,"minSize",null),u([ai("minSize")],yr.prototype,"castMinSize",null),u([wt("minSize")],yr.prototype,"readMinSize",null),u([p({type:String,json:{write:!0}})],yr.prototype,"normalizationField",void 0),u([p({readOnly:!0})],yr.prototype,"arcadeRequired",null),u([p({type:String})],yr.prototype,"scaleBy",void 0),u([p({type:[f2],value:null,json:{write:!0}})],yr.prototype,"stops",null),u([p({type:["outline"],json:{write:!0}})],yr.prototype,"target",void 0),u([p({type:String,readOnly:!0})],yr.prototype,"transformationType",null),u([p({type:["size"],json:{type:["sizeInfo"]}})],yr.prototype,"type",void 0),u([p({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],yr.prototype,"useSymbolValue",void 0),u([p({type:String,json:{write:!0}})],yr.prototype,"valueExpression",void 0),u([wt("valueExpression",["valueExpression","expression"])],yr.prototype,"readValueExpression",null),u([Be("web-scene","valueExpression")],yr.prototype,"writeValueExpressionWebScene",null),u([p({type:["radius","diameter","area","width","distance"],json:{write:!0}})],yr.prototype,"valueRepresentation",void 0),u([p({type:FY.apiValues,json:{write:FY.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],yr.prototype,"valueUnit",void 0),u([wt("valueUnit")],yr.prototype,"readValueUnit",null),yr=NY=u([M("esri.renderers.visualVariables.SizeVariable")],yr);const C8=yr,dAt={color:nIe,size:C8,opacity:sIe,rotation:oIe},pAt=new Sr({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),fAt=/^\[([^\]]+)\]$/i;let q4=class extends we{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),e=e&&e.filter(i=>!!i),e?.length){for(const i of e)switch(i.type){case"color":this.colorVariables.push(i);break;case"opacity":this.opacityVariables.push(i);break;case"rotation":this.rotationVariables.push(i);break;case"size":this.sizeVariables.push(i)}this.sizeVariables.length&&this.sizeVariables.some(i=>!!i.target)&&e.sort((i,r)=>{let n=null;return n=i.target===r.target?0:i.target?1:-1,n});for(let i=0;i<e.length;i++)e[i].index=i;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,i,r){const{rotationExpression:n,rotationType:s}=i,o=n?.match(fAt),a=o?.[1];if(a&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:s,field:a})),e)return e.map(l=>{const c=pAt.read(l.type),h=dAt[c];h||(K.getLogger(this).warn(`Unknown variable type: ${c}`),r?.messages&&r.messages.push(new Sm("visual-variable:unsupported",`visualVariable of type '${c}' is not supported`,{definition:l,context:r})));const d=new h;return d.read(l,r),d})}writeVariables(e,i){const r=[];for(const n of e){const s=n.toJSON(i);s&&r.push(s)}return r}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};u([p()],q4.prototype,"visualVariables",null),q4=u([M("esri.renderers.visualVariables.VisualVariableFactory")],q4);const mAt=q4,gAt={base:b$,key:"type",typeMap:{opacity:sIe,color:nIe,rotation:oIe,size:C8}},HC=t=>{let e=class extends t{constructor(){super(...arguments),this._vvFactory=new mAt}set visualVariables(i){this._vvFactory.visualVariables=i,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(i,r,n){return this._vvFactory.readVariables(i,r,n)}writeVisualVariables(i,r,n,s){r[n]=this._vvFactory.writeVariables(i,s)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const i of this.visualVariables)if(i.arcadeRequired)return!0;return!1}hasVisualVariables(i,r){return i?this.getVisualVariablesForType(i,r).length>0:this.getVisualVariablesForType("size",r).length>0||this.getVisualVariablesForType("color",r).length>0||this.getVisualVariablesForType("opacity",r).length>0||this.getVisualVariablesForType("rotation",r).length>0}getVisualVariablesForType(i,r){const n=this.visualVariables;return n?n.filter(s=>s.type===i&&(typeof r=="string"?s.target===r:r!==!1||!s.target)):[]}async collectVVRequiredFields(i,r){let n=[];this.visualVariables&&(n=n.concat(this.visualVariables));for(const s of n)s&&(s.field&&Hu(i,r,s.field),s.normalizationField&&Hu(i,r,s.normalizationField),s.valueExpression&&(yAt(s.valueExpression,i,r)||await Ql(i,r,s.valueExpression)))}};return u([p({types:[gAt],value:null,json:{write:!0}})],e.prototype,"visualVariables",null),u([wt("visualVariables",["visualVariables","rotationType","rotationExpression"])],e.prototype,"readVisualVariables",null),u([Be("visualVariables")],e.prototype,"writeVisualVariables",null),e=u([M("esri.renderers.mixins.VisualVariablesMixin")],e),e};function yAt(t,e,i){const r=aAt(t);return r!=null&&(Hu(e,i,r),!0)}const A8={types:W1e,json:{write:{writer:ak},origins:{"web-scene":{types:dne,write:{writer:ak},read:{reader:bC({types:dne})}}}}},Cte=$X({json:{origins:{"web-scene":{write:{isRequired:!0}}}}},A8),aIe={types:{base:Jc,key:"type",typeMap:{"simple-fill":X2.typeMap["simple-fill"],"picture-fill":X2.typeMap["picture-fill"],"polygon-3d":X2.typeMap["polygon-3d"]}},json:{write:{writer:ak},origins:{"web-scene":{type:MM,write:{writer:ak}}}}},W4={cast:t=>t==null||typeof t=="string"||typeof t=="number"?t:`${t}`,json:{type:String,write:{writer:(t,e)=>{e.value=t?.toString()}}}};var kY;let w_=kY=class extends pe{constructor(t){super(t),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new kY({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const t=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${t}`}};u([p({type:String,json:{write:!0}})],w_.prototype,"description",void 0),u([p({type:String,json:{write:!0}})],w_.prototype,"label",void 0),u([p({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],w_.prototype,"minValue",void 0),u([p({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],w_.prototype,"maxValue",void 0),u([p(Cte)],w_.prototype,"symbol",void 0),w_=kY=u([M("esri.renderers.support.ClassBreakInfo")],w_);const Yk=w_;var UY;const lIe="log",Y4="percent-of-total",X4="field",MD=new Sr({esriNormalizeByLog:lIe,esriNormalizeByPercentOfTotal:Y4,esriNormalizeByField:X4}),_At=as(Yk);let so=UY=class extends HC(i0){constructor(t){super(t),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(t,e,i){if(!Array.isArray(t))return;let r=e.minValue;return t.map(n=>{const s=new Yk;return s.read(n,i),s.minValue==null&&(s.minValue=r),s.maxValue==null&&(s.maxValue=s.minValue),r=s.maxValue,s})}writeClassBreakInfos(t,e,i,r){const n=t.map(s=>s.write({},r));this._areClassBreaksConsecutive()&&n.forEach(s=>delete s.classMinValue),e[i]=n}castField(t){return t==null?t:typeof t=="function"?(K.getLogger(this).error(".field: field must be a string value"),null):lM(t)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let t=this._get("normalizationType");const e=!!this.normalizationField,i=this.normalizationTotal!=null;return e||i?(t=e&&X4||i&&Y4||null,e&&i&&K.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):t!==X4&&t!==Y4||(t=null),t}set normalizationType(t){this._set("normalizationType",t)}addClassBreakInfo(t,e,i){let r=null;r=typeof t=="number"?new Yk({minValue:t,maxValue:e,symbol:Y1e(i)}):_At(Q(t)),this.classBreakInfos.push(r),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(t,e){const i=this.classBreakInfos.length;for(let r=0;r<i;r++){const n=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(n[0]===t&&n[1]===e){this.classBreakInfos.splice(r,1);break}}}getBreakIndex(t,e){return this.valueExpression&&e?.arcade==null&&K.getLogger(this).warn(""),this.valueExpression?this._getBreakIndexForExpression(t,e):this._getBreakIndexForField(t)}async getClassBreakInfo(t,e){let i=e;this.valueExpression&&e?.arcade==null&&(i={...i,arcade:await Pv()});const r=this.getBreakIndex(t,i);return r!==-1?this.classBreakInfos[r]:null}getSymbol(t,e){if(this.valueExpression&&e?.arcade==null)return void K.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this.getBreakIndex(t,e);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}async getSymbolAsync(t,e){let i=e;if(this.valueExpression&&e?.arcade==null){const n=await Pv(),{arcadeUtils:s}=n;s.hasGeometryOperations(this.valueExpression)&&await s.enableGeometryOperations(),i={...i,arcade:n}}const r=this.getBreakIndex(t,i);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}getSymbols(){const t=[];return this.classBreakInfos.forEach(e=>{e.symbol&&t.push(e.symbol)}),this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),i=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${t}.${e}.${this.classBreakInfos.reduce((r,n)=>r+n.getMeshHash(),"")}.${i}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new UY({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol?.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol?.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:Q(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:Q(this.visualVariables),legendOptions:Q(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(t,e){const i=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(i)}async collectSymbolFields(t,e){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(t,e)),Ql(t,e,this.valueExpression)];Hu(t,e,this.field),Hu(t,e,this.normalizationField),await Promise.all(i)}_getBreakIndexForExpression(t,e){const{viewingMode:i,scale:r,spatialReference:n,arcade:s,timeZone:o}=e??{},{valueExpression:a}=this;let l=this._compiledValueExpression.valueExpression===a?this._compiledValueExpression.compiledFunction:null;const c=s.arcadeUtils;if(!l){const d=c.createSyntaxTree(a);l=c.createFunction(d),this._compiledValueExpression.compiledFunction=l}this._compiledValueExpression.valueExpression=a;const h=c.executeFunction(l,c.createExecContext(t,c.getViewInfo({viewingMode:i,scale:r,spatialReference:n}),o));return this._getBreakIndexfromInfos(h)}_getBreakIndexForField(t){const e=this.field,i=t.attributes,r=this.normalizationType;let n=parseFloat(i[e]);if(r){const s=this.normalizationTotal,o=parseFloat(this.normalizationField?i[this.normalizationField]:void 0);if(r===lIe)n=Math.log(n)*Math.LOG10E;else if(r!==Y4||s==null||isNaN(s)){if(r===X4&&!isNaN(o)){if(isNaN(n)||isNaN(o))return-1;n/=o}}else n=n/s*100}return this._getBreakIndexfromInfos(n)}_getBreakIndexfromInfos(t){const e=this.isMaxInclusive;if(t!=null&&typeof t=="number"&&!isNaN(t))for(let i=0;i<this.classBreakInfos.length;i++){const r=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(r[0]<=t&&(e?t<=r[1]:t<r[1]))return i}return-1}_areClassBreaksConsecutive(){const t=this.classBreakInfos,e=t.length;for(let i=1;i<e;i++)if(t[i-1].maxValue!==t[i].minValue)return!1;return!0}};u([p(aIe)],so.prototype,"backgroundFillSymbol",void 0),u([p({type:[Yk]})],so.prototype,"classBreakInfos",void 0),u([wt("classBreakInfos")],so.prototype,"readClassBreakInfos",null),u([Be("classBreakInfos")],so.prototype,"writeClassBreakInfos",null),u([p({type:String,json:{write:!0}})],so.prototype,"defaultLabel",void 0),u([p(A8)],so.prototype,"defaultSymbol",void 0),u([p({type:String,json:{write:!0}})],so.prototype,"field",void 0),u([ai("field")],so.prototype,"castField",null),u([p({type:Boolean})],so.prototype,"isMaxInclusive",void 0),u([p({type:vE,json:{write:!0}})],so.prototype,"legendOptions",void 0),u([p({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],so.prototype,"minValue",null),u([p({type:String,json:{write:!0}})],so.prototype,"normalizationField",void 0),u([p({type:Number,cast:t=>Nh(t),json:{write:!0}})],so.prototype,"normalizationTotal",void 0),u([p({type:MD.apiValues,value:null,json:{type:MD.jsonValues,read:MD.read,write:MD.write}})],so.prototype,"normalizationType",null),u([nt({classBreaks:"class-breaks"})],so.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],so.prototype,"valueExpression",void 0),u([p({type:String,json:{write:!0}})],so.prototype,"valueExpressionTitle",void 0),so=UY=u([M("esri.renderers.ClassBreaksRenderer")],so);const cIe=so;function vAt(t){return"timeZone"in t}function bAt(t){return"timeZone"in t}function wAt(t){return"dateFieldsTimeZone"in t}let uIe=class Z4{static fromJSON(e){return new Z4(e.fields,e.timeZoneByFieldName)}static fromLayer(e){return new Z4(e.fields??[],kfe(e))}static fromLayerJSON(e){return new Z4(e.fields??[],kfe(e))}constructor(e=[],i){this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=e||[],this._timeZoneByFieldName=i?new Map(i):null;const r=[];for(const n of this.fields){const s=n?.name,o=Ffe(s);if(s&&o){const a=ww(s);this._fieldsMap.set(s,n),this._fieldsMap.set(a,n),this._normalizedFieldsMap.set(o,n),r.push(`${a}:${n.type}:${this._timeZoneByFieldName?.get(s)}`),t1e(n)?(this.dateFields.push(n),this._dateFieldsSet.add(n)):uJ(n)&&(this._numericFieldsSet.add(n),this.numericFields.push(n)),sne(n)||one(n)||(n.editable=n.editable==null||!!n.editable,n.nullable=n.nullable==null||!!n.nullable)}}r.sort(),this.uid=r.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)sne(e)||one(e)||e.nullable||q9e(e)!==void 0||this._requiredFields.push(e)}return this._requiredFields}equals(e){return this.uid===e?.uid}has(e){return this.get(e)!=null}get(e){if(!e)return;let i=this._fieldsMap.get(e);return i||(i=this._fieldsMap.get(ww(e))??this._normalizedFieldsMap.get(Ffe(e)),i&&this._fieldsMap.set(e,i),i)}getTimeZone(e){const i=this.get(e&&typeof e!="string"?e.name:e);return i?this._timeZoneByFieldName?this._timeZoneByFieldName.get(i.name):i.type==="date"||i.type==="esriFieldTypeDate"?(K.getLogger("esri.layers.support.FieldsIndex").error(new G("getTimeZone:no-timezone-information",`no time zone information for field '${i.name}'`)),yx):hIe.has(i.type)?VE:null:null}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isTimeOnlyField(e){return sBe(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){return this.get(e)?.name??void 0}toJSON(){return{fields:this.fields.map(e=>v5(e)?e.toJSON():e),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}};function ww(t){return t.trim().toLowerCase()}function Ffe(t){return P9e(t)?.toLowerCase()??""}const hIe=new Set(["time-only","date-only","timestamp-offset","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function kfe(t){const e=new Map;if(!t.fields)return e;const i=t.datesInUnknownTimezone===!0,{timeInfo:r,editFieldsInfo:n}=t,s=(r?"startField"in r?r.startField:r.startTimeField:"")??"",o=(r?"endField"in r?r.endField:r.endTimeField:"")??"",a=wAt(t)?t.dateFieldsTimeZone??null:t.dateFieldsTimeReference?pN(t.dateFieldsTimeReference):null,l=n?vAt(n)?n.timeZone??a:n.dateFieldsTimeReference?pN(n.dateFieldsTimeReference):a??yx:null,c=r?bAt(r)?r.timeZone??a:r.timeReference?pN(r.timeReference):a:null,h=new Map([[ww(n?.creationDateField??""),l],[ww(n?.editDateField??""),l],[ww(s),c],[ww(o),c]]);for(const{name:d,type:f}of t.fields)if(hIe.has(f))e.set(d,VE);else if(f!=="date"&&f!=="esriFieldTypeDate")e.set(d,null);else if(i)e.set(d,VE);else{const m=h.get(ww(d??""))??a;e.set(d,m)}return e}const Ufe="esri.renderers.support.DictionaryLoader",xAt={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};let Ate=class{constructor(e,i,r){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new s3e(100),this._dictionaryVersion=null,this._fieldIndex=null,this._dictionaryPromise=null,this.url=e,this.config=i,this.fieldMap=r}getSymbolFields(){return this._symbolFields}async getSymbolAsync(e,i){let r;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(i));try{r=await this._dictionaryPromise}catch(y){if(Tn(y))return this._dictionaryPromise=null,null}const n=this._dictionaryVersion&&this._dictionaryVersion.since(4,0),s={};if(this.fieldMap)for(const y of this._symbolFields){const _=this._getFieldName(this.fieldMap[y]);if(_){const v=e.attributes[_];s[y]=n?v:v!=null?""+e.attributes[_]:""}else s[y]=""}let o=null;try{o=r?.(s,i)}catch{return null}if(!o||typeof o!="string")return null;const a=IX(o).toString(),l=this._symbolCache.get(a);if(l)return l.catch(()=>{this._symbolCache.pop(a)}),l;const c=o.split(";"),h=[],d=[];for(const y of c)if(y)if(y.includes("po:")){const _=y.substr(3).split("|");if(_.length===3){const v=_[0],w=_[1];let x=_[2];if(w==="DashTemplate")x=x.split(" ").map(T=>Number(T));else if(w==="Color"){const T=new Pe(x).toRgba();x=[T[0],T[1],T[2],255*T[3]]}else x=Number(x);d.push({primitiveName:v,propertyName:w,value:x})}}else if(y.includes("|")){for(const _ of y.split("|"))if(this._itemNames.has(_)){h.push(_);break}}else this._itemNames.has(y)&&h.push(y);const f=e.geometry==null||!e.geometry.hasZ&&e.geometry.type==="point",m=this._cimPartsToCIMSymbol(h,d,f,i);return this._symbolCache.put(a,m,1),m}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void K.getLogger(Ufe).error("no valid URL!");const i=_i(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:e!=null?e.signal:null}),[{data:r}]=await Promise.all([i,Pv()]);if(!r)throw this._dictionaryPromise=null,new G("esri.renderers.DictionaryRenderer","Bad dictionary data!");const{authoringInfo:n,dictionary_version:s,expression:o,itemsNames:a}=r,l=o;let c=!1;s&&(this._dictionaryVersion=Ov.parse(s),c=this._dictionaryVersion.since(4,0)),this._refSymbolUrlTemplate=this.url+"/"+r.cimRefTemplateUrl,this._itemNames=new Set(a),this._symbolFields=n.symbol;const h={};if(this.config){const m=this.config;for(const y in m)h[y]=m[y]}if(n.configuration)for(const m of n.configuration)h.hasOwnProperty(m.name)||(h[m.name]=m.value);const d=[];if(e?.fields&&this.fieldMap)for(const m of this._symbolFields){const y=this.fieldMap[m],_=e.fields.filter(v=>v.name.toLowerCase()===y?.toLowerCase());_.length>0&&d.push({..._[0],type:c?_[0].type:"esriFieldTypeString"})}d.length>0&&(this._fieldIndex=new uIe(d));const f=A9e(l,e!=null?e.spatialReference:null,d,h).then(m=>{const y={scale:0};return(_,v)=>{if(m==null)return null;const w=m.repurposeFeature({geometry:null,attributes:_});return y.scale=v!=null?v.scale??void 0:void 0,m.evaluate({$feature:w,$view:y},m.services)}}).catch(m=>(K.getLogger(Ufe).error("Creating dictinoary expression failed:",m),null));return this._dictionaryPromise=f,f}async _cimPartsToCIMSymbol(e,i,r,n){const s=new Array(e.length);for(let l=0;l<e.length;l++)s[l]=this._getSymbolPart(e[l],n);const o=await Promise.all(s),a=this.fieldMap;if(a)for(const l of o)dIe(l,a);return new OC({data:this._combineSymbolParts(o,i,r)})}async _getSymbolPart(e,i){if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then(s=>s.data);const r=this._refSymbolUrlTemplate.replaceAll(/\{itemName\}/gi,e),n=_i(r,{responseType:"json",query:{f:"json"},...i});this._ongoingRequests.set(e,n);try{return(await n).data}catch(s){throw this._ongoingRequests.delete(e),s}}_combineSymbolParts(e,i,r){if(!e||e.length===0)return null;const n={...e[0]};if(e.length>1){n.symbolLayers=[];for(const s of e){const o=s;n.symbolLayers.unshift(...o.symbolLayers)}}return r&&(n.callout=xAt),{type:"CIMSymbolReference",symbol:n,primitiveOverrides:i}}_getFieldName(e){if(this._fieldIndex!==null){const i=this._fieldIndex.get(e);return i?i.name:e}return e}};function dIe(t,e){if(!t)return;const i=t.symbolLayers;if(!i)return;let r=i.length;for(;r--;){const n=i[r];n&&n.enable!==!1&&n.type==="CIMVectorMarker"&&TAt(n,e)}}function TAt(t,e){const i=t.markerGraphics;if(i)for(const r of i){if(!r)continue;const n=r.symbol;if(n)switch(n.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":dIe(n,e);break;case"CIMTextSymbol":n.fieldMap=e}}}const KGt=Object.freeze(Object.defineProperty({__proto__:null,DictionaryLoader:Ate},Symbol.toStringTag,{value:"Module"}));var zY;let Qd=zY=class extends HC(i0){constructor(t){super(t),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new Ate(this.url,this.config,this.fieldMap)}writeData(t,e){t&&(e.scalingExpressionInfo={expression:t,returnType:"number"})}writeVisualVariables(t,e,i,r){r?.origin||super.writeVisualVariables(t,e,i,r)}clone(){return new zY({config:Q(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:Q(this.fieldMap),url:Q(this.url),visualVariables:Q(this.visualVariables)})}async getSymbolAsync(t,e){return this._loader.getSymbolAsync(t,e)}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e),this.scaleExpression&&await Ql(t,e,this.scaleExpression);for(const i in this.fieldMap){const r=this.fieldMap[i];e.has(r)&&t.add(r)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};u([p({type:Ate})],Qd.prototype,"_loader",null),u([p({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],Qd.prototype,"config",void 0),u([p({type:Object,json:{write:!0}})],Qd.prototype,"fieldMap",void 0),u([p({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],Qd.prototype,"scaleExpression",void 0),u([Be("scaleExpression")],Qd.prototype,"writeData",null),u([p({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(t){return{enabled:!!t&&!!this.scaleExpression}}}}})],Qd.prototype,"scaleExpressionTitle",void 0),u([p({type:String,json:{write:!0}})],Qd.prototype,"url",void 0),u([Be("visualVariables")],Qd.prototype,"writeVisualVariables",null),Qd=zY=u([M("esri.renderers.DictionaryRenderer")],Qd);const SAt=Qd;var BY;let Ng=BY=class extends pe{constructor(t){super(t),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(t){return t==null?t:typeof t=="function"?(K.getLogger(this).error(".field: field must be a string value"),null):lM(t)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new BY({color:this.color?.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([p({type:Pe,json:{type:[Number],write:!0}})],Ng.prototype,"color",void 0),u([p({type:String,json:{write:!0}})],Ng.prototype,"field",void 0),u([ai("field")],Ng.prototype,"castField",null),u([p({type:String,json:{write:!0}})],Ng.prototype,"label",void 0),u([p({type:String,json:{write:!0}})],Ng.prototype,"valueExpression",void 0),u([p({type:String,json:{write:!0}})],Ng.prototype,"valueExpressionTitle",void 0),Ng=BY=u([M("esri.renderers.support.AttributeColorInfo")],Ng);const pIe=Ng;var VY;let J4=VY=class extends pe{constructor(){super(...arguments),this.unit=null}clone(){return new VY({unit:this.unit})}};u([p({type:String,json:{write:!0}})],J4.prototype,"unit",void 0),J4=VY=u([M("esri.renderers.support.DotDensityLegendOptions")],J4);const EAt=J4;var GY;let vc=GY=class extends HC(i0){constructor(t){super(t),this.attributes=null,this.backgroundColor=new Pe([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new ud,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(t){if(this.referenceScale==null)return this.dotValue;const e=t/this.referenceScale*this.dotValue;return e<1?1:e}getSymbol(){return new jx({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes?.reduce((t,e)=>t+e.getAttributeHash(),"")??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new GY({attributes:Q(this.attributes),backgroundColor:Q(this.backgroundColor),dotBlendingEnabled:Q(this.dotBlendingEnabled),dotShape:Q(this.dotShape),dotSize:Q(this.dotSize),dotValue:Q(this.dotValue),legendOptions:Q(this.legendOptions),outline:Q(this.outline),referenceScale:Q(this.referenceScale),visualVariables:Q(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){return`${this.attributes?.map(e=>e.field||e.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e);for(const i of this.attributes??[])i.valueExpression&&await Ql(t,e,i.valueExpression),i.field&&t.add(i.field)}};u([p({type:[pIe],json:{write:!0}})],vc.prototype,"attributes",void 0),u([p({type:Pe,json:{write:!0}})],vc.prototype,"backgroundColor",void 0),u([p({type:Boolean,json:{write:!0}})],vc.prototype,"dotBlendingEnabled",void 0),u([p({type:String,json:{write:!1}})],vc.prototype,"dotShape",void 0),u([p({type:Number,json:{write:!0}})],vc.prototype,"dotSize",void 0),u([p({type:EAt,json:{write:!0}})],vc.prototype,"legendOptions",void 0),u([p({type:ud,json:{default:null,write:!0}})],vc.prototype,"outline",void 0),u([p({type:Number,json:{write:!0}})],vc.prototype,"dotValue",void 0),u([p({type:Number,json:{write:!0}})],vc.prototype,"referenceScale",void 0),u([p({type:Number,json:{write:!0}})],vc.prototype,"seed",void 0),u([nt({dotDensity:"dot-density"})],vc.prototype,"type",void 0),vc=GY=u([M("esri.renderers.DotDensityRenderer")],vc);const CAt=vc;var jY;let $O=jY=class extends pe{constructor(t){super(t),this.color=null,this.ratio=null}clone(){return new jY({color:this.color,ratio:this.ratio})}};u([p({type:Pe,json:{type:[dr],default:null,write:!0}})],$O.prototype,"color",void 0),u([p({type:Number,json:{write:!0}})],$O.prototype,"ratio",void 0),$O=jY=u([M("esri.renderers.support.HeatmapColorStop")],$O);const K4=$O;let m2=class extends es(pe){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};u([p({type:String,json:{write:!0}})],m2.prototype,"minLabel",void 0),u([p({type:String,json:{write:!0}})],m2.prototype,"maxLabel",void 0),u([p({type:String,json:{write:!0}})],m2.prototype,"title",void 0),m2=u([M("esri.renderers.support.HeatmapLegendOptions")],m2);const Ote=2.4;function AAt(t){return Ku(t*Ote)}function OAt(t){return Jn(t)/Ote}function RAt(t,e,i,r){let{color:n,ratio:s}=e,{color:o,ratio:a}=i;a===s&&(a===1?s-=1e-6:a+=1e-6);const l=_e((r-s)/(a-s),0,1);T6(t,n.toArray(),o.toArray(),l)}function ejt(t){const i=new Uint8ClampedArray(2048);if(t=t.filter(({ratio:a})=>a>=0&&a<=1).sort((a,l)=>a.ratio-l.ratio).map(({color:a,ratio:l})=>({color:a,ratio:Math.max(l,.001)})),t.length<1)return i;let r=t[0],n=t[0],s=1;const o=oi();for(let a=0;a<512;a++){const l=(a+.5)/512;for(;l>n.ratio&&s<t.length;)r=n,n=t[s++];RAt(o,r,n,l),i.set(o,4*a)}return i}function tjt(t,e,i,r){const{radius:n,fieldOffset:s,field:o}=e,a=Math.round(Jn(n)),l=new Float64Array(i*r);let c,h=Number.NEGATIVE_INFINITY;const d=MAt(o,s),f=new Set;for(const m of t){const y=m.getCursor();for(;y.next();){const _=y.getObjectId();if(f.has(_))continue;f.add(_);const v=y.readLegacyPointGeometry(),w=128;if(v.x<-w||v.x>=i+w||v.y<-w||v.y>r+w)continue;const x=+d(y),T=Math.max(0,Math.round(v.x)-a),S=Math.max(0,Math.round(v.y)-a),C=Math.min(r,Math.round(v.y)+a),A=Math.min(i,Math.round(v.x)+a);for(let R=S;R<C;R++)for(let D=T;D<A;D++){const N=R*i+D,k=PAt(v.x-D,v.y-R,a);c=l[N]+=k*x,c>h&&(h=c)}}}return{matrix:l.buffer,max:h}}function PAt(t,e,i){const r=Math.sqrt(t**2+e**2)/i;return r>1?0:3/(Math.PI*i**2)*(1-r**2)**2}function ijt(t,e){return typeof t=="function"?t:t?typeof e=="string"?i=>-1*+i[t]:i=>+i[t]+e:()=>1}function MAt(t,e){return t!=null?typeof e=="string"?i=>-1*+i.readAttribute(t):i=>+i.readAttribute(t)+e:i=>1}var HY;const fIe="esri.renderers.HeatmapRenderer",$At=K.getLogger(fIe);function zfe(t){if(t!=null){const{maxDensity:e,minDensity:i,radius:r}=t;if(e!=null||i!=null||r!=null){const{blurRadius:n,maxPixelIntensity:s,minPixelIntensity:o,...a}=t;return a}}return t}let Io=HY=class extends i0{constructor(t){super(t),this.authoringInfo=null,this.colorStops=[new K4({ratio:0,color:new Pe("rgba(255, 140, 0, 0)")}),new K4({ratio:.75,color:new Pe("rgba(255, 140, 0, 1)")}),new K4({ratio:.9,color:new Pe("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(t){return zfe(t)}get blurRadius(){return OAt(this.radius)}set blurRadius(t){const e=this.maxPixelIntensity,i=this.minPixelIntensity;this._set("radius",AAt(t)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",e*this._pixelIntensityToDensity),this._set("minDensity",i*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(t){this._set("maxDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(t){this._set("minDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(Ote**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(t,e){this._warnedProps[t]||Jl(this).getDefaultOrigin()==="user"&&(this._warnedProps[t]=!0,Ux(()=>{Kg($At,t,{replacement:`${String(e)} (suggested value: ${this._get(e)})`,version:"4.24"})}))}read(t,e){t=zfe(t),super.read(t,e)}getSymbol(){return new Qv}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(t,e){const i=this.field,r=this.valueExpression;i&&typeof i=="string"&&Hu(t,e,i),r&&typeof r=="string"&&await Ql(t,e,r)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new HY({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:Q(this.colorStops),field:this.field,legendOptions:Q(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([p({type:Ete,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Io.prototype,"authoringInfo",void 0),u([p({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Io.prototype,"blurRadius",null),u([p({type:[K4],json:{write:!0}})],Io.prototype,"colorStops",void 0),u([p({type:String,json:{write:!0}})],Io.prototype,"field",void 0),u([p({type:Number,json:{write:{overridePolicy:(t,e,i)=>({enabled:i==null})},origins:{"web-scene":{write:!1}}}})],Io.prototype,"fieldOffset",void 0),u([p({type:m2,json:{write:!0}})],Io.prototype,"legendOptions",void 0),u([p({type:Number,json:{write:!0}})],Io.prototype,"maxDensity",void 0),u([p({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Io.prototype,"maxPixelIntensity",null),u([p({type:Number,json:{write:!0}})],Io.prototype,"minDensity",void 0),u([p({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Io.prototype,"minPixelIntensity",null),u([p({type:Number,cast:sr,json:{write:!0}})],Io.prototype,"radius",void 0),u([p({type:Number,range:{min:0},json:{default:0,write:!0}})],Io.prototype,"referenceScale",void 0),u([nt({heatmap:"heatmap"})],Io.prototype,"type",void 0),u([p({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],Io.prototype,"valueExpression",void 0),u([p({type:String})],Io.prototype,"valueExpressionTitle",void 0),u([p({readOnly:!0})],Io.prototype,"_pixelIntensityToDensity",null),Io=HY=u([M(fIe)],Io);const mIe=Io;let xw=class extends es(pe){constructor(){super(...arguments),this.color=new Pe([0,0,0,0]),this.label=null,this.threshold=0}};u([p({type:Pe,json:{write:!0}})],xw.prototype,"color",void 0),u([p({type:String,json:{write:!0}})],xw.prototype,"label",void 0),u([p({type:Number,range:{min:0,max:1},json:{write:!0}})],xw.prototype,"threshold",void 0),xw=u([M("esri.renderers.support.OthersCategory")],xw);let Q4=class extends es(pe){constructor(){super(...arguments),this.title=null}};u([p({type:String,json:{write:!0}})],Q4.prototype,"title",void 0),Q4=u([M("esri.renderers.support.PieChartLegendOptions")],Q4);let gu=class extends HC(es(i0)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new Pe([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new xw,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){return new Qv({size:this.size?this.size/2+(this.outline?.width||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(Yv)}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,i)=>e+i.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,i)=>e+JSON.stringify(i),"")}async collectRequiredFields(e,i){await this.collectVVRequiredFields(e,i);for(const r of this.attributes)r.valueExpression&&await Ql(e,i,r.valueExpression),r.field&&e.add(r.field)}};u([p({type:[pIe],json:{write:!0}})],gu.prototype,"attributes",void 0),u([p({type:jx,json:{default:null,write:!0}})],gu.prototype,"backgroundFillSymbol",void 0),u([p({type:Pe,json:{write:!0}})],gu.prototype,"defaultColor",void 0),u([p({type:String,json:{write:!0}})],gu.prototype,"defaultLabel",void 0),u([p({type:Number,range:{min:0,max:1},json:{write:!0}})],gu.prototype,"holePercentage",void 0),u([p({type:xw,json:{write:!0}})],gu.prototype,"othersCategory",void 0),u([p({type:Q4,json:{write:!0}})],gu.prototype,"legendOptions",void 0),u([p({type:ud,json:{default:null,write:!0}})],gu.prototype,"outline",void 0),u([p({type:Number,cast:sr,json:{write:!0}})],gu.prototype,"size",void 0),u([nt({pieChart:"pie-chart"})],gu.prototype,"type",void 0),gu=u([M("esri.renderers.PieChartRenderer")],gu);const IAt=gu;var qY;let Qb=qY=class extends HC(i0){constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(t,e){await Promise.all([this.collectSymbolFields(t,e),this.collectVVRequiredFields(t,e)])}async collectSymbolFields(t,e){await Promise.all(this.getSymbols().map(i=>i.collectRequiredFields(t,e)))}getSymbol(t,e){return this.symbol}async getSymbolAsync(t,e){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((t,e)=>t+JSON.stringify(e),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new qY({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:Q(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};u([p({type:String,json:{write:!0}})],Qb.prototype,"description",void 0),u([p({type:String,json:{write:!0}})],Qb.prototype,"label",void 0),u([p(Cte)],Qb.prototype,"symbol",void 0),u([nt({simple:"simple"})],Qb.prototype,"type",void 0),Qb=qY=u([M("esri.renderers.SimpleRenderer")],Qb);const O8=Qb,LAt=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function WY(t){return t instanceof we}function Bfe(t){return t instanceof Je?Object.keys(t.items):WY(t)?Jl(t).keys():t?Object.keys(t):[]}function $D(t,e){return t instanceof Je?t.items[e]:t[e]}function DAt(t,e){return!(!Array.isArray(t)||!Array.isArray(e))&&t.length!==e.length}function jR(t){return t?t.declaredClass:null}function gIe(t,e){const i=t.diff;if(i&&typeof i=="function")return i(t,e);const r=Bfe(t),n=Bfe(e);if(r.length===0&&n.length===0)return;if(!r.length||!n.length||DAt(t,e))return{type:"complete",oldValue:t,newValue:e};const s=n.filter(d=>!r.includes(d)),o=r.filter(d=>!n.includes(d)),a=r.filter(d=>n.includes(d)&&$D(t,d)!==$D(e,d)).concat(s,o).sort(),l=jR(t);if(l&&LAt.has(l)&&a.length)return{type:"complete",oldValue:t,newValue:e};let c;const h=WY(t)&&WY(e);for(const d of a){const f=$D(t,d),m=$D(e,d);let y;if((h||typeof f!="function"&&typeof m!="function")&&f!==m&&(f!=null||m!=null)){if(i&&i[d]&&typeof i[d]=="function")y=i[d]?.(f,m);else if(f instanceof Date&&m instanceof Date){if(f.getTime()===m.getTime())continue;y={type:"complete",oldValue:f,newValue:m}}else y=typeof f=="object"&&typeof m=="object"&&jR(f)===jR(m)?gIe(f,m):{type:"complete",oldValue:f,newValue:m};y!=null&&(c!=null?c.diff[d]=y:c={type:"partial",diff:{[d]:y}})}}return c}function NAt(t,e){if(t==null)return!1;const i=e.split(".");let r=t;for(const n of i){if(r.type==="complete")return!0;if(r.type!=="partial")return!1;{const s=r.diff[n];if(!s)return!1;r=s}}return!0}function ojt(t,e){for(const i of e)if(NAt(t,i))return!0;return!1}function FAt(t,e){if(typeof t!="function"&&typeof e!="function"&&(t!=null||e!=null))return t==null||e==null||typeof t=="object"&&typeof e=="object"&&jR(t)!==jR(e)?{type:"complete",oldValue:t,newValue:e}:gIe(t,e)}function ID(t){if(t==null)return!0;switch(t.type){case"complete":return!1;case"collection":{const e=t;for(const i of e.added)if(!ID(i))return!1;for(const i of e.removed)if(!ID(i))return!1;for(const i of e.changed)if(!ID(i))return!1;return!0}case"partial":for(const e in t.diff)if(!ID(t.diff[e]))return!1;return!0}}let g2=class extends es(pe){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}};u([p(W4)],g2.prototype,"value",void 0),u([p(W4)],g2.prototype,"value2",void 0),u([p(W4)],g2.prototype,"value3",void 0),g2=u([M("esri.renderers.support.UniqueValue")],g2);const bE=g2;let x_=class extends es(pe){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(e==null)return null;const i=typeof(e=Array.isArray(e)?e:[e])[0];return i==="string"||i==="number"?e.map(r=>new bE({value:r})):i==="object"?e[0]instanceof bE?e:e.map(r=>new bE(r)):null}};u([p({type:String,json:{write:!0}})],x_.prototype,"description",void 0),u([p({type:String,json:{write:!0}})],x_.prototype,"label",void 0),u([p(A8)],x_.prototype,"symbol",void 0),u([p({type:[bE],json:{type:[[String]],read:{reader:t=>t?t.map(e=>new bE({value:e[0],value2:e[1],value3:e[2]})):null},write:{writer:(t,e)=>{const i=[];for(const r of t){const n=[r.value,r.value2,r.value3].filter(Yv).map(s=>s.toString());i.push(n)}e.values=i}}}})],x_.prototype,"values",void 0),u([ai("values")],x_.prototype,"castValues",null),x_=u([M("esri.renderers.support.UniqueValueClass")],x_);const yIe=x_;let IO=class extends es(pe){constructor(e){super(e),this.heading=null,this.classes=null}};u([p({type:String,json:{write:!0}})],IO.prototype,"heading",void 0),u([p({type:[yIe],json:{write:!0}})],IO.prototype,"classes",void 0),IO=u([M("esri.renderers.support.UniqueValueGroup")],IO);const YY=IO;var XY;let ew=XY=class extends pe{constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new XY({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const t=JSON.stringify(this.symbol?.toJSON());return`${this.value}.${t}`}};u([p({type:String,json:{write:!0}})],ew.prototype,"description",void 0),u([p({type:String,json:{write:!0}})],ew.prototype,"label",void 0),u([p(Cte)],ew.prototype,"symbol",void 0),u([p(W4)],ew.prototype,"value",void 0),ew=XY=u([M("esri.renderers.support.UniqueValueInfo")],ew);const HR=ew;var LO;const _Ie="esri.renderers.UniqueValueRenderer",H0=K.getLogger(_Ie),Vfe="uvInfos-watcher",Gfe="uvGroups-watcher",kAt=",",UAt=as(HR);function zAt(t){const{field1:e,field2:i,field3:r,fieldDelimiter:n,uniqueValueInfos:s,valueExpression:o}=t,a=!(!e||!i);return[{classes:(s??[]).map(l=>{const{symbol:c,label:h,value:d,description:f}=l,[m,y,_]=a?d?.toString()?.split(n||"")||[]:[d],v=[];return(e||o)&&v.push(m),i&&v.push(y),r&&v.push(_),{symbol:c,label:h,values:[v],description:f}})}]}let jn=LO=class extends HC(i0){constructor(t){super(t),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,i){if(!e&&!i)return;if(!e||!i)return{type:"complete",oldValue:e,newValue:i};let r=!1;const n={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let s=0;s<i.length;s++){const o=e.find(a=>a.value===i[s].value);o?FAt(o,i[s])?(n.changed.push({type:"complete",oldValue:o,newValue:i[s]}),r=!0):n.unchanged.push({oldValue:o,newValue:i[s]}):(n.added.push(i[s]),r=!0)}for(let s=0;s<e.length;s++)i.find(o=>o.value===e[s].value)||(n.removed.push(e[s]),r=!0);return r?n:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(t){this._set("field",t),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(t){return t==null||typeof t=="function"?t:lM(t)}writeField(t,e,i,r){typeof t=="string"?e[i]=t:r?.messages?r.messages.push(new G("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):H0.error(".field: cannot write field to JSON since it's not a string value")}set field2(t){this._set("field2",t),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(t){this._set("field3",t),this._updateUniqueValues()}set valueExpression(t){this._set("valueExpression",t),this._updateUniqueValues()}set defaultSymbol(t){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",t)}set fieldDelimiter(t){this._set("fieldDelimiter",t),this._updateUniqueValues()}readPortal(t,e,i){return i.portal||Ds.getDefault()}readStyleOrigin(t,e,i){if(e.styleName)return Object.freeze({styleName:e.styleName});if(e.styleUrl){const r=Cv(e.styleUrl,i);return Object.freeze({styleUrl:r})}}writeStyleOrigin(t,e,i,r){t.styleName?e.styleName=t.styleName:t.styleUrl&&(e.styleUrl=mx(t.styleUrl,r))}set uniqueValueGroups(t){this.styleOrigin?H0.error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",t),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(t){this.styleOrigin?H0.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(t,e){if(this.styleOrigin)return void H0.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let i;i=typeof t=="object"?UAt(t):new HR({value:t,symbol:Y1e(e)}),this.uniqueValueInfos?.push(i),this._valueInfoMap[i.value]=i,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(t){if(this.styleOrigin)return void H0.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const e=this.uniqueValueInfos;if(e)for(let i=0;i<e.length;i++){const r=e[i];if(String(r.value)===String(t)){delete this._valueInfoMap[t],e.splice(i,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(t,e){let i=e;return this.valueExpression&&e?.arcade==null&&(i={...i,arcade:await Pv()}),this._getUniqueValueInfo(t,i)}getSymbol(t,e){return this.valueExpression&&e?.arcade==null?void H0.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used"):this._getUniqueValueInfo(t,e)?.symbol||this.defaultSymbol}async getSymbolAsync(t,e){let i=e;if(this.valueExpression&&i?.arcade==null){const n=await Pv(),{arcadeUtils:s}=n;s.hasGeometryOperations(this.valueExpression)&&await s.enableGeometryOperations(),i={...i,arcade:n}}return this._getUniqueValueInfo(t,i)?.symbol||this.defaultSymbol}getSymbols(){const t=[];for(const e of this.uniqueValueInfos??[])e.symbol&&t.push(e.symbol);return this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),i=this.uniqueValueInfos?.reduce((r,n)=>r+n.getMeshHash(),"");return`${t}.${e}.${i}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const t=new LO({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:Q(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:Q(this.visualVariables),legendOptions:Q(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:Q(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(t._isDefaultSymbolDerived=!0),t._set("portal",this.portal);const e=Q(this.uniqueValueInfos),i=Q(this.uniqueValueGroups);return this.styleOrigin&&(t._set("styleOrigin",Object.freeze(Q(this.styleOrigin))),Object.freeze(e),Object.freeze(i)),t._set("uniqueValueInfos",e),t._updateValueInfoMap(),t._set("uniqueValueGroups",i),t._isInfosSource=this._isInfosSource,t._watchUniqueValueInfosAndGroups(),t}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(t,e){const i=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(i)}async collectSymbolFields(t,e){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(t,e)),Ql(t,e,this.valueExpression)];Hu(t,e,this.field),Hu(t,e,this.field2),Hu(t,e,this.field3),await Promise.all(i)}populateFromStyle(){return gee(this.styleOrigin,{portal:this.portal}).then(t=>{const e=[];return this._valueInfoMap={},t&&t.data&&Array.isArray(t.data.items)&&t.data.items.forEach(i=>{const r=new Hx({styleUrl:t.styleUrl,styleName:t.styleName,portal:this.portal,name:i.name});this.defaultSymbol||i.name!==t.data.defaultItem||(this.defaultSymbol=r,this._isDefaultSymbolDerived=!0);const n=new HR({value:i.name,symbol:r});e.push(n),this._valueInfoMap[i.name]=n}),this._set("uniqueValueInfos",Object.freeze(e)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&this.uniqueValueInfos?.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",kAt)}_updateUniqueValues(){this._isInfosSource!=null&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:t}=this;if(t)for(const e of t)this._valueInfoMap[e.value+""]=e}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(Vfe);const{uniqueValueInfos:t}=this;if(t){const e=[];for(const i of t)e.push(ne(()=>({symbol:i.symbol,value:i.value,label:i.label,description:i.description}),(r,n)=>{r!==n&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)},{sync:!0}));this.addHandles(e,Vfe)}}_watchUniqueValueGroups(){this.removeHandles(Gfe);const{uniqueValueGroups:t}=this;if(t){const e=[];for(const i of t){e.push(ne(()=>({classes:i.classes}),(r,n)=>{r!==n&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}));for(const r of i.classes??[])e.push(ne(()=>({symbol:r.symbol,values:r.values,label:r.label,description:r.description}),(n,s)=>{n!==s&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}))}this.addHandles(e,Gfe)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const t=[],{field:e,field2:i,field3:r,fieldDelimiter:n,uniqueValueGroups:s,valueExpression:o}=this;if(!e&&!o)return this._set("uniqueValueInfos",t),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const a=!(!e||!i);for(const l of s)for(const c of l.classes??[]){const{symbol:h,label:d,values:f,description:m}=c;for(const y of f??[]){const{value:_,value2:v,value3:w}=y,x=[_];i&&x.push(v),r&&x.push(w);const T=a?x.join(n||""):x[0];t.push(new HR({symbol:h,label:d,value:T,description:m}))}}this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(t=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:e,field2:i,valueExpression:r,fieldDelimiter:n,uniqueValueInfos:s}=this;if(!e&&!r||!s.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const o=!(!e||!i),a=s.map(c=>{const{symbol:h,label:d,value:f,description:m}=c,[y,_,v]=o?f?.toString()?.split(n||"")||[]:[f];return new yIe({symbol:h,label:d,description:m,values:[new bE({value:y,value2:_,value3:v})]})}),l=[new YY({classes:a})];t&&Object.freeze(l),this._set("uniqueValueGroups",l),this._watchUniqueValueGroups()}_getUniqueValueInfo(t,e){return this.valueExpression?this._getUnqiueValueInfoForExpression(t,e):this._getUnqiueValueInfoForFields(t)}_getUnqiueValueInfoForExpression(t,e){const{viewingMode:i,scale:r,spatialReference:n,arcade:s,timeZone:o}=e??{};let a=this._cache.compiledFunc;const l=s.arcadeUtils;if(!a){const h=l.createSyntaxTree(this.valueExpression);a=l.createFunction(h),this._cache.compiledFunc=a}const c=l.executeFunction(a,l.createExecContext(t,l.getViewInfo({viewingMode:i,scale:r,spatialReference:n}),o));return this._valueInfoMap[c+""]}_getUnqiueValueInfoForFields(t){const e=this.field,i=t.attributes;let r;if(typeof e!="function"&&this.field2){const n=this.field2,s=this.field3,o=[];e&&o.push(i[e]),n&&o.push(i[n]),s&&o.push(i[s]),r=o.join(this.fieldDelimiter||"")}else typeof e=="function"?r=e(t):e&&(r=i[e]);return this._valueInfoMap[r+""]}static fromPortalStyle(t,e){const i=new LO(e?.properties);i._set("styleOrigin",Object.freeze({styleName:t})),i._set("portal",e?.portal||Ds.getDefault());const r=i.populateFromStyle();return r.catch(n=>{H0.error(`#fromPortalStyle('${t}'[, ...])`,"Failed to create unique value renderer from style name",n)}),r}static fromStyleUrl(t,e){const i=new LO(e?.properties);i._set("styleOrigin",Object.freeze({styleUrl:t}));const r=i.populateFromStyle();return r.catch(n=>{H0.error(`#fromStyleUrl('${t}'[, ...])`,"Failed to create unique value renderer from style URL",n)}),r}};u([p({readOnly:!0})],jn.prototype,"_cache",null),u([nt({uniqueValue:"unique-value"})],jn.prototype,"type",void 0),u([p(aIe)],jn.prototype,"backgroundFillSymbol",void 0),u([p({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],jn.prototype,"field",null),u([ai("field")],jn.prototype,"castField",null),u([Be("field")],jn.prototype,"writeField",null),u([p({type:String,value:null,json:{write:!0}})],jn.prototype,"field2",null),u([p({type:String,value:null,json:{write:!0}})],jn.prototype,"field3",null),u([p({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],jn.prototype,"orderByClassesEnabled",void 0),u([p({type:String,value:null,json:{write:!0}})],jn.prototype,"valueExpression",null),u([p({type:String,json:{write:!0}})],jn.prototype,"valueExpressionTitle",void 0),u([p({type:vE,json:{write:!0}})],jn.prototype,"legendOptions",void 0),u([p({type:String,json:{write:!0}})],jn.prototype,"defaultLabel",void 0),u([p($X({...A8},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],jn.prototype,"defaultSymbol",null),u([p({type:String,value:null,json:{write:!0}})],jn.prototype,"fieldDelimiter",null),u([p({type:Ds,readOnly:!0})],jn.prototype,"portal",void 0),u([wt("portal",["styleName"])],jn.prototype,"readPortal",null),u([p({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],jn.prototype,"styleOrigin",void 0),u([wt("styleOrigin",["styleName","styleUrl"])],jn.prototype,"readStyleOrigin",null),u([Be("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],jn.prototype,"writeStyleOrigin",null),u([p({type:[YY],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(t,e,i)=>(e.uniqueValueGroups||zAt(e)).map(r=>YY.fromJSON(r,i))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],jn.prototype,"uniqueValueGroups",null),u([p({type:[HR],json:{read:!1,write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],jn.prototype,"uniqueValueInfos",null),jn=LO=u([M(_Ie)],jn);const w$=jn,R8={key:"type",base:i0,typeMap:{heatmap:mIe,simple:O8,"unique-value":w$,"class-breaks":cIe,"dot-density":CAt,dictionary:SAt,"pie-chart":IAt},errorContext:"renderer"},BAt={key:"type",base:i0,typeMap:{simple:O8,"unique-value":w$,"class-breaks":cIe,heatmap:mIe},errorContext:"renderer",validate:VAt};function VAt(t){switch(t.type){case"simple":return GAt(t);case"unique-value":return jAt(t);case"class-breaks":return HAt(t);case"heatmap":return t}}function GAt(t){if(t.symbol)return t;K.getLogger("esri.renderers.support.types").error("Removed invalid 'simple' renderer without a symbol from web scene.")}function jAt(t){const e=t.uniqueValueInfos,i=e?.filter(({symbol:r,label:n},s)=>(r||K.getLogger("esri.renderers.support.types").error(`Removed invalid unique value info ([${s}] ${n}) without a symbol from web scene.`),!!r));return i?.length!==e?.length&&(t.uniqueValueInfos=i),t}function HAt(t){const e=t.classBreakInfos,i=e?.filter(({symbol:r,label:n},s)=>(r||K.getLogger("esri.renderers.support.types").error(`Removed invalid class break info ([${s}] ${n}) without a symbol from web scene.`),!!r));return i?.length!==e?.length&&(t.classBreakInfos=i),t}function ujt(t,e){return eM(t,null,e)}const qAt=bC({types:R8});function eM(t,e,i){return t?t&&(t.styleName||t.styleUrl)&&t.type!=="uniqueValue"?(i?.messages&&i.messages.push(new Sm("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+t.type+"'",{definition:t,context:i})),null):qAt(t,e,i):null}const WAt=t=>{let e=class extends t{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const i=N6(this.url);if(i!=null&&i.title)return i.title}return this._get("title")||""}set title(i){this._set("title",i)}set url(i){this._set("url",V6e(i,K.getLogger(this)))}};return u([p()],e.prototype,"title",null),u([p({type:String})],e.prototype,"url",null),e=u([M("esri.layers.mixins.ArcGISService")],e),e},jfe={read:{reader:lee},write:{allowNull:!0,writer:cee}},YAt=t=>{let e=class extends t{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return u([p({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],e.prototype,"blendMode",void 0),u([p({json:{read:!1,write:!1,origins:{"web-map":jfe,"portal-item":jfe}}})],e.prototype,"effect",void 0),e=u([M("esri.layers.mixins.BlendLayer")],e),e},XAt=t=>{let e=class extends t{constructor(){super(...arguments),this.customParameters=null}};return u([p({type:Object,json:{write:{overridePolicy:i=>({enabled:!!(i&&Object.keys(i).length>0)})}}})],e.prototype,"customParameters",void 0),e=u([M("esri.layers.mixins.CustomParametersMixin")],e),e};var ZY;let y2=ZY=class extends pe{constructor(t){super(t),this.type="map-layer"}clone(){const{mapLayerId:t,gdbVersion:e}=this;return new ZY({mapLayerId:t,gdbVersion:e})}};u([nt({mapLayer:"map-layer"})],y2.prototype,"type",void 0),u([p({type:dr,json:{write:!0}})],y2.prototype,"mapLayerId",void 0),u([p({type:String,json:{write:!0}})],y2.prototype,"gdbVersion",void 0),y2=ZY=u([M("esri.layers.support.source.MapLayerSource")],y2);var JY;let Fg=JY=class extends pe{constructor(t){super(t),this.type="query-table"}clone(){const{workspaceId:t,query:e,oidFields:i,spatialReference:r,geometryType:n}=this,s={workspaceId:t,query:e,oidFields:i,spatialReference:r?.clone()??void 0,geometryType:n};return new JY(s)}};u([nt({queryTable:"query-table"})],Fg.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],Fg.prototype,"workspaceId",void 0),u([p({type:String,json:{write:!0}})],Fg.prototype,"query",void 0),u([p({type:String,json:{write:!0}})],Fg.prototype,"oidFields",void 0),u([p({type:ze,json:{write:!0}})],Fg.prototype,"spatialReference",void 0),u([nt(nP)],Fg.prototype,"geometryType",void 0),Fg=JY=u([M("esri.layers.support.source.QueryTableDataSource")],Fg);var KY;let _2=KY=class extends pe{constructor(t){super(t),this.type="raster"}clone(){const{workspaceId:t,dataSourceName:e}=this;return new KY({workspaceId:t,dataSourceName:e})}};u([nt({raster:"raster"})],_2.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],_2.prototype,"dataSourceName",void 0),u([p({type:String,json:{write:!0}})],_2.prototype,"workspaceId",void 0),_2=KY=u([M("esri.layers.support.source.RasterDataSource")],_2);var QY;let tw=QY=class extends pe{constructor(t){super(t),this.type="table"}clone(){const{workspaceId:t,gdbVersion:e,dataSourceName:i}=this;return new QY({workspaceId:t,gdbVersion:e,dataSourceName:i})}};u([nt({table:"table"})],tw.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],tw.prototype,"workspaceId",void 0),u([p({type:String,json:{write:!0}})],tw.prototype,"gdbVersion",void 0),u([p({type:String,json:{write:!0}})],tw.prototype,"dataSourceName",void 0),tw=QY=u([M("esri.layers.support.source.TableDataSource")],tw);var eX,tX;const ZAt=yl()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let yu=eX=class extends pe{constructor(t){super(t),this.type="join-table"}readLeftTableSource(t,e,i){return Hfe()(t,e,i)}castLeftTableSource(t){return Tm(iX(),t)}readRightTableSource(t,e,i){return Hfe()(t,e,i)}castRightTableSource(t){return Tm(iX(),t)}clone(){const{leftTableKey:t,rightTableKey:e,leftTableSource:i,rightTableSource:r,joinType:n}=this,s={leftTableKey:t,rightTableKey:e,leftTableSource:i?.clone()??void 0,rightTableSource:r?.clone()??void 0,joinType:n};return new eX(s)}};u([nt({joinTable:"join-table"})],yu.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],yu.prototype,"leftTableKey",void 0),u([p({type:String,json:{write:!0}})],yu.prototype,"rightTableKey",void 0),u([p({json:{write:!0}})],yu.prototype,"leftTableSource",void 0),u([wt("leftTableSource")],yu.prototype,"readLeftTableSource",null),u([ai("leftTableSource")],yu.prototype,"castLeftTableSource",null),u([p({json:{write:!0}})],yu.prototype,"rightTableSource",void 0),u([wt("rightTableSource")],yu.prototype,"readRightTableSource",null),u([ai("rightTableSource")],yu.prototype,"castRightTableSource",null),u([nt(ZAt)],yu.prototype,"joinType",void 0),yu=eX=u([M("esri.layers.support.source.JoinTableDataSource")],yu);let GV=null;function Hfe(){return GV||(GV=bC({types:iX()})),GV}let jV=null;function iX(){return jV||(jV={key:"type",base:null,typeMap:{"data-layer":Xf,"map-layer":y2}}),jV}const JAt={key:"type",base:null,typeMap:{"join-table":yu,"query-table":Fg,raster:_2,table:tw}};let Xf=tX=class extends pe{constructor(t){super(t),this.type="data-layer"}clone(){const{fields:t,dataSource:e}=this;return new tX({fields:t,dataSource:e})}};u([nt({dataLayer:"data-layer"})],Xf.prototype,"type",void 0),u([p({type:[QU],json:{write:!0}})],Xf.prototype,"fields",void 0),u([p({types:JAt,json:{write:!0}})],Xf.prototype,"dataSource",void 0),Xf=tX=u([M("esri.layers.support.source.DataLayerSource")],Xf),Xf.from=as(Xf);let iw=class extends es(pe){constructor(e){super(e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};u([p({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.onFields!=null&&this.onFields.length>0}}}}})],iw.prototype,"onFields",void 0),u([p({type:String,json:{write:!0}})],iw.prototype,"operator",void 0),u([p({type:String,json:{write:!0}})],iw.prototype,"searchTerm",void 0),u([p({type:String,json:{write:!0}})],iw.prototype,"searchType",void 0),iw=u([M("esri.rest.support.FullTextSearch")],iw);const KAt=iw;var rX;const qfe=new Sr({upperLeft:"upper-left",lowerLeft:"lower-left"});let rw=rX=class extends pe{constructor(t){super(t),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new rX(Q({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};u([p({type:zi,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],rw.prototype,"extent",void 0),u([p({type:["view","edit"],json:{write:!0}})],rw.prototype,"mode",void 0),u([p({type:String,json:{read:qfe.read,write:qfe.write}})],rw.prototype,"originPosition",void 0),u([p({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],rw.prototype,"tolerance",void 0),rw=rX=u([M("esri.rest.support.QuantizationParameters")],rw);const QAt=rw;var nX;const Wfe=new Sr({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let ep=nX=class extends pe{constructor(t){super(t),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(t,e){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(e.statisticParameters=Q(t))}clone(){return new nX({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:Q(this.statisticParameters)})}};u([p({type:Number,json:{write:!0}})],ep.prototype,"maxPointCount",void 0),u([p({type:Number,json:{write:!0}})],ep.prototype,"maxRecordCount",void 0),u([p({type:Number,json:{write:!0}})],ep.prototype,"maxVertexCount",void 0),u([p({type:String,json:{write:!0}})],ep.prototype,"onStatisticField",void 0),u([p({type:String,json:{write:!0}})],ep.prototype,"outStatisticFieldName",void 0),u([p({type:String,json:{read:{source:"statisticType",reader:Wfe.read},write:{target:"statisticType",writer:Wfe.write}}})],ep.prototype,"statisticType",void 0),u([p({type:Object})],ep.prototype,"statisticParameters",void 0),u([Be("statisticParameters")],ep.prototype,"writeStatisticParameters",null),ep=nX=u([M("esri.rest.support.StatisticDefinition")],ep);const e3t=ep;var e5;const t3t=new Sr({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),i3t=new Sr({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let It=e5=class extends pe{static from(t){return nx(e5,t)}constructor(t){super(t),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(t){return typeof t=="number"||typeof t=="object"?t:null}writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeParameterValues(t,e){if(t){const i={};for(const r in t){const n=t[r];Array.isArray(n)?i[r]=n.map(s=>s instanceof Date?s.getTime():s):n instanceof Date?i[r]=n.getTime():i[r]=n}e.parameterValues=i}}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,e.where="1=1"}writeWhere(t,e){e.where=t||"1=1"}clone(){return new e5(Q({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,formatOf3DObjects:this.formatOf3DObjects,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:this.historicMoment!=null?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};It.MAX_MAX_RECORD_COUNT_FACTOR=5,u([p({json:{write:!0}})],It.prototype,"aggregateIds",void 0),u([p({type:Boolean,json:{write:!0}})],It.prototype,"cacheHint",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],It.prototype,"compactGeometryEnabled",void 0),u([p({json:{write:!0}})],It.prototype,"datumTransformation",void 0),u([ai("datumTransformation")],It.prototype,"castDatumTransformation",null),u([p({type:Boolean,json:{default:!1,write:!0}})],It.prototype,"defaultSpatialReferenceEnabled",void 0),u([p({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],It.prototype,"distance",void 0),u([p({type:Xf,json:{write:!0}})],It.prototype,"dynamicDataSource",void 0),u([p({type:String,json:{write:!0}})],It.prototype,"formatOf3DObjects",void 0),u([p({type:[KAt],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.fullText!=null&&this.fullText.length>0}}}}})],It.prototype,"fullText",void 0),u([p({type:String,json:{write:!0}})],It.prototype,"gdbVersion",void 0),u([p({types:_M,json:{read:bv,write:!0}})],It.prototype,"geometry",void 0),u([p({type:Number,json:{write:!0}})],It.prototype,"geometryPrecision",void 0),u([p({type:[String],json:{write:!0}})],It.prototype,"groupByFieldsForStatistics",void 0),u([p({type:String,json:{write:!0}})],It.prototype,"having",void 0),u([p({type:Date})],It.prototype,"historicMoment",void 0),u([Be("historicMoment")],It.prototype,"writeHistoricMoment",null),u([p({type:Number,json:{write:!0}})],It.prototype,"maxAllowableOffset",void 0),u([p({type:Number,cast:t=>t<1?1:t>It.MAX_MAX_RECORD_COUNT_FACTOR?It.MAX_MAX_RECORD_COUNT_FACTOR:t,json:{write:{overridePolicy:t=>({enabled:t>1})}}})],It.prototype,"maxRecordCountFactor",void 0),u([p({type:["xyFootprint"],json:{write:!0}})],It.prototype,"multipatchOption",void 0),u([p({type:Number,json:{read:{source:"resultRecordCount"}}})],It.prototype,"num",void 0),u([p({json:{write:!0}})],It.prototype,"objectIds",void 0),u([p({type:[String],json:{write:!0}})],It.prototype,"orderByFields",void 0),u([p({type:[String],json:{write:!0}})],It.prototype,"outFields",void 0),u([p({type:ze,json:{name:"outSR",write:!0}})],It.prototype,"outSpatialReference",void 0),u([p({type:[e3t],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.outStatistics!=null&&this.outStatistics.length>0}}}}})],It.prototype,"outStatistics",void 0),u([p({json:{write:!0}})],It.prototype,"parameterValues",void 0),u([Be("parameterValues")],It.prototype,"writeParameterValues",null),u([p({type:ut,json:{write:!0}})],It.prototype,"pixelSize",void 0),u([p({type:QAt,json:{write:!0}})],It.prototype,"quantizationParameters",void 0),u([p({type:[Object],json:{write:!0}})],It.prototype,"rangeValues",void 0),u([p({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],It.prototype,"relationParameter",void 0),u([p({type:String,json:{write:!0}})],It.prototype,"resultType",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],It.prototype,"returnCentroid",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],It.prototype,"returnDistinctValues",void 0),u([p({type:Boolean,json:{default:!0,write:!0}})],It.prototype,"returnExceededLimitFeatures",void 0),u([p({type:Boolean,json:{write:!0}})],It.prototype,"returnGeometry",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],It.prototype,"returnQueryGeometry",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],It.prototype,"returnM",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],It.prototype,"returnZ",void 0),u([p({type:ze,json:{write:!0}})],It.prototype,"sourceSpatialReference",void 0),u([nt(t3t,{ignoreUnknown:!1,name:"spatialRel"})],It.prototype,"spatialRelationship",void 0),u([p({type:Number,json:{read:{source:"resultOffset"}}})],It.prototype,"start",void 0),u([Be("start"),Be("num")],It.prototype,"writeStart",null),u([p({type:String,json:{write:!0}})],It.prototype,"sqlFormat",void 0),u([p({type:String,json:{write:!0}})],It.prototype,"text",void 0),u([p({type:Gy,json:{write:!0}})],It.prototype,"timeExtent",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],It.prototype,"timeReferenceUnknownClient",void 0),u([nt(i3t,{ignoreUnknown:!1}),p({json:{write:{overridePolicy(t){return{enabled:!!t&&this.distance!=null&&this.distance>0}}}}})],It.prototype,"units",void 0),u([p({type:String,json:{write:{overridePolicy(t){return{enabled:t!=null||this.start!=null&&this.start>0}}}}})],It.prototype,"where",void 0),u([Be("where")],It.prototype,"writeWhere",null),It=e5=u([M("esri.rest.support.Query")],It);const sT=It;var sX;const HV=new Sr({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),qV=new Sr({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Gf=sX=class extends pe{constructor(t){super(t),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(t={}){const{where:e,geometry:i,spatialRelationship:r,timeExtent:n,objectIds:s,units:o,distance:a}=this;return new sT({geometry:Q(i),objectIds:Q(s),spatialRelationship:r,timeExtent:Q(n),where:e,units:o,distance:a,...t})}clone(){const{where:t,geometry:e,spatialRelationship:i,timeExtent:r,objectIds:n,units:s,distance:o}=this;return new sX({geometry:Q(e),objectIds:Q(n),spatialRelationship:i,timeExtent:Q(r),where:t,units:s,distance:o})}};u([p({type:String,json:{write:!0}})],Gf.prototype,"where",void 0),u([p({types:_M,json:{write:!0}})],Gf.prototype,"geometry",void 0),u([p({type:HV.apiValues,json:{name:"spatialRel",read:{reader:HV.read},write:{allowNull:!1,writer:HV.write,overridePolicy(){return{enabled:this.geometry!=null}}}}})],Gf.prototype,"spatialRelationship",void 0),u([p({type:Number,json:{write:{overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],Gf.prototype,"distance",void 0),u([p({type:[Number],json:{write:!0}})],Gf.prototype,"objectIds",void 0),u([p({type:qV.apiValues,json:{read:qV.read,write:{writer:qV.write,overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],Gf.prototype,"units",void 0),u([p({type:Gy,json:{write:!0}})],Gf.prototype,"timeExtent",void 0),Gf=sX=u([M("esri.layers.support.FeatureFilter")],Gf);const r3t=Gf;var oX;const Yfe={read:{reader:lee},write:{writer:cee,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},Xfe={read:{reader:lee},write:{writer:cee,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},Zfe={name:"showExcludedLabels",default:!0};let nw=oX=class extends pe{constructor(t){super(t),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(t,e){const i=super.write(t,e);if(e?.origin){if(i.filter){const r=Object.keys(i.filter);if(r.length>1||r[0]!=="where")return e.messages?.push(new G("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:e.layer,effect:this})),null}if("showExcludedLabels"in i)return e.messages?.push(new G("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:e.layer,effect:this})),null}return i}clone(){return new oX({filter:this.filter!=null?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};u([p({type:r3t,json:{write:{allowNull:!0,writer(t,e,i,r){const n=t?.write({},r);n&&Object.keys(n).length!==0?Mp(i,n,e):Mp(i,null,e)}}}})],nw.prototype,"filter",void 0),u([p({json:{write:!0,origins:{"web-map":Yfe,"portal-item":Yfe}}})],nw.prototype,"includedEffect",void 0),u([p({json:{write:!0,origins:{"web-map":Xfe,"portal-item":Xfe}}})],nw.prototype,"excludedEffect",void 0),u([p({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":Zfe,"portal-item":Zfe}}})],nw.prototype,"excludedLabelsVisible",void 0),nw=oX=u([M("esri.layers.support.FeatureEffect")],nw);const n3t=nw,Jfe={write:{allowNull:!0}},s3t=t=>{let e=class extends t{constructor(){super(...arguments),this.featureEffect=null}};return u([p({type:n3t,json:{origins:{"web-map":Jfe,"portal-item":Jfe}}})],e.prototype,"featureEffect",void 0),e=u([M("esri.layers.mixins.FeatureEffectLayer")],e),e};let v2=class extends es(pe){constructor(e){super(e),this.expression=null,this.title=null,this.returnType=null}};u([p({type:String,json:{write:!0}})],v2.prototype,"expression",void 0),u([p({type:String,json:{write:!0}})],v2.prototype,"title",void 0),u([p({type:String,json:{write:!0}})],v2.prototype,"returnType",void 0),v2=u([M("esri.layers.support.ExpressionInfo")],v2);const Rte=v2;var aX;let kg=aX=class extends pe{constructor(t){super(t),this.isAutoGenerated=!1,this.name=null,this.alias=null,this.onStatisticField=null,this.onStatisticExpression=null,this.statisticType=null}clone(){return new aX({name:this.name,alias:this.alias,isAutoGenerated:this.isAutoGenerated,onStatisticExpression:Q(this.onStatisticExpression),onStatisticField:this.onStatisticField,statisticType:this.statisticType})}};u([p({type:Boolean,json:{write:!0}})],kg.prototype,"isAutoGenerated",void 0),u([p({type:String,json:{write:!0}})],kg.prototype,"name",void 0),u([p({type:String,json:{write:!0}})],kg.prototype,"alias",void 0),u([p({type:String,json:{write:!0}})],kg.prototype,"onStatisticField",void 0),u([p({type:Rte,json:{write:!0}})],kg.prototype,"onStatisticExpression",void 0),u([p({type:String,json:{write:!0}})],kg.prototype,"statisticType",void 0),kg=aX=u([M("esri.layers.support.AggregateField")],kg);const Fx=kg;let mv=class extends pe{constructor(){super(...arguments),this.type=null}};u([p({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],mv.prototype,"type",void 0),mv=u([M("esri.layers.support.FeatureReduction")],mv);function o3t(t){if(!t)return t;const{start:e,end:i}=t;return new Gy({start:e!=null?qw(e,-e.getTimezoneOffset(),"minutes"):e,end:i!=null?qw(i,-i.getTimezoneOffset(),"minutes"):i})}function a3t(t){if(!t)return t;const{start:e,end:i}=t;return new Gy({start:e!=null?qw(e,e.getTimezoneOffset(),"minutes"):e,end:i!=null?qw(i,i.getTimezoneOffset(),"minutes"):i})}var lX;let DO=lX=class extends pe{constructor(t){super(t)}async collectRequiredFields(t,e){return Ql(t,e,this.expression)}clone(){return new lX({expression:this.expression,title:this.title})}equals(t){return this.expression===t.expression&&this.title===t.title}};u([p({type:String,json:{write:!0}})],DO.prototype,"expression",void 0),u([p({type:String,json:{write:!0}})],DO.prototype,"title",void 0),DO=lX=u([M("esri.layers.support.FeatureExpressionInfo")],DO);const Kfe=DO;var cX;const LD=yl()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),Qfe=new Sr({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let Ug=cX=class extends pe{constructor(t){super(t),this.offset=null}readFeatureExpressionInfo(t,e){return t??(e.featureExpression&&e.featureExpression.value===0?{expression:"0"}:void 0)}writeFeatureExpressionInfo(t,e,i,r){e[i]=t.write({},r),t.expression==="0"&&(e.featureExpression={value:0})}get mode(){const{offset:t,featureExpressionInfo:e}=this;return this._isOverridden("mode")?this._get("mode"):t!=null||e?"relative-to-ground":"on-the-ground"}set mode(t){this._override("mode",t)}set unit(t){this._set("unit",t)}write(t,e){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(t,e):null}clone(){return new cX({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(t){return this.mode===t.mode&&this.offset===t.offset&&this.unit===t.unit&&fLe(this.featureExpressionInfo,t.featureExpressionInfo)}};u([p({type:Kfe,json:{write:!0}})],Ug.prototype,"featureExpressionInfo",void 0),u([wt("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],Ug.prototype,"readFeatureExpressionInfo",null),u([Be("featureExpressionInfo",{featureExpressionInfo:{type:Kfe},"featureExpression.value":{type:[0]}})],Ug.prototype,"writeFeatureExpressionInfo",null),u([p({type:LD.apiValues,nonNullable:!0,json:{type:LD.jsonValues,read:LD.read,write:{writer:LD.write,isRequired:!0}}})],Ug.prototype,"mode",null),u([p({type:Number,json:{write:!0}})],Ug.prototype,"offset",void 0),u([p({type:Srt,json:{type:String,read:Qfe.read,write:Qfe.write}})],Ug.prototype,"unit",null),Ug=cX=u([M("esri.layers.support.ElevationInfo")],Ug);const vIe=Ug,l3t={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:{enabled:!0,layerContainerTypes:ih}}},Pte={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(t,e)=>!e.disablePopup},write:{enabled:!0,writer(t,e,i){e[i]=!t}}}},Mte={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:{enabled:!0,layerContainerTypes:ih}}},c3t={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:Av}}},u3t={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:{enabled:!0,layerContainerTypes:ih}}},fjt={value:null,type:vIe,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:{enabled:!0,layerContainerTypes:ih}}};function mjt(t){return{type:t,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const bIe={write:{enabled:!0,layerContainerTypes:ih},read:!0},uX={type:Number,json:{origins:{"web-document":bIe,"portal-item":{write:!0}}}},gjt={...uX,json:{...uX.json,origins:{"web-document":{...bIe,write:{enabled:!0,layerContainerTypes:ih,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(t,e,i)=>i&&i.origin!=="service"||!e.drawingInfo||e.drawingInfo.transparency===void 0?e.layerDefinition?.drawingInfo&&e.layerDefinition.drawingInfo.transparency!==void 0?RE(e.layerDefinition.drawingInfo.transparency):void 0:RE(e.drawingInfo.transparency)}}},yjt={type:Gy,readOnly:!0,get(){if(!this.layer?.timeInfo)return null;const{datesInUnknownTimezone:t,timeOffset:e,useViewTime:i}=this.layer,r=this.view?.timeExtent;let n=this.layer.timeExtent;t&&(n=a3t(n));let s=i?r&&n?r.intersection(n):r||n:n;if(!s||s.isEmpty||s.isAllTime)return s;e&&(s=s.offset(-e.value,e.unit)),t&&(s=o3t(s));const o=this._get("timeExtent");return s.equals(o)?o:s}},_jt={type:zi,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(t,e)=>{const i=zi.fromJSON(t);return e.spatialReference!=null&&typeof e.spatialReference=="object"&&(i.spatialReference=ze.fromJSON(e.spatialReference)),i}}}},read:!1}},vjt={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},h3t={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.minScale",write:{enabled:!0,layerContainerTypes:ih}}},name:"layerDefinition.minScale",write:!0}},d3t={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.maxScale",write:{enabled:!0,layerContainerTypes:ih}}},name:"layerDefinition.maxScale",write:!0}},p3t={json:{write:{ignoreOrigin:!0,layerContainerTypes:ih},origins:{"web-map":{read:!1,write:!1}}}};async function f3t(t,e,i){e=e.clone(),t.capabilities.query.supportsMaxRecordCountFactor&&(e.maxRecordCountFactor=wIe(t));const r=m3t(t),n=t.capabilities.query.supportsPagination;e.start=0,e.num=r;let s=null;for(;;){const o=await t.source.queryFeaturesJSON(e,i);if(s==null?s=o:s.features=s.features.concat(o.features),s.exceededTransferLimit=o.exceededTransferLimit,!n||!o.exceededTransferLimit)break;e.start+=r}return s}function m3t(t){return wIe(t)*g3t(t)}function g3t(t){return t.capabilities.query.maxRecordCount||2e3}function wIe(t){return t.capabilities.query.supportsMaxRecordCountFactor?sT.MAX_MAX_RECORD_COUNT_FACTOR:1}var hX;let Qo=hX=class extends pe{constructor(t){super(t),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new hX(Q({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};u([p({type:[String],json:{write:!0}})],Qo.prototype,"attachmentTypes",void 0),u([p({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],Qo.prototype,"attachmentsWhere",void 0),u([p({type:Boolean,json:{write:!0}})],Qo.prototype,"cacheHint",void 0),u([p({type:[String],json:{write:!0}})],Qo.prototype,"keywords",void 0),u([p({type:[Number],json:{write:!0}})],Qo.prototype,"globalIds",void 0),u([p({json:{write:!0}})],Qo.prototype,"name",void 0),u([p({type:Number,json:{read:{source:"resultRecordCount"}}})],Qo.prototype,"num",void 0),u([p({type:[Number],json:{write:!0}})],Qo.prototype,"objectIds",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],Qo.prototype,"returnMetadata",void 0),u([p({type:[Number],json:{write:!0}})],Qo.prototype,"size",void 0),u([p({type:Number,json:{read:{source:"resultOffset"}}})],Qo.prototype,"start",void 0),u([Be("start"),Be("num")],Qo.prototype,"writeStart",null),u([p({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],Qo.prototype,"where",void 0),Qo=hX=u([M("esri.rest.support.AttachmentQuery")],Qo),Qo.from=as(Qo);const y3t=Qo;var dX;let rs=dX=class extends pe{constructor(t){super(t),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(e.definitionExpression="1=1")}clone(){return new dX(Q({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};u([p({type:Boolean,json:{write:!0}})],rs.prototype,"cacheHint",void 0),u([p({type:Xf,json:{write:!0}})],rs.prototype,"dynamicDataSource",void 0),u([p({type:String,json:{write:!0}})],rs.prototype,"gdbVersion",void 0),u([p({type:Number,json:{write:!0}})],rs.prototype,"geometryPrecision",void 0),u([p({type:Date})],rs.prototype,"historicMoment",void 0),u([Be("historicMoment")],rs.prototype,"_writeHistoricMoment",null),u([p({type:Number,json:{write:!0}})],rs.prototype,"maxAllowableOffset",void 0),u([p({type:[Number],json:{write:!0}})],rs.prototype,"objectIds",void 0),u([p({type:[String],json:{write:!0}})],rs.prototype,"orderByFields",void 0),u([p({type:[String],json:{write:!0}})],rs.prototype,"outFields",void 0),u([p({type:ze,json:{read:{source:"outSR"},write:{target:"outSR"}}})],rs.prototype,"outSpatialReference",void 0),u([p({json:{write:!0}})],rs.prototype,"relationshipId",void 0),u([p({type:Number,json:{read:{source:"resultOffset"}}})],rs.prototype,"start",void 0),u([Be("start"),Be("num")],rs.prototype,"writeStart",null),u([p({type:Number,json:{read:{source:"resultRecordCount"}}})],rs.prototype,"num",void 0),u([p({json:{write:!0}})],rs.prototype,"returnGeometry",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],rs.prototype,"returnM",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],rs.prototype,"returnZ",void 0),u([p({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],rs.prototype,"where",void 0),rs=dX=u([M("esri.rest.support.RelationshipQuery")],rs),rs.from=as(rs);const $te=rs,bjt=Object.freeze(Object.defineProperty({__proto__:null,default:$te},Symbol.toStringTag,{value:"Module"})),wjt=new Sr({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function xjt(t,e,i,r){const n=await c1(t);if(await Ite(t,e,r),!n.addAttachment)throw new G(r,"Layer source does not support addAttachment capability");return n.addAttachment(e,i)}function Ite(t,e,i){const{attributes:r}=e,{objectIdField:n}=t;return t.capabilities?.data?.supportsAttachment?e?r?n&&r[n]?Promise.resolve():Promise.reject(new G(i,`feature is missing the identifying attribute ${n}`)):Promise.reject(new G(i,"'attributes' are required on a feature to query attachments")):Promise.reject(new G(i,"A feature is required to add/delete/update attachments")):Promise.reject(new G(i,"this layer doesn't support attachments"))}async function Tjt(t,e,i,r,n){const s=await c1(t);if(await Ite(t,e,n),!s.updateAttachment)throw new G(n,"Layer source does not support updateAttachment capability");return s.updateAttachment(e,i,r)}async function Sjt(t,e,i){const{applyEdits:r}=await ce(()=>import("./editingSupport-0e0a87c3.js"),["./editingSupport-0e0a87c3.js","./EditBusLayer-4de7f58b.js"],import.meta.url),n=await t.load(),{source:s,globalIdField:o}=n;let a=i;return n.type==="feature"&&n.infoFor3D&&e.deleteFeatures!=null&&o!=null&&(a={...a,globalIdToObjectId:await v3t(t,e.deleteFeatures,o)}),r(n,s,e,i)}async function Ejt(t,e,i){const{uploadAssets:r}=await ce(()=>import("./editingSupport-0e0a87c3.js"),["./editingSupport-0e0a87c3.js","./EditBusLayer-4de7f58b.js"],import.meta.url),n=await t.load();return r(n,n.source,e,i)}async function Cjt(t,e,i,r){const n=await c1(t);if(await Ite(t,e,r),!n.deleteAttachments)throw new G(r,"Layer source does not support deleteAttachments capability");return n.deleteAttachments(e,i)}async function Ajt(t,e,i){const r=(await t.load({signal:e?.signal})).source;if(!r.fetchRecomputedExtents)throw new G(i,"Layer source does not support fetchUpdates capability");return r.fetchRecomputedExtents(e)}async function Ojt(t,e,i,r){e=y3t.from(e),await t.load();const n=t.source,s=t.capabilities;if(!s?.data?.supportsAttachment)throw new G(r,"this layer doesn't support attachments");const{attachmentTypes:o,objectIds:a,globalIds:l,num:c,size:h,start:d,where:f}=e;if(!s?.operations?.supportsQueryAttachments&&(o?.length>0||l?.length>0||h?.length>0||c||d||f))throw new G(r,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(a?.length||l?.length||f))throw new G(r,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!n.queryAttachments)throw new G(r,"Layer source does not support queryAttachments capability",e);return n.queryAttachments(e)}async function Rjt(t,e,i,r){const n=await c1(t);if(!n.queryObjectIds)throw new G(r,"Layer source does not support queryObjectIds capability");return n.queryObjectIds(sT.from(e)??t.createQuery(),i)}async function Pjt(t,e,i,r){const n=await c1(t);if(!n.queryFeatureCount)throw new G(r,"Layer source does not support queryFeatureCount capability");return n.queryFeatureCount(sT.from(e)??t.createQuery(),i)}async function Mjt(t,e,i,r){const n=await c1(t);if(!n.queryExtent)throw new G(r,"Layer source does not support queryExtent capability");return n.queryExtent(sT.from(e)??t.createQuery(),i)}async function $jt(t,e,i,r){const n=await c1(t);if(!n.queryRelatedFeatures)throw new G(r,"Layer source does not support queryRelatedFeatures capability");return n.queryRelatedFeatures($te.from(e),i)}async function Ijt(t,e,i,r){const n=await c1(t);if(!n.queryRelatedFeaturesCount)throw new G(r,"Layer source does not support queryRelatedFeaturesCount capability");return n.queryRelatedFeaturesCount($te.from(e),i)}async function Ljt(t){const e=t.source;if(e?.refresh)try{const{dataChanged:i,updates:r}=await e.refresh();if(r!=null&&(t.sourceJSON={...t.sourceJSON,...r},t.read(r,{origin:"service",url:t.parsedUrl})),i)return!0}catch{}if(t.definitionExpression)try{return(await QZ(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1}function Djt(t){const e=new sT,i=t.capabilities?.data,r=t.capabilities?.query;e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,r&&(e.compactGeometryEnabled=r.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=r.supportsDefaultSpatialReference),i&&(i.supportsZ&&t.returnZ!=null&&(e.returnZ=t.returnZ),i.supportsM&&t.returnM!=null&&(e.returnM=t.returnM)),e.outFields=["*"];const{timeOffset:n,timeExtent:s}=t;return e.timeExtent=n!=null&&s!=null?s.offset(-n.value,n.unit):s||null,e.multipatchOption=t.geometryType==="multipatch"?"xyFootprint":null,e}function Njt(t){const{globalIdField:e,fields:i}=t;if(e)return e;if(i){for(const r of i)if(r.type==="esriFieldTypeGlobalID")return r.name}}function Fjt(t){const{objectIdField:e,fields:i}=t;if(e)return e;if(i){for(const r of i)if(r.type==="esriFieldTypeOID")return r.name}}function kjt(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}async function c1(t){return(await t.load()).source}async function _3t(t,e){if(!Wt||Wt.findCredential(t))return;let i;try{const r=await Tye(t,e);r&&(i=await Wt.checkSignInStatus(`${r}/sharing`))}catch{}if(i)try{const r=e!=null?e.signal:null;await Wt.getCredential(t,{signal:r})}catch{}}async function Ujt(t,e,i){const r=t.parsedUrl?.path;r&&t.authenticationTriggerEvent===e&&await _3t(r,i)}function zjt(t){return!t.sourceJSON?.isMultiServicesView&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}const WV=bC({types:W1e});function Lte(t,e){if(t.defaultSymbol)return t.types?.length?new w$({defaultSymbol:WV(t.defaultSymbol,t,e),field:t.typeIdField,uniqueValueInfos:t.types.map(i=>({id:i.id,symbol:WV(i.symbol,i,e)}))}):new O8({symbol:WV(t.defaultSymbol,t,e)})}function Bjt(t){let e=t.sourceJSON?.cacheMaxAge;if(!e)return!1;const i=t.editingInfo?.lastEditDate?.getTime();return i==null||(e*=1e3,Date.now()-i<e)}async function v3t(t,e,i){if(e==null)return null;const r=[],{objectIdField:n}=t;if(e.forEach(c=>{let h=null;if("attributes"in c){const{attributes:d}=c;h={globalId:d[i],objectId:d[n]!=null&&d[n]!==-1?d[n]:null}}else h={globalId:c.globalId,objectId:c.objectId!=null&&c.objectId!==-1?c.objectId:null};h.globalId!=null&&(h.objectId!=null&&h.objectId!==-1||r.push(h.globalId))}),r.length===0)return null;const s=t.createQuery();s.where=r.map(c=>`${i}='${c}'`).join(" OR "),s.returnGeometry=!1,s.outFields=[n,i],s.cacheHint=!1;const o=await o4e(f3t(t,s));if(!o.ok)return null;const a=new Map,l=o.value.features;for(const c of l){const h=c.attributes[i],d=c.attributes[n];h!=null&&d!=null&&d!==-1&&a.set(h,d)}return a}var pX;let T_=pX=class extends pe{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(t,e){return e.value?Jq(e.value):t}writeExpression(t,e,i){this.value!=null&&(t=Jq(this.value)),t!=null&&(e[i]=t)}clone(){return new pX({expression:this.expression,title:this.title,value:this.value})}};u([p({type:String,json:{write:{writerEnsuresNonNull:!0}}})],T_.prototype,"expression",void 0),u([wt("expression",["expression","value"])],T_.prototype,"readExpression",null),u([Be("expression")],T_.prototype,"writeExpression",null),u([p({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],T_.prototype,"title",void 0),u([p({json:{read:!1,write:!1}})],T_.prototype,"value",void 0),T_=pX=u([M("esri.layers.support.LabelExpressionInfo")],T_);const xIe=T_,TIe=[252,146,31,255],Vjt=[153,153,153,255],b3t={type:"esriSMS",style:"esriSMSCircle",size:6,color:TIe,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},w3t={type:"esriSLS",style:"esriSLSSolid",width:.75,color:TIe},x3t={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},T3t={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},S3t={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},E3t={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},C3t={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},Gjt=Qv.fromJSON(b3t),jjt=ud.fromJSON(w3t),Hjt=jx.fromJSON(x3t),A3t=MC.fromJSON(T3t);Qv.fromJSON(S3t);ud.fromJSON(E3t);jx.fromJSON(C3t);var fX;const DD=new Sr({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function ND(t,e,i){return{enabled:!xye(i?.layer)}}function SIe(t){return!t||t.origin!=="service"&&t.layer?.type!=="map-image"}function O3t(t){return t?.type==="map-image"}function EIe(t){return!!O3t(t)&&!!t.capabilities?.exportMap?.supportsArcadeExpressionForLabeling}function R3t(t){return SIe(t)||EIe(t?.layer)}let xs=fX=class extends pe{static evaluateWhere(t,e){const i=(r,n,s)=>{switch(n){case"=":return r==s;case"<>":return r!=s;case">":return r>s;case">=":return r>=s;case"<":return r<s;case"<=":return r<=s}return!1};try{if(t==null)return!0;const r=t.split(" ");if(r.length===3)return i(e[r[0]],r[1],r[2]);if(r.length===7){const n=i(e[r[0]],r[1],r[2]),s=r[3],o=i(e[r[4]],r[5],r[6]);switch(s){case"AND":return n&&o;case"OR":return n||o}}return!1}catch{console.log("Error.: can't parse = "+t)}}constructor(t){super(t),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=A3t,this.useCodedValues=void 0,this.where=null}readLabelExpression(t,e){const i=e.labelExpressionInfo;if(!i||!i.value&&!i.expression)return t}writeLabelExpression(t,e,i){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)t=Xit(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const r=bQ(this.labelExpressionInfo.expression);r&&(t="["+r+"]")}}t!=null&&(e[i]=t)}writeLabelExpressionInfo(t,e,i,r){if(t==null&&this.labelExpression!=null&&SIe(r))t=new xIe({expression:this.getLabelExpressionArcade()});else if(!t)return;const n=t.toJSON(r);n.expression&&(e[i]=n)}writeMaxScale(t,e){(t||this.minScale)&&(e.maxScale=t)}writeMinScale(t,e){(t||this.maxScale)&&(e.minScale=t)}getLabelExpression(){return HU(this)}getLabelExpressionArcade(){return Zit(this)}getLabelExpressionSingleField(){return Jit(this)}hash(){return JSON.stringify(this)}clone(){return new fX({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:Q(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:Q(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};u([p({type:String,json:{write:!0}})],xs.prototype,"name",void 0),u([p({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:ND}}}}})],xs.prototype,"allowOverrun",void 0),u([p({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:ND}}}}})],xs.prototype,"deconflictionStrategy",void 0),u([p({type:String,json:{write:{overridePolicy(t,e,i){return this.labelExpressionInfo&&i?.origin==="service"&&EIe(i.layer)?{enabled:!1}:{allowNull:!0}}}}})],xs.prototype,"labelExpression",void 0),u([wt("labelExpression")],xs.prototype,"readLabelExpression",null),u([Be("labelExpression")],xs.prototype,"writeLabelExpression",null),u([p({type:xIe,json:{write:{overridePolicy:(t,e,i)=>R3t(i)?{allowNull:!0}:{enabled:!1}}}})],xs.prototype,"labelExpressionInfo",void 0),u([Be("labelExpressionInfo")],xs.prototype,"writeLabelExpressionInfo",null),u([p({type:DD.apiValues,json:{type:DD.jsonValues,read:DD.read,write:DD.write}})],xs.prototype,"labelPlacement",void 0),u([p({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],xs.prototype,"labelPosition",void 0),u([p({type:Number})],xs.prototype,"maxScale",void 0),u([Be("maxScale")],xs.prototype,"writeMaxScale",null),u([p({type:Number})],xs.prototype,"minScale",void 0),u([Be("minScale")],xs.prototype,"writeMinScale",null),u([p({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:ND}}}}})],xs.prototype,"repeatLabel",void 0),u([p({type:Number,cast:sr,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:ND}}}}})],xs.prototype,"repeatLabelDistance",void 0),u([p({types:yVe,json:{origins:{"web-scene":{types:_Ve,write:Fce,default:null}},write:Fce,default:null}})],xs.prototype,"symbol",void 0),u([p({type:Boolean,json:{write:!0}})],xs.prototype,"useCodedValues",void 0),u([p({type:String,json:{write:!0}})],xs.prototype,"where",void 0),xs=fX=u([M("esri.layers.support.LabelClass")],xs);const qC=xs;var mX;const P3t="esri.layers.support.FeatureReductionBinning";let Nl=mX=class extends mv{constructor(t){super(t),this.type="binning",this.binType="geohash",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}writeFields(t,e,i){const r=t.filter(n=>n.statisticType!=="avg_angle").map(n=>n.toJSON());Mp(i,r,e)}readRenderer(t,e,i){const r=e.drawingInfo?.renderer;return r?eM(r,e,i)??void 0:Lte(e,i)}clone(){return new mX({fields:Q(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:Q(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:Q(this.popupTemplate),renderer:Q(this.renderer)})}};u([nt({binning:"binning"})],Nl.prototype,"type",void 0),u([nt({geohash:"geohash"})],Nl.prototype,"binType",void 0),u([p({type:Number,range:{min:1,max:9},json:{write:!0}})],Nl.prototype,"fixedBinLevel",void 0),u([p({type:[qC],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Nl.prototype,"labelingInfo",void 0),u([p(Mte)],Nl.prototype,"labelsVisible",void 0),u([p({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],Nl.prototype,"maxScale",void 0),u([p(Pte)],Nl.prototype,"popupEnabled",void 0),u([p({type:AM,json:{name:"popupInfo",write:!0}})],Nl.prototype,"popupTemplate",void 0),u([p({type:[Fx],json:{write:!0}})],Nl.prototype,"fields",void 0),u([Be("fields")],Nl.prototype,"writeFields",null),u([p({types:R8,json:{write:{target:"drawingInfo.renderer"}}})],Nl.prototype,"renderer",void 0),u([wt("renderer",["drawingInfo.renderer"])],Nl.prototype,"readRenderer",null),Nl=mX=u([M(P3t)],Nl);const CIe=Nl;var gX;const M3t="esri.layers.support.FeatureReductionCluster";function eme(t){return t.type==="simple"&&!t.visualVariables?.length}let oo=gX=class extends pe{constructor(t){super(t),this.type="cluster",this.clusterRadius=sr("80px"),this.clusterMinSize=sr("12px"),this.clusterMaxSize=sr("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}readRenderer(t,e,i){const r=e.drawingInfo?.renderer;return r?.authoringInfo?.isAutoGenerated?null:r?eme(r)?null:eM(r,e,i)??void 0:Lte(e,i)}readSymbol(t,e,i){const r=e.drawingInfo?.renderer;return r?.authoringInfo?.isAutoGenerated?null:r&&eme(r)?eM(r,e,i)?.symbol:null}writeSymbol(t,e,i,r){const n=this.renderer?.authoringInfo?.isAutoGenerated;if(!this.renderer||n){const s=new O8({symbol:t});e.drawingInfo={renderer:s.write({},r)}}}writeFields(t,e,i){const r=t.filter(n=>n.statisticType!=="avg_angle").map(n=>n.toJSON());Mp(i,r,e)}readFields(t,e,i){return t.filter(r=>!r.isAutoGenerated).map(r=>Fx.fromJSON(r))}clone(){return new gX({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:Q(this.labelingInfo),labelsVisible:this.labelsVisible,fields:Q(this.fields),maxScale:this.maxScale,renderer:Q(this.renderer),symbol:Q(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:Q(this.popupTemplate)})}};u([p({type:["cluster"],readOnly:!0,json:{write:!0}})],oo.prototype,"type",void 0),u([p({type:Number,cast:t=>t==="auto"?t:sr(t),json:{write:!0}})],oo.prototype,"clusterRadius",void 0),u([p({type:Number,cast:sr,json:{write:!0}})],oo.prototype,"clusterMinSize",void 0),u([p({type:Number,cast:sr,json:{write:!0}})],oo.prototype,"clusterMaxSize",void 0),u([p({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],oo.prototype,"maxScale",void 0),u([p(Pte)],oo.prototype,"popupEnabled",void 0),u([p({type:AM,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],oo.prototype,"popupTemplate",void 0),u([p({types:R8,json:{write:{target:"drawingInfo.renderer"}}})],oo.prototype,"renderer",void 0),u([wt("renderer",["drawingInfo.renderer"])],oo.prototype,"readRenderer",null),u([p({types:mVe})],oo.prototype,"symbol",void 0),u([wt("symbol",["drawingInfo.renderer"])],oo.prototype,"readSymbol",null),u([Be("symbol")],oo.prototype,"writeSymbol",null),u([p({type:[qC],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],oo.prototype,"labelingInfo",void 0),u([p(Mte)],oo.prototype,"labelsVisible",void 0),u([p({type:[Fx],json:{write:!0}})],oo.prototype,"fields",void 0),u([Be("fields")],oo.prototype,"writeFields",null),u([wt("fields")],oo.prototype,"readFields",null),oo=gX=u([M(M3t)],oo);const AIe=oo;var yX;let t5=yX=class extends mv{constructor(t){super(t),this.type="selection"}clone(){return new yX}};u([p({type:["selection"]})],t5.prototype,"type",void 0),t5=yX=u([M("esri.layers.support.FeatureReductionSelection")],t5);const tme=t5,ime={key:"type",base:mv,typeMap:{cluster:AIe,binning:CIe}},$3t={types:{key:"type",base:mv,typeMap:{selection:tme,cluster:AIe,binning:CIe}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:ime},"portal-item":{types:ime},"web-scene":{types:{key:"type",base:mv,typeMap:{selection:tme}},name:"layerDefinition.featureReduction",write:{layerContainerTypes:ih}}}}},wS={Base64:0,Hex:1,String:2,Raw:3},wE=8,OIe=(1<<wE)-1;function sv(t,e){const i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}function I3t(t){const e=[];for(let i=0,r=t.length*wE;i<r;i+=wE)e[i>>5]|=(t.charCodeAt(i/wE)&OIe)<<i%32;return e}function L3t(t){const e=[];for(let i=0,r=32*t.length;i<r;i+=wE)e.push(String.fromCharCode(t[i>>5]>>>i%32&OIe));return e.join("")}function D3t(t){const e="0123456789abcdef",i=[];for(let r=0,n=4*t.length;r<n;r++)i.push(e.charAt(t[r>>2]>>r%4*8+4&15)+e.charAt(t[r>>2]>>r%4*8&15));return i.join("")}function N3t(t){const e="=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=[];for(let n=0,s=4*t.length;n<s;n+=3){const o=(t[n>>2]>>n%4*8&255)<<16|(t[n+1>>2]>>(n+1)%4*8&255)<<8|t[n+2>>2]>>(n+2)%4*8&255;for(let a=0;a<4;a++)8*n+6*a>32*t.length?r.push(e):r.push(i.charAt(o>>6*(3-a)&63))}return r.join("")}function F3t(t,e){return t<<e|t>>>32-e}function P8(t,e,i,r,n,s){return sv(F3t(sv(sv(e,t),sv(r,s)),n),i)}function qa(t,e,i,r,n,s,o){return P8(e&i|~e&r,t,e,n,s,o)}function Wa(t,e,i,r,n,s,o){return P8(e&r|i&~r,t,e,n,s,o)}function Ya(t,e,i,r,n,s,o){return P8(e^i^r,t,e,n,s,o)}function Xa(t,e,i,r,n,s,o){return P8(i^(e|~r),t,e,n,s,o)}function k3t(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;let i=1732584193,r=-271733879,n=-1732584194,s=271733878;for(let o=0;o<t.length;o+=16){const a=i,l=r,c=n,h=s;i=qa(i,r,n,s,t[o],7,-680876936),s=qa(s,i,r,n,t[o+1],12,-389564586),n=qa(n,s,i,r,t[o+2],17,606105819),r=qa(r,n,s,i,t[o+3],22,-1044525330),i=qa(i,r,n,s,t[o+4],7,-176418897),s=qa(s,i,r,n,t[o+5],12,1200080426),n=qa(n,s,i,r,t[o+6],17,-1473231341),r=qa(r,n,s,i,t[o+7],22,-45705983),i=qa(i,r,n,s,t[o+8],7,1770035416),s=qa(s,i,r,n,t[o+9],12,-1958414417),n=qa(n,s,i,r,t[o+10],17,-42063),r=qa(r,n,s,i,t[o+11],22,-1990404162),i=qa(i,r,n,s,t[o+12],7,1804603682),s=qa(s,i,r,n,t[o+13],12,-40341101),n=qa(n,s,i,r,t[o+14],17,-1502002290),r=qa(r,n,s,i,t[o+15],22,1236535329),i=Wa(i,r,n,s,t[o+1],5,-165796510),s=Wa(s,i,r,n,t[o+6],9,-1069501632),n=Wa(n,s,i,r,t[o+11],14,643717713),r=Wa(r,n,s,i,t[o],20,-373897302),i=Wa(i,r,n,s,t[o+5],5,-701558691),s=Wa(s,i,r,n,t[o+10],9,38016083),n=Wa(n,s,i,r,t[o+15],14,-660478335),r=Wa(r,n,s,i,t[o+4],20,-405537848),i=Wa(i,r,n,s,t[o+9],5,568446438),s=Wa(s,i,r,n,t[o+14],9,-1019803690),n=Wa(n,s,i,r,t[o+3],14,-187363961),r=Wa(r,n,s,i,t[o+8],20,1163531501),i=Wa(i,r,n,s,t[o+13],5,-1444681467),s=Wa(s,i,r,n,t[o+2],9,-51403784),n=Wa(n,s,i,r,t[o+7],14,1735328473),r=Wa(r,n,s,i,t[o+12],20,-1926607734),i=Ya(i,r,n,s,t[o+5],4,-378558),s=Ya(s,i,r,n,t[o+8],11,-2022574463),n=Ya(n,s,i,r,t[o+11],16,1839030562),r=Ya(r,n,s,i,t[o+14],23,-35309556),i=Ya(i,r,n,s,t[o+1],4,-1530992060),s=Ya(s,i,r,n,t[o+4],11,1272893353),n=Ya(n,s,i,r,t[o+7],16,-155497632),r=Ya(r,n,s,i,t[o+10],23,-1094730640),i=Ya(i,r,n,s,t[o+13],4,681279174),s=Ya(s,i,r,n,t[o],11,-358537222),n=Ya(n,s,i,r,t[o+3],16,-722521979),r=Ya(r,n,s,i,t[o+6],23,76029189),i=Ya(i,r,n,s,t[o+9],4,-640364487),s=Ya(s,i,r,n,t[o+12],11,-421815835),n=Ya(n,s,i,r,t[o+15],16,530742520),r=Ya(r,n,s,i,t[o+2],23,-995338651),i=Xa(i,r,n,s,t[o],6,-198630844),s=Xa(s,i,r,n,t[o+7],10,1126891415),n=Xa(n,s,i,r,t[o+14],15,-1416354905),r=Xa(r,n,s,i,t[o+5],21,-57434055),i=Xa(i,r,n,s,t[o+12],6,1700485571),s=Xa(s,i,r,n,t[o+3],10,-1894986606),n=Xa(n,s,i,r,t[o+10],15,-1051523),r=Xa(r,n,s,i,t[o+1],21,-2054922799),i=Xa(i,r,n,s,t[o+8],6,1873313359),s=Xa(s,i,r,n,t[o+15],10,-30611744),n=Xa(n,s,i,r,t[o+6],15,-1560198380),r=Xa(r,n,s,i,t[o+13],21,1309151649),i=Xa(i,r,n,s,t[o+4],6,-145523070),s=Xa(s,i,r,n,t[o+11],10,-1120210379),n=Xa(n,s,i,r,t[o+2],15,718787259),r=Xa(r,n,s,i,t[o+9],21,-343485551),i=sv(i,a),r=sv(r,l),n=sv(n,c),s=sv(s,h)}return[i,r,n,s]}function RIe(t,e=wS.Hex){const i=e||wS.Base64,r=k3t(I3t(t),t.length*wE);switch(i){case wS.Raw:return r;case wS.Hex:return D3t(r);case wS.String:return L3t(r);case wS.Base64:return N3t(r)}}var _X;let NO=_X=class extends C8{writeLevels(t,e,i){for(const r in t){const n=this.levels[r];return void(e.stops=n)}}clone(){return new _X({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:tv(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:tv(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops?.map(t=>t.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions?.clone(),levels:Q(this.levels)})}};u([p()],NO.prototype,"levels",void 0),u([Be("levels")],NO.prototype,"writeLevels",null),NO=_X=u([M("esri.views.2d.engine.LevelDependentSizeVariable")],NO);const U3t=K.getLogger("esri.views.2d.layers.support.clusterUtils");ie.add("esri-cluster-arcade-enabled",!0);const z3t=ie("esri-cluster-arcade-enabled"),B3t=(t,e,i,r,n)=>{const s=e.clone();if(!H3t(s))return s;if(s.authoringInfo||(s.authoringInfo=new Ete),s.authoringInfo.isAutoGenerated=!0,"visualVariables"in s){const o=(s.visualVariables||[]).filter(l=>l.valueExpression!=="$view.scale"),a=V3t(o);o.forEach(l=>{l.type==="rotation"?l.field?l.field=rb(t,l.field,"avg_angle","number"):l.valueExpression&&(l.field=QA(t,l.valueExpression,"avg_angle","number"),l.valueExpression=null):l.normalizationField?(l.field=rb(t,l.field,"avg_norm","number",l.normalizationField),l.normalizationField=null):l.field?l.field=rb(t,l.field,"avg","number"):l.valueExpression&&(l.field=QA(t,l.valueExpression,"avg","number"),l.valueExpression=null)}),a==null&&!G3t(o)&&n&&(o.push(j3t(i,r)),s.dynamicClusterSize=!0),s.visualVariables=o}switch(s.type){case"simple":break;case"pie-chart":for(const o of s.attributes)o.field?o.field=rb(t,o.field,"sum","number"):o.valueExpression&&(o.field=QA(t,o.valueExpression,"sum","number"),o.valueExpression=null);break;case"unique-value":s.field?s.field=rb(t,s.field,"mode","string"):s.valueExpression&&(s.field=QA(t,s.valueExpression,"mode","string"),s.valueExpression=null);break;case"class-breaks":s.normalizationField?(s.field=rb(t,s.field,"avg_norm","number",s.normalizationField),s.normalizationField=null):s.field?s.field=rb(t,s.field,"avg","number"):s.valueExpression&&(s.field=QA(t,s.valueExpression,"avg","number"),s.valueExpression=null)}return s},V3t=t=>{for(const e of t)if(e.type==="size")return e;return null},G3t=t=>{for(const e of t)if(e.field==="cluster_count")return!0;return!1},j3t=(t,e)=>{const i=[new f2({value:0,size:0}),new f2({value:1})];if(e==null)return new C8({field:"cluster_count",stops:[...i,new f2({value:2,size:0})]});const r=Object.keys(e).reduce((n,s)=>({...n,[s]:[...i,new f2({value:Math.max(2,e[s].minValue),size:t.clusterMinSize}),new f2({value:Math.max(3,e[s].maxValue),size:t.clusterMaxSize})]}),{});return new NO({field:"cluster_count",levels:r})},H3t=t=>{const e=i=>U3t.error(new G("Unsupported-renderer",i,{renderer:t}));if(!t)return!1;switch(t.type){case"unique-value":if(t.field2||t.field3)return e("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1;break;case"class-breaks":if(t.normalizationField){const i=t.normalizationType;if(i!=="field")return e(`FeatureReductionCluster does not support a normalizationType of ${i}`),!1}break;case"simple":case"pie-chart":break;default:return e(`FeatureReductionCluster does not support renderers of type ${t.type}`),!1}if(!z3t){if("valueExpression"in t&&t.valueExpression)return e("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in t&&t.visualVariables||[]).some(i=>!(!("valueExpression"in i)||!i.valueExpression)))return e("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function q3t(t,e,i){switch(t){case"sum":return`cluster_sum_${e}`;case"avg":case"avg_angle":return`cluster_avg_${e}`;case"mode":return`cluster_type_${e}`;case"avg_norm":{const r=i,n="field",s=e.toLowerCase()+",norm:"+n+","+r.toLowerCase();return"cluster_avg_"+RIe(s)}}}function QA(t,e,i,r){const n=RIe(e),s=i==="mode"?`cluster_type_${n}`:i==="sum"?`cluster_sum_${n}`:`cluster_avg_${n}`;return t.some(o=>o.name===s)||t.push(new Fx({name:s,isAutoGenerated:!0,onStatisticExpression:new Rte({expression:e,returnType:r}),statisticType:i})),s}function rb(t,e,i,r,n){if(e==="cluster_count"||t.some(o=>o.name===e))return e;const s=q3t(i,e,n);return t.some(o=>o.name===s)||(i==="avg_norm"?t.push(new Fx({name:s,isAutoGenerated:!0,onStatisticExpression:new Rte({expression:`$feature.${e} / $feature.${n}`,returnType:r}),statisticType:"avg"})):t.push(new Fx({name:s,isAutoGenerated:!0,onStatisticField:e,statisticType:i}))),s}const W3t=t=>{let e=class extends t{constructor(...i){super(...i),this.addHandles(ne(()=>this.renderer,()=>{if(this.featureReduction){const r=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",r)}},Zi))}set featureReduction(i){const r=this._normalizeFeatureReduction(i);this._set("featureReduction",r)}set renderer(i){}_normalizeFeatureReduction(i){if(i?.type!=="cluster")return i;const r=i.clone(),n=[new Fx({name:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],s=(r.fields??[]).filter(a=>!a.isAutoGenerated);if(i.renderer&&!i.renderer.authoringInfo?.isAutoGenerated)return r.fields=[...n,...s],r;if(i.symbol)return r.fields=[...n,...s],r.renderer=null,r;if(!this.renderer)return i;const o=B3t(n,this.renderer,i,null,!1);return r.fields=[...n,...s],r.renderer=o,r}};return u([p($3t)],e.prototype,"featureReduction",null),e=u([M("esri.layers.mixins.FeatureReductionLayer")],e),e},rme={ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CSV:!0,GeoRSS:!0,GeoJSON:!0,GroupLayer:!0,KML:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},nme={ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},sme={ArcGISFeatureLayer:!0},Y3t={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,GeoJSON:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,KML:!0,RasterDataLayer:!0,Voxel:!0,LineOfSightLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-scene/tables":{ArcGISFeatureLayer:!0},"web-map/operational-layers":rme,"web-map/basemap":nme,"web-map/tables":sme,"link-chart/operational-layers":{...rme,LinkChartLayer:!0},"link-chart/basemap":nme,"link-chart/tables":sme,"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISImageServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0}},X3t=t=>{let e=class extends t{constructor(){super(...arguments),this.persistenceEnabled=!0,this.title=null}readId(i,r,n){return n?.portalItem?.type==="Group Layer"?void 0:i}writeListMode(i,r,n,s){(s&&s.layerContainerType==="ground"||i&&QDe(this,n,{},s))&&(r[n]=i)}writeOperationalLayerType(i,r,n,s){i&&s?.layerContainerType!=="tables"&&(r.layerType=i)}writeTitle(i,r){r.title=i??"Layer"}read(i,r){r&&(r.layer=this),Pge(this,i,n=>super.read(i,n),r)}write(i,r){if(!this.persistenceEnabled)return null;if(r?.origin){const o=`${r.origin}/${r.layerContainerType||"operational-layers"}`;let l=!!Y3t[o]?.[this.operationalLayerType];if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&o==="web-scene/operational-layers"&&(l=!1),this.operationalLayerType==="ArcGISDimensionLayer"&&o==="web-map/operational-layers"&&(l=!1),!l)return r.messages?.push(new G("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${o}'`,{layer:this})),null}const n=super.write(i,{...r,layer:this}),s=!!r&&!!r.messages&&!!r.messages.filter(o=>o instanceof G&&o.name==="web-document-write:property-required").length;return SE(n?.url)?(r?.messages?.push(new G("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&s?null:n}beforeSave(){}};return u([p({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],e.prototype,"id",void 0),u([wt("id",["id"])],e.prototype,"readId",null),u([p(p3t)],e.prototype,"listMode",void 0),u([Be("listMode")],e.prototype,"writeListMode",null),u([p({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1},"web-scene":{name:"layerType",read:!1,write:{enabled:!0,ignoreOrigin:!0,layerContainerTypes:ih}}}}})],e.prototype,"operationalLayerType",void 0),u([Be("operationalLayerType")],e.prototype,"writeOperationalLayerType",null),u([p(uX)],e.prototype,"opacity",void 0),u([p({type:Boolean,readOnly:!1})],e.prototype,"persistenceEnabled",void 0),u([p({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],e.prototype,"title",void 0),u([Be("title"),Be(["web-scene"],"title")],e.prototype,"writeTitle",null),u([p({type:Boolean,json:{origins:{"web-scene":{name:"visibility",write:{enabled:!0,layerContainerTypes:ih}}},name:"visibility",write:!0}})],e.prototype,"visible",void 0),e=u([M("esri.layers.mixins.OperationalLayer")],e),e},Z3t=t=>{let e=class extends t{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=$e(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(i){i!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",i))}readPortalItem(i,r,n){if(r.itemId)return new kw({id:r.itemId,portal:n?.portal})}writePortalItem(i,r){i?.id&&(r.itemId=i.id)}async loadFromPortal(i,r){if(this.portalItem?.id)try{const{load:n}=await ce(()=>import("./layersLoader-5ccdc111.js"),["./layersLoader-5ccdc111.js","./fetchService-6e256c6d.js","./requestPresets-07a176e4.js","./portalLayers-7401a143.js","./associatedFeatureServiceUtils-aa9f1206.js","./layersCreator-96ef29cd.js","./jsonContext-663a523d.js"],import.meta.url);return Tt(r),await n({instance:this,supportedTypes:i.supportedTypes,validateItem:i.validateItem,supportsData:i.supportsData,layerModuleTypeMap:i.layerModuleTypeMap},r)}catch(n){throw Tn(n)||K.getLogger(this).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${n}`),n}}async finishLoadEditablePortalLayer(i){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(i).catch(r=>(Gl(r),!0)))}async setUserPrivileges(i,r){if(!Di.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(r);if(this.url)try{const{features:{edit:n,fullEdit:s},content:{updateItem:o}}=await this._fetchUserPrivileges(i,r);this._set("userHasEditingPrivileges",n),this._set("userHasFullEditingPrivileges",s),this._set("userHasUpdateItemPrivileges",o)}catch(n){Gl(n)}}async _fetchUserPrivileges(i,r){let n=this.portalItem;if(!i||!n||!n.loaded||n.sourceUrl)return this._fetchFallbackUserPrivileges(r);const s=i===n.id;if(s&&n.portal.user)return lre(n);let o,a;if(s)o=n.portal.url;else try{o=await Tye(this.url,r)}catch(d){Gl(d)}if(!o||!gNe(o,n.portal.url))return this._fetchFallbackUserPrivileges(r);try{const d=r!=null?r.signal:null;a=await Wt?.getCredential(`${o}/sharing`,{prompt:!1,signal:d})}catch(d){Gl(d)}const l=!0,c=!1,h=!1;if(!a)return{features:{edit:l,fullEdit:c},content:{updateItem:h}};try{if(s?await n.reload():(n=new kw({id:i,portal:{url:o}}),await n.load(r)),n.portal.user)return lre(n)}catch(d){Gl(d)}return{features:{edit:l,fullEdit:c},content:{updateItem:h}}}async _fetchFallbackUserPrivileges(i){let r=!0;try{r=await this._fetchUserHasEditingPrivileges(i)}catch(n){Gl(n)}return{features:{edit:r,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(i){const r=this.url?Wt?.findCredential(this.url):null;if(!r)return!0;const n=FD.credential===r?FD.user:await this._fetchEditingUser(i);return FD.credential=r,FD.user=n,n?.privileges==null||n.privileges.includes("features:user:edit")}async _fetchEditingUser(i){const r=this.portalItem?.portal?.user;if(r)return r;const n=Wt.findServerInfo(this.url??"");if(!n?.owningSystemUrl)return null;const s=`${n.owningSystemUrl}/sharing/rest`,o=Ds.getDefault();if(o&&o.loaded&&Bu(o.restUrl)===Bu(s))return o.user;const a=`${s}/community/self`,l=i!=null?i.signal:null,c=await jc(_i(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?dZ.fromJSON(c.value.data):null}read(i,r){r&&(r.layer=this),super.read(i,r)}write(i,r){const n=r?.portal,s=this.portalItem?.id&&(this.portalItem.portal||Ds.getDefault());return n&&s&&!kge(s.restUrl,n.restUrl)?(r.messages&&r.messages.push(new G("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(i,{...r,layer:this})}};return u([p({type:kw})],e.prototype,"portalItem",null),u([wt("web-document","portalItem",["itemId"])],e.prototype,"readPortalItem",null),u([Be("web-document","portalItem",{itemId:{type:String}})],e.prototype,"writePortalItem",null),u([p({clonable:!1})],e.prototype,"resourceReferences",void 0),u([p({type:Boolean,readOnly:!0})],e.prototype,"userHasEditingPrivileges",void 0),u([p({type:Boolean,readOnly:!0})],e.prototype,"userHasFullEditingPrivileges",void 0),u([p({type:Boolean,readOnly:!0})],e.prototype,"userHasUpdateItemPrivileges",void 0),e=u([M("esri.layers.mixins.PortalLayer")],e),e},FD={credential:null,user:null},J3t=t=>{let e=class extends t{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const i={minScale:this.minScale,maxScale:this.maxScale},r=this.parent;r&&"effectiveScaleRange"in r&&K3t(i,r.effectiveScaleRange);const n=this._get("effectiveScaleRange");return n&&n.minScale===i.minScale&&n.maxScale===i.maxScale?n:i}};return u([p({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"minScale",void 0),u([p({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"maxScale",void 0),u([p({readOnly:!0})],e.prototype,"effectiveScaleRange",null),e=u([M("esri.layers.mixins.ScaleRangeLayer")],e),e};function K3t(t,e){return t.minScale=t.minScale>0?e.minScale>0?Math.min(t.minScale,e.minScale):t.minScale:e.minScale,t.maxScale=t.maxScale>0?e.maxScale>0?Math.max(t.maxScale,e.maxScale):t.maxScale:e.maxScale,t}const PIe=yl()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});let FO=class extends es(pe){constructor(e){super(e),this.unit="milliseconds",this.value=0}toMilliseconds(){return Qqe(this.value,this.unit,"milliseconds")}};u([nt(PIe,{nonNullable:!0})],FO.prototype,"unit",void 0),u([p({type:Number,json:{write:!0},nonNullable:!0})],FO.prototype,"value",void 0),FO=u([M("esri.TimeInterval")],FO);const Xk=FO;function ome(t,e){return Xk.fromJSON({value:t,unit:e})}let tl=class extends es(pe){constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeZone=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,i){if(!i.timeExtent||!Array.isArray(i.timeExtent)||i.timeExtent.length!==2)return null;const r=new Date(i.timeExtent[0]),n=new Date(i.timeExtent[1]);return new Gy({start:r,end:n})}writeFullTimeExtent(e,i){e?.start!=null&&e.end!=null?i.timeExtent=[e.start.getTime(),e.end.getTime()]:i.timeExtent=null}readInterval(e,i){return i.timeInterval&&i.timeIntervalUnits?ome(i.timeInterval,i.timeIntervalUnits):i.defaultTimeInterval&&i.defaultTimeIntervalUnits?ome(i.defaultTimeInterval,i.defaultTimeIntervalUnits):null}writeInterval(e,i){i.timeInterval=e?.toJSON().value??null,i.timeIntervalUnits=e?.toJSON().unit??null}};u([p({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],tl.prototype,"cumulative",void 0),u([p({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],tl.prototype,"endField",void 0),u([p({type:Gy,json:{write:{enabled:!0,allowNull:!0}}})],tl.prototype,"fullTimeExtent",void 0),u([wt("fullTimeExtent",["timeExtent"])],tl.prototype,"readFullTimeExtent",null),u([Be("fullTimeExtent")],tl.prototype,"writeFullTimeExtent",null),u([p({type:Boolean,json:{write:!0}})],tl.prototype,"hasLiveData",void 0),u([p({type:Xk,json:{write:{enabled:!0,allowNull:!0}}})],tl.prototype,"interval",void 0),u([wt("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],tl.prototype,"readInterval",null),u([Be("interval")],tl.prototype,"writeInterval",null),u([p({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],tl.prototype,"startField",void 0),u([p(Qze("timeReference",!0))],tl.prototype,"timeZone",void 0),u([p({type:String,json:{write:{enabled:!0,allowNull:!0}}})],tl.prototype,"trackIdField",void 0),u([p({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],tl.prototype,"useTime",void 0),tl=u([M("esri.layers.support.TimeInfo")],tl);const Q3t=tl,eOt=t=>{let e=class extends t{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(i,r){const n=r.timeInfo.exportOptions;if(!n)return null;const s=n.timeOffset,o=PIe.fromJSON(n.timeOffsetUnits);return s&&o?new Xk({value:s,unit:o}):null}set timeInfo(i){Yve(i,this.fieldsIndex),this._set("timeInfo",i)}};return u([p({type:Gy,json:{write:!1}})],e.prototype,"timeExtent",void 0),u([p({type:Xk})],e.prototype,"timeOffset",void 0),u([wt("service","timeOffset",["timeInfo.exportOptions"])],e.prototype,"readOffset",null),u([p({value:null,type:Q3t,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.prototype,"timeInfo",null),u([p({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],e.prototype,"useViewTime",void 0),e=u([M("esri.layers.mixins.TemporalLayer")],e),e};function tOt(){return{fields:{type:[QU],value:null,set:function(t){if(t&&ie("big-integer-warning-enabled")){const e=t.filter(i=>i.type==="big-integer"||i.type==="oid"&&(i.length||0)>=8);if(e.length){const i=e.map(r=>`'${r.name}'`).join(", ");K.getLogger(this).warn("#fields",`Layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}') references big-integer field(s): ${i}, support for which is experimental. Only integers less than ${Number.MAX_SAFE_INTEGER} (Number.MAX_SAFE_INTEGER) are supported.`)}}this._set("fields",t)}},fieldsIndex:{readOnly:!0,get(){return uIe.fromLayer(this)}},outFields:{type:[String],json:{read:!1},set:function(t){this._userOutFields=t,this.notifyChange("outFields")},get:function(){const t=this._userOutFields;if(!t?.length)return null;if(t.includes("*"))return["*"];if(!this.fields)return t;for(const e of t)this.fieldsIndex?.has(e)||K.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${e} found in outFields`,{layer:this,outFields:t});return cJ(this.fieldsIndex,t)}}}}const YV=K.getLogger("esri.layers.support.labelingInfo"),iOt=/\[([^\[\]]+)\]/gi;function rOt(t,e,i){return t?t.map(r=>{const n=new qC;if(n.read(r,i),n.labelExpression){const s=e.fields||e.layerDefinition?.fields||this.fields;n.labelExpression=n.labelExpression.replaceAll(iOt,(o,a)=>`[${nOt(a,s)}]`)}return n}):null}function nOt(t,e){if(!e)return t;const i=t.toLowerCase();for(let r=0;r<e.length;r++){const n=e[r].name;if(n.toLowerCase()===i)return n}return t}const sOt={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null};function Yjt(t,e){const i=Q(t);return i.some(r=>oOt(r,e))?[]:i}function oOt(t,e){const i=t.labelPlacement,r=sOt[e];if(!t.symbol)return YV.warn("No ILabelClass symbol specified."),!0;if(!r)return YV.error(new G("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${e}' is not supported`)),!0;if(!r.includes(i)){const n=r[0];i&&YV.warn(`Found invalid label placement type ${i} for ${e}. Defaulting to ${n}`),t.labelPlacement=n}return!1}var vX;let sw=vX=class extends pe{constructor(){super(...arguments),this.age=null,this.ageReceived=null,this.displayCount=null,this.maxObservations=1}clone(){return new vX({age:this.age,ageReceived:this.ageReceived,displayCount:this.displayCount,maxObservations:this.maxObservations})}};u([p({type:Number,json:{write:!0}})],sw.prototype,"age",void 0),u([p({type:Number,json:{write:!0}})],sw.prototype,"ageReceived",void 0),u([p({type:Number,json:{write:!0}})],sw.prototype,"displayCount",void 0),u([p({type:Number,json:{write:!0}})],sw.prototype,"maxObservations",void 0),sw=vX=u([M("esri.layers.support.PurgeOptions")],sw);const MIe=sw;async function aOt(t,e,i){const r=t&&t.getAtOrigin&&t.getAtOrigin("renderer",e.origin);if(r&&r.type==="unique-value"&&r.styleOrigin){const n=await jc(r.populateFromStyle());if(Tt(i),n.ok===!1){const s=n.error;e?.messages&&e.messages.push(new Sm("renderer:style-reference",`Failed to create unique value renderer from style reference: ${s.message}`,{error:s,context:e})),t.clear("renderer",e?.origin)}}}function lOt({displayField:t,editFieldsInfo:e,fields:i,objectIdField:r,title:n},s){if(!i)return null;const o=dOt({editFieldsInfo:e,fields:i,objectIdField:r},s);if(!o.length)return null;const a=mOt({titleBase:n,fields:i,displayField:t}),l=fOt();return new AM({title:a,content:l,fieldInfos:o})}const cOt=(t,e)=>e.visibleFieldNames?e.visibleFieldNames.has(t.name):j9e(t,e);function uOt(t,e){const i=t;return e&&(t=t.filter(r=>!e.includes(r.type))),t===i&&(t=t.slice()),t.sort(hOt),t}function hOt(t,e){return t.type==="oid"?-1:e.type==="oid"?1:ame(t)?-1:ame(e)?1:(t.alias||t.name).toLocaleLowerCase().localeCompare((e.alias||e.name).toLocaleLowerCase())}function dOt(t,e){const i=e?.visibleFieldNames;return uOt(t.fields??[],e?.ignoreFieldTypes||gOt).map(r=>new dJ({fieldName:r.name,isEditable:G9e(r,t),label:r.alias,format:pOt(r),visible:cOt(r,{...t,visibleFieldNames:i})}))}function pOt(t){switch(t.type){case"small-integer":case"integer":case"single":return new gN({digitSeparator:!0,places:0});case"double":return new gN({digitSeparator:!0,places:2});case"string":return fBe(t.name)?new gN({digitSeparator:!0,places:0}):null;default:return null}}function fOt(){return[new dP,new hP]}function mOt(t){const e=I9e(t),{titleBase:i}=t;return e?`${i}: {${e.trim()}}`:i??""}function ame(t){return(t.name&&t.name.toLowerCase())==="name"?!0:(t.alias&&t.alias.toLowerCase())==="name"}const gOt=["geometry","blob","raster","guid","xml"],lme=tOt();function cme(t,e){return new G("layer:unsupported",`Layer (${t.title}, ${t.id}) of type '${t.declaredClass}' ${e}`,{layer:t})}let ji=class extends W3t(s3t(YAt(eOt(J3t(syt(WAt(X3t(Z3t(kZ(XAt(es(DZ)))))))))))){constructor(...t){super(...t),this.copyright=null,this.definitionExpression=null,this.displayField=null,this.elevationInfo=null,this.fields=null,this.fieldsIndex=null,this.geometryDefinition=null,this.geometryType=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.maxReconnectionAttempts=0,this.maxReconnectionInterval=20,this.maxScale=0,this.minScale=0,this.objectIdField=null,this.operationalLayerType="ArcGISStreamLayer",this.outFields=["*"],this.popupEnabled=!0,this.popupTemplate=null,this.purgeOptions=new MIe,this.refreshInterval=0,this.screenSizePerspectiveEnabled=!0,this.sourceJSON=null,this.spatialReference=ze.WGS84,this.type="stream",this.url=null,this.updateInterval=300,this.useViewTime=!0,this.webSocketUrl=null,this._debouncedSaveOperations=aM(async(e,i,r)=>{const{save:n,saveAs:s}=await ce(()=>import("./streamLayerUtils-0cd72517.js"),["./streamLayerUtils-0cd72517.js","./utils-c17e3eca.js","./jsonContext-663a523d.js"],import.meta.url);switch(e){case nm.SAVE:return n(this,i);case nm.SAVE_AS:return s(this,r,i)}})}normalizeCtorArgs(t,e){return typeof t=="string"?{url:t,...e}:t}load(t){if(!("WebSocket"in globalThis))return this.addResolvingPromise(Promise.reject(new G("stream-layer:websocket-unsupported","WebSocket is not supported in this browser. StreamLayer will not have real-time connection with the stream service."))),Promise.resolve(this);const e=t!=null?t.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Stream Service","Feed"]},t).catch(Gl).then(()=>this._fetchService(e))),Promise.resolve(this)}get defaultPopupTemplate(){return this.createPopupTemplate()}set featureReduction(t){const e=this._normalizeFeatureReduction(t);this._set("featureReduction",e)}set renderer(t){rne(t,this.fieldsIndex),this._set("renderer",t)}readRenderer(t,e,i){e=e.layerDefinition||e;const r=e.drawingInfo?.renderer;if(r){const n=eM(r,e,i)||void 0;return n||K.getLogger(this).error("Failed to create renderer",{rendererDefinition:e.drawingInfo.renderer,layer:this,context:i}),n}return Lte(e,i)}async connect(t){const[{createConnection:e}]=await Promise.all([ce(()=>import("./createConnection-efa0dc21.js"),["./createConnection-efa0dc21.js","./query-329b2ac1.js","./pbfQueryUtils-2cf66e2d.js","./pbf-b60d46d3.js","./queryZScale-47976d5a.js"],import.meta.url),this.load()]),i=this.geometryType?nP.toJSON(this.geometryType):null,{customParameters:r=null,definitionExpression:n=null,geometryDefinition:s=null,maxReconnectionAttempts:o=0,maxReconnectionInterval:a=20,spatialReference:l=this.spatialReference}=t||this.createConnectionParameters(),c=e(this.parsedUrl,this.spatialReference,l,i,{geometry:s,where:n},o,a,r??void 0),h=yv([this.on("send-message-to-socket",d=>c.sendMessageToSocket(d)),this.on("send-message-to-client",d=>c.sendMessageToClient(d))]);return c.once("destroy",h.remove),c}createConnectionParameters(){return{spatialReference:this.spatialReference,customParameters:this.customParameters,definitionExpression:this.definitionExpression,geometryDefinition:this.geometryDefinition,maxReconnectionAttempts:this.maxReconnectionAttempts,maxReconnectionInterval:this.maxReconnectionInterval}}createPopupTemplate(t){return lOt(this,t)}createQuery(){const t=new sT;return t.returnGeometry=!0,t.outFields=["*"],t.where=this.definitionExpression||"1=1",t}getFieldDomain(t,e){if(!this.fields)return null;let i=null;return this.fields.some(r=>(r.name===t&&(i=r.domain),!!i)),i}getField(t){return this.fieldsIndex.get(t)}serviceSupportsSpatialReference(t){return!0}sendMessageToSocket(t){this.emit("send-message-to-socket",t)}sendMessageToClient(t){this.emit("send-message-to-client",t)}async save(t){return this._debouncedSaveOperations(nm.SAVE,t)}async saveAs(t,e){return this._debouncedSaveOperations(nm.SAVE_AS,e,t)}write(t,e){const i=e?.messages;return this.webSocketUrl?(i?.push(cme(this,"using a custom websocket connection cannot be written to web scenes and web maps")),null):this.parsedUrl?super.write(t,e):(i?.push(cme(this,"using a client-side only connection without a url cannot be written to web scenes and web maps")),null)}async _fetchService(t){if(!this.webSocketUrl&&this.parsedUrl){if(!this.sourceJSON){const{data:e}=await _i(this.parsedUrl.path,{query:{f:"json",...this.customParameters,...this.parsedUrl.query},responseType:"json",signal:t});this.sourceJSON=e}}else{if(!this.timeInfo?.trackIdField)throw new G("stream-layer:missing-metadata","The stream layer trackIdField must be specified.");if(!this.objectIdField){const e=this.fields.find(i=>i.type==="oid")?.name;if(!e)throw new G("stream-layer:missing-metadata","The stream layer objectIdField must be specified.");this.objectIdField=e}if(!this.fields)throw new G("stream-layer:missing-metadata","The stream layer fields must be specified.");if(this.fields.some(e=>e.name===this.objectIdField)||this.fields.push(new QU({name:this.objectIdField,alias:this.objectIdField,type:"oid"})),!this.geometryType)throw new G("stream-layer:missing-metadata","The stream layer geometryType must be specified.");this.webSocketUrl&&(this.url=this.webSocketUrl)}return this.read(this.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:this.portalItem?.portal,url:this.parsedUrl}),rne(this.renderer,this.fieldsIndex),Yve(this.timeInfo,this.fieldsIndex),this.objectIdField||(this.objectIdField="__esri_stream_id__"),aOt(this,{origin:"service"})}};u([p({type:String})],ji.prototype,"copyright",void 0),u([p({readOnly:!0})],ji.prototype,"defaultPopupTemplate",null),u([p({type:String,json:{name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],ji.prototype,"definitionExpression",void 0),u([p({type:String})],ji.prototype,"displayField",void 0),u([p({type:vIe})],ji.prototype,"elevationInfo",void 0),u([p({json:{origins:{"web-map":{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-scene":{read:!1,write:!1}}}})],ji.prototype,"featureReduction",null),u([p(lme.fields)],ji.prototype,"fields",void 0),u([p(lme.fieldsIndex)],ji.prototype,"fieldsIndex",void 0),u([p({type:zi,json:{name:"layerDefinition.definitionGeometry",write:!0}})],ji.prototype,"geometryDefinition",void 0),u([p({type:nP.apiValues,json:{read:{reader:nP.read}}})],ji.prototype,"geometryType",void 0),u([p(Mte)],ji.prototype,"labelsVisible",void 0),u([p({type:[qC],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:rOt},write:!0}})],ji.prototype,"labelingInfo",void 0),u([p(u3t)],ji.prototype,"legendEnabled",void 0),u([p({type:["show","hide"],json:{origins:{"portal-item":{read:!1,write:!1}}}})],ji.prototype,"listMode",void 0),u([p({type:dr})],ji.prototype,"maxReconnectionAttempts",void 0),u([p({type:dr})],ji.prototype,"maxReconnectionInterval",void 0),u([p(d3t)],ji.prototype,"maxScale",void 0),u([p(h3t)],ji.prototype,"minScale",void 0),u([p({type:String})],ji.prototype,"objectIdField",void 0),u([p({value:"ArcGISStreamLayer",type:["ArcGISStreamLayer"]})],ji.prototype,"operationalLayerType",void 0),u([p({readOnly:!0})],ji.prototype,"outFields",void 0),u([p(Pte)],ji.prototype,"popupEnabled",void 0),u([p({type:AM,json:{name:"popupInfo",write:!0}})],ji.prototype,"popupTemplate",void 0),u([p({type:MIe})],ji.prototype,"purgeOptions",void 0),u([p({json:{read:!1,write:!1}})],ji.prototype,"refreshInterval",void 0),u([p({types:R8,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{name:"layerDefinition.drawingInfo.renderer",types:BAt,write:!0}},write:{target:"layerDefinition.drawingInfo.renderer"}}})],ji.prototype,"renderer",null),u([wt("service","renderer",["drawingInfo.renderer","defaultSymbol"]),wt("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],ji.prototype,"readRenderer",null),u([p((()=>{const t=Q(l3t);return t.json.origins["portal-item"]={read:!1,write:!1},t})())],ji.prototype,"screenSizePerspectiveEnabled",void 0),u([p()],ji.prototype,"sourceJSON",void 0),u([p({type:ze,json:{origins:{service:{read:{source:"spatialReference"}}}}})],ji.prototype,"spatialReference",void 0),u([p({json:{read:!1}})],ji.prototype,"type",void 0),u([p(c3t)],ji.prototype,"url",void 0),u([p({type:Number})],ji.prototype,"updateInterval",void 0),u([p({json:{read:!1,write:!1}})],ji.prototype,"useViewTime",void 0),u([p({type:String})],ji.prototype,"webSocketUrl",void 0),ji=u([M("esri.layers.StreamLayer")],ji);const Dte=ji,Xjt=Object.freeze(Object.defineProperty({__proto__:null,default:Dte},Symbol.toStringTag,{value:"Module"})),yOt=t=>{switch(t){case"ev":return"https://static.arcgis.com/arcgis/styleItems/Icons/web/resource/Fuel.svg";case"parking":return"https://static.arcgis.com/arcgis/styleItems/Icons/web/resource/Parking.svg"}},Nw=(t,e)=>new ry({verticalOffset:{screenLength:t==="parking"?30:60,maxWorldLength:500,minWorldLength:20},callout:new PM({size:1.2,color:e}),symbolLayers:[new sm({anchor:"center",resource:{primitive:"circle"},size:15*1.4,material:{color:"white"},outline:{color:e,size:1}}),new sm({material:{color:e},resource:{href:yOt(t)},size:15})]}),e3=new Dte({url:"https://us-iot.arcgis.com/bc1qjuyagnrebxvh/bc1qjuyagnrebxvh/streams/arcgis/rest/services/Zurich__ev_stations_live1/StreamServer",renderer:new w$({valueExpression:"$feature.EvseStatus",defaultSymbol:Nw("ev",new Pe("#BFBFBF")),uniqueValueInfos:[{value:"Occupied",symbol:Nw("ev",new Pe("#D90012"))},{value:"Available",symbol:Nw("ev",new Pe("#00A0FF"))}]}),labelingInfo:[new qC({labelExpressionInfo:{expression:"'EV Charger ' + $feature.EvseStatus"},symbol:new PC({symbolLayers:[new Uy({material:{color:"white"},halo:{color:[80,80,80],size:1},size:8})],callout:new PM({type:"line",size:1.5,color:[200,200,200]}),verticalOffset:{screenLength:25,maxWorldLength:15e4,minWorldLength:20}}),labelPlacement:"above-center",maxScale:0,minScale:0})]}),kD=new Dte({url:"https://us-iot.arcgis.com/bc1qjuyagnrebxvh/bc1qjuyagnrebxvh/streams/arcgis/rest/services/Zurich__parking_live/StreamServer",labelingInfo:[new qC({labelExpressionInfo:{expression:"$feature.available + ' / ' + $feature.anzahl_oef"},symbol:new PC({symbolLayers:[new Uy({material:{color:"white"},halo:{color:[80,80,80],size:1},size:8})],callout:new PM({type:"line",size:1.5,color:[200,200,200]}),verticalOffset:{screenLength:25,maxWorldLength:15e4,minWorldLength:20}}),labelPlacement:"above-center",maxScale:0,minScale:0})],renderer:new w$({valueExpression:"When($feature.available < 5, 'low', $feature.available < 10, 'medium', 'high')",defaultSymbol:Nw("parking",new Pe([50,50,50])),uniqueValueInfos:[{value:"low",symbol:Nw("parking",new Pe("#D90012"))},{value:"medium",symbol:Nw("parking",new Pe("#FFC900"))},{value:"high",symbol:Nw("parking",new Pe("#36DA43"))}]})});function ume(t){return new Promise(e=>{setTimeout(e,t)})}const UD="esri-identity-form",cu={base:UD,group:`${UD}__group`,label:`${UD}__label`,footer:`${UD}__footer`,esriInput:"esri-input",esriButton:"esri-button",esriButtonSecondary:"esri-button--secondary"},_Ot="ArcGIS Online";let zg=class extends Yp{constructor(e,i){super(e,i),this._usernameInputNode=null,this._passwordInputNode=null,this.signingIn=!1,this.server=null,this.resource=null,this.error=null,this.oAuthPrompt=!1}render(){const{error:e,server:i,resource:r,signingIn:n,oAuthPrompt:s,messages:o}=this,a=Ce("div",{class:cu.group},u9e(s?o.oAuthInfo:o.info,{server:i&&/\.arcgis\.com/i.test(i)?_Ot:i,resource:`(${r||o.lblItem})`})),l=s?null:Ce("div",{class:cu.group,key:"username"},Ce("label",{class:cu.label},o.lblUser,Ce("input",{afterCreate:kne,autocomplete:"off",bind:this,class:cu.esriInput,"data-node-ref":"_usernameInputNode",required:!0,spellcheck:!1,type:"text",value:""}))),c=s?null:Ce("div",{class:cu.group,key:"password"},Ce("label",{class:cu.label},o.lblPwd,Ce("input",{afterCreate:kne,bind:this,class:cu.esriInput,"data-node-ref":"_passwordInputNode",required:!0,type:"password",value:""}))),h=Ce("div",{class:this.classes(cu.group,cu.footer)},Ce("input",{class:cu.esriButton,disabled:!!n,type:"submit",value:n?o.lblSigning:o.lblOk}),Ce("input",{bind:this,class:this.classes(cu.esriButton,cu.esriButtonSecondary),onclick:this._cancel,type:"button",value:o.lblCancel})),d=e?Ce("div",null,e.details?.httpStatus?o.invalidUser:o.noAuthService):null;return Ce("form",{bind:this,class:cu.base,onsubmit:this._submit},a,d,l,c,h)}_cancel(){this._set("signingIn",!1),this._usernameInputNode&&(this._usernameInputNode.value=""),this._passwordInputNode&&(this._passwordInputNode.value=""),this.emit("cancel")}_submit(e){e.preventDefault(),this._set("signingIn",!0);const i=this.oAuthPrompt?{}:{username:this._usernameInputNode&&this._usernameInputNode.value,password:this._passwordInputNode&&this._passwordInputNode.value};this.emit("submit",i)}};u([p(),Lm("esri/identity/t9n/identity")],zg.prototype,"messages",void 0),u([p()],zg.prototype,"signingIn",void 0),u([p()],zg.prototype,"server",void 0),u([p()],zg.prototype,"resource",void 0),u([p()],zg.prototype,"error",void 0),u([p()],zg.prototype,"oAuthPrompt",void 0),zg=u([M("esri.identity.IdentityForm")],zg);const vOt=zg;/*!
* tabbable 6.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var $Ie=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],Zk=$Ie.join(","),IIe=typeof Element>"u",kx=IIe?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,Jk=!IIe&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t?.ownerDocument},Kk=function t(e,i){var r;i===void 0&&(i=!0);var n=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"inert"),s=n===""||n==="true",o=s||i&&e&&t(e.parentNode);return o},bOt=function(e){var i,r=e==null||(i=e.getAttribute)===null||i===void 0?void 0:i.call(e,"contenteditable");return r===""||r==="true"},LIe=function(e,i,r){if(Kk(e))return[];var n=Array.prototype.slice.apply(e.querySelectorAll(Zk));return i&&kx.call(e,Zk)&&n.unshift(e),n=n.filter(r),n},DIe=function t(e,i,r){for(var n=[],s=Array.from(e);s.length;){var o=s.shift();if(!Kk(o,!1))if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,c=t(l,!0,r);r.flatten?n.push.apply(n,c):n.push({scopeParent:o,candidates:c})}else{var h=kx.call(o,Zk);h&&r.filter(o)&&(i||!e.includes(o))&&n.push(o);var d=o.shadowRoot||typeof r.getShadowRoot=="function"&&r.getShadowRoot(o),f=!Kk(d,!1)&&(!r.shadowRootFilter||r.shadowRootFilter(o));if(d&&f){var m=t(d===!0?o.children:d.children,!0,r);r.flatten?n.push.apply(n,m):n.push({scopeParent:o,candidates:m})}else s.unshift.apply(s,o.children)}}return n},NIe=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},Tw=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||bOt(e))&&!NIe(e)?0:e.tabIndex},wOt=function(e,i){var r=Tw(e);return r<0&&i&&!NIe(e)?0:r},xOt=function(e,i){return e.tabIndex===i.tabIndex?e.documentOrder-i.documentOrder:e.tabIndex-i.tabIndex},FIe=function(e){return e.tagName==="INPUT"},TOt=function(e){return FIe(e)&&e.type==="hidden"},SOt=function(e){var i=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(r){return r.tagName==="SUMMARY"});return i},EOt=function(e,i){for(var r=0;r<e.length;r++)if(e[r].checked&&e[r].form===i)return e[r]},COt=function(e){if(!e.name)return!0;var i=e.form||Jk(e),r=function(a){return i.querySelectorAll('input[type="radio"][name="'+a+'"]')},n;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")n=r(window.CSS.escape(e.name));else try{n=r(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var s=EOt(n,e.form);return!s||s===e},AOt=function(e){return FIe(e)&&e.type==="radio"},OOt=function(e){return AOt(e)&&!COt(e)},ROt=function(e){var i,r=e&&Jk(e),n=(i=r)===null||i===void 0?void 0:i.host,s=!1;if(r&&r!==e){var o,a,l;for(s=!!((o=n)!==null&&o!==void 0&&(a=o.ownerDocument)!==null&&a!==void 0&&a.contains(n)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!s&&n;){var c,h,d;r=Jk(n),n=(c=r)===null||c===void 0?void 0:c.host,s=!!((h=n)!==null&&h!==void 0&&(d=h.ownerDocument)!==null&&d!==void 0&&d.contains(n))}}return s},hme=function(e){var i=e.getBoundingClientRect(),r=i.width,n=i.height;return r===0&&n===0},POt=function(e,i){var r=i.displayCheck,n=i.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var s=kx.call(e,"details>summary:first-of-type"),o=s?e.parentElement:e;if(kx.call(o,"details:not([open]) *"))return!0;if(!r||r==="full"||r==="legacy-full"){if(typeof n=="function"){for(var a=e;e;){var l=e.parentElement,c=Jk(e);if(l&&!l.shadowRoot&&n(l)===!0)return hme(e);e.assignedSlot?e=e.assignedSlot:!l&&c!==e.ownerDocument?e=c.host:e=l}e=a}if(ROt(e))return!e.getClientRects().length;if(r!=="legacy-full")return!0}else if(r==="non-zero-area")return hme(e);return!1},MOt=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var i=e.parentElement;i;){if(i.tagName==="FIELDSET"&&i.disabled){for(var r=0;r<i.children.length;r++){var n=i.children.item(r);if(n.tagName==="LEGEND")return kx.call(i,"fieldset[disabled] *")?!0:!n.contains(e)}return!0}i=i.parentElement}return!1},Qk=function(e,i){return!(i.disabled||Kk(i)||TOt(i)||POt(i,e)||SOt(i)||MOt(i))},bX=function(e,i){return!(OOt(i)||Tw(i)<0||!Qk(e,i))},$Ot=function(e){var i=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(i)||i>=0)},IOt=function t(e){var i=[],r=[];return e.forEach(function(n,s){var o=!!n.scopeParent,a=o?n.scopeParent:n,l=wOt(a,o),c=o?t(n.candidates):a;l===0?o?i.push.apply(i,c):i.push(a):r.push({documentOrder:s,tabIndex:l,item:n,isScope:o,content:c})}),r.sort(xOt).reduce(function(n,s){return s.isScope?n.push.apply(n,s.content):n.push(s.content),n},[]).concat(i)},LOt=function(e,i){i=i||{};var r;return i.getShadowRoot?r=DIe([e],i.includeContainer,{filter:bX.bind(null,i),flatten:!1,getShadowRoot:i.getShadowRoot,shadowRootFilter:$Ot}):r=LIe(e,i.includeContainer,bX.bind(null,i)),IOt(r)},DOt=function(e,i){i=i||{};var r;return i.getShadowRoot?r=DIe([e],i.includeContainer,{filter:Qk.bind(null,i),flatten:!0,getShadowRoot:i.getShadowRoot}):r=LIe(e,i.includeContainer,Qk.bind(null,i)),r},xS=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return kx.call(e,Zk)===!1?!1:bX(i,e)},NOt=$Ie.concat("iframe").join(","),XV=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return kx.call(e,NOt)===!1?!1:Qk(i,e)};/*!
* focus-trap 7.5.4
* @license MIT, https://github.com/focus-trap/focus-trap/blob/master/LICENSE
*/function dme(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),i.push.apply(i,r)}return i}function pme(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?dme(Object(i),!0).forEach(function(r){FOt(t,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):dme(Object(i)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))})}return t}function FOt(t,e,i){return e=UOt(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function kOt(t,e){if(typeof t!="object"||t===null)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var r=i.call(t,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function UOt(t){var e=kOt(t,"string");return typeof e=="symbol"?e:String(e)}var fme={activateTrap:function(e,i){if(e.length>0){var r=e[e.length-1];r!==i&&r.pause()}var n=e.indexOf(i);n===-1||e.splice(n,1),e.push(i)},deactivateTrap:function(e,i){var r=e.indexOf(i);r!==-1&&e.splice(r,1),e.length>0&&e[e.length-1].unpause()}},zOt=function(e){return e.tagName&&e.tagName.toLowerCase()==="input"&&typeof e.select=="function"},BOt=function(e){return e?.key==="Escape"||e?.key==="Esc"||e?.keyCode===27},qR=function(e){return e?.key==="Tab"||e?.keyCode===9},VOt=function(e){return qR(e)&&!e.shiftKey},GOt=function(e){return qR(e)&&e.shiftKey},mme=function(e){return setTimeout(e,0)},gme=function(e,i){var r=-1;return e.every(function(n,s){return i(n)?(r=s,!1):!0}),r},t3=function(e){for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];return typeof e=="function"?e.apply(void 0,r):e},zD=function(e){return e.target.shadowRoot&&typeof e.composedPath=="function"?e.composedPath()[0]:e.target},jOt=[],HOt=function(e,i){var r=i?.document||document,n=i?.trapStack||jOt,s=pme({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0,isKeyForward:VOt,isKeyBackward:GOt},i),o={containers:[],containerGroups:[],tabbableGroups:[],nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,delayInitialFocusTimer:void 0,recentNavEvent:void 0},a,l=function(L,z,j){return L&&L[z]!==void 0?L[z]:s[j||z]},c=function(L,z){var j=typeof z?.composedPath=="function"?z.composedPath():void 0;return o.containerGroups.findIndex(function(H){var X=H.container,P=H.tabbableNodes;return X.contains(L)||j?.includes(X)||P.find(function(I){return I===L})})},h=function(L){var z=s[L];if(typeof z=="function"){for(var j=arguments.length,H=new Array(j>1?j-1:0),X=1;X<j;X++)H[X-1]=arguments[X];z=z.apply(void 0,H)}if(z===!0&&(z=void 0),!z){if(z===void 0||z===!1)return z;throw new Error("`".concat(L,"` was specified but was not a node, or did not return a node"))}var P=z;if(typeof z=="string"&&(P=r.querySelector(z),!P))throw new Error("`".concat(L,"` as selector refers to no known node"));return P},d=function(){var L=h("initialFocus");if(L===!1)return!1;if(L===void 0||!XV(L,s.tabbableOptions))if(c(r.activeElement)>=0)L=r.activeElement;else{var z=o.tabbableGroups[0],j=z&&z.firstTabbableNode;L=j||h("fallbackFocus")}if(!L)throw new Error("Your focus-trap needs to have at least one focusable element");return L},f=function(){if(o.containerGroups=o.containers.map(function(L){var z=LOt(L,s.tabbableOptions),j=DOt(L,s.tabbableOptions),H=z.length>0?z[0]:void 0,X=z.length>0?z[z.length-1]:void 0,P=j.find(function(q){return xS(q)}),I=j.slice().reverse().find(function(q){return xS(q)}),V=!!z.find(function(q){return Tw(q)>0});return{container:L,tabbableNodes:z,focusableNodes:j,posTabIndexesFound:V,firstTabbableNode:H,lastTabbableNode:X,firstDomTabbableNode:P,lastDomTabbableNode:I,nextTabbableNode:function(Y){var J=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,ee=z.indexOf(Y);return ee<0?J?j.slice(j.indexOf(Y)+1).find(function(me){return xS(me)}):j.slice(0,j.indexOf(Y)).reverse().find(function(me){return xS(me)}):z[ee+(J?1:-1)]}}}),o.tabbableGroups=o.containerGroups.filter(function(L){return L.tabbableNodes.length>0}),o.tabbableGroups.length<=0&&!h("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times");if(o.containerGroups.find(function(L){return L.posTabIndexesFound})&&o.containerGroups.length>1)throw new Error("At least one node with a positive tabindex was found in one of your focus-trap's multiple containers. Positive tabindexes are only supported in single-container focus-traps.")},m=function B(L){var z=L.activeElement;if(z)return z.shadowRoot&&z.shadowRoot.activeElement!==null?B(z.shadowRoot):z},y=function B(L){if(L!==!1&&L!==m(document)){if(!L||!L.focus){B(d());return}L.focus({preventScroll:!!s.preventScroll}),o.mostRecentlyFocusedNode=L,zOt(L)&&L.select()}},_=function(L){var z=h("setReturnFocus",L);return z||(z===!1?!1:L)},v=function(L){var z=L.target,j=L.event,H=L.isBackward,X=H===void 0?!1:H;z=z||zD(j),f();var P=null;if(o.tabbableGroups.length>0){var I=c(z,j),V=I>=0?o.containerGroups[I]:void 0;if(I<0)X?P=o.tabbableGroups[o.tabbableGroups.length-1].lastTabbableNode:P=o.tabbableGroups[0].firstTabbableNode;else if(X){var q=gme(o.tabbableGroups,function(yt){var St=yt.firstTabbableNode;return z===St});if(q<0&&(V.container===z||XV(z,s.tabbableOptions)&&!xS(z,s.tabbableOptions)&&!V.nextTabbableNode(z,!1))&&(q=I),q>=0){var Y=q===0?o.tabbableGroups.length-1:q-1,J=o.tabbableGroups[Y];P=Tw(z)>=0?J.lastTabbableNode:J.lastDomTabbableNode}else qR(j)||(P=V.nextTabbableNode(z,!1))}else{var ee=gme(o.tabbableGroups,function(yt){var St=yt.lastTabbableNode;return z===St});if(ee<0&&(V.container===z||XV(z,s.tabbableOptions)&&!xS(z,s.tabbableOptions)&&!V.nextTabbableNode(z))&&(ee=I),ee>=0){var me=ee===o.tabbableGroups.length-1?0:ee+1,Me=o.tabbableGroups[me];P=Tw(z)>=0?Me.firstTabbableNode:Me.firstDomTabbableNode}else qR(j)||(P=V.nextTabbableNode(z))}}else P=h("fallbackFocus");return P},w=function(L){var z=zD(L);if(!(c(z,L)>=0)){if(t3(s.clickOutsideDeactivates,L)){a.deactivate({returnFocus:s.returnFocusOnDeactivate});return}t3(s.allowOutsideClick,L)||L.preventDefault()}},x=function(L){var z=zD(L),j=c(z,L)>=0;if(j||z instanceof Document)j&&(o.mostRecentlyFocusedNode=z);else{L.stopImmediatePropagation();var H,X=!0;if(o.mostRecentlyFocusedNode)if(Tw(o.mostRecentlyFocusedNode)>0){var P=c(o.mostRecentlyFocusedNode),I=o.containerGroups[P].tabbableNodes;if(I.length>0){var V=I.findIndex(function(q){return q===o.mostRecentlyFocusedNode});V>=0&&(s.isKeyForward(o.recentNavEvent)?V+1<I.length&&(H=I[V+1],X=!1):V-1>=0&&(H=I[V-1],X=!1))}}else o.containerGroups.some(function(q){return q.tabbableNodes.some(function(Y){return Tw(Y)>0})})||(X=!1);else X=!1;X&&(H=v({target:o.mostRecentlyFocusedNode,isBackward:s.isKeyBackward(o.recentNavEvent)})),y(H||o.mostRecentlyFocusedNode||d())}o.recentNavEvent=void 0},T=function(L){var z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;o.recentNavEvent=L;var j=v({event:L,isBackward:z});j&&(qR(L)&&L.preventDefault(),y(j))},S=function(L){if(BOt(L)&&t3(s.escapeDeactivates,L)!==!1){L.preventDefault(),a.deactivate();return}(s.isKeyForward(L)||s.isKeyBackward(L))&&T(L,s.isKeyBackward(L))},C=function(L){var z=zD(L);c(z,L)>=0||t3(s.clickOutsideDeactivates,L)||t3(s.allowOutsideClick,L)||(L.preventDefault(),L.stopImmediatePropagation())},A=function(){if(o.active)return fme.activateTrap(n,a),o.delayInitialFocusTimer=s.delayInitialFocus?mme(function(){y(d())}):y(d()),r.addEventListener("focusin",x,!0),r.addEventListener("mousedown",w,{capture:!0,passive:!1}),r.addEventListener("touchstart",w,{capture:!0,passive:!1}),r.addEventListener("click",C,{capture:!0,passive:!1}),r.addEventListener("keydown",S,{capture:!0,passive:!1}),a},R=function(){if(o.active)return r.removeEventListener("focusin",x,!0),r.removeEventListener("mousedown",w,!0),r.removeEventListener("touchstart",w,!0),r.removeEventListener("click",C,!0),r.removeEventListener("keydown",S,!0),a},D=function(L){var z=L.some(function(j){var H=Array.from(j.removedNodes);return H.some(function(X){return X===o.mostRecentlyFocusedNode})});z&&y(d())},N=typeof window<"u"&&"MutationObserver"in window?new MutationObserver(D):void 0,k=function(){N&&(N.disconnect(),o.active&&!o.paused&&o.containers.map(function(L){N.observe(L,{subtree:!0,childList:!0})}))};return a={get active(){return o.active},get paused(){return o.paused},activate:function(L){if(o.active)return this;var z=l(L,"onActivate"),j=l(L,"onPostActivate"),H=l(L,"checkCanFocusTrap");H||f(),o.active=!0,o.paused=!1,o.nodeFocusedBeforeActivation=r.activeElement,z?.();var X=function(){H&&f(),A(),k(),j?.()};return H?(H(o.containers.concat()).then(X,X),this):(X(),this)},deactivate:function(L){if(!o.active)return this;var z=pme({onDeactivate:s.onDeactivate,onPostDeactivate:s.onPostDeactivate,checkCanReturnFocus:s.checkCanReturnFocus},L);clearTimeout(o.delayInitialFocusTimer),o.delayInitialFocusTimer=void 0,R(),o.active=!1,o.paused=!1,k(),fme.deactivateTrap(n,a);var j=l(z,"onDeactivate"),H=l(z,"onPostDeactivate"),X=l(z,"checkCanReturnFocus"),P=l(z,"returnFocus","returnFocusOnDeactivate");j?.();var I=function(){mme(function(){P&&y(_(o.nodeFocusedBeforeActivation)),H?.()})};return P&&X?(X(_(o.nodeFocusedBeforeActivation)).then(I,I),this):(I(),this)},pause:function(L){if(o.paused||!o.active)return this;var z=l(L,"onPause"),j=l(L,"onPostPause");return o.paused=!0,z?.(),R(),k(),j?.(),this},unpause:function(L){if(!o.paused||!o.active)return this;var z=l(L,"onUnpause"),j=l(L,"onPostUnpause");return o.paused=!1,z?.(),f(),A(),k(),j?.(),this},updateContainerElements:function(L){var z=[].concat(L).filter(Boolean);return o.containers=z.map(function(j){return typeof j=="string"?r.querySelector(j):j}),o.active&&f(),k(),this}},a.updateContainerElements(e),a};const nb="esri-identity-modal",_f={base:nb,open:`${nb}--open`,closed:`${nb}--closed`,title:`${nb}__title`,dialog:`${nb}__dialog`,content:`${nb}__content`,closeButton:`${nb}__close-button`,iconClose:"esri-icon-close"};let S_=class extends Yp{constructor(t,e){super(t,e),this.container=document.createElement("div"),this.content=null,this.open=!1,this._focusTrap=null,this._close=()=>{this.open=!1},document.body.appendChild(this.container),this.addHandles(ne(()=>this.open,()=>this._toggleFocusTrap()))}destroy(){this._destroyFocusTrap()}get title(){return this.messages?.auth.signIn}render(){const t=this.id,{open:e,content:i,title:r,messages:n}=this,s=e&&!!i,o={[_f.open]:s,[_f.closed]:!s},a=Ce("button",{"aria-label":n.close,bind:this,class:_f.closeButton,onclick:this._close,title:n.close,type:"button"},Ce("span",{"aria-hidden":"true",class:_f.iconClose})),l=`${t}_title`,c=`${t}_content`,h=r?Ce("h1",{class:_f.title,id:l},r):null,d=s?Ce("div",{afterCreate:this._createFocusTrap,"aria-describedby":c,"aria-labelledby":l,bind:this,class:_f.dialog,role:"dialog"},a,h,this._renderContent(c)):null;return Ce("div",{class:this.classes(_f.base,o),tabIndex:-1},d)}_destroyFocusTrap(){this._focusTrap?.deactivate({onDeactivate:()=>{}}),this._focusTrap=null}_toggleFocusTrap(){const{_focusTrap:t,open:e}=this;t&&(e?t.activate():t.deactivate())}_createFocusTrap(t){this._destroyFocusTrap();const e=requestAnimationFrame(()=>{this._focusTrap=HOt(t,{initialFocus:"input",onDeactivate:this._close}),this._toggleFocusTrap()});this.addHandles(Vi(()=>cancelAnimationFrame(e)))}_renderContent(t){const e=this.content;return typeof e=="string"?Ce("div",{class:_f.content,id:t,innerHTML:e}):fE(e)?Ce("div",{class:_f.content,id:t},e.render()):e instanceof HTMLElement?Ce("div",{afterCreate:this._attachToNode,bind:e,class:_f.content,id:t}):null}_attachToNode(t){const e=this;t.appendChild(e)}};u([p({readOnly:!0})],S_.prototype,"container",void 0),u([p()],S_.prototype,"content",void 0),u([p()],S_.prototype,"open",void 0),u([p(),Lm("esri/t9n/common")],S_.prototype,"messages",void 0),u([p()],S_.prototype,"title",null),S_=u([M("esri.identity.IdentityModal")],S_);const yme=S_,ZV="esriJSAPIOAuth";class wX{constructor(e,i){this.oAuthInfo=null,this.storage=null,this.appId=null,this.codeVerifier=null,this.expires=null,this.refreshToken=null,this.ssl=null,this.stateUID=null,this.token=null,this.userId=null,this.oAuthInfo=e,this.storage=i,this._init()}isValid(){let e=!1;if(this.oAuthInfo&&this.userId&&(this.refreshToken||this.token)){if(this.expires==null&&this.refreshToken)e=!0;else if(this.expires){const i=Date.now();this.expires>i&&(this.expires-i)/1e3>60*this.oAuthInfo.minTimeUntilExpiration&&(e=!0)}}return e}save(){if(!this.storage)return!1;const e=this._load(),i=this.oAuthInfo;if(i&&i.authNamespace&&i.portalUrl){let r=e[i.authNamespace];r||(r=e[i.authNamespace]={}),this.appId||(this.appId=i.appId),r[i.portalUrl]={appId:this.appId,codeVerifier:this.codeVerifier,expires:this.expires,refreshToken:this.refreshToken,ssl:this.ssl,stateUID:this.stateUID,token:this.token,userId:this.userId};try{this.storage.setItem(ZV,JSON.stringify(e))}catch(n){return console.warn(n),!1}return!0}return!1}destroy(){const e=this._load(),i=this.oAuthInfo;if(i?.appId&&i?.portalUrl&&(this.expires==null||this.expires>Date.now())&&(this.refreshToken||this.token)){const r=i.portalUrl.replace(/^http:/i,"https:")+"/sharing/rest/oauth2/revokeToken",n=new FormData;if(n.append("f","json"),n.append("auth_token",this.refreshToken||this.token),n.append("client_id",i.appId),n.append("token_type_hint",this.refreshToken?"refresh_token":"access_token"),typeof navigator.sendBeacon=="function")navigator.sendBeacon(r,n);else{const s=new XMLHttpRequest;s.open("POST",r),s.send(n)}}if(i&&i.authNamespace&&i.portalUrl&&this.storage){const r=e[i.authNamespace];if(r){delete r[i.portalUrl];try{this.storage.setItem(ZV,JSON.stringify(e))}catch(n){console.log(n)}}}i&&(i._oAuthCred=null,this.oAuthInfo=null)}_init(){const e=this._load(),i=this.oAuthInfo;if(i&&i.authNamespace&&i.portalUrl){let r=e[i.authNamespace];r&&(r=r[i.portalUrl],r&&(this.appId=r.appId,this.codeVerifier=r.codeVerifier,this.expires=r.expires,this.refreshToken=r.refreshToken,this.ssl=r.ssl,this.stateUID=r.stateUID,this.token=r.token,this.userId=r.userId))}}_load(){let e={};if(this.storage){const i=this.storage.getItem(ZV);if(i)try{e=JSON.parse(i)}catch(r){console.warn(r)}}return e}}wX.prototype.declaredClass="esri.identity.OAuthCredential";var xX;let _a=xX=class extends pe{constructor(t){super(t),this._oAuthCred=null,this.appId=null,this.authNamespace="/",this.expiration=20160,this.flowType="auto",this.forceLogin=!1,this.forceUserId=!1,this.locale=null,this.minTimeUntilExpiration=30,this.popup=!1,this.popupCallbackUrl="oauth-callback.html",this.popupWindowFeatures="height=490,width=800,resizable,scrollbars,status",this.portalUrl="https://www.arcgis.com",this.preserveUrlHash=!1,this.userId=null}clone(){return xX.fromJSON(this.toJSON())}};u([p({json:{write:!0}})],_a.prototype,"appId",void 0),u([p({json:{write:!0}})],_a.prototype,"authNamespace",void 0),u([p({json:{write:!0}})],_a.prototype,"expiration",void 0),u([p({json:{write:!0}})],_a.prototype,"flowType",void 0),u([p({json:{write:!0}})],_a.prototype,"forceLogin",void 0),u([p({json:{write:!0}})],_a.prototype,"forceUserId",void 0),u([p({json:{write:!0}})],_a.prototype,"locale",void 0),u([p({json:{write:!0}})],_a.prototype,"minTimeUntilExpiration",void 0),u([p({json:{write:!0}})],_a.prototype,"popup",void 0),u([p({json:{write:!0}})],_a.prototype,"popupCallbackUrl",void 0),u([p({json:{write:!0}})],_a.prototype,"popupWindowFeatures",void 0),u([p({json:{write:!0}})],_a.prototype,"portalUrl",void 0),u([p({json:{write:!0}})],_a.prototype,"preserveUrlHash",void 0),u([p({json:{write:!0}})],_a.prototype,"userId",void 0),_a=xX=u([M("esri.identity.OAuthInfo")],_a);const TX=_a;let _u=class extends pe{constructor(e){super(e),this.adminTokenServiceUrl=null,this.currentVersion=null,this.hasPortal=null,this.hasServer=null,this.owningSystemUrl=null,this.owningTenant=null,this.server=null,this.shortLivedTokenValidity=null,this.tokenServiceUrl=null,this.webTierAuth=null}};u([p({json:{write:!0}})],_u.prototype,"adminTokenServiceUrl",void 0),u([p({json:{write:!0}})],_u.prototype,"currentVersion",void 0),u([p({json:{write:!0}})],_u.prototype,"hasPortal",void 0),u([p({json:{write:!0}})],_u.prototype,"hasServer",void 0),u([p({json:{write:!0}})],_u.prototype,"owningSystemUrl",void 0),u([p({json:{write:!0}})],_u.prototype,"owningTenant",void 0),u([p({json:{write:!0}})],_u.prototype,"server",void 0),u([p({json:{write:!0}})],_u.prototype,"shortLivedTokenValidity",void 0),u([p({json:{write:!0}})],_u.prototype,"tokenServiceUrl",void 0),u([p({json:{write:!0}})],_u.prototype,"webTierAuth",void 0),_u=u([M("esri.identity.ServerInfo")],_u);const JV=_u,i5={},kIe=t=>{const e=new Ic(t.owningSystemUrl).host,i=new Ic(t.server).host,r=/.+\.arcgis\.com$/i;return r.test(e)&&r.test(i)},SX=(t,e)=>!!(kIe(t)&&e&&e.some(i=>i.test(t.server)));let r5=null,n5=null;try{r5=window.localStorage,n5=window.sessionStorage}catch{}class UIe extends Sn{constructor(){super(),this._portalConfig=globalThis.esriGeowConfig,this.serverInfos=[],this.oAuthInfos=[],this.credentials=[],this._soReqs=[],this._xoReqs=[],this._portals=[],this._defaultOAuthInfo=null,this._defaultTokenValidity=60,this.dialog=null,this.formConstructor=vOt,this.tokenValidity=null,this.normalizeWebTierAuth=!1,this._appOrigin=window.origin!=="null"?window.origin:window.location.origin,this._appUrlObj=Nn(window.location.href),this._busy=null,this._rejectOnPersistedPageShow=!1,this._oAuthLocationParams=null,this._gwTokenUrl="/sharing/rest/generateToken",this._agsRest="/rest/services",this._agsPortal=/\/sharing(\/|$)/i,this._agsAdmin=/(https?:\/\/[^\/]+\/[^\/]+)\/admin\/?(\/.*)?$/i,this._adminSvcs=/\/rest\/admin\/services(\/|$)/i,this._gwDomains=[{regex:/^https?:\/\/www\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:dev|[a-z\d-]+\.mapsdev)\.arcgis\.com/i,customBaseUrl:"mapsdev.arcgis.com",tokenServiceUrl:"https://dev.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:devext|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,customBaseUrl:"mapsdevext.arcgis.com",tokenServiceUrl:"https://devext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:qaext|[a-z\d-]+\.mapsqa)\.arcgis\.com/i,customBaseUrl:"mapsqa.arcgis.com",tokenServiceUrl:"https://qaext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/[a-z\d-]+\.maps\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"}],this._legacyFed=[],this._regexSDirUrl=/http.+\/rest\/services\/?/gi,this._regexServerType=/(\/(FeatureServer|GPServer|GeoDataServer|GeocodeServer|GeoenrichmentServer|GeometryServer|GlobeServer|ImageServer|KnowledgeGraphServer|MapServer|MissionServer|MobileServer|NAServer|NetworkDiagramServer|OGCFeatureServer|ParcelFabricServer|RelationalCatalogServer|SceneServer|StreamServer|UtilityNetworkServer|ValidationServer|VectorTileServer|VersionManagementServer|VideoServer)).*/gi,this._gwUser=/http.+\/users\/([^\/]+)\/?.*/i,this._gwItem=/http.+\/items\/([^\/]+)\/?.*/i,this._gwGroup=/http.+\/groups\/([^\/]+)\/?.*/i,this._rePortalTokenSvc=/\/sharing(\/rest)?\/generatetoken/i,this._createDefaultOAuthInfo=!0,this._hasTestedIfAppIsOnPortal=!1,this._getOAuthLocationParams(),window.addEventListener("pageshow",e=>{this._pageShowHandler(e)})}registerServers(e){const i=this.serverInfos;i?(e=e.filter(r=>!this.findServerInfo(r.server)),this.serverInfos=i.concat(e)):this.serverInfos=e,e.forEach(r=>{r.owningSystemUrl&&this._portals.push(r.owningSystemUrl),r.hasPortal&&this._portals.push(r.server)})}registerOAuthInfos(e){const i=this.oAuthInfos;if(i){for(const r of e){const n=this.findOAuthInfo(r.portalUrl);n&&i.splice(i.indexOf(n),1)}this.oAuthInfos=i.concat(e)}else this.oAuthInfos=e}registerToken(e){e={...e};const i=this._sanitizeUrl(e.server),r=this._isServerRsrc(i);let n,s=this.findServerInfo(i),o=!0;s||(s=new JV,s.server=this._getServerInstanceRoot(i),r?s.hasServer=!0:(s.tokenServiceUrl=this._getTokenSvcUrl(i),s.hasPortal=!0),this.registerServers([s])),n=this._findCredential(i),n?(delete e.server,Object.assign(n,e),o=!1):(n=new Hn({userId:e.userId,server:s.server,token:e.token,expires:e.expires,ssl:e.ssl,scope:r?"server":"portal"}),n.resources=[i],this.credentials.push(n)),n.emitTokenChange(!1),o||n.refreshServerTokens()}toJSON(){return n6({serverInfos:this.serverInfos.map(e=>e.toJSON()),oAuthInfos:this.oAuthInfos.map(e=>e.toJSON()),credentials:this.credentials.map(e=>e.toJSON())})}initialize(e){if(!e)return;typeof e=="string"&&(e=JSON.parse(e));const i=e.serverInfos,r=e.oAuthInfos,n=e.credentials;if(i){const s=[];i.forEach(o=>{o.server&&o.tokenServiceUrl&&s.push(o.declaredClass?o:new JV(o))}),s.length&&this.registerServers(s)}if(r){const s=[];r.forEach(o=>{o.appId&&s.push(o.declaredClass?o:new TX(o))}),s.length&&this.registerOAuthInfos(s)}n&&n.forEach(s=>{s.server&&s.token&&s.expires&&s.expires>Date.now()&&((s=s.declaredClass?s:new Hn(s)).emitTokenChange(),this.credentials.push(s))})}findServerInfo(e){let i;e=this._sanitizeUrl(e);for(const r of this.serverInfos)if(this._hasSameServerInstance(r.server,e)){i=r;break}return i}findOAuthInfo(e){let i;e=this._sanitizeUrl(e);for(const r of this.oAuthInfos)if(this._hasSameServerInstance(r.portalUrl,e)){i=r;break}return i}findCredential(e,i){if(!e)return;let r;e=this._sanitizeUrl(e);const n=this._isServerRsrc(e)?"server":"portal";if(i){for(const s of this.credentials)if(this._hasSameServerInstance(s.server,e)&&i===s.userId&&s.scope===n){r=s;break}}else for(const s of this.credentials)if(this._hasSameServerInstance(s.server,e)&&this._getIdenticalSvcIdx(e,s)!==-1&&s.scope===n){r=s;break}return r}getCredential(e,i){let r,n,s=!0;i&&(r=!!i.token,n=i.error,s=i.prompt!==!1),i={...i},e=this._sanitizeUrl(e);const o=new AbortController,a=Hs();if(i.signal&&Ms(i.signal,()=>{o.abort()}),Ms(o,()=>{a.reject(new G("identity-manager:user-aborted","ABORTED"))}),ps(o))return a.promise;i.signal=o.signal;const l=this._isAdminResource(e),c=r?this.findCredential(e):null;let h;if(c&&n&&n.details&&n.details.httpStatus===498)c.destroy();else if(c)return h=new G("identity-manager:not-authorized","You are currently signed in as: '"+c.userId+"'. You do not have access to this resource: "+e,{error:n}),a.reject(h),a.promise;const d=this._findCredential(e,i);if(d)return a.resolve(d),a.promise;let f=this.findServerInfo(e);if(f)!f.hasPortal&&f.server&&f.owningSystemUrl&&this._hasSameServerInstance(f.server,f.owningSystemUrl)&&(f.hasPortal=!0),!f.hasServer&&this._isServerRsrc(e)&&(f._restInfoPms=this._getTokenSvcUrl(e),f.hasServer=!0);else{const m=this._getTokenSvcUrl(e);if(!m)return h=new G("identity-manager:unknown-resource","Unknown resource - could not find token service endpoint."),a.reject(h),a.promise;f=new JV,f.server=this._getServerInstanceRoot(e),typeof m=="string"?(f.tokenServiceUrl=m,f.hasPortal=!0):(f._restInfoPms=m,f.hasServer=!0),this.registerServers([f])}return f.hasPortal&&f._selfReq===void 0&&(s||Ec(f.tokenServiceUrl,this._appOrigin)||this._gwDomains.some(m=>m.tokenServiceUrl===f.tokenServiceUrl))&&(f._selfReq={owningTenant:i?.owningTenant,selfDfd:this._getPortalSelf(f.tokenServiceUrl.replace(this._rePortalTokenSvc,"/sharing/rest/portals/self"),e)}),this._enqueue(e,f,i,a,l)}getResourceName(e){return this._isRESTService(e)?e.replace(this._regexSDirUrl,"").replace(this._regexServerType,"")||"":this._gwUser.test(e)&&e.replace(this._gwUser,"$1")||this._gwItem.test(e)&&e.replace(this._gwItem,"$1")||this._gwGroup.test(e)&&e.replace(this._gwGroup,"$1")||""}generateToken(e,i,r){const n=this._rePortalTokenSvc.test(e.tokenServiceUrl),s=new Ic(this._appOrigin),o=e.shortLivedTokenValidity;let a,l,c,h,d,f,m,y;i&&(y=this.tokenValidity||o||this._defaultTokenValidity,y>o&&o>0&&(y=o)),r&&(a=r.isAdmin,l=r.serverUrl,c=r.token,f=r.signal,m=r.ssl,e.customParameters=r.customParameters),a?h=e.adminTokenServiceUrl:(h=e.tokenServiceUrl,d=new Ic(h.toLowerCase()),e.webTierAuth&&r?.serverUrl&&!m&&s.scheme==="http"&&(Ec(s.uri,h,!0)||d.scheme==="https"&&s.host===d.host&&s.port==="7080"&&d.port==="7443")&&(h=h.replace(/^https:/i,"http:").replace(/:7443/i,":7080")));const _={query:{request:"getToken",username:i?.username,password:i?.password,serverUrl:l,token:c,expiration:y,referer:a||n?this._appOrigin:null,client:a?"referer":null,f:"json",...e.customParameters},method:"post",authMode:"anonymous",useProxy:this._useProxy(e,r),signal:f,...r?.ioArgs};return n||(_.withCredentials=!1),_i(h,_).then(v=>{const w=v.data;if(!w?.token)return new G("identity-manager:authentication-failed","Unable to generate token");const x=e.server;return i5[x]||(i5[x]={}),i&&(i5[x][i.username]=i.password),w.validity=y,w})}isBusy(){return!!this._busy}checkSignInStatus(e){return this.checkAppAccess(e,"").then(i=>i.credential)}checkAppAccess(e,i,r){let n=!1;return this.getCredential(e,{prompt:!1}).then(s=>{let o;const a={f:"json"};if(s.scope==="portal")if(i&&(this._doPortalSignIn(e)||r?.force))o=s.server+"/sharing/rest/oauth2/validateAppAccess",a.client_id=i;else{if(!s.token)return{credential:s};o=s.server+"/sharing/rest"}else{if(!s.token)return{credential:s};o=s.server+"/rest/services"}return s.token&&(a.token=s.token),_i(o,{query:a,authMode:"anonymous"}).then(l=>{if(l.data.valid===!1)throw new G("identity-manager:not-authorized",`You are currently signed in as: '${s.userId}'.`,l.data);return n=!!l.data.viewOnlyUserTypeApp,{credential:s}}).catch(l=>{if(l.name==="identity-manager:not-authorized")throw l;const c=l.details?.httpStatus;if(c===498)throw s.destroy(),new G("identity-manager:not-authenticated","User is not signed in.");if(c===400)throw new G("identity-manager:invalid-request");return{credential:s}})}).then(s=>({credential:s.credential,viewOnly:n}))}setOAuthResponseHash(e){e&&(e.charAt(0)==="#"&&(e=e.substring(1)),this._processOAuthPopupParams(Sw(e)))}setOAuthRedirectionHandler(e){this._oAuthRedirectFunc=e}setProtocolErrorHandler(e){this._protocolFunc=e}signIn(e,i,r={}){const n=Hs(),s=()=>{l?.remove(),c?.remove(),h?.remove(),a?.destroy(),this.dialog?.destroy(),this.dialog=a=l=c=h=null},o=()=>{s(),this._oAuthDfd=null,n.reject(new G("identity-manager:user-aborted","ABORTED"))};r.signal&&Ms(r.signal,()=>{o()});let a=new this.formConstructor;a.resource=this.getResourceName(e),a.server=i.server,this.dialog=new yme,this.dialog.content=a,this.dialog.open=!0,this.emit("dialog-create");let l=a.on("cancel",o),c=ne(()=>this.dialog.open,o),h=a.on("submit",d=>{this.generateToken(i,d,{isAdmin:r.isAdmin,signal:r.signal}).then(f=>{s();const m=new Hn({userId:d.username,server:i.server,token:f.token,expires:f.expires!=null?Number(f.expires):null,ssl:!!f.ssl,isAdmin:r.isAdmin,validity:f.validity});n.resolve(m)}).catch(f=>{a.error=f,a.signingIn=!1})});return n.promise}oAuthSignIn(e,i,r,n){this._oAuthDfd=Hs();const s=this._oAuthDfd;let o;n?.signal&&Ms(n.signal,()=>{const y=this._oAuthDfd&&this._oAuthDfd.oAuthWin_;y&&!y.closed?y.close():this.dialog&&f()}),s.resUrl_=e,s.sinfo_=i,s.oinfo_=r;const a=r._oAuthCred;if(a.storage&&(r.flowType==="authorization-code"||r.flowType==="auto"&&i.currentVersion>=8.4)){let y=crypto.getRandomValues(new Uint8Array(32));o=N8(y),a.codeVerifier=o,y=crypto.getRandomValues(new Uint8Array(32)),a.stateUID=N8(y),a.save()||(a.codeVerifier=o=null)}else a.codeVerifier=null;let l,c,h,d;this._getCodeChallenge(o).then(y=>{const _=!n||n.oAuthPopupConfirmation!==!1;r.popup&&_?(l=new this.formConstructor,l.oAuthPrompt=!0,l.server=i.server,this.dialog=new yme,this.dialog.content=l,this.dialog.open=!0,this.emit("dialog-create"),c=l.on("cancel",f),h=ne(()=>this.dialog.open,f),d=l.on("submit",()=>{m(),this._doOAuthSignIn(e,i,r,y)})):this._doOAuthSignIn(e,i,r,y)});const f=()=>{m(),this._oAuthDfd=null,s.reject(new G("identity-manager:user-aborted","ABORTED"))},m=()=>{c?.remove(),h?.remove(),d?.remove(),l?.destroy(),this.dialog?.destroy(),this.dialog=null};return s.promise}destroyCredentials(){this.credentials&&this.credentials.slice().forEach(e=>{e.destroy()}),this.emit("credentials-destroy")}enablePostMessageAuth(e="https://www.arcgis.com/sharing/rest"){this._postMessageAuthHandle&&this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=oy(window,"message",i=>{if((i.origin===this._appOrigin||i.origin.endsWith(".arcgis.com"))&&i.data?.type==="arcgis:auth:requestCredential"){const r=i.source;this.getCredential(e).then(n=>{r.postMessage({type:"arcgis:auth:credential",credential:{expires:n.expires,server:n.server,ssl:n.ssl,token:n.token,userId:n.userId}},i.origin)}).catch(n=>{r.postMessage({type:"arcgis:auth:error",error:{name:n.name,message:n.message}},i.origin)})}})}disablePostMessageAuth(){this._postMessageAuthHandle&&(this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=null)}_getOAuthLocationParams(){let e=window.location.hash;if(e){e.charAt(0)==="#"&&(e=e.substring(1));const r=Sw(e);let n=!1;if(r.access_token&&r.expires_in&&r.state&&r.hasOwnProperty("username"))try{r.state=JSON.parse(r.state),r.state.portalUrl&&(this._oAuthLocationParams=r,n=!0)}catch{}else if(r.error&&r.error_description&&(console.log("IdentityManager OAuth Error: ",r.error," - ",r.error_description),r.error==="access_denied"&&(n=!0,r.state)))try{r.state=JSON.parse(r.state)}catch{}n&&(window.location.hash=r.state?.hash||"")}let i=window.location.search;if(i){i.charAt(0)==="?"&&(i=i.substring(1));const r=Sw(i);let n=!1;if(r.code&&r.state)try{r.state=JSON.parse(r.state),r.state.portalUrl&&r.state.uid&&(this._oAuthLocationParams=r,n=!0)}catch{}else if(r.error&&r.error_description&&(console.log("IdentityManager OAuth Error: ",r.error," - ",r.error_description),r.error==="access_denied"&&(n=!0,r.state)))try{r.state=JSON.parse(r.state)}catch{}if(n){const s={...r};["code","error","error_description","message_code","persist","state"].forEach(l=>{delete s[l]});const o=sx(s),a=window.location.pathname+(o?`?${o}`:"")+(r.state?.hash||"");window.history.replaceState(window.history.state,"",a)}}}_getOAuthToken(e,i,r,n,s){return e=e.replace(/^http:/i,"https:"),_i(`${e}/sharing/rest/oauth2/token`,{authMode:"anonymous",method:"post",query:n&&s?{grant_type:"authorization_code",code:i,redirect_uri:n,client_id:r,code_verifier:s}:{grant_type:"refresh_token",refresh_token:i,client_id:r}}).then(o=>o.data)}_getCodeChallenge(e){if(e&&globalThis.isSecureContext){const i=new TextEncoder().encode(e);return crypto.subtle.digest("SHA-256",i).then(r=>N8(new Uint8Array(r)))}return Promise.resolve(null)}_pageShowHandler(e){if(e.persisted&&this.isBusy()&&this._rejectOnPersistedPageShow){const i=new G("identity-manager:user-aborted","ABORTED");this._errbackFunc(i)}}_findCredential(e,i){let r,n,s,o,a=-1;const l=i?.token,c=i?.resource,h=this._isServerRsrc(e)?"server":"portal",d=this.credentials.filter(f=>this._hasSameServerInstance(f.server,e)&&f.scope===h);if(e=c||e,d.length)if(d.length===1){if(r=d[0],s=this.findServerInfo(r.server),n=s?.owningSystemUrl,o=n?this.findCredential(n,r.userId):void 0,a=this._getIdenticalSvcIdx(e,r),!l)return a===-1&&r.resources.push(e),this._addResource(e,o),r;a!==-1&&(r.resources.splice(a,1),this._removeResource(e,o))}else{let f,m;if(d.some(y=>(m=this._getIdenticalSvcIdx(e,y),m!==-1&&(f=y,s=this.findServerInfo(f.server),n=s?.owningSystemUrl,o=n?this.findCredential(n,f.userId):void 0,a=m,!0))),l)f&&(f.resources.splice(a,1),this._removeResource(e,o));else if(f)return this._addResource(e,o),f}}_findOAuthInfo(e){let i=this.findOAuthInfo(e);if(!i){for(const r of this.oAuthInfos)if(this._isIdProvider(r.portalUrl,e)){i=r;break}}return i}_addResource(e,i){i&&this._getIdenticalSvcIdx(e,i)===-1&&i.resources.push(e)}_removeResource(e,i){let r=-1;i&&(r=this._getIdenticalSvcIdx(e,i),r>-1&&i.resources.splice(r,1))}_useProxy(e,i){return i?.isAdmin&&!Ec(e.adminTokenServiceUrl,this._appOrigin)||!this._isPortalDomain(e.tokenServiceUrl)&&String(e.currentVersion)==="10.1"&&!Ec(e.tokenServiceUrl,this._appOrigin)}_getOrigin(e){const i=new Ic(e);return i.scheme+"://"+i.host+(i.port!=null?":"+i.port:"")}_getServerInstanceRoot(e){const i=e.toLowerCase();let r=i.indexOf(this._agsRest);return r===-1&&this._isAdminResource(e)&&(r=this._agsAdmin.test(e)?e.replace(this._agsAdmin,"$1").length:e.search(this._adminSvcs)),r!==-1||Ige(i)||(r=i.indexOf("/sharing")),r===-1&&i.substr(-1)==="/"&&(r=i.length-1),r>-1?e.substring(0,r):e}_hasSameServerInstance(e,i){return e.substr(-1)==="/"&&(e=e.slice(0,-1)),e=e.toLowerCase(),i=this._getServerInstanceRoot(i).toLowerCase(),e=this._normalizeAGOLorgDomain(e),i=this._normalizeAGOLorgDomain(i),(e=e.substr(e.indexOf(":")))===(i=i.substr(i.indexOf(":")))}_normalizeAGOLorgDomain(e){const i=/^https?:\/\/(?:cdn|[a-z\d-]+\.maps)\.arcgis\.com/i,r=/^https?:\/\/(?:cdndev|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,n=/^https?:\/\/(?:cdnqa|[a-z\d-]+\.mapsqa)\.arcgis\.com/i;return i.test(e)?e=e.replace(i,"https://www.arcgis.com"):r.test(e)?e=e.replace(r,"https://devext.arcgis.com"):n.test(e)&&(e=e.replace(n,"https://qaext.arcgis.com")),e}_sanitizeUrl(e){const i=(Di.request.proxyUrl||"").toLowerCase(),r=i?e.toLowerCase().indexOf(i+"?"):-1;return r!==-1&&(e=e.substring(r+i.length+1)),e=Bu(e),Nn(e).path}_isRESTService(e){return e.includes(this._agsRest)}_isAdminResource(e){return this._agsAdmin.test(e)||this._adminSvcs.test(e)}_isServerRsrc(e){return this._isRESTService(e)||this._isAdminResource(e)}_isIdenticalService(e,i){let r=!1;if(this._isRESTService(e)&&this._isRESTService(i)){const n=this._getSuffix(e).toLowerCase(),s=this._getSuffix(i).toLowerCase();if(r=n===s,!r){const o=/(.*)\/(MapServer|FeatureServer|UtilityNetworkServer).*/gi;r=n.replaceAll(o,"$1")===s.replaceAll(o,"$1")}}else this._isAdminResource(e)&&this._isAdminResource(i)?r=!0:this._isServerRsrc(e)||this._isServerRsrc(i)||!this._isPortalDomain(e)||(r=!0);return r}_isPortalDomain(e){const i=new Ic(e.toLowerCase()),r=this._portalConfig;let n=this._gwDomains.some(s=>s.regex.test(i.uri));return!n&&r&&(n=this._hasSameServerInstance(this._getServerInstanceRoot(r.restBaseUrl),i.uri)),n||Di.portalUrl&&(n=Ec(i,Di.portalUrl,!0)),n||(n=this._portals.some(s=>this._hasSameServerInstance(s,i.uri))),n=n||this._agsPortal.test(i.path),n}_isIdProvider(e,i){let r=-1,n=-1;this._gwDomains.forEach((o,a)=>{r===-1&&o.regex.test(e)&&(r=a),n===-1&&o.regex.test(i)&&(n=a)});let s=!1;if(r>-1&&n>-1&&(r===0||r===4?n!==0&&n!==4||(s=!0):r===1?n!==1&&n!==2||(s=!0):r===2?n===2&&(s=!0):r===3&&n===3&&(s=!0)),!s){const o=this.findServerInfo(i),a=o?.owningSystemUrl;a&&kIe(o)&&this._isPortalDomain(a)&&this._isIdProvider(e,a)&&(s=!0)}return s}_getIdenticalSvcIdx(e,i){let r=-1;for(let n=0;n<i.resources.length;n++){const s=i.resources[n];if(this._isIdenticalService(e,s)){r=n;break}}return r}_getSuffix(e){return e.replace(this._regexSDirUrl,"").replace(this._regexServerType,"$1")}_getTokenSvcUrl(e){let i,r,n;if(this._isRESTService(e)||this._isAdminResource(e)){const s=this._getServerInstanceRoot(e);return i=s+"/admin/generateToken",r=_i(e=s+"/rest/info",{query:{f:"json"}}).then(o=>o.data),{adminUrl:i,promise:r}}if(this._isPortalDomain(e)){let s="";if(this._gwDomains.some(o=>(o.regex.test(e)&&(s=o.tokenServiceUrl),!!s)),s||this._portals.some(o=>(this._hasSameServerInstance(o,e)&&(s=o+this._gwTokenUrl),!!s)),s||(n=e.toLowerCase().indexOf("/sharing"),n!==-1&&(s=e.substring(0,n)+this._gwTokenUrl)),s||(s=this._getOrigin(e)+this._gwTokenUrl),s){const o=new Ic(e).port;/^http:\/\//i.test(e)&&o==="7080"&&(s=s.replace(/:7080/i,":7443")),s=s.replace(/http:/i,"https:")}return s}if(e.toLowerCase().includes("premium.arcgisonline.com"))return"https://premium.arcgisonline.com/server/tokens"}_processOAuthResponseParams(e,i,r){const n=i._oAuthCred;if(e.code){const o=n.codeVerifier;return n.codeVerifier=null,n.stateUID=null,n.save(),this._getOAuthToken(r.server,e.code,i.appId,this._getRedirectURI(i,!0),o).then(a=>{const l=new Hn({userId:a.username,server:r.server,token:a.access_token,expires:Date.now()+1e3*a.expires_in,ssl:a.ssl,oAuthState:e.state,_oAuthCred:n});return i.userId=l.userId,n.storage=a.persist?r5:n5,n.refreshToken=a.refresh_token,n.token=null,n.expires=a.refresh_token_expires_in?Date.now()+1e3*a.refresh_token_expires_in:null,n.userId=l.userId,n.ssl=l.ssl,n.save(),l})}const s=new Hn({userId:e.username,server:r.server,token:e.access_token,expires:Date.now()+1e3*Number(e.expires_in),ssl:e.ssl==="true",oAuthState:e.state,_oAuthCred:n});return i.userId=s.userId,n.storage=e.persist?r5:n5,n.refreshToken=null,n.token=s.token,n.expires=s.expires,n.userId=s.userId,n.ssl=s.ssl,n.save(),Promise.resolve(s)}_processOAuthPopupParams(e){const i=this._oAuthDfd;if(this._oAuthDfd=null,i)if(clearInterval(this._oAuthIntervalId),this._oAuthOnPopupHandle?.remove(),e.error){const r=e.error==="access_denied",n=new G(r?"identity-manager:user-aborted":"identity-manager:authentication-failed",r?"ABORTED":"OAuth: "+e.error+" - "+e.error_description);i.reject(n)}else this._processOAuthResponseParams(e,i.oinfo_,i.sinfo_).then(r=>{i.resolve(r)}).catch(r=>{i.reject(r)})}_setOAuthResponseQueryString(e){e&&(e.charAt(0)==="?"&&(e=e.substring(1)),this._processOAuthPopupParams(Sw(e)))}_exchangeToken(e,i,r){return _i(`${e}/sharing/rest/oauth2/exchangeToken`,{authMode:"anonymous",method:"post",query:{f:"json",client_id:i,token:r}}).then(n=>n.data.token)}_getPlatformSelf(e,i){return e=e.replace(/^http:/i,"https:"),_i(`${e}/sharing/rest/oauth2/platformSelf`,{authMode:"anonymous",headers:{"X-Esri-Auth-Client-Id":i,"X-Esri-Auth-Redirect-Uri":window.location.href.replace(/#.*$/,"")},method:"post",query:{f:"json",expiration:30},withCredentials:!0}).then(r=>r.data)}_getPortalSelf(e,i){let r;return this._gwDomains.some(n=>(n.regex.test(e)&&(r=n.customBaseUrl),!!r)),r?Promise.resolve({allSSL:!0,currentVersion:"8.4",customBaseUrl:r,portalMode:"multitenant",supportsOAuth:!0}):(this._appOrigin.startsWith("https:")?e=e.replace(/^http:/i,"https:").replace(/:7080/i,":7443"):/^http:/i.test(i)&&(e=e.replace(/^https:/i,"http:").replace(/:7443/i,":7080")),_i(e,{query:{f:"json"},authMode:"anonymous",withCredentials:!0}).then(n=>n.data))}_doPortalSignIn(e){const i=this._portalConfig,r=window.location.href,n=this.findServerInfo(e);return!(!i&&!this._isPortalDomain(r)||!(n?n.hasPortal||n.owningSystemUrl&&this._isPortalDomain(n.owningSystemUrl):this._isPortalDomain(e))||!(this._isIdProvider(r,e)||i&&(this._hasSameServerInstance(this._getServerInstanceRoot(i.restBaseUrl),e)||this._isIdProvider(i.restBaseUrl,e))||Ec(r,e,!0)))}_checkProtocol(e,i,r,n){let s=!0;const o=n?i.adminTokenServiceUrl:i.tokenServiceUrl;return o.trim().toLowerCase().startsWith("https:")&&!this._appOrigin.startsWith("https:")&&uM(o)&&(s=!!this._protocolFunc&&!!this._protocolFunc({resourceUrl:e,serverInfo:i}),!s)&&r(new G("identity-manager:aborted","Aborted the Sign-In process to avoid sending password over insecure connection.")),s}_enqueue(e,i,r,n,s,o){return n||(n=Hs()),n.resUrl_=e,n.sinfo_=i,n.options_=r,n.admin_=s,n.refresh_=o,this._busy?this._hasSameServerInstance(this._getServerInstanceRoot(e),this._busy.resUrl_)?(this._oAuthDfd&&this._oAuthDfd.oAuthWin_&&this._oAuthDfd.oAuthWin_.focus(),this._soReqs.push(n)):this._xoReqs.push(n):this._doSignIn(n),n.promise}_doSignIn(e){this._busy=e,this._rejectOnPersistedPageShow=!1;const i=c=>{const h=e.options_?.resource,d=e.resUrl_,f=e.refresh_;let m=!1;this.credentials.includes(c)||(f&&this.credentials.includes(f)?(f.userId=c.userId,f.token=c.token,f.expires=c.expires,f.validity=c.validity,f.ssl=c.ssl,f.creationTime=c.creationTime,m=!0,c=f):this.credentials.push(c)),c.resources||(c.resources=[]),c.resources.includes(h||d)||c.resources.push(h||d),c.scope=this._isServerRsrc(d)?"server":"portal",c.emitTokenChange();const y=this._soReqs,_={};this._soReqs=[],y.forEach(v=>{if(!this._isIdenticalService(d,v.resUrl_)){const w=this._getSuffix(v.resUrl_);_[w]||(_[w]=!0,c.resources.push(v.resUrl_))}}),e.resolve(c),y.forEach(v=>{this._hasSameServerInstance(this._getServerInstanceRoot(d),v.resUrl_)?v.resolve(c):this._soReqs.push(v)}),this._busy=e.resUrl_=e.sinfo_=e.refresh_=null,m||this.emit("credential-create",{credential:c}),this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},r=c=>{e.reject(c),this._busy=e.resUrl_=e.sinfo_=e.refresh_=null,this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},n=(c,h,d,f)=>{const m=e.sinfo_,y=!e.options_||e.options_.prompt!==!1,_=m.hasPortal&&this._findOAuthInfo(e.resUrl_);let v,w;if(c)i(new Hn({userId:c,server:m.server,token:d||null,expires:f!=null?Number(f):null,ssl:!!h}));else if(window!==window.parent&&this._appUrlObj.query?.["arcgis-auth-origin"]&&this._appUrlObj.query?.["arcgis-auth-portal"]&&this._hasSameServerInstance(this._getServerInstanceRoot(this._appUrlObj.query["arcgis-auth-portal"]),e.resUrl_)){window.parent.postMessage({type:"arcgis:auth:requestCredential"},this._appUrlObj.query["arcgis-auth-origin"]);const x=oy(window,"message",T=>{T.source===window.parent&&T.data&&(T.data.type==="arcgis:auth:credential"?(x.remove(),T.data.credential.expires<Date.now()?r(new G("identity-manager:credential-request-failed","Parent application's token has expired.")):i(new Hn(T.data.credential))):T.data.type==="arcgis:auth:error"&&(x.remove(),T.data.error.name==="tokenExpiredError"?r(new G("identity-manager:credential-request-failed","Parent application's token has expired.")):r(G.fromJSON(T.data.error))))});Ms(e.options_?.signal,()=>{x.remove()})}else if(_){let x=_._oAuthCred;if(!x){const T=new wX(_,r5),S=new wX(_,n5);T.isValid()&&S.isValid()?T.expires>S.expires?(x=T,S.destroy()):(x=S,T.destroy()):x=T.isValid()?T:S,_._oAuthCred=x}if(x.isValid()){v=new Hn({userId:x.userId,server:m.server,token:x.token,expires:x.expires,ssl:x.ssl,_oAuthCred:x});const T=_.appId!==x.appId&&this._doPortalSignIn(e.resUrl_);T||x.refreshToken?(e._pendingDfd=x.refreshToken?this._getOAuthToken(m.server,x.refreshToken,x.appId).then(S=>(v.expires=Date.now()+1e3*S.expires_in,v.token=S.access_token,v)):Promise.resolve(v),e._pendingDfd.then(S=>T?this._exchangeToken(S.server,_.appId,S.token).then(C=>(S.token=C,S)).catch(()=>S):S).then(S=>{i(S)}).catch(()=>{x?.destroy(),n()})):i(v)}else if(this._oAuthLocationParams&&this._hasSameServerInstance(_.portalUrl,this._oAuthLocationParams.state.portalUrl)&&(this._oAuthLocationParams.access_token||this._oAuthLocationParams.code&&this._oAuthLocationParams.state.uid===x.stateUID&&x.codeVerifier)){const T=this._oAuthLocationParams;this._oAuthLocationParams=null,e._pendingDfd=this._processOAuthResponseParams(T,_,m).then(S=>{i(S)}).catch(r)}else{const T=()=>{y?e._pendingDfd=this.oAuthSignIn(e.resUrl_,m,_,e.options_).then(i,r):(w=new G("identity-manager:not-authenticated","User is not signed in."),r(w))};this._doPortalSignIn(e.resUrl_)?e._pendingDfd=this._getPlatformSelf(m.server,_.appId).then(S=>{Ec(S.portalUrl,this._appOrigin,!0)?(v=new Hn({userId:S.username,server:m.server,expires:Date.now()+1e3*S.expires_in,token:S.token}),i(v)):T()}).catch(T):T()}}else if(y){if(this._checkProtocol(e.resUrl_,m,r,e.admin_)){let x=e.options_;e.admin_&&(x=x||{},x.isAdmin=!0),e._pendingDfd=this.signIn(e.resUrl_,m,x).then(i,r)}}else w=new G("identity-manager:not-authenticated","User is not signed in."),r(w)},s=()=>{const c=e.sinfo_,h=c.owningSystemUrl,d=e.options_;let f,m,y,_;if(d&&(f=d.token,m=d.error,y=d.prompt),_=this._findCredential(h,{token:f,resource:e.resUrl_}),!_){for(const v of this.credentials)if(this._isIdProvider(h,v.server)){_=v;break}}if(_){const v=this.findCredential(e.resUrl_,_.userId);if(v)i(v);else if(SX(c,this._legacyFed)){const w=_.toJSON();w.server=c.server,w.resources=null,i(new Hn(w))}else(e._pendingDfd=this.generateToken(this.findServerInfo(_.server),null,{serverUrl:e.resUrl_,token:_.token,signal:e.options_.signal,ssl:_.ssl})).then(w=>{i(new Hn({userId:_?.userId,server:c.server,token:w.token,expires:w.expires!=null?Number(w.expires):null,ssl:!!w.ssl,isAdmin:e.admin_,validity:w.validity}))},r)}else this._busy=null,f&&(e.options_.token=null),(e._pendingDfd=this.getCredential(h.replace(/\/?$/,"/sharing"),{resource:e.resUrl_,owningTenant:c.owningTenant,signal:e.options_.signal,token:f,error:m,prompt:y})).then(()=>{this._enqueue(e.resUrl_,e.sinfo_,e.options_,e,e.admin_)},v=>{e.resUrl_=e.sinfo_=e.refresh_=null,e.reject(v)})};this._errbackFunc=r;const o=e.sinfo_.owningSystemUrl,a=this._isServerRsrc(e.resUrl_),l=e.sinfo_._restInfoPms;l?l.promise.then(c=>{const h=e.sinfo_;if(h._restInfoPms){h.adminTokenServiceUrl=h._restInfoPms.adminUrl,h._restInfoPms=null,h.tokenServiceUrl=(Jg("authInfo.tokenServicesUrl",c)||Jg("authInfo.tokenServiceUrl",c)||Jg("tokenServiceUrl",c))??null,h.shortLivedTokenValidity=Jg("authInfo.shortLivedTokenValidity",c)??null,h.currentVersion=c.currentVersion,h.owningTenant=c.owningTenant;const d=h.owningSystemUrl=c.owningSystemUrl;d&&this._portals.push(d)}a&&h.owningSystemUrl?s():n()},()=>{e.sinfo_._restInfoPms=null;const c=new G("identity-manager:server-identification-failed","Unknown resource - could not find token service endpoint.");r(c)}):a&&o?s():e.sinfo_._selfReq?e.sinfo_._selfReq.selfDfd.then(c=>{const h={};let d,f,m,y;return c&&(d=c.user?.username,h.username=d,h.allSSL=c.allSSL,f=c.supportsOAuth,y=parseFloat(c.currentVersion),c.portalMode==="multitenant"&&(m=c.customBaseUrl),e.sinfo_.currentVersion=y),e.sinfo_.webTierAuth=!!d,d&&this.normalizeWebTierAuth?this.generateToken(e.sinfo_,null,{ssl:h.allSSL}).catch(()=>null).then(_=>(h.portalToken=_&&_.token,h.tokenExpiration=_&&_.expires,h)):!d&&f&&y>=4.4&&!this._findOAuthInfo(e.resUrl_)?this._generateOAuthInfo({portalUrl:e.sinfo_.server,customBaseUrl:m,owningTenant:e.sinfo_._selfReq.owningTenant}).catch(()=>null).then(()=>h):h}).catch(()=>null).then(c=>{e.sinfo_._selfReq=null,c?n(c.username,c.allSSL,c.portalToken,c.tokenExpiration):n()}):n()}_generateOAuthInfo(e){let i,r=null,n=e.portalUrl;const s=e.customBaseUrl,o=e.owningTenant,a=!this._defaultOAuthInfo&&this._createDefaultOAuthInfo&&!this._hasTestedIfAppIsOnPortal;if(a){r=window.location.href;let l=r.indexOf("?");l>-1&&(r=r.slice(0,l)),l=r.search(/\/(apps|home)\//),r=l>-1?r.slice(0,l):null}return a&&r?(this._hasTestedIfAppIsOnPortal=!0,i=_i(r+"/sharing/rest",{query:{f:"json"}}).then(()=>{this._defaultOAuthInfo=new TX({appId:"arcgisonline",popupCallbackUrl:r+"/home/oauth-callback.html"})})):i=Promise.resolve(),i.then(()=>{if(this._defaultOAuthInfo)return n=n.replace(/^http:/i,"https:"),_i(n+"/sharing/rest/oauth2/validateRedirectUri",{query:{accountId:o,client_id:this._defaultOAuthInfo.appId,redirect_uri:ul(this._defaultOAuthInfo.popupCallbackUrl),f:"json"}}).then(l=>{if(l.data.valid){const c=this._defaultOAuthInfo.clone();l.data.urlKey&&s?c.portalUrl="https://"+l.data.urlKey.toLowerCase()+"."+s:c.portalUrl=n,c.popup=window!==window.top||!(Ec(n,this._appOrigin)||this._gwDomains.some(h=>h.regex.test(n)&&h.regex.test(this._appOrigin))),this.oAuthInfos.push(c)}})})}_doOAuthSignIn(e,i,r,n){const s=r._oAuthCred,o={portalUrl:r.portalUrl};!r.popup&&r.preserveUrlHash&&window.location.hash&&(o.hash=window.location.hash),s.stateUID&&(o.uid=s.stateUID);const a={client_id:r.appId,response_type:s.codeVerifier?"code":"token",state:JSON.stringify(o),expiration:r.expiration,locale:r.locale,redirect_uri:this._getRedirectURI(r,!!s.codeVerifier)};r.forceLogin&&(a.force_login=!0),r.forceUserId&&r.userId&&(a.prepopulatedusername=r.userId),!r.popup&&this._doPortalSignIn(e)&&(a.redirectToUserOrgUrl=!0),s.codeVerifier&&(a.code_challenge=n||s.codeVerifier,a.code_challenge_method=n?"S256":"plain");const l=r.portalUrl.replace(/^http:/i,"https:")+"/sharing/oauth2/authorize",c=l+"?"+sx(a);if(r.popup){const h=window.open(c,"esriJSAPIOAuth",r.popupWindowFeatures);if(h)h.focus(),this._oAuthDfd.oAuthWin_=h,this._oAuthIntervalId=setInterval(()=>{if(h.closed){clearInterval(this._oAuthIntervalId),this._oAuthOnPopupHandle.remove();const d=this._oAuthDfd;if(d){const f=new G("identity-manager:user-aborted","ABORTED");d.reject(f)}}},500),this._oAuthOnPopupHandle=oy(window,["arcgis:auth:hash","arcgis:auth:location:search"],d=>{d.type==="arcgis:auth:hash"?this.setOAuthResponseHash(d.detail):this._setOAuthResponseQueryString(d.detail)});else{const d=new G("identity-manager:popup-blocked","ABORTED");this._oAuthDfd.reject(d)}}else this._rejectOnPersistedPageShow=!0,this._oAuthRedirectFunc?this._oAuthRedirectFunc({authorizeParams:a,authorizeUrl:l,resourceUrl:e,serverInfo:i,oAuthInfo:r}):window.location.href=c}_getRedirectURI(e,i){const r=window.location.href.replace(/#.*$/,"");if(e.popup)return ul(e.popupCallbackUrl);if(i){const n=Nn(r);return n.query&&["code","error","error_description","message_code","persist","state"].forEach(s=>{delete n.query[s]}),qD(n.path,n.query)}return r}}UIe.prototype.declaredClass="esri.identity.IdentityManagerBase";let Hn=class extends Sn.EventedAccessor{constructor(t){super(t),this._oAuthCred=null,this.tokenRefreshBuffer=2,t?._oAuthCred&&(this._oAuthCred=t._oAuthCred)}initialize(){this.resources=this.resources||[],this.creationTime==null&&(this.creationTime=Date.now())}refreshToken(){const t=Wt.findServerInfo(this.server),e=t?.owningSystemUrl,i=!!e&&this.scope==="server",r=i&&SX(t,Wt._legacyFed),n=t.webTierAuth,s=n&&Wt.normalizeWebTierAuth,o=i5[this.server],a=o?.[this.userId];let l,c=this.resources&&this.resources[0],h=i?Wt.findServerInfo(e):null,d={username:this.userId,password:a};if(n&&!s)return;i&&!h&&Wt.serverInfos.some(m=>(Wt._isIdProvider(e,m.server)&&(h=m),!!h));const f=h?Wt.findCredential(h.server,this.userId):null;if(!i||f){if(!r){if(i)l={serverUrl:c,token:f?.token,ssl:f&&f.ssl};else if(s)d=null,l={ssl:this.ssl};else{if(!a){let m;return c&&(c=Wt._sanitizeUrl(c),this._enqueued=1,m=Wt._enqueue(c,t,null,null,this.isAdmin,this),m.then(()=>{this._enqueued=0,this.refreshServerTokens()}).catch(()=>{this._enqueued=0})),m}this.isAdmin&&(l={isAdmin:!0})}return Wt.generateToken(i?h:t,i?null:d,l).then(m=>{this.token=m.token,this.expires=m.expires!=null?Number(m.expires):null,this.creationTime=Date.now(),this.validity=m.validity,this.emitTokenChange(),this.refreshServerTokens()}).catch(()=>{})}f?.refreshToken()}}refreshServerTokens(){this.scope==="portal"&&Wt.credentials.forEach(t=>{const e=Wt.findServerInfo(t.server),i=e?.owningSystemUrl;t!==this&&t.userId===this.userId&&i&&t.scope==="server"&&(Wt._hasSameServerInstance(this.server,i)||Wt._isIdProvider(i,this.server))&&(SX(e,Wt._legacyFed)?(t.token=this.token,t.expires=this.expires,t.creationTime=this.creationTime,t.validity=this.validity,t.emitTokenChange()):t.refreshToken())})}emitTokenChange(t){clearTimeout(this._refreshTimer);const e=this.server?Wt.findServerInfo(this.server):null,i=e?.owningSystemUrl,r=i?Wt.findServerInfo(i):null;t===!1||i&&this.scope!=="portal"&&(!r?.webTierAuth||Wt.normalizeWebTierAuth)||this.expires==null&&this.validity==null||this._startRefreshTimer(),this.emit("token-change")}destroy(){this.userId=this.server=this.token=this.expires=this.validity=this.resources=this.creationTime=null,this._oAuthCred&&(this._oAuthCred.destroy(),this._oAuthCred=null);const t=Wt.credentials.indexOf(this);t>-1&&Wt.credentials.splice(t,1),this.emitTokenChange(),this.emit("destroy")}toJSON(){const t=n6({userId:this.userId,server:this.server,token:this.token,expires:this.expires,validity:this.validity,ssl:this.ssl,isAdmin:this.isAdmin,creationTime:this.creationTime,scope:this.scope}),e=this.resources;return e&&e.length>0&&(t.resources=e.slice()),t}_startRefreshTimer(){clearTimeout(this._refreshTimer);const t=6e4*this.tokenRefreshBuffer,e=2**31-1;let i=(this.validity?this.creationTime+6e4*this.validity:this.expires)-Date.now();i<0?i=0:i>e&&(i=e),this._refreshTimer=setTimeout(this.refreshToken.bind(this),i>t?i-t:i)}};u([p()],Hn.prototype,"creationTime",void 0),u([p()],Hn.prototype,"expires",void 0),u([p()],Hn.prototype,"isAdmin",void 0),u([p()],Hn.prototype,"oAuthState",void 0),u([p()],Hn.prototype,"resources",void 0),u([p()],Hn.prototype,"scope",void 0),u([p()],Hn.prototype,"server",void 0),u([p()],Hn.prototype,"ssl",void 0),u([p()],Hn.prototype,"token",void 0),u([p()],Hn.prototype,"tokenRefreshBuffer",void 0),u([p()],Hn.prototype,"userId",void 0),u([p()],Hn.prototype,"validity",void 0),Hn=u([M("esri.identity.Credential")],Hn);class zIe extends UIe{}zIe.prototype.declaredClass="esri.identity.IdentityManager";const tx=new zIe;MNe(tx);const qOt=Object.freeze(Object.defineProperty({__proto__:null,default:tx},Symbol.toStringTag,{value:"Module"}));var WOt=Object.defineProperty,YOt=Object.getOwnPropertyDescriptor,Nte=(t,e,i,r)=>{for(var n=r>1?void 0:r?YOt(e,i):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(n=(r?o(e,i,n):o(n))||n);return r&&n&&WOt(e,i,n),n};const BIe=new TX({appId:"KojZjH6glligLidj",popup:!0,popupCallbackUrl:`${document.location.origin}${document.location.pathname}oauth-callback-api.html`});tx.registerOAuthInfos([BIe]);window.setOAuthResponseHash=t=>{tx.setOAuthResponseHash(t)};let tM=class extends we{constructor(){super(),tx.on("credential-create",t=>{const e=new Ds;e.authMode="immediate",e.load().then(()=>{this.user=e.user})})}get authenticated(){return!!this.user}signIn(){tx.getCredential(BIe.portalUrl+"/sharing",{oAuthPopupConfirmation:!1})}signOut(){tx.destroyCredentials(),this.user=null}};Nte([p()],tM.prototype,"authenticated",1);Nte([p()],tM.prototype,"user",2);tM=Nte([M("arcgis-core-template.UserStore")],tM);const XOt=tM;var ZOt=Object.defineProperty,JOt=Object.getOwnPropertyDescriptor,oT=(t,e,i,r)=>{for(var n=r>1?void 0:r?JOt(e,i):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(n=(r?o(e,i,n):o(n))||n);return r&&n&&ZOt(e,i,n),n};let Dy=class extends we{constructor(t){super(t),this.userStore=new XOt,this.canGoLive=!1,this.isLive=!1,this.isChangingLiveState=!1,this.featureLayers=[],this.toggleLiveMode=aM(async()=>{this.isChangingLiveState=!0;const e=[kD,e3];if(this.isLive)this.isLive=!1,this.view.map.removeMany(e),this.featureLayers.forEach(i=>i.visible=!0),await ume(1e3);else{this.isLive=!0,this.view.map.addMany(e),this.featureLayers.forEach(r=>r.visible=!1);const i=await Promise.all(e.map(r=>this.view.whenLayerView(r)));await Promise.all([ume(1e3),...i.map(async r=>await Tv(()=>!r.updating))])}this.isChangingLiveState=!1}),Tv(()=>this.map).then(async e=>{await e.load(),document.title=e.portalItem.title;const i=e.allLayers.find(n=>n.title==="EV stations");e3.renderer=i.renderer,e3.elevationInfo=i.elevationInfo,e3.labelingInfo=i.labelingInfo,e3.popupTemplate=i.popupTemplate;const r=e.allLayers.find(n=>n.title==="Parking");kD.renderer=r.renderer,kD.elevationInfo=r.elevationInfo,kD.popupTemplate=r.popupTemplate,this.featureLayers.push(i,r),await e.loadAll()}),this.addHandles([gl(()=>this.userStore.authenticated,()=>{this.canGoLive=this.userStore.authenticated},{initial:!0})])}};oT([p({aliasOf:"view.map"})],Dy.prototype,"map",2);oT([p({constructOnly:!0})],Dy.prototype,"view",2);oT([p({constructOnly:!0})],Dy.prototype,"userStore",2);oT([p()],Dy.prototype,"canGoLive",2);oT([p()],Dy.prototype,"isLive",2);oT([p()],Dy.prototype,"isChangingLiveState",2);Dy=oT([M("arcgis-core-template.AppStore")],Dy);const KOt=Dy;console.log(`Using ArcGIS Maps SDK for JavaScript v${d6}`);const VIe=new URLSearchParams(document.location.search.slice(1)),QOt=VIe.get("webscene")||"b500006175164ac1a6ba5f8e84a88d01",eRt=new KUe({portalItem:{id:QOt}}),Fte=new h2t({container:"viewDiv",map:eRt,camera:VIe.get("webscene")?void 0:{position:{longitude:8.55532887,latitude:47.35675923,z:1424.09201},heading:324.45,tilt:63.06}});Fte.popup.defaultPopupTemplateEnabled=!0;window.view=Fte;const tRt=new KOt({view:Fte});new eAt({container:"app",store:tRt});export{bbt as $,vPe as A,P1t as B,OTe as C,VF as D,WXe as E,nit as F,Ont as G,Tnt as H,e1t as I,Zyt as J,Xyt as K,f8 as L,Jyt as M,Nat as N,QF as O,nbt as P,APe as Q,abt as R,bYe as S,TPe as T,SPe as U,ibt as V,Hf as W,Jee as X,dbt as Y,_bt as Z,_Re as _,hTe as a,yv as a$,xbt as a0,Krt as a1,ant as a2,OQ as a3,_8 as a4,Lbt as a5,ult as a6,zPe as a7,Fbt as a8,nwt as a9,ce as aA,Tt as aB,wt as aC,zx as aD,c3t as aE,DZ as aF,$p as aG,gl as aH,dv as aI,KX as aJ,Je as aK,ne as aL,Zi as aM,wy as aN,cW as aO,vx as aP,vyt as aQ,Ji as aR,Xv as aS,Gc as aT,ps as aU,vR as aV,aM as aW,Vi as aX,bo as aY,M6 as aZ,Zr as a_,vut as aa,fht as ab,Qpt as ac,_ft as ad,dft as ae,Cp as af,Xt as ag,u as ah,p as ai,Cm as aj,M as ak,vM as al,$e as am,Qie as an,we as ao,WAt as ap,X3t as aq,Z3t as ar,kZ as as,lyt as at,li as au,G as av,Gl as aw,_i as ax,ayt as ay,sx as az,MXe as b,TC as b$,kme as b0,Zc as b1,ms as b2,O as b3,Ve as b4,dC as b5,Os as b6,iee as b7,iT as b8,Vt as b9,r3t as bA,hM as bB,Mt as bC,n8t as bD,A5e as bE,s$t as bF,pBe as bG,jx as bH,Pe as bI,ry as bJ,SJ as bK,PM as bL,uVe as bM,Uy as bN,MC as bO,xt as bP,zdt as bQ,FA as bR,Yv as bS,u$t as bT,cJ as bU,Ut as bV,KV as bW,_me as bX,VM as bY,ut as bZ,gp as b_,nn as ba,Fn as bb,v4t as bc,MP as bd,b4t as be,Pr as bf,ua as bg,ze as bh,Dp as bi,lt as bj,ye as bk,ae as bl,K as bm,E as bn,rP as bo,FAt as bp,Tn as bq,Ikt as br,Lkt as bs,zit as bt,Py as bu,sT as bv,Q5t as bw,EUt as bx,o8t as by,pt as bz,ETe as c,$Fe as c$,zi as c0,VN as c1,rie as c2,t1e as c3,p$t as c4,f$t as c5,QMt as c6,a9e as c7,Rv as c8,i$t as c9,Da as cA,Ci as cB,dM as cC,Bmt as cD,Sm as cE,a4e as cF,nt as cG,L6e as cH,Cbe as cI,fge as cJ,a6 as cK,WZ as cL,mx as cM,aP as cN,u6e as cO,j_ as cP,Vu as cQ,F6e as cR,SE as cS,k6e as cT,RIe as cU,YZ as cV,Nm as cW,qRt as cX,RNe as cY,EMt as cZ,vy as c_,t$t as ca,yx as cb,e$t as cc,YOe as cd,ie as ce,$a as cf,Sr as cg,QU as ch,Be as ci,_M as cj,pe as ck,bv as cl,Q as cm,L6 as cn,es as co,hst as cp,OMt as cq,M5 as cr,w6e as cs,q6e as ct,Tv as cu,$Mt as cv,I9t as cw,Pee as cx,p6 as cy,Sn as cz,JTe as d,XRt as d$,qye as d0,Wye as d1,cr as d2,jD as d3,xrt as d4,ks as d5,D$t as d6,Ekt as d7,Zt as d8,id as d9,FP as dA,E5e as dB,BEt as dC,l1 as dD,rh as dE,nh as dF,fv as dG,SMe as dH,Ae as dI,ex as dJ,md as dK,NMe as dL,xGt as dM,yGt as dN,pGt as dO,aCt as dP,lCt as dQ,LMt as dR,X6e as dS,hG as dT,kw as dU,Ds as dV,ire as dW,ure as dX,Nn as dY,N6 as dZ,B6e as d_,yjt as da,KMt as db,gIt as dc,Sp as dd,v5 as de,ox as df,iD as dg,IZ as dh,$Z as di,U0e as dj,LZ as dk,rMt as dl,YRe as dm,YPt as dn,Dw as dp,bM as dq,FE as dr,Bm as ds,S7 as dt,qn as du,T7 as dv,C7 as dw,O5 as dx,n_e as dy,MPt as dz,vJe as e,n4t as e$,RPt as e0,b3t as e1,w3t as e2,x3t as e3,Gu as e4,lRt as e5,y1t as e6,_1t as e7,u1t as e8,g7t as e9,bkt as eA,yst as eB,i3 as eC,rn as eD,rr as eE,bx as eF,pm as eG,hd as eH,Mn as eI,G5 as eJ,dRt as eK,bNe as eL,Ec as eM,WX as eN,pLe as eO,qZ as eP,nP as eQ,CMt as eR,aOt as eS,T_e as eT,Hs as eU,R5e as eV,_v as eW,UMt as eX,L_t as eY,m$t as eZ,SRt as e_,vk as ea,EVt as eb,b1t as ec,N3e as ed,g4e as ee,uIe as ef,JZ as eg,q9e as eh,d$t as ei,Ist as ej,Lst as ek,yM as el,XCe as em,vkt as en,_kt as eo,QR as ep,P9e as eq,uJ as er,Rx as es,jv as et,oBe as eu,y$t as ev,nBe as ew,g$t as ex,Ra as ey,AFe as ez,RJe as f,k$t as f$,s3e as f0,W$ as f1,ZBe as f2,cM as f3,YAt as f4,syt as f5,J3t as f6,Di as f7,vjt as f8,u3t as f9,ip as fA,g$ as fB,t0 as fC,p$ as fD,y$ as fE,cCt as fF,f$ as fG,_$ as fH,uCt as fI,Qy as fJ,m$ as fK,e0 as fL,v$ as fM,qv as fN,wGt as fO,T8 as fP,x8 as fQ,S8 as fR,GEt as fS,iRt as fT,SUt as fU,Jn as fV,pUt as fW,c3e as fX,kWe as fY,fUt as fZ,Dft as f_,Jc as fa,ud as fb,X6 as fc,Qv as fd,r6e as fe,i6e as ff,Ake as fg,kie as fh,zMt as fi,tZ as fj,nm as fk,Jl as fl,tUe as fm,eOt as fn,XAt as fo,mIt as fp,R5 as fq,Gy as fr,Qze as fs,dr as ft,up as fu,ul as fv,ai as fw,Ux as fx,qEt as fy,_te as fz,RK as g,zrt as g$,Ku as g0,uUt as g1,WIe as g2,Z6e as g3,are as g4,PPt as g5,Fmt as g6,kmt as g7,nx as g8,KFe as g9,nF as gA,cP as gB,s6 as gC,C4e as gD,A4e as gE,O4e as gF,R4e as gG,_e as gH,as as gI,Mp as gJ,Oa as gK,Wl as gL,zNt as gM,I6 as gN,_o as gO,un as gP,Uw as gQ,f6 as gR,pr as gS,Ms as gT,Sy as gU,jc as gV,os as gW,oGt as gX,X7 as gY,Bc as gZ,Wi as g_,oe as ga,ke as gb,be as gc,GLe as gd,iie as ge,TUt as gf,WR as gg,tjt as gh,Zv as gi,HVe as gj,pUe as gk,HRt as gl,JRt as gm,gee as gn,Udt as go,yee as gp,rOe as gq,_ee as gr,Cv as gs,nOe as gt,Mht as gu,OW as gv,Ti as gw,Wt as gx,P7 as gy,No as gz,TZe as h,b2 as h$,tK as h0,RX as h1,PX as h2,JIe as h3,rRt as h4,LC as h5,nZ as h6,QJ as h7,XJ as h8,MIt as h9,PAt as hA,t1 as hB,nFt as hC,rFt as hD,hF as hE,Bv as hF,jF as hG,XM as hH,Nc as hI,nd as hJ,mi as hK,XE as hL,Nje as hM,HJ as hN,S0e as hO,O6e as hP,l0t as hQ,Xxt as hR,FZ as hS,Nh as hT,ere as hU,LMe as hV,byt as hW,JIt as hX,o6 as hY,Mqe as hZ,Jie as h_,kIt as ha,KJ as hb,go as hc,re as hd,ue as he,Wrt as hf,Is as hg,Urt as hh,LM as hi,fs as hj,AZ as hk,mjt as hl,iG as hm,xy as hn,lOt as ho,vIe as hp,BAt as hq,Pte as hr,AM as hs,tOt as ht,m4e as hu,ekt as hv,fse as hw,sBe as hx,Pv as hy,ijt as hz,Wnt as i,cIe as i$,lG as i0,skt as i1,hle as i2,NPt as i3,ikt as i4,zu as i5,qPt as i6,nMt as i7,Gke as i8,ZPt as i9,Yve as iA,fjt as iB,Mte as iC,qC as iD,rOt as iE,uX as iF,R8 as iG,l3t as iH,_x as iI,$$t as iJ,Xf as iK,oR as iL,Jj as iM,lv as iN,J7 as iO,aMt as iP,Ic as iQ,ENe as iR,Em as iS,Bu as iT,bC as iU,O8 as iV,Djt as iW,h3t as iX,d3t as iY,i0 as iZ,w$ as i_,WPt as ia,I7 as ib,ql as ic,Mr as id,kn as ie,h7e as ig,wp as ih,Vp as ii,jw as ij,eIt as ik,v7e as il,Qr as im,ur as io,VW as ip,GW as iq,AMt as ir,y_e as is,RMt as it,PMt as iu,fUe as iv,Av as iw,W3t as ix,s3t as iy,rne as iz,lAe as j,_U as j$,Hjt as j0,jjt as j1,Gjt as j2,Ujt as j3,zjt as j4,xjt as j5,Tjt as j6,Sjt as j7,Cjt as j8,Ajt as j9,gv as jA,pGe as jB,Ju as jC,nRt as jD,RRt as jE,pkt as jF,Ei as jG,zc as jH,Xl as jI,b as jJ,Dn as jK,Xc as jL,et as jM,Re as jN,F as jO,BF as jP,Wm as jQ,it as jR,Pi as jS,Yc as jT,Te as jU,U as jV,xr as jW,Fi as jX,Mi as jY,Lt as jZ,Zy as j_,Ojt as ja,Rjt as jb,Pjt as jc,Mjt as jd,$jt as je,Ijt as jf,Ljt as jg,Q3t as jh,oM as ji,gjt as jj,ote as jk,cte as jl,_Gt as jm,vMe as jn,bGt as jo,vGt as jp,QZ as jq,Wge as jr,$te as js,iRe as jt,$u as ju,HPt as jv,gSe as jw,q4e as jx,CE as jy,lkt as jz,w0t as k,y2 as k$,o1 as k0,ec as k1,BU as k2,Gt as k3,$m as k4,Gv as k5,a1 as k6,jU as k7,fl as k8,KQ as k9,Wmt as kA,Le as kB,lGe as kC,U_ as kD,hs as kE,Bo as kF,iK as kG,Q7t as kH,FUt as kI,J6t as kJ,Z6t as kK,Y6t as kL,E2 as kM,gct as kN,X6t as kO,sr as kP,r_e as kQ,qD as kR,cne as kS,sMt as kT,jE as kU,N$t as kV,cRt as kW,Ov as kX,IMt as kY,NX as kZ,Mv as k_,VU as ka,le as kb,slt as kc,xK as kd,VC as ke,tt as kf,xU as kg,k5t as kh,eEe as ki,fQ as kj,zut as kk,Vut as kl,DNt as km,Bp as kn,i8 as ko,fLe as kp,lge as kq,IX as kr,Qx as ks,Jr as kt,fi as ku,Bi as kv,bp as kw,tn as kx,Ze as ky,br as kz,Oot as l,zht as l$,y3t as l0,Yjt as l1,a5 as l2,MMt as l3,QDe as l4,gM as l5,zp as l6,M7 as l7,ZRt as l8,XR as l9,de as lA,oue as lB,N2 as lC,oa as lD,vo as lE,VNt as lF,Ne as lG,mM as lH,v3t as lI,mv as lJ,tme as lK,RE as lL,uoe as lM,Y3e as lN,Z3e as lO,Xut as lP,ph as lQ,ER as lR,AR as lS,C3e as lT,ddt as lU,Uut as lV,Vst as lW,Oy as lX,JCe as lY,DPt as lZ,jst as l_,BPt as la,Tr as lb,uwt as lc,y6 as ld,CZ as le,q8 as lf,Ai as lg,yJ as lh,Qge as li,Njt as lj,Fjt as lk,eM as ll,Lte as lm,Ejt as ln,X2 as lo,wjt as lp,ih as lq,p3t as lr,S6 as ls,YF as lt,wn as lu,pAe as lv,Jy as lw,Vr as lx,Ft as ly,mp as lz,qAe as m,$ as m$,Lht as m0,Dht as m1,Vht as m2,Fht as m3,kht as m4,Fp as m5,Nht as m6,Ia as m7,Bht as m8,UM as m9,c$t as mA,uP as mB,Hu as mC,_$t as mD,yEe as mE,_Mt as mF,rZ as mG,bMt as mH,vMt as mI,Qf as mJ,xP as mK,aa as mL,oP as mM,om as mN,Qn as mO,$M as mP,MUt as mQ,TW as mR,js as mS,fp as mT,jPt as mU,J$t as mV,JK as mW,qx as mX,sd as mY,F_ as mZ,cn as m_,EU as ma,Ws as mb,Gst as mc,Uht as md,AU as me,Oe as mf,ld as mg,Jx as mh,uE as mi,ml as mj,ZT as mk,o4e as ml,f3t as mm,u6 as mn,by as mo,h$t as mp,l$t as mq,tie as mr,Lp as ms,xM as mt,si as mu,pl as mv,akt as mw,n3t as mx,o$t as my,a$t as mz,_Xe as n,fIt as n$,uPt as n0,Jg as n1,lte as n2,SSt as n3,gGt as n4,xSt as n5,fGt as n6,mGt as n7,$Me as n8,M$e as n9,Fr as nA,H$e as nB,eCt as nC,$$e as nD,By as nE,Nbe as nF,z7e as nG,oi as nH,sGt as nI,xa as nJ,OPt as nK,YR as nL,zUe as nM,gPt as nN,ed as nO,Ny as nP,sp as nQ,Lc as nR,pK as nS,dK as nT,Jye as nU,Xi as nV,oIt as nW,T7e as nX,Wc as nY,SWe as nZ,Z7e as n_,Kme as na,ERt as nb,zPt as nc,aRt as nd,cGe as ne,eDe as nf,$Rt as ng,MRt as nh,xkt as ni,wkt as nj,IRt as nk,PRt as nl,wme as nm,rLe as nn,QPt as no,hY as np,YEt as nq,qGt as nr,gte as ns,GGt as nt,jGt as nu,HGt as nv,wte as nw,ZEt as nx,G$e as ny,KEt as nz,Elt as o,s1 as o$,yi as o0,Si as o1,Xu as o2,ci as o3,Hr as o4,n1 as o5,i1 as o6,jLt as o7,wP as o8,qLt as o9,YX as oA,jRt as oB,ov as oC,y4e as oD,MBt as oE,fie as oF,p_e as oG,ge as oH,PIt as oI,IIt as oJ,I$t as oK,GBe as oL,Ab as oM,CF as oN,or as oO,F$t as oP,U5t as oQ,qTe as oR,qi as oS,en as oT,tCe as oU,Ki as oV,Yu as oW,G7 as oX,Sx as oY,wU as oZ,dd as o_,VLt as oa,TH as ob,GLt as oc,NUt as od,uZ as oe,$Pt as of,pZ as og,Ss as oh,Dt as oi,wBe as oj,qVe as ok,Xx as ol,ZWe as om,zh as on,Ge as oo,pi as op,IPt as oq,v6 as or,lMt as os,Fm as ot,WRt as ou,Zme as ov,e5e as ow,Cme as ox,$x as oy,Bge as oz,Lx as p,Kc as p$,Vo as p0,Qe as p1,PSe as p2,Ii as p3,xe as p4,Pa as p5,Gr as p6,w1e as p7,LIt as p8,DIt as p9,qRe as pA,GRe as pB,zee as pC,n_t as pD,jRe as pE,Uee as pF,Gne as pG,xUt as pH,ULt as pI,hK as pJ,mUt as pK,yUt as pL,xct as pM,Ect as pN,Bdt as pO,P1e as pP,nVe as pQ,vUt as pR,bUt as pS,wUt as pT,yl as pU,vE as pV,cAt as pW,od as pX,ZU as pY,kt as pZ,Kl as p_,FIt as pa,gJ as pb,na as pc,wbe as pd,H6 as pe,rt as pf,Hp as pg,Ui as ph,Ri as pi,X7t as pj,UUe as pk,wzt as pl,rm as pm,K6 as pn,E0e as po,NCe as pp,nO as pq,$be as pr,aGt as ps,LH as pt,Ce as pu,hje as pv,Ps as pw,K4 as px,_Ut as py,t6 as pz,W0t as q,Np as q$,tc as q0,Na as q1,Fu as q2,tIt as q3,IM as q4,vU as q5,ASe as q6,Q$t as q7,Ytt as q8,JXe as q9,Hy as qA,Gut as qB,Kse as qC,BDt as qD,Qu as qE,IH as qF,But as qG,zDt as qH,Nkt as qI,UPt as qJ,kPt as qK,ft as qL,vse as qM,Git as qN,J5t as qO,PJ as qP,VPt as qQ,qs as qR,iIt as qS,yF as qT,s_e as qU,tMt as qV,_se as qW,zm as qX,GZ as qY,l2e as qZ,td as q_,th as qa,sNt as qb,rNt as qc,nNt as qd,i7e as qe,W2 as qf,Sat as qg,Eat as qh,lC as qi,ku as qj,lrt as qk,Eq as ql,YQ as qm,F3e as qn,VUt as qo,R3e as qp,AW as qq,hee as qr,jX as qs,rd as qt,Hut as qu,P3e as qv,I3e as qw,qut as qx,jut as qy,Wut as qz,Xee as r,aIt as r$,tC as r0,zo as r1,GU as r2,V2e as r3,Qtt as r4,mQ as r5,_p as r6,L$t as r7,RJ as r8,HLt as r9,CX as rA,oHe as rB,YRt as rC,Skt as rD,ule as rE,Ckt as rF,gkt as rG,HCe as rH,WCe as rI,GCe as rJ,VO as rK,BO as rL,gle as rM,qst as rN,QFt as rO,F0e as rP,oMt as rQ,$ke as rR,XPt as rS,J4e as rT,n5e as rU,YCe as rV,cZ as rW,wPt as rX,rTe as rY,WYe as rZ,hl as r_,bP as ra,hx as rb,rIt as rc,v8 as rd,oF as re,elt as rf,tGt as rg,dkt as rh,zE as ri,rGt as rj,iGt as rk,fM as rl,eMt as rm,UNt as rn,yse as ro,Mf as rp,Ta as rq,d1e as rr,_jt as rs,gHe as rt,YVe as ru,rbe as rv,ey as rw,Kr as rx,D3e as ry,Zut as rz,C1t as s,t_e as s$,TWe as s0,uC as s1,Ev as s2,an as s3,nIt as s4,sIt as s5,Iv as s6,ym as s7,poe as s8,Go as s9,b6e as sA,Z as sB,sre as sC,S1e as sD,Mme as sE,QIe as sF,LPt as sG,rx as sH,VHe as sI,J7t as sJ,UL as sK,vAe as sL,qvt as sM,WVe as sN,$It as sO,wMt as sP,tse as sQ,dE as sR,NNt as sS,HE as sT,Zn as sU,UOe as sV,RC as sW,qt as sX,eAe as sY,tAe as sZ,eFt as s_,gs as sa,U5 as sb,fPt as sc,pPt as sd,wS as se,e3t as sf,dje as sg,QAe as sh,gke as si,yke as sj,C8 as sk,gUt as sl,oTt as sm,hUt as sn,APt as so,ujt as sp,gW as sq,hAt as sr,u9e as ss,Hl as st,Lm as su,Zf as sv,Yp as sw,vn as sx,sP as sy,i_e as sz,gPe as t,PC as t$,v6e as t0,zr as t1,x2 as t2,LE as t3,qEe as t4,AQ as t5,gXe as t6,B3e as t7,Yge as t8,Ebe as t9,W6 as tA,MM as tB,Y6 as tC,OM as tD,TIe as tE,MBe as tF,Vjt as tG,nmt as tH,ist as tI,est as tJ,lYe as tK,BFt as tL,zFt as tM,Ry as tN,Rkt as tO,mo as tP,sa as tQ,Azt as tR,ZQ as tS,ca as tT,FRt as tU,Ru as tV,ID as tW,hkt as tX,ore as tY,nkt as tZ,Rrt as t_,cR as ta,s8t as tb,qE as tc,b7e as td,cy as te,XU as tf,nr as tg,dVt as th,sPt as ti,sM as tj,TRt as tk,SP as tl,iFt as tm,ITe as tn,Awe as to,NIt as tp,Q_ as tq,c7e as tr,cre as ts,Zie as tt,Xmt as tu,$ue as tv,m3t as tw,bme as tx,AX as ty,KRt as tz,GTe as u,KPt as u$,Hx as u0,smt as u1,wQ as u2,Kn as u3,bmt as u4,BLt as u5,zLt as u6,jue as u7,jW as u8,Pd as u9,Pc as uA,Mc as uB,WW as uC,HW as uD,YW as uE,qW as uF,Hue as uG,sbe as uH,Uxe as uI,T6 as uJ,AJ as uK,px as uL,Nxe as uM,jWe as uN,Fy as uO,Q6 as uP,nR as uQ,iU as uR,Ibe as uS,lIt as uT,QWe as uU,V6e as uV,cPt as uW,ckt as uX,iMt as uY,oRt as uZ,Z9t as u_,gk as ua,gP as ub,LJ as uc,ME as ud,GPt as ue,IQe as uf,DJ as ug,Qye as uh,PE as ui,Tbe as uj,j7e as uk,Cy as ul,nU as um,_He as un,K$t as uo,moe as up,BNt as uq,nM as ur,Wx as us,y4t as ut,hr as uu,hIt as uv,qFe as uw,Wu as ux,R9t as uy,yk as uz,MZe as v,kjt as v$,QAt as v0,ukt as v1,$c as v2,xRt as v3,aAt as v4,Zrt as v5,vu as v6,Hi as v7,jp as v8,qm as v9,b6 as vA,_Pt as vB,yPt as vC,vPt as vD,EDe as vE,w9t as vF,P9t as vG,aCe as vH,vw as vI,que as vJ,b9t as vK,T9t as vL,_w as vM,_9t as vN,kB as vO,d4 as vP,Ma as vQ,ad as vR,gCe as vS,Bh as vT,Rgt as vU,Pgt as vV,kO as vW,ust as vX,c1e as vY,Tm as vZ,Bjt as v_,Fs as va,Nt as vb,wr as vc,uy as vd,Pm as ve,zt as vf,gt as vg,We as vh,ejt as vi,ykt as vj,Kx as vk,HC as vl,Ete as vm,iAt as vn,rAt as vo,oIe as vp,rot as vq,iAe as vr,Yk as vs,URt as vt,Kg as vu,iIe as vv,HR as vw,_P as vx,q5e as vy,D5 as vz,STe as w,q6 as w$,NAt as w0,C9e as w1,Rm as w2,VE as w3,jBe as w4,Akt as w5,Tkt as w6,PVe as w7,ojt as w8,jLe as w9,rde as wA,nde as wB,sde as wC,JPt as wD,K6t as wE,cUt as wF,Whe as wG,Jhe as wH,sUt as wI,nUt as wJ,Ift as wK,oUt as wL,aUt as wM,cce as wN,hce as wO,uce as wP,iUt as wQ,rUt as wR,Ahe as wS,_he as wT,vhe as wU,bhe as wV,zhe as wW,pde as wX,gde as wY,Ohe as wZ,fde as w_,t_t as wa,k9 as wb,U9 as wc,fkt as wd,zW as we,$v as wf,a_t as wg,w_t as wh,d_ as wi,fhe as wj,ghe as wk,uct as wl,S3t as wm,E3t as wn,C3t as wo,Fct as wp,QD as wq,kge as wr,Nhe as ws,Mhe as wt,Pke as wu,$he as wv,Yhe as ww,Ihe as wx,Uhe as wy,ide as wz,jXe as x,Px as x$,ik as x0,lUt as x1,dct as x2,pct as x3,eUt as x4,tUt as x5,t3e as x6,Q6t as x7,Fft as x8,fct as x9,hPt as xA,x6 as xB,c6e as xC,Iat as xD,dLt as xE,cv as xF,TEe as xG,uIt as xH,Ey as xI,tYe as xJ,U3 as xK,av as xL,z7 as xM,dIt as xN,cIt as xO,$7e as xP,f7e as xQ,gZ as xR,Ca as xS,a7e as xT,MJ as xU,yMt as xV,jo as xW,TE as xX,MX as xY,wLt as xZ,wut as x_,lJ as xa,fBe as xb,r$t as xc,ute as xd,kne as xe,vIt as xf,fE as xg,dJ as xh,yBe as xi,Jme as xj,gBe as xk,eF as xl,iF as xm,dP as xn,uRt as xo,s2t as xp,f2t as xq,EGt as xr,CM as xs,u1e as xt,h1e as xu,t2t as xv,nGt as xw,d2t as xx,mPt as xy,dPt as xz,lR as y,xMt as y0,SMt as y1,K5t as y2,$kt as y3,GUt as y4,r8t as y5,KGt as y6,bjt as y7,Xjt as y8,O1t as z};
