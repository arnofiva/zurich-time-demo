(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();const pOe="modulepreload",fOe=function(t,e){return new URL(t,e).href},gJ={},pe=function(e,i,r){if(!i||i.length===0)return e();const n=document.getElementsByTagName("link");return Promise.all(i.map(s=>{if(s=fOe(s,r),s in gJ)return;gJ[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let u=n.length-1;u>=0;u--){const d=n[u];if(d.href===s&&(!o||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":pOe,o||(c.as="script",c.crossOrigin=""),c.href=s,document.head.appendChild(c),o)return new Promise((u,d)=>{c.addEventListener("load",u),c.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e()).catch(s=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s})};function h(t,e,i,r){var n,s=arguments.length,o=s<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,i):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,i,o):n(e,i))||o);return s>3&&o&&Object.defineProperty(e,i,o),o}function LTt(t,e,i,r){function n(s){return s instanceof i?s:new i(function(o){o(s)})}return new(i||(i=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):n(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})}let Ey;function ie(t){return typeof Ey[t]=="function"?Ey[t]=Ey[t](globalThis):Ey[t]}Ey=globalThis.dojoConfig?.has||globalThis.esriConfig?.has?{...globalThis.dojoConfig?.has,...globalThis.esriConfig?.has}:{},ie.add=(t,e,i,r)=>((r||Ey[t]===void 0)&&(Ey[t]=e),i&&ie(t)),ie.cache=Ey,ie.add("big-integer-warning-enabled",!0),ie.add("esri-deprecation-warnings",!0),ie.add("esri-tests-disable-screenshots",!1),ie.add("esri-tests-use-full-window",!1),ie.add("esri-tests-post-to-influx",!0),(()=>{ie.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const t=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(ie.add("host-browser",t),ie.add("host-node",typeof globalThis.process=="object"&&globalThis.process.versions?.node&&globalThis.process.versions.v8),ie.add("dom",t),ie("host-browser")){const e=navigator,i=e.userAgent,r=e.appVersion,n=parseFloat(r);if(ie.add("wp",parseFloat(i.split("Windows Phone")[1])||void 0),ie.add("msapp",parseFloat(i.split("MSAppHost/")[1])||void 0),ie.add("khtml",r.includes("Konqueror")?n:void 0),ie.add("edge",parseFloat(i.split("Edge/")[1])||void 0),ie.add("opr",parseFloat(i.split("OPR/")[1])||void 0),ie.add("webkit",!ie("wp")&&!ie("edge")&&parseFloat(i.split("WebKit/")[1])||void 0),ie.add("chrome",!ie("edge")&&!ie("opr")&&parseFloat(i.split("Chrome/")[1])||void 0),ie.add("android",!ie("wp")&&parseFloat(i.split("Android ")[1])||void 0),ie.add("safari",!r.includes("Safari")||ie("wp")||ie("chrome")||ie("android")||ie("edge")||ie("opr")?void 0:parseFloat(r.split("Version/")[1])),ie.add("mac",r.includes("Macintosh")),!ie("wp")&&/(iPhone|iPod|iPad)/.test(i)){const s=RegExp.$1.replace(/P/,"p"),o=/OS ([\d_]+)/.test(i)?RegExp.$1:"1",a=parseFloat(o.replace(/_/,".").replaceAll("_",""));ie.add(s,a),ie.add("ios",a)}ie("webkit")||(!i.includes("Gecko")||ie("wp")||ie("khtml")||ie("edge")||ie.add("mozilla",n),ie("mozilla")&&ie.add("ff",parseFloat(i.split("Firefox/")[1]||i.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const t=navigator.userAgent,e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(t),i=/iPhone/i.test(t);e&&ie.add("esri-mobile",e),i&&ie.add("esri-iPhone",i),ie.add("esri-geolocation",!!navigator.geolocation)}ie.add("esri-wasm","WebAssembly"in globalThis),ie.add("esri-performance-mode-frames-between-render",20),ie.add("esri-force-performance-mode",!1),ie.add("esri-shared-array-buffer",()=>{const t="SharedArrayBuffer"in globalThis,e=globalThis.crossOriginIsolated===!1;return t&&!e}),ie.add("wasm-simd",()=>{const t=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(t))}),ie.add("esri-atomics","Atomics"in globalThis),ie.add("esri-workers","Worker"in globalThis),ie.add("web-feat:cache","caches"in globalThis),ie.add("esri-workers-arraybuffer-transfer",!ie("safari")||Number(ie("safari"))>=12),ie.add("workers-pool-size",8),ie.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),ie.add("featurelayer-simplify-payload-size-factors",[1,1,4]),ie.add("featurelayer-animation-enabled",!0),ie.add("featurelayer-snapshot-enabled",!0),ie.add("featurelayer-snapshot-point-min-threshold",8e4),ie.add("featurelayer-snapshot-point-max-threshold",4e5),ie.add("featurelayer-snapshot-point-coverage",.1),ie.add("featurelayer-advanced-symbols",!1),ie.add("featurelayer-pbf",!0),ie.add("featurelayer-pbf-statistics",!1),ie.add("feature-layers-workers",!0),ie.add("feature-polyline-generalization-factor",1),ie.add("mapview-transitions-duration",200),ie.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),ie.add("mapserver-pbf-version-support",10.81),ie.add("mapservice-popup-identify-max-tolerance",20),ie.add("heatmap-allow-raster-fallback",!1),ie.add("heatmap-force-raster",!1),ie("host-webworker")||ie("host-browser")&&(ie.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),ie.add("esri-image-decode",()=>{if("decode"in new Image){const t=new Image;return t.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void t.decode().then(()=>{ie.add("esri-image-decode",!0,!0,!0)}).catch(()=>{ie.add("esri-image-decode",!1,!0,!0)})}return!1}),ie.add("esri-url-encodes-apostrophe",()=>{const t=window.document.createElement("a");return t.href="?'",t.href.includes("?%27")}))})();let NA=class Mv{constructor(e=1){this._seed=e}set seed(e){this._seed=e??Math.random()*Mv._m}getInt(){return this._seed=(Mv._a*this._seed+Mv._c)%Mv._m,this._seed}getFloat(){return this.getInt()/(Mv._m-1)}getIntRange(e,i){return Math.round(this.getFloatRange(e,i))}getFloatRange(e,i){const r=i-e;return e+this.getInt()/Mv._m*r}};NA._m=2147483647,NA._a=48271,NA._c=0;const o4=1.5,mOe=1/o4,gOe=.5;function a4(t,e){return e?t.filter((i,r,n)=>n.findIndex(e.bind(null,i))===r):Array.from(new Set(t))}function yg(t,e,i){if(t==null&&e==null)return!0;if(t==null||e==null||t.length!==e.length)return!1;if(i){for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1}else for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function _H(t,e){let i=t.length!==e.length;i&&(t.length=e.length);for(let r=0;r<e.length;++r)t[r]!==e[r]&&(t[r]=e[r],i=!0);return i}function yOe(t,e,i){let r,n;return i?(r=e.filter(s=>!t.some(o=>i(o,s))),n=t.filter(s=>!e.some(o=>i(o,s)))):(r=e.filter(s=>!t.includes(s)),n=t.filter(s=>!e.includes(s))),{added:r,removed:n}}function _Oe(t){return t&&typeof t.length=="number"}function DTt(t,e){const i=t.length;if(i===0)return[];const r=[];for(let n=0;n<i;n+=e)r.push(t.slice(n,n+e));return r}const vOe=!!Array.prototype.fill;function NTt(t,e){if(vOe)return new Array(t).fill(e);const i=new Array(t);for(let r=0;r<t;r++)i[r]=e;return i}function bOe(t,e){e===void 0&&(e=t,t=0);const i=new Array(e-t);for(let r=t;r<e;r++)i[r-t]=r;return i}function wOe(t,e,i){const r=t.length;let n=0,s=r-1;for(;n<s;){const a=n+Math.floor((s-n)/2);e>t[a]?n=a+1:s=a}const o=t[n];return i?e>=t[r-1]?-1:o===e?n:n-1:o===e?n:-1}let Pue=class{constructor(){this.last=0}};const Mue=new Pue;function Yz(t,e,i,r){r=r||Mue;const n=Math.max(0,r.last-10);for(let o=n;o<i;++o)if(t[o]===e)return r.last=o,o;const s=Math.min(n,i);for(let o=0;o<s;++o)if(t[o]===e)return r.last=o,o;return-1}function z3(t,e,i,r){const n=i??t.length,s=Yz(t,e,n,r);if(s!==-1)return t[s]=t[n-1],i==null&&t.pop(),e}const Lh=new Set;function xOe(t,e,i=t.length,r=e.length,n,s){if(r===0||i===0)return i;Lh.clear();for(let a=0;a<r;++a)Lh.add(e[a]);n=n||Mue;const o=Math.max(0,n.last-10);for(let a=o;a<i;++a)if(Lh.has(t[a])&&(s?.push(t[a]),Lh.delete(t[a]),t[a]=t[i-1],--i,--a,Lh.size===0||i===0))return Lh.clear(),i;for(let a=0;a<o;++a)if(Lh.has(t[a])&&(s?.push(t[a]),Lh.delete(t[a]),t[a]=t[i-1],--i,--a,Lh.size===0||i===0))return Lh.clear(),i;return Lh.clear(),i}function TOe(t,e){let i=0;for(let r=0;r<t.length;++r){const n=t[r];e(n,r)&&(t[i]=n,i++)}t.length=i}function SOe(t){return t?(yJ.seed=t,()=>yJ.getFloat()):Math.random}function kTt(t,e){const i=SOe(e);for(let r=t.length-1;r>0;r--){const n=Math.floor(i()*(r+1)),s=t[r];t[r]=t[n],t[n]=s}return t}const yJ=new NA;function vH(t,e){const i=t.indexOf(e);return i!==-1?(t.splice(i,1),e):null}function UTt(t,e){const i=new Map,r=t.length;for(let n=0;n<r;n++){const s=t[n],o=e(s,n,t),a=i.get(o);a?a.push(s):i.set(o,[s])}return i}function ZO(t,e){return t!=null}const EOe=[];function $ue(t){return 32+t.length}function bH(){return 16}function Iue(t){if(!t)return 0;let e=Nue;for(const i in t)if(t.hasOwnProperty(i)){const r=t[i];switch(typeof r){case"string":e+=$ue(r);break;case"number":e+=bH();break;case"boolean":e+=4}}return e}function Lue(t){if(!t)return 0;if(Array.isArray(t))return COe(t);let e=Nue;for(const i in t)t.hasOwnProperty(i)&&(e+=Due(t[i]));return e}function COe(t){const e=t.length;if(e===0||typeof t[0]=="number")return 32+8*e;let i=Fue;for(let r=0;r<e;r++)i+=Due(t[r]);return i}function Due(t){switch(typeof t){case"object":return Lue(t);case"string":return $ue(t);case"number":return bH();case"boolean":return 4;default:return 8}}function AOe(t,e){return Fue+t.length*e}const Nue=32,Fue=32;function pC(t){return t instanceof ArrayBuffer}function wH(t){return t?.constructor?.name==="Int8Array"}function Cy(t){return t?.constructor?.name==="Uint8Array"}function kue(t){return t?.constructor?.name==="Uint8ClampedArray"}function xH(t){return t?.constructor?.name==="Int16Array"}function l4(t){return t?.constructor?.name==="Uint16Array"}function TH(t){return t?.constructor?.name==="Int32Array"}function c4(t){return t?.constructor?.name==="Uint32Array"}function AS(t){return t?.constructor?.name==="Float32Array"}function OS(t){return t?.constructor?.name==="Float64Array"}function uh(t){return!("buffer"in t)}function Jy(...t){return t.reduce((e,i)=>e+(i?uh(i)?AOe(i,bH()):i.byteLength+Uue:0),0)}const Uue=145,lu=1024;function OOe(t){return OS(t)||AS(t)||TH(t)||xH(t)||wH(t)}function ROe(t){return OS(t)||AS(t)}function POe(t){return OS(t)?179769e303:AS(t)?3402823e32:c4(t)?4294967295:l4(t)?65535:Cy(t)||kue(t)?255:TH(t)?2147483647:xH(t)?32767:wH(t)?127:256}function u4(t,e){let i;if(e)for(i in t)t.hasOwnProperty(i)&&(t[i]===void 0?delete t[i]:t[i]instanceof Object&&u4(t[i],!0));else for(i in t)t.hasOwnProperty(i)&&t[i]===void 0&&delete t[i];return t}function ye(t){if(!t||typeof t!="object"||typeof t=="function")return t;const e=Vue(t);if(e!=null)return e;if(dD(t))return t.clone();if(zue(t))return t.map(ye);if(Bue(t))return t.clone();const i={};for(const r of Object.getOwnPropertyNames(t))i[r]=ye(t[r]);return i}function Xz(t){if(!t||typeof t!="object"||typeof t=="function"||"HTMLElement"in globalThis&&t instanceof HTMLElement)return t;const e=Vue(t);if(e!=null)return e;if(zue(t)){let i=!0;const r=t.map(n=>{const s=Xz(n);return n!=null&&s==null&&(i=!1),s});return i?r:null}if(dD(t))return t.clone();if(t instanceof File||t instanceof Blob)return t;if(!Bue(t)){const i=new(Object.getPrototypeOf(t)).constructor;for(const r of Object.getOwnPropertyNames(t)){const n=t[r],s=Xz(n);if(n!=null&&s==null)return null;i[r]=s}return i}return null}function dD(t){return typeof t.clone=="function"}function zue(t){return typeof t.map=="function"&&typeof t.forEach=="function"}function Bue(t){return typeof t.notifyChange=="function"&&typeof t.watch=="function"}function _J(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function Vue(t){if(wH(t)||Cy(t)||kue(t)||xH(t)||l4(t)||TH(t)||c4(t)||AS(t)||OS(t))return t.slice();if(t instanceof Date)return new Date(t.getTime());if(t instanceof ArrayBuffer)return t.slice(0,t.byteLength);if(t instanceof Map){const e=new Map;for(const[i,r]of t)e.set(i,ye(r));return e}if(t instanceof Set){const e=new Set;for(const i of t)e.add(ye(i));return e}return null}function SH(t,e){return t===e||typeof t=="number"&&isNaN(t)&&typeof e=="number"&&isNaN(e)||typeof t?.getTime=="function"&&typeof e?.getTime=="function"&&t.getTime()===e.getTime()||!1}function Gue(t,e){return t===e||(t==null||typeof t=="string"?t===e:typeof t=="number"?t===e||typeof e=="number"&&isNaN(t)&&isNaN(e):t instanceof Date?e instanceof Date&&t.getTime()===e.getTime():Array.isArray(t)?Array.isArray(e)&&yg(t,e):t instanceof Set?e instanceof Set&&$Oe(t,e):t instanceof Map?e instanceof Map&&IOe(t,e):!!_J(t)&&_J(e)&&MOe(t,e))}function MOe(t,e){if(t===null||e===null)return!1;const i=Object.keys(t);if(e===null||Object.keys(e).length!==i.length)return!1;for(const r of i)if(t[r]!==e[r]||!Object.prototype.hasOwnProperty.call(e,r))return!1;return!0}function $Oe(t,e){if(t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0}function IOe(t,e){if(t.size!==e.size)return!1;for(const[i,r]of t){const n=e.get(i);if(n!==r||n===void 0&&!e.has(i))return!1}return!0}function LOe(t,e,i=!1){return Hue(t,e,i)}function Km(t,e){if(e!=null)return e[t]||jue(t.split("."),!1,e)}function RS(t,e,i){const r=t.split("."),n=r.pop(),s=jue(r,!0,i);s&&n&&(s[n]=e)}function jue(t,e,i){let r=i;for(const n of t){if(r==null)return;if(!(n in r)){if(!e)return;r[n]={}}r=r[n]}return r}function Hue(t,e,i){return e?Object.keys(e).reduce((r,n)=>{let s=r[n],o=e[n];return s===o?r:s===void 0?(r[n]=ye(o),r):(Array.isArray(o)||Array.isArray(r)?(s=s?Array.isArray(s)?r[n]=s.concat():r[n]=[s]:r[n]=[],o&&(Array.isArray(o)||(o=[o]),i?o.forEach(a=>{s.includes(a)||s.push(a)}):r[n]=o.concat())):o&&typeof o=="object"?r[n]=Hue(s,o,i):r.hasOwnProperty(n)&&!e.hasOwnProperty(n)||(r[n]=o),r)},t||{}):t}const Oi={apiKey:void 0,applicationName:"",applicationUrl:globalThis.location?.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!0,portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(LOe(Oi,globalThis.esriConfig,!0),delete Oi.has),!Oi.assetsPath){{const t="4.28";Oi.assetsPath=`https://js.arcgis.com/${t}/@arcgis/core/assets`}Oi.defaultAssetsPath=Oi.assetsPath}const DOe=/\{([^\}]+)\}/g;function vJ(t){return t??""}function h4(t,e){return e?t.replaceAll(DOe,typeof e=="object"?(i,r)=>vJ(Km(r,e)):(i,r)=>vJ(e(r))):t}function zTt(t,e){return t.replaceAll(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,i=>e&&e.includes(i)?i:`\\${i}`)}function que(t){let e=0;for(let i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i),e|=0;return e}function BTt(t){return new DOMParser().parseFromString(t||"","text/html").body.innerText||""}function VTt(t,e){return new RegExp(`{${e}}`,"ig").test(t)}const bJ={info:0,warn:1,error:2,none:3};let ne=class wa{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},e.level!=null&&(this.level=e.level),e.writer!=null&&(this.writer=e.writer),this._module=e.module,wa._loggers.set(this.module,this);const i=this.module.lastIndexOf(".");i!==-1&&(this._parent=wa.getLogger(this.module.slice(0,i)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){const e=this;return{loggedMessages:e._loggedMessages,clearLoggedWarnings:()=>e._loggedMessages.warn.clear()}}static get test(){return{resetLoggers(e=new Map){const i=wa._loggers;return wa._loggers=e,i},set throttlingDisabled(e){wa._throttlingDisabled=e}}}static getLogger(e){return e=typeof e!="string"?e.declaredClass:e,wa._loggers.get(e)||new wa({module:e})}_log(e,i,...r){if(this._matchLevel(e)){if(i!=="always"&&!wa._throttlingDisabled){const n=this._argsToKey(r),s=this._loggedMessages[e].get(n);if(i==="once"&&s!=null||i==="oncePerTick"&&s&&s>=wa._tickCounter)return;this._loggedMessages[e].set(n,wa._tickCounter),wa._scheduleTickCounterIncrement()}for(const n of Oi.log.interceptors)if(n(e,this.module,...r))return;this._inheritedWriter()(e,this.module,...r)}}_parentWithMember(e,i){let r=this;for(;r!=null;){const n=r[e];if(n!=null)return n;r=r.parent}return i}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(e,i,...r){console[e](`[${i}]`,...r)}_matchLevel(e){const i=Oi.log.level||"warn";return bJ[this._parentWithMember("level",i)]<=bJ[e]}_argsToKey(...e){return que(JSON.stringify(e,(r,n)=>typeof n!="object"||Array.isArray(n)?n:"[Object]"))}static _scheduleTickCounterIncrement(){wa._tickCounterScheduled||(wa._tickCounterScheduled=!0,Promise.resolve().then(()=>{wa._tickCounter++,wa._tickCounterScheduled=!1}))}};ne._loggers=new Map,ne._tickCounter=0,ne._tickCounterScheduled=!1,ne._throttlingDisabled=!1;function NOe(t,e){return t.replaceAll(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(i,r)=>r===""?"$":(Km(r,e)??"").toString())}let Wue=class{constructor(e,i,r){this.name=e,this.details=r,this.message=(i&&NOe(i,r))??""}toString(){return"["+this.name+"]: "+this.message}},W=class Yue extends Wue{constructor(e,i,r){super(e,i,r)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(e,i)=>{if(i&&typeof i=="object"&&typeof i.toJSON=="function")return i;try{return ye(i)}catch{return"[object]"}}))}}catch(e){throw ne.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new Yue(e.name,e.message,e.details)}};W.prototype.type="error";const wJ=new Set;function FOe(t,e,i=!1){i&&wJ.has(e)||(i&&wJ.add(e),t.warn(`🛑 DEPRECATED - ${e}`))}function Xue(t,e,i={}){if(ie("esri-deprecation-warnings")){const{moduleName:r}=i;RT(t,`Function: ${(r?r+"::":"")+e+"()"}`,i)}}function Ay(t,e,i={}){if(ie("esri-deprecation-warnings")){const{moduleName:r}=i;RT(t,`Property: ${(r?r+"::":"")+e}`,i)}}function RT(t,e,i={}){if(ie("esri-deprecation-warnings")){const{replacement:r,version:n,see:s,warnOnce:o}=i;let a=e;r&&(a+=`
	🛠️ Replacement: ${r}`),n&&(a+=`
	⚙️ Version: ${n}`),s&&(a+=`
	🔗 See ${s} for more details.`),FOe(t,a,o)}}function jTt(t){const e=[];return function*(){yield*e;for(const i of t)e.push(i),yield i}}function kOe(t,e){for(const i of t)if(i!=null&&e(i))return i}function Zz(t){return t!=null&&typeof t[Symbol.iterator]=="function"}let Dg=class Jz{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(i=>{e+=i.length}),e}add(e,i){if(Zz(e)){const r=this._getOrCreateGroup(i);for(const n of e)this._isHandle(n)&&r.push(n)}else this._isHandle(e)&&this._getOrCreateGroup(i).push(e);return this}forEach(e,i){if(typeof e=="function")this._groups.forEach(r=>r.forEach(e));else{const r=this._getGroup(e);r&&i&&r.forEach(i)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(typeof e!="string"&&Zz(e)){for(const i of e)this.remove(i);return this}return this.has(e)?(this._removeAllFromGroup(this._getGroup(e)),this._groups.delete(this._ensureGroupKey(e)),this):this}removeAll(){return this._groups.forEach(e=>this._removeAllFromGroup(e)),this._groups.clear(),this}_isHandle(e){return e&&(!!e.remove||e instanceof Jz)}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const i=[];return this._groups.set(this._ensureGroupKey(e),i),i}_getGroup(e){return this._groups.get(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}_removeAllFromGroup(e){for(const i of e)i instanceof Jz?i.removeAll():i.remove()}};function d4(t,e){if(t==null)throw new Error(e??"value is None")}function Pe(t){return t?.destroy(),null}function et(t){return t?.dispose(),null}function pr(t){return t?.remove(),null}function nc(t){return t?.abort(),null}function Jt(t){return t?.release(),null}function HTt(t,e,i){return t!=null&&e!=null?i!=null?i(t,e):t.equals(e):t===e}function xJ(t,e){return t?.[e]}const Zue=Symbol("Accessor-beforeDestroy"),UOe={remove:()=>{}};function Mi(t){return t?{remove(){t&&(t(),t=void 0)}}:UOe}function zOe(t){t.forEach(e=>e?.remove())}function db(t){return Mi(()=>zOe(t))}function Jue(t){return Mi(t!=null?()=>t.destroy():void 0)}function cu(t){return t.__accessor__??null}function BOe(t,e){return t?.metadatas?.[e]!=null}function pI(t,e,i){return i?pD(t,e,{policy:i,path:""}):pD(t,e,null)}function pD(t,e,i){return e?Object.keys(e).reduce((r,n)=>{const s=n;let o=null,a="merge";if(i&&(o=i.path?`${i.path}.${n}`:n,a=i.policy(o)),a==="replace"||a==="replace-arrays"&&Array.isArray(r[s]))return r[s]=e[s],r;if(r[s]===void 0)return r[s]=ye(e[s]),r;let l=r[s],c=e[s];if(l===c)return r;if(Array.isArray(c)||Array.isArray(r))l=l?Array.isArray(l)?r[s]=l.concat():r[s]=[l]:r[s]=[],c&&(Array.isArray(c)||(c=[c]),c.forEach(u=>{l.includes(u)||l.push(u)}));else if(c&&typeof c=="object")if(i){const u=i.path;i.path=o,r[s]=pD(l,c,i),i.path=u}else r[s]=pD(l,c,null);else r.hasOwnProperty(n)&&!e.hasOwnProperty(n)||(r[s]=c);return r},t||{}):t}function Kue(t){return Array.isArray(t)?t:t.split(".")}function TJ(t){return t.includes(",")?t.split(",").map(e=>e.trim()):[t.trim()]}function VOe(t){if(Array.isArray(t)){const e=[];for(const i of t)e.push(...TJ(i));return e}return TJ(t)}function Que(t,e,i,r){const n=VOe(e);if(n.length!==1){const s=n.map(o=>r(t,o,i));return db(s)}return r(t,n[0],i)}function ehe(t,e){const i=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const n=parseInt(i,10);if(!isNaN(n))return Array.isArray(e)?e[n]:e.at(n)}const r=cu(e);return BOe(r,i)?r.get(i):e[i]}function the(t,e,i){if(t==null)return t;const r=ehe(e[i],t);return!r&&i<e.length-1?void 0:i===e.length-1?r:the(r,e,i+1)}function JO(t,e,i=0){return typeof e!="string"||e.includes(".")?the(t,Kue(e),i):ehe(e,t)}function Ld(t,e){return JO(t,e)}function SJ(t,e){return JO(e,t)!==void 0}function KO(t){let e=t.constructor.__accessorMetadata__;const i=Object.prototype.hasOwnProperty.call(t.constructor,"__accessorMetadata__");if(e){if(!i){e=Object.create(e);for(const r in e)e[r]=ye(e[r]);Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0})}}else e={},Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0});return t.constructor.__accessorMetadata__}function p4(t,e){const i=KO(t);let r=i[e];return r||(r=i[e]={}),r}function GOe(t,e){return pI(t,e,HOe)}const jOe=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function HOe(t){return jOe.test(t)?"replace":"merge"}function qOe(t){return t?.release&&typeof t.release=="function"}function WOe(t){return t?.acquire&&typeof t.acquire=="function"}let aa=class Kz{constructor(e,i,r,n=1,s=0){if(this._ctor=e,this._acquireFunction=i,this._releaseFunction=r,this.allocationSize=n,this._pool=new Array(s),this._initialSize=s,this._ctor)for(let o=0;o<s;o++)this._pool[o]=new this._ctor;this.allocationSize=Math.max(n,1)}destroy(){this.prune(0)}acquire(...e){let i;if(Kz.test.disabled)i=new this._ctor;else{if(this._pool.length===0){const r=this.allocationSize;for(let n=0;n<r;n++)this._pool[n]=new this._ctor}i=this._pool.pop()}return this._acquireFunction?this._acquireFunction(i,...e):WOe(i)&&i.acquire(...e),i}release(e){e&&!Kz.test.disabled&&(this._releaseFunction?this._releaseFunction(e):qOe(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let i=e;i<this._pool.length;++i){const r=this._pool[i];this._dispose(r)}this._pool.length=e}}_dispose(e){e.dispose&&typeof e.dispose=="function"&&e.dispose()}};aa.test={disabled:!1};var Xm;(function(t){t[t.INITIALIZING=0]="INITIALIZING",t[t.CONSTRUCTING=1]="CONSTRUCTING",t[t.CONSTRUCTED=2]="CONSTRUCTED"})(Xm||(Xm={}));let YOe=class{constructor(e,i){this._observers=e,this._observer=i}remove(){vH(this._observers,this._observer)}},ihe=class{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return XOe;this._observers==null&&(this._observers=[]);const i=this._observers;let r=!1,n=!1;const s=i.length;for(let o=0;o<s;++o){const a=i[o];if(a.destroyed)n=!0;else if(a===e){r=!0;break}}return r||(i.push(e),n&&this._removeDestroyedObservers()),new YOe(i,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||e.length===0)return;const i=e.length;let r=0;for(let n=0;n<i;++n){for(;n+r<i&&e[n+r].destroyed;)++r;if(r>0){if(!(n+r<i))break;e[n]=e[n+r]}}e.length=i-r}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(e!=null){for(const i of e)i.onCommitted();this._observers=null}}};const XOe=Mi();var gi;(function(t){t[t.DEFAULTS=0]="DEFAULTS",t[t.COMPUTED=1]="COMPUTED",t[t.SERVICE=2]="SERVICE",t[t.PORTAL_ITEM=3]="PORTAL_ITEM",t[t.WEB_SCENE=4]="WEB_SCENE",t[t.WEB_MAP=5]="WEB_MAP",t[t.LINK_CHART=6]="LINK_CHART",t[t.USER=7]="USER"})(gi||(gi={}));const Qz=gi.USER+1;function Oy(t){switch(t){case"defaults":return gi.DEFAULTS;case"service":return gi.SERVICE;case"portal-item":return gi.PORTAL_ITEM;case"web-scene":return gi.WEB_SCENE;case"web-map":return gi.WEB_MAP;case"link-chart":return gi.LINK_CHART;case"user":return gi.USER;default:return null}}function fD(t){switch(t){case gi.DEFAULTS:return"defaults";case gi.SERVICE:return"service";case gi.PORTAL_ITEM:return"portal-item";case gi.WEB_SCENE:return"web-scene";case gi.WEB_MAP:return"web-map";case gi.LINK_CHART:return"link-chart";case gi.USER:return"user"}}function ZOe(t){return fD(t)}var Cr;(function(t){t[t.Dirty=1]="Dirty",t[t.Overriden=2]="Overriden",t[t.Computing=4]="Computing",t[t.NonNullable=8]="NonNullable",t[t.HasDefaultValue=16]="HasDefaultValue",t[t.DepTrackingInitialized=32]="DepTrackingInitialized",t[t.AutoTracked=64]="AutoTracked",t[t.ExplicitlyTracking=128]="ExplicitlyTracking"})(Cr||(Cr={}));const mD={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},fC=[];let FA=mD;function Ct(t){FA.onObservableAccessed(t)}let fI=!1,mI=!1;function _g(t,e,i){if(fI)return EH(t,e,i);rhe(t);const r=e.call(i);return nhe(),r}function JOe(t,e){return _g(mD,t,e)}function EH(t,e,i){const r=fI;fI=!0,rhe(t);let n=null;try{n=e.call(i)}catch(s){mI&&ne.getLogger("esri.core.accessorSupport.tracking").error(s)}return nhe(),fI=r,n}function rhe(t){FA=t,fC.push(t)}function nhe(){const t=fC.length;if(t>1){const e=fC.pop();FA=fC[t-2],e.onTrackingEnd()}else if(t===1){const e=fC.pop();FA=mD,e.onTrackingEnd()}else FA=mD}function she(t,e){if(e.flags&Cr.DepTrackingInitialized)return;const i=mI;mI=!1,e.flags&Cr.AutoTracked?EH(e,e.metadata.get,t):ohe(t,e),mI=i}const KOe=[];function ohe(t,e){e.flags&Cr.ExplicitlyTracking||(e.flags|=Cr.ExplicitlyTracking,EH(e,()=>{const i=e.metadata.dependsOn||KOe;for(const r of i)if(typeof r!="string"||r.includes(".")){const n=Kue(r);for(let s=0,o=t;s<n.length&&o!=null&&typeof o=="object";++s)o=EJ(o,n[s],s!==n.length-1)}else EJ(t,r,!1)}),e.flags&=~Cr.ExplicitlyTracking)}function EJ(t,e,i){const r=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const s=parseInt(r,10);if(!isNaN(s))return Array.isArray(t)?t[s]:t.at(s)}const n=cu(t);if(n){const s=n.propertiesByName.get(r);s&&(Ct(s),she(t,s))}return i?t[r]:void 0}let CJ=class extends ihe{constructor(e,i){super(),this.propertyName=e,this.metadata=i,this._accessed=null,this._handles=null,this.flags=0,this.flags=Cr.Dirty|(i.nonNullable?Cr.NonNullable:0)|(i.hasOwnProperty("value")?Cr.HasDefaultValue:0)|(i.get===void 0?Cr.DepTrackingInitialized:0)|(i.dependsOn===void 0?Cr.AutoTracked:0)}destroy(){this.flags&Cr.Dirty&&this.onCommitted(),super.destroy(),this._accessed=null,this._clearObservationHandles()}getComputed(e){Ct(this);const i=e.store,r=this.propertyName,n=this.flags,s=i.get(r);if(n&Cr.Computing||~n&Cr.Dirty&&i.has(r))return s;this.flags|=Cr.Computing;const o=e.host;let a;n&Cr.AutoTracked?a=_g(this,this.metadata.get,o):(ohe(o,this),a=this.metadata.get.call(o)),i.set(r,a,gi.COMPUTED);const l=i.get(r);return l===s?this.flags&=~Cr.Dirty:JOe(this.commit,this),this.flags&=~Cr.Computing,l}onObservableAccessed(e){if(e===this)return;let i=this._accessed;if(i==null)i=[],this._accessed=i;else if(i.includes(e))return;i.push(e)}onTrackingEnd(){this._clearObservationHandles(),this.flags|=Cr.DepTrackingInitialized;const e=this._accessed;if(e==null||e.length===0)return;let i=this._handles;i==null&&(i=[],this._handles=i);for(let r=0;r<e.length;++r)i.push(e[r].observe(this));e.length=0}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}commit(){this.flags&=~Cr.Dirty,this.onCommitted()}_clearObservationHandles(){const e=this._handles;if(e!==null){for(let i=0;i<e.length;++i)e[i].remove();e.length=0}}onInvalidated(){~this.flags&Cr.Overriden&&(this.flags|=Cr.Dirty);const e=this._observers;if(e&&e.length>0)for(const i of e)i.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onCommitted()}}},QOe=class ahe{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new ahe;return this._values.forEach((r,n)=>{e&&e.has(n)||i.set(n,ye(r))}),i}get(e){return this._values.get(e)}originOf(){return gi.USER}keys(){return[...this._values.keys()]}set(e,i){this._values.set(e,i)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}};function oP(t,e,i){return t!==void 0}function AJ(t,e,i,r){return t!==void 0&&(!(i==null&&t.flags&Cr.NonNullable)||(r.lifecycle,Xm.INITIALIZING,!1))}function eRe(t){return t&&typeof t.destroy=="function"}ne.getLogger("esri.core.accessorSupport.Properties");let tRe=class{constructor(e){this.host=e,this.propertiesByName=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=Xm.INITIALIZING,this.store=new QOe,this._origin=gi.USER;const i=this.host.constructor.__accessorMetadata__;for(const r in i){const n=new CJ(r,i[r]);this.propertiesByName.set(r,n)}this.metadatas=i}initialize(){this.lifecycle=Xm.CONSTRUCTING}constructed(){this.lifecycle=Xm.CONSTRUCTED}destroy(){this.destroyed=!0;for(const[e,i]of this.propertiesByName){if(i.metadata.autoDestroy){const r=this.internalGet(e);r&&eRe(r)&&(r.destroy(),~i.flags&Cr.NonNullable&&this._internalSet(i,null))}i.destroy()}}get initialized(){return this.lifecycle!==Xm.INITIALIZING}get(e){const i=this.propertiesByName.get(e);if(i.metadata.get)return i.getComputed(this);Ct(i);const r=this.store;return r.has(e)?r.get(e):i.metadata.value}originOf(e){const i=this.store.originOf(e);if(i===void 0){const r=this.propertiesByName.get(e);if(r!==void 0&&r.flags&Cr.HasDefaultValue)return"defaults"}return fD(i)}has(e){return!!this.propertiesByName.has(e)&&this.store.has(e)}keys(){return[...this.propertiesByName.keys()]}internalGet(e){const i=this.propertiesByName.get(e);if(oP(i))return this.store.has(e)?this.store.get(e):i.metadata.value}internalSet(e,i){const r=this.propertiesByName.get(e);oP(r)&&this._internalSet(r,i)}getDependsInfo(e,i,r){const n=this.propertiesByName.get(i);if(!oP(n))return"";const s=new Set,o=_g({onObservableAccessed:l=>s.add(l),onTrackingEnd:()=>{}},()=>n.metadata.get?.call(e));let a=`${r}${e.declaredClass.split(".").pop()}.${i}: ${o}
`;if(s.size===0)return a;r+="  ";for(const l of s)l instanceof CJ&&(a+=`${r}${l.propertyName}: undefined
`);return a}setAtOrigin(e,i,r){const n=this.propertiesByName.get(e);if(oP(n))return this._setAtOrigin(n,i,r)}isOverridden(e){const i=this.propertiesByName.get(e);return i!==void 0&&!!(i.flags&Cr.Overriden)}clearOverride(e){const i=this.propertiesByName.get(e);i&&i.flags&Cr.Overriden&&(i.flags&=~Cr.Overriden,i.notifyChange())}override(e,i){const r=this.propertiesByName.get(e);if(!AJ(r,e,i,this))return;const n=r.metadata.cast;if(n){const s=this._cast(n,i),{valid:o,value:a}=s;if(Bk.release(s),!o)return;i=a}r.flags|=Cr.Overriden,this._internalSet(r,i)}set(e,i){const r=this.propertiesByName.get(e);if(!AJ(r,e,i,this))return;const n=r.metadata.cast;if(n){const o=this._cast(n,i),{valid:a,value:l}=o;if(Bk.release(o),!a)return;i=l}const s=r.metadata.set;s?s.call(this.host,i):this._internalSet(r,i)}setDefaultOrigin(e){this._origin=Oy(e)}getDefaultOrigin(){return fD(this._origin)}notifyChange(e){const i=this.propertiesByName.get(e);i!==void 0&&i.notifyChange()}invalidate(e){const i=this.propertiesByName.get(e);i!==void 0&&i.invalidate()}commit(e){const i=this.propertiesByName.get(e);i!==void 0&&i.commit()}_internalSet(e,i){const r=this.lifecycle!==Xm.INITIALIZING?this._origin:gi.DEFAULTS;this._setAtOrigin(e,i,r)}_setAtOrigin(e,i,r){const n=this.store,s=e.propertyName;n.has(s,r)&&SH(i,n.get(s))&&~e.flags&Cr.Overriden&&r===n.originOf(s)||(e.invalidate(),n.set(s,i,r),e.commit(),she(this.host,e))}_cast(e,i){const r=Bk.acquire();return r.valid=!0,r.value=i,e&&(r.value=e.call(this.host,i,r)),r}},iRe=class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}};const Bk=new aa(iRe);function gD(t,e,i){if(t&&e)if(typeof e=="object")for(const r of Object.getOwnPropertyNames(e))gD(t,r,e[r]);else{if(e.includes(".")){const n=e.split("."),s=n.splice(-1,1)[0];return void gD(Ld(t,n),s,i)}const r=t.__accessor__;r!=null&&rRe(e,r),t[e]=i}}function rRe(t,e){if(ie("esri-unknown-property-errors")&&!nRe(t,e))throw new W("set:unknown-property",sRe(t,e))}function nRe(t,e){return e.metadatas[t]!=null}function sRe(t,e){return"setting unknown property '"+t+"' on instance of "+e.host.declaredClass}let oRe;function aRe(){return oRe}var OJ;(function(t){t[t.Ignore=0]="Ignore",t[t.Destroy=1]="Destroy",t[t.ThrowError=2]="ThrowError"})(OJ||(OJ={}));function lRe(t){t.length=0}let Hl=class{constructor(e=50,i=50){this._pool=new aa(Array,void 0,lRe,i,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return Vk.acquire()}static release(e){return Vk.release(e)}static prune(){Vk.prune()}};const Vk=new Hl(100);let lhe=class extends aa{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=null}acquire(...e){const i=super.acquire(...e);return this._set.delete(i),i}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}};const aP=[];function PT(t){aP.push(t),aP.length===1&&queueMicrotask(()=>{const e=aP.slice();aP.length=0;for(const i of e)i()})}let Qm=class{constructor(e,i=30){this.name=e,this._counter=0,this._samples=new Array(i)}record(e){e!=null&&(this._samples[++this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort((e,i)=>e-i)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((e,i)=>e+i,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var eB;(function(t){const e=(s,o,a,l)=>{let c=o,u=o;const d=a>>>1,p=s[c-1];for(;u<=d;){u=c<<1,u<a&&l(s[u-1],s[u])<0&&++u;const m=s[u-1];if(l(m,p)<=0)break;s[c-1]=m,c=u}s[c-1]=p},i=(s,o)=>s<o?-1:s>o?1:0;function r(s,o,a,l){o===void 0&&(o=0),a===void 0&&(a=s.length),l===void 0&&(l=i);for(let u=a>>>1;u>o;u--)e(s,u,a,l);const c=o+1;for(let u=a-1;u>o;u--){const d=s[o];s[o]=s[u],s[u]=d,e(s,c,u,l)}}function*n(s,o,a,l){o===void 0&&(o=0),a===void 0&&(a=s.length),l===void 0&&(l=i);for(let u=a>>>1;u>o;u--)e(s,u,a,l),yield;const c=o+1;for(let u=a-1;u>o;u--){const d=s[o];s[o]=s[u],s[u]=d,e(s,c,u,l),yield}}t.sort=r,t.iterableSort=n})(eB||(eB={}));const RJ=eB,cRe=1.5,uRe=1.1;let It=class{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new Pue,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),e.deallocator!==void 0&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>PJ(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const i=new Array;for(let r=0;r<this._length;r++){const n=this.data[r];e(n)&&i.push(n)}return i}at(e){if((e=Math.trunc(e)||0)<0&&(e+=this._length),!(e<0||e>=this._length))return this.data[e]}includes(e,i){const r=this.data.indexOf(e,i);return r!==-1&&r<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let i=e;i<this._length;++i)this.data[i]=this._deallocator(this.data[i]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,i=e.length){for(let r=0;r<i;r++)this.data[this._length++]=e[r]}fill(e,i){for(let r=0;r<i;r++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,PJ(this)}pop(){if(this.length===0)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const i=Yz(this.data,e,this.length,this._hint);if(i!==-1)return this.data.splice(i,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex(Yz(this.data,e,this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,i=e.length,r){this.length=xOe(this.data,e,this.length,i,this._hint,r),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(e,i){if(e>=this.length||i>=this.length||e===i)return;const r=this.data[e];this.data[e]=this.data[i],this.data[i]=r}sort(e){RJ.sort(this.data,0,this.length,e)}iterableSort(e){return RJ.iterableSort(this.data,0,this.length,e)}some(e,i){for(let r=0;r<this.length;++r)if(e.call(i,this.data[r],r,this.data))return!0;return!1}find(e,i){for(let r=0;r<this.length;++r){const n=this.data[r];if(e.call(i,n,r))return n}}filterInPlace(e,i){let r=0;for(let n=0;n<this._length;++n){const s=this.data[n];e.call(i,s,n,this.data)&&(this.data[n]=this.data[r],this.data[r]=s,r++)}if(this._deallocator)for(let n=r;n<this._length;n++)this.data[n]=this._deallocator(this.data[n]);return this._length=r,this._shrink(),this}forAll(e,i){const r=this.length,n=this.data;for(let s=0;s<r;++s)e.call(i,n[s],s,n)}forEach(e,i){for(let r=0;r<this.length;++r)e.call(i,this.data[r],r,this.data)}map(e,i){const r=new Array(this.length);for(let n=0;n<this.length;++n)r[n]=e.call(i,this.data[n],n,this.data);return r}reduce(e,i){let r=i;for(let n=0;n<this.length;++n)r=e(r,this.data[n],n,this.data);return r}has(e){const i=this.length,r=this.data;for(let n=0;n<i;++n)if(r[n]===e)return!0;return!1}};function PJ(t){t.data.length>cRe*t.length&&(t.data.length=Math.floor(t.length*uRe))}function hRe(t){return{setTimeout:(e,i)=>{const r=t.setTimeout(e,i);return Mi(()=>t.clearTimeout(r))}}}const QO=hRe(globalThis);function f4(t){return t&&(typeof t.on=="function"||typeof t.addEventListener=="function")}function sg(t,e,i){if(!f4(t))throw new TypeError("target is not a Evented or EventTarget object");if("on"in t)return t.on(e,i);if(Array.isArray(e)){const r=e.slice();for(const n of r)t.addEventListener(n,i);return Mi(()=>{for(const n of r)t.removeEventListener(n,i)})}return t.addEventListener(e,i),Mi(()=>t.removeEventListener(e,i))}function che(t,e,i){if(!f4(t))throw new TypeError("target is not a Evented or EventTarget object");if("once"in t)return t.once(e,i);const r=sg(t,e,n=>{r.remove(),i.call(t,n)});return r}const dRe={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function pRe({key:t}){return dRe[t]||t}function pi(t="Aborted"){return new W("AbortError",t)}function Et(t,e="Aborted"){if(Hn(t))throw pi(e)}function m4(t){return t!=null?"aborted"in t?t:t.signal:t}function Hn(t){const e=m4(t);return e!=null&&e.aborted}function T_(t){if(Fn(t))throw t}function MJ(t){if(!Fn(t))throw t}function os(t,e){const i=m4(t);if(i!=null){if(!i.aborted)return che(i,"abort",()=>e());e()}}function eR(t,e){const i=m4(t);if(i!=null)return Et(i),che(i,"abort",()=>e(pi()))}function fRe(t,e){return m4(e)==null?t:new Promise((i,r)=>{let n=os(e,()=>r(pi()));const s=()=>{n=pr(n)};t.then(s,s),t.then(i,r)})}function Fn(t){return t?.name==="AbortError"}async function B3(t){try{return await t}catch(e){if(!Fn(e))throw e;return}}async function tSt(t,e=ne.getLogger("esri")){try{return await t}catch(i){Fn(i)||e.error(i)}}async function tR(t){if(!t)return;if(typeof t.forEach!="function"){const i=Object.keys(t),r=i.map(o=>t[o]),n=await tR(r),s={};return i.map((o,a)=>s[o]=n[a]),s}const e=t;return Promise.allSettled(e).then(i=>Array.from(e,(r,n)=>{const s=i[n];return s.status==="fulfilled"?{promise:r,value:s.value}:{promise:r,error:s.reason}}))}async function mRe(t){return(await tR(t)).filter(e=>!!e.value).map(e=>e.value)}async function $J(t){return(await Promise.allSettled(t)).filter(e=>e.status==="fulfilled").map(e=>e.value)}async function gRe(t){return(await Promise.allSettled(t)).filter(e=>e.status==="rejected").map(e=>e.reason)}function V3(t,e=void 0,i){const r=new AbortController;return os(i,()=>r.abort()),new Promise((n,s)=>{let o=setTimeout(()=>{o=0,n(e)},t);os(r,()=>{o&&(clearTimeout(o),s(pi()))})})}function dc(t){return t&&typeof t.then=="function"}function tB(t){return dc(t)?t:Promise.resolve(t)}function CH(t,e=-1){let i,r,n,s,o=null;const a=(...l)=>{if(i){r=l,s&&s.reject(pi()),s=vs();const p=s.promise;if(o){const m=o;o=null,m.abort()}return p}if(n=s||vs(),s=null,e>0){const p=new AbortController;i=tB(t(...l,p.signal));const m=i;V3(e).then(()=>{i===m&&(s?p.abort():o=p)})}else i=1,i=tB(t(...l));const c=()=>{const p=r;r=n=i=o=null,p!=null&&a(...p)},u=i,d=n;return u.then(c,c),u.then(d.resolve,d.reject),d.promise};return a}function vs(){let t,e;const i=new Promise((n,s)=>{t=n,e=s}),r=n=>{t(n)};return r.resolve=n=>t(n),r.reject=n=>e(n),r.timeout=(n,s)=>QO.setTimeout(()=>r.reject(s),n),r.promise=i,r}function iSt(t,e){return t.then(e,e)}async function IJ(t){await Promise.resolve(),Et(t)}function rSt(t){return t}function uhe(t){return 1e3*t}function nSt(t){return t}function AH(t){return .001*t}let yRe=class{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}},_Re=class{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}},iB=0,rB=0;const sE={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},nB=["prepare","preRender","render","postRender","update","finish"],sB=[],pb=new It;let vRe=class{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}};const yD={frameTasks:pb,willDispatch:!1,clearFrameTasks:bRe,dispatch:phe,executeFrameTasks:xRe};function PS(t){const e=new _Re(t);return sB.push(e),yD.willDispatch||(yD.willDispatch=!0,PT(phe)),e}function fb(t){const e=new yRe(t);return pb.push(e),_D==null&&(iB=performance.now(),_D=requestAnimationFrame(hhe)),new vRe(e)}let _D=null;function bRe(t=!1){pb.forAll(e=>{e.removed=!0}),t&&dhe()}function wRe(t){rB=Math.max(0,t)}function hhe(){const t=performance.now();_D=null,_D=pb.length>0?requestAnimationFrame(hhe):null,yD.executeFrameTasks(t)}function xRe(t){const e=t-iB;iB=t;const i=rB>0?rB:1e3/60,r=Math.max(0,e-i);sE.time=t,sE.frameDuration=i-r;for(let n=0;n<nB.length;n++){const s=performance.now(),o=nB[n];pb.forAll(a=>{a.paused||a.removed||(n===0&&a.ticks++,a.phases[o]&&(sE.elapsedFrameTime=performance.now()-t,sE.deltaTime=a.ticks===0?0:e,a.phases[o]?.call(a,sE)))}),TRe[n].record(performance.now()-s)}dhe(),SRe.record(performance.now()-t)}const lP=new It;function dhe(){pb.forAll(t=>{t.removed&&lP.push(t)}),pb.removeUnorderedMany(lP.data,lP.length),lP.clear()}function phe(){for(;sB.length;){const t=sB.shift();t.isActive&&t.callback()}yD.willDispatch=!1}function lSt(t=1,e){const i=vs(),r=()=>{Hn(e)?i.reject(pi()):t===0?i():(--t,PT(()=>r()))};return r(),i.promise}const TRe=nB.map(t=>new Qm(t)),SRe=new Qm("total");function gI(t,e){for(const i of t.entries())if(e(i[0]))return!0;return!1}function LJ(t,e){if(!e)return t;for(const i of e)t.add(i);return t}function ERe(t,e){const i=new Set;return LJ(i,t),LJ(i,e),i}function cSt(t,e){const i=new Set;for(const r of e)t.has(r)&&i.add(r);return i}function uSt(t,e){if(!t||!e)return!1;if(t===e)return!0;for(const i of t)if(!e.has(i))return!1;return!0}function hSt(t,e){if(t==null&&e==null)return!0;if(t==null||e==null||t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0}function dSt(t,e){const i=new Set(t);for(const r of e)i.delete(r);return i}let CRe=0;const ARe=0;function Kc(){return++CRe}let g4=class{constructor(e){this._accessed=[],this._handles=[],this._observerObject=new ORe(e),DJ.register(this,new WeakRef(this._observerObject),this)}destroy(){DJ.unregister(this._observerObject),this._accessed.length=0,this._observerObject?.destroy(),this.clear()}onObservableAccessed(e){const i=this._accessed;i.includes(e)||i.push(e)}onTrackingEnd(){const e=this._handles,i=this._accessed,r=this._observerObject;for(let n=0;n<i.length;++n)e.push(i[n].observe(r));i.length=0}clear(){const e=this._handles;for(let i=0;i<e.length;++i)e[i].remove();e.length=0}},ORe=class{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(e===1)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=RRe}};const DJ=new FinalizationRegistry(t=>{t.deref()?.destroy()});function RRe(){}let eT=!1;const vD=[];function fhe(t,e){let i=new g4(s),r=null,n=!1;function s(){if(!i||n)return;if(eT)return void yhe(s);const a=r;i.clear(),eT=!0,n=!0,r=_g(i,t),n=!1,eT=!1,e(r,a),_he()}function o(){i&&(i.destroy(),i=null,r=null)}return n=!0,r=_g(i,t),n=!1,Mi(o)}function mhe(t,e){let i=new g4(n),r=null;function n(){e(r,o)}function s(){i&&(i.destroy(),i=null),r=null}function o(){return i?(i.clear(),r=_g(i,t),r):null}return o(),Mi(s)}function ghe(t){let e=new g4(r),i=!1;function r(){e&&!i&&(eT?yhe(r):(e.clear(),eT=!0,i=!0,_g(e,t),i=!1,eT=!1,_he()))}function n(){e&&(e.destroy(),e=null)}return i=!0,_g(e,t),i=!1,Mi(n)}function yhe(t){vD.includes(t)||vD.unshift(t)}function _he(){for(;vD.length;)vD.pop()()}var kA;(function(t){t[t.Untracked=0]="Untracked",t[t.Tracked=1]="Tracked"})(kA||(kA={}));let G3=class{constructor(){this.uid=Kc(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,i,r,n,s){return this.pool.acquire(kA.Untracked,e,i,r,n,s,SH)}static acquireTracked(e,i,r,n){return this.pool.acquire(kA.Tracked,e,i,r,null,null,n)}notify(e,i){this.type===kA.Untracked?this.callback.call(this.target,e,i,this.path,this.target):this.callback.call(null,e,i,void 0,void 0)}acquire(e,i,r,n,s,o,a){this.uid=Kc(),this.removed=!1,this.type=e,this.oldValue=i,this.callback=r,this.getValue=n,this.target=s,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=Kc(),this.removed=!0}};G3.pool=new lhe(G3);const yI=new Hl,og=new Set;let bD;function wD(t){og.delete(t),og.add(t),bD||(bD=PS($Re))}function PRe(t){if(t.removed)return;const e=t.oldValue,i=t.getValue();t.equals(e,i)||(t.oldValue=i,t.notify(i,e))}function MRe(t){for(const e of og.values())e.target===t&&(e.removed=!0)}function $Re(){let t=10;for(;bD&&t--;){bD=null;const e=IRe(),i=yI.acquire();for(const r of e){const n=r.uid;PRe(r),n===r.uid&&r.removed&&i.push(r)}for(const r of og)r.removed&&(i.push(r),og.delete(r));for(const r of i)G3.pool.release(r);yI.release(i),yI.release(e),oB.forEach(r=>r())}}function IRe(){const t=yI.acquire();t.length=og.size;let e=0;for(const i of og)t[e]=i,++e;return og.clear(),t}const oB=new Set;function vhe(t){return oB.add(t),Mi(()=>oB.delete(t))}function LRe(t,e,i){let r=Que(t,e,i,(n,s,o)=>{let a,l,c=mhe(()=>JO(n,s),(u,d)=>{n.__accessor__.destroyed||a&&a.uid!==l?r.remove():(a||(a=G3.acquireUntracked(u,o,d,n,s),l=a.uid),wD(a))});return Mi(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,wD(a)),a=null),r=c=null})});return r}function DRe(t,e,i){const r=Que(t,e,i,(n,s,o)=>{let a=!1;return fhe(()=>JO(n,s),(l,c)=>{n.__accessor__.destroyed?r.remove():a||(a=!0,SH(c,l)||o.call(n,l,c,s,n),a=!1)})});return r}function NRe(t,e,i,r=!1){return!t.__accessor__||t.__accessor__.destroyed?Mi():r?DRe(t,e,i):LRe(t,e,i)}function FRe(t,e,i){let r,n,s=mhe(t,(o,a)=>{r&&r.uid!==n?s.remove():(r||(r=G3.acquireTracked(o,e,a,i),n=r.uid),wD(r))});return Mi(()=>{s.remove(),r&&(r.uid!==n||r.removed||(r.removed=!0,wD(r)),r=null),s=null})}function kRe(t,e,i){let r=!1;return fhe(t,(n,s)=>{r||(r=!0,i(s,n)||e(n,s),r=!1)})}function URe(t,e,i=!1,r=Gue){return i?kRe(t,e,r):FRe(t,e,r)}function NJ(t){return gI(og,e=>e.oldValue===t)}function Hc(t,e){for(const[i,r]of t)if(e(r,i))return!0;return!1}function gSt(t,e){for(const[i,r]of t)if(e(r,i))return r;return null}function bhe(t,e,i){const r=t.get(e);if(r!==void 0)return r;const n=i();return t.set(e,n),n}const tT=ne.getLogger("esri.core.accessorSupport.ensureTypes");function zRe(t){return t==null?t:new Date(t)}function BRe(t){return t==null?t:!!t}function VRe(t){return t==null?t:t.toString()}function bd(t){return t==null?t:(t=parseFloat(t),isNaN(t)?0:t)}function OH(t){return t==null?t:Math.round(parseFloat(t))}function whe(t){return t?.constructor&&t.constructor.__accessorMetadata__!==void 0}function xD(t,e){return e!=null&&t&&!(e instanceof t)}function xhe(t){return t&&"isCollection"in t}function FJ(t){return t?.Type?typeof t.Type=="function"?t.Type:t.Type.base:null}function GRe(t,e){if(!e?.constructor||!xhe(e.constructor))return aB(t,e)?e:new t(e);const i=FJ(t.prototype.itemType),r=FJ(e.constructor.prototype.itemType);return i?r?i===r?e:i.prototype.isPrototypeOf(r.prototype)?new t(e):(aB(t,e),e):new t(e):e}function aB(t,e){return!!whe(e)&&(tT.error("Accessor#set","Assigning an instance of '"+(e.declaredClass||"unknown")+"' which is not a subclass of '"+y4(t)+"'"),!0)}function MT(t,e){return e==null?e:xhe(t)?GRe(t,e):xD(t,e)?aB(t,e)?e:new t(e):e}function y4(t){return t?.prototype?.declaredClass||"unknown"}const jRe=new WeakMap;function HRe(t){switch(t){case Number:return bd;case Ln:return OH;case Boolean:return BRe;case String:return VRe;case Date:return zRe;default:return bhe(jRe,t,()=>MT.bind(null,t))}}function uo(t,e){const i=HRe(t);return arguments.length===1?i:i(e)}function j3(t,e,i){return arguments.length===1?j3.bind(null,t):e&&(Array.isArray(e)?e.map(r=>t(r,i)):[t(e,i)])}function qRe(t,e){return arguments.length===1?j3(i=>uo(t,i)):j3(i=>uo(t,i),e)}function The(t,e,i){return e!==0&&Array.isArray(i)?i.map(r=>The(t,e-1,r)):t(i)}function TD(t,e,i){if(arguments.length===2)return s=>TD(t,e,s);if(!i)return i;i=The(t,e,i);let r=e,n=i;for(;r>0&&Array.isArray(n);)r--,n=n[0];if(n!==void 0)for(let s=0;s<r;s++)i=[i];return i}function WRe(t,e,i){return arguments.length===2?TD(r=>uo(t,r),e):TD(r=>uo(t,r),e,i)}function She(t){return!!Array.isArray(t)&&!t.some(e=>{const i=typeof e;return!(i==="string"||i==="number"||i==="function"&&t.length>1)})}function lB(t,e){if(arguments.length===2)return lB(t).call(null,e);const i=new Set,r=t.filter(a=>typeof a!="function"),n=t.filter(a=>typeof a=="function");for(const a of t)typeof a!="string"&&typeof a!="number"||i.add(a);let s=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,u=c==="string"||c==="number";return u&&(i.has(a)||n.some(d=>c==="string"&&d===String||c==="number"&&d===Number))||c==="object"&&n.some(d=>!xD(a,d))?a:(u&&r.length?(s||(s=r.map(d=>typeof d=="string"?`'${d}'`:`${d}`).join(", ")),tT.error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${s}`)):typeof a=="object"&&n.length?(o||(o=n.map(d=>y4(d)).join(", ")),tT.error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):tT.error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function Ky(t,e){if(arguments.length===2)return Ky(t).call(null,e);const i={},r=[],n=[];for(const l in t.typeMap){const c=t.typeMap[l];i[l]=uo(c),r.push(y4(c)),n.push(l)}const s=()=>`'${r.join("', '")}'`,o=()=>`'${n.join("', '")}'`,a=typeof t.key=="string"?l=>l[t.key]:t.key;return l=>{if(t.base&&!xD(t.base,l)||l==null)return l;const c=a(l)||t.defaultKeyValue,u=i[c];if(!u)return tT.error("Accessor#set",`Invalid property value, value needs to be one of ${s()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!xD(t.typeMap[c],l))return l;if(typeof t.key=="string"&&!whe(l)){const d={};for(const p in l)p!==t.key&&(d[p]=l[p]);return u(d)}return u(l)}}let Ln=class{};const _St={native:t=>({type:"native",value:t}),array:t=>({type:"array",value:t}),oneOf:t=>({type:"one-of",values:t})};function YRe(t){if(!t||!("type"in t))return!1;switch(t.type){case"native":case"array":case"one-of":return!0}return!1}function Ehe(t){switch(t.type){case"native":return uo(t.value);case"array":return j3(Ehe(t.value));case"one-of":return XRe(t);default:return null}}function XRe(t){let e=null;return(i,r)=>uB(i,t)?i:(e==null&&(e=cB(t)),tT.error("Accessor#set",`Invalid property value, value needs to be of type ${e}`),r&&(r.valid=!1),null)}function cB(t){switch(t.type){case"native":switch(t.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case Ln:return"integer";case Date:return"date";default:return y4(t.value)}case"array":return`array of ${cB(t.value)}`;case"one-of":{const e=t.values.map(i=>cB(i));return`one of ${e.slice(0,-1)} or ${e[e.length-1]}`}}return"unknown"}function uB(t,e){if(t==null)return!0;switch(e.type){case"native":switch(e.value){case Number:case Ln:return typeof t=="number";case Boolean:return typeof t=="boolean";case String:return typeof t=="string"}return t instanceof e.value;case"array":return!!Array.isArray(t)&&!t.some(i=>!uB(i,e.value));case"one-of":return e.values.some(i=>uB(t,i))}}function f(t={}){return(e,i)=>{if(e===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${e.name}.${i}. Accessor does not support static properties.`);const r=Object.getOwnPropertyDescriptor(e,i),n=p4(e,i);r&&(r.get||r.set?(n.get=r.get||n.get,n.set=r.set||n.set):"value"in r&&("value"in t&&ne.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${i}" on "${e.constructor.name}" already defined in the metadata`,t),n.value=t.value=r.value)),t.readOnly!=null&&(n.readOnly=t.readOnly);const s=t.aliasOf;if(s){const l=typeof s=="string"?s:s.source,c=typeof s=="string"?null:s.overridable===!0;let u;n.dependsOn=[l],n.get=function(){let d=Ld(this,l);if(typeof d=="function"){u||(u=l.split(".").slice(0,-1).join("."));const p=Ld(this,u);p&&(d=d.bind(p))}return d},n.readOnly||(n.set=c?function(d){this._override(i,d)}:function(d){gD(this,l,d)})}const o=t.type,a=t.types;n.cast||(o?n.cast=ZRe(o):a&&(Array.isArray(a)?n.cast=j3(Ky(a[0])):n.cast=Ky(a))),GOe(n,t),t.range&&(n.cast=JRe(n.cast,t.range))}}function Che(t,e,i){const r=p4(t,i);r.json||(r.json={});let n=r.json;return e!==void 0&&(n.origins||(n.origins={}),n.origins[e]||(n.origins[e]={}),n=n.origins[e]),n}function ZRe(t){let e=0,i=t;if(YRe(t))return Ehe(t);for(;Array.isArray(i)&&i.length===1&&typeof i[0]!="string"&&typeof i[0]!="number";)i=i[0],e++;const r=i;if(She(r))return e===0?lB(r):TD(lB(r),e);if(e===1)return qRe(r);if(e>1)return WRe(r,e);const n=t;return n.from?n.from:uo(n)}function JRe(t,e){return i=>{let r=+t(i);return e.step!=null&&(r=Math.round(r/e.step)*e.step),e.min!=null&&(r=Math.max(e.min,r)),e.max!=null&&(r=Math.min(e.max,r)),r}}function KRe(t){if(t.json&&t.json.origins){const e=t.json.origins,i={"web-document":["web-scene","web-map"]};for(const r in i)if(e[r]){const n=e[r];i[r].forEach(s=>{e[s]=n}),delete e[r]}}}let mb=class extends Wue{constructor(e,i,r){super(e,i,r)}};mb.prototype.type="warning";function Ahe(t){return!!t&&t.prototype?.declaredClass&&t.prototype.declaredClass.indexOf("esri.core.Collection")===0}const hB=ne.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function kJ(t,e,i){t&&(!i&&!e.read||e.read?.reader||e.read?.enabled===!1||tPe(t)&&RS("read.reader",Ohe(t),e))}function Ohe(t){const e=t.ndimArray??0;if(e>1)return ePe(t);if(e===1)return UJ(t);if("type"in t&&Phe(t.type)){const i=t.type.prototype?.itemType?.Type,r=UJ(typeof i=="function"?{type:i}:{types:i});return(n,s,o)=>{const a=r(n,s,o);return a&&new t.type(a)}}return RH(t)}function RH(t){return"type"in t?QRe(t.type):iPe(t.types)}function QRe(t){return t.prototype.read?(e,i,r)=>{if(e==null)return e;const n=typeof e;if(n!=="object")return void hB.error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${n}'`);const s=new t;return s.read(e,r),s}:t.fromJSON}function Rhe(t,e,i,r){return r!==0&&Array.isArray(e)?e.map(n=>Rhe(t,n,i,r-1)):t(e,void 0,i)}function ePe(t){const e=RH(t),i=Rhe.bind(null,e),r=t.ndimArray??0;return(n,s,o)=>{if(n==null)return n;n=i(n,o,r);let a=r,l=n;for(;a>0&&Array.isArray(l);)a--,l=l[0];if(l!==void 0)for(let c=0;c<a;c++)n=[n];return n}}function UJ(t){const e=RH(t);return(i,r,n)=>{if(i==null)return i;if(Array.isArray(i)){const o=[];for(const a of i){const l=e(a,void 0,n);l!==void 0&&o.push(l)}return o}const s=e(i,void 0,n);return s!==void 0?[s]:void 0}}function Phe(t){if(!Ahe(t))return!1;const e=t.prototype.itemType;return!(!e||!e.Type)&&(typeof e.Type=="function"?PH(e.Type):Mhe(e.Type))}function tPe(t){return"types"in t?Mhe(t.types):PH(t.type)}function PH(t){return!Array.isArray(t)&&!!t&&t.prototype&&("read"in t.prototype||"fromJSON"in t||Phe(t))}function Mhe(t){for(const e in t.typeMap)if(!PH(t.typeMap[e]))return!1;return!0}function iPe(t){let e=null;const i=t.errorContext??"type",r=t.validate;return(n,s,o)=>{if(n==null)return n;const a=typeof n;if(a!=="object")return void hB.error(`Expected JSON value of type 'object' to deserialize, but got '${a}'`);e||(e=rPe(t));const l=t.key;if(typeof l!="string")return;const c=n[l],u=c?e[c]:t.defaultKeyValue?t.typeMap[t.defaultKeyValue]:void 0;if(!u){const p=`Type '${c||"unknown"}' is not supported`;return o?.messages&&n&&o.messages.push(new mb(`${i}:unsupported`,p,{definition:n,context:o})),void hB.error(p)}const d=new u;return d.read(n,o),r?r(d):d}}function rPe(t){const e={};for(const i in t.typeMap){const r=t.typeMap[i],n=KO(r.prototype);if(typeof t.key=="function")continue;const s=n[t.key];if(!s)continue;s.json?.type&&Array.isArray(s.json.type)&&s.json.type.length===1&&typeof s.json.type[0]=="string"&&(e[s.json.type[0]]=r);const o=s.json?.write;if(!o?.writer){e[i]=r;continue}const a=o.target,l=typeof a=="string"?a:t.key,c={};o.writer(i,c,l),c[l]&&(e[c[l]]=r)}return e}function nPe(t){if(t.json||(t.json={}),BJ(t.json),VJ(t.json),zJ(t.json),t.json.origins)for(const e in t.json.origins)BJ(t.json.origins[e]),VJ(t.json.origins[e]),zJ(t.json.origins[e]);return!0}function zJ(t){t.name&&(t.read&&typeof t.read=="object"?t.read.source===void 0&&(t.read.source=t.name):t.read={source:t.name},t.write&&typeof t.write=="object"?t.write.target===void 0&&(t.write.target=t.name):t.write={target:t.name})}function BJ(t){typeof t.read=="boolean"?t.read={enabled:t.read}:typeof t.read=="function"?t.read={enabled:!0,reader:t.read}:t.read&&typeof t.read=="object"&&t.read.enabled===void 0&&(t.read.enabled=!0)}function VJ(t){typeof t.write=="boolean"?t.write={enabled:t.write}:typeof t.write=="function"?t.write={enabled:!0,writer:t.write}:t.write&&typeof t.write=="object"&&t.write.enabled===void 0&&(t.write.enabled=!0)}function GJ(t,e){if(!e.write||e.write.writer||e.write.enabled===!1&&!e.write.overridePolicy)return;const i=t?.ndimArray??0;t&&(i===1||"type"in t&&Ahe(t.type))?e.write.writer=aPe:i>1?e.write.writer=lPe(i):e.types?Array.isArray(e.types)?e.write.writer=oPe(e.types[0]):e.write.writer=sPe(e.types):e.write.writer=H3}function sPe(t){return(e,i,r,n)=>e?$he(e,t,n)?H3(e,i,r,n):void 0:H3(e,i,r,n)}function $he(t,e,i){for(const r in e.typeMap)if(t instanceof e.typeMap[r])return!0;if(i?.messages){const r=e.errorContext??"type",n=`Values of type '${(typeof e.key!="function"?t[e.key]:t.declaredClass)??"Unknown"}' cannot be written`;i&&i.messages&&t&&i.messages.push(new W(`${r}:unsupported`,n,{definition:t,context:i})),ne.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(n)}return!1}function oPe(t){return(e,i,r,n)=>!e||!Array.isArray(e)?H3(e,i,r,n):H3(e.filter(s=>$he(s,t,n)),i,r,n)}function H3(t,e,i,r){RS(i,SD(t,r),e)}function SD(t,e){return t&&typeof t.write=="function"?t.write({},e):t&&typeof t.toJSON=="function"?t.toJSON():typeof t=="number"?ED(t):t}function ED(t){return t===-1/0?-Number.MAX_VALUE:t===1/0?Number.MAX_VALUE:isNaN(t)?null:t}function aPe(t,e,i,r){let n;t===null?n=null:t&&typeof t.map=="function"?(n=t.map(s=>SD(s,r)),typeof n.toArray=="function"&&(n=n.toArray())):n=[SD(t,r)],RS(i,n,e)}function Ihe(t,e,i){return i!==0&&Array.isArray(t)?t.map(r=>Ihe(r,e,i-1)):SD(t,e)}function lPe(t){return(e,i,r,n)=>{let s;if(e===null)s=null;else{s=Ihe(e,n,t);let o=t,a=s;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)s=[s]}RS(r,s,i)}}function cPe(t,e){return MH(t,"any",e?.origin)}function dB(t,e){return MH(t,"read",e?.origin)}function Lhe(t,e){return MH(t,"write",e?.origin)}function MH(t,e,i){let r=t?.json;if(r?.origins&&i){let n;n=i==="link-chart"?r.origins[i]&&(e==="any"||e in r.origins[i])?r.origins[i]:r.origins["web-map"]:r.origins[i],n&&(e==="any"||e in n)&&(r=n)}return r}function uPe(t){const e=hPe(t);if(t.json.origins)for(const i in t.json.origins){const r=t.json.origins[i],n=r.types?dPe(r):e;kJ(n,r,!1),r.types&&!r.write&&t.json.write&&t.json.write.enabled&&(r.write={...t.json.write}),GJ(n,r)}kJ(e,t.json,!0),GJ(e,t.json)}function hPe(t){return t.json.types?pB(t.json):t.type?Dhe(t):pB(t)}function dPe(t){return t.type?Dhe(t):pB(t)}function Dhe(t){if(!t.type)return;let e=0,i=t.type;for(;Array.isArray(i)&&!She(i);)i=i[0],e++;return{type:i,ndimArray:e}}function pB(t){if(!t.types)return;let e=0,i=t.types;for(;Array.isArray(i);)i=i[0],e++;return{types:i,ndimArray:e}}function pPe(t){nPe(t)&&(KRe(t),uPe(t))}const Gk=new Set,jk=new Set;function z(t){return e=>{t??(t="esri.core.Accessor"),e.prototype.declaredClass=t,mPe(e);const i=[],r=[];let n=e.prototype;for(;n;)n.hasOwnProperty("initialize")&&!Gk.has(n.initialize)&&(Gk.add(n.initialize),i.push(n.initialize)),n.hasOwnProperty("destroy")&&!jk.has(n.destroy)&&(jk.add(n.destroy),r.push(n.destroy)),n=Object.getPrototypeOf(n);Gk.clear(),jk.clear();const s=class extends e{constructor(...a){if(super(...a),this.constructor===s&&typeof this.postscript=="function"){if(i.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=i.length-1;l>=0;l--)i[l].call(this)}}),r.length){let l=!1;const c=this[Zue];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0,c.call(this);for(let u=0;u<r.length;u++)r[u].call(this)}}})}this.postscript(...a)}}};s.__accessorMetadata__=KO(e.prototype),s.prototype.declaredClass=t;const o=(t||"AccessorSubclass").split(".").slice(-1)[0];return Object.defineProperty(s,"name",{value:o,configurable:!0}),s}}function fPe(t,e){return e.get==null?function(){const i=this.__accessor__,r=i.propertiesByName.get(t);if(r===void 0)return;Ct(r);const n=i.store;return n.has(t)?n.get(t):r.metadata.value}:function(){const i=this.__accessor__,r=i.propertiesByName.get(t);if(r!==void 0)return r.getComputed(i)}}function mPe(t){const e=t.prototype,i=KO(e),r={};for(const n of Object.getOwnPropertyNames(i)){const s=i[n];pPe(s),r[n]={enumerable:!0,configurable:!0,get:fPe(n,s),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this)){if(a.initialized&&s.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${n}' of ${this.declaredClass}`);if(a.lifecycle===Xm.CONSTRUCTED&&s.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${n}' of ${this.declaredClass}`);a.set(n,o)}}else Object.defineProperty(this,n,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(t.prototype,r)}var Nhe,Fhe;function gPe(t){if(t==null)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return t.constructor?.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const U0=Symbol("Accessor-Handles"),fB=Symbol("Accessor-Initialized");let xe=class khe{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:i,declaredClass:r,constructor:n}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const s=this;class o extends s{constructor(...l){super(...l),this.inherited=null,n&&n.apply(this,l)}}KO(o.prototype);for(const a in e){const l=e[a];o.prototype[a]=typeof l=="function"?function(...c){const u=this.inherited;let d;this.inherited=function(...p){if(s.prototype[a])return s.prototype[a].apply(this,p)};try{d=l.apply(this,c)}catch(p){throw this.inherited=u,p}return this.inherited=u,d}:e[a]}for(const a in i){const l=gPe(i[a]);f(l)(o.prototype,a)}return z(r)(o)}constructor(...e){if(this[Nhe]=null,this[Fhe]=!1,this.constructor===khe)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const i=new tRe(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:i}),e.length>0&&this.normalizeCtorArgs&&(i.ctorArgs=this.normalizeCtorArgs.apply(this,e))}postscript(e){const i=this.__accessor__,r=i.ctorArgs||e;i.initialize(),r&&(this.set(r),i.ctorArgs=null),i.constructed(),this.initialize(),this[fB]=!0}initialize(){}[Zue](){this[U0]=Pe(this[U0])}destroy(){this.destroyed||(MRe(this),this.__accessor__.destroy(),aRe()?.onInstanceDestroy(this))}[Symbol.dispose](){this.destroy()}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[fB]}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(e){Ld(this,e)}get(e){return Xue(ne.getLogger(this),"`Accessor.get` is deprecated in favor of using optional chaining",{version:"4.28",see:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining"}),Ld(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,i){return gD(this,e,i),this}watch(e,i,r){return NRe(this,e,i,r)}addHandles(e,i){if(this.destroyed){const n=Array.isArray(e)?e:[e];for(const s of n)s.remove();return}let r=this[U0];r==null&&(r=this[U0]=new Dg),r.add(e,i)}removeHandles(e){const i=this[U0];i?.remove(e)}removeAllHandles(){const e=this[U0];e?.removeAll()}hasHandles(e){const i=this[U0];return i!=null&&i.has(e)}_override(e,i){i===void 0?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,i){i==null?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,i){return this.__accessor__.internalSet(e,i),this}};Nhe=U0,Fhe=fB;let yPe=class Uhe{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new Uhe;return this._values.forEach((r,n)=>{e&&e.has(n)||i.set(n,ye(r.value),r.origin)}),i}get(e,i){i=this._normalizeOrigin(i);const r=this._values.get(e);return i==null||r?.origin===i?r?.value:void 0}originOf(e){return this._values.get(e)?.origin??gi.USER}keys(e){e=this._normalizeOrigin(e);const i=[...this._values.keys()];return e==null?i:i.filter(r=>this._values.get(r)?.origin===e)}set(e,i,r){if((r=this._normalizeOrigin(r))===gi.DEFAULTS){const n=this._values.get(e);if(n?.origin!=null&&n.origin>r)return}this._values.set(e,new _Pe(i,r))}delete(e,i){(i=this._normalizeOrigin(i))!=null&&this._values.get(e)?.origin!==i||this._values.delete(e)}has(e,i){return(i=this._normalizeOrigin(i))!=null?this._values.get(e)?.origin===i:this._values.has(e)}forEach(e){this._values.forEach(({value:i},r)=>e(i,r))}_normalizeOrigin(e){if(e!=null)return e===gi.DEFAULTS?e:gi.USER}},_Pe=class{constructor(e,i){this.value=e,this.origin=i}};function zhe(t,e,i){e.keys().forEach(n=>{i.set(n,e.get(n),gi.DEFAULTS)});const r=t.metadatas;Object.keys(r).forEach(n=>{t.internalGet(n)&&i.set(n,t.internalGet(n),gi.DEFAULTS)})}function vPe(t,e,i){if(!t?.read||t.read.enabled===!1||!t.read.source)return!1;const r=t.read.source;if(typeof r=="string"){if(r===e||r.includes(".")&&r.indexOf(e)===0&&SJ(r,i))return!0}else for(const n of r)if(n===e||n.includes(".")&&n.indexOf(e)===0&&SJ(n,i))return!0;return!1}function bPe(t){return t&&(!t.read||t.read.enabled!==!1&&!t.read.source)}function wPe(t,e,i,r,n){let s=dB(e[i],n);bPe(s)&&(t[i]=!0);for(const o of Object.getOwnPropertyNames(e))s=dB(e[o],n),vPe(s,i,r)&&(t[o]=!0)}function xPe(t,e,i,r){const n=i.metadatas,s=cPe(n[e],r),o=s?.default;if(o===void 0)return;const a=typeof o=="function"?o.call(t,e,r):o;a!==void 0&&i.set(e,a)}const Bhe={origin:"service"};function Vhe(t,e,i=Bhe){if(!e||typeof e!="object")return;const r=cu(t),n=r.metadatas,s={};for(const o of Object.getOwnPropertyNames(e))wPe(s,n,o,e,i);r.setDefaultOrigin(i.origin);for(const o of Object.getOwnPropertyNames(s)){const a=dB(n[o],i).read,l=a?.source;let c;c=l&&typeof l=="string"?JO(e,l):e[o],a?.reader&&(c=a.reader.call(t,c,e,i)),c!==void 0&&r.set(o,c)}if(!i||!i.ignoreDefaults){r.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(n))s[o]||xPe(t,o,r,i)}r.setDefaultOrigin("user")}function TPe(t,e,i,r=Bhe){const n={...r,messages:[]};i(n),n.messages?.forEach(s=>{s.type!=="warning"||t.loaded?r?.messages&&r.messages.push(s):t.loadWarnings.push(s)})}function SPe(t,e,i,r,n){const s={};return e.write?.writer?.call(t,r,s,i,n),s}function Ghe(t,e,i,r,n,s){if(!r?.write)return!1;const o=Ld(t,i);if(!n&&r.write.overridePolicy){const a=r.write.overridePolicy.call(t,o,i,s??void 0);a!==void 0&&(n=a)}if(n||(n=r.write),!n||n.enabled===!1||n.layerContainerTypes&&s?.layerContainerType&&!n.layerContainerTypes.includes(s.layerContainerType))return!1;if((o===null&&!n.allowNull&&!n.writerEnsuresNonNull||o===void 0)&&n.isRequired){const a=new W("web-document-write:property-required",`Missing value for required property '${i}' on '${t.declaredClass}'`,{propertyName:i,target:t});return a&&s?.messages?s.messages.push(a):a&&!s&&ne.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!n.allowNull&&!n.writerEnsuresNonNull||!n.alwaysWriteDefaults&&(!e.store.multipleOriginsSupported||e.store.originOf(i)===gi.DEFAULTS)&&EPe(t,i,s,r,o)||!n.ignoreOrigin&&s?.origin&&e.store.multipleOriginsSupported&&e.store.originOf(i)<Oy(s.origin))}function EPe(t,e,i,r,n){const s=r.default;if(s===void 0)return!1;if(r.defaultEquals!=null)return r.defaultEquals(n);if(typeof s=="function"){if(Array.isArray(n)){const o=s.call(t,e,i??void 0);return yg(o,n)}return!1}return s===n}function wSt(t,e,i,r){const n=cu(t),s=n.metadatas,o=Lhe(s[e],r);return!!o&&Ghe(t,n,e,o,i,r)}function jhe(t,e,i){if(t&&typeof t.toJSON=="function"&&(!t.toJSON.isDefaultToJSON||!t.write))return pI(e,t.toJSON(i));const r=cu(t),n=r.metadatas;for(const s in n){const o=Lhe(n[s],i);if(!Ghe(t,r,s,o,void 0,i))continue;const a=Ld(t,s),l=SPe(t,o,o.write&&typeof o.write.target=="string"?o.write.target:s,a,i);Object.keys(l).length>0&&(e=pI(e,l),i?.resources?.pendingOperations?.length&&i.resources.pendingOperations.push(Promise.all(i.resources.pendingOperations).then(()=>pI(e,l,()=>"replace-arrays"))),i?.writtenProperties&&i.writtenProperties.push({target:t,propName:s,oldOrigin:ZOe(r.store.originOf(s)),newOrigin:i.origin}))}return e}const iR=t=>{let e=class extends t{constructor(...i){super(...i);const r=cu(this),n=r.store,s=new yPe;r.store=s,zhe(r,n,s)}read(i,r){Vhe(this,i,r)}write(i,r){return jhe(this,i??{},r)}toJSON(i){return this.write({},i)}static fromJSON(i,r){return CPe.call(this,i,r)}};return e=h([z("esri.core.JSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function CPe(t,e){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const i=new this;return i.read(t,e),i}function mB(t){return t&&typeof t=="object"&&"toJSON"in t&&typeof t.toJSON=="function"}let $e=class extends iR(xe){};$e=h([z("esri.core.JSONSupport")],$e);const APe=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,OPe={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function jJ(t){const e=t?.match(APe);if(!e)return null;const[,i,r,n]=e;if(!i)return null;let s=null,o=null,a=null;const{devext:l,qaext:c,www:u}=OPe;if(r)if(s=i,n)switch(n.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qa":({customBaseUrl:o,portalHostname:a}=c);break;default:return null}else({customBaseUrl:o,portalHostname:a}=u);else switch(i.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qaext":({customBaseUrl:o,portalHostname:a}=c);break;case"www":({customBaseUrl:o,portalHostname:a}=u);break;default:return null}return{customBaseUrl:o,isPortal:!1,portalHostname:a,urlKey:s}}function Hhe(t){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)}function qhe(t){const e=atob(t),i=new Uint8Array(e.length);for(let r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return i.buffer}function RPe(t){const e=new Uint8Array(t);let i="";for(let r=0;r<e.length;r++)i+=String.fromCharCode(e[r]);return btoa(i)}const PPe=ne.getLogger("esri.core.urlUtils"),MS=Oi.request,HJ="esri/config: esriConfig.request.proxyUrl is not set.",Whe=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,Yhe=/^\s*http:/i,MPe=/^\s*https:/i,$Pe=/^\s*file:/i,IPe=/:\d+$/,LPe=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,DPe=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),NPe=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");let Wl=class{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let i=this.uri.match(DPe);this.scheme=i[2]||(i[1]?"":null),this.authority=i[4]||(i[3]?"":null),this.path=i[5],this.query=i[7]||(i[6]?"":null),this.fragment=i[9]||(i[8]?"":null),this.authority!=null&&(i=this.authority.match(NPe),this.user=i[3]||null,this.password=i[4]||null,this.host=i[6]||i[7],this.port=i[9]||null)}toString(){return this.uri}};const cP={},FPe=new Wl(Oi.applicationUrl);let Ia=FPe;const kPe=UPe();let $H=kPe;const IH=()=>Ia,SSt=()=>$H;function UPe(){const t=Ia.path,e=t.substring(0,t.lastIndexOf(t.split("/")[t.split("/").length-1]));return`${`${Ia.scheme}://${Ia.host}${Ia.port!=null?`:${Ia.port}`:""}`}${e}`}function bn(t){if(!t)return null;const e={path:null,query:null},i=new Wl(t),r=t.indexOf("?");return i.query===null?e.path=t:(e.path=t.substring(0,r),e.query=F1(i.query)),i.fragment&&(e.hash=i.fragment,i.query===null&&(e.path=e.path.substring(0,e.path.length-(i.fragment.length+1)))),e}function F1(t){const e=t.split("&"),i={};for(const r of e){if(!r)continue;const n=r.indexOf("=");let s,o;n<0?(s=decodeURIComponent(r),o=""):(s=decodeURIComponent(r.slice(0,n)),o=decodeURIComponent(r.slice(n+1)));let a=i[s];typeof a=="string"&&(a=i[s]=[a]),Array.isArray(a)?a.push(o):i[s]=o}return i}function gb(t,e){return t?e&&typeof e=="function"?Object.keys(t).map(i=>encodeURIComponent(i)+"="+encodeURIComponent(e(i,t[i]))).join("&"):Object.keys(t).map(i=>{const r=t[i];if(r==null)return"";const n=encodeURIComponent(i)+"=",s=e?.[i];return s?n+encodeURIComponent(s(r)):Array.isArray(r)?r.map(o=>mB(o)?n+encodeURIComponent(JSON.stringify(o)):n+encodeURIComponent(o)).join("&"):mB(r)?n+encodeURIComponent(JSON.stringify(r)):n+encodeURIComponent(r)}).filter(i=>i).join("&"):""}function zPe(t=!1){let e,i=MS.proxyUrl;if(typeof t=="string"){e=qPe(t);const r=rR(t);r&&(i=r.proxyUrl)}else e=!!t;if(!i)throw PPe.warn(HJ),new W("urlutils:proxy-not-set",HJ);return e&&gB()&&(i=UH(i)),bn(i)}function ESt(t){const e=rR(t);let i,r;if(e){const n=LH(e.proxyUrl);i=n.path,r=n.query?F1(n.query):null}if(i){const n=bn(t);t=i+"?"+n.path;const s=gb({...r,...n.query});s&&(t=`${t}?${s}`)}return t}const oE={path:"",query:""};function LH(t){const e=t.indexOf("?");return e!==-1?(oE.path=t.slice(0,e),oE.query=t.slice(e+1)):(oE.path=t,oE.query=null),oE}function Xhe(t){return t=(t=AD(t=JPe(t=LH(t).path),!0)).toLowerCase()}function BPe(t){const e={proxyUrl:t.proxyUrl,urlPrefix:Xhe(t.urlPrefix)},i=MS.proxyRules,r=e.urlPrefix;let n=i.length;for(let s=0;s<i.length;s++){const o=i[s].urlPrefix;if(r.indexOf(o)===0){if(r.length===o.length)return-1;n=s;break}o.indexOf(r)===0&&(n=s+1)}return i.splice(n,0,e),n}function rR(t){const e=MS.proxyRules,i=Xhe(t);for(let r=0;r<e.length;r++)if(i.indexOf(e[r].urlPrefix)===0)return e[r]}function CSt(t,e){if(!t||!e)return!1;t=CD(t),e=CD(e);const i=jJ(t),r=jJ(e);return i!=null&&r!=null?i.portalHostname===r.portalHostname:i==null&&r==null&&Ul(t,e,!0)}function VPe(t,e){return t=CD(t),e=CD(e),AD(t)===AD(e)}function CD(t){const e=(t=Dd(t)).indexOf("/sharing");return e>0?t.substring(0,e):t.replace(/\/+$/,"")}function Zhe(t){const e=r=>r==null||r instanceof RegExp&&r.test(t)||typeof r=="string"&&t.startsWith(r),i=MS.interceptors;if(i){for(const r of i)if(Array.isArray(r.urls)){if(r.urls.some(e))return r}else if(e(r.urls))return r}return null}function Ul(t,e,i=!1){if(!t||!e)return!1;const r=_B(t),n=_B(e);return!(!i&&r.scheme!==n.scheme)&&r.host!=null&&n.host!=null&&r.host.toLowerCase()===n.host.toLowerCase()&&r.port===n.port}function DH(t){if(typeof t=="string"){if(!Qc(t))return!0;t=_B(t)}if(Ul(t,Ia))return!0;const e=MS.trustedServers||[];for(let i=0;i<e.length;i++){const r=GPe(e[i]);for(let n=0;n<r.length;n++)if(Ul(t,r[n]))return!0}return!1}function GPe(t){return cP[t]||(kH(t)||Pf(t)?cP[t]=[new Wl(La(t))]:cP[t]=[new Wl(`http://${t}`),new Wl(`https://${t}`)]),cP[t]}function La(t,e=$H,i){return Pf(t)?i&&i.preserveProtocolRelative?t:Ia.scheme==="http"&&Ia.authority===Nd(t).slice(2)?`http:${t}`:`https:${t}`:kH(t)?t:zf(t[0]==="/"?ZPe(e):e,t)}function NH(t,e=$H,i){if(t==null||!Qc(t))return t;const r=Dd(t),n=r.toLowerCase(),s=Dd(e).toLowerCase().replace(/\/+$/,""),o=i?Dd(i).toLowerCase().replace(/\/+$/,""):null;if(o&&s.indexOf(o)!==0)return t;const a=(d,p,m)=>(m=d.indexOf(p,m))===-1?d.length:m;let l=a(n,"/",n.indexOf("//")+2),c=-1;for(;n.slice(0,l+1)===s.slice(0,l)+"/"&&(c=l+1,l!==n.length);)l=a(n,"/",l+1);if(c===-1||o&&c<o.length)return t;t=r.slice(c);const u=s.slice(c-1).replaceAll(/[^/]+/g,"").length;if(u>0)for(let d=0;d<u;d++)t=`../${t}`;else t=`./${t}`;return t}function Dd(t){return t=eMe(t=QPe(t=KPe(t=La(t=t.trim()))))}function zf(...t){const e=t.filter(ZO);if(!e?.length)return;const i=[];if(Qc(e[0])){const n=e[0],s=n.indexOf("//");s!==-1&&(i.push(n.slice(0,s+1)),YPe(e[0])&&(i[0]+="/"),e[0]=n.slice(s+2))}else e[0][0]==="/"&&i.push("");const r=e.reduce((n,s)=>s?n.concat(s.split("/")):n,[]);for(let n=0;n<r.length;n++){const s=r[n];s===".."&&i.length>0&&i[i.length-1]!==".."?i.pop():(!s&&n===r.length-1||s&&(s!=="."||i.length===0))&&i.push(s)}return i.join("/")}function Nd(t,e=!1){if(t==null||q3(t)||Bf(t))return null;let i=t.indexOf("://");if(i===-1&&Pf(t))i=2;else{if(i===-1)return null;i+=3}const r=t.indexOf("/",i);return r!==-1&&(t=t.slice(0,r)),e&&(t=AD(t,!0)),t}function Qc(t){return Pf(t)||kH(t)}function q3(t){return t!=null&&t.slice(0,5)==="blob:"}function Bf(t){return t!=null&&t.slice(0,5)==="data:"}function FH(t){const e=Qy(t);return e&&e.isBase64?qhe(e.data):null}function Hk(t){return RPe(t).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const jPe=/^data:(.*?)(;base64)?,(.*)$/;function Qy(t){const e=t.match(jPe);if(!e)return null;const[,i,r,n]=e;return{mediaType:i,isBase64:!!r,data:n}}function Jhe(t){return t.isBase64?`data:${t.mediaType};base64,${t.data}`:`data:${t.mediaType},${t.data}`}async function ASt(t){return(await fetch(t)).blob()}function OSt(t){const e=FH(t);if(!e)return null;const i=Qy(t);return new Blob([e],{type:i.mediaType})}function RSt(t,e){HPe(t,e)}function HPe(t,e){if(!t)return!1;const i=document.createElement("a");if(!("download"in i))return!1;const r=URL.createObjectURL(t);return i.download=e,i.href=r,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r),!0}function Pf(t){return t!=null&&t[0]==="/"&&t[1]==="/"}function kH(t){return t!=null&&Whe.test(t)}function qPe(t){return t!=null&&MPe.test(t)||Ia.scheme==="https"&&Pf(t)}function WPe(t){return t!=null&&Yhe.test(t)||Ia.scheme==="http"&&Pf(t)}function YPe(t){return t!=null&&$Pe.test(t)}function UH(t){return Pf(t)?`https:${t}`:t.replace(Yhe,"https:")}function XPe(){return Ia.scheme==="http"}function gB(){return Ia.scheme==="https"}function AD(t,e=!1){return Pf(t)?t.slice(2):(t=t.replace(Whe,""),e&&t.length>1&&t[0]==="/"&&t[1]==="/"&&(t=t.slice(2)),t)}function ZPe(t){const e=t.indexOf("//"),i=t.indexOf("/",e+2);return i===-1?t:t.slice(0,i)}function zH(t){let e=0;if(Qc(t)){const r=t.indexOf("//");r!==-1&&(e=r+2)}const i=t.lastIndexOf("/");return i<e?t:t.slice(0,i+1)}function PSt(t,e){if(!t)return"";const i=bn(t).path.replace(/\/+$/,""),r=i.substring(i.lastIndexOf("/")+1);if(!e?.length)return r;const n=new RegExp(`.(${e.join("|")})$`,"ig");return r.replace(n,"")}function JPe(t){return t.endsWith("/")?t:`${t}/`}function Khe(t){return t.replace(/\/+$/,"")}function KPe(t){if(/^https?:\/\//i.test(t)){const e=LH(t);t=(t=e.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),e.query&&(t+=`?${e.query}`)}return t}function QPe(t){return t.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function eMe(t){const e=MS.httpsDomains;if(!WPe(t))return t;const i=t.indexOf("/",7);let r;if(r=i===-1?t:t.slice(0,i),r=r.toLowerCase().slice(7),IPe.test(r)){if(!r.endsWith(":80"))return t;r=r.slice(0,-3),t=t.replace(":80","")}return XPe()&&r===Ia.authority&&!LPe.test(t)||(gB()&&r===Ia.authority||e&&e.some(n=>r===n||r.endsWith(`.${n}`))||gB()&&!rR(t))&&(t=UH(t)),t}function yB(t,e,i){if(!(e&&i&&t&&Qc(t)))return t;const r=t.indexOf("//"),n=t.indexOf("/",r+2),s=t.indexOf(":",r+2),o=Math.min(n<0?t.length:n,s<0?t.length:s);return t.slice(r+2,o).toLowerCase()!==e.toLowerCase()?t:`${t.slice(0,r+2)}${i}${t.slice(o)}`}function _B(t){return typeof t=="string"?new Wl(La(t)):(t.scheme||(t.scheme=Ia.scheme),t)}function Qhe(t){return iMe.test(t)}function ede(t,e){const i=bn(t),r=Object.keys(i.query||{});return r.length>0&&e&&e.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${r.join(", ")}.`),i.path}function BH(t,e,i){const r=bn(t),n=r.query||{};return n[e]=String(i),`${r.path}?${gb(n)}`}function _I(t,e){if(!e)return t;const i=bn(t),r=i.query||{};for(const[s,o]of Object.entries(e))o!=null&&(r[s]=o);const n=gb(r);return n?`${i.path}?${n}`:i.path}function tMe(t){if(t==null)return null;const e=t.match(tde);return e?e[2]:null}function qJ(t){if(t==null)return null;const e=t.match(tde);return e?{path:e[1],extension:e[2]}:{path:t,extension:null}}async function MSt(t){return typeof t=="string"?Qy(t)??{data:t}:new Promise((e,i)=>{const r=new FileReader;r.readAsDataURL(t),r.onload=()=>e(Qy(r.result)),r.onerror=n=>i(n)})}const tde=/([^.]*)\.([^\/]*)$/,iMe=/(^data:image\/svg|\.svg$)/i,ide="20231030",rde="3a1dbcf6ca66ff827c68b22ba716b8223f3d53ec";Symbol.dispose??(Symbol.dispose=Symbol("Symbol.dispose")),Symbol.asyncDispose??(Symbol.asyncDispose=Symbol("Symbol.asyncDispose"));const nde="4.28";let li,_4=nde;_4="4.28.4";function rMe(t){li=t}function $St(t){const e=li?.findCredential(t);return e?.token?BH(t,"token",e.token):t}ie("host-webworker");const nMe=new Set(["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"]);function VH(t){const e=Nd(t,!0);return!!e&&e.endsWith(".arcgis.com")&&!nMe.has(e)&&!t.endsWith("/sharing/rest/generateToken")}function sde(t,e,i=!1,r){return new Promise((n,s)=>{if(Hn(r))return void s(WJ());let o=()=>{c(),s(new Error(`Unable to load ${e}`))},a=()=>{const u=t;c(),n(u)},l=()=>{if(!t)return;const u=t;c(),u.src="",s(WJ())};const c=()=>{ie("esri-image-decode")||(t.removeEventListener("error",o),t.removeEventListener("load",a)),o=null,a=null,t=null,r?.removeEventListener("abort",l),l=null,i&&URL.revokeObjectURL(e)};r?.addEventListener("abort",l),ie("esri-image-decode")?t.decode().then(a,o):(t.addEventListener("error",o),t.addEventListener("load",a))})}function WJ(){try{return new DOMException("Aborted","AbortError")}catch{const t=new Error;return t.name="AbortError",t}}const ode="Timeout exceeded";function sMe(){return new Error(ode)}function ISt(t){return typeof t=="object"&&!!t&&"message"in t&&t.message===ode}function oMe(t){Oi.request.crossOriginNoCorsDomains||(Oi.request.crossOriginNoCorsDomains={});const e=Oi.request.crossOriginNoCorsDomains;for(let i of t)i=i.toLowerCase(),/^https?:\/\//.test(i)?e[Nd(i)??""]=0:(e[Nd("http://"+i)??""]=0,e[Nd("https://"+i)??""]=0)}function aMe(t){const e=Oi.request.crossOriginNoCorsDomains;if(e){let i=Nd(t);if(i)return i=i.toLowerCase(),!Ul(i,IH())&&e[i]<Date.now()-36e5}return!1}async function lMe(t){const e=Oi.request.crossOriginNoCorsDomains,i=Nd(t);e&&i&&(e[i.toLowerCase()]=Date.now());const r=bn(t);t=r.path,r.query?.f==="json"&&(t+="?f=json");try{await fetch(t,{mode:"no-cors",credentials:"include"})}catch{}}async function Ii(t,e){t instanceof URL&&(t=t.toString()),e?.query instanceof URLSearchParams&&(e.query=F1(e.query.toString().replaceAll("+"," ")));const i=Bf(t),r=q3(t);r||i||(t=Dd(t));const n={url:t,requestOptions:{...e}};let s=Zhe(t);if(s){const c=await gMe(s,n);if(c!=null)return{data:c,getHeader:GH,httpStatus:200,requestOptions:n.requestOptions,url:n.url};s.after||s.error||(s=null)}if(t=n.url,(e=n.requestOptions).responseType==="image"&&(ie("host-webworker")||ie("host-node")))throw _f("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),n);if(e.method==="head"){if(e.body)throw _f("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),n);if(i||r)throw _f("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),n)}if(await pMe(),OD)return OD.execute(t,e);const o=new AbortController;os(e,()=>o.abort());const a={controller:o,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:s,params:n,redoRequest:!1,useIdentity:fd.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},l=await _Me(a);return s?.after?.(l),l}let OD;const fd=Oi.request,ade="FormData"in globalThis,cMe=new Set([499,498,403,401]),uMe=new Set(["COM_0056","COM_0057","SB_0008"]),hMe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],GH=()=>null,RD=Symbol();function dMe(t){const e=Nd(t);e&&!Ii._corsServers.includes(e)&&Ii._corsServers.push(e)}function YJ(t){const e=Nd(t);return!e||e.endsWith(".arcgis.com")||Ii._corsServers.includes(e)||DH(e)}function _f(t,e,i,r){let n="Error";const s={url:i.url,requestOptions:i.requestOptions,getHeader:GH,ssl:!1};if(e instanceof W)return e.details?(e.details=ye(e.details),e.details.url=i.url,e.details.requestOptions=i.requestOptions):e.details=s,e;if(e){const o=r&&(c=>r.headers.get(c)),a=r?.status,l=e.message;l&&(n=l),o&&(s.getHeader=o),s.httpStatus=(e.httpCode!=null?e.httpCode:e.code)||a||0,s.subCode=e.subcode,s.messageCode=e.messageCode,typeof e.details=="string"?s.messages=[e.details]:s.messages=e.details,s.raw=RD in e?e[RD]:e}return Fn(e)?pi():new W(t,n,s)}async function pMe(){ie("host-webworker")?OD||(OD=await pe(()=>import("./request-122821fc.js"),[],import.meta.url)):Ii._abortableFetch||(Ii._abortableFetch=globalThis.fetch.bind(globalThis))}async function vB(){li||await pe(()=>Promise.resolve().then(()=>TTt),void 0,import.meta.url)}async function fMe(t){const e=t.params.url,i=t.params.requestOptions,r=t.controller.signal,n=i.body;let s=null,o=null;if(ade&&"HTMLFormElement"in globalThis&&(n instanceof FormData?s=n:n instanceof HTMLFormElement&&(s=new FormData(n))),typeof n=="string"&&(o=n),t.fetchOptions={cache:i.cacheBust&&!("polyfill"in Ii._abortableFetch)?"no-cache":"default",credentials:"same-origin",headers:i.headers||{},method:i.method==="head"?"HEAD":"GET",mode:"cors",priority:fd.priority,redirect:"follow",signal:r},(s||o)&&(t.fetchOptions.body=s||o),i.authMode==="anonymous"&&(t.useIdentity=!1),t.hasToken=!!(/token=/i.test(e)||i.query?.token||s?.get("token")),!t.hasToken&&Oi.apiKey&&VH(e)&&(i.query||(i.query={}),i.query.token=Oi.apiKey,t.hasToken=!0),t.useIdentity&&!t.hasToken&&!t.credentialToken&&!lde(e)&&!Hn(r)){let a;i.authMode==="immediate"?(await vB(),a=await li.getCredential(e,{signal:r}),t.credential=a):i.authMode==="no-prompt"?(await vB(),a=await li.getCredential(e,{prompt:!1,signal:r}).catch(()=>{}),t.credential=a):li&&(a=li.findCredential(e)),a&&(t.credentialToken=a.token,t.useSSL=!!a.ssl)}}function lde(t){return hMe.some(e=>e.test(t))}async function mMe(t){let e=t.params.url;const i=t.params.requestOptions,r=t.fetchOptions??{},n=q3(e)||Bf(e),s=i.responseType||"json",o=n?0:i.timeout!=null?i.timeout:fd.timeout;let a=!1;if(!n){t.useSSL&&(e=UH(e)),i.cacheBust&&r.cache==="default"&&(e=BH(e,"request.preventCache",Date.now()));let p={...i.query};t.credentialToken&&(p.token=t.credentialToken);let m=gb(p);ie("esri-url-encodes-apostrophe")&&(m=m.replaceAll("'","%27"));const y=e.length+1+m.length;let _;a=i.method==="delete"||i.method==="post"||i.method==="put"||!!i.body||y>fd.maxUrlLength;const v=i.useProxy||!!rR(e);if(v){const w=zPe(e);_=w.path,!a&&_.length+1+y>fd.maxUrlLength&&(a=!0),w.query&&(p={...w.query,...p})}if(r.method==="HEAD"&&(a||v)){if(a)throw y>fd.maxUrlLength?_f("request:invalid-parameters",new Error("URL exceeds maximum length"),t.params):_f("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),t.params);if(v)throw _f("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),t.params)}a?(r.method=i.method==="delete"?"DELETE":i.method==="put"?"PUT":"POST",i.body?e=_I(e,p):(r.body=gb(p),r.headers||(r.headers={}),r.headers["Content-Type"]="application/x-www-form-urlencoded")):e=_I(e,p),v&&(t.useProxy=!0,e=`${_}?${e}`),p.token&&ade&&r.body instanceof FormData&&!Hhe(e)&&r.body.set("token",p.token),i.hasOwnProperty("withCredentials")?t.withCredentials=i.withCredentials:Ul(e,IH())||(DH(e)||li&&li.findServerInfo(e)?.webTierAuth)&&(t.withCredentials=!0),t.withCredentials&&(r.credentials="include",aMe(e)&&await lMe(a?_I(e,p):e))}let l,c,u=0,d=!1;o>0&&(u=setTimeout(()=>{d=!0,t.controller.abort()},o));try{if(i.responseType==="native-request-init")c=r,c.url=e;else if(i.responseType!=="image"||r.cache!=="default"||r.method!=="GET"||a||yMe(i.headers)||!n&&!t.useProxy&&fd.proxyUrl&&!YJ(e)){if(l=await Ii._abortableFetch(e,r),t.useProxy||dMe(e),i.responseType==="native")c=l;else if(r.method!=="HEAD")if(l.ok){switch(s){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(u&&(clearTimeout(u),u=0),s==="json"||s==="xml"||s==="document")if(c)switch(s){case"json":c=JSON.parse(c);break;case"xml":c=XJ(c,"application/xml");break;case"document":c=XJ(c,"text/html")}else c=null;if(c){if(s==="array-buffer"||s==="blob"){const p=l.headers.get("Content-Type");if(p&&/application\/json|text\/plain/i.test(p)&&c[s==="blob"?"size":"byteLength"]<=750)try{const m=await new Response(c).json();m.error&&(c=m)}catch{}}s==="image"&&c instanceof Blob&&(c=await ZJ(URL.createObjectURL(c),t,!0))}}else{c=await l.text();try{c=JSON.parse(c)}catch{}}}else c=await ZJ(e,t)}catch(p){if(p.name==="AbortError")throw d?sMe():pi("Request canceled");if(!(!l&&p instanceof TypeError&&fd.proxyUrl)||i.body||i.method==="delete"||i.method==="head"||i.method==="post"||i.method==="put"||t.useProxy||YJ(e))throw p;t.redoRequest=!0,BPe({proxyUrl:fd.proxyUrl,urlPrefix:Nd(e)??""})}finally{u&&clearTimeout(u)}return[l,c]}async function gMe(t,e){if(t.responseData!=null)return t.responseData;if(t.headers&&(e.requestOptions.headers={...e.requestOptions.headers,...t.headers}),t.query&&(e.requestOptions.query={...e.requestOptions.query,...t.query}),t.before){let i,r;try{r=await t.before(e)}catch(n){i=_f("request:interceptor",n,e)}if((r instanceof Error||r instanceof W)&&(i=_f("request:interceptor",r,e)),i)throw t.error&&t.error(i),i;return r}}function yMe(t){if(t){for(const e of Object.getOwnPropertyNames(t))if(t[e])return!0}return!1}function XJ(t,e){let i;try{i=new DOMParser().parseFromString(t,e)}catch{}if(!i||i.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return i}async function _Me(t){let e,i;await fMe(t);try{do[e,i]=await mMe(t);while(!await vMe(t,e,i))}catch(s){const o=_f("request:server",s,t.params,e);throw o.details.ssl=t.useSSL,t.interceptor?.error&&t.interceptor.error(o),o}const r=t.params.url;if(i&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(r)){if(!t.hasToken&&!t.credentialToken&&i.user?.username&&!DH(r)){const s=Nd(r,!0);s&&fd.trustedServers.push(s)}Array.isArray(i.authorizedCrossOriginNoCorsDomains)&&oMe(i.authorizedCrossOriginNoCorsDomains)}const n=t.credential;if(n&&li){let o=li.findServerInfo(n.server)?.owningSystemUrl;if(o){o=o.replace(/\/?$/,"/sharing");const a=li.findCredential(o,n.userId);a&&li._getIdenticalSvcIdx(o,a)===-1&&a.resources.unshift(o)}}return{data:i,getHeader:e?s=>e?.headers.get(s):GH,httpStatus:e?.status??200,requestOptions:t.params.requestOptions,ssl:t.useSSL,url:t.params.url}}async function vMe(t,e,i){if(t.redoRequest)return t.redoRequest=!1,!1;const r=t.params.requestOptions;if(!e||r.responseType==="native"||r.responseType==="native-request-init")return!0;let n,s;if(i&&(i.error?n=i.error:i.status==="error"&&Array.isArray(i.messages)&&(n={...i},n[RD]=i,n.details=i.messages)),!n&&!e.ok)throw n=new Error(`Unable to load ${e.url} status: ${e.status}`),n[RD]=i,n;let o,a=null;n&&(s=Number(n.code),a=n.hasOwnProperty("subcode")?Number(n.subcode):null,o=n.messageCode,o=o?.toUpperCase());const l=r.authMode;if(s===403&&(a===4||n.message?.toLowerCase().includes("ssl")&&!n.message.toLowerCase().includes("permission"))){if(!t.useSSL)return t.useSSL=!0,!1}else if(!t.hasToken&&t.useIdentity&&(l!=="no-prompt"||s===498)&&s!==void 0&&cMe.has(s)&&!lde(t.params.url)&&(s!==403||(!o||!uMe.has(o))&&(a==null||a===2&&t.credentialToken))){await vB();try{const c=await li.getCredential(t.params.url,{error:_f("request:server",n,t.params),prompt:l!=="no-prompt",signal:t.controller.signal,token:t.credentialToken});return t.credential=c,t.credentialToken=c.token,t.useSSL=t.useSSL||c.ssl,!1}catch(c){if(l==="no-prompt")return t.credential=void 0,t.credentialToken=void 0,!1;n=c}}if(n)throw n;return!0}function ZJ(t,e,i=!1){const r=e.controller.signal,n=new Image;return e.withCredentials?n.crossOrigin="use-credentials":n.crossOrigin="anonymous",n.alt="",n.fetchPriority=fd.priority,n.src=t,sde(n,t,i,r)}Ii._abortableFetch=null,Ii._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];let vI=class cde{constructor(){this._emitter=new cde.EventEmitter(this)}emit(e,i){return this._emitter.emit(e,i)}on(e,i){return this._emitter.on(e,i)}once(e,i){return this._emitter.once(e,i)}hasEventListener(e){return this._emitter.hasEventListener(e)}};(function(t){class e{constructor(n=null){this._target=n,this._listenersMap=null}clear(){this._listenersMap?.clear(),this._listenersMap=null}destroy(){this.clear()}emit(n,s){let o=this._listenersMap?.get(n);if(!o)return!1;const a=this._target||this;let l=!1;for(const c of o.slice()){const u="deref"in c?c.deref():c;u?u?.call(a,s):l=!0}return l&&(o=o.filter(c=>!("deref"in c)||c.deref()!=null),this._listenersMap.set(n,o)),o.length>0}on(n,s){if(Array.isArray(n)){const a=n.map(l=>this.on(l,s));return db(a)}if(n.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap??(this._listenersMap=new Map);const o=this._listenersMap.get(n)||[];return o.push(s),this._listenersMap.set(n,o),Mi(()=>{const a=this._listenersMap?.get(n),l=a?.indexOf(s)??-1;l>=0&&a.splice(l,1)})}once(n,s){const o=this.on(n,a=>{o.remove(),("deref"in s?s.deref():s)?.call(null,a)});return o}hasEventListener(n){const s=this._listenersMap?.get(n);return s!=null&&s.length>0}}t.EventEmitter=e,t.EventedMixin=r=>{let n=class extends r{constructor(){super(...arguments),this._emitter=new e}destroy(){this._emitter.clear()}emit(s,o){return this._emitter.emit(s,o)}on(s,o){return this._emitter.on(s,o)}once(s,o){return this._emitter.once(s,o)}hasEventListener(s){return this._emitter.hasEventListener(s)}};return n=h([z("esri.core.Evented")],n),n};let i=class extends xe{constructor(){super(...arguments),this._emitter=new vI.EventEmitter(this)}destroy(){this._emitter.clear()}emit(r,n){return this._emitter.emit(r,n)}on(r,n){return this._emitter.on(r,n)}once(r,n){return this._emitter.once(r,n)}hasEventListener(r){return this._emitter.hasEventListener(r)}};i=h([z("esri.core.Evented")],i),t.EventedAccessor=i})(vI||(vI={}));const Tn=vI;var tr;(function(t){t[t.ADD=1]="ADD",t[t.REMOVE=2]="REMOVE",t[t.MOVE=4]="MOVE"})(tr||(tr={}));function ude(t){return(e,i)=>{e[i]=t}}let nR=class extends ihe{notify(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onInvalidated(),r.onCommitted()}}};var qm;let bMe=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}},wMe=class{constructor(e,i,r,n,s){this.target=e,this.added=i,this.removed=r,this.start=n,this.deleteCount=s}};const bu=new aa(bMe,void 0,t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1});function qk(t){return t?t instanceof b1?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function Wk(t){if(t?.length)return t[0]}function xMe(t,e,i,r){const n=Math.min(t.length-i,e.length-r);let s=0;for(;s<n&&t[i+s]===e[r+s];)s++;return s}function hde(t,e,i,r){e&&e.forEach((n,s,o)=>{t.push(n),hde(t,i.call(r,n,s,o),i,r)})}const t0=new Set,i0=new Set,r0=new Set,Yk=new Map;let TMe=0,b1=qm=class extends Tn.EventedAccessor{static isCollection(t){return t!=null&&t instanceof qm}constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new nR,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:TMe++})}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof qm?{items:t}:t:{}}destroy(){this._removeAllRaw()}*[Symbol.iterator](){yield*this.items}get items(){return Ct(this._observable),this._items}set items(t){this._emitBeforeChanges(tr.ADD)||(this._splice(0,this.length,qk(t)),this._emitAfterChanges(tr.ADD))}hasEventListener(t){return t==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(t)}on(t,e){if(t==="change"){const i=this._chgListeners,r={removed:!1,callback:e};return i.push(r),this._notifications&&this._notifications.push({listeners:i.slice(),items:this._items.slice(),changes:[]}),Mi(()=>{r.removed=!0,i.splice(i.indexOf(r),1)})}return this._emitter.on(t,e)}once(t,e){const i="deref"in e?()=>e.deref():()=>e,r=this.on(t,n=>{i()?.call(null,n),r.remove()});return r}add(t,e){if(Ct(this._observable),this._emitBeforeChanges(tr.ADD))return this;const i=this.getNextIndex(e??null);return this._splice(i,0,[t]),this._emitAfterChanges(tr.ADD),this}addMany(t,e=this._items.length){if(Ct(this._observable),!t?.length)return this;if(this._emitBeforeChanges(tr.ADD))return this;const i=this.getNextIndex(e);return this._splice(i,0,qk(t)),this._emitAfterChanges(tr.ADD),this}at(t){if(Ct(this._observable),(t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this._items[t]}removeAll(){if(Ct(this._observable),!this.length||this._emitBeforeChanges(tr.REMOVE))return[];const t=this._removeAllRaw();return this._emitAfterChanges(tr.REMOVE),t}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return Ct(this._observable),this._createNewInstance({items:this._items.map(ye)})}concat(...t){Ct(this._observable);const e=t.map(qk);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(Ct(this._observable),!this.length||this._emitBeforeChanges(tr.REMOVE))return;const i=this._splice(0,this.length),r=i.length;for(let n=0;n<r;n++)t.call(e,i[n],n,i);this._emitAfterChanges(tr.REMOVE)}every(t,e){return Ct(this._observable),this._items.every(t,e)}filter(t,e){let i;return Ct(this._observable),i=arguments.length===2?this._items.filter(t,e):this._items.filter(t),this._createNewInstance({items:i})}find(t,e){return Ct(this._observable),this._items.find(t,e)}findIndex(t,e){return Ct(this._observable),this._items.findIndex(t,e)}flatten(t,e){Ct(this._observable);const i=[];return hde(i,this,t,e),new qm(i)}forEach(t,e){return Ct(this._observable),this._items.forEach(t,e)}getItemAt(t){return Ct(this._observable),this._items[t]}getNextIndex(t){Ct(this._observable);const e=this.length;return(t=t??e)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return Ct(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return Ct(this._observable),this._items.indexOf(t,e)}join(t=","){return Ct(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return Ct(this._observable),this._items.lastIndexOf(t,e)}map(t,e){Ct(this._observable);const i=this._items.map(t,e);return new qm({items:i})}reorder(t,e=this.length-1){Ct(this._observable);const i=this.indexOf(t);if(i!==-1){if(e<0?e=0:e>=this.length&&(e=this.length-1),i!==e){if(this._emitBeforeChanges(tr.MOVE))return t;this._splice(i,1),this._splice(e,0,[t]),this._emitAfterChanges(tr.MOVE)}return t}}pop(){if(Ct(this._observable),!this.length||this._emitBeforeChanges(tr.REMOVE))return;const t=Wk(this._splice(this.length-1,1));return this._emitAfterChanges(tr.REMOVE),t}push(...t){return Ct(this._observable),this._emitBeforeChanges(tr.ADD)||(this._splice(this.length,0,t),this._emitAfterChanges(tr.ADD)),this.length}reduce(t,e){Ct(this._observable);const i=this._items;return arguments.length===2?i.reduce(t,e):i.reduce(t)}reduceRight(t,e){Ct(this._observable);const i=this._items;return arguments.length===2?i.reduceRight(t,e):i.reduceRight(t)}remove(t){return Ct(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(Ct(this._observable),t<0||t>=this.length||this._emitBeforeChanges(tr.REMOVE))return;const e=Wk(this._splice(t,1));return this._emitAfterChanges(tr.REMOVE),e}removeMany(t){if(Ct(this._observable),!t?.length||this._emitBeforeChanges(tr.REMOVE))return[];const e=t instanceof qm?t.toArray():t,i=this._items,r=[],n=e.length;for(let s=0;s<n;s++){const o=e[s],a=i.indexOf(o);if(a>-1){const l=1+xMe(e,i,s+1,a+1),c=this._splice(a,l);c&&c.length>0&&r.push.apply(r,c),s+=l-1}}return this._emitAfterChanges(tr.REMOVE),r}reverse(){if(Ct(this._observable),this._emitBeforeChanges(tr.MOVE))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(tr.MOVE),this}shift(){if(Ct(this._observable),!this.length||this._emitBeforeChanges(tr.REMOVE))return;const t=Wk(this._splice(0,1));return this._emitAfterChanges(tr.REMOVE),t}slice(t=0,e=this.length){return Ct(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return Ct(this._observable),this._items.some(t,e)}sort(t){if(Ct(this._observable),!this.length||this._emitBeforeChanges(tr.MOVE))return this;const e=this._splice(0,this.length);return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(tr.MOVE),this}splice(t,e,...i){Ct(this._observable);const r=(e?tr.REMOVE:0)|(i.length?tr.ADD:0);if(this._emitBeforeChanges(r))return[];const n=this._splice(t,e,i)||[];return this._emitAfterChanges(r),n}toArray(){return Ct(this._observable),this._items.slice()}toJSON(){return Ct(this._observable),this.toArray()}toLocaleString(){return Ct(this._observable),this._items.toLocaleString()}toString(){return Ct(this._observable),this._items.toString()}unshift(...t){return Ct(this._observable),!t.length||this._emitBeforeChanges(tr.ADD)||(this._splice(0,0,t),this._emitAfterChanges(tr.ADD)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,i){const r=this._items,n=this.itemType;let s,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=PS(()=>this._dispatchChange())),t<0&&(t+=this.length),e){if(o=r.splice(t,e),this.hasEventListener("before-remove")){const a=bu.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)s=o[l],a.reset(s),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),r.splice(t,0,s),t+=1,l-=1,c-=1);bu.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=bu.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);bu.release(a)}}if(i?.length){if(n){const u=[];for(const d of i){const p=n.ensureType(d);p==null&&d!=null||u.push(p)}i=u}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=t===this.length;if(a||l){const u=bu.acquire();u.target=this,u.cancellable=!0;const d=bu.acquire();d.target=this,d.cancellable=!1;for(const p of i)a?(u.reset(p),this.emit("before-add",u),u.defaultPrevented||(c?r.push(p):r.splice(t++,0,p),this._set("length",r.length),l&&(d.reset(p),this.emit("after-add",d)))):(c?r.push(p):r.splice(t++,0,p),this._set("length",r.length),d.reset(p),this.emit("after-add",d));bu.release(d),bu.release(u)}else{if(c)for(const u of i)r.push(u);else r.splice(t,0,...i);this._set("length",r.length)}}if((i?.length||o?.length)&&this._notifyChangeEvent(i,o),this.hasEventListener("after-splice")){const a=new wMe(this,i,o,t,e);this.emit("after-splice",a)}return o}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const i=bu.acquire();i.target=this,i.cancellable=!0,i.type=t,this.emit("before-changes",i),e=i.defaultPrevented,bu.release(i)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=bu.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),bu.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const i=e.changes;t0.clear(),i0.clear(),r0.clear();for(const{added:l,removed:c}of i){if(l)if(r0.size===0&&i0.size===0)for(const u of l)t0.add(u);else for(const u of l)i0.has(u)?(r0.add(u),i0.delete(u)):r0.has(u)||t0.add(u);if(c)if(r0.size===0&&t0.size===0)for(const u of c)i0.add(u);else for(const u of c)t0.has(u)?t0.delete(u):(r0.delete(u),i0.add(u))}const r=Hl.acquire();t0.forEach(l=>{r.push(l)});const n=Hl.acquire();i0.forEach(l=>{n.push(l)});const s=this._items,o=e.items,a=Hl.acquire();if(r0.forEach(l=>{o.indexOf(l)!==s.indexOf(l)&&a.push(l)}),e.listeners&&(r.length||n.length||a.length)){const l={target:this,added:r,removed:n,moved:a},c=e.listeners.length;for(let u=0;u<c;u++){const d=e.listeners[u];d.removed||d.callback.call(this,l)}}Hl.release(r),Hl.release(n),Hl.release(a)}t0.clear(),i0.clear(),r0.clear()}};b1.ofType=t=>{if(!t)return qm;if(Yk.has(t))return Yk.get(t);let e=null;if(typeof t=="function")e=t.prototype.declaredClass;else if(t.base)e=t.base.prototype.declaredClass;else for(const r in t.typeMap){const n=t.typeMap[r].prototype.declaredClass;e?e+=` | ${n}`:e=n}let i=class extends qm{};return h([ude({Type:t,ensureType:typeof t=="function"?uo(t):Ky(t)})],i.prototype,"itemType",void 0),i=h([z(`esri.core.Collection<${e}>`)],i),Yk.set(t,i),i},h([f()],b1.prototype,"length",void 0),h([f()],b1.prototype,"items",null),b1=qm=h([z("esri.core.Collection")],b1);const ft=b1;function vg(t,e,i=ft){return e||(e=new i),e===t||(e.removeAll(),SMe(t)?e.addMany(t):t&&e.add(t)),e}function jH(t){return t}function SMe(t){return t&&(Array.isArray(t)||"items"in t&&Array.isArray(t.items))}var hy;(function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"})(hy||(hy={}));let EMe=class{constructor(){this._resolver=vs(),this._status=hy.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=hy.RESOLVED,this._cleanUp()},()=>{this._status=hy.REJECTED,this._cleanUp()}),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===hy.RESOLVED}isRejected(){return this._status===hy.REJECTED}isFulfilled(){return this._status!==hy.PENDING}abort(){this._resolver.reject(pi())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const e=vs(),i=[...this._resolvingPromises,e.promise],r=this._allPromise=Promise.all(i);r.then(()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve()},n=>{this.isFulfilled()||this._allPromise!==r||Fn(n)||this._resolver.reject(n)}),e.resolve()}};const v4=t=>{let e=class extends t{constructor(...i){super(...i),this._promiseProps=new EMe,this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(i,r){return this._promiseProps.promise.then(()=>this).then(i,r)}catch(i){return this.when(null,i)}addResolvingPromise(i){i&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in i?i.when():i)}};return e=h([z("esri.core.Promise")],e),e};let PD=class extends v4(xe){};PD=h([z("esri.core.Promise")],PD);const CMe="not-loaded",AMe="loading",OMe="failed",JJ="loaded",dde=t=>{let e=class extends t{constructor(...i){super(...i),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(r=>{const n=this.load.bind(this);this.load=s=>{const o=new Promise((a,l)=>{const c=eR(s,l);this.destroyed&&l(new W("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===CMe){this._set("loadStatus",AMe);const a=this._loadController=new AbortController;n({signal:a.signal})}return r(),o}})),this.when(()=>{this._set("loadStatus",JJ),this._loadController=null},r=>{this._set("loadStatus",OMe),this._set("loadError",r),this._loadController=null})}destroy(){this._loadController&&(this._loadController=nc(this._loadController),this._promiseProps.abort()),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===JJ}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){return this.isFulfilled()||(this._set("loadError",new W("load:cancelled","Cancelled")),this._loadController?.abort(),this._promiseProps.abort()),this}};return h([f({readOnly:!0})],e.prototype,"loaded",null),h([f({readOnly:!0})],e.prototype,"loadError",void 0),h([f({clonable:!1})],e.prototype,"loadStatus",void 0),h([f({type:[mb],readOnly:!0})],e.prototype,"loadWarnings",null),e=h([z("esri.core.Loadable")],e),e};let mC=class extends dde(PD){};mC=h([z("esri.core.Loadable")],mC),function(t){function e(i){return!(!i||!i.load)}t.LoadableMixin=dde,t.isLoadable=e}(mC||(mC={}));const bg=mC;function b4(t,e,i){return tR(t.map((r,n)=>e.apply(i,[r,n])))}async function RMe(t,e,i){return(await tR(t.map((r,n)=>e.apply(i,[r,n])))).map(r=>r.value)}function HH(t){return{ok:!0,value:t}}function qH(t){return{ok:!1,error:t}}function PMe(t){return t!=null&&t.ok===!0?t.value:null}function MMe(t){return t!=null&&t.ok===!1?t.error:null}async function hh(t){if(t==null)return{ok:!1,error:new Error("no promise provided")};try{return HH(await t)}catch(e){return qH(e)}}async function zSt(t){try{return HH(await t)}catch(e){return T_(e),qH(e)}}function BSt(t){if(t.ok===!0)return t.value;throw t.error}function S_(t,e){return new z0(t,e)}let z0=class extends xe{get value(){return PMe(this._result)}get error(){return MMe(this._result)}get finished(){return this._result!=null}constructor(e,i){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=nc(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:r}=this._abortController;this.promise=e(r),this.promise.then(n=>{this._result=HH(n),this._cleanup()},n=>{this._result=qH(n),this._cleanup()}),this._abortHandle=os(i,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=pr(this._abortHandle),this._abortController=null}};h([f()],z0.prototype,"value",null),h([f()],z0.prototype,"error",null),h([f()],z0.prototype,"finished",null),h([f()],z0.prototype,"promise",void 0),h([f()],z0.prototype,"_result",void 0),z0=h([z("esri.core.asyncUtils.ReactiveTask")],z0);async function WH(t,e){return await t.load(),$Me(t,e)}async function $Me(t,e){const i=[],r=(...s)=>{for(const o of s)o!=null&&(Array.isArray(o)?r(...o):ft.isCollection(o)?o.forEach(a=>r(a)):bg.isLoadable(o)&&i.push(o))};e(r);let n=null;if(await RMe(i,async s=>{const o=await hh(IMe(s)?s.loadAll():s.load());o.ok!==!1||n||(n=o)}),n)throw n.error;return t}function IMe(t){return"loadAll"in t&&typeof t.loadAll=="function"}function di(t,e,i){let r,n;return e===void 0?(n=t,r=[void 0]):typeof e!="string"?(n=t,r=[void 0],i=e):(n=e,r=Array.isArray(t)?t:[t]),(s,o)=>{const a=s.constructor.prototype;for(const l of r){const c=Che(s,l,n);c.write&&typeof c.write=="object"||(c.write={}),i&&(c.write.target=i),c.write.writer=a[o]}}}let uu=class{constructor(e,i={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=i,this.apiValues=[],this.jsonValues=[],this._apiToJSON=this._invertMap(e),this.apiValues=this._getKeysSorted(this._apiToJSON),this.jsonValues=this._getKeysSorted(this._jsonToAPI),this.read=r=>this.fromJSON(r),this.write=(r,n,s)=>{const o=this.toJSON(r);o!==void 0&&RS(s,o,n)},this.write.isJSONMapWriter=!0}toJSON(e){if(e==null)return null;if(this._apiToJSON.hasOwnProperty(e)){const i=this._apiToJSON[e];return this._options.useNumericKeys?+i:i}return this._options.ignoreUnknown?void 0:e}fromJSON(e){return e!=null&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}_invertMap(e){const i={};for(const r in e)i[e[r]]=r;return i}_getKeysSorted(e){const i=[];for(const r in e)i.push(r);return i.sort(),i}};function fu(){return function(t,e){return new uu(t,{ignoreUnknown:!0,...e})}}let YH=class{constructor(e,i,r,n){this.semiMajorAxis=e,this.flattening=i,this.outerAtmosphereRimWidth=r;const s=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*s,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=n||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const yi=new YH(6378137,1/298.257223563,3e5,.006694379990137799),vf=new YH(3396190,1/169.8944472236118,23e4),wg=new YH(1737400,0,0),LMe=ne.getLogger("esri.assets");function DMe(t,e){return Ii(lr(t),e)}function lr(t){if(!Oi.assetsPath)throw LMe.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new W("assets:path-not-set","config.assetsPath is not set");return zf(Oi.assetsPath,t)}let Xk,ee=null;function pde(){return!!ee}function NMe(){return!!ie("esri-wasm")}function fde(){return Xk||(Xk=pe(()=>import("./pe-wasm-a821b773.js"),[],import.meta.url).then(t=>t.p).then(({default:t})=>t({locateFile:e=>lr(`esri/geometry/support/${e}`)})).then(t=>{gde(t)}),Xk)}var bB,Rn,wB;(function(t){function e(s,o,a){ee.ensureCache.prepare();const l=w1(a),c=a===l,u=ee.ensureFloat64(l),d=ee._pe_geog_to_proj(ee.getPointer(s),o,u);return d&&vy(a,o,u,c),d}function i(s,o,a,l){switch(l){case Rn.PE_TRANSFORM_P_TO_G:return r(s,o,a);case Rn.PE_TRANSFORM_G_TO_P:return e(s,o,a)}return 0}function r(s,o,a){return n(s,o,a,0)}function n(s,o,a,l){ee.ensureCache.prepare();const c=w1(a),u=a===c,d=ee.ensureFloat64(c),p=ee._pe_proj_to_geog_center(ee.getPointer(s),o,d,l);return p&&vy(a,o,d,u),p}t.geogToProj=e,t.projGeog=i,t.projToGeog=r,t.projToGeogCenter=n})(bB||(bB={})),function(t){function e(){t.PE_BUFFER_MAX=ee.PeDefs.prototype.PE_BUFFER_MAX,t.PE_NAME_MAX=ee.PeDefs.prototype.PE_NAME_MAX,t.PE_MGRS_MAX=ee.PeDefs.prototype.PE_MGRS_MAX,t.PE_USNG_MAX=ee.PeDefs.prototype.PE_USNG_MAX,t.PE_DD_MAX=ee.PeDefs.prototype.PE_DD_MAX,t.PE_DDM_MAX=ee.PeDefs.prototype.PE_DDM_MAX,t.PE_DMS_MAX=ee.PeDefs.prototype.PE_DMS_MAX,t.PE_UTM_MAX=ee.PeDefs.prototype.PE_UTM_MAX,t.PE_PARM_MAX=ee.PeDefs.prototype.PE_PARM_MAX,t.PE_TYPE_NONE=ee.PeDefs.prototype.PE_TYPE_NONE,t.PE_TYPE_GEOGCS=ee.PeDefs.prototype.PE_TYPE_GEOGCS,t.PE_TYPE_PROJCS=ee.PeDefs.prototype.PE_TYPE_PROJCS,t.PE_TYPE_GEOGTRAN=ee.PeDefs.prototype.PE_TYPE_GEOGTRAN,t.PE_TYPE_COORDSYS=ee.PeDefs.prototype.PE_TYPE_COORDSYS,t.PE_TYPE_UNIT=ee.PeDefs.prototype.PE_TYPE_UNIT,t.PE_TYPE_LINUNIT=ee.PeDefs.prototype.PE_TYPE_LINUNIT,t.PE_STR_OPTS_NONE=ee.PeDefs.prototype.PE_STR_OPTS_NONE,t.PE_STR_AUTH_NONE=ee.PeDefs.prototype.PE_STR_AUTH_NONE,t.PE_STR_AUTH_TOP=ee.PeDefs.prototype.PE_STR_AUTH_TOP,t.PE_STR_NAME_CANON=ee.PeDefs.prototype.PE_STR_NAME_CANON,t.PE_STR_FMT_WKT=ee.PeDefs.prototype.PE_STR_FMT_WKT,t.PE_STR_FMT_WKT2=ee.PeDefs.prototype.PE_STR_FMT_WKT2,t.PE_PARM_X0=ee.PeDefs.prototype.PE_PARM_X0,t.PE_PARM_ND=ee.PeDefs.prototype.PE_PARM_ND,t.PE_TRANSFORM_1_TO_2=ee.PeDefs.prototype.PE_TRANSFORM_1_TO_2,t.PE_TRANSFORM_2_TO_1=ee.PeDefs.prototype.PE_TRANSFORM_2_TO_1,t.PE_TRANSFORM_P_TO_G=ee.PeDefs.prototype.PE_TRANSFORM_P_TO_G,t.PE_TRANSFORM_G_TO_P=ee.PeDefs.prototype.PE_TRANSFORM_G_TO_P,t.PE_HORIZON_RECT=ee.PeDefs.prototype.PE_HORIZON_RECT,t.PE_HORIZON_POLY=ee.PeDefs.prototype.PE_HORIZON_POLY,t.PE_HORIZON_LINE=ee.PeDefs.prototype.PE_HORIZON_LINE,t.PE_HORIZON_DELTA=ee.PeDefs.prototype.PE_HORIZON_DELTA}t.init=e}(Rn||(Rn={})),function(t){const e={},i={},r=m=>{if(m){const y=m.getType();switch(y){case Rn.PE_TYPE_GEOGCS:m=ee.castObject(m,ee.PeGeogcs);break;case Rn.PE_TYPE_PROJCS:m=ee.castObject(m,ee.PeProjcs);break;case Rn.PE_TYPE_GEOGTRAN:m=ee.castObject(m,ee.PeGeogtran);break;default:y&Rn.PE_TYPE_UNIT&&(m=ee.castObject(m,ee.PeUnit))}}return m};function n(){ee.PeFactory.prototype.initialize(null)}function s(m){return o(Rn.PE_TYPE_COORDSYS,m)}function o(m,y){let _=null,v=e[m];if(v||(v={},e[m]=v),v.hasOwnProperty(String(y)))_=v[y];else{const w=ee.PeFactory.prototype.factoryByType(m,y);ee.compare(w,ee.NULL)||(_=w,v[y]=_)}return _=r(_),_}function a(m,y){let _=null,v=i[m];if(v||(v={},i[m]=v),v.hasOwnProperty(y))_=v[y];else{const w=ee.PeFactory.prototype.fromString(m,y);ee.compare(w,ee.NULL)||(_=w,v[y]=_)}return _=r(_),_}function l(m){return o(Rn.PE_TYPE_GEOGCS,m)}function c(m){return o(Rn.PE_TYPE_GEOGTRAN,m)}function u(m){return ee.PeFactory.prototype.getCode(m)}function d(m){return o(Rn.PE_TYPE_PROJCS,m)}function p(m){return o(Rn.PE_TYPE_UNIT,m)}t.initialize=n,t.coordsys=s,t.factoryByType=o,t.fromString=a,t.geogcs=l,t.geogtran=c,t.getCode=u,t.projcs=d,t.unit=p}(wB||(wB={}));let mde=null;var MD,xB,TB,SB,$D,EB,ID,LD,CB;function gde(t){function e(s,o,a){s[o]=a(s[o])}ee=t,Rn.init(),MD.init(),$D.init(),ID.init(),LD.init(),mde=class extends ee.PeGCSExtent{destroy(){ee.destroy(this)}};const i=[ee.PeDatum,ee.PeGeogcs,ee.PeGeogtran,ee.PeObject,ee.PeParameter,ee.PePrimem,ee.PeProjcs,ee.PeSpheroid,ee.PeUnit];for(const s of i)e(s.prototype,"getName",o=>function(){return o.call(this,new Array(Rn.PE_NAME_MAX))});for(const s of[ee.PeGeogtran,ee.PeProjcs])e(s.prototype,"getParameters",o=>function(){const a=new Array(Rn.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const u=ee.getValue(l,"*");a[c]=u?ee.wrapPointer(u,ee.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});e(ee.PeHorizon.prototype,"getCoord",s=>function(){const o=this.getSize();if(!o)return null;const a=[];return vy(a,o,s.call(this)),a}),e(ee.PeGTlistExtendedEntry.prototype,"getEntries",s=>{const o=ee._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=s.call(this);if(!ee.compare(l,ee.NULL)){a=[l];const c=this.getSteps();if(c>1){const u=ee.getPointer(l);for(let d=1;d<c;d++)a.push(ee.wrapPointer(u+o*d,ee.PeGTlistExtendedGTs))}}return a}});const r=ee._pe_getPeHorizonSize(),n=s=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(s))return o.get(s);let a=null;const l=s.call(this);if(!ee.compare(l,ee.NULL)){a=[l];const c=l.getNump();if(c>1){const u=ee.getPointer(l);for(let d=1;d<c;d++)a.push(ee.wrapPointer(u+r*d,ee.PeHorizon))}}return o.set(s,a),a};e(ee.PeProjcs.prototype,"horizonGcsGenerate",n),e(ee.PeProjcs.prototype,"horizonPcsGenerate",n),ee.PeObject.prototype.toString=function(s=Rn.PE_STR_OPTS_NONE){ee.ensureCache.prepare();const o=ee.getPointer(this),a=ee.ensureInt8(new Array(Rn.PE_BUFFER_MAX));return ee.UTF8ToString(ee._pe_object_to_string_ext(o,s,a))}}function rm(t){if(!t)return;const e=ee.getClass(t);if(!e)return;const i=ee.getCache(e);if(!i)return;const r=ee.getPointer(t);r&&delete i[r]}function uP(t,e){const i=[],r=new Array(e);for(let n=0;n<t;n++)i.push(ee.ensureInt8(r));return i}function w1(t){let e;return Array.isArray(t[0])?(e=[],t.forEach(i=>{e.push(i[0],i[1])})):e=t,e}function vy(t,e,i,r=!1){if(r)for(let n=0;n<2*e;n++)t[n]=ee.getValue(i+n*Float64Array.BYTES_PER_ELEMENT,"double");else{const n=t.length===0;for(let s=0;s<e;s++)n&&(t[s]=new Array(2)),t[s][0]=ee.getValue(i,"double"),t[s][1]=ee.getValue(i+Float64Array.BYTES_PER_ELEMENT,"double"),i+=2*Float64Array.BYTES_PER_ELEMENT}}(function(t){let e;function i(){t.PE_GTLIST_OPTS_COMMON=ee.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,e=ee._pe_getPeGTlistExtendedEntrySize()}function r(n,s,o,a,l,c){let u=null;const d=new ee.PeInteger(c);try{const p=ee.PeGTlistExtended.prototype.getGTlist(n,s,o,a,l,d);if((c=d.val)&&(u=[p],c>1)){const m=ee.getPointer(p);for(let y=1;y<c;y++)u.push(ee.wrapPointer(m+e*y,ee.PeGTlistExtendedEntry))}}finally{ee.destroy(d)}return u}t.init=i,t.getGTlist=r})(MD||(MD={})),function(t){function e(i){if(i?.length){for(const r of i)rm(r),r.getEntries().forEach(n=>{rm(n);const s=n.getGeogtran();rm(s),s.getParameters().forEach(rm),[s.getGeogcs1(),s.getGeogcs2()].forEach(o=>{rm(o);const a=o.getDatum();rm(a),rm(a.getSpheroid()),rm(o.getPrimem()),rm(o.getUnit())})});ee.PeGTlistExtendedEntry.prototype.Delete(i[0])}}t.destroy=e}(xB||(xB={})),function(t){function e(i,r,n,s,o){ee.ensureCache.prepare();const a=w1(n),l=n===a,c=ee.ensureFloat64(a);let u=0;s&&(u=ee.ensureFloat64(s));const d=ee._pe_geog_to_geog(ee.getPointer(i),r,c,u,o);return d&&vy(n,r,c,l),d}t.geogToGeog=e}(TB||(TB={})),function(t){const e=(c,u,d,p,m,y)=>{let _,v;switch(ee.ensureCache.prepare(),c){case"dd":_=ee._pe_geog_to_dd,v=Rn.PE_DD_MAX;break;case"ddm":_=ee._pe_geog_to_ddm,v=Rn.PE_DDM_MAX;break;case"dms":_=ee._pe_geog_to_dms,v=Rn.PE_DMS_MAX}let w=0;u&&(w=ee.getPointer(u));const x=w1(p),T=ee.ensureFloat64(x),S=uP(d,v),E=_(w,d,T,m,ee.ensureInt32(S));if(E)for(let A=0;A<d;A++)y[A]=ee.UTF8ToString(S[A]);return E},i=(c,u,d,p,m)=>{let y;switch(ee.ensureCache.prepare(),c){case"dd":y=ee._pe_dd_to_geog;break;case"ddm":y=ee._pe_ddm_to_geog;break;case"dms":y=ee._pe_dms_to_geog}let _=0;u&&(_=ee.getPointer(u));const v=p.map(S=>ee.ensureString(S)),w=ee.ensureInt32(v),x=ee.ensureFloat64(new Array(2*d)),T=y(_,d,w,x);return T&&vy(m,d,x),T};function r(c,u,d,p,m){return e("dms",c,u,d,p,m)}function n(c,u,d,p){return i("dms",c,u,d,p)}function s(c,u,d,p,m){return e("ddm",c,u,d,p,m)}function o(c,u,d,p){return i("ddm",c,u,d,p)}function a(c,u,d,p,m){return e("dd",c,u,d,p,m)}function l(c,u,d,p){return i("dd",c,u,d,p)}t.geogToDms=r,t.dmsToGeog=n,t.geogToDdm=s,t.ddmToGeog=o,t.geogToDd=a,t.ddToGeog=l}(SB||(SB={})),function(t){function e(){t.PE_MGRS_STYLE_NEW=ee.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,t.PE_MGRS_STYLE_OLD=ee.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,t.PE_MGRS_STYLE_AUTO=ee.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,t.PE_MGRS_180_ZONE_1_PLUS=ee.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,t.PE_MGRS_ADD_SPACES=ee.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function i(n,s,o,a,l,c,u){ee.ensureCache.prepare();let d=0;n&&(d=ee.getPointer(n));const p=w1(o),m=ee.ensureFloat64(p),y=uP(s,Rn.PE_MGRS_MAX),_=ee.ensureInt32(y),v=ee._pe_geog_to_mgrs_extended(d,s,m,a,l,c,_);if(v)for(let w=0;w<s;w++)u[w]=ee.UTF8ToString(y[w]);return v}function r(n,s,o,a,l){ee.ensureCache.prepare();let c=0;n&&(c=ee.getPointer(n));const u=o.map(y=>ee.ensureString(y)),d=ee.ensureInt32(u),p=ee.ensureFloat64(new Array(2*s)),m=ee._pe_mgrs_to_geog_extended(c,s,d,a,p);return m&&vy(l,s,p),m}t.init=e,t.geogToMgrsExtended=i,t.mgrsToGeogExtended=r}($D||($D={})),function(t){function e(r,n,s,o,a,l,c){ee.ensureCache.prepare();let u=0;r&&(u=ee.getPointer(r));const d=w1(s),p=ee.ensureFloat64(d),m=uP(n,Rn.PE_MGRS_MAX),y=ee.ensureInt32(m),_=ee._pe_geog_to_usng(u,n,p,o,a,l,y);if(_)for(let v=0;v<n;v++)c[v]=ee.UTF8ToString(m[v]);return _}function i(r,n,s,o){ee.ensureCache.prepare();let a=0;r&&(a=ee.getPointer(r));const l=s.map(p=>ee.ensureString(p)),c=ee.ensureInt32(l),u=ee.ensureFloat64(new Array(2*n)),d=ee._pe_usng_to_geog(a,n,c,u);return d&&vy(o,n,u),d}t.geogToUsng=e,t.usngToGeog=i}(EB||(EB={})),function(t){function e(){t.PE_UTM_OPTS_NONE=ee.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,t.PE_UTM_OPTS_ADD_SPACES=ee.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,t.PE_UTM_OPTS_NS=ee.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function i(n,s,o,a,l){ee.ensureCache.prepare();let c=0;n&&(c=ee.getPointer(n));const u=w1(o),d=ee.ensureFloat64(u),p=uP(s,Rn.PE_UTM_MAX),m=ee.ensureInt32(p),y=ee._pe_geog_to_utm(c,s,d,a,m);if(y)for(let _=0;_<s;_++)l[_]=ee.UTF8ToString(p[_]);return y}function r(n,s,o,a,l){ee.ensureCache.prepare();let c=0;n&&(c=ee.getPointer(n));const u=o.map(y=>ee.ensureString(y)),d=ee.ensureInt32(u),p=ee.ensureFloat64(new Array(2*s)),m=ee._pe_utm_to_geog(c,s,d,a,p);return m&&vy(l,s,p),m}t.init=e,t.geogToUtm=i,t.utmToGeog=r}(ID||(ID={})),function(t){const e=new Map;function i(){t.PE_PCSINFO_OPTION_NONE=ee.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,t.PE_PCSINFO_OPTION_DOMAIN=ee.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,t.PE_POLE_OUTSIDE_BOUNDARY=ee.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,t.PE_POLE_POINT=ee.PePCSInfo.prototype.PE_POLE_POINT}function r(n,s=t.PE_PCSINFO_OPTION_DOMAIN){let o=null,a=null;return e.has(n)&&(a=e.get(n),a[s]&&(o=a[s])),o||(o=ee.PePCSInfo.prototype.generate(n,s),a||(a=[],e.set(n,a)),a[s]=o),o}t.init=i,t.generate=r}(LD||(LD={})),function(t){function e(){return ee.PeVersion.prototype.version_string()}t.versionString=e}(CB||(CB={}));const FMe=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return bB},get PeDefs(){return Rn},get PeFactory(){return wB},get PeGCSExtent(){return mde},get PeGTTransformations(){return TB},get PeGTlistExtended(){return MD},get PeGTlistExtendedEntry(){return xB},get PeNotationDms(){return SB},get PeNotationMgrs(){return $D},get PeNotationUsng(){return EB},get PeNotationUtm(){return ID},get PePCSInfo(){return LD},get PeVersion(){return CB},_init:gde,get _pe(){return ee},isLoaded:pde,isSupported:NMe,load:fde},Symbol.toStringTag,{value:"Module"}));var ih;(function(t){t[t.CGCS2000=4490]="CGCS2000",t[t.GCSMARS2000=104971]="GCSMARS2000",t[t.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",t[t.GCSMOON2000=104903]="GCSMOON2000"})(ih||(ih={}));let g;const L={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9895:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,10160:0,10183:0,10188:0,10194:0,10199:0,10207:0,10212:0,10217:0,10222:0,10227:0,10235:0,10240:0,10250:0,10254:0,10270:0,10275:0,10280:0,10306:0,10329:0,10471:0,20002:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2,103897:1};for(g=2e3;g<=2045;g++)L[g]=0;for(g=2056;g<=2065;g++)L[g]=0;for(g=2067;g<=2135;g++)L[g]=0;for(g=2137;g<=2154;g++)L[g]=0;for(g=2161;g<=2170;g++)L[g]=0;for(g=2172;g<=2193;g++)L[g]=0;for(g=2195;g<=2198;g++)L[g]=0;for(g=2200;g<=2203;g++)L[g]=0;for(g=2205;g<=2217;g++)L[g]=0;for(g=2222;g<=2224;g++)L[g]=1;for(g=2225;g<=2250;g++)L[g]=2;for(g=2251;g<=2253;g++)L[g]=1;for(g=2257;g<=2264;g++)L[g]=2;for(g=2274;g<=2279;g++)L[g]=2;for(g=2280;g<=2282;g++)L[g]=1;for(g=2283;g<=2289;g++)L[g]=2;for(g=2290;g<=2292;g++)L[g]=0;for(g=2308;g<=2313;g++)L[g]=0;for(g=2315;g<=2491;g++)L[g]=0;for(g=2494;g<=2866;g++)L[g]=0;for(g=2867;g<=2869;g++)L[g]=1;for(g=2870;g<=2888;g++)L[g]=2;for(g=2891;g<=2895;g++)L[g]=2;for(g=2896;g<=2898;g++)L[g]=1;for(g=2902;g<=2908;g++)L[g]=2;for(g=2915;g<=2920;g++)L[g]=2;for(g=2921;g<=2923;g++)L[g]=1;for(g=2924;g<=2930;g++)L[g]=2;for(g=2931;g<=2962;g++)L[g]=0;for(g=2964;g<=2968;g++)L[g]=2;for(g=2969;g<=2973;g++)L[g]=0;for(g=2975;g<=2991;g++)L[g]=0;for(g=2995;g<=3051;g++)L[g]=0;for(g=3054;g<=3079;g++)L[g]=0;for(g=3081;g<=3088;g++)L[g]=0;for(g=3092;g<=3101;g++)L[g]=0;for(g=3106;g<=3138;g++)L[g]=0;for(g=3146;g<=3151;g++)L[g]=0;for(g=3153;g<=3166;g++)L[g]=0;for(g=3168;g<=3172;g++)L[g]=0;for(g=3174;g<=3203;g++)L[g]=0;for(g=3294;g<=3358;g++)L[g]=0;for(g=3367;g<=3403;g++)L[g]=0;for(g=3408;g<=3416;g++)L[g]=0;for(g=3417;g<=3438;g++)L[g]=2;for(g=3441;g<=3446;g++)L[g]=2;for(g=3447;g<=3450;g++)L[g]=0;for(g=3451;g<=3459;g++)L[g]=2;for(g=3460;g<=3478;g++)L[g]=0;for(g=3554;g<=3559;g++)L[g]=0;for(g=3560;g<=3570;g++)L[g]=2;for(g=3571;g<=3581;g++)L[g]=0;for(g=3594;g<=3597;g++)L[g]=0;for(g=3601;g<=3604;g++)L[g]=0;for(g=3637;g<=3639;g++)L[g]=0;for(g=3665;g<=3667;g++)L[g]=0;for(g=3693;g<=3695;g++)L[g]=0;for(g=3701;g<=3727;g++)L[g]=0;for(g=3728;g<=3739;g++)L[g]=2;for(g=3740;g<=3751;g++)L[g]=0;for(g=3753;g<=3760;g++)L[g]=2;for(g=3761;g<=3773;g++)L[g]=0;for(g=3775;g<=3777;g++)L[g]=0;for(g=3779;g<=3781;g++)L[g]=0;for(g=3783;g<=3785;g++)L[g]=0;for(g=3788;g<=3791;g++)L[g]=0;for(g=3797;g<=3802;g++)L[g]=0;for(g=3814;g<=3816;g++)L[g]=0;for(g=3825;g<=3829;g++)L[g]=0;for(g=3832;g<=3841;g++)L[g]=0;for(g=3844;g<=3852;g++)L[g]=0;for(g=3873;g<=3885;g++)L[g]=0;for(g=3890;g<=3893;g++)L[g]=0;for(g=3907;g<=3912;g++)L[g]=0;for(g=3942;g<=3950;g++)L[g]=0;for(g=3968;g<=3970;g++)L[g]=0;for(g=3973;g<=3976;g++)L[g]=0;for(g=3986;g<=3989;g++)L[g]=0;for(g=3994;g<=3997;g++)L[g]=0;for(g=4048;g<=4051;g++)L[g]=0;for(g=4056;g<=4063;g++)L[g]=0;for(g=4093;g<=4096;g++)L[g]=0;for(g=4390;g<=4398;g++)L[g]=0;for(g=4399;g<=4413;g++)L[g]=2;for(g=4418;g<=4433;g++)L[g]=2;for(g=4455;g<=4457;g++)L[g]=2;for(g=4484;g<=4489;g++)L[g]=0;for(g=4491;g<=4554;g++)L[g]=0;for(g=4568;g<=4589;g++)L[g]=0;for(g=4652;g<=4656;g++)L[g]=0;for(g=4766;g<=4800;g++)L[g]=0;for(g=5014;g<=5016;g++)L[g]=0;for(g=5069;g<=5072;g++)L[g]=0;for(g=5105;g<=5130;g++)L[g]=0;for(g=5167;g<=5188;g++)L[g]=0;for(g=5253;g<=5259;g++)L[g]=0;for(g=5269;g<=5275;g++)L[g]=0;for(g=5292;g<=5311;g++)L[g]=0;for(g=5329;g<=5331;g++)L[g]=0;for(g=5343;g<=5349;g++)L[g]=0;for(g=5355;g<=5357;g++)L[g]=0;for(g=5387;g<=5389;g++)L[g]=0;for(g=5459;g<=5463;g++)L[g]=0;for(g=5479;g<=5482;g++)L[g]=0;for(g=5518;g<=5520;g++)L[g]=0;for(g=5530;g<=5539;g++)L[g]=0;for(g=5550;g<=5552;g++)L[g]=0;for(g=5562;g<=5583;g++)L[g]=0;for(g=5623;g<=5625;g++)L[g]=2;for(g=5631;g<=5639;g++)L[g]=0;for(g=5649;g<=5653;g++)L[g]=0;for(g=5663;g<=5680;g++)L[g]=0;for(g=5682;g<=5685;g++)L[g]=0;for(g=5875;g<=5877;g++)L[g]=0;for(g=5896;g<=5899;g++)L[g]=0;for(g=5921;g<=5940;g++)L[g]=0;for(g=6050;g<=6125;g++)L[g]=0;for(g=6244;g<=6275;g++)L[g]=0;for(g=6328;g<=6348;g++)L[g]=0;for(g=6350;g<=6356;g++)L[g]=0;for(g=6366;g<=6372;g++)L[g]=0;for(g=6381;g<=6387;g++)L[g]=0;for(g=6393;g<=6404;g++)L[g]=0;for(g=6480;g<=6483;g++)L[g]=0;for(g=6511;g<=6514;g++)L[g]=0;for(g=6579;g<=6581;g++)L[g]=0;for(g=6619;g<=6624;g++)L[g]=0;for(g=6625;g<=6627;g++)L[g]=2;for(g=6628;g<=6632;g++)L[g]=0;for(g=6634;g<=6637;g++)L[g]=0;for(g=6669;g<=6692;g++)L[g]=0;for(g=6707;g<=6709;g++)L[g]=0;for(g=6720;g<=6723;g++)L[g]=0;for(g=6732;g<=6738;g++)L[g]=0;for(g=6931;g<=6933;g++)L[g]=0;for(g=6956;g<=6959;g++)L[g]=0;for(g=7005;g<=7007;g++)L[g]=0;for(g=7057;g<=7070;g++)L[g]=2;for(g=7074;g<=7082;g++)L[g]=0;for(g=7109;g<=7118;g++)L[g]=0;for(g=7119;g<=7127;g++)L[g]=1;for(g=7374;g<=7376;g++)L[g]=0;for(g=7528;g<=7586;g++)L[g]=0;for(g=7587;g<=7645;g++)L[g]=2;for(g=7692;g<=7696;g++)L[g]=0;for(g=7755;g<=7787;g++)L[g]=0;for(g=7791;g<=7795;g++)L[g]=0;for(g=7799;g<=7801;g++)L[g]=0;for(g=7803;g<=7805;g++)L[g]=0;for(g=7825;g<=7831;g++)L[g]=0;for(g=7845;g<=7859;g++)L[g]=0;for(g=8013;g<=8032;g++)L[g]=0;for(g=8065;g<=8068;g++)L[g]=1;for(g=8518;g<=8529;g++)L[g]=2;for(g=8533;g<=8536;g++)L[g]=2;for(g=8538;g<=8540;g++)L[g]=2;for(g=8677;g<=8679;g++)L[g]=0;for(g=8836;g<=8840;g++)L[g]=0;for(g=8857;g<=8859;g++)L[g]=0;for(g=8908;g<=8910;g++)L[g]=0;for(g=9154;g<=9159;g++)L[g]=0;for(g=9205;g<=9218;g++)L[g]=0;for(g=9271;g<=9273;g++)L[g]=0;for(g=9295;g<=9297;g++)L[g]=0;for(g=9356;g<=9360;g++)L[g]=0;for(g=9404;g<=9407;g++)L[g]=0;for(g=9476;g<=9482;g++)L[g]=0;for(g=9487;g<=9494;g++)L[g]=0;for(g=9697;g<=9699;g++)L[g]=0;for(g=9821;g<=9865;g++)L[g]=0;for(g=10285;g<=10291;g++)L[g]=0;for(g=10314;g<=10317;g++)L[g]=0;for(g=10448;g<=10465;g++)L[g]=0;for(g=11114;g<=11118;g++)L[g]=0;for(g=20004;g<=20032;g++)L[g]=0;for(g=20047;g<=20049;g++)L[g]=0;for(g=20062;g<=20092;g++)L[g]=0;for(g=20135;g<=20138;g++)L[g]=0;for(g=20248;g<=20258;g++)L[g]=0;for(g=20348;g<=20358;g++)L[g]=0;for(g=20436;g<=20440;g++)L[g]=0;for(g=20822;g<=20824;g++)L[g]=0;for(g=20904;g<=20932;g++)L[g]=0;for(g=20934;g<=20936;g++)L[g]=0;for(g=21004;g<=21032;g++)L[g]=0;for(g=21035;g<=21037;g++)L[g]=0;for(g=21095;g<=21097;g++)L[g]=0;for(g=21148;g<=21150;g++)L[g]=0;for(g=21207;g<=21264;g++)L[g]=0;for(g=21307;g<=21364;g++)L[g]=0;for(g=21413;g<=21423;g++)L[g]=0;for(g=21453;g<=21463;g++)L[g]=0;for(g=21473;g<=21483;g++)L[g]=0;for(g=21780;g<=21782;g++)L[g]=0;for(g=21891;g<=21894;g++)L[g]=0;for(g=21896;g<=21899;g++)L[g]=0;for(g=22171;g<=22177;g++)L[g]=0;for(g=22181;g<=22187;g++)L[g]=0;for(g=22191;g<=22197;g++)L[g]=0;for(g=22207;g<=22222;g++)L[g]=0;for(g=22229;g<=22232;g++)L[g]=0;for(g=22234;g<=22236;g++)L[g]=0;for(g=22243;g<=22250;g++)L[g]=0;for(g=22262;g<=22265;g++)L[g]=0;for(g=22307;g<=22322;g++)L[g]=0;for(g=22348;g<=22357;g++)L[g]=0;for(g=22407;g<=22422;g++)L[g]=0;for(g=22462;g<=22465;g++)L[g]=0;for(g=22521;g<=22525;g++)L[g]=0;for(g=22607;g<=22622;g++)L[g]=0;for(g=22641;g<=22646;g++)L[g]=0;for(g=22648;g<=22657;g++)L[g]=0;for(g=22707;g<=22722;g++)L[g]=0;for(g=22762;g<=22765;g++)L[g]=0;for(g=22807;g<=22822;g++)L[g]=0;for(g=22991;g<=22994;g++)L[g]=0;for(g=23028;g<=23038;g++)L[g]=0;for(g=23301;g<=23333;g++)L[g]=2;for(g=23830;g<=23853;g++)L[g]=0;for(g=23866;g<=23872;g++)L[g]=0;for(g=23877;g<=23884;g++)L[g]=0;for(g=23886;g<=23894;g++)L[g]=0;for(g=23946;g<=23948;g++)L[g]=0;for(g=24311;g<=24313;g++)L[g]=0;for(g=24342;g<=24347;g++)L[g]=0;for(g=24370;g<=24374;g++)L[g]=10;for(g=24375;g<=24381;g++)L[g]=0;for(g=24718;g<=24721;g++)L[g]=0;for(g=24817;g<=24821;g++)L[g]=0;for(g=24877;g<=24882;g++)L[g]=0;for(g=24891;g<=24893;g++)L[g]=0;for(g=25391;g<=25395;g++)L[g]=0;for(g=25828;g<=25838;g++)L[g]=0;for(g=26191;g<=26195;g++)L[g]=0;for(g=26391;g<=26393;g++)L[g]=0;for(g=26701;g<=26722;g++)L[g]=0;for(g=26729;g<=26799;g++)L[g]=2;for(g=26801;g<=26803;g++)L[g]=2;for(g=26811;g<=26813;g++)L[g]=2;for(g=26847;g<=26870;g++)L[g]=2;for(g=26891;g<=26899;g++)L[g]=0;for(g=26901;g<=26923;g++)L[g]=0;for(g=26929;g<=26946;g++)L[g]=0;for(g=26948;g<=26998;g++)L[g]=0;for(g=27037;g<=27040;g++)L[g]=0;for(g=27205;g<=27232;g++)L[g]=0;for(g=27258;g<=27260;g++)L[g]=0;for(g=27391;g<=27398;g++)L[g]=0;for(g=27561;g<=27564;g++)L[g]=0;for(g=27571;g<=27574;g++)L[g]=0;for(g=27581;g<=27584;g++)L[g]=0;for(g=27591;g<=27594;g++)L[g]=0;for(g=28191;g<=28193;g++)L[g]=0;for(g=28348;g<=28358;g++)L[g]=0;for(g=28402;g<=28432;g++)L[g]=0;for(g=28462;g<=28492;g++)L[g]=0;for(g=29118;g<=29122;g++)L[g]=0;for(g=29168;g<=29172;g++)L[g]=0;for(g=29177;g<=29185;g++)L[g]=0;for(g=29187;g<=29195;g++)L[g]=0;for(g=29900;g<=29903;g++)L[g]=0;for(g=30161;g<=30179;g++)L[g]=0;for(g=30491;g<=30494;g++)L[g]=0;for(g=30729;g<=30732;g++)L[g]=0;for(g=31251;g<=31259;g++)L[g]=0;for(g=31265;g<=31268;g++)L[g]=0;for(g=31275;g<=31279;g++)L[g]=0;for(g=31281;g<=31297;g++)L[g]=0;for(g=31461;g<=31469;g++)L[g]=0;for(g=31491;g<=31495;g++)L[g]=0;for(g=31917;g<=31922;g++)L[g]=0;for(g=31965;g<=32e3;g++)L[g]=0;for(g=32001;g<=32003;g++)L[g]=2;for(g=32005;g<=32031;g++)L[g]=2;for(g=32033;g<=32060;g++)L[g]=2;for(g=32064;g<=32067;g++)L[g]=2;for(g=32074;g<=32077;g++)L[g]=2;for(g=32081;g<=32086;g++)L[g]=0;for(g=32107;g<=32130;g++)L[g]=0;for(g=32133;g<=32159;g++)L[g]=0;for(g=32164;g<=32167;g++)L[g]=2;for(g=32180;g<=32199;g++)L[g]=0;for(g=32201;g<=32260;g++)L[g]=0;for(g=32301;g<=32360;g++)L[g]=0;for(g=32401;g<=32460;g++)L[g]=0;for(g=32501;g<=32560;g++)L[g]=0;for(g=32601;g<=32662;g++)L[g]=0;for(g=32664;g<=32667;g++)L[g]=2;for(g=32701;g<=32761;g++)L[g]=0;for(g=53001;g<=53004;g++)L[g]=0;for(g=53008;g<=53019;g++)L[g]=0;for(g=53021;g<=53032;g++)L[g]=0;for(g=53034;g<=53037;g++)L[g]=0;for(g=53042;g<=53046;g++)L[g]=0;for(g=53074;g<=53080;g++)L[g]=0;for(g=54001;g<=54004;g++)L[g]=0;for(g=54008;g<=54019;g++)L[g]=0;for(g=54021;g<=54032;g++)L[g]=0;for(g=54034;g<=54037;g++)L[g]=0;for(g=54042;g<=54046;g++)L[g]=0;for(g=54048;g<=54053;g++)L[g]=0;for(g=54074;g<=54080;g++)L[g]=0;for(g=54098;g<=54101;g++)L[g]=0;for(g=102001;g<=102040;g++)L[g]=0;for(g=102042;g<=102063;g++)L[g]=0;for(g=102065;g<=102067;g++)L[g]=0;for(g=102070;g<=102117;g++)L[g]=0;for(g=102122;g<=102216;g++)L[g]=0;for(g=102221;g<=102377;g++)L[g]=0;for(g=102382;g<=102388;g++)L[g]=0;for(g=102389;g<=102398;g++)L[g]=2;for(g=102399;g<=102444;g++)L[g]=0;for(g=102445;g<=102447;g++)L[g]=2;for(g=102448;g<=102458;g++)L[g]=0;for(g=102459;g<=102468;g++)L[g]=2;for(g=102469;g<=102499;g++)L[g]=0;for(g=102500;g<=102519;g++)L[g]=1;for(g=102520;g<=102524;g++)L[g]=0;for(g=102525;g<=102529;g++)L[g]=2;for(g=102530;g<=102588;g++)L[g]=0;for(g=102590;g<=102598;g++)L[g]=0;for(g=102601;g<=102603;g++)L[g]=0;for(g=102605;g<=102628;g++)L[g]=0;for(g=102629;g<=102646;g++)L[g]=2;for(g=102648;g<=102700;g++)L[g]=2;for(g=102701;g<=102703;g++)L[g]=0;for(g=102707;g<=102730;g++)L[g]=2;for(g=102733;g<=102758;g++)L[g]=2;for(g=102767;g<=102900;g++)L[g]=0;for(g=102901;g<=102933;g++)L[g]=2;for(g=102934;g<=102950;g++)L[g]=13;for(g=102951;g<=102955;g++)L[g]=0;for(g=102961;g<=102963;g++)L[g]=0;for(g=102965;g<=102969;g++)L[g]=0;for(g=102971;g<=102973;g++)L[g]=0;for(g=102975;g<=102989;g++)L[g]=0;for(g=102990;g<=102992;g++)L[g]=1;for(g=102997;g<=103002;g++)L[g]=0;for(g=103003;g<=103008;g++)L[g]=2;for(g=103009;g<=103011;g++)L[g]=0;for(g=103012;g<=103014;g++)L[g]=2;for(g=103019;g<=103021;g++)L[g]=0;for(g=103022;g<=103024;g++)L[g]=2;for(g=103029;g<=103031;g++)L[g]=0;for(g=103032;g<=103034;g++)L[g]=2;for(g=103065;g<=103068;g++)L[g]=0;for(g=103074;g<=103076;g++)L[g]=0;for(g=103077;g<=103079;g++)L[g]=1;for(g=103080;g<=103082;g++)L[g]=0;for(g=103083;g<=103085;g++)L[g]=2;for(g=103090;g<=103093;g++)L[g]=0;for(g=103097;g<=103099;g++)L[g]=0;for(g=103100;g<=103102;g++)L[g]=2;for(g=103107;g<=103109;g++)L[g]=0;for(g=103110;g<=103112;g++)L[g]=2;for(g=103113;g<=103116;g++)L[g]=0;for(g=103117;g<=103120;g++)L[g]=2;for(g=103153;g<=103157;g++)L[g]=0;for(g=103158;g<=103162;g++)L[g]=2;for(g=103163;g<=103165;g++)L[g]=0;for(g=103166;g<=103168;g++)L[g]=1;for(g=103169;g<=103171;g++)L[g]=2;for(g=103186;g<=103188;g++)L[g]=0;for(g=103189;g<=103191;g++)L[g]=2;for(g=103192;g<=103195;g++)L[g]=0;for(g=103196;g<=103199;g++)L[g]=2;for(g=103200;g<=103224;g++)L[g]=0;for(g=103225;g<=103227;g++)L[g]=1;for(g=103232;g<=103237;g++)L[g]=0;for(g=103238;g<=103243;g++)L[g]=2;for(g=103244;g<=103246;g++)L[g]=0;for(g=103247;g<=103249;g++)L[g]=2;for(g=103254;g<=103256;g++)L[g]=0;for(g=103257;g<=103259;g++)L[g]=2;for(g=103264;g<=103266;g++)L[g]=0;for(g=103267;g<=103269;g++)L[g]=2;for(g=103300;g<=103375;g++)L[g]=0;for(g=103381;g<=103383;g++)L[g]=0;for(g=103384;g<=103386;g++)L[g]=1;for(g=103387;g<=103389;g++)L[g]=0;for(g=103390;g<=103392;g++)L[g]=2;for(g=103397;g<=103399;g++)L[g]=0;for(g=103400;g<=103471;g++)L[g]=2;for(g=103476;g<=103478;g++)L[g]=0;for(g=103479;g<=103481;g++)L[g]=2;for(g=103486;g<=103488;g++)L[g]=0;for(g=103489;g<=103491;g++)L[g]=2;for(g=103492;g<=103495;g++)L[g]=0;for(g=103496;g<=103499;g++)L[g]=2;for(g=103528;g<=103543;g++)L[g]=0;for(g=103544;g<=103548;g++)L[g]=2;for(g=103549;g<=103551;g++)L[g]=0;for(g=103552;g<=103554;g++)L[g]=1;for(g=103555;g<=103557;g++)L[g]=2;for(g=103558;g<=103560;g++)L[g]=0;for(g=103571;g<=103573;g++)L[g]=0;for(g=103574;g<=103576;g++)L[g]=2;for(g=103577;g<=103580;g++)L[g]=0;for(g=103581;g<=103583;g++)L[g]=2;for(g=103595;g<=103694;g++)L[g]=0;for(g=103696;g<=103699;g++)L[g]=0;for(g=103700;g<=103793;g++)L[g]=2;for(g=103794;g<=103890;g++)L[g]=0;for(g=103891;g<=103896;g++)L[g]=2;for(g=103900;g<=103971;g++)L[g]=2;for(g=103972;g<=103977;g++)L[g]=0;for(g=112e3;g<=112101;g++)L[g]=0;const kMe={102113:!0,102100:!0,3857:!0,3785:!0},UMe={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},KJ='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',hP=[-20037508342788905e-9,20037508342788905e-9],dP=[-20037508342787e-6,20037508342787e-6],yde={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:hP,origin:dP,dx:1e-5},102100:{wkTemplate:KJ,valid:hP,origin:dP,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:hP,origin:dP,dx:1e-5},3857:{wkTemplate:KJ,valid:hP,origin:dP,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function wn(t,e){if(t===e)return!0;if(t==null||e==null)return!1;if(t.wkid!=null||e.wkid!=null)return t.wkid===e.wkid||yb(t)&&yb(e)||e.latestWkid!=null&&t.wkid===e.latestWkid||t.latestWkid!=null&&e.wkid===t.latestWkid;const i=t.wkt2??t.wkt,r=e.wkt2??e.wkt;return!(!i||!r)&&i.toUpperCase()===r.toUpperCase()}function Fd(t){return ta(t)&&t.wkid&&yde[t.wkid]||null}function DD(t){if(!t)return;if(t.wkid)return String(t.wkid);const e=t.wkt||t.wkt2;return JSON.stringify(e?{wkt:e}:{})}function XH(t){if(!ta(t))return!1;if(t.wkid)return L[t.wkid]==null;const e=t.wkt2||t.wkt;return!!e&&/^\s*(?:GEOGCS|GEOGCRS|GEOGRAPHICCRS)/i.test(e)}function $T(t){return!(Vf(t)||Gf(t))}function W3(t){return ta(t)&&t.wkid===4326}function HSt(t){return/^\s*(?:GEOD|GEODETIC|GEOG|GEOGRAPHIC|PROJ|PROJECTED|VERT|VERTICAL|ENG|ENGINEERING|PARAMETRIC|TIME|DERIVEDPROJ|COMPOUND|BOUND)CRS/i.test(t)}function _de(t){return ta(t)&&t.wkid===ih.CGCS2000}function yb(t){return ta(t)&&t.wkid!=null&&kMe[t.wkid]===!0}function ZH(t){return ta(t)&&t.wkid===32662}function JH(t){return t===ih.GCSMARS2000||t===ih.GCSMARS2000_SPHERE}function Vf(t){return ta(t)&&t.wkid!=null&&JH(t.wkid)}function KH(t){return t===ih.GCSMOON2000}function Gf(t){return ta(t)&&t.wkid!=null&&KH(t.wkid)}function zMe(t){return ta(t)&&t.wkid!=null&&UMe[t.wkid]===!0}function ta(t){return t!=null&&(t.wkid!=null&&t.wkid>=2e3||t.wkt2!=null||t.wkt!=null)}const BMe={wkid:4326,wkt:h4(yde[4326].wkTemplate,{Central_Meridian:"0.0"})},VMe={wkid:102100,latestWkid:3857},GMe={wkid:32662};function QH(t){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${t.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const vde=QH(yi),w4=QH(vf),x4=QH(wg),bde={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${yi.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`};function Fi(t){return t!=null&&(Vf(t)||wn(t,w4))?vf:t!=null&&(Gf(t)||wn(t,x4))?wg:yi}function qSt(t){return JH(t)?vf:KH(t)?wg:yi}function ND(t){return wn(t,vde)}function e_(t){return ND(t)||wn(t,w4)||wn(t,x4)}const eq=39.37,jMe=yi.radius*Math.PI/200,wde=/(?:LENGTH)?UNIT\[([^\]]+)]]$/i,X1=L,xde=/UNIT\[([^\]]+)]/i,HMe=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),qMe=fu()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),lp=t=>t*t,n0=t=>t*t*t,Y3={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:lp(.001)},"square-centimeters":{inBaseUnits:lp(.01)},"square-decimeters":{inBaseUnits:lp(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:lp(1e3)},"square-inches":{inBaseUnits:lp(.0254)},"square-feet":{inBaseUnits:lp(.3048)},"square-yards":{inBaseUnits:lp(.9144)},"square-miles":{inBaseUnits:lp(1609.344)},"square-us-feet":{inBaseUnits:lp(1200/3937)},acres:{inBaseUnits:.0015625*lp(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*n0(.001)},"cubic-centimeters":{inBaseUnits:1e3*n0(.01)},"cubic-decimeters":{inBaseUnits:1e3*n0(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*n0(1e3)},"cubic-inches":{inBaseUnits:1e3*n0(.0254)},"cubic-feet":{inBaseUnits:1e3*n0(.3048)},"cubic-yards":{inBaseUnits:1e3*n0(.9144)},"cubic-miles":{inBaseUnits:1e3*n0(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},WMe=(()=>{const t={};for(const e in Y3)for(const i in Y3[e].units)t[i]=e;return t})();function YMe(t,e,i){return t*Y3[i].units[e].inBaseUnits}function XMe(t,e,i){return t/Y3[i].units[e].inBaseUnits}const ZMe=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"];function AB(t){const e=WMe[t];if(!e)throw new Error("unknown type");return e}function QJ(t,e=null){return e=e||AB(t),Y3[e].baseUnit===t}function ao(t,e,i){if(e===i)return t;const r=AB(e);if(r!==AB(i))throw new Error("incompatible units");const n=QJ(e,r)?t:YMe(t,e,r);return QJ(i,r)?n:XMe(n,i,r)}function WSt(t,e,i){switch(i){case"metric":return JMe(t,e);case"imperial":return QMe(t,e);default:return i}}function YSt(t,e,i){switch(i){case"metric":return KMe(t,e);case"imperial":return e$e(t,e);default:return i}}function JMe(t,e){const i=ao(t,e,"meters");return Math.abs(i)<3e3?"meters":"kilometers"}function KMe(t,e){const i=ao(t,e,"meters");return Math.abs(i)<1e5?"meters":"kilometers"}function QMe(t,e){const i=ao(t,e,"feet");return Math.abs(i)<1e3?"feet":"miles"}function e$e(t,e){const i=ao(t,e,"feet");return Math.abs(i)<1e5?"feet":"miles"}function XSt(t,e){const i=ao(t,e,"square-meters");return Math.abs(i)<3e6?"square-meters":"square-kilometers"}function ZSt(t,e){const i=ao(t,e,"square-feet");return Math.abs(i)<1e6?"square-feet":"square-miles"}function t$e(t,e,i){return ao(t,e,"meters")/(i*Math.PI/180)}function Tde(t){return qMe.fromJSON(t.toLowerCase())||null}function FD(t){if(t!=null&&!$T(t))return 1;const e=ua(t);return e>1e5?1:e}function i$e(t){return ua(t)>=Fi(t).metersPerDegree?"meters":T4(t)}function ua(t,e=yi.metersPerDegree){return r$e(t,!0)??e}function r$e(t,e=!1){const i=t?.wkid??null,r=t?.wkt2??t?.wkt??null;let n=null;if(i){if(JH(i))return vf.metersPerDegree;if(KH(i))return wg.metersPerDegree;n=X1.values[X1[i]],!n&&e&&HMe.has(i)&&(n=jMe)}else r&&(Cde(r)?n=eK(wde.exec(r),n):Ede(r)&&(n=eK(xde.exec(r),n)));return n}function OB(t){return XH(t)?1:ua(t)}function eK(t,e){return t?.[1]?Sde(t[1]):e}function Sde(t){return parseFloat(t.split(",")[1])}function T4(t){const e=t?.wkid??null,i=t?.wkt2??t?.wkt??null;let r=null;if(e)r=X1.units[X1[e]];else if(i){const n=Cde(i)?wde:Ede(i)?xde:null;if(n){const s=n.exec(i);s?.[1]&&(r=s$e(s[1]))}}return r!=null?Tde(r):null}function JSt(t){const e=T4(t);return e!=null&&ZMe.includes(e)?e:null}function Ede(t){return/^GEOCCS/i.test(t)}function Cde(t){return/^\s*(?:PROJCS|PROJCRS|PROJECTEDCRS)/i.test(t)}const n$e=1e-7;function s$e(t){let i=/[\\"']{1}([^\\"']+)/.exec(t)?.[1];if(!i||!X1.units.includes(i)){const r=Sde(t);i=null;const n=X1.values;for(let s=0;s<n.length;++s)if(Math.abs(r-n[s])<n$e){i=X1.units[s];break}}return i}function KSt(t){const e=T4(t);if(e==null)return null;switch(e){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}const o$e={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},a$e={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},l$e={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},QSt=fu()(o$e),eEt=fu()(a$e),tEt=fu()(l$e);var Pp;let ar=Pp=class extends $e{static fromJSON(t){if(!t)return null;if(t.wkid){if(t.wkid===102100)return Pp.WebMercator;if(t.wkid===4326)return Pp.WGS84}const e=new Pp;return e.read(t),e}constructor(t){super(t),this.latestWkid=null,this.wkid=null,this.wkt=null,this.wkt2=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(t){return t&&typeof t=="object"?t:{[typeof t=="string"?"wkt":"wkid"]:t}}get isWGS84(){return W3(this)}get isWebMercator(){return yb(this)}get isGeographic(){return XH(this)}get isWrappable(){return zMe(this)}get metersPerUnit(){return ua(this)}get unit(){return T4(this)||(this.isGeographic?"degrees":null)}writeWkt(t,e){this.wkid||(e.wkt=t)}clone(){if(this===Pp.WGS84)return Pp.WGS84;if(this===Pp.WebMercator)return Pp.WebMercator;const t=new Pp;return this.wkid!=null?(t.wkid=this.wkid,this.latestWkid!=null&&(t.latestWkid=this.latestWkid),this.vcsWkid!=null&&(t.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(t.latestVcsWkid=this.latestVcsWkid)):(this.wkt!=null&&(t.wkt=this.wkt),this.wkt2!=null&&(t.wkt2=this.wkt2)),this.imageCoordinateSystem&&(t.imageCoordinateSystem=ye(this.imageCoordinateSystem)),t}equals(t){if(t==null)return!1;if(this.imageCoordinateSystem||t.imageCoordinateSystem){if(this.imageCoordinateSystem==null||t.imageCoordinateSystem==null)return!1;const{id:e,referenceServiceName:i}=t.imageCoordinateSystem,{geodataXform:r}=t.imageCoordinateSystem,n=this.imageCoordinateSystem;return e==null||r?JSON.stringify(n)===JSON.stringify(t.imageCoordinateSystem):i?n.id===e&&n.referenceServiceName===i:n.id===e}return wn(this,t)}toJSON(t){return this.write(void 0,t)}};ar.GCS_NAD_1927=null,ar.WGS84=null,ar.WebMercator=null,ar.PlateCarree=null,h([f({readOnly:!0})],ar.prototype,"isWGS84",null),h([f({readOnly:!0})],ar.prototype,"isWebMercator",null),h([f({readOnly:!0})],ar.prototype,"isGeographic",null),h([f({readOnly:!0})],ar.prototype,"isWrappable",null),h([f({type:Ln,json:{write:!0}})],ar.prototype,"latestWkid",void 0),h([f({readOnly:!0})],ar.prototype,"metersPerUnit",null),h([f({readOnly:!0})],ar.prototype,"unit",null),h([f({type:Ln,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt==null}}}}}}})],ar.prototype,"wkid",void 0),h([f({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid==null}}}}}}})],ar.prototype,"wkt",void 0),h([di("wkt"),di("web-scene","wkt")],ar.prototype,"writeWkt",null),h([f({type:String,json:{write:!1}})],ar.prototype,"wkt2",void 0),h([f({type:Ln,json:{write:!0}})],ar.prototype,"vcsWkid",void 0),h([f({type:Ln,json:{write:!0}})],ar.prototype,"latestVcsWkid",void 0),h([f()],ar.prototype,"imageCoordinateSystem",void 0),ar=Pp=h([z("esri.geometry.SpatialReference")],ar),ar.prototype.toJSON.isDefaultToJSON=!0,ar.GCS_NAD_1927=new ar({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),ar.WGS84=new ar(BMe),ar.WebMercator=new ar(VMe),ar.PlateCarree=new ar(GMe),Object.freeze&&(Object.freeze(ar.GCS_NAD_1927),Object.freeze(ar.WGS84),Object.freeze(ar.WebMercator));const je=ar;function Ni(t,e,i){let r,n;return e===void 0||Array.isArray(e)?(n=t,i=e,r=[void 0]):(n=e,r=Array.isArray(t)?t:[t]),(s,o)=>{const a=s.constructor.prototype;r.forEach(l=>{const c=Che(s,l,n);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],i&&(c.read.source=(c.read.source||[]).concat(i))})}}let Mp=class extends $e{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=je.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,i){if(e instanceof je)return e;if(e!=null){const r=new je;return r.read(e,i),r}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,i){this.cache[e]=i}};h([f()],Mp.prototype,"type",void 0),h([f({readOnly:!0})],Mp.prototype,"cache",null),h([f({readOnly:!0})],Mp.prototype,"extent",null),h([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Mp.prototype,"hasM",void 0),h([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Mp.prototype,"hasZ",void 0),h([f({type:je,json:{write:!0},value:je.WGS84})],Mp.prototype,"spatialReference",void 0),h([Ni("spatialReference")],Mp.prototype,"readSpatialReference",null),Mp=h([z("esri.geometry.Geometry")],Mp);const E_=Mp,c$e=Object.prototype.toString;function u$e(t){const e="__accessorMetadata__"in t?uo(t):t;return function(...i){if(i.push(e),typeof i[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return h$e.apply(this,i)}}function h$e(t,e,i,r){p4(t,e).cast=r}function d$e(t){return(e,i)=>{p4(e,t).cast=e[i]}}function rr(...t){if(t.length!==3||typeof t[1]!="string")return t.length===1&&c$e.call(t[0])==="[object Function]"?u$e(t[0]):t.length===1&&typeof t[0]=="string"?d$e(t[0]):void 0}function p$e(t,e){const i=t.x-e.x,r=t.y-e.y,n=t.hasZ&&e.hasZ?t.z-e.z:0;return Math.sqrt(i*i+r*r+n*n)}const f$e=57.29577951308232,m$e=.017453292519943;function tK(t){return t*f$e}function iK(t){return t*m$e}function rK(t){return t/yi.radius}function kD(t){return Math.PI/2-2*Math.atan(Math.exp(-t/yi.radius))}function RB(t){return t.wkid!=null||t.wkt!=null}const Zk=[0,0];function UD(t,e,i,r,n){const s=t,o=n;if(o.spatialReference=i,"x"in s&&"x"in o)[o.x,o.y]=e(s.x,s.y,Zk,r);else if("xmin"in s&&"xmin"in o)[o.xmin,o.ymin]=e(s.xmin,s.ymin,Zk,r),[o.xmax,o.ymax]=e(s.xmax,s.ymax,Zk,r);else if("paths"in s&&"paths"in o||"rings"in s&&"rings"in o){const a="paths"in s?s.paths:s.rings,l=[];let c;for(let u=0;u<a.length;u++){const d=a[u];c=[],l.push(c);for(let p=0;p<d.length;p++)c.push(e(d[p][0],d[p][1],[0,0],r)),d[p].length>2&&c[p].push(d[p][2]),d[p].length>3&&c[p].push(d[p][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in s&&"points"in o){const a=s.points,l=[];for(let c=0;c<a.length;c++)l[c]=e(a[c][0],a[c][1],[0,0],r),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return n}function UA(t,e){const i=t&&(RB(t)?t:t.spatialReference),r=e&&(RB(e)?e:e.spatialReference);return!(t&&"type"in t&&t.type==="mesh"||e&&"type"in e&&e.type==="mesh"||!i||!r)&&(!!wn(r,i)||yb(r)&&W3(i)||yb(i)&&W3(r))}function sR(t,e){if(t==null)return null;const i=t.spatialReference,r=e&&(RB(e)?e:e.spatialReference);return UA(i,r)?wn(i,r)?ye(t):yb(r)?UD(t,M2,je.WebMercator,!1,ye(t)):W3(r)?UD(t,zA,je.WGS84,!1,ye(t)):null:null}function M2(t,e,i=[0,0]){e>89.99999?e=89.99999:e<-89.99999&&(e=-89.99999);const r=iK(e);return i[0]=iK(t)*yi.radius,i[1]=yi.halfSemiMajorAxis*Math.log((1+Math.sin(r))/(1-Math.sin(r))),i}function zA(t,e,i=[0,0],r=!1){const n=tK(t/yi.radius);return i[0]=r?n:n-360*Math.floor((n+180)/360),i[1]=tK(Math.PI/2-2*Math.atan(Math.exp(-e/yi.radius))),i}function Gy(t,e=!1,i=ye(t)){return UD(t,M2,je.WebMercator,e,i)}function $2(t,e=!1,i=ye(t)){return UD(t,zA,je.WGS84,e,i)}var bI;const aE=[0,0];function nK(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let Qa=bI=class extends E_{static copy(t,e){e._set("x",t._get("x")),e._set("y",t._get("y")),e._set("z",t._get("z")),e._set("m",t._get("m"));const i=t._get("spatialReference");e._set("spatialReference",Object.isFrozen(i)?i:i.clone())}constructor(...t){super(...t),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(t,e,i,r,n){let s;if(Array.isArray(t))s=t,n=e,t=s[0],e=s[1],i=s[2],r=s[3];else if(t&&typeof t=="object"){if(s=t,t=s.x!=null?s.x:s.longitude,e=s.y!=null?s.y:s.latitude,i=s.z,r=s.m,(n=s.spatialReference)&&n.declaredClass!=="esri.geometry.SpatialReference"&&(n=new je(n)),s.longitude!=null||s.latitude!=null){if(s.longitude==null)ne.getLogger(this).warn(".longitude=","Latitude was defined without longitude");else if(s.latitude==null)ne.getLogger(this).warn(".latitude=","Longitude was defined without latitude");else if(!s.declaredClass&&n&&n.isWebMercator){const a=M2(s.longitude,s.latitude,aE);t=a[0],e=a[1]}}}else nK(i)?(n=i,i=null):nK(r)&&(n=r,r=null);const o={x:t,y:e};return o.x==null&&o.y!=null?ne.getLogger(this).warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&ne.getLogger(this).warn(".x=","X coordinate was defined without a Y coordinate"),n!=null&&(o.spatialReference=n),i!=null&&(o.z=i),r!=null&&(o.m=r),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(t){t!==(this._get("m")!==void 0)&&(this._set("m",t?0:void 0),this._set("hasM",t))}get hasZ(){return this.z!==void 0}set hasZ(t){t!==(this._get("z")!==void 0)&&(this._set("z",t?0:void 0),this._set("hasZ",t))}get latitude(){const{spatialReference:t,x:e,y:i}=this;if(t){if(t.isWebMercator)return zA(e,i,aE)[1];if(t.isGeographic)return i}return null}set latitude(t){const{spatialReference:e,x:i}=this;t!=null&&e&&(e.isWebMercator?this._set("y",M2(i,t,aE)[1]):e.isGeographic&&this._set("y",t),this._set("latitude",t))}get longitude(){const{x:t,y:e,spatialReference:i}=this;if(i){if(i.isWebMercator)return zA(t,e,aE)[0];if(i.isGeographic)return t}return null}set longitude(t){const{y:e,spatialReference:i}=this;t!=null&&i&&(i.isWebMercator?this._set("x",M2(t,e,aE)[0]):i.isGeographic&&this._set("x",t),this._set("longitude",t))}writeX(t,e,i){e[i]=isNaN(t)?"NaN":t}readX(t){return typeof t=="string"?NaN:t}clone(){const t=new bI;return t.x=this.x,t.y=this.y,t.z=this.z,t.m=this.m,t.spatialReference=this.spatialReference,t}copy(t){return bI.copy(t,this),this}equals(t){if(t==null)return!1;const{x:e,y:i,z:r,m:n,spatialReference:s}=this,{z:o,m:a}=t;let{x:l,y:c,spatialReference:u}=t;if(!s.equals(u))if(s.isWebMercator&&u.isWGS84)[l,c]=M2(l,c),u=s;else{if(!s.isWGS84||!u.isWebMercator)return!1;[l,c]=zA(l,c),u=s}return e===l&&i===c&&r===o&&n===a&&s.wkid===u.wkid}offset(t,e,i){return this.x+=t,this.y+=e,i!=null&&(this.z=(this.z??0)+i),this}normalize(){if(!this.spatialReference)return this;const t=Fd(this.spatialReference);if(!t)return this;let e=this.x;const[i,r]=t.valid,n=2*r;let s;return e>r?(s=Math.ceil(Math.abs(e-r)/n),e-=s*n):e<i&&(s=Math.ceil(Math.abs(e-i)/n),e+=s*n),this._set("x",e),this}distance(t){return p$e(this,t)}toArray(){const t=this.hasZ,e=this.hasM;return t&&e?[this.x,this.y,this.z,this.m]:t?[this.x,this.y,this.z]:e?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(t){return this.write({},t)}};h([f({readOnly:!0})],Qa.prototype,"cache",null),h([f({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Qa.prototype,"hasM",null),h([f({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Qa.prototype,"hasZ",null),h([f({type:Number})],Qa.prototype,"latitude",null),h([f({type:Number})],Qa.prototype,"longitude",null),h([f({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),rr(t=>isNaN(t)?t:bd(t))],Qa.prototype,"x",void 0),h([di("x")],Qa.prototype,"writeX",null),h([Ni("x")],Qa.prototype,"readX",null),h([f({type:Number,json:{write:!0}})],Qa.prototype,"y",void 0),h([f({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Qa.prototype,"z",void 0),h([f({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],Qa.prototype,"m",void 0),Qa=bI=h([z("esri.geometry.Point")],Qa),Qa.prototype.toJSON.isDefaultToJSON=!0;const lt=Qa,Jk=[0,0];function tq(t,e){return e!=null&&Aa(t,e.x,e.y,e.z)}function rEt(t,e){if(!e.points||e.points.length)return!1;for(const i of e.points)if(!IT(t,i))return!1;return!0}function g$e(t,e){const{xmin:i,ymin:r,zmin:n,xmax:s,ymax:o,zmax:a}=e;return t.hasZ&&e.hasZ?Aa(t,i,r,n)&&Aa(t,i,o,n)&&Aa(t,s,o,n)&&Aa(t,s,r,n)&&Aa(t,i,r,a)&&Aa(t,i,o,a)&&Aa(t,s,o,a)&&Aa(t,s,r,a):Aa(t,i,r)&&Aa(t,i,o)&&Aa(t,s,o)&&Aa(t,s,r)}function IT(t,e){return Aa(t,e[0],e[1])}function y$e(t,e){return Aa(t,e[0],e[1],e[2])}function Aa(t,e,i,r){return e>=t.xmin&&e<=t.xmax&&i>=t.ymin&&i<=t.ymax&&(r==null||!t.hasZ||r>=t.zmin&&r<=t.zmax)}function _$e(t,e){return Jk[1]=e.y,Jk[0]=e.x,v$e(t,Jk)}function v$e(t,e){return Ade(t.rings,e)}function Ade(t,e){if(!t)return!1;if(b$e(t))return sK(!1,t,e);let i=!1;for(let r=0,n=t.length;r<n;r++)i=sK(i,t[r],e);return i}function b$e(t){return!Array.isArray(t[0][0])}function sK(t,e,i){const[r,n]=i;let s=t,o=0;for(let a=0,l=e.length;a<l;a++){o++,o===l&&(o=0);const[c,u]=e[a],[d,p]=e[o];(u<n&&p>=n||p<n&&u>=n)&&c+(n-u)/(p-u)*(d-c)<r&&(s=!s)}return s}function w$e(t,e){return tq(t,e)}function x$e(t,e){const i=t.hasZ&&e.hasZ;let r,n,s;if(t.xmin<=e.xmin){if(r=e.xmin,t.xmax<r)return!1}else if(r=t.xmin,e.xmax<r)return!1;if(t.ymin<=e.ymin){if(n=e.ymin,t.ymax<n)return!1}else if(n=t.ymin,e.ymax<n)return!1;if(i&&e.hasZ){if(t.zmin<=e.zmin){if(s=e.zmin,t.zmax<s)return!1}else if(s=t.zmin,e.zmax<s)return!1}return!0}function T$e(t,e){const{points:i,hasZ:r}=e,n=r?y$e:IT;for(const s of i)if(n(t,s))return!0;return!1}const _b=[0,0],vb=[0,0],bb=[0,0],wb=[0,0],S$e=[_b,vb,bb,wb],Ode=[[bb,_b],[_b,vb],[vb,wb],[wb,bb]];function E$e(t,e){return C$e(t,e.rings)}function C$e(t,e){_b[0]=t.xmin,_b[1]=t.ymax,vb[0]=t.xmax,vb[1]=t.ymax,bb[0]=t.xmin,bb[1]=t.ymin,wb[0]=t.xmax,wb[1]=t.ymin;for(const i of S$e)if(Ade(e,i))return!0;for(const i of e){if(!i.length)continue;let r=i[0];if(IT(t,r))return!0;for(let n=1;n<i.length;n++){const s=i[n];if(IT(t,s)||Rde(r,s,Ode))return!0;r=s}}return!1}function A$e(t,e){_b[0]=t.xmin,_b[1]=t.ymax,vb[0]=t.xmax,vb[1]=t.ymax,bb[0]=t.xmin,bb[1]=t.ymin,wb[0]=t.xmax,wb[1]=t.ymin;const i=e.paths;for(const r of i){if(!i.length)continue;let n=r[0];if(IT(t,n))return!0;for(let s=1;s<r.length;s++){const o=r[s];if(IT(t,o)||Rde(n,o,Ode))return!0;n=o}}return!1}const vo=[0,0];function O$e(t){for(let e=0;e<t.length;e++){const i=t[e];for(let n=0;n<i.length-1;n++){const s=i[n],o=i[n+1];for(let a=e+1;a<t.length;a++)for(let l=0;l<t[a].length-1;l++){const c=t[a][l],u=t[a][l+1];if(PB(s,o,c,u,vo)&&!(vo[0]===s[0]&&vo[1]===s[1]||vo[0]===c[0]&&vo[1]===c[1]||vo[0]===o[0]&&vo[1]===o[1]||vo[0]===u[0]&&vo[1]===u[1]))return!0}}const r=i.length;if(!(r<=4))for(let n=0;n<r-3;n++){let s=r-1;n===0&&(s=r-2);const o=i[n],a=i[n+1];for(let l=n+2;l<s;l++){const c=i[l],u=i[l+1];if(PB(o,a,c,u,vo)&&!(vo[0]===o[0]&&vo[1]===o[1]||vo[0]===c[0]&&vo[1]===c[1]||vo[0]===a[0]&&vo[1]===a[1]||vo[0]===u[0]&&vo[1]===u[1]))return!0}}}return!1}function Rde(t,e,i){for(let r=0;r<i.length;r++)if(PB(t,e,i[r][0],i[r][1]))return!0;return!1}function PB(t,e,i,r,n){const[s,o]=t,[a,l]=e,[c,u]=i,[d,p]=r,m=d-c,y=s-c,_=a-s,v=p-u,w=o-u,x=l-o,T=v*_-m*x;if(T===0)return!1;const S=(m*w-v*y)/T,E=(_*w-x*y)/T;return S>=0&&S<=1&&E>=0&&E<=1&&(n&&(n[0]=s+S*(a-s),n[1]=o+S*(l-o)),!0)}function R$e(t){switch(t){case"esriGeometryEnvelope":case"extent":return x$e;case"esriGeometryMultipoint":case"multipoint":return T$e;case"esriGeometryPoint":case"point":return w$e;case"esriGeometryPolygon":case"polygon":return E$e;case"esriGeometryPolyline":case"polyline":return A$e}}var Mu;function P$e(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}function s0(t,e,i){return e==null?i:i==null?e:t(e,i)}let eo=Mu=class extends E_{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,i,r,n){return P$e(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:typeof t=="object"?(t.spatialReference=t.spatialReference==null?je.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:i,ymax:r,spatialReference:n??je.WGS84}}static fromBounds(t,e){return new Mu({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}static fromPoint(t){return new Mu({xmin:t.x,ymin:t.y,zmin:t.z,xmax:t.x,ymax:t.y,zmax:t.z,spatialReference:t.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const t=new lt({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return t.z!=null&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new Mu;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,this.zmin!=null&&(t.zmin=this.zmin,t.zmax=this.zmax),this.mmin!=null&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&UA(e,i)&&(t=e.isWebMercator?Gy(t):$2(t,!0)),t.type==="point"?tq(this,t):t.type==="extent"&&g$e(this,t)}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&UA(e,i)&&(t=e.isWebMercator?Gy(t):$2(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),i=this.width*e,r=this.height*e;if(this.xmin+=i,this.ymin+=r,this.xmax-=i,this.ymax-=r,this.hasZ){const n=(this.zmax-this.zmin)*e;this.zmin+=n,this.zmax-=n}if(this.hasM){const n=(this.mmax-this.mmin)*e;this.mmin+=n,this.mmax-=n}return this}intersects(t){if(t==null)return!1;t.type==="mesh"&&(t=t.extent);const e=this.spatialReference,i=t.spatialReference;return e&&i&&!wn(e,i)&&UA(e,i)&&(t=e.isWebMercator?Gy(t):$2(t,!0)),R$e(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,i){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,i!=null&&(this.zmin+=i,this.zmax+=i),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this===t||(this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=s0(Math.min,this.zmin,t.zmin),this.zmax=s0(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=s0(Math.min,this.mmin,t.mmin),this.mmax=s0(Math.max,this.mmax,t.mmax))),this}intersection(t){return this===t?this:t!=null&&this.intersects(t)?(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=s0(Math.max,this.zmin,t.zmin),this.zmax=s0(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=s0(Math.max,this.mmin,t.mmin),this.mmax=s0(Math.min,this.mmax,t.mmax)),this):null}toJSON(t){return this.write({},t)}_shiftCM(t=Fd(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,i=this._getCM(t);if(i){const r=e.isWebMercator?$2(i):i;this.xmin-=i.x,this.xmax-=i.x,e.isWebMercator||(r.x=this._normalizeX(r.x,t).x),this.spatialReference=new je(h4((e.isWGS84?t.altTemplate:null)??t.wkTemplate,{Central_Meridian:r.x}))}return this}_getCM(t){let e=null;const[i,r]=t.valid,n=this.xmin,s=this.xmax;return n>=i&&n<=r&&s>=i&&s<=r||(e=this.center),e}_normalize(t,e,i){const r=this.spatialReference;if(!r)return this;const n=i??Fd(r);if(n==null)return this;const s=this._getParts(n).map(l=>l.extent);if(s.length<2)return s[0]||this;if(s.length>2)return t?this._shiftCM(n):this.set({xmin:n.valid[0],xmax:n.valid[1]});if(t)return this._shiftCM(n);if(e)return s;let o=!0,a=!0;return s.forEach(l=>{l.hasZ||(o=!1),l.hasM||(a=!1)}),{rings:s.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(o){const u=(l.zmax-l.zmin)/2;for(let d=0;d<c.length;d++)c[d].push(u)}if(a){const u=(l.mmax-l.mmin)/2;for(let d=0;d<c.length;d++)c[d].push(u)}return c}),hasZ:o,hasM:a,spatialReference:r}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:n,ymax:s,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let u;t=t||Fd(o);const[d,p]=t.valid;u=this._normalizeX(this.xmin,t);const m=u.x,y=u.frameId;u=this._normalizeX(this.xmax,t);const _=u.x,v=u.frameId,w=m===_&&a>0;if(a>2*p){const x=new Mu(l<c?m:_,n,p,s,o),T=new Mu(d,n,l<c?_:m,s,o),S=new Mu(0,n,p,s,o),E=new Mu(d,n,0,s,o),A=[],P=[];x.contains(S)&&A.push(y),x.contains(E)&&P.push(y),T.contains(S)&&A.push(v),T.contains(E)&&P.push(v);for(let N=y+1;N<v;N++)A.push(N),P.push(N);e.push({extent:x,frameIds:[y]},{extent:T,frameIds:[v]},{extent:S,frameIds:A},{extent:E,frameIds:P})}else m>_||w?e.push({extent:new Mu(m,n,p,s,o),frameIds:[y]},{extent:new Mu(d,n,_,s,o),frameIds:[v]}):e.push({extent:new Mu(m,n,_,s,o),frameIds:[y]});this.cache._parts=e}const i=this.hasZ,r=this.hasM;if(i||r){const n={};i&&(n.zmin=this.zmin,n.zmax=this.zmax),r&&(n.mmin=this.mmin,n.mmax=this.mmax);for(let s=0;s<e.length;s++)e[s].extent.set(n)}return e}_normalizeX(t,e){const[i,r]=e.valid,n=2*r;let s,o=0;return t>r?(s=Math.ceil(Math.abs(t-r)/n),t-=s*n,o=s):t<i&&(s=Math.ceil(Math.abs(t-i)/n),t+=s*n,o=-s),{x:t,frameId:o}}};h([f({readOnly:!0})],eo.prototype,"cache",null),h([f({readOnly:!0})],eo.prototype,"center",null),h([f({readOnly:!0})],eo.prototype,"extent",null),h([f({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],eo.prototype,"hasM",null),h([f({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],eo.prototype,"hasZ",null),h([f({readOnly:!0})],eo.prototype,"height",null),h([f({readOnly:!0})],eo.prototype,"width",null),h([f({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],eo.prototype,"xmin",void 0),h([f({type:Number,json:{write:!0}})],eo.prototype,"ymin",void 0),h([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],eo.prototype,"mmin",void 0),h([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],eo.prototype,"zmin",void 0),h([f({type:Number,json:{write:!0}})],eo.prototype,"xmax",void 0),h([f({type:Number,json:{write:!0}})],eo.prototype,"ymax",void 0),h([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],eo.prototype,"mmax",void 0),h([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],eo.prototype,"zmax",void 0),eo=Mu=h([z("esri.geometry.Extent")],eo),eo.prototype.toJSON.isDefaultToJSON=!0;const Xi=eo;let BA;const M$e=globalThis.esriConfig?.locale??globalThis.dojoConfig?.locale;function Pde(){return M$e??globalThis.navigator?.language??"en"}function eu(){return BA===void 0&&(BA=Pde()),BA}function $$e(t=eu()){return/^([a-zA-Z]{2,3})(?:[_\-]\w+)*$/.exec(t)?.[1].toLowerCase()}const VA=[];function iq(t){return VA.push(t),Mi(()=>VA.splice(VA.indexOf(t),1))}const MB=[];function rq(t){return MB.push(t),Mi(()=>VA.splice(MB.indexOf(t),1))}function I$e(){const t=Pde();BA!==t&&(BA=t,[...MB].forEach(e=>{e.call(null,t)}),[...VA].forEach(e=>{e.call(null,t)}))}globalThis.addEventListener?.("languagechange",I$e);let pP;function L$e(t){return pP&&!pP.destroyed||(pP=t()),pP}var $B;const D$e=new uu({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let $u=$B=class extends xe{constructor(t){super(t),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){t!=="asc"&&t!=="desc"||this._set("sortOrder",t)}clone(){return new $B({categories:this.categories?ye(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,e){let i=[];this.categories&&(i=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o));let r="";if(this.extent){const o=sR(this.extent,je.WGS84);o!=null&&(r=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let n=this.query;!this.disableExtraQuery&&t.extraQuery&&(n="("+n+")"+t.extraQuery);const s={categories:i,bbox:r,q:n,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(s.sortField=this.sortField.split(",").map(o=>D$e.toJSON(o.trim())).join(","),s.sortOrder=this.sortOrder),{query:{...e,...s}}}};h([f()],$u.prototype,"categories",void 0),h([f()],$u.prototype,"disableExtraQuery",void 0),h([f({type:Xi})],$u.prototype,"extent",void 0),h([f()],$u.prototype,"filter",void 0),h([f()],$u.prototype,"num",void 0),h([f()],$u.prototype,"query",void 0),h([f()],$u.prototype,"sortField",void 0),h([f()],$u.prototype,"sortOrder",null),h([f()],$u.prototype,"start",void 0),$u=$B=h([z("esri.portal.PortalQueryParams")],$u);const of=$u;var IB;let Os=IB=class extends $e{constructor(t){super(t),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.sourceJSON=null,this.tags=null,this.title=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e&&this.portal?this.portal?.normalizeUrl(`${t}/info/${e}?f=json`):null}get url(){const t=this.portal?.restUrl;return t?t+"/community/groups/"+this.id:null}fetchCategorySchema(t){return this.portal.request(this.url+"/categorySchema",t).then(e=>{const i=e.categorySchema||[];return i.some(r=>r.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",t):i})}fetchMembers(t){return this.portal.request(this.url+"/users",t)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}toJSON(){throw new W("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new IB;return e.sourceJSON=t,e.read(t),e}queryItems(t,e){let i=uo(of,t);const r=this.portal;return parseFloat(r.currentVersion)>5?(i=i||new of,r.queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",e)):(i=i?i.clone():new of,i.query="group:"+this.id+(i.query?" "+i.query:""),r.queryItems(i,e))}_fetchCategorySchemaSet(t,e){const i=this.portal;return i.fetchSelf(i.authMode,!0,e).then(r=>{const n=r.contentCategorySetsGroupQuery;if(n){const s=new of;return s.disableExtraQuery=!0,s.num=1,s.query=n,i.queryGroups(s,e)}throw new W("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(r=>{if(r.total){const n=r.results[0],s=new of;return s.num=1,s.query=`typekeywords:"${t}"`,n.queryItems(s,e)}throw new W("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(r=>r.total?r.results[0].fetchData("json",e).then(n=>{const s=n?.categorySchema;return s?.length?s:[]}):[])}};h([f()],Os.prototype,"access",void 0),h([f({type:Date})],Os.prototype,"created",void 0),h([f()],Os.prototype,"description",void 0),h([f()],Os.prototype,"id",void 0),h([f()],Os.prototype,"isInvitationOnly",void 0),h([f({type:Date})],Os.prototype,"modified",void 0),h([f()],Os.prototype,"owner",void 0),h([f()],Os.prototype,"portal",void 0),h([f()],Os.prototype,"snippet",void 0),h([f()],Os.prototype,"sortField",void 0),h([f()],Os.prototype,"sortOrder",void 0),h([f()],Os.prototype,"sourceJSON",void 0),h([f()],Os.prototype,"tags",void 0),h([f()],Os.prototype,"thumbnail",void 0),h([f({readOnly:!0})],Os.prototype,"thumbnailUrl",null),h([f()],Os.prototype,"title",void 0),h([f({readOnly:!0})],Os.prototype,"url",null),Os=IB=h([z("esri.portal.PortalGroup")],Os);const LB=Os;let $v=class extends xe{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};h([f()],$v.prototype,"nextQueryParams",void 0),h([f()],$v.prototype,"queryParams",void 0),h([f()],$v.prototype,"results",void 0),h([f()],$v.prototype,"total",void 0),$v=h([z("esri.portal.PortalQueryResult")],$v);const N$e=$v;let Tm=class extends $e{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.portal?.restUrl;return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new W("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};h([f({type:Date})],Tm.prototype,"created",void 0),h([f()],Tm.prototype,"id",void 0),h([f()],Tm.prototype,"portal",void 0),h([f()],Tm.prototype,"title",void 0),h([f({readOnly:!0})],Tm.prototype,"url",null),h([f()],Tm.prototype,"username",void 0),Tm=h([z("esri.portal.PortalFolder")],Tm);const F$e=Tm;var DB;let hn=DB=class extends $e{constructor(...t){super(...t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){const t=this.portal?.restUrl;return t?`${t}/content/users/${this.username}`:null}get url(){const t=this.portal?.restUrl;return t?`${t}/community/users/${this.username}`:null}addItem(t){const e=t&&t.item,i=t?.data,r=t?.folder,n={method:"post"};e&&(n.query=e.createPostQuery(),i!=null&&(typeof i=="string"?n.query.text=i:typeof i=="object"&&(n.query.text=JSON.stringify(i))));let s=this.userContentUrl;return r&&(s+="/"+(typeof r=="string"?r:r.id)),this.portal.request(s+"/addItem",n).then(o=>(e.id=o.id,e.portal=this.portal,e.loaded?e.reload():e.load()))}deleteItem(t){let e=this.userContentUrl;return t.ownerFolder&&(e+="/"+t.ownerFolder),this.portal.request(e+`/items/${t.id}/delete`,{method:"post"}).then(()=>{t.id=null,t.portal=null})}deleteItems(t){const e=this.userContentUrl+"/deleteItems",i=t.map(r=>r.id);if(i.length){const r={method:"post",query:{items:i.join(",")}};return this.portal.request(e,r).then(()=>{t.forEach(n=>{n.id=null,n.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then(e=>{let i;return i=e&&e.folders?e.folders.map(r=>{const n=F$e.fromJSON(r);return n.portal=this.portal,n}):[],i})}fetchGroups(){return this.portal.request(this.url??"").then(t=>{let e;return e=t&&t.groups?t.groups.map(i=>{const r=LB.fromJSON(i);return r.portal=this.portal,r}):[],e})}fetchItems(t){const e=t??{};let i,r=this.userContentUrl??"";return e.folder&&(r+="/"+e.folder.id),pe(()=>Promise.resolve().then(()=>$de),void 0,import.meta.url).then(({default:n})=>{i=n;const s={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal.request(r,{query:s})}).then(n=>{let s;return n?.items?(s=n.items.map(o=>{const a=i.fromJSON(o);return a.portal=this.portal,a}),Promise.all(s.map(o=>o.load())).catch(o=>o).then(()=>({items:s,nextStart:n.nextStart,total:n.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal.request(this.url+"/tags").then(t=>t.tags)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new LB({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new W("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new W("internal:not-yet-implemented","PortalUser.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new DB;return e.sourceJSON=t,e.read(t),e}};h([f()],hn.prototype,"access",void 0),h([f({type:Date})],hn.prototype,"created",void 0),h([f()],hn.prototype,"culture",void 0),h([f()],hn.prototype,"description",void 0),h([f()],hn.prototype,"email",void 0),h([f()],hn.prototype,"favGroupId",void 0),h([f()],hn.prototype,"fullName",void 0),h([f({type:Date})],hn.prototype,"modified",void 0),h([f()],hn.prototype,"orgId",void 0),h([f()],hn.prototype,"portal",void 0),h([f()],hn.prototype,"preferredView",void 0),h([f()],hn.prototype,"privileges",void 0),h([f()],hn.prototype,"region",void 0),h([f()],hn.prototype,"role",void 0),h([f()],hn.prototype,"roleId",void 0),h([f()],hn.prototype,"sourceJSON",void 0),h([f()],hn.prototype,"thumbnail",void 0),h([f({readOnly:!0})],hn.prototype,"thumbnailUrl",null),h([f()],hn.prototype,"units",void 0),h([f({readOnly:!0})],hn.prototype,"userContentUrl",null),h([f({readOnly:!0})],hn.prototype,"url",null),h([f()],hn.prototype,"username",void 0),h([f()],hn.prototype,"userType",void 0),hn=DB=h([z("esri.portal.PortalUser")],hn);const Mde=hn;var Sm;let fP;const oK={PortalGroup:()=>Promise.resolve({default:LB}),PortalItem:()=>pe(()=>Promise.resolve().then(()=>$de),void 0,import.meta.url),PortalUser:()=>Promise.resolve({default:Mde})};let Ie=Sm=class extends iR(bg){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=Oi.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){aK.unregister(this),this.defaultBasemap=Pe(this.defaultBasemap),this.defaultDevBasemap=Pe(this.defaultDevBasemap),this.defaultVectorBasemap=Pe(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=pr(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(const e of t)Oi.request.trustedServers.includes(e)||Oi.request.trustedServers.push(e);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){const t=this.user?.orgId,e=!t||this.canSearchPublic;return this.id&&!e?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let t=this.url;if(t){const e=t.indexOf("/sharing");t=e>0?t.substring(0,e):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){const t=this.restUrl,e=this.thumbnail;return t&&e?this._normalizeSSL(t+"/portals/self/resources/"+e):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let e=null;return t&&(e=Mde.fromJSON(t),e.portal=this),e}load(t){const e=pe(()=>Promise.resolve().then(()=>dIe),void 0,import.meta.url).then(({default:i})=>{Et(t),fP=i}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(i=>{if(li){const r=li;this.credential=r.findCredential(this.restUrl),this.credential||this.authMode!==Sm.AUTH_MODE_AUTO||(this._esriIdCredentialCreateHandle?.remove(),this._esriIdCredentialCreateHandle=r.on("credential-create",k$e(new WeakRef(this))),aK.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(e),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),e=(await pe(()=>import("./ElevationLayer-be7fb2fd.js"),["./ElevationLayer-be7fb2fd.js","./ArcGISCachedService-2e25f484.js","./TileInfoTilemapCache-84675d0f.js","./TilemapCache-15811be1.js","./ArcGISService-1771a240.js","./OperationalLayer-5c10068f.js","./commonProperties-60f31277.js","./ElevationInfo-36952bdf.js","./PortalLayer-c3739096.js"],import.meta.url)).default;return t?t.map(i=>new e({id:i.id,url:i.url})):[]}async fetchBasemaps(t,e){const i=await this._fetchBasemaps(t,e);if(e?.include3d===!0&&this.use3dBasemaps!==!1){const r=await this._fetchBasemaps3D(t,e);i.unshift(...r)}return i}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(e=>e.categorySchema):Hn(t)?Promise.reject(pi()):Promise.resolve([])}fetchFeaturedGroups(t){const e=this.featuredGroups,i=new of;if(i.num=100,i.sortField="title",e&&e.length){const r=[];for(const n of e)r.push(`(title:"${n.title}" AND owner:${n.owner})`);return i.query=r.join(" OR "),this.queryGroups(i,t).then(n=>n.results)}return Hn(t)?Promise.reject(pi()):Promise.resolve([])}fetchRegions(t){const e=this.user?.culture||this.culture||eu();return this.request(this.restUrl+"/portals/regions",{...t,query:{culture:e}})}fetchSettings(t){const e=this.user?.culture||this.culture||eu();return this.request(this.restUrl+"/portals/self/settings",{...t,query:{culture:e}})}static getDefault(){return L$e(()=>new Sm)}queryGroups(t,e){return this.queryPortal("/community/groups",t,"PortalGroup",e)}queryItems(t,e){return this.queryPortal("/search",t,"PortalItem",e)}queryUsers(t,e){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",e)}fetchSelf(t=this.authMode,e=!1,i){const r=this.restUrl+"/portals/self",n={authMode:t,query:{culture:eu().toLowerCase()},...i};return n.authMode==="auto"&&(n.authMode="no-prompt"),e&&(n.query.default=!0),this.request(r,n)}queryPortal(t,e,i,r){const n=uo(of,e),s=o=>this.request(this.restUrl+t,{...n.toRequestOptions(this),...r}).then(a=>{const l=n.clone();return l.start=a.nextStart,new N$e({nextQueryParams:l,queryParams:n,total:a.total,results:Sm._resultsToTypedArray(o,{portal:this},a,r)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(T_(l),a)));return i&&oK[i]?oK[i]().then(({default:o})=>(Et(r),s(o))):s()}signIn(){if(this.authMode===Sm.AUTH_MODE_ANONYMOUS)return Promise.reject(new W("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const t=e=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(e||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate"))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate"))).then(i=>{i&&(this.sourceJSON=i,this.read(i))});return li?li.getCredential(this.restUrl).then(e=>t(e)):t(this.credential)}normalizeUrl(t){const e=this.credential?.token;return this._normalizeSSL(e?t+(t.includes("?")?"&":"?")+"token="+e:t)}requestToTypedArray(t,e,i){return this.request(t,e).then(r=>{const n=Sm._resultsToTypedArray(i,{portal:this},r);return Promise.all(n.map(s=>typeof s.when=="function"?s.when():r)).then(()=>n,()=>n)})}request(t,e={}){const i={f:"json",...e.query},{authMode:r=this.authMode===Sm.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:n=null,cacheBust:s=!1,method:o="auto",responseType:a="json",signal:l}=e,c={authMode:r,body:n,cacheBust:s,method:o,query:i,responseType:a,timeout:0,signal:l};return Ii(this._normalizeSSL(t),c).then(u=>u.data)}toJSON(){throw new W("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new Sm({sourceJSON:t})}_getHelperService(t){const e=this.helperServices&&this.helperServices[t];if(!e)throw new W("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return e}async _fetchBasemaps(t,e){const i=new of;i.query=t||(Oi.apiKey&&VH(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),i.disableExtraQuery=!0;const r=await this.queryGroups(i,e);if(!r.total)return[];const n=r.results[0];i.num=100,i.query='type:"Web Map" -type:"Web Application"',i.sortField=n.sortField||"name",i.sortOrder=n.sortOrder||"desc";const s=await n.queryItems(i,e);return s.total?s.results.filter(o=>o.type==="Web Map").map(o=>new fP({portalItem:o})):[]}async _fetchBasemaps3D(t,e){const i=t||this.basemapGalleryGroupQuery3D;if(!i)return[];const r=new of({query:i,disableExtraQuery:!0}),n=await this.queryGroups(r,e);if(!n.total)return[];const s=n.results[0];r.num=100,r.query='type:"Web Scene"',r.sortField=s.sortField||"name",r.sortOrder=s.sortOrder||"desc";const o=await s.queryItems(r,e);return o.total?o.results.filter(a=>a.type==="Web Scene").map(a=>new fP({portalItem:a})):[]}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){const e=fP.fromJSON(t);return e.portalItem={portal:this},e}return null}static _resultsToTypedArray(t,e,i,r){let n=[];if(i){const s=r!=null?r.signal:null;n=i.listings||i.notifications||i.userInvitations||i.tags||i.items||i.groups||i.comments||i.provisions||i.results||i.relatedItems||i,(t||e)&&(n=n.map(o=>{const a=Object.assign(t?t.fromJSON(o):o,e);return typeof a.load=="function"&&a.load(s),a}))}else n=[];return n}};Ie.AUTH_MODE_ANONYMOUS="anonymous",Ie.AUTH_MODE_AUTO="auto",Ie.AUTH_MODE_IMMEDIATE="immediate",h([f()],Ie.prototype,"access",void 0),h([f()],Ie.prototype,"allSSL",void 0),h([f()],Ie.prototype,"authMode",void 0),h([f()],Ie.prototype,"authorizedCrossOriginDomains",void 0),h([Ni("authorizedCrossOriginDomains")],Ie.prototype,"readAuthorizedCrossOriginDomains",null),h([f()],Ie.prototype,"basemapGalleryGroupQuery",void 0),h([f({json:{name:"3DBasemapGalleryGroupQuery"}})],Ie.prototype,"basemapGalleryGroupQuery3D",void 0),h([f()],Ie.prototype,"bingKey",void 0),h([f()],Ie.prototype,"canListApps",void 0),h([f()],Ie.prototype,"canListData",void 0),h([f()],Ie.prototype,"canListPreProvisionedItems",void 0),h([f()],Ie.prototype,"canProvisionDirectPurchase",void 0),h([f()],Ie.prototype,"canSearchPublic",void 0),h([f()],Ie.prototype,"canShareBingPublic",void 0),h([f()],Ie.prototype,"canSharePublic",void 0),h([f()],Ie.prototype,"canSignInArcGIS",void 0),h([f()],Ie.prototype,"canSignInIDP",void 0),h([f()],Ie.prototype,"colorSetsGroupQuery",void 0),h([f()],Ie.prototype,"commentsEnabled",void 0),h([f({type:Date})],Ie.prototype,"created",void 0),h([f()],Ie.prototype,"credential",void 0),h([f()],Ie.prototype,"culture",void 0),h([f()],Ie.prototype,"currentVersion",void 0),h([f()],Ie.prototype,"customBaseUrl",void 0),h([f()],Ie.prototype,"defaultBasemap",void 0),h([Ni("defaultBasemap")],Ie.prototype,"readDefaultBasemap",null),h([f()],Ie.prototype,"defaultDevBasemap",void 0),h([Ni("defaultDevBasemap")],Ie.prototype,"readDefaultDevBasemap",null),h([f({type:Xi})],Ie.prototype,"defaultExtent",void 0),h([f()],Ie.prototype,"defaultVectorBasemap",void 0),h([Ni("defaultVectorBasemap")],Ie.prototype,"readDefaultVectorBasemap",null),h([f()],Ie.prototype,"description",void 0),h([f()],Ie.prototype,"devBasemapGalleryGroupQuery",void 0),h([f()],Ie.prototype,"eueiEnabled",void 0),h([f({readOnly:!0})],Ie.prototype,"extraQuery",null),h([f()],Ie.prototype,"featuredGroups",void 0),h([f()],Ie.prototype,"featuredItemsGroupQuery",void 0),h([f()],Ie.prototype,"galleryTemplatesGroupQuery",void 0),h([f()],Ie.prototype,"livingAtlasGroupQuery",void 0),h([f()],Ie.prototype,"hasCategorySchema",void 0),h([f()],Ie.prototype,"helpBase",void 0),h([f()],Ie.prototype,"helperServices",void 0),h([f()],Ie.prototype,"helpMap",void 0),h([f()],Ie.prototype,"homePageFeaturedContent",void 0),h([f()],Ie.prototype,"homePageFeaturedContentCount",void 0),h([f()],Ie.prototype,"httpPort",void 0),h([f()],Ie.prototype,"httpsPort",void 0),h([f()],Ie.prototype,"id",void 0),h([f()],Ie.prototype,"ipCntryCode",void 0),h([f({readOnly:!0})],Ie.prototype,"isOrganization",null),h([f()],Ie.prototype,"isPortal",void 0),h([f()],Ie.prototype,"isReadOnly",void 0),h([f({readOnly:!0})],Ie.prototype,"itemPageUrl",null),h([f()],Ie.prototype,"layerTemplatesGroupQuery",void 0),h([f()],Ie.prototype,"maxTokenExpirationMinutes",void 0),h([f({type:Date})],Ie.prototype,"modified",void 0),h([f()],Ie.prototype,"name",void 0),h([f()],Ie.prototype,"portalHostname",void 0),h([f()],Ie.prototype,"portalMode",void 0),h([f()],Ie.prototype,"portalProperties",void 0),h([f()],Ie.prototype,"region",void 0),h([f({readOnly:!0})],Ie.prototype,"restUrl",null),h([f()],Ie.prototype,"rotatorPanels",void 0),h([f()],Ie.prototype,"showHomePageDescription",void 0),h([f()],Ie.prototype,"sourceJSON",void 0),h([f()],Ie.prototype,"staticImagesUrl",void 0),h([f({json:{name:"2DStylesGroupQuery"}})],Ie.prototype,"stylesGroupQuery2d",void 0),h([f({json:{name:"stylesGroupQuery"}})],Ie.prototype,"stylesGroupQuery3d",void 0),h([f()],Ie.prototype,"supportsHostedServices",void 0),h([f()],Ie.prototype,"symbolSetsGroupQuery",void 0),h([f()],Ie.prototype,"templatesGroupQuery",void 0),h([f()],Ie.prototype,"thumbnail",void 0),h([f({readOnly:!0})],Ie.prototype,"thumbnailUrl",null),h([f()],Ie.prototype,"units",void 0),h([f()],Ie.prototype,"url",void 0),h([f()],Ie.prototype,"urlKey",void 0),h([Ni("urlKey")],Ie.prototype,"readUrlKey",null),h([f()],Ie.prototype,"user",void 0),h([Ni("user")],Ie.prototype,"readUser",null),h([f()],Ie.prototype,"use3dBasemaps",void 0),h([f()],Ie.prototype,"useStandardizedQuery",void 0),h([f()],Ie.prototype,"useVectorBasemaps",void 0),h([f()],Ie.prototype,"vectorBasemapGalleryGroupQuery",void 0),Ie=Sm=h([z("esri.portal.Portal")],Ie);const ia=Ie,aK=new FinalizationRegistry(t=>{t.remove()});function k$e(t){const e=li;return()=>{const i=t.deref();i&&e.findCredential(i.restUrl)&&i.signIn().catch(()=>{})}}let Em=class extends xe{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e?.portalItem&&e.path?{...e,path:this._normalizePath(e.path,e.portalItem)}:e}set path(e){e!=null&&Qc(e)?ne.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",i){const r=this.cdnUrl;if(r==null)throw new W("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(r,{responseType:e,query:{token:this.portalItem.apiKey},signal:i?.signal})}async update(e,i){const{addOrUpdateResource:r}=await pe(()=>Promise.resolve().then(()=>wC),void 0,import.meta.url);return r(this,"update",e,i)}hasPath(){return this.path!=null}_normalizePath(e,i){return e==null?e:(e=e.replace(/^\/+/,""),i!=null&&Qc(e)&&(e=NH(e,i.itemUrl)),e?.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};h([f()],Em.prototype,"portalItem",void 0),h([f({type:String,value:null})],Em.prototype,"path",null),h([rr("path")],Em.prototype,"_castPath",null),h([f({type:String,readOnly:!0})],Em.prototype,"url",null),h([f({type:String,readOnly:!0})],Em.prototype,"cdnUrl",null),h([f({type:String,readOnly:!0})],Em.prototype,"itemRelativeUrl",null),Em=h([z("esri.portal.PortalItemResource")],Em);const U$e=Em;let gC=class extends xe{constructor(e){super(e),this.created=null,this.rating=null}};h([f()],gC.prototype,"created",void 0),h([f()],gC.prototype,"rating",void 0),gC=h([z("esri.portal.PortalRating")],gC);const Kk=gC;var Iv;const z$e=new Set(["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","GeoJson","CSV","KML","WFS","WMTS","WMS","Feed"]),B$e=new Set(["KML","GeoJson","CSV"]);let ti=Iv=class extends iR(bg){static from(t){return MT(Iv,t)}constructor(t){super(t),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const t=this.type,e=this.typeKeywords||[];let i=t;return t==="Feature Service"||t==="Feature Collection"?i=e.includes("Table")?"Table":e.includes("Route Layer")?"Route Layer":e.includes("Markup")?"Markup":"Feature Layer":t==="Image Service"?i=e.includes("Elevation 3D Layer")?"Elevation Layer":e.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":t==="Scene Service"?i="Scene Layer":t==="Video Service"?i="Video Layer":t==="Scene Package"?i="Scene Layer Package":t==="Stream Service"?i="Feature Layer":t==="Geoprocessing Service"?i=e.includes("Web Tool")?"Tool":"Geoprocessing Service":t==="Geocoding Service"?i="Locator":t==="Geoenrichment Service"?i="GeoEnrichment Service":t==="Microsoft Powerpoint"?i="Microsoft PowerPoint":t==="GeoJson"?i="GeoJSON":t==="Globe Service"?i="Globe Layer":t==="Vector Tile Service"?i="Tile Layer":t==="netCDF"?i="NetCDF":t==="Map Service"?i=e.includes("Spatiotemporal")||!e.includes("Hosted Service")&&!e.includes("Tiled")||e.includes("Relational")?"Map Image Layer":"Tile Layer":t&&t.toLowerCase().includes("add in")?i=t.replaceAll(/(add in)/gi,"Add-In"):t==="datastore catalog service"?i="Big Data File Share":t==="Compact Tile Package"?i="Tile Package (tpkx)":t==="OGCFeatureServer"?i="OGC Feature Layer":t==="web mapping application"&&e.includes("configurableApp")?i="Instant App":t==="Insights Page"?i="Insights Report":t==="Excalibur Imagery Project"&&(i="Excalibur Project"),i}readExtent(t){return t&&t.length?new Xi(t[0][0],t[0][1],t[1][0],t[1][1]):null}get iconUrl(){const t=this.type?.toLowerCase()||"",e=this.typeKeywords||[],i="esri/images/portal/",r="16";let n,s=!1,o=!1,a=!1,l=!1,c=!1,u=!1,d=!1;return t.indexOf("service")>0||t==="feature collection"||t==="kml"||t==="wms"||t==="wmts"||t==="wfs"?(s=e.includes("Hosted Service"),t==="feature service"||t==="feature collection"||t==="kml"||t==="wfs"?(o=e.includes("Table"),a=e.includes("Route Layer"),l=e.includes("Markup"),c=e.includes("Spatiotemporal"),u=e.includes("UtilityNetwork"),n=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":s?"featureshosted":u?"utilitynetwork":"features"):n=t==="map service"||t==="wms"||t==="wmts"?s||e.includes("Tiled")||t==="wmts"?"maptiles":"mapimages":t==="scene service"?e.includes("Line")?"sceneweblayerline":e.includes("3DObject")?"sceneweblayermultipatch":e.includes("Point")?"sceneweblayerpoint":e.includes("IntegratedMesh")?"sceneweblayermesh":e.includes("PointCloud")?"sceneweblayerpointcloud":e.includes("Polygon")?"sceneweblayerpolygon":e.includes("Building")?"sceneweblayerbuilding":e.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":t==="image service"?e.includes("Elevation 3D Layer")?"elevationlayer":e.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":t==="stream service"?"streamlayer":t==="video service"?e.includes("Live Stream")?"livestreamvideolayer":"videolayer":t==="vector tile service"?"vectortile":t==="datastore catalog service"?"datastorecollection":t==="geocoding service"?"geocodeservice":t==="geoprocessing service"?e.includes("Web Tool")?"tool":"layers":t==="geodata service"?"geodataservice":t==="3dtiles service"?"3dtileslayer":"layers"):t==="web map"||t==="cityengine web scene"?n="maps":t==="web scene"?n=e.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":t==="web mapping application"&&e.includes("configurableApp")?n="instantapps":t==="web mapping application"||t==="mobile application"||t==="application"||t==="operation view"||t==="desktop application"?n="apps":t==="map document"||t==="map package"||t==="published map"||t==="scene document"||t==="globe document"||t==="basemap package"||t==="mobile basemap package"||t==="mobile map package"||t==="project package"||t==="project template"||t==="pro map"||t==="layout"||t==="layer"&&e.includes("ArcGIS Pro")||t==="explorer map"&&e.indexOf("Explorer Document")?n="mapsgray":t==="service definition"||t==="csv"||t==="shapefile"||t==="cad drawing"||t==="geojson"||t==="netcdf"||t==="administrative report"?n="datafiles":t==="explorer add in"||t==="desktop add in"||t==="windows viewer add in"||t==="windows viewer configuration"?n="appsgray":t==="360 vr experience"?n="360vr":t==="arcgis pro add in"||t==="arcgis pro configuration"?n="addindesktop":t==="rule package"||t==="file geodatabase"||t==="sqlite geodatabase"||t==="csv collection"||t==="kml collection"||t==="windows mobile package"||t==="map template"||t==="desktop application template"||t==="gml"||t==="arcpad package"||t==="code sample"||t==="document link"||t==="earth configuration"||t==="operations dashboard add in"||t==="rules package"||t==="image"||t==="workflow manager package"||t==="explorer map"&&e.includes("Explorer Mapping Application")||e.includes("Document")?n="datafilesgray":t==="network analysis service"||t==="geoprocessing service"||t==="geodata service"||t==="geometry service"||t==="geoprocessing package"||t==="locator package"||t==="geoprocessing sample"||t==="workflow manager service"?n="toolsgray":t==="layer"||t==="layer package"||t==="explorer layer"?n="layersgray":t==="scene package"?n="scenepackage":t==="3dtiles package"?n="3dtileslayerpackage":t==="mobile scene package"?n="mobilescenepackage":t==="tile package"||t==="compact tile package"?n="tilepackage":t==="task file"?n="taskfile":t==="report template"?n="report-template":t==="statistical data collection"?n="statisticaldatacollection":t==="insights workbook"?n="workbook":t==="insights model"?n="insightsmodel":t==="insights page"?n="insightspage":t==="insights theme"?n="insightstheme":t==="hub initiative"?n="hubinitiative":t==="hubpage"?n="hubpage":t==="hub event"?n="hubevent":t==="hub site application"?n="hubsite":t==="hub project"?n="hubproject":t==="relational database connection"?n="relationaldatabaseconnection":t==="big data file share"?n="datastorecollection":t==="image collection"?n="imagecollection":t==="style"?n="style":t==="desktop style"?n="desktopstyle":t==="dashboard"?n="dashboard":t==="raster function template"?n="rasterprocessingtemplate":t==="vector tile package"?n="vectortilepackage":t==="ortho mapping project"?n="orthomappingproject":t==="ortho mapping template"?n="orthomappingtemplate":t==="solution"?n="solutions":t==="geopackage"?n="geopackage":t==="deep learning package"?n="deeplearningpackage":t==="real time analytic"?n="realtimeanalytics":t==="big data analytic"?n="bigdataanalytics":t==="feed"?n="feed":t==="excalibur imagery project"?n="excaliburimageryproject":t==="notebook"?n="notebook":t==="storymap"?n="storymap":t==="survey123 add in"?n="survey123addin":t==="mission"?n="mission":t==="mission report"?n="missionreport":t==="mission template"?n="missiontemplate":t==="quickcapture project"?n="quickcaptureproject":t==="pro report"?n="proreport":t==="pro report template"?n="proreporttemplate":t==="urban model"?n="urbanmodel":t==="web experience"?n="experiencebuilder":t==="web experience template"?n="webexperiencetemplate":t==="experience builder widget"?n="experiencebuilderwidget":t==="experience builder widget package"?n="experiencebuilderwidgetpackage":t==="workflow"?n="workflow":t==="insights script"?n="insightsscript":t==="kernel gateway connection"?n="kernelgatewayconnection":t==="hub initiative template"?n="hubinitiativetemplate":t==="storymap theme"?n="storymaptheme":t==="knowledge graph"?n="knowledgegraph":t==="knowledge studio project"?n="knowledgestudio":t==="native application"?n="nativeapp":t==="native application installer"?n="nativeappinstaller":t==="link chart"?n="linkchart":t==="investigation"?n="investigation":t==="ogcfeatureserver"?n="features":t==="pro project"?n="proproject":t==="insights workbook package"?n="insightsworkbookpackage":t==="apache parquet"?n="apacheparquet":t==="notebook code snippets"||t==="notebook code snippet library"?n="notebookcodesnippets":t==="suitability model"?n="suitabilitymodel":t==="esri classifier definition"?n="classifierdefinition":t==="esri classification schema"?n="classificationschema":t==="insights data engineering workbook"?n="dataengineeringworkbook":t==="insights data engineering model"?n="dataengineeringmodel":t==="deep learning studio project"?n="deeplearningproject":t==="discussion"?n="discussion":t==="allsource project"?n="allsourceproject":t==="api key"?n="apikey":t==="data pipeline"?n="datapipelines":t==="group layer"?(d=e.includes("Map"),n=d?"layergroup2d":"layergroup"):n=t==="media layer"?"onlinemedialayer":t==="form"?e.includes("Survey123")?"survey":"datafilesgray":"maps",n?lr(i+n+r+".png"):null}get isLayer(){return this.type!=null&&z$e.has(this.type)}get itemCdnUrl(){let t=this.itemUrl;return t&&li&&!li.findCredential(t)&&(t=li._normalizeAGOLorgDomain(t),t=t.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),t=t.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),t=t.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),t}get itemPageUrl(){const t=this.portal?.itemPageUrl;return t&&this.id?`${t}?id=${this.id}`:null}get itemUrl(){const t=this.portal?.restUrl;return t&&this.id?`${t}/content/items/${this.id}`:null}get thumbnailUrl(){const t=this.itemUrl,e=this.thumbnail;return t&&e?this.portal?.normalizeUrl(`${t}/info/${e}?f=json`)??null:null}get userItemUrl(){const t=this.portal?.restUrl;if(!t)return null;const e=this.owner||this.portal?.user?.username;return e?`${t}/content/users/${this.ownerFolder?`${e}/${this.ownerFolder}`:e}/items/${this.id}`:null}load(t){const e=this.portal??(this.portal=ia.getDefault()),i=e.load(t).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?e.request(this.itemUrl,{signal:t!=null?t.signal:null,query:{token:this.apiKey}}):{}).then(r=>{this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(i),Promise.resolve(this)}async addRating(t){const e={method:"post",query:{}};return t instanceof Kk&&(t=t.rating),t==null||isNaN(t)||typeof t!="number"||(e.query.rating=t),this.portal?(await this.portal.request(this.itemUrl+"/addRating",e),new Kk({rating:t,created:new Date})):null}clone(){const t={access:this.access,accessInformation:this.accessInformation,applicationProxies:ye(this.applicationProxies),avgRating:this.avgRating,categories:ye(this.categories),created:ye(this.created),culture:this.culture,description:this.description,extent:ye(this.extent),groupCategories:ye(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:ye(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:ye(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:ye(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ye(this.typeKeywords),url:this.url};this.loaded&&(t.loadStatus="loaded");const e=new Iv({sourceJSON:this.sourceJSON}).set(t);return e._set("isOrgItem",this.isOrgItem),e}createPostQuery(){const t=this.toJSON();for(const i of["tags","typeKeywords","categories"])t[i]=t[i]?.join(", ");const{extent:e}=t;return e&&(t.extent=JSON.stringify(e)),t}async deleteRating(){await this.portal.request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(t="json",e){return this.portal.request(this.itemUrl+"/data",{responseType:t,...e,query:{token:this.apiKey}})}async fetchRating(t){const e=await this.portal.request(this.itemUrl+"/rating",{query:{token:this.apiKey},...t});return e.rating!=null?(e.created=new Date(e.created),new Kk(e)):null}fetchRelatedItems(t,e){return this.portal.requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...t,token:this.apiKey},...e},Iv)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}reload(){return this.portal.request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.sourceJSON=t,this.read(t),this))}update(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t?.data,i={method:"post"};i.query=this.createPostQuery();for(const r in i.query)i.query[r]===null&&(i.query[r]="");return i.query.clearEmptyFields=!0,e!=null&&(typeof e=="string"?i.query.text=e:typeof e=="object"&&(i.query.text=JSON.stringify(e))),this.portal.request(`${this.userItemUrl}/update`,i).then(()=>this.reload())}):Promise.reject(new W("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(t){if(!this.id)throw new W("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:e,itemUrl:i}=this;await e.signIn();const{copyResources:r,folder:n,tags:s,title:o}=t||{},a={method:"post",query:{copyPrivateResources:r==="all",folder:typeof n=="string"?n:n?.id,includeResources:!!r,tags:s?.join(","),title:o}},{itemId:l}=await e.request(`${i}/copy`,a);return new Iv({id:l,portal:e})}updateThumbnail(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t.thumbnail,i=t.filename,r={method:"post"};if(typeof e=="string")Bf(e)?r.query={data:e}:r.query={url:La(e)},i!=null&&(r.query.filename=i);else{const n=new FormData;i!=null?n.append("file",e,i):n.append("file",e),r.body=n}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,r).then(()=>this.reload())}):Promise.reject(new W("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(t={},e){const{fetchResources:i}=await pe(()=>Promise.resolve().then(()=>wC),void 0,import.meta.url);return i(this,t,e)}async addResource(t,e,i){const{addOrUpdateResource:r}=await pe(()=>Promise.resolve().then(()=>wC),void 0,import.meta.url);return t.portalItem=this,r(t,"add",e,i)}async removeResource(t,e){const{removeResource:i}=await pe(()=>Promise.resolve().then(()=>wC),void 0,import.meta.url);if(t.portalItem&&t.portalItem.itemUrl!==this.itemUrl)throw new W("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return i(this,t,e)}async removeAllResources(t){const{removeAllResources:e}=await pe(()=>Promise.resolve().then(()=>wC),void 0,import.meta.url);return e(this,t)}resourceFromPath(t){return new U$e({portalItem:this,path:t})}toJSON(){const t=this.extent,e={accessInformation:this.accessInformation,categories:ye(this.categories),created:this.created?.getTime(),description:this.description,extent:t&&[[t.xmin,t.ymin],[t.xmax,t.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified?.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:ye(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ye(this.typeKeywords),url:this.url};return u4(e)}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new Iv({sourceJSON:t})}_getPostQuery(){const t=this.toJSON();for(const e in t)e==="tags"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="typeKeywords"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="extent"&&t[e]&&(t[e]=JSON.stringify(t[e]));return t}};h([f({type:["private","shared","org","public"]})],ti.prototype,"access",void 0),h([f()],ti.prototype,"accessInformation",void 0),h([f({type:String})],ti.prototype,"apiKey",void 0),h([f({json:{read:{source:"appProxies"}}})],ti.prototype,"applicationProxies",void 0),h([f()],ti.prototype,"avgRating",void 0),h([f()],ti.prototype,"categories",void 0),h([f({type:Date})],ti.prototype,"created",void 0),h([f()],ti.prototype,"culture",void 0),h([f()],ti.prototype,"description",void 0),h([f({readOnly:!0})],ti.prototype,"displayName",null),h([f({type:Xi})],ti.prototype,"extent",void 0),h([Ni("extent")],ti.prototype,"readExtent",null),h([f()],ti.prototype,"groupCategories",void 0),h([f({readOnly:!0})],ti.prototype,"iconUrl",null),h([f()],ti.prototype,"id",void 0),h([f({readOnly:!0})],ti.prototype,"isLayer",null),h([f({type:Boolean,readOnly:!0})],ti.prototype,"isOrgItem",void 0),h([f()],ti.prototype,"itemControl",void 0),h([f({readOnly:!0})],ti.prototype,"itemPageUrl",null),h([f({readOnly:!0})],ti.prototype,"itemUrl",null),h([f()],ti.prototype,"licenseInfo",void 0),h([f({type:Date})],ti.prototype,"modified",void 0),h([f()],ti.prototype,"name",void 0),h([f()],ti.prototype,"numComments",void 0),h([f()],ti.prototype,"numRatings",void 0),h([f()],ti.prototype,"numViews",void 0),h([f()],ti.prototype,"owner",void 0),h([f()],ti.prototype,"ownerFolder",void 0),h([f({type:ia})],ti.prototype,"portal",void 0),h([f()],ti.prototype,"screenshots",void 0),h([f()],ti.prototype,"size",void 0),h([f()],ti.prototype,"snippet",void 0),h([f()],ti.prototype,"sourceJSON",void 0),h([f({type:String})],ti.prototype,"sourceUrl",void 0),h([f({type:String})],ti.prototype,"spatialReference",void 0),h([f()],ti.prototype,"tags",void 0),h([f()],ti.prototype,"thumbnail",void 0),h([f({readOnly:!0})],ti.prototype,"thumbnailUrl",null),h([f()],ti.prototype,"title",void 0),h([f()],ti.prototype,"type",void 0),h([f()],ti.prototype,"typeKeywords",void 0),h([f({type:String,json:{read(t,e){if(B$e.has(e.type)){const i=this.portal?.restUrl;t||(t=i&&this.id?`${i}/content/items/${this.id}/data`:null)}return t}}})],ti.prototype,"url",void 0),h([f({readOnly:!0})],ti.prototype,"userItemUrl",null),ti=Iv=h([z("esri.portal.PortalItem")],ti);const S4=ti,$de=Object.freeze(Object.defineProperty({__proto__:null,default:S4},Symbol.toStringTag,{value:"Module"})),lK=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,V$e={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function cK(t){return t in V$e}const yC=[],iT=new Map;function uK(t){for(const e of iT.keys())Ide(t.pattern,e)&&iT.delete(e)}function G$e(t){return yC.includes(t)||(uK(t),yC.unshift(t)),Mi(()=>{const e=yC.indexOf(t);e>-1&&(yC.splice(e,1),uK(t))})}async function nq(t){const e=eu();iT.has(t)||iT.set(t,H$e(t,e));const i=iT.get(t);return i&&await q$e.add(i),i}function j$e(t){if(!lK.test(t))return null;const e=lK.exec(t);if(e===null)return null;const[,i,r]=e,n=i+(r?"-"+r.toUpperCase():"");return cK(n)?n:cK(i)?i:null}async function H$e(t,e){const i=[];for(const r of yC)if(Ide(r.pattern,t))try{return await r.fetchMessageBundle(t,e)}catch(n){i.push(n)}throw i.length?new W("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:i}):new W("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}function Ide(t,e){return typeof t=="string"?e.startsWith(t):t.test(e)}rq(()=>{iT.clear()});const q$e=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=vs())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function W$e(t){if(!t)return;const e=t.includes("-vector")?t.slice(0,t.indexOf("-vector")):t.includes("-3d")?t.slice(0,t.indexOf("-3d")):t,i=await nq("esri/t9n/basemaps");return i[t]||i[e]}const NB={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return lr("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return lr("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return lr("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return lr("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return lr("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return lr("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get"dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return lr("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return lr("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return lr("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return lr("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return lr("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return lr("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return lr("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return lr("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"arcgis-imagery":{get thumbnailUrl(){return lr("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return lr("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return lr("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return lr("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return lr("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return lr("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return lr("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return lr("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return lr("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return lr("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}},Y$e=new Set(["ar","bs","ca","hr","cs","da","nl","en","et","fi","fr","de","el","he","hu","id","it","ja","ko","lv","lt","nb","pl","ro","ru","sr","es","sv","th","tr","uk","vi"]);let Vx=class extends xe{constructor(e){super(e),this.id=null,this.language=null,this.serviceUrl="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2/webmaps"}getLanguageParamValue(){if(this.language)return this.language;const e=eu().toLowerCase();switch(e){case"pt-br":return"pt-BR";case"pt-pt":return"pt-PT";case"zh-cn":return"zh-CN";case"zh-hk":return"zh-HK";case"zh-tw":return"zh-TW"}const i=$$e(e);return i==="pt"?"pt-BR":i&&Y$e.has(i)?i:"global"}};h([f()],Vx.prototype,"id",void 0),h([f()],Vx.prototype,"language",void 0),h([f()],Vx.prototype,"serviceUrl",void 0),Vx=h([z("esri.support.BasemapStyle")],Vx);const X$e=Vx;function cEt(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="feature"}function uEt(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="subtype-group"&&"sublayers"in t}function GA(t){const e=t?.type;return e==="base-tile"||e==="tile"||e==="elevation"||e==="imagery-tile"||e==="base-elevation"||e==="open-street-map"||e==="wcs"||e==="web-tile"||e==="wmts"||e==="vector-tile"}function LT(t){return t!=null&&"type"in t&&t.type==="group"}const hEt={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function Z$e(t){const e=t?.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function hK(t){return t?.type==="voxel"}function dK(t){return t?.type==="imagery-tile"}function wI(t){return t?.parent!=null&&"declaredClass"in t.parent&&t.parent.declaredClass==="esri.Basemap"&&t.parent.baseLayers.includes(t)}function E4(t){return t?.type==="feature"&&!t.url&&t.source?.type==="memory"}function dEt(t){return(t?.type==="feature"||t?.type==="subtype-group")&&t.source?.type==="feature-layer"}function J$e(t){if(t.activeLayer){const e=t.activeLayer.tileMatrixSet;if(e)return e;const i=t.activeLayer.tileMatrixSets;if(i)return i}return null}async function pEt(t,e){const i=li?.findServerInfo(t);if(i?.currentVersion!=null)return i.owningSystemUrl||null;const r=t.toLowerCase().indexOf("/rest/services");if(r===-1)return null;const n=`${t.substring(0,r)}/rest/info`,s=e!=null?e.signal:null,{data:o}=await Ii(n,{query:{f:"json"},responseType:"json",signal:s});return o?.owningSystemUrl||null}function K$e(t){if(!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function Q$e(t){return K$e(t)?"effectiveCapabilities"in t?t.effectiveCapabilities:t.capabilities:null}function eIe(t){if(!("editingEnabled"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function tIe(t){return!!eIe(t)&&("effectiveEditingEnabled"in t?t.effectiveEditingEnabled:t.editingEnabled)}const iIe=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),rIe=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","media","ogc-feature","oriented-imagery","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function nIe(t){return t.layerContainerType==="basemap"?iIe:t.layerContainerType==="operational-layers"?rIe:null}function sIe(t,e){if(e.restrictedWebMapWriting){const i=nIe(e);return i==null||i.has(t.type)&&!E4(t)}return!0}function oIe(t,e){if(e)if(E4(t)){const i=Km("featureCollection.layers",e),r=i?.[0]?.layerDefinition;r&&pK(t,r)}else t.type!=="group"&&pK(t,e)}function pK(t,e){"maxScale"in t&&(e.maxScale=ED(t.maxScale)??void 0),"minScale"in t&&(e.minScale=ED(t.minScale)??void 0)}function aIe(t,e){if(oIe(t,e),e&&(e.id=t.id,"blendMode"in t&&(e.blendMode=t.blendMode,e.blendMode==="normal"&&delete e.blendMode),e.opacity=ED(t.opacity)??void 0,e.title=t.title||"Layer",e.visibility=t.visible,"legendEnabled"in t&&t.type!=="wmts"))if(E4(t)){const i=e.featureCollection;i&&(i.showLegend=t.legendEnabled)}else e.showLegend=t.legendEnabled}function fK(t,e,i){if(!t.persistenceEnabled)return null;if(!("write"in t)||!t.write)return i?.messages&&i.messages.push(new W("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted`,{layer:t})),null;if(E4(t)&&!t.isTable)e=t.resourceInfo;else if(sIe(t,i)){const r={};return t.write(r,i)?r:null}return e!=null&&aIe(t,e=ye(e)),e}var _C;let lIe=0;const cIe="esri.Basemap";let Ac=_C=class extends iR(bg){constructor(t){super(t),this.id=null,this.portalItem=null,this.spatialReference=null,this.style=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+lIe++,this.baseLayers=new ft,this.referenceLayers=new ft;const e=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type==="elevation"&&ne.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a basemap layer and will therefore be ignored.`)},i=r=>{r.parent=null};this.addHandles([this.baseLayers.on("after-add",r=>e(r.item)),this.referenceLayers.on("after-add",r=>e(r.item)),this.baseLayers.on("after-remove",r=>i(r.item)),this.referenceLayers.on("after-remove",r=>i(r.item))])}initialize(){this.when().catch(t=>{ne.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.baseLayers.toArray();for(const i of t)i.destroy();const e=this.referenceLayers.toArray();for(const i of e)i.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),this.portalItem=Pe(this.portalItem)}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set baseLayers(t){this._set("baseLayers",vg(t,this._get("baseLayers")))}_writeBaseLayers(t,e,i){const r=[];t&&(i={...i,layerContainerType:"basemap"},this.baseLayers.forEach(n=>{const s=fK(n,i.webmap?i.webmap.getLayerJSONFromResourceInfo(n):null,i);s!=null&&r.push(s)}),this.referenceLayers.forEach(n=>{const s=fK(n,i.webmap?i.webmap.getLayerJSONFromResourceInfo(n):null,i);s!=null&&(n.type!=="scene"&&(s.isReference=!0),r.push(s))})),e.baseMapLayers=r}set referenceLayers(t){this._set("referenceLayers",vg(t,this._get("referenceLayers")))}writeTitle(t,e){e.title=t||"Basemap"}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return WH(this,t=>{t(this.baseLayers,this.referenceLayers)})}clone(){const t={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(e=>dD(e)?e.clone():e),referenceLayers:this.referenceLayers.map(e=>dD(e)?e.clone():e)};return this.loaded&&(t.loadStatus="loaded"),new _C({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}write(t,e){return t=t||{},e?.origin||(e={origin:"web-map",...e}),super.write(t,e),!this.loaded&&this.resourceInfo?.data.baseMapLayers&&(t.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(i=>{const r=ye(i);return r.url&&Pf(r.url)&&(r.url=`https:${r.url}`),r.templateUrl&&Pf(r.templateUrl)&&(r.templateUrl=`https:${r.templateUrl}`),r})),t}async _loadFromSource(t){const{resourceInfo:e,portalItem:i,style:r}=this;Et(t);const n=[];if(e){const s=e.context?e.context.url:null;if(n.push(this._loadLayersFromJSON(e.data,s,t)),e.data.id&&!e.data.title){const o=e.data.id;n.push(W$e(o).then(a=>{a&&this.read({title:a},e.context)}))}}else i?n.push(this._loadFromItem(i,t)):r&&n.push(this._loadFromStylesService(r,t));await Promise.all(n)}async _loadLayersFromJSON(t,e,i){const r=this.resourceInfo?.context,n=this.portalItem?.portal||r?.portal||null,s=hIe[r?.origin||""]??"web-map",{populateOperationalLayers:o}=await pe(()=>import("./layersCreator-ba061b59.js"),["./layersCreator-ba061b59.js","./portalLayers-c7cc2afd.js","./associatedFeatureServiceUtils-44938726.js","./requestPresets-f7ad0d2f.js","./styleUtils-f17e2eb8.js"],import.meta.url),a=[];if(Et(i),t.baseMapLayers&&Array.isArray(t.baseMapLayers)){const l={context:{...r,origin:s,url:e,portal:n,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},c=p=>s==="web-scene"&&p.layerType==="ArcGISSceneServiceLayer"||p.isReference,u=o(this.baseLayers,t.baseMapLayers.filter(p=>!c(p)),l);a.push(u);const d=o(this.referenceLayers,t.baseMapLayers.filter(c),l);a.push(d)}await Promise.allSettled(a)}async _loadFromItem(t,e){const i=await t.load(e),r=await i.fetchData("json",e),n=bn(t.itemUrl??"");return this._set("resourceInfo",{data:r.baseMap??{},context:{origin:uIe[t.type||""]??"web-map",portal:t.portal||ia.getDefault(),url:n}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this.read({title:t.title,thumbnailUrl:t.thumbnailUrl},{origin:"portal-item",portal:t.portal||ia.getDefault(),url:n}),this._loadLayersFromJSON(this.resourceInfo.data,n,e)}async _loadFromStylesService(t,e){const i=`${t.serviceUrl}/${t.id}`,r=(await Ii(i,{query:{language:t.getLanguageParamValue()},signal:e?.signal})).data;if(r.baseMap&&Array.isArray(r.baseMap.baseMapLayers)){for(const s of r.baseMap.baseMapLayers)if(!s.customParameters&&s.styleUrl?.includes("?")){const o=bn(s.styleUrl);o.query&&(s.styleUrl=o.path,s.customParameters=o.query)}}const n=bn(i);return this._set("resourceInfo",{data:r.baseMap??{},context:{origin:"web-map",url:n}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this._loadLayersFromJSON(this.resourceInfo.data,n,e)}static fromId(t){const e=NB[t];return e?e.itemId?new _C({portalItem:{id:e.itemId,portal:{url:"https://www.arcgis.com"}}}):_C.fromJSON(e,{origin:e.is3d?"web-scene":"web-map"}):null}};h([f({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(t,e,i,r){this._writeBaseLayers(t,e,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:ft}},writer(t,e,i,r){this._writeBaseLayers(t,e,r)}}}}}})],Ac.prototype,"baseLayers",null),h([f({type:String,json:{origins:{"web-scene":{write:!0}}}})],Ac.prototype,"id",void 0),h([f({type:S4})],Ac.prototype,"portalItem",void 0),h([f()],Ac.prototype,"referenceLayers",null),h([f({readOnly:!0})],Ac.prototype,"resourceInfo",void 0),h([f({type:je})],Ac.prototype,"spatialReference",void 0),h([f({type:X$e})],Ac.prototype,"style",void 0),h([f()],Ac.prototype,"thumbnailUrl",void 0),h([f({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],Ac.prototype,"title",void 0),h([di("title")],Ac.prototype,"writeTitle",null),Ac=_C=h([z(cIe)],Ac);const uIe={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},hIe={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},rT=Ac,dIe=Object.freeze(Object.defineProperty({__proto__:null,default:rT},Symbol.toStringTag,{value:"Module"})),zD={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function Lde(t){return!!zD[t]||!!zD[t.toLowerCase()]}function sq(t){return zD[t]??zD[t.toLowerCase()]}function pIe(t){return[...sq(t)]}function Qk(t,e,i){i<0&&++i,i>1&&--i;const r=6*i;return r<1?t+(e-t)*r:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}function Dde(t,e,i,r=1){const n=(t%360+360)%360/360,s=i<=.5?i*(e+1):i+e-i*e,o=2*i-s;return[Math.round(255*Qk(o,s,n+1/3)),Math.round(255*Qk(o,s,n)),Math.round(255*Qk(o,s,n-1/3)),r]}function fIe(t){const e=t.length>5,i=e?8:4,r=(1<<i)-1,n=e?1:17,s=e?t.length===9:t.length===5;let o=+("0x"+t.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return s&&(l=o&r,o>>=i,a[3]=n*l/255),l=o&r,o>>=i,a[2]=n*l,l=o&r,o>>=i,a[1]=n*l,l=o&r,o>>=i,a[0]=n*l,a}function C(){return[0,0,0]}function Br(t){return[t[0],t[1],t[2]]}function Ce(t,e,i){return[t,e,i]}function Xo(t,e=C()){const i=Math.min(3,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function Nde(t,e){return new Float64Array(t,e,3)}function Fde(){return C()}function kde(){return Ce(1,1,1)}function Ude(){return Ce(1,0,0)}function zde(){return Ce(0,1,0)}function oq(){return Ce(0,0,1)}const Gs=Fde(),eg=kde(),Bde=Ude(),Vde=zde(),aq=oq();Object.freeze(Object.defineProperty({__proto__:null,ONES:eg,UNIT_X:Bde,UNIT_Y:Vde,UNIT_Z:aq,ZEROS:Gs,clone:Br,create:C,createView:Nde,fromArray:Xo,fromValues:Ce,ones:kde,unitX:Ude,unitY:zde,unitZ:oq,zeros:Fde},Symbol.toStringTag,{value:"Module"}));let lq=1e-6;function mo(){return lq}function mIe(t){lq=t}const oR=Math.random,gIe=Math.PI/180,yIe=180/Math.PI;function C4(t){return t*gIe}function _Ie(t){return t*yIe}function vIe(t,e){return Math.abs(t-e)<=lq*Math.max(1,Math.abs(t),Math.abs(e))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:oR,equals:vIe,getEpsilon:mo,setEpsilon:mIe,toDegree:_Ie,toRadian:C4},Symbol.toStringTag,{value:"Module"}));function we(t){const e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)}function se(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function oe(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t}function ce(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function he(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function A4(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function BD(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function bIe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function Gde(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function DT(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}function VD(t,e){return t[0]=Math.sign(e[0]),t[1]=Math.sign(e[1]),t[2]=Math.sign(e[2]),t}function O4(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function jde(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function wIe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function te(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function dl(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t}function br(t,e){const i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(i*i+r*r+n*n)}function bs(t,e){const i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return i*i+r*r+n*n}function Oo(t){const e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r}function na(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function xIe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function ge(t,e){const i=e[0],r=e[1],n=e[2];let s=i*i+r*r+n*n;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s),t}function me(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function nt(t,e,i){const r=e[0],n=e[1],s=e[2],o=i[0],a=i[1],l=i[2];return t[0]=n*l-s*a,t[1]=s*o-r*l,t[2]=r*a-n*o,t}function Ui(t,e,i,r){const n=e[0],s=e[1],o=e[2];return t[0]=n+r*(i[0]-n),t[1]=s+r*(i[1]-s),t[2]=o+r*(i[2]-o),t}function TIe(t,e,i,r,n,s){const o=s*s,a=o*(2*s-3)+1,l=o*(s-2)+s,c=o*(s-1),u=o*(3-2*s);return t[0]=e[0]*a+i[0]*l+r[0]*c+n[0]*u,t[1]=e[1]*a+i[1]*l+r[1]*c+n[1]*u,t[2]=e[2]*a+i[2]*l+r[2]*c+n[2]*u,t}function SIe(t,e,i,r,n,s){const o=1-s,a=o*o,l=s*s,c=a*o,u=3*s*a,d=3*l*o,p=l*s;return t[0]=e[0]*c+i[0]*u+r[0]*d+n[0]*p,t[1]=e[1]*c+i[1]*u+r[1]*d+n[1]*p,t[2]=e[2]*c+i[2]*u+r[2]*d+n[2]*p,t}function EIe(t,e){e=e||1;const i=oR,r=2*i()*Math.PI,n=2*i()-1,s=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(r)*s,t[1]=Math.sin(r)*s,t[2]=n*e,t}function Fe(t,e,i){const r=e[0],n=e[1],s=e[2];return t[0]=i[0]*r+i[4]*n+i[8]*s+i[12],t[1]=i[1]*r+i[5]*n+i[9]*s+i[13],t[2]=i[2]*r+i[6]*n+i[10]*s+i[14],t}function Zl(t,e,i){const r=e[0],n=e[1],s=e[2];return t[0]=r*i[0]+n*i[3]+s*i[6],t[1]=r*i[1]+n*i[4]+s*i[7],t[2]=r*i[2]+n*i[5]+s*i[8],t}function bf(t,e,i){const r=i[0],n=i[1],s=i[2],o=i[3],a=e[0],l=e[1],c=e[2];let u=n*c-s*l,d=s*a-r*c,p=r*l-n*a,m=n*p-s*d,y=s*u-r*p,_=r*d-n*u;const v=2*o;return u*=v,d*=v,p*=v,m*=2,y*=2,_*=2,t[0]=a+u+m,t[1]=l+d+y,t[2]=c+p+_,t}function CIe(t,e,i,r){const n=[],s=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],s[0]=n[0],s[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),s[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2],t}function AIe(t,e,i,r){const n=[],s=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],s[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),s[1]=n[1],s[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2],t}function OIe(t,e,i,r){const n=[],s=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],s[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),s[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),s[2]=n[2],t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2],t}function Hde(t,e){se(mP,t),se(gP,e),ge(mP,mP),ge(gP,gP);const i=me(mP,gP);return i>1?0:i<-1?Math.PI:Math.acos(i)}const mP=C(),gP=C();function RIe(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Po(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function xb(t,e){if(t===e)return!0;const i=t[0],r=t[1],n=t[2],s=e[0],o=e[1],a=e[2],l=mo();return Math.abs(i-s)<=l*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-o)<=l*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-a)<=l*Math.max(1,Math.abs(n),Math.abs(a))}function Ng(t,e,i){const r=i[0]-e[0],n=i[1]-e[1],s=i[2]-e[2];let o=r*r+n*n+s*s;return o>0?(o=1/Math.sqrt(o),t[0]=r*o,t[1]=n*o,t[2]=s*o,t):(t[0]=0,t[1]=0,t[2]=0,t)}const zs=he,PIe=A4,MIe=BD,aR=br,R4=bs,zl=we,FB=Oo,mK=Object.freeze(Object.defineProperty({__proto__:null,abs:DT,add:ce,angle:Hde,bezier:SIe,ceil:bIe,copy:se,cross:nt,direction:Ng,dist:aR,distance:br,div:MIe,divide:BD,dot:me,equals:xb,exactEquals:Po,floor:Gde,hermite:TIe,inverse:xIe,len:zl,length:we,lerp:Ui,max:jde,min:O4,mul:PIe,multiply:A4,negate:na,normalize:ge,random:EIe,rotateX:CIe,rotateY:AIe,rotateZ:OIe,round:wIe,scale:te,scaleAndAdd:dl,set:oe,sign:VD,sqrDist:R4,sqrLen:FB,squaredDistance:bs,squaredLength:Oo,str:RIe,sub:zs,subtract:he,transformMat3:Zl,transformMat4:Fe,transformQuat:bf},Symbol.toStringTag,{value:"Module"}));function Cd(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Mr(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t}function cq(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function qde(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function Wde(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function Yde(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function $Ie(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function IIe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function LIe(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t}function DIe(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t}function NIe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function Tb(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function FIe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t}function Xde(t,e){const i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return Math.sqrt(i*i+r*r+n*n+s*s)}function GD(t,e){const i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return i*i+r*r+n*n+s*s}function uq(t){const e=t[0],i=t[1],r=t[2],n=t[3];return Math.sqrt(e*e+i*i+r*r+n*n)}function hq(t){const e=t[0],i=t[1],r=t[2],n=t[3];return e*e+i*i+r*r+n*n}function kIe(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function UIe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function Zde(t,e){const i=e[0],r=e[1],n=e[2],s=e[3];let o=i*i+r*r+n*n+s*s;return o>0&&(o=1/Math.sqrt(o),t[0]=i*o,t[1]=r*o,t[2]=n*o,t[3]=s*o),t}function Jde(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function dq(t,e,i,r){const n=e[0],s=e[1],o=e[2],a=e[3];return t[0]=n+r*(i[0]-n),t[1]=s+r*(i[1]-s),t[2]=o+r*(i[2]-o),t[3]=a+r*(i[3]-a),t}function zIe(t,e){const i=oR;let r,n,s,o,a,l;e=e||1;do r=2*i()-1,n=2*i()-1,a=r*r+n*n;while(a>=1);do s=2*i()-1,o=2*i()-1,l=s*s+o*o;while(l>=1);const c=Math.sqrt((1-a)/l);return t[0]=e*r,t[1]=e*n,t[2]=e*s*c,t[3]=e*o*c,t}function Xc(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3];return t[0]=i[0]*r+i[4]*n+i[8]*s+i[12]*o,t[1]=i[1]*r+i[5]*n+i[9]*s+i[13]*o,t[2]=i[2]*r+i[6]*n+i[10]*s+i[14]*o,t[3]=i[3]*r+i[7]*n+i[11]*s+i[15]*o,t}function BIe(t,e,i){const r=e[0],n=e[1],s=e[2],o=i[0],a=i[1],l=i[2],c=i[3],u=c*r+a*s-l*n,d=c*n+l*r-o*s,p=c*s+o*n-a*r,m=-o*r-a*n-l*s;return t[0]=u*c+m*-o+d*-l-p*-a,t[1]=d*c+m*-a+p*-o-u*-l,t[2]=p*c+m*-l+u*-a-d*-o,t[3]=e[3],t}function VIe(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function nT(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Sb(t,e){const i=t[0],r=t[1],n=t[2],s=t[3],o=e[0],a=e[1],l=e[2],c=e[3],u=mo();return Math.abs(i-o)<=u*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=u*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-l)<=u*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=u*Math.max(1,Math.abs(s),Math.abs(c))}const GIe=qde,jIe=Wde,HIe=Yde,qIe=Xde,WIe=GD,YIe=uq,XIe=hq,Kde=Object.freeze(Object.defineProperty({__proto__:null,add:cq,ceil:$Ie,copy:Cd,dist:qIe,distance:Xde,div:HIe,divide:Yde,dot:Jde,equals:Sb,exactEquals:nT,floor:IIe,inverse:UIe,len:YIe,length:uq,lerp:dq,max:DIe,min:LIe,mul:jIe,multiply:Wde,negate:kIe,normalize:Zde,random:zIe,round:NIe,scale:Tb,scaleAndAdd:FIe,set:Mr,sqrDist:WIe,sqrLen:XIe,squaredDistance:GD,squaredLength:hq,str:VIe,sub:GIe,subtract:qde,transformMat4:Xc,transformQuat:BIe},Symbol.toStringTag,{value:"Module"})),gK=new Float32Array(1);function Qde(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function _e(t,e,i){return Math.min(Math.max(t,e),i)}function Eb(t){return(t&t-1)==0}function fEt(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function mEt(t){return 10**Math.ceil(Math.LOG10E*Math.log(t))}function _t(t,e,i){return t+(e-t)*i}function gEt(t,e,i,r,n){return _t(r,n,(t-e)/(i-e))}function Rt(t){return t*Math.PI/180}function za(t){return 180*t/Math.PI}function kB(t,e=1e-6){return(t<0?-1:1)/Math.max(Math.abs(t),e)}function xs(t){return Math.acos(_e(t,-1,1))}function dh(t){return Math.asin(_e(t,-1,1))}function jy(t,e,i=1e-6){return t===e?!0:!Number.isFinite(t)||!Number.isFinite(e)?!1:(t>e?t-e:e-t)<=i}const jD=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function UB(t){return jD.setFloat64(0,t),jD.getBigInt64(0)}function ZIe(t){return jD.setBigInt64(0,t),jD.getFloat64(0)}const xI=BigInt("1000000"),JIe=epe(1);function epe(t){const e=UB(t=Math.abs(t)),i=ZIe(e<=xI?xI:e-xI);return Math.abs(t-i)}function yEt(t,e,i=JIe){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;if(i!=null&&epe(Math.min(Math.abs(t),Math.abs(e)))<i)return Math.abs(t-e)<=i;const r=UB(t),n=UB(e);return r<0!=n<0?!1:!((r<n?n-r:r-n)>xI)}function KIe(t,e,i=1e-6){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;const r=Math.abs(t-e),n=Math.abs(t),s=Math.abs(e);if(t===0||e===0||n<1e-12&&s<1e-12){if(r>.01*i)return!1}else if(r/(n+s)>i)return!1;return!0}function QIe(t){return tpe(Math.max(-zB,Math.min(t,zB)))}function tpe(t){return gK[0]=t,gK[0]}function X3(t,e,i){const r=_e((i-t)/(e-t),0,1);return r*r*(3-2*r)}function yK(t,e){const i=we(t),r=dh(t[2]/i),n=Math.atan2(t[1]/i,t[0]/i);return oe(e,i,r,n),e}function _Et(t){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[3]*t[3]+t[4]*t[4]+t[5]*t[5],r=t[6]*t[6]+t[7]*t[7]+t[8]*t[8];return!(jy(e,1)&&jy(i,1)&&jy(r,1))}function eLe(t,e){return(t%e+e)%e}const zB=tpe(34028234663852886e22);function yP(t){return _e(OH(t),0,255)}function _P(t,e,i){return t=Number(t),isNaN(t)?i:t<e?e:t>i?i:t}function vP(t,e){const i=t.toString(16).padStart(2,"0");return e?i.substring(0,1):i}let TI=class to{static blendColors(e,i,r,n=new to){return n.r=Math.round(e.r+(i.r-e.r)*r),n.g=Math.round(e.g+(i.g-e.g)*r),n.b=Math.round(e.b+(i.b-e.b)*r),n.a=e.a+(i.a-e.a)*r,n._sanitize()}static fromRgb(e,i){const r=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(r){const n=r[2].split(/\s*,\s*/),s=r[1];if(s==="rgb"&&n.length===3||s==="rgba"&&n.length===4){const o=n[0];if(o.charAt(o.length-1)==="%"){const a=n.map(l=>2.56*parseFloat(l));return n.length===4&&(a[3]=parseFloat(n[3])),to.fromArray(a,i)}return to.fromArray(n.map(a=>parseFloat(a)),i)}if(s==="hsl"&&n.length===3||s==="hsla"&&n.length===4)return to.fromArray(Dde(parseFloat(n[0]),parseFloat(n[1])/100,parseFloat(n[2])/100,parseFloat(n[3])),i)}return null}static fromHex(e,i=new to){if(e[0]!=="#"||isNaN(+`0x${e.substring(1)}`))return null;switch(e.length){case 4:case 5:{const r=parseInt(e.substring(1,2),16),n=parseInt(e.substring(2,3),16),s=parseInt(e.substring(3,4),16),o=e.length===5?15:parseInt(e.substring(4),16);return to.fromArray([r+16*r,n+16*n,s+16*s,(o+16*o)/255],i)}case 7:case 9:{const r=parseInt(e.substring(1,3),16),n=parseInt(e.substring(3,5),16),s=parseInt(e.substring(5,7),16),o=e.length===7?255:parseInt(e.substring(7),16);return to.fromArray([r,n,s,o/255],i)}default:return null}}static fromArray(e,i=new to){return i._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(i.a)&&(i.a=1),i._sanitize()}static fromString(e,i){const r=Lde(e)?sq(e):null;return r&&to.fromArray(r,i)||to.fromRgb(e,i)||to.fromHex(e,i)}static fromJSON(e){return e!=null?new to([e[0],e[1],e[2],(e[3]??255)/255]):void 0}static toUnitRGB(e){return e!=null?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return e!=null?[e.r/255,e.g/255,e.b/255,e.a!=null?e.a:1]:null}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return typeof e=="string"?to.fromString(e,this):Array.isArray(e)?to.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof to||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(e){const i=e?.capitalize??!1,r=e?.digits??6,n=r===3||r===4,s=r===4||r===8,o=`#${vP(this.r,n)}${vP(this.g,n)}${vP(this.b,n)}${s?vP(Math.round(255*this.a),n):""}`;return i?o.toUpperCase():o}toCss(e=!1){const i=this.r+", "+this.g+", "+this.b;return e?`rgba(${i}, ${this.a})`:`rgb(${i})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=to.AlphaMode.ALWAYS){const i=yP(this.r),r=yP(this.g),n=yP(this.b);return e===to.AlphaMode.ALWAYS||this.a!==1?[i,r,n,yP(255*this.a)]:[i,r,n]}clone(){return new to(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return e!=null&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=Math.round(_P(this.r,0,255)),this.g=Math.round(_P(this.g,0,255)),this.b=Math.round(_P(this.b,0,255)),this.a=_P(this.a,0,1),this}_set(e,i,r,n){this.r=e,this.g=i,this.b=r,this.a=n}};TI.prototype.declaredClass="esri.Color",function(t){var e;(e=t.AlphaMode||(t.AlphaMode={}))[e.ALWAYS=0]="ALWAYS",e[e.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(TI||(TI={}));const Ye=TI;function vEt(t){}function tLe(t){return()=>t}function Ut(t,e={}){const i=t instanceof uu?t:new uu(t,e),r={type:e?.ignoreUnknown??1?i.apiValues:String,json:{type:i.jsonValues,read:!e?.readOnly&&{reader:i.read},write:{writer:i.write}}};return e?.readOnly!==void 0&&(r.readOnly=!!e.readOnly),e?.default!==void 0&&(r.json.default=e.default),e?.name!==void 0&&(r.json.name=e.name),e?.nonNullable!==void 0&&(r.nonNullable=e.nonNullable),f(r)}var BB;let SI=BB=class extends $e{constructor(t){super(t),this.type="none"}clone(){return new BB({type:this.type})}};h([Ut({none:"none",stayAbove:"stay-above"})],SI.prototype,"type",void 0),SI=BB=h([z("esri.ground.NavigationConstraint")],SI);function pq(t){const e=OH(100*(1-t));return Math.max(0,Math.min(e,100))}function fq(t){const e=1-t/100;return Math.max(0,Math.min(e,1))}var VB;let Cm=VB=class extends iR(bg){constructor(t){super(t),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new ft;const e=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&ne.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},i=r=>{r.parent=null};this.addHandles([this.layers.on("after-add",r=>e(r.item)),this.layers.on("after-remove",r=>i(r.item))])}initialize(){this.when().catch(t=>{Fn(t)||ne.getLogger(this).error("#load()","Failed to load ground",t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.layers.removeAll();for(const e of t)Pe(e);this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set layers(t){this._set("layers",vg(t,this._get("layers")))}writeLayers(t,e,i,r){const n=[];t&&(r={...r,layerContainerType:"ground"},t.forEach(s=>{if("write"in s){const o={};tLe(s)().write(o,r)&&n.push(o)}else r?.messages&&r.messages.push(new W("layer:unsupported",`Layers (${s.title}, ${s.id}) of type '${s.declaredClass}' cannot be persisted in the ground`,{layer:s}))})),e.layers=n}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return WH(this,t=>{t(this.layers)})}async queryElevation(t,e){await this.load({signal:e?.signal});const{ElevationQuery:i}=await pe(()=>import("./ElevationQuery-eff4527f.js"),[],import.meta.url);Et(e);const r=new i,n=this.layers.filter(_K).toArray();return r.queryAll(n,t,e)}async createElevationSampler(t,e){await this.load({signal:e?.signal});const{ElevationQuery:i}=await pe(()=>import("./ElevationQuery-eff4527f.js"),[],import.meta.url);Et(e);const r=new i,n=this.layers.filter(_K).toArray();return r.createSamplerAll(n,t,e)}clone(){const t={opacity:this.opacity,surfaceColor:ye(this.surfaceColor),navigationConstraint:ye(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new VB({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve()}async _loadLayersFromJSON(t,e,i){const r=e?.origin||"web-scene",n=e?.portal||null,s=e?.url||null,{populateOperationalLayers:o}=await pe(()=>import("./layersCreator-ba061b59.js"),["./layersCreator-ba061b59.js","./portalLayers-c7cc2afd.js","./associatedFeatureServiceUtils-44938726.js","./requestPresets-f7ad0d2f.js","./styleUtils-f17e2eb8.js"],import.meta.url);Et(i);const a=[];if(t.layers&&Array.isArray(t.layers)){const l={context:{origin:r,url:s,portal:n,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,t.layers,l))}await Promise.allSettled(a)}};function iLe(t){return t&&"createElevationSampler"in t}function _K(t){return t.type==="elevation"||iLe(t)}h([f({json:{read:!1}})],Cm.prototype,"layers",null),h([di("layers")],Cm.prototype,"writeLayers",null),h([f({readOnly:!0})],Cm.prototype,"resourceInfo",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Ln,read:{reader:fq,source:"transparency"},write:{writer:(t,e)=>{e.transparency=pq(t)},target:"transparency"}}})],Cm.prototype,"opacity",void 0),h([f({type:Ye,json:{type:[Ln],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],Cm.prototype,"surfaceColor",void 0),h([f({type:SI,json:{write:!0}})],Cm.prototype,"navigationConstraint",void 0),Cm=VB=h([z("esri.Ground")],Cm);const Z3=Cm;let Gx=class extends ft{constructor(e){super(e),this.getCollections=null}initialize(){this.addHandles(ghe(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=this.getCollections!=null?this.getCollections():null;if(e==null)return void this.removeAll();let i=0;for(const r of e)r!=null&&(i=this._processCollection(i,r));this.splice(i,this.length)}_createNewInstance(e){return new ft(e)}_processCollection(e,i){if(!i)return e;const r=this.itemFilterFunction??(n=>!!n);for(const n of i)if(n){if(r(n)){const s=this.indexOf(n,e);s>=0?s!==e&&this.reorder(n,e):this.add(n,e),++e}if(this.getChildrenFunction){const s=this.getChildrenFunction(n);if(Array.isArray(s))for(const o of s)e=this._processCollection(e,o);else e=this._processCollection(e,s)}}return e}};h([f()],Gx.prototype,"getCollections",void 0),h([f()],Gx.prototype,"getChildrenFunction",void 0),h([f()],Gx.prototype,"itemFilterFunction",void 0),Gx=h([z("esri.core.CollectionFlattener")],Gx);const J3=Gx,rLe=[["binary","application/octet-stream","bin",""]];function wEt(t,e){return npe(e.name,t?.supportedFormats??[])!=null}function xEt(t,e){if(!t)return!1;const i=nLe(e,t.supportedFormats??[]);return i!=null&&t.editFormats.includes(i)}function ipe(t,e){return gq(oLe(t,e))}function rpe(t,e){return gq(npe(t,e))}function TEt(t,e){return spe(sLe(t,e))}function nLe(t,e){return rpe(t.name,e)??ipe(t.type,e)}function mq(t){return[...rLe,...t]}function sLe(t,e){return mq(e).find(i=>gq(i)===t)}function oLe(t,e){const i=t.toLowerCase();return mq(e).find(r=>spe(r)===i)}function npe(t,e){const i=t.toLowerCase();return mq(e).find(r=>aLe(r).some(n=>i.endsWith(n)))}function gq(t){return t?.[0]}function spe(t){return t?.[1].toLowerCase()}function aLe(t){return t?.[2].split(",").map(e=>e.toLowerCase())??[]}function SEt(t){return t.tables?.find(e=>e.role==="assetMaps")}function lLe(t){return!(!(t&&typeof t=="object"&&"loaded"in t&&t.loaded&&Q$e(t)?.operations?.supportsEditing&&"type"in t)||"editingEnabled"in t&&!tIe(t)||t.type==="scene"&&!cLe(t))}function cLe(t){const{associatedLayer:e}=t,i=e?.infoFor3D;if(!i)return!0;const{supportedFormats:r,queryFormats:n}=i,s=ipe("model/gltf-binary",r)??rpe("glb",r);if(!(s!=null&&n.includes(s)))return ne.getLogger("esri.layers.support.editableLayers").warnOnce(`SceneLayer (${t.title??"Untitled layer"}, ${t.id}) is not editable because it does not support GLB queries.`),!1;const o=t.spatialReference,a=e.spatialReference;if(!wn(o,a))return ne.getLogger("esri.layers.support.editableLayers").warnOnce(`SceneLayer (${t.title??"Untitled layer"}, ${t.id}) is not editable because its spatial reference (wkid:${o.wkid}) is different from its associated FeatureLayer's spatial reference (wkid:${a.wkid}).`),!1;const l=e.sourceJSON.sourceSpatialReference;return!(l!=null&&!wn(l,a))||(ne.getLogger("esri.layers.support.editableLayers").warnOnce(`SceneLayer (${t.title??"Untitled layer"}, ${t.id}) is not editable because the spatial reference of its associated FeatureLayer's service (wkid:${a.wkid}) is different from its source spatial reference (wkid:${l.wkid}).`),!1)}const uLe=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,hLe="screenUtils.toPt: input not recognized!",ope=96;function ra(t){return t?t/72*ope:0}function jd(t){return t?72*t/ope:0}function Bn(t){if(typeof t=="string"){const e=t.match(uLe);if(e){const i=Number(e[1]),r=e[3]&&e[3].toLowerCase(),n=t.charAt(0)==="-",s=r==="px"?jd(i):i;return n?-s:s}return console.warn(hLe),null}return t}function ph(t=0,e=0){return{x:t,y:e}}function Zr(t=0,e=0){return[t,e]}function ape(t=0,e=0){return[t,e]}function Mo(t=0,e=0,i=0){return[t,e,i]}function EEt(t){return t}function CEt(t){return t}function AEt(t){return t}function Ed(t,e){return e?(e[0]=t.x,e[1]=t.y,e.length>2&&(e[2]=0),e):[t.x,t.y]}function P4(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function dLe(t){const e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function pLe(t,e,i,r,n,s,o,a,l,c,u,d,p,m,y,_){const v=new Float32Array(16);return v[0]=t,v[1]=e,v[2]=i,v[3]=r,v[4]=n,v[5]=s,v[6]=o,v[7]=a,v[8]=l,v[9]=c,v[10]=u,v[11]=d,v[12]=p,v[13]=m,v[14]=y,v[15]=_,v}function fLe(t,e){return new Float32Array(t,e,16)}const mLe=P4();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:mLe,clone:dLe,create:P4,createView:fLe,fromValues:pLe},Symbol.toStringTag,{value:"Module"}));function Nn(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function jf(t,e,i,r,n,s,o,a,l,c,u,d,p,m,y,_,v){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=s,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t[9]=u,t[10]=d,t[11]=p,t[12]=m,t[13]=y,t[14]=_,t[15]=v,t}function fh(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function sc(t,e){if(t===e){const i=e[1],r=e[2],n=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=n,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function $S(t,e){return qn(t,e)||fh(t),t}function qn(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],p=e[10],m=e[11],y=e[12],_=e[13],v=e[14],w=e[15],x=i*a-r*o,T=i*l-n*o,S=i*c-s*o,E=r*l-n*a,A=r*c-s*a,P=n*c-s*l,N=u*_-d*y,F=u*v-p*y,D=u*w-m*y,$=d*v-p*_,R=d*w-m*_,k=p*w-m*v;let B=x*k-T*R+S*$+E*D-A*F+P*N;return B?(B=1/B,t[0]=(a*k-l*R+c*$)*B,t[1]=(n*R-r*k-s*$)*B,t[2]=(_*P-v*A+w*E)*B,t[3]=(p*A-d*P-m*E)*B,t[4]=(l*D-o*k-c*F)*B,t[5]=(i*k-n*D+s*F)*B,t[6]=(v*S-y*P-w*T)*B,t[7]=(u*P-p*S+m*T)*B,t[8]=(o*R-a*D+c*N)*B,t[9]=(r*D-i*R-s*N)*B,t[10]=(y*A-_*S+w*x)*B,t[11]=(d*S-u*A-m*x)*B,t[12]=(a*F-o*$-l*N)*B,t[13]=(i*$-r*F+n*N)*B,t[14]=(_*T-y*E-v*x)*B,t[15]=(u*E-d*T+p*x)*B,t):null}function gLe(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],p=e[10],m=e[11],y=e[12],_=e[13],v=e[14],w=e[15];return t[0]=a*(p*w-m*v)-d*(l*w-c*v)+_*(l*m-c*p),t[1]=-(r*(p*w-m*v)-d*(n*w-s*v)+_*(n*m-s*p)),t[2]=r*(l*w-c*v)-a*(n*w-s*v)+_*(n*c-s*l),t[3]=-(r*(l*m-c*p)-a*(n*m-s*p)+d*(n*c-s*l)),t[4]=-(o*(p*w-m*v)-u*(l*w-c*v)+y*(l*m-c*p)),t[5]=i*(p*w-m*v)-u*(n*w-s*v)+y*(n*m-s*p),t[6]=-(i*(l*w-c*v)-o*(n*w-s*v)+y*(n*c-s*l)),t[7]=i*(l*m-c*p)-o*(n*m-s*p)+u*(n*c-s*l),t[8]=o*(d*w-m*_)-u*(a*w-c*_)+y*(a*m-c*d),t[9]=-(i*(d*w-m*_)-u*(r*w-s*_)+y*(r*m-s*d)),t[10]=i*(a*w-c*_)-o*(r*w-s*_)+y*(r*c-s*a),t[11]=-(i*(a*m-c*d)-o*(r*m-s*d)+u*(r*c-s*a)),t[12]=-(o*(d*v-p*_)-u*(a*v-l*_)+y*(a*p-l*d)),t[13]=i*(d*v-p*_)-u*(r*v-n*_)+y*(r*p-n*d),t[14]=-(i*(a*v-l*_)-o*(r*v-n*_)+y*(r*l-n*a)),t[15]=i*(a*p-l*d)-o*(r*p-n*d)+u*(r*l-n*a),t}function yLe(t){const e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],d=t[10],p=t[11],m=t[12],y=t[13],_=t[14],v=t[15];return(e*o-i*s)*(d*v-p*_)-(e*a-r*s)*(u*v-p*y)+(e*l-n*s)*(u*_-d*y)+(i*a-r*o)*(c*v-p*m)-(i*l-n*o)*(c*_-d*m)+(r*l-n*a)*(c*y-u*m)}function Di(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],p=e[9],m=e[10],y=e[11],_=e[12],v=e[13],w=e[14],x=e[15];let T=i[0],S=i[1],E=i[2],A=i[3];return t[0]=T*r+S*a+E*d+A*_,t[1]=T*n+S*l+E*p+A*v,t[2]=T*s+S*c+E*m+A*w,t[3]=T*o+S*u+E*y+A*x,T=i[4],S=i[5],E=i[6],A=i[7],t[4]=T*r+S*a+E*d+A*_,t[5]=T*n+S*l+E*p+A*v,t[6]=T*s+S*c+E*m+A*w,t[7]=T*o+S*u+E*y+A*x,T=i[8],S=i[9],E=i[10],A=i[11],t[8]=T*r+S*a+E*d+A*_,t[9]=T*n+S*l+E*p+A*v,t[10]=T*s+S*c+E*m+A*w,t[11]=T*o+S*u+E*y+A*x,T=i[12],S=i[13],E=i[14],A=i[15],t[12]=T*r+S*a+E*d+A*_,t[13]=T*n+S*l+E*p+A*v,t[14]=T*s+S*c+E*m+A*w,t[15]=T*o+S*u+E*y+A*x,t}function yl(t,e,i){const r=i[0],n=i[1],s=i[2];if(e===t)t[12]=e[0]*r+e[4]*n+e[8]*s+e[12],t[13]=e[1]*r+e[5]*n+e[9]*s+e[13],t[14]=e[2]*r+e[6]*n+e[10]*s+e[14],t[15]=e[3]*r+e[7]*n+e[11]*s+e[15];else{const o=e[0],a=e[1],l=e[2],c=e[3],u=e[4],d=e[5],p=e[6],m=e[7],y=e[8],_=e[9],v=e[10],w=e[11];t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=u,t[5]=d,t[6]=p,t[7]=m,t[8]=y,t[9]=_,t[10]=v,t[11]=w,t[12]=o*r+u*n+y*s+e[12],t[13]=a*r+d*n+_*s+e[13],t[14]=l*r+p*n+v*s+e[14],t[15]=c*r+m*n+w*s+e[15]}return t}function lR(t,e,i){const r=i[0],n=i[1],s=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Jl(t,e,i,r){let n,s,o,a,l,c,u,d,p,m,y,_,v,w,x,T,S,E,A,P,N,F,D,$,R=r[0],k=r[1],B=r[2],j=Math.sqrt(R*R+k*k+B*B);return j<mo()?null:(j=1/j,R*=j,k*=j,B*=j,n=Math.sin(i),s=Math.cos(i),o=1-s,a=e[0],l=e[1],c=e[2],u=e[3],d=e[4],p=e[5],m=e[6],y=e[7],_=e[8],v=e[9],w=e[10],x=e[11],T=R*R*o+s,S=k*R*o+B*n,E=B*R*o-k*n,A=R*k*o-B*n,P=k*k*o+s,N=B*k*o+R*n,F=R*B*o+k*n,D=k*B*o-R*n,$=B*B*o+s,t[0]=a*T+d*S+_*E,t[1]=l*T+p*S+v*E,t[2]=c*T+m*S+w*E,t[3]=u*T+y*S+x*E,t[4]=a*A+d*P+_*N,t[5]=l*A+p*P+v*N,t[6]=c*A+m*P+w*N,t[7]=u*A+y*P+x*N,t[8]=a*F+d*D+_*$,t[9]=l*F+p*D+v*$,t[10]=c*F+m*D+w*$,t[11]=u*F+y*D+x*$,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function NT(t,e,i){const r=Math.sin(i),n=Math.cos(i),s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],d=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*n+c*r,t[5]=o*n+u*r,t[6]=a*n+d*r,t[7]=l*n+p*r,t[8]=c*n-s*r,t[9]=u*n-o*r,t[10]=d*n-a*r,t[11]=p*n-l*r,t}function M4(t,e,i){const r=Math.sin(i),n=Math.cos(i),s=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],d=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n-c*r,t[1]=o*n-u*r,t[2]=a*n-d*r,t[3]=l*n-p*r,t[8]=s*r+c*n,t[9]=o*r+u*n,t[10]=a*r+d*n,t[11]=l*r+p*n,t}function FT(t,e,i){const r=Math.sin(i),n=Math.cos(i),s=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],d=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n+c*r,t[1]=o*n+u*r,t[2]=a*n+d*r,t[3]=l*n+p*r,t[4]=c*n-s*r,t[5]=u*n-o*r,t[6]=d*n-a*r,t[7]=p*n-l*r,t}function cR(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function _Le(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function hu(t,e,i){if(e===0)return fh(t);let r,n,s,o=i[0],a=i[1],l=i[2],c=Math.sqrt(o*o+a*a+l*l);return c<mo()?null:(c=1/c,o*=c,a*=c,l*=c,r=Math.sin(e),n=Math.cos(e),s=1-n,t[0]=o*o*s+n,t[1]=a*o*s+l*r,t[2]=l*o*s-a*r,t[3]=0,t[4]=o*a*s-l*r,t[5]=a*a*s+n,t[6]=l*a*s+o*r,t[7]=0,t[8]=o*l*s+a*r,t[9]=a*l*s-o*r,t[10]=l*l*s+n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function lpe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function vLe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function cpe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function upe(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=r+r,l=n+n,c=s+s,u=r*a,d=r*l,p=r*c,m=n*l,y=n*c,_=s*c,v=o*a,w=o*l,x=o*c;return t[0]=1-(m+_),t[1]=d+x,t[2]=p-w,t[3]=0,t[4]=d-x,t[5]=1-(u+_),t[6]=y+v,t[7]=0,t[8]=p+w,t[9]=y-v,t[10]=1-(u+m),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function bLe(t,e){const i=wLe,r=-e[0],n=-e[1],s=-e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=r*r+n*n+s*s+o*o;return d>0?(i[0]=2*(a*o+u*r+l*s-c*n)/d,i[1]=2*(l*o+u*n+c*r-a*s)/d,i[2]=2*(c*o+u*s+a*n-l*r)/d):(i[0]=2*(a*o+u*r+l*s-c*n),i[1]=2*(l*o+u*n+c*r-a*s),i[2]=2*(c*o+u*s+a*n-l*r)),upe(t,e,i),t}const wLe=C();function HD(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function hpe(t,e){const i=e[0],r=e[1],n=e[2],s=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10];return t[0]=Math.sqrt(i*i+r*r+n*n),t[1]=Math.sqrt(s*s+o*o+a*a),t[2]=Math.sqrt(l*l+c*c+u*u),t}function xLe(t,e){const i=e[0]+e[5]+e[10];let r=0;return i>0?(r=2*Math.sqrt(i+1),t[3]=.25*r,t[0]=(e[6]-e[9])/r,t[1]=(e[8]-e[2])/r,t[2]=(e[1]-e[4])/r):e[0]>e[5]&&e[0]>e[10]?(r=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/r,t[0]=.25*r,t[1]=(e[1]+e[4])/r,t[2]=(e[8]+e[2])/r):e[5]>e[10]?(r=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/r,t[0]=(e[1]+e[4])/r,t[1]=.25*r,t[2]=(e[6]+e[9])/r):(r=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/r,t[0]=(e[8]+e[2])/r,t[1]=(e[6]+e[9])/r,t[2]=.25*r),t}function dpe(t,e,i,r){const n=e[0],s=e[1],o=e[2],a=e[3],l=n+n,c=s+s,u=o+o,d=n*l,p=n*c,m=n*u,y=s*c,_=s*u,v=o*u,w=a*l,x=a*c,T=a*u,S=r[0],E=r[1],A=r[2];return t[0]=(1-(y+v))*S,t[1]=(p+T)*S,t[2]=(m-x)*S,t[3]=0,t[4]=(p-T)*E,t[5]=(1-(d+v))*E,t[6]=(_+w)*E,t[7]=0,t[8]=(m+x)*A,t[9]=(_-w)*A,t[10]=(1-(d+y))*A,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function TLe(t,e,i,r,n){const s=e[0],o=e[1],a=e[2],l=e[3],c=s+s,u=o+o,d=a+a,p=s*c,m=s*u,y=s*d,_=o*u,v=o*d,w=a*d,x=l*c,T=l*u,S=l*d,E=r[0],A=r[1],P=r[2],N=n[0],F=n[1],D=n[2],$=(1-(_+w))*E,R=(m+S)*E,k=(y-T)*E,B=(m-S)*A,j=(1-(p+w))*A,X=(v+x)*A,M=(y+T)*P,I=(v-x)*P,G=(1-(p+_))*P;return t[0]=$,t[1]=R,t[2]=k,t[3]=0,t[4]=B,t[5]=j,t[6]=X,t[7]=0,t[8]=M,t[9]=I,t[10]=G,t[11]=0,t[12]=i[0]+N-($*N+B*F+M*D),t[13]=i[1]+F-(R*N+j*F+I*D),t[14]=i[2]+D-(k*N+X*F+G*D),t[15]=1,t}function SLe(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=i+i,a=r+r,l=n+n,c=i*o,u=r*o,d=r*a,p=n*o,m=n*a,y=n*l,_=s*o,v=s*a,w=s*l;return t[0]=1-d-y,t[1]=u+w,t[2]=p-v,t[3]=0,t[4]=u-w,t[5]=1-c-y,t[6]=m+_,t[7]=0,t[8]=p+v,t[9]=m-_,t[10]=1-c-d,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ppe(t,e,i,r,n,s,o){const a=1/(i-e),l=1/(n-r),c=1/(s-o);return t[0]=2*s*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s*l,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(n+r)*l,t[10]=(o+s)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*c,t[15]=0,t}function ELe(t,e,i,r,n){const s=1/Math.tan(e/2);let o;return t[0]=s/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0?(o=1/(r-n),t[10]=(n+r)*o,t[14]=2*n*r*o):(t[10]=-1,t[14]=-2*r),t}function CLe(t,e,i,r){const n=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(n+s);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-a)*l*.5,t[9]=(n-s)*c*.5,t[10]=r/(i-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*i/(i-r),t[15]=0,t}function fpe(t,e,i,r,n,s,o){const a=1/(e-i),l=1/(r-n),c=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*a,t[13]=(n+r)*l,t[14]=(o+s)*c,t[15]=1,t}function $4(t,e,i,r){const n=e[0],s=e[1],o=e[2];let a=n-i[0],l=s-i[1],c=o-i[2];const u=mo();if(Math.abs(a)<u&&Math.abs(l)<u&&Math.abs(c)<u)return void fh(t);let d=1/Math.sqrt(a*a+l*l+c*c);a*=d,l*=d,c*=d;const p=r[0],m=r[1],y=r[2];let _=m*c-y*l,v=y*a-p*c,w=p*l-m*a;d=Math.sqrt(_*_+v*v+w*w),d?(d=1/d,_*=d,v*=d,w*=d):(_=0,v=0,w=0);let x=l*w-c*v,T=c*_-a*w,S=a*v-l*_;d=Math.sqrt(x*x+T*T+S*S),d?(d=1/d,x*=d,T*=d,S*=d):(x=0,T=0,S=0),t[0]=_,t[1]=x,t[2]=a,t[3]=0,t[4]=v,t[5]=T,t[6]=l,t[7]=0,t[8]=w,t[9]=S,t[10]=c,t[11]=0,t[12]=-(_*n+v*s+w*o),t[13]=-(x*n+T*s+S*o),t[14]=-(a*n+l*s+c*o),t[15]=1}function mpe(t,e,i,r){const n=e[0],s=e[1],o=e[2],a=r[0],l=r[1],c=r[2];let u=n-i[0],d=s-i[1],p=o-i[2],m=u*u+d*d+p*p;m>0&&(m=1/Math.sqrt(m),u*=m,d*=m,p*=m);let y=l*p-c*d,_=c*u-a*p,v=a*d-l*u;return m=y*y+_*_+v*v,m>0&&(m=1/Math.sqrt(m),y*=m,_*=m,v*=m),t[0]=y,t[1]=_,t[2]=v,t[3]=0,t[4]=d*v-p*_,t[5]=p*y-u*v,t[6]=u*_-d*y,t[7]=0,t[8]=u,t[9]=d,t[10]=p,t[11]=0,t[12]=n,t[13]=s,t[14]=o,t[15]=1,t}function ALe(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function OLe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2+t[9]**2+t[10]**2+t[11]**2+t[12]**2+t[13]**2+t[14]**2+t[15]**2)}function RLe(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t}function gpe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}function PLe(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t}function MLe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t[9]=e[9]+i[9]*r,t[10]=e[10]+i[10]*r,t[11]=e[11]+i[11]*r,t[12]=e[12]+i[12]*r,t[13]=e[13]+i[13]*r,t[14]=e[14]+i[14]*r,t[15]=e[15]+i[15]*r,t}function yq(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function I4(t,e){if(t===e)return!0;const i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=t[9],p=t[10],m=t[11],y=t[12],_=t[13],v=t[14],w=t[15],x=e[0],T=e[1],S=e[2],E=e[3],A=e[4],P=e[5],N=e[6],F=e[7],D=e[8],$=e[9],R=e[10],k=e[11],B=e[12],j=e[13],X=e[14],M=e[15],I=mo();return Math.abs(i-x)<=I*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(r-T)<=I*Math.max(1,Math.abs(r),Math.abs(T))&&Math.abs(n-S)<=I*Math.max(1,Math.abs(n),Math.abs(S))&&Math.abs(s-E)<=I*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(o-A)<=I*Math.max(1,Math.abs(o),Math.abs(A))&&Math.abs(a-P)<=I*Math.max(1,Math.abs(a),Math.abs(P))&&Math.abs(l-N)<=I*Math.max(1,Math.abs(l),Math.abs(N))&&Math.abs(c-F)<=I*Math.max(1,Math.abs(c),Math.abs(F))&&Math.abs(u-D)<=I*Math.max(1,Math.abs(u),Math.abs(D))&&Math.abs(d-$)<=I*Math.max(1,Math.abs(d),Math.abs($))&&Math.abs(p-R)<=I*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(m-k)<=I*Math.max(1,Math.abs(m),Math.abs(k))&&Math.abs(y-B)<=I*Math.max(1,Math.abs(y),Math.abs(B))&&Math.abs(_-j)<=I*Math.max(1,Math.abs(_),Math.abs(j))&&Math.abs(v-X)<=I*Math.max(1,Math.abs(v),Math.abs(X))&&Math.abs(w-M)<=I*Math.max(1,Math.abs(w),Math.abs(M))}function _q(t){const e=mo(),i=t[0],r=t[1],n=t[2],s=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return Math.abs(1-(i*i+s*s+l*l))<=e&&Math.abs(1-(r*r+o*o+c*c))<=e&&Math.abs(1-(n*n+a*a+u*u))<=e}function L4(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[8]===0&&t[9]===0&&t[10]===1}const $Le=Di,ILe=gpe;Object.freeze(Object.defineProperty({__proto__:null,add:RLe,adjoint:gLe,copy:Nn,determinant:yLe,equals:I4,exactEquals:yq,frob:OLe,fromQuat:SLe,fromQuat2:bLe,fromRotation:hu,fromRotationTranslation:upe,fromRotationTranslationScale:dpe,fromRotationTranslationScaleOrigin:TLe,fromScaling:_Le,fromTranslation:cR,fromXRotation:lpe,fromYRotation:vLe,fromZRotation:cpe,frustum:ppe,getRotation:xLe,getScaling:hpe,getTranslation:HD,hasIdentityRotation:L4,identity:fh,invert:qn,invertOrIdentity:$S,isOrthoNormal:_q,lookAt:$4,mul:$Le,multiply:Di,multiplyScalar:PLe,multiplyScalarAndAdd:MLe,ortho:fpe,perspective:ELe,perspectiveFromFieldOfView:CLe,rotate:Jl,rotateX:NT,rotateY:M4,rotateZ:FT,scale:lR,set:jf,str:ALe,sub:ILe,subtract:gpe,targetTo:mpe,translate:yl,transpose:sc},Symbol.toStringTag,{value:"Module"}));const LLe=(t,e)=>{const i=jf(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return sc(i,i)},DLe=(t,e)=>{const i=jf(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return sc(i,i)},NLe=(t,e)=>{const i=1-e,r=jf(t,.2126+.7874*i,.7152-.7152*i,.0722-.0722*i,0,.2126-.2126*i,.7152+.2848*i,.0722-.0722*i,0,.2126-.2126*i,.7152-.7152*i,.0722+.9278*i,0,0,0,0,1);return sc(r,r)},FLe=(t,e)=>{const i=Math.sin(e*Math.PI/180),r=Math.cos(e*Math.PI/180),n=jf(t,.213+.787*r-.213*i,.715-.715*r-.715*i,.072-.072*r+.928*i,0,.213-.213*r+.143*i,.715+.285*r+.14*i,.072-.072*r-.283*i,0,.213-.213*r-.787*i,.715-.715*r+.715*i,.072+.928*r+.072*i,0,0,0,0,1);return sc(n,n)},kLe=(t,e)=>{const i=1-2*e,r=jf(t,i,0,0,e,0,i,0,e,0,0,i,e,0,0,0,1);return sc(r,r)},ULe=(t,e)=>{const i=jf(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return sc(i,i)},zLe=(t,e)=>{const i=1-e,r=jf(t,.393+.607*i,.769-.769*i,.189-.189*i,0,.349-.349*i,.686+.314*i,.168-.168*i,0,.272-.272*i,.534-.534*i,.131+.869*i,0,0,0,0,1);return sc(r,r)};let ype=class _pe{constructor(e,i,r){this.strength=e,this.radius=i,this.threshold=r,this.type="bloom"}interpolate(e,i,r){this.strength=Gl(e.strength,i.strength,r),this.radius=Gl(e.radius,i.radius,r),this.threshold=Gl(e.threshold,i.threshold,r)}clone(){return new _pe(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:jA(this.radius),strength:this.strength,threshold:this.threshold}}},vpe=class bpe{constructor(e){this.radius=e,this.type="blur"}interpolate(e,i,r){this.radius=Math.round(Gl(e.radius,i.radius,r))}clone(){return new bpe(this.radius)}toJSON(){return{type:"blur",radius:jA(this.radius)}}},GB=class wpe{constructor(e,i){this.type=e,this.amount=i,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.amount=Gl(e.amount,i.amount,r),this._updateMatrix()}clone(){return new wpe(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||P4();switch(this.type){case"brightness":this._colorMatrix=LLe(e,this.amount);break;case"contrast":this._colorMatrix=DLe(e,this.amount);break;case"grayscale":this._colorMatrix=NLe(e,this.amount);break;case"invert":this._colorMatrix=kLe(e,this.amount);break;case"saturate":this._colorMatrix=ULe(e,this.amount);break;case"sepia":this._colorMatrix=zLe(e,this.amount)}}},xpe=class Tpe{constructor(e,i,r,n){this.offsetX=e,this.offsetY=i,this.blurRadius=r,this.color=n,this.type="drop-shadow"}interpolate(e,i,r){this.offsetX=Gl(e.offsetX,i.offsetX,r),this.offsetY=Gl(e.offsetY,i.offsetY,r),this.blurRadius=Gl(e.blurRadius,i.blurRadius,r),this.color[0]=Math.round(Gl(e.color[0],i.color[0],r)),this.color[1]=Math.round(Gl(e.color[1],i.color[1],r)),this.color[2]=Math.round(Gl(e.color[2],i.color[2],r)),this.color[3]=Gl(e.color[3],i.color[3],r)}clone(){return new Tpe(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:jA(this.offsetX),yoffset:jA(this.offsetY),blurRadius:jA(this.blurRadius),color:e}}},Spe=class Epe{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.angle=Gl(e.angle,i.angle,r),this._updateMatrix()}clone(){return new Epe(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||P4();this._colorMatrix=FLe(e,this.angle)}},Cpe=class Ape{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,i,r){this.amount=Gl(e.amount,i.amount,r)}clone(){return new Ape(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function Gl(t,e,i){return t+(e-t)*i}function jA(t){return Math.round(1e3*jd(t))/1e3}function BLe(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new GB(t.type,0);case"saturate":case"brightness":case"contrast":return new GB(t.type,1);case"opacity":return new Cpe(1);case"hue-rotate":return new Spe(0);case"blur":return new vpe(0);case"drop-shadow":return new xpe(0,0,0,[...sq("transparent")]);case"bloom":return new ype(0,0,1)}}function VLe(t,e){const i=t.length>e.length?t:e;return(t.length>e.length?e:t).every((r,n)=>r.type===i[n].type)}function GLe(t,e){const i=t.length>e.length?t:e,r=t.length>e.length?e:t;for(let n=r.length;n<i.length;n++)r.push(BLe(i[n]))}function OEt(t){const e=t[0];return!!e&&"type"in e}function jLe(t,e){return JSON.stringify(t??null)===JSON.stringify(e??null)}const vK=ne.getLogger("esri.support.basemapUtils");function HLe(){return{}}function qLe(t){for(const e in t){const i=t[e];Pe(i),delete t[e]}}function vq(t,e){let i;if(typeof t=="string"){const r=t in NB,n=!r&&t.includes("/");if(!r&&!n){const s=Object.entries(NB).filter(([o,a])=>Oi.apiKey&&!a.classic||!Oi.apiKey&&(a.classic||a.is3d)).map(([o])=>`"${o}"`).sort().join(", ");return vK.warn(`Unable to find basemap definition for: ${t}. Try one of these: ${s}`),null}e&&(i=e[t]),i||(i=r?rT.fromId(t):new rT({style:{id:t}}),e&&(e[t]=i))}else i=uo(rT,t);return i?.destroyed&&(vK.warn("The provided basemap is already destroyed",{basemap:i}),i=null),i}function REt(t,e){return t.basemap?.referenceLayers?.some(i=>i.uid===e)||t.basemap?.baseLayers?.some(i=>i.uid===e)}function WLe(t,e=null){const i=vq(t);if(!i)return null;const r=i.clone();return e&&(r.baseLayers=bK(r.baseLayers,e.baseLayers),r.referenceLayers=bK(r.referenceLayers,e.referenceLayers)),r}function bK(t,e){const i=new ft;return t.forEach(r=>{const n=e.find(s=>s.type!=="scene"&&ZLe(TK(r),TK(s)))||r;i.includes(n)?i.push(r):i.push(n)}),i}function wK(t){return!!t?.baseLayers.concat(t.referenceLayers).some(YLe)}function YLe(t){if(xK(t.url))return!0;if(t.type==="vector-tile")for(const e in t.sourceNameToSource){const i=t.sourceNameToSource[e];if(xK(i?.sourceUrl))return!0}return!1}const XLe=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function xK(t){if(!t)return!1;const e=new Wl(La(t));return!!e.authority&&XLe.test(e.authority)}function TK(t){return{type:t.type,effect:"effect"in t?t.effect:void 0,url:JLe("urlTemplate"in t&&t.urlTemplate||t.url||"styleUrl"in t&&t.styleUrl||""),minScale:"minScale"in t&&t.minScale!=null?t.minScale:0,maxScale:"maxScale"in t&&t.maxScale!=null?t.maxScale:0,opacity:t.opacity!=null?t.opacity:1,visible:t.visible==null||!!t.visible,sublayers:t.type!=="map-image"&&t.type!=="wms"||t.sublayers==null?void 0:t.sublayers?.map(e=>({id:e.id,visible:e.visible})),activeLayerId:t.type==="wmts"?t.activeLayer?.id:void 0}}function ZLe(t,e){if(t.type!==e.type||t.url!==e.url||t.minScale!==e.minScale||t.maxScale!==e.maxScale||t.visible!==e.visible||t.opacity!==e.opacity||!jLe(t.effect,e.effect))return!1;if(t.activeLayerId!=null||e.activeLayerId!=null)return t.activeLayerId===e.activeLayerId;if(t.sublayers!=null||e.sublayers!=null){if(t.sublayers==null||e.sublayers==null||t.sublayers.length!==e.sublayers.length)return!1;for(let i=0;i<t.sublayers.length;i++){const r=t.sublayers.at(i),n=e.sublayers.at(i);if(r?.id!==n?.id||r?.visible!==n?.visible)return!1}}return!0}function JLe(t){return t?Dd(t).replace(/^\s*https?:/i,"").toLowerCase():""}function KLe(t){return new J3({getCollections:()=>[t.tables,t.layers],getChildrenFunction:e=>{const i=[];return"tables"in e&&i.push(e.tables),"layers"in e&&i.push(e.layers),i},itemFilterFunction:e=>{const i=e.parent;return!!i&&"tables"in i&&i.tables.includes(e)}})}function e6(t){for(const e of t.values())e?.destroy();t.clear()}const SK={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function QLe(t){let e=null;if(typeof t=="string")if(t in SK){const i=SK[t];e=new Z3({resourceInfo:{data:{layers:[i]}}})}else ne.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`);else e=uo(Z3,t);return e}function kT(t,e,i=!1){let{hasM:r,hasZ:n}=t;Array.isArray(e)?e.length!==4||r||n?e.length===3&&i&&!r?(n=!0,r=!1):e.length===3&&r&&n&&(r=!1,n=!1):(r=!0,n=!0):(n=!n&&e.hasZ&&(!r||e.hasM),r=!r&&e.hasM&&(!n||e.hasZ)),t.hasZ=n,t.hasM=r}var jB;function EK(t){return(e,i)=>e==null?i:i==null?e:t(e,i)}function eDe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let B0=jB=class extends E_{constructor(...t){super(...t),this.points=[],this.type="multipoint"}normalizeCtorArgs(t,e){if(!t&&!e)return{};const i={};Array.isArray(t)?(i.points=t,i.spatialReference=e):eDe(t)?i.spatialReference=t:(t.points&&(i.points=t.points),t.spatialReference&&(i.spatialReference=t.spatialReference),t.hasZ&&(i.hasZ=t.hasZ),t.hasM&&(i.hasM=t.hasM));const r=i.points?.[0];return r&&(i.hasZ===void 0&&i.hasM===void 0?(i.hasZ=r.length>2,i.hasM=!1):i.hasZ===void 0?i.hasZ=r.length>3:i.hasM===void 0&&(i.hasM=r.length>3)),i}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const t=this.points;if(!t.length)return null;const e=new Xi,i=this.hasZ,r=this.hasM,n=i?3:2,s=t[0],o=EK(Math.min),a=EK(Math.max);let l,c,u,d,[p,m]=s,[y,_]=s;for(let v=0,w=t.length;v<w;v++){const x=t[v],[T,S]=x;if(p=o(p,T),m=o(m,S),y=a(y,T),_=a(_,S),i&&x.length>2){const E=x[2];l=o(l,E),u=a(u,E)}if(r&&x.length>n){const E=x[n];c=o(c,E),d=a(d,E)}}return e.xmin=p,e.ymin=m,e.xmax=y,e.ymax=_,e.spatialReference=this.spatialReference,i?(e.zmin=l,e.zmax=u):(e.zmin=void 0,e.zmax=void 0),r?(e.mmin=c,e.mmax=d):(e.mmin=void 0,e.mmax=void 0),e}writePoints(t,e){e.points=ye(this.points)}addPoint(t){return kT(this,t),Array.isArray(t)?this.points.push(t):this.points.push(t.toArray()),this.notifyChange("points"),this}clone(){const t={points:ye(this.points),spatialReference:this.spatialReference};return this.hasZ&&(t.hasZ=!0),this.hasM&&(t.hasM=!0),new jB(t)}getPoint(t){if(!this._validateInputs(t))return null;const e=this.points[t],i={x:e[0],y:e[1],spatialReference:this.spatialReference};let r=2;return this.hasZ&&(i.z=e[2],r=3),this.hasM&&(i.m=e[r]),new lt(i)}removePoint(t){if(!this._validateInputs(t))return null;const e=new lt(this.points.splice(t,1)[0],this.spatialReference);return this.notifyChange("points"),e}setPoint(t,e){return this._validateInputs(t)?(kT(this,e),Array.isArray(e)||(e=e.toArray()),this.points[t]=e,this.notifyChange("points"),this):this}toJSON(t){return this.write({},t)}_validateInputs(t){return t!=null&&t>=0&&t<this.points.length}};h([f({readOnly:!0})],B0.prototype,"cache",null),h([f()],B0.prototype,"extent",null),h([f({type:[[Number]],json:{write:{isRequired:!0}}})],B0.prototype,"points",void 0),h([di("points")],B0.prototype,"writePoints",null),B0=jB=h([z("esri.geometry.Multipoint")],B0),B0.prototype.toJSON.isDefaultToJSON=!0;const IS=B0;function PEt(t){const e=[];for(t.reset();t.nextPath();){const i=[];for(;t.nextPoint();)i.push([t.x,t.y]);e.push(i)}return t.reset(),e}function tDe(t){const e=[];for(;t.nextPoint();)e.push([t.x,t.y]);return t.seekPathStart(),e}var Yr;(function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"})(Yr||(Yr={}));function D4(t,e){const i=e[0]-t[0],r=e[1]-t[1];if(t.length>2&&e.length>2){const n=t[2]-e[2];return Math.sqrt(i*i+r*r+n*n)}return Math.sqrt(i*i+r*r)}function Ope(t,e,i){const r=t[0]+i*(e[0]-t[0]),n=t[1]+i*(e[1]-t[1]);return t.length>2&&e.length>2?[r,n,t[2]+i*(e[2]-t[2])]:[r,n]}function MEt(t,e,i,r){const[n,s]=e,[o,a]=i,[l,c]=r,u=l-o,d=c-a,p=u*u+d*d,m=(n-o)*u+(s-a)*d,y=Math.min(1,Math.max(0,m/p));return t[0]=o+u*y,t[1]=a+d*y,t}function Rpe(t,e){return Ope(t,e,.5)}function Ppe(t){const e=t.length;let i=0;for(let r=0;r<e-1;++r)i+=D4(t[r],t[r+1]);return i}function Mpe(t,e){if(e<=0)return t[0];const i=t.length;let r=0;for(let n=0;n<i-1;++n){const s=D4(t[n],t[n+1]);if(e-r<s){const o=(e-r)/s;return Ope(t[n],t[n+1],o)}r+=s}return t[i-1]}function EI(t,e=Yr.X,i=Yr.Y){let r=0;const n=t.length;let s=t[0];for(let o=0;o<n-1;o++){const a=t[o+1];r+=(a[e]-s[e])*(a[i]+s[i]),s=a}return r>=0}function iDe(t){const e=t.length;return e>2&&yg(t[0],t[e-1])}function $Et(t){if("rings"in t)for(const e of t.rings)iDe(e)||e.push(e[0].slice())}function IEt(t){return t?t.hasZ?[t.xmax-t.xmin/2,t.ymax-t.ymin/2,t.zmax-t.zmin/2]:[t.xmax-t.xmin/2,t.ymax-t.ymin/2]:null}function rDe(t){return t?$pe(t.rings,t.hasZ??!1):null}function $pe(t,e){if(!t?.length)return null;const i=[],r=[],n=e?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let s=0,o=t.length;s<o;s++){const a=Ipe(t[s],e,n);a&&r.push(a)}if(r.sort((s,o)=>{let a=s[2]-o[2];return a===0&&e&&(a=s[4]-o[4]),a}),r.length&&(i[0]=r[0][0],i[1]=r[0][1],e&&(i[2]=r[0][3]),(i[0]<n[0]||i[0]>n[1]||i[1]<n[2]||i[1]>n[3]||e&&(i[2]<n[4]||i[2]>n[5]))&&(i.length=0)),!i.length){const s=t[0]&&t[0].length?nDe(t[0],e):null;if(!s)return null;i[0]=s[0],i[1]=s[1],e&&s.length>2&&(i[2]=s[2])}return i}function Ipe(t,e,i){let r=0,n=0,s=0,o=0,a=0;const l=t.length?t[0][0]:0,c=t.length?t[0][1]:0,u=t.length&&e?t[0][2]:0;for(let p=0;p<t.length;p++){const m=t[p],y=t[(p+1)%t.length],[_,v,w]=m,x=_-l,T=v-c,[S,E,A]=y,P=S-l,N=E-c,F=x*N-P*T;if(o+=F,r+=(x+P)*F,n+=(T+N)*F,e&&m.length>2&&y.length>2){const D=w-u,$=A-u,R=x*$-P*D;s+=(D+$)*R,a+=R}_<i[0]&&(i[0]=_),_>i[1]&&(i[1]=_),v<i[2]&&(i[2]=v),v>i[3]&&(i[3]=v),e&&(w<i[4]&&(i[4]=w),w>i[5]&&(i[5]=w))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const d=[r/(6*o)+l,n/(6*o)+c,o];return e&&(i[4]===i[5]||a===0?(d[3]=(i[4]+i[5])/2,d[4]=0):(d[3]=s/(6*a)+u,d[4]=a)),d}function LEt(t,e){let i=0,r=0,n=0;t.nextPoint();const s=t.pathSize?t.x:0,o=t.pathSize?t.y:0;for(let a=0;a<t.pathSize;a++){t.seekInPath(a);const l=[t.x,t.y];t.seekInPath((a+1)%t.pathSize);const c=[t.x,t.y],[u,d]=l,p=u-s,m=d-o,[y,_]=c,v=y-s,w=_-o,x=p*w-v*m;n+=x,i+=(p+v)*x,r+=(m+w)*x,u<e[0]&&(e[0]=u),u>e[1]&&(e[1]=u),d<e[2]&&(e[2]=d),d>e[3]&&(e[3]=d)}return n>0&&(n*=-1),n?(n*=.5,[i/(6*n)+s,r/(6*n)+o,n]):null}function nDe(t,e){const i=e?[0,0,0]:[0,0],r=e?[0,0,0]:[0,0];let n=0,s=0,o=0,a=0;for(let l=0,c=t.length;l<c-1;l++){const u=t[l],d=t[l+1];if(u&&d){i[0]=u[0],i[1]=u[1],r[0]=d[0],r[1]=d[1],e&&u.length>2&&d.length>2&&(i[2]=u[2],r[2]=d[2]);const p=D4(i,r);if(p){n+=p;const m=Rpe(u,d);s+=p*m[0],o+=p*m[1],e&&m.length>2&&(a+=p*m[2])}}}return n>0?e?[s/n,o/n,a/n]:[s/n,o/n]:t.length?t[0]:null}function sDe(t){const{hasZ:e,totalSize:i}=t;if(i===0)return null;const r=[],n=[],s=e?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(t.reset();t.nextPath();){const o=Ipe(tDe(t),t.hasZ,s);o&&n.push(o)}if(n.sort((o,a)=>{let l=o[2]-a[2];return l===0&&e&&(l=o[4]-a[4]),l}),n.length&&(r[0]=n[0][0],r[1]=n[0][1],e&&(r[2]=n[0][3]),(r[0]<s[0]||r[0]>s[1]||r[1]<s[2]||r[1]>s[3]||e&&(r[2]<s[4]||r[2]>s[5]))&&(r.length=0)),!r.length){t.reset(),t.nextPath();const o=t.pathSize?oDe(t):null;if(!o)return null;r[0]=o[0],r[1]=o[1],e&&o.length>2&&(r[2]=o[2])}return r}function oDe(t){const{hasZ:e}=t,i=e?[0,0,0]:[0,0],r=e?[0,0,0]:[0,0];let n=0,s=0,o=0,a=0;if(t.nextPoint()){let l=t.x,c=t.y,u=t.z;for(;t.nextPoint();){const d=t.x,p=t.y,m=t.z;i[0]=l,i[1]=c,r[0]=d,r[1]=p,e&&(i[2]=u,r[2]=m);const y=D4(i,r);if(y){n+=y;const _=Rpe(i,r);s+=y*_[0],o+=y*_[1],e&&_.length>2&&(a+=y*_[2])}l=d,c=p,u=m}}return n>0?e?[s/n,o/n,a/n]:[s/n,o/n]:t.pathSize?(t.seekPathStart(),t.nextPoint(),[t.x,t.y]):null}const aDe=1e-6;function DEt(t){let e=0;for(t.reset();t.nextPath();)e+=t.getCurrentRingArea();if(e<aDe){const n=sDe(t);return n?[n[0],n[1]]:null}const i=[0,0];if(t.reset(),!t.nextPath()||!t.nextPoint())return null;const r=[t.x,t.y];for(t.reset();t.nextPath();)cDe(i,r,t);return i[0]*=1/e,i[1]*=1/e,i[0]+=r[0],i[1]+=r[1],i}const lDe=1/3;function cDe(t,e,i){if(!t||!i||i.pathSize<3)return null;i.nextPoint();const r=i.x,n=i.y;i.nextPoint();let s,o=i.x-r,a=i.y-n,l=0,c=0;for(;i.nextPoint();)l=i.x-r,c=i.y-n,s=.5*lDe*(l*a-c*o),t[0]+=s*(o+l),t[1]+=s*(a+c),o=l,a=c;const u=i.getCurrentRingArea(),d=[r,n];return d[0]-=e[0],d[1]-=e[1],d[0]*=u,d[1]*=u,t[0]+=d[0],t[1]+=d[1],t}function Gt(t=pDe){return[t[0],t[1],t[2],t[3]]}function NEt(t){return[t[0],t[1],t[2],t[3]]}function xg(t,e){return t!==e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t}function bq(t,e,i,r,n=Gt()){return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n}function Lpe(t,e=Gt()){return e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax,e}function N4(t,e){return new Xi({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}function wq(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function Hy(t,e,i){if(e!=null)if("length"in e)WB(e)?(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[2]),i[3]=Math.max(t[3],e[3])):e.length!==2&&e.length!==3||(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[0]),i[3]=Math.max(t[3],e[1]));else switch(e.type){case"extent":i[0]=Math.min(t[0],e.xmin),i[1]=Math.min(t[1],e.ymin),i[2]=Math.max(t[2],e.xmax),i[3]=Math.max(t[3],e.ymax);break;case"point":i[0]=Math.min(t[0],e.x),i[1]=Math.min(t[1],e.y),i[2]=Math.max(t[2],e.x),i[3]=Math.max(t[3],e.y)}else xg(i,t)}function t6(t,e,i=t){const r=e.length;let n=t[0],s=t[1],o=t[2],a=t[3];for(let l=0;l<r;l++){const c=e[l];n=Math.min(n,c[0]),s=Math.min(s,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return i[0]=n,i[1]=s,i[2]=o,i[3]=a,i}function HB(t){for(let e=0;e<4;e++)if(!isFinite(t[e]))return!1;return!0}function ea(t){return t==null||t[0]>=t[2]?0:t[2]-t[0]}function pl(t){return t==null||t[1]>=t[3]?0:t[3]-t[1]}function FEt(t){return ea(t)*pl(t)}function qD(t){return ea(t)>0&&pl(t)>0}function xq(t,e=[0,0]){return e[0]=(t[0]+t[2])/2,e[1]=(t[1]+t[3])/2,e}function Dpe(t,e){return F4(t,e[0],e[1])}function CK(t,e){const i=e[3],r=.5*(t[0]+t[2]),n=Math.abs(e[0]-r),s=.5*(t[2]-t[0]);if(n>i+s)return!1;const o=.5*(t[1]+t[3]),a=.5*(t[3]-t[1]),l=Math.abs(e[1]-o);if(l>i+a)return!1;if(n<s||l<a)return!0;const c=n-s,u=l-a;return c*c+u*u<=i*i}function kEt(t,e,i){const r=t[0],n=t[1],s=t[2],o=t[3],{x:a,y:l}=e,{x:c,y:u}=i,d=(v,w)=>(u-l)*v+(a-c)*w+(c*l-a*u)<0,p=d(r,o),m=d(s,o),y=d(s,n),_=d(r,n);return!(p===m&&m===y&&y===_&&_===p||a<r&&c<r||a>s&&c>s||l>o&&u>o||l<n&&u<n)}function UEt(t,e){return F4(t,e.x,e.y)}function F4(t,e,i){return e>=t[0]&&i>=t[1]&&e<=t[2]&&i<=t[3]}function uDe(t,e,i){return e[0]>=t[0]-i&&e[1]>=t[1]-i&&e[0]<=t[2]+i&&e[1]<=t[3]+i}function k4(t,e){return Math.max(e[0],t[0])<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])<=Math.min(e[3],t[3])}function AK(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}function qB(t,e,i){if(e==null)return xg(i,t);const r=e[0],n=e[1],s=e[2],o=e[3];return i[0]=_e(t[0],r,s),i[1]=_e(t[1],n,o),i[2]=_e(t[2],r,s),i[3]=_e(t[3],n,o),i}function hDe(t,e){const i=(t[0]+t[2])/2,r=(t[1]+t[3])/2,n=Math.max(Math.abs(e[0]-i)-ea(t)/2,0),s=Math.max(Math.abs(e[1]-r)-pl(t)/2,0);return Math.sqrt(n*n+s*s)}function WD(t,e,i,r=t){return r[0]=t[0]+e,r[1]=t[1]+i,r[2]=t[2]+e,r[3]=t[3]+i,r}function mh(t){return t?xg(t,YB):Gt(YB)}function WB(t){return t!=null&&t.length===4}function dDe(t){return!(ea(t)!==0&&isFinite(t[0])||pl(t)!==0&&isFinite(t[1]))}function Z1(t,e){return WB(t)&&WB(e)?t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]:t===e}const zEt=[-1/0,-1/0,1/0,1/0],YB=[1/0,1/0,-1/0,-1/0],pDe=[0,0,0,0];function Npe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function Fpe(t){return t.points!==void 0}function kpe(t){return t.x!==void 0&&t.y!==void 0}function Upe(t){return t.paths!==void 0}function zpe(t){return t.rings!==void 0}function Bpe(t){function e(i,r){return i==null?r:r==null?i:t(i,r)}return e}const Ry=Bpe(Math.min),Py=Bpe(Math.max);function BEt(t,e){return Upe(e)?UT(t,e.paths,!1,!1):zpe(e)?UT(t,e.rings,!1,!1):Fpe(e)?Tq(t,e.points,!1,!1,!1,!1):Npe(e)?Vpe(t,e):(kpe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.x,t[3]=e.y),t)}function VEt(t){let e,i,r,n;for(t.reset(),e=r=1/0,i=n=-1/0;t.nextPath();){const s=fDe(t);e=Math.min(s[0],e),r=Math.min(s[1],r),i=Math.max(s[2],i),n=Math.max(s[3],n)}return Gt([e,r,i,n])}function fDe(t){let e,i,r,n;for(e=r=1/0,i=n=-1/0;t.nextPoint();)e=Math.min(t.x,e),r=Math.min(t.y,r),i=Math.max(t.x,i),n=Math.max(t.y,n);return Gt([e,r,i,n])}function GEt(t,e){return Upe(e)?UT(t,e.paths,!0,!1):zpe(e)?UT(t,e.rings,!0,!1):Fpe(e)?Tq(t,e.points,!0,!1,!0,!1):Npe(e)?Vpe(t,e,!0,!1,!0,!1):(kpe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.x,t[4]=e.y,t[5]=e.z),t)}function UT(t,e,i,r){const n=i?3:2;if(!e.length||!e[0].length)return null;let s,o,a,l,[c,u]=e[0][0],[d,p]=e[0][0];for(let m=0;m<e.length;m++){const y=e[m];for(let _=0;_<y.length;_++){const v=y[_],[w,x]=v;if(c=Ry(c,w),u=Ry(u,x),d=Py(d,w),p=Py(p,x),i&&v.length>2){const T=v[2];s=Ry(s,T),o=Py(o,T)}if(r&&v.length>n){const T=v[n];a=Ry(s,T),l=Py(o,T)}}}return i?r?(t[0]=c,t[1]=u,t[2]=s,t[3]=a,t[4]=d,t[5]=p,t[6]=o,t[7]=l,t.length=8,t):(t[0]=c,t[1]=u,t[2]=s,t[3]=d,t[4]=p,t[5]=o,t.length=6,t):r?(t[0]=c,t[1]=u,t[2]=a,t[3]=d,t[4]=p,t[5]=l,t.length=6,t):(t[0]=c,t[1]=u,t[2]=d,t[3]=p,t.length=4,t)}function Vpe(t,e,i,r,n,s){const o=e.xmin,a=e.xmax,l=e.ymin,c=e.ymax;let u=e.zmin,d=e.zmax,p=e.mmin,m=e.mmax;return n?(u=u||0,d=d||0,s?(p=p||0,m=m||0,t[0]=o,t[1]=l,t[2]=u,t[3]=p,t[4]=a,t[5]=c,t[6]=d,t[7]=m,t):(t[0]=o,t[1]=l,t[2]=u,t[3]=a,t[4]=c,t[5]=d,t)):s?(p=p||0,m=m||0,t[0]=o,t[1]=l,t[2]=p,t[3]=a,t[4]=c,t[5]=m,t):(t[0]=o,t[1]=l,t[2]=a,t[3]=c,t)}function Tq(t,e,i,r,n,s){const o=i?3:2,a=r&&s,l=i&&n;if(!e.length||!e[0].length)return null;let c,u,d,p,[m,y]=e[0],[_,v]=e[0];for(let w=0;w<e.length;w++){const x=e[w],[T,S]=x;if(m=Ry(m,T),y=Ry(y,S),_=Py(_,T),v=Py(v,S),l&&x.length>2){const E=x[2];c=Ry(c,E),u=Py(u,E)}if(a&&x.length>o){const E=x[o];d=Ry(c,E),p=Py(u,E)}}return n?(c=c||0,u=u||0,s?(d=d||0,p=p||0,t[0]=m,t[1]=y,t[2]=c,t[3]=d,t[4]=_,t[5]=v,t[6]=u,t[7]=p,t):(t[0]=m,t[1]=y,t[2]=c,t[3]=_,t[4]=v,t[5]=u,t)):s?(d=d||0,p=p||0,t[0]=m,t[1]=y,t[2]=d,t[3]=_,t[4]=v,t[5]=p,t):(t[0]=m,t[1]=y,t[2]=_,t[3]=v,t)}function mDe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function gDe(t){return t.points!==void 0}function yDe(t){return t.x!==void 0&&t.y!==void 0}function _De(t){return t.paths!==void 0}function vDe(t){return t.rings!==void 0}const Sq=[];function Gpe(t,e,i,r){return{xmin:t,ymin:e,xmax:i,ymax:r}}function jpe(t,e,i,r,n,s){return{xmin:t,ymin:e,zmin:i,xmax:r,ymax:n,zmax:s}}function Hpe(t,e,i,r,n,s){return{xmin:t,ymin:e,mmin:i,xmax:r,ymax:n,mmax:s}}function qpe(t,e,i,r,n,s,o,a){return{xmin:t,ymin:e,zmin:i,mmin:r,xmax:n,ymax:s,zmax:o,mmax:a}}function Eq(t,e=!1,i=!1){return e?i?qpe(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):jpe(t[0],t[1],t[2],t[3],t[4],t[5]):i?Hpe(t[0],t[1],t[2],t[3],t[4],t[5]):Gpe(t[0],t[1],t[2],t[3])}function jEt(t){return t?mDe(t)?t:yDe(t)?wDe(t):vDe(t)?Wpe(t):_De(t)?Ype(t):gDe(t)?bDe(t):null:null}function bDe(t){const{hasZ:e,hasM:i,points:r}=t;return Eq(Tq(Sq,r,e??!1,i??!1),e,i)}function wDe(t){const{x:e,y:i,z:r,m:n}=t,s=n!=null;return r!=null?s?qpe(e,i,r,n,e,i,r,n):jpe(e,i,r,e,i,r):s?Hpe(e,i,n,e,i,n):Gpe(e,i,e,i)}function Wpe(t){const{hasZ:e,hasM:i,rings:r}=t,n=UT(Sq,r,e??!1,i??!1);return n?Eq(n,e,i):null}function Ype(t){const{hasZ:e,hasM:i,paths:r}=t,n=UT(Sq,r,e??!1,i??!1);return n?Eq(n,e,i):null}var CI;function OK(t){return!Array.isArray(t[0])}let $p=CI=class extends E_{static fromExtent(t){const e=t.clone().normalize(),i=t.spatialReference;let r=!1,n=!1;for(const o of e)o.hasZ&&(r=!0),o.hasM&&(n=!0);const s={rings:e.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(r&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(n&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:i};return r&&(s.hasZ=!0),n&&(s.hasM=!0),new CI(s)}constructor(...t){super(...t),this.rings=[],this.type="polygon"}normalizeCtorArgs(t,e){let i,r,n=null,s=null;return t&&!Array.isArray(t)?(n=t.rings??null,e||(t.spatialReference?e=t.spatialReference:t.rings||(e=t)),i=t.hasZ,r=t.hasM):n=t,n=n||[],e=e||je.WGS84,n.length&&n[0]?.[0]!=null&&typeof n[0][0]=="number"&&(n=[n]),s=n[0]?.[0],s&&(i===void 0&&r===void 0?(i=s.length>2,r=s.length>3):i===void 0?i=r?s.length>3:s.length>2:r===void 0&&(r=i?s.length>3:s.length>2)),{rings:n,spatialReference:e,hasZ:i,hasM:r}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const t=rDe(this);if(!t||isNaN(t[0])||isNaN(t[1])||this.hasZ&&isNaN(t[2]))return null;const e=new lt;return e.x=t[0],e.y=t[1],e.spatialReference=this.spatialReference,this.hasZ&&(e.z=t[2]),e}get extent(){const{spatialReference:t}=this,e=Wpe(this);if(!e)return null;const i=new Xi(e);return i.spatialReference=t,i}get isSelfIntersecting(){return O$e(this.rings)}writeRings(t,e){e.rings=ye(this.rings)}addRing(t){if(!t)return;const e=this.rings,i=e.length;if(OK(t)){const r=[];for(let n=0,s=t.length;n<s;n++)r[n]=t[n].toArray();e[i]=r}else e[i]=t.concat();return this.notifyChange("rings"),this}clone(){const t=new CI;return t.spatialReference=this.spatialReference,t.rings=ye(this.rings),t.hasZ=this.hasZ,t.hasM=this.hasM,t}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,i=t.spatialReference;if(e!=null!=(i!=null)||e!=null&&i!=null&&!e.equals(i)||this.rings.length!==t.rings.length)return!1;const r=([n,s,o,a],[l,c,u,d])=>n===l&&s===c&&(o==null&&u==null||o===u)&&(a==null&&d==null||a===d);for(let n=0;n<this.rings.length;n++){const s=this.rings[n],o=t.rings[n];if(!yg(s,o,r))return!1}return!0}contains(t){if(!t)return!1;const e=sR(t,this.spatialReference);return _$e(this,e??t)}isClockwise(t){let e;return e=OK(t)?t.map(i=>this.hasZ?this.hasM?[i.x,i.y,i.z,i.m]:[i.x,i.y,i.z]:[i.x,i.y]):t,EI(e)}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.rings[t][e],r=this.hasZ,n=this.hasM;return r&&!n?new lt(i[0],i[1],i[2],void 0,this.spatialReference):n&&!r?new lt(i[0],i[1],void 0,i[2],this.spatialReference):r&&n?new lt(i[0],i[1],i[2],i[3],this.spatialReference):new lt(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?(kT(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t].splice(e,0,i),this.notifyChange("rings"),this):this}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new lt(this.rings[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("rings"),i}removeRing(t){if(!this._validateInputs(t,null))return null;const e=this.rings.splice(t,1)[0],i=this.spatialReference,r=e.map(n=>new lt(n,i));return this.notifyChange("rings"),r}setPoint(t,e,i){return this._validateInputs(t,e)?(kT(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t][e]=i,this.notifyChange("rings"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.rings.length)return!1;if(e!=null){const r=this.rings[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};h([f({readOnly:!0})],$p.prototype,"cache",null),h([f({readOnly:!0})],$p.prototype,"centroid",null),h([f({readOnly:!0})],$p.prototype,"extent",null),h([f({readOnly:!0})],$p.prototype,"isSelfIntersecting",null),h([f({type:[[[Number]]],json:{write:{isRequired:!0}}})],$p.prototype,"rings",void 0),h([di("rings")],$p.prototype,"writeRings",null),$p=CI=h([z("esri.geometry.Polygon")],$p),$p.prototype.toJSON.isDefaultToJSON=!0;const Mf=$p;var XB;function xDe(t){return!Array.isArray(t[0])}let V0=XB=class extends E_{constructor(...t){super(...t),this.paths=[],this.type="polyline"}normalizeCtorArgs(t,e){let i,r,n=null,s=null;return t&&!Array.isArray(t)?(n=t.paths??null,e||(t.spatialReference?e=t.spatialReference:t.paths||(e=t)),i=t.hasZ,r=t.hasM):n=t,n=n||[],e=e||je.WGS84,n.length&&n[0]?.[0]!=null&&typeof n[0][0]=="number"&&(n=[n]),s=n[0]?.[0],s&&(i===void 0&&r===void 0?(i=s.length>2,r=!1):i===void 0?i=!r&&s.length>3:r===void 0&&(r=!i&&s.length>3)),{paths:n,spatialReference:e,hasZ:i,hasM:r}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:t}=this,e=Ype(this);if(!e)return null;const i=new Xi(e);return i.spatialReference=t,i}writePaths(t,e){e.paths=ye(this.paths)}addPath(t){if(!t)return;const e=this.paths,i=e.length;if(xDe(t)){const r=[];for(let n=0,s=t.length;n<s;n++)r[n]=t[n].toArray();e[i]=r}else e[i]=t.concat();return this.notifyChange("paths"),this}clone(){const t=new XB;return t.spatialReference=this.spatialReference,t.paths=ye(this.paths),t.hasZ=this.hasZ,t.hasM=this.hasM,t}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.paths[t][e],r=this.hasZ,n=this.hasM;return r&&!n?new lt(i[0],i[1],i[2],void 0,this.spatialReference):n&&!r?new lt(i[0],i[1],void 0,i[2],this.spatialReference):r&&n?new lt(i[0],i[1],i[2],i[3],this.spatialReference):new lt(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?(kT(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t].splice(e,0,i),this.notifyChange("paths"),this):this}removePath(t){if(!this._validateInputs(t,null))return null;const e=this.paths.splice(t,1)[0],i=this.spatialReference,r=e.map(n=>new lt(n,i));return this.notifyChange("paths"),r}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new lt(this.paths[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("paths"),i}setPoint(t,e,i){return this._validateInputs(t,e)?(kT(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t][e]=i,this.notifyChange("paths"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.paths.length)return!1;if(e!=null){const r=this.paths[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};h([f({readOnly:!0})],V0.prototype,"cache",null),h([f({readOnly:!0})],V0.prototype,"extent",null),h([f({type:[[[Number]]],json:{write:{isRequired:!0}}})],V0.prototype,"paths",void 0),h([di("paths")],V0.prototype,"writePaths",null),V0=XB=h([z("esri.geometry.Polyline")],V0),V0.prototype.toJSON.isDefaultToJSON=!0;const Ad=V0,TDe=fu()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),HEt=fu()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function Xpe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function Cq(t){return t.points!==void 0}function Aq(t){return t.x!==void 0&&t.y!==void 0}function Oq(t){return t.paths!==void 0}function U4(t){return t.rings!==void 0}function Cb(t){return t==null?null:t instanceof E_?t:Aq(t)?lt.fromJSON(t):Oq(t)?Ad.fromJSON(t):U4(t)?Mf.fromJSON(t):Cq(t)?IS.fromJSON(t):Xpe(t)?Xi.fromJSON(t):null}function uR(t){return t?Aq(t)?"esriGeometryPoint":Oq(t)?"esriGeometryPolyline":U4(t)?"esriGeometryPolygon":Xpe(t)?"esriGeometryEnvelope":Cq(t)?"esriGeometryMultipoint":null:null}const SDe={esriGeometryPoint:lt,esriGeometryPolyline:Ad,esriGeometryPolygon:Mf,esriGeometryEnvelope:Xi,esriGeometryMultipoint:IS};function EDe(t){return t&&SDe[t]||null}const Rq={base:E_,key:"type",typeMap:{extent:Xi,multipoint:IS,point:lt,polyline:Ad,polygon:Mf}};Ky(Rq);let Zpe=0;const Pq=t=>{let e=class extends t{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+Zpe++})}};return e=h([z("esri.core.Identifiable")],e),e},qEt=t=>{let e=class extends t{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Zpe++})}};return e=h([z("esri.core.NumericIdentifiable")],e),e};let RK=class extends Pq(class{}){};RK=h([z("esri.core.Identifiable")],RK);async function CDe(t){const e="portalItem"in t?t:{portalItem:t},{fromItem:i}=await pe(()=>import("./portalLayers-c7cc2afd.js").then(r=>r.p),["./portalLayers-c7cc2afd.js","./associatedFeatureServiceUtils-44938726.js","./requestPresets-f7ad0d2f.js"],import.meta.url);try{return await i(e)}catch(r){const n=e&&e.portalItem,s=n?.id||"unset",o=n&&n.portal&&n.portal.url||Oi.portalUrl;throw ne.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+s+"')",r),r}}let ADe=0,Rs=class extends Tn.EventedMixin(Pq(bg)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new Xi(-180,-90,180,90,je.WGS84),this.id=Date.now().toString(16)+"-layer-"+ADe++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.persistenceEnabled=!1,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=je.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const i=typeof e=="string"?{url:e}:e;return(await pe(()=>import("./arcgisLayers-e14ebdd0.js"),["./arcgisLayers-e14ebdd0.js","./associatedFeatureServiceUtils-44938726.js","./fetchService-1b5d4dbf.js","./requestPresets-f7ad0d2f.js"],import.meta.url)).fromUrl(i)}static fromPortalItem(e){return CDe(e)}initialize(){this.when().catch(e=>{Fn(e)||ne.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}destroy(){const e=this.parent;if(e){const i=this;"layers"in e&&e.layers.includes(i)?e.layers.remove(i):"tables"in e&&e.tables.includes(i)?e.tables.remove(i):"baseLayers"in e&&e.baseLayers.includes(i)?e.baseLayers.remove(i):"referenceLayers"in e&&e.referenceLayers.includes(i)&&e.referenceLayers.remove(i),this._set("parent",null)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return bn(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await Ii(e,{query:{f:"json"},responseType:"json"})).data;throw new W("layer:no-attribution-data","Layer does not have attribution data")}};h([f({type:String})],Rs.prototype,"attributionDataUrl",void 0),h([f({type:Xi})],Rs.prototype,"fullExtent",void 0),h([f({readOnly:!0})],Rs.prototype,"hasAttributionData",null),h([f({type:String,clonable:!1})],Rs.prototype,"id",void 0),h([f({type:Boolean,nonNullable:!0})],Rs.prototype,"legendEnabled",void 0),h([f({type:["show","hide","hide-children"]})],Rs.prototype,"listMode",void 0),h([f({type:Number,range:{min:0,max:1},nonNullable:!0})],Rs.prototype,"opacity",void 0),h([f({clonable:!1})],Rs.prototype,"parent",void 0),h([f({readOnly:!0})],Rs.prototype,"parsedUrl",null),h([f({type:Boolean,readOnly:!0})],Rs.prototype,"persistenceEnabled",void 0),h([f({type:Boolean})],Rs.prototype,"popupEnabled",void 0),h([f({type:Boolean})],Rs.prototype,"attributionVisible",void 0),h([f({type:je})],Rs.prototype,"spatialReference",void 0),h([f({type:String})],Rs.prototype,"title",void 0),h([f({readOnly:!0,json:{read:!1}})],Rs.prototype,"type",void 0),h([f()],Rs.prototype,"url",void 0),h([f({type:Boolean,nonNullable:!0})],Rs.prototype,"visible",void 0),Rs=h([z("esri.layers.Layer")],Rs);const Jpe=Rs;function ZB(t,e,i){let r,n;if(t)for(let s=0,o=t.length;s<o;s++){if(r=t.at(s),r?.[e]===i)return r;if(r?.type==="group"&&(n=ZB(r.layers,e,i),n))return n}}const ODe=t=>{let e=class extends t{constructor(...i){super(...i),this.layers=new ft;const r=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},n=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||ne.getLogger(this).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},s=o=>{o.parent=null,this.layerRemoved(o)};this.addHandles([this.layers.on("before-add",o=>r(o.item)),this.layers.on("after-add",o=>n(o.item)),this.layers.on("after-remove",o=>s(o.item))])}destroy(){const i=this.layers.toArray();for(const r of i)r.destroy();this.layers.destroy()}set layers(i){this._set("layers",vg(i,this._get("layers")))}add(i,r){const n=this.layers;if(r=n.getNextIndex(r),i instanceof Jpe){const s=i;s.parent===this?this.reorder(s,r):n.add(s,r)}else dc(i)?i.then(s=>{this.destroyed||this.add(s,r)}):ne.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(i,r){const n=this.layers;let s=n.getNextIndex(r);i.slice().forEach(o=>{o.parent!==this?(n.add(o,s),s+=1):this.reorder(o,s)})}findLayerById(i){return ZB(this.layers,"id",i)}findLayerByUid(i){return ZB(this.layers,"uid",i)}remove(i){return this.layers.remove(i)}removeMany(i){return this.layers.removeMany(i)}removeAll(){return this.layers.removeAll()}reorder(i,r){return this.layers.reorder(i,r)}layerAdded(i){}layerRemoved(i){}};return h([f()],e.prototype,"layers",null),e=h([z("esri.support.LayersMixin")],e),e};function JB(t,e,i){if(t)for(let r=0,n=t.length;r<n;r++){const s=t.at(r);if(s[e]===i)return s;if(s?.type==="group"){const o=JB(s.tables,e,i);if(o)return o}}}const RDe=t=>{let e=class extends t{constructor(...i){super(...i),this.tables=new ft,this.addHandles([this.tables.on("after-add",r=>{const n=r.item;n.parent&&n.parent!==this&&"tables"in n.parent&&n.parent.tables.remove(n),n.parent=this,n.type!=="feature"&&ne.getLogger(this).error(`Layer 'title:${n.title}, id:${n.id}' of type '${n.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",r=>{r.item.parent=null})])}destroy(){const i=this.tables.toArray();for(const r of i)r.destroy();this.tables.destroy()}set tables(i){this._set("tables",vg(i,this._get("tables")))}findTableById(i){return JB(this.tables,"id",i)}findTableByUid(i){return JB(this.tables,"uid",i)}};return h([f()],e.prototype,"tables",null),e=h([z("esri.support.TablesMixin")],e),e};let Ip=class extends RDe(ODe(Tn.EventedMixin(xe))){constructor(e){super(e),this.allLayers=new J3({getCollections:()=>[this.basemap?.baseLayers,this.ground?.layers,this.layers,this.basemap?.referenceLayers],getChildrenFunction:i=>"layers"in i?i.layers:null}),this.allTables=KLe(this),this.basemap=null,this.editableLayers=new J3({getCollections:()=>[this.allLayers],itemFilterFunction:lLe}),this.ground=new Z3,this._basemapCache=HLe()}destroy(){qLe(this._basemapCache),this._basemapCache=null,this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=Pe(this.basemap),Pe(this.ground),this._set("ground",null)}castBasemap(e){return vq(e,this._basemapCache)}castGround(e){return QLe(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(i=>i.id===e)}findTableById(e){return this.allTables.find(i=>i.id===e)}};h([f({readOnly:!0,dependsOn:[]})],Ip.prototype,"allLayers",void 0),h([f({readOnly:!0})],Ip.prototype,"allTables",void 0),h([f({type:rT,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],Ip.prototype,"basemap",void 0),h([rr("basemap")],Ip.prototype,"castBasemap",null),h([f({readOnly:!0})],Ip.prototype,"editableLayers",void 0),h([f({type:Z3,nonNullable:!0})],Ip.prototype,"ground",void 0),h([rr("ground")],Ip.prototype,"castGround",null),Ip=h([z("esri.Map")],Ip);const Kpe=Ip,mu=t=>{let e=class extends t{clone(){const i=cu(this);d4(i,"unable to clone instance of non-accessor class");const r=i.metadatas,n=i.store,s={},o=new Map;for(const l in r){const c=r[l],u=n?.originOf(l),d=c.clonable;if(c.readOnly||d===!1||u!==gi.USER&&u!==gi.DEFAULTS&&u!==gi.WEB_MAP&&u!==gi.WEB_SCENE)continue;const p=this[l];let m=null;m=typeof d=="function"?d(p):d==="reference"?p:Xz(p),p!=null&&m==null||(u===gi.DEFAULTS?o.set(l,m):s[l]=m)}const a=new(Object.getPrototypeOf(this)).constructor(s);if(o.size){const l=cu(a)?.store;if(l)for(const[c,u]of o)l.set(c,u,gi.DEFAULTS)}return a}};return e=h([z("esri.core.Clonable")],e),e};let PK=class extends mu(xe){};PK=h([z("esri.core.Clonable")],PK);let t_=class{constructor(e,i){this.min=e,this.max=i,this.range=i-e}ndiff(e,i=0){return Math.ceil((e-i)/this.range)*this.range+i}_normalize(e,i,r,n=0,s=!1){return(r-=n)<e?r+=this.ndiff(e-r):r>i&&(r-=this.ndiff(r-i)),s&&r===i&&(r=e),r+n}normalize(e,i=0,r=!1){return this._normalize(this.min,this.max,e,i,r)}clamp(e,i=0){return _e(e-i,this.min,this.max)+i}monotonic(e,i,r){return e<i?i:i+this.ndiff(e-i,r)}minimalMonotonic(e,i,r){return this._normalize(e,e+this.range,i,r)}center(e,i,r){return i=this.monotonic(e,i,r),this.normalize((e+i)/2,r)}diff(e,i,r){return this.monotonic(e,i,r)-e}shortestSignedDiff(e,i){e=this.normalize(e);const r=(i=this.normalize(i))-e,n=i<e?this.minimalMonotonic(e,i)-e:i-this.minimalMonotonic(i,e);return Math.abs(r)<Math.abs(n)?r:n}contains(e,i,r){return i=this.minimalMonotonic(e,i),(r=this.minimalMonotonic(e,r))>e&&r<i}};function Mq(t){for(const e in t){const i=t[e];i instanceof Function&&(t[e]=i.bind(t))}return t}const PDe=Mq(new t_(0,2*Math.PI)),i_=Mq(new t_(-Math.PI,Math.PI)),$q=Mq(new t_(0,360));let Am=class extends mu($e){constructor(...e){super(...e),this.position=new lt([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,i,r,n){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const s={position:e};return i!=null&&(s.heading=i),r!=null&&(s.tilt=r),n!=null&&(s.fov=n),s}return e}writePosition(e,i,r,n){const s=e.clone();s.x=bd(e.x||0),s.y=bd(e.y||0),s.z=e.hasZ?bd(e.z||0):e.z,i[r]=s.write({},n)}readPosition(e,i){const r=new lt;return r.read(e,i),r.x=bd(r.x||0),r.y=bd(r.y||0),r.z=r.hasZ?bd(r.z||0):r.z,r}equals(e){return e!=null&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};h([f({type:lt,json:{write:{isRequired:!0}}})],Am.prototype,"position",void 0),h([di("position")],Am.prototype,"writePosition",null),h([Ni("position")],Am.prototype,"readPosition",null),h([f({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),rr(t=>$q.normalize(bd(t)))],Am.prototype,"heading",void 0),h([f({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),rr(t=>_e(bd(t),-180,180))],Am.prototype,"tilt",void 0),h([f({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Am.prototype,"fov",void 0),Am=h([z("esri.Camera")],Am);const du=Am;var KB;let G0=KB=class extends $e{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new KB({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};function i6(){return{enabled:!this.camera}}h([f({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:i6}}}}})],G0.prototype,"rotation",void 0),h([rr("rotation")],G0.prototype,"castRotation",null),h([f({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:i6}}}}})],G0.prototype,"scale",void 0),h([f({types:Rq,json:{read:Cb,write:!0,origins:{"web-scene":{read:Cb,write:{overridePolicy:i6}}}}})],G0.prototype,"targetGeometry",void 0),h([f({type:du,json:{write:!0}})],G0.prototype,"camera",void 0),G0=KB=h([z("esri.Viewpoint")],G0);const oc=G0;let MDe=class Qpe{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(Qz),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const i=new Qpe,r=this._originStores[gi.DEFAULTS];r&&r.forEach((n,s)=>{i.set(s,ye(n),gi.DEFAULTS)});for(let n=gi.SERVICE;n<Qz;n++){const s=this._originStores[n];s&&s.forEach((o,a)=>{e&&e.has(a)||i.set(a,ye(o),n)})}return i}get(e,i){const r=i===void 0?this._values:this._originStores[i];return r?r.get(e):void 0}keys(e){const i=e==null?this._values:this._originStores[e];return i?[...i.keys()]:[]}set(e,i,r=gi.USER){let n=this._originStores[r];if(n||(n=new Map,this._originStores[r]=n),n.set(e,i),!this._values.has(e)||this._propertyOriginMap.get(e)<=r){const s=this._values.get(e);return this._values.set(e,i),this._propertyOriginMap.set(e,r),s!==i}return!1}delete(e,i=gi.USER){const r=this._originStores[i];if(!r)return;const n=r.get(e);if(r.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===i){this._values.delete(e);for(let s=i-1;s>=0;s--){const o=this._originStores[s];if(o&&o.has(e)){this._values.set(e,o.get(e)),this._propertyOriginMap.set(e,s);break}}}return n}has(e,i){const r=i===void 0?this._values:this._originStores[i];return!!r&&r.has(e)}revert(e,i){for(;i>0&&!this.has(e,i);)--i;const r=this._originStores[i],n=r?.get(e),s=this._values.get(e);return this._values.set(e,n),this._propertyOriginMap.set(e,i),s!==n}originOf(e){return this._propertyOriginMap.get(e)||gi.DEFAULTS}forEach(e){this._values.forEach(e)}};const efe=t=>{let e=class extends t{constructor(...i){super(...i);const r=cu(this),n=r.store,s=new MDe;r.store=s,zhe(r,n,s)}read(i,r){Vhe(this,i,r)}getAtOrigin(i,r){const n=r6(this),s=Oy(r);if(typeof i=="string")return n.get(i,s);const o={};return i.forEach(a=>{o[a]=n.get(a,s)}),o}originOf(i){return fD(this.originIdOf(i))}originIdOf(i){return r6(this).originOf(i)}revert(i,r){const n=r6(this),s=Oy(r),o=cu(this);let a;a=typeof i=="string"?i==="*"?n.keys(s):[i]:i,a.forEach(l=>{o.invalidate(l),n.revert(l,s),o.commit(l)})}};return e=h([z("esri.core.ReadOnlyMultiOriginJSONSupport")],e),e};function r6(t){return cu(t).store}let MK=class extends efe(xe){};MK=h([z("esri.core.ReadOnlyMultiOriginJSONSupport")],MK);const $De=t=>{let e=class extends t{constructor(...i){super(...i)}clear(i,r="user"){return n6(this).delete(i,Oy(r))}write(i,r){return jhe(this,i=i||{},r),i}setAtOrigin(i,r,n){cu(this).setAtOrigin(i,r,Oy(n))}removeOrigin(i){const r=n6(this),n=Oy(i),s=r.keys(n);for(const o of s)r.originOf(o)===n&&r.set(o,r.get(o,n),gi.USER)}updateOrigin(i,r){const n=n6(this),s=Oy(r),o=Ld(this,i);for(let a=s+1;a<Qz;++a)n.delete(i,a);n.set(i,o,s)}toJSON(i){return this.write({},i)}};return e=h([z("esri.core.WriteableMultiOriginJSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function n6(t){return cu(t).store}const tfe=t=>{let e=class extends $De(efe(t)){constructor(...i){super(...i)}};return e=h([z("esri.core.MultiOriginJSONSupport")],e),e};let QB=class extends tfe(xe){};QB=h([z("esri.core.MultiOriginJSONSupport")],QB);function le(t,e,i={}){return Iq(t,e,i,ife)}function ac(t,e,i={}){return Iq(t,e,i,rfe)}function Iq(t,e,i={},r){let n=null;const s=i.once?(o,a)=>{r(o)&&(pr(n),e(o,a))}:(o,a)=>{r(o)&&e(o,a)};if(n=URe(t,s,i.sync,i.equals),i.initial){const o=t();s(o,o)}return n}function Io(t,e,i,r={}){let n=null,s=null,o=null;function a(){n&&s&&(s.remove(),r.onListenerRemove?.(n),n=null,s=null)}function l(u){r.once&&r.once&&pr(o),i(u)}const c=le(t,(u,d)=>{a(),f4(u)&&(n=u,s=sg(u,e,l),r.onListenerAdd?.(u))},{sync:r.sync,initial:!0});return o=Mi(()=>{c.remove(),a()}),o}function Tg(t,e){return IDe(t,rfe,e)}function IDe(t,e,i){if(Hn(i))return Promise.reject(pi());const r=t();if(e?.(r))return Promise.resolve(r);let n=null;function s(){n=pr(n)}return new Promise((o,a)=>{n=db([os(i,()=>{s(),a(pi())}),Iq(t,l=>{s(),o(l)},{sync:!1,once:!0},e??ife)])})}function ife(t){return!0}function rfe(t){return!!t}function LDe(t,e){const i=new ft,r=Io(t,"after-splice",({added:n,start:s,deleteCount:o})=>{const a=i.splice(s,o);for(const l of a)l.remove();if(n?.length){const l=n.map(e);i.addMany(l,s)}},{sync:!0,onListenerRemove:()=>i.drain(n=>n.remove()),onListenerAdd:n=>i.addMany(n.items.map(e))});return i.addHandles(r),i}function tCt(t,e){const i=new ft,r=LDe(t,a=>S_(async l=>{const c=await e(a,l);if(Hn(l))throw c.remove(),pi();return c})),n=()=>null,s=async a=>{const l=await a.promise,c=r.indexOf(a);c<0||i.splice(c,1,l)};i.addMany(r.items.map(n));for(const a of r)B3(s(a));const o=r.on("after-splice",({added:a,start:l,deleteCount:c})=>{const u=i.splice(l,c);for(const d of u)d?.remove();if(a?.length){i.addMany(a.map(n),l);for(const d of a)B3(s(d))}});return i.addHandles([Jue(r),o]),i}const qi={sync:!0},Zi={initial:!0},Yi={sync:!0,initial:!0};function DDe(t){return t&&"getAtOrigin"in t&&"originOf"in t}function $K(t){t?.writtenProperties&&t.writtenProperties.forEach(({target:e,propName:i,newOrigin:r})=>{DDe(e)&&r&&e.originOf(i)!==r&&e.updateOrigin(i,r)})}var vC;const YD=fu()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),nfe=YD.jsonValues.slice();z3(nfe,"orthometric");const HA=fu()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let Yh=vC=class extends $e{constructor(t){super(t),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(t,e,i){return YD.write(t,e,i)}readHeightModel(t,e,i){return YD.read(t)||(i?.messages&&i.messages.push(NDe(t,{context:i})),null)}readHeightUnit(t,e,i){return HA.read(t)||(i?.messages&&i.messages.push(IK(t,{context:i})),null)}readHeightUnitService(t,e,i){return Tde(t)||HA.read(t)||(i?.messages&&i.messages.push(IK(t,{context:i})),null)}readVertCRS(t,e){return e.vertCRS||e.ellipsoid||e.geoid}clone(){return new vC({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(t){return!!t&&(this===t||this.heightModel===t.heightModel&&this.heightUnit===t.heightUnit&&this.vertCRS===t.vertCRS)}static deriveUnitFromSR(t,e){const i=i$e(e);return new vC({heightModel:t.heightModel,heightUnit:i,vertCRS:t.vertCRS})}write(t,e){return e={origin:"web-scene",...e},super.write(t,e)}static fromJSON(t){if(!t)return null;const e=new vC;return e.read(t,{origin:"web-scene"}),e}};function IK(t,e){return new mb("height-unit:unsupported",`Height unit of value '${t}' is not supported`,e)}function NDe(t,e){return new mb("height-model:unsupported",`Height model of value '${t}' is not supported`,e)}h([f({type:YD.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:nfe,default:"ellipsoidal"}}}})],Yh.prototype,"heightModel",void 0),h([di("web-scene","heightModel")],Yh.prototype,"writeHeightModel",null),h([Ni(["web-scene","service"],"heightModel")],Yh.prototype,"readHeightModel",null),h([f({type:HA.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:HA.jsonValues,write:HA.write}}}})],Yh.prototype,"heightUnit",void 0),h([Ni("web-scene","heightUnit")],Yh.prototype,"readHeightUnit",null),h([Ni("service","heightUnit")],Yh.prototype,"readHeightUnitService",null),h([f({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],Yh.prototype,"vertCRS",void 0),h([Ni("service","vertCRS",["vertCRS","ellipsoid","geoid"])],Yh.prototype,"readVertCRS",null),Yh=vC=h([z("esri.geometry.HeightModelInfo")],Yh);const tw=Yh,iCt=Math.PI/180,rCt=/(?:SPHEROID|ELLIPSOID)\[([^\]]+)]/i,o0=yi.radius,Dh=yi.eccentricitySquared,FDe={a1:o0*Dh,a2:o0*Dh*o0*Dh,a3:o0*Dh*Dh/2,a4:o0*Dh*o0*Dh*2.5,a5:o0*Dh+o0*Dh*Dh/2,a6:1-Dh},nCt={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:yi.radius,f:yi.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:wg.radius,f:wg.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:vf.radius,f:vf.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:vf.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};var J;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",t[t.WGS84=2]="WGS84",t[t.WEB_MERCATOR=3]="WEB_MERCATOR",t[t.WGS84_ECEF=4]="WGS84_ECEF",t[t.CGCS2000=5]="CGCS2000",t[t.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",t[t.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",t[t.GCSMARS2000=8]="GCSMARS2000",t[t.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",t[t.GCSMOON2000=10]="GCSMOON2000",t[t.LON_LAT=11]="LON_LAT",t[t.PLATE_CARREE=12]="PLATE_CARREE"})(J||(J={}));const I2={[J.WGS84]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:Or,[J.WGS84_COMPARABLE_LON_LAT]:Or,[J.SPHERICAL_ECEF]:$y,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:zT,[J.PLATE_CARREE]:My,[J.WGS84]:Or,[J.WGS84_ECEF]:Ly},[J.CGCS2000]:{[J.CGCS2000]:Or,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:Or,[J.WGS84_COMPARABLE_LON_LAT]:Or,[J.SPHERICAL_ECEF]:$y,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:My,[J.WGS84]:null,[J.WGS84_ECEF]:Ly},[J.GCSMARS2000]:{[J.CGCS2000]:null,[J.GCSMARS2000]:Or,[J.GCSMOON2000]:null,[J.LON_LAT]:Or,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:t9,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.GCSMOON2000]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:Or,[J.LON_LAT]:Or,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:e9,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.WEB_MERCATOR]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:J1,[J.WGS84_COMPARABLE_LON_LAT]:J1,[J.SPHERICAL_ECEF]:ofe,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:Or,[J.PLATE_CARREE]:lfe,[J.WGS84]:J1,[J.WGS84_ECEF]:afe},[J.WGS84_ECEF]:{[J.CGCS2000]:Dy,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:Dy,[J.WGS84_COMPARABLE_LON_LAT]:Dy,[J.SPHERICAL_ECEF]:hfe,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:dfe,[J.PLATE_CARREE]:kDe,[J.WGS84]:Dy,[J.WGS84_ECEF]:Or},[J.SPHERICAL_ECEF]:{[J.CGCS2000]:Iy,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:Iy,[J.WGS84_COMPARABLE_LON_LAT]:Iy,[J.SPHERICAL_ECEF]:Or,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:cfe,[J.PLATE_CARREE]:UDe,[J.WGS84]:Iy,[J.WGS84_ECEF]:ufe},[J.SPHERICAL_MARS_PCPF]:{[J.CGCS2000]:null,[J.GCSMARS2000]:r9,[J.GCSMOON2000]:null,[J.LON_LAT]:r9,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:Or,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.SPHERICAL_MOON_PCPF]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:i9,[J.LON_LAT]:i9,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:Or,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.UNKNOWN]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:null,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:Or,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.LON_LAT]:{[J.CGCS2000]:Or,[J.GCSMARS2000]:Or,[J.GCSMOON2000]:Or,[J.LON_LAT]:Or,[J.WGS84_COMPARABLE_LON_LAT]:Or,[J.SPHERICAL_ECEF]:$y,[J.SPHERICAL_MARS_PCPF]:t9,[J.SPHERICAL_MOON_PCPF]:e9,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:zT,[J.PLATE_CARREE]:My,[J.WGS84]:Or,[J.WGS84_ECEF]:Ly},[J.WGS84_COMPARABLE_LON_LAT]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:Or,[J.WGS84_COMPARABLE_LON_LAT]:Or,[J.SPHERICAL_ECEF]:$y,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:My,[J.WGS84]:Or,[J.WGS84_ECEF]:Ly},[J.PLATE_CARREE]:{[J.CGCS2000]:k1,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:k1,[J.WGS84_COMPARABLE_LON_LAT]:k1,[J.SPHERICAL_ECEF]:zDe,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:BDe,[J.PLATE_CARREE]:Or,[J.WGS84]:k1,[J.WGS84_ECEF]:VDe}};function sfe(t){const e=K3(t,ffe);return I2[e][J.WGS84_COMPARABLE_LON_LAT]}function Lq(t,e,i=pfe()){return t==null||e==null?null:jDe(t,e,i).projector}function sCt(t,e){switch(Lq(t,e,kq)){case Or:return"copy3";case $y:return"wgs84ToSphericalECEF";case zT:return"wgs84ToWebMercator";case My:return"wgs84ToPlateCarree";case Ly:return"wgs84ToWGS84ECEF";case J1:return"webMercatorToWGS84";case ofe:return"webMercatorToSphericalECEF";case afe:return"webMercatorToWGS84ECEF";case lfe:return"webMercatorToPlateCarree";case Dy:return"wgs84ECEFToWGS84";case hfe:return"wgs84ECEFToSphericalECEF";case dfe:return"wgs84ECEFToWebMercator";case Iy:return"sphericalECEFToWGS84";case cfe:return"sphericalECEFToWebMercator";case r9:return"sphericalMarsPCPFToMars2000";case i9:return"sphericalMoonPCPFToMoon2000";case ufe:return"sphericalECEFToWGS84ECEF";case t9:return"mars2000ToSphericalPCPF";case e9:return"moon2000ToSphericalPCPF";default:return null}}function K3(t,e){return t?e.spatialReference===t?e.spatialReferenceId:(e.spatialReference=t,"metersPerUnit"in e&&(e.metersPerUnit=ua(t,1)),ND(t)?e.spatialReferenceId=J.SPHERICAL_ECEF:W3(t)?e.spatialReferenceId=J.WGS84:yb(t)?e.spatialReferenceId=J.WEB_MERCATOR:ZH(t)?e.spatialReferenceId=J.PLATE_CARREE:t.wkt===bde.wkt?e.spatialReferenceId=J.WGS84_ECEF:t.wkid===ih.CGCS2000?e.spatialReferenceId=J.CGCS2000:t.wkt===w4.wkt?e.spatialReferenceId=J.SPHERICAL_MARS_PCPF:t.wkt===x4.wkt?e.spatialReferenceId=J.SPHERICAL_MOON_PCPF:Vf(t)?e.spatialReferenceId=J.GCSMARS2000:Gf(t)?e.spatialReferenceId=J.GCSMOON2000:e.spatialReferenceId=J.UNKNOWN):J.UNKNOWN}function Or(t,e,i,r){t!==i&&(i[r++]=t[e++],i[r++]=t[e++],i[r]=t[e])}function J1(t,e,i,r){i[r++]=VT*(t[e++]/yi.radius),i[r++]=VT*(Math.PI/2-2*Math.atan(Math.exp(-t[e++]/yi.radius))),i[r]=t[e]}function ofe(t,e,i,r){J1(t,e,i,r),$y(i,r,i,r)}function afe(t,e,i,r){J1(t,e,i,r),Ly(i,r,i,r)}function Dq(t,e,i,r,n){const s=.4999999*Math.PI,o=_e(BT*t[e+1],-s,s),a=Math.sin(o);i[r++]=BT*t[e]*n.radius,i[r++]=n.halfSemiMajorAxis*Math.log((1+a)/(1-a)),i[r]=t[e+2]}function zT(t,e,i,r){Dq(t,e,i,r,yi)}const LK=yi.radius*Math.PI/180,DK=180/(yi.radius*Math.PI);function My(t,e,i,r){i[r]=t[e]*LK,i[r+1]=t[e+1]*LK,i[r+2]=t[e+2]}function k1(t,e,i,r){i[r]=t[e]*DK,i[r+1]=t[e+1]*DK,i[r+2]=t[e+2]}function lfe(t,e,i,r){J1(t,e,i,r),My(i,r,i,r)}function kDe(t,e,i,r){Dy(t,e,i,r),My(i,r,i,r)}function UDe(t,e,i,r){Iy(t,e,i,r),My(i,r,i,r)}function zDe(t,e,i,r){k1(t,e,i,r),$y(i,r,i,r)}function BDe(t,e,i,r){k1(t,e,i,r),zT(i,r,i,r)}function VDe(t,e,i,r){k1(t,e,i,r),Ly(i,r,i,r)}function Nq(t,e,i,r,n){const s=n+t[e+2],o=BT*t[e+1],a=BT*t[e],l=Math.cos(o);i[r++]=Math.cos(a)*l*s,i[r++]=Math.sin(a)*l*s,i[r]=Math.sin(o)*s}function e9(t,e,i,r){Nq(t,e,i,r,wg.radius)}function t9(t,e,i,r){Nq(t,e,i,r,vf.radius)}function $y(t,e,i,r){Nq(t,e,i,r,yi.radius)}function Fq(t,e,i,r,n){const s=t[e],o=t[e+1],a=t[e+2],l=Math.sqrt(s*s+o*o+a*a),c=dh(a/(l===0?1:l)),u=Math.atan2(o,s);i[r++]=VT*u,i[r++]=VT*c,i[r]=l-n}function i9(t,e,i,r){Fq(t,e,i,r,wg.radius)}function r9(t,e,i,r){Fq(t,e,i,r,vf.radius)}function Iy(t,e,i,r){Fq(t,e,i,r,yi.radius)}function cfe(t,e,i,r){Iy(t,e,i,r),zT(i,r,i,r)}function ufe(t,e,i,r){Iy(t,e,i,r),Ly(i,r,i,r)}function GDe(t,e,i,r,n){const s=BT*t[e],o=BT*t[e+1],a=t[e+2],l=Math.sin(o),c=Math.cos(o),u=n.radius/Math.sqrt(1-n.eccentricitySquared*l*l);i[r++]=(u+a)*c*Math.cos(s),i[r++]=(u+a)*c*Math.sin(s),i[r++]=(u*(1-n.eccentricitySquared)+a)*l}function Ly(t,e,i,r){GDe(t,e,i,r,yi)}function Dy(t,e,i,r){const n=FDe,s=t[e],o=t[e+1],a=t[e+2];let l,c,u,d,p,m,y,_,v,w,x,T,S,E,A,P,N,F,D,$,R;l=Math.abs(a),c=s*s+o*o,u=Math.sqrt(c),d=c+a*a,p=Math.sqrt(d),$=Math.atan2(o,s),m=a*a/d,y=c/d,E=n.a2/p,A=n.a3-n.a4/p,y>.3?(_=l/p*(1+y*(n.a1+E+m*A)/p),D=Math.asin(_),w=_*_,v=Math.sqrt(1-w)):(v=u/p*(1-m*(n.a5-E-y*A)/p),D=Math.acos(v),w=1-v*v,_=Math.sqrt(w)),x=1-yi.eccentricitySquared*w,T=yi.radius/Math.sqrt(x),S=n.a6*T,E=u-T*v,A=l-S*_,N=v*E+_*A,P=v*A-_*E,F=P/(S/x+N),D+=F,R=N+P*F/2,a<0&&(D=-D),i[r++]=VT*$,i[r++]=VT*D,i[r]=R}function hfe(t,e,i,r){Dy(t,e,i,r),$y(i,r,i,r)}function dfe(t,e,i,r){Dy(t,e,i,r),zT(i,r,i,r)}function jDe(t,e,i){if(t==null||e==null||i.source.spatialReference===t&&i.dest.spatialReference===e)return i;const r=K3(t,i.source),n=K3(e,i.dest);return r===J.UNKNOWN&&n===J.UNKNOWN?wn(t,e)?i.projector=Or:i.projector=null:i.projector=I2[r][n],i}function pfe(){return{source:{spatialReference:null,spatialReferenceId:J.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:J.UNKNOWN,metersPerUnit:1},projector:Or}}const ffe={spatialReference:null,spatialReferenceId:J.UNKNOWN},HDe={spatialReference:null,spatialReferenceId:J.UNKNOWN},kq=pfe(),BT=Rt(1),VT=za(1);function jr(t,e,i,r,n,s,o=1){const a=Lq(e,n,kq);if(a==null)return!1;if(a===Or){if(t===r&&i===s)return!0;const c=i+3*o;for(let u=i,d=s;u<c;u++,d++)r[d]=t[u];return!0}const l=i+3*o;for(let c=i,u=s;c<l;c+=3,u+=3)a(t,c,r,u);return!0}const oCt=Object.freeze(Object.defineProperty({__proto__:null,projectBuffer:jr},Symbol.toStringTag,{value:"Module"}));function NK(t,e,i,r,n,s){return bP[0]=t,bP[1]=e,bP[2]=i,jr(bP,r,0,n,s,0,1)}const bP=C();let wP=0,s6=class n9{static fromGE(e){const i=new n9;return i._wkt=e.wkt,i._wkid=e.wkid,i._isInverse=e.isInverse,i}constructor(e){this.uid=wP++,e?(this._wkt=e.wkt!=null?e.wkt:null,this._wkid=e.wkid!=null?e.wkid:-1,this._isInverse=e.isInverse!=null&&e.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=wP++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=wP++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=wP++}getInverse(){const e=new n9;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}},XD=class bC{static cacheKey(e,i){return[e.wkid?.toString()??"-1",e.wkt?.toString()??"",e.wkt2?.toString()??"",i.wkid?.toString()??"-1",i.wkt?.toString()??"",i.wkt2?.toString()??""].join()}static fromGE(e){const i=new bC;let r="";for(const n of e.steps){const s=s6.fromGE(n);i.steps.push(s),r+=s.uid.toString()+","}return i._cachedProjection={},i._gtlistentry=null,i._chain=r,i}constructor(e){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,e?.steps)for(const i of e.steps)i instanceof s6?this.steps.push(i):this.steps.push(new s6({wkid:i.wkid,wkt:i.wkt,isInverse:i.isInverse}))}getInverse(){const e=new bC;e.steps=[];for(let i=this.steps.length-1;i>=0;i--){const r=this.steps[i];e.steps.push(r.getInverse())}return e}getGTListEntry(){let e="";for(const i of this.steps)e+=i.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=e),this._gtlistentry}assignCachedGe(e,i,r){this._cachedProjection[bC.cacheKey(e,i)]=r}getCachedGeTransformation(e,i){let r="";for(const s of this.steps)r+=s.uid.toString()+",";r!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=r);const n=this._cachedProjection[bC.cacheKey(e,i)];return n===void 0?null:n}};function qDe(t,e,i){if(e==null||i==null||i.vcsWkid||wn(e,i)||e_(e)||e_(i))return null;const r=FD(e)/FD(i);if(r===1)return null;switch(t){case"point":case"esriGeometryPoint":return n=>WDe(n,r);case"polyline":case"esriGeometryPolyline":return n=>XDe(n,r);case"polygon":case"esriGeometryPolygon":return n=>YDe(n,r);case"multipoint":case"esriGeometryMultipoint":return n=>ZDe(n,r);case"extent":case"esriGeometryEnvelope":return n=>JDe(n,r);default:return null}}function WDe(t,e){t?.z!=null&&(t.z*=e)}function YDe(t,e){if(t)for(const i of t.rings)for(const r of i)r.length>2&&(r[2]*=e)}function XDe(t,e){if(t)for(const i of t.paths)for(const r of i)r.length>2&&(r[2]*=e)}function ZDe(t,e){if(t)for(const i of t.points)i.length>2&&(i[2]*=e)}function JDe(t,e){t&&t.zmin!=null&&t.zmax!=null&&(t.zmin*=e,t.zmax*=e)}let kd=null,r_=null,qA=null,AI={};const Uq=new nR;function hR(){return!!kd&&pde()}function KDe(){return!!hR()||(Ct(Uq),GT(),!1)}function GT(t){return qA==null&&(qA=Promise.all([fde(),pe(()=>import("./geometryEngineBase-2020e3dc.js"),[],import.meta.url).then(e=>e.g),pe(()=>import("./hydrated-1ef0bde6.js"),[],import.meta.url)])),qA.then(([,e,{hydratedAdapter:i}])=>{Et(t),r_=i,kd=e.default,kd._enableProjection(FMe),Uq.notify()})}function Hf(t,e,i=null,r=null){return Array.isArray(t)?t.length===0?[]:s9(r_,t,t[0].spatialReference,e,i,r):s9(r_,[t],t.spatialReference,e,i,r)[0]}function s9(t,e,i,r,n=null,s=null){if(i==null||r==null)return e;if(Hd(i,r,n))return e.map(o=>WA(o,i,r));if(n==null&&ND(i))return e.map(o=>WA(o,i,je.WGS84)).map(o=>Q3(o,r));if(n==null&&ND(r))return e.map(o=>Q3(o,je.WGS84)).map(o=>WA(o,je.WGS84,r));if(n==null){const o=XD.cacheKey(i,r);AI[o]!==void 0?n=AI[o]:((n=gfe(i,r,void 0))==null&&(n=new XD),AI[o]=n)}if(kd==null||t==null)throw new z4;return s!=null?kd._project(t,e,i,r,n,s):kd._project(t,e,i,r,n)}function QDe(t,e){const i=mfe([t],e);return i.pending!=null?{pending:i.pending,geometry:null}:i.geometries!=null?{pending:null,geometry:i.geometries[0]}:{pending:null,geometry:null}}function mfe(t,e){if(!hR()){for(const i of t)if(i!=null&&!wn(i.spatialReference,e)&&ta(i.spatialReference)&&ta(e)&&!Hd(i.spatialReference,e))return Ct(Uq),{pending:GT(),geometries:null}}return{pending:null,geometries:t.map(i=>i==null?null:wn(i.spatialReference,e)?i:ta(i.spatialReference)&&ta(e)?Q3(i,e):null)}}function gfe(t,e,i=null){if(t==null||e==null)return null;if(kd==null||r_==null)throw new z4;const r=kd._getTransformation(r_,t,e,i,i?.spatialReference);return r!==null?XD.fromGE(r):null}function eNe(t,e,i=null){if(kd==null||r_==null)throw new z4;const r=kd._getTransformationBySuitability(r_,t,e,i,i?.spatialReference);if(r!==null){const n=[];for(const s of r)n.push(XD.fromGE(s));return n}return[]}let z4=class extends W{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}};function tNe(){kd=null,r_=null,qA=null,AI={}}const iNe={get loadPromise(){return qA}};function Q3(t,e){try{const i=Hf(t,e);if(i==null)return null;"xmin"in t&&"xmin"in i&&(i.zmin=t.zmin,i.zmax=t.zmax);const r=qDe(i.type,t.spatialReference,e);return r?.(i),i}catch(i){if(!(i instanceof z4))throw i;return null}}async function $f(t,e,i){const r=t.spatialReference;return r!=null&&e!=null&&await zq(r,e,null,i),Q3(t,e)}function Hd(t,e,i){return!i&&(!!wn(t,e)||ta(t)&&ta(e)&&!!Lq(t,e,kq))}async function zq(t,e,i,r){if(hR())return IJ(r);if(Array.isArray(t)){for(const{source:n,dest:s,geographicTransformation:o}of t)if(!Hd(n,s,o))return GT(r)}else if(!Hd(t,e,i))return GT(r);return IJ(r)}function WA(t,e,i){return t?"x"in t?_fe(t,e,new lt,i,0):"xmin"in t?xfe(t,e,new Xi,i,0):"rings"in t?wfe(t,e,new Mf,i,0):"paths"in t?bfe(t,e,new Ad,i,0):"points"in t?vfe(t,e,new IS,i,0):null:null}function yfe(t,e,i=e.spatialReference,r=0){return i!=null&&t.spatialReference!=null&&_fe(t,t.spatialReference,e,i,r)!=null}function _fe(t,e,i,r,n){Ra[0]=t.x,Ra[1]=t.y;const s=t.z;return Ra[2]=s!==void 0?s:n,jr(Ra,e,0,Ra,r,0,1)?(i.x=Ra[0],i.y=Ra[1],i.spatialReference=r,s!==void 0||e_(r)?(i.z=Ra[2],i.hasZ=!0):(i.z=void 0,i.hasZ=!1),t.m===void 0?(i.m=void 0,i.hasM=!1):(i.m=t.m,i.hasM=!0),i):null}function rNe(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&vfe(t,t.spatialReference,e,i,r)!=null}function vfe(t,e,i,r,n){const{points:s,hasZ:o,hasM:a}=t,l=[],c=s.length,u=[];for(const p of s)u.push(p[0],p[1],o?p[2]:n);if(!jr(u,e,0,u,r,0,c))return null;const d=o||e_(r);for(let p=0;p<c;++p){const m=3*p,y=u[m],_=u[m+1];d&&a?l.push([y,_,u[m+2],s[p][3]]):d?l.push([y,_,u[m+2]]):a?l.push([y,_,s[p][2]]):l.push([y,_])}return i.points=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i}function nNe(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&bfe(t,t.spatialReference,e,i,r)!=null}function bfe(t,e,i,r,n){const{paths:s,hasZ:o,hasM:a}=t,l=[];if(!Tfe(s,o??!1,a??!1,e,l,r,n))return null;const c=o||e_(r);return i.paths=l,i.spatialReference=r,i.hasZ=c,i.hasM=a,i}function sNe(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&wfe(t,t.spatialReference,e,i,r)!=null}function wfe(t,e,i,r,n){const{rings:s,hasZ:o,hasM:a}=t,l=[];if(!Tfe(s,o??!1,a??!1,e,l,r,n))return null;const c=o||e_(r);return i.rings=l,i.spatialReference=r,i.hasZ=c,i.hasM=a,i}function oNe(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&xfe(t,t.spatialReference,e,i,r)!=null}function xfe(t,e,i,r,n){const{xmin:s,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:u}=t,d=c?t.zmin:n;if(!NK(s,o,d,e,Ra,r))return null;const p=c||e_(r);i.xmin=Ra[0],i.ymin=Ra[1],p&&(i.zmin=Ra[2]);const m=c?t.zmax:n;return NK(a,l,m,e,Ra,r)?(i.xmax=Ra[0],i.ymax=Ra[1],p&&(i.zmax=Ra[2]),u&&(i.mmin=t.mmin,i.mmax=t.mmax),i.spatialReference=r,i):null}function Tfe(t,e,i,r,n,s,o=0){const a=new Array;for(const u of t)for(const d of u)a.push(d[0],d[1],e?d[2]:o);if(!jr(a,r,0,a,s,0,a.length/3))return!1;let l=0;n.length=0;const c=e||e_(s);for(const u of t){const d=new Array;for(const p of u)c&&i?d.push([a[l++],a[l++],a[l++],p[3]]):c?d.push([a[l++],a[l++],a[l++]]):i?(d.push([a[l++],a[l++],p[2]]),l++):(d.push([a[l++],a[l++]]),l++);n.push(d)}return!0}function n_(t){return t!=null&&sfe(t)!=null}const Ra=C(),lCt=Object.freeze(Object.defineProperty({__proto__:null,canProjectToWGS84ComparableLonLat:n_,canProjectWithoutEngine:Hd,getTransformation:gfe,getTransformations:eNe,initializeProjection:zq,isLoaded:hR,isLoadedOrLoad:KDe,load:GT,project:Hf,projectExtent:oNe,projectMany:s9,projectMultipoint:rNe,projectOrLoad:QDe,projectOrLoadMany:mfe,projectPoint:yfe,projectPolygon:sNe,projectPolyline:nNe,projectWithZConversion:$f,projectWithoutEngine:WA,test:iNe,tryProjectWithZConversion:Q3,unload:tNe},Symbol.toStringTag,{value:"Module"}));function Ab(t,e){const i=e?.url?.path;if(t&&i&&(t=La(t,i,{preserveProtocolRelative:!0}),e.portalItem&&e.readResourcePaths)){const r=NH(t,e.portalItem.itemUrl);r!=null&&aNe.test(r)&&e.readResourcePaths.push(e.portalItem.resourceFromPath(r).path)}return o9(t,e?.portal)}function jT(t,e,i=eO.YES){if(t==null)return t;!Qc(t)&&e?.blockedRelativeUrls&&e.blockedRelativeUrls.push(t);let r=La(t);if(e){const n=e.verifyItemRelativeUrls?.rootPath||e.url?.path;if(n){const s=o9(n,e.portal),o=o9(r,e.portal);r=NH(o,s,s),r!=null&&r!==o&&r!==t&&e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.push(r)}}return r=Efe(r,e?.portal),Qc(r)&&(r=Dd(r)),e?.resources&&e?.portalItem&&!Qc(r)&&!Bf(r)&&i===eO.YES&&e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(r),compress:!1}),r}function Bq(t,e,i){return Ab(t,i)}function Ob(t,e,i,r){const n=jT(t,r);n!==void 0&&(e[i]=n)}const Sfe=/\/items\/([^\/]+)\/resources\/(.*)/,aNe=/^\.\/resources\//;function lNe(t){return(t?.match(Sfe)??null)?.[1]??null}function cNe(t){const e=t?.match(Sfe)??null;if(e==null)return null;const i=e[2],r=i.lastIndexOf("/");if(r===-1){const{path:o,extension:a}=qJ(i);return{prefix:null,filename:o,extension:a}}const{path:n,extension:s}=qJ(i.slice(r+1));return{prefix:i.slice(0,r),filename:n,extension:s}}function Efe(t,e){return e&&!e.isPortal&&e.urlKey&&e.customBaseUrl?yB(t,`${e.urlKey}.${e.customBaseUrl}`,e.portalHostname):t}function o9(t,e){if(!e||e.isPortal||!e.urlKey||!e.customBaseUrl)return t;const i=`${e.urlKey}.${e.customBaseUrl}`,r=IH();return Ul(r,`${r.scheme}://${i}`)?yB(t,e.portalHostname,i):yB(t,i,e.portalHostname)}var eO;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})(eO||(eO={}));const cCt=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return eO},ensureMainOnlineDomain:Efe,fromJSON:Ab,itemIdFromResourceUrl:lNe,prefixAndFilenameFromResourceUrl:cNe,read:Bq,toJSON:jT,write:Ob},Symbol.toStringTag,{value:"Module"})),Cfe={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},Afe=Object.values(Cfe),Ofe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${Afe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),uNe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${Afe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),hNe=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function uCt(t){return!!Ofe.test(t)}function Vq(t){if(t==null)return null;const e=bn(t),i=e?.path.match(Ofe)||e?.path.match(uNe);if(!i)return null;const[,r,n,s,o]=i,a=n.indexOf("/");return{title:Rfe(a!==-1?n.slice(a+1):n),serverType:Cfe[s.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:r}}}function dNe(t){const e=bn(t).path.match(hNe);return e?{serviceUrl:e[1],sublayerId:Number(e[2])}:null}function Rfe(t){return(t=t.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+t.slice(1)}function hCt(t,e){const i=[];if(t){const r=Vq(t);r!=null&&r.title&&i.push(r.title)}if(e){const r=Rfe(e);i.push(r)}if(i.length===2){if(i[0].toLowerCase().includes(i[1].toLowerCase()))return i[0];if(i[1].toLowerCase().includes(i[0].toLowerCase()))return i[1]}return i.join(" - ")}function dCt(t){if(!t)return!1;const e=".arcgis.com/",i="//services",r="//tiles",n="//features",s=(t=t.toLowerCase()).includes(e),o=t.includes(i)||t.includes(r)||t.includes(n);return s&&o}function pCt(t,e){return t&&Khe(ede(t,e))}function fCt(t){let{url:e}=t;if(!e)return{url:e};e=ede(e,t.logger);const i=bn(e),r=Vq(i.path);let n;if(r!=null)r.sublayer!=null&&t.layer.layerId==null&&(n=r.sublayer),e=r.url.path;else if(t.nonStandardUrlAllowed){const s=dNe(i.path);s!=null&&(e=s.serviceUrl,n=s.sublayerId)}return{url:Khe(e),layerId:n}}function mCt(t,e,i,r,n){Ob(e,r,"url",n),r.url&&t.layerId!=null&&(r.url=zf(r.url,i,t.layerId.toString()))}function gCt(t){if(!t)return!1;const e=t.toLowerCase(),i=e.includes("/services/"),r=e.includes("/mapserver/wmsserver"),n=e.includes("/imageserver/wmsserver"),s=e.includes("/wmsserver");return i&&(r||n||s)}function pNe(t,e){if(!t)return null;if(!a9(t))return new W("webscene:unsupported-height-model-info","The vertical coordinate system of the scene is not supported",{heightModelInfo:t});const i=t.heightUnit,r=tw.deriveUnitFromSR(t,e).heightUnit;return i!==r?new W("webscene:incompatible-height-unit",`The vertical units of the scene (${i}) must match the horizontal units of the scene (${r})`,{verticalUnit:i,horizontalUnit:r}):null}function yCt(t,e,i){const r=Pfe(t),n=e,s=fNe(r,n,i);if(r){const o=tw.deriveUnitFromSR(r,t.spatialReference).heightUnit;if(!i&&o!==r.heightUnit){const a=new W("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new W("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r,error:a})}}if(!mNe(t)||s===Bl.Unsupported)return new W("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r});switch(s){case Bl.Units:{const o=r?.heightUnit||"unknown",a=n?.heightUnit||"unknown",l=new W("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new W("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:n,error:l})}case Bl.HeightModel:{const o=r?.heightModel||"unknown",a=n?.heightModel||"unknown",l=new W("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new W("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:n,error:l})}case Bl.CRS:{const o=r?.vertCRS||"unknown",a=n?.vertCRS||"unknown",l=new W("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new W("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:n,error:l})}}return null}function fNe(t,e,i){if(!a9(t)||!a9(e))return Bl.Unsupported;if(t==null||e==null)return Bl.Ok;if(!i&&t.heightUnit!==e.heightUnit)return Bl.Units;if(t.heightModel!==e.heightModel)return Bl.HeightModel;switch(t.heightModel){case"gravity-related-height":return Bl.Ok;case"ellipsoidal":return t.vertCRS===e.vertCRS?Bl.Ok:Bl.CRS;default:return Bl.Unsupported}}var Bl;function a9(t){return t==null||t.heightModel!=null&&t.heightUnit!=null}function mNe(t){return"heightModelInfo"in t&&t.heightModelInfo!=null||t.spatialReference!=null||!Ife(t)}function Pfe(t){const e=t.url?Vq(t.url):void 0;return!(t.spatialReference?.vcsWkid==null&&e!=null&&e.serverType==="ImageServer")&&Mfe(t)&&t.heightModelInfo?t.heightModelInfo:Ife(t)?tw.deriveUnitFromSR(yNe,t.spatialReference):null}function Mfe(t){return"heightModelInfo"in t}function $fe(t){if(t.type==="unknown"||!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function Ife(t){return $fe(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):Lfe(t)}function gNe(t){return t.layers!=null||Lfe(t)||$fe(t)||Mfe(t)}function Lfe(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(t){t[t.Ok=0]="Ok",t[t.Units=1]="Units",t[t.HeightModel=2]="HeightModel",t[t.CRS=3]="CRS",t[t.Unsupported=4]="Unsupported"})(Bl||(Bl={}));const yNe=new tw({heightModel:"gravity-related-height"});async function _Ne(t){const e=t.spatialReference;if(e.isWGS84)return t.clone();if(e.isWebMercator)return $2(t);const i=je.WGS84;return await zq(e,i),Hf(t,i)}function vNe(t,e){if(!Dfe(t,e)){const i=t.typeKeywords;i?i.push(e):t.typeKeywords=[e]}}function Dfe(t,e){return!!t.typeKeywords?.includes(e)}function _Ct(t){return Dfe(t,l9.HOSTED_SERVICE)}function bNe(t,e){const i=t.typeKeywords;if(i){const r=i.indexOf(e);r>-1&&i.splice(r,1)}}function FK(t,e,i){i?vNe(t,e):bNe(t,e)}async function vCt(t){const e=t.clone().normalize();let i;if(e.length>1)for(const r of e)i?r.width>i.width&&(i=r):i=r;else i=e[0];return _Ne(i)}const l9={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service",LOCAL_SCENE:"ViewingMode-Local",TILED_IMAGERY:"Tiled Imagery",GROUP_LAYER_MAP:"Map"};function bCt(t){const{portal:e,isOrgItem:i,itemControl:r}=t,n=e.user?.privileges;let s=!n||n.includes("features:user:edit"),o=!!i&&!!n?.includes("features:user:fullEdit");const a=r==="update"||r==="admin";return a?o=s=!0:o&&(s=!0),{features:{edit:s,fullEdit:o},content:{updateItem:a}}}let j0=class extends $e{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};h([f({type:String,json:{write:!0}})],j0.prototype,"facilityIdField",void 0),h([f({type:String,json:{write:!0}})],j0.prototype,"layerId",void 0),h([f({type:String,json:{write:!0}})],j0.prototype,"nameField",void 0),h([f({type:String,json:{write:!0}})],j0.prototype,"siteIdField",void 0),h([f({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],j0.prototype,"sublayerId",void 0),j0=h([z("esri.layers.support.FacilityLayerInfo")],j0);const wNe=j0;let Xh=class extends $e{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.levelIdField=null,this.levelNumberField=null,this.longNameField=null,this.shortNameField=null,this.sublayerId=null,this.verticalOrderField=null}};h([f({type:String,json:{write:!0}})],Xh.prototype,"facilityIdField",void 0),h([f({type:String,json:{write:!0}})],Xh.prototype,"layerId",void 0),h([f({type:String,json:{write:!0}})],Xh.prototype,"levelIdField",void 0),h([f({type:String,json:{write:!0}})],Xh.prototype,"levelNumberField",void 0),h([f({type:String,json:{write:!0}})],Xh.prototype,"longNameField",void 0),h([f({type:String,json:{write:!0}})],Xh.prototype,"shortNameField",void 0),h([f({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],Xh.prototype,"sublayerId",void 0),h([f({type:String,json:{write:!0}})],Xh.prototype,"verticalOrderField",void 0),Xh=h([z("esri.layers.support.LevelLayerInfo")],Xh);const xNe=Xh;let Lv=class extends $e{constructor(e){super(e),this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};h([f({type:String,json:{write:!0}})],Lv.prototype,"layerId",void 0),h([f({type:String,json:{write:!0}})],Lv.prototype,"nameField",void 0),h([f({type:String,json:{write:!0}})],Lv.prototype,"siteIdField",void 0),h([f({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],Lv.prototype,"sublayerId",void 0),Lv=h([z("esri.layers.support.SiteLayerInfo")],Lv);const TNe=Lv;let jx=class extends $e{constructor(e){super(e),this.levelLayer=null,this.facilityLayer=null,this.siteLayer=null}};h([f({type:xNe,json:{write:!0}})],jx.prototype,"levelLayer",void 0),h([f({type:wNe,json:{write:!0}})],jx.prototype,"facilityLayer",void 0),h([f({type:TNe,json:{write:!0}})],jx.prototype,"siteLayer",void 0),jx=h([z("esri.support.MapFloorInfo")],jx);const SNe=jx,ENe=Symbol("WebScene"),CNe="webscene:failed-to-copy-embedded-resources",ANe="webscene:schema-validation";function ONe(){return new W(CNe,"Copying of embedded resources is currently not supported")}function RNe(t){return new W(ANe,"Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:t})}var Me;function kK(t){return t==="global"?Me.Global:Me.Local}function o6(t){return t===Me.Global?"global":"local"}(function(t){t[t.Global=1]="Global",t[t.Local=2]="Local"})(Me||(Me={}));function tO(t,e){return t!=null&&(e==null||(e===Me.Local?!t.isGeographic||t.isWGS84||t.wkid===ih.CGCS2000:t.isWebMercator||t.isWGS84||t.wkid===ih.CGCS2000||t.wkid===ih.GCSMARS2000||t.wkid===ih.GCSMARS2000_SPHERE||t.wkid===ih.GCSMOON2000))}var L2;(function(t){t[t.SAVE=0]="SAVE",t[t.SAVE_AS=1]="SAVE_AS"})(L2||(L2={}));function UK(t){if(Oi.apiKey&&VH(t.portal.url))throw new W("save-api-key-utils:api-key-not-supported",`Saving is not supported on ${t.portal.url} when using an api key`)}const PNe="randomUUID"in crypto;function Gq(){if(PNe)return crypto.randomUUID();const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=i=>t[i].toString(16).padStart(4,"0");return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}function ECt(){return`{${Gq()}}`}async function MNe(t,e={},i){await t.load(i);const r=zf(t.itemUrl,"resources"),{start:n=1,num:s=10,sortOrder:o="asc",sortField:a="created"}=e,l={query:{start:n,num:s,sortOrder:o,sortField:a,token:t.apiKey},signal:i?.signal},c=await t.portal.request(r,l);return{total:c.total,nextStart:c.nextStart,resources:c.resources.map(({created:u,size:d,resource:p})=>({created:new Date(u),size:d,resource:t.resourceFromPath(p)}))}}async function $Ne(t,e,i,r){if(!t.hasPath())throw new W(`portal-item-resource-${e}:invalid-path`,"Resource does not have a valid path");const n=t.portalItem;await n.load(r);const s=zf(n.userItemUrl,e==="add"?"addResources":"updateResources"),[o,a]=Nfe(t.path),l=new FormData;return o&&o!=="."&&l.append("resourcesPrefix",o),r!=null&&r.compress&&l.append("compress","true"),l.append("fileName",a),l.append("file",i,a),l.append("f","json"),r?.access&&l.append("access",r.access),await n.portal.request(s,{method:"post",body:l,signal:r?.signal}),t}async function INe(t,e,i){if(!e.hasPath())throw new W("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await t.load(i);const r=zf(t.userItemUrl,"removeResources");await t.portal.request(r,{method:"post",query:{resource:e.path},signal:i?.signal}),e.portalItem=null}async function LNe(t,e){await t.load(e);const i=zf(t.userItemUrl,"removeResources");return t.portal.request(i,{method:"post",query:{deleteAll:!0},signal:e?.signal})}function Nfe(t){const e=t.lastIndexOf("/");return e===-1?[".",t]:[t.slice(0,e),t.slice(e+1)]}function jq(t){const[e,i]=DNe(t),[r,n]=Nfe(e);return[r,n,i]}function DNe(t){const e=tMe(t);return e==null?[t,""]:[t.slice(0,t.length-e.length-1),`.${e}`]}async function Hq(t){return t.type==="blob"?t.blob:t.type==="json"?new Blob([t.jsonString],{type:"application/json"}):(await Ii(t.url,{responseType:"blob"})).data}function NNe(t,e){if(!t.hasPath())return null;const[i,,r]=jq(t.path);return t.portalItem.resourceFromPath(zf(i,e+r))}function Ffe(t,e){if(!t.hasPath())return null;const[i,,r]=jq(t.path);return t.portalItem.resourceFromPath(zf(i,e+r))}const wC=Object.freeze(Object.defineProperty({__proto__:null,addOrUpdateResource:$Ne,contentToBlob:Hq,fetchResources:MNe,getSiblingOfSameType:NNe,getSiblingOfSameTypeI:Ffe,removeAllResources:LNe,removeResource:INe,splitPrefixFileNameAndExtension:jq},Symbol.toStringTag,{value:"Module"}));async function FNe(t,e,i=null){const r=await kfe(t,e,i);await Ufe(r,e,i)}async function kNe(t,e,i,r,n=null){const s=await kfe(i,r,n);await t.update({data:e}),await Ufe(s,r,n)}async function kfe(t,e,i=null){if(!e?.resources)return;const r=e.portalItem===t.portalItem?new Set(t.paths):new Set;t.paths.length=0,t.portalItem=e.portalItem;const n=new Set(e.resources.toKeep.map(l=>l.resource.path)),s=new Set,o=[];n.forEach(l=>{r.delete(l),t.paths.push(l)});for(const l of e.resources.toUpdate)if(r.delete(l.resource.path),n.has(l.resource.path)||s.has(l.resource.path)){const{resource:c,content:u,finish:d,error:p}=l,m=Ffe(c,Gq());t.paths.push(m.path),o.push(zK({resource:m,content:u,compress:l.compress,finish:d,error:p},i))}else t.paths.push(l.resource.path),o.push(UNe(l,i)),s.add(l.resource.path);for(const l of e.resources.toAdd)t.paths.push(l.resource.path),r.has(l.resource.path)?r.delete(l.resource.path):o.push(zK(l,i));if(o.length===0)return r;const a=await gRe(o);if(Et(i),a.length>0)throw new W("save:resources","Failed to save one or more resources",{errors:a});return r}async function Ufe(t,e,i=null){if(!t||!e.portalItem)return;const r=[];for(const n of t){const s=e.portalItem.resourceFromPath(n);r.push(s.portalItem.removeResource(s,i))}await tR(r)}async function zK(t,e){const i={...e??{},compress:t.compress},r=await hh(t.resource.portalItem.addResource(t.resource,await Hq(t.content),i));if(r.ok!==!0)throw t.error?.(r.error),r.error;t.finish?.(t.resource)}async function UNe(t,e){const i=await hh(t.resource.update(await Hq(t.content),e));if(i.ok!==!0)throw t.error?.(i.error),i.error;t.finish?.(t.resource)}async function CCt(t){const e=[];for(const i of t.allLayers)if("beforeSave"in i&&typeof i.beforeSave=="function"){const r=i.beforeSave();r&&e.push(r)}await Promise.allSettled(e)}const zNe={width:600,height:400},xP=1.5;function BNe(t,e){e=e||zNe;let{width:i,height:r}=e;const n=i/r;return n<xP?r=i/xP:n>xP&&(i=r*xP),i>t.width&&(r*=t.width/i,i=t.width),r>t.height&&(i*=t.height/r,r=t.height),{width:Math.round(i),height:Math.round(r)}}function BK(t){return{enabled:!!t?.length}}const qq=new uu({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"});var c9;let Hx=c9=class extends $e{constructor(t){super(t),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new c9({exactMatch:this.exactMatch,type:this.type,name:this.name})}};h([f({type:Boolean,json:{write:!0}})],Hx.prototype,"exactMatch",void 0),h([f({type:String,json:{write:!0}})],Hx.prototype,"name",void 0),h([Ut(qq)],Hx.prototype,"type",void 0),Hx=c9=h([z("esri.webdoc.applicationProperties.SearchLayerField")],Hx);const VNe=Hx;var u9;let qx=u9=class extends $e{constructor(t){super(t),this.field=null,this.id=null,this.subLayer=null}clone(){return new u9(ye({field:this.field,id:this.id,subLayer:this.subLayer}))}};h([f({type:VNe,json:{write:{isRequired:!0}}})],qx.prototype,"field",void 0),h([f({type:String,json:{write:{isRequired:!0}}})],qx.prototype,"id",void 0),h([f({type:Ln,json:{write:!0}})],qx.prototype,"subLayer",void 0),qx=u9=h([z("esri.webdoc.applicationProperties.SearchLayer")],qx);const GNe=qx;var h9;let Wx=h9=class extends $e{constructor(t){super(t),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new h9({exactMatch:this.exactMatch,type:this.type,name:this.name})}};h([f({type:Boolean,json:{write:!0}})],Wx.prototype,"exactMatch",void 0),h([f({type:String,json:{write:!0}})],Wx.prototype,"name",void 0),h([Ut(qq)],Wx.prototype,"type",void 0),Wx=h9=h([z("esri.webdoc.applicationProperties.SearchTableField")],Wx);const jNe=Wx;var d9;let xC=d9=class extends $e{constructor(t){super(t),this.field=null,this.id=null}clone(){return new d9(ye({field:this.field,id:this.id}))}};h([f({type:jNe,json:{write:{isRequired:!0}}})],xC.prototype,"field",void 0),h([f({type:String,json:{write:{isRequired:!0}}})],xC.prototype,"id",void 0),xC=d9=h([z("esri.webdoc.applicationProperties.SearchTable")],xC);const HNe=xC;var p9;const zfe=ft.ofType(GNe),Bfe=ft.ofType(HNe);let Lp=p9=class extends $e{constructor(t){super(t),this.addressSearchEnabled=!0,this.enabled=!0,this.hintText=null,this.layers=new zfe,this.tables=new Bfe}readAddressSearchEnabled(t){return!t}writeAddressSearchEnabled(t,e,i){e[i]=!t}clone(){return new p9(ye({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,tables:this.tables}))}};h([f({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],Lp.prototype,"addressSearchEnabled",void 0),h([Ni("addressSearchEnabled")],Lp.prototype,"readAddressSearchEnabled",null),h([di("addressSearchEnabled")],Lp.prototype,"writeAddressSearchEnabled",null),h([f({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],Lp.prototype,"enabled",void 0),h([f({type:String,json:{write:!0}})],Lp.prototype,"hintText",void 0),h([f({type:zfe,json:{write:{overridePolicy:BK},origins:{"web-scene":{write:{isRequired:!0}}}}})],Lp.prototype,"layers",void 0),h([f({type:Bfe,json:{read:!0,write:{overridePolicy:BK}}})],Lp.prototype,"tables",void 0),Lp=p9=h([z("esri.webdoc.applicationProperties.Search")],Lp);const qNe=Lp;var f9;let OI=f9=class extends $e{constructor(t){super(t),this.search=null}clone(){return new f9(ye({search:this.search}))}};h([f({type:qNe,json:{write:!0}})],OI.prototype,"search",void 0),OI=f9=h([z("esri.webdoc.applicationProperties.Viewing")],OI);const WNe=OI;var m9;let RI=m9=class extends $e{constructor(t){super(t),this.viewing=null}clone(){return new m9({viewing:this.viewing?this.viewing.clone():null})}};h([f({type:WNe,json:{write:!0}})],RI.prototype,"viewing",void 0),RI=m9=h([z("esri.webscene.ApplicationProperties")],RI);const YNe=RI;var g9;let TC=g9=class extends $e{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new g9({cloudCover:this.cloudCover})}};h([Ut({sunny:"sunny"})],TC.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],TC.prototype,"cloudCover",void 0),TC=g9=h([z("esri.views.3d.environment.SunnyWeather")],TC);const ZD=TC;var y9;let SC=y9=class extends $e{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new y9({cloudCover:this.cloudCover})}};h([Ut({cloudy:"cloudy"})],SC.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],SC.prototype,"cloudCover",void 0),SC=y9=h([z("esri.views.3d.environment.CloudyWeather")],SC);const XNe=SC;var _9;let EC=_9=class extends $e{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new _9({fogStrength:this.fogStrength})}};h([Ut({foggy:"foggy"})],EC.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],EC.prototype,"fogStrength",void 0),EC=_9=h([z("esri.views.3d.environment.FoggyWeather")],EC);const ZNe=EC;var v9;let Yx=v9=class extends $e{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new v9({cloudCover:this.cloudCover,precipitation:this.precipitation})}};h([Ut({rainy:"rainy"})],Yx.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Yx.prototype,"cloudCover",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Yx.prototype,"precipitation",void 0),Yx=v9=h([z("esri.views.3d.environment.RainyWeather")],Yx);const JNe=Yx;var b9;let Dv=b9=class extends $e{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new b9({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};h([Ut({snowy:"snowy"})],Dv.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Dv.prototype,"cloudCover",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Dv.prototype,"precipitation",void 0),h([f({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],Dv.prototype,"snowCover",void 0),Dv=b9=h([z("esri.views.3d.environment.SnowyWeather")],Dv);const KNe=Dv,Wq={key:"type",base:ZD,typeMap:{sunny:ZD,cloudy:XNe,rainy:JNe,snowy:KNe,foggy:ZNe}},QNe=Object.keys(Wq.typeMap);function e5e(t,e){return!!QNe.includes(t)||(e.error(`"${t}" is not a valid weather type`),!1)}const Wm=1e4,t5e=1e5;var w9;let Iu=w9=class extends $e{constructor(t){super(t),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(t,e){return e.datetime!=null&&new Date(e.datetime)||null}writeDate(t,e,i){e[i]=t.getTime()}readDirectShadowsEnabled(t,e){return!!e.directShadows}writedirectShadowsEnabled(t,e,i){t&&(e[i]=t)}writeDisplayUTCOffset(t,e){t!=null&&(e.displayUTCOffset=t)}clone(){return new w9(this.cloneConstructProperties())}cloneConstructProperties(){const t={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(t.date=new Date(this.date.getTime())),t}};h([f({readOnly:!0,type:["sun"],json:{write:!0}})],Iu.prototype,"type",void 0),h([f({type:Date,json:{type:Number,write:{target:"datetime"}}})],Iu.prototype,"date",void 0),h([Ni("date",["datetime"])],Iu.prototype,"readDate",null),h([di("date")],Iu.prototype,"writeDate",null),h([f({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],Iu.prototype,"directShadowsEnabled",void 0),h([Ni("directShadowsEnabled",["directShadows"])],Iu.prototype,"readDirectShadowsEnabled",null),h([di("directShadowsEnabled")],Iu.prototype,"writedirectShadowsEnabled",null),h([f({type:Number,json:{write:!0}})],Iu.prototype,"displayUTCOffset",void 0),h([di("displayUTCOffset")],Iu.prototype,"writeDisplayUTCOffset",null),Iu=w9=h([z("esri.webscene.SunLighting")],Iu);const Rb=Iu;var x9;let CC=x9=class extends $e{constructor(t){super(t),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new x9(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};h([f({readOnly:!0,type:["virtual"],json:{write:!0}})],CC.prototype,"type",void 0),h([f({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],CC.prototype,"directShadowsEnabled",void 0),CC=x9=h([z("esri.webscene.VirtualLighting")],CC);const dR=CC,Vfe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:Rb,virtual:dR}};let PI=class extends $e{constructor(e){super(e)}clone(){}};h([f({readOnly:!0,json:{read:!1}})],PI.prototype,"type",void 0),PI=h([z("esri.webscene.background.Background")],PI);const Gfe=PI;function i5e(t,e){const i=e.transparency!=null?fq(e.transparency):1,r=e.color;return r&&Array.isArray(r)?new Ye([r[0]||0,r[1]||0,r[2]||0,i]):null}function r5e(t,e){e.color=t.toJSON().slice(0,3);const i=pq(t.a);i!==0&&(e.transparency=i)}const Fg={type:Ye,json:{type:[Ln],default:null,read:{source:["color","transparency"],reader:i5e},write:{target:{color:{type:[Ln]},transparency:{type:Ln}},writer:r5e}}},If={type:Number,cast:Bn,json:{write:!0}};var T9;const n5e={...Fg,nonNullable:!0};let AC=T9=class extends Gfe{constructor(t){super(t),this.type="color",this.color=new Ye([0,0,0,1])}clone(){return new T9(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};h([Ut({color:"color"},{readOnly:!0})],AC.prototype,"type",void 0),h([f(n5e)],AC.prototype,"color",void 0),AC=T9=h([z("esri.webscene.background.ColorBackground")],AC);const jfe=AC,VK={base:Gfe,key:"type",typeMap:{color:jfe}};function s5e(t){return(e,i,r)=>{if(!e)return e;for(const n in t.typeMap)if(e.type===n){const s=new t.typeMap[n];return s.read(e,r),s}}}const o5e={types:VK,json:{read:s5e(VK),write:{overridePolicy:(t,e,i)=>({enabled:!i||!i.isPresentation})}}};var S9;const Hfe="esri.webscene.Environment",a5e=ne.getLogger(Hfe),GK=(t,e,i)=>({enabled:!i||!i.isPresentation});let H0=S9=class extends $e{constructor(t){super(t),this.lighting=new Rb,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(t){e5e(t?.type,a5e)&&this._set("weather",t)}clone(){return new S9(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?dR.prototype.clone.call(this.lighting):Rb.prototype.clone.call(this.lighting),background:ye(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};h([f({types:Vfe,nonNullable:!0,json:{write:!0}})],H0.prototype,"lighting",void 0),h([f(o5e)],H0.prototype,"background",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:GK}}})],H0.prototype,"atmosphereEnabled",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:GK}}})],H0.prototype,"starsEnabled",void 0),h([f({types:Wq,nonNullable:!0,json:{write:!0},value:new ZD})],H0.prototype,"weather",null),H0=S9=h([z(Hfe)],H0);const HT=H0;var E9;let Nv=E9=class extends $e{constructor(t){super(t),this.environment=new HT,this.spatialReference=null,this.viewpoint=null}set viewingMode(t){this._set("viewingMode",t)}clone(){return new E9({environment:this.environment.clone(),spatialReference:this.spatialReference?this.spatialReference.clone():null,viewingMode:this.viewingMode,viewpoint:this.viewpoint?this.viewpoint.clone():null})}};h([f({type:HT,json:{write:{isRequired:!0}}})],Nv.prototype,"environment",void 0),h([f({type:je})],Nv.prototype,"spatialReference",void 0),h([f({type:["local","global"]})],Nv.prototype,"viewingMode",null),h([f({type:oc,json:{write:{isRequired:!0}}})],Nv.prototype,"viewpoint",void 0),Nv=E9=h([z("esri.webscene.InitialViewProperties")],Nv);const JD=Nv;let l5e=class{constructor(e,i){this._observable=new nR,this._value=e,this._equalityFunction=i}get value(){return Ct(this._observable),this._value}set value(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}mutate(e){e(this._value),this._observable.notify()}};function qT(t,e=Gue){return new l5e(t,e)}let c5e=class{constructor(){this._tasks=new Array,this._running=qT(!1)}get length(){return this._tasks.length}get running(){return this._running.value}destroy(){this.cancelAll()}runTask(e){for(;!e.done&&this._process(e);)e.madeProgress()}push(e,i,r){return this._running.value=!0,new Promise((n,s)=>this._tasks.push(new jK(n,s,e,i,r)))}unshift(e,i,r){return this._running.value=!0,new Promise((n,s)=>this._tasks.unshift(new jK(n,s,e,i,r)))}_process(e){if(this._tasks.length===0)return!1;const i=this._tasks.shift();try{const r=Hn(i.signal);if(r&&!i.abortCallback)i.reject(pi());else{const n=r?i.abortCallback?.(pi()):i.callback(e);dc(n)?n.then(i.resolve,i.reject):i.resolve(n)}}catch(r){i.reject(r)}return this._running.value=this._tasks.length>0,!0}cancelAll(){const e=pi();for(const i of this._tasks)if(i.abortCallback){const r=i.abortCallback(e);i.resolve(r)}else i.reject(e);this._tasks.length=0,this._running.value=!1}},jK=class{constructor(e,i,r,n=void 0,s=void 0){this.resolve=e,this.reject=i,this.callback=r,this.signal=n,this.abortCallback=s}},OC=class extends xe{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};h([f()],OC.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),h([f()],OC.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),OC=h([z("esri.views.support.DebugFlags")],OC);const u5e=new OC;var Si;(function(t){t[t.ANIMATING=0]="ANIMATING",t[t.INTERACTING=1]="INTERACTING",t[t.IDLE=2]="IDLE"})(Si||(Si={}));function h5e(){return new KD.Scheduler}var Lo,ut;(function(t){t[t.YIELD=1]="YIELD"})(Lo||(Lo={})),function(t){t.RESOURCE_CONTROLLER_IMMEDIATE="immediate",t.RESOURCE_CONTROLLER="schedule",t.SLIDE="slide",t.STREAM_DATA_LOADER="stream loader",t.ELEVATION_QUERY="elevation query",t.TERRAIN_SURFACE="terrain",t.SURFACE_GEOMETRY_UPDATES="surface geometry updates",t.LOD_RENDERER="LoD renderer",t.GRAPHICS_CORE="Graphics3D",t.I3S_CONTROLLER="I3S",t.POINT_CLOUD_LAYER="point cloud",t.FEATURE_TILE_FETCHER="feature fetcher",t.OVERLAY="overlay",t.STAGE="stage",t.GRAPHICS_DECONFLICTOR="graphics deconflictor",t.FILTER_VISIBILITY="Graphics3D filter visibility",t.SCALE_VISIBILITY="Graphics3D scale visibility",t.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",t.POINT_OF_INTEREST_FREQUENT="POI frequent",t.POINT_OF_INTEREST_INFREQUENT="POI infrequent",t.LABELER="labeler",t.FEATURE_QUERY_ENGINE="feature query",t.FEATURE_TILE_TREE="feature tile tree",t.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",t.ELEVATION_ALIGNMENT="elevation alignment",t.TEXT_TEXTURE_ATLAS="text texture atlas",t.TEXTURE_UNLOAD="texture unload",t.LINE_OF_SIGHT_TOOL="line of sight tool",t.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",t.ELEVATION_PROFILE="elevation profile",t.SNAPPING="snapping",t.SHADOW_ACCUMULATOR="shadow accumulator",t.CLOUDS_GENERATOR="clouds generator",t[t.NONE=0]="NONE",t[t.TEST_PRIO=1]="TEST_PRIO"}(ut||(ut={}));const nf=0,HK=new Map([[ut.RESOURCE_CONTROLLER_IMMEDIATE,nf],[ut.RESOURCE_CONTROLLER,4],[ut.SLIDE,nf],[ut.STREAM_DATA_LOADER,nf],[ut.ELEVATION_QUERY,nf],[ut.TERRAIN_SURFACE,1],[ut.SURFACE_GEOMETRY_UPDATES,1],[ut.LOD_RENDERER,2],[ut.GRAPHICS_CORE,2],[ut.I3S_CONTROLLER,2],[ut.POINT_CLOUD_LAYER,2],[ut.FEATURE_TILE_FETCHER,2],[ut.OVERLAY,4],[ut.STAGE,4],[ut.GRAPHICS_DECONFLICTOR,4],[ut.FILTER_VISIBILITY,4],[ut.SCALE_VISIBILITY,4],[ut.FRUSTUM_VISIBILITY,4],[ut.CLOUDS_GENERATOR,4],[ut.POINT_OF_INTEREST_FREQUENT,6],[ut.POINT_OF_INTEREST_INFREQUENT,30],[ut.LABELER,8],[ut.FEATURE_QUERY_ENGINE,8],[ut.FEATURE_TILE_TREE,16],[ut.FEATURE_TILE_TREE_ACTIVE,nf],[ut.ELEVATION_ALIGNMENT,12],[ut.TEXT_TEXTURE_ATLAS,12],[ut.TEXTURE_UNLOAD,12],[ut.LINE_OF_SIGHT_TOOL,16],[ut.LINE_OF_SIGHT_TOOL_INTERACTIVE,nf],[ut.SNAPPING,nf],[ut.SHADOW_ACCUMULATOR,30]]);function qK(t){return HK.has(t)?HK.get(t):typeof t=="number"?t:1}const WK=6.5,YK=1,d5e=30,XK=1e3/30,ZK=100,JK=.9;var KD,q_;(function(t){class e{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(s=>s.needsUpdate)}constructor(){this._updating=qT(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new Qm("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new r,this._state=Si.INTERACTING,this._tasks=new It,this._runQueue=new It,this._load=0,this._idleStateCallbacks=new It,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=le(()=>u5e.SCHEDULER_LOG_SLOW_TASKS,o=>this._debug=o,Zi);for(const o of Object.keys(ut))this.performanceInfo.tasks.set(ut[o],new Qm(ut[o]));const s=this;this._test={FRAME_SAFETY_BUDGET:WK,INTERACTING_BUDGET:XK,IDLE_BUDGET:ZK,get availableBudget(){return s._budget.budget},usedBudget:0,getBudget:()=>s._budget,setBudget:o=>s._budget=o,updateTask:o=>this._updateTask(o),getState:o=>this._getState(o),getRuntime:o=>this._getRuntime(o),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(s=>s.remove()),this._tasks.clear(),pr(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(s){this._updatingChanged(),s&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(s,o){const a=qK(s),l=new i(this,s,o,a);return this._tasks.push(l),this._updatingChanged(),this.performanceInfo.tasks.has(s)||this.performanceInfo.tasks.set(s,new Qm(s)),l}registerIdleStateCallbacks(s,o){const a={idleBegin:s,idleEnd:o};this._idleStateCallbacks.push(a),this.state===Si.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(c){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===Si.IDLE&&c()),a.idleBegin=c},set idleEnd(c){a.idleEnd=c}}}get load(){return this._load}set state(s){this._state!==s&&(this._state=s,this.state!==Si.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(o=>o.idleEnd())))}get state(){return this._state}updateBudget(s){this._test.usedBudget=0,++this._frameNumber;let o=WK,a=s.frameDuration,l=YK;switch(this.state){case Si.IDLE:o=0,a=Math.max(ZK,s.frameDuration),l=d5e;break;case Si.INTERACTING:a=Math.max(XK,s.frameDuration);case Si.ANIMATING:}return a=a-s.elapsedFrameTime-o,this.state!==Si.IDLE&&a<YK&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case Si.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(s=>s.idleBegin())),this._runIdle();break;case Si.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(s){this._idleUpdatesStartFired&&s.idleEnd(),this._idleStateCallbacks.removeUnordered(s)}removeTask(s){this._tasks.removeUnordered(s),this._runQueue.removeUnordered(s),this._updatingChanged()}_updateTask(s){this._tasks.forAll(o=>{o.name===s&&o.setPriority(s)})}_getState(s){if(this._runQueue.some(a=>a.name===s))return q_.SCHEDULED;let o=q_.IDLE;return this._tasks.forAll(a=>{a.name===s&&a.needsUpdate&&(a.schedulePriority<=1?o=q_.READY:o!==q_.READY&&(o=q_.WAITING))}),o}_getRuntime(s){let o=0;return this._tasks.forAll(a=>{a.name===s&&(o+=a.runtime)}),o}_resetRuntimes(){this._tasks.forAll(s=>s.runtime=0)}_getRunning(){const s=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&s.set(a.name,(s.get(a.name)||0)+1)}),s.size===0)return null;let o="";return s.forEach((a,l)=>{o+=a>1?` ${a}x ${l}`:` ${l}`}),o}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const s=this._tasks.reduce((o,a)=>a.needsUpdate?++o:o,0);this._load=this._load*JK+s*(1-JK)}_schedule(){for(this._runQueue.filterInPlace(s=>!!s.needsUpdate||(s.schedulePriority=s.basePriority,!1)),this._tasks.forAll(s=>{s.basePriority===nf&&s.needsUpdate&&!this._runQueue.includes(s)&&s.blockFrame!==this._frameNumber&&this._runQueue.unshift(s)});this._runQueue.length===0;){let s=!1,o=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==nf&&a.blockFrame!==this._frameNumber&&(s=!0,o=Math.max(o,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!s)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const s=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const o=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)===Lo.YIELD&&(a.blockFrame=this._frameNumber)}catch(c){ne.getLogger("esri.views.support.Scheduler").error(`Exception in task "${a.name}"`,c),a.blockFrame=this._frameNumber}!this._budget.hasProgressed&&a.blockFrame!==this._frameNumber&&a.needsUpdate&&(a.name,ut.I3S_CONTROLLER,a.blockFrame=this._frameNumber),a.schedulePriority=a.basePriority;const l=this._budget.now()-o;if(a.runtime+=l,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+l),this._debug&&l>2*this._budget.budget&&console.log("Task",a.name,"used",l,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-s)}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-s)}_startFrameTaskTimes(){for(const s of Object.keys(ut))this._frameTaskTimes.set(ut[s],0)}_recordFrameTaskTimes(s){this._frameTaskTimes.forEach((o,a)=>this.performanceInfo.tasks.get(a).record(o)),this.performanceInfo.total.record(s)}get test(){return this._test}}t.Scheduler=e;class i{get task(){return this._task.value}get updating(){return this._queue.running}constructor(s,o,a,l){this._scheduler=s,this.name=o,this._basePriority=l,this.blockFrame=0,this.runtime=0,this._queue=new c5e,this._handles=new Dg,this.schedulePriority=this._basePriority,this._task=qT(a??this._queue),this._handles.add(ac(()=>this.task.running,c=>s.taskRunningChanged(c)))}remove(){this.processQueue(Da),this._scheduler.removeTask(this),this.schedule=WT.schedule,this.reschedule=WT.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(s){this.name=s;const o=qK(s);this._basePriority!==nf&&this.schedulePriority===0||(this.schedulePriority=o),this._basePriority=o}get priority(){return this.name}set priority(s){this.setPriority(s)}get needsUpdate(){return this.updating||this.task.running}schedule(s,o,a){return this._queue.push(s,o,a)}reschedule(s,o,a){return this._queue.unshift(s,o,a)}processQueue(s){this._queue.runTask(s)}}class r{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=Si.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(s){return!this.done&&(s()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(s){this._enabled=s}reset(s,o){this._begin=this.now(),this._budget=s,this._state=o,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}t.Budget=r})(KD||(KD={})),function(t){t.SCHEDULED="s",t.READY="r",t.WAITING="w",t.IDLE="i"}(q_||(q_={}));const Da=(()=>{const t=new KD.Budget;return t.enabled=!1,t})();let p5e=class{remove(){}processQueue(){}schedule(e,i,r){try{if(Hn(i)){const n=pi();return r?Promise.resolve(r(n)):Promise.reject(n)}return tB(e(Da))}catch(n){return Promise.reject(n)}}reschedule(e,i,r){return this.schedule(e,i,r)}};const WT=new p5e;var C9;let tg=C9=class extends $e{constructor(){super(...arguments),this.url=""}destroy(){this.url=""}clone(){return new C9({url:this.url})}};h([f({type:String,json:{write:{isRequired:!0}}})],tg.prototype,"url",void 0),tg=C9=h([z("esri.webdoc.support.SlideThumbnail")],tg);var A9;let MI=A9=class extends $e{constructor(){super(...arguments),this.text=""}clone(){return new A9({text:this.text})}};h([f({type:String,json:{write:!0}})],MI.prototype,"text",void 0),MI=A9=h([z("esri.webscene.support.Description")],MI);const $I=MI;var O9;let D2=O9=class extends $e{constructor(){super(...arguments),this.lighting=new Rb,this.weather=new ZD}clone(){return new O9({lighting:ye(this.lighting),weather:ye(this.weather)})}};h([f({types:Vfe,json:{write:!0}})],D2.prototype,"lighting",void 0),h([f({types:Wq,json:{write:!0}})],D2.prototype,"weather",void 0),D2=O9=h([z("esri.webscene.Environment")],D2);var II;let LI=II=class extends $e{constructor(){super(...arguments),this.opacity=null}clone(){return new II({opacity:this.opacity})}cloneAndApplyTo(t){return this.opacity==null||((t=t?.clone()??new Z3).opacity=this.opacity),t}static fromGround(t){return new II({opacity:t.opacity})}};h([f({type:Number,json:{type:Ln,read:{reader:fq,source:"transparency"},write:{writer:(t,e)=>{e.transparency=pq(t)},target:"transparency"}}})],LI.prototype,"opacity",void 0),LI=II=h([z("esri.webscene.support.SlideGround")],LI);const qfe=LI;var R9;let N2=R9=class extends $e{constructor(t){super(t),this.id="",this.sublayerIds=null}clone(){return new R9({id:this.id,sublayerIds:ye(this.sublayerIds)})}};h([f({type:String,json:{write:!0}})],N2.prototype,"id",void 0),h([f({type:[Ln],json:{read:{source:"subLayerIds"},write:{target:"subLayerIds"}}})],N2.prototype,"sublayerIds",void 0),N2=R9=h([z("esri.webscene.support.SlideVisibleLayer")],N2);var P9;let DI=P9=class extends $e{constructor(){super(...arguments),this.text=""}clone(){return new P9({text:this.text})}};h([f({type:String,json:{write:{isRequired:!0}}})],DI.prototype,"text",void 0),DI=P9=h([z("esri.webscene.support.Title")],DI);const YA=DI;let f5e=0;const M9=ft.ofType(N2);let wo=class extends $e{constructor(e){super(e),this.id=Date.now().toString(16)+"-slide-"+f5e++,this.title=new YA,this.description=new $I,this.hidden=!1,this.thumbnail=new tg,this.viewpoint=null,this.basemap=null,this.ground=null,this.environment=new D2,this.visibleLayers=new M9}destroy(){this.visibleLayers.removeAll(),this.basemap=null,this.thumbnail=Pe(this.thumbnail),this.description=null,this.title=null,this.thumbnail=null}castTitle(e){return typeof e=="string"?new YA({text:e}):uo(YA,e)}castDescription(e){return typeof e=="string"?new $I({text:e}):uo($I,e)}castThumbnail(e){return typeof e=="string"?new tg({url:e}):uo(tg,e)}castBasemap(e){return vq(e)}set visibleLayers(e){this._set("visibleLayers",vg(e,this._get("visibleLayers"),M9))}castVisibleLayers(e){return e&&typeof e.map=="function"?e.map(i=>{if(typeof i=="string")return{id:i};if(i instanceof Jpe){const r=KK(i);return{id:i.id,sublayerIds:r}}return i.id?{id:i.id,sublayerIds:"sublayerIds"in i?i.sublayerIds:void 0}:(ne.getLogger(this).warn('Invalid visible layer, expected { id }, Layer or "id"'),i)}):null}clone(){return new this.constructor({id:this.id,title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||null,basemap:this.basemap?.clone()||null,ground:this.ground?.clone()||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&this.environment.clone()||null,hidden:this.hidden})}async _updateVisibleLayersFrom(e){const i=[];await Promise.allSettled(this._getLayers(e.map).map(r=>e.whenLayerView(r).then(n=>{if(n.visible){const s=KK(r);i.push(new N2({id:n.layer.id,sublayerIds:s}))}})).toArray()),this.visibleLayers.removeAll(),this.visibleLayers.addMany(i)}updateFrom(e,i){const r={format:"png",quality:80,width:120,height:75,disableDecorations:!0,...i?.screenshot};return e.when(()=>(this.viewpoint=e.viewpoint.clone(),this.environment.lighting=e.environment.lighting.type==="virtual"?dR.prototype.clone.apply(e.environment.lighting):Rb.prototype.clone.apply(e.environment.lighting),this.environment.weather=e.environment.weather.clone(),this.basemap=e.map.basemap&&e.map.basemap.clone()||null,this.ground=e.map.ground?qfe.fromGround(e.map.ground):null,this._updateVisibleLayersFrom(e))).then(()=>e.takeScreenshot(r)).then(n=>(this.thumbnail=new tg({url:n.dataUrl}),this))}async applyTo(e,i){this._applyToController!=null&&this._applyToController.abort();let r=new AbortController;this._applyToController=r;const n=eR(i,()=>r?.abort()),s=e.resourceController.scheduler.registerTask(ut.SLIDE);let o=!1;const a={animate:!0,...i,signal:this._applyToController.signal},l=async()=>{await Promise.all([s.schedule(async()=>o=await this._setViewpointOfInterest(e,a)),s.schedule(()=>this._applyBasemap(e,a),a.signal)]),await this._loadLayersWithSublayerVisibility(e),await Promise.all([s.schedule(()=>this._applyLayerVisibility(e),a.signal),s.schedule(()=>this._applyGround(e),a.signal),s.schedule(()=>this._applyViewpoint(e,a),a.signal)]),await s.schedule(()=>e.environment.weather=this.environment.weather.clone())},c=await hh(e.addUpdatingPromise(l()));if(o&&(e.contentCamera=null),s.remove(),this._applyToController===r&&(this._applyToController=null),r=null,n?.remove(),c.ok===!1)throw c.error;return this}async _applyBasemap(e,i){if(this.basemap){try{await this.basemap.load(i)}catch(r){if(Fn(r))throw r}e.map.basemap=WLe(this.basemap,e.map.basemap)}}_applyGround(e){this.ground&&(e.map.ground=this.ground.cloneAndApplyTo(e.map.ground))}_getLayers(e){const i=new ft;return this._collectLayers(e,i),this._collectLayers(e.ground,i),i}_collectLayers(e,i){e.layers.forEach(r=>{r.persistenceEnabled&&(i.add(r),"layers"in r&&this._collectLayers(r,i))})}async _loadLayersWithSublayerVisibility(e){this.visibleLayers&&await Promise.allSettled(this._getLayers(e.map).items.map(i=>this.visibleLayers.find(n=>n.id===i.id)?.sublayerIds?i.load():null))}_applyLayerVisibility(e){this.visibleLayers&&this._getLayers(e.map).forEach(i=>{const r=this.visibleLayers.find(o=>o.id===i.id);i.visible=r!=null;const n=r?.sublayerIds,s=Wfe(i);n&&s&&s.forEach(o=>o.visible=n.includes(o.id))})}async _setViewpointOfInterest(e,i){if(e.state.fixedContentCamera||!this.viewpoint||i?.ignoreViewpoint||!i?.useDestinationCamera)return!1;const{toCameraAsync:r}=await pe(()=>Promise.resolve().then(()=>BYe),void 0,import.meta.url),n=await r(e,this.viewpoint);return e.contentCamera=n,n!=null}async _applyViewpoint(e,i){if(this._applyCachedCameraTrackingEnabled(e),this.viewpoint&&!i.ignoreViewpoint){this.viewpoint.camera!=null&&(this.viewpoint.camera.fov=e.camera.fov);const r=this.environment.lighting;if(i.animate&&r.type==="sun"&&r.date)return this._animateToLighting(e,i);i.animate&&(e.environment.applyLighting(r.clone()),await e.goTo(this.viewpoint,i)),e.viewpoint=this.viewpoint}e.environment.applyLighting(this.environment.lighting.clone())}async _animateToLighting(e,i){let r=null;return e.environment.lighting.type!=="virtual"&&this.environment.lighting.type!=="virtual"&&(e.viewingMode==="global"&&(r=this._animateLightingWithCamera(e,e.environment.lighting,this.environment.lighting)),e.environment.cachedCameraTrackingEnabled=e.environment.lighting.cameraTrackingEnabled,e.environment.lighting.cameraTrackingEnabled=!1),e.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled,this.environment.lighting.type==="virtual"||e.environment.lighting.type==="virtual"?(e.environment.applyLighting(this.environment.lighting.clone()),e.environment.lighting.type!=="virtual"&&(e.environment.cachedCameraTrackingEnabled=e.environment.lighting.cameraTrackingEnabled,e.environment.lighting.cameraTrackingEnabled=!1)):this.environment.lighting.displayUTCOffset!=null&&(e.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset),e.goTo(this.viewpoint,i).then(()=>{this._applyCachedCameraTrackingEnabled(e),e.environment.applyLighting(this.environment.lighting.clone())}).catch(n=>{throw e.animation==null&&this._applyCachedCameraTrackingEnabled(e),n}).finally(()=>{pr(r)})}_applyCachedCameraTrackingEnabled(e){e.environment.cachedCameraTrackingEnabled!=null&&(e.environment.lighting.cameraTrackingEnabled=e.environment.cachedCameraTrackingEnabled,e.environment.cachedCameraTrackingEnabled=null)}_getTime(e){return[e.getTime(),3600*e.getUTCHours()+60*e.getUTCMinutes()+e.getUTCSeconds()]}_setTime(e,i,r){return e.setTime(i),e.setUTCHours(r/3600),e.setUTCMinutes(r%3600/60),e.setUTCSeconds(r%3600%60),e}_animateLightingWithCamera(e,i,r){const n=new Date(i.date.toString()),[s,o]=this._getTime(n),[a,l]=this._getTime(r.date),c=m5e(o,l),u=e.renderCoordsHelper,d=C();u.toRenderCoords(e.camera.position,d);const p=C(),m=C();this.viewpoint.camera!=null&&u.toRenderCoords(this.viewpoint.camera.position,p);const y=new Date;return ac(()=>e.camera,_=>{u.toRenderCoords(_.position,m);const v=bs(d,m),w=bs(p,m);let x=0;v+w!==0&&(x=v/(v+w));const T=s+(a-s)*x,S=g5e(o,c*x);i.date=this._setTime(y,T,S)})}static createFrom(e,i){return new this().updateFrom(e,i)}};function Wfe(t){if(t.type==="building-scene"||t.type==="map-image")return t.allSublayers.toArray()}function KK(t){const e=Wfe(t);if(e)return e.filter(i=>i.visible).map(i=>i.id)}h([f({type:String,json:{write:{isRequired:!0}}})],wo.prototype,"id",void 0),h([f({type:YA,json:{default:()=>new YA({text:""}),write:{isRequired:!0}}})],wo.prototype,"title",void 0),h([rr("title")],wo.prototype,"castTitle",null),h([f({type:$I,json:{write:{overridePolicy:t=>({enabled:!(!t||!t.text)})}}})],wo.prototype,"description",void 0),h([rr("description")],wo.prototype,"castDescription",null),h([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!1}})],wo.prototype,"hidden",void 0),h([f({type:tg,json:{default:()=>new tg({url:""}),write:{isRequired:!0}}})],wo.prototype,"thumbnail",void 0),h([rr("thumbnail")],wo.prototype,"castThumbnail",null),h([f({type:oc,nonNullable:!0,json:{write:{isRequired:!0}}})],wo.prototype,"viewpoint",void 0),h([f({type:rT,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],wo.prototype,"basemap",void 0),h([rr("basemap")],wo.prototype,"castBasemap",null),h([f({type:qfe,json:{write:!0}})],wo.prototype,"ground",void 0),h([f({type:M9,json:{write:{isRequired:!0}}})],wo.prototype,"visibleLayers",null),h([rr("visibleLayers")],wo.prototype,"castVisibleLayers",null),h([f({type:D2,json:{write:!0}})],wo.prototype,"environment",void 0),wo=h([z("esri.webscene.Slide")],wo);const $9=86400,QK=43200;function m5e(t,e){let i=e-t;return i>QK&&(i-=$9),i<-QK&&(i+=$9),i}function g5e(t,e){return eLe(t+e,$9)}const y5e=wo,I9=ft.ofType(y5e);let NI=class extends $e{constructor(e){super(e),this.slides=new I9}destroy(){this.slides.forEach(e=>e.destroy()),this.slides.removeAll()}set slides(e){e&&(e=e.filter(i=>!!i.viewpoint)),this._set("slides",vg(e,this._get("slides"),I9))}clone(){return new this.constructor({slides:this.slides.clone()})}};h([f({type:I9,nonNullable:!0,json:{write:!0}}),rr(jH)],NI.prototype,"slides",null),NI=h([z("esri.webscene.Presentation")],NI);const Yfe=NI;var L9;let Xx=L9=class extends $e{constructor(t){super(t)}clone(){return new L9({name:this.name,path:this.path,title:this.title})}};h([f({type:String,json:{write:!0}})],Xx.prototype,"name",void 0),h([f({type:String,json:{write:!0}})],Xx.prototype,"path",void 0),h([f({type:String,json:{write:!0}})],Xx.prototype,"title",void 0),Xx=L9=h([z("esri.webscene.TransportationNetwork")],Xx);const _5e=Xx;let Pb=class{constructor(e,i,r=""){this.major=e,this.minor=i,this._context=r}lessThan(e,i){return this.major<e||e===this.major&&this.minor<i}since(e,i){return!this.lessThan(e,i)}validate(e){if(this.major!==e.major){const i=this._context&&this._context+":",r=this._context&&this._context+" ";throw new W(i+"unsupported-version",`Required major ${r}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new Pb(this.major,this.minor,this._context)}static parse(e,i=""){const[r,n]=e.split("."),s=/^\s*\d+\s*$/;if(!r?.match||!s.test(r))throw new W((i&&i+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!n?.match||!s.test(n))throw new W((i&&i+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const o=parseInt(r,10),a=parseInt(n,10);return new Pb(o,a,i)}},QD=class extends Pb{constructor(e,i){super(e,i,"webscene")}get supportsGround(){return this.since(1,8)}get supportsVisibleElevationLayersInSlides(){return this.lessThan(1,8)}},v5e=null;function b5e(){return v5e}var Xfe;const K1=new QD(1,32),w5e=()=>{const e=[],i=K1.major;for(let r=8;r<=K1.minor;r++)e.push(`${i}.${r}`);return e},a6="Web Scene";let er=class extends bg.LoadableMixin(v4(tfe(Kpe))){constructor(e){super(e),this[Xfe]=!0,this._layersIdGCTimeoutId=void 0,this._updateFromPromise=null,this.applicationProperties=null,this.clippingArea=null,this.clippingEnabled=!1,this.floorInfo=null,this.heightModelInfo=void 0,this.sourceVersion=null,this.transportationNetworks=null,this.presentation=new Yfe,this.initialViewProperties=new JD,this.portalItem=null,this.resourceInfo=null,this._debouncedSaveOperations=CH(async(i,r,n)=>{switch(i){case L2.SAVE:return this._saveImpl(r);case L2.SAVE_AS:return this._saveAsImpl(n,r)}}),this._resourceReferences={portalItem:null,paths:[]},this.authoringApp=null,this.authoringAppVersion=null,this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1}initialize(){if(this.when().catch(e=>{ne.getLogger(this).error("#load()","Failed to load web scene",e)}),this.resourceInfo){let e;try{e=this._validateJSON(this.resourceInfo)}catch(i){return void this.addResolvingPromise(Promise.reject(i))}this.read(e),this.addResolvingPromise(this._validateSpatialReference()),this.addResolvingPromise(this._validateHeightModelInfo())}this.addHandles(Io(()=>this.allLayers,"change",()=>this._scheduleLayersIdGC()))}destroy(){this._unscheduleLayersIdGC(),this.presentation&&this.presentation.destroy(),this.portalItem=Pe(this.portalItem)}writeClippingArea(e,i){i.clippingArea||(i.clippingArea={}),i.clippingArea.geometry=e.toJSON()}readClippingEnabled(e,i){return!!i.clippingArea&&!!i.clippingArea.clip}writeClippingEnabled(e,i){this.clippingArea&&(i.clippingArea||(i.clippingArea={}),i.clippingArea.clip=e)}writeLayers(e,i,r,n){i[r]=this._layersToJSON(e,"operational-layers",n)}readSourceVersion(e,i){const[r,n]=i.version.split(".");return new QD(parseInt(r,10),parseInt(n,10))}writeSourceVersion(e,i,r){i[r]=`${K1.major}.${K1.minor}`}writeTables(e,i,r,n){const s=this._layersToJSON(e,"tables",n);s.length&&(i[r]=s)}get thumbnailUrl(){return this.portalItem?.thumbnailUrl??null}set thumbnailUrl(e){e?this._override("thumbnailUrl",e):(this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}set authoringApp(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e)}writeAuthoringApp(e,i){e&&this._isAuthoringAppSetByUser?i.authoringApp=e:i.authoringApp="ArcGIS API for JavaScript"}set authoringAppVersion(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e)}writeAuthoringAppVersion(e,i){e&&this._isAuthoringAppVersionSetByUser?i.authoringAppVersion=e:i.authoringAppVersion=nde}writeGround(e,i,r,n){i[r]=e?e.write({},n):{transparency:0,layers:[]}}readInitialViewProperties(e,i){const r={};return i.initialState?.environment&&(r.environment=HT.fromJSON(i.initialState.environment)),r.spatialReference=i.spatialReference?je.fromJSON(i.spatialReference):je.WebMercator,r.viewingMode=i.viewingMode??"global",i.initialState?.viewpoint&&(r.viewpoint=oc.fromJSON(i.initialState.viewpoint)),new JD(r)}get spatialReference(){return this.initialViewProperties?.spatialReference??je.WebMercator}get viewingMode(){return this.initialViewProperties?.viewingMode??"global"}load(e){const i=this.ground;return this.addResolvingPromise(this._loadFromSource().then(()=>{i&&i!==this.ground&&i.destroy()})),Promise.resolve(this)}loadAll(){return WH(this,e=>{const i=this.presentation&&this.presentation.slides;e(this.ground,this.basemap,this.layers,i&&i.map(r=>r.basemap),this.tables)})}read(e,i){i={...i,origin:"web-scene"};const r=this._isAuthoringAppVersionSetByUser,n=this._isAuthoringAppSetByUser;if(TPe(this,e,s=>super.read(e,s),i),n||(this._isAuthoringAppSetByUser=!1),r||(this._isAuthoringAppVersionSetByUser=!1),e.baseMap&&Array.isArray(e.baseMap.elevationLayers)&&this.sourceVersion?.supportsVisibleElevationLayersInSlides){const s=e.baseMap.elevationLayers.map(c=>({id:c.id})),o=this.presentation.slides,a=(c,u)=>c.visibleLayers.some(d=>d.id===u),l=s.filter(c=>!o.some(u=>a(u,c.id)));o.forEach(c=>{c.visibleLayers.addMany(l)})}}_writeBasemapElevationLayers(e){const i=e.ground?.layers;!e.baseMap&&i?.length&&(e.baseMap={title:"Basemap",baseMapLayers:[]}),e.baseMap&&(e.baseMap.elevationLayers=ye(i))}_layersToJSON(e,i,r){const n={...r,layerContainerType:i};return e.map(s=>this._verifyWritableLayer(s,r)?s.write({},n):null).filter(s=>!!s).toArray()}_verifyWritableLayer(e,i){return!!e.persistenceEnabled&&("write"in e||(i?.messages&&i.messages.push(new W("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted in web scenes`,{layer:e})),!1))}write(e,i){if(this.loadStatus!=="loaded"){const s=new W("webscene:not-loaded","Web scene must be loaded before it can be serialized");throw ne.getLogger(this).error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus),s}this._runLayersIdGC();const r=!i?.messages;i={messages:[],...i,origin:"web-scene"};const n=super.write(e,i);if(r){const s=i.messages?.filter(o=>o.name==="web-document-write:property-required")??[];if(s.length){const o=new W("web-document:property-required","One or more properties that are required in the webscene JSON are missing, see details for the specific errors",{errors:s});throw ne.getLogger(this).error("#toJSON()","One or more properties that are required in the webscene JSON are missing",s),o}}return this._writeBasemapElevationLayers(n),n}async save(e){return this._debouncedSaveOperations(L2.SAVE,e)}async _saveImpl(e){if(!this.portalItem)throw new W("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene");if(UK(this.portalItem),this.portalItem?.type!==a6)throw new W("webscene:portal-item-wrong-type",`Portal item needs to have type "${a6}"`);const i=this._updateFromPromise;await this._ensureLoadBeforeSave();const r=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:this.portalItem.itemUrl?bn(this.portalItem.itemUrl):null,messages:[],portal:this.portalItem.portal??ia.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}}),n=this.write({},r);return await Promise.all(r.resources.pendingOperations),await this._verifySave(n,r,e),this._updateTypeKeywords(this.portalItem),await kNe(this.portalItem,n,this._resourceReferences,r,null),$K(r),i&&await i,await this._saveThumbnail(),this.portalItem}async saveAs(e,i){return this._debouncedSaveOperations(L2.SAVE_AS,i,e)}async _saveAsImpl(e,i){let r=S4.from(e);if(!r)throw new W("webscene:portal-item-required","saveAs requires a portal item to save to");UK(r),r.id&&(r=r.clone(),r.id=null);const n=r.portal||ia.getDefault();await this._ensureLoadBeforeSave(),r.type=a6,r.portal=n;const s=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:null,messages:[],portal:n,portalItem:r,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}}),o=this.write({},s);await Promise.all(s.resources.pendingOperations),await this._verifySaveAs(o,s,i);const a=this.thumbnailUrl,l=!this._isOverridden("thumbnailUrl");if(this._updateTypeKeywords(r),await n.signIn(),!n.user)throw new W("webscene:user-not-signed-in","saveAs requires a user to be signed in to the portal");return await n.user.addItem({item:r,folder:i?.folder,data:o}),await FNe(this._resourceReferences,s,null),this.portalItem=r,QB.prototype.read.call(this,{version:o.version,authoringApp:o.authoringApp,authoringAppVersion:o.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:r.itemUrl?bn(r.itemUrl):void 0}),$K(s),a&&(this.thumbnailUrl=l?BH(a,"w","8192"):a),s.portalItem=r,await this._saveThumbnail(),r}async _saveThumbnail(){this._isOverridden("thumbnailUrl")&&(await this.portalItem?.updateThumbnail({thumbnail:this.thumbnailUrl}),this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}_verifySave(e,i,r,n=!1){if(!$T(this.spatialReference))return Promise.reject(new W("webscene:unsupported-spatial-reference","Webscenes using spatial reference systems from Mars or Moon can not be saved currently."));let s,o=i.messages?.filter(c=>c.type==="error").map(c=>new W(c.name,c.message,c.details))??[];i.blockedRelativeUrls&&(o=o.concat(i.blockedRelativeUrls.map(c=>new W("url:unsupported",`Relative url '${c}' is not supported in Web Scene`)))),r&&r.ignoreUnsupported&&(o=o.filter(c=>c.name!=="layer:unsupported"&&c.name!=="symbol:unsupported"&&c.name!=="symbol-layer:unsupported"&&c.name!=="property:unsupported"&&c.name!=="url:unsupported"&&c.name!=="scenemodification:unsupported")),r?.requiredPropertyChecksDisabled&&(o=o.filter(c=>c.name!=="web-document-write:property-required"));const a=!!r?.strictSchemaValidationEnabled,l=b5e();return s=a&&l?l().then(c=>{const u=c.validate(e);if(u.length>0){const d=`webscene did not validate:
${u.join(`
`)}`;ne.getLogger(this).error(`${n?"saveAs":"save"}(): ${d}`)}return u.map(d=>new W("webscene:schema-validation",d))}).then(c=>{if(c.length>0)throw RNe(c.concat(o));return o}):Promise.resolve(o),s.then(c=>{if(c.length>0)throw new W("webscene:save","Failed to save webscene due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:c})})}_verifySaveAs(e,i,r){return this.canNotSaveAs(i)?Promise.reject(ONe()):this._verifySave(e,i,r,!0)}verifySaveAs(e){const i=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),r=this.write({},i);return this._verifySaveAs(r,i,e)}canNotSaveAs(e){return e||(e=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write({},e)),(e.verifyItemRelativeUrls?.writtenUrls?.length??0)>0}async updateFrom(e,i={}){const r=this._updateFrom(e,i);this._updateFromPromise=r,await r,this._updateFromPromise===r&&(this._updateFromPromise=null)}async _updateFrom(e,i={}){if(await e.whenReady(),!i.environmentExcluded&&e.environment&&(this.initialViewProperties.environment=HT.prototype.clone.apply(e.environment)),!i.viewpointExcluded&&e.viewpoint&&(this.initialViewProperties.viewpoint=e.viewpoint.clone()),this.initialViewProperties.spatialReference=e.spatialReference.clone(),this.initialViewProperties.viewingMode=e.viewingMode,e.clippingArea!=null?e.clippingArea!==this.clippingArea&&(this.clippingArea=e.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,e.heightModelInfo&&(this.heightModelInfo=e.heightModelInfo.clone()),e.map===this)for(const r of e.allLayerViews){const n="visible";n in r&&n in r.layer&&r._isOverridden(n)&&(r.layer[n]=r[n])}(i.thumbnailExcluded===!1||i.thumbnailExcluded==null&&!i.viewpointExcluded)&&await this._updateFromThumbnail(e,i.thumbnailSize??void 0)}async _updateFromThumbnail(e,i){const r=BNe(e,i),n=await e.takeScreenshot({format:"jpg",width:r.width,height:r.height,disableDecorations:!0});this.thumbnailUrl=n.dataUrl}_loadFromSource(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):this.portalItem?.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()}_readAndLoadFromJSON(e,i){const r=this._validateJSON(e);return this.read(r,i),this._loadFromJSON(r,i)}_extractOperationalLayers(e){const i=[];if(!this.sourceVersion?.supportsGround&&e.baseMap&&Array.isArray(e.baseMap.elevationLayers))for(const s of e.baseMap.elevationLayers)i.push(s);const r=[],n=s=>(s.layers&&(s.layers=s.layers.filter(n)),s.layerType!=="ArcGISTiledElevationServiceLayer"||(this.sourceVersion?.supportsGround||r.push(s),!1));return{operationalLayers:e.operationalLayers?e.operationalLayers.filter(n):[],operationalElevationLayers:r,basemapElevationLayers:i}}async _loadFromJSON(e,i){const r=new ft;await this._validateSpatialReference(),await this._validateHeightModelInfo();const{populateOperationalLayers:n}=await pe(()=>import("./layersCreator-ba061b59.js"),["./layersCreator-ba061b59.js","./portalLayers-c7cc2afd.js","./associatedFeatureServiceUtils-44938726.js","./requestPresets-f7ad0d2f.js","./styleUtils-f17e2eb8.js"],import.meta.url),{operationalLayers:s,operationalElevationLayers:o,basemapElevationLayers:a}=this._extractOperationalLayers(e),l=[],c={context:{...i,layerContainerType:"operational-layers"}};if(this.portalItem&&(c.context.portal=this.portalItem.portal||ia.getDefault()),a.length>0){const u={...c,context:{...c.context,layerContainerType:"ground"}};u.defaultLayerType="ArcGISTiledElevationServiceLayer",l.push(n(this.ground.layers,a,u))}if(o.length>0){const u={...c,context:{...c.context,layerContainerType:"ground"}};u.defaultLayerType="ArcGISTiledElevationServiceLayer",l.push(n(r,o,u))}s&&s.length>0&&l.push(n(this.layers,s,c)),e.tables?.length&&l.push(n(this.tables,e.tables,{...c,context:{...c.context,layerContainerType:"tables"},defaultLayerType:"ArcGISFeatureLayer"})),await Promise.allSettled(l),await this._loadObjectsWithLayers(),this.ground.layers.addMany(r)}async _ensureLoadBeforeSave(){await this.load(),await this._loadObjectsWithLayers();const e=[],i=[...this.allLayers.items];for(const{basemap:r}of this.presentation.slides.items)r&&(i.push(...r.baseLayers.items),i.push(...r.referenceLayers.items));for(const r of i)if("beforeSave"in r&&typeof r.beforeSave=="function"){const n=r.beforeSave();n&&e.push(n)}await Promise.allSettled(e)}async _loadObjectsWithLayers(){const e=[];this.ground&&e.push(this.ground.load()),this.basemap&&e.push(this.basemap.load()),this.presentation.slides.forEach(i=>{i.basemap&&e.push(i.basemap.load())}),await Promise.allSettled(e)}async _loadFromItem(e){if(await e.load().catch(n=>{throw new W("webscene:load-portal-item","Failed to load portal item",{error:n})}),e.type!=="Web Scene")throw new W("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:e.type});const i=await e.fetchData();this.resourceInfo=i;const r={origin:"web-scene",url:bn(e.itemUrl),portal:e.portal||ia.getDefault(),portalItem:e,readResourcePaths:[]};await this._readAndLoadFromJSON(i,r),this._resourceReferences={portalItem:e,paths:r.readResourcePaths??[]}}_validateSpatialReference(){const e=this.initialViewProperties,i=this._sceneSpatialReference;let r;if(e.viewingMode!=="local"){if(!tO(i,Me.Global))return Promise.reject(new W("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:i,viewingMode:e.viewingMode}));r=l=>!l||Hd(l,i)}else{if(!tO(i,Me.Local))return Promise.reject(new W("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:i,viewingMode:e.viewingMode}));r=l=>!l||l.equals(i)}const n=l=>l?.camera?.position.spatialReference??l?.targetGeometry?.spatialReference,s=e.viewpoint,o=n(s);if(o&&!r(o))return Promise.reject(new W("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:o,sceneSpatialReference:i,viewingMode:e.viewingMode}));const a=this.presentation.slides.find(l=>!r(n(l.viewpoint)));if(a){const l=n(a.viewpoint);return Promise.reject(new W("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{slideSpatialReference:l,sceneSpatialReference:i,viewingMode:e.viewingMode}))}return Promise.resolve()}_validateHeightModelInfo(){const e=this._sceneSpatialReference,i=pNe(this.heightModelInfo,e);return i?Promise.reject(i):Promise.resolve()}_validateJSON(e){const i=QD.parse(e.version||"","webscene");return K1.validate(i),e.version=`${i.major}.${i.minor}`,i.major===1&&i.minor<=2&&(e.spatialReference=je.WebMercator.toJSON()),e}_updateTypeKeywords(e){FK(e,l9.LOCAL_SCENE,this.initialViewProperties.viewingMode==="local"),FK(e,l9.DEVELOPER_BASEMAP,wK(this.basemap)||this.presentation.slides.some(({basemap:i})=>!!i&&wK(i))),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter((i,r,n)=>n.indexOf(i)===r))}get _sceneSpatialReference(){return this.initialViewProperties.spatialReference||je.WebMercator}get _verifyItemRelativeRootPath(){return this.portalItem?.itemUrl?bn(this.portalItem.itemUrl).path:null}_enableVerifyItemRelativeUrls(e){const i=this._verifyItemRelativeRootPath;return i&&(e.verifyItemRelativeUrls={rootPath:i,writtenUrls:[]}),e}_unscheduleLayersIdGC(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),this._layersIdGCTimeoutId=0)}_scheduleLayersIdGC(){this._unscheduleLayersIdGC(),this._layersIdGCTimeoutId=setTimeout(()=>{this._layersIdGCTimeoutId=0,this._runLayersIdGC()},3e3)}_runLayersIdGC(){this._unscheduleLayersIdGC();const e=this.applicationProperties?.viewing?.search,i=n=>this.allLayers.some(s=>s.id===n&&s.persistenceEnabled);e&&e.layers&&(e.layers=e.layers.filter(n=>i(n.id)));const r=this.presentation&&this.presentation.slides;r&&r.forEach(n=>{n.visibleLayers&&(n.visibleLayers=n.visibleLayers.filter(s=>i(s.id)))})}static fromJSON(e){if(!e)throw new W("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:e})}};Xfe=ENe,er.version=`${K1.major}.${K1.minor}`,h([f({type:YNe,json:{write:!0}})],er.prototype,"applicationProperties",void 0),h([f({type:Xi,json:{read:{source:"clippingArea.geometry",reader:Cb},write:{target:"clippingArea.geometry"}}})],er.prototype,"clippingArea",void 0),h([di("clippingArea")],er.prototype,"writeClippingArea",null),h([f({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],er.prototype,"clippingEnabled",void 0),h([Ni("clippingEnabled",["clippingArea"])],er.prototype,"readClippingEnabled",null),h([di("clippingEnabled")],er.prototype,"writeClippingEnabled",null),h([f({type:SNe,json:{read:{source:"mapFloorInfo"},write:{target:"mapFloorInfo"}}})],er.prototype,"floorInfo",void 0),h([f({type:tw,json:{write:!0}})],er.prototype,"heightModelInfo",void 0),h([f({json:{write:{target:"operationalLayers",ignoreOrigin:!0}}})],er.prototype,"layers",void 0),h([di("layers")],er.prototype,"writeLayers",null),h([f({readOnly:!0,type:QD,json:{type:w5e(),write:{ignoreOrigin:!0,target:"version",isRequired:!0,overridePolicy:()=>({enabled:!0,allowNull:!0,ignoreOrigin:!0})}}})],er.prototype,"sourceVersion",void 0),h([Ni("sourceVersion",["version"])],er.prototype,"readSourceVersion",null),h([di("sourceVersion")],er.prototype,"writeSourceVersion",null),h([f({json:{read:!1,write:{enabled:!0,ignoreOrigin:!0}}})],er.prototype,"tables",void 0),h([di("tables")],er.prototype,"writeTables",null),h([f()],er.prototype,"thumbnailUrl",null),h([f({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],er.prototype,"authoringApp",null),h([di("authoringApp")],er.prototype,"writeAuthoringApp",null),h([f({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],er.prototype,"authoringAppVersion",null),h([di("authoringAppVersion")],er.prototype,"writeAuthoringAppVersion",null),h([f({json:{write:{isRequired:!0,allowNull:!0,ignoreOrigin:!0,enabled:!0}}})],er.prototype,"ground",void 0),h([di("ground")],er.prototype,"writeGround",null),h([f({type:ft.ofType(_5e),json:{write:!0}})],er.prototype,"transportationNetworks",void 0),h([f({type:Yfe,nonNullable:!0,json:{write:{ignoreOrigin:!0,writer:(t,e,i,r)=>{if(t.slides&&t.slides.length>0){const n={...r,isPresentation:!0};e.presentation=t.write({},n)}}}}})],er.prototype,"presentation",void 0),h([f({type:JD,nonNullable:!0,json:{write:{target:"initialState",isRequired:!0,ignoreOrigin:!0},default:()=>new JD({viewingMode:"global",spatialReference:je.WebMercator})}})],er.prototype,"initialViewProperties",void 0),h([Ni("initialViewProperties",["initialState.environment","initialState.viewpoint","spatialReference","viewingMode"])],er.prototype,"readInitialViewProperties",null),h([f({type:je,json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],er.prototype,"spatialReference",null),h([f({type:["local","global"],json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],er.prototype,"viewingMode",null),h([f({type:S4})],er.prototype,"portalItem",void 0),h([f()],er.prototype,"resourceInfo",void 0),er=h([z("esri.WebScene")],er);const x5e=er;async function Zfe(t,e){const{WhereClause:i}=await pe(()=>import("./WhereClause-4988664d.js").then(r=>r.W),["./WhereClause-4988664d.js","./TimeOnly-a96593b0.js"],import.meta.url);return i.create(t,e)}function kCt(t,e){return t!=null?e!=null?`(${t}) AND (${e})`:t:e}function Ew(t){return typeof t=="string"||t instanceof String}const eQ=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Almaty"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Mazatlan"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);class iw extends Error{}class T5e extends iw{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class S5e extends iw{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class E5e extends iw{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class RC extends iw{}class Jfe extends iw{constructor(e){super(`Invalid unit ${e}`)}}class Xu extends iw{}class a0 extends iw{constructor(){super("Zone is an abstract class")}}const He="numeric",qd="short",tu="long",eN={year:He,month:He,day:He},Kfe={year:He,month:qd,day:He},C5e={year:He,month:qd,day:He,weekday:qd},Qfe={year:He,month:tu,day:He},eme={year:He,month:tu,day:He,weekday:tu},tme={hour:He,minute:He},ime={hour:He,minute:He,second:He},rme={hour:He,minute:He,second:He,timeZoneName:qd},nme={hour:He,minute:He,second:He,timeZoneName:tu},sme={hour:He,minute:He,hourCycle:"h23"},ome={hour:He,minute:He,second:He,hourCycle:"h23"},ame={hour:He,minute:He,second:He,hourCycle:"h23",timeZoneName:qd},lme={hour:He,minute:He,second:He,hourCycle:"h23",timeZoneName:tu},cme={year:He,month:He,day:He,hour:He,minute:He},ume={year:He,month:He,day:He,hour:He,minute:He,second:He},hme={year:He,month:qd,day:He,hour:He,minute:He},dme={year:He,month:qd,day:He,hour:He,minute:He,second:He},A5e={year:He,month:qd,day:He,weekday:qd,hour:He,minute:He},pme={year:He,month:tu,day:He,hour:He,minute:He,timeZoneName:qd},fme={year:He,month:tu,day:He,hour:He,minute:He,second:He,timeZoneName:qd},mme={year:He,month:tu,day:He,weekday:tu,hour:He,minute:He,timeZoneName:tu},gme={year:He,month:tu,day:He,weekday:tu,hour:He,minute:He,second:He,timeZoneName:tu};class pR{get type(){throw new a0}get name(){throw new a0}get ianaName(){return this.name}get isUniversal(){throw new a0}offsetName(e,i){throw new a0}formatOffset(e,i){throw new a0}offset(e){throw new a0}equals(e){throw new a0}get isValid(){throw new a0}}let l6=null;class B4 extends pR{static get instance(){return l6===null&&(l6=new B4),l6}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return _me(e,i,r)}formatOffset(e,i){return ZA(this.offset(e),i)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let FI={};function O5e(t){return FI[t]||(FI[t]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),FI[t]}const R5e={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function P5e(t,e){const i=t.format(e).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(i),[,n,s,o,a,l,c,u]=r;return[o,n,s,a,l,c,u]}function M5e(t,e){const i=t.formatToParts(e),r=[];for(let n=0;n<i.length;n++){const{type:s,value:o}=i[n],a=R5e[s];s==="era"?r[a]=o:Gi(a)||(r[a]=parseInt(o,10))}return r}let TP={};class Wd extends pR{static create(e){return TP[e]||(TP[e]=new Wd(e)),TP[e]}static resetCache(){TP={},FI={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=Wd.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return _me(e,i,r,this.name)}formatOffset(e,i){return ZA(this.offset(e),i)}offset(e){const i=new Date(e);if(isNaN(i))return NaN;const r=O5e(this.name);let[n,s,o,a,l,c,u]=r.formatToParts?M5e(r,i):P5e(r,i);a==="BC"&&(n=-Math.abs(n)+1);const p=G4({year:n,month:s,day:o,hour:l===24?0:l,minute:c,second:u,millisecond:0});let m=+i;const y=m%1e3;return m-=y>=0?y:1e3+y,(p-m)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let tQ={};function $5e(t,e={}){const i=JSON.stringify([t,e]);let r=tQ[i];return r||(r=new Intl.ListFormat(t,e),tQ[i]=r),r}let D9={};function N9(t,e={}){const i=JSON.stringify([t,e]);let r=D9[i];return r||(r=new Intl.DateTimeFormat(t,e),D9[i]=r),r}let F9={};function I5e(t,e={}){const i=JSON.stringify([t,e]);let r=F9[i];return r||(r=new Intl.NumberFormat(t,e),F9[i]=r),r}let k9={};function L5e(t,e={}){const{base:i,...r}=e,n=JSON.stringify([t,r]);let s=k9[n];return s||(s=new Intl.RelativeTimeFormat(t,e),k9[n]=s),s}let PC=null;function D5e(){return PC||(PC=new Intl.DateTimeFormat().resolvedOptions().locale,PC)}function N5e(t){const e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));const i=t.indexOf("-u-");if(i===-1)return[t];{let r,n;try{r=N9(t).resolvedOptions(),n=t}catch{const l=t.substring(0,i);r=N9(l).resolvedOptions(),n=l}const{numberingSystem:s,calendar:o}=r;return[n,s,o]}}function F5e(t,e,i){return(i||e)&&(t.includes("-u-")||(t+="-u"),i&&(t+=`-ca-${i}`),e&&(t+=`-nu-${e}`)),t}function k5e(t){const e=[];for(let i=1;i<=12;i++){const r=Zt.utc(2009,i,1);e.push(t(r))}return e}function U5e(t){const e=[];for(let i=1;i<=7;i++){const r=Zt.utc(2016,11,13+i);e.push(t(r))}return e}function SP(t,e,i,r){const n=t.listingMode();return n==="error"?null:n==="en"?i(e):r(e)}function z5e(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem==="latn"}class B5e{constructor(e,i,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;const{padTo:n,floor:s,...o}=r;if(!i||Object.keys(o).length>0){const a={useGrouping:!1,...r};r.padTo>0&&(a.minimumIntegerDigits=r.padTo),this.inf=I5e(e,a)}}format(e){if(this.inf){const i=this.floor?Math.floor(e):e;return this.inf.format(i)}else{const i=this.floor?Math.floor(e):Xq(e,3);return Fs(i,this.padTo)}}}class V5e{constructor(e,i,r){this.opts=r,this.originalZone=void 0;let n;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){const o=-1*(e.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;e.offset!==0&&Wd.create(a).valid?(n=a,this.dt=e):(n="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,n=e.zone.name):(n="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const s={...this.opts};s.timeZone=s.timeZone||n,this.dtf=N9(i,s)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(i=>{if(i.type==="timeZoneName"){const r=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...i,value:r}}else return i}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class G5e{constructor(e,i,r){this.opts={style:"long",...r},!i&&yme()&&(this.rtf=L5e(e,r))}format(e,i){return this.rtf?this.rtf.format(e,i):o4e(i,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,i){return this.rtf?this.rtf.formatToParts(e,i):[]}}class Pn{static fromOpts(e){return Pn.create(e.locale,e.numberingSystem,e.outputCalendar,e.defaultToEN)}static create(e,i,r,n=!1){const s=e||Ds.defaultLocale,o=s||(n?"en-US":D5e()),a=i||Ds.defaultNumberingSystem,l=r||Ds.defaultOutputCalendar;return new Pn(o,a,l,s)}static resetCache(){PC=null,D9={},F9={},k9={}}static fromObject({locale:e,numberingSystem:i,outputCalendar:r}={}){return Pn.create(e,i,r)}constructor(e,i,r,n){const[s,o,a]=N5e(e);this.locale=s,this.numberingSystem=i||o||null,this.outputCalendar=r||a||null,this.intl=F5e(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=n,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=z5e(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),i=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&i?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:Pn.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,i=!1){return SP(this,e,wme,()=>{const r=i?{month:e,day:"numeric"}:{month:e},n=i?"format":"standalone";return this.monthsCache[n][e]||(this.monthsCache[n][e]=k5e(s=>this.extract(s,r,"month"))),this.monthsCache[n][e]})}weekdays(e,i=!1){return SP(this,e,Sme,()=>{const r=i?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},n=i?"format":"standalone";return this.weekdaysCache[n][e]||(this.weekdaysCache[n][e]=U5e(s=>this.extract(s,r,"weekday"))),this.weekdaysCache[n][e]})}meridiems(){return SP(this,void 0,()=>Eme,()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[Zt.utc(2016,11,13,9),Zt.utc(2016,11,13,19)].map(i=>this.extract(i,e,"dayperiod"))}return this.meridiemCache})}eras(e){return SP(this,e,Cme,()=>{const i={era:e};return this.eraCache[e]||(this.eraCache[e]=[Zt.utc(-40,1,1),Zt.utc(2017,1,1)].map(r=>this.extract(r,i,"era"))),this.eraCache[e]})}extract(e,i,r){const n=this.dtFormatter(e,i),s=n.formatToParts(),o=s.find(a=>a.type.toLowerCase()===r);return o?o.value:null}numberFormatter(e={}){return new B5e(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,i={}){return new V5e(e,this.intl,i)}relFormatter(e={}){return new G5e(this.intl,this.isEnglish(),e)}listFormatter(e={}){return $5e(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let c6=null;class Fa extends pR{static get utcInstance(){return c6===null&&(c6=new Fa(0)),c6}static instance(e){return e===0?Fa.utcInstance:new Fa(e)}static parseSpecifier(e){if(e){const i=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(i)return new Fa(j4(i[1],i[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${ZA(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${ZA(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,i){return ZA(this.fixed,i)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class j5e extends pR{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function by(t,e){if(Gi(t)||t===null)return e;if(t instanceof pR)return t;if(H5e(t)){const i=t.toLowerCase();return i==="default"?e:i==="local"||i==="system"?B4.instance:i==="utc"||i==="gmt"?Fa.utcInstance:Fa.parseSpecifier(i)||Wd.create(t)}else return Q1(t)?Fa.instance(t):typeof t=="object"&&"offset"in t&&typeof t.offset=="function"?t:new j5e(t)}let iQ=()=>Date.now(),rQ="system",nQ=null,sQ=null,oQ=null,aQ=60,lQ;class Ds{static get now(){return iQ}static set now(e){iQ=e}static set defaultZone(e){rQ=e}static get defaultZone(){return by(rQ,B4.instance)}static get defaultLocale(){return nQ}static set defaultLocale(e){nQ=e}static get defaultNumberingSystem(){return sQ}static set defaultNumberingSystem(e){sQ=e}static get defaultOutputCalendar(){return oQ}static set defaultOutputCalendar(e){oQ=e}static get twoDigitCutoffYear(){return aQ}static set twoDigitCutoffYear(e){aQ=e%100}static get throwOnInvalid(){return lQ}static set throwOnInvalid(e){lQ=e}static resetCaches(){Pn.resetCache(),Wd.resetCache()}}function Gi(t){return typeof t>"u"}function Q1(t){return typeof t=="number"}function V4(t){return typeof t=="number"&&t%1===0}function H5e(t){return typeof t=="string"}function q5e(t){return Object.prototype.toString.call(t)==="[object Date]"}function yme(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function W5e(t){return Array.isArray(t)?t:[t]}function cQ(t,e,i){if(t.length!==0)return t.reduce((r,n)=>{const s=[e(n),n];return r&&i(r[0],s[0])===r[0]?r:s},null)[1]}function Y5e(t,e){return e.reduce((i,r)=>(i[r]=t[r],i),{})}function YT(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function ig(t,e,i){return V4(t)&&t>=e&&t<=i}function X5e(t,e){return t-e*Math.floor(t/e)}function Fs(t,e=2){const i=t<0;let r;return i?r="-"+(""+-t).padStart(e,"0"):r=(""+t).padStart(e,"0"),r}function dy(t){if(!(Gi(t)||t===null||t===""))return parseInt(t,10)}function W_(t){if(!(Gi(t)||t===null||t===""))return parseFloat(t)}function Yq(t){if(!(Gi(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function Xq(t,e,i=!1){const r=10**e;return(i?Math.trunc:Math.round)(t*r)/r}function fR(t){return t%4===0&&(t%100!==0||t%400===0)}function XA(t){return fR(t)?366:365}function tN(t,e){const i=X5e(e-1,12)+1,r=t+(e-i)/12;return i===2?fR(r)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][i-1]}function G4(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(t.year,t.month-1,t.day)),+e}function iN(t){const e=(t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400))%7,i=t-1,r=(i+Math.floor(i/4)-Math.floor(i/100)+Math.floor(i/400))%7;return e===4||r===3?53:52}function U9(t){return t>99?t:t>Ds.twoDigitCutoffYear?1900+t:2e3+t}function _me(t,e,i,r=null){const n=new Date(t),s={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(s.timeZone=r);const o={timeZoneName:e,...s},a=new Intl.DateTimeFormat(i,o).formatToParts(n).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function j4(t,e){let i=parseInt(t,10);Number.isNaN(i)&&(i=0);const r=parseInt(e,10)||0,n=i<0||Object.is(i,-0)?-r:r;return i*60+n}function vme(t){const e=Number(t);if(typeof t=="boolean"||t===""||Number.isNaN(e))throw new Xu(`Invalid unit value ${t}`);return e}function rN(t,e){const i={};for(const r in t)if(YT(t,r)){const n=t[r];if(n==null)continue;i[e(r)]=vme(n)}return i}function ZA(t,e){const i=Math.trunc(Math.abs(t/60)),r=Math.trunc(Math.abs(t%60)),n=t>=0?"+":"-";switch(e){case"short":return`${n}${Fs(i,2)}:${Fs(r,2)}`;case"narrow":return`${n}${i}${r>0?`:${r}`:""}`;case"techie":return`${n}${Fs(i,2)}${Fs(r,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function H4(t){return Y5e(t,["hour","minute","second","millisecond"])}const Z5e=["January","February","March","April","May","June","July","August","September","October","November","December"],bme=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],J5e=["J","F","M","A","M","J","J","A","S","O","N","D"];function wme(t){switch(t){case"narrow":return[...J5e];case"short":return[...bme];case"long":return[...Z5e];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const xme=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Tme=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],K5e=["M","T","W","T","F","S","S"];function Sme(t){switch(t){case"narrow":return[...K5e];case"short":return[...Tme];case"long":return[...xme];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const Eme=["AM","PM"],Q5e=["Before Christ","Anno Domini"],e4e=["BC","AD"],t4e=["B","A"];function Cme(t){switch(t){case"narrow":return[...t4e];case"short":return[...e4e];case"long":return[...Q5e];default:return null}}function i4e(t){return Eme[t.hour<12?0:1]}function r4e(t,e){return Sme(e)[t.weekday-1]}function n4e(t,e){return wme(e)[t.month-1]}function s4e(t,e){return Cme(e)[t.year<0?0:1]}function o4e(t,e,i="always",r=!1){const n={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},s=["hours","minutes","seconds"].indexOf(t)===-1;if(i==="auto"&&s){const d=t==="days";switch(e){case 1:return d?"tomorrow":`next ${n[t][0]}`;case-1:return d?"yesterday":`last ${n[t][0]}`;case 0:return d?"today":`this ${n[t][0]}`}}const o=Object.is(e,-0)||e<0,a=Math.abs(e),l=a===1,c=n[t],u=r?l?c[1]:c[2]||c[1]:l?n[t][0]:t;return o?`${a} ${u} ago`:`in ${a} ${u}`}function uQ(t,e){let i="";for(const r of t)r.literal?i+=r.val:i+=e(r.val);return i}const a4e={D:eN,DD:Kfe,DDD:Qfe,DDDD:eme,t:tme,tt:ime,ttt:rme,tttt:nme,T:sme,TT:ome,TTT:ame,TTTT:lme,f:cme,ff:hme,fff:pme,ffff:mme,F:ume,FF:dme,FFF:fme,FFFF:gme};class Na{static create(e,i={}){return new Na(e,i)}static parseFormat(e){let i=null,r="",n=!1;const s=[];for(let o=0;o<e.length;o++){const a=e.charAt(o);a==="'"?(r.length>0&&s.push({literal:n||/^\s+$/.test(r),val:r}),i=null,r="",n=!n):n||a===i?r+=a:(r.length>0&&s.push({literal:/^\s+$/.test(r),val:r}),r=a,i=a)}return r.length>0&&s.push({literal:n||/^\s+$/.test(r),val:r}),s}static macroTokenToFormatOpts(e){return a4e[e]}constructor(e,i){this.opts=i,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,i){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...i}).format()}dtFormatter(e,i={}){return this.loc.dtFormatter(e,{...this.opts,...i})}formatDateTime(e,i){return this.dtFormatter(e,i).format()}formatDateTimeParts(e,i){return this.dtFormatter(e,i).formatToParts()}formatInterval(e,i){return this.dtFormatter(e.start,i).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,i){return this.dtFormatter(e,i).resolvedOptions()}num(e,i=0){if(this.opts.forceSimple)return Fs(e,i);const r={...this.opts};return i>0&&(r.padTo=i),this.loc.numberFormatter(r).format(e)}formatDateTimeFromString(e,i){const r=this.loc.listingMode()==="en",n=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",s=(m,y)=>this.loc.extract(e,m,y),o=m=>e.isOffsetFixed&&e.offset===0&&m.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,m.format):"",a=()=>r?i4e(e):s({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(m,y)=>r?n4e(e,m):s(y?{month:m}:{month:m,day:"numeric"},"month"),c=(m,y)=>r?r4e(e,m):s(y?{weekday:m}:{weekday:m,month:"long",day:"numeric"},"weekday"),u=m=>{const y=Na.macroTokenToFormatOpts(m);return y?this.formatWithSystemDefault(e,y):m},d=m=>r?s4e(e,m):s({era:m},"era"),p=m=>{switch(m){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return a();case"d":return n?s({day:"numeric"},"day"):this.num(e.day);case"dd":return n?s({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return n?s({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return n?s({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return n?s({month:"numeric"},"month"):this.num(e.month);case"MM":return n?s({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return n?s({year:"numeric"},"year"):this.num(e.year);case"yy":return n?s({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return n?s({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return n?s({year:"numeric"},"year"):this.num(e.year,6);case"G":return d("short");case"GG":return d("long");case"GGGGG":return d("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return u(m)}};return uQ(Na.parseFormat(i),p)}formatDurationFromString(e,i){const r=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},n=l=>c=>{const u=r(c);return u?this.num(l.get(u),c.length):c},s=Na.parseFormat(i),o=s.reduce((l,{literal:c,val:u})=>c?l:l.concat(u),[]),a=e.shiftTo(...o.map(r).filter(l=>l));return uQ(s,n(a))}}class Od{constructor(e,i){this.reason=e,this.explanation=i}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const Ame=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function LS(...t){const e=t.reduce((i,r)=>i+r.source,"");return RegExp(`^${e}$`)}function DS(...t){return e=>t.reduce(([i,r,n],s)=>{const[o,a,l]=s(e,n);return[{...i,...o},a||r,l]},[{},null,1]).slice(0,2)}function NS(t,...e){if(t==null)return[null,null];for(const[i,r]of e){const n=i.exec(t);if(n)return r(n)}return[null,null]}function Ome(...t){return(e,i)=>{const r={};let n;for(n=0;n<t.length;n++)r[t[n]]=dy(e[i+n]);return[r,null,i+n]}}const Rme=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,l4e=`(?:${Rme.source}?(?:\\[(${Ame.source})\\])?)?`,Zq=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,Pme=RegExp(`${Zq.source}${l4e}`),Jq=RegExp(`(?:T${Pme.source})?`),c4e=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,u4e=/(\d{4})-?W(\d\d)(?:-?(\d))?/,h4e=/(\d{4})-?(\d{3})/,d4e=Ome("weekYear","weekNumber","weekDay"),p4e=Ome("year","ordinal"),f4e=/(\d{4})-(\d\d)-(\d\d)/,Mme=RegExp(`${Zq.source} ?(?:${Rme.source}|(${Ame.source}))?`),m4e=RegExp(`(?: ${Mme.source})?`);function sT(t,e,i){const r=t[e];return Gi(r)?i:dy(r)}function g4e(t,e){return[{year:sT(t,e),month:sT(t,e+1,1),day:sT(t,e+2,1)},null,e+3]}function FS(t,e){return[{hours:sT(t,e,0),minutes:sT(t,e+1,0),seconds:sT(t,e+2,0),milliseconds:Yq(t[e+3])},null,e+4]}function mR(t,e){const i=!t[e]&&!t[e+1],r=j4(t[e+1],t[e+2]),n=i?null:Fa.instance(r);return[{},n,e+3]}function gR(t,e){const i=t[e]?Wd.create(t[e]):null;return[{},i,e+1]}const y4e=RegExp(`^T?${Zq.source}$`),_4e=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function v4e(t){const[e,i,r,n,s,o,a,l,c]=t,u=e[0]==="-",d=l&&l[0]==="-",p=(m,y=!1)=>m!==void 0&&(y||m&&u)?-m:m;return[{years:p(W_(i)),months:p(W_(r)),weeks:p(W_(n)),days:p(W_(s)),hours:p(W_(o)),minutes:p(W_(a)),seconds:p(W_(l),l==="-0"),milliseconds:p(Yq(c),d)}]}const b4e={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function Kq(t,e,i,r,n,s,o){const a={year:e.length===2?U9(dy(e)):dy(e),month:bme.indexOf(i)+1,day:dy(r),hour:dy(n),minute:dy(s)};return o&&(a.second=dy(o)),t&&(a.weekday=t.length>3?xme.indexOf(t)+1:Tme.indexOf(t)+1),a}const w4e=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function x4e(t){const[,e,i,r,n,s,o,a,l,c,u,d]=t,p=Kq(e,n,r,i,s,o,a);let m;return l?m=b4e[l]:c?m=0:m=j4(u,d),[p,new Fa(m)]}function T4e(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const S4e=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,E4e=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,C4e=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function hQ(t){const[,e,i,r,n,s,o,a]=t;return[Kq(e,n,r,i,s,o,a),Fa.utcInstance]}function A4e(t){const[,e,i,r,n,s,o,a]=t;return[Kq(e,a,i,r,n,s,o),Fa.utcInstance]}const O4e=LS(c4e,Jq),R4e=LS(u4e,Jq),P4e=LS(h4e,Jq),M4e=LS(Pme),$me=DS(g4e,FS,mR,gR),$4e=DS(d4e,FS,mR,gR),I4e=DS(p4e,FS,mR,gR),L4e=DS(FS,mR,gR);function D4e(t){return NS(t,[O4e,$me],[R4e,$4e],[P4e,I4e],[M4e,L4e])}function N4e(t){return NS(T4e(t),[w4e,x4e])}function F4e(t){return NS(t,[S4e,hQ],[E4e,hQ],[C4e,A4e])}function k4e(t){return NS(t,[_4e,v4e])}const U4e=DS(FS);function z4e(t){return NS(t,[y4e,U4e])}const B4e=LS(f4e,m4e),V4e=LS(Mme),G4e=DS(FS,mR,gR);function j4e(t){return NS(t,[B4e,$me],[V4e,G4e])}const dQ="Invalid Duration",Ime={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},H4e={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...Ime},wu=146097/400,Cw=146097/4800,q4e={years:{quarters:4,months:12,weeks:wu/7,days:wu,hours:wu*24,minutes:wu*24*60,seconds:wu*24*60*60,milliseconds:wu*24*60*60*1e3},quarters:{months:3,weeks:wu/28,days:wu/4,hours:wu*24/4,minutes:wu*24*60/4,seconds:wu*24*60*60/4,milliseconds:wu*24*60*60*1e3/4},months:{weeks:Cw/7,days:Cw,hours:Cw*24,minutes:Cw*24*60,seconds:Cw*24*60*60,milliseconds:Cw*24*60*60*1e3},...Ime},U1=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],W4e=U1.slice(0).reverse();function l0(t,e,i=!1){const r={values:i?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new cr(r)}function Lme(t,e){let i=e.milliseconds??0;for(const r of W4e.slice(1))e[r]&&(i+=e[r]*t[r].milliseconds);return i}function pQ(t,e){const i=Lme(t,e)<0?-1:1;U1.reduceRight((r,n)=>{if(Gi(e[n]))return r;if(r){const s=e[r]*i,o=t[n][r],a=Math.floor(s/o);e[n]+=a*i,e[r]-=a*o*i}return n},null),U1.reduce((r,n)=>{if(Gi(e[n]))return r;if(r){const s=e[r]%1;e[r]-=s,e[n]+=s*t[r][n]}return n},null)}function Y4e(t){const e={};for(const[i,r]of Object.entries(t))r!==0&&(e[i]=r);return e}class cr{constructor(e){const i=e.conversionAccuracy==="longterm"||!1;let r=i?q4e:H4e;e.matrix&&(r=e.matrix),this.values=e.values,this.loc=e.loc||Pn.create(),this.conversionAccuracy=i?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=r,this.isLuxonDuration=!0}static fromMillis(e,i){return cr.fromObject({milliseconds:e},i)}static fromObject(e,i={}){if(e==null||typeof e!="object")throw new Xu(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new cr({values:rN(e,cr.normalizeUnit),loc:Pn.fromObject(i),conversionAccuracy:i.conversionAccuracy,matrix:i.matrix})}static fromDurationLike(e){if(Q1(e))return cr.fromMillis(e);if(cr.isDuration(e))return e;if(typeof e=="object")return cr.fromObject(e);throw new Xu(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,i){const[r]=k4e(e);return r?cr.fromObject(r,i):cr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,i){const[r]=z4e(e);return r?cr.fromObject(r,i):cr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,i=null){if(!e)throw new Xu("need to specify a reason the Duration is invalid");const r=e instanceof Od?e:new Od(e,i);if(Ds.throwOnInvalid)throw new E5e(r);return new cr({invalid:r})}static normalizeUnit(e){const i={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!i)throw new Jfe(e);return i}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,i={}){const r={...i,floor:i.round!==!1&&i.floor!==!1};return this.isValid?Na.create(this.loc,r).formatDurationFromString(this,e):dQ}toHuman(e={}){if(!this.isValid)return dQ;const i=U1.map(r=>{const n=this.values[r];return Gi(n)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:r.slice(0,-1)}).format(n)}).filter(r=>r);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(i)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=Xq(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const i=this.toMillis();return i<0||i>=864e5?null:(e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e,includeOffset:!1},Zt.fromMillis(i,{zone:"UTC"}).toISOTime(e))}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.isValid?Lme(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const i=cr.fromDurationLike(e),r={};for(const n of U1)(YT(i.values,n)||YT(this.values,n))&&(r[n]=i.get(n)+this.get(n));return l0(this,{values:r},!0)}minus(e){if(!this.isValid)return this;const i=cr.fromDurationLike(e);return this.plus(i.negate())}mapUnits(e){if(!this.isValid)return this;const i={};for(const r of Object.keys(this.values))i[r]=vme(e(this.values[r],r));return l0(this,{values:i},!0)}get(e){return this[cr.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const i={...this.values,...rN(e,cr.normalizeUnit)};return l0(this,{values:i})}reconfigure({locale:e,numberingSystem:i,conversionAccuracy:r,matrix:n}={}){const o={loc:this.loc.clone({locale:e,numberingSystem:i}),matrix:n,conversionAccuracy:r};return l0(this,o)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return pQ(this.matrix,e),l0(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=Y4e(this.normalize().shiftToAll().toObject());return l0(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(o=>cr.normalizeUnit(o));const i={},r={},n=this.toObject();let s;for(const o of U1)if(e.indexOf(o)>=0){s=o;let a=0;for(const c in r)a+=this.matrix[c][o]*r[c],r[c]=0;Q1(n[o])&&(a+=n[o]);const l=Math.trunc(a);i[o]=l,r[o]=(a*1e3-l*1e3)/1e3}else Q1(n[o])&&(r[o]=n[o]);for(const o in r)r[o]!==0&&(i[s]+=o===s?r[o]:r[o]/this.matrix[s][o]);return pQ(this.matrix,i),l0(this,{values:i},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const i of Object.keys(this.values))e[i]=this.values[i]===0?0:-this.values[i];return l0(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function i(r,n){return r===void 0||r===0?n===void 0||n===0:r===n}for(const r of U1)if(!i(this.values[r],e.values[r]))return!1;return!0}}const Aw="Invalid Interval";function X4e(t,e){return!t||!t.isValid?Qn.invalid("missing or invalid start"):!e||!e.isValid?Qn.invalid("missing or invalid end"):e<t?Qn.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class Qn{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,i=null){if(!e)throw new Xu("need to specify a reason the Interval is invalid");const r=e instanceof Od?e:new Od(e,i);if(Ds.throwOnInvalid)throw new S5e(r);return new Qn({invalid:r})}static fromDateTimes(e,i){const r=cE(e),n=cE(i),s=X4e(r,n);return s??new Qn({start:r,end:n})}static after(e,i){const r=cr.fromDurationLike(i),n=cE(e);return Qn.fromDateTimes(n,n.plus(r))}static before(e,i){const r=cr.fromDurationLike(i),n=cE(e);return Qn.fromDateTimes(n.minus(r),n)}static fromISO(e,i){const[r,n]=(e||"").split("/",2);if(r&&n){let s,o;try{s=Zt.fromISO(r,i),o=s.isValid}catch{o=!1}let a,l;try{a=Zt.fromISO(n,i),l=a.isValid}catch{l=!1}if(o&&l)return Qn.fromDateTimes(s,a);if(o){const c=cr.fromISO(n,i);if(c.isValid)return Qn.after(s,c)}else if(l){const c=cr.fromISO(r,i);if(c.isValid)return Qn.before(a,c)}}return Qn.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds"){if(!this.isValid)return NaN;const i=this.start.startOf(e),r=this.end.startOf(e);return Math.floor(r.diff(i,e).get(e))+(r.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:i}={}){return this.isValid?Qn.fromDateTimes(e||this.s,i||this.e):this}splitAt(...e){if(!this.isValid)return[];const i=e.map(cE).filter(o=>this.contains(o)).sort(),r=[];let{s:n}=this,s=0;for(;n<this.e;){const o=i[s]||this.e,a=+o>+this.e?this.e:o;r.push(Qn.fromDateTimes(n,a)),n=a,s+=1}return r}splitBy(e){const i=cr.fromDurationLike(e);if(!this.isValid||!i.isValid||i.as("milliseconds")===0)return[];let{s:r}=this,n=1,s;const o=[];for(;r<this.e;){const a=this.start.plus(i.mapUnits(l=>l*n));s=+a>+this.e?this.e:a,o.push(Qn.fromDateTimes(r,s)),r=s,n+=1}return o}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const i=this.s>e.s?this.s:e.s,r=this.e<e.e?this.e:e.e;return i>=r?null:Qn.fromDateTimes(i,r)}union(e){if(!this.isValid)return this;const i=this.s<e.s?this.s:e.s,r=this.e>e.e?this.e:e.e;return Qn.fromDateTimes(i,r)}static merge(e){const[i,r]=e.sort((n,s)=>n.s-s.s).reduce(([n,s],o)=>s?s.overlaps(o)||s.abutsStart(o)?[n,s.union(o)]:[n.concat([s]),o]:[n,o],[[],null]);return r&&i.push(r),i}static xor(e){let i=null,r=0;const n=[],s=e.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...s),a=o.sort((l,c)=>l.time-c.time);for(const l of a)r+=l.type==="s"?1:-1,r===1?i=l.time:(i&&+i!=+l.time&&n.push(Qn.fromDateTimes(i,l.time)),i=null);return Qn.merge(n)}difference(...e){return Qn.xor([this].concat(e)).map(i=>this.intersection(i)).filter(i=>i&&!i.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} – ${this.e.toISO()})`:Aw}toLocaleString(e=eN,i={}){return this.isValid?Na.create(this.s.loc.clone(i),e).formatInterval(this):Aw}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:Aw}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:Aw}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:Aw}toFormat(e,{separator:i=" – "}={}){return this.isValid?`${this.s.toFormat(e)}${i}${this.e.toFormat(e)}`:Aw}toDuration(e,i){return this.isValid?this.e.diff(this.s,e,i):cr.invalid(this.invalidReason)}mapEndpoints(e){return Qn.fromDateTimes(e(this.s),e(this.e))}}class EP{static hasDST(e=Ds.defaultZone){const i=Zt.now().setZone(e).set({month:12});return!e.isUniversal&&i.offset!==i.set({month:6}).offset}static isValidIANAZone(e){return Wd.isValidZone(e)}static normalizeZone(e){return by(e,Ds.defaultZone)}static months(e="long",{locale:i=null,numberingSystem:r=null,locObj:n=null,outputCalendar:s="gregory"}={}){return(n||Pn.create(i,r,s)).months(e)}static monthsFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:n=null,outputCalendar:s="gregory"}={}){return(n||Pn.create(i,r,s)).months(e,!0)}static weekdays(e="long",{locale:i=null,numberingSystem:r=null,locObj:n=null}={}){return(n||Pn.create(i,r,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:n=null}={}){return(n||Pn.create(i,r,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return Pn.create(e).meridiems()}static eras(e="short",{locale:i=null}={}){return Pn.create(i,null,"gregory").eras(e)}static features(){return{relative:yme()}}}function fQ(t,e){const i=n=>n.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=i(e)-i(t);return Math.floor(cr.fromMillis(r).as("days"))}function Z4e(t,e,i){const r=[["years",(l,c)=>c.year-l.year],["quarters",(l,c)=>c.quarter-l.quarter+(c.year-l.year)*4],["months",(l,c)=>c.month-l.month+(c.year-l.year)*12],["weeks",(l,c)=>{const u=fQ(l,c);return(u-u%7)/7}],["days",fQ]],n={},s=t;let o,a;for(const[l,c]of r)i.indexOf(l)>=0&&(o=l,n[l]=c(t,e),a=s.plus(n),a>e?(n[l]--,t=s.plus(n),t>e&&(a=t,n[l]--,t=s.plus(n))):t=a);return[t,n,a,o]}function J4e(t,e,i,r){let[n,s,o,a]=Z4e(t,e,i);const l=e-n,c=i.filter(d=>["hours","minutes","seconds","milliseconds"].indexOf(d)>=0);c.length===0&&(o<e&&(o=n.plus({[a]:1})),o!==n&&(s[a]=(s[a]||0)+l/(o-n)));const u=cr.fromObject(s,r);return c.length>0?cr.fromMillis(l,r).shiftTo(...c).plus(u):u}const Qq={arab:"[٠-٩]",arabext:"[۰-۹]",bali:"[᭐-᭙]",beng:"[০-৯]",deva:"[०-९]",fullwide:"[０-９]",gujr:"[૦-૯]",hanidec:"[〇|一|二|三|四|五|六|七|八|九]",khmr:"[០-៩]",knda:"[೦-೯]",laoo:"[໐-໙]",limb:"[᥆-᥏]",mlym:"[൦-൯]",mong:"[᠐-᠙]",mymr:"[၀-၉]",orya:"[୦-୯]",tamldec:"[௦-௯]",telu:"[౦-౯]",thai:"[๐-๙]",tibt:"[༠-༩]",latn:"\\d"},mQ={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},K4e=Qq.hanidec.replace(/[\[|\]]/g,"").split("");function Q4e(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);if(t[i].search(Qq.hanidec)!==-1)e+=K4e.indexOf(t[i]);else for(const n in mQ){const[s,o]=mQ[n];r>=s&&r<=o&&(e+=r-s)}}return parseInt(e,10)}else return e}function Nh({numberingSystem:t},e=""){return new RegExp(`${Qq[t||"latn"]}${e}`)}const eFe="missing Intl.DateTimeFormat.formatToParts support";function Tr(t,e=i=>i){return{regex:t,deser:([i])=>e(Q4e(i))}}const tFe=String.fromCharCode(160),Dme=`[ ${tFe}]`,Nme=new RegExp(Dme,"g");function iFe(t){return t.replace(/\./g,"\\.?").replace(Nme,Dme)}function gQ(t){return t.replace(/\./g,"").replace(Nme," ").toLowerCase()}function Fh(t,e){return t===null?null:{regex:RegExp(t.map(iFe).join("|")),deser:([i])=>t.findIndex(r=>gQ(i)===gQ(r))+e}}function yQ(t,e){return{regex:t,deser:([,i,r])=>j4(i,r),groups:e}}function CP(t){return{regex:t,deser:([e])=>e}}function rFe(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function nFe(t,e){const i=Nh(e),r=Nh(e,"{2}"),n=Nh(e,"{3}"),s=Nh(e,"{4}"),o=Nh(e,"{6}"),a=Nh(e,"{1,2}"),l=Nh(e,"{1,3}"),c=Nh(e,"{1,6}"),u=Nh(e,"{1,9}"),d=Nh(e,"{2,4}"),p=Nh(e,"{4,6}"),m=v=>({regex:RegExp(rFe(v.val)),deser:([w])=>w,literal:!0}),_=(v=>{if(t.literal)return m(v);switch(v.val){case"G":return Fh(e.eras("short"),0);case"GG":return Fh(e.eras("long"),0);case"y":return Tr(c);case"yy":return Tr(d,U9);case"yyyy":return Tr(s);case"yyyyy":return Tr(p);case"yyyyyy":return Tr(o);case"M":return Tr(a);case"MM":return Tr(r);case"MMM":return Fh(e.months("short",!0),1);case"MMMM":return Fh(e.months("long",!0),1);case"L":return Tr(a);case"LL":return Tr(r);case"LLL":return Fh(e.months("short",!1),1);case"LLLL":return Fh(e.months("long",!1),1);case"d":return Tr(a);case"dd":return Tr(r);case"o":return Tr(l);case"ooo":return Tr(n);case"HH":return Tr(r);case"H":return Tr(a);case"hh":return Tr(r);case"h":return Tr(a);case"mm":return Tr(r);case"m":return Tr(a);case"q":return Tr(a);case"qq":return Tr(r);case"s":return Tr(a);case"ss":return Tr(r);case"S":return Tr(l);case"SSS":return Tr(n);case"u":return CP(u);case"uu":return CP(a);case"uuu":return Tr(i);case"a":return Fh(e.meridiems(),0);case"kkkk":return Tr(s);case"kk":return Tr(d,U9);case"W":return Tr(a);case"WW":return Tr(r);case"E":case"c":return Tr(i);case"EEE":return Fh(e.weekdays("short",!1),1);case"EEEE":return Fh(e.weekdays("long",!1),1);case"ccc":return Fh(e.weekdays("short",!0),1);case"cccc":return Fh(e.weekdays("long",!0),1);case"Z":case"ZZ":return yQ(new RegExp(`([+-]${a.source})(?::(${r.source}))?`),2);case"ZZZ":return yQ(new RegExp(`([+-]${a.source})(${r.source})?`),2);case"z":return CP(/[a-z_+-/]{1,256}?/i);case" ":return CP(/[^\S\n\r]/);default:return m(v)}})(t)||{invalidReason:eFe};return _.token=t,_}const sFe={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function oFe(t,e,i){const{type:r,value:n}=t;if(r==="literal"){const l=/^\s+$/.test(n);return{literal:!l,val:l?" ":n}}const s=e[r];let o=r;r==="hour"&&(e.hour12!=null?o=e.hour12?"hour12":"hour24":e.hourCycle!=null?e.hourCycle==="h11"||e.hourCycle==="h12"?o="hour12":o="hour24":o=i.hour12?"hour12":"hour24");let a=sFe[o];if(typeof a=="object"&&(a=a[s]),a)return{literal:!1,val:a}}function aFe(t){return[`^${t.map(i=>i.regex).reduce((i,r)=>`${i}(${r.source})`,"")}$`,t]}function lFe(t,e,i){const r=t.match(e);if(r){const n={};let s=1;for(const o in i)if(YT(i,o)){const a=i[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(n[a.token.val[0]]=a.deser(r.slice(s,s+l))),s+=l}return[r,n]}else return[r,{}]}function cFe(t){const e=s=>{switch(s){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let i=null,r;return Gi(t.z)||(i=Wd.create(t.z)),Gi(t.Z)||(i||(i=new Fa(t.Z)),r=t.Z),Gi(t.q)||(t.M=(t.q-1)*3+1),Gi(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),Gi(t.u)||(t.S=Yq(t.u)),[Object.keys(t).reduce((s,o)=>{const a=e(o);return a&&(s[a]=t[o]),s},{}),i,r]}let u6=null;function uFe(){return u6||(u6=Zt.fromMillis(1555555555555)),u6}function hFe(t,e){if(t.literal)return t;const i=Na.macroTokenToFormatOpts(t.val),r=Ume(i,e);return r==null||r.includes(void 0)?t:r}function Fme(t,e){return Array.prototype.concat(...t.map(i=>hFe(i,e)))}function kme(t,e,i){const r=Fme(Na.parseFormat(i),t),n=r.map(o=>nFe(o,t)),s=n.find(o=>o.invalidReason);if(s)return{input:e,tokens:r,invalidReason:s.invalidReason};{const[o,a]=aFe(n),l=RegExp(o,"i"),[c,u]=lFe(e,l,a),[d,p,m]=u?cFe(u):[null,null,void 0];if(YT(u,"a")&&YT(u,"H"))throw new RC("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:r,regex:l,rawMatches:c,matches:u,result:d,zone:p,specificOffset:m}}}function dFe(t,e,i){const{result:r,zone:n,specificOffset:s,invalidReason:o}=kme(t,e,i);return[r,n,s,o]}function Ume(t,e){if(!t)return null;const r=Na.create(e,t).dtFormatter(uFe()),n=r.formatToParts(),s=r.resolvedOptions();return n.map(o=>oFe(o,t,s))}const zme=[0,31,59,90,120,151,181,212,243,273,304,334],Bme=[0,31,60,91,121,152,182,213,244,274,305,335];function nh(t,e){return new Od("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function Vme(t,e,i){const r=new Date(Date.UTC(t,e-1,i));t<100&&t>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);const n=r.getUTCDay();return n===0?7:n}function Gme(t,e,i){return i+(fR(t)?Bme:zme)[e-1]}function jme(t,e){const i=fR(t)?Bme:zme,r=i.findIndex(s=>s<e),n=e-i[r];return{month:r+1,day:n}}function z9(t){const{year:e,month:i,day:r}=t,n=Gme(e,i,r),s=Vme(e,i,r);let o=Math.floor((n-s+10)/7),a;return o<1?(a=e-1,o=iN(a)):o>iN(e)?(a=e+1,o=1):a=e,{weekYear:a,weekNumber:o,weekday:s,...H4(t)}}function _Q(t){const{weekYear:e,weekNumber:i,weekday:r}=t,n=Vme(e,1,4),s=XA(e);let o=i*7+r-n-3,a;o<1?(a=e-1,o+=XA(a)):o>s?(a=e+1,o-=XA(e)):a=e;const{month:l,day:c}=jme(a,o);return{year:a,month:l,day:c,...H4(t)}}function h6(t){const{year:e,month:i,day:r}=t,n=Gme(e,i,r);return{year:e,ordinal:n,...H4(t)}}function vQ(t){const{year:e,ordinal:i}=t,{month:r,day:n}=jme(e,i);return{year:e,month:r,day:n,...H4(t)}}function pFe(t){const e=V4(t.weekYear),i=ig(t.weekNumber,1,iN(t.weekYear)),r=ig(t.weekday,1,7);return e?i?r?!1:nh("weekday",t.weekday):nh("week",t.week):nh("weekYear",t.weekYear)}function fFe(t){const e=V4(t.year),i=ig(t.ordinal,1,XA(t.year));return e?i?!1:nh("ordinal",t.ordinal):nh("year",t.year)}function Hme(t){const e=V4(t.year),i=ig(t.month,1,12),r=ig(t.day,1,tN(t.year,t.month));return e?i?r?!1:nh("day",t.day):nh("month",t.month):nh("year",t.year)}function qme(t){const{hour:e,minute:i,second:r,millisecond:n}=t,s=ig(e,0,23)||e===24&&i===0&&r===0&&n===0,o=ig(i,0,59),a=ig(r,0,59),l=ig(n,0,999);return s?o?a?l?!1:nh("millisecond",n):nh("second",r):nh("minute",i):nh("hour",e)}const d6="Invalid DateTime",bQ=864e13;function AP(t){return new Od("unsupported zone",`the zone "${t.name}" is not supported`)}function p6(t){return t.weekData===null&&(t.weekData=z9(t.c)),t.weekData}function Y_(t,e){const i={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new Zt({...i,...e,old:i})}function Wme(t,e,i){let r=t-e*60*1e3;const n=i.offset(r);if(e===n)return[r,e];r-=(n-e)*60*1e3;const s=i.offset(r);return n===s?[r,n]:[t-Math.min(n,s)*60*1e3,Math.max(n,s)]}function OP(t,e){t+=e*60*1e3;const i=new Date(t);return{year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate(),hour:i.getUTCHours(),minute:i.getUTCMinutes(),second:i.getUTCSeconds(),millisecond:i.getUTCMilliseconds()}}function kI(t,e,i){return Wme(G4(t),e,i)}function wQ(t,e){const i=t.o,r=t.c.year+Math.trunc(e.years),n=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,s={...t.c,year:r,month:n,day:Math.min(t.c.day,tN(r,n))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},o=cr.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),a=G4(s);let[l,c]=Wme(a,i,t.zone);return o!==0&&(l+=o,c=t.zone.offset(l)),{ts:l,o:c}}function lE(t,e,i,r,n,s){const{setZone:o,zone:a}=i;if(t&&Object.keys(t).length!==0||e){const l=e||a,c=Zt.fromObject(t,{...i,zone:l,specificOffset:s});return o?c:c.setZone(a)}else return Zt.invalid(new Od("unparsable",`the input "${n}" can't be parsed as ${r}`))}function RP(t,e,i=!0){return t.isValid?Na.create(Pn.create("en-US"),{allowZ:i,forceSimple:!0}).formatDateTimeFromString(t,e):null}function f6(t,e){const i=t.c.year>9999||t.c.year<0;let r="";return i&&t.c.year>=0&&(r+="+"),r+=Fs(t.c.year,i?6:4),e?(r+="-",r+=Fs(t.c.month),r+="-",r+=Fs(t.c.day)):(r+=Fs(t.c.month),r+=Fs(t.c.day)),r}function xQ(t,e,i,r,n,s){let o=Fs(t.c.hour);return e?(o+=":",o+=Fs(t.c.minute),(t.c.millisecond!==0||t.c.second!==0||!i)&&(o+=":")):o+=Fs(t.c.minute),(t.c.millisecond!==0||t.c.second!==0||!i)&&(o+=Fs(t.c.second),(t.c.millisecond!==0||!r)&&(o+=".",o+=Fs(t.c.millisecond,3))),n&&(t.isOffsetFixed&&t.offset===0&&!s?o+="Z":t.o<0?(o+="-",o+=Fs(Math.trunc(-t.o/60)),o+=":",o+=Fs(Math.trunc(-t.o%60))):(o+="+",o+=Fs(Math.trunc(t.o/60)),o+=":",o+=Fs(Math.trunc(t.o%60)))),s&&(o+="["+t.zone.ianaName+"]"),o}const Yme={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},mFe={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},gFe={ordinal:1,hour:0,minute:0,second:0,millisecond:0},Xme=["year","month","day","hour","minute","second","millisecond"],yFe=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],_Fe=["year","ordinal","hour","minute","second","millisecond"];function TQ(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new Jfe(t);return e}function SQ(t,e){const i=by(e.zone,Ds.defaultZone),r=Pn.fromObject(e),n=Ds.now();let s,o;if(Gi(t.year))s=n;else{for(const c of Xme)Gi(t[c])&&(t[c]=Yme[c]);const a=Hme(t)||qme(t);if(a)return Zt.invalid(a);const l=i.offset(n);[s,o]=kI(t,l,i)}return new Zt({ts:s,zone:i,loc:r,o})}function EQ(t,e,i){const r=Gi(i.round)?!0:i.round,n=(o,a)=>(o=Xq(o,r||i.calendary?0:2,!0),e.loc.clone(i).relFormatter(i).format(o,a)),s=o=>i.calendary?e.hasSame(t,o)?0:e.startOf(o).diff(t.startOf(o),o).get(o):e.diff(t,o).get(o);if(i.unit)return n(s(i.unit),i.unit);for(const o of i.units){const a=s(o);if(Math.abs(a)>=1)return n(a,o)}return n(t>e?-0:0,i.units[i.units.length-1])}function CQ(t){let e={},i;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],i=Array.from(t).slice(0,t.length-1)):i=Array.from(t),[e,i]}class Zt{constructor(e){const i=e.zone||Ds.defaultZone;let r=e.invalid||(Number.isNaN(e.ts)?new Od("invalid input"):null)||(i.isValid?null:AP(i));this.ts=Gi(e.ts)?Ds.now():e.ts;let n=null,s=null;if(!r)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(i))[n,s]=[e.old.c,e.old.o];else{const a=i.offset(this.ts);n=OP(this.ts,a),r=Number.isNaN(n.year)?new Od("invalid input"):null,n=r?null:n,s=r?null:a}this._zone=i,this.loc=e.loc||Pn.create(),this.invalid=r,this.weekData=null,this.c=n,this.o=s,this.isLuxonDateTime=!0}static now(){return new Zt({})}static local(){const[e,i]=CQ(arguments),[r,n,s,o,a,l,c]=i;return SQ({year:r,month:n,day:s,hour:o,minute:a,second:l,millisecond:c},e)}static utc(){const[e,i]=CQ(arguments),[r,n,s,o,a,l,c]=i;return e.zone=Fa.utcInstance,SQ({year:r,month:n,day:s,hour:o,minute:a,second:l,millisecond:c},e)}static fromJSDate(e,i={}){const r=q5e(e)?e.valueOf():NaN;if(Number.isNaN(r))return Zt.invalid("invalid input");const n=by(i.zone,Ds.defaultZone);return n.isValid?new Zt({ts:r,zone:n,loc:Pn.fromObject(i)}):Zt.invalid(AP(n))}static fromMillis(e,i={}){if(Q1(e))return e<-bQ||e>bQ?Zt.invalid("Timestamp out of range"):new Zt({ts:e,zone:by(i.zone,Ds.defaultZone),loc:Pn.fromObject(i)});throw new Xu(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,i={}){if(Q1(e))return new Zt({ts:e*1e3,zone:by(i.zone,Ds.defaultZone),loc:Pn.fromObject(i)});throw new Xu("fromSeconds requires a numerical input")}static fromObject(e,i={}){e=e||{};const r=by(i.zone,Ds.defaultZone);if(!r.isValid)return Zt.invalid(AP(r));const n=Ds.now(),s=Gi(i.specificOffset)?r.offset(n):i.specificOffset,o=rN(e,TQ),a=!Gi(o.ordinal),l=!Gi(o.year),c=!Gi(o.month)||!Gi(o.day),u=l||c,d=o.weekYear||o.weekNumber,p=Pn.fromObject(i);if((u||a)&&d)throw new RC("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&a)throw new RC("Can't mix ordinal dates with month/day");const m=d||o.weekday&&!u;let y,_,v=OP(n,s);m?(y=yFe,_=mFe,v=z9(v)):a?(y=_Fe,_=gFe,v=h6(v)):(y=Xme,_=Yme);let w=!1;for(const N of y){const F=o[N];Gi(F)?w?o[N]=_[N]:o[N]=v[N]:w=!0}const x=m?pFe(o):a?fFe(o):Hme(o),T=x||qme(o);if(T)return Zt.invalid(T);const S=m?_Q(o):a?vQ(o):o,[E,A]=kI(S,s,r),P=new Zt({ts:E,zone:r,o:A,loc:p});return o.weekday&&u&&e.weekday!==P.weekday?Zt.invalid("mismatched weekday",`you can't specify both a weekday of ${o.weekday} and a date of ${P.toISO()}`):P}static fromISO(e,i={}){const[r,n]=D4e(e);return lE(r,n,i,"ISO 8601",e)}static fromRFC2822(e,i={}){const[r,n]=N4e(e);return lE(r,n,i,"RFC 2822",e)}static fromHTTP(e,i={}){const[r,n]=F4e(e);return lE(r,n,i,"HTTP",i)}static fromFormat(e,i,r={}){if(Gi(e)||Gi(i))throw new Xu("fromFormat requires an input string and a format");const{locale:n=null,numberingSystem:s=null}=r,o=Pn.fromOpts({locale:n,numberingSystem:s,defaultToEN:!0}),[a,l,c,u]=dFe(o,e,i);return u?Zt.invalid(u):lE(a,l,r,`format ${i}`,e,c)}static fromString(e,i,r={}){return Zt.fromFormat(e,i,r)}static fromSQL(e,i={}){const[r,n]=j4e(e);return lE(r,n,i,"SQL",e)}static invalid(e,i=null){if(!e)throw new Xu("need to specify a reason the DateTime is invalid");const r=e instanceof Od?e:new Od(e,i);if(Ds.throwOnInvalid)throw new T5e(r);return new Zt({invalid:r})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,i={}){const r=Ume(e,Pn.fromObject(i));return r?r.map(n=>n?n.val:null).join(""):null}static expandFormat(e,i={}){return Fme(Na.parseFormat(e),Pn.fromObject(i)).map(n=>n.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?p6(this).weekYear:NaN}get weekNumber(){return this.isValid?p6(this).weekNumber:NaN}get weekday(){return this.isValid?p6(this).weekday:NaN}get ordinal(){return this.isValid?h6(this.c).ordinal:NaN}get monthShort(){return this.isValid?EP.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?EP.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?EP.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?EP.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const e=864e5,i=6e4,r=G4(this.c),n=this.zone.offset(r-e),s=this.zone.offset(r+e),o=this.zone.offset(r-n*i),a=this.zone.offset(r-s*i);if(o===a)return[this];const l=r-o*i,c=r-a*i,u=OP(l,o),d=OP(c,a);return u.hour===d.hour&&u.minute===d.minute&&u.second===d.second&&u.millisecond===d.millisecond?[Y_(this,{ts:l}),Y_(this,{ts:c})]:[this]}get isInLeapYear(){return fR(this.year)}get daysInMonth(){return tN(this.year,this.month)}get daysInYear(){return this.isValid?XA(this.year):NaN}get weeksInWeekYear(){return this.isValid?iN(this.weekYear):NaN}resolvedLocaleOptions(e={}){const{locale:i,numberingSystem:r,calendar:n}=Na.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:i,numberingSystem:r,outputCalendar:n}}toUTC(e=0,i={}){return this.setZone(Fa.instance(e),i)}toLocal(){return this.setZone(Ds.defaultZone)}setZone(e,{keepLocalTime:i=!1,keepCalendarTime:r=!1}={}){if(e=by(e,Ds.defaultZone),e.equals(this.zone))return this;if(e.isValid){let n=this.ts;if(i||r){const s=e.offset(this.ts),o=this.toObject();[n]=kI(o,s,e)}return Y_(this,{ts:n,zone:e})}else return Zt.invalid(AP(e))}reconfigure({locale:e,numberingSystem:i,outputCalendar:r}={}){const n=this.loc.clone({locale:e,numberingSystem:i,outputCalendar:r});return Y_(this,{loc:n})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const i=rN(e,TQ),r=!Gi(i.weekYear)||!Gi(i.weekNumber)||!Gi(i.weekday),n=!Gi(i.ordinal),s=!Gi(i.year),o=!Gi(i.month)||!Gi(i.day),a=s||o,l=i.weekYear||i.weekNumber;if((a||n)&&l)throw new RC("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(o&&n)throw new RC("Can't mix ordinal dates with month/day");let c;r?c=_Q({...z9(this.c),...i}):Gi(i.ordinal)?(c={...this.toObject(),...i},Gi(i.day)&&(c.day=Math.min(tN(c.year,c.month),c.day))):c=vQ({...h6(this.c),...i});const[u,d]=kI(c,this.o,this.zone);return Y_(this,{ts:u,o:d})}plus(e){if(!this.isValid)return this;const i=cr.fromDurationLike(e);return Y_(this,wQ(this,i))}minus(e){if(!this.isValid)return this;const i=cr.fromDurationLike(e).negate();return Y_(this,wQ(this,i))}startOf(e){if(!this.isValid)return this;const i={},r=cr.normalizeUnit(e);switch(r){case"years":i.month=1;case"quarters":case"months":i.day=1;case"weeks":case"days":i.hour=0;case"hours":i.minute=0;case"minutes":i.second=0;case"seconds":i.millisecond=0;break}if(r==="weeks"&&(i.weekday=1),r==="quarters"){const n=Math.ceil(this.month/3);i.month=(n-1)*3+1}return this.set(i)}endOf(e){return this.isValid?this.plus({[e]:1}).startOf(e).minus(1):this}toFormat(e,i={}){return this.isValid?Na.create(this.loc.redefaultToEN(i)).formatDateTimeFromString(this,e):d6}toLocaleString(e=eN,i={}){return this.isValid?Na.create(this.loc.clone(i),e).formatDateTime(this):d6}toLocaleParts(e={}){return this.isValid?Na.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:i=!1,suppressMilliseconds:r=!1,includeOffset:n=!0,extendedZone:s=!1}={}){if(!this.isValid)return null;const o=e==="extended";let a=f6(this,o);return a+="T",a+=xQ(this,o,i,r,n,s),a}toISODate({format:e="extended"}={}){return this.isValid?f6(this,e==="extended"):null}toISOWeekDate(){return RP(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:i=!1,includeOffset:r=!0,includePrefix:n=!1,extendedZone:s=!1,format:o="extended"}={}){return this.isValid?(n?"T":"")+xQ(this,o==="extended",i,e,r,s):null}toRFC2822(){return RP(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return RP(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?f6(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:i=!1,includeOffsetSpace:r=!0}={}){let n="HH:mm:ss.SSS";return(i||e)&&(r&&(n+=" "),i?n+="z":e&&(n+="ZZ")),RP(this,n,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():d6}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const i={...this.c};return e.includeConfig&&(i.outputCalendar=this.outputCalendar,i.numberingSystem=this.loc.numberingSystem,i.locale=this.loc.locale),i}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,i="milliseconds",r={}){if(!this.isValid||!e.isValid)return cr.invalid("created by diffing an invalid DateTime");const n={locale:this.locale,numberingSystem:this.numberingSystem,...r},s=W5e(i).map(cr.normalizeUnit),o=e.valueOf()>this.valueOf(),a=o?this:e,l=o?e:this,c=J4e(a,l,s,n);return o?c.negate():c}diffNow(e="milliseconds",i={}){return this.diff(Zt.now(),e,i)}until(e){return this.isValid?Qn.fromDateTimes(this,e):this}hasSame(e,i){if(!this.isValid)return!1;const r=e.valueOf(),n=this.setZone(e.zone,{keepLocalTime:!0});return n.startOf(i)<=r&&r<=n.endOf(i)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const i=e.base||Zt.fromObject({},{zone:this.zone}),r=e.padding?this<i?-e.padding:e.padding:0;let n=["years","months","days","hours","minutes","seconds"],s=e.unit;return Array.isArray(e.unit)&&(n=e.unit,s=void 0),EQ(i,this.plus(r),{...e,numeric:"always",units:n,unit:s})}toRelativeCalendar(e={}){return this.isValid?EQ(e.base||Zt.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(Zt.isDateTime))throw new Xu("min requires all arguments be DateTimes");return cQ(e,i=>i.valueOf(),Math.min)}static max(...e){if(!e.every(Zt.isDateTime))throw new Xu("max requires all arguments be DateTimes");return cQ(e,i=>i.valueOf(),Math.max)}static fromFormatExplain(e,i,r={}){const{locale:n=null,numberingSystem:s=null}=r,o=Pn.fromOpts({locale:n,numberingSystem:s,defaultToEN:!0});return kme(o,e,i)}static fromStringExplain(e,i,r={}){return Zt.fromFormatExplain(e,i,r)}static get DATE_SHORT(){return eN}static get DATE_MED(){return Kfe}static get DATE_MED_WITH_WEEKDAY(){return C5e}static get DATE_FULL(){return Qfe}static get DATE_HUGE(){return eme}static get TIME_SIMPLE(){return tme}static get TIME_WITH_SECONDS(){return ime}static get TIME_WITH_SHORT_OFFSET(){return rme}static get TIME_WITH_LONG_OFFSET(){return nme}static get TIME_24_SIMPLE(){return sme}static get TIME_24_WITH_SECONDS(){return ome}static get TIME_24_WITH_SHORT_OFFSET(){return ame}static get TIME_24_WITH_LONG_OFFSET(){return lme}static get DATETIME_SHORT(){return cme}static get DATETIME_SHORT_WITH_SECONDS(){return ume}static get DATETIME_MED(){return hme}static get DATETIME_MED_WITH_SECONDS(){return dme}static get DATETIME_MED_WITH_WEEKDAY(){return A5e}static get DATETIME_FULL(){return pme}static get DATETIME_FULL_WITH_SECONDS(){return fme}static get DATETIME_HUGE(){return mme}static get DATETIME_HUGE_WITH_SECONDS(){return gme}}function cE(t){if(Zt.isDateTime(t))return t;if(t&&t.valueOf&&Q1(t.valueOf()))return Zt.fromJSDate(t);if(t&&typeof t=="object")return Zt.fromObject(t);throw new Xu(`Unknown datetime argument: ${t}, of type ${typeof t}`)}const Lf="system",eW="unknown",iO="UTC",vFe=Intl.DateTimeFormat().resolvedOptions().timeZone,bFe="shortOffset";function wFe(t){return"timeZoneIANA"in t}function xFe(t){return t.startsWith("UTC")}function UCt(t,e=!1){return{json:{read:{source:t,reader:(i,r)=>r[t]?TFe(r[t]):null},write:!!e&&{allowNull:!0,writer(i,r){r[t]=i?SFe(i):null}}}}}function TFe(t,e=Lf){return t?wFe(t)?t.timeZoneIANA:EFe(t,e):e}function SFe(t){return{timeZoneIANA:t}}function EFe(t,e=Lf){if(!t||!eQ.has(t.timeZone))return e;const i=eQ.get(t.timeZone);return xFe(t.timeZone)||t.respectsDaylightSaving?i:CFe(i)}function CFe(t){const e=Zt.local().setZone(t),i=Math.min(e.set({month:1,day:1}).offset,e.set({month:5}).offset);return i===0?"Etc/UTC":`Etc/GMT${Fa.instance(-i).formatOffset(0,"narrow")}`}function zCt(t,e,i,r,n){if(e&&n==="date")return{timeZone:iO,timeZoneName:void 0};const s=r.timeStyle||r.hour,o=i===eW;return{timeZone:o?n==="timestamp-offset"?void 0:t??iO:i,timeZoneName:o&&s?bFe:void 0}}const AFe={year:void 0,month:void 0,day:void 0,weekday:void 0},OFe={hour:void 0,minute:void 0,second:void 0},Zme={timeZone:iO},cp={year:"numeric",month:"numeric",day:"numeric"},uE={year:"numeric",month:"long",day:"numeric"},hE={year:"numeric",month:"short",day:"numeric"},dE={year:"numeric",month:"long",weekday:"long",day:"numeric"},py={hour:"numeric",minute:"numeric"},Fv={...py,second:"numeric"},Jme={hourCycle:"h23"},pE={...py,...Jme},fE={...Fv,...Jme},Kme={"short-date":cp,"short-date-short-time":{...cp,...py},"short-date-short-time-24":{...cp,...pE},"short-date-long-time":{...cp,...Fv},"short-date-long-time-24":{...cp,...fE},"short-date-le":cp,"short-date-le-short-time":{...cp,...py},"short-date-le-short-time-24":{...cp,...pE},"short-date-le-long-time":{...cp,...Fv},"short-date-le-long-time-24":{...cp,...fE},"long-month-day-year":uE,"long-month-day-year-short-time":{...uE,...py},"long-month-day-year-short-time-24":{...uE,...pE},"long-month-day-year-long-time":{...uE,...Fv},"long-month-day-year-long-time-24":{...uE,...fE},"day-short-month-year":hE,"day-short-month-year-short-time":{...hE,...py},"day-short-month-year-short-time-24":{...hE,...pE},"day-short-month-year-long-time":{...hE,...Fv},"day-short-month-year-long-time-24":{...hE,...fE},"long-date":dE,"long-date-short-time":{...dE,...py},"long-date-short-time-24":{...dE,...pE},"long-date-long-time":{...dE,...Fv},"long-date-long-time-24":{...dE,...fE},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":py,"long-time":Fv},RFe=fu()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),Qme={ar:"ar-u-nu-latn-ca-gregory"};let B9=new WeakMap;const q4=Kme["short-date-short-time"];function PFe(t){let e=B9.get(t);if(!e){const i=eu(),r=Qme[i]||i,n=tW(t.timeZone??Lf),s={...t,timeZone:n};e=new Intl.DateTimeFormat(r,s),B9.set(t,e)}return e}function MFe(t){return Kme[t]}function s_(t,e=q4){return PFe(e).format(t)}function BCt(t,e=q4){return s_(new Date(t),{...e,...Zme,...OFe})}function VCt(t,e=q4){return s_(new Date(`1970-01-01T${t}Z`),{...e,...Zme,...AFe})}function GCt(t,e=q4){if(e.timeZone)return s_(new Date(t),e);const i=Zt.fromISO(t,{setZone:!0}),r=eu(),n=Qme[r]??r,s=i.offset===0?iO:e.timeZone,o={...e,timeZone:s};return i.toLocaleString(o,{locale:n})}function tW(t){switch(t){case Lf:return vFe;case eW:return iO;default:return t}}rq(()=>{B9=new WeakMap});const $Fe={ar:"ar-u-nu-latn"};let UI=new WeakMap,ege={};function IFe(t){const e=t||ege;if(!UI.has(e)){const i=eu(),r=$Fe[eu()]||i;UI.set(e,new Intl.NumberFormat(r,t))}return UI.get(e)}function jCt(t={}){const e={};return t.digitSeparator!=null&&(e.useGrouping=t.digitSeparator),t.places!=null&&(e.minimumFractionDigits=e.maximumFractionDigits=t.places),e}function rO(t,e){return Object.is(t,-0)&&(t=0),IFe(e).format(t)}rq(()=>{UI=new WeakMap,ege={}});const tge=ne.getLogger("esri.intl.substitute");function LFe(t,e,i={}){const{format:r={}}=i;return h4(t,n=>DFe(n,e,r))}function DFe(t,e,i){let r,n;const s=t.indexOf(":");if(s===-1?r=t.trim():(r=t.slice(0,s).trim(),n=t.slice(s+1).trim()),!r)return"";const o=Km(r,e);if(o==null)return"";const a=(n?i?.[n]:null)??i?.[r];return a?NFe(o,a):n?FFe(o,n):iW(o)}function NFe(t,e){switch(e.type){case"date":return s_(t,e.intlOptions);case"number":return rO(t,e.intlOptions);default:return tge.warn("missing format descriptor for key {key}"),iW(t)}}function FFe(t,e){switch(e.toLowerCase()){case"dateformat":return s_(t);case"numberformat":return rO(t);default:return tge.warn(`inline format is unsupported since 4.12: ${e}`),/^(dateformat|datestring)/i.test(e)?s_(t):/^numberformat/i.test(e)?rO(t):iW(t)}}function iW(t){switch(typeof t){case"string":return t;case"number":return rO(t);case"boolean":return""+t;default:return t instanceof Date?s_(t):""}}async function kFe(t,e,i,r){const n=e.exec(i);if(!n)throw new W("esri-intl:invalid-bundle",`Bundle id "${i}" is not compatible with the pattern "${e}"`);const s=n[1]?`${n[1]}/`:"",o=n[2],a=j$e(r),l=`${s}${o}.json`,c=a?`${s}${o}_${a}.json`:l;let u;try{u=await AQ(t(c))}catch(d){if(c===l)throw new W("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:d});try{u=await AQ(t(l))}catch(p){throw new W("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:p})}}return u}async function AQ(t){if(OQ.fetchBundleAsset!=null)return OQ.fetchBundleAsset(t);const e=await Ii(t,{responseType:"text"});return JSON.parse(e.data)}let UFe=class{constructor({base:e="",pattern:i,location:r=new URL(window.location.href)}){let n;n=typeof r=="string"?s=>new URL(s,new URL(r,window.location.href)).href:r instanceof URL?s=>new URL(s,r).href:r,this.pattern=typeof i=="string"?new RegExp(`^${i}`):i,this.getAssetUrl=n,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)/)?(.*)$`)}fetchMessageBundle(e,i){return kFe(this.getAssetUrl,this.matcher,e,i)}};function zFe(t){return new UFe(t)}const OQ={};G$e(zFe({pattern:"esri/",location:lr}));const BFe="yyyy-MM-dd",VFe="TT";var JA;(function(t){t.HM="HH:mm",t.HMS="HH:mm:ss",t.HMS_MS="HH:mm:ss.SSS"})(JA||(JA={}));const GFe=[JA.HMS_MS,JA.HMS,JA.HM,VFe];function RQ(t){return Zt.fromFormat(t,BFe)}function PQ(t){let e=null;return GFe.find(i=>(e=Zt.fromFormat(t,i),e.isValid)),e}function MQ(t){return Zt.fromISO(t)}var XT;(function(t){t.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",t.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(XT||(XT={}));const jFe=new Set(["integer","small-integer","big-integer","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"]);function HFe(t){return t!=null&&jFe.has(t.type)}function ige(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function rge(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function nge(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}function qFe(t,e){const i=t?.domain;if(!i)return null;switch(i.type){case"range":{const{min:r,max:n}=sge(t);if(r!=null&&+e<r||n!=null&&+e>n)return XT.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(i.codedValues==null||i.codedValues.every(r=>r==null||r.code!==e))return XT.INVALID_CODED_VALUE}return null}function sge(t,e){const i=e??t?.domain;if(!i||i.type!=="range")return;const r="range"in i?i.range[0]:i.minValue,n="range"in i?i.range[1]:i.maxValue,s=HFe(t);return ige(t)||nge(t)||rge(t)?{...WFe(t,n,r),isInteger:s}:{min:r!=null&&typeof r=="number"?r:null,max:n!=null&&typeof n=="number"?n:null,rawMin:r,rawMax:n,isInteger:s}}function WFe(t,e,i){return ige(t)?{min:i!=null&&Ew(i)?RQ(i).toMillis():null,max:e!=null&&Ew(e)?RQ(e).toMillis():null,rawMin:i,rawMax:e}:nge(t)?{min:i!=null&&Ew(i)?PQ(i).toMillis():null,max:e!=null&&Ew(e)?PQ(e).toMillis():null,rawMin:i,rawMax:e}:rge(t)?{min:i!=null&&Ew(i)?MQ(i).toMillis():null,max:e!=null&&Ew(e)?MQ(e).toMillis():null,rawMin:i,rawMax:e}:{max:null,min:null}}const YFe=ne.getLogger("esri.support.arcadeOnDemand");let m6;function rW(){return m6||(m6=(async()=>{const t=await pe(()=>import("./arcadeUtils-58dad66b.js").then(e=>e.aD),["./arcadeUtils-58dad66b.js","./TimeOnly-a96593b0.js","./number-85ab87ed.js","./FieldsIndex-85e142d0.js","./hash-6f442295.js"],import.meta.url);return{arcade:t.arcade,arcadeUtils:t,Dictionary:t.Dictionary,Feature:t.arcadeFeature}})()),m6}const XFe=(t,e,i)=>nW.create(t,e,i,null,["$feature","$view"],[]),ZFe=(t,e,i)=>nW.create(t,e,i,null,["$feature","$view"],[]),qCt=(t,e,i,r)=>nW.create(t,e,i,r,["$feature","$view"],[]);let nW=class oge{constructor(e,i,r,n,s,o,a){this.services=null,this.script=e,this.evaluate=n;const l=Array.isArray(o)?o:o.fields;this.fields=l,this._syntaxTree=r,this._arcade=i,this._arcadeFeature=s,this._spatialReference=a,this._referencesGeometry=i.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,i,r,n,s,o){const{arcade:a,Feature:l,Dictionary:c}=await rW(),u=je.fromJSON(i);let d;try{d=a.parseScript(e,o)}catch(N){return YFe.error(new W("arcade-bad-expression","Failed to parse arcade script",{script:e,error:N})),null}const p=s.reduce((N,F)=>({...N,[F]:null}),{});let m=null;n!=null&&(m=new c(n),m.immutable=!0,p.$config=null);const y=a.scriptUsesGeometryEngine(d),_=y&&a.enableGeometrySupport(),v=a.scriptUsesFeatureSet(d)&&a.enableFeatureSetSupport(),w=a.scriptIsAsync(d),x=w&&a.enableAsyncSupport(),T={vars:p,spatialReference:u,useAsync:!!x};await Promise.all([_,v,x]);const S=new Set;await a.loadDependentModules(S,d,null,w,y);const E=new c;E.immutable=!1,E.setField("scale",0);const A=a.compileScript(d,T),P=(N,F)=>{const D=N.$view?.timeZone;return"$view"in N&&N.$view&&(E.setField("scale",typeof N.$view=="object"&&"scale"in N.$view?N.$view.scale:void 0),N.$view=E),m&&(N.$config=m),A({vars:N,spatialReference:u,services:F,timeZone:D})};return new oge(e,a,d,P,new l,r,u)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}};const JFe=/^([0-9_])/,KFe=/[^a-z0-9_\u0080-\uffff]+/gi;function WCt(t){return t==null?null:t.trim().replaceAll(KFe,"_").replace(JFe,"F$1")||null}const QFe=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],eke=["field","normalizationField"];function YCt(t,e){if(t!=null&&e!=null){for(const i of Array.isArray(t)?t:[t])if($Q(QFe,i,e),"visualVariables"in i&&i.visualVariables)for(const r of i.visualVariables)$Q(eke,r,e)}}function $Q(t,e,i){if(t)for(const r of t){const n=Km(r,e),s=n&&typeof n!="function"&&i.get(n);s&&RS(r,s.name,e)}}function XCt(t,e){if(t!=null&&e?.fields?.length)if("startField"in t){const i=e.get(t.startField),r=e.get(t.endField);t.startField=i?.name??null,t.endField=r?.name??null}else{const i=e.get(t.startTimeField),r=e.get(t.endTimeField);t.startTimeField=i?.name??null,t.endTimeField=r?.name??null}}const g6=new Set;function age(t,e){return t&&e?(g6.clear(),nO(g6,t,e),Array.from(g6).sort()):[]}function nO(t,e,i){if(i)if(e?.fields?.length)if(i.includes("*"))for(const{name:r}of e.fields)t.add(r);else for(const r of i)W4(t,e,r);else{if(i.includes("*"))return t.clear(),void t.add("*");for(const r of i)r!=null&&t.add(r)}}function W4(t,e,i){if(typeof i=="string")if(e){const r=e.get(i);r&&t.add(r.name)}else t.add(i)}function ZCt(t,e){return e==null||t==null?[]:e.includes("*")?(t.fields??[]).map(i=>i.name):e}async function Mb(t,e,i){if(!i)return;const{arcadeUtils:r}=await rW(),n=r.extractFieldNames(i,e?.fields?.map(s=>s.name));for(const s of n)W4(t,e,s)}async function lge(t,e,i){if(i&&i!=="1=1"){const r=await Zfe(i,e);if(!r.isStandardized)throw new W("fieldUtils:collectFilterFields","Where clause is not standardized",{where:i});nO(t,e,r.fieldNames)}}function JCt({displayField:t,fields:e}){return t||(e?.length?y6(e,"name-or-title")||y6(e,"unique-identifier")||y6(e,"type-or-category")||tke(e):null)}function tke(t){for(const e of t){if(!e?.name)continue;const i=e.name.toLowerCase();if(i.includes("name")||i.includes("title"))return e.name}return null}function y6(t,e){for(const i of t)if(i?.valueType&&i.valueType===e)return i.name;return null}async function KCt(t,e){if(!e)return;const i=e.elevationInfo?.featureExpressionInfo;return i?i.collectRequiredFields(t,e.fieldsIndex):void 0}function ike(t,e,i){i.onStatisticExpression?Mb(t,e,i.onStatisticExpression.expression):t.add(i.onStatisticField)}async function QCt(t,e,i){if(!e||!i||!("fields"in i))return;const r=[],n=i.popupTemplate;r.push(rke(t,e,n)),i.fields&&r.push(...i.fields.map(async s=>ike(t,e.fieldsIndex,s))),await Promise.all(r)}async function rke(t,e,i){const r=[];i?.expressionInfos&&r.push(...i.expressionInfos.map(s=>Mb(t,e.fieldsIndex,s.expression)));const n=i?.content;if(Array.isArray(n))for(const s of n)s.type==="expression"&&s.expressionInfo&&r.push(Mb(t,e.fieldsIndex,s.expressionInfo.expression));await Promise.all(r)}async function eAt(t,e,i){e&&(e.timeInfo&&i?.timeExtent&&nO(t,e.fieldsIndex,[e.timeInfo.startField,e.timeInfo.endField]),e.floorInfo&&nO(t,e.fieldsIndex,[e.floorInfo.floorField]),i?.where!=null&&await lge(t,e.fieldsIndex,i.where))}async function tAt(t,e,i){e&&i&&await Promise.all(i.map(r=>nke(t,e,r)))}async function nke(t,e,i){e&&i&&(i.valueExpression?await Mb(t,e.fieldsIndex,i.valueExpression):i.field&&W4(t,e.fieldsIndex,i.field))}function iAt(t){return t?age(t.fieldsIndex,cge(t)):[]}function ske(t){if(!t)return[];const e=t.geometryFieldsInfo;return e?age(t.fieldsIndex,[e.shapeAreaField,e.shapeLengthField]):[]}const oke=new Set(["oid","global-id","guid"]),ake=new Set(["oid","global-id"]),lke=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i];function cke(t){const e=new Set;uge(t).forEach(r=>e.add(r)),ske(t).forEach(r=>e.add(r.toLowerCase()));const i=t&&"infoFor3D"in t?t.infoFor3D:void 0;return i&&(Object.values(i.assetMapFieldRoles).forEach(r=>e.add(r.toLowerCase())),Object.values(i.transformFieldRoles).forEach(r=>e.add(r.toLowerCase()))),Array.from(e)}function cge(t){if(!t)return[];const e="editFieldsInfo"in t&&t.editFieldsInfo;if(!e)return[];const{creationDateField:i,creatorField:r,editDateField:n,editorField:s}=e;return[i,r,n,s].filter(Boolean)}function uge(t){return cge(t).map(e=>e.toLowerCase())}function rAt(t,e){return t.editable&&!oke.has(t.type)&&!uge(e).includes(t.name?.toLowerCase()??"")}function nAt(t,e){const i=t.name?.toLowerCase()??"";return!(e?.objectIdField!=null&&i===e.objectIdField.toLowerCase()||e?.globalIdField!=null&&i===e.globalIdField.toLowerCase()||cke(e).includes(i)||ake.has(t.type)||lke.some(r=>r.test(i)))}async function sAt(t,e){const{labelingInfo:i,fieldsIndex:r}=e;i?.length&&await Promise.all(i.map(n=>uke(t,r,n)))}async function uke(t,e,i){if(!i)return;const r=i.getLabelExpression(),n=i.where;if(r.type==="arcade")await Mb(t,e,r.expression);else{const s=r.expression.match(/{[^}]*}/g);s&&s.forEach(o=>{W4(t,e,o.slice(1,-1))})}await lge(t,e,n)}function oAt(t){const e=t.defaultValue;return e!==void 0&&pge(t,e)?e:t.nullable?null:void 0}function aAt(t){const e=typeof t=="string"?{type:t}:t;return xke(e)?255:e.type==="esriFieldTypeDate"||e.type==="date"?8:void 0}function hge(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function hke(t){return t===null||hge(t)}function dke(t){return t===null||Number.isInteger(t)}function dge(t){return t!=null&&typeof t=="string"}function pke(t){return t===null||dge(t)}function fke(){return!0}function pge(t,e){let i;switch(t.type){case"date":case"integer":case"long":case"small-integer":case"big-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":case"esriFieldTypeBigInteger":i=t.nullable?dke:Number.isInteger;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=t.nullable?hke:hge;break;case"string":case"esriFieldTypeString":i=t.nullable?pke:dge;break;default:i=fke}return arguments.length===1?i:i(e)}const mke=["integer","small-integer","big-integer"],gke=["single","double"],yke=["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"],_ke=["esriFieldTypeSingle","esriFieldTypeDouble"],vke=new Set([...mke,...yke]),bke=new Set([...gke,..._ke]),wke=ERe(vke,bke);function fge(t){return t!=null&&wke.has(t.type)}function xke(t){return t!=null&&(t.type==="string"||t.type==="esriFieldTypeString")}function Tke(t){return t!=null&&(t.type==="date"||t.type==="esriFieldTypeDate")}function lAt(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function cAt(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function uAt(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}function hAt(t){return t!=null&&(t.type==="oid"||t.type==="esriFieldTypeOID")}function dAt(t){return t!=null&&(t.type==="global-id"||t.type==="esriFieldTypeGlobalID")}function pAt(t,e){return Ske(t,e)===null}var nN,sN;function fAt(t){return t==null||typeof t=="number"&&isNaN(t)?null:t}function Ske(t,e){return t==null||t.nullable&&e===null?null:fge(t)&&!Eke(t.type,Number(e))?nN.OUT_OF_RANGE:pge(t,e)?t.domain?qFe(t,e):null:sN.INVALID_TYPE}function Eke(t,e){const i=typeof t=="string"?mge(t):t;if(!i)return!1;const r=i.min,n=i.max;return i.isInteger?Number.isInteger(e)&&e>=r&&e<=n:e>=r&&e<=n}function mge(t){switch(t){case"esriFieldTypeSmallInteger":case"small-integer":return Cke;case"esriFieldTypeInteger":case"integer":return Ake;case"esriFieldTypeBigInteger":case"big-integer":return Oke;case"esriFieldTypeSingle":case"single":return Rke;case"esriFieldTypeDouble":case"double":return Pke}}(function(t){t.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(nN||(nN={})),function(t){t.INVALID_TYPE="type-validation-error::invalid-type"}(sN||(sN={}));const Cke={min:-32768,max:32767,isInteger:!0,rawMin:-32768,rawMax:32767},Ake={min:-2147483648,max:2147483647,isInteger:!0,rawMin:-2147483648,rawMax:2147483647},Oke={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0,rawMin:-Number.MAX_SAFE_INTEGER,rawMax:Number.MAX_SAFE_INTEGER},Rke={min:-34e37,max:12e37,isInteger:!1,rawMin:-34e37,rawMax:12e37},Pke={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1,rawMin:-Number.MAX_VALUE,rawMax:Number.MAX_VALUE};function mAt(t,e,i){switch(t){case XT.INVALID_CODED_VALUE:return`Value ${i} is not in the coded domain - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case XT.VALUE_OUT_OF_RANGE:return`Value ${i} is out of the range of valid values - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case sN.INVALID_TYPE:return`Value ${i} is not a valid value for the field type - field: ${e.name}, type: ${e.type}, nullable: ${e.nullable}`;case nN.OUT_OF_RANGE:{const{min:r,max:n}=mge(e.type);return`Value ${i} is out of range for the number type - field: ${e.name}, type: ${e.type}, value range is ${r} to ${n}`}}}function gAt(t,e){return!Mke(t,e,null)}function Mke(t,e,i){if(!e?.attributes||!t){if(i!=null)for(const s of t??[])i.add(s);return!0}const r=new Set(Object.keys(e.attributes));let n=!1;for(const s of t)if(!r.has(s)){if(n=!0,i==null)break;i.add(s)}return n}function yAt(t){return!!t&&["raster.itempixelvalue","raster.servicepixelvalue"].some(e=>t.toLowerCase().startsWith(e))}let zI=class extends $e{constructor(e){super(e),this.type=null}};h([f({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],zI.prototype,"type",void 0),zI=h([z("esri.popup.content.Content")],zI);const C_=zI;var V9;let kv=V9=class extends C_{constructor(t){super(t),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new V9({description:this.description,displayType:this.displayType,title:this.title})}};h([f({type:String,json:{write:!0}})],kv.prototype,"description",void 0),h([f({type:["auto","preview","list"],json:{write:!0}})],kv.prototype,"displayType",void 0),h([f({type:String,json:{write:!0}})],kv.prototype,"title",void 0),h([f({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],kv.prototype,"type",void 0),kv=V9=h([z("esri.popup.content.AttachmentsContent")],kv);const oN=kv;var G9;let Uv=G9=class extends C_{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new G9({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?ye(this.outFields):null})}};h([f()],Uv.prototype,"creator",void 0),h([f()],Uv.prototype,"destroyer",void 0),h([f()],Uv.prototype,"outFields",void 0),h([f({type:["custom"],readOnly:!0})],Uv.prototype,"type",void 0),Uv=G9=h([z("esri.popup.content.CustomContent")],Uv);const $ke=Uv;var j9;let Zx=j9=class extends $e{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new j9({title:this.title,expression:this.expression})}};h([f({type:String,json:{write:!0}})],Zx.prototype,"title",void 0),h([f({type:String,json:{write:!0}})],Zx.prototype,"expression",void 0),h([f({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],Zx.prototype,"returnType",void 0),Zx=j9=h([z("esri.popup.ElementExpressionInfo")],Zx);const Ike=Zx;var H9;let MC=H9=class extends C_{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){return new H9({expressionInfo:this.expressionInfo?.clone()})}};h([f({type:Ike,json:{write:!0}})],MC.prototype,"expressionInfo",void 0),h([f({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],MC.prototype,"type",void 0),MC=H9=h([z("esri.popup.content.ExpressionContent")],MC);const sW=MC;let Jx=class extends mu($e){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}};h([Ut(RFe)],Jx.prototype,"dateFormat",void 0),h([f({type:Boolean,json:{write:!0}})],Jx.prototype,"digitSeparator",void 0),h([f({type:Ln,json:{write:!0}})],Jx.prototype,"places",void 0),Jx=h([z("esri.popup.support.FieldInfoFormat")],Jx);const Lke=Jx;var q9;let Zh=q9=class extends $e{constructor(t){super(t),this.fieldName=null,this.format=null,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new q9({fieldName:this.fieldName,format:this.format?ye(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};h([f({type:String,json:{write:!0}})],Zh.prototype,"fieldName",void 0),h([f({type:Lke,json:{write:!0}})],Zh.prototype,"format",void 0),h([f({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],Zh.prototype,"isEditable",void 0),h([f({type:String,json:{write:!0}})],Zh.prototype,"label",void 0),h([Ut(new uu({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],Zh.prototype,"stringFieldOption",void 0),h([f({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],Zh.prototype,"statisticType",void 0),h([f({type:String,json:{write:!0}})],Zh.prototype,"tooltip",void 0),h([f({type:Boolean,json:{write:!0}})],Zh.prototype,"visible",void 0),Zh=q9=h([z("esri.popup.FieldInfo")],Zh);const gge=Zh;var W9;let Om=W9=class extends C_{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,e){e.fieldInfos=t&&t.map(i=>i.toJSON())}clone(){return new W9(ye({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};h([f({type:Object,json:{write:!0}})],Om.prototype,"attributes",void 0),h([f({type:String,json:{write:!0}})],Om.prototype,"description",void 0),h([f({type:[gge]})],Om.prototype,"fieldInfos",void 0),h([di("fieldInfos")],Om.prototype,"writeFieldInfos",null),h([f({type:String,json:{write:!0}})],Om.prototype,"title",void 0),h([f({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],Om.prototype,"type",void 0),Om=W9=h([z("esri.popup.content.FieldsContent")],Om);const aN=Om;let zv=class extends $e{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};h([f({type:String,json:{write:!0}})],zv.prototype,"altText",void 0),h([f({type:String,json:{write:!0}})],zv.prototype,"caption",void 0),h([f({type:String,json:{write:!0}})],zv.prototype,"title",void 0),h([f({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],zv.prototype,"type",void 0),zv=h([z("esri.popup.content.mixins.MediaInfo")],zv);const oW=zv;var Y9;let Bv=Y9=class extends xe{constructor(t){super(t),this.color=null,this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new Y9({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};h([f()],Bv.prototype,"color",void 0),h([f()],Bv.prototype,"fieldName",void 0),h([f()],Bv.prototype,"tooltip",void 0),h([f()],Bv.prototype,"value",void 0),Bv=Y9=h([z("esri.popup.content.support.ChartMediaInfoValueSeries")],Bv);const Dke=Bv;var X9;let q0=X9=class extends $e{constructor(t){super(t),this.colors=null,this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new X9({colors:ye(this.colors),fields:ye(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};h([f({type:[Ye],json:{type:[[Ln]],write:!0}})],q0.prototype,"colors",void 0),h([f({type:[String],json:{write:!0}})],q0.prototype,"fields",void 0),h([f({type:String,json:{write:!0}})],q0.prototype,"normalizeField",void 0),h([f({type:[Dke],json:{read:!1}})],q0.prototype,"series",void 0),h([f({type:String,json:{write:!0}})],q0.prototype,"tooltipField",void 0),q0=X9=h([z("esri.popup.content.support.ChartMediaInfoValue")],q0);const Nke=q0;let $C=class extends oW{constructor(e){super(e),this.type=null,this.value=null}};h([f({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],$C.prototype,"type",void 0),h([f({type:Nke,json:{write:!0}})],$C.prototype,"value",void 0),$C=h([z("esri.popup.content.mixins.ChartMediaInfo")],$C);const Y4=$C,X4=fu()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var Z9;let BI=Z9=class extends Y4{constructor(t){super(t),this.type="bar-chart"}clone(){return new Z9({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};h([f({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:X4.write}})],BI.prototype,"type",void 0),BI=Z9=h([z("esri.popup.content.BarChartMediaInfo")],BI);const yge=BI;var J9;let VI=J9=class extends Y4{constructor(t){super(t),this.type="column-chart"}clone(){return new J9({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};h([f({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:X4.write}})],VI.prototype,"type",void 0),VI=J9=h([z("esri.popup.content.ColumnChartMediaInfo")],VI);const _ge=VI;var K9;let IC=K9=class extends $e{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new K9({linkURL:this.linkURL,sourceURL:this.sourceURL})}};h([f({type:String,json:{write:!0}})],IC.prototype,"linkURL",void 0),h([f({type:String,json:{write:!0}})],IC.prototype,"sourceURL",void 0),IC=K9=h([z("esri.popup.content.support.ImageMediaInfoValue")],IC);const Fke=IC;var Q9;let Kx=Q9=class extends oW{constructor(t){super(t),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new Q9({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};h([f({type:Number,json:{write:!0}})],Kx.prototype,"refreshInterval",void 0),h([f({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],Kx.prototype,"type",void 0),h([f({type:Fke,json:{write:!0}})],Kx.prototype,"value",void 0),Kx=Q9=h([z("esri.popup.content.ImageMediaInfo")],Kx);const vge=Kx;var eV;let GI=eV=class extends Y4{constructor(t){super(t),this.type="line-chart"}clone(){return new eV({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};h([f({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:X4.write}})],GI.prototype,"type",void 0),GI=eV=h([z("esri.popup.content.LineChartMediaInfo")],GI);const bge=GI;var tV;let jI=tV=class extends Y4{constructor(t){super(t),this.type="pie-chart"}clone(){return new tV({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};h([f({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:X4.write}})],jI.prototype,"type",void 0),jI=tV=h([z("esri.popup.content.PieChartMediaInfo")],jI);const wge=jI,xge={base:oW,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":yge,"column-chart":_ge,"line-chart":bge,"pie-chart":wge,image:vge}};var iV;let Jh=iV=class extends C_{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(e=>e.type==="image"?vge.fromJSON(e):e.type==="barchart"?yge.fromJSON(e):e.type==="columnchart"?_ge.fromJSON(e):e.type==="linechart"?bge.fromJSON(e):e.type==="piechart"?wge.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(t,e){e.mediaInfos=t&&t.map(i=>i.toJSON())}clone(){return new iV(ye({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};h([f()],Jh.prototype,"activeMediaInfoIndex",void 0),h([f({type:Object,json:{write:!0}})],Jh.prototype,"attributes",void 0),h([f({type:String,json:{write:!0}})],Jh.prototype,"description",void 0),h([f({types:[xge]})],Jh.prototype,"mediaInfos",void 0),h([Ni("mediaInfos")],Jh.prototype,"readMediaInfos",null),h([di("mediaInfos")],Jh.prototype,"writeMediaInfos",null),h([f({type:String,json:{write:!0}})],Jh.prototype,"title",void 0),h([f({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],Jh.prototype,"type",void 0),Jh=iV=h([z("esri.popup.content.MediaContent")],Jh);const lN=Jh;var rV;let LC=rV=class extends $e{constructor(t){super(t),this.field=null,this.order=null}clone(){return new rV({field:this.field,order:this.order})}};h([f({type:String,json:{write:!0}})],LC.prototype,"field",void 0),h([f({type:["asc","desc"],json:{write:!0}})],LC.prototype,"order",void 0),LC=rV=h([z("esri.popup.support.RelatedRecordsInfoFieldOrder")],LC);const Tge=LC;let Dp=class extends mu(C_){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};h([f({type:String,json:{write:!0}})],Dp.prototype,"description",void 0),h([f({type:Number,json:{type:Ln,write:!0}})],Dp.prototype,"displayCount",void 0),h([f({type:["list"],json:{write:!0}})],Dp.prototype,"displayType",void 0),h([f({type:[Tge],json:{write:!0}})],Dp.prototype,"orderByFields",void 0),h([f({type:Number,json:{type:Ln,write:!0}})],Dp.prototype,"relationshipId",void 0),h([f({type:String,json:{write:!0}})],Dp.prototype,"title",void 0),h([f({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],Dp.prototype,"type",void 0),Dp=h([z("esri.popup.content.RelationshipContent")],Dp);const cN=Dp;var nV;let DC=nV=class extends C_{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new nV({text:this.text})}};h([f({type:String,json:{write:!0}})],DC.prototype,"text",void 0),h([f({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],DC.prototype,"type",void 0),DC=nV=h([z("esri.popup.content.TextContent")],DC);const uN=DC,kke={base:null,key:"type",typeMap:{attachment:oN,media:lN,text:uN,expression:sW,field:aN,relationship:cN}};var sV;let Vv=sV=class extends $e{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new sV({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};h([f({type:String,json:{write:!0}})],Vv.prototype,"name",void 0),h([f({type:String,json:{write:!0}})],Vv.prototype,"title",void 0),h([f({type:String,json:{write:!0}})],Vv.prototype,"expression",void 0),h([f({type:["string","number"],json:{write:!0}})],Vv.prototype,"returnType",void 0),Vv=sV=h([z("esri.popup.ExpressionInfo")],Vv);const Uke=Vv;var oV;let NC=oV=class extends $e{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new oV({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};h([f({type:Boolean,json:{write:!0}})],NC.prototype,"returnTopmostRaster",void 0),h([f({type:Boolean,json:{write:!0}})],NC.prototype,"showNoDataRecords",void 0),NC=oV=h([z("esri.popup.LayerOptions")],NC);const zke=NC;var aV;let FC=aV=class extends $e{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new aV({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?ye(this.orderByFields):null})}};h([f({type:Boolean,json:{write:!0}})],FC.prototype,"showRelatedRecords",void 0),h([f({type:[Tge],json:{write:!0}})],FC.prototype,"orderByFields",void 0),FC=aV=h([z("esri.popup.RelatedRecordsInfo")],FC);const Bke=FC;var lV;let Lu=lV=class extends Pq(xe){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new lV({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};h([f()],Lu.prototype,"active",void 0),h([f()],Lu.prototype,"className",void 0),h([f()],Lu.prototype,"disabled",void 0),h([f()],Lu.prototype,"icon",void 0),h([f()],Lu.prototype,"id",void 0),h([f()],Lu.prototype,"indicator",void 0),h([f()],Lu.prototype,"title",void 0),h([f()],Lu.prototype,"type",void 0),h([f()],Lu.prototype,"visible",void 0),Lu=lV=h([z("esri.support.actions.ActionBase")],Lu);const aW=Lu;var cV;let HI=cV=class extends aW{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new cV({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};h([f()],HI.prototype,"image",void 0),HI=cV=h([z("esri.support.Action.ActionButton")],HI);const Vke=HI;var uV;let kC=uV=class extends aW{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new uV({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};h([f()],kC.prototype,"image",void 0),h([f()],kC.prototype,"value",void 0),kC=uV=h([z("esri.support.Action.ActionToggle")],kC);const Gke=kC,jke="esri.PopupTemplate",Hke=ne.getLogger(jke),mE="relationships/",IQ="expression/",qke=ft.ofType({key:"type",defaultKeyValue:"button",base:aW,typeMap:{button:Vke,toggle:Gke}}),Wke={base:C_,key:"type",typeMap:{media:lN,custom:$ke,text:uN,attachments:oN,fields:aN,expression:sW,relationship:cN}},Yke=new Set(["attachments","fields","media","text","expression","relationship"]);let io=class extends mu($e){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(i=>Ky(Wke,i)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||dc(e)?e:(Hke.error("content error","unsupported content value",{value:e}),null)}readContent(e,i){const{popupElements:r}=i;return Array.isArray(r)&&r.length>0?this._readPopupInfoElements(i.description,i.mediaInfos,r):this._readPopupInfo(i)}writeContent(e,i,r,n){typeof e!="string"?Array.isArray(e)&&(i.popupElements=e.filter(s=>Yke.has(s.type)).map(s=>s?.toJSON(n)),i.popupElements.forEach(s=>{s.type==="attachments"?this._writeAttachmentContent(i):s.type==="media"?this._writeMediaContent(s,i):s.type==="text"?this._writeTextContent(s,i):s.type==="relationship"&&this._writeRelationshipContent(s,i)})):i.description=e}writeFieldInfos(e,i,r,n){const{content:s}=this,o=Array.isArray(s)?s:null;if(e){const a=o?o.filter(c=>c.type==="fields"):[],l=a.length&&a.every(c=>c.fieldInfos?.length);i.fieldInfos=e.filter(Boolean).map(c=>{const u=c.toJSON(n);return l&&(u.visible=!1),u})}if(o)for(const a of o)a.type==="fields"&&this._writeFieldsContent(a,i)}writeLayerOptions(e,i,r,n){i[r]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(n)}writeTitle(e,i){i.title=e||""}async collectRequiredFields(e,i){const r=this.expressionInfos||[];await this._collectExpressionInfoFields(e,i,[...r,...this._getContentExpressionInfos(this.content,r)]),nO(e,i,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const i=new Set;return await this.collectRequiredFields(i,e),[...i].sort()}_writeFieldsContent(e,i){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const r=ye(e.fieldInfos);Array.isArray(i.fieldInfos)?r.forEach(n=>{const s=i.fieldInfos.find(o=>o.fieldName.toLowerCase()===n.fieldName.toLowerCase());s?s.visible=!0:i.fieldInfos.push(n)}):i.fieldInfos=r}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,i){const r=e.orderByFields?.map(s=>this._toFieldOrderJSON(s,e.relationshipId))||[],n=[...i.relatedRecordsInfo?.orderByFields||[],...r];i.relatedRecordsInfo={showRelatedRecords:!0,...n?.length&&{orderByFields:n}}}_writeTextContent(e,i){!i.description&&e.text&&(i.description=e.text)}_writeMediaContent(e,i){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const r=ye(e.mediaInfos);Array.isArray(i.mediaInfos)?i.mediaInfos=[...i.mediaInfos,...r]:i.mediaInfos=r}_readPopupInfoElements(e,i,r){const n={description:!1,mediaInfos:!1};return r.map(s=>s.type==="media"?(s.mediaInfos||!i||n.mediaInfos||(s.mediaInfos=i,n.mediaInfos=!0),lN.fromJSON(s)):s.type==="text"?(s.text||!e||n.description||(s.text=e,n.description=!0),uN.fromJSON(s)):s.type==="attachments"?oN.fromJSON(s):s.type==="fields"?aN.fromJSON(s):s.type==="expression"?sW.fromJSON(s):s.type==="relationship"?cN.fromJSON(s):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:i,order:r}=e;if(!i?.startsWith(mE))return null;const n=i.replace(mE,"").split("/");if(n.length!==2)return null;const s=parseInt(n[0],10),o=n[1];return typeof s=="number"&&o?cN.fromJSON({relationshipId:s,orderByFields:[{field:o,order:r}]}):null}_toFieldOrderJSON(e,i){const{order:r,field:n}=e;return{field:`${mE}${i}/${n}`,order:r}}_readPopupInfo({description:e,mediaInfos:i,showAttachments:r,relatedRecordsInfo:n={showRelatedRecords:!1}}){const s=[];e?s.push(new uN({text:e})):s.push(new aN),Array.isArray(i)&&i.length&&s.push(lN.fromJSON({mediaInfos:i})),r&&s.push(oN.fromJSON({displayType:"auto"}));const{showRelatedRecords:o,orderByFields:a}=n;return o&&a?.length&&a.forEach(l=>{const c=this._toRelationshipContent(l);c&&s.push(c)}),s.length?s:e}_getContentElementFields(e){const i=e?.type;if(i==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(i==="custom")return e.outFields||[];if(i==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(i==="media"){const r=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...r.reduce((n,s)=>[...n,...this._getMediaInfoFields(s)],[])]}return i==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:i,title:r,value:n}=e,s=n||{},{fields:o,normalizeField:a,tooltipField:l,sourceURL:c,linkURL:u}=s,d=[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(c),...this._extractFieldNames(u),...o??[]];return a&&d.push(a),l&&d.push(l),d}_getContentExpressionInfos(e,i){return Array.isArray(e)?e.reduce((r,n)=>[...r,...n.type==="expression"&&n.expressionInfo?[n.expressionInfo]:[]],i):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((i,r)=>[...i,...this._getContentElementFields(r)],[]):[]}async _collectExpressionInfoFields(e,i,r){r&&await Promise.all(r.map(n=>Mb(e,i,n.expression)))}_getFieldInfoFields(e){return e?e.filter(i=>i.visible===void 0||!!i.visible).map(i=>i.fieldName).filter(i=>!i.startsWith(mE)&&!i.startsWith(IQ)):[]}_getActionsFields(e){return e?e.toArray().reduce((i,r)=>[...i,...this._getActionFields(r)],[]):[]}_getActionFields(e){const{className:i,title:r,type:n}=e,s=n==="button"||n==="toggle"?e.image:"";return[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(s)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const i=/{[^}]*}/g,r=e.match(i);if(!r)return[];const n=/\{(\w+):.+\}/,s=r.filter(o=>!(o.indexOf(`{${mE}`)===0||o.indexOf(`{${IQ}`)===0)).map(o=>o.replace(n,"{$1}"));return s?s.map(o=>o.slice(1,-1)):[]}};h([f({type:qke})],io.prototype,"actions",void 0),h([f()],io.prototype,"content",void 0),h([rr("content")],io.prototype,"castContent",null),h([Ni("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],io.prototype,"readContent",null),h([di("content",{popupElements:{type:ft.ofType(kke)},showAttachments:{type:Boolean},mediaInfos:{type:ft.ofType(xge)},description:{type:String},relatedRecordsInfo:{type:Bke}})],io.prototype,"writeContent",null),h([f({type:[Uke],json:{write:!0}})],io.prototype,"expressionInfos",void 0),h([f({type:[gge]})],io.prototype,"fieldInfos",void 0),h([di("fieldInfos")],io.prototype,"writeFieldInfos",null),h([f({type:zke})],io.prototype,"layerOptions",void 0),h([di("layerOptions")],io.prototype,"writeLayerOptions",null),h([f({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],io.prototype,"lastEditInfoEnabled",void 0),h([f()],io.prototype,"outFields",void 0),h([f()],io.prototype,"overwriteActions",void 0),h([f()],io.prototype,"returnGeometry",void 0),h([f({json:{type:String}})],io.prototype,"title",void 0),h([di("title")],io.prototype,"writeTitle",null),io=h([z("esri.PopupTemplate")],io);const Xke=io,LQ=new uu({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let Zke=0,Qx=class extends $e{constructor(e){super(e),this.id="sym"+Zke++,this.type=null,this.color=new Ye([0,0,0,1])}readColor(e){return e?.[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,i){}hash(){return JSON.stringify(this.toJSON())}clone(){}};h([f({type:LQ.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:LQ.write}}})],Qx.prototype,"type",void 0),h([f({type:Ye,json:{write:{allowNull:!0}}})],Qx.prototype,"color",void 0),h([Ni("color")],Qx.prototype,"readColor",null),Qx=h([z("esri.symbols.Symbol")],Qx);const gu=Qx;var hV;let W0=hV=class extends gu{constructor(t){super(t),this.data=null,this.type="cim"}readData(t,e){return e}writeData(t,e){Object.assign(e,t)}async collectRequiredFields(t,e){if(this.data?.type==="CIMSymbolReference"){const i=this.data.primitiveOverrides;if(i){const r=i.map(n=>{const s=n.valueExpressionInfo;return Mb(t,e,s.expression)});await Promise.all(r)}}}clone(){return new hV({data:ye(this.data)})}hash(){return que(JSON.stringify(this.data)).toString()}};h([f({json:{write:!1}})],W0.prototype,"color",void 0),h([f({json:{write:!0}})],W0.prototype,"data",void 0),h([Ni("data",["symbol"])],W0.prototype,"readData",null),h([di("data",{})],W0.prototype,"writeData",null),h([Ut({CIMSymbolReference:"cim"},{readOnly:!0})],W0.prototype,"type",void 0),W0=hV=h([z("esri.symbols.CIMSymbol")],W0);const yR=W0;let e2=class extends $e{constructor(e){super(e),this.enabled=!0,this.type=null,this.ignoreDrivers=!1}writeEnabled(e,i,r){e||(i[r]=e)}};h([f({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],e2.prototype,"enabled",void 0),h([di("enabled")],e2.prototype,"writeEnabled",null),h([f({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],e2.prototype,"type",void 0),e2=h([z("esri.symbols.Symbol3DLayer")],e2);const qf=e2;let Gv=class extends $e{constructor(e){super(e),this.color=new Ye([0,0,0,1]),this.extensionLength=0,this.size=jd(1)}clone(){}cloneProperties(){return{color:ye(this.color),size:this.size,extensionLength:this.extensionLength}}};h([f({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Gv.prototype,"type",void 0),h([f(Fg)],Gv.prototype,"color",void 0),h([f({...If,json:{write:{overridePolicy:t=>({enabled:!!t})}}})],Gv.prototype,"extensionLength",void 0),h([f(If)],Gv.prototype,"size",void 0),Gv=h([z("esri.symbols.edges.Edges3D")],Gv);const lW=Gv;var dV;let qI=dV=class extends lW{constructor(t){super(t),this.type="sketch"}clone(){return new dV(this.cloneProperties())}};h([Ut({sketch:"sketch"},{readOnly:!0})],qI.prototype,"type",void 0),qI=dV=h([z("esri.symbols.edges.SketchEdges3D")],qI);const Jke=qI;var pV;let WI=pV=class extends lW{constructor(t){super(t),this.type="solid"}clone(){return new pV(this.cloneProperties())}};h([Ut({solid:"solid"},{readOnly:!0})],WI.prototype,"type",void 0),WI=pV=h([z("esri.symbols.support.SolidEdges3D")],WI);const Kke=WI,Sge={types:{key:"type",base:lW,typeMap:{solid:Kke,sketch:Jke}},json:{write:!0}};var fV;let iu=fV=class extends $e{constructor(t){super(t),this.color=null}clone(){const t={color:this.color!=null?this.color.clone():null};return new fV(t)}};h([f(Fg)],iu.prototype,"color",void 0),iu=fV=h([z("esri.symbols.support.Symbol3DMaterial")],iu);var mV;let Y0=mV=class extends qf{constructor(t){super(t),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new mV({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};h([Ut({Extrude:"extrude"},{readOnly:!0})],Y0.prototype,"type",void 0),h([f({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],Y0.prototype,"size",void 0),h([f({type:iu,json:{write:!0}})],Y0.prototype,"material",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Y0.prototype,"castShadows",void 0),h([f(Sge)],Y0.prototype,"edges",void 0),Y0=mV=h([z("esri.symbols.ExtrudeSymbol3DLayer")],Y0);const Ege=Y0;let UC=class extends gu{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};h([Ut({esriSLS:"simple-line"},{readOnly:!0})],UC.prototype,"type",void 0),h([f({type:Number,cast:Bn,json:{write:!0}})],UC.prototype,"width",void 0),UC=h([z("esri.symbols.LineSymbol")],UC);const Qke=UC,e6e=["begin","end","begin-end"],Cge=["arrow","circle","square","diamond","cross","x"];var gV;let Np=gV=class extends $e{constructor(t){super(t),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(t,e,i,r){e[i]=r?.origin==="web-map"?"arrow":t}set color(t){this._set("color",t)}readColor(t){return t?.[0]!=null?[t[0],t[1],t[2],t[3]/255]:t}writeColor(t,e,i,r){r?.origin==="web-map"||(e[i]=t)}clone(){return new gV({color:ye(this.color),placement:this.placement,style:this.style})}hash(){return`${this.placement}.${this.color?.hash()}.${this.style}`}};h([f({type:["begin","end","begin-end"],json:{write:!0}})],Np.prototype,"placement",void 0),h([Ut({"line-marker":"line-marker"},{readOnly:!0}),f({json:{origins:{"web-map":{write:!1}}}})],Np.prototype,"type",void 0),h([f({type:Cge})],Np.prototype,"style",void 0),h([di("style")],Np.prototype,"writeStyle",null),h([f({type:Ye,value:null,json:{write:{allowNull:!0}}})],Np.prototype,"color",null),h([Ni("color")],Np.prototype,"readColor",null),h([di("color")],Np.prototype,"writeColor",null),Np=gV=h([z("esri.symbols.LineSymbolMarker")],Np);const t6e=Np;var yV;const _6=new uu({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let Rm=yV=class extends Qke{constructor(...t){super(...t),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(t,e,i,r,n,s){if(t&&typeof t!="string")return t;const o={};return t!=null&&(o.style=t),e!=null&&(o.color=e),i!=null&&(o.width=Bn(i)),r!=null&&(o.cap=r),n!=null&&(o.join=n),s!=null&&(o.miterLimit=Bn(s)),o}clone(){return new yV({color:ye(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:this.marker?.clone()})}hash(){return`${super.hash()}.${this.color?.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${this.marker?.hash()}`}};h([Ut({esriSLS:"simple-line"},{readOnly:!0})],Rm.prototype,"type",void 0),h([f({type:_6.apiValues,json:{read:_6.read,write:_6.write}})],Rm.prototype,"style",void 0),h([f({type:["butt","round","square"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&i?.origin==null})}}})],Rm.prototype,"cap",void 0),h([f({type:["miter","round","bevel"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&i?.origin==null})}}})],Rm.prototype,"join",void 0),h([f({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":t6e}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],Rm.prototype,"marker",void 0),h([f({type:Number,json:{read:!1,write:!1}})],Rm.prototype,"miterLimit",void 0),Rm=yV=h([z("esri.symbols.SimpleLineSymbol")],Rm);const rw=Rm;let zC=class extends gu{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};h([f({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":rw}},json:{default:null,write:!0}})],zC.prototype,"outline",void 0),h([f({type:["simple-fill","picture-fill"],readOnly:!0})],zC.prototype,"type",void 0),zC=h([z("esri.symbols.FillSymbol")],zC);const Age=zC;let YI=class extends $e{constructor(e){super(e)}clone(){}};h([f({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],YI.prototype,"type",void 0),YI=h([z("esri.symbols.patterns.LinePattern3D")],YI);const Oge=YI,i6e=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var _V;const r6e=fu()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let BC=_V=class extends Oge{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new _V(t)}};h([f({type:["style"]})],BC.prototype,"type",void 0),h([Ut(r6e),f({type:i6e})],BC.prototype,"style",void 0),BC=_V=h([z("esri.symbols.patterns.LineStylePattern3D")],BC);const cW=BC;let XI=class extends $e{constructor(e){super(e)}clone(){}};h([f({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],XI.prototype,"type",void 0),XI=h([z("esri.symbols.patterns.Pattern3D")],XI);const Rge=XI,n6e=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var vV;let VC=vV=class extends Rge{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new vV(t)}};h([f({type:["style"]})],VC.prototype,"type",void 0),h([f({type:n6e,json:{read:!0,write:!0}})],VC.prototype,"style",void 0),VC=vV=h([z("esri.symbols.patterns.StylePattern3D")],VC);const Pge=VC,s6e={types:{key:"type",base:Rge,typeMap:{style:Pge}},json:{write:!0}},Mge={types:{key:"type",base:Oge,typeMap:{style:cW}},json:{write:!0}},KA=new Ye("white");new Ye("black");const o6e=new Ye([255,255,255,0]);function a6e(t){return t.r===0&&t.g===0&&t.b===0}var bV;let QA=bV=class extends iu{constructor(t){super(t),this.colorMixMode=null}clone(){const t={color:this.color!=null?this.color.clone():null,colorMixMode:this.colorMixMode};return new bV(t)}};h([Ut({multiply:"multiply",replace:"replace",tint:"tint"})],QA.prototype,"colorMixMode",void 0),QA=bV=h([z("esri.symbols.support.Symbol3DFillMaterial")],QA);function ds(t=Nge){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function $b(t,e,i,r,n,s,o=ds()){return o[0]=t,o[1]=e,o[2]=i,o[3]=r,o[4]=n,o[5]=s,o}function MAt(t,e){const i=isFinite(t[2])||isFinite(t[5]);return new Xi(i?{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],zmin:t[2],zmax:t[5],spatialReference:e}:{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],spatialReference:e})}function ZT(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t[4]=Math.max(t[4],e[4]),t[5]=Math.max(t[5],e[5])}function l6e(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[3]=Math.max(t[3],e[2]),t[4]=Math.max(t[4],e[3])}function Yd(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[0]),t[4]=Math.max(t[4],e[1]),t[5]=Math.max(t[5],e[2])}function Zc(t,e,i=0,r=e.length/3){let n=t[0],s=t[1],o=t[2],a=t[3],l=t[4],c=t[5];for(let u=0;u<r;u++)n=Math.min(n,e[i+3*u]),s=Math.min(s,e[i+3*u+1]),o=Math.min(o,e[i+3*u+2]),a=Math.max(a,e[i+3*u]),l=Math.max(l,e[i+3*u+1]),c=Math.max(c,e[i+3*u+2]);t[0]=n,t[1]=s,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function v6(t,e,i){const r=e.length;let n=t[0],s=t[1],o=t[2],a=t[3],l=t[4],c=t[5];if(i)for(let u=0;u<r;u++){const d=e[u];n=Math.min(n,d[0]),s=Math.min(s,d[1]),o=Math.min(o,d[2]),a=Math.max(a,d[0]),l=Math.max(l,d[1]),c=Math.max(c,d[2])}else for(let u=0;u<r;u++){const d=e[u];n=Math.min(n,d[0]),s=Math.min(s,d[1]),a=Math.max(a,d[0]),l=Math.max(l,d[1])}t[0]=n,t[1]=s,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function c6e(t){for(let e=0;e<6;e++)if(!isFinite(t[e]))return!1;return!0}function nw(t){return t[0]>=t[3]?0:t[3]-t[0]}function sw(t){return t[1]>=t[4]?0:t[4]-t[1]}function A_(t){return t[2]>=t[5]?0:t[5]-t[2]}function $ge(t){const e=nw(t),i=A_(t),r=sw(t);return Math.sqrt(e*e+i*i+r*r)}function Rd(t,e=[0,0,0]){return e[0]=t[0]+nw(t)/2,e[1]=t[1]+sw(t)/2,e[2]=t[2]+A_(t)/2,e}function PP(t,e=[0,0,0]){return e[0]=nw(t),e[1]=sw(t),e[2]=A_(t),e}function uW(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]}function $At(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[3]<=t[3]&&e[4]<=t[4]&&e[5]<=t[5]}function u6e(t,e){return Math.max(e[0],t[0])<=Math.min(e[3],t[3])&&Math.max(e[1],t[1])<=Math.min(e[4],t[4])&&Math.max(e[2],t[2])<=Math.min(e[5],t[5])}function Pd(t,e){return e==null||u6e(t,e)}function Ige(t,e,i,r,n=t){return n[0]=t[0]+e,n[1]=t[1]+i,n[2]=t[2]+r,n[3]=t[3]+e,n[4]=t[4]+i,n[5]=t[5]+r,n}function IAt(t,e,i=t){const r=t[0]+nw(t)/2,n=t[1]+sw(t)/2,s=t[2]+A_(t)/2;return i[0]=r+(t[0]-r)*e,i[1]=n+(t[1]-n)*e,i[2]=s+(t[2]-s)*e,i[3]=r+(t[3]-r)*e,i[4]=n+(t[4]-n)*e,i[5]=s+(t[5]-s)*e,i}function Lge(t,e,i=t){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i!==t&&(i[3]=t[3],i[4]=t[4],i[5]=t[5]),i}function Dge(t,e,i=t){return i[3]=e[0],i[4]=e[1],i[5]=e[2],i!==t&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),t}function Z4(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function vr(t){return t?Z4(t,DQ):ds(DQ)}function hW(t,e){return e||(e=Gt()),e[0]=t[0],e[1]=t[1],e[2]=t[3],e[3]=t[4],e}function LAt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=Number.NEGATIVE_INFINITY,t[3]=e[2],t[4]=e[3],t[5]=Number.POSITIVE_INFINITY,t}function h6e(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=Number.NEGATIVE_INFINITY,t[3]=r,t[4]=n,t[5]=Number.POSITIVE_INFINITY,t}function wV(t){return t.length===6}function dW(t){return nw(t)===0&&sw(t)===0&&A_(t)===0}function DAt(t,e,i){if(t==null||e==null)return t===e;if(!wV(t)||!wV(e))return!1;if(i){for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1}else for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function d6e(t,e,i,r,n,s){return $b(t,e,i,r,n,s,p6e)}const NAt=[-1/0,-1/0,-1/0,1/0,1/0,1/0],DQ=[1/0,1/0,1/0,-1/0,-1/0,-1/0],Nge=[0,0,0,0,0,0],p6e=ds();function b6(t,{isPrimitive:e,width:i,depth:r,height:n}){const s=e?10:1;if(i==null&&n==null&&r==null)return[s*t[0],s*t[1],s*t[2]];const o=Ce(i,r,n);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/t[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=t[l]*a);return o}const f6e=$b(-.5,-.5,-.5,.5,.5,.5),m6e=$b(-.5,-.5,0,.5,.5,1),g6e=$b(-.5,-.5,0,.5,.5,.5);function y6e(t){switch(t){case"sphere":case"cube":case"diamond":return f6e;case"cylinder":case"cone":case"inverted-cone":return m6e;case"tetrahedron":return g6e;default:return}}const pW=["butt","square","round"],_6e=[...pW,"none"],Fge=["miter","bevel","round"];var xV;let jv=xV=class extends $e{constructor(t){super(t),this.color=new Ye([0,0,0,1]),this.size=jd(1),this.pattern=null,this.patternCap="butt"}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size,pattern:this.pattern!=null?this.pattern.clone():null,patternCap:this.patternCap};return new xV(t)}};h([f(Fg)],jv.prototype,"color",void 0),h([f(If)],jv.prototype,"size",void 0),h([f(Mge)],jv.prototype,"pattern",void 0),h([f({type:pW,json:{default:"butt",write:{overridePolicy(){return{enabled:this.pattern!=null}}}}})],jv.prototype,"patternCap",void 0),jv=xV=h([z("esri.symbols.support.Symbol3DOutline")],jv);var ZI;let Pm=ZI=class extends qf{constructor(t){super(t),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const t={edges:this.edges!=null?this.edges.clone():null,enabled:this.enabled,material:this.material!=null?this.material.clone():null,pattern:this.pattern!=null?this.pattern.clone():null,castShadows:this.castShadows,outline:this.outline!=null?this.outline.clone():null};return new ZI(t)}static fromSimpleFillSymbol(t){const e=t.outline&&t.outline.style&&t.outline.style!=="inside-frame"&&t.outline.style!=="solid"?new cW({style:t.outline.style}):null,i={size:t.outline?.width??0,color:(t.outline?.color??KA).clone(),pattern:e};return e&&t.outline?.cap&&(i.patternCap=t.outline.cap),new ZI({material:new QA({color:(t.color??o6e).clone()}),pattern:t.style&&t.style!=="solid"?new Pge({style:t.style}):null,outline:i})}};h([Ut({Fill:"fill"},{readOnly:!0})],Pm.prototype,"type",void 0),h([f({type:QA,json:{write:!0}})],Pm.prototype,"material",void 0),h([f(s6e)],Pm.prototype,"pattern",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Pm.prototype,"castShadows",void 0),h([f({type:jv,json:{write:!0}})],Pm.prototype,"outline",void 0),h([f(Sge)],Pm.prototype,"edges",void 0),Pm=ZI=h([z("esri.symbols.FillSymbol3DLayer")],Pm);const _R=Pm,v6e=["none","underline","line-through"],b6e=["normal","italic","oblique"],w6e=["normal","lighter","bold","bolder"],kge={type:Number,cast:t=>{const e=bd(t);return e===0?1:_e(e,.1,4)},nonNullable:!0},x6e=["left","right","center"],T6e=["baseline","top","middle","bottom"],Uge={type:x6e,nonNullable:!0},zge={type:T6e,nonNullable:!0},FAt=8;var TV;let Mm=TV=class extends $e{constructor(t){super(t),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(t){return Bn(t)}clone(){return new TV({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};h([f({type:v6e,json:{default:"none",write:!0}})],Mm.prototype,"decoration",void 0),h([f({type:String,json:{write:!0}})],Mm.prototype,"family",void 0),h([f({type:Number,json:{write:{overridePolicy:(t,e,i)=>({enabled:!i||!i.textSymbol3D})}}})],Mm.prototype,"size",void 0),h([rr("size")],Mm.prototype,"castSize",null),h([f({type:b6e,json:{default:"normal",write:!0}})],Mm.prototype,"style",void 0),h([f({type:w6e,json:{default:"normal",write:!0}})],Mm.prototype,"weight",void 0),Mm=TV=h([z("esri.symbols.Font")],Mm);const J4=Mm;var SV;const S6e=fu()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let Hv=SV=class extends $e{constructor(t){super(t)}readHref(t,e,i){return t?Ab(t,i):e.dataURI}writeHref(t,e,i,r){t&&(Bf(t)?e.dataURI=t:(e.href=jT(t,r),Qc(e.href)&&(e.href=Dd(e.href))))}clone(){return new SV({href:this.href,primitive:this.primitive})}};h([f({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],Hv.prototype,"href",void 0),h([Ni("href")],Hv.prototype,"readHref",null),h([di("href",{href:{type:String},dataURI:{type:String}})],Hv.prototype,"writeHref",null),h([Ut(S6e)],Hv.prototype,"primitive",void 0),Hv=SV=h([z("esri.symbols.support.IconSymbol3DLayerResource")],Hv);const E6e="circle";var EV;let F2=EV=class extends xe{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new EV({x:this.x,y:this.y})}};h([f({type:Number})],F2.prototype,"x",void 0),h([f({type:Number})],F2.prototype,"y",void 0),F2=EV=h([z("esri.symbols.support.Symbol3DAnchorPosition2D")],F2);var CV;let GC=CV=class extends $e{constructor(t){super(t),this.color=new Ye([0,0,0,1]),this.size=jd(1)}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size};return new CV(t)}};h([f(Fg)],GC.prototype,"color",void 0),h([f(If)],GC.prototype,"size",void 0),GC=CV=h([z("esri.symbols.support.Symbol3DIconOutline")],GC);var t2;const Bge="esri.symbols.IconSymbol3DLayer";let Fp=t2=class extends qf{constructor(t){super(t),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new t2({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,outline:this.outline!=null?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(t){const e=t.color||KA,i=NQ(t),r=t.outline&&t.outline.width>0?{size:t.outline.width,color:(t.outline.color||KA).clone()}:null;return new t2({size:t.size,resource:{primitive:A6e(t.style)},material:{color:e},outline:r,anchor:i?"relative":void 0,anchorPosition:i})}static fromPictureMarkerSymbol(t){const e=!t.color||a6e(t.color)?KA:t.color,i=NQ(t);return new t2({size:t.width<=t.height?t.height:t.width,resource:{href:t.url},material:{color:e.clone()},anchor:i?"relative":void 0,anchorPosition:i})}static fromCIMSymbol(t){return new t2({resource:{href:Jhe({mediaType:"application/json",data:JSON.stringify(t.data)})}})}};function NQ(t){const e="width"in t?t.width:t.size,i="height"in t?t.height:t.size,r=FQ(t.xoffset),n=FQ(t.yoffset);return(r||n)&&e&&i?{x:-r/e,y:n/i}:null}function FQ(t){return isFinite(t)?t:0}h([f({type:iu,json:{write:!0}})],Fp.prototype,"material",void 0),h([f({type:Hv,json:{write:!0}})],Fp.prototype,"resource",void 0),h([Ut({Icon:"icon"},{readOnly:!0})],Fp.prototype,"type",void 0),h([f(If)],Fp.prototype,"size",void 0),h([Ut({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),f({json:{default:"center"}})],Fp.prototype,"anchor",void 0),h([f({type:F2,json:{type:[Number],read:{reader:t=>new F2({x:t[0],y:t[1]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Fp.prototype,"anchorPosition",void 0),h([f({type:GC,json:{write:!0}})],Fp.prototype,"outline",void 0),Fp=t2=h([z(Bge)],Fp);const C6e={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function A6e(t){return C6e[t]||(ne.getLogger(Bge).warn(`${t} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const Ny=Fp;let qv=class extends mu($e){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return e!=null&&e.placement===this.placement&&e.style===this.style&&(this.color==null&&e.color==null||this.color!=null&&e.color!=null&&this.color.toJSON()===e.color.toJSON())}};h([f({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],qv.prototype,"type",void 0),h([f({type:e6e,json:{default:"begin-end",write:!0}})],qv.prototype,"placement",void 0),h([f({type:Cge,json:{default:"arrow",write:!0}})],qv.prototype,"style",void 0),h([f({type:Ye,json:{type:[Ln],default:null,write:!0}})],qv.prototype,"color",void 0),qv=h([z("esri.symbols.LineStyleMarker3D")],qv);const AV=qv;var JI;let kp=JI=class extends qf{constructor(t){super(t),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=jd(1),this.pattern=null,this.marker=null}clone(){const t={enabled:this.enabled,material:this.material!=null?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:this.pattern!=null?this.pattern.clone():null,marker:this.marker!=null?this.marker.clone():null};return new JI(t)}static fromSimpleLineSymbol(t){const e={enabled:!0,size:t.width??jd(1),cap:t.cap||"butt",join:t.join||"miter",pattern:t.style&&t.style!=="inside-frame"?new cW({style:t.style}):null,material:new iu({color:(t.color||KA).clone()}),marker:t.marker?new AV({placement:t.marker.placement,style:t.marker.style,color:t.marker.color?.clone()??null}):null};return new JI(e)}};h([f({type:iu,json:{write:!0}})],kp.prototype,"material",void 0),h([Ut({Line:"line"},{readOnly:!0})],kp.prototype,"type",void 0),h([f({type:Fge,json:{write:!0,default:"miter"}})],kp.prototype,"join",void 0),h([f({type:pW,json:{write:!0,default:"butt"}})],kp.prototype,"cap",void 0),h([f(If)],kp.prototype,"size",void 0),h([f(Mge)],kp.prototype,"pattern",void 0),h([f({types:{key:"type",base:AV,typeMap:{style:AV}},json:{write:!0}})],kp.prototype,"marker",void 0),kp=JI=h([z("esri.symbols.LineSymbol3DLayer")],kp);const vR=kp;var OV;const O6e=fu()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let jC=OV=class extends $e{clone(){return new OV({href:this.href,primitive:this.primitive})}};h([f({type:String,json:{read:Bq,write:Ob}})],jC.prototype,"href",void 0),h([Ut(O6e)],jC.prototype,"primitive",void 0),jC=OV=h([z("esri.symbols.support.ObjectSymbol3DLayerResource")],jC);const Vge="sphere";var RV;let x1=RV=class extends xe{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new RV({x:this.x,y:this.y,z:this.z})}};h([f({type:Number})],x1.prototype,"x",void 0),h([f({type:Number})],x1.prototype,"y",void 0),h([f({type:Number})],x1.prototype,"z",void 0),x1=RV=h([z("esri.symbols.support.Symbol3DAnchorPosition3D")],x1);var PV;let xa=PV=class extends qf{constructor(t){super(t),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new PV({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition?.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:this.material?.clone()??null,castShadows:this.castShadows,resource:this.resource?.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};h([f({type:iu,json:{write:!0}})],xa.prototype,"material",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],xa.prototype,"castShadows",void 0),h([f({type:jC,json:{write:!0}})],xa.prototype,"resource",void 0),h([Ut({Object:"object"},{readOnly:!0})],xa.prototype,"type",void 0),h([f({type:Number,json:{write:!0}})],xa.prototype,"width",void 0),h([f({type:Number,json:{write:!0}})],xa.prototype,"height",void 0),h([f({type:Number,json:{write:!0}})],xa.prototype,"depth",void 0),h([Ut({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),f({json:{default:"origin"}})],xa.prototype,"anchor",void 0),h([f({type:x1,json:{type:[Number],read:{reader:t=>new x1({x:t[0],y:t[1],z:t[2]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y,t.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],xa.prototype,"anchorPosition",void 0),h([f({type:Number,json:{write:!0}})],xa.prototype,"heading",void 0),h([f({type:Number,json:{write:!0}})],xa.prototype,"tilt",void 0),h([f({type:Number,json:{write:!0}})],xa.prototype,"roll",void 0),h([f({readOnly:!0})],xa.prototype,"isPrimitive",null),xa=PV=h([z("esri.symbols.ObjectSymbol3DLayer")],xa);const fW=xa;var MV;let el=MV=class extends qf{constructor(t){super(t),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(t,e){return t??(e.height==null&&e.size!=null?e.size:void 0)}readHeight(t,e){return t??(e.width==null&&e.size!=null?e.size:void 0)}clone(){return new MV({enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};h([f({type:iu,json:{write:!0}})],el.prototype,"material",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],el.prototype,"castShadows",void 0),h([Ut({Path:"path"},{readOnly:!0})],el.prototype,"type",void 0),h([f({type:["circle","quad"],json:{write:!0,default:"circle"}})],el.prototype,"profile",void 0),h([f({type:Fge,json:{write:!0,default:"miter"}})],el.prototype,"join",void 0),h([f({type:_6e,json:{write:!0,default:"butt"}})],el.prototype,"cap",void 0),h([f({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],el.prototype,"width",void 0),h([Ni("width",["width","size","height"])],el.prototype,"readWidth",null),h([f({type:Number,json:{write:!0}})],el.prototype,"height",void 0),h([Ni("height",["height","size","width"])],el.prototype,"readHeight",null),h([f({type:["center","bottom","top"],json:{write:!0,default:"center"}})],el.prototype,"anchor",void 0),h([f({type:["heading","all"],json:{write:!0,default:"all"}})],el.prototype,"profileRotation",void 0),el=MV=h([z("esri.symbols.PathSymbol3DLayer")],el);const mW=el;var $V;let k2=$V=class extends $e{constructor(){super(...arguments),this.color=new Ye([0,0,0,1]),this.size=0}clone(){const t={color:ye(this.color),size:this.size};return new $V(t)}};h([f(Fg)],k2.prototype,"color",void 0),h([f(If)],k2.prototype,"size",void 0),k2=$V=h([z("esri.symbols.support.Symbol3DHalo")],k2);let e3=class extends mu($e){constructor(e){super(e),this.color=null}};h([f(Fg)],e3.prototype,"color",void 0),e3=h([z("esri.symbols.support.Symbol3DTextBackground")],e3);var KI;let $l=KI=class extends qf{constructor(t){super(t),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(t){t!=null&&this._userSize!=null&&(t.size=this._userSize),this._set("font",t)}writeFont(t,e,i,r){const n={...r,textSymbol3D:!0};e.font=t.write({},n),delete e.font.size}get size(){return this._userSize!=null?this._userSize:this.font?.size!=null?this.font.size:9}set size(t){this._userSize=t,this.font!=null&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const t=new KI({enabled:this.enabled,font:this.font&&ye(this.font),halo:this.halo&&ye(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:this.material!=null?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:ye(this.background)});return t._userSize=this._userSize,t}static fromTextSymbol(t){return new KI({font:t.font!=null?t.font.clone():new J4,halo:R6e(t.haloColor,t.haloSize),horizontalAlignment:t.horizontalAlignment,lineHeight:t.lineHeight,material:t.color?new iu({color:t.color.clone()}):null,text:t.text,verticalAlignment:t.verticalAlignment,background:t.backgroundColor?new e3({color:t.backgroundColor.clone()}):null})}};function R6e(t,e){return t&&e!=null&&e>0?new k2({color:ye(t),size:e}):null}h([f({type:J4,json:{write:!0}})],$l.prototype,"font",null),h([di("font")],$l.prototype,"writeFont",null),h([f({type:k2,json:{write:!0}})],$l.prototype,"halo",void 0),h([f({...Uge,json:{default:"center",write:!0}})],$l.prototype,"horizontalAlignment",void 0),h([f({...kge,json:{default:1,write:!0}})],$l.prototype,"lineHeight",void 0),h([f({type:iu,json:{write:!0}})],$l.prototype,"material",void 0),h([f({type:e3,json:{write:!0}})],$l.prototype,"background",void 0),h([f(If)],$l.prototype,"size",null),h([f({type:String,json:{write:!0}})],$l.prototype,"text",void 0),h([Ut({Text:"text"},{readOnly:!0})],$l.prototype,"type",void 0),h([f({...zge,json:{default:"baseline",write:!0}})],$l.prototype,"verticalAlignment",void 0),$l=KI=h([z("esri.symbols.TextSymbol3DLayer")],$l);const ow=$l;var IV;let X0=IV=class extends qf{constructor(t){super(t),this.color=LV.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new IV({color:ye(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};h([f({type:Ye,nonNullable:!0,json:{type:[Ln],write:(t,e,i)=>e[i]=t.toArray(Ye.AlphaMode.UNLESS_OPAQUE),default:()=>LV.clone(),defaultEquals:t=>t.toCss(!0)===LV.toCss(!0)}})],X0.prototype,"color",void 0),h([Ut({Water:"water"},{readOnly:!0})],X0.prototype,"type",void 0),h([f({type:["small","medium","large"],json:{write:!0,default:"medium"}})],X0.prototype,"waterbodySize",void 0),h([f({type:Number,json:{write:!0,default:null}})],X0.prototype,"waveDirection",void 0),h([f({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],X0.prototype,"waveStrength",void 0),X0=IV=h([z("esri.symbols.WaterSymbol3DLayer")],X0);const LV=new Ye([0,119,190]),Gge=X0;var DV;let Wv=DV=class extends xe{constructor(t){super(t),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new DV({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};h([f({type:String})],Wv.prototype,"name",void 0),h([f({type:String})],Wv.prototype,"styleUrl",void 0),h([f({type:String})],Wv.prototype,"styleName",void 0),h([f({type:ia})],Wv.prototype,"portal",void 0),Wv=DV=h([z("esri.symbols.support.StyleOrigin")],Wv);const sO=Wv;var NV;let eb=NV=class extends xe{constructor(){super(...arguments),this.url=""}clone(){return new NV({url:this.url})}};h([f({type:String})],eb.prototype,"url",void 0),eb=NV=h([z("esri.symbols.support.Thumbnail")],eb);const jge={icon:Ny,object:fW,line:vR,path:mW,fill:_R,extrude:Ege,text:ow,water:Gge},P6e=ft.ofType({base:qf,key:"type",typeMap:jge,errorContext:"symbol-layer"});let Up=class extends gu{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const i=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,r=i?.type,n=r||ft;this._set("symbolLayers",new n)}get color(){return null}set color(e){this.constructed&&ne.getLogger(this).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){vg(e,this._get("symbolLayers"))}readStyleOrigin(e,i,r){if(e.styleUrl&&e.name){const n=Ab(e.styleUrl,r);return new sO({styleUrl:n,name:e.name})}if(e.styleName&&e.name)return new sO({portal:r?.portal||ia.getDefault(),styleName:e.styleName,name:e.name});r?.messages&&r.messages.push(new mb("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:r,definition:e}))}writeStyleOrigin(e,i,r,n){if(e.styleUrl&&e.name){let s=jT(e.styleUrl,n);Qc(s)&&(s=Dd(s)),i.styleOrigin={styleUrl:s,name:e.name}}else e.styleName&&e.name&&(e.portal&&n?.portal&&!VPe(e.portal.restUrl,n.portal.restUrl)?n?.messages&&n.messages.push(new mb("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):i.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof qf||e&&jge[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};h([f({json:{read:!1,write:!1}})],Up.prototype,"color",null),h([f({type:P6e,nonNullable:!0,json:{write:!0}}),rr(jH)],Up.prototype,"symbolLayers",null),h([f({type:sO})],Up.prototype,"styleOrigin",void 0),h([Ni("styleOrigin")],Up.prototype,"readStyleOrigin",null),h([di("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],Up.prototype,"writeStyleOrigin",null),h([f({type:eb,json:{read:!1}})],Up.prototype,"thumbnail",void 0),h([f({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],Up.prototype,"type",void 0),Up=h([z("esri.symbols.Symbol3D")],Up);const kS=Up;let HC=class extends $e{constructor(e){super(e),this.visible=!0}clone(){}};h([f({type:["line"],constructOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],HC.prototype,"type",void 0),h([f({readOnly:!0})],HC.prototype,"visible",void 0),HC=h([z("esri.symbols.callouts.Callout3D")],HC);const Hge=HC;var FV;let QI=FV=class extends $e{constructor(t){super(t),this.color=new Ye("white")}clone(){return new FV({color:ye(this.color)})}};h([f(Fg)],QI.prototype,"color",void 0),QI=FV=h([z("esri.symbols.callouts.LineCallout3DBorder")],QI);const M6e=QI;var kV;let Z0=kV=class extends Hge{constructor(t){super(t),this.type="line",this.color=new Ye([0,0,0,1]),this.size=jd(1),this.border=null}get visible(){return this.size>0&&this.color!=null&&this.color.a>0}clone(){return new kV({color:ye(this.color),size:this.size,border:ye(this.border)})}};h([Ut({line:"line"})],Z0.prototype,"type",void 0),h([f(Fg)],Z0.prototype,"color",void 0),h([f(If)],Z0.prototype,"size",void 0),h([f({type:M6e,json:{write:!0}})],Z0.prototype,"border",void 0),h([f({readOnly:!0})],Z0.prototype,"visible",null),Z0=kV=h([z("esri.symbols.callouts.LineCallout3D")],Z0);const qge=Z0;function gW(t){if(!t)return!1;const e=t.verticalOffset;return!!e&&!(e.screenLength<=0||e.maxWorldLength!=null&&e.maxWorldLength<=0)}function Wge(t){if(!t||!t.supportsCallout||!t.supportsCallout())return!1;const e=t.callout;return!!e&&!!e.visible&&!!gW(t)}function yW(t){return t.type==="point-3d"||t.type==="label-3d"}function Yge(t){return t.horizontalAlignment==="center"}const Xge={types:{key:"type",base:Hge,typeMap:{line:qge}},json:{write:!0}};var UV;let i2=UV=class extends $e{constructor(t){super(t),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new UV({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};h([f(If)],i2.prototype,"screenLength",void 0),h([f({type:Number,nonNullable:!0,json:{write:!0,default:0}})],i2.prototype,"minWorldLength",void 0),h([f({type:Number,json:{write:!0}})],i2.prototype,"maxWorldLength",void 0),i2=UV=h([z("esri.symbols.support.Symbol3DVerticalOffset")],i2);const _W=i2;var eL;const Zge=ft.ofType({base:null,key:"type",typeMap:{text:ow}});let J0=eL=class extends kS{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new Zge,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return Wge(this)}hasVisibleVerticalOffset(){return gW(this)}clone(){return new eL({styleOrigin:ye(this.styleOrigin),symbolLayers:ye(this.symbolLayers),thumbnail:ye(this.thumbnail),callout:ye(this.callout),verticalOffset:ye(this.verticalOffset)})}static fromTextSymbol(t){return new eL({symbolLayers:new ft([ow.fromTextSymbol(t)])})}};h([f({type:_W,json:{write:!0}})],J0.prototype,"verticalOffset",void 0),h([f(Xge)],J0.prototype,"callout",void 0),h([f({json:{read:!1,write:!1}})],J0.prototype,"styleOrigin",void 0),h([f({type:Zge})],J0.prototype,"symbolLayers",void 0),h([Ut({LabelSymbol3D:"label-3d"},{readOnly:!0})],J0.prototype,"type",void 0),J0=eL=h([z("esri.symbols.LabelSymbol3D")],J0);const K4=J0;var tL;const Jge=ft.ofType({base:null,key:"type",typeMap:{line:vR,path:mW}}),$6e=ft.ofType({base:null,key:"type",typeMap:{line:vR,path:mW}});let qC=tL=class extends kS{constructor(t){super(t),this.symbolLayers=new Jge,this.type="line-3d"}clone(){return new tL({styleOrigin:ye(this.styleOrigin),symbolLayers:ye(this.symbolLayers),thumbnail:ye(this.thumbnail)})}static fromSimpleLineSymbol(t){return new tL({symbolLayers:new ft([vR.fromSimpleLineSymbol(t)])})}};h([f({type:Jge,json:{type:$6e}})],qC.prototype,"symbolLayers",void 0),h([Ut({LineSymbol3D:"line-3d"},{readOnly:!0})],qC.prototype,"type",void 0),qC=tL=h([z("esri.symbols.LineSymbol3D")],qC);const Q4=qC;let K0=class extends gu{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};h([f({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],K0.prototype,"angle",void 0),h([f({type:["simple-marker","picture-marker"],readOnly:!0})],K0.prototype,"type",void 0),h([f({type:Number,cast:Bn,json:{write:!0}})],K0.prototype,"xoffset",void 0),h([f({type:Number,cast:Bn,json:{write:!0}})],K0.prototype,"yoffset",void 0),h([f({type:Number,cast:t=>t==="auto"?t:Bn(t),json:{write:!0}})],K0.prototype,"size",void 0),K0=h([z("esri.symbols.MarkerSymbol")],K0);const Kge=K0;var iL;const Qge=ft.ofType({base:null,key:"type",typeMap:{fill:_R}});let WC=iL=class extends kS{constructor(t){super(t),this.symbolLayers=new Qge,this.type="mesh-3d"}clone(){return new iL({styleOrigin:ye(this.styleOrigin),symbolLayers:ye(this.symbolLayers),thumbnail:ye(this.thumbnail)})}static fromSimpleFillSymbol(t){return new iL({symbolLayers:new ft([_R.fromSimpleFillSymbol(t)])})}};h([f({type:Qge})],WC.prototype,"symbolLayers",void 0),h([Ut({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],WC.prototype,"type",void 0),WC=iL=h([z("esri.symbols.MeshSymbol3D")],WC);const eF=WC;function I6e(t,e,i){return e.imageData?Jhe({mediaType:e.contentType||"image/png",isBase64:!0,data:e.imageData}):e0e(e.url,i)}function e0e(t,e){return D6e(e)&&!Qc(t)&&e?.layer?.parsedUrl?zf(e.layer.parsedUrl.path,"images",t):Ab(t,e)}function L6e(t,e,i,r){if(Bf(t)){const n=Qy(t);if(!n)return;e.contentType=n.mediaType,e.imageData=n.data,i&&i.imageData===e.imageData&&i.url&&Ob(i.url,e,"url",r)}else Ob(t,e,"url",r)}const t0e={json:{read:{source:["imageData","url"],reader:I6e},write:{writer(t,e,i,r){L6e(t,e,this.source,r)}}}},i0e={readOnly:!0,json:{read:{source:["imageData","url"],reader(t,e,i){const r={};return e.imageData&&(r.imageData=e.imageData),e.contentType&&(r.contentType=e.contentType),e.url&&(r.url=e0e(e.url,i)),r}}}};function D6e(t){return!(t==null||t.origin!=="service"&&t.origin!=="portal-item"||t.layer?.type!=="feature"&&t.layer?.type!=="stream")}var zV;let Du=zV=class extends Age{constructor(...t){super(...t),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string"&&t.imageData==null)return t;const n={};return t&&(n.url=t),e&&(n.outline=e),i!=null&&(n.width=Bn(i)),r!=null&&(n.height=Bn(r)),n}clone(){const t=new zV({color:ye(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return t._set("source",ye(this.source)),t}hash(){return`${super.hash()}.${this.color?.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};h([Ut({esriPFS:"picture-fill"},{readOnly:!0})],Du.prototype,"type",void 0),h([f(t0e)],Du.prototype,"url",void 0),h([f({type:Number,json:{write:!0}})],Du.prototype,"xscale",void 0),h([f({type:Number,json:{write:!0}})],Du.prototype,"yscale",void 0),h([f({type:Number,cast:Bn,json:{write:!0}})],Du.prototype,"width",void 0),h([f({type:Number,cast:Bn,json:{write:!0}})],Du.prototype,"height",void 0),h([f({type:Number,cast:Bn,json:{write:!0}})],Du.prototype,"xoffset",void 0),h([f({type:Number,cast:Bn,json:{write:!0}})],Du.prototype,"yoffset",void 0),h([f(i0e)],Du.prototype,"source",void 0),Du=zV=h([z("esri.symbols.PictureFillSymbol")],Du);const r0e=Du;var BV;let Kh=BV=class extends Kge{constructor(...t){super(...t),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string"&&t.imageData==null)return t;const r={};return t&&(r.url=t),e!=null&&(r.width=Bn(e)),i!=null&&(r.height=Bn(i)),r}readHeight(t,e){return e.size||t}readWidth(t,e){return e.size||t}clone(){const t=new BV({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return t._set("source",ye(this.source)),t}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};h([f({json:{write:!1}})],Kh.prototype,"color",void 0),h([Ut({esriPMS:"picture-marker"},{readOnly:!0})],Kh.prototype,"type",void 0),h([f(t0e)],Kh.prototype,"url",void 0),h([f(i0e)],Kh.prototype,"source",void 0),h([f({type:Number,cast:Bn,json:{write:!0}})],Kh.prototype,"height",void 0),h([Ni("height",["height","size"])],Kh.prototype,"readHeight",null),h([f({type:Number,cast:Bn,json:{write:!0}})],Kh.prototype,"width",void 0),h([f({json:{write:!1}})],Kh.prototype,"size",void 0),Kh=BV=h([z("esri.symbols.PictureMarkerSymbol")],Kh);const tF=Kh;var Yv;const n0e=ft.ofType({base:null,key:"type",typeMap:{icon:Ny,object:fW,text:ow}});let Xv=Yv=class extends kS{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.symbolLayers=new n0e,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const t of this.symbolLayers.items)switch(t.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return Wge(this)}hasVisibleVerticalOffset(){return gW(this)}clone(){return new Yv({verticalOffset:ye(this.verticalOffset),callout:ye(this.callout),styleOrigin:ye(this.styleOrigin),symbolLayers:ye(this.symbolLayers),thumbnail:ye(this.thumbnail)})}static fromSimpleMarkerSymbol(t){return new Yv({symbolLayers:new ft([Ny.fromSimpleMarkerSymbol(t)])})}static fromPictureMarkerSymbol(t){return new Yv({symbolLayers:new ft([Ny.fromPictureMarkerSymbol(t)])})}static fromCIMSymbol(t){if(t.data?.symbol?.type!=="CIMPointSymbol")return null;const i=t.data.symbol;return new Yv(i?.callout?{symbolLayers:new ft([Ny.fromCIMSymbol(t)]),callout:new qge({size:.5,color:new Ye([0,0,0])}),verticalOffset:new _W({screenLength:40})}:{symbolLayers:new ft([Ny.fromCIMSymbol(t)])})}static fromTextSymbol(t){return new Yv({symbolLayers:new ft([ow.fromTextSymbol(t)])})}};h([f({type:_W,json:{write:!0}})],Xv.prototype,"verticalOffset",void 0),h([f(Xge)],Xv.prototype,"callout",void 0),h([f({type:n0e,json:{origins:{"web-scene":{write:!0}}}})],Xv.prototype,"symbolLayers",void 0),h([Ut({PointSymbol3D:"point-3d"},{readOnly:!0})],Xv.prototype,"type",void 0),Xv=Yv=h([z("esri.symbols.PointSymbol3D")],Xv);const Fy=Xv;var YC;const s0e=ft.ofType({base:null,key:"type",typeMap:{extrude:Ege,fill:_R,icon:Ny,line:vR,object:fW,text:ow,water:Gge}});let XC=YC=class extends kS{constructor(t){super(t),this.symbolLayers=new s0e,this.type="polygon-3d"}initialize(){const t=e=>{e.type==="line"&&RT(ne.getLogger(this),"LineSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use FillSymbol3DLayer.outline instead.",version:"4.28"}),e.type==="text"&&RT(ne.getLogger(this),"TextSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use Labels instead.",version:"4.28"})};for(const e of this.symbolLayers)t(e);this.addHandles(Io(()=>this.symbolLayers,"after-add",({item:e})=>t(e),qi))}clone(){return new YC({styleOrigin:ye(this.styleOrigin),symbolLayers:ye(this.symbolLayers),thumbnail:ye(this.thumbnail)})}static fromJSON(t){const e=new YC;if(e.read(t),e.symbolLayers.length===2&&e.symbolLayers.at(0).type==="fill"&&e.symbolLayers.at(1).type==="line"){const i=e.symbolLayers.at(0),r=e.symbolLayers.at(1);!r.enabled||t.symbolLayers?.[1]&&t.symbolLayers[1].enable===!1||(i.outline={size:r.size,color:r.material!=null?r.material.color:null}),e.symbolLayers.removeAt(1)}return e}static fromSimpleFillSymbol(t){return new YC({symbolLayers:new ft([_R.fromSimpleFillSymbol(t)])})}};h([f({type:s0e,json:{write:!0}})],XC.prototype,"symbolLayers",void 0),h([Ut({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],XC.prototype,"type",void 0),XC=YC=h([z("esri.symbols.PolygonSymbol3D")],XC);const iF=XC;var VV;const w6=new uu({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let Zv=VV=class extends Age{constructor(...t){super(...t),this.color=new Ye([0,0,0,.25]),this.outline=new rw,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.style=t),e&&(r.outline=e),i&&(r.color=i),r}clone(){return new VV({color:ye(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};h([f()],Zv.prototype,"color",void 0),h([f()],Zv.prototype,"outline",void 0),h([Ut({esriSFS:"simple-fill"},{readOnly:!0})],Zv.prototype,"type",void 0),h([f({type:w6.apiValues,json:{read:w6.read,write:w6.write}})],Zv.prototype,"style",void 0),Zv=VV=h([z("esri.symbols.SimpleFillSymbol")],Zv);const vW=Zv;var GV;const x6=new uu({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let zp=GV=class extends Kge{constructor(...t){super(...t),this.color=new Ye([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new rw}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string")return t;const n={};return t&&(n.style=t),e!=null&&(n.size=Bn(e)),i&&(n.outline=i),r&&(n.color=r),n}writeColor(t,e){t&&this.style!=="x"&&this.style!=="cross"&&(e.color=t.toJSON()),t===null&&(e.color=null)}set path(t){this.style="path",this._set("path",t)}clone(){return new GV({angle:this.angle,color:ye(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${this.outline?.hash()}`}};h([f()],zp.prototype,"color",void 0),h([di("color")],zp.prototype,"writeColor",null),h([Ut({esriSMS:"simple-marker"},{readOnly:!0})],zp.prototype,"type",void 0),h([f()],zp.prototype,"size",void 0),h([f({type:x6.apiValues,json:{read:x6.read,write:x6.write}})],zp.prototype,"style",void 0),h([f({type:String,json:{write:!0}})],zp.prototype,"path",null),h([f({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":rw}},json:{default:null,write:!0}})],zp.prototype,"outline",void 0),zp=GV=h([z("esri.symbols.SimpleMarkerSymbol")],zp);const rF=zp;var jV;let En=jV=class extends gu{constructor(...t){super(...t),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new J4,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.text=t),e&&(r.font=e),i&&(r.color=i),r}writeLineWidth(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}castLineWidth(t){return Bn(t)}writeLineHeight(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}clone(){return new jV({angle:this.angle,backgroundColor:ye(this.backgroundColor),borderLineColor:ye(this.borderLineColor),borderLineSize:this.borderLineSize,color:ye(this.color),font:this.font&&this.font.clone(),haloColor:ye(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor?.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color?.hash()}.${this.font&&this.font.hash()}.${this.haloColor?.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};h([f({type:Ye,json:{write:!0}})],En.prototype,"backgroundColor",void 0),h([f({type:Ye,json:{write:!0}})],En.prototype,"borderLineColor",void 0),h([f({type:Number,json:{write:!0},cast:Bn})],En.prototype,"borderLineSize",void 0),h([f({type:J4,json:{write:!0}})],En.prototype,"font",void 0),h([f({...Uge,json:{write:!0}})],En.prototype,"horizontalAlignment",void 0),h([f({type:Boolean,json:{write:!0}})],En.prototype,"kerning",void 0),h([f({type:Ye,json:{write:!0}})],En.prototype,"haloColor",void 0),h([f({type:Number,cast:Bn,json:{write:!0}})],En.prototype,"haloSize",void 0),h([f({type:Boolean,json:{write:!0}})],En.prototype,"rightToLeft",void 0),h([f({type:Boolean,json:{write:!0}})],En.prototype,"rotated",void 0),h([f({type:String,json:{write:!0}})],En.prototype,"text",void 0),h([Ut({esriTS:"text"},{readOnly:!0})],En.prototype,"type",void 0),h([f({...zge,json:{write:!0}})],En.prototype,"verticalAlignment",void 0),h([f({type:Number,cast:Bn,json:{write:!0}})],En.prototype,"xoffset",void 0),h([f({type:Number,cast:Bn,json:{write:!0}})],En.prototype,"yoffset",void 0),h([f({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],En.prototype,"angle",void 0),h([f({type:Number,json:{write:!0}})],En.prototype,"width",void 0),h([f({type:Number})],En.prototype,"lineWidth",void 0),h([di("lineWidth")],En.prototype,"writeLineWidth",null),h([rr("lineWidth")],En.prototype,"castLineWidth",null),h([f(kge)],En.prototype,"lineHeight",void 0),h([di("lineHeight")],En.prototype,"writeLineHeight",null),En=jV=h([z("esri.symbols.TextSymbol")],En);const bR=En;var HV;let Qh=HV=class extends gu{constructor(t){super(t),this.color=null,this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const t=this.portal!=null?this.portal:ia.getDefault(),e=t.user?t.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${e}:${t.url}`}read(t,e){this.portal=e?.portal,super.read(t,e)}clone(){return new HV({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(t){return this._fetchSymbol("webRef",t)}fetchCIMSymbol(t){return this._fetchSymbol("cimRef",t)}async _fetchSymbol(t,e){const i=e!=null?e.cache:null,r=i?this._fetchCacheKey:null;if(i!=null){const a=r&&i.get(r);if(a)return a.clone()}const{resolveWebStyleSymbol:n}=await pe(()=>Promise.resolve().then(()=>iat),void 0,import.meta.url);Et(e);const s=n(this,{portal:this.portal},t,e);s.catch(a=>{ne.getLogger(this).error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await s;return t==="webRef"&&o.type==="point-3d"||t==="cimRef"&&o.type==="cim"?(i?.set(r,o.clone()),o):null}};h([f({json:{write:!1}})],Qh.prototype,"color",void 0),h([f({type:String,json:{write:!0}})],Qh.prototype,"styleName",void 0),h([f({type:ia,json:{write:!1}})],Qh.prototype,"portal",void 0),h([f({type:String,json:{read:Bq,write:Ob}})],Qh.prototype,"styleUrl",void 0),h([f({type:eb,json:{read:!1}})],Qh.prototype,"thumbnail",void 0),h([f({type:String,json:{write:!0}})],Qh.prototype,"name",void 0),h([Ut({styleSymbolReference:"web-style"},{readOnly:!0})],Qh.prototype,"type",void 0),h([f()],Qh.prototype,"_fetchCacheKey",null),Qh=HV=h([z("esri.symbols.WebStyleSymbol")],Qh);const US=Qh;function nF(t){if(!t)return!1;switch(t.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function Ib(t){if(!t)return!1;switch(t.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const bW={base:gu,key:"type",typeMap:{"simple-fill":vW,"picture-fill":r0e,"picture-marker":tF,"simple-line":rw,"simple-marker":rF,text:bR,"label-3d":K4,"line-3d":Q4,"mesh-3d":eF,"point-3d":Fy,"polygon-3d":iF,"web-style":US,cim:yR},errorContext:"symbol"},GAt={base:gu,key:"type",typeMap:{"picture-marker":tF,"simple-marker":rF,text:bR,"web-style":US,cim:yR},errorContext:"symbol"},N6e=Ohe({types:bW}),jAt={base:gu,key:"type",typeMap:{"simple-fill":vW,"picture-fill":r0e,"picture-marker":tF,"simple-line":rw,"simple-marker":rF,text:bR,"line-3d":Q4,"mesh-3d":eF,"point-3d":Fy,"polygon-3d":iF,"web-style":US,cim:yR},errorContext:"symbol"},HAt={base:gu,key:"type",typeMap:{text:bR,"label-3d":K4},errorContext:"symbol"},qAt={base:gu,key:"type",typeMap:{"line-3d":Q4,"mesh-3d":eF,"point-3d":Fy,"polygon-3d":iF,"web-style":US,cim:yR},errorContext:"symbol"},WAt={base:gu,key:"type",typeMap:{"label-3d":K4},errorContext:"symbol"},YAt=Ky(bW);var qV;function F6e(t){if(!t)return null;const e={};for(const i in t){const r=Cb(t[i]);r&&(e[i]=r)}return Object.keys(e).length!==0?e:null}function k6e(t){if(t==null)return null;const e={};for(const i in t){const r=t[i];r&&(e[i]=r.toJSON())}return Object.keys(e).length!==0?e:null}let Il=qV=class extends mu($e){constructor(...t){super(...t),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:Kc(),configurable:!0})}normalizeCtorArgs(t,e,i,r){return t&&!t.declaredClass?t:{geometry:t,symbol:e,attributes:i,popupTemplate:r}}set aggregateGeometries(t){const e=this._get("aggregateGeometries");JSON.stringify(e)!==JSON.stringify(t)&&this._set("aggregateGeometries",t)}set attributes(t){const e=this._get("attributes");e!==t&&(this._set("attributes",t),this._notifyLayer("attributes",e,t))}set geometry(t){const e=this._get("geometry");e!==t&&(this._set("geometry",t),this._notifyLayer("geometry",e,t))}set symbol(t){const e=this._get("symbol");e!==t&&(this._set("symbol",t),this._notifyLayer("symbol",e,t))}set visible(t){const e=this._get("visible");e!==t&&(this._set("visible",t),this._notifyLayer("visible",e,t))}cloneShallow(){return new qV({aggregateGeometries:this.aggregateGeometries,attributes:this.attributes,geometry:this.geometry,isAggregate:this.isAggregate,layer:this.layer,popupTemplate:this.popupTemplate,sourceLayer:this.sourceLayer,symbol:this.symbol,visible:this.visible})}getEffectivePopupTemplate(t=!1){if(this.popupTemplate)return this.popupTemplate;for(const e of[this.sourceLayer,this.layer])if(e){if("popupTemplate"in e&&e.popupTemplate)return e.popupTemplate;if(t&&"defaultPopupTemplate"in e&&e.defaultPopupTemplate!=null)return e.defaultPopupTemplate}return null}getAttribute(t){return this.attributes?.[t]}setAttribute(t,e){if(this.attributes){const i=this.getAttribute(t);this.attributes[t]=e,this._notifyLayer("attributes",i,e,t)}else this.attributes={[t]:e},this._notifyLayer("attributes",void 0,e,t)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:k6e(this.aggregateGeometries),geometry:this.geometry!=null?this.geometry.toJSON():null,symbol:this.symbol!=null?this.symbol.toJSON():null,attributes:mB(this.attributes)?this.attributes.toJSON():{...this.attributes},popupTemplate:this.popupTemplate?.toJSON()??null}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(t={}){const{geometry:e}=this;if(e?.type==="mesh"){const i={origin:e.origin,transform:e.transform};this._notifyLayer("origin-transform",i,i,t.action)}}_notifyLayer(t,e,i,r){if(!this.layer||!("graphicChanged"in this.layer))return;const n={graphic:this,property:t,oldValue:e,newValue:i};t==="origin-transform"&&(n.action=r),t==="attributes"&&(n.attributeName=r),this.layer.graphicChanged(n)}};h([f({value:null,json:{read:F6e}})],Il.prototype,"aggregateGeometries",null),h([f({value:null})],Il.prototype,"attributes",null),h([f({value:null,types:Rq,json:{read:Cb}})],Il.prototype,"geometry",null),h([f({type:Boolean})],Il.prototype,"isAggregate",void 0),h([f({clonable:"reference"})],Il.prototype,"layer",void 0),h([f({type:Xke})],Il.prototype,"popupTemplate",void 0),h([f({clonable:"reference"})],Il.prototype,"sourceLayer",void 0),h([f({value:null,types:bW})],Il.prototype,"symbol",null),h([f({type:Boolean,value:!0})],Il.prototype,"visible",null),Il=qV=h([z("esri.Graphic")],Il),function(t){t.generateUID=Kc}(Il||(Il={}));const Lb=Il;function sF(t){return typeof t=="string"?document.getElementById(t):t??null}function o0e(t){for(;t.hasChildNodes();)t.removeChild(t.firstChild)}function kQ(t,e){const i=e.parentNode;i&&i.insertBefore(t,e)}function UQ(t,e){for(;;){const i=t.firstChild;if(!i)break;e.appendChild(i)}}let hN=class{constructor(e=i=>i.values().next().value){this._peeker=e,this._observable=new nR,this._items=new Set}get length(){return Ct(this._observable),this._items.size}clear(){this.length!==0&&(this._items.clear(),this._observable.notify())}last(){if(this.length===0)return;let e;for(e of this._items);return e}peek(){if(this.length!==0)return this._peeker(this._items)}push(e){this.contains(e)||(this._items.add(e),this._observable.notify())}contains(e){return Ct(this._observable),this._items.has(e)}pop(){if(this.length===0)return;const e=this.peek();return this._items.delete(e),this._observable.notify(),e}popLast(){if(this.length===0)return;const e=this.last();return this._items.delete(e),this._observable.notify(),e}remove(e){this.contains(e)&&(this._items.delete(e),this._observable.notify())}filter(e){const i=this.length;return this._items.forEach(r=>{e(r)||this._items.delete(r)}),i!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){Ct(this._observable),yield*this._items}};const a0e=new FinalizationRegistry(t=>{t.close()});function U6e(t,e){a0e.register(t,e,e)}function z6e(t){a0e.unregister(t)}const B6e={statsWorker:()=>pe(()=>import("./statsWorker-d6e985b9.js"),["./statsWorker-d6e985b9.js","./utils-4576de5f.js","./heatmapUtils-3c0e0ece.js","./utils-e24aed40.js","./generateRendererUtils-1c8bce12.js"],import.meta.url),geometryEngineWorker:()=>pe(()=>import("./geometryEngineWorker-1f528451.js"),["./geometryEngineWorker-1f528451.js","./geometryEngineJSON-3c45c350.js","./geometryEngineBase-2020e3dc.js","./json-48e3ea08.js"],import.meta.url),CSVSourceWorker:()=>pe(()=>import("./CSVSourceWorker-9fc9314a.js"),["./CSVSourceWorker-9fc9314a.js","./date-430969b3.js","./json-48e3ea08.js","./FeatureStore-d414226c.js","./BoundsStore-409e99ee.js","./PooledRBush-05d409af.js","./quickselect-fc5bb707.js","./QueryEngine-03d16de6.js","./WhereClause-4988664d.js","./TimeOnly-a96593b0.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-4576de5f.js","./heatmapUtils-3c0e0ece.js","./utils-e24aed40.js","./generateRendererUtils-1c8bce12.js","./FieldsIndex-85e142d0.js","./optimizedFeatureQueryEngineAdapter-717c64bf.js","./number-85ab87ed.js","./clientSideDefaults-7259c628.js","./defaultsJSON-59981e75.js"],import.meta.url),EdgeProcessingWorker:()=>pe(()=>import("./EdgeProcessingWorker-1ad79575.js"),[],import.meta.url),ElevationSamplerWorker:()=>pe(()=>import("./ElevationSamplerWorker-9ef30e2f.js"),["./ElevationSamplerWorker-9ef30e2f.js","./PooledRBush-05d409af.js","./quickselect-fc5bb707.js"],import.meta.url),FeatureServiceSnappingSourceWorker:()=>pe(()=>import("./FeatureServiceSnappingSourceWorker-252ea410.js"),["./FeatureServiceSnappingSourceWorker-252ea410.js","./FeatureStore-d414226c.js","./BoundsStore-409e99ee.js","./PooledRBush-05d409af.js","./quickselect-fc5bb707.js","./QueryEngine-03d16de6.js","./WhereClause-4988664d.js","./TimeOnly-a96593b0.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-4576de5f.js","./heatmapUtils-3c0e0ece.js","./utils-e24aed40.js","./generateRendererUtils-1c8bce12.js","./FieldsIndex-85e142d0.js","./optimizedFeatureQueryEngineAdapter-717c64bf.js","./Query-630c5d65.js","./ElevationInfo-36952bdf.js","./symbologySnappingCandidates-d7f920a2.js","./pbfQueryUtils-0854066b.js","./pbf-97a34880.js","./query-ae6e69b4.js","./queryZScale-9dee68ff.js"],import.meta.url),GeoJSONSourceWorker:()=>pe(()=>import("./GeoJSONSourceWorker-f1e0459c.js"),["./GeoJSONSourceWorker-f1e0459c.js","./FeatureStore-d414226c.js","./BoundsStore-409e99ee.js","./PooledRBush-05d409af.js","./quickselect-fc5bb707.js","./QueryEngine-03d16de6.js","./WhereClause-4988664d.js","./TimeOnly-a96593b0.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-4576de5f.js","./heatmapUtils-3c0e0ece.js","./utils-e24aed40.js","./generateRendererUtils-1c8bce12.js","./FieldsIndex-85e142d0.js","./optimizedFeatureQueryEngineAdapter-717c64bf.js","./geojson-ede2d4c1.js","./date-430969b3.js","./clientSideDefaults-7259c628.js","./defaultsJSON-59981e75.js","./sourceUtils-58f78e35.js"],import.meta.url),LercWorker:()=>pe(()=>import("./LercWorker-78076147.js"),[],import.meta.url),MemorySourceWorker:()=>pe(()=>import("./MemorySourceWorker-673d2a2f.js"),["./MemorySourceWorker-673d2a2f.js","./objectIdUtils-967fafff.js","./FeatureStore-d414226c.js","./BoundsStore-409e99ee.js","./PooledRBush-05d409af.js","./quickselect-fc5bb707.js","./QueryEngine-03d16de6.js","./WhereClause-4988664d.js","./TimeOnly-a96593b0.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-4576de5f.js","./heatmapUtils-3c0e0ece.js","./utils-e24aed40.js","./generateRendererUtils-1c8bce12.js","./FieldsIndex-85e142d0.js","./optimizedFeatureQueryEngineAdapter-717c64bf.js","./clientSideDefaults-7259c628.js","./defaultsJSON-59981e75.js","./sourceUtils-58f78e35.js","./date-430969b3.js"],import.meta.url),PBFDecoderWorker:()=>pe(()=>import("./PBFDecoderWorker-00e3ef9f.js"),["./PBFDecoderWorker-00e3ef9f.js","./pbfQueryUtils-0854066b.js","./pbf-97a34880.js"],import.meta.url),Pipeline:()=>pe(()=>import("./Pipeline-71977f9f.js").then(t=>t.P),["./Pipeline-71977f9f.js","./QueryEngine-03d16de6.js","./WhereClause-4988664d.js","./TimeOnly-a96593b0.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-4576de5f.js","./heatmapUtils-3c0e0ece.js","./utils-e24aed40.js","./generateRendererUtils-1c8bce12.js","./FieldsIndex-85e142d0.js","./StreamFeatureManager-8348c744.js","./quickselect-fc5bb707.js","./diffUtils-3ed1f592.js","./labelPoint-fc5dd920.js","./ogcFeatureUtils-e3521781.js","./geojson-ede2d4c1.js","./date-430969b3.js","./clientSideDefaults-7259c628.js","./defaultsJSON-59981e75.js","./query-ae6e69b4.js","./pbfQueryUtils-0854066b.js","./pbf-97a34880.js","./queryZScale-9dee68ff.js","./Query-630c5d65.js","./createConnection-2daa0cd5.js","./definitions-5359da6f.js","./enums-9d4f5c11.js","./number-e491b09e.js","./geohashUtils-77d8429b.js"],import.meta.url),PointCloudWorker:()=>pe(()=>import("./PointCloudWorker-22f29668.js"),["./PointCloudWorker-22f29668.js","./PointCloudWorkerUtil-183a0b1e.js","./PointCloudUniqueValueRenderer-b39faed6.js","./ColorStop-ac9a118d.js","./I3SBinaryReader-024c287a.js"],import.meta.url),RasterWorker:()=>pe(()=>import("./RasterWorker-9c2ebe81.js"),["./RasterWorker-9c2ebe81.js","./dataUtils-bacb2c6b.js","./utils-af2c9311.js","./colorRamps-cf6fa9ce.js","./rasterProjectionHelper-3356de65.js"],import.meta.url),SceneLayerSnappingSourceWorker:()=>pe(()=>import("./SceneLayerSnappingSourceWorker-13be1683.js"),[],import.meta.url),SceneLayerWorker:()=>pe(()=>import("./SceneLayerWorker-e4dafa49.js").then(t=>t.S),["./SceneLayerWorker-e4dafa49.js","./I3SNode-92c7143c.js"],import.meta.url),WFSSourceWorker:()=>pe(()=>import("./WFSSourceWorker-256af171.js"),["./WFSSourceWorker-256af171.js","./FeatureStore-d414226c.js","./BoundsStore-409e99ee.js","./PooledRBush-05d409af.js","./quickselect-fc5bb707.js","./QueryEngine-03d16de6.js","./WhereClause-4988664d.js","./TimeOnly-a96593b0.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-4576de5f.js","./heatmapUtils-3c0e0ece.js","./utils-e24aed40.js","./generateRendererUtils-1c8bce12.js","./FieldsIndex-85e142d0.js","./optimizedFeatureQueryEngineAdapter-717c64bf.js","./geojson-ede2d4c1.js","./date-430969b3.js","./sourceUtils-58f78e35.js","./wfsUtils-38d961b8.js","./xmlUtils-444cb4c0.js"],import.meta.url),WorkerTileHandler:()=>pe(()=>import("./WorkerTileHandler-289b72c1.js"),["./WorkerTileHandler-289b72c1.js","./TileClipper-ae6eca9e.js","./StyleRepository-9854daae.js","./definitions-5359da6f.js","./Rect-98da58d6.js","./pbf-97a34880.js","./TurboLine-f24b8fe3.js","./BidiEngine-9a40f2f4.js"],import.meta.url)};var Ao;(function(t){t[t.HANDSHAKE=0]="HANDSHAKE",t[t.OPEN=1]="OPEN",t[t.OPENED=2]="OPENED",t[t.RESPONSE=3]="RESPONSE",t[t.INVOKE=4]="INVOKE",t[t.ABORT=5]="ABORT",t[t.CLOSE=6]="CLOSE",t[t.OPEN_PORT=7]="OPEN_PORT",t[t.ON=8]="ON"})(Ao||(Ao={}));let V6e=0;function l0e(){return V6e++}function G6e(t){return t&&typeof t=="object"&&("result"in t||"transferList"in t)}function oO(t){return t?typeof t=="string"?JSON.stringify({name:"message",message:t}):t.toJSON?JSON.stringify(t):JSON.stringify({name:t.name,message:t.message,details:t.details||{stack:t.stack}}):null}function wW(t,e,i,r){if(e.type===Ao.OPEN_PORT)return void t.postMessage(e,[e.port]);if(e.type!==Ao.INVOKE&&e.type!==Ao.RESPONSE)return void t.postMessage(e);let n;if(G6e(i)?(n=zQ(i.transferList),e.data=i.result):(n=zQ(r),e.data=i),n){if(ie("ff")){for(const s of n)if("byteLength"in s&&s.byteLength>267386880){const o="Worker call with large ArrayBuffer would crash Firefox";switch(e.type){case Ao.INVOKE:throw o;case Ao.RESPONSE:return void wW(t,{type:Ao.RESPONSE,jobId:e.jobId,error:oO(o)})}}}t.postMessage(e,n)}else t.postMessage(e)}function aO(t){if(!t)return null;const e=t.data;return e?typeof e=="string"?JSON.parse(e):e:null}function zQ(t){if(!t?.length)return null;if(ie("esri-workers-arraybuffer-transfer"))return t;const e=t.filter(i=>!j6e(i));return e.length?e:null}function j6e(t){return t instanceof ArrayBuffer||t?.constructor?.name==="ArrayBuffer"}const{CLOSE:BQ,ABORT:VQ,INVOKE:GQ,RESPONSE:gE,OPEN_PORT:jQ,ON:H6e}=Ao,q6e=2;let W6e=class{constructor(e){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=e,this._timer=null,this._process=this._process.bind(this)}push(e){e.type===Ao.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}},o_=class r2{static connect(e){const i=new MessageChannel;let r;r=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const n=new r2(i.port1,{channel:i,client:r});return typeof r=="object"&&"remoteClient"in r&&(r.remoteClient=n),r2.clients.set(n,r),i.port2}static loadWorker(e){const i=B6e[e];return i?i():Promise.resolve(null)}constructor(e,i,r){this._port=e,this._jobQueue=r,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new W6e(n=>this._onInvokeMessage(n)),this._client=i.client,this._onMessage=this._onMessage.bind(this),this._channel=i.channel,this._schedule=i.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:BQ}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,i,r){const n=r?.signal,s=r?.transferList;if(!this._port)return Promise.reject(new W("worker:port-closed",`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:i}));const o=l0e();return new Promise((a,l)=>{if(Hn(n))return this._processWork(),void l(pi());const c=os(n,()=>{const d=this._outJobs.get(o);d&&(this._outJobs.delete(o),this._processWork(),pr(d.abortHandle),this._post({type:VQ,jobId:o}),l(pi()))}),u={resolve:a,reject:l,abortHandle:c,debugInfo:e};this._outJobs.set(o,u),this._post({type:GQ,jobId:o,methodName:e,abortable:n!=null},i,s)})}on(e,i){const r=new MessageChannel;function n(s){i(s.data)}return this._port.postMessage({type:Ao.ON,eventType:e,port:r.port2},[r.port2]),r.port1.addEventListener("message",n),r.port1.start(),Mi(()=>{r.port1.postMessage({type:Ao.CLOSE}),r.port1.close(),r.port1.removeEventListener("message",n)})}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:jQ,port:e.port2}),e.port1}_processWork(){if(this._outJobs.size>=q6e)return;const e=this._jobQueue?.pop();if(!e)return;const{methodName:i,data:r,invokeOptions:n,resolver:s}=e;this.invoke(i,r,n).then(o=>s.resolve(o)).catch(o=>s.reject(o))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{pr(e.abortHandle),e.reject(pi(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(e){this._schedule!=null?this._schedule(()=>this._processMessage(e)):this._processMessage(e)}_processMessage(e){const i=aO(e);if(i)switch(i.type){case gE:this._onResponseMessage(i);break;case GQ:this._invokeQueue.push(i);break;case VQ:this._onAbortMessage(i);break;case BQ:this._onCloseMessage();break;case jQ:this._onOpenPortMessage(i);break;case H6e:this._onOnMessage(i)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,n=i.get(r);this._invokeQueue.push(e),n&&(n.controller&&n.controller.abort(),i.delete(r))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&r2.clients.get(this)===e&&e.destroy(),r2.clients.delete(this),e?.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:i,jobId:r,data:n,abortable:s}=e,o=s?new AbortController:null,a=this._inJobs;let l,c=this._client,u=c[i];try{if(!u&&i&&i.includes(".")){const d=i.split(".");for(let p=0;p<d.length-1;p++)c=c[d[p]],u=c[d[p+1]]}if(typeof u!="function")throw new TypeError(`${i} is not a function`);l=u.call(c,n,{client:this,signal:o?o.signal:null})}catch(d){return void this._post({type:gE,jobId:r,error:oO(d)})}dc(l)?(a.set(r,{controller:o,promise:l}),l.then(d=>{a.has(r)&&(a.delete(r),this._post({type:gE,jobId:r},d))},d=>{a.has(r)&&(a.delete(r),Fn(d)||this._post({type:gE,jobId:r,error:oO(d||{message:`Error encountered at method ${i}`})}))})):this._post({type:gE,jobId:r},l)}_onOpenPortMessage(e){new r2(e.port,{client:this._client})}_onOnMessage(e){const{port:i}=e,r=this._client.on(e.eventType,s=>{i.postMessage(s)}),n=sg(e.port,"message",s=>{aO(s)?.type===Ao.CLOSE&&(n.remove(),r.remove(),i.close())})}_onResponseMessage(e){const{jobId:i,error:r,data:n}=e,s=this._outJobs;if(!s.has(i))return;const o=s.get(i);s.delete(i),this._processWork(),pr(o.abortHandle),r?o.reject(W.fromJSON(JSON.parse(r))):o.resolve(n)}_post(e,i,r){return wW(this._port,e,i,r)}};o_.kernelInfo={buildDate:ide,fullVersion:_4,revision:rde},o_.clients=new Map;let Y6e=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new hN}destroy(){this.close()}get closed(){return!this._clients?.length}open(e,i){return new Promise((r,n)=>{let s=!0;const o=a=>{Et(i.signal),s&&(s=!1,a())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let a=0;a<e.length;++a){const l=e[a];dc(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new o_(c,i,this._ongoingJobsQueue),o(r),this._clients[a]),()=>(o(n),null)):(this._clients[a]=new o_(l,i,this._ongoingJobsQueue),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(r))}})}broadcast(e,i,r){const n=new Array(this._clientPromises.length);for(let s=0;s<this._clientPromises.length;++s){const o=this._clientPromises[s];n[s]=o.then(a=>a?.invoke(e,i,r))}return n}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject(pi(`Worker closing, aborting job calling '${e.methodName}'`));for(const i of this._clientPromises)i.then(r=>r?.close());this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0,z6e(this)}invoke(e,i,r){let n;Array.isArray(r)?(ne.getLogger("esri.core.workers.Connection").warn("invoke()","The transferList parameter is deprecated, use the options object instead"),n={transferList:r}):n=r;const s=vs();this._ongoingJobsQueue.push({methodName:e,data:i,invokeOptions:n,resolver:s});for(let o=0;o<this._clientPromises.length;o++){const a=this._clients[o];a?a.jobAdded():this._clientPromises[o].then(l=>l?.jobAdded())}return s.promise}on(e,i){return Promise.all(this._clientPromises).then(()=>db(this._clients.map(r=>r.on(e,i))))}openPorts(){return new Promise(e=>{const i=new Array(this._clientPromises.length);let r=i.length;for(let n=0;n<this._clientPromises.length;++n)this._clientPromises[n].then(s=>{s&&(i[n]=s.openPort()),--r==0&&e(i)})})}get test(){return{numClients:this._clients.length}}};const X6e={async request(t,e){const i=t.options,r=i.responseType;i.signal=e?.signal,i.responseType=r==="native"||r==="native-request-init"?"native-request-init":r&&["blob","json","text"].includes(r)&&Zhe(t.url)?.after?r:"array-buffer";const n=await Ii(t.url,i),s={data:n.data,httpStatus:n.httpStatus,ssl:n.ssl};switch(n.requestOptions?.responseType){case"native-request-init":return delete s.data.signal,s;case"blob":s.data=await s.data.arrayBuffer();break;case"json":s.data=new TextEncoder().encode(JSON.stringify(s.data)).buffer;break;case"text":s.data=new TextEncoder().encode(s.data).buffer}return{result:s,transferList:[s.data]}}},Z6e={};function J6e(t){const e={async:t.async,isDebug:t.isDebug,locale:t.locale,baseUrl:t.baseUrl,has:{...t.has},map:{...t.map},packages:t.packages?.concat()||[],paths:{...t.paths}};return t.hasOwnProperty("async")||(e.async=!0),t.hasOwnProperty("isDebug")||(e.isDebug=!1),t.baseUrl||(e.baseUrl=Z6e.baseUrl),e}let K6e=class{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(i=>{this[i]=(...r)=>e[i](...r)})}},rL=class{constructor(){this._dispatcher=new K6e,this._workerPostMessage({type:Ao.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){PT(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,i,r){this._dispatcher.addEventListener(e,i,r)}removeEventListener(e,i,r){this._dispatcher.removeEventListener(e,i,r)}_workerPostMessage(e){PT(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const i=aO(e);if(i&&i.type===Ao.OPEN){const{modulePath:r,jobId:n}=i;let s=await o_.loadWorker(r);s||(s=await pe(()=>import(r),[],import.meta.url));const o=o_.connect(s);this._workerPostMessage({type:Ao.OPENED,jobId:n,data:o})}}};const WV=ne.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:Q6e}=Ao,eUe='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,s)=>{if(t){if(t.aborted)return s(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:ABORT,jobId:n}),s(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:s}),self.postMessage({type:INVOKE,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\\nModules version: ${r}\\nAssets version: ${n??s}\\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case OPEN:let n;function t(e){const o=n.connect(e);self.postMessage({type:OPENED,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case RESPONSE:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let MP,$P;const HQ="Failed to create Worker. Fallback to execute module in main thread";async function tUe(){if(!ie("esri-workers"))return qQ(new rL);if(!MP&&!$P)try{const e=eUe.split('"{CONFIGURATION}"').join(`'${iUe()}'`);MP=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){$P=e||{}}let t;if(MP)try{t=new Worker(MP,{name:"esri-worker-"+rUe++})}catch{WV.warn(HQ,$P),t=new rL}else WV.warn(HQ,$P),t=new rL;return qQ(t)}async function qQ(t){return new Promise(e=>{function i(n){const s=aO(n);s&&s.type===Q6e&&(t.removeEventListener("message",i),t.removeEventListener("error",r),e(t))}function r(n){n.preventDefault(),t.removeEventListener("message",i),t.removeEventListener("error",r),WV.warn("Failed to create Worker. Fallback to execute module in main thread",n),(t=new rL).addEventListener("message",i),t.addEventListener("error",r)}t.addEventListener("message",i),t.addEventListener("error",r)})}function iUe(){let t;if(Oi.default!=null){const n={...Oi};delete n.default,t=JSON.parse(JSON.stringify(n))}else t=JSON.parse(JSON.stringify(Oi));t.assetsPath=La(t.assetsPath),t.defaultAssetsPath=t.defaultAssetsPath?La(t.defaultAssetsPath):void 0,t.request.interceptors=[],t.log.interceptors=[],t.locale=eu(),t.has={"esri-csp-restrictions":ie("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":ie("esri-2d-update-debug"),"esri-2d-log-updating":ie("esri-2d-log-updating"),"featurelayer-pbf":ie("featurelayer-pbf"),"featurelayer-simplify-thresholds":ie("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":ie("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":ie("featurelayer-simplify-mobile-factor"),"esri-atomics":ie("esri-atomics"),"esri-shared-array-buffer":ie("esri-shared-array-buffer"),"esri-tiles-debug":ie("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":ie("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":ie("feature-polyline-generalization-factor"),"host-webworker":1},t.workers.loaderUrl&&(t.workers.loaderUrl=La(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=La(t.workers.workerPath):t.workers.workerPath=La(lr("esri/core/workers/RemoteClient.js")),t.workers.useDynamicImport=!1;const e=Oi.workers.loaderConfig,i=J6e({baseUrl:e?.baseUrl,locale:eu(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e?.has},map:{...e?.map},paths:{...e?.paths},packages:e?.packages||[]});return JSON.stringify({esriConfig:t,loaderConfig:i,kernelInfo:{buildDate:ide,fullVersion:_4,revision:rde}})}let rUe=0;const{ABORT:WQ,INVOKE:nUe,OPEN:sUe,OPENED:oUe,RESPONSE:yE}=Ao;let aUe=class c0e{static async create(e){const i=await tUe();return new c0e(i,e)}constructor(e,i){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=i,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",r=>{r.preventDefault(),ne.getLogger("esri.core.workers.WorkerOwner").error(r)})}terminate(){this.worker.terminate()}async open(e,i={}){const{signal:r}=i,n=l0e();return new Promise((s,o)=>{const a={resolve:s,reject:o,abortHandle:eR(r,()=>{this._outJobs.delete(n),this._post({type:WQ,jobId:n})})};this._outJobs.set(n,a),this._post({type:sUe,jobId:n,modulePath:e})})}_onMessage(e){const i=aO(e);if(i)switch(i.type){case oUe:this._onOpenedMessage(i);break;case yE:this._onResponseMessage(i);break;case WQ:this._onAbortMessage(i);break;case nUe:this._onInvokeMessage(i)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,n=i.get(r);n&&(n.controller&&n.controller.abort(),i.delete(r))}_onInvokeMessage(e){const{methodName:i,jobId:r,data:n,abortable:s}=e,o=s?new AbortController:null,a=this._inJobs,l=X6e[i];let c;try{if(typeof l!="function")throw new TypeError(`${i} is not a function`);c=l.call(null,n,{signal:o?o.signal:null})}catch(u){return void this._post({type:yE,jobId:r,error:oO(u)})}dc(c)?(a.set(r,{controller:o,promise:c}),c.then(u=>{a.has(r)&&(a.delete(r),this._post({type:yE,jobId:r},u))},u=>{a.has(r)&&(a.delete(r),u||(u={message:"Error encountered at method"+i}),Fn(u)||this._post({type:yE,jobId:r,error:oO(u||{message:`Error encountered at method ${i}`})}))})):this._post({type:yE,jobId:r},c)}_onOpenedMessage(e){const{jobId:i,data:r}=e,n=this._outJobs.get(i);n&&(this._outJobs.delete(i),pr(n.abortHandle),n.resolve(r))}_onResponseMessage(e){const{jobId:i,error:r,data:n}=e,s=this._outJobs.get(i);s&&(this._outJobs.delete(i),pr(s.abortHandle),r?s.reject(W.fromJSON(JSON.parse(r))):s.resolve(n))}_post(e,i,r){return wW(this.worker,e,i,r)}};const YQ=ie("host-browser")?Math.min(navigator.hardwareConcurrency-1,ie("workers-pool-size")):0;let z1=ie("esri-mobile")?Math.min(YQ,3):YQ;z1||(z1=ie("safari")&&ie("mac")?7:2);let XQ=0;const nL=[];function lUe(){u0e()}async function IP(t,e){const i=new Y6e,{registryTarget:r,...n}=e;return await i.open(t,n),r&&U6e(r,i),i}async function cUe(t,e={}){if(typeof t!="string")throw new W("workers:undefined-module","modulePath is missing");let i=e.strategy||"distributed";if(ie("host-webworker")&&!ie("esri-workers")&&(i="local"),i==="local"){let r=await o_.loadWorker(t);r||(r=await pe(()=>import(t),[],import.meta.url)),Et(e.signal);const n=e.client||r;return IP([o_.connect(r)],{...e,client:n})}if(await u0e(),Et(e.signal),i==="dedicated"){const r=XQ++%z1;return IP([await nL[r].open(t,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const r=Math.min(e.maxNumWorkers,z1);if(r<z1){const n=new Array(r);for(let s=0;s<r;++s){const o=XQ++%z1;n[s]=nL[o].open(t,e)}return IP(n,e)}}return IP(nL.map(r=>r.open(t,e)),e)}let LP=null;async function u0e(){if(LP)return LP;new AbortController;const t=[];for(let e=0;e<z1;e++){const i=aUe.create(e).then(r=>(nL[e]=r,r));t.push(i)}return LP=Promise.all(t),LP}let t3=class extends ft{constructor(e){super(e),this.addHandles([this.on("before-add",i=>{i.item==null&&i.preventDefault()}),this.on("after-add",i=>this._own(i.item)),this.on("after-remove",i=>this._release(i.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(ft.ofType(this.itemType.Type))(e):new ft(e)}};function YV(t,e){return{type:t,cast:jH,set(i){const r=vg(i,this._get(e),t);r.owner=this,this._set(e,r)}}}h([f()],t3.prototype,"owner",null),t3=h([z("esri.core.support.OwningCollection")],t3);function oF(t,e,i,r){return t!=null&&(wn(e,r)?(xg(i,t),!0):(Tl[0]=t[0],Tl[1]=t[1],Tl[2]=0,!!jr(Tl,e,0,Tl,r,0,1)&&(i[0]=Tl[0],i[1]=Tl[1],Tl[0]=t[2],Tl[1]=t[3],Tl[2]=0,!!jr(Tl,e,0,Tl,r,0,1)&&(i[2]=Tl[0],i[3]=Tl[1],!0))))}const Tl=C();function lc(t,e,i,r=0){DP[0]=t.x,DP[1]=t.y;const n=t.z;return DP[2]=n!==void 0?n:r,jr(DP,t.spatialReference,0,e,i,0,1)}const DP=C();function Do(t,e,i,r){return!(e==null||r==null||t.length<2)&&(t.length===2&&(NP[0]=t[0],NP[1]=t[1],NP[2]=0,t=NP),jr(t,e,0,i,r,0,1))}const NP=C();let kg=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&PT(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*ZQ);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,ZQ));e++)this._items.push(this._allocator())}};const ZQ=1024;function be(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function JT(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function xW(t,e,i,r,n,s,o,a,l,c,u,d,p,m,y,_){return[t,e,i,r,n,s,o,a,l,c,u,d,p,m,y,_]}function h0e(t,e){return new Float64Array(t,e,16)}const zr=be();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:zr,clone:JT,create:be,createView:h0e,fromValues:xW},Symbol.toStringTag,{value:"Module"}));var dN;(function(t){t[t.KILOBYTES=1024]="KILOBYTES",t[t.MEGABYTES=1048576]="MEGABYTES",t[t.GIGABYTES=1073741824]="GIGABYTES"})(dN||(dN={}));function Hr(){return[1,0,0,0,1,0,0,0,1]}function d0e(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function uUe(t,e,i,r,n,s,o,a,l){return[t,e,i,r,n,s,o,a,l]}function p0e(t,e){return new Float64Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:d0e,create:Hr,createView:p0e,fromValues:uUe},Symbol.toStringTag,{value:"Module"}));function Sh(){return[0,0,0,1]}function f0e(t){return[t[0],t[1],t[2],t[3]]}function hUe(t,e,i,r){return[t,e,i,r]}function m0e(t,e){return new Float64Array(t,e,4)}const dUe=Sh();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:dUe,clone:f0e,create:Sh,createView:m0e,fromValues:hUe},Symbol.toStringTag,{value:"Module"}));function Ue(){return[0,0]}function ZC(t){return[t[0],t[1]]}function ri(t,e){return[t,e]}function g0e(t,e=Ue()){const i=Math.min(2,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function y0e(t,e){return new Float64Array(t,e,2)}function _0e(){return Ue()}function v0e(){return ri(1,1)}function b0e(){return ri(1,0)}function w0e(){return ri(0,1)}const Sg=_0e(),pUe=v0e(),x0e=b0e(),fUe=w0e();Object.freeze(Object.defineProperty({__proto__:null,ONES:pUe,UNIT_X:x0e,UNIT_Y:fUe,ZEROS:Sg,clone:ZC,create:Ue,createView:y0e,fromArray:g0e,fromValues:ri,ones:v0e,unitX:b0e,unitY:w0e,zeros:_0e},Symbol.toStringTag,{value:"Module"}));function Kt(){return[0,0,0,0]}function wR(t){return[t[0],t[1],t[2],t[3]]}function Mt(t,e,i,r){return[t,e,i,r]}function TW(t,e=Kt()){const i=Math.min(4,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function T0e(t,e){return new Float64Array(t,e,4)}function S0e(){return Kt()}function E0e(){return Mt(1,1,1,1)}function C0e(){return Mt(1,0,0,0)}function A0e(){return Mt(0,1,0,0)}function O0e(){return Mt(0,0,1,0)}function R0e(){return Mt(0,0,0,1)}const ru=S0e(),rh=E0e(),mUe=C0e(),gUe=A0e(),yUe=O0e(),_Ue=R0e();Object.freeze(Object.defineProperty({__proto__:null,ONES:rh,UNIT_W:_Ue,UNIT_X:mUe,UNIT_Y:gUe,UNIT_Z:yUe,ZEROS:ru,clone:wR,create:Kt,createView:T0e,fromArray:TW,fromValues:Mt,ones:E0e,unitW:R0e,unitX:C0e,unitY:A0e,unitZ:O0e,zeros:S0e},Symbol.toStringTag,{value:"Module"}));let zS=class Jv{constructor(e,i,r){this._itemByteSize=e,this._itemCreate=i,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(r/this._itemByteSize)}get(){this._itemsPtr===0&&PT(()=>this._reset());const e=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=e;){const i=new ArrayBuffer(this._itemsPerBuffer*this._itemByteSize);for(let r=0;r<this._itemsPerBuffer;++r)this._items.push(this._itemCreate(i,r*this._itemByteSize));this._buffers.push(i)}return this._items[this._itemsPtr++]}_reset(){const e=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>e;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(e=Ow){return new Jv(16,y0e,e)}static createVec3f64(e=Ow){return new Jv(24,Nde,e)}static createVec4f64(e=Ow){return new Jv(32,T0e,e)}static createMat3f64(e=Ow){return new Jv(72,p0e,e)}static createMat4f64(e=Ow){return new Jv(128,h0e,e)}static createQuatf64(e=Ow){return new Jv(32,m0e,e)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this._itemByteSize}}};const Ow=4*dN.KILOBYTES,i3t=zS.createVec2f64(),Le=zS.createVec3f64(),SW=zS.createVec4f64();zS.createMat3f64();const EW=zS.createMat4f64(),r3t=zS.createQuatf64();function tp(t){return t?{origin:Br(t.origin),vector:Br(t.vector)}:{origin:C(),vector:C()}}function vUe(t,e){const i=wUe.get();return i.origin=t,i.vector=e,i}function n3t(t,e=tp()){return bUe(t.origin,t.vector,e)}function bUe(t,e,i=tp()){return se(i.origin,t),se(i.vector,e),i}function tb(t,e,i=tp()){return se(i.origin,t),he(i.vector,e,t),i}function CW(t,e){const i=he(Le.get(),e,t.origin),r=me(t.vector,i),n=me(t.vector,t.vector),s=_e(r/n,0,1),o=he(Le.get(),te(Le.get(),t.vector,s),i);return me(o,o)}function s3t(t,e,i){return XV(t,e,0,1,i)}function o3t(t,e,i){return ce(i,t.origin,te(i,t.vector,e))}function XV(t,e,i,r,n){const{vector:s,origin:o}=t,a=he(Le.get(),e,o),l=me(s,a)/Oo(s);return te(n,s,_e(l,i,r)),ce(n,n,t.origin)}function a3t(t,e){if(M0e(t,vUe(e.origin,e.direction),!1,pN)){const{tA:i,pB:r,distance2:n}=pN;if(i>=0&&i<=1)return n;if(i<0)return bs(t.origin,r);if(i>1)return bs(ce(Le.get(),t.origin,t.vector),r)}return null}function P0e(t,e,i){return!!M0e(t,e,!0,pN)&&(se(i,pN.pA),!0)}function M0e(t,e,i,r){const s=t.origin,o=ce(Le.get(),s,t.vector),a=e.origin,l=ce(Le.get(),a,e.vector),c=Le.get(),u=Le.get();if(c[0]=s[0]-a[0],c[1]=s[1]-a[1],c[2]=s[2]-a[2],u[0]=l[0]-a[0],u[1]=l[1]-a[1],u[2]=l[2]-a[2],Math.abs(u[0])<1e-6&&Math.abs(u[1])<1e-6&&Math.abs(u[2])<1e-6)return!1;const d=Le.get();if(d[0]=o[0]-s[0],d[1]=o[1]-s[1],d[2]=o[2]-s[2],Math.abs(d[0])<1e-6&&Math.abs(d[1])<1e-6&&Math.abs(d[2])<1e-6)return!1;const p=c[0]*u[0]+c[1]*u[1]+c[2]*u[2],m=u[0]*d[0]+u[1]*d[1]+u[2]*d[2],y=c[0]*d[0]+c[1]*d[1]+c[2]*d[2],_=u[0]*u[0]+u[1]*u[1]+u[2]*u[2],v=(d[0]*d[0]+d[1]*d[1]+d[2]*d[2])*_-m*m;if(Math.abs(v)<1e-6)return!1;let w=(p*m-y*_)/v,x=(p+m*w)/_;i&&(w=_e(w,0,1),x=_e(x,0,1));const T=Le.get(),S=Le.get();return T[0]=s[0]+w*d[0],T[1]=s[1]+w*d[1],T[2]=s[2]+w*d[2],S[0]=a[0]+x*u[0],S[1]=a[1]+x*u[1],S[2]=a[2]+x*u[2],r.tA=w,r.tB=x,r.pA=T,r.pB=S,r.distance2=bs(T,S),!0}const pN={tA:0,tB:0,pA:C(),pB:C(),distance2:0},wUe=new kg(()=>tp());function _s(t){return t?JQ(Br(t.origin),Br(t.direction)):JQ(C(),C())}function JQ(t,e){return{origin:t,direction:e}}function l3t(t,e){return yg(t.origin,e.origin)&&yg(t.direction,e.direction)}function pu(t,e){const i=SUe.get();return i.origin=t,i.direction=e,i}function fN(t,e=_s()){return I0e(t.origin,t.direction,e)}function $0e(t,e,i=_s()){return se(i.origin,t),he(i.direction,e,t),i}function I0e(t,e,i=_s()){return se(i.origin,t),se(i.direction,e),i}function xUe(t,e){const i=nt(Le.get(),ge(Le.get(),t.direction),he(Le.get(),e,t.origin));return me(i,i)}function TUe(t,e,i){const r=me(t.direction,he(i,e,t.origin));return ce(i,t.origin,te(i,t.direction,r)),i}const SUe=new kg(()=>_s());function i3(t,e){return me(t,e)/we(t)}function aF(t,e){const i=me(t,e)/(we(t)*we(e));return-xs(i)}function L0e(t,e,i){ge(FP,t),ge(T6,e);const r=me(FP,T6),n=xs(r),s=nt(FP,FP,T6);return me(s,i)<0?2*Math.PI-n:n}const FP=C(),T6=C(),D0e=xn();function xn(){return Kt()}const EUe=Sb,CUe=Sb;function KT(t,e=xn()){return Cd(e,t)}function N0e(t,e){return Mt(t[0],t[1],t[2],e)}function AUe(t){return t}function OUe(t){t[0]=t[1]=t[2]=t[3]=0}function lF(t,e){return t[0]=t[1]=t[2]=0,t[3]=e,t}function ag(t){return t[3]}function RUe(t){return t}function F0e(t,e,i,r){return Mt(t,e,i,r)}function PUe(t,e,i){return t!==i&&se(i,t),i[3]=t[3]+e,i}function MUe(t,e,i){return ne.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported"),t===i?i:KT(t,i)}function O_(t,e,i){if(e==null||!k0e(t,e,mN))return!1;let{t0:r,t1:n}=mN;if((r<0||n<r&&n>0)&&(r=n),r<0)return!1;if(i){const{origin:s,direction:o}=e;i[0]=s[0]+o[0]*r,i[1]=s[1]+o[1]*r,i[2]=s[2]+o[2]*r}return!0}function $Ue(t,e,i){const r=$0e(e,i);if(!k0e(t,r,mN))return[];const{origin:n,direction:s}=r,{t0:o,t1:a}=mN,l=c=>{const u=C();return dl(u,n,s,c),AW(t,u,u)};return Math.abs(o-a)<mo()?[l(o)]:[l(o),l(a)]}const mN={t0:0,t1:0};function k0e(t,e,i){const{origin:r,direction:n}=e,s=IUe;s[0]=r[0]-t[0],s[1]=r[1]-t[1],s[2]=r[2]-t[2];const o=n[0]*n[0]+n[1]*n[1]+n[2]*n[2];if(o===0)return!1;const a=2*(n[0]*s[0]+n[1]*s[1]+n[2]*s[2]),l=a*a-4*o*(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]-t[3]*t[3]);if(l<0)return!1;const c=Math.sqrt(l);return i.t0=(-a-c)/(2*o),i.t1=(-a+c)/(2*o),!0}const IUe=C();function ZV(t,e){return O_(t,e,null)}function LUe(t,e,i){if(O_(t,e,i))return i;const r=BS(t,e,Le.get());return ce(i,e.origin,te(Le.get(),e.direction,br(e.origin,r)/we(e.direction))),i}function BS(t,e,i){const r=Le.get(),n=EW.get();nt(r,e.origin,e.direction);const s=ag(t);nt(i,r,e.origin),te(i,i,1/we(i)*s);const o=z0e(t,e.origin),a=aF(e.origin,i);return hu(n,a+o,r),Fe(i,i,n),i}function DUe(t,e,i){return O_(t,e,i)?i:(TUe(e,t,i),AW(t,i,i))}function AW(t,e,i){const r=he(Le.get(),e,t),n=te(Le.get(),r,t[3]/we(r));return ce(i,n,t)}function U0e(t,e){const i=he(Le.get(),e,t),r=Oo(i),n=t[3]*t[3];return Math.sqrt(Math.abs(r-n))}function z0e(t,e){const i=he(Le.get(),e,t),r=we(i),n=ag(t),s=n+Math.abs(n-r);return xs(n/s)}const S6=C();function B0e(t,e,i,r){const n=he(S6,e,t);switch(i){case Yr.X:{const s=yK(n,S6)[2];return oe(r,-Math.sin(s),Math.cos(s),0)}case Yr.Y:{const s=yK(n,S6),o=s[1],a=s[2],l=Math.sin(o);return oe(r,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case Yr.Z:return ge(r,n);default:return}}function V0e(t,e){const i=he(JV,e,t);return we(i)-t[3]}function NUe(t,e,i,r){const n=V0e(t,e),s=B0e(t,e,Yr.Z,JV),o=te(JV,s,i-n);return ce(r,e,o)}function FUe(t,e){const i=bs(t,e),r=ag(t);return i<=r*r}function kUe(t,e,i=xn()){const r=br(t,e),n=t[3],s=e[3];return r+s<n?(Cd(i,t),i):r+n<s?(Cd(i,e),i):(Ui(i,t,e,(r+s-n)/(2*r)),i[3]=(r+n+s)/2,i)}const JV=C(),cF=xn(),UUe=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:D0e,altitudeAt:V0e,angleToSilhouette:z0e,axisAt:B0e,clear:OUe,closestPoint:DUe,closestPointOnSilhouette:BS,containsPoint:FUe,copy:KT,create:xn,distanceToSilhouette:U0e,elevate:PUe,equals:CUe,exactEquals:EUe,fromCenterAndRadius:N0e,fromRadius:lF,fromValues:F0e,getCenter:RUe,getRadius:ag,intersectLine:$Ue,intersectRay:O_,intersectRayClosestSilhouette:LUe,intersectsRay:ZV,projectPoint:AW,setAltitudeAt:NUe,setExtent:MUe,tmpSphere:cF,union:kUe,wrap:AUe},Symbol.toStringTag,{value:"Module"}));function QT(t){const e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],i=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],r=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(e,i,r))}function zUe(t,e){const i=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),r=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),n=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return oe(t,i,r,n),t}function c3t(t,e,i){i=i||t;const r=me(t,e);oe(i,t[0]-r*e[0],t[1]-r*e[1],t[2]-r*e[2]),ge(i,i)}function u3t(t,e,i){Math.abs(t[0])>Math.abs(t[1])?oe(e,0,1,0):oe(e,1,0,0),nt(i,t,e),ge(e,e),nt(e,i,t),ge(i,i)}function kP(t,e,i,r,n,s){const o=t+(e-t)*n;return o+(i+(r-i)*n-o)*s}function BUe(t,e,i,r=C()){const n=we(t),s=we(e),o=me(t,e)/(n*s);if(o<.9999999999999999){const a=Math.acos(o),l=((1-i)*n+i*s)/Math.sin(a),c=l/n*Math.sin((1-i)*a),u=l/s*Math.sin(i*a);return te(B1,t,c),te(V1,e,u),ce(r,B1,V1)}return Ui(r,t,e,i)}function h3t(t,e,i,r=C(),n=C()){const s=we(t),o=we(e),a=me(t,e)/(s*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),u=Math.sin(i*l),d=Math.sin((1-i)*l),p=(1-i)*s+i*o;{const m=p/c,y=m/o*u;te(B1,t,m/s*d),te(V1,e,y),ce(r,B1,V1)}{const m=1/s*(-Math.cos((1-i)*l)*l*p+d*(-s+o));te(B1,t,m);const y=1/o*(Math.cos(i*l)*l*p+u*(-s+o));te(V1,e,y),ce(n,B1,V1),te(n,n,1/c)}return n}return Ui(r,t,e,i),he(n,e,t),ge(n,n),n}function sL(t,e,i){t=ge(B1,t),e=ge(V1,e);const r=xs(me(t,e));if(i){const n=nt(VUe,t,e);if(me(n,i)<0)return-r}return r}function oL(t){const e=t.length;return i=>{if(i<=t[0][0])return t[0][1];if(i>=t[e-1][0])return t[e-1][1];let r=1;for(;i>t[r][0];)r++;const n=t[r-1][0],s=t[r][0],o=(s-i)/(s-n);return o*t[r-1][1]+(1-o)*t[r][1]}}function d3t(t,e,i,r){he(KQ,e,t),he(QQ,i,t),nt(r,KQ,QQ),ge(r,r),r[3]=-me(t,r)}const KQ=C(),QQ=C(),VUe=C(),B1=C(),V1=C();function Ti(t=JC){return[t[0],t[1],t[2],t[3]]}function GUe(t=JC[0],e=JC[1],i=JC[2],r=JC[3]){return OW(t,e,i,r,SW.get())}function uF(t,e){return OW(e[0],e[1],e[2],e[3],t)}function OW(t,e,i,r,n=Ti()){return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n}function G0e(t,e,i){return se(i,t),i[3]=e,i}function xR(t,e,i){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=-(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]),i}function Ko(t,e,i,r=Ti()){const n=i[0]-e[0],s=i[1]-e[1],o=i[2]-e[2],a=t[0]-e[0],l=t[1]-e[1],c=t[2]-e[2],u=s*c-o*l,d=o*a-n*c,p=n*l-s*a,m=u*u+d*d+p*p,y=Math.abs(m-1)>1e-5&&m>1e-12?1/Math.sqrt(m):1;return r[0]=u*y,r[1]=d*y,r[2]=p*y,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function RW(t,e,i,r=0,n=Math.floor(i*(1/3)),s=Math.floor(i*(2/3))){if(i<3)return!1;e(_E,r);let o=n,a=!1;for(;o<i-1&&!a;)e(Rw,o),o++,a=!Po(_E,Rw);if(!a)return!1;for(o=Math.max(o,s),a=!1;o<i&&!a;)e(T1,o),o++,he(UP,_E,Rw),ge(UP,UP),he(zP,Rw,T1),ge(zP,zP),a=!Po(_E,T1)&&!Po(Rw,T1)&&Math.abs(me(UP,zP))<HUe;return a?(Ko(_E,Rw,T1,t),!0):(r!==0||n!==1||s!==2)&&RW(t,e,i,0,1,2)}function jUe(t,e,i=!0){const r=e.length/3;return RW(t,(n,s)=>oe(n,e[3*s+0],e[3*s+1],e[3*s+2]),i?r-1:r)}const HUe=.99619469809,_E=C(),Rw=C(),T1=C(),UP=C(),zP=C();function KV(t,e,i){return e!==t&&uF(t,e),t[3]=-me(t,i),t}function QV(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function lO(t,e,i,r){return nt(T1,e,t),xR(i,T1,r)}function p3t(t,e,i,r){return hF(t,e,he(Le.get(),i,e),JUe,r)}function aw(t,e,i){return e!=null&&hF(t,e.origin,e.direction,KUe,i)}function qUe(t,e,i){return hF(t,e.origin,e.vector,wf.NONE,i)}function WUe(t,e,i){return hF(t,e.origin,e.vector,wf.CLAMP,i)}const f3t=(()=>{const t=C();return(e,i,r)=>{const n=e,s=i;if(nt(t,n,s),Oo(t)<mo())return!1;ge(t,t);const[o,a,l]=t,c=r.origin,u=Math.abs(o),d=Math.abs(a),p=Math.abs(l),[m,y,_]=n,[v,w,x]=s,T=e[3],S=i[3];return u>d&&u>p?(c[1]=(S*_-T*x)/o,c[2]=(T*w-S*y)/o):d>p?(c[0]=(T*x-S*_)/a,c[2]=(S*m-T*v)/a):(c[0]=(S*y-T*w)/l,c[1]=(T*v-S*m)/l),se(r.direction,t),!0}})();function j0e(t,e){return ir(t,e)>=0}function YUe(t,e){const i=me(t,e.ray.direction),r=-ir(t,e.ray.origin);if(r<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return r>0;if((r<0||i<0)&&!(r<0&&i<0))return!0;const n=r/i;return i>0?n<e.c1&&(e.c1=n):n>e.c0&&(e.c0=n),e.c0<=e.c1}function XUe(t,e){const i=me(t,e.ray.direction),r=-ir(t,e.ray.origin);if(i>-1e-6&&i<1e-6)return r>0;const n=r/i;return i>0?n<e.c1&&(e.c1=n):n>e.c0&&(e.c0=n),e.c0<=e.c1}function ZUe(t,e,i){const r=te(Le.get(),t,-t[3]),n=e7(t,he(Le.get(),e,r),Le.get());return ce(i,n,r),i}function e7(t,e,i){const r=te(Le.get(),t,me(t,e));return he(i,e,r),i}function m3t(t,e){return Math.abs(ir(t,e))}function ir(t,e){return me(t,e)+t[3]}function hF(t,e,i,r,n){const s=me(t,i);if(s===0)return!1;let o=-(me(t,e)+t[3])/s;return r&wf.CLAMP&&(o=_e(o,0,1)),!(!(r&wf.INFINITE_MIN)&&o<0||!(r&wf.INFINITE_MAX)&&o>1)&&(ce(n,e,te(n,i,o)),!0)}function g3t(t){return t}function y3t(t){return Math.abs(t[2])<mo()}const JC=[0,0,1,0];var wf;(function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"})(wf||(wf={}));const JUe=wf.INFINITE_MIN|wf.INFINITE_MAX,KUe=wf.INFINITE_MAX,E6=ne.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");let QUe=class{constructor(){this.plane=Ti(),this.origin=C(),this.basis1=C(),this.basis2=C()}};const H0e=QUe;function Ug(t=iye){return{plane:Ti(t.plane),origin:Br(t.origin),basis1:Br(t.basis1),basis2:Br(t.basis2)}}function e8e(t,e,i){const r=d8e.get();return r.origin=t,r.basis1=e,r.basis2=i,r.plane=GUe(0,0,0,0),dF(r),r}function lw(t,e=Ug()){return PW(t.origin,t.basis1,t.basis2,e)}function t8e(t,e){se(e.origin,t.origin),se(e.basis1,t.basis1),se(e.basis2,t.basis2),uF(e.plane,t.plane)}function PW(t,e,i,r=Ug()){return se(r.origin,t),se(r.basis1,e),se(r.basis2,i),dF(r),u8e(r,"fromValues()"),r}function dF(t){lO(t.basis2,t.basis1,t.origin,t.plane)}function q0e(t,e,i){t!==i&&lw(t,i);const r=te(Le.get(),Eg(t),e);return ce(i.origin,i.origin,r),i.plane[3]-=e,i}function i8e(t,e,i){return W0e(e,i),q0e(i,LW(t,t.origin),i),i}function W0e(t,e=Ug()){const i=(t[2]-t[0])/2,r=(t[3]-t[1])/2;return oe(e.origin,t[0]+i,t[1]+r,0),oe(e.basis1,i,0,0),oe(e.basis2,0,r,0),OW(0,0,1,0,e.plane),e}function MW(t,e,i){return!!aw(t.plane,e,i)&&eye(t,i)}function r8e(t,e,i){if(MW(t,e,i))return i;const r=Y0e(t,e,Le.get());return ce(i,e.origin,te(Le.get(),e.direction,br(e.origin,r)/we(e.direction))),i}function Y0e(t,e,i){const r=gN.get();tye(t,e,r,gN.get());let n=Number.POSITIVE_INFINITY;for(const s of NW){const o=DW(t,s,pF.get()),a=Le.get();if(qUe(r,o,a)){const l=Ng(Le.get(),e.origin,a),c=Math.abs(xs(me(e.direction,l)));c<n&&(n=c,se(i,a))}}return n===Number.POSITIVE_INFINITY?X0e(t,e,i):i}function X0e(t,e,i){if(MW(t,e,i))return i;const r=gN.get(),n=gN.get();tye(t,e,r,n);let s=Number.POSITIVE_INFINITY;for(const o of NW){const a=DW(t,o,pF.get()),l=Le.get();if(WUe(r,a,l)){const c=xUe(e,l);if(!j0e(n,l))continue;c<s&&(s=c,se(i,l))}}return $W(t,e.origin)<s&&Z0e(t,e.origin,i),i}function Z0e(t,e,i){const r=ZUe(t.plane,e,Le.get()),n=XV(eee(t,t.basis1),r,-1,1,Le.get()),s=XV(eee(t,t.basis2),r,-1,1,Le.get());return he(i,ce(Le.get(),n,s),t.origin),i}function J0e(t,e,i){const{origin:r,basis1:n,basis2:s}=t,o=he(Le.get(),e,r),a=i3(n,o),l=i3(s,o),c=i3(Eg(t),o);return oe(i,a,l,c)}function $W(t,e){const i=J0e(t,e,Le.get()),{basis1:r,basis2:n}=t,s=we(r),o=we(n),a=Math.max(Math.abs(i[0])-s,0),l=Math.max(Math.abs(i[1])-o,0),c=i[2];return a*a+l*l+c*c}function n8e(t,e){return Math.sqrt($W(t,e))}function s8e(t,e){let i=Number.NEGATIVE_INFINITY;for(const r of NW){const n=DW(t,r,pF.get()),s=CW(n,e);s>i&&(i=s)}return Math.sqrt(i)}function IW(t,e){return j0e(t.plane,e)&&eye(t,e)}function o8e(t,e,i,r){return c8e(t,i,r)}function LW(t,e){const i=-t.plane[3];return i3(Eg(t),e)-i}function a8e(t,e,i,r){const n=LW(t,e),s=te(h8e,Eg(t),i-n);return ce(r,e,s),r}function K0e(t,e){return Po(t.basis1,e.basis1)&&Po(t.basis2,e.basis2)&&Po(t.origin,e.origin)}function Q0e(t,e,i){return t!==i&&lw(t,i),qn(Pw,e),sc(Pw,Pw),Fe(i.basis1,t.basis1,Pw),Fe(i.basis2,t.basis2,Pw),Fe(i.plane,t.plane,Pw),Fe(i.origin,t.origin,e),KV(i.plane,i.plane,i.origin),i}function l8e(t,e,i,r){return t!==r&&lw(t,r),hu(C6,e,i),Fe(r.basis1,t.basis1,C6),Fe(r.basis2,t.basis2,C6),dF(r),r}function Eg(t){return t.plane}function c8e(t,e,i){switch(e){case Yr.X:se(i,t.basis1),ge(i,i);break;case Yr.Y:se(i,t.basis2),ge(i,i);break;case Yr.Z:se(i,Eg(t))}return i}function eye(t,e){const i=he(Le.get(),e,t.origin),r=Oo(t.basis1),n=Oo(t.basis2),s=me(t.basis1,i),o=me(t.basis2,i);return-s-r<0&&s-r<0&&-o-n<0&&o-n<0}function eee(t,e){const i=pF.get();return se(i.origin,t.origin),se(i.vector,e),i}function DW(t,e,i){const{basis1:r,basis2:n,origin:s}=t,o=te(Le.get(),r,e.origin[0]),a=te(Le.get(),n,e.origin[1]);ce(i.origin,o,a),ce(i.origin,i.origin,s);const l=te(Le.get(),r,e.direction[0]),c=te(Le.get(),n,e.direction[1]);return te(i.vector,ce(l,l,c),2),i}function u8e(t,e){Math.abs(me(t.basis1,t.basis2)/(we(t.basis1)*we(t.basis2)))>1e-6&&E6.warn(e,"Provided basis vectors are not perpendicular"),Math.abs(me(t.basis1,Eg(t)))>1e-6&&E6.warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-me(Eg(t),t.origin)-t.plane[3])>1e-6&&E6.warn(e,"Plane offset is not consistent with plane origin")}function tye(t,e,i,r){const n=Eg(t);lO(n,e.direction,e.origin,i),lO(i,n,e.origin,r)}const iye={plane:Ti(),origin:Ce(0,0,0),basis1:Ce(1,0,0),basis2:Ce(0,1,0)},gN=new kg(Ti),pF=new kg(tp),h8e=C(),d8e=new kg(()=>Ug()),NW=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],Pw=be(),C6=be(),p8e=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:H0e,altitudeAt:LW,axisAt:o8e,closestPoint:X0e,closestPointOnSilhouette:Y0e,copy:lw,copyWithoutVerify:t8e,create:Ug,distance:n8e,distance2:$W,distanceToSilhouette:s8e,elevate:q0e,equals:K0e,extrusionContainsPoint:IW,fromAABoundingRect:W0e,fromValues:PW,intersectRay:MW,intersectRayClosestSilhouette:r8e,normal:Eg,projectPoint:Z0e,projectPointLocal:J0e,rotate:l8e,setAltitudeAt:a8e,setExtent:i8e,transform:Q0e,up:iye,updateUnboundedPlane:dF,wrap:e8e},Symbol.toStringTag,{value:"Module"})),f8e=new je(vde),tee=new je(w4),iee=new je(x4),v3t=new je(bde);function VS(t){return t&&(Vf(t)||wn(t,tee))?tee:t&&(Gf(t)||wn(t,iee))?iee:f8e}function m8e(t){const{value:e,operations:i}=t;return{operations:i,value:i.create(e)}}function g8e(t,e,i){return t.operations.setExtent(t.value,e,i.value),i}function y8e(t){return{operations:t,value:t.create()}}function rye(t,e,i=y8e(t)){return i.operations=t,t.copy(e,i.value),i}function _8e(t){return rye(UUe,F0e(0,0,0,Fi(t).radius))}const ree=2**50;function v8e(){return rye(p8e,PW([0,0,0],[ree,0,0],[0,ree,0]))}function b8e(t,e,i){return t.operations.axisAt(t.value,e,Yr.Z,i)}function w8e(t,e,i,r){return t.operations.axisAt(t.value,e,i,r)}function x8e(t,e,i){return t.operations.intersectRay(t.value,e,i)}function T8e(t,e,i){return t.operations.intersectRayClosestSilhouette(t.value,e,i)}function S8e(t,e){return t.operations.altitudeAt(t.value,e)}function nye(t,e,i,r){return t.operations.setAltitudeAt(t.value,e,i,r)}function E8e(t,e,i,r){return e!==r&&Nn(r,e),oe(Mw,r[12],r[13],r[14]),nye(t,Mw,i,Mw),r[12]=Mw[0],r[13]=Mw[1],r[14]=Mw[2],r}function A6(t,e,i){return t.operations.elevate(t.value,e,i.value)}const Mw=C();function nee(t,e,i,r,n){return n[0]=me(t,e),n[1]=me(t,i),n[2]=me(t,r),n}function t7(t,e,i,r,n){se(i,t),se(BP,e),ge(BP,BP),nt(r,BP,i),nt(n,r,i)}function C8e(t,e){return t?VS(e):e.isGeographic?je.PlateCarree:e}const BP=C(),FW=96;function b3t(t,e){const i=e||t.extent,r=t.width,n=ua(i?.spatialReference);return i&&r?i.width/r*n*eq*FW:0}function A8e(t,e){return t/(ua(e)*eq*FW)}function O8e(t){return t/(eq*FW)}function w3t(t,e,i){return R8e(t,e)&&P8e(t,i)}function R8e(t,e){return e===0||jy(t,e)||t<e}function P8e(t,e){return e===0||jy(t,e)||t>e}const M8e="OBJECTID";let eS=class extends t3{constructor(e){super(e),this.addHandles(this.on("before-add",i=>{i.item!=null&&i.item.parent===this.owner&&(ne.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),i.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};eS=h([z("esri.support.AnalysesCollection")],eS);const aL={widthBreakpoint:{getValue(t){const e=t.viewSize[0],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,i=e[0],r=e[1],n=this.values;return r>=i?n.portrait:n.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},O6={xsmall:544,small:768,medium:992,large:1200};function $8e(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function R6(t,e){return e?aL[t].valueToClassName[e].split(" "):[]}const I8e=t=>{let e=class extends t{constructor(...i){super(...i),this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=O6}initialize(){this.addHandles(le(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),Zi))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(i){if(i===this._get("breakpoints"))return;const r=$8e(i);if(!r){const n=JSON.stringify(O6,null,2);console.warn("provided breakpoints are not valid, using defaults:"+n)}i=r?i:O6,this._set("breakpoints",{...i})}_updateClassNames(){if(!this.container)return;const i=Hl.acquire(),r=Hl.acquire();let n,s=!1;for(n in aL){const o=this[n],a=aL[n].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(s=!0,this[n]=a,R6(n,o).forEach(l=>r.push(l)),R6(n,a).forEach(l=>i.push(l)))}s&&(this._applyClassNameChanges(i,r),Hl.release(i),Hl.release(r))}_applyClassNameChanges(i,r){const n=this.container;n&&(r.forEach(s=>n.classList.remove(s)),i.forEach(s=>n.classList.add(s)))}_removeActiveClassNames(){const i=this.container;if(!i)return;let r;for(r in aL)R6(r,this[r]).forEach(n=>i.classList.remove(n))}};return h([f()],e.prototype,"breakpoints",null),h([f()],e.prototype,"orientation",void 0),h([f()],e.prototype,"widthBreakpoint",void 0),h([f()],e.prototype,"heightBreakpoint",void 0),e=h([z("esri.views.BreakpointsOwner")],e),e};let Ud=class extends xe{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(e,i,r={}){return this._installWatch(e,i,r,le)}addWhen(e,i,r={}){return this._installWatch(e,i,r,ac)}addOnCollectionChange(e,i,{initial:r=!1,final:n=!1}={}){const s=++this._handleId;return this.addHandles([Io(e,"after-changes",this._createSyncUpdatingCallback(),qi),Io(e,"change",i,{onListenerAdd:r?o=>i({added:o.toArray(),removed:[]}):void 0,onListenerRemove:n?o=>i({added:[],removed:o.toArray()}):void 0})],s),Mi(()=>this.removeHandles(s))}addPromise(e){if(e==null)return e;const i=++this._handleId;this.addHandles(Mi(()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this.hasHandles(VP)||this._set("updating",!1))}),i),this._pendingPromises.add(e),this._set("updating",!0);const r=()=>this.removeHandles(i);return e.then(r,r),e}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set("updating",!1)}_installWatch(e,i,r={},n){const s=++this._handleId;r.sync||this._installSyncUpdatingWatch(e,s);const o=n(e,i,r);return this.addHandles(o,s),Mi(()=>this.removeHandles(s))}_installSyncUpdatingWatch(e,i){const r=this._createSyncUpdatingCallback(),n=le(e,r,{sync:!0,equals:()=>!1});return this.addHandles(n,i),n}_createSyncUpdatingCallback(){return()=>{this.removeHandles(VP),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this.addHandles(PS(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this.removeHandles(VP))}),VP)}}};h([f({readOnly:!0})],Ud.prototype,"updating",void 0),Ud=h([z("esri.core.support.UpdatingHandles")],Ud);const VP=-42;/*!
 * @esri/arcgis-html-sanitizer - v3.0.1 - Tue Nov 15 2022 09:46:54 GMT-0800 (Pacific Standard Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei(雷宗民) <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 */var L8e=function(t){if(typeof t!="object"||t===null||Object.prototype.toString.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},S1={exports:{}},Xn={},cO={exports:{}},cw={};function sye(){var t={};return t["align-content"]=!1,t["align-items"]=!1,t["align-self"]=!1,t["alignment-adjust"]=!1,t["alignment-baseline"]=!1,t.all=!1,t["anchor-point"]=!1,t.animation=!1,t["animation-delay"]=!1,t["animation-direction"]=!1,t["animation-duration"]=!1,t["animation-fill-mode"]=!1,t["animation-iteration-count"]=!1,t["animation-name"]=!1,t["animation-play-state"]=!1,t["animation-timing-function"]=!1,t.azimuth=!1,t["backface-visibility"]=!1,t.background=!0,t["background-attachment"]=!0,t["background-clip"]=!0,t["background-color"]=!0,t["background-image"]=!0,t["background-origin"]=!0,t["background-position"]=!0,t["background-repeat"]=!0,t["background-size"]=!0,t["baseline-shift"]=!1,t.binding=!1,t.bleed=!1,t["bookmark-label"]=!1,t["bookmark-level"]=!1,t["bookmark-state"]=!1,t.border=!0,t["border-bottom"]=!0,t["border-bottom-color"]=!0,t["border-bottom-left-radius"]=!0,t["border-bottom-right-radius"]=!0,t["border-bottom-style"]=!0,t["border-bottom-width"]=!0,t["border-collapse"]=!0,t["border-color"]=!0,t["border-image"]=!0,t["border-image-outset"]=!0,t["border-image-repeat"]=!0,t["border-image-slice"]=!0,t["border-image-source"]=!0,t["border-image-width"]=!0,t["border-left"]=!0,t["border-left-color"]=!0,t["border-left-style"]=!0,t["border-left-width"]=!0,t["border-radius"]=!0,t["border-right"]=!0,t["border-right-color"]=!0,t["border-right-style"]=!0,t["border-right-width"]=!0,t["border-spacing"]=!0,t["border-style"]=!0,t["border-top"]=!0,t["border-top-color"]=!0,t["border-top-left-radius"]=!0,t["border-top-right-radius"]=!0,t["border-top-style"]=!0,t["border-top-width"]=!0,t["border-width"]=!0,t.bottom=!1,t["box-decoration-break"]=!0,t["box-shadow"]=!0,t["box-sizing"]=!0,t["box-snap"]=!0,t["box-suppress"]=!0,t["break-after"]=!0,t["break-before"]=!0,t["break-inside"]=!0,t["caption-side"]=!1,t.chains=!1,t.clear=!0,t.clip=!1,t["clip-path"]=!1,t["clip-rule"]=!1,t.color=!0,t["color-interpolation-filters"]=!0,t["column-count"]=!1,t["column-fill"]=!1,t["column-gap"]=!1,t["column-rule"]=!1,t["column-rule-color"]=!1,t["column-rule-style"]=!1,t["column-rule-width"]=!1,t["column-span"]=!1,t["column-width"]=!1,t.columns=!1,t.contain=!1,t.content=!1,t["counter-increment"]=!1,t["counter-reset"]=!1,t["counter-set"]=!1,t.crop=!1,t.cue=!1,t["cue-after"]=!1,t["cue-before"]=!1,t.cursor=!1,t.direction=!1,t.display=!0,t["display-inside"]=!0,t["display-list"]=!0,t["display-outside"]=!0,t["dominant-baseline"]=!1,t.elevation=!1,t["empty-cells"]=!1,t.filter=!1,t.flex=!1,t["flex-basis"]=!1,t["flex-direction"]=!1,t["flex-flow"]=!1,t["flex-grow"]=!1,t["flex-shrink"]=!1,t["flex-wrap"]=!1,t.float=!1,t["float-offset"]=!1,t["flood-color"]=!1,t["flood-opacity"]=!1,t["flow-from"]=!1,t["flow-into"]=!1,t.font=!0,t["font-family"]=!0,t["font-feature-settings"]=!0,t["font-kerning"]=!0,t["font-language-override"]=!0,t["font-size"]=!0,t["font-size-adjust"]=!0,t["font-stretch"]=!0,t["font-style"]=!0,t["font-synthesis"]=!0,t["font-variant"]=!0,t["font-variant-alternates"]=!0,t["font-variant-caps"]=!0,t["font-variant-east-asian"]=!0,t["font-variant-ligatures"]=!0,t["font-variant-numeric"]=!0,t["font-variant-position"]=!0,t["font-weight"]=!0,t.grid=!1,t["grid-area"]=!1,t["grid-auto-columns"]=!1,t["grid-auto-flow"]=!1,t["grid-auto-rows"]=!1,t["grid-column"]=!1,t["grid-column-end"]=!1,t["grid-column-start"]=!1,t["grid-row"]=!1,t["grid-row-end"]=!1,t["grid-row-start"]=!1,t["grid-template"]=!1,t["grid-template-areas"]=!1,t["grid-template-columns"]=!1,t["grid-template-rows"]=!1,t["hanging-punctuation"]=!1,t.height=!0,t.hyphens=!1,t.icon=!1,t["image-orientation"]=!1,t["image-resolution"]=!1,t["ime-mode"]=!1,t["initial-letters"]=!1,t["inline-box-align"]=!1,t["justify-content"]=!1,t["justify-items"]=!1,t["justify-self"]=!1,t.left=!1,t["letter-spacing"]=!0,t["lighting-color"]=!0,t["line-box-contain"]=!1,t["line-break"]=!1,t["line-grid"]=!1,t["line-height"]=!1,t["line-snap"]=!1,t["line-stacking"]=!1,t["line-stacking-ruby"]=!1,t["line-stacking-shift"]=!1,t["line-stacking-strategy"]=!1,t["list-style"]=!0,t["list-style-image"]=!0,t["list-style-position"]=!0,t["list-style-type"]=!0,t.margin=!0,t["margin-bottom"]=!0,t["margin-left"]=!0,t["margin-right"]=!0,t["margin-top"]=!0,t["marker-offset"]=!1,t["marker-side"]=!1,t.marks=!1,t.mask=!1,t["mask-box"]=!1,t["mask-box-outset"]=!1,t["mask-box-repeat"]=!1,t["mask-box-slice"]=!1,t["mask-box-source"]=!1,t["mask-box-width"]=!1,t["mask-clip"]=!1,t["mask-image"]=!1,t["mask-origin"]=!1,t["mask-position"]=!1,t["mask-repeat"]=!1,t["mask-size"]=!1,t["mask-source-type"]=!1,t["mask-type"]=!1,t["max-height"]=!0,t["max-lines"]=!1,t["max-width"]=!0,t["min-height"]=!0,t["min-width"]=!0,t["move-to"]=!1,t["nav-down"]=!1,t["nav-index"]=!1,t["nav-left"]=!1,t["nav-right"]=!1,t["nav-up"]=!1,t["object-fit"]=!1,t["object-position"]=!1,t.opacity=!1,t.order=!1,t.orphans=!1,t.outline=!1,t["outline-color"]=!1,t["outline-offset"]=!1,t["outline-style"]=!1,t["outline-width"]=!1,t.overflow=!1,t["overflow-wrap"]=!1,t["overflow-x"]=!1,t["overflow-y"]=!1,t.padding=!0,t["padding-bottom"]=!0,t["padding-left"]=!0,t["padding-right"]=!0,t["padding-top"]=!0,t.page=!1,t["page-break-after"]=!1,t["page-break-before"]=!1,t["page-break-inside"]=!1,t["page-policy"]=!1,t.pause=!1,t["pause-after"]=!1,t["pause-before"]=!1,t.perspective=!1,t["perspective-origin"]=!1,t.pitch=!1,t["pitch-range"]=!1,t["play-during"]=!1,t.position=!1,t["presentation-level"]=!1,t.quotes=!1,t["region-fragment"]=!1,t.resize=!1,t.rest=!1,t["rest-after"]=!1,t["rest-before"]=!1,t.richness=!1,t.right=!1,t.rotation=!1,t["rotation-point"]=!1,t["ruby-align"]=!1,t["ruby-merge"]=!1,t["ruby-position"]=!1,t["shape-image-threshold"]=!1,t["shape-outside"]=!1,t["shape-margin"]=!1,t.size=!1,t.speak=!1,t["speak-as"]=!1,t["speak-header"]=!1,t["speak-numeral"]=!1,t["speak-punctuation"]=!1,t["speech-rate"]=!1,t.stress=!1,t["string-set"]=!1,t["tab-size"]=!1,t["table-layout"]=!1,t["text-align"]=!0,t["text-align-last"]=!0,t["text-combine-upright"]=!0,t["text-decoration"]=!0,t["text-decoration-color"]=!0,t["text-decoration-line"]=!0,t["text-decoration-skip"]=!0,t["text-decoration-style"]=!0,t["text-emphasis"]=!0,t["text-emphasis-color"]=!0,t["text-emphasis-position"]=!0,t["text-emphasis-style"]=!0,t["text-height"]=!0,t["text-indent"]=!0,t["text-justify"]=!0,t["text-orientation"]=!0,t["text-overflow"]=!0,t["text-shadow"]=!0,t["text-space-collapse"]=!0,t["text-transform"]=!0,t["text-underline-position"]=!0,t["text-wrap"]=!0,t.top=!1,t.transform=!1,t["transform-origin"]=!1,t["transform-style"]=!1,t.transition=!1,t["transition-delay"]=!1,t["transition-duration"]=!1,t["transition-property"]=!1,t["transition-timing-function"]=!1,t["unicode-bidi"]=!1,t["vertical-align"]=!1,t.visibility=!1,t["voice-balance"]=!1,t["voice-duration"]=!1,t["voice-family"]=!1,t["voice-pitch"]=!1,t["voice-range"]=!1,t["voice-rate"]=!1,t["voice-stress"]=!1,t["voice-volume"]=!1,t.volume=!1,t["white-space"]=!1,t.widows=!1,t.width=!0,t["will-change"]=!1,t["word-break"]=!0,t["word-spacing"]=!0,t["word-wrap"]=!0,t["wrap-flow"]=!1,t["wrap-through"]=!1,t["writing-mode"]=!1,t["z-index"]=!1,t}function D8e(t,e,i){}function N8e(t,e,i){}var F8e=/javascript\s*\:/img;function k8e(t,e){return F8e.test(e)?"":e}cw.whiteList=sye();cw.getDefaultWhiteList=sye;cw.onAttr=D8e;cw.onIgnoreAttr=N8e;cw.safeAttrValue=k8e;var U8e={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,n;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,n=t.length;r<n;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")}},vE=U8e;function z8e(t,e){t=vE.trimRight(t),t[t.length-1]!==";"&&(t+=";");var i=t.length,r=!1,n=0,s=0,o="";function a(){if(!r){var u=vE.trim(t.slice(n,s)),d=u.indexOf(":");if(d!==-1){var p=vE.trim(u.slice(0,d)),m=vE.trim(u.slice(d+1));if(p){var y=e(n,o.length,p,m,u);y&&(o+=y+"; ")}}}n=s+1}for(;s<i;s++){var l=t[s];if(l==="/"&&t[s+1]==="*"){var c=t.indexOf("*/",s+2);if(c===-1)break;s=c+1,n=s+1,r=!1}else l==="("?r=!0:l===")"?r=!1:l===";"?r||a():l===`
`&&a()}return vE.trim(o)}var B8e=z8e,GP=cw,V8e=B8e;function see(t){return t==null}function G8e(t){var e={};for(var i in t)e[i]=t[i];return e}function oye(t){t=G8e(t||{}),t.whiteList=t.whiteList||GP.whiteList,t.onAttr=t.onAttr||GP.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||GP.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||GP.safeAttrValue,this.options=t}oye.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,n=i.onAttr,s=i.onIgnoreAttr,o=i.safeAttrValue,a=V8e(t,function(l,c,u,d,p){var m=r[u],y=!1;if(m===!0?y=m:typeof m=="function"?y=m(d):m instanceof RegExp&&(y=m.test(d)),y!==!0&&(y=!1),d=o(u,d),!!d){var _={position:c,sourcePosition:l,source:p,isWhite:y};if(y){var v=n(u,d,_);return see(v)?u+":"+d:v}else{var v=s(u,d,_);if(!see(v))return v}}});return a};var j8e=oye;(function(t,e){var i=cw,r=j8e;function n(o,a){var l=new r(a);return l.process(o)}e=t.exports=n,e.FilterCSS=r;for(var s in i)e[s]=i[s]})(cO,cO.exports);var kW={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,n;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,n=t.length;r<n;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/,i=e.exec(t);return i?i.index:-1}},H8e=cO.exports.FilterCSS,q8e=cO.exports.getDefaultWhiteList,yN=kW;function aye(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var lye=new H8e;function W8e(t,e,i){}function Y8e(t,e,i){}function X8e(t,e,i){}function Z8e(t,e,i){}function cye(t){return t.replace(K8e,"&lt;").replace(Q8e,"&gt;")}function J8e(t,e,i,r){if(i=mye(i),e==="href"||e==="src"){if(i=yN.trim(i),i==="#")return"#";if(!(i.substr(0,7)==="http://"||i.substr(0,8)==="https://"||i.substr(0,7)==="mailto:"||i.substr(0,4)==="tel:"||i.substr(0,11)==="data:image/"||i.substr(0,6)==="ftp://"||i.substr(0,2)==="./"||i.substr(0,3)==="../"||i[0]==="#"||i[0]==="/"))return""}else if(e==="background"){if(jP.lastIndex=0,jP.test(i))return""}else if(e==="style"){if(oee.lastIndex=0,oee.test(i)||(aee.lastIndex=0,aee.test(i)&&(jP.lastIndex=0,jP.test(i))))return"";r!==!1&&(r=r||lye,i=r.process(i))}return i=gye(i),i}var K8e=/</g,Q8e=/>/g,eze=/"/g,tze=/&quot;/g,ize=/&#([a-zA-Z0-9]*);?/gim,rze=/&colon;?/gim,nze=/&newline;?/gim,jP=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,oee=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,aee=/u\s*r\s*l\s*\(.*/gi;function uye(t){return t.replace(eze,"&quot;")}function hye(t){return t.replace(tze,'"')}function dye(t){return t.replace(ize,function(i,r){return r[0]==="x"||r[0]==="X"?String.fromCharCode(parseInt(r.substr(1),16)):String.fromCharCode(parseInt(r,10))})}function pye(t){return t.replace(rze,":").replace(nze," ")}function fye(t){for(var e="",i=0,r=t.length;i<r;i++)e+=t.charCodeAt(i)<32?" ":t.charAt(i);return yN.trim(e)}function mye(t){return t=hye(t),t=dye(t),t=pye(t),t=fye(t),t}function gye(t){return t=uye(t),t=cye(t),t}function sze(){return""}function oze(t,e){typeof e!="function"&&(e=function(){});var i=!Array.isArray(t);function r(o){return i?!0:yN.indexOf(t,o)!==-1}var n=[],s=!1;return{onIgnoreTag:function(o,a,l){if(r(o))if(l.isClosing){var c="[/removed]",u=l.position+c.length;return n.push([s!==!1?s:l.position,u]),s=!1,c}else return s||(s=l.position),"[removed]";else return e(o,a,l)},remove:function(o){var a="",l=0;return yN.forEach(n,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function aze(t){for(var e="",i=0;i<t.length;){var r=t.indexOf("<!--",i);if(r===-1){e+=t.slice(i);break}e+=t.slice(i,r);var n=t.indexOf("-->",r);if(n===-1)break;i=n+3}return e}function lze(t){var e=t.split("");return e=e.filter(function(i){var r=i.charCodeAt(0);return r===127?!1:r<=31?r===10||r===13:!0}),e.join("")}Xn.whiteList=aye();Xn.getDefaultWhiteList=aye;Xn.onTag=W8e;Xn.onIgnoreTag=Y8e;Xn.onTagAttr=X8e;Xn.onIgnoreTagAttr=Z8e;Xn.safeAttrValue=J8e;Xn.escapeHtml=cye;Xn.escapeQuote=uye;Xn.unescapeQuote=hye;Xn.escapeHtmlEntities=dye;Xn.escapeDangerHtml5Entities=pye;Xn.clearNonPrintableCharacter=fye;Xn.friendlyAttrValue=mye;Xn.escapeAttrValue=gye;Xn.onIgnoreTagStripAll=sze;Xn.StripTagBody=oze;Xn.stripCommentTag=aze;Xn.stripBlankChar=lze;Xn.cssFilter=lye;Xn.getDefaultCSSWhiteList=q8e;var fF={},fy=kW;function cze(t){var e=fy.spaceIndex(t),i;return e===-1?i=t.slice(1,-1):i=t.slice(1,e+1),i=fy.trim(i).toLowerCase(),i.slice(0,1)==="/"&&(i=i.slice(1)),i.slice(-1)==="/"&&(i=i.slice(0,-1)),i}function uze(t){return t.slice(0,2)==="</"}function hze(t,e,i){var r="",n=0,s=!1,o=!1,a=0,l=t.length,c="",u="";e:for(a=0;a<l;a++){var d=t.charAt(a);if(s===!1){if(d==="<"){s=a;continue}}else if(o===!1){if(d==="<"){r+=i(t.slice(n,a)),s=a,n=a;continue}if(d===">"){r+=i(t.slice(n,s)),u=t.slice(s,a+1),c=cze(u),r+=e(s,r.length,c,u,uze(u)),n=a+1,s=!1;continue}if(d==='"'||d==="'")for(var p=1,m=t.charAt(a-p);m.trim()===""||m==="=";){if(m==="="){o=d;continue e}m=t.charAt(a-++p)}}else if(d===o){o=!1;continue}}return n<t.length&&(r+=i(t.substr(n))),r}var dze=/[^a-zA-Z0-9\\_:.-]/gim;function pze(t,e){var i=0,r=0,n=[],s=!1,o=t.length;function a(p,m){if(p=fy.trim(p),p=p.replace(dze,"").toLowerCase(),!(p.length<1)){var y=e(p,m||"");y&&n.push(y)}}for(var l=0;l<o;l++){var c=t.charAt(l),u,d;if(s===!1&&c==="="){s=t.slice(i,l),i=l+1,r=t.charAt(i)==='"'||t.charAt(i)==="'"?i:mze(t,l+1);continue}if(s!==!1&&l===r){if(d=t.indexOf(c,l+1),d===-1)break;u=fy.trim(t.slice(r+1,d)),a(s,u),s=!1,l=d,i=l+1;continue}if(/\s|\n|\t/.test(c))if(t=t.replace(/\s|\n|\t/g," "),s===!1)if(d=fze(t,l),d===-1){u=fy.trim(t.slice(i,l)),a(u),s=!1,i=l+1;continue}else{l=d-1;continue}else if(d=gze(t,l-1),d===-1){u=fy.trim(t.slice(i,l)),u=lee(u),a(s,u),s=!1,i=l+1;continue}else continue}return i<t.length&&(s===!1?a(t.slice(i)):a(s,lee(fy.trim(t.slice(i))))),fy.trim(n.join(" "))}function fze(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="="?e:-1}}function mze(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="'"||i==='"'?e:-1}}function gze(t,e){for(;e>0;e--){var i=t[e];if(i!==" ")return i==="="?e:-1}}function yze(t){return t[0]==='"'&&t[t.length-1]==='"'||t[0]==="'"&&t[t.length-1]==="'"}function lee(t){return yze(t)?t.substr(1,t.length-2):t}fF.parseTag=hze;fF.parseAttr=pze;var _ze=cO.exports.FilterCSS,pd=Xn,yye=fF,vze=yye.parseTag,bze=yye.parseAttr,lL=kW;function HP(t){return t==null}function wze(t){var e=lL.spaceIndex(t);if(e===-1)return{html:"",closing:t[t.length-2]==="/"};t=lL.trim(t.slice(e+1,-1));var i=t[t.length-1]==="/";return i&&(t=lL.trim(t.slice(0,-1))),{html:t,closing:i}}function xze(t){var e={};for(var i in t)e[i]=t[i];return e}function Tze(t){var e={};for(var i in t)Array.isArray(t[i])?e[i.toLowerCase()]=t[i].map(function(r){return r.toLowerCase()}):e[i.toLowerCase()]=t[i];return e}function _ye(t){t=xze(t||{}),t.stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=pd.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=Tze(t.whiteList||t.allowList):t.whiteList=pd.whiteList,t.onTag=t.onTag||pd.onTag,t.onTagAttr=t.onTagAttr||pd.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||pd.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||pd.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||pd.safeAttrValue,t.escapeHtml=t.escapeHtml||pd.escapeHtml,this.options=t,t.css===!1?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new _ze(t.css))}_ye.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,n=i.onTag,s=i.onIgnoreTag,o=i.onTagAttr,a=i.onIgnoreTagAttr,l=i.safeAttrValue,c=i.escapeHtml,u=e.cssFilter;i.stripBlankChar&&(t=pd.stripBlankChar(t)),i.allowCommentTag||(t=pd.stripCommentTag(t));var d=!1;i.stripIgnoreTagBody&&(d=pd.StripTagBody(i.stripIgnoreTagBody,s),s=d.onIgnoreTag);var p=vze(t,function(m,y,_,v,w){var x={sourcePosition:m,position:y,isClosing:w,isWhite:Object.prototype.hasOwnProperty.call(r,_)},T=n(_,v,x);if(!HP(T))return T;if(x.isWhite){if(x.isClosing)return"</"+_+">";var S=wze(v),E=r[_],A=bze(S.html,function(P,N){var F=lL.indexOf(E,P)!==-1,D=o(_,P,N,F);return HP(D)?F?(N=l(_,P,N,u),N?P+'="'+N+'"':P):(D=a(_,P,N,F),HP(D)?void 0:D):D});return v="<"+_,A&&(v+=" "+A),S.closing&&(v+=" /"),v+=">",v}else return T=s(_,v,x),HP(T)?c(v):T},c);return d&&(p=d.remove(p)),p};var Sze=_ye;(function(t,e){var i=Xn,r=fF,n=Sze;function s(a,l){var c=new n(l);return c.process(a)}e=t.exports=s,e.filterXSS=s,e.FilterXSS=n,function(){for(var a in i)e[a]=i[a];for(var l in r)e[l]=r[l]}();function o(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=t.exports)})(S1,S1.exports);var Eze=function(){function t(e,i){var r=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(s,o,a,l){return s==="a"&&o==="href"||(s==="img"||s==="source")&&o==="src"?r.sanitizeUrl(a):S1.exports.safeAttrValue(s,o,a,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var n;e&&!i?n=e:e&&i?(n=Object.create(this.arcgisFilterOptions),Object.keys(e).forEach(function(s){s==="whiteList"?n.whiteList=r._extendObjectOfArrays([r.arcgisWhiteList,e.whiteList||{}]):n[s]=e[s]})):(n=Object.create(this.arcgisFilterOptions),n.whiteList=this.arcgisWhiteList),this.xssFilterOptions=n,this._xssFilter=new S1.exports.FilterXSS(n)}return t.prototype.sanitize=function(e,i){switch(i===void 0&&(i={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,i);default:return i.allowUndefined&&typeof e>"u"?void 0:null}},t.prototype.sanitizeUrl=function(e,i){var r=(i??{}).isProtocolRequired,n=r===void 0?!0:r,s=this._trim(e.substring(0,e.indexOf(":"))),o=e==="/",a=/^#/.test(e),l=s&&this.allowedProtocols.indexOf(s.toLowerCase())>-1;return o||a||l?S1.exports.escapeAttrValue(e):!s&&!n?S1.exports.escapeAttrValue("https://".concat(e)):""},t.prototype.sanitizeHTMLAttribute=function(e,i,r,n){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(e,i,r,n):S1.exports.safeAttrValue(e,i,r,n)},t.prototype.validate=function(e,i){i===void 0&&(i={});var r=this.sanitize(e,i);return{isValid:e===r,sanitized:r}},t.prototype.encodeHTML=function(e){var i=this;return String(e).replace(/[&<>"'\/]/g,function(r){return i._entityMap[r]})},t.prototype.encodeAttrValue=function(e){var i=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,function(r,n){return i.test(r)?r:"&#x".concat(Number(e.charCodeAt(n)).toString(16),";")})},t.prototype._extendObjectOfArrays=function(e){var i={};return e.forEach(function(r){Object.keys(r).forEach(function(n){Array.isArray(r[n])&&Array.isArray(i[n])?i[n]=i[n].concat(r[n]):i[n]=r[n]})}),i},t.prototype._iterateOverObject=function(e,i){var r=this;i===void 0&&(i={});try{var n=!1,s=void 0;if(Array.isArray(e))s=e.reduce(function(a,l){var c=r.validate(l,i);return c.isValid?a.concat([l]):(n=!0,a.concat([c.sanitized]))},[]);else if(L8e(e)){var o=Object.keys(e);s=o.reduce(function(a,l){var c=e[l],u=r.validate(c,i);return u.isValid?a[l]=c:(n=!0,a[l]=u.sanitized),a},{})}else return i.allowUndefined&&typeof e>"u"?void 0:null;return n?s:e}catch{return null}},t.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},t}();const mF=new Map;function vye(){mF.clear()}function Cze(t){return mF.get(t)}function Aze(t,e){mF.set(t,e)}function P6(t){mF.delete(t)}const Oze=ne.getLogger("esri.widgets.support.widgetUtils");function Rze(t){const e=Hl.acquire();for(let r=0;r<arguments.length;r++){const n=arguments[r],s=typeof n;if(s==="string")e.push(n);else if(Array.isArray(n))e.push.apply(e,n);else if(s==="object")for(const o in n)n[o]&&e.push(o)}const i=e.join(" ");return Hl.release(e),i}(()=>{const t=new Map,e=new ResizeObserver(r=>{vye();for(const n of r)t.get(n.target)?.(n)}),i=(r,n,s)=>(t.has(r)&&Oze.error("Already observing element",r),t.set(r,n),e.observe(r,s),Mi(()=>{e.unobserve(r),t.delete(r)}));return(r,n,s)=>{let o=null;return db([le(()=>typeof r=="function"?r():r,a=>{o?.remove(),a&&(o=i(a,n,s))},Yi),Mi(()=>o?.remove())])}})();function Pze(t){const e=t?.closest("[dir]");return e!==null&&e instanceof HTMLElement&&e.dir==="rtl"||document.dir==="rtl"}function S3t(t){const e="data-node-ref";this[t.getAttribute(e)]=null}function cee(t){const e="data-node-ref";this[t.getAttribute(e)]=t}const Mze=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],$ze=Mze.reduce((t,e)=>(t[e]=[],t),{}),Ize=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],bye=new Eze({whiteList:$ze,onTagAttr:(t,e,i)=>{const r=`${e}="${i}"`;if(Ize.includes(e))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function Lze(t){return t==="Enter"||t===" "}const wye="http://www.w3.org/",gF=`${wye}2000/svg`,xye=`${wye}1999/xlink`;let uee=[],UW=(t,e)=>{let i={};return Object.keys(t).forEach(r=>{i[r]=t[r]}),e&&Object.keys(e).forEach(r=>{i[r]=e[r]}),i},zW=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),Tye=t=>{if(typeof t!="string")throw new Error("Style values must be strings")},Dze=(t,e,i)=>{if(e.vnodeSelector!==""){for(let r=i;r<t.length;r++)if(zW(t[r],e))return r}return-1},M6=(t,e,i,r)=>{let n=t[e];if(n.vnodeSelector==="")return;let s=n.properties;if(!(s&&(s.key===void 0?s.bind:s.key))){for(let o=0;o<t.length;o++)if(o!==e){let a=t[o];if(zW(a,n))throw new Error(`${i.vnodeSelector} had a ${n.vnodeSelector} child ${r==="added"?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},Nze=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},i7=[],r7=!1,Sye=t=>{(t.children||[]).forEach(Sye),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.apply(t.properties.bind||t.properties,[t.domNode])},hee=()=>{r7=!1,i7.forEach(Sye),i7.length=0},dee=t=>{i7.push(t),r7||(r7=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(hee,{timeout:16}):setTimeout(hee,16))},pee=t=>{let e=t.domNode;if(t.properties){let i=t.properties.exitAnimation;if(i)return e.style.pointerEvents="none",void i(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),dee(t))},t.properties)}e.parentNode&&(e.parentNode.removeChild(e),dee(t))},Fze=(t,e,i)=>{if(!e)return;let r=i.eventHandlerInterceptor,n=Object.keys(e),s=n.length;for(let o=0;o<s;o++){let a=n[o],l=e[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")s7(t,l,!0);else if(a==="classes"){let c=Object.keys(l),u=c.length;for(let d=0;d<u;d++){let p=c[d];l[p]&&t.classList.add(p)}}else if(a==="styles"){let c=Object.keys(l),u=c.length;for(let d=0;d<u;d++){let p=c[d],m=l[p];m&&(Tye(m),i.styleApplyer(t,p,m))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(r&&(l=r(a,l,t,e)),a==="oninput"&&function(){let u=l;l=function(d){u.apply(this,[d]),d.target["oninput-value"]=d.target.value}}()),t[a]=l):i.namespace===gF?a==="href"?t.setAttributeNS(xye,a,l):t.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?t[a]=bye.sanitize(l):n7(t)&&a in t?t[a]=l:t.setAttribute(a,l):t[a]=l}}};function n7(t){if(!(t instanceof Element&&t.tagName.includes("-")))return!1;const e=window.customElements.get(t.tagName.toLowerCase());return!!e&&t instanceof e}let _N,kze=(t,e,i)=>{if(e)for(let r of e)U2(r,t,void 0,i)},Eye=(t,e,i)=>{kze(t,e.children,i),e.text&&(t.textContent=e.text),Fze(t,e.properties,i),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[t,i,e.vnodeSelector,e.properties,e.children])},U2=(t,e,i,r)=>{let n,s=0,o=t.vnodeSelector,a=e.ownerDocument;if(o==="")n=t.domNode=a.createTextNode(t.text),i!==void 0?e.insertBefore(n,i):e.appendChild(n);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let u=o.charAt(s-1),d=o.slice(s,l);u==="."?n.classList.add(d):u==="#"?n.id=d:(d==="svg"&&(r=UW(r,{namespace:gF})),r.namespace!==void 0?n=t.domNode=a.createElementNS(r.namespace,d):(n=t.domNode=t.domNode||a.createElement(d),d==="input"&&t.properties&&t.properties.type!==void 0&&n.setAttribute("type",t.properties.type)),i!==void 0?e.insertBefore(n,i):n.parentNode!==e&&e.appendChild(n)),s=l+1}}Eye(n,t,r)}},s7=(t,e,i)=>{e&&e.split(" ").forEach(r=>{r&&t.classList.toggle(r,i)})},Uze=(t,e,i,r)=>{if(!i)return;let n=!1,s=Object.keys(i),o=s.length;for(let a=0;a<o;a++){let l=s[a],c=i[l],u=e[l];if(l==="class")u!==c&&(s7(t,u,!1),s7(t,c,!0));else if(l==="classes"){let d=t.classList,p=Object.keys(c),m=p.length;for(let y=0;y<m;y++){let _=p[y],v=!!c[_];v!==!!u[_]&&(n=!0,v?d.add(_):d.remove(_))}}else if(l==="styles"){let d=Object.keys(c),p=d.length;for(let m=0;m<p;m++){let y=d[m],_=c[y];_!==u[y]&&(n=!0,_?(Tye(_),r.styleApplyer(t,y,_)):r.styleApplyer(t,y,""))}}else if(c||typeof u!="string"||(c=""),l!=="value"||n7(t)){if(c!==u){let d=typeof c;d==="function"&&r.eventHandlerInterceptor||(r.namespace===gF?l==="href"?t.setAttributeNS(xye,l,c):t.setAttribute(l,c):d==="string"?l==="innerHTML"?t[l]=bye.sanitize(c):l==="role"&&c===""?t.removeAttribute(l):n7(t)&&l in t?t[l]=c:t.setAttribute(l,c):t[l]!==c&&(t[l]=c),n=!0)}}else{let d=t[l];d!==c&&(t["oninput-value"]?d===t["oninput-value"]:c!==u)&&(t[l]=c,t["oninput-value"]=void 0),c!==u&&(n=!0)}}return n},zze=(t,e,i,r,n)=>{if(i===r)return!1;r=r||uee;let s,o=(i=i||uee).length,a=r.length,l=0,c=0,u=!1;for(;c<a;){let d=l<o?i[l]:void 0,p=r[c];if(d!==void 0&&zW(d,p))u=_N(d,p,n)||u,l++;else{let m=Dze(i,p,l+1);if(m>=0){for(s=l;s<m;s++)pee(i[s]),M6(i,s,t,"removed");u=_N(i[m],p,n)||u,l=m+1}else U2(p,e,l<o?i[l].domNode:void 0,n),Nze(p),M6(r,c,t,"added")}c++}if(o>l)for(s=l;s<o;s++)pee(i[s]),M6(i,s,t,"removed");return u};_N=(t,e,i)=>{let r=t.domNode,n=!1;if(t===e)return!1;let s=!1;if(e.vnodeSelector===""){if(e.text!==t.text){let o=r.ownerDocument.createTextNode(e.text);return r.parentNode.replaceChild(o,r),e.domNode=o,n=!0,n}e.domNode=r}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(i=UW(i,{namespace:gF})),t.text!==e.text&&(s=!0,e.text===void 0?r.removeChild(r.firstChild):r.textContent=e.text),e.domNode=r,s=zze(e,r,t.children,e.children,i)||s,s=Uze(r,t.properties,e.properties,i)||s,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[r,i,e.vnodeSelector,e.properties,e.children]);return s&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(r,e.properties,t.properties),n};let bE=(t,e)=>({getLastRender:()=>t,update:i=>{if(t.vnodeSelector!==i.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let r=t;t=i,_N(r,i,e)},domNode:t.domNode});const Bze={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{e.charAt(0)==="-"?t.style.setProperty(e,i):t.style[e]=i}};let n2=t=>UW(Bze,t),ky={create:(t,e)=>(e=n2(e),U2(t,document.createElement("div"),void 0,e),bE(t,e)),append:(t,e,i)=>(i=n2(i),U2(e,t,void 0,i),bE(e,i)),insertBefore:(t,e,i)=>(i=n2(i),U2(e,t.parentNode,t,i),bE(e,i)),merge:(t,e,i)=>(i=n2(i),e.domNode=t,Eye(t,e,i),bE(e,i)),replace:(t,e,i)=>(i=n2(i),U2(e,t.parentNode,t,i),t.parentNode.removeChild(t),bE(e,i))},Cye,Vze=(t,e)=>{let i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i};Cye=Array.prototype.find?(t,e)=>t.find(e):(t,e)=>t.filter(e)[0];let Gze=(t,e)=>{let i=t;return e.forEach(r=>{i=i&&i.children?Cye(i.children,n=>n.domNode===r):void 0}),i},jze=(t,e,i)=>{let r=function(n){i("domEvent",n);let s=e(),o=Vze(n.currentTarget,s.domNode);o.reverse();let a,l=Gze(s.getLastRender(),o);return t.scheduleRender(),l&&(a=l.properties[`on${n.type}`].apply(l.properties.bind||this,arguments)),i("domEventProcessed",n),a};return(n,s,o,a)=>r},fee=t=>{let e,i,r=n2(t),n=r.performanceLogger,s=!0,o=!1,a=[],l=[],c=(d,p,m)=>{let y,_=()=>y;r.eventHandlerInterceptor=jze(e,_,n),y=d(p,m(),r),a.push(y),l.push(m)},u=()=>{if(i=void 0,s){s=!1,n("renderStart",void 0);for(let d=0;d<a.length;d++){let p=l[d]();n("rendered",void 0),a[d].update(p),n("patched",void 0)}n("renderDone",void 0),s=!0}};return e={renderNow:u,scheduleRender:()=>{i||o||(i=requestAnimationFrame(u))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),o=!0},resume:()=>{o=!1,s=!0,e.scheduleRender()},append:(d,p)=>{c(ky.append,d,p)},insertBefore:(d,p)=>{c(ky.insertBefore,d,p)},merge:(d,p)=>{c(ky.merge,d,p)},replace:(d,p)=>{c(ky.replace,d,p)},detach:d=>{for(let p=0;p<l.length;p++)if(l[p]===d)return l.splice(p,1),a.splice(p,1)[0];throw new Error("renderFunction was not found")}},e},Q0=class extends xe{constructor(){super(...arguments),this.items=new ft,this._watchUpdatingTracking=new Ud,this._callbacks=new Map,this._projector=fee(),this._hiddenProjector=fee()}get needsRender(){return this.items.length>0}get updating(){return this._watchUpdatingTracking?.updating??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,i=>{for(const r of i.added){const n=()=>r.render();this._callbacks.set(r,n),this._projector.append(this.surface,n)}for(const r of i.removed){const n=this._projector.detach(this._callbacks.get(r));this.surface.removeChild(n.domNode),this._callbacks.delete(r)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const i=this._hiddenSurface,r=this._hiddenProjector;let n;const s=()=>(n=e.render(),n);r.append(i,s),r.renderNow();const o={left:0,top:0,right:0,bottom:0};if(n?.domNode){const a=n.domNode.getBoundingClientRect();o.left=a.left,o.top=a.top,o.right=a.right,o.bottom=a.bottom}for(r.detach(s);i.firstChild;)i.removeChild(i.firstChild);return o}overlaps(e,i){const r=this.computeBoundingRect(e),n=this.computeBoundingRect(i);return Math.max(r.left,n.left)<=Math.min(r.right,n.right)&&Math.max(r.top,n.top)<=Math.min(r.bottom,n.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e,i){const r=!!i?.disableDecorations;if(!this.items.some(s=>s.visible&&!(r&&s.isDecoration)))return;const n=e.getContext("2d");n.save(),n.font=this._fontString(),this.items.forEach(s=>{r&&s.isDecoration||(n.save(),s.renderCanvas(n),n.restore())}),n.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};h([f({readOnly:!0})],Q0.prototype,"surface",void 0),h([f({readOnly:!0})],Q0.prototype,"items",void 0),h([f({readOnly:!0})],Q0.prototype,"needsRender",null),h([f({readOnly:!0})],Q0.prototype,"_watchUpdatingTracking",void 0),h([f({readOnly:!0})],Q0.prototype,"updating",null),Q0=h([z("esri.views.overlay.ViewOverlay")],Q0);const mee=Q0,$6=[0,0];function Hze(t){const e=(t.ownerDocument||window.document).defaultView,i=t.getBoundingClientRect();return $6[0]=i.left+(e?.pageXOffset??0),$6[1]=i.top+(e?.pageYOffset??0),$6}function gee(t){t&&(o0e(t),t.parentNode&&t.parentNode.removeChild(t))}function qze(t){const e=document.createElement("div");return t.appendChild(e),e}const wE=16,qP=750,Wze=512,Yze=2,Xze=t=>{let e=class extends t{constructor(...i){super(...i),this._freqInfo={freq:wE,time:qP},this._overlayRenderTaskHandle=null,this.height=0,this.messagesCommon=null,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([le(()=>this.cursor,r=>{const{surface:n}=this;n&&n.setAttribute("data-cursor",r)}),le(()=>this.navigating,r=>{const{surface:n}=this;n&&n.setAttribute("data-navigating",r.toString())})])}initialize(){const i=ie("mac"),r=async()=>{i&&(await Tg(()=>this.ready),this.messagesCommon=await nq("esri/t9n/common").catch(()=>{}))};r(),this.addHandles([le(()=>this.ui,(n,s)=>this._handleUIChange(n,s),Zi),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused")),iq(r)])}destroy(){this.destroyed||(this.ui=Pe(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(i){const r=this._get("container"),n=sF(i);if(n||typeof i!="string"||ne.getLogger(this).error("#container",`element with id '${i}' not found`),r===n)return;if(this._stopMeasuring(),r&&(r.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(gee(this.root),this._set("root",null)),this.userContent&&(UQ(this.userContent,r),gee(this.userContent),this._set("userContent",null))),!n)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);n.classList.add("esri-view");const s=document.createElement("div");s.className="esri-view-user-storage",UQ(n,s),n.appendChild(s),this._set("userContent",s);const o=document.createElement("div");o.className="esri-view-root",n.insertBefore(o,n.firstChild),this._set("root",o);const a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);const l=new mee;o.appendChild(l.surface),this._set("overlay",l),this.addHandles(le(()=>l.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=fb({render:()=>this.overlay?.render()}):this._overlayRenderTaskHandle=pr(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",n),this._startMeasuring()}get focused(){const i=document.activeElement===this.surface;return document.hasFocus()&&i}get size(){return[this.width,this.height]}blur(){this.surface?.blur()}focus(){this.surface?.focus()}pageToContainer(i,r,n){const s=this.position;return i-=s?s[0]:0,r-=s?s[1]:0,n?(n[0]=i,n[1]=r):n=[i,r],n}containerToPage(i,r,n){const s=this.position;return i+=s?s[0]:0,r+=s?s[1]:0,n?(n[0]=i,n[1]=r):n=[i,r],n}_handleUIChange(i,r){this.removeHandles("ui"),r&&r!==i&&r.destroy(),i&&(i.view=this,this.addHandles(le(()=>this.root,n=>{i.container=n?qze(n):null},Zi),"ui")),this._set("ui",i)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const i=this._freqInfo;i.freq=wE,i.time=qP,this.addHandles([sg(window,"resize",()=>{i.freq=wE,i.time=qP}),fb({prepare:r=>{const n=this._measure(),s=this._freqInfo;if(s.time+=r.deltaTime,n&&(s.freq=wE,this._get("resizing")||this._set("resizing",!0)),s.time<s.freq)return;s.time=0;const o=this._position();s.freq=o||n?wE:Math.min(qP,s.freq*Yze),!n&&s.freq>=Wze&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const i=this.container,r=i?i.clientWidth:0,n=i?i.clientHeight:0;if(r===0||n===0)return this.suspended||this._set("suspended",!0),!1;const s=this.width,o=this.height;return r===s&&n===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",r),this._set("height",n),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:s,oldHeight:o,width:r,height:n}),!0)}_position(){const i=this.container,r=this.position,n=i&&Hze(i);return!!n&&(!r||n[0]!==r[0]||n[1]!==r[1])&&(this._set("position",[n[0],n[1]]),!0)}forceDOMReadyCycle(){}};return h([f()],e.prototype,"container",null),h([f({readOnly:!0})],e.prototype,"focused",null),h([f({readOnly:!0})],e.prototype,"height",void 0),h([f()],e.prototype,"messagesCommon",void 0),h([f({type:mee})],e.prototype,"overlay",void 0),h([f({readOnly:!0})],e.prototype,"position",void 0),h([f({readOnly:!0})],e.prototype,"resizing",void 0),h([f({readOnly:!0})],e.prototype,"root",void 0),h([f({value:null,readOnly:!0})],e.prototype,"size",null),h([f({readOnly:!0})],e.prototype,"surface",void 0),h([f({readOnly:!0})],e.prototype,"suspended",void 0),h([f()],e.prototype,"ui",void 0),h([f({readOnly:!0})],e.prototype,"userContent",void 0),h([f({readOnly:!0})],e.prototype,"width",void 0),h([f()],e.prototype,"widthBreakpoint",void 0),e=h([z("esri.views.DOMContainer")],e),e};function R_(t,e,i,r){return{x:t,y:e,z:i,hasZ:i!=null,hasM:!1,spatialReference:r,type:"point"}}async function vN(t,e,i,r,n){r??(r=0);const s=t.spatialReference;if(Hd(s,i)||s==null||i==null||wn(s,i))return WP[0]=t.x,WP[1]=t.y,WP[2]=t.z??r,void jr(WP,t.spatialReference,0,e,i,0,1);const o=R_(t.x,t.y,t.z??r,s),a=await $f(o,i,n);e[0]=a.x,e[1]=a.y,e[2]=a.z??0}const WP=C();function Cg(t,e,i){if(e==null||i==null)return null;const r=new lt({spatialReference:i});return jr(t,e,0,YP,i,0,1)?(r.x=YP[0],r.y=YP[1],r.z=YP[2],r):null}const YP=C();async function Aye(t,e,i,r){const n=Cg(t,e,i);if(n!=null)return n;const s=new lt({x:t[0],y:t[1],z:t[2],spatialReference:e,hasZ:!0});return $f(s,i,r)}var Ur,ho;(function(t){t[t.OBJECT=0]="OBJECT",t[t.HUD=1]="HUD",t[t.TERRAIN=2]="TERRAIN",t[t.OVERLAY=3]="OVERLAY",t[t.I3S=4]="I3S",t[t.PCL=5]="PCL",t[t.LOD=6]="LOD",t[t.VOXEL=7]="VOXEL"})(Ur||(Ur={}));let Zze=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=ho.ALL}};(function(t){t[t.MIN=0]="MIN",t[t.MINMAX=1]="MINMAX",t[t.ALL=2]="ALL"})(ho||(ho={}));let Jze=class{constructor(e,i,r){this.object=e,this.geometryId=i,this.triangleNr=r}},Kze=class extends Jze{constructor(e,i,r,n){super(e,i,r),this.center=n!=null?Br(n):null}},Oye=class{constructor(e){this.layerUid=e}},yF=class extends Oye{constructor(e,i){super(e),this.graphicUid=i}};function ip(t){return t?.dist!=null}function yee(t){return(e,i,r)=>(Ui(_ee,e,i,r),!IW(t,_ee))}function _F(t){return ip(t)&&t.intersector===Ur.OBJECT&&!!t.target}function vF(t){return ip(t)&&t.intersector===Ur.HUD&&!!t.target&&"center"in t.target&&t.target.center!=null}const _ee=C();function gh(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function Qze(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function BW(t,e,i,r,n,s,o,a,l,c){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=s,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t}function VW(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function yh(t,e){if(t===e){const i=e[1],r=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function uw(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=u*o-a*c,p=-u*s+a*l,m=c*s-o*l;let y=i*d+r*p+n*m;return y?(y=1/y,t[0]=d*y,t[1]=(-u*r+n*c)*y,t[2]=(a*r-n*o)*y,t[3]=p*y,t[4]=(u*i-n*l)*y,t[5]=(-a*i+n*s)*y,t[6]=m*y,t[7]=(-c*i+r*l)*y,t[8]=(o*i-r*s)*y,t):null}function eBe(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t[0]=o*u-a*c,t[1]=n*c-r*u,t[2]=r*a-n*o,t[3]=a*l-s*u,t[4]=i*u-n*l,t[5]=n*s-i*a,t[6]=s*c-o*l,t[7]=r*l-i*c,t[8]=i*o-r*s,t}function tBe(t){const e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*s-o*l)+i*(-c*n+o*a)+r*(l*n-s*a)}function tS(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],p=i[0],m=i[1],y=i[2],_=i[3],v=i[4],w=i[5],x=i[6],T=i[7],S=i[8];return t[0]=p*r+m*o+y*c,t[1]=p*n+m*a+y*u,t[2]=p*s+m*l+y*d,t[3]=_*r+v*o+w*c,t[4]=_*n+v*a+w*u,t[5]=_*s+v*l+w*d,t[6]=x*r+T*o+S*c,t[7]=x*n+T*a+S*u,t[8]=x*s+T*l+S*d,t}function bN(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],p=i[0],m=i[1];return t[0]=r,t[1]=n,t[2]=s,t[3]=o,t[4]=a,t[5]=l,t[6]=p*r+m*o+c,t[7]=p*n+m*a+u,t[8]=p*s+m*l+d,t}function GW(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],p=Math.sin(i),m=Math.cos(i);return t[0]=m*r+p*o,t[1]=m*n+p*a,t[2]=m*s+p*l,t[3]=m*o-p*r,t[4]=m*a-p*n,t[5]=m*l-p*s,t[6]=c,t[7]=u,t[8]=d,t}function jW(t,e,i){const r=i[0],n=i[1],s=i[2];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=s*e[6],t[7]=s*e[7],t[8]=s*e[8],t}function iBe(t,e,i){const r=i[0],n=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t}function rBe(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function nBe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function sBe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function oBe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function HW(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=i+i,a=r+r,l=n+n,c=i*o,u=r*o,d=r*a,p=n*o,m=n*a,y=n*l,_=s*o,v=s*a,w=s*l;return t[0]=1-d-y,t[3]=u-w,t[6]=p+v,t[1]=u+w,t[4]=1-c-y,t[7]=m-_,t[2]=p-v,t[5]=m+_,t[8]=1-c-d,t}function Rye(t,e){const i=e[0],r=e[1],n=e[2],s=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10],d=u*o-a*c,p=-u*s+a*l,m=c*s-o*l,y=i*d+r*p+n*m;if(!y)return null;const _=1/y;return t[0]=d*_,t[1]=(-u*r+n*c)*_,t[2]=(a*r-n*o)*_,t[3]=p*_,t[4]=(u*i-n*l)*_,t[5]=(-a*i+n*s)*_,t[6]=m*_,t[7]=(-c*i+r*l)*_,t[8]=(o*i-r*s)*_,t}function Ag(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],p=e[10],m=e[11],y=e[12],_=e[13],v=e[14],w=e[15],x=i*a-r*o,T=i*l-n*o,S=i*c-s*o,E=r*l-n*a,A=r*c-s*a,P=n*c-s*l,N=u*_-d*y,F=u*v-p*y,D=u*w-m*y,$=d*v-p*_,R=d*w-m*_,k=p*w-m*v;let B=x*k-T*R+S*$+E*D-A*F+P*N;return B?(B=1/B,t[0]=(a*k-l*R+c*$)*B,t[1]=(l*D-o*k-c*F)*B,t[2]=(o*R-a*D+c*N)*B,t[3]=(n*R-r*k-s*$)*B,t[4]=(i*k-n*D+s*F)*B,t[5]=(r*D-i*R-s*N)*B,t[6]=(_*P-v*A+w*E)*B,t[7]=(v*S-y*P-w*T)*B,t[8]=(y*A-_*S+w*x)*B,t):null}function aBe(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function lBe(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function cBe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2)}function uBe(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t}function Pye(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}function hBe(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t}function dBe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t}function pBe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function fBe(t,e){const i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=e[0],p=e[1],m=e[2],y=e[3],_=e[4],v=e[5],w=e[6],x=e[7],T=e[8],S=mo();return Math.abs(i-d)<=S*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(r-p)<=S*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(n-m)<=S*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(s-y)<=S*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(o-_)<=S*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(a-v)<=S*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(l-w)<=S*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(c-x)<=S*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(u-T)<=S*Math.max(1,Math.abs(u),Math.abs(T))}function qW(t){const e=mo(),i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return Math.abs(1-(i*i+s*s+l*l))<=e&&Math.abs(1-(r*r+o*o+c*c))<=e&&Math.abs(1-(n*n+a*a+u*u))<=e}const mBe=tS,gBe=Pye;Object.freeze(Object.defineProperty({__proto__:null,add:uBe,adjoint:eBe,copy:Qze,determinant:tBe,equals:fBe,exactEquals:pBe,frob:cBe,fromMat2d:oBe,fromMat4:gh,fromQuat:HW,fromRotation:nBe,fromScaling:sBe,fromTranslation:rBe,identity:VW,invert:uw,isOrthoNormal:qW,mul:mBe,multiply:tS,multiplyScalar:hBe,multiplyScalarAndAdd:dBe,normalFromMat4:Ag,normalFromMat4Legacy:Rye,projection:aBe,rotate:GW,scale:jW,scaleByVec2:iBe,set:BW,str:lBe,sub:gBe,subtract:Pye,translate:bN,transpose:yh},Symbol.toStringTag,{value:"Module"}));function yBe(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function uO(t,e,i){i*=.5;const r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t}function WW(t,e){const i=2*Math.acos(e[3]),r=Math.sin(i/2);return r>mo()?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),i}function YW(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=i[0],l=i[1],c=i[2],u=i[3];return t[0]=r*u+o*a+n*c-s*l,t[1]=n*u+o*l+s*a-r*c,t[2]=s*u+o*c+r*l-n*a,t[3]=o*u-r*a-n*l-s*c,t}function _Be(t,e,i){i*=.5;const r=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+o*a,t[1]=n*l+s*a,t[2]=s*l-n*a,t[3]=o*l-r*a,t}function vBe(t,e,i){i*=.5;const r=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l-s*a,t[1]=n*l+o*a,t[2]=s*l+r*a,t[3]=o*l-n*a,t}function bBe(t,e,i){i*=.5;const r=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+n*a,t[1]=n*l-r*a,t[2]=s*l+o*a,t[3]=o*l-s*a,t}function wBe(t,e){const i=e[0],r=e[1],n=e[2];return t[0]=i,t[1]=r,t[2]=n,t[3]=Math.sqrt(Math.abs(1-i*i-r*r-n*n)),t}function cL(t,e,i,r){const n=e[0],s=e[1],o=e[2],a=e[3];let l,c,u,d,p,m=i[0],y=i[1],_=i[2],v=i[3];return c=n*m+s*y+o*_+a*v,c<0&&(c=-c,m=-m,y=-y,_=-_,v=-v),1-c>mo()?(l=Math.acos(c),u=Math.sin(l),d=Math.sin((1-r)*l)/u,p=Math.sin(r*l)/u):(d=1-r,p=r),t[0]=d*n+p*m,t[1]=d*s+p*y,t[2]=d*o+p*_,t[3]=d*a+p*v,t}function xBe(t){const e=oR,i=e(),r=e(),n=e(),s=Math.sqrt(1-i),o=Math.sqrt(i);return t[0]=s*Math.sin(2*Math.PI*r),t[1]=s*Math.cos(2*Math.PI*r),t[2]=o*Math.sin(2*Math.PI*n),t[3]=o*Math.cos(2*Math.PI*n),t}function TBe(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=i*i+r*r+n*n+s*s,a=o?1/o:0;return t[0]=-i*a,t[1]=-r*a,t[2]=-n*a,t[3]=s*a,t}function Db(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Mye(t,e){const i=e[0]+e[4]+e[8];let r;if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{let n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);const s=(n+1)%3,o=(n+2)%3;r=Math.sqrt(e[3*n+n]-e[3*s+s]-e[3*o+o]+1),t[n]=.5*r,r=.5/r,t[3]=(e[3*s+o]-e[3*o+s])*r,t[s]=(e[3*s+n]+e[3*n+s])*r,t[o]=(e[3*o+n]+e[3*n+o])*r}return t}function SBe(t,e,i,r){const n=.5*Math.PI/180;e*=n,i*=n,r*=n;const s=Math.sin(e),o=Math.cos(e),a=Math.sin(i),l=Math.cos(i),c=Math.sin(r),u=Math.cos(r);return t[0]=s*l*u-o*a*c,t[1]=o*a*u+s*l*c,t[2]=o*l*c-s*a*u,t[3]=o*l*u+s*a*c,t}function EBe(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const XW=Cd,CBe=Mr,ABe=cq,OBe=YW,RBe=Tb,PBe=Jde,MBe=dq,$ye=uq,$Be=$ye,Iye=hq,IBe=Iye,ZW=Zde,LBe=nT,DBe=Sb;function NBe(t,e,i){const r=me(e,i);return r<-.999999?(nt(up,FBe,e),zl(up)<1e-6&&nt(up,kBe,e),ge(up,up),uO(t,up,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(nt(up,e,i),t[0]=up[0],t[1]=up[1],t[2]=up[2],t[3]=1+r,ZW(t,t))}const up=C(),FBe=Ce(1,0,0),kBe=Ce(0,1,0);function UBe(t,e,i,r,n,s){return cL(vee,e,n,s),cL(bee,i,r,s),cL(t,vee,bee,2*s*(1-s)),t}const vee=Sh(),bee=Sh();function zBe(t,e,i,r){const n=BBe;return n[0]=i[0],n[3]=i[1],n[6]=i[2],n[1]=r[0],n[4]=r[1],n[7]=r[2],n[2]=-e[0],n[5]=-e[1],n[8]=-e[2],ZW(t,Mye(t,n))}const BBe=Hr();Object.freeze(Object.defineProperty({__proto__:null,add:ABe,calculateW:wBe,conjugate:Db,copy:XW,dot:PBe,equals:DBe,exactEquals:LBe,fromEuler:SBe,fromMat3:Mye,getAxisAngle:WW,identity:yBe,invert:TBe,len:$Be,length:$ye,lerp:MBe,mul:OBe,multiply:YW,normalize:ZW,random:xBe,rotateX:_Be,rotateY:vBe,rotateZ:bBe,rotationTo:NBe,scale:RBe,set:CBe,setAxes:zBe,setAxisAngle:uO,slerp:cL,sqlerp:UBe,sqrLen:IBe,squaredLength:Iye,str:EBe},Symbol.toStringTag,{value:"Module"}));let TR=class{constructor(e,i,r=i){this.data=e,this.size=i,this.stride=r}},ke=class extends TR{constructor(e,i,r,n=!1,s=r){super(e,r,s),this.indices=i,this.exclusive=n}};const iS=1e-6,xE=[0,0,0],XP=[0,0,0];function VBe(t,e){const{data:i,size:r}=t,n=i.length/r;if(n<=0)return;const s=new JBe(t);uL(xE,s.minProj,s.maxProj),E1(xE,xE,.5),Zu(XP,s.maxProj,s.minProj);const o=o7(XP),a=new KBe;a.quality=o,n<14&&(t=new TR(new Float64Array(s.buffer,112,42),3));const l=[0,0,0],c=[0,0,0],u=[0,0,0],d=[0,0,0],p=[0,0,0],m=[0,0,0],y=[0,0,0];switch(GBe(s,t,y,l,c,u,d,p,m,a)){case 1:return void See(xE,XP,e);case 2:return void ZBe(t,d,e)}jBe(t,y,l,c,u,d,p,m,a),Lye(t,a.b0,a.b1,a.b2,aT,lT);const _=[0,0,0];Zu(_,lT,aT),a.quality=o7(_),a.quality<o?Dye(a.b0,a.b1,a.b2,aT,lT,_,e):See(xE,XP,e)}function GBe(t,e,i,r,n,s,o,a,l,c){return HBe(t,r,n),a7(r,n)<iS?1:(Zu(o,r,n),So(o,o),qBe(e,r,o,s)<iS?2:(Zu(a,n,s),So(a,a),Zu(l,s,r),So(l,l),Ju(i,a,o),So(i,i),Kv(e,i,o,a,l,c),0))}const TE=[0,0,0],SE=[0,0,0],xu=[0,0,0],Tu=[0,0,0],Su=[0,0,0],c0=[0,0,0],u0=[0,0,0],h0=[0,0,0];function jBe(t,e,i,r,n,s,o,a,l){WBe(t,e,i,TE,SE),TE[0]!==void 0&&(Zu(xu,TE,i),So(xu,xu),Zu(Tu,TE,r),So(Tu,Tu),Zu(Su,TE,n),So(Su,Su),Ju(c0,Tu,s),So(c0,c0),Ju(u0,Su,o),So(u0,u0),Ju(h0,xu,a),So(h0,h0),Kv(t,c0,s,Tu,xu,l),Kv(t,u0,o,Su,Tu,l),Kv(t,h0,a,xu,Su,l)),SE[0]!==void 0&&(Zu(xu,SE,i),So(xu,xu),Zu(Tu,SE,r),So(Tu,Tu),Zu(Su,SE,n),So(Su,Su),Ju(c0,Tu,s),So(c0,c0),Ju(u0,Su,o),So(u0,u0),Ju(h0,xu,a),So(h0,h0),Kv(t,c0,s,Tu,xu,l),Kv(t,u0,o,Su,Tu,l),Kv(t,h0,a,xu,Su,l))}function HBe(t,e,i){let r=a7(t.maxVert[0],t.minVert[0]),n=0;for(let s=1;s<7;++s){const o=a7(t.maxVert[s],t.minVert[s]);o>r&&(r=o,n=s)}Kl(e,t.minVert[n]),Kl(i,t.maxVert[n])}const Eu=[0,0,0];function qBe(t,e,i,r){const{data:n,size:s}=t;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<n.length;l+=s){Eu[0]=n[l]-e[0],Eu[1]=n[l+1]-e[1],Eu[2]=n[l+2]-e[2];const c=i[0]*Eu[0]+i[1]*Eu[1]+i[2]*Eu[2],u=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],d=Eu[0]*Eu[0]+Eu[1]*Eu[1]+Eu[2]*Eu[2]-c*c/u;d>o&&(o=d,a=l)}return Kl(r,n,a),o}const gs=[0,0];function WBe(t,e,i,r,n){XBe(t,e,gs,n,r);const s=Fye(i,e);gs[1]-iS<=s&&(r[0]=void 0),gs[0]+iS>=s&&(n[0]=void 0)}const wee=[0,0,0],xee=[0,0,0],Tee=[0,0,0],$w=[0,0,0],Iw=[0,0,0],ZP=[0,0,0];function Kv(t,e,i,r,n,s){if(Nye(e)<iS)return;Ju(wee,i,e),Ju(xee,r,e),Ju(Tee,n,e),oT(t,e,gs),Iw[1]=gs[0],$w[1]=gs[1],ZP[1]=$w[1]-Iw[1];const o=[i,r,n],a=[wee,xee,Tee];for(let l=0;l<3;++l){oT(t,o[l],gs),Iw[0]=gs[0],$w[0]=gs[1],oT(t,a[l],gs),Iw[2]=gs[0],$w[2]=gs[1],ZP[0]=$w[0]-Iw[0],ZP[2]=$w[2]-Iw[2];const c=o7(ZP);c<s.quality&&(Kl(s.b0,o[l]),Kl(s.b1,e),Kl(s.b2,a[l]),s.quality=c)}}const YBe=[0,0,0];function oT(t,e,i){const{data:r,size:n}=t;i[0]=Number.POSITIVE_INFINITY,i[1]=Number.NEGATIVE_INFINITY;for(let s=0;s<r.length;s+=n){const o=r[s]*e[0]+r[s+1]*e[1]+r[s+2]*e[2];i[0]=Math.min(i[0],o),i[1]=Math.max(i[1],o)}}function XBe(t,e,i,r,n){const{data:s,size:o}=t;Kl(r,s),Kl(n,r),i[0]=Fye(YBe,e),i[1]=i[0];for(let a=o;a<s.length;a+=o){const l=s[a]*e[0]+s[a+1]*e[1]+s[a+2]*e[2];l<i[0]&&(i[0]=l,Kl(r,s,a)),l>i[1]&&(i[1]=l,Kl(n,s,a))}}function See(t,e,i){Kl(i.center,t),E1(i.halfSize,e,.5),i.quaternion[0]=0,i.quaternion[1]=0,i.quaternion[2]=0,i.quaternion[3]=1}const nm=[0,0,0],Lw=[0,0,0],EE=[0,0,0],aT=[0,0,0],lT=[0,0,0],Eee=[0,0,0];function ZBe(t,e,i){Kl(nm,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?nm[0]=0:Math.abs(e[1])>Math.abs(e[2])?nm[1]=0:nm[2]=0,Nye(nm)<iS&&(nm[0]=nm[1]=nm[2]=1),Ju(Lw,e,nm),So(Lw,Lw),Ju(EE,e,Lw),So(EE,EE),Lye(t,e,Lw,EE,aT,lT),Zu(Eee,lT,aT),Dye(e,Lw,EE,aT,lT,Eee,i)}function Lye(t,e,i,r,n,s){oT(t,e,gs),n[0]=gs[0],s[0]=gs[1],oT(t,i,gs),n[1]=gs[0],s[1]=gs[1],oT(t,r,gs),n[2]=gs[0],s[2]=gs[1]}const JP=[0,0,0],hp=[1,0,0,0,1,0,0,0,1],Dw=[0,0,0];function Dye(t,e,i,r,n,s,o){hp[0]=t[0],hp[1]=t[1],hp[2]=t[2],hp[3]=e[0],hp[4]=e[1],hp[5]=e[2],hp[6]=i[0],hp[7]=i[1],hp[8]=i[2],QBe(o.quaternion,hp),uL(Dw,r,n),E1(Dw,Dw,.5),E1(o.center,t,Dw[0]),E1(JP,e,Dw[1]),uL(o.center,o.center,JP),E1(JP,i,Dw[2]),uL(o.center,o.center,JP),E1(o.halfSize,s,.5)}const fc=7;let JBe=class{constructor(e){this.minVert=new Array(fc),this.maxVert=new Array(fc);const i=64*fc;this.buffer=new ArrayBuffer(i);let r=0;this.minProj=new Float64Array(this.buffer,r,fc),r+=8*fc,this.maxProj=new Float64Array(this.buffer,r,fc),r+=8*fc;for(let l=0;l<fc;++l)this.minVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<fc;++l)this.maxVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<fc;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const n=new Array(fc),s=new Array(fc),{data:o,size:a}=e;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,n[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,s[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,n[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,s[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,n[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,s[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,n[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,s[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,n[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,s[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,n[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,s[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,n[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,s[6]=l)}for(let l=0;l<fc;++l){let c=n[l];Kl(this.minVert[l],o,c),c=s[l],Kl(this.maxVert[l],o,c)}}},KBe=class{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}};function o7(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function uL(t,e,i){t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2]}function Zu(t,e,i){t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2]}function E1(t,e,i){t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}function Kl(t,e,i=0){t[0]=e[i],t[1]=e[i+1],t[2]=e[i+2]}function Ju(t,e,i){const r=e[0],n=e[1],s=e[2],o=i[0],a=i[1],l=i[2];t[0]=n*l-s*a,t[1]=s*o-r*l,t[2]=r*a-n*o}function So(t,e){const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(i>0){const r=1/Math.sqrt(i);t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}}function Nye(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function a7(t,e){const i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return i*i+r*r+n*n}function Fye(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function QBe(t,e){const i=e[0]+e[4]+e[8];if(i>0){let r=Math.sqrt(i+1);t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r}else{let r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);const n=(r+1)%3,s=(r+2)%3;let o=Math.sqrt(e[3*r+r]-e[3*n+n]-e[3*s+s]+1);t[r]=.5*o,o=.5/o,t[3]=(e[3*n+s]-e[3*s+n])*o,t[n]=(e[3*n+r]+e[3*r+n])*o,t[s]=(e[3*s+r]+e[3*r+s])*o}}const ib=Sh(),Oa=C(),l7=C(),e9e=Hr();function JW(t=[0,0,0],e=[-1,-1,-1],i=Sh()){return{center:Br(t),halfSize:Br(e),quaternion:f0e(i)}}function Cee(t){return JW(t.center,t.halfSize,t.quaternion)}function D3t(t,e){se(e.center,t.center),se(e.halfSize,t.halfSize),XW(e.quaternion,t.quaternion)}function N3t(t,e){return e=e||JW(),VBe(t,e),e}function Qv(t,e){const i=ir(e,t.center),r=bF(t,e);return i>r?1:i<-r?-1:0}function F3t(t,e){return Oa[0]=t.center[0]-e[0],Oa[1]=t.center[1]-e[1],Oa[2]=t.center[2]-e[2],Db(ib,t.quaternion),bf(Oa,Oa,ib),DT(Oa,Oa),O4(l7,Oa,t.halfSize),R4(l7,Oa)<e[3]*e[3]}function k3t(t,e){e||(e=ds());const i=HW(e9e,t.quaternion),r=t.halfSize[0]*Math.abs(i[0])+t.halfSize[1]*Math.abs(i[3])+t.halfSize[2]*Math.abs(i[6]),n=t.halfSize[0]*Math.abs(i[1])+t.halfSize[1]*Math.abs(i[4])+t.halfSize[2]*Math.abs(i[7]),s=t.halfSize[0]*Math.abs(i[2])+t.halfSize[1]*Math.abs(i[5])+t.halfSize[2]*Math.abs(i[8]);return e[0]=t.center[0]-r,e[1]=t.center[1]-n,e[2]=t.center[2]-s,e[3]=t.center[0]+r,e[4]=t.center[1]+n,e[5]=t.center[2]+s,e}function U3t(t,e){return ir(e,t.center)-bF(t,e)}function z3t(t,e){return ir(e,t.center)+bF(t,e)}function B3t(t,e){return Qv(t,e[0])<=0&&Qv(t,e[1])<=0&&Qv(t,e[2])<=0&&Qv(t,e[3])<=0&&Qv(t,e[4])<=0&&Qv(t,e[5])<=0}function V3t(t,e,i,r=0){Db(ib,t.quaternion),he(Oa,e,t.center);const n=bf(Oa,Oa,ib),s=bf(l7,i,ib);let o=-1/0,a=1/0;for(let l=0;l<3;l++)if(Math.abs(s[l])>1e-6){const c=(r+t.halfSize[l]-n[l])/s[l],u=(-r-t.halfSize[l]-n[l])/s[l];o=Math.max(o,Math.min(c,u)),a=Math.min(a,Math.max(c,u))}else if(n[l]>t.halfSize[l]+r||n[l]<-t.halfSize[l]-r)return!1;return o<=a}(()=>{const t=new Int8Array(162);let e=0;const i=r=>{for(let n=0;n<r.length;n++)t[e+n]=r[n];e+=6};return i([6,2,3,1,5,4]),i([0,2,3,1,5,4]),i([0,2,3,7,5,4]),i([0,1,3,2,6,4]),i([0,1,3,2,0,0]),i([0,1,5,7,3,2]),i([0,1,3,7,6,4]),i([0,1,3,7,6,2]),i([0,1,5,7,6,2]),i([0,1,5,4,6,2]),i([0,1,5,4,0,0]),i([0,1,3,7,5,4]),i([0,2,6,4,0,0]),i([0,0,0,0,0,0]),i([1,3,7,5,0,0]),i([2,3,7,6,4,0]),i([2,3,7,6,0,0]),i([2,3,1,5,7,6]),i([0,1,5,7,6,2]),i([0,1,5,7,6,4]),i([0,1,3,7,6,4]),i([4,5,7,6,2,0]),i([4,5,7,6,0,0]),i([4,5,1,3,7,6]),i([0,2,3,7,5,4]),i([6,2,3,7,5,4]),i([6,2,3,1,5,4]),t})();function bF(t,e){Db(ib,t.quaternion),bf(Oa,e,ib);const i=t.halfSize;return Math.abs(Oa[0]*i[0])+Math.abs(Oa[1]*i[1])+Math.abs(Oa[2]*i[2])}function G3t(t,e){for(let i=0;i<8;++i){const r=e[i];r[0]=1&i?-t.halfSize[0]:t.halfSize[0],r[1]=2&i?-t.halfSize[1]:t.halfSize[1],r[2]=4&i?-t.halfSize[2]:t.halfSize[2],bf(r,r,t.quaternion),ce(r,r,t.center)}}function t9e(t){return zl(t.halfSize)}function kye(t,e,i,r,n){if(XW(n.quaternion,t.quaternion),r===Me.Global){Db(KP,t.quaternion),bf(d0,t.center,KP),DT(Nw,d0),O4(Fw,Nw,t.halfSize),zs(Fw,Nw,Fw);const s=we(Fw);ce(Fw,Nw,t.halfSize);const o=we(Fw);if(s<i)se(n.center,t.center),oe(d0,i,i,i),ce(n.halfSize,t.halfSize,d0);else{const a=o>0?1+e/o:1,l=s>0?1+i/s:1,c=(l+a)/2,u=(l-a)/2;te(n.halfSize,Nw,u),dl(n.halfSize,n.halfSize,t.halfSize,c),te(n.center,Nw,c),dl(n.center,n.center,t.halfSize,u),VD(d0,d0),A4(n.center,n.center,d0),bf(n.center,n.center,n.quaternion)}}else{const s=oe(d0,0,0,1);dl(n.center,t.center,s,(i+e)/2),Db(KP,t.quaternion),bf(s,s,KP),DT(s,s),dl(n.halfSize,t.halfSize,s,(i-e)/2)}return n}const d0=C(),Nw=C(),Fw=C(),KP=Sh();let i9e=class{constructor(){this._transform=be(),this._transformInverse=new QP({value:this._transform},qn,be),this._transformInverseTranspose=new QP(this._transformInverse,sc,be),this._transformTranspose=new QP({value:this._transform},sc,be),this._transformInverseRotation=new QP({value:this._transform},Rye,Hr)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){Nn(this._transform,e)}multiplyTransform(e){Di(this._transform,this._transform,e)}set(e){Nn(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,i){this.setTransformMatrix(e),this.multiplyTransform(i),this._invalidateLazyTransforms()}},QP=class{constructor(e,i,r){this._original=e,this._update=i,this._dirty=!0,this._transform=r()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},r9e=class{constructor(e=0){this.offset=e,this.tmpVertex=C()}applyToVertex(e,i,r){const n=oe(wN,e,i,r),s=ce(u7,n,this.localOrigin),o=this.offset/we(s);return dl(this.tmpVertex,n,s,o),this.tmpVertex}applyToAabb(e){const i=Uye,r=zye,n=Bye;for(let l=0;l<3;++l)i[l]=e[0+l]+this.localOrigin[l],r[l]=e[3+l]+this.localOrigin[l],n[l]=i[l];const s=this.applyToVertex(i[0],i[1],i[2]);for(let l=0;l<3;++l)e[l]=s[l],e[l+3]=s[l];const o=l=>{const c=this.applyToVertex(l[0],l[1],l[2]);for(let u=0;u<3;++u)e[u]=Math.min(e[u],c[u]),e[u+3]=Math.max(e[u+3],c[u])};for(let l=1;l<8;++l){for(let c=0;c<3;++c)n[c]=l&1<<c?r[c]:i[c];o(n)}let a=0;for(let l=0;l<3;++l)i[l]*r[l]<0&&(a|=1<<l);if(a!==0&&a!==7){for(let l=0;l<8;++l)if(!(a&l)){for(let c=0;c<3;++c)n[c]=a&1<<c?0:l&1<<c?i[c]:r[c];o(n)}}for(let l=0;l<3;++l)e[l]-=this.localOrigin[l],e[l+3]-=this.localOrigin[l];return e}},n9e=class{constructor(e=0){this.componentLocalOriginLength=0,this._tmpVertex=C(),this._mbs=xn(),this._obb=JW(),this._totalOffset=0,this._offset=0,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=we(e)}applyToVertex(e,i,r){const n=oe(wN,e,i,r),s=oe(u7,e,i,r+this.componentLocalOriginLength),o=this._totalOffset/we(s);return dl(this._tmpVertex,n,s,o),this._tmpVertex}applyToAabb(e){const i=oe(wN,e[0],e[1],e[2]+this.componentLocalOriginLength),r=oe(u7,e[3],e[4],e[5]+this.componentLocalOriginLength),n=VD(Uye,i),s=VD(zye,r),o=DT(Bye,i),a=DT(l9e,r),l=O4(Pee,o,a);l[0]=n[0]*s[0]<0?0:l[0],l[1]=n[1]*s[1]<0?0:l[1],l[2]=n[2]*s[2]<0?0:l[2];const c=we(l);if(c<this._totalOffset)return e[0]-=i[0]<0?this._totalOffset:0,e[1]-=i[1]<0?this._totalOffset:0,e[2]-=i[2]<0?this._totalOffset:0,e[3]+=r[0]>0?this._totalOffset:0,e[4]+=r[1]>0?this._totalOffset:0,e[5]+=r[2]>0?this._totalOffset:0,e;const u=jde(Pee,o,a),d=we(u),p=this._totalOffset/d,m=this._totalOffset/c;return e[0]+=i[0]*(i[0]>0?p:m),e[1]+=i[1]*(i[1]>0?p:m),e[2]+=i[2]*(i[2]>0?p:m),e[3]+=r[0]*(r[0]<0?p:m),e[4]+=r[1]*(r[1]<0?p:m),e[5]+=r[2]*(r[2]<0?p:m),e}applyToMbs(e){const i=we(e),r=this._totalOffset/i;return dl(this._mbs,e,e,r),this._mbs[3]=e[3]+e[3]*this._totalOffset/i,this._mbs}applyToObb(e){return kye(e,this._totalOffset,this._totalOffset,Me.Global,this._obb),this._obb}},s9e=class{constructor(e=0){this.offset=e,this.sphere=xn(),this.tmpVertex=C()}applyToVertex(e,i,r){const n=this.objectTransform.transform,s=oe(wN,e,i,r),o=Fe(s,s,n),a=this.offset/we(o);dl(o,o,o,a);const l=this.objectTransform.inverse;return Fe(this.tmpVertex,o,l),this.tmpVertex}applyToMinMax(e,i){const r=this.offset/we(e);dl(e,e,e,r);const n=this.offset/we(i);dl(i,i,i,n)}applyToAabb(e){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const r=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*r,e[4]+=e[4]*r,e[5]+=e[5]*r,e}applyToBoundingSphere(e){const i=we(e),r=this.offset/i;return dl(this.sphere,e,e,r),this.sphere[3]=e[3]+e[3]*this.offset/i,this.sphere}};const Aee=new s9e;function c7(t){return t!=null?(Aee.offset=t,Aee):null}const Oee=new n9e;function o9e(t){return t!=null?(Oee.offset=t,Oee):null}const Ree=new r9e;function a9e(t){return t!=null?(Ree.offset=t,Ree):null}const wy="terrain",wN=C(),u7=C(),Uye=C(),zye=C(),Bye=C(),l9e=C(),Pee=C(),rS=1e-5;let c9e=class{constructor(e){this.options=new Zze,this._results=new u9e,this.transform=new i9e,this.tolerance=rS,this.verticalOffset=null,this._ray=_s(),this._rayEnd=C(),this._rayBeginTransformed=C(),this._rayEndTransformed=C(),this.viewingMode=e??Me.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,i,r){this.resetWithRay($0e(e,i,this._ray),r)}resetWithRay(e,i){this.camera=i,e!==this._ray&&fN(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===Me.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,ce(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,i,r,n,s){this.point=i,this.filterPredicate=n,this.tolerance=r??rS;const o=c7(this.verticalOffset);if(e&&e.length>0){const a=s?l=>{s(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of e){const c=l.getSpatialQueryAccelerator?.();c!=null?(o!=null?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,a,o):c.forEachAlongRay(this._ray.origin,this._ray.direction,a),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(a)):l.objects.forAll(u=>a(u))}}this.sortResults()}intersectObject(e){const i=e.geometries;if(!i)return;const r=e.effectiveTransformation,n=c7(this.verticalOffset);for(const s of i){if(!s.visible)continue;const{material:o,id:a}=s;this.transform.setAndInvalidateLazyTransforms(r,s.transformation),Fe(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),Fe(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;n!=null&&(n.objectTransform=this.transform),o.intersect(s,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,u,d,p,m,y)=>{if(c>=0){if(this.filterPredicate!=null&&!this.filterPredicate(this._ray.origin,this._rayEnd,c))return;const _=p?this._results.hud:this._results,v=p?w=>{const x=new Kze(e,a,d,y);w.set(Ur.HUD,x,c,u,zr,m)}:w=>w.set(Ur.OBJECT,{object:e,geometryId:a,triangleNr:d},c,u,l,m);if((_.min.drapedLayerOrder==null||m>=_.min.drapedLayerOrder)&&(_.min.dist==null||c<_.min.dist)&&v(_.min),this.options.store!==ho.MIN&&(_.max.drapedLayerOrder==null||m<_.max.drapedLayerOrder)&&(_.max.dist==null||c>_.max.dist)&&v(_.max),this.options.store===ho.ALL)if(p){const w=new h7(this._ray);v(w),this._results.hud.all.push(w)}else{const w=new cT(this._ray);v(w),this._results.all.push(w)}}})}}sortResults(e=this._results.all){e.sort((i,r)=>i.dist!==r.dist?(i.dist??0)-(r.dist??0):i.drapedLayerOrder!==r.drapedLayerOrder?(i.drapedLayerOrder??Number.MAX_VALUE)-(r.drapedLayerOrder??Number.MAX_VALUE):(r.drapedLayerGraphicOrder??Number.MIN_VALUE)-(i.drapedLayerGraphicOrder??Number.MIN_VALUE))}};function _h(t){return new c9e(t)}let u9e=class{constructor(){this.min=new cT(_s()),this.max=new cT(_s()),this.hud={min:new h7(_s()),max:new h7(_s()),all:new Array},this.ground=new cT(_s()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}},cT=class{get ray(){return this._ray}get distanceInRenderSpace(){return this.dist!=null?(te(eM,this.ray.direction,this.dist),we(eM)):null}getIntersectionPoint(e){return!!ip(this)&&(te(eM,this.ray.direction,this.dist),ce(e,this.ray.origin,eM),!0)}getTransformedNormal(e){return se(CE,this.normal),CE[3]=0,Xc(CE,CE,this.transformation),se(e,CE),ge(e,e)}constructor(e){this.intersector=Ur.OBJECT,this.normal=C(),this.transformation=be(),this._ray=_s(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=Ur.OBJECT,fN(e,this._ray)}set(e,i,r,n,s,o,a){this.intersector=e,this.dist=r,se(this.normal,n??aq),Nn(this.transformation,s??zr),this.target=i,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(e){fN(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,se(this.normal,e.normal),Nn(this.transformation,e.transformation)}},h7=class extends cT{constructor(){super(...arguments),this.intersector=Ur.HUD}};function KW(t){return new cT(t)}const eM=C(),CE=Kt();function Vye(t,e,i,r){return t.renderCoordsHelper.fromRenderCoords(e.eye,xN,r)!=null&&Dpe(i,xN)}function wF(t,e){return t.elevationProvider?t.elevationProvider.getElevation(e[0],e[1],e[2],t.renderCoordsHelper.spatialReference,"ground")??0:0}function hw(t,e,i,r){const n=t.state.camera.clone();e&&i&&r&&(n.eye=e,n.center=i,n.up=r),h9e(t,n.ray,p0)||se(p0,n.center);const s=t.state.constraints,o=s.minimumPoiDistance;if(bs(n.eye,p0)<o){const a=s.collision.enabled;se(X_,n.viewForward),te(X_,X_,o),a?n.eye=he(xN,p0,X_):ce(p0,n.eye,X_);const l=t.renderCoordsHelper,c=l.getAltitude(n.eye),u=s.collision.elevationMargin;a&&c<u&&(he(X_,p0,n.eye),n.eye=l.setAltitude(xN,u,n.eye),ce(p0,n.eye,X_))}return n.center=p0,n}function Mee(t,e,i){if(!t.state.isGlobal||!t.stateManager.constraintsManager)return!1;const r=wF(t,e),n=t.stateManager.constraintsManager.nearFarHeuristic,{far:s}=n.compute(e,i,t.renderDataExtent,r,p9e),o=s*s;return bs(e,i)>o}function h9e(t,e,i){let r=$ee[t.viewingMode];r||(r=_h(t.state.viewingMode),r.options.backfacesTerrain=!t.state.isGlobal,r.options.invisibleTerrain=!0,$ee[t.viewingMode]=r);const{isGlobal:n}=t.state;return!(!t.sceneIntersectionHelper.intersectRay(e,r,i)||Mee(t,e.origin,i))||!(!t.renderCoordsHelper.intersectManifold(e,0,i)||Mee(t,e.origin,i))||!!n&&d9e(e,i,Fi(t.spatialReference).radius)}function d9e(t,e,i){const r=me(t.origin,t.origin)-i*i,n=r>0?Math.sqrt(r)/3:1;return te(e,t.direction,n/we(t.direction)),ce(e,e,t.origin),!0}const $ee={},xN=C(),p0=C(),X_=C(),p9e={near:0,far:0},f9e=C(),tM=C();function QW(){return{direction:C(),up:C()}}function Gye(t,e,i,r,n){let s=ge(f9e,t),o=me(s,r);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(me(e,r)),o<.99?(se(s,e),a&&te(s,s,-1)):s=null);let l=0;if(s){te(tM,r,me(r,s)),he(s,s,tM);const u=me(s,n)/(we(s)*we(n));nt(tM,s,n),l=(me(tM,r)>0?1:-1)*za(xs(u))}const c=za(xs(-me(r,t)/we(t)));return i?(i.heading=l,i.tilt=c,i):{heading:l,tilt:c}}const jye=Ce(0,1,0),Hye=Ce(0,0,1),AE=be(),sm=C(),om=C();function qye(t,e,i,r=QW()){const{direction:n,up:s}=r;return cpe(AE,-Rt(e)),NT(AE,AE,Rt(i)),Fe(n,Hye,AE),te(n,n,-1),Fe(s,jye,AE),r}function m9e(t,e,i,r){return Gye(e,i,r,Hye,jye)}function g9e(t,e,i,r){const n=qye(t,i,r),s=C();return te(s,n.direction,-e),ce(s,s,t),{up:n.up,eye:s,heading:i,tilt:r}}function y9e(t){return za(t)}function _9e(t){return Rt(t)}function Wye(t,e,i,r,n){const s=t.renderSpatialReference,o=t.map&&t.spatialReference||e.spatialReference;return lc(e,sm,s),lc(e,om,s),sm[0]-=i/2,om[0]+=i/2,sm[1]-=r/2,om[1]+=r/2,Do(sm,s,sm,o),Do(om,s,om,o),n?(n.xmin=sm[0],n.ymin=sm[1],n.xmax=om[0],n.ymax=om[1],n.spatialReference=o):n=new Xi(sm[0],sm[1],om[0],om[1],o),n}const v9e=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:m9e,eyeForCenterWithHeadingTilt:g9e,eyeTiltToLookAtTilt:_9e,headingTiltToDirectionUp:qye,lookAtTiltToEyeTilt:y9e,toExtent:Wye},Symbol.toStringTag,{value:"Module"}));function Iee(t,e,i){if(e.longitude==null||e.latitude==null||i.longitude==null||i.latitude==null)throw new Error("Invalid points: no lon/lat");return b9e(t,e.longitude,e.latitude,i.longitude,i.latitude)}function b9e(t,e,i,r,n){const s=Rt(i),o=Rt(n),a=s-o,l=Rt(e)-Rt(r),c=Math.sin(a/2),u=Math.sin(l/2),d=2*dh(Math.sqrt(c*c+Math.cos(s)*Math.cos(o)*u*u))*t;return Math.round(1e4*d)/1e4}function w9e(t,e,i){const r=e.spatialReference,n=Fi(r),s=new lt(e.x,t.y,r),o=new lt(i.x,t.y,r),a=new lt(t.x,e.y,r),l=new lt(t.x,i.y,r);return{lon:Iee(n.radius,s,o),lat:Iee(n.radius,a,l)}}function x9e(t,e,i){const r=e/i,n=Rt(t),s=Math.sin(r/2),o=Math.cos(n),a=2*dh(Math.sqrt(s*s/(o*o)));return za(a)}function T9e(t,e){let i=t/15;return e||(i=Math.round(i)),i}function Lee(t,e){const i=t?.[0];if(i==null)return null;e||(e={hours:0,minutes:0,seconds:0}),e.hours=T9e(i,!0);const r=e.hours%1;e.hours-=r,e.minutes=60*r;const n=e.minutes%1;return e.minutes-=n,e.seconds=Math.round(60*n),e}const Yye=Ce(0,0,1),Xye=ge(C(),Ce(1,1,1)),S9e=new t_(-180,180),OE=be(),my=C(),kw=C();function Zye(t,e,i,r=QW()){nt(my,t,Yye),me(my,my)===0&&nt(my,t,Xye),hu(OE,-Rt(e),t),Jl(OE,OE,-Rt(i),my);const{up:n,direction:s}=r;return nt(n,my,t),ge(n,n),Fe(n,n,OE),ge(s,t),na(s,s),Fe(s,s,OE),r}function E9e(t,e,i,r){const n=my,s=kw;return ge(n,t),nt(kw,n,Yye),me(kw,kw)===0&&nt(kw,n,Xye),nt(s,kw,n),Gye(e,i,r,n,s)}function C9e(t,e,i,r){const n={eye:C(),up:null,tilt:r,heading:i},s=my;s[0]=t[0],s[1]=t[2],s[2]=-t[1];const o=e,a=Rt(i),l=Rt(r),c=Math.sin(a),u=Math.cos(a),d=Math.sin(l),p=Math.cos(l),m=we(s);let y;if(Math.abs(l)<1e-8)y=o+m;else{const X=m/d,M=dh(o/X),I=Math.PI-l-M;y=X*Math.sin(I)}const _=p*o,v=o*o*(d*d),w=u*u*v,x=y-_,T=x*x,S=w*(w+T-s[1]*s[1]);if(S<0)return te(n.eye,s,y/m),n.tilt=0,iM(n,t);const E=Math.sqrt(S),A=s[1]*x,P=w+T;let N;if(N=u>0?-E+A:E+A,Math.abs(P)<1e-8)return m<1e-8?(n.eye[0]=0,n.eye[1]=0,n.eye[2]=o):te(n.eye,s,y/m),n.tilt=0,I6(n.eye),iM(n,t);n.eye[1]=N/P;const F=c*c*v,D=d*o,$=u*D*n.eye[1],R=n.eye[1]*n.eye[1],k=1-R,B=Math.sqrt(k),j=w*R+F-2*$*B*x+k*T;return Math.abs(j)<1e-8?(te(n.eye,s,y/m),n.tilt=0,I6(n.eye),iM(n,t)):(n.eye[0]=(k*(y*s[0]-_*s[0])-D*B*(s[0]*n.eye[1]*u+s[2]*c))/j,n.eye[2]=(k*(y*s[2]-_*s[2])-D*B*(s[2]*n.eye[1]*u-s[0]*c))/j,te(n.eye,n.eye,y),I6(n.eye),iM(n,t))}function I6(t){const e=t[1];t[1]=-t[2],t[2]=e}function iM(t,e){const i=Zye(e,t.heading,t.tilt);return t.up=i.up,t}function A9e(t,e,i){const r=we(e),n=Math.sqrt(i*i+r*r-2*i*r*Math.cos(Math.PI-t)),s=dh(i/(n/Math.sin(t)));return za(t-s)}function O9e(t,e,i){const r=Rt(t),n=we(e);return dh(i/(n/Math.sin(r)))+r}function Jye(t,e,i,r,n){let s,o,a,l;const c=e.latitude,u=Fi(t.spatialReference).radius,d=e.longitude,p=x9e(c,i,u)/2;s=d-p,o=d+p;const m=Rt(c),y=(1+Math.sin(m))/(1-Math.sin(m)),_=(y+1)*Math.tan(r/u/2),v=_*_;function w(T){const S=Math.PI/2;return(T=PDe.normalize(T,-S))>S&&(T=Math.PI-T),T}if(a=1.5*Math.PI-2*Math.atan(.5*(_+Math.sqrt(4*y+v))),l=a+r/u,a=w(a),l=w(l),l<a){const T=l;l=a,a=T}if(a=Math.max(za(a),-90),l=Math.min(za(l),90),o=S9e.monotonic(s,o),o-s>180){const T=(o-s-180)/2;s+=T,o-=T}const x=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:je.WGS84;return n?(n.xmin=s,n.ymin=a,n.xmax=o,n.ymax=l,n.spatialReference=x):n=new Xi(s,a,o,l,x),t.spatialReference&&t.spatialReference.isWebMercator&&Gy(n,!1,n),n}const R9e=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:E9e,eyeForCenterWithHeadingTilt:C9e,eyeTiltToLookAtTilt:O9e,headingTiltToDirectionUp:Zye,lookAtTiltToEyeTilt:A9e,toExtent:Jye},Symbol.toStringTag,{value:"Module"}));function TN(t){return t.type==="point"}let eY=class{constructor(e,i=null,r=0){this.array=e,this.spatialReference=i,this.offset=r}};function Kye(t){return"array"in t}function pf(t,e,i="ground"){if(TN(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,i);if(Kye(e)){let r=e.offset;return t.getElevation(e.array[r++],e.array[r++],e.array[r]||0,e.spatialReference??t.spatialReference,i)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,i)}const Qye=ne.getLogger("esri.views.3d.support.cameraUtils"),e_e=39.37,t_e=96,d7=1,P9e=8,M9e=5,i_e=1,Dee=C(),$9e={heading:0,tilt:0},r3=C(),I9e=new t_(-20037508342788905e-9,20037508342788905e-9),L9e=new t_(-180,180);var $o;function zg(t){return t.spatialReference??je.WGS84}function GS(t){return t.viewingMode==="global"?R9e:v9e}function D9e(t,e,i,r,n){return GS(t).headingTiltToDirectionUp(e,i,r,n)}function Vm(t,e){if(e==null)return null;const i=t.renderSpatialReference,r=GS(t).headingTiltToDirectionUp,n=C();if(!lc(e.position,n,i))return null;const s=r(n,e.heading,e.tilt);te(s.direction,s.direction,t.state.camera.distance),ce(s.direction,s.direction,n);const o=hw(t,n,s.direction,s.up);return o.fov=Rt(e.fov),o}(function(t){t[t.LOCKED=0]="LOCKED",t[t.ADJUST=1]="ADJUST"})($o||($o={}));const Uw=C();function nS(t,e,i){const r=t.renderSpatialReference,n=TF(t,e.eye,e.viewForward,e.up,$9e);let s=zg(t);return Do(e.eye,r,Uw,s)||(s=je.WGS84,Do(e.eye,r,Uw,s)),i==null?new du(new lt(Uw,s),n.heading,n.tilt,za(e.fov)):(i.position.x=Uw[0],i.position.y=Uw[1],i.position.z=Uw[2],i.position.spatialReference=s,i.heading=n.heading,i.tilt=n.tilt,i.fov=za(e.fov),i)}function xF(t,e,i){const r=t.state.camera,n=r.width/2/r.pixelRatio;return t.renderCoordsHelper.viewingMode===Me.Global&&i!=null&&(e*=Math.cos(Rt(i))),e/=t.renderCoordsHelper.unitInMeters,n/(t_e*e_e/e)/Math.tan(r.fovX/2)}function Nb(t,e,i){const r=t.state.camera,n=e*Math.tan(r.fovX/2),s=r.width/2/r.pixelRatio;let o=t_e*e_e/(s/n);return t.renderCoordsHelper.viewingMode===Me.Global&&i!=null&&(o/=Math.cos(Rt(i))),o*t.renderCoordsHelper.unitInMeters}async function r_e(t,e,i,r,n,s){return n_e(t,e,xF(t,i,e.latitude),r,n,s)}function N9e(t,e,i,r,n,s){return __e(t,tY(t,r.heading,r.tilt,e,i,n),r.fov,s)}async function n_e(t,e,i,r,n,s){const o=await o_e(t,r.heading,r.tilt,e,i,n,s);return Et(s),v_e(t,o,r.fov,s)}function TF(t,e,i,r,n){return GS(t).directionToHeadingTilt(e,i,r,n)}function s_e(t,e){return!!(t.basemapTerrain&&t.renderCoordsHelper.fromRenderCoords(e,r3,t.spatialReference)&&t.elevationProvider&&(pf(t.elevationProvider,r3)??0)>r3[2]-i_e)}async function F9e(t,e,i){if(s_e(t,e))return!0;const{elevationProvider:r,spatialReference:n,renderCoordsHelper:s}=t;if(r==null||!s.fromRenderCoords(e,r3,n))return!1;const[o,a,l]=r3,c=await r.queryElevation(o,a,l,n,"ground",i)??0;return Et(i),c>l-i_e}async function k9e(t,e,i){const r=C();if(e==null)return se(r,t.state.camera.center);if(e instanceof lt){const{renderSpatialReference:n,basemapTerrain:s,elevationProvider:o}=t,a=e.spatialReference;if(await vN(e,r,n,0,{signal:i}),Et(i),e.z==null&&s!=null&&o!=null){const l=await o.queryElevation(e.x,e.y,e.z??0,a,"ground",i);Et(i),l!=null&&t.renderCoordsHelper.setAltitude(r,l)}return r}return se(r,e)}function U9e(t,e){const i=C();if(e==null)return se(i,t.state.camera.center);if(e instanceof lt){if(!lc(e,i,t.renderSpatialReference))return null;const{basemapTerrain:r,elevationProvider:n}=t;if(e.z==null&&r!=null&&n!=null){const s=pf(n,e);s!=null&&t.renderCoordsHelper.setAltitude(i,s)}return i}return se(i,e)}function tY(t,e,i,r,n,s){return a_e(t,e,i,r instanceof lt?r:null,U9e(t,r),n,s)}async function o_e(t,e,i,r,n,s,o){const a=r instanceof lt?r:null,l=await k9e(t,r,o);return Et(o),l_e(t,e,i,a,l,n,s,o)}function a_e(t,e,i,r,n,s,o){if(n==null||(r??(r=Cg(n,t.renderSpatialReference,zg(t))),r==null))return null;const a=c_e(t,e,i,n,s,o);if(u_e(t,i,o)&&s_e(t,a.eye)){const{tilt:l,mode:c}=h_e(t,i,n,s);return a_e(t,e,l,r,n,s,c)}return d_e(a,n)}async function l_e(t,e,i,r,n,s,o,a){r??(r=await Aye(n,t.renderSpatialReference,zg(t),{signal:a})),Et(a);const l=c_e(t,e,i,n,s,o);if(u_e(t,i,o)&&await F9e(t,l.eye,a)){Et(a);const{tilt:c,mode:u}=h_e(t,i,n,s);return l_e(t,e,c,r,n,s,u,a)}return d_e(l,n)}function c_e(t,e,i,r,n,s){const o=B9e(t,e,i,r,n=Math.max(n,t.state.constraints.minimumPoiDistance),s);return(0,GS(t).eyeForCenterWithHeadingTilt)(r,n,o.heading,o.tilt)}function u_e(t,e,i){const r=t.map.ground.navigationConstraint;return i===$o.ADJUST&&t.viewingMode==="global"&&e>0&&(r==null||r.type==="stay-above")}function h_e(t,e,i,r){const n=y_e(t,i,r,G9e(t,r,e,i));return{tilt:n,mode:e-n<1?$o.LOCKED:$o.ADJUST}}function d_e(t,e){return{...t,center:Br(e)}}function p_e(t,e){const{state:i,spatialReference:r}=t,n=e.spatialReference;return i.isGlobal&&tO(n,Me.Global)||i.isLocal&&r.equals(n)}function f_e(t,e){let i,r,n;if(t.state.isGlobal){const u=new lt(e.xmin,e.ymin,e.spatialReference),d=new lt(e.xmax,e.ymax,e.spatialReference),p=e.spatialReference.isGeographic?L9e:I9e;i=new lt({x:p.center(u.x,d.x),y:(d.y+u.y)/2,z:e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0,spatialReference:e.spatialReference});const m=Fi(e.spatialReference),y=w9e(i,u,d);r=y.lon,n=y.lat,p.diff(u.x,d.x)>p.range/2&&(r+=m.halfCircumference),r=Math.min(r,m.halfCircumference),n=Math.min(n,m.halfCircumference)}else{const u=t.renderSpatialReference??e.spatialReference;u.equals(e.spatialReference)||(e=Hf(e,u)),r=e.xmax-e.xmin,n=e.ymax-e.ymin;const d=e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0;i=new lt({x:e.xmin+.5*r,y:e.ymin+.5*n,z:d,spatialReference:u})}const s=e.zmax!=null&&e.zmin!=null?e.zmax-e.zmin:0,o=t.state.camera,a=1/Math.tan(o.fovX/2),l=1/Math.tan(o.fovY/2),c=1/Math.tan(o.fov/2);return{center:i,distance:Math.max(.5*r*a,.5*n*l,.5*s*c)/d7}}async function m_e(t,e,i,r,n,s){const o=p_e(t,e)?e:await $f(e,t.spatialReference,{signal:s});Et(s);const{center:a,distance:l}=f_e(t,o),c=await o_e(t,i,r,a,l,n,s);return Et(s),v_e(t,c,t.camera.fov,s)}function hL(t,e,i,r,n,s){let o;try{o=p_e(t,e)?e:Hf(e,t.spatialReference)}catch{return null}const{center:a,distance:l}=f_e(t,o),c=tY(t,i,r,a,l,n);return c==null?null:__e(t,c,t.camera.fov,s)}function g_e(t,e,i){const r=t.renderSpatialReference,n=Cg(i,r,zg(t));if(n==null)return null;const s=Math.tan(e.fovX/2),o=Math.tan(e.fovY/2),a=aR(e.eye,i),l=2*a*s*d7,c=2*a*o*d7;return t.viewingMode==="global"?Jye(t,n,l,c):Wye(t,n,l,c)}function z9e(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(i/r)/Math.LN2>P9e)return!0;const n=t.renderSpatialReference,s=zg(t),o=Cg(e,n,s),a=Cg(t.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n,s);if(o==null||a==null)return!1;const l=Math.tan(.5*t.state.camera.fov)*r;return a.distance(o)/l>M9e}function B9e(t,e,i,r,n,s){let o=0;return s===$o.ADJUST&&z9e(t,r,n)?(e=0,o=V9e(t,n,i,r)):o=iY(t,r,n,i),o=t.state.constraints.clampTilt(n,o),{heading:e,tilt:i=y_e(t,r,n,o)}}const SN=.7;function V9e(t,e,i,r){const n=iY(t,r,e,i);if(!t.state.constraints.tilt)return n;const s=t.state.constraints.tilt(e);s.max=Math.min(s.max,.5*Math.PI);const o=s.min*(1-SN)+s.max*SN;return Math.min(n,o)}function G9e(t,e,i,r){let n=iY(t,r,e,i);if(!t.state.constraints.tilt)return n;const s=t.state.constraints.tilt(e);return n=Math.min(n,.5*Math.PI),s.min*(1-SN)+n*SN}function y_e(t,e,i,r){return GS(t).lookAtTiltToEyeTilt(r,e,i)}function iY(t,e,i,r){return GS(t).eyeTiltToLookAtTilt(r,e,i)}function __e(t,e,i,r){if(e==null)return null;const n=t.renderSpatialReference,s=Cg(e.eye,n,zg(t));return s==null?null:(r??(r=new du),r.position=s,r.heading=e.heading,r.tilt=e.tilt,r.fov=i,r)}async function v_e(t,e,i,r){const n=t.renderSpatialReference,s=await Aye(e.eye,n,zg(t),{signal:r});return Et(r),new du(s,e.heading,e.tilt,i)}function j9e(t,e){const i=t.basemapTerrain?.tilingScheme;if(i)return i.levelAtScale(e);Qye.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function b_e(t,e){const i=t.basemapTerrain?.tilingScheme;if(i)return i.scaleAtLevel(e);Qye.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function w_e(t,e){return Do(e.center,t.renderSpatialReference,Dee,je.WGS84),Nb(t,e.distance,Dee[1])}const rY=ne.getLogger("esri.layers.support.ElevationSampler");let x_e=class{queryElevation(e){return T_e(e.clone(),this)}on(){return Mi()}projectIfRequired(e,i){return S_e(e,i)}},H9e=class extends x_e{get spatialReference(){return this.extent.spatialReference}constructor(e,i,r){super(),this.tile=e,this.noDataValue=r;const n=e.tile.extent;this.extent=N4(n,i.spatialReference),this.extent.zmin=e.zmin,this.extent.zmax=e.zmax,this._aaExtent=n;const s=ua(i.spatialReference),o=i.lodAt(e.tile.level).resolution*s;this.demResolution={min:o,max:o}}contains(e){const i=this.projectIfRequired(e,this.spatialReference);return i!=null&&this.containsAt(i.x,i.y)}containsAt(e,i){return F4(this._aaExtent,e,i)}elevationAt(e,i){if(!this.containsAt(e,i)){const r=this.extent,n=`${r.xmin}, ${r.ymin}, ${r.xmax}, ${r.ymax}`;return rY.warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler extent (${n})`),this.noDataValue}return this.tile.sample(e,i)??this.noDataValue}},iOt=class extends x_e{get spatialReference(){return this.extent.spatialReference}constructor(e,i,r){let n;super(),typeof i=="number"?(this.noDataValue=i,n=null):(n=i,this.noDataValue=r),this.samplers=n?e.map(o=>new H9e(o,n,this.noDataValue)):e;const s=this.samplers[0];if(s){this.extent=s.extent.clone();const{min:o,max:a}=s.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=N4(Gt(),n.spatialReference),this.demResolution={min:0,max:0}}elevationAt(e,i){for(const r of this.samplers)if(r.containsAt(e,i))return r.elevationAt(e,i);return rY.warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler`),this.noDataValue}};function T_e(t,e){const i=S_e(t,e.spatialReference);if(!i)return null;switch(t.type){case"point":q9e(t,i,e);break;case"polyline":W9e(t,i,e);break;case"multipoint":Y9e(t,i,e)}return t}function S_e(t,e){if(t==null)return null;const i=t.spatialReference;if(i.equals(e))return t;const r=sR(t,e);return r||rY.error(`Cannot project geometry spatial reference (wkid:${i.wkid}) to elevation sampler spatial reference (wkid:${e.wkid})`),r}function q9e(t,e,i){t.z=i.elevationAt(e.x,e.y)}function W9e(t,e,i){af.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let n=0;n<t.paths.length;n++){const s=t.paths[n],o=e.paths[n];for(let a=0;a<s.length;a++){const l=s[a],c=o[a];af.x=c[0],af.y=c[1],r&&(l[3]=l[2]),l[2]=i.elevationAt(af.x,af.y)}}t.hasZ=!0}function Y9e(t,e,i){af.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let n=0;n<t.points.length;n++){const s=t.points[n],o=e.points[n];af.x=o[0],af.y=o[1],r&&(s[3]=s[2]),s[2]=i.elevationAt(af.x,af.y)}t.hasZ=!0}const af=new lt;var p7;let Bp=p7=class extends $e{constructor(t){super(t),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new p7({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};h([f({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Bp.prototype,"cols",void 0),h([f({type:Ln,json:{write:!0}})],Bp.prototype,"level",void 0),h([f({type:String,json:{write:!0}})],Bp.prototype,"levelValue",void 0),h([f({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Bp.prototype,"origin",void 0),h([f({type:Number,json:{write:!0}})],Bp.prototype,"resolution",void 0),h([f({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Bp.prototype,"rows",void 0),h([f({type:Number,json:{write:!0}})],Bp.prototype,"scale",void 0),Bp=p7=h([z("esri.layers.support.LOD")],Bp);const wd=Bp;let X9e=class{constructor(e,i,r,n,s=void 0){this.id=e,this.level=i,this.row=r,this.col=n,this.extent=s}};var ey;const Nee=new uu({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let Vo=ey=class extends $e{static create(t={}){const{resolutionFactor:e=1,scales:i,size:r=256,spatialReference:n=je.WebMercator,numLODs:s=24}=t;if(!ta(n)){const d=[];if(i)for(let p=0;p<i.length;p++){const m=i[p];d.push(new wd({level:p,scale:m,resolution:m}))}else{let p=5e-4;for(let m=s-1;m>=0;m--)d.unshift(new wd({level:m,scale:p,resolution:p})),p*=2}return new ey({dpi:96,lods:d,origin:new lt(0,0,n),size:[r,r],spatialReference:n})}const o=Fd(n),a=t.origin?new lt({x:t.origin.x,y:t.origin.y,spatialReference:n}):new lt(o?{x:o.origin[0],y:o.origin[1],spatialReference:n}:{x:0,y:0,spatialReference:n}),l=96,c=1/(ua(n)*39.37*l),u=[];if(i)for(let d=0;d<i.length;d++){const p=i[d],m=p*c;u.push(new wd({level:d,scale:p,resolution:m}))}else{let d=XH(n)?512/r*5916575275917094e-7:256/r*591657527591555e-6;const p=Math.ceil(s/e);u.push(new wd({level:0,scale:d,resolution:d*c}));for(let m=1;m<p;m++){const y=d/2**e,_=y*c;u.push(new wd({level:m,scale:y,resolution:_})),d=y}}return new ey({dpi:l,lods:u,origin:a,size:[r,r],spatialReference:n})}constructor(t){super(t),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:t,origin:e}=this;if(t&&e){const i=Fd(t);return t.isWrappable&&!!i&&Math.abs(i.origin[0]-e.x)<=i.dx}return!1}readOrigin(t,e){return lt.fromJSON({spatialReference:e.spatialReference,...t})}set lods(t){let e=0,i=0;const r=[],n=this._levelToLOD={};t&&(e=-1/0,i=1/0,t.forEach(s=>{r.push(s.scale),e=s.scale>e?s.scale:e,i=s.scale<i?s.scale:i,n[s.level]=s})),this._set("scales",r),this._set("lods",t),this._initializeUpsampleLevels()}readSize(t,e){return[e.cols,e.rows]}writeSize(t,e){e.cols=t[0],e.rows=t[1]}zoomToScale(t){const e=this.scales;if(t<=0)return e[0];if(t>=e.length-1)return e[e.length-1];const i=Math.floor(t),r=i+1;return e[i]/(e[i]/e[r])**(t-i)}scaleToZoom(t){const e=this.scales,i=e.length-1;let r=0;for(;r<i;r++){const n=e[r],s=e[r+1];if(n<=t)return r;if(s===t)return r+1;if(n>t&&s<t)return r+Math.log(n/t)/Math.log(n/s)}return r}snapScale(t,e=.95){const i=this.scaleToZoom(t);return i%Math.floor(i)>=e?this.zoomToScale(Math.ceil(i)):this.zoomToScale(Math.floor(i))}tileAt(t,e,i,r){const n=this.lodAt(t);if(!n)return null;let s,o;if(typeof e=="number")s=e,o=i;else if(wn(e.spatialReference,this.spatialReference))s=e.x,o=e.y,r=i;else{const c=sR(e,this.spatialReference);if(c==null)return null;s=c.x,o=c.y,r=i}const a=n.resolution*this.size[0],l=n.resolution*this.size[1];return r||(r=new X9e(null,0,0,0,Gt())),r.level=t,r.row=Math.floor((this.origin.y-o)/l+.001),r.col=Math.floor((s-this.origin.x)/a+.001),this.updateTileInfo(r),r}updateTileInfo(t,e=ey.ExtrapolateOptions.NONE){let i=this.lodAt(t.level);if(!i&&e===ey.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<t.level&&(i=o)}if(!i)return;const r=t.level-i.level,n=i.resolution*this.size[0]/2**r,s=i.resolution*this.size[1]/2**r;t.id=`${t.level}/${t.row}/${t.col}`,t.extent||(t.extent=Gt()),t.extent[0]=this.origin.x+t.col*n,t.extent[1]=this.origin.y-(t.row+1)*s,t.extent[2]=t.extent[0]+n,t.extent[3]=t.extent[1]+s}upsampleTile(t){const e=this._upsampleLevels[t.level];return!(!e||e.parentLevel===-1)&&(t.level=e.parentLevel,t.row=Math.floor(t.row/e.factor+.001),t.col=Math.floor(t.col/e.factor+.001),this.updateTileInfo(t),!0)}getTileBounds(t,e){const i=this.lodAt(e.level);if(i==null)return null;const{resolution:r}=i,n=r*this.size[0],s=r*this.size[1];return t[0]=this.origin.x+e.col*n,t[1]=this.origin.y-(e.row+1)*s,t[2]=t[0]+n,t[3]=t[1]+s,t}lodAt(t){return this._levelToLOD?.[t]??null}clone(){return ey.fromJSON(this.write({}))}getOrCreateCompatible(t,e){if(this.size[0]===256&&this.size[1]===256)return t===256?this:null;const i=[],r=this.lods.length;for(let n=0;n<r;n++){const s=this.lods[n],o=s.resolution*e;i.push(new wd({level:s.level,scale:s.scale,resolution:o}))}return new ey({size:[t,t],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:i})}_initializeUpsampleLevels(){const t=this.lods;this._upsampleLevels=[];let e=null;for(let i=0;i<t.length;i++){const r=t[i];this._upsampleLevels[r.level]={parentLevel:e?e.level:-1,factor:e?e.resolution/r.resolution:0},e=r}}};h([f({type:Number,json:{write:!0}})],Vo.prototype,"compressionQuality",void 0),h([f({type:Number,json:{write:!0}})],Vo.prototype,"dpi",void 0),h([f({type:String,json:{read:Nee.read,write:Nee.write,origins:{"web-scene":{read:!1,write:!1}}}})],Vo.prototype,"format",void 0),h([f({readOnly:!0})],Vo.prototype,"isWrappable",null),h([f({type:lt,json:{write:!0}})],Vo.prototype,"origin",void 0),h([Ni("origin")],Vo.prototype,"readOrigin",null),h([f({type:[wd],value:null,json:{write:!0}})],Vo.prototype,"lods",null),h([f({readOnly:!0})],Vo.prototype,"scales",void 0),h([f({cast:t=>Array.isArray(t)?t:typeof t=="number"?[t,t]:[256,256]})],Vo.prototype,"size",void 0),h([Ni("size",["rows","cols"])],Vo.prototype,"readSize",null),h([di("size",{cols:{type:Ln},rows:{type:Ln}})],Vo.prototype,"writeSize",null),h([f({type:je,json:{write:!0}})],Vo.prototype,"spatialReference",void 0),Vo=ey=h([z("esri.layers.support.TileInfo")],Vo),function(t){var e;(e=t.ExtrapolateOptions||(t.ExtrapolateOptions={}))[e.NONE=0]="NONE",e[e.POWER_OF_TWO=1]="POWER_OF_TWO"}(Vo||(Vo={}));const dL=Vo,Z9e=12;let ql=class tl{constructor(e){const i=tl.checkUnsupported(e);if(i!=null)throw i;const r=e;this.spatialReference=r.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=n_(this.spatialReference)||Vf(this.spatialReference)||Gf(this.spatialReference),this.origin=[r.origin.x,r.origin.y],this.pixelSize=r.size[0],this.dpi=r.dpi;const n=r.lods.reduce((c,u,d)=>(u.level<c.min&&(c.min=u.level,c.minIndex=d),c.max=Math.max(c.max,u.level),c),{min:1/0,minIndex:0,max:-1/0}),s=r.lods[n.minIndex],o=2**s.level;let a=s.resolution*o,l=s.scale*o;this.levels=new Array(n.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*r.size[0],a*r.size[1]]},a/=2,l/=2}clone(){return new tl(this.toTileInfo())}toTileInfo(){return new dL({dpi:this.dpi,origin:new lt({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,i)=>new wd({level:i,scale:e.scale,resolution:e.resolution}))})}getExtent(e,i,r,n){const s=this.levels[e],o=s.tileSize[0],a=s.tileSize[1];n[0]=this.origin[0]+r*o,n[2]=this.origin[0]+(r+1)*o,n[3]=this.origin[1]-i*a,n[1]=this.origin[1]-(i+1)*a}convertExtentToRadians(e,i){this._isWebMercator?(i[0]=rK(e[0]),i[1]=kD(e[1]),i[2]=rK(e[2]),i[3]=kD(e[3])):this._isGCS&&(i[0]=Rt(e[0]),i[1]=Rt(e[1]),i[2]=Rt(e[2]),i[3]=Rt(e[3]))}getExtentGeometry(e,i,r,n=new Xi){return this.getExtent(e,i,r,dp),n.spatialReference=this.spatialReference,n.xmin=dp[0],n.ymin=dp[1],n.xmax=dp[2],n.ymax=dp[3],n.zmin=void 0,n.zmax=void 0,n}ensureMaxLod(e){if(e==null)return!1;let i=!1;for(;this.levels.length<=e;){const r=this.levels[this.levels.length-1],n=r.resolution/2;this.levels.push({resolution:n,scale:r.scale/2,tileSize:[n*this.pixelSize,n*this.pixelSize]}),i=!0}return i}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const i=this.levels[0].scale;return e>=i?0:Math.log(i/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e){if(!(e instanceof tl)){if(tl.checkUnsupported(e))return!1;e=new tl(e)}if(!e.spatialReference.equals(this.spatialReference)||e.pixelSize!==this.pixelSize)return!1;const i=Math.min(this.levels.length,e.levels.length)-1,r=this.levels[i].resolution;let n=.5*r;return!jy(e.origin[0],this.origin[0],n)||!jy(e.origin[1],this.origin[1],n)?!1:(n=.5*r/2**i/this.pixelSize*Z9e,jy(r,e.levels[i].resolution,n))}rootTilesInExtent(e,i=null,r=1/0){const n=new Array,s=this.levels[0].tileSize;if(e==null||s[0]===0||s[1]===0)return n;tl.computeRowColExtent(e,s,this.origin,dp);let o=dp[1],a=dp[3],l=dp[0],c=dp[2];const u=c-l,d=a-o;if(u*d>r){const p=Math.floor(Math.sqrt(r));d>p&&(o=o+Math.floor(.5*d)-Math.floor(.5*p),a=o+p),u>p&&(l=l+Math.floor(.5*u)-Math.floor(.5*p),c=l+p)}for(let p=o;p<a;p++)for(let m=l;m<c;m++)n.push([0,p,m]);return i!=null&&(i[0]=this.origin[0]+l*s[0],i[1]=this.origin[1]-a*s[1],i[2]=this.origin[0]+c*s[0],i[3]=this.origin[1]-o*s[1]),n}static computeRowColExtent(e,i,r,n){const s=.001*(e[2]-e[0]+(e[3]-e[1]));n[0]=Math.max(0,Math.floor((e[0]+s-r[0])/i[0])),n[2]=Math.max(0,Math.ceil((e[2]-s-r[0])/i[0])),n[1]=Math.max(0,Math.floor((r[1]-e[3]+s)/i[1])),n[3]=Math.max(0,Math.ceil((r[1]-e[1]-s)/i[1]))}static isPowerOfTwo(e){const i=e.lods,r=i[0].resolution*2**i[0].level;return!i.some(n=>!KIe(n.resolution,r/2**n.level))}static hasGapInLevels(e){const i=e.lods.map(r=>r.level);i.sort((r,n)=>r-n);for(let r=1;r<i.length;r++)if(i[r]!==i[0]+r)return!0;return!1}static tileSizeSupported(e){const i=e.size[1];return i===e.size[0]&&(i&i-1)==0&&i>=128&&i<=512}static hasOriginPerLODs(e){const i=e.origin;return e.lods.some(r=>r.origin!=null&&(r.origin[0]!==i.x||r.origin[1]!==i.y))}static getMissingTileInfoError(){return new W("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return e==null?nY():e.lods.length<1?new W("tilingscheme:generic","Tiling scheme must have at least one level"):tl.isPowerOfTwo(e)?tl.hasGapInLevels(e)?new W("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):tl.tileSizeSupported(e)?tl.hasOriginPerLODs(e)?new W("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new W("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new W("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,i){const r=e[2]-e[0],n=e[3]-e[1],s=ua(i),o=1.2*Math.max(r,n),a=256,l=96,c=.0254,u=new tl(new dL({size:[a,a],origin:new lt({x:e[0]-.5*(o-r),y:e[3]+.5*(o-n)}),lods:[new wd({level:0,resolution:o/a,scale:1/(a/l*c/(o*s))})],spatialReference:i}));return u.ensureMaxLod(20),u}static makeWebMercatorAuxiliarySphere(e){const i=new tl(tl.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(e),i}static makeGCSWithTileSize(e,i=256,r=16){const n=256/i,s=new tl(new dL({size:[i,i],origin:new lt({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new wd({level:0,resolution:.703125*n,scale:295497598570834e-6*n})]}));return s.ensureMaxLod(r),s}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}};function nY(){return new W("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}ql.WebMercatorAuxiliarySphereTileInfo=new dL({size:[256,256],origin:new lt({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:je.WebMercator}),spatialReference:je.WebMercator,lods:[new wd({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),ql.WebMercatorAuxiliarySphere=ql.makeWebMercatorAuxiliarySphere(19);const dp=Gt(),z2=64,KC=512,J9e=2.5,hO=QIe(zB/10),E_e=2,C_e=Gt();ql.WebMercatorAuxiliarySphere.getExtent(0,0,0,C_e);const K9e=Gt([-180,-90,180,90]),Q9e="Cannot extend surface to encompass all layers because it would result in too many root tiles.",eVe="Surface extent is too large for tile resolution at level 0.",tVe=3;let iVe=tVe;function f7(t){return t<4?3:iVe}let ty=class extends Tn.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=hO}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(e?.extent==null||e.spatialReference==null)return null;const i=N4(e.extent,e.spatialReference);return i.zmin=e.visibleElevationBounds.min,i.zmax=e.visibleElevationBounds.max,i}get spatialReference(){return this.view.basemapTerrain?.spatialReference??je.WGS84}elevationAt(e,i){if(this.extent==null||!Aa(this.extent,e,i)){const r=this.extent!=null?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return ne.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler extent (${r})`),this.noDataValue}return this.view.elevationProvider?.getElevation(e,i,0,this.spatialReference,"ground")??this.noDataValue}queryElevation(e){return T_e(e.clone(),this)}};h([f({readOnly:!0})],ty.prototype,"demResolution",void 0),h([f({readOnly:!0})],ty.prototype,"extent",null),h([f({readOnly:!0})],ty.prototype,"noDataValue",void 0),h([f()],ty.prototype,"spatialReference",null),h([f({constructOnly:!0})],ty.prototype,"view",void 0),ty=h([z("esri.views.support.GroundViewElevationSampler")],ty);const rVe=ty;let $m=class extends xe{constructor(e){super(e),this.view=null,this.layerViews=new ft}initialize(){this.addHandles(ac(()=>this.view?.map?.ground,e=>e.load())),this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null);for(const e of this.layerViews)e.destroy();this.layerViews.length=0}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new rVe({view:this.view}):null:null}get extent(){const e=this.view;return e&&e.type!=="2d"&&e.ready?g_e(e,e.state.camera,e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation):null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.removeHandles("updating"),this.addHandles(this.layerViews.map(e=>le(()=>e.updating,()=>this._updateUpdating(),qi)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};h([f({readOnly:!0})],$m.prototype,"elevationSampler",null),h([f({readOnly:!0})],$m.prototype,"extent",null),h([f({type:Boolean,readOnly:!0})],$m.prototype,"updating",null),h([f({constructOnly:!0})],$m.prototype,"view",void 0),h([f({type:ft,readOnly:!0})],$m.prototype,"layerViews",void 0),h([f({readOnly:!0})],$m.prototype,"suspended",null),$m=h([z("esri.views.GroundView")],$m);const nVe=$m;let Og=class{constructor(e,i){this._owner=i,this._properties={},this._afterDispatchHandle=null;for(const r in e){const n=e[r],s=new lhe(n,void 0,void 0,2,2);this._properties[r]={pool:s,acquired:[]}}this._afterDispatchHandle=vhe(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const i=this._properties[e];for(const r of i.acquired)NJ(r)||i.pool.release(r);i.pool.destroy(),i.pool=null,i.acquired=null}this._properties=null,this._owner=null}get(e){const i=this._owner._get(e),r=this._properties[e];let n=r.pool.acquire();for(r.acquired.push(n);n===i;)r.acquired.push(n),n=r.pool.acquire();return n}_release(){for(const e in this._properties){const i=this._properties[e];let r=0;for(const n of i.acquired)NJ(n)?i.acquired[r++]=n:i.pool.release(n);i.acquired.length=r}}};const sVe=ie("mac")?"Meta":"Ctrl",SF={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let t=48;t<58;t++)SF[t]=String.fromCharCode(t);for(let t=1;t<25;t++)SF[111+t]=`F${t}`;for(let t=65;t<91;t++)SF[t]=[String.fromCharCode(t+32),String.fromCharCode(t)];function oVe(t){if(t.key!==void 0)return pRe(t);const e=SF[t.keyCode];return Array.isArray(e)?t.shiftKey?e[1]:e[0]:e}function aVe(t){switch(t){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}let lVe=class{constructor(e,i=[]){this.eventType=e,this.keyModifiers=i}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const i=e.modifiers;for(const r of this.keyModifiers)if(!i.has(r))return!1;return!0}};const Fee=ne.getLogger("esri.views.input.InputHandler");let go=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const i=this._incoming[e];for(const r of i)this._incomingEventMatches.push(r.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?Fee.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback(i=>this._handleEvent(i)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,i,r){let n;typeof i=="function"?(r=i,n=[]):n=i||[];const s=typeof e=="string"?new lVe(e,n):e,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=u=>{const d=this._incoming[u.match.eventType];if(d){const p=d.indexOf(u);d.splice(p,1),o(),this._manager&&this._manager.updateDependencies()}},l=new cVe(s,r,{onPause:a,onRemove:a,onResume:u=>{const d=this._incoming[u.match.eventType];d&&!d.includes(u)&&(d.push(u),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[s.eventType];return c||(c=[],this._incoming[s.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const i=new uVe(e,{onEmit:(r,n,s,o)=>{this._manager?.emit(r.eventType,n,s,o)},onRemove:r=>{delete this._outgoing[r.eventType],this._manager?.updateDependencies()}});return this._outgoing[e]=i,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),i}startCapturingPointer(e){this._manager?.setPointerCapture(e,!0)}stopCapturingPointer(e){this._manager?.setPointerCapture(e,!1)}refreshHasPendingInputs(){this._manager?.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):Fee.error("This InputHandler is not registered with an InputManager")}_handleEvent(e){const i=this._incoming[e.type];if(i){for(const r of i)if(r.match.matches(e)&&(r.callback?.(e),e.shouldStopPropagation()))break}}},cVe=class{constructor(e,i,r){this.match=e,this._callback=i,this._handler=r}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},uVe=class{constructor(e,i){this.eventType=e,this._removed=!1,this._handler=i}emit(e,i,r){this._removed||this._handler.onEmit(this,e,i,r)}remove(){this._removed=!0,this._handler.onRemove(this)}},hVe=class extends go{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",i=>{this._update(i.data)})}_update(e){const i=e.native.pointerType==="touch"?"touch":"mouse",{x:r,y:n}=e;i===this._value&&this._x===r&&this._y===n||(this._value=i,this._x=r,this._y=n,this._onChange(i,r,n))}},dVe=class extends go{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=qT(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},Nu=class extends xe{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=sVe,this._latestPointerType="mouse",this._propertiesPool=new Og({latestPointerLocation:mVe},this),this.latestPointerLocation=null,this._paused=!1,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const i of e)this.uninstallHandlers(i);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get updating(){return this.hasPendingInputs||this._paused}installHandlers(e,i,r=qy.INTERNAL){if(this._nameToGroup[e])return void ne.getLogger(this).error("There is already an InputHandler group registered under the name `"+e+"`");if(i.length===0)return void ne.getLogger(this).error("Can't register a group of zero handlers");const n={name:e,handlers:i.map(s=>({handler:s,active:!0,removed:!1,priorityIndex:0,groupPriority:r,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=n;for(let s=n.handlers.length-1;s>=0;s--){const o=n.handlers[s];this._handlers.push(o),o.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(a,l,c,u,d)=>{this._emitInputEvent(o.priorityIndex+1,a,l,c,d,u)},setPointerCapture:(a,l)=>{this._setPointerCapture(n,o,a,l)},setEventCallback:a=>{o.eventCallback=a},setUninstallCallback:a=>{o.uninstallCallback=a},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const i=this._nameToGroup[e];i?(i.handlers.forEach(r=>{r.removed=!0,r.uninstallCallback?.()}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):ne.getLogger(this).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,i=new Set;this._handlersPriority=[];for(let r=this._handlers.length-1;r>=0;r--){const n=this._handlers[r];n.priorityIndex=r,this._handlersPriority.push(n)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let r=this._handlersPriority.length-1;r>=0;r--){const n=this._handlersPriority[r];n.priorityIndex=r;let s=n.handler.hasSideEffects;if(!s){for(const o of n.handler.outgoingEventTypes)if(e.has(o)){s=!0;break}}if(s)for(const o of n.handler.incomingEventMatches){e.add(o.eventType);for(const a of o.keyModifiers)aVe(a)||i.add(a)}n.active=s}this._sourceEvents=e,this._keyModifiers=i,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,i,r){this._latestPointerType=e;const n=this._get("latestPointerLocation");if(n==null||n.x!==i||n.y!==r){const s=this._propertiesPool.get("latestPointerLocation");s.x=i,s.y=r,this._set("latestPointerLocation",s)}}_onEventReceived(e,i){if(e==="pointer-capture-lost"){const s=i;this._pointerCaptures.delete(s.native.pointerId)}this._updateKeyModifiers(e,i);const r=this.test.timestamp!=null?this.test.timestamp:i.native?i.native.timestamp:void 0,n=i.native?i.native.cancelable:void 0;this._emitInputEventFromSource(e,i,r,n)}_updateKeyModifiers(e,i){if(!i)return;let r=!1;const n=()=>{if(!r){const a=new Set;this._activeKeyModifiers.forEach(l=>{a.add(l)}),this._activeKeyModifiers=a,r=!0}},s=(a,l)=>{l&&!this._activeKeyModifiers.has(a)?(n(),this._activeKeyModifiers.add(a)):!l&&this._activeKeyModifiers.has(a)&&(n(),this._activeKeyModifiers.delete(a))};if(e==="key-down"||e==="key-up"){const a=i.key;this._keyModifiers.has(a)&&s(a,e==="key-down")}const o=i.native;s("Alt",!(!o||!o.altKey)),s("Ctrl",!(!o||!o.ctrlKey)),s("Shift",!(!o||!o.shiftKey)),s("Meta",!(!o||!o.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new hVe((e,i,r)=>this._setLatestPointer(e,i,r)),this._multiTouchHandler=new dVe,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],qy.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,qy.INTERNAL)}_setPointerCapture(e,i,r,n){const s=e.name+"-"+i.priorityIndex,o=this._pointerCaptures.get(r.pointerId)||new Set;this._pointerCaptures.set(r.pointerId,o),n?(o.add(s),o.size===1&&this.eventSource&&this.eventSource.setPointerCapture(r,!0)):o.has(s)&&(o.delete(s),o.size===0&&(this._pointerCaptures.delete(r.pointerId),this.eventSource&&this.eventSource.setPointerCapture(r,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,i,r,n){this._emitInputEvent(0,e,i,r,n)}_emitInputEvent(e,i,r,n,s,o){const a=n!==void 0?n:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),l=s!==void 0&&s,c={event:new pVe(i,r,a,o||this._activeKeyModifiers,l),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(e){this._currentPropagation={events:new hN,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){this._paused=!1;const e=this._currentPropagation;if(e){for(;e.events.length>0;){const{event:i,priorityIndex:r}=e.events.pop(),n=i.data?.eventId;if(!(n!=null&&this._stoppedPropagationEventIds.has(n)))for(e.currentHandler=this._handlersPriority[r];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!i.shouldStopPropagation()&&e.currentHandler.eventCallback?.(i),i.shouldStopPropagation()){n!=null&&this._stoppedPropagationEventIds.add(n);break}if(i.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:i,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const i=new hN;i.push(e);const r=this._currentPropagation;if(r){for(;r.events.length;)i.push(r.events.pop());r.events=i,r.currentHandler=null,this._paused=!0}}_compareHandlerPriority(e,i){if(e.handler.hasSideEffects!==i.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==i.groupPriority)return e.groupPriority>i.groupPriority?-1:1;for(const r of e.handler.incomingEventMatches)for(const n of i.handler.incomingEventMatches){if(r.eventType!==n.eventType)continue;const s=r.keyModifiers.filter(o=>n.keyModifiers.includes(o));if(s.length===r.keyModifiers.length!=(s.length===n.keyModifiers.length))return r.keyModifiers.length>n.keyModifiers.length?-1:1}return e.priorityIndex>i.priorityIndex?-1:1}_sortHandlersPriority(e){const i=[];for(const r of e){let n=0;for(;n<i.length&&this._compareHandlerPriority(r,i[n])>=0;)n++;i.splice(n,0,r)}return i}get debug(){const e=i=>{const r=this._setPointerCapture;this._setPointerCapture=()=>{},i(),this._setPointerCapture=r};return{injectEvent:(i,r)=>{e(()=>{this._onEventReceived(i,r)})},disablePointerCapture:e}}};h([f({readOnly:!0})],Nu.prototype,"hasPendingInputs",null),h([f({constructOnly:!0})],Nu.prototype,"eventSource",void 0),h([f({constructOnly:!0})],Nu.prototype,"recognizers",void 0),h([f()],Nu.prototype,"_latestPointerType",void 0),h([f()],Nu.prototype,"latestPointerType",null),h([f()],Nu.prototype,"multiTouchActive",null),h([f({readOnly:!0})],Nu.prototype,"latestPointerLocation",void 0),h([f()],Nu.prototype,"_paused",void 0),h([f({readOnly:!0})],Nu.prototype,"updating",null),Nu=h([z("esri.views.input.InputManager")],Nu);let pVe=class{constructor(e,i,r,n,s){this.type=e,this.data=i,this.timestamp=r,this.modifiers=n,this.cancelable=s,this._propagationState=gy.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=gy.STOPPED}shouldStopPropagation(){return(this._propagationState&gy.STOPPED)!=0}async(e){this._propagationState|=gy.PAUSED;const i=(r,n)=>{this._propagationState&=~gy.PAUSED;const s=this._resumeCallback;if(this._resumeCallback=null,s&&s(),n)throw r;return r};return(typeof e=="function"?e():e).then(r=>i(r,!1),r=>i(r,!0))}shouldPausePropagation(e){return!!(this._propagationState&gy.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var gy;(function(t){t[t.NONE=0]="NONE",t[t.STOPPED=1]="STOPPED",t[t.PAUSED=2]="PAUSED"})(gy||(gy={}));const qy={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let fVe=class{};const mVe=fVe;function pp(t){return t!=null&&"open"in t&&"declaredClass"in t}function kee(t){return t!=null&&"declaredClass"in t&&"dockOptions"in t}const gVe=t=>{let e=class extends t{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([le(()=>[this.ui,this.popup],([i,r],n)=>{const s="popup",o="manual";if(n){const[a,l]=n;a&&pp(l)&&(l.view=null,kee(l)&&a.remove(l,s))}i&&pp(r)&&(r.view=this,kee(r)&&i.add(r,{key:s,position:o,internal:!0}))},Zi),this.on("click",i=>{this.popup&&this.popupEnabled&&(i.pointerType!=="mouse"||i.button===0)&&(!pp(this.popup)&&"autoOpenEnabled"in this.popup&&this.popup.autoOpenEnabled===!1||(pp(this.popup)?this.popup.viewModel.handleViewClick(i):i.async(async()=>{await this.setupPopup(),pp(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(i)})))},qy.WIDGET)]),Tg(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{pe(()=>import("./Popup-aba10ee0.js"),["./Popup-aba10ee0.js","./unitFormatUtils-4b3497b3.js","./AttachmentInfo-b9241c2f.js","./AttachmentQuery-ac66f9a7.js","./utils-e24aed40.js","./ColorStop-ac9a118d.js","./jsonUtils-3d6448c4.js","./UniqueValueRenderer-176db886.js","./diffUtils-3ed1f592.js","./colorRamps-cf6fa9ce.js","./DictionaryLoader-1a1ab2cc.js","./FieldsIndex-85e142d0.js","./heatmapUtils-3c0e0ece.js","./Query-630c5d65.js","./executeQueryJSON-d0cd1585.js","./query-ae6e69b4.js","./pbfQueryUtils-0854066b.js","./pbf-97a34880.js","./queryZScale-9dee68ff.js","./FeatureSet-05a1ff98.js","./RelationshipQuery-249800df.js","./TopFeaturesQuery-268791e0.js","./FeatureLayer-72a3b1cd.js","./FeatureLayerBase-56c03a7a.js","./commonProperties-60f31277.js","./ElevationInfo-36952bdf.js","./featureLayerUtils-d891b150.js","./featureQueryAll-778379dd.js","./LayerFloorInfo-5c97dc41.js","./serviceCapabilitiesUtils-1513785a.js","./editsZScale-03b9f186.js","./APIKeyMixin-9d7343aa.js","./ArcGISService-1771a240.js","./BlendLayer-dce91235.js","./jsonUtils-16d33138.js","./CustomParametersMixin-45f14a7d.js","./EditBusLayer-3babd061.js","./FeatureEffectLayer-50d5188d.js","./FeatureEffect-40ff6b77.js","./FeatureFilter-5ab88729.js","./FeatureReductionLayer-826e078c.js","./FeatureReductionSelection-4ea33fb1.js","./LabelClass-06cdad9c.js","./defaults-4b2d7493.js","./defaultsJSON-59981e75.js","./MD5-715f37cd.js","./OperationalLayer-5c10068f.js","./OrderedLayer-b68b3bb4.js","./PortalLayer-c3739096.js","./ScaleRangeLayer-5b526f5a.js","./TemporalLayer-683091de.js","./FeatureTemplate-0e5c0008.js","./FeatureType-347e5e8f.js","./fieldProperties-49b9eb67.js","./labelingInfo-4784a348.js","./versionUtils-e8eeb271.js","./styleUtils-f17e2eb8.js","./popupUtils-6f3d55df.js","./ReactiveSet-2b224343.js"],import.meta.url)})}destroy(){this.destroyed||this.closePopup()}async openPopup(i){if(pp(this.popup))return this.popup.open(i);try{if(await this.setupPopup(),!this.popup)return void ne.getLogger(this).error(new W("view:null-popup","Popup is null and can't be opened"));this.popup.open(i)}catch{}}closePopup(){this._popupSetupTask?.abort(),pp(this.popup)&&this.popup.close()}async fetchPopupFeatures(i,r){await this.when();const{location:n,queryArea:s,layerViewsAndGraphics:o,clientOnlyGraphics:a}=await this._prepareFetchPopupFeatures(i,r),l=Promise.resolve(a),c=this._queryLayerPopupFeatures(s,o,r),u=c.map(d=>d.promise);return{location:n,clientOnlyGraphics:a,allGraphicsPromise:mRe([l,...u]).then(d=>Array.from(new Set(d.flat()))),promisesPerLayerView:c}}async setupPopup(){if(this._popupSetupTask?.abort(),this.popup&&!pp(this.popup))return this._popupSetupTask=S_(async i=>{const{default:r}=await pe(()=>import("./Popup-aba10ee0.js"),["./Popup-aba10ee0.js","./unitFormatUtils-4b3497b3.js","./AttachmentInfo-b9241c2f.js","./AttachmentQuery-ac66f9a7.js","./utils-e24aed40.js","./ColorStop-ac9a118d.js","./jsonUtils-3d6448c4.js","./UniqueValueRenderer-176db886.js","./diffUtils-3ed1f592.js","./colorRamps-cf6fa9ce.js","./DictionaryLoader-1a1ab2cc.js","./FieldsIndex-85e142d0.js","./heatmapUtils-3c0e0ece.js","./Query-630c5d65.js","./executeQueryJSON-d0cd1585.js","./query-ae6e69b4.js","./pbfQueryUtils-0854066b.js","./pbf-97a34880.js","./queryZScale-9dee68ff.js","./FeatureSet-05a1ff98.js","./RelationshipQuery-249800df.js","./TopFeaturesQuery-268791e0.js","./FeatureLayer-72a3b1cd.js","./FeatureLayerBase-56c03a7a.js","./commonProperties-60f31277.js","./ElevationInfo-36952bdf.js","./featureLayerUtils-d891b150.js","./featureQueryAll-778379dd.js","./LayerFloorInfo-5c97dc41.js","./serviceCapabilitiesUtils-1513785a.js","./editsZScale-03b9f186.js","./APIKeyMixin-9d7343aa.js","./ArcGISService-1771a240.js","./BlendLayer-dce91235.js","./jsonUtils-16d33138.js","./CustomParametersMixin-45f14a7d.js","./EditBusLayer-3babd061.js","./FeatureEffectLayer-50d5188d.js","./FeatureEffect-40ff6b77.js","./FeatureFilter-5ab88729.js","./FeatureReductionLayer-826e078c.js","./FeatureReductionSelection-4ea33fb1.js","./LabelClass-06cdad9c.js","./defaults-4b2d7493.js","./defaultsJSON-59981e75.js","./MD5-715f37cd.js","./OperationalLayer-5c10068f.js","./OrderedLayer-b68b3bb4.js","./PortalLayer-c3739096.js","./ScaleRangeLayer-5b526f5a.js","./TemporalLayer-683091de.js","./FeatureTemplate-0e5c0008.js","./FeatureType-347e5e8f.js","./fieldProperties-49b9eb67.js","./labelingInfo-4784a348.js","./versionUtils-e8eeb271.js","./styleUtils-f17e2eb8.js","./popupUtils-6f3d55df.js","./ReactiveSet-2b224343.js"],import.meta.url);if(Et(i),!this.popup||pp(this.popup))return;const n=this.popup;delete n.open,delete n.close,this.popup=new r(n)}),this._popupSetupTask.promise}_queryLayerPopupFeatures(i,r,n){return r.map(({layerView:s,graphics:o})=>{const a={clientGraphics:o,event:n?.event,signal:n?.signal,defaultPopupTemplateEnabled:n!=null&&!!n.defaultPopupTemplateEnabled},l=s.fetchPopupFeatures(i,a);return{layerView:s,promise:l}})}_isValidPopupGraphic(i,r){return i&&!!i.getEffectivePopupTemplate(r!=null&&r.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(i,r){const{clientGraphics:n,queryArea:s,location:o}=await this._popupHitTestGraphics(i,r),a=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:l,clientOnlyGraphics:c}=this._graphicsPerFetchPopupLayerView(n,a);return{clientOnlyGraphics:c,layerViewsAndGraphics:l,queryArea:s,location:o}}async _popupHitTestGraphics(i,r){const n=await this.popupHitTest(i),s=n.results,o=n.mapPoint,a=s.filter(c=>c.type==="graphic"&&this._isValidPopupGraphic(c.graphic,r)),l=a.length?a[0].mapPoint:null;return{clientGraphics:a.map(c=>c.graphic),queryArea:o,location:o||l}}_getFetchPopupLayerViews(){const i=[];return this.allLayerViews.forEach(r=>{this._isValidPopupLayerView(r)&&i.push(r)}),this.graphicsView!=null&&this._isValidPopupLayerView(this.graphicsView)&&i.push(this.graphicsView),i.reverse()}_isValidPopupLayerView(i){return i!=null&&(!("layer"in i)||!i.suspended)&&"fetchPopupFeatures"in i}_graphicsPerFetchPopupLayerView(i,r){const n=[],s=new Map,o=r.map(a=>{const l=[];return"layer"in a?s.set(a.layer,l):s.set(a.graphics,l),{layerView:a,graphics:l}});for(const a of i){const l=s.get(a.layer)||s.get(a.sourceLayer)||null;l?l.push(a):n.push(a)}return{layerViewsAndGraphics:o,clientOnlyGraphics:n}}};return h([f({cast(i){return!i||pp(i)||typeof i=="object"&&(i.open=r=>(RT(ne.getLogger(this),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",version:"4.27"}),this.openPopup(r)),i.close=()=>(RT(ne.getLogger(this),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",{replacement:"Use view.closePopup() instead.",version:"4.27"}),this.closePopup())),i}})],e.prototype,"popup",void 0),h([f()],e.prototype,"popupEnabled",void 0),e=h([z("esri.views.PopupView")],e),e},Uee={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8};function L6(t,e,i,r=Lf){const n=new Wd(tW(r)),s=Zt.fromJSDate(t,{zone:n}),o=i==="decades"||i==="centuries"?"year":A_e(i);return i==="decades"&&(e*=10),i==="centuries"&&(e*=100),s.plus({[o]:e}).toJSDate()}function zee(t,e,i=Lf){const r=new Wd(tW(i)),n=Zt.fromJSDate(t,{zone:r});if(e==="decades"||e==="centuries"){const o=n.startOf("year"),{year:a}=o,l=a-a%(e==="decades"?10:100);return o.set({year:l}).toJSDate()}const s=A_e(e);return n.startOf(s).toJSDate()}function yOt(t,e,i){return t===0?0:t*Uee[e]/Uee[i]}function _Ot(t,e){return t&&e?t.intersection(e):t||e}function A_e(t){switch(t){case"milliseconds":return"millisecond";case"seconds":return"second";case"minutes":return"minute";case"hours":return"hour";case"days":return"day";case"weeks":return"week";case"months":return"month";case"years":return"year"}}var ed;let Nc=ed=class extends $e{static get allTime(){return Bee}static get empty(){return yVe}constructor(t){super(t),this.end=null,this.start=null}readEnd(t,e){return e.end!=null?new Date(e.end):null}writeEnd(t,e){e.end=t?.getTime()??null}get isAllTime(){return this.equals(ed.allTime)}get isEmpty(){return this.equals(ed.empty)}readStart(t,e){return e.start!=null?new Date(e.start):null}writeStart(t,e){e.start=t?.getTime()??null}clone(){return new ed({end:this.end,start:this.start})}equals(t){if(!t)return!1;const e=this.start?.getTime()??this.start,i=this.end?.getTime()??this.end,r=t.start?.getTime()??t.start,n=t.end?.getTime()??t.end;return e===r&&i===n}expandTo(t,e=Lf){if(this.isEmpty||this.isAllTime)return this.clone();let i=this.start;i&&(i=zee(i,t,e));let r=this.end;if(r){const n=zee(r,t,e);r=r.getTime()===n.getTime()?n:L6(n,1,t,e)}return new ed({start:i,end:r})}intersection(t){if(!t)return this.clone();if(this.isEmpty||t.isEmpty)return ed.empty;if(this.isAllTime)return t.clone();if(t.isAllTime)return this.clone();const e=this.start?.getTime()??-1/0,i=this.end?.getTime()??1/0,r=t.start?.getTime()??-1/0,n=t.end?.getTime()??1/0;let s,o;if(r>=e&&r<=i?s=r:e>=r&&e<=n&&(s=e),i>=r&&i<=n?o=i:n>=e&&n<=i&&(o=n),s!=null&&o!=null&&!isNaN(s)&&!isNaN(o)){const a=new ed;return a.start=s===-1/0?null:new Date(s),a.end=o===1/0?null:new Date(o),a}return ed.empty}offset(t,e,i=Lf){if(this.isEmpty||this.isAllTime)return this.clone();const r=new ed,{start:n,end:s}=this;return n!=null&&(r.start=L6(n,t,e,i)),s!=null&&(r.end=L6(s,t,e,i)),r}union(t){if(!t||t.isEmpty)return this.clone();if(this.isEmpty)return t.clone();if(this.isAllTime||t.isAllTime)return Bee.clone();const e=this.start!=null&&t.start!=null?new Date(Math.min(this.start.getTime(),t.start.getTime())):null,i=this.end!=null&&t.end!=null?new Date(Math.max(this.end.getTime(),t.end.getTime())):null;return new ed({start:e,end:i})}};h([f({type:Date,json:{write:{allowNull:!0}}})],Nc.prototype,"end",void 0),h([Ni("end")],Nc.prototype,"readEnd",null),h([di("end")],Nc.prototype,"writeEnd",null),h([f({readOnly:!0,json:{read:!1}})],Nc.prototype,"isAllTime",null),h([f({readOnly:!0,json:{read:!1}})],Nc.prototype,"isEmpty",null),h([f({type:Date,json:{write:{allowNull:!0}}})],Nc.prototype,"start",void 0),h([Ni("start")],Nc.prototype,"readStart",null),h([di("start")],Nc.prototype,"writeStart",null),Nc=ed=h([z("esri.TimeExtent")],Nc);const Bee=new Nc,yVe=new Nc({start:void 0,end:void 0}),_Ve=Nc;let n3=class extends t3{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};h([ude({Type:Lb,ensureType:uo(Lb)})],n3.prototype,"itemType",void 0),n3=h([z("esri.support.GraphicsCollection")],n3);let iy=class extends xe{constructor(e){super(e),this.view=null,this.baseLayerViews=new ft,this.referenceLayerViews=new ft,this._loadingHandle=le(()=>this.view?.map?.basemap,i=>{i&&i.load().catch(()=>{})},Zi)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(const e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return!this.view||this.view.suspended}get updating(){if(this.view&&this.view.suspended)return!1;const e=this.view?.map?.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(i=>i.updating)||this.referenceLayerViews.some(i=>i.updating))}};h([f({constructOnly:!0})],iy.prototype,"view",void 0),h([f({readOnly:!0})],iy.prototype,"baseLayerViews",void 0),h([f({readOnly:!0})],iy.prototype,"referenceLayerViews",void 0),h([f({readOnly:!0})],iy.prototype,"suspended",null),h([f({type:Boolean,readOnly:!0})],iy.prototype,"updating",null),iy=h([z("esri.views.BasemapView")],iy);function vVe(t){return"tryRecycleWith"in t}let bVe=class{constructor(e,i,r){this.layer=e,this.view=i,this.layerViewImporter=r,this._controller=new AbortController,this._deferred=vs(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,os(this._controller.signal,()=>{const n=new W("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(n)})}tryRecycle(e){if(!this.done||!this.layerView||!vVe(this.layerView))return null;const i=this.layer.type,r=this._controller.signal;for(let n=0;n<e.length;n++){const s=e[n];if(s.type!==i)continue;const o=this.layerView.tryRecycleWith(s,{signal:r});if(o){e.splice(n,1),this.layer=s;const a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(Et(this._controller.signal),s.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),s.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((c,u)=>os(this._controller.signal,()=>u(pi())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:i,view:r}=this;i.emit("layerview-destroy",{view:r,layerView:e}),r.emit("layerview-destroy",{layer:i,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:i,view:r}=this;this._map=r.map;try{let n,s;if(await i.load({signal:e}),i.prefetchResources&&await i.prefetchResources({signal:e}),xVe(i))n=await i.createLayerView(r,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(i))throw new W("layer:view-not-supported","No layerview implementation was found");const l=await this.layerViewImporter.importLayerView(i);Et(e),n="default"in l?new l.default({layer:i,view:r}):new l({layer:i,view:r})}const o=()=>{s=pr(s),n.destroyed||n.destroy(),n.layer=null,n.parent=null,n.view=null,this.done=!0};s=os(e,o),Et(e);try{await n.when()}catch(l){throw o(),l}if(!this._map?.allLayers?.includes(i))return o(),void this._deferred.reject(new W("view:no-layerview-for-layer","The layer has been removed from the map",{layer:i}));this.layerView=n,i.emit("layerview-create",{view:r,layerView:n}),r.emit("layerview-create",{layer:i,layerView:n}),this.done=!0,this._deferred.resolve(n)}catch(n){i.emit("layerview-create-error",{view:r,error:n}),r.emit("layerview-create-error",{layer:i,error:n}),this.done=!0,this._deferred.reject(new W("layerview:create-error","layerview creation failed",{layer:i,error:n}))}}},Fu=class extends xe{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new Ud,this.supportsGround=!0,this._preloadLayerViewModules=()=>{const i=this.view.map?.allLayers;if(i)for(const r of i)this.layerViewImporter.hasLayerViewModule(r)&&this.layerViewImporter.importLayerView(r)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=vs(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(PS(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{if(this.destroyed)return;const i=this.view.map;if(this._map!==i&&(this.clear(),this._map=i),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const r=new Set,n=[],s=this.view.ready,o=l=>{if(l!=null){for(const c of l)if(c){r.add(c);const u=this._layerLayerViewInfoMap.get(c);u&&s?u.start():u||this._recyclingInfoMap.has(c)||n.push(c),"layers"in c&&c.layers&&o(c.layers)}}};for(const l of this._rootCollectionNames)o(Ld(this,l));for(const[l,c]of this._layerLayerViewInfoMap)if(!r.has(l)){this._layerLayerViewInfoMap.delete(c.layer);const u=c.tryRecycle(n);u?(this.notifyChange("updating"),this._recyclingInfoMap.set(c.layer,c),u.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(c.layer),this._layerLayerViewInfoMap.set(c.layer,c),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(c.layer),c.destroy(),this._reschedule()})):c.destroy()}for(const[l,c]of this._recyclingInfoMap)r.has(l)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(c.layer),c.destroy());for(const l of n)this._createLayerView(l);this._refreshCollections();const a=[i?.ground?.layers,i?.basemap?.baseLayers,i?.basemap?.referenceLayers,i?.layers].filter(l=>!!l);r.forEach(l=>"layers"in l&&a.push(l.layers)),this.addHandles(a.map(l=>this._watchUpdatingTracking.addOnCollectionChange(()=>l,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.addHandles([Io(()=>this.view?.map?.allLayers,"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),le(()=>{const e=this.view,i=e?.map;return[i?.basemap,i?.ground,i?.layers,e?.ready]},()=>this._reschedule(),Yi)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),e6(this._recyclingInfoMap),e6(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(pi()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||Hc(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const i of this._layerLayerViewInfoMap.values())i.done||++e;return e}clear(){this.destroyed||(e6(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new W("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,i]of this._layersToLayerViews)this._populateLayerViewsOwners(Ld(this,e),Ld(this,i),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,i,r){if(!e||!i)return void(i&&i.removeAll());let n=0;for(const s of e){const o=this._layerLayerViewInfoMap.get(s);if(!o?.layerView)continue;const a=o.layerView;a.layer=s,a.parent=r,i.at(n)!==a&&i.splice(n,0,a),s.layers&&this._populateLayerViewsOwners(s.layers,a.layerViews,a),n+=1}n<i.length&&i.splice(n,i.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const i=new bVe(e,this.view,this.layerViewImporter);i.promise.then(()=>this._refreshCollections(),r=>{r&&(Fn(r)||r.name==="cancelled:layerview-create")||ne.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:r}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,i),this.view.ready&&i.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};h([f()],Fu.prototype,"_workPromise",void 0),h([f({readOnly:!0})],Fu.prototype,"_watchUpdatingTracking",void 0),h([f({readOnly:!0})],Fu.prototype,"_layersToLayerViews",null),h([f({readOnly:!0})],Fu.prototype,"_rootCollectionNames",null),h([f()],Fu.prototype,"layerViewImporter",void 0),h([f()],Fu.prototype,"supportsGround",void 0),h([f({readOnly:!0})],Fu.prototype,"updating",null),h([f({readOnly:!0})],Fu.prototype,"updatingRemaining",null),h([f({constructOnly:!0})],Fu.prototype,"view",void 0),Fu=h([z("esri.views.LayerViewManager")],Fu);const wVe=Fu;function xVe(t){return"createLayerView"in t&&t.createLayerView!=null}let Oc=class extends xe{constructor(e){super(e),this.factor=1.5,this.offset=ph(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};h([f({type:Number})],Oc.prototype,"factor",void 0),h([f({nonNullable:!0})],Oc.prototype,"offset",void 0),h([f()],Oc.prototype,"position",void 0),h([f({type:Number,range:{min:0}})],Oc.prototype,"size",void 0),h([f()],Oc.prototype,"maskUrl",void 0),h([f()],Oc.prototype,"maskEnabled",void 0),h([f()],Oc.prototype,"overlayUrl",void 0),h([f()],Oc.prototype,"overlayEnabled",void 0),h([f({readOnly:!0})],Oc.prototype,"version",null),h([f({type:Boolean})],Oc.prototype,"visible",void 0),Oc=h([z("esri.views.Magnifier")],Oc);const O_e=Oc;let QC=class extends mu(xe){constructor(e){super(e),this.accentColor=new Ye([255,127,0]),this.textColor=new Ye([255,255,255])}};h([f({type:Ye,nonNullable:!0})],QC.prototype,"accentColor",void 0),h([f({type:Ye,nonNullable:!0})],QC.prototype,"textColor",void 0),QC=h([z("esri.views.Theme")],QC);const m7=QC;var Vee;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"})(Vee||(Vee={}));const R_e=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],P_e={};function M_e(t){return!!P_e[t]}function TVe(t){for(const e of t)if(!M_e(e))return!1;return!0}R_e.forEach(t=>{P_e[t]=!0});let SVe=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:i,priority:r},n)=>this.inputManager?.installHandlers(n,[i],r))}disconnect(){this.inputManager&&this._handlers.forEach((e,i)=>this.inputManager?.uninstallHandlers(i)),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,i,r,n){const s=Array.isArray(e)?e:e.split(",");if(!TVe(s))return s.some(M_e)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(i)?a=i:(o=i,a=[]),typeof r=="function"?o=r:n=r,n=n??qy.DEFAULT;const l=this._createUniqueGroupName(),c=new EVe(this.view,s,a,o);this._handlers.set(l,{handler:c,priority:n});for(const u of s){const d=this._handlerCounts.get(u)||0;this._handlerCounts.set(u,d+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],n),Mi(()=>this._removeHandler(l,s))}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,i){if(this._handlers.has(e)){this._handlers.delete(e);for(const r of i){const n=this._handlerCounts.get(r);n===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",r):n===1?this._handlerCounts.delete(r):this._handlerCounts.set(r,n-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},EVe=class extends go{constructor(e,i,r,n){super(!0),this._latestDragStart=void 0,this.view=e;for(const s of i)switch(s){case"click":this.registerIncoming("click",r,o=>n(this._wrapClick(o)));break;case"double-click":this.registerIncoming("double-click",r,o=>n(this._wrapDoubleClick(o)));break;case"immediate-click":this.registerIncoming("immediate-click",r,o=>n(this._wrapImmediateClick(o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",r,o=>n(this._wrapImmediateDoubleClick(o)));break;case"hold":this.registerIncoming("hold",r,o=>n(this._wrapHold(o)));break;case"drag":this.registerIncoming("drag",r,o=>{const a=this._wrapDrag(o);a&&n(a)});break;case"key-down":this.registerIncoming("key-down",r,o=>n(this._wrapKeyDown(o)));break;case"key-up":this.registerIncoming("key-up",r,o=>n(this._wrapKeyUp(o)));break;case"pointer-down":this.registerIncoming("pointer-down",r,o=>n(this._wrapPointer(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",r,o=>n(this._wrapPointer(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",r,o=>n(this._wrapPointer(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",r,o=>n(this._wrapPointerDrag(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",r,o=>n(this._wrapMouseWheel(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",r,o=>n(this._wrapPointer(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",r,o=>n(this._wrapPointer(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",r,o=>{n(this._wrapGamepad(o))});break;case"focus":this.registerIncoming("focus",r,o=>{n(this._wrapFocus(o))});break;case"blur":this.registerIncoming("blur",r,o=>{n(this._wrapBlur(o))})}}_wrapFocus(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:i=>e.async(i),preventDefault:()=>e.preventDefault()}}_wrapBlur(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:i=>e.async(i),preventDefault:()=>e.preventDefault()}}_wrapClick(e){const{pointerType:i,button:r,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:u}=e;return{type:"click",pointerType:i,button:r,buttons:n,x:s,y:o,native:a,timestamp:u,screenPoint:ph(s,o),mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}_wrapDoubleClick(e){const{pointerType:i,button:r,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:u}=e;return{type:"double-click",pointerType:i,button:r,buttons:n,x:s,y:o,native:a,timestamp:u,mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}_wrapImmediateClick(e){const{pointerType:i,button:r,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:u,timestamp:d}=e;return{type:"immediate-click",pointerId:c,pointerType:i,button:r,buttons:n,x:s,y:o,native:a,timestamp:d,mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}_wrapImmediateDoubleClick(e){const{pointerType:i,button:r,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:u,timestamp:d}=e;return{type:"immediate-double-click",pointerId:c,pointerType:i,button:r,buttons:n,x:s,y:o,native:a,timestamp:d,mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}_wrapHold(e){const{pointerType:i,button:r,buttons:n,x:s,y:o,native:a}=e.data,{cancelable:l,timestamp:c}=e;return{type:"hold",pointerType:i,button:r,buttons:n,x:s,y:o,native:a,timestamp:c,mapPoint:this._getMapPoint(s,o),cancelable:l,stopPropagation:()=>e.stopPropagation(),async:u=>e.async(u),preventDefault:()=>e.preventDefault()}}_getMapPoint(e,i){return this.view.toMap(ph(e,i),{exclude:[]})}_wrapDrag(e){const i=e.data,{x:r,y:n}=i.center,{action:s,pointerType:o,button:a}=i;if(s==="start"&&(this._latestDragStart=i),!this._latestDragStart)return;const l=i.pointer.native,c=i.buttons,{cancelable:u,timestamp:d}=e,p={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return s==="end"&&(this._latestDragStart=void 0),{type:"drag",action:s,x:r,y:n,origin:p,pointerType:o,button:a,buttons:c,radius:i.radius,angle:za(i.angle),native:l,timestamp:d,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}_wrapKeyDown(e){const{key:i,repeat:r,native:n}=e.data,{cancelable:s,timestamp:o}=e;return{type:"key-down",key:i,repeat:r,native:n,timestamp:o,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:a=>e.async(a),preventDefault:()=>e.preventDefault()}}_wrapKeyUp(e){const{key:i,native:r}=e.data,{cancelable:n,timestamp:s}=e;return{type:"key-up",key:i,native:r,timestamp:s,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:o=>e.async(o),preventDefault:()=>e.preventDefault()}}_wrapPointer(e,i){const{x:r,y:n,button:s,buttons:o,native:a,eventId:l}=e.data,c=a.pointerId,u=a.pointerType,{cancelable:d,timestamp:p}=e;return{type:i,x:r,y:n,pointerId:c,pointerType:u,button:s,buttons:o,native:a,timestamp:p,eventId:l,cancelable:d,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}_wrapPointerDrag(e){const{x:i,y:r,buttons:n,native:s,eventId:o}=e.data.currentEvent,{button:a}=e.data.startEvent,l=e.data.startEvent.native.pointerId,c=e.data.startEvent.native.pointerType,u=e.data.action,d={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:p,timestamp:m}=e;return{type:"pointer-drag",x:i,y:r,pointerId:l,pointerType:c,button:a,buttons:n,action:u,origin:d,native:s,timestamp:m,eventId:o,cancelable:p,stopPropagation:()=>e.stopPropagation(),async:y=>e.async(y),preventDefault:()=>e.preventDefault()}}_wrapMouseWheel(e){const{cancelable:i,data:r,timestamp:n}=e,{x:s,y:o,deltaY:a,native:l}=r;return{type:"mouse-wheel",x:s,y:o,deltaY:a,native:l,timestamp:n,cancelable:i,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}_wrapGamepad(e){const{action:i,state:r,device:n}=e.data,{cancelable:s,timestamp:o}=e,{buttons:a,axes:l}=r;return{type:"gamepad",device:n,timestamp:o,action:i,buttons:a,axes:l,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}};var dO,Gee,jee;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})(dO||(dO={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}(Gee||(Gee={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(jee||(jee={}));function CVe(t){return[t.on("before-add",e=>{const i=e.item;if(i==null||t.includes(i))return ne.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();i.onAdd()}),t.on("after-remove",e=>{const i=e.item;i.active&&(i.view.activeTool=null),i.destroy()})]}function g7(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag(dO.USER)&&t.getEditableFlag(dO.MANAGER)}function Vp(t){return ph(t.x,t.y)}function AOt(t){return Zr(t.x,t.y)}function $_e(t,e){const i=(t instanceof HTMLElement?t:t.surface)?.getBoundingClientRect();return i?ph(e.clientX-i.left,e.clientY-i.top):ph(0,0)}function Hee(t,e){return e instanceof Event?$_e(t,e):Vp(e)}function qee(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let AVe=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,i){const r=()=>e.stopPropagation();switch(e.type){case"pointer-move":Wee(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(r(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!Yee(e))break;const n=Vp(e),s=this._intersect(n,e.pointerType,i.forEachTool);if(s==null)break;const o=s.manipulator,a=s.tool;o==null||a==null||!o.interactive||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._ungrabManipulatorBeforeDragging(o,e,i),o!=null&&a!=null&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:o,tool:a,start:n,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&i.activeTool==null&&(this._revertToNullActiveTool=!0,i.setActiveTool(s.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:n}),r());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,i);break;case"pointer-drag":{if(!Yee(e))break;const n=this._grabbedManipulators.get(e.pointerId),s=n?.manipulator,o=n?.tool;if(s==null||o==null)break;const a=Vp(e);a.x=_e(a.x,0,i.view.width),a.y=_e(a.y,0,i.view.height);const l=n.start,c=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(s.dragging=!0,c?s.events.emit("drag",{action:"update",start:l,screenPoint:a}):s.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:o,manipulator:s,start:l}));break;case"end":s.dragging=!1,c&&s.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,i)}r();break}case"immediate-click":{const n=Vp(e),s=this._intersect(n,e.pointerType,i.forEachTool);if(OVe(e)||i.forEachTool(c=>{if((s==null||s.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let u=!1;c.manipulators.forEach(({manipulator:d})=>{d.selected&&(d.selected=!1,u=!0)}),u&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),s==null)break;const{manipulator:o,tool:a}=s;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const l=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:r}),D6(o,r);break}case"click":{const n=Vp(e),s=this._intersect(n,e.pointerType,i.forEachTool),o=s?.manipulator;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit(e.type,{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a}),r();break}case"double-click":{const n=Vp(e),s=this._intersect(n,e.pointerType,i.forEachTool),o=s!=null?s.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("double-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:r}),D6(o,r);break}case"immediate-double-click":{const n=Vp(e),s=this._intersect(n,e.pointerType,i.forEachTool),o=s!=null?s.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:r}),D6(o,r);break}}this._onFocusChange(i.forEachTool)}_ungrabManipulatorBeforeDragging(e,i,r){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:i.pointerType,screenPoint:Vp(i)}),this._grabbedManipulators.forEach(({manipulator:n},s)=>{n===e&&this._grabbedManipulators.delete(s)}),this._afterManipulatorUngrab(r.setActiveTool)}_handlePointerEnd(e,i){const r=this._grabbedManipulators.get(e.pointerId)?.manipulator;r!=null&&r.grabbing&&(r.grabbing=!1,r.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:Vp(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorUngrab(i.setActiveTool))}_cursorFromMap(e){let i=null;return Hc(e,({manipulator:r})=>!(r==null||!r.interactive)&&(r.grabbing&&r.grabCursor?(i=r.grabCursor,!0):!!r.cursor&&(i=r.cursor,!0))),i}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const i=new Set,r=new Set;this._grabbedManipulators.forEach(({tool:n})=>{i.add(n)}),this._hoveredManipulators.forEach(({tool:n})=>{r.add(n)}),e(n=>{n.hasGrabbedManipulators=i.has(n),n.hasHoveredManipulators=r.has(n);const s=this._grabbedManipulators.values(),o=kOe(s,({tool:a})=>a===n);n.firstGrabbedManipulator=o!=null?o.manipulator:null})}clearPointers(e,{forEachTool:i,setActiveTool:r},n=!0,s){const o=(a,l)=>a===e&&(s==null||s===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},u)=>{o(a,l)&&(this._grabbedManipulators.delete(u),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),n&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorUngrab(r),this._onFocusChange(i)}_intersect(e,i,r){let n=null;return r(s=>{if(s.manipulators==null||!g7(s))return!1;const o=s.manipulators.intersect(e,i);return o!=null&&(n={tool:s,manipulator:o},!0)}),n}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((i,r)=>{this._updateHoveredStateForPointerAtScreenPosition(ph(i.x,i.y),r,i.pointerType,e)})}handleHoverEvent(e,i){e.type!=="pointer-up"&&e.type!=="immediate-click"&&e.type!=="pointer-move"||!Wee(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(Vp(e),e.pointerId,e.pointerType,i)}_updateHoveredStateForPointerAtScreenPosition(e,i,r,n){let s=this._intersect(e,r,n);const o=this._hoveredManipulators.get(i)?.manipulator;s==null||s.manipulator.interactive||(s=null),s!=null&&o===s.manipulator||(o!=null&&(o.hovering=!1),s!=null?(s.manipulator.hovering=!0,this._hoveredManipulators.set(i,s)):this._hoveredManipulators.delete(i),this._onFocusChange(n))}_afterManipulatorUngrab(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}};function Wee(t){return t==="mouse"}function Yee(t){return t.pointerType!=="mouse"||t.button===0}function OVe(t){return!!t.native.shiftKey}function D6(t,e){t?.consumesClicks&&e()}const Xee="attached",N6="tools",Zee=1e3;let Gp=class extends xe{constructor(e){super(e),this._updatingHandles=new Ud,this._clock=QO,this._manipulatorState=new AVe,this.tools=new ft,this.cursor=null,this._interacting=!1,this._interactingTimeout=Zee,this._interactingTimeoutHandle=null,this._forEachTool=i=>{for(const r of this.tools.items)if(i(r))return}}initialize(){this.addHandles([this.view.on(R_e,e=>{this._handleInputEvent(e)},qy.TOOL),...CVe(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.activeTool=null,this.tools.drain(e=>e.destroy()),this._clearInteractingTimeout(),this._interacting=!1,this._updatingHandles.destroy()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void ne.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const i=this.activeTool;this._set("activeTool",e),i?.deactivate(),e?.activate(),this._removeIncompleteTools(e);for(const r of this.tools){this._updateToolEditableFlag(r);const n=g7(r);this.activeTool!=null&&n||this._manipulatorState.clearPointers(r,this._manipulatorStateEventArgs,!n)}this._updateCursor()}get updating(){return this._updatingHandles.updating||this.tools.some(e=>e.updating)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeoutHandle=pr(this._interactingTimeoutHandle)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeoutHandle=this._clock.setTimeout(()=>this._interacting=!1,this._interactingTimeout)}attach(){this.view.type==="3d"?this.addHandles([le(()=>{const{state:e}=this.view;return"camera"in e&&e.camera},()=>this._forEachManipulator(e=>e.onViewChange())),this.view.elevationProvider?.on("elevation-change",e=>this._forEachManipulator(i=>i.onElevationChange(e)))],Xee):this.addHandles(le(()=>this.view.extent,()=>this._forEachManipulator(e=>e.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.removeHandles(Xee),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(i=>{i.manipulators&&i.manipulators.forEach(({manipulator:r})=>e(r,i))})}_handleInputEvent(e){let i=!1;const r={...e,stopPropagation:()=>{i=!0,e.stopPropagation()}};this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(r):this._forEachTool(n=>{!i&&n.visible&&n.handleInputEvent(r)}),!i&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(r,this._manipulatorStateEventArgs),i||this.activeTool==null||this.activeTool.handleInputEventAfter(r),this._manipulatorState.handleHoverEvent(r,this._forEachTool),this._updateCursor(),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.removeHandles(N6),this._forEachTool(e=>{if(e instanceof xe){const i=le(()=>[e.cursor,e.visible,e.editable],()=>{g7(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.addHandles(i,N6)}e.manipulators&&this.addHandles([e.manipulators.on("after-remove",i=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,i.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],N6)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){e.setEditableFlag?.(dO.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(i=>!(i.cursor==null||!i.visible)&&(e=i.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(i=>(e==null||i!==e)&&!i.created&&i.removeIncompleteOnCancel).forEach(i=>{this.tools.remove(i)})}get test(){const e=this;return{setClock:i=>this._clock=i,set interactingTimeoutEnabled(i){e._interactingTimeout=i?Zee:0},get interactingTimeoutEnabled(){return e._interactingTimeout!==0}}}};h([f({constructOnly:!0,nonNullable:!0})],Gp.prototype,"view",void 0),h([f({value:null})],Gp.prototype,"activeTool",null),h([f({readOnly:!0,type:ft})],Gp.prototype,"tools",void 0),h([f({readOnly:!0})],Gp.prototype,"cursor",void 0),h([f({readOnly:!0})],Gp.prototype,"updating",null),h([f()],Gp.prototype,"_interacting",void 0),h([f({readOnly:!0})],Gp.prototype,"interacting",null),Gp=h([z("esri.views.ToolViewManager")],Gp);let s2=class extends xe{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":RVe.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return PVe[this.deviceType]}};h([f({nonNullable:!0,readOnly:!0})],s2.prototype,"nativeIndex",void 0),h([f({type:String,readOnly:!0})],s2.prototype,"deviceType",null),h([f({type:Number,readOnly:!0})],s2.prototype,"axisThreshold",null),s2=h([z("esri.views.input.gamepad.GamepadInputDevice")],s2);const RVe=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),PVe={standard:.15,spacemouse:.025,unknown:0},sY=s2;let eA=class extends xe{constructor(...e){super(...e),this.devices=new ft,this.enabledFocusMode="document"}};h([f({type:ft.ofType(sY),readOnly:!0})],eA.prototype,"devices",void 0),h([f({type:["document","view","none"]})],eA.prototype,"enabledFocusMode",void 0),eA=h([z("esri.views.input.gamepad.GamepadSettings")],eA);const MVe=eA;let pL=class extends xe{constructor(){super(...arguments),this.gamepad=new MVe}};h([f({readOnly:!0})],pL.prototype,"gamepad",void 0),pL=h([z("esri.views.input.Input")],pL);const $Ve=pL;let ry=class extends xe{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};h([f({type:Boolean,nonNullable:!0})],ry.prototype,"enabled",void 0),h([f({type:sY})],ry.prototype,"device",void 0),h([f({type:["pan","zoom"],nonNullable:!0})],ry.prototype,"mode",void 0),h([f({type:["forward-down","forward-up"],nonNullable:!0})],ry.prototype,"tiltDirection",void 0),h([f({type:Number,nonNullable:!0})],ry.prototype,"velocityFactor",void 0),ry=h([z("esri.views.navigation.gamepad.GamepadSettings")],ry);const I_e=ry;let e1=class extends xe{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new I_e,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};h([f({type:Boolean})],e1.prototype,"browserTouchPanEnabled",void 0),h([f({type:I_e,nonNullable:!0})],e1.prototype,"gamepad",void 0),h([f({type:Boolean})],e1.prototype,"momentumEnabled",void 0),h([f({type:Boolean})],e1.prototype,"mouseWheelZoomEnabled",void 0),e1=h([z("esri.views.navigation.Navigation")],e1);const L_e=e1;let y7,F6=null;async function IVe(t){F6||(F6=pe(()=>Promise.resolve().then(()=>tut),void 0,import.meta.url).then(e=>y7=e)),await F6,Et(t)}async function D_e(t,e,i,r){if(!t)return null;const n=t.spatialReference;return hR()||Hd(n,e)?Hf(t,e):y7?y7.projectGeometry(t,e,i,r):(await Promise.race([IVe(r),GT(r)]),D_e(t,e,i,r))}let Fr=class extends xe{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=nc(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference!=null?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){const e=this.map?.(),i=[];return this.priorityCollection!=null&&i.push(this.priorityCollection),i.push({parent:e?.basemap,layers:e?.basemap?.baseLayers},{layers:e?.layers},{parent:e?.ground,layers:e?.ground?.layers},{parent:e?.basemap,layers:e?.basemap?.referenceLayers}),i}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:i}=this._allLayers;let r=null;for(const s of e){const o=this._getSupportedSpatialReferences(s);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(r,o);a!=null&&(r=a)}if(r!=null&&r.length===1)break}if(i&&(r==null||r.length!==1))return{updating:!0};const n=this._pickSpatialReferenceCandidate(r);return{spatialReference:n!=null?n.spatialReference:null,viewingMode:n!=null?n.viewingMode:null,updating:!1}}get _tileInfoTask(){if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:i}=this._collectLayers([{parent:this.map?.()?.basemap,layers:this.map?.()?.basemap?.baseLayers},{layers:this.map?.()?.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const r=e[0].tileInfo;return{tileInfo:r&&r.spatialReference.equals(this.spatialReference)?r:null,updating:!1}}return{updating:i}}get _heightModelInfoTask(){if(!this.required.heightModelInfo||this.suspended&&this._get("_heightModelInfoTask")?.heightModelInfo)return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:i}=this._allLayers;for(const r of e)if(gNe(r)){const n=Pfe(r);if(n)return{heightModelInfo:n,vcsWkid:r.spatialReference?.vcsWkid,latestVcsWkid:r.spatialReference?.latestVcsWkid,updating:!1}}return{updating:i}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,i=e.updating,r=[];for(const n of e.layers){const s="fullExtents"in n&&n.fullExtents||(n.fullExtent!=null?[n.fullExtent]:[]),o=this.requiresExtentInSpatialReference?null:s[0],a=s.find(l=>l.spatialReference.equals(this.spatialReference))??o;if(a)return{candidates:[{extent:a,layer:n}],updating:!1};if(this._getSupportedSpatialReferences(n).length>0)for(const l of s)r.push({extent:l,layer:n})}return{candidates:r,updating:i}}get _extentTask(){const{candidates:e,updating:i}=this._extentCandidatesTask;if(i)return{updating:i};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const r=this._pickExtentCandidate(e),n=this.spatialReference;return r.extent.equals(this._projectExtentTask.input)&&n.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=nc(this._projectExtentTask.task)),this._projectExtentTask={input:r.extent.clone(),output:null,spatialReference:n.clone(),task:S_(async s=>{try{const o=await D_e(r.extent,n,"portalItem"in r.layer?r.layer.portalItem:void 0,s);this._projectExtentTask={...this._projectExtentTask,task:null,output:o}}catch{if(Hn(s))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,i){if(e==null)return i;const r=[],n=(s,o)=>s!=null?o!=null?s===o&&s:s:o;for(const s of e)for(const o of i){if(!s.spatialReference.equals(o.spatialReference))continue;const a=n(s.viewingMode,o.viewingMode);if(a!==!1){r.push({spatialReference:s.spatialReference,viewingMode:a});break}}return r.length>0?r:null}_pickSpatialReferenceCandidate(e){const i=this.defaultSpatialReference;return e==null||e.length<1?i!=null?{spatialReference:i,viewingMode:null}:null:(i!=null&&e.length>1&&e.some(({spatialReference:r})=>r.equals(i))&&(e=e.filter(({spatialReference:r})=>r.equals(i))),e.length>1&&e.some(({viewingMode:r})=>r!==Me.Local)&&(e=e.filter(({viewingMode:r})=>r!==Me.Local)),e[0])}_getSupportedSpatialReferences(e){const i="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(i.length===0)return[];const r=[];for(const n of i){const s=this.getSpatialReferenceSupport({spatialReference:n,layer:e});if(s!=null){const o=s.constraints!=null?s.constraints:[{spatialReference:n,viewingMode:null}];for(const{spatialReference:a,viewingMode:l}of o)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!a.equals(this.userSpatialReference)||r.push({spatialReference:a,viewingMode:l})}}return r}_pickExtentCandidate(e){const i=this.spatialReference;return e.find(({extent:r})=>i.equals(r.spatialReference))||e[0]}_collectLayers(e){if(this._loadMaybe(this.map?.())!=="loaded")return{layers:[],updating:!0};const i=new LVe;for(const r of e)if(this._collectCollection(r,i),i.preloading===this.sourcePreloadCount)break;return{layers:i.layers,updating:i.updating}}_collectCollection(e,i){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return i.updating=!0,void++i.preloading;case"failed":return}for(const r of e.layers){switch(this._loadMaybe(r)){case"failed":continue;case"loading":i.updating=!0,++i.preloading;break;case"loaded":i.updating||i.layers.push(r),"layers"in r&&this._collectCollection({layers:r.layers},i)}if(i.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(i=>{Fn(i)||console.log(i)}),"loading"):e.loadStatus:"loaded"}};h([f()],Fr.prototype,"required",void 0),h([f({constructOnly:!0})],Fr.prototype,"map",void 0),h([f({constructOnly:!0})],Fr.prototype,"getSpatialReferenceSupport",void 0),h([f()],Fr.prototype,"defaultSpatialReference",void 0),h([f()],Fr.prototype,"userSpatialReference",void 0),h([f()],Fr.prototype,"sourcePreloadCount",void 0),h([f()],Fr.prototype,"priorityCollection",void 0),h([f()],Fr.prototype,"requiresExtentInSpatialReference",void 0),h([f()],Fr.prototype,"suspended",void 0),h([f({readOnly:!0})],Fr.prototype,"ready",null),h([f({readOnly:!0})],Fr.prototype,"heightModelInfoReady",null),h([f({readOnly:!0})],Fr.prototype,"spatialReference",null),h([f({readOnly:!0})],Fr.prototype,"extent",null),h([f({readOnly:!0})],Fr.prototype,"heightModelInfo",null),h([f({readOnly:!0})],Fr.prototype,"vcsWkid",null),h([f({readOnly:!0})],Fr.prototype,"latestVcsWkid",null),h([f({readOnly:!0})],Fr.prototype,"viewingMode",null),h([f({readOnly:!0})],Fr.prototype,"tileInfo",null),h([f({readOnly:!0})],Fr.prototype,"mapCollections",null),h([f({readOnly:!0})],Fr.prototype,"_allLayers",null),h([f({readOnly:!0})],Fr.prototype,"_spatialReferenceTask",null),h([f({readOnly:!0})],Fr.prototype,"_tileInfoTask",null),h([f({readOnly:!0})],Fr.prototype,"_heightModelInfoTask",null),h([f({readOnly:!0})],Fr.prototype,"_extentCandidatesTask",null),h([f()],Fr.prototype,"_extentTask",null),h([f()],Fr.prototype,"_projectExtentTask",void 0),Fr=h([z("esri.views.support.DefaultsFromMap")],Fr);let LVe=class{constructor(){this.layers=new Array,this.preloading=-1,this.updating=!1}};var tA;let St=tA=class extends Tn.EventedMixin(v4(xe)){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.handles=new Dg,this.updatingHandles=new Ud,this.allLayerViews=new J3({getCollections:()=>[this.basemapView?.baseLayerViews,this.groundView?.layerViews,this.layerViews,this.basemapView?.referenceLayerViews],getChildrenFunction:NVe}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new n3,this.analyses=new eS,this.typeSpecificPreconditionsReady=!0,this.layerViews=new ft,this.magnifier=new O_e,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new $Ve,this.navigation=new L_e,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new SVe(this),this.persistableViewModels=new ft,this._isValid=!1,this._readyCycleForced=!1,this._lockedSpatialReference=null,this._userTimeZone=null,this._lockedTimeZone=null,this.theme=null,this.handles.add(le(()=>this.preconditionsReady,e=>{e?(this._lockedSpatialReference=this.spatialReference,this._lockedTimeZone=this.timeZone,tA.views.add(this)):(this._lockedSpatialReference=null,tA.views.remove(this)),this.notifyChange("spatialReference"),!e&&this.ready?(this.toolViewManager?.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),this.layerViewManager?.clear(),this._teardown()):e&&!this.ready&&(this._startup(),this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach())},qi))}initialize(){this.addResolvingPromise(Promise.all([this.loadAsyncDependencies(),this.validate()]).then(()=>(this._isValid=!0,Tg(()=>this.ready)))),this.basemapView=new iy({view:this}),this.layerViewManager=new wVe({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new Gp({view:this}),this._setupSpatialReferenceLogger(),this.addHandles([le(()=>this.initialExtentRequired,t=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:t},{sync:!0,initial:!0}),le(()=>this.ready,t=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=t,this.defaultsFromMap.userSpatialReference=t?this.spatialReference:this._userSpatialReference)},{sync:!0}),le(()=>this._userSpatialReference,t=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=t)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let t=null;this.addHandles([le(()=>this.defaultsFromMap?.ready,e=>{const i=this.map?.allLayers.length>0;if(e&&!this.spatialReference&&i){if(t!=null)return;const r=Mi(()=>t=nc(t));t=S_(async n=>{try{await V3(this.spatialReferenceWarningDelay,null,n)}catch{return}finally{t=null}ne.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.addHandles(r,"spatial-reference-logger-task")}else this.removeHandles("spatial-reference-logger-task")},{sync:!0})])}destroy(){this.destroyed||(tA.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=Pe(this.graphics),this.analyses=Pe(this.analyses),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),Pe(this.analysisViewManager),this.toolViewManager=Pe(this.toolViewManager),this.layerViewManager=Pe(this.layerViewManager),this.basemapView=Pe(this.basemapView),this.groundView?.destroy(),this.layerViews?.forEach(t=>t.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.destroy(),this.map=Pe(this.map),this.updatingHandles.destroy())}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return ne.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){return this.toolViewManager?.activeTool}set activeTool(t){this.toolViewManager&&(this.toolViewManager.activeTool=t)}get animation(){return this._get("animation")}set animation(t){this._set("animation",t)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new Fr({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:t=>this.getSpatialReferenceSupport(t),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(t){this._set("extent",t)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||bg.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._lockedSpatialReference&&!this.defaultsFromMap?.ready||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(t){t!==this._get("map")&&(t?.destroyed&&(ne.getLogger(this).warn("#map","The provided map is already destroyed",{map:t}),t=null),bg.isLoadable(t)&&t.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._lockedSpatialReference=null),this._set("map",t))}get spatialReference(){let t=this._userSpatialReference||this._lockedSpatialReference||this.getDefaultSpatialReference()||null;return t&&this.defaultsFromMap?.required?.heightModelInfo&&(t=t.clone(),t.vcsWkid=this.defaultsFromMap.vcsWkid,t.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),t}set spatialReference(t){const e=!wn(t,this._get("spatialReference"));this._set("_userSpatialReference",t),e&&(this._set("spatialReference",t),this._spatialReferenceChanged(t))}_spatialReferenceChanged(t){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get timeZone(){return this._userTimeZone??this._lockedTimeZone??this.getDefaultTimeZone()??Lf}set timeZone(t){const e=new Set(["etc/utc","etc/gmt","gmt"]),i=new Set(Intl.supportedValuesOf("timeZone").map(r=>r.toLowerCase()));this._userTimeZone=t,t===Lf||t===eW||e.has(t.toLowerCase())||i.has(t.toLowerCase())||ne.getLogger(this).warn("#timeZone",`the parsed value '${t}' may not be a valid IANA time zone`)}get tools(){return this.toolViewManager?.tools}get initialExtent(){return this.defaultsFromMap?.extent}get cursor(){return this.toolViewManager?.cursor??this._cursor??"default"}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}get effectiveTheme(){return this.theme??new m7}whenLayerView(t){return this.layerViewManager?.whenLayerView(t)??Promise.reject()}getDefaultSpatialReference(){return this.defaultsFromMap?.spatialReference}getDefaultHeightModelInfo(){return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??this.defaultsFromMap?.heightModelInfo??null}getDefaultTimeZone(){return null}importLayerView(t){throw new W("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}async loadAsyncDependencies(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(t){return this.getSpatialReferenceSupport({spatialReference:t})!=null}when(t,e){return this.isResolved()&&!this.ready&&ne.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(t,e)}forceReadyCycle(){this.ready&&(ac(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}};St.views=new ft,h([f()],St.prototype,"_userSpatialReference",void 0),h([f()],St.prototype,"activeTool",null),h([f({readOnly:!0})],St.prototype,"allLayerViews",void 0),h([f()],St.prototype,"groundView",void 0),h([f()],St.prototype,"animation",null),h([f()],St.prototype,"basemapView",void 0),h([f()],St.prototype,"center",null),h([f({readOnly:!0})],St.prototype,"_defaultsFromMapSettings",null),h([f()],St.prototype,"defaultsFromMap",null),h([f()],St.prototype,"fatalError",void 0),h([f({type:Xi})],St.prototype,"extent",null),h([f(YV(n3,"graphics"))],St.prototype,"graphics",void 0),h([f(YV(eS,"analyses"))],St.prototype,"analyses",void 0),h([f({readOnly:!0,type:tw})],St.prototype,"heightModelInfo",null),h([f({readOnly:!0})],St.prototype,"interacting",null),h([f({readOnly:!0})],St.prototype,"navigating",null),h([f({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_lockedSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],St.prototype,"preconditionsReady",null),h([f({readOnly:!0})],St.prototype,"typeSpecificPreconditionsReady",void 0),h([f({type:ft,readOnly:!0})],St.prototype,"layerViews",void 0),h([f()],St.prototype,"resolution",null),h([f({type:O_e})],St.prototype,"magnifier",void 0),h([f({value:null,type:Kpe})],St.prototype,"map",null),h([f()],St.prototype,"padding",void 0),h([f({readOnly:!0})],St.prototype,"ready",void 0),h([f({type:je})],St.prototype,"spatialReference",null),h([f()],St.prototype,"spatialReferenceWarningDelay",void 0),h([f()],St.prototype,"stationary",null),h([f({readOnly:!0})],St.prototype,"supportsGround",void 0),h([f({type:_Ve})],St.prototype,"timeExtent",void 0),h([f({type:String,nonNullable:!0})],St.prototype,"timeZone",null),h([f()],St.prototype,"tools",null),h([f()],St.prototype,"toolViewManager",void 0),h([f({readOnly:!0})],St.prototype,"type",void 0),h([f({type:Number})],St.prototype,"scale",void 0),h([f({readOnly:!0})],St.prototype,"updating",void 0),h([f({readOnly:!0})],St.prototype,"initialExtentRequired",void 0),h([f({readOnly:!0})],St.prototype,"initialExtent",null),h([f()],St.prototype,"cursor",null),h([f({readOnly:!0})],St.prototype,"input",void 0),h([f({type:L_e,nonNullable:!0})],St.prototype,"navigation",void 0),h([f()],St.prototype,"layerViewManager",void 0),h([f()],St.prototype,"analysisViewManager",void 0),h([f()],St.prototype,"width",void 0),h([f()],St.prototype,"height",void 0),h([f({readOnly:!0})],St.prototype,"resizing",void 0),h([f({value:null,readOnly:!0})],St.prototype,"size",null),h([f({readOnly:!0})],St.prototype,"suspended",void 0),h([f({readOnly:!0})],St.prototype,"viewEvents",void 0),h([f({readOnly:!0})],St.prototype,"persistableViewModels",void 0),h([f()],St.prototype,"_isValid",void 0),h([f()],St.prototype,"_readyCycleForced",void 0),h([f()],St.prototype,"_lockedSpatialReference",void 0),h([f()],St.prototype,"_userTimeZone",void 0),h([f()],St.prototype,"_lockedTimeZone",void 0),h([f({type:m7})],St.prototype,"theme",void 0),h([f({readOnly:!0,type:m7})],St.prototype,"effectiveTheme",null),St=tA=h([z("esri.views.View")],St);const DVe=St;function NVe(t){return t.layerViews}let ny=class extends PD{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=vs(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),this._resolver?.reject(new W("ViewAnimation stopped")))}finish(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),this._resolver?.resolve())}update(e,i){i||(i=dc(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",i)}};h([f({readOnly:!0})],ny.prototype,"done",null),h([f({readOnly:!0,type:String})],ny.prototype,"state",void 0),h([f()],ny.prototype,"target",void 0),ny=h([z("esri.views.ViewAnimation")],ny),function(t){t.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(ny||(ny={}));const sS=ny,RE=()=>pe(()=>import("./TileLayerView3D-202445ce.js"),["./TileLayerView3D-202445ce.js","./LayerView3D-239175ff.js","./TiledLayerView3D-791dea7d.js","./LayerView-840504cd.js","./RefreshableLayerView-c5fc5cdc.js","./MapServiceLayerViewHelper-ea990d3e.js","./floorFilterUtils-73949d2d.js","./sublayerUtils-109579ed.js","./popupUtils-049df13a.js","./drapedUtils-9a01dc8f.js"],import.meta.url),Jee=()=>pe(()=>import("./ElevationLayerView3D-86c1853a.js"),["./ElevationLayerView3D-86c1853a.js","./LayerView3D-239175ff.js","./TiledLayerView3D-791dea7d.js","./LayerView-840504cd.js"],import.meta.url),Kee={"base-dynamic":()=>pe(()=>import("./BaseDynamicLayerView3D-2d44d692.js"),["./BaseDynamicLayerView3D-2d44d692.js","./DynamicLayerView3D-69073afb.js","./LayerView3D-239175ff.js","./projectExtentUtils-4faf6b68.js","./ImageMaterial-0b6c45d0.js","./LayerView-840504cd.js","./RefreshableLayerView-c5fc5cdc.js"],import.meta.url),"base-elevation":Jee,"base-tile":RE,"bing-maps":RE,"building-scene":()=>pe(()=>import("./BuildingSceneLayerView3D-b9532884.js"),["./BuildingSceneLayerView3D-b9532884.js","./BuildingGroupSublayer-632eb7df.js","./BuildingComponentSublayer-00e240d7.js","./UniqueValueRenderer-176db886.js","./ColorStop-ac9a118d.js","./diffUtils-3ed1f592.js","./colorRamps-cf6fa9ce.js","./jsonUtils-3d6448c4.js","./DictionaryLoader-1a1ab2cc.js","./FieldsIndex-85e142d0.js","./heatmapUtils-3c0e0ece.js","./FeatureLayer-72a3b1cd.js","./FeatureLayerBase-56c03a7a.js","./commonProperties-60f31277.js","./ElevationInfo-36952bdf.js","./featureLayerUtils-d891b150.js","./featureQueryAll-778379dd.js","./Query-630c5d65.js","./AttachmentQuery-ac66f9a7.js","./RelationshipQuery-249800df.js","./LayerFloorInfo-5c97dc41.js","./serviceCapabilitiesUtils-1513785a.js","./editsZScale-03b9f186.js","./queryZScale-9dee68ff.js","./FeatureSet-05a1ff98.js","./APIKeyMixin-9d7343aa.js","./ArcGISService-1771a240.js","./BlendLayer-dce91235.js","./jsonUtils-16d33138.js","./CustomParametersMixin-45f14a7d.js","./EditBusLayer-3babd061.js","./FeatureEffectLayer-50d5188d.js","./FeatureEffect-40ff6b77.js","./FeatureFilter-5ab88729.js","./FeatureReductionLayer-826e078c.js","./FeatureReductionSelection-4ea33fb1.js","./LabelClass-06cdad9c.js","./defaults-4b2d7493.js","./defaultsJSON-59981e75.js","./MD5-715f37cd.js","./OperationalLayer-5c10068f.js","./OrderedLayer-b68b3bb4.js","./PortalLayer-c3739096.js","./ScaleRangeLayer-5b526f5a.js","./TemporalLayer-683091de.js","./FeatureTemplate-0e5c0008.js","./FeatureType-347e5e8f.js","./fieldProperties-49b9eb67.js","./labelingInfo-4784a348.js","./versionUtils-e8eeb271.js","./styleUtils-f17e2eb8.js","./TopFeaturesQuery-268791e0.js","./popupUtils-6f3d55df.js","./capabilities-c607cf72.js","./I3SIndexInfo-79029bcd.js","./I3SLayerDefinitions-a9c572ad.js","./I3SUtil-c67fd91a.js","./I3SBinaryReader-024c287a.js","./popupUtils-049df13a.js","./WhereClause-4988664d.js","./TimeOnly-a96593b0.js","./I3SMeshView3D-ed8e6c8f.js","./I3SOverrides-fbc2eb85.js","./I3SNode-92c7143c.js","./ReactiveSet-2b224343.js","./meshFeatureSet-3231dbe2.js","./External-45f5ccd1.js","./FeatureLayerView3D-40bafc47.js","./FeatureLayerViewBase3D-91374a1b.js","./FeatureLikeLayerView3D-8f33ec1f.js","./dehydratedFeatureComparison-43e0df71.js","./queryForSymbologySnapping-44fbc011.js","./elevationInfoUtils-25b84599.js","./hash-6f442295.js","./Graphics3DObjectStates-b80419b4.js","./optimizedFeatureQueryEngineAdapter-717c64bf.js","./PooledRBush-05d409af.js","./quickselect-fc5bb707.js","./floorFilterUtils-73949d2d.js","./QueryEngine-03d16de6.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-4576de5f.js","./utils-e24aed40.js","./generateRendererUtils-1c8bce12.js","./FeatureStore-d414226c.js","./BoundsStore-409e99ee.js","./projectExtentUtils-4faf6b68.js","./LayerView3D-239175ff.js","./query-ae6e69b4.js","./pbfQueryUtils-0854066b.js","./pbf-97a34880.js","./EventedSet-74df0505.js","./LayerView-840504cd.js","./RefreshableLayerView-c5fc5cdc.js","./SceneModification-81577e5e.js","./persistable-961aa677.js","./resourceExtension-6429cea6.js","./SceneLayerWorker-e4dafa49.js","./I3SQueryFeatureStore-ad2445f3.js","./DefinitionExpressionSceneLayerView-3b14bf49.js"],import.meta.url),csv:()=>pe(()=>import("./CSVLayerView3D-2f6662e3.js"),["./CSVLayerView3D-2f6662e3.js","./FeatureLayerViewBase3D-91374a1b.js","./FeatureLikeLayerView3D-8f33ec1f.js","./Query-630c5d65.js","./dehydratedFeatureComparison-43e0df71.js","./queryForSymbologySnapping-44fbc011.js","./elevationInfoUtils-25b84599.js","./hash-6f442295.js","./diffUtils-3ed1f592.js","./UniqueValueRenderer-176db886.js","./ColorStop-ac9a118d.js","./colorRamps-cf6fa9ce.js","./Graphics3DObjectStates-b80419b4.js","./jsonUtils-3d6448c4.js","./DictionaryLoader-1a1ab2cc.js","./FieldsIndex-85e142d0.js","./heatmapUtils-3c0e0ece.js","./defaults-4b2d7493.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-717c64bf.js","./PooledRBush-05d409af.js","./quickselect-fc5bb707.js","./popupUtils-049df13a.js","./FeatureFilter-5ab88729.js","./floorFilterUtils-73949d2d.js","./QueryEngine-03d16de6.js","./WhereClause-4988664d.js","./TimeOnly-a96593b0.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-4576de5f.js","./utils-e24aed40.js","./generateRendererUtils-1c8bce12.js","./FeatureSet-05a1ff98.js","./FeatureStore-d414226c.js","./BoundsStore-409e99ee.js","./projectExtentUtils-4faf6b68.js","./LayerView3D-239175ff.js","./query-ae6e69b4.js","./pbfQueryUtils-0854066b.js","./pbf-97a34880.js","./queryZScale-9dee68ff.js","./EventedSet-74df0505.js","./commonProperties-60f31277.js","./ElevationInfo-36952bdf.js","./FeatureEffect-40ff6b77.js","./jsonUtils-16d33138.js","./LayerView-840504cd.js","./RefreshableLayerView-c5fc5cdc.js"],import.meta.url),dimension:()=>pe(()=>import("./DimensionLayerView3D-1076bec2.js"),["./DimensionLayerView3D-1076bec2.js","./LayerView3D-239175ff.js","./LayerView-840504cd.js"],import.meta.url),elevation:Jee,feature:()=>pe(()=>import("./FeatureLayerView3D-40bafc47.js"),["./FeatureLayerView3D-40bafc47.js","./FeatureLayerViewBase3D-91374a1b.js","./FeatureLikeLayerView3D-8f33ec1f.js","./Query-630c5d65.js","./dehydratedFeatureComparison-43e0df71.js","./queryForSymbologySnapping-44fbc011.js","./elevationInfoUtils-25b84599.js","./hash-6f442295.js","./diffUtils-3ed1f592.js","./UniqueValueRenderer-176db886.js","./ColorStop-ac9a118d.js","./colorRamps-cf6fa9ce.js","./Graphics3DObjectStates-b80419b4.js","./jsonUtils-3d6448c4.js","./DictionaryLoader-1a1ab2cc.js","./FieldsIndex-85e142d0.js","./heatmapUtils-3c0e0ece.js","./defaults-4b2d7493.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-717c64bf.js","./PooledRBush-05d409af.js","./quickselect-fc5bb707.js","./popupUtils-049df13a.js","./FeatureFilter-5ab88729.js","./floorFilterUtils-73949d2d.js","./QueryEngine-03d16de6.js","./WhereClause-4988664d.js","./TimeOnly-a96593b0.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-4576de5f.js","./utils-e24aed40.js","./generateRendererUtils-1c8bce12.js","./FeatureSet-05a1ff98.js","./FeatureStore-d414226c.js","./BoundsStore-409e99ee.js","./projectExtentUtils-4faf6b68.js","./LayerView3D-239175ff.js","./query-ae6e69b4.js","./pbfQueryUtils-0854066b.js","./pbf-97a34880.js","./queryZScale-9dee68ff.js","./EventedSet-74df0505.js","./commonProperties-60f31277.js","./ElevationInfo-36952bdf.js","./FeatureEffect-40ff6b77.js","./jsonUtils-16d33138.js","./LayerView-840504cd.js","./RefreshableLayerView-c5fc5cdc.js"],import.meta.url),geojson:()=>pe(()=>import("./GeoJSONLayerView3D-046aa2df.js"),["./GeoJSONLayerView3D-046aa2df.js","./FeatureLayerViewBase3D-91374a1b.js","./FeatureLikeLayerView3D-8f33ec1f.js","./Query-630c5d65.js","./dehydratedFeatureComparison-43e0df71.js","./queryForSymbologySnapping-44fbc011.js","./elevationInfoUtils-25b84599.js","./hash-6f442295.js","./diffUtils-3ed1f592.js","./UniqueValueRenderer-176db886.js","./ColorStop-ac9a118d.js","./colorRamps-cf6fa9ce.js","./Graphics3DObjectStates-b80419b4.js","./jsonUtils-3d6448c4.js","./DictionaryLoader-1a1ab2cc.js","./FieldsIndex-85e142d0.js","./heatmapUtils-3c0e0ece.js","./defaults-4b2d7493.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-717c64bf.js","./PooledRBush-05d409af.js","./quickselect-fc5bb707.js","./popupUtils-049df13a.js","./FeatureFilter-5ab88729.js","./floorFilterUtils-73949d2d.js","./QueryEngine-03d16de6.js","./WhereClause-4988664d.js","./TimeOnly-a96593b0.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-4576de5f.js","./utils-e24aed40.js","./generateRendererUtils-1c8bce12.js","./FeatureSet-05a1ff98.js","./FeatureStore-d414226c.js","./BoundsStore-409e99ee.js","./projectExtentUtils-4faf6b68.js","./LayerView3D-239175ff.js","./query-ae6e69b4.js","./pbfQueryUtils-0854066b.js","./pbf-97a34880.js","./queryZScale-9dee68ff.js","./EventedSet-74df0505.js","./commonProperties-60f31277.js","./ElevationInfo-36952bdf.js","./FeatureEffect-40ff6b77.js","./jsonUtils-16d33138.js","./LayerView-840504cd.js","./RefreshableLayerView-c5fc5cdc.js"],import.meta.url),graphics:()=>pe(()=>import("./GraphicsLayerView3D-81baf03e.js"),["./GraphicsLayerView3D-81baf03e.js","./LayerView3D-239175ff.js","./queryForSymbologySnapping-44fbc011.js","./elevationInfoUtils-25b84599.js","./GraphicsProcessor-ef5fbca1.js","./diffUtils-3ed1f592.js","./Query-630c5d65.js","./Graphics3DObjectStates-b80419b4.js","./UniqueValueRenderer-176db886.js","./ColorStop-ac9a118d.js","./colorRamps-cf6fa9ce.js","./jsonUtils-3d6448c4.js","./DictionaryLoader-1a1ab2cc.js","./FieldsIndex-85e142d0.js","./heatmapUtils-3c0e0ece.js","./defaults-4b2d7493.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-717c64bf.js","./PooledRBush-05d409af.js","./quickselect-fc5bb707.js","./popupUtils-049df13a.js","./projectExtentUtils-4faf6b68.js","./LayerView-840504cd.js"],import.meta.url),group:()=>pe(()=>import("./GroupLayerView-caa49224.js"),["./GroupLayerView-caa49224.js","./LayerView-840504cd.js"],import.meta.url),imagery:()=>pe(()=>import("./ImageryLayerView3D-ae6638c9.js"),["./ImageryLayerView3D-ae6638c9.js","./DynamicLayerView3D-69073afb.js","./LayerView3D-239175ff.js","./projectExtentUtils-4faf6b68.js","./ImageMaterial-0b6c45d0.js","./LayerView-840504cd.js","./RefreshableLayerView-c5fc5cdc.js","./commonProperties-60f31277.js","./ElevationInfo-36952bdf.js","./Query-630c5d65.js","./popupUtils-049df13a.js"],import.meta.url),"integrated-mesh":()=>pe(()=>import("./IntegratedMeshLayerView3D-d1ef18ba.js"),["./IntegratedMeshLayerView3D-d1ef18ba.js","./I3SMeshView3D-ed8e6c8f.js","./I3SOverrides-fbc2eb85.js","./I3SNode-92c7143c.js","./I3SUtil-c67fd91a.js","./Query-630c5d65.js","./I3SBinaryReader-024c287a.js","./ReactiveSet-2b224343.js","./featureQueryAll-778379dd.js","./meshFeatureSet-3231dbe2.js","./External-45f5ccd1.js","./FeatureSet-05a1ff98.js","./FeatureLayerView3D-40bafc47.js","./FeatureLayerViewBase3D-91374a1b.js","./FeatureLikeLayerView3D-8f33ec1f.js","./dehydratedFeatureComparison-43e0df71.js","./queryForSymbologySnapping-44fbc011.js","./elevationInfoUtils-25b84599.js","./hash-6f442295.js","./diffUtils-3ed1f592.js","./UniqueValueRenderer-176db886.js","./ColorStop-ac9a118d.js","./colorRamps-cf6fa9ce.js","./Graphics3DObjectStates-b80419b4.js","./jsonUtils-3d6448c4.js","./DictionaryLoader-1a1ab2cc.js","./FieldsIndex-85e142d0.js","./heatmapUtils-3c0e0ece.js","./defaults-4b2d7493.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-717c64bf.js","./PooledRBush-05d409af.js","./quickselect-fc5bb707.js","./popupUtils-049df13a.js","./FeatureFilter-5ab88729.js","./floorFilterUtils-73949d2d.js","./QueryEngine-03d16de6.js","./WhereClause-4988664d.js","./TimeOnly-a96593b0.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-4576de5f.js","./utils-e24aed40.js","./generateRendererUtils-1c8bce12.js","./FeatureStore-d414226c.js","./BoundsStore-409e99ee.js","./projectExtentUtils-4faf6b68.js","./LayerView3D-239175ff.js","./query-ae6e69b4.js","./pbfQueryUtils-0854066b.js","./pbf-97a34880.js","./queryZScale-9dee68ff.js","./EventedSet-74df0505.js","./commonProperties-60f31277.js","./ElevationInfo-36952bdf.js","./FeatureEffect-40ff6b77.js","./jsonUtils-16d33138.js","./LayerView-840504cd.js","./RefreshableLayerView-c5fc5cdc.js","./SceneModification-81577e5e.js","./persistable-961aa677.js","./MD5-715f37cd.js","./resourceExtension-6429cea6.js","./SceneLayerWorker-e4dafa49.js"],import.meta.url),"line-of-sight":()=>pe(()=>import("./LineOfSightLayerView3D-d9a7cff2.js"),["./LineOfSightLayerView3D-d9a7cff2.js","./LayerView3D-239175ff.js","./LayerView-840504cd.js"],import.meta.url),"map-image":()=>pe(()=>import("./MapImageLayerView3D-f555b596.js"),["./MapImageLayerView3D-f555b596.js","./DynamicLayerView3D-69073afb.js","./LayerView3D-239175ff.js","./projectExtentUtils-4faf6b68.js","./ImageMaterial-0b6c45d0.js","./LayerView-840504cd.js","./RefreshableLayerView-c5fc5cdc.js","./commonProperties-60f31277.js","./ElevationInfo-36952bdf.js","./ExportImageParameters-9e86bb51.js","./floorFilterUtils-73949d2d.js","./sublayerUtils-109579ed.js","./MapServiceLayerViewHelper-ea990d3e.js","./popupUtils-049df13a.js","./drapedUtils-9a01dc8f.js"],import.meta.url),media:()=>pe(()=>import("./MediaLayerView3D-451f7ba1.js"),["./MediaLayerView3D-451f7ba1.js","./MediaElementView-80a4bcf7.js","./normalizeUtilsSync-344190b6.js","./LayerView3D-239175ff.js","./ImageMaterial-0b6c45d0.js","./LayerView-840504cd.js"],import.meta.url),"ogc-feature":()=>pe(()=>import("./OGCFeatureLayerView3D-0407cfab.js"),["./OGCFeatureLayerView3D-0407cfab.js","./FeatureLayerViewBase3D-91374a1b.js","./FeatureLikeLayerView3D-8f33ec1f.js","./Query-630c5d65.js","./dehydratedFeatureComparison-43e0df71.js","./queryForSymbologySnapping-44fbc011.js","./elevationInfoUtils-25b84599.js","./hash-6f442295.js","./diffUtils-3ed1f592.js","./UniqueValueRenderer-176db886.js","./ColorStop-ac9a118d.js","./colorRamps-cf6fa9ce.js","./Graphics3DObjectStates-b80419b4.js","./jsonUtils-3d6448c4.js","./DictionaryLoader-1a1ab2cc.js","./FieldsIndex-85e142d0.js","./heatmapUtils-3c0e0ece.js","./defaults-4b2d7493.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-717c64bf.js","./PooledRBush-05d409af.js","./quickselect-fc5bb707.js","./popupUtils-049df13a.js","./FeatureFilter-5ab88729.js","./floorFilterUtils-73949d2d.js","./QueryEngine-03d16de6.js","./WhereClause-4988664d.js","./TimeOnly-a96593b0.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-4576de5f.js","./utils-e24aed40.js","./generateRendererUtils-1c8bce12.js","./FeatureSet-05a1ff98.js","./FeatureStore-d414226c.js","./BoundsStore-409e99ee.js","./projectExtentUtils-4faf6b68.js","./LayerView3D-239175ff.js","./query-ae6e69b4.js","./pbfQueryUtils-0854066b.js","./pbf-97a34880.js","./queryZScale-9dee68ff.js","./EventedSet-74df0505.js","./commonProperties-60f31277.js","./ElevationInfo-36952bdf.js","./FeatureEffect-40ff6b77.js","./jsonUtils-16d33138.js","./LayerView-840504cd.js","./RefreshableLayerView-c5fc5cdc.js"],import.meta.url),"open-street-map":RE,"oriented-imagery":()=>pe(()=>import("./FeatureLayerView3D-40bafc47.js"),["./FeatureLayerView3D-40bafc47.js","./FeatureLayerViewBase3D-91374a1b.js","./FeatureLikeLayerView3D-8f33ec1f.js","./Query-630c5d65.js","./dehydratedFeatureComparison-43e0df71.js","./queryForSymbologySnapping-44fbc011.js","./elevationInfoUtils-25b84599.js","./hash-6f442295.js","./diffUtils-3ed1f592.js","./UniqueValueRenderer-176db886.js","./ColorStop-ac9a118d.js","./colorRamps-cf6fa9ce.js","./Graphics3DObjectStates-b80419b4.js","./jsonUtils-3d6448c4.js","./DictionaryLoader-1a1ab2cc.js","./FieldsIndex-85e142d0.js","./heatmapUtils-3c0e0ece.js","./defaults-4b2d7493.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-717c64bf.js","./PooledRBush-05d409af.js","./quickselect-fc5bb707.js","./popupUtils-049df13a.js","./FeatureFilter-5ab88729.js","./floorFilterUtils-73949d2d.js","./QueryEngine-03d16de6.js","./WhereClause-4988664d.js","./TimeOnly-a96593b0.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-4576de5f.js","./utils-e24aed40.js","./generateRendererUtils-1c8bce12.js","./FeatureSet-05a1ff98.js","./FeatureStore-d414226c.js","./BoundsStore-409e99ee.js","./projectExtentUtils-4faf6b68.js","./LayerView3D-239175ff.js","./query-ae6e69b4.js","./pbfQueryUtils-0854066b.js","./pbf-97a34880.js","./queryZScale-9dee68ff.js","./EventedSet-74df0505.js","./commonProperties-60f31277.js","./ElevationInfo-36952bdf.js","./FeatureEffect-40ff6b77.js","./jsonUtils-16d33138.js","./LayerView-840504cd.js","./RefreshableLayerView-c5fc5cdc.js"],import.meta.url),"point-cloud":()=>pe(()=>import("./PointCloudLayerView3D-5f07b375.js").then(t=>t.P),["./PointCloudLayerView3D-5f07b375.js","./LayerView3D-239175ff.js","./I3SUtil-c67fd91a.js","./Query-630c5d65.js","./I3SBinaryReader-024c287a.js","./PointCloudWorkerUtil-183a0b1e.js","./PointCloudUniqueValueRenderer-b39faed6.js","./ColorStop-ac9a118d.js","./PopupSceneLayerView-b9ac1823.js","./popupUtils-049df13a.js","./LayerView-840504cd.js"],import.meta.url),voxel:()=>pe(()=>import("./VoxelLayerView3D-8fa70479.js"),["./VoxelLayerView3D-8fa70479.js","./LayerView3D-239175ff.js","./PopupSceneLayerView-b9ac1823.js","./popupUtils-049df13a.js","./LayerView-840504cd.js"],import.meta.url),route:()=>pe(()=>import("./RouteLayerView3D-fa2064e5.js"),["./RouteLayerView3D-fa2064e5.js","./Stop-848b410a.js","./LayerView3D-239175ff.js","./GraphicsProcessor-ef5fbca1.js","./diffUtils-3ed1f592.js","./Query-630c5d65.js","./Graphics3DObjectStates-b80419b4.js","./UniqueValueRenderer-176db886.js","./ColorStop-ac9a118d.js","./colorRamps-cf6fa9ce.js","./jsonUtils-3d6448c4.js","./DictionaryLoader-1a1ab2cc.js","./FieldsIndex-85e142d0.js","./heatmapUtils-3c0e0ece.js","./defaults-4b2d7493.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-717c64bf.js","./PooledRBush-05d409af.js","./quickselect-fc5bb707.js","./popupUtils-049df13a.js","./projectExtentUtils-4faf6b68.js","./EventedSet-74df0505.js","./LayerView-840504cd.js"],import.meta.url),scene:t=>t.profile==null||t.profile==="mesh-pyramids"?pe(()=>import("./SceneLayerView3D-87257e19.js"),["./SceneLayerView3D-87257e19.js","./ReactiveSet-2b224343.js","./WhereClause-4988664d.js","./TimeOnly-a96593b0.js","./FeatureFilter-5ab88729.js","./Query-630c5d65.js","./floorFilterUtils-73949d2d.js","./I3SMeshView3D-ed8e6c8f.js","./I3SOverrides-fbc2eb85.js","./I3SNode-92c7143c.js","./I3SUtil-c67fd91a.js","./I3SBinaryReader-024c287a.js","./featureQueryAll-778379dd.js","./meshFeatureSet-3231dbe2.js","./External-45f5ccd1.js","./FeatureSet-05a1ff98.js","./FeatureLayerView3D-40bafc47.js","./FeatureLayerViewBase3D-91374a1b.js","./FeatureLikeLayerView3D-8f33ec1f.js","./dehydratedFeatureComparison-43e0df71.js","./queryForSymbologySnapping-44fbc011.js","./elevationInfoUtils-25b84599.js","./hash-6f442295.js","./diffUtils-3ed1f592.js","./UniqueValueRenderer-176db886.js","./ColorStop-ac9a118d.js","./colorRamps-cf6fa9ce.js","./Graphics3DObjectStates-b80419b4.js","./jsonUtils-3d6448c4.js","./DictionaryLoader-1a1ab2cc.js","./FieldsIndex-85e142d0.js","./heatmapUtils-3c0e0ece.js","./defaults-4b2d7493.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-717c64bf.js","./PooledRBush-05d409af.js","./quickselect-fc5bb707.js","./popupUtils-049df13a.js","./QueryEngine-03d16de6.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-4576de5f.js","./utils-e24aed40.js","./generateRendererUtils-1c8bce12.js","./FeatureStore-d414226c.js","./BoundsStore-409e99ee.js","./projectExtentUtils-4faf6b68.js","./LayerView3D-239175ff.js","./query-ae6e69b4.js","./pbfQueryUtils-0854066b.js","./pbf-97a34880.js","./queryZScale-9dee68ff.js","./EventedSet-74df0505.js","./commonProperties-60f31277.js","./ElevationInfo-36952bdf.js","./FeatureEffect-40ff6b77.js","./jsonUtils-16d33138.js","./LayerView-840504cd.js","./RefreshableLayerView-c5fc5cdc.js","./SceneModification-81577e5e.js","./persistable-961aa677.js","./MD5-715f37cd.js","./resourceExtension-6429cea6.js","./SceneLayerWorker-e4dafa49.js","./SceneLayerView-1a07e2f6.js","./DefinitionExpressionSceneLayerView-3b14bf49.js","./I3SQueryFeatureStore-ad2445f3.js","./PopupSceneLayerView-b9ac1823.js"],import.meta.url):pe(()=>import("./SceneLayerGraphicsView3D-d3d2ee99.js"),["./SceneLayerGraphicsView3D-d3d2ee99.js","./I3SOverrides-fbc2eb85.js","./I3SNode-92c7143c.js","./I3SUtil-c67fd91a.js","./Query-630c5d65.js","./I3SBinaryReader-024c287a.js","./ReactiveSet-2b224343.js","./featureQueryAll-778379dd.js","./meshFeatureSet-3231dbe2.js","./External-45f5ccd1.js","./FeatureSet-05a1ff98.js","./FeatureLayerView3D-40bafc47.js","./FeatureLayerViewBase3D-91374a1b.js","./FeatureLikeLayerView3D-8f33ec1f.js","./dehydratedFeatureComparison-43e0df71.js","./queryForSymbologySnapping-44fbc011.js","./elevationInfoUtils-25b84599.js","./hash-6f442295.js","./diffUtils-3ed1f592.js","./UniqueValueRenderer-176db886.js","./ColorStop-ac9a118d.js","./colorRamps-cf6fa9ce.js","./Graphics3DObjectStates-b80419b4.js","./jsonUtils-3d6448c4.js","./DictionaryLoader-1a1ab2cc.js","./FieldsIndex-85e142d0.js","./heatmapUtils-3c0e0ece.js","./defaults-4b2d7493.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-717c64bf.js","./PooledRBush-05d409af.js","./quickselect-fc5bb707.js","./popupUtils-049df13a.js","./FeatureFilter-5ab88729.js","./floorFilterUtils-73949d2d.js","./QueryEngine-03d16de6.js","./WhereClause-4988664d.js","./TimeOnly-a96593b0.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-4576de5f.js","./utils-e24aed40.js","./generateRendererUtils-1c8bce12.js","./FeatureStore-d414226c.js","./BoundsStore-409e99ee.js","./projectExtentUtils-4faf6b68.js","./LayerView3D-239175ff.js","./query-ae6e69b4.js","./pbfQueryUtils-0854066b.js","./pbf-97a34880.js","./queryZScale-9dee68ff.js","./EventedSet-74df0505.js","./commonProperties-60f31277.js","./ElevationInfo-36952bdf.js","./FeatureEffect-40ff6b77.js","./jsonUtils-16d33138.js","./LayerView-840504cd.js","./RefreshableLayerView-c5fc5cdc.js","./SceneLayerView-1a07e2f6.js","./DefinitionExpressionSceneLayerView-3b14bf49.js","./PopupSceneLayerView-b9ac1823.js"],import.meta.url),stream:()=>pe(()=>import("./StreamLayerView3D-6145dbc6.js"),["./StreamLayerView3D-6145dbc6.js","./StreamFeatureManager-8348c744.js","./createConnection-2daa0cd5.js","./query-ae6e69b4.js","./pbfQueryUtils-0854066b.js","./pbf-97a34880.js","./queryZScale-9dee68ff.js","./Query-630c5d65.js","./EventedSet-74df0505.js","./FeatureLikeLayerView3D-8f33ec1f.js","./dehydratedFeatureComparison-43e0df71.js","./queryForSymbologySnapping-44fbc011.js","./elevationInfoUtils-25b84599.js","./hash-6f442295.js","./diffUtils-3ed1f592.js","./UniqueValueRenderer-176db886.js","./ColorStop-ac9a118d.js","./colorRamps-cf6fa9ce.js","./Graphics3DObjectStates-b80419b4.js","./jsonUtils-3d6448c4.js","./DictionaryLoader-1a1ab2cc.js","./FieldsIndex-85e142d0.js","./heatmapUtils-3c0e0ece.js","./defaults-4b2d7493.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-717c64bf.js","./PooledRBush-05d409af.js","./quickselect-fc5bb707.js","./popupUtils-049df13a.js","./FeatureFilter-5ab88729.js","./floorFilterUtils-73949d2d.js","./QueryEngine-03d16de6.js","./WhereClause-4988664d.js","./TimeOnly-a96593b0.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-4576de5f.js","./utils-e24aed40.js","./generateRendererUtils-1c8bce12.js","./FeatureSet-05a1ff98.js","./FeatureStore-d414226c.js","./BoundsStore-409e99ee.js","./projectExtentUtils-4faf6b68.js","./LayerView3D-239175ff.js","./LayerView-840504cd.js"],import.meta.url),tile:RE,"imagery-tile":()=>pe(()=>import("./ImageryTileLayerView3D-21d425d7.js"),["./ImageryTileLayerView3D-21d425d7.js","./rasterProjectionHelper-3356de65.js","./LayerView3D-239175ff.js","./TiledLayerView3D-791dea7d.js","./commonProperties-60f31277.js","./ElevationInfo-36952bdf.js","./popupUtils-049df13a.js","./LayerView-840504cd.js","./RefreshableLayerView-c5fc5cdc.js","./drapedUtils-9a01dc8f.js"],import.meta.url),"vector-tile":()=>pe(()=>import("./VectorTileLayerView3D-42a7b126.js"),["./VectorTileLayerView3D-42a7b126.js","./Rect-98da58d6.js","./pbf-97a34880.js","./rasterizingUtils-13352f0c.js","./vec4f32-0d1b2306.js","./definitions-5359da6f.js","./enums-9d4f5c11.js","./number-e491b09e.js","./GeometryUtils-0258f920.js","./StyleRepository-9854daae.js","./TileClipper-ae6eca9e.js","./LayerView3D-239175ff.js","./TiledLayerView3D-791dea7d.js","./LayerView-840504cd.js"],import.meta.url),wcs:()=>pe(()=>import("./ImageryTileLayerView3D-21d425d7.js"),["./ImageryTileLayerView3D-21d425d7.js","./rasterProjectionHelper-3356de65.js","./LayerView3D-239175ff.js","./TiledLayerView3D-791dea7d.js","./commonProperties-60f31277.js","./ElevationInfo-36952bdf.js","./popupUtils-049df13a.js","./LayerView-840504cd.js","./RefreshableLayerView-c5fc5cdc.js","./drapedUtils-9a01dc8f.js"],import.meta.url),"web-tile":RE,wfs:()=>pe(()=>import("./WFSLayerView3D-e962f8a3.js"),["./WFSLayerView3D-e962f8a3.js","./FeatureLayerViewBase3D-91374a1b.js","./FeatureLikeLayerView3D-8f33ec1f.js","./Query-630c5d65.js","./dehydratedFeatureComparison-43e0df71.js","./queryForSymbologySnapping-44fbc011.js","./elevationInfoUtils-25b84599.js","./hash-6f442295.js","./diffUtils-3ed1f592.js","./UniqueValueRenderer-176db886.js","./ColorStop-ac9a118d.js","./colorRamps-cf6fa9ce.js","./Graphics3DObjectStates-b80419b4.js","./jsonUtils-3d6448c4.js","./DictionaryLoader-1a1ab2cc.js","./FieldsIndex-85e142d0.js","./heatmapUtils-3c0e0ece.js","./defaults-4b2d7493.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-717c64bf.js","./PooledRBush-05d409af.js","./quickselect-fc5bb707.js","./popupUtils-049df13a.js","./FeatureFilter-5ab88729.js","./floorFilterUtils-73949d2d.js","./QueryEngine-03d16de6.js","./WhereClause-4988664d.js","./TimeOnly-a96593b0.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-4576de5f.js","./utils-e24aed40.js","./generateRendererUtils-1c8bce12.js","./FeatureSet-05a1ff98.js","./FeatureStore-d414226c.js","./BoundsStore-409e99ee.js","./projectExtentUtils-4faf6b68.js","./LayerView3D-239175ff.js","./query-ae6e69b4.js","./pbfQueryUtils-0854066b.js","./pbf-97a34880.js","./queryZScale-9dee68ff.js","./EventedSet-74df0505.js","./commonProperties-60f31277.js","./ElevationInfo-36952bdf.js","./FeatureEffect-40ff6b77.js","./jsonUtils-16d33138.js","./LayerView-840504cd.js","./RefreshableLayerView-c5fc5cdc.js"],import.meta.url),wms:()=>pe(()=>import("./WMSLayerView3D-cca65b29.js"),["./WMSLayerView3D-cca65b29.js","./DynamicLayerView3D-69073afb.js","./LayerView3D-239175ff.js","./projectExtentUtils-4faf6b68.js","./ImageMaterial-0b6c45d0.js","./LayerView-840504cd.js","./RefreshableLayerView-c5fc5cdc.js","./commonProperties-60f31277.js","./ElevationInfo-36952bdf.js","./ExportWMSImageParameters-881fad92.js"],import.meta.url),wmts:()=>pe(()=>import("./WMTSLayerView3D-33c9523d.js"),["./WMTSLayerView3D-33c9523d.js","./LayerView3D-239175ff.js","./TiledLayerView3D-791dea7d.js","./LayerView-840504cd.js","./RefreshableLayerView-c5fc5cdc.js"],import.meta.url),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};function FVe(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",i=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new W(`${i}:view-not-supported`,`${e} is not supported in 3D`)}const Qee={hasLayerViewModule:t=>Kee[t.type]!=null,importLayerView:t=>{const e=Kee[t.type];if(e==null)throw FVe(t);return e(t)}},ete="analyses-owner-handles";var B2,C1;(function(t){t[t.PENDING=0]="PENDING",t[t.CREATED=1]="CREATED"})(B2||(B2={})),function(t){t[t.ADDED=0]="ADDED",t[t.REMOVED=1]="REMOVED"}(C1||(C1={}));let t1=class extends xe{constructor(e){super(e),this._allAnalysisViews=new ft,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=tte(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(pi("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(pi()),this._attachedToViewResolver=tte()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const i=this._items.get(e);if(i==null||i.state.list===C1.REMOVED)throw new W("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return i.createAnalysisViewTask.promise}_connectOwners(){this.addHandles(this._connectAnalysesCollection(this.view.analyses),ete)}_disconnectOwners(){this.removeHandles(ete),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const n of e)this._addAnalysis(n);const i=e.on("after-add",n=>this._addAnalysis(n.item)),r=e.on("after-remove",n=>this._removeAnalysis(n.item));return Mi(()=>{i.remove(),r.remove();for(const n of e)this._removeAnalysis(n)})}_addAnalysis(e){const i=this._items.get(e);if(i==null){const r={state:{view:B2.PENDING,list:C1.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,r),r.createAnalysisViewTask=S_(n=>this._createAnalysisViewPromise(r,n))}else i.state.list=C1.ADDED}_removeAnalysis(e){const i=this._items.get(e);i!=null?(i.state.list=C1.REMOVED,this._scheduleUpdate()):ne.getLogger(this).error("Trying to remove analysis which was not added")}_scheduleUpdate(){this._scheduledUpdateHandle==null&&(this._scheduledUpdateHandle=PS(()=>this._update()))}_update(){this._scheduledUpdateHandle=pr(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===C1.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case B2.PENDING:e.createAnalysisViewTask=nc(e.createAnalysisViewTask);break;case B2.CREATED:e.view!=null&&(this._allAnalysisViews.remove(e.view),e.view=Pe(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,i){const r=e.analysis,n=r.type,s=this._analysisModules[n];if(this._creatingViewCount+=1,s.module==null)try{s.module=await this._loadAnalysisModule(n)}catch(a){throw this._creatingViewCount-=1,a}if(Hn(i))throw this._creatingViewCount-=1,pi("AnalysisView creation aborted");const o=new s.module.default({analysis:r,view:this.view});try{await o.when()}catch(a){throw this._creatingViewCount-=1,a}if(Hn(i))throw this._creatingViewCount-=1,o.destroy(),pi("AnalysisView creation aborted");return e.view=o,e.state.view=B2.CREATED,this._allAnalysisViews.add(o),this._creatingViewCount-=1,o}_loadAnalysisModule(e){switch(e){case"area-measurement":return pe(()=>import("./AreaMeasurementAnalysisView3D-d69dcb05.js").then(i=>i.A),["./AreaMeasurementAnalysisView3D-d69dcb05.js","./UnitNormalizer-021d0e91.js","./Segment-ec50fd17.js","./unitFormatUtils-4b3497b3.js","./LineVisualElement-fc7385d7.js","./elevationInfoUtils-25b84599.js","./geometryEngine-11d58676.js","./geometryEngineBase-2020e3dc.js","./hydrated-1ef0bde6.js","./EditGeometryOperations-aafb8f81.js"],import.meta.url);case"dimension":return pe(()=>import("./DimensionAnalysisView3D-97b08dcc.js").then(i=>i.D),["./DimensionAnalysisView3D-97b08dcc.js","./LineVisualElement-fc7385d7.js","./LengthDimension-aec24abc.js","./Segment-ec50fd17.js","./unitFormatUtils-4b3497b3.js","./elevationInfoUtils-25b84599.js","./analysisViewUtils-d9ecfeae.js","./Factory-9cf1118b.js","./ImageMaterial-0b6c45d0.js","./vec4f32-0d1b2306.js","./RightAngleQuadVisualElement-f61633a8.js","./PointVisualElement-8a3927d0.js","./Query-630c5d65.js","./EditGeometryOperations-aafb8f81.js","./FeatureFilter-5ab88729.js","./floorFilterUtils-73949d2d.js","./dehydratedFeatureComparison-43e0df71.js"],import.meta.url);case"direct-line-measurement":return pe(()=>import("./DirectLineMeasurementAnalysisView3D-d1befe55.js").then(i=>i.D),["./DirectLineMeasurementAnalysisView3D-d1befe55.js","./UnitNormalizer-021d0e91.js","./Segment-ec50fd17.js","./unitFormatUtils-4b3497b3.js","./LineVisualElement-fc7385d7.js","./elevationInfoUtils-25b84599.js","./geometryEngine-11d58676.js","./geometryEngineBase-2020e3dc.js","./hydrated-1ef0bde6.js","./RightAngleQuadVisualElement-f61633a8.js"],import.meta.url);case"line-of-sight":return pe(()=>import("./LineOfSightAnalysisView3D-7d71182d.js"),["./LineOfSightAnalysisView3D-7d71182d.js","./LineVisualElement-fc7385d7.js","./LineOfSightAnalysisTarget-cabc86a8.js","./persistable-961aa677.js","./MD5-715f37cd.js","./resourceExtension-6429cea6.js","./ElevationInfo-36952bdf.js","./elevationInfoUtils-25b84599.js","./analysisViewUtils-d9ecfeae.js","./PointVisualElement-8a3927d0.js"],import.meta.url);case"slice":return pe(()=>import("./SliceAnalysisView3D-f3fc87b3.js").then(i=>i.S),["./SliceAnalysisView3D-f3fc87b3.js","./LineVisualElement-fc7385d7.js","./persistable-961aa677.js","./MD5-715f37cd.js","./resourceExtension-6429cea6.js","./BuildingComponentSublayer-00e240d7.js","./UniqueValueRenderer-176db886.js","./ColorStop-ac9a118d.js","./diffUtils-3ed1f592.js","./colorRamps-cf6fa9ce.js","./jsonUtils-3d6448c4.js","./DictionaryLoader-1a1ab2cc.js","./FieldsIndex-85e142d0.js","./heatmapUtils-3c0e0ece.js","./FeatureLayer-72a3b1cd.js","./FeatureLayerBase-56c03a7a.js","./commonProperties-60f31277.js","./ElevationInfo-36952bdf.js","./featureLayerUtils-d891b150.js","./featureQueryAll-778379dd.js","./Query-630c5d65.js","./AttachmentQuery-ac66f9a7.js","./RelationshipQuery-249800df.js","./LayerFloorInfo-5c97dc41.js","./serviceCapabilitiesUtils-1513785a.js","./editsZScale-03b9f186.js","./queryZScale-9dee68ff.js","./FeatureSet-05a1ff98.js","./APIKeyMixin-9d7343aa.js","./ArcGISService-1771a240.js","./BlendLayer-dce91235.js","./jsonUtils-16d33138.js","./CustomParametersMixin-45f14a7d.js","./EditBusLayer-3babd061.js","./FeatureEffectLayer-50d5188d.js","./FeatureEffect-40ff6b77.js","./FeatureFilter-5ab88729.js","./FeatureReductionLayer-826e078c.js","./FeatureReductionSelection-4ea33fb1.js","./LabelClass-06cdad9c.js","./defaults-4b2d7493.js","./defaultsJSON-59981e75.js","./OperationalLayer-5c10068f.js","./OrderedLayer-b68b3bb4.js","./PortalLayer-c3739096.js","./ScaleRangeLayer-5b526f5a.js","./TemporalLayer-683091de.js","./FeatureTemplate-0e5c0008.js","./FeatureType-347e5e8f.js","./fieldProperties-49b9eb67.js","./labelingInfo-4784a348.js","./versionUtils-e8eeb271.js","./styleUtils-f17e2eb8.js","./TopFeaturesQuery-268791e0.js","./popupUtils-6f3d55df.js","./capabilities-c607cf72.js","./I3SIndexInfo-79029bcd.js","./I3SLayerDefinitions-a9c572ad.js","./I3SUtil-c67fd91a.js","./I3SBinaryReader-024c287a.js","./popupUtils-049df13a.js","./analysisViewUtils-d9ecfeae.js","./Factory-9cf1118b.js","./ImageMaterial-0b6c45d0.js"],import.meta.url)}}};function tte(){const t=vs();return t.promise.catch(()=>{}),t}h([f()],t1.prototype,"updating",null),h([f({constructOnly:!0})],t1.prototype,"view",void 0),h([f()],t1.prototype,"_allAnalysisViews",void 0),h([f()],t1.prototype,"_creatingViewCount",void 0),t1=h([z("esri.views.3d.analysis.AnalysisViewManager3D")],t1);const kVe=t1;let Im=class extends xe{constructor(e){super(e),this.collision=new iA,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===Me.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==Me.Local?this._set("altitude",e):ne.getLogger(this).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?_e(e,this.altitude.min,this.altitude.max):e}clampTilt(e,i){if(!this.tilt)return i;const r=this.tilt(e);return _e(i,r.min,r.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===Me.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(i,r=k6)=>(r.min=Co.min,r.max=e,r)}_createDefaultTiltLocal(){const e=this.collision.enabled?oL([[4e3,Co.max],[1e4,Rt(88)],[6e6,Rt(88)]]):()=>Co.max;return(i,r=k6)=>(r.min=Co.min,r.max=e(i),r)}_createDefaultTiltGlobal(){const e=this.collision.enabled?oL([[4e3,Co.max],[5e4,Rt(88)],[6e6,Rt(88)],[2e7,Co.min]]):oL([[3e5,Co.max],[3e6,Rt(88)],[6e6,Rt(88)],[2e7,Co.min]]);return(i,r=k6)=>(r.min=Co.min,r.max=e(i),r)}};function UVe(t){return{min:-2e5,max:4*t.radius}}h([f()],Im.prototype,"altitude",null),h([f({readOnly:!0})],Im.prototype,"collision",void 0),h([f()],Im.prototype,"distance",void 0),h([f({readOnly:!0})],Im.prototype,"minimumPoiDistance",void 0),h([f()],Im.prototype,"tilt",void 0),h([f({constructOnly:!0})],Im.prototype,"mode",void 0),Im=h([z("esri.views.3d.state.Constraints")],Im);const ite=UVe(yi),Co={min:Rt(.5),max:Rt(179.5)},k6={min:0,max:0};let iA=class extends xe{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};h([f({type:Boolean})],iA.prototype,"enabled",void 0),h([f({type:Number})],iA.prototype,"elevationMargin",void 0),iA=h([z("esri.views.3d.state.Constraints.CollisionConstraint")],iA);let V2=class extends xe{constructor(){super(...arguments),this.min=ite.min,this.max=ite.max}};h([f({type:Number})],V2.prototype,"min",void 0),h([f({type:Number})],V2.prototype,"max",void 0),V2=h([z("esri.views.3d.constraints.AltitudeConstraint")],V2);let Gm=class extends xe{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,i){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==i&&this._set("far",i))}};h([f({type:Number,value:1e-8})],Gm.prototype,"near",null),h([rr("near")],Gm.prototype,"castNear",null),h([f({type:Number,value:1e-8})],Gm.prototype,"far",null),h([rr("far")],Gm.prototype,"castFar",null),h([f({type:["auto","manual"]})],Gm.prototype,"mode",void 0),Gm=h([z("esri.views.3d.constraints.ClipDistanceConstraint")],Gm);const _7={min:za(Co.min),max:za(Co.max)};let A1=class extends xe{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return _e(e,_7.min,_7.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};h([f({type:["auto","manual"]})],A1.prototype,"mode",void 0),h([f({type:Number,value:_7.max})],A1.prototype,"max",null),h([rr("max")],A1.prototype,"castMax",null),A1=h([z("esri.views.3d.constraints.TiltConstraint")],A1);let O1=class extends xe{constructor(){super(...arguments),this.tilt=new A1,this.altitude=new V2,this.clipDistance=new Gm}};h([f({type:A1})],O1.prototype,"tilt",void 0),h([f({type:V2})],O1.prototype,"altitude",void 0),h([f({type:Gm})],O1.prototype,"clipDistance",void 0),O1=h([z("esri.views.3d.constraints.Constraints")],O1);var o2;const N_e="esri.views.3d.environment.SunLighting",rM=ne.getLogger(N_e);let jp=o2=class extends Tn.EventedMixin(Rb){constructor(t){super(t),this.cameraTrackingEnabled=!0,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),i=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",i),this._set("date",i)}get ambientOcclusionEnabled(){return Ay(rM,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(t){Ay(rM,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",t)}get waterReflectionEnabled(){return Ay(rM,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(t){Ay(rM,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",t)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(t){return new o2(t.cloneConstructProperties())}set defaultDate(t){const e=this._get("date")===this._get("defaultDate");t=new Date(t.getTime()),this._set("defaultDate",t),e&&this._set("date",t)}set date(t){t!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t.getTime())))}autoUpdate(t,e){const i=o2.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let r=null;t!=null&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(r=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(r=this.date&&this.date.getTime(),this._set("date",new Date(t.getTime()))));const n=o2.calculateTimezoneOffset(this.positionTimezoneInfo);if(i!==n&&(nM.target=this,nM.timezoneOffset=n,this.emit("timezone-will-change",nM),nM.target=null),t!=null)return isNaN(t.getTime())||r!==t.getTime()}clone(){const t=this._get("date")===this._get("defaultDate"),e=new o2({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});return t&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(t){const e=this.clone();return t.date!=null&&(e.date=t.date),e.directShadowsEnabled=t.directShadowsEnabled,e.displayUTCOffset=t.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};h([f({type:Boolean})],jp.prototype,"cameraTrackingEnabled",void 0),h([f({type:Boolean})],jp.prototype,"ambientOcclusionEnabled",null),h([f({type:Boolean})],jp.prototype,"waterReflectionEnabled",null),h([f({type:Date})],jp.prototype,"defaultDate",null),h([f({type:Date})],jp.prototype,"date",null),jp=o2=h([z(N_e)],jp),function(t){function e({hours:i,minutes:r,seconds:n}){return Math.round(i+r/60+n/3600)}t.calculateTimezoneOffset=e}(jp||(jp={}));const nM={target:null,timezoneOffset:0},i1=jp;var fL;const F_e="esri.views.3d.environment.VirtualLighting",sM=ne.getLogger(F_e);let a2=fL=class extends Tn.EventedMixin(dR){constructor(t){super(t),this.cameraTrackingEnabled=!0}get ambientOcclusionEnabled(){return Ay(sM,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(t){Ay(sM,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",t)}get waterReflectionEnabled(){return Ay(sM,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(t){Ay(sM,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",t)}clone(){return new fL({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(t){return new fL(t.cloneConstructProperties())}cloneWithWebsceneLighting(t){const e=this.clone();return e.directShadowsEnabled=t.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};h([f({type:Boolean})],a2.prototype,"ambientOcclusionEnabled",null),h([f({type:Boolean})],a2.prototype,"waterReflectionEnabled",null),h([f({type:Boolean})],a2.prototype,"cameraTrackingEnabled",void 0),a2=fL=h([z(F_e)],a2);const rA=a2,zVe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:i1,virtual:rA}};var v7;let s3=v7=class extends xe{set quality(t){["low","high"].includes(t)&&this._set("quality",t)}clone(){return new v7({quality:this.quality})}};h([f({type:["low","high"],value:"low"})],s3.prototype,"quality",null),s3=v7=h([z("esri.views.3d.environment.SceneViewAtmosphere")],s3);var nA;let l2=nA=class extends HT{constructor(t){super(t),this.atmosphere=new s3,this.lighting=this.castLighting(),this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(t){const e=t.cloneConstructProperties();return new nA({...e,lighting:e.lighting?e.lighting.type==="virtual"?rA.fromWebsceneLighting(e.lighting):i1.fromWebsceneLighting(e.lighting):void 0})}castLighting(t){return this._convertLightingWithDestroy(t)}applyLighting(t){this.lighting=this._convertLightingWithDestroy(t)}_convertLightingWithDestroy(t){const e=this._convertLighting(t);return e!==t&&this.addHandles(Jue(e)),e}_convertLighting(t){return t?t instanceof i1||t instanceof rA?t:t instanceof Rb?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(t):new i1({...t.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):t instanceof dR?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t):new rA({...t.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):Ky(zVe,t):new i1}clone(){return new nA({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ye(this.background)})}cloneWithWebsceneEnvironment(t){return new nA({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ye(this.background),...t.cloneConstructProperties(),lighting:this._getLighting(t)})}_getLighting(t){switch(t.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(t.lighting):i1.fromWebsceneLighting(t.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t.lighting):rA.fromWebsceneLighting(t.lighting);default:return t.lighting,i1.fromWebsceneLighting(t.lighting)}}};h([f({type:s3,json:{read:!1},nonNullable:!0})],l2.prototype,"atmosphere",void 0),h([f({nonNullable:!0})],l2.prototype,"lighting",void 0),h([rr("lighting")],l2.prototype,"castLighting",null),l2=nA=h([z("esri.views.3d.environment.SceneViewEnvironment")],l2);const c2=l2;function BVe(t,e,i){if(e==null)return!1;const r=sfe(e);return r!=null&&(r(t,0,PE,0),i!==PE&&(i[0]=PE[0],i[1]=PE[1],i.length>2&&(i[2]=PE[2])),!0)}const PE=C();function VVe(t,e){oM[0]=t.x,oM[1]=t.y;const i=t.z;return oM[2]=i!==void 0?i:0,BVe(oM,t.spatialReference,e)}const oM=C();var Ho;(function(t){t[t.Realistic=0]="Realistic",t[t.Local=1]="Local",t[t.Mars=2]="Mars",t[t.None=3]="None"})(Ho||(Ho={}));function GVe(t){return"r"in t&&"g"in t&&"b"in t}function k_e(t){return"h"in t&&"s"in t&&"v"in t}function U_e(t){return"l"in t&&"a"in t&&"b"in t}function z_e(t){return"l"in t&&"c"in t&&"h"in t}function jVe(t){return"x"in t&&"y"in t&&"z"in t}const HVe=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],qVe=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function B_e(t,e){const i=[];let r,n;if(t[0].length!==e.length)throw new Error("dimensions do not match");const s=t.length,o=t[0].length;let a=0;for(r=0;r<s;r++){for(a=0,n=0;n<o;n++)a+=t[r][n]*e[n];i.push(a)}return i}function V_e(t){const e=[t.r/255,t.g/255,t.b/255].map(r=>r<=.04045?r/12.92:((r+.055)/1.055)**2.4),i=B_e(HVe,e);return{x:100*i[0],y:100*i[1],z:100*i[2]}}function oY(t){const e=B_e(qVe,[t.x/100,t.y/100,t.z/100]).map(i=>{const r=i<=.0031308?12.92*i:1.055*i**.4166666666666667-.055;return Math.min(1,Math.max(r,0))});return{r:Math.round(255*e[0]),g:Math.round(255*e[1]),b:Math.round(255*e[2])}}function G_e(t){const e=[t.x/95.047,t.y/100,t.z/108.883].map(i=>i>.008856451679035631?i**.3333333333333333:7.787037037037035*i+.13793103448275862);return{l:116*e[1]-16,a:500*(e[0]-e[1]),b:200*(e[1]-e[2])}}function j_e(t){const e=t.l,i=[(e+16)/116+t.a/500,(e+16)/116,(e+16)/116-t.b/200].map(r=>r>6/29?r**3:3*(6/29)**2*(r-4/29));return{x:95.047*i[0],y:100*i[1],z:108.883*i[2]}}function WVe(t){const e=t.l,i=t.a,r=t.b,n=Math.sqrt(i*i+r*r);let s=Math.atan2(r,i);return s=s>0?s:s+2*Math.PI,{l:e,c:n,h:s}}function YVe(t){const e=t.l,i=t.c,r=t.h;return{l:e,a:i*Math.cos(r),b:i*Math.sin(r)}}function XVe(t){return G_e(V_e(t))}function ZVe(t){return oY(j_e(t))}function JVe(t){return WVe(G_e(V_e(t)))}function KVe(t){return oY(j_e(YVe(t)))}function QVe(t){const e=t.r,i=t.g,r=t.b,n=Math.max(e,i,r),s=n-Math.min(e,i,r);let o=n,a=s===0?0:n===e?(i-r)/s%6:n===i?(r-e)/s+2:(e-i)/s+4,l=s===0?0:s/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}function e7e(t){const e=(t.h+360)%360/60,i=t.s/100,r=t.v/100*255,n=r*i,s=n*(1-Math.abs(e%2-1));let o;switch(Math.floor(e)){case 0:o={r:n,g:s,b:0};break;case 1:o={r:s,g:n,b:0};break;case 2:o={r:0,g:n,b:s};break;case 3:o={r:0,g:s,b:n};break;case 4:o={r:s,g:0,b:n};break;case 5:case 6:o={r:n,g:0,b:s};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+r-n),o.g=Math.round(o.g+r-n),o.b=Math.round(o.b+r-n),o}function aY(t){return GVe(t)?t:z_e(t)?KVe(t):U_e(t)?ZVe(t):jVe(t)?oY(t):k_e(t)?e7e(t):t}function HOt(t){return k_e(t)?t:QVe(aY(t))}function qOt(t){return U_e(t)?t:XVe(aY(t))}function WOt(t){return z_e(t)?t:JVe(aY(t))}function t7e(t){let{r:e,g:i,b:r,a:n}=t;return n<1&&(e=Math.round(n*e+255*(1-n)),i=Math.round(n*i+255*(1-n)),r=Math.round(n*r+255*(1-n))),new Ye({r:e,g:i,b:r})}function i7e(t,e){const{r:i,g:r,b:n}=e?.ignoreAlpha?t:t7e(t);return .2126*i+.7152*r+.0722*n}var b7;function YOt(t,e=b7.High){return i7e(t,{ignoreAlpha:!0})>e?new Ye([0,0,0,t.a]):new Ye([255,255,255,t.a])}function XOt(t,e){const i=t.clone();return i.a*=e,i}function pO(t){return Ye.toUnitRGBA(t)}function ZOt(t,e){return t===e||t!=null&&e!=null&&Sb(t,e)}function JOt(t){return Mt(t[0],t[1],t[2],t.length>3?t[3]:1)}function KOt(t,e){const i=Ye.toUnitRGBA(t);return i[3]*=e,i}(function(t){t[t.Low=160]="Low",t[t.High=225]="High"})(b7||(b7={}));function Yn(t,e){return t[0]=e[0],t[1]=e[1],t}function si(t,e,i){return t[0]=e,t[1]=i,t}function md(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function lf(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function H_e(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function q_e(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function r7e(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function n7e(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function s7e(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t}function o7e(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t}function a7e(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function Yl(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function l7e(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t}function a_(t,e){const i=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(i*i+r*r)}function EN(t,e){const i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r}function lY(t){const e=t[0],i=t[1];return Math.sqrt(e*e+i*i)}function W_e(t){const e=t[0],i=t[1];return e*e+i*i}function cY(t,e){return t[0]=-e[0],t[1]=-e[1],t}function c7e(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function fO(t,e){const i=e[0],r=e[1];let n=i*i+r*r;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t}function es(t,e){return t[0]*e[0]+t[1]*e[1]}function u7e(t,e,i){const r=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=r,t}function Ku(t,e,i,r){const n=e[0],s=e[1];return t[0]=n+r*(i[0]-n),t[1]=s+r*(i[1]-s),t}function h7e(t,e){e=e||1;const i=2*oR()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t}function Y_e(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[2]*n,t[1]=i[1]*r+i[3]*n,t}function sy(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[2]*n+i[4],t[1]=i[1]*r+i[3]*n+i[5],t}function d7e(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[3]*n+i[6],t[1]=i[1]*r+i[4]*n+i[7],t}function p7e(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[4]*n+i[12],t[1]=i[1]*r+i[5]*n+i[13],t}function f7e(t,e,i,r){const n=e[0]-i[0],s=e[1]-i[1],o=Math.sin(r),a=Math.cos(r);return t[0]=n*a-s*o+i[0],t[1]=n*o+s*a+i[1],t}function m7e(t,e){const i=t[0],r=t[1],n=e[0],s=e[1];let o=i*i+r*r;o>0&&(o=1/Math.sqrt(o));let a=n*n+s*s;a>0&&(a=1/Math.sqrt(a));const l=(i*n+r*s)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function g7e(t){return"vec2("+t[0]+", "+t[1]+")"}function X_e(t,e){return t[0]===e[0]&&t[1]===e[1]}function Z_e(t,e){const i=t[0],r=t[1],n=e[0],s=e[1],o=mo();return Math.abs(i-n)<=o*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-s)<=o*Math.max(1,Math.abs(r),Math.abs(s))}function y7e(t,e,i,r,n){let s=e[0]-i[0],o=e[1]-i[1];const a=(r[0]*s+r[1]*o)*(n-1);return s=r[0]*a,o=r[1]*a,t[0]=e[0]+s,t[1]=e[1]+o,t}const _7e=lY,v7e=lf,b7e=H_e,w7e=q_e,J_e=a_,x7e=EN,T7e=W_e;Object.freeze(Object.defineProperty({__proto__:null,add:md,angle:m7e,ceil:r7e,copy:Yn,cross:u7e,dist:J_e,distance:a_,div:w7e,divide:q_e,dot:es,equals:Z_e,exactEquals:X_e,floor:n7e,inverse:c7e,len:_7e,length:lY,lerp:Ku,max:o7e,min:s7e,mul:b7e,multiply:H_e,negate:cY,normalize:fO,projectAndScale:y7e,random:h7e,rotate:f7e,round:a7e,scale:Yl,scaleAndAdd:l7e,set:si,sqrDist:x7e,sqrLen:T7e,squaredDistance:EN,squaredLength:W_e,str:g7e,sub:v7e,subtract:lf,transformMat2:Y_e,transformMat2d:sy,transformMat3:d7e,transformMat4:p7e},Symbol.toStringTag,{value:"Module"}));function uY(t){return _e((t-1e5)/(1e6-1e5),0,1)}const w7=1e4,S7e=.085,yy=1e5;let E7e=class{};const Ki=E7e;function b(t,...e){let i="";for(let r=0;r<e.length;r++)i+=t[r]+e[r];return i+=t[t.length-1],i}(function(t){function e(r){return Math.round(r).toString()}function i(r){return r.toPrecision(8)}t.int=e,t.float=i})(b||(b={}));var O;function C7e(t){return t===O.POSITION}(function(t){t.POSITION="position",t.NORMAL="normal",t.NORMALCOMPRESSED="normalCompressed",t.UV0="uv0",t.AUXPOS1="auxpos1",t.AUXPOS2="auxpos2",t.COLOR="color",t.SYMBOLCOLOR="symbolColor",t.SIZE="size",t.TANGENT="tangent",t.OFFSET="offset",t.PERSPECTIVEDIVIDE="perspectiveDivide",t.SUBDIVISIONFACTOR="subdivisionFactor",t.COLORFEATUREATTRIBUTE="colorFeatureAttribute",t.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",t.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",t.DISTANCETOSTART="distanceToStart",t.UVMAPSPACE="uvMapSpace",t.BOUNDINGRECT="boundingRect",t.UVREGION="uvRegion",t.PROFILERIGHT="profileRight",t.PROFILEUP="profileUp",t.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",t.FEATUREVALUE="featureValue",t.INSTANCEMODELORIGINHI="instanceModelOriginHi",t.INSTANCEMODELORIGINLO="instanceModelOriginLo",t.INSTANCEMODEL="instanceModel",t.INSTANCEMODELNORMAL="instanceModelNormal",t.INSTANCECOLOR="instanceColor",t.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",t.LOCALTRANSFORM="localTransform",t.GLOBALTRANSFORM="globalTransform",t.BOUNDINGSPHERE="boundingSphere",t.MODELORIGIN="modelOrigin",t.MODELSCALEFACTORS="modelScaleFactors",t.FEATUREATTRIBUTE="featureAttribute",t.STATE="state",t.LODLEVEL="lodLevel",t.POSITION0="position0",t.POSITION1="position1",t.NORMALA="normalA",t.NORMALB="normalB",t.COMPONENTINDEX="componentIndex",t.VARIANTOFFSET="variantOffset",t.VARIANTSTROKE="variantStroke",t.VARIANTEXTENSION="variantExtension",t.SIDENESS="sideness",t.START="start",t.END="end",t.UP="up",t.EXTRUDE="extrude",t.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",t.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"})(O||(O={}));var In;function xf(t,e){switch(e.textureCoordinateType){case In.Default:return t.attributes.add(O.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(b`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case In.Compressed:return t.attributes.add(O.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(b`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case In.Atlas:return t.attributes.add(O.UV0,"vec2"),t.varyings.add("vuv0","vec2"),t.attributes.add(O.UVREGION,"vec4"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(b`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:e.textureCoordinateType;case In.None:return void t.vertex.code.add(b`void forwardTextureCoordinates() {}`);case In.COUNT:return}}(function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Atlas=2]="Atlas",t[t.Compressed=3]="Compressed",t[t.COUNT=4]="COUNT"})(In||(In={}));function Eh(t){t.code.add(b`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function vh(t){t.include(Eh),t.code.add(b`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromRGBA(vec4 depth, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(depth), nearFar);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTex, 0)));
return linearDepthFromRGBA(texelFetch(depthTex, iuv, 0), nearFar);
}`)}function EF(t){t.fragment.code.add(b`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var _i;(function(t){t[t.Pass=0]="Pass",t[t.Draw=1]="Draw"})(_i||(_i={}));let Qr=class{constructor(e,i,r,n,s=null){if(this.name=e,this.type=i,this.arraySize=s,this.bind={[_i.Pass]:null,[_i.Draw]:null},n)switch(r){case _i.Pass:this.bind[_i.Pass]=n;break;case _i.Draw:this.bind[_i.Draw]=n}}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},$t=class extends Qr{constructor(e,i){super(e,"vec3",_i.Pass,(r,n,s)=>r.setUniform3fv(e,i(n,s)))}};function Bg(t){t.uniforms.add(new $t("mainLightDirection",(e,i)=>i.lighting.mainLight.direction))}function Wf(t){t.uniforms.add(new $t("mainLightIntensity",(e,i)=>i.lighting.mainLight.intensity))}function CN(t){Bg(t.fragment),Wf(t.fragment),t.fragment.code.add(b`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}let zi=class extends Qr{constructor(e,i){super(e,"vec2",_i.Pass,(r,n,s)=>r.setUniform2fv(e,i(n,s)))}},ai=class extends Qr{constructor(e,i){super(e,"vec4",_i.Pass,(r,n,s)=>r.setUniform4fv(e,i(n,s)))}},Oe=class extends Qr{constructor(e,i){super(e,"float",_i.Pass,(r,n,s)=>r.setUniform1f(e,i(n,s)))}},Vr=class extends Qr{constructor(e,i){super(e,"mat4",_i.Pass,(r,n,s)=>r.setUniformMatrix4fv(e,i(n,s)))}};const ma=Kt();let A7e=class{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}};function Ke(t,e){if(!t){e=e||"Assertion";const i=new Error(e).stack;throw new A7e(`${e} at ${i}`)}}function zw(t,e){t||(e=e||"",console.warn("Verify failed: "+e+`
`+new Error("verify").stack))}function rte(t,e,i,r){let n,s=(i[0]-t[0])/e[0],o=(r[0]-t[0])/e[0];s>o&&(n=s,s=o,o=n);let a=(i[1]-t[1])/e[1],l=(r[1]-t[1])/e[1];if(a>l&&(n=a,a=l,l=n),s>l||a>o)return!1;a>s&&(s=a),l<o&&(o=l);let c=(i[2]-t[2])/e[2],u=(r[2]-t[2])/e[2];return c>u&&(n=c,c=u,u=n),!(s>u||c>o)&&(u<o&&(o=u),!(o<0))}function aM(t,e,i,r,n,s=Ue()){const o=(r[n]-i[n])*(e[0]-t[0])-(r[0]-i[0])*(e[n]-t[n]),a=(r[0]-i[0])*(t[n]-i[n])-(r[n]-i[n])*(t[0]-i[0]);if(o===0)return!1;const l=a/o;return s[0]=t[0]+l*(e[0]-t[0]),s[1]=t[n]+l*(e[n]-t[n]),!0}function nte(t,e,i,r,n){ma[0]=t[0],ma[1]=t[1],ma[2]=t[2],ma[3]=1,Xc(ma,ma,e),n.length>2&&(n[2]=-ma[2]),Xc(ma,ma,i),Ke(ma[3]!==0),n[0]=ma[0]/ma[3],n[1]=ma[1]/ma[3],n[2]=ma[2]/ma[3],n[0]=(.5*n[0]+.5)*r[2]+r[0],n[1]=(.5*n[1]+.5)*r[3]+r[1]}function O7e(t,e){return Math.log(t)/Math.log(e)}function R7e(t,e,i,r){t[12]=e,t[13]=i,t[14]=r}function K_e(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[15]===1}const Q_e=ne.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let eve=class{constructor(){this._includedModules=new Map}include(e,i){if(this._includedModules.has(e)){const r=this._includedModules.get(e);if(r!==i){Q_e.error("Trying to include shader module multiple times with different sets of options.");const n=new Set;for(const s of Object.keys(r))r[s]!==e[s]&&n.add(s);for(const s of Object.keys(e))r[s]!==e[s]&&n.add(s);n.forEach(s=>console.error(`  ${s}: current ${r[s]} new ${e[s]}`))}}else this._includedModules.set(e,i),e(this.builder,i)}},mi=class extends eve{constructor(){super(...arguments),this.vertex=new ste,this.fragment=new ste,this.attributes=new $7e,this.varyings=new I7e,this.extensions=new x7,this.constants=new tve,this.outputs=new S7}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const i=this.extensions.generateSource(e),r=this.attributes.generateSource(e),n=this.varyings.generateSource(e),s=e==="vertex"?this.vertex:this.fragment,o=s.uniforms.generateSource(),a=s.code.generateSource(),l=e==="vertex"?D7e:L7e,c=this.constants.generateSource().concat(s.constants.generateSource()),u=this.outputs.generateSource(e);return`#version 300 es
${i.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${r.join(`
`)}

${n.join(`
`)}

${u.join(`
`)}

${a.join(`
`)}`}generateBindPass(e){const i=new Map;this.vertex.uniforms.entries.forEach(s=>{const o=s.bind[_i.Pass];o&&i.set(s.name,o)}),this.fragment.uniforms.entries.forEach(s=>{const o=s.bind[_i.Pass];o&&i.set(s.name,o)});const r=Array.from(i.values()),n=r.length;return(s,o)=>{for(let a=0;a<n;++a)r[a](e,s,o)}}generateBindDraw(e){const i=new Map;this.vertex.uniforms.entries.forEach(s=>{const o=s.bind[_i.Draw];o&&i.set(s.name,o)}),this.fragment.uniforms.entries.forEach(s=>{const o=s.bind[_i.Draw];o&&i.set(s.name,o)});const r=Array.from(i.values()),n=r.length;return(s,o,a)=>{for(let l=0;l<n;++l)r[l](e,s,o,a)}}},P7e=class{constructor(){this._entries=new Map}add(...e){for(const i of e)this._add(i)}get(e){return this._entries.get(e)}_add(e){if(e!=null){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new W(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else Q_e.error(`Trying to add null Uniform from ${new Error().stack}.`)}generateSource(){return Array.from(this._entries.values()).map(e=>e.arraySize!=null?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`)}get entries(){return Array.from(this._entries.values())}},M7e=class{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}},ste=class extends eve{constructor(){super(...arguments),this.uniforms=new P7e,this.code=new M7e,this.constants=new tve}get builder(){return this}},$7e=class{constructor(){this._entries=new Array}add(e,i){this._entries.push([e,i])}generateSource(e){return e==="fragment"?[]:this._entries.map(i=>`in ${i[1]} ${i[0]};`)}},I7e=class{constructor(){this._entries=new Map}add(e,i){this._entries.has(e)&&Ke(this._entries.get(e)===i),this._entries.set(e,i)}generateSource(e){const i=new Array;return this._entries.forEach((r,n)=>i.push(e==="vertex"?`out ${r} ${n};`:`in ${r} ${n};`)),i}},x7=class T7{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const i=e==="vertex"?T7.ALLOWLIST_VERTEX:T7.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(r=>i.includes(r)).map(r=>`#extension ${r} : enable`)}};x7.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],x7.ALLOWLIST_VERTEX=[];let S7=class E7{constructor(){this._entries=new Map}add(e,i,r=0){const n=this._entries.get(r);n?Ke(n.name===e&&n.type===i,`Fragment shader output location ${r} occupied`):this._entries.set(r,{name:e,type:i})}generateSource(e){if(e==="vertex")return[];this._entries.size===0&&this._entries.set(0,{name:E7.DEFAULT_NAME,type:E7.DEFAULT_TYPE});const i=new Array;return this._entries.forEach((r,n)=>i.push(`layout(location = ${n}) out ${r.type} ${r.name};`)),i}};S7.DEFAULT_TYPE="vec4",S7.DEFAULT_NAME="fragColor";let tve=class Zn{constructor(){this._entries=new Set}add(e,i,r){let n="ERROR_CONSTRUCTOR_STRING";switch(i){case"float":n=Zn._numberToFloatStr(r);break;case"int":n=Zn._numberToIntStr(r);break;case"bool":n=r.toString();break;case"vec2":n=`vec2(${Zn._numberToFloatStr(r[0])},                            ${Zn._numberToFloatStr(r[1])})`;break;case"vec3":n=`vec3(${Zn._numberToFloatStr(r[0])},                            ${Zn._numberToFloatStr(r[1])},                            ${Zn._numberToFloatStr(r[2])})`;break;case"vec4":n=`vec4(${Zn._numberToFloatStr(r[0])},                            ${Zn._numberToFloatStr(r[1])},                            ${Zn._numberToFloatStr(r[2])},                            ${Zn._numberToFloatStr(r[3])})`;break;case"ivec2":n=`ivec2(${Zn._numberToIntStr(r[0])},                             ${Zn._numberToIntStr(r[1])})`;break;case"ivec3":n=`ivec3(${Zn._numberToIntStr(r[0])},                             ${Zn._numberToIntStr(r[1])},                             ${Zn._numberToIntStr(r[2])})`;break;case"ivec4":n=`ivec4(${Zn._numberToIntStr(r[0])},                             ${Zn._numberToIntStr(r[1])},                             ${Zn._numberToIntStr(r[2])},                             ${Zn._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":n=`${i}(${Array.prototype.map.call(r,s=>Zn._numberToFloatStr(s)).join(", ")})`}return this._entries.add(`const ${i} ${e} = ${n};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}};const L7e=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif`,D7e=`precision highp float;
precision highp sampler2D;`;let Je=class extends Qr{constructor(e,i){super(e,"sampler2D",_i.Pass,(r,n,s)=>r.bindTexture(e,i(n,s)))}};const o3=Ce(parseFloat(5802e-9.toFixed(6)),parseFloat(13558e-9.toFixed(6)),parseFloat(331e-7.toFixed(6))),U6=3,z6=Ce(U6*parseFloat(65e-8.toFixed(6)),U6*parseFloat(1881e-9.toFixed(6)),U6*parseFloat(85e-9.toFixed(6))),N7e=3996e-9,F7e=Ce(parseFloat(Number(o3[0]+z6[0]).toFixed(6)),parseFloat(Number(o3[1]+z6[1]).toFixed(6)),parseFloat(Number(o3[2]+z6[2]).toFixed(6)));function k7e(t){const e=new mi;e.attributes.add(O.POSITION,"vec2"),e.include(xf,{textureCoordinateType:In.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:i,fragment:r}=e;return i.uniforms.add(new Vr("inverseProjectionMatrix",(n,s)=>s.camera.inverseProjectionMatrix),new Vr("inverseViewMatrix",(n,s)=>$S(U7e,s.camera.viewMatrix))),i.code.add(b`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new $t("backgroundColor",n=>n.backgroundColor),new zi("radii",n=>n.radii),new $t("cameraPosition",(n,s)=>s.camera.eye),new ai("heightParameters",n=>n.heightParameters),new Oe("innerFadeDistance",n=>n.innerFadeDistance),new Oe("altitudeFade",n=>n.altitudeFade),new Je("depthTexture",n=>n.depthTexture),new Oe("hazeStrength",n=>n.hazeStrength)),r.constants.add("betaRayleigh","vec3",o3),r.constants.add("betaCombined","vec3",F7e),r.constants.add("betaMie","float",N7e),r.constants.add("scaleHeight","float",S7e*yy),Bg(r),e.include(EF),t.haze&&(r.include(vh),r.uniforms.add(new zi("nearFar",(n,s)=>s.camera.nearFar))),r.code.add(b`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(b`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),r.code.add(b`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),r.code.add(b`
    const int STEPS = 6;

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${t.haze?b`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${t.haze?"":b`mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * `} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${t.haze?"":b`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${t.haze?b`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:b`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    ${t.haze?"":b`
            vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
              vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
              if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
                return fragColor;
              }

              float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
              vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
              float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
              if (relDist > 1.0) {
                return surfaceColor;
              }

              return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
            }

            float getGlow(float dist, float radius, float intensity) {
              return pow(radius / max(dist, 1e-6), intensity);
            }

            vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){

              // Get the amount of atmosphere between camera and the Sun along the view ray
              float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
              float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));

              // Find the amount of light that remains after travelling through the atmosphere from the Sun along the view ray
              // This will make the colour of the Sun reddish on the horizon and white from space
              vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));

              // Alignment of light direction and view ray
              float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
              // Draw the Sun as a bright disc
              float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));

              return normalize(sunTransmittance) * sunDisc;
            }`}

    ${t.haze&&t.reduced?b`
        float getDepth(vec2 uv){
          return linearDepthFromTexture(depthTexture, uv, nearFar);
        }

        float textureBilinear(vec2 uv) {
          // Information about the high-resolution depth texture
          vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
          vec2 texelSize = 1.0 / depthTextureSize;

          // The uv inside the upper right pixel - of the tile of 4 pixels -
          // that the atmosphere uv maps to in the depth texture
          vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);

          // Relative distance of the uv coordinates inside the depth texture pixel
          vec2 f = fract(depthUV);

          // Snap to the centre of the depth texture pixel
          vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;

          // Read the depth texture pixel and its three neighbours
          float d0 = getDepth(snapUV);
          float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
          float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
          float d3 = getDepth(snapUV + texelSize);

          // Return the bilinearly interpolated value of the neighbouring pixels based
          // on the sample position in the depth texture pixel
          return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
        }
        `:""}

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${t.haze?b`
          vec4 depthSample = texture(depthTexture, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;

              ${t.reduced?b`cameraSpaceRay *= -textureBilinear(vuv0);`:b`cameraSpaceRay *= -linearDepthFromTexture(depthTexture, vuv0, nearFar);`}

            terrainDepth = max(0.0, length(cameraSpaceRay));
          }else{
            discard;
          }
          `:b`${t.reduced?"":b`
                float depthSample = texture(depthTexture, vuv0).r;
                if (depthSample != 1.0) {
                  fragColor = vec4(0);
                  return;
                }`}`}

      ${t.haze?b`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            // Alpha is ignored for haze blending
            float alpha = 1.0;
            `:b`
            vec3 col = linearizeGamma(backgroundColor);
            col += getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            col += getSun(cameraPosition, rayDir, mainLightDirection);
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      ${t.haze?"":b`fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);`}
    }
  `),e}const U7e=be(),z7e=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:o3,build:k7e},Symbol.toStringTag,{value:"Module"}));let bi=class{constructor(e,i){this._module=e,this._loadModule=i}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}};var hr,Qt,Te,Df,wt,Md,oS,Ze,Pi,Gr,Lt,Nt,sn,pt,Ge,hs,ks,vi,Gc,Eo;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(hr||(hr={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Qt||(Qt={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(Te||(Te={})),function(t){t[t.ADD=32774]="ADD",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.SUBTRACT=32778]="SUBTRACT",t[t.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(Df||(Df={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(wt||(wt={})),function(t){t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(Md||(Md={})),function(t){t[t.CW=2304]="CW",t[t.CCW=2305]="CCW"}(oS||(oS={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT"}(Ze||(Ze={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(Pi||(Pi={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP"}(Gr||(Gr={})),function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(Lt||(Lt={})),function(t){t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(Nt||(Nt={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(sn||(sn={})),function(t){t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.RED=6403]="RED",t[t.RG=33319]="RG",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER"}(pt||(pt={})),function(t){t[t.RGBA4=32854]="RGBA4",t[t.R16F=33325]="R16F",t[t.RG16F=33327]="RG16F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.R32F=33326]="R32F",t[t.RG32F=33328]="RG32F",t[t.RGBA32F=34836]="RGBA32F",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB5_A1=32855]="RGB5_A1",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGB565=36194]="RGB565",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI"}(Ge||(Ge={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.INT=5124]="INT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(hs||(hs={})),function(t){t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(ks||(ks={})),function(t){t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_READ=35045]="STATIC_READ",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.STREAM_COPY=35042]="STREAM_COPY"}(vi||(vi={})),function(t){t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER"}(Gc||(Gc={})),function(t){t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(Eo||(Eo={}));const B6=33984;var Mn,ll,C7;(function(t){t[t.Texture=0]="Texture",t[t.BufferObject=1]="BufferObject",t[t.VertexArrayObject=2]="VertexArrayObject",t[t.Shader=3]="Shader",t[t.Program=4]="Program",t[t.FramebufferObject=5]="FramebufferObject",t[t.Renderbuffer=6]="Renderbuffer",t[t.Sync=7]="Sync",t[t.UNCOUNTED=8]="UNCOUNTED",t[t.LinesOfCode=8]="LinesOfCode",t[t.Uniform=9]="Uniform",t[t.COUNT=10]="COUNT"})(Mn||(Mn={})),function(t){t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(ll||(ll={})),function(t){t[t.NONE=0]="NONE",t[t.BACK=1029]="BACK"}(C7||(C7={}));const ote=33306;var fn,ate,lte,cte,AN,A7,ute;(function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(fn||(fn={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(ate||(ate={})),function(t){t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS"}(lte||(lte={})),function(t){t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED"}(cte||(cte={})),function(t){t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED"}(AN||(AN={})),function(t){t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(A7||(A7={})),function(t){t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(ute||(ute={}));let Ci=class{constructor(e,i,r){this.release=r,this.initializeConfiguration(e,i),this._configuration=i.snapshot(),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}destroy(){this._program=et(this._program),this._pipeline=this._configuration=null}reload(e){et(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return Qt.TRIANGLES}getPipeline(e,i,r){return this._pipeline}initializeConfiguration(e,i){}};const fi=new Map([[O.POSITION,0],[O.NORMAL,1],[O.NORMALCOMPRESSED,1],[O.UV0,2],[O.COLOR,3],[O.COLORFEATUREATTRIBUTE,3],[O.SIZE,4],[O.TANGENT,4],[O.AUXPOS1,5],[O.SYMBOLCOLOR,5],[O.AUXPOS2,6],[O.FEATUREATTRIBUTE,6],[O.INSTANCEFEATUREATTRIBUTE,6],[O.INSTANCECOLOR,7],[O.OBJECTANDLAYERIDCOLOR,7],[O.INSTANCEOBJECTANDLAYERIDCOLOR,7],[O.INSTANCEMODEL,8],[O.INSTANCEMODELNORMAL,12],[O.INSTANCEMODELORIGINHI,11],[O.INSTANCEMODELORIGINLO,15]]),B7e=ne.getLogger("esri.views.webgl.checkWebGLError");function V7e(t,e){switch(e){case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const ive=!!ie("enable-feature:webgl-debug");function gd(){return ive}function O7(){return ive}function cf(t){if(gd()){const e=t.getError();if(e){const i=V7e(t,e),r=new Error().stack;B7e.error(new W("webgl-error","WebGL error occurred",{message:i,stack:r}))}}}let wi=class{constructor(e,i,r){this._context=e,this._locations=r,this._textures=new Map,this._freeTextureUnits=new It({deallocator:null}),this._glProgram=e.programCache.acquire(i.generate("vertex"),i.generate("fragment"),r),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=i.generateBindPass(this),this.bindDraw=i.generateBindDraw(this),this._fragmentUniforms=gd()?i.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get compiled(){return this._glProgram.compiled}setUniform1b(e,i){this._glProgram.setUniform1i(e,i?1:0)}setUniform1i(e,i){this._glProgram.setUniform1i(e,i)}setUniform1f(e,i){this._glProgram.setUniform1f(e,i)}setUniform2fv(e,i){this._glProgram.setUniform2fv(e,i)}setUniform3fv(e,i){this._glProgram.setUniform3fv(e,i)}setUniform4fv(e,i){this._glProgram.setUniform4fv(e,i)}setUniformMatrix3fv(e,i){this._glProgram.setUniformMatrix3fv(e,i)}setUniformMatrix4fv(e,i){this._glProgram.setUniformMatrix4fv(e,i)}setUniform1fv(e,i){this._glProgram.setUniform1fv(e,i)}setUniform1iv(e,i){this._glProgram.setUniform1iv(e,i)}setUniform2iv(e,i){this._glProgram.setUniform3iv(e,i)}setUniform3iv(e,i){this._glProgram.setUniform3iv(e,i)}setUniform4iv(e,i){this._glProgram.setUniform4iv(e,i)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,i){if(i?.glName==null){const n=this._textures.get(e);return n&&(this._context.bindTexture(null,n.unit),this._freeTextureUnit(n),this._textures.delete(e)),null}let r=this._textures.get(e);return r==null?(r=this._allocTextureUnit(i),this._textures.set(e,r)):r.texture=i,this._context.useProgram(this),this.setUniform1i(e,r.unit),this._context.bindTexture(i,r.unit),r.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((e,i)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(i,e.unit)}),this._fragmentUniforms!=null&&this._fragmentUniforms.forEach(e=>{e.type!=="sampler2D"&&e.type!=="samplerCube"||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)})}_allocTextureUnit(e){return{texture:e,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}};var dr,Fb,_n,l_,gl,Rg,Wi,Ql,lg;(function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"})(dr||(dr={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(Fb||(Fb={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(_n||(_n={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(l_||(l_={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(gl||(gl={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee",t[t.COUNT=2]="COUNT"}(Rg||(Rg={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(Wi||(Wi={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(Ql||(Ql={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(lg||(lg={}));function cc(t,e,i=Df.ADD,r=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function fo(t,e,i,r,n=Df.ADD,s=Df.ADD,o=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:i,dstAlpha:r,opRgb:n,opAlpha:s,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const hY={face:Md.BACK,mode:oS.CCW},rve={face:Md.FRONT,mode:oS.CCW},CF=t=>t===dr.Back?hY:t===dr.Front?rve:null,_l={zNear:0,zFar:1},Ft={r:!0,g:!0,b:!0,a:!0};function G7e(t){return K7e.intern(t)}function j7e(t){return Q7e.intern(t)}function H7e(t){return eGe.intern(t)}function q7e(t){return tGe.intern(t)}function W7e(t){return iGe.intern(t)}function Y7e(t){return rGe.intern(t)}function X7e(t){return nGe.intern(t)}function Z7e(t){return sGe.intern(t)}function J7e(t){return oGe.intern(t)}function Ot(t){return aGe.intern(t)}let Yf=class{constructor(e,i){this._makeKey=e,this._makeRef=i,this._interns=new Map}intern(e){if(!e)return null;const i=this._makeKey(e),r=this._interns;return r.has(i)||r.set(i,this._makeRef(e)),r.get(i)??null}};function Xf(t){return"["+t.join(",")+"]"}const K7e=new Yf(nve,t=>({__tag:"Blending",...t}));function nve(t){return t?Xf([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const Q7e=new Yf(sve,t=>({__tag:"Culling",...t}));function sve(t){return t?Xf([t.face,t.mode]):null}const eGe=new Yf(ove,t=>({__tag:"PolygonOffset",...t}));function ove(t){return t?Xf([t.factor,t.units]):null}const tGe=new Yf(ave,t=>({__tag:"DepthTest",...t}));function ave(t){return t?Xf([t.func]):null}const iGe=new Yf(lve,t=>({__tag:"StencilTest",...t}));function lve(t){return t?Xf([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const rGe=new Yf(cve,t=>({__tag:"DepthWrite",...t}));function cve(t){return t?Xf([t.zNear,t.zFar]):null}const nGe=new Yf(uve,t=>({__tag:"ColorWrite",...t}));function uve(t){return t?Xf([t.r,t.g,t.b,t.a]):null}const sGe=new Yf(hve,t=>({__tag:"StencilWrite",...t}));function hve(t){return t?Xf([t.mask]):null}const oGe=new Yf(dve,t=>({__tag:"DrawBuffers",...t}));function dve(t){return t?Xf(t.buffers):null}const aGe=new Yf(lGe,t=>({blending:G7e(t.blending),culling:j7e(t.culling),polygonOffset:H7e(t.polygonOffset),depthTest:q7e(t.depthTest),stencilTest:W7e(t.stencilTest),depthWrite:Y7e(t.depthWrite),colorWrite:X7e(t.colorWrite),stencilWrite:Z7e(t.stencilWrite),drawBuffers:J7e(t.drawBuffers)}));function lGe(t){return t?Xf([nve(t.blending),sve(t.culling),ove(t.polygonOffset),ave(t.depthTest),lve(t.stencilTest),cve(t.depthWrite),uve(t.colorWrite),hve(t.stencilWrite),dve(t.drawBuffers)]):null}let cGe=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._setDrawBuffers(e.drawBuffers),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(e){this._drawBuffers=this._setSubState(e,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(e,i,r,n){return(r||e!==i)&&(n(e),this._pipelineInvalid=!0),e}},uGe=class extends Ki{constructor(){super(...arguments),this.heightParameters=Kt(),this.radii=Ue(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1,this.renderScale=Ue(),this.backgroundColor=C()}},sA=class pve extends Ci{initializeProgram(e){return new wi(e.rctx,pve.shader.get().build(this.configuration),fi)}initializePipeline(){return this.configuration.reduced?Ot({blending:cc(Te.ONE,Te.ZERO),depthTest:{func:Pi.ALWAYS},colorWrite:Ft}):this.configuration.haze?Ot({blending:fo(Te.ONE,Te.ZERO,Te.ONE_MINUS_SRC_COLOR,Te.ONE),colorWrite:Ft}):Ot({blending:cc(Te.SRC_ALPHA,Te.ONE_MINUS_SRC_ALPHA),depthTest:{func:Pi.LEQUAL},colorWrite:Ft})}};sA.shader=new bi(z7e,()=>pe(()=>import("./ChapmanAtmosphere.glsl-5537acae.js"),[],import.meta.url));let bl=class extends Ki{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,i={key:this.key};for(const r of e)i[r]=this[r];return i}};function V(t={}){return(e,i)=>{if(e._parameterNames=e._parameterNames??[],e._parameterNames.push(i),t.constValue!=null)Object.defineProperty(e,i,{get:()=>t.constValue});else{const r=e._parameterNames.length-1,n=t.count||2,s=Math.ceil(Math.log2(n)),o=e._parameterBits??[0];let a=0;for(;o[a]+s>16;)a++,a>=o.length&&o.push(0);e._parameterBits=o;const l=o[a],c=(1<<s)-1<<l;o[a]+=s,Object.defineProperty(e,i,{get(){return this[r]},set(u){if(this[r]!==u&&(this[r]=u,this._keyDirty=!0,this._parameterBits[a]=this._parameterBits[a]&~c|+u<<l&c,typeof u!="number"&&typeof u!="boolean"))throw new Error("Configuration value for "+i+" must be boolean or number, got "+typeof u)}})}}}let ON=class extends bl{constructor(){super(...arguments),this.haze=!1,this.reduced=!1}};h([V()],ON.prototype,"haze",void 0),h([V()],ON.prototype,"reduced",void 0);const a3=-3;var yd;(function(t){t[t.ALL=0]="ALL",t[t.SOME=1]="SOME"})(yd||(yd={}));let hGe=class{constructor(e,i,r){this.name=e,this._storage=i,this.id=dGe+++":",this.size=0,this.maxSize=0,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),r&&(this._storage.registerRemoveFunc(this.id,r),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get sizeAll(){return this._storage.size}resetHitRate(){this._hit=this._miss=0}put(e,i,r,n=0){this._storage.put(this,e,i,r,n)}get(e){const i=this._storage.get(this,e);return i===void 0?++this._miss:++this._hit,i}peek(e){return this._storage.peek(this,e)}pop(e){const i=this._storage.pop(this,e);return i===void 0?++this._miss:++this._hit,i}updateSize(e,i,r){this._storage.updateSize(this,e,i,r)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}},fve=class{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new It,this._users=new It}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,i){this._removeFuncs.push([e,i])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace(i=>i[0]!==e)}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,0),this._checkSizeLimits()}put(e,i,r,n,s){i=e.id+i;const o=this._db.get(i);if(o&&(this._size-=o.size,e.size-=o.size,this._db.delete(i),o.entry!==r&&this._notifyRemove(i,o.entry,yd.ALL)),n>this._maxSize)return void this._notifyRemove(i,r,yd.ALL);if(r===void 0)return void console.warn("Refusing to cache undefined entry ");if(!n||n<0)return console.warn(`Refusing to cache entry with size ${n} for key ${i}`),void this._notifyRemove(i,r,yd.ALL);const a=1+Math.max(s,a3)-a3;this._db.set(i,{entry:r,size:n,lifetime:a,lives:a}),this._size+=n,e.size+=n,this._checkSizeLimits()}updateSize(e,i,r,n){i=e.id+i;const s=this._db.get(i);if(s&&s.entry===r){for(this._size-=s.size,e.size-=s.size;n>this._maxSize;){const o=this._notifyRemove(i,r,yd.SOME);if(!(o!=null&&o>0))return void this._db.delete(i);n=o}s.size=n,this._size+=n,e.size+=n,this._checkSizeLimits()}}pop(e,i){i=e.id+i;const r=this._db.get(i);if(r)return this._size-=r.size,e.size-=r.size,this._db.delete(i),++this._hit,r.entry;++this._miss}get(e,i){i=e.id+i;const r=this._db.get(i);if(r!==void 0)return this._db.delete(i),r.lives=r.lifetime,this._db.set(i,r),++this._hit,r.entry;++this._miss}peek(e,i){const r=this._db.get(e.id+i);return r?++this._hit:++this._miss,r?.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},i={},r=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;r[l]=(r[l]||0)+o.size,this._users.forAll(c=>{const{id:u,name:d}=c;if(a.startsWith(u)){const p=i[d]||0;i[d]=p+o.size}})});const n={};this._users.forAll(o=>{const a=o.name;if("hitRate"in o&&typeof o.hitRate=="number"&&!isNaN(o.hitRate)&&o.hitRate>0){const l=i[a]||0;i[a]=l,n[a]=Math.round(100*o.hitRate)+"%"}else n[a]="0%"});const s=Object.keys(i);s.sort((o,a)=>i[a]-i[o]),s.forEach(o=>e[o]=Math.round(i[o]/2**20)+"MB / "+n[o]);for(let o=r.length-1;o>=0;--o){const a=r[o];a&&(e["Priority "+(o+a3-1)]=Math.round(a/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll(e=>e.resetHitRate())}clear(e){const i=e.id;this._db.forEach((r,n)=>{n.startsWith(i)&&(this._size-=r.size,this._db.delete(n),this._notifyRemove(n,r.entry,yd.ALL))}),e.size=0}clearAll(){this._db.forEach((e,i)=>this._notifyRemove(i,e.entry,yd.ALL)),this._users.forEach(e=>e.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,i,r){let n;return this._removeFuncs.some(s=>{if(e.startsWith(s[0])){const o=s[1](i,r);return typeof o=="number"&&(n=o),!0}return!1}),n}_checkSizeLimits(){if(this._size>this._maxSize){for(const[e,i]of this._db)if(this._purgeItem(e,i),this._size<=.9*this.maxSize)return}this._users.forEach(e=>{if(e.maxSize>0&&e.size>e.maxSize){for(const[i,r]of this._db)if(i.startsWith(e.id)&&(this._purgeItem(i,r,e),e.size<=.9*e.maxSize))return}})}_purgeItem(e,i,r=this._users.find(n=>e.startsWith(n.id))){if(this._db.delete(e),i.lives<=1){this._size-=i.size,r&&(r.size-=i.size);const n=this._notifyRemove(e,i.entry,yd.SOME);n!=null&&n>0&&(this._size+=n,r&&(r.size+=n),i.lives=i.lifetime,i.size=n,this._db.set(e,i))}else--i.lives,this._db.set(e,i)}},dGe=0,SR=class{constructor(e,i){this._cache=e(i,(r,n)=>this._remove(r,n))}hitrate(){return this._cache.hitRate}destroy(){this._cache.destroy()}clear(){this._cache.clear()}pop(e){const i=this._cache.peek(e);if(!i)return;const r=i.pop();if(i.length>0){const n=i.reduce((s,o)=>s+o.usedMemory,0);this._cache.updateSize(e,i,n)}else this._cache.pop(e);return r}put(e,i,r=a3){const n=this._cache.peek(e);if(!n)return void this._cache.put(e,[i],i.usedMemory,r);n.push(i);const s=n.reduce((o,a)=>o+a.usedMemory,0);this._cache.updateSize(e,n,s)}_remove(e,i){switch(i){case yd.ALL:return e.forEach(r=>r.dispose()),0;case yd.SOME:return e.shift()?.dispose(),e.reduce((r,n)=>r+n.usedMemory,0)}}},V6=class{constructor(e,i){this._last=new It,this._incarnation=0,this._cache=new SR(e,i)}destroy(){this._last?.forAll(e=>e.dispose()),this._last=null,this._cache.destroy()}set interactive(e){e&&!this._last?this._last=new It:e||(this._last?.forAll(i=>i.dispose()),this._last=null)}clean(){this._last?.filterInPlace(e=>!(e.incarnation<this._incarnation)||(this._cache.put(e.key,e),!1))}frame(){++this._incarnation}pop(e){if(this._last){const i=this._last.find(r=>r.key===e);if(i)return this._last.removeUnordered(i),i}return this._cache.pop(e)}put(e){e.incarnation=this._incarnation,this._last?this._last.push(e):this._cache.put(e.key,e)}get usedMemory(){return this._last?.reduce((e,i)=>e+i.usedMemory,0)??0}};var ni;function R7(t,e,i={}){const r=e===ni.WEBGL1?"webgl":"webgl2";return t.getContext(r,i)||null}function pGe(t,e,i={}){const r=mve(t);for(const n of r){const s=R7(e,n,i);if(s)return s}return null}function mve(t){if(t==="3d")return[ni.WEBGL2];const e=ie("esri-force-webgl");return e===ni.WEBGL1||e===ni.WEBGL2?[e]:ie("mac")&&ie("chrome")?[ni.WEBGL1,ni.WEBGL2]:[ni.WEBGL2,ni.WEBGL1]}(function(t){t[t.WEBGL1=1]="WEBGL1",t[t.WEBGL2=2]="WEBGL2"})(ni||(ni={}));const fp=ne.getLogger("esri.views.webgl.BufferObject");let Ri=class u2{static createIndex(e,i,r){return new u2(e,wt.ELEMENT_ARRAY_BUFFER,i,r)}static createVertex(e,i,r){return new u2(e,wt.ARRAY_BUFFER,i,r)}static createUniform(e,i,r){if(e.type!==ni.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new u2(e,wt.UNIFORM_BUFFER,i,r)}static createPixelPack(e,i=vi.STREAM_READ,r){if(e.type!==ni.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const n=new u2(e,wt.PIXEL_PACK_BUFFER,i);return r&&n.setSize(r),n}static createPixelUnpack(e,i=vi.STREAM_DRAW,r){if(e.type!==ni.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new u2(e,wt.PIXEL_UNPACK_BUFFER,i,r)}constructor(e,i,r,n){this._context=e,this.bufferType=i,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(Mn.BufferObject,this),this._glName=this._context.gl.createBuffer(),cf(this._context.gl),n&&this.setData(n)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteLength(){return this.bufferType===wt.ELEMENT_ARRAY_BUFFER?this._indexType===Ze.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===wt.ELEMENT_ARRAY_BUFFER||this.bufferType===wt.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(Mn.BufferObject,this),this._context=null):this._glName&&fp.warn("Leaked WebGL buffer object")}setSize(e,i=null){if(e<=0&&fp.error("Buffer size needs to be positive!"),this.bufferType===wt.ELEMENT_ARRAY_BUFFER&&i!=null)switch(this._indexType=i,i){case Ze.UNSIGNED_SHORT:e*=2;break;case Ze.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let i=e.byteLength;this.bufferType===wt.ELEMENT_ARRAY_BUFFER&&(l4(e)&&(i/=2,this._indexType=Ze.UNSIGNED_SHORT),c4(e)&&(i/=4,this._indexType=Ze.UNSIGNED_INT)),this._setBufferData(i,e)}_setBufferData(e,i=null){this._size=e;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const n=this._context.gl;i!=null?n.bufferData(this.bufferType,i,this.usage):n.bufferData(this.bufferType,e,this.usage),cf(n),this._isVAOAware&&this._context.bindVAO(r)}setSubData(e,i,r,n){if(!e)return;(i<0||i*e.BYTES_PER_ELEMENT>=this.byteLength)&&fp.error("offset is out of range!"),r>=n&&fp.error("end must be bigger than start!"),(i+(n-r))*e.BYTES_PER_ELEMENT>this.byteLength&&fp.error("An attempt to write beyond the end of the buffer!");const s=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const o=this._context.gl;if(this._context.type===ni.WEBGL2)o.bufferSubData(this.bufferType,i*e.BYTES_PER_ELEMENT,e,r,n-r);else{const a=r===0&&n===e.length?e:e.subarray(r,n);o.bufferSubData(this.bufferType,i*e.BYTES_PER_ELEMENT,a)}cf(o),this._isVAOAware&&this._context.bindVAO(s)}getSubData(e,i=0,r,n){if(this._context.type!==ni.WEBGL2)return void fp.error("Get buffer subdata is supported in WebGL2 only!");if(r<0||n<0)return void fp.error("Problem getting subdata: offset and length were less than zero!");const s=fGe(e)?e.BYTES_PER_ELEMENT:1;if(s*((r??0)+(n??0))>e.byteLength)return void fp.error("Problem getting subdata: offset and length exceeded destination size!");i+s*(n??0)>this.byteLength&&fp.warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this._context.bindBuffer(this,wt.COPY_READ_BUFFER),o.getBufferSubData(wt.COPY_READ_BUFFER,i,e,r,n),this._context.unbindBuffer(wt.COPY_READ_BUFFER)}async getSubDataAsync(e,i=0,r,n){this._context.type===ni.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(e,i,r,n)):fp.error("Get buffer subdata is supported in WebGL2 only!")}};function fGe(t){return _Oe(t)}var c_;(function(t){t[t.Texture=0]="Texture",t[t.RenderBuffer=1]="RenderBuffer"})(c_||(c_={}));function mGe(t){const e=t.gl;switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case e.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case e.INVALID_OPERATION:return"The specified command is not allowed for the current state";case e.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case e.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case e.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function cg(t,e){return t.vertexBuffers[e].byteLength/gGe(t.layout[e])}function gGe(t){return t[0].stride}function dY(t,e,i,r,n=0){const s=t.gl;t.bindBuffer(i);for(const o of r){const a=e.get(o.name);a===void 0&&console.error(`There is no location for vertex attribute '${o.name}' defined.`);const l=n*o.stride;if(o.count<=4)s.vertexAttribPointer(a,o.count,o.type,o.normalized,o.stride,o.offset+l),s.enableVertexAttribArray(a),o.divisor>0&&t.gl2?.vertexAttribDivisor(a,o.divisor);else if(o.count===9)for(let c=0;c<3;c++)s.vertexAttribPointer(a+c,3,o.type,o.normalized,o.stride,o.offset+12*c+l),s.enableVertexAttribArray(a+c),o.divisor>0&&t.gl2?.vertexAttribDivisor(a+c,o.divisor);else if(o.count===16)for(let c=0;c<4;c++)s.vertexAttribPointer(a+c,4,o.type,o.normalized,o.stride,o.offset+16*c+l),s.enableVertexAttribArray(a+c),o.divisor>0&&t.gl2?.vertexAttribDivisor(a+c,o.divisor);else console.error("Unsupported vertex attribute element count: "+o.count)}}function pY(t,e,i,r){const n=t.gl;t.bindBuffer(i);for(const s of r){const o=e.get(s.name);if(s.count<=4)n.disableVertexAttribArray(o),s.divisor&&s.divisor>0&&t.gl2?.vertexAttribDivisor(o,0);else if(s.count===9)for(let a=0;a<3;a++)n.disableVertexAttribArray(o+a),s.divisor&&s.divisor>0&&t.gl2?.vertexAttribDivisor(o+a,0);else if(s.count===16)for(let a=0;a<4;a++)n.disableVertexAttribArray(o+a),s.divisor&&s.divisor>0&&t.gl2?.vertexAttribDivisor(o+a,0);else console.error("Unsupported vertex attribute element count: "+s.count)}t.unbindBuffer(wt.ARRAY_BUFFER)}function fY(t){switch(t){case pt.ALPHA:case pt.LUMINANCE:case pt.RED:case pt.RED_INTEGER:case Ge.R8:case Ge.R8I:case Ge.R8UI:case Ge.R8_SNORM:case ks.STENCIL_INDEX8:return 1;case pt.LUMINANCE_ALPHA:case pt.RG:case pt.RG_INTEGER:case Ge.RGBA4:case Ge.R16F:case Ge.R16I:case Ge.R16UI:case Ge.RG8:case Ge.RG8I:case Ge.RG8UI:case Ge.RG8_SNORM:case Ge.RGB565:case Ge.RGB5_A1:case ks.DEPTH_COMPONENT16:return 2;case pt.DEPTH_COMPONENT:case pt.RGB:case pt.RGB_INTEGER:case Ge.RGB8:case Ge.RGB8I:case Ge.RGB8UI:case Ge.RGB8_SNORM:case Ge.SRGB8:case ks.DEPTH_COMPONENT24:return 3;case pt.DEPTH_STENCIL:case pt.DEPTH24_STENCIL8:case pt.RGBA:case pt.RGBA_INTEGER:case Ge.RGBA8:case Ge.R32F:case Ge.R11F_G11F_B10F:case Ge.RG16F:case Ge.R32I:case Ge.R32UI:case Ge.RG16I:case Ge.RG16UI:case Ge.RGBA8I:case Ge.RGBA8UI:case Ge.RGBA8_SNORM:case Ge.SRGB8_ALPHA8:case Ge.RGB9_E5:case Ge.RGB10_A2UI:case Ge.RGB10_A2:case ks.DEPTH_STENCIL:case ks.DEPTH_COMPONENT32F:case ks.DEPTH24_STENCIL8:return 4;case ks.DEPTH32F_STENCIL8:return 5;case Ge.RGB16F:case Ge.RGB16I:case Ge.RGB16UI:return 6;case Ge.RG32F:case Ge.RG32I:case Ge.RG32UI:case Ge.RGBA16F:case Ge.RGBA16I:case Ge.RGBA16UI:return 8;case Ge.RGB32F:case Ge.RGB32I:case Ge.RGB32UI:return 12;case Ge.RGBA32F:case Ge.RGBA32I:case Ge.RGBA32UI:return 16;case fn.COMPRESSED_RGB_S3TC_DXT1_EXT:case fn.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case fn.COMPRESSED_RGBA_S3TC_DXT3_EXT:case fn.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case fn.COMPRESSED_R11_EAC:case fn.COMPRESSED_SIGNED_R11_EAC:case fn.COMPRESSED_RGB8_ETC2:case fn.COMPRESSED_SRGB8_ETC2:case fn.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case fn.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case fn.COMPRESSED_RG11_EAC:case fn.COMPRESSED_SIGNED_RG11_EAC:case fn.COMPRESSED_RGBA8_ETC2_EAC:case fn.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}let mL=class{constructor(e,i,r=i){this.internalFormat=e,this.width=i,this.height=r,this.multisampled=!1,this.samples=1}};function yGe(t){return t.width<=0||t.height<=0||t.internalFormat==null?0:t.width*t.height*fY(t.internalFormat)}let gve=class{constructor(e,i){this._context=e,this._descriptor=i,this.type=c_.RenderBuffer,this._context.instanceCounter.increment(Mn.Renderbuffer,this);const r=this._context.gl;this.glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:n,height:s,internalFormat:o,multisampled:a}=i;if(a){if(this._context.type!==ni.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");r.renderbufferStorageMultisample(r.RENDERBUFFER,this.samples,o,n,s)}else r.renderbufferStorage(r.RENDERBUFFER,o,n,s)}get descriptor(){return this._descriptor}get samples(){const e=this._descriptor.samples,i=this._context.parameters.maxSamples;return e?Math.min(e,i):i}get gpuMemoryUsage(){return yGe(this._descriptor)}resize(e,i){const r=this._descriptor;if(r.width===e&&r.height===i)return;r.width=e,r.height=i;const n=this._context.gl;this._context.bindRenderbuffer(this),r.multisampled?n.renderbufferStorageMultisample(n.RENDERBUFFER,this.samples,r.internalFormat,r.width,r.height):n.renderbufferStorage(n.RENDERBUFFER,r.internalFormat,r.width,r.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(Mn.Renderbuffer,this),this._context=null)}},Li=class{constructor(e=0,i=e){this.width=e,this.height=i,this.target=sn.TEXTURE_2D,this.pixelFormat=pt.RGBA,this.dataType=hs.UNSIGNED_BYTE,this.samplingMode=Lt.LINEAR,this.wrapMode=Nt.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.depth=1,this.isImmutable=!1}};function _Ge(t){return t.width<=0||t.height<=0?0:t.width*t.height*(t.hasMipmap?4/3:1)*(t.internalFormat==null?4:fY(t.internalFormat))}let vGe=class yve extends Li{constructor(e,i){switch(super(),this.context=e,Object.assign(this,i),this.internalFormat){case Ge.R16F:case Ge.R16I:case Ge.R16UI:case Ge.R32F:case Ge.R32I:case Ge.R32UI:case Ge.R8_SNORM:case Ge.R8:case Ge.R8I:case Ge.R8UI:this.pixelFormat=pt.RED}}static validate(e,i){return new yve(e,i)}};const hte=4;let Pt=class{constructor(e,i=null,r=null){if(this.type=c_.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,r=i;else{const n=vGe.validate(e,i);if(!n)throw new W("Texture descriptor invalid");this._descriptor=n}if(this._descriptor.context.type!==ni.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),r1(this._descriptor.target)))throw new W("3D and array textures are not supported in WebGL1");this._descriptor.target===sn.TEXTURE_CUBE_MAP?this._setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get gpuMemoryUsage(){return SGe.delete(this),_Ge(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._glName&&this._descriptor.context.instanceCounter.decrement(Mn.Texture,this),this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(e,i){const r=this._descriptor;if(r.width!==e||r.height!==i){if(this._wasImmutablyAllocated)throw new W("Immutable textures can't be resized!");r.width=e,r.height=i,this._descriptor.target===sn.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let i=sn.TEXTURE_CUBE_MAP_POSITIVE_X;i<=sn.TEXTURE_CUBE_MAP_NEGATIVE_Z;i++)this._setData(e,i)}setData(e){this._setData(e)}_setData(e,i){if(!this._descriptor.context?.gl)return;const r=this._descriptor.context.gl;cf(r),this._glName||(this._glName=r.createTexture(),this._glName&&this._descriptor.context.instanceCounter.increment(Mn.Texture,this)),e===void 0&&(e=null);const n=this._descriptor,s=i??n.target,o=r1(s);e===null&&(n.width=n.width||hte,n.height=n.height||hte,o&&(n.depth=n.depth??1));const a=this._descriptor.context.bindTexture(this,Pt.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(Pt.TEXTURE_UNIT_FOR_UPDATES),G6(this._descriptor.context,n),this._configurePixelStorage(),cf(r);const l=this._deriveInternalFormat();if(j6(e)){let c="width"in e?e.width:e.codedWidth,u="height"in e?e.height:e.codedHeight;const d=1;e instanceof HTMLVideoElement&&(c=e.videoWidth,u=e.videoHeight),n.width&&n.height,o&&n.depth,n.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(s,l,n.hasMipmap,c,u,d),this._texImage(s,0,l,c,u,d,e),cf(r),n.hasMipmap&&this.generateMipmap(),n.width||(n.width=c),n.height||(n.height=u),o&&!n.depth&&(n.depth=d)}else{const{width:c,height:u,depth:d}=n;if(c==null||u==null)throw new W("Width and height must be specified!");if(o&&d==null)throw new W("Depth must be specified!");if(n.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(s,l,n.hasMipmap,c,u,d),gL(e)){const p=e.levels,m=fte(s,c,u,d),y=Math.min(m-1,p.length-1);this._descriptor.context.gl2!=null?r.texParameteri(n.target,this._descriptor.context.gl2.TEXTURE_MAX_LEVEL,y):n.hasMipmap=n.hasMipmap&&m===p.length;const _=l;if(!xGe(_))throw new W("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel((v,w,x,T)=>{const S=p[Math.min(v,p.length-1)];this._compressedTexImage(s,v,_,w,x,T,S)},y)}else this._texImage(s,0,l,c,u,d,e),cf(r),n.hasMipmap&&this.generateMipmap()}dte(r,this._descriptor),pte(r,this._descriptor),bGe(this._descriptor.context,this._descriptor),cf(r),this._descriptor.context.bindTexture(a,Pt.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,i,r,n,s,o,a=0){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const l=this._descriptor.context.gl,c=this._descriptor.context.gl2,u=this._descriptor,d=this._deriveInternalFormat(),{pixelFormat:p,dataType:m,target:y,isImmutable:_}=u;if(_&&!this._wasImmutablyAllocated)throw new W("Cannot update immutable texture before allocation!");const v=this._descriptor.context.bindTexture(this,Pt.TEXTURE_UNIT_FOR_UPDATES,!0);if((i<0||r<0||n>u.width||s>u.height||i+n>u.width||r+s>u.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),a){if(!c)return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(c.UNPACK_SKIP_ROWS,a)}if(j6(o)?c?c.texSubImage2D(y,e,i,r,n,s,p,m,o):l.texSubImage2D(y,e,i,r,p,m,o):gL(o)?l.compressedTexSubImage2D(y,e,i,r,n,s,d,o.levels[e]):l.texSubImage2D(y,e,i,r,n,s,p,m,o),a){if(!c)return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(c.UNPACK_SKIP_ROWS,0)}this._descriptor.context.bindTexture(v,Pt.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,i,r,n,s,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._descriptor.context.gl2;if(c==null)throw new W("3D textures are not supported in WebGL1");const u=this._descriptor,d=this._deriveInternalFormat(),{pixelFormat:p,dataType:m,isImmutable:y,target:_}=u;if(y&&!this._wasImmutablyAllocated)throw new W("Cannot update immutable texture before allocation!");r1(_)||console.warn("Attempting to set 3D texture data on a non-3D texture");const v=this._descriptor.context.bindTexture(this,Pt.TEXTURE_UNIT_FOR_UPDATES);if(this._descriptor.context.setActiveTexture(Pt.TEXTURE_UNIT_FOR_UPDATES),(i<0||r<0||n<0||s>u.width||o>u.height||a>u.depth||i+s>u.width||r+o>u.height||n+a>u.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),gL(l))l=l.levels[e],c.compressedTexSubImage3D(_,e,i,r,n,s,o,a,d,l);else{const w=l;c.texSubImage3D(_,e,i,r,n,s,o,a,p,m,w)}this._descriptor.context.bindTexture(v,Pt.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new W("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,G6(this._descriptor.context,e)}e.samplingMode===Lt.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=Lt.LINEAR_MIPMAP_NEAREST):e.samplingMode===Lt.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=Lt.NEAREST_MIPMAP_NEAREST);const i=this._descriptor.context.bindTexture(this,Pt.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(Pt.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(e.target),this._descriptor.context.bindTexture(i,Pt.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,G6(this._descriptor.context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._descriptor.context.gl,i=this._descriptor;this._samplingModeDirty&&(dte(e,i),this._samplingModeDirty=!1),this._wrapModeDirty&&(pte(e,i),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(this._descriptor.context.type===ni.WEBGL1)return this._descriptor.internalFormat=this._descriptor.pixelFormat;if(this._descriptor.internalFormat!=null)return this._descriptor.internalFormat===pt.DEPTH_STENCIL&&(this._descriptor.internalFormat=pt.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case hs.FLOAT:switch(this._descriptor.pixelFormat){case pt.RGBA:return this._descriptor.internalFormat=Ge.RGBA32F;case pt.RGB:return this._descriptor.internalFormat=Ge.RGB32F;default:throw new W("Unable to derive format")}case hs.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case pt.RGBA:return this._descriptor.internalFormat=Ge.RGBA8;case pt.RGB:return this._descriptor.internalFormat=Ge.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===pt.DEPTH_STENCIL?pt.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:i,flipped:r,preMultiplyAlpha:n}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,i),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n?1:0)}_texStorage(e,i,r,n,s,o){const a=this._descriptor.context.gl2;if(a==null)throw new W("Immutable textures are not supported in WebGL1");if(!wGe(i))throw new W("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=r?fte(e,n,s,o):1;if(r1(e)){if(o==null)throw new W("Missing depth dimension for 3D texture upload");a.texStorage3D(e,l,i,n,s,o)}else a.texStorage2D(e,l,i,n,s);this._wasImmutablyAllocated=!0}_texImage(e,i,r,n,s,o,a){const l=this._descriptor.context.gl,c=r1(e),{isImmutable:u,pixelFormat:d,dataType:p}=this._descriptor,m=this._descriptor.context.type===ni.WEBGL2,y=m?l:null;if(m||!j6(a))if(u){if(a!=null){const _=a;if(c){if(o==null)throw new W("Missing depth dimension for 3D texture upload");y.texSubImage3D(e,i,0,0,0,n,s,o,d,p,_)}else l.texSubImage2D(e,i,0,0,n,s,d,p,_)}}else{const _=a;if(c){if(o==null)throw new W("Missing depth dimension for 3D texture upload");y.texImage3D(e,i,r,n,s,o,0,d,p,_)}else l.texImage2D(e,i,r,n,s,0,d,p,_)}else l.texImage2D(e,0,r,d,p,a)}_compressedTexImage(e,i,r,n,s,o,a){const l=this._descriptor.context.gl;let c=null;const u=r1(e),d=this._descriptor.isImmutable;if(u){if(this._descriptor.context.type!==ni.WEBGL2)throw new W("3D textures are not supported in WebGL1");c=l}if(d){if(a!=null)if(u){if(o==null)throw new W("Missing depth dimension for 3D texture upload");c.compressedTexSubImage3D(e,i,0,0,0,n,s,o,r,a)}else l.compressedTexSubImage2D(e,i,0,0,n,s,r,a)}else if(u){if(o==null)throw new W("Missing depth dimension for 3D texture upload");c.compressedTexImage3D(e,i,r,n,s,o,0,a)}else l.compressedTexImage2D(e,i,r,n,s,0,a)}_forEachMipmapLevel(e,i=1/0){let{width:r,height:n,depth:s,hasMipmap:o,target:a}=this._descriptor;const l=a===sn.TEXTURE_3D;if(r==null||n==null||l&&s==null)throw new W("Missing texture dimensions for mipmap calculation");for(let c=0;e(c,r,n,s),o&&(r!==1||n!==1||l&&s!==1)&&!(c>=i);++c)r=Math.max(1,r>>1),n=Math.max(1,n>>1),l&&(s=Math.max(1,s>>1))}};function G6(t,e){(e.width!=null&&e.width<0||e.height!=null&&e.height<0||e.depth!=null&&e.depth<0)&&console.error("Negative dimension parameters are not allowed!");const i=t.type===ni.WEBGL2;i||!e.isImmutable&&!r1(e.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),!i&&(e.width!=null&&Eb(e.width)&&e.height!=null&&Eb(e.height)||(typeof e.wrapMode=="number"?e.wrapMode!==Nt.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):e.wrapMode.s===Nt.CLAMP_TO_EDGE&&e.wrapMode.t===Nt.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),e.hasMipmap&&console.error("Mipmapping requires power-of-two textures!")))}function dte(t,e){let i=e.samplingMode,r=e.samplingMode;i===Lt.LINEAR_MIPMAP_NEAREST||i===Lt.LINEAR_MIPMAP_LINEAR?(i=Lt.LINEAR,e.hasMipmap||(r=Lt.LINEAR)):i!==Lt.NEAREST_MIPMAP_NEAREST&&i!==Lt.NEAREST_MIPMAP_LINEAR||(i=Lt.NEAREST,e.hasMipmap||(r=Lt.NEAREST)),t.texParameteri(e.target,t.TEXTURE_MAG_FILTER,i),t.texParameteri(e.target,t.TEXTURE_MIN_FILTER,r)}function pte(t,e){typeof e.wrapMode=="number"?(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode)):(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode.s),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode.t))}function bGe(t,e){const i=t.capabilities.textureFilterAnisotropic;i&&t.gl.texParameterf(e.target,i.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}function wGe(t){return t in Ge}function xGe(t){return t in fn}function gL(t){return t!=null&&"type"in t&&t.type==="compressed"}function TGe(t){return t!=null&&"byteLength"in t}function j6(t){return t!=null&&!gL(t)&&!TGe(t)}function r1(t){return t===sn.TEXTURE_3D||t===sn.TEXTURE_2D_ARRAY}function fte(t,e,i,r=1){let n=Math.max(e,i);return t===sn.TEXTURE_3D&&(n=Math.max(n,r)),Math.round(Math.log(n)/Math.LN2)+1}Pt.TEXTURE_UNIT_FOR_UPDATES=0;const SGe=new Map,EGe=ne.getLogger("esri.views.webgl.FramebufferObject");let rp=class h2{constructor(e,i,r=null){this._context=e,this._glName=null,this._colorAttachments=new Map,this._depthStencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,e.instanceCounter.increment(Mn.FramebufferObject,this);const n=yL(i)?i:new Pt(this._context,i);if(this._colorAttachments.set(ll.COLOR_ATTACHMENT0,n),this._validateTextureDescriptor(n.descriptor),this._validateColorAttachmentPoint(ll.COLOR_ATTACHMENT0),r!=null)if(AGe(r))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),this._depthStencilTexture=yL(r)?r:new Pt(this._context,r),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const s=CGe(r)?r:new gve(this._context,r);this._depthStencilBuffer=s,this._validateRenderBufferDescriptor(s.descriptor)}}dispose(){if(this._colorAttachments.size===0&&!this._glName)return;const e=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((i,r)=>this.detachColorTexture(r)?.dispose()),this.detachDepthStencilBuffer()?.dispose(),this.detachDepthStencilTexture()?.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(Mn.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(ll.COLOR_ATTACHMENT0)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._colorAttachments.get(ll.COLOR_ATTACHMENT0)?.descriptor?.width??0}get height(){return this._colorAttachments.get(ll.COLOR_ATTACHMENT0)?.descriptor?.height??0}get gpuMemoryUsage(){return[...this._colorAttachments].reduce((e,[i,r])=>e+r.gpuMemoryUsage,this.depthStencil?.gpuMemoryUsage??0)}getColorTexture(e){const i=this._colorAttachments.get(e);return i&&yL(i)?i:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(e,i=ll.COLOR_ATTACHMENT0){if(!e)return;this._validateColorAttachmentPoint(i);const r=e.descriptor;this._validateTextureDescriptor(r),this.detachColorTexture(i)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,i)),this._colorAttachments.set(i,e)}detachColorTexture(e=ll.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(e);if(i)return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e)),this._colorAttachments.delete(e),i}setColorTextureTarget(e,i=ll.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(i);r&&this._framebufferTexture2D(r.glName,i,e)}attachDepthStencil(e){if(e)switch(e.type){case c_.Texture:return this._attachDepthStencilTexture(e);case c_.RenderBuffer:return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){if(e==null)return;const i=e.descriptor;i.pixelFormat!==pt.DEPTH_STENCIL&&i.pixelFormat!==pt.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),i.dataType!==hs.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),this._validateTextureDescriptor(i),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,ote)),this._depthStencilTexture?.dispose(),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;return e&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,ote)),this._depthStencilTexture=null,e}_attachDepthStencilBuffer(e){if(e==null)return;const i=e.descriptor;if(this._validateRenderBufferDescriptor(i),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,n=this._getGLAttachmentPoint(i);r.framebufferRenderbuffer(Eo.FRAMEBUFFER,n,r.RENDERBUFFER,e.glName)}this._depthStencilBuffer=e}detachDepthStencilBuffer(){const e=this._depthStencilBuffer;if(e&&this._initialized){this._context.bindFramebuffer(this);const i=this._context.gl,r=this._getGLAttachmentPoint(e.descriptor);i.framebufferRenderbuffer(Eo.FRAMEBUFFER,r,i.RENDERBUFFER,null)}return this._depthStencilBuffer=null,e}copyToTexture(e,i,r,n,s,o,a){(e<0||i<0||s<0||o<0)&&console.error("Offsets cannot be negative!"),(r<=0||n<=0)&&console.error("Copy width and height must be greater than zero!");const l=a.descriptor;a.descriptor.target!==sn.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),(l?.width==null||l?.height==null||e+r>this.width||i+n>this.height||s+r>l.width||o+n>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const c=this._context,u=c.bindTexture(a,Pt.TEXTURE_UNIT_FOR_UPDATES);c.setActiveTexture(Pt.TEXTURE_UNIT_FOR_UPDATES),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(sn.TEXTURE_2D,0,s,o,e,i,r,n),c.bindTexture(u,Pt.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,i,r,n,s,o,a){(r<=0||n<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,i,r,n,s,o,a)}async readPixelsAsync(e,i,r,n,s,o,a){if(this._context.type!==ni.WEBGL2)return gd()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(e,i,r,n,s,o,a);const l=this._context.gl,c=Ri.createPixelPack(this._context,vi.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(e,i,r,n,s,o,0),this._context.unbindBuffer(wt.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(e,i){if(this.width===e&&this.height===i)return;const r={width:e,height:i};G1(r,this._context.parameters.maxTextureSize),this._colorAttachments.forEach(n=>n.resize(r.width,r.height)),this._depthStencilTexture?.resize(r.width,r.height),this._initialized&&(G1(r,this._context.parameters.maxRenderbufferSize),this._depthStencilBuffer?.resize(r.width,r.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(e=Eo.FRAMEBUFFER){const i=this._context.gl;if(this._initialized)return void i.bindFramebuffer(e,this.glName);this._glName&&i.deleteFramebuffer(this._glName);const r=i.createFramebuffer();if(i.bindFramebuffer(e,r),this._colorAttachments.forEach((n,s)=>this._framebufferTexture2D(n.glName,s,mte(n),e)),this._depthStencilBuffer){const n=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);i.framebufferRenderbuffer(e,n,i.RENDERBUFFER,this._depthStencilBuffer.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,i.DEPTH_STENCIL_ATTACHMENT,mte(this._depthStencilTexture),e);gd()&&i.checkFramebufferStatus(e)!==i.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=r,this._initialized=!0}_framebufferTexture2D(e,i=ll.COLOR_ATTACHMENT0,r=sn.TEXTURE_2D,n=Eo.FRAMEBUFFER,s=0){this._context.gl.framebufferTexture2D(n,i,r,e,s)}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const i=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);e.framebufferRenderbuffer(Eo.FRAMEBUFFER,i,e.RENDERBUFFER,null)}this._depthStencilBuffer=et(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=et(this._depthStencilTexture))}_validateTextureDescriptor(e){e.target!==sn.TEXTURE_2D&&e.target!==sn.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),G1(e,this._context.parameters.maxTextureSize),this._validateBufferDimensions(e)}_validateRenderBufferDescriptor(e){G1(e,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(e)}_validateBufferDimensions(e){e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),this.width>0&&this.height>0&&(this.width===e.width&&this.height===e.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(e){switch(e.internalFormat){case ks.DEPTH_COMPONENT16:case ks.DEPTH_COMPONENT24:case ks.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case ks.DEPTH24_STENCIL8:case ks.DEPTH32F_STENCIL8:case ks.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case ks.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(e){if(h2._MAX_COLOR_ATTACHMENTS===-1){const r=this._context.capabilities.drawBuffers;if(r){const n=this._context.gl;h2._MAX_COLOR_ATTACHMENTS=n.getParameter(r.MAX_COLOR_ATTACHMENTS)}else h2._MAX_COLOR_ATTACHMENTS=1}const i=e-ll.COLOR_ATTACHMENT0;i+1>h2._MAX_COLOR_ATTACHMENTS&&ne.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${i+1}. Implementation supports up to ${h2._MAX_COLOR_ATTACHMENTS} color attachments`)}};function yL(t){return t!=null&&"type"in t&&t.type===c_.Texture}function CGe(t){return t!=null&&"type"in t&&t.type===c_.RenderBuffer}function AGe(t){return yL(t)||t!=null&&"pixelFormat"in t}function G1(t,e){const i=Math.max(t.width,t.height);if(i>e){EGe.warn(`Resizing FBO attachment size ${t.width}x${t.height} to device limit ${e}`);const r=e/i;return t.width=Math.round(t.width*r),t.height=Math.round(t.height*r),!1}return!0}function mte(t){return t.descriptor.target===sn.TEXTURE_CUBE_MAP?sn.TEXTURE_CUBE_MAP_POSITIVE_X:sn.TEXTURE_2D}rp._MAX_COLOR_ATTACHMENTS=-1;let OGe=class{constructor(e){this.rctx=e,this._acquired=new Set,this._cache=new V6(e.newCache,"FBOCache"),this._depthCache=new V6(e.newCache,"DepthAttachmentCache"),this._colorCache=new V6(e.newCache,"ColorAttachmentCache")}destroy(){this._cache.destroy(),this._depthCache.destroy(),this._colorCache.destroy()}clean(){this._cache.clean(),this._colorCache.clean(),this._depthCache.clean()}frame(){this._cache.frame(),this._colorCache.frame(),this._depthCache.frame()}get usedMemory(){return Array.from(this._acquired.values()).reduce((e,i)=>e+("colorTexture"in i?i.colorTexture?.gpuMemoryUsage??0:i.usedMemory),this._cache.usedMemory+this._colorCache.usedMemory+this._depthCache.usedMemory)}set interactive(e){this._cache.interactive=this._colorCache.interactive=this._depthCache.interactive=e}acquire(e,i,r){const n=H6(e,i,r),s=this._cache.pop(n)||new RGe(n,new rp(this.rctx,{...yte[e],width:i,height:r}),o=>(s.releaseDepth(),s.depth=this._acquireDepth(o,s.fbo.width,s.fbo.height),s.fbo.attachDepthStencil(s.depth.attachment),s),(o,a)=>{const l=this._acquireColor(o,i,r);return s.colors??(s.colors=new Map),s.colors.set(a,l),s.fbo.attachColorTexture(l.attachment,a),s});return s.release=()=>{this._acquired.delete(s),s.releaseDepth(),this._cache.put(s),s.release=()=>console.log(`Double FBO release in ${new Error().stack}`)},this.rctx.unbindTexture(s.fbo.colorTexture),this._trackHandle(s)}acquireDepth(e,i,r){return this._acquireDepth(e,i,r)}_acquireDepth(e,i,r){const n=H6(e,i,r),s=this._depthCache.pop(n);if(s)return this._trackHandle(s);const o=e===rs.DEPTH_STENCIL_TEXTURE?new gte(n,new Pt(this.rctx,{..._te[e],width:i,height:r}),()=>{this._acquired.delete(o),this._depthCache.put(o)}):new gte(n,new gve(this.rctx,{..._te[e],width:i,height:r}),()=>{this._acquired.delete(o),this._depthCache.put(o)});return this._trackHandle(o)}_acquireColor(e,i,r){const n=H6(e,i,r),s=this._colorCache.pop(n);if(s)return this._trackHandle(s);const o=new PGe(n,new Pt(this.rctx,{...yte[e],width:i,height:r}),()=>{this._acquired.delete(o),this._colorCache.put(o)});return this._trackHandle(o)}_trackHandle(e){return this._acquired.add(e),e}},RGe=class{constructor(e,i,r,n){this.key=e,this.fbo=i,this.acquireDepth=r,this.acquireColor=n,this.release=()=>{},this.incarnation=0}dispose(){this.fbo.dispose()}releaseDepth(){this.fbo.detachDepthStencilTexture(),this.fbo.detachDepthStencilBuffer(),this.depth=Jt(this.depth)}detachDepth(){const e=this.depth;return this.depth=void 0,this.fbo.detachDepthStencilTexture(),this.fbo.detachDepthStencilBuffer(),e}attachDepth(e){return this.releaseDepth(),e&&(this.fbo.attachDepthStencil(e.attachment),this.depth=e),this}releaseColor(e){this.fbo.detachColorTexture(e);const i=this.colors?.get(e);this.colors?.delete(e),Jt(i)}get colorTexture(){return this.fbo?.colorTexture}getColorTexture(e=ll.COLOR_ATTACHMENT0){return this.fbo?.getColorTexture(e)}get usedMemory(){return this.fbo.gpuMemoryUsage}},_ve=class{constructor(e,i,r){this.key=e,this.attachment=i,this.release=r,this.incarnation=0}dispose(){this.attachment.dispose()}get usedMemory(){return this.attachment.gpuMemoryUsage}},gte=class extends _ve{},PGe=class extends _ve{constructor(e,i,r){super(e,i,r),this.attachment=i,this.release=r}};function H6(t,e,i){return`${t}x${e}x${i}`}var hi;(function(t){t[t.RED=0]="RED",t[t.RG=1]="RG",t[t.RGBA4=2]="RGBA4",t[t.RGBA=3]="RGBA",t[t.RGBA_MIPMAP=4]="RGBA_MIPMAP",t[t.R16F=5]="R16F",t[t.RGBA16F=6]="RGBA16F"})(hi||(hi={}));const _L=new Li;_L.pixelFormat=pt.RED,_L.internalFormat=Ge.R8,_L.wrapMode=Nt.CLAMP_TO_EDGE;const vL=new Li;vL.pixelFormat=pt.RG,vL.internalFormat=Ge.RG8,vL.wrapMode=Nt.CLAMP_TO_EDGE;const bL=new Li;bL.internalFormat=Ge.RGBA4,bL.dataType=hs.UNSIGNED_SHORT_4_4_4_4,bL.wrapMode=Nt.CLAMP_TO_EDGE;const vve=new Li;vve.wrapMode=Nt.CLAMP_TO_EDGE;const oA=new Li;oA.wrapMode=Nt.CLAMP_TO_EDGE,oA.samplingMode=Lt.LINEAR_MIPMAP_LINEAR,oA.hasMipmap=!0,oA.maxAnisotropy=8;const aA=new Li;aA.pixelFormat=pt.RED,aA.dataType=hs.HALF_FLOAT,aA.internalFormat=Ge.R16F,aA.samplingMode=Lt.NEAREST;const wL=new Li;wL.dataType=hs.HALF_FLOAT,wL.internalFormat=Ge.RGBA16F,wL.samplingMode=Lt.NEAREST;const yte={[hi.RED]:_L,[hi.RG]:vL,[hi.RGBA4]:bL,[hi.RGBA]:vve,[hi.RGBA_MIPMAP]:oA,[hi.R16F]:aA,[hi.RGBA16F]:wL};var rs;(function(t){t[t.DEPTH_STENCIL_TEXTURE=0]="DEPTH_STENCIL_TEXTURE",t[t.DEPTH_STENCIL_BUFFER=1]="DEPTH_STENCIL_BUFFER",t[t.DEPTH24_BUFFER=2]="DEPTH24_BUFFER",t[t.DEPTH16_BUFFER=3]="DEPTH16_BUFFER"})(rs||(rs={}));const lA=new Li;lA.pixelFormat=pt.DEPTH_STENCIL,lA.dataType=hs.UNSIGNED_INT_24_8,lA.samplingMode=Lt.NEAREST,lA.wrapMode=Nt.CLAMP_TO_EDGE;const _te={[rs.DEPTH_STENCIL_TEXTURE]:lA,[rs.DEPTH_STENCIL_BUFFER]:new mL(ks.DEPTH24_STENCIL8,4),[rs.DEPTH24_BUFFER]:new mL(ks.DEPTH_COMPONENT24,4),[rs.DEPTH16_BUFFER]:new mL(ks.DEPTH_COMPONENT16,4)};let po=class{constructor(e,i,r,n,s,o=!1,a=0){this.name=e,this.count=i,this.type=r,this.offset=n,this.stride=s,this.normalized=o,this.divisor=a}};new po(O.POSITION,3,Ze.FLOAT,0,12);new po(O.POSITION,3,Ze.FLOAT,0,20),new po(O.UV0,2,Ze.FLOAT,12,20);new po(O.POSITION,3,Ze.FLOAT,0,32),new po(O.NORMAL,3,Ze.FLOAT,12,32),new po(O.UV0,2,Ze.FLOAT,24,32);new po(O.POSITION,3,Ze.FLOAT,0,16),new po(O.COLOR,4,Ze.UNSIGNED_BYTE,12,16);const mY=[new po(O.POSITION,2,Ze.FLOAT,0,8)],ER=[new po(O.POSITION,2,Ze.FLOAT,0,16),new po(O.UV0,2,Ze.FLOAT,8,16)],Bw=ne.getLogger("esri.views.webgl.VertexArrayObject");let bh=class{constructor(e,i,r,n,s=null){this._context=e,this._locations=i,this._layout=r,this._buffers=n,this._indexBuffer=s,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce((e,i)=>e+this._buffers[i].byteLength,this._indexBuffer!=null?this._indexBuffer.byteLength:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*Uue}dispose(){if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const e in this._buffers)this._buffers[e]?.dispose(),delete this._buffers[e];this._indexBuffer=et(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&Bw.warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&((this._context?.capabilities?.vao).deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(Mn.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const e=this._context.capabilities.vao;if(e){const i=e.createVertexArray();e.bindVertexArray(i),this._bindLayout(),e.bindVertexArray(null),this._glName=i,this._context.instanceCounter.increment(Mn.VertexArrayObject,this)}this._initialized=!0}bind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:e,_layout:i,_indexBuffer:r}=this;e||Bw.error("Vertex buffer dictionary is empty!");const n=this._context.gl;for(const s in e){const o=e[s];o||Bw.error("Vertex buffer is uninitialized!");const a=i[s];a||Bw.error("Vertex element descriptor is empty!"),dY(this._context,this._locations,o,a)}r!=null&&(this._context.capabilities.vao?n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r.glName):this._context.bindBuffer(r))}unbind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:e,_layout:i}=this;e||Bw.error("Vertex buffer dictionary is empty!");for(const r in e){const n=e[r];n||Bw.error("Vertex buffer is uninitialized!");const s=i[r];pY(this._context,this._locations,n,s)}this._indexBuffer!=null&&this._context.unbindBuffer(this._indexBuffer.bufferType)}},np=class extends bh{};function Zf(t,e=mY,i=fi,r=-1,n=1){let s=null;return e===ER?s=new Float32Array([r,r,0,0,n,r,1,0,r,n,0,1,n,n,1,1]):s=new Float32Array([r,r,n,r,r,n,n,n]),new np(t,i,{geometry:e},{geometry:Ri.createVertex(t,vi.STATIC_DRAW,s)})}function MGe(t,e=mY,i=fi){const r=new Float32Array([-1,-1,3,-1,-1,3]);return new np(t,i,{geometry:e},{geometry:Ri.createVertex(t,vi.STATIC_DRAW,r)})}const $Ge=4;function bve(t){const e=new Li($Ge);return e.samplingMode=Lt.NEAREST,new Pt(t,e)}function IGe(t){const e=new Li(1);return e.samplingMode=Lt.NEAREST,new Pt(t,e,new Uint8Array([255,255,255,255]))}const vte=16;function rb(t){return Math.ceil(t/vte)*vte}function LGe(t,e){let s=t.width*t.height;if(s<4096)return t instanceof ImageData?wve(t):t;let o=t.width,a=t.height;do o=Math.ceil(o/2),a=Math.ceil(a/2),s=o*a;while(s>1048576||e!=null&&(o>e||a>e));return gY(t,o,a)}function DGe(t,e){const i=Math.max(t.width,t.height);if(i<=e)return t;const r=e/i;return gY(t,Math.round(t.width*r),Math.round(t.height*r))}function gY(t,e,i){if(t instanceof ImageData)return gY(wve(t),e,i);const r=document.createElement("canvas");return r.width=e,r.height=i,r.getContext("2d").drawImage(t,0,0,r.width,r.height),r}function wve(t){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");if(i==null)throw new W("Failed to create 2d context from HTMLCanvasElement");return i.putImageData(t,0,0),e}function ha(t,e=!0){t.attributes.add(O.POSITION,"vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.code.add(b`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?b`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}let xve=class extends Ki{};function NGe(t){const e=new mi;e.include(ha),e.fragment.uniforms.add(new Je("colorTexture",r=>r.color),new Je("depthTexture",r=>r.depth));const i=t.haze;return e.fragment.code.add(b`
    void main() {
      ${i?b`vec4`:b`float`} depthSample = texture(depthTexture, uv) ${i?"":b`.r`};
      if (depthSample ${i?b`== vec4(0)`:b`!= 1.0`} ) {
          fragColor = vec4(0);
          return;
      }
      fragColor = texture(colorTexture, uv);
    }
    `),e}const FGe=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:xve,build:NGe},Symbol.toStringTag,{value:"Module"}));let Tve=class Sve extends Ci{initializeProgram(e){return new wi(e.rctx,Sve.shader.get().build(this.configuration),fi)}initializePipeline(){return this.configuration.haze?Ot({blending:fo(Te.ONE,Te.ZERO,Te.ONE_MINUS_SRC_COLOR,Te.ONE),depthTest:{func:Pi.ALWAYS},colorWrite:Ft}):Ot({blending:cc(Te.SRC_ALPHA,Te.ONE_MINUS_SRC_ALPHA),depthTest:{func:Pi.ALWAYS},colorWrite:Ft})}};Tve.shader=new bi(FGe,()=>pe(()=>import("./AtmosphereCompositing.glsl-e70a3ec1.js"),[],import.meta.url));let bte=class{constructor(e,i){this._view=e,this._context=i,this.type=Ho.Realistic,this._handles=new Dg,this._atmosphereCompositionParameters=new xve,this._atmosphereConfiguration=new ON,this._passParameters=new uGe,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=yi.radius,this._fadeHaze=0,this._updateRadius(yi.radius);const r=this._context.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([le(()=>this._view?.basemapTerrain?.rootTileElevationBounds,()=>this._view?.basemapTerrain?this._updateRootTileElevationBounds():null),le(()=>this._view?.basemapTerrain?.visibleElevationBounds,()=>this._view?.basemapTerrain?this._updateVisibleElevationBounds():null),le(()=>this._view?.environment.background,s=>{const o=s instanceof jfe?pO(s.color):ru;oe(this._passParameters.backgroundColor,o[0]*o[3],o[1]*o[3],o[2]*o[3])},Yi)]);const n=new ON;n.haze=!1,this._atmosphereTechnique=this._context.techniqueRepository.acquire(sA,n),n.haze=!0,this._atmosphereHazeTechnique=this._context.techniqueRepository.acquire(sA,n),n.reduced=!0,n.haze=!1,this._atmosphereReducedTechnique=this._context.techniqueRepository.acquire(sA,n),n.haze=!0,this._atmosphereHazeReducedTechnique=this._context.techniqueRepository.acquire(sA,n),this._vao=Zf(r,ER)}destroy(){this._handles.destroy(),this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._atmosphereReducedTechnique.release(),this._atmosphereHazeReducedTechnique.release(),this._vao.dispose()}render(e,i){this._render(e,i?this._atmosphereTechnique:this._atmosphereReducedTechnique,e.offscreenRenderingHelper.depthTexture,i,!1)}renderHaze(e,i,r){this._fadeHaze=i,this._render(e,r?this._atmosphereHazeTechnique:this._atmosphereHazeReducedTechnique,e.bindParameters.linearDepth?.colorTexture,r,!0)}_render(e,i,r,n,s){if(r==null)return;const o=e.offscreenRenderingHelper;this._update(e.bindParameters.camera),this._passParameters.depthTexture=r;const a=e.rctx.bindTechnique(i,this._passParameters,e.bindParameters);if(n)o.renderDepthDetached(()=>this._renderCommon(a,e));else{const l=e.rctx.getViewport(),c=we(e.bindParameters.camera.eye)-yi.radius;let u;if(c<yy){const _=Math.min(1,Math.max(0,c/yy));u=s?_t(.4,.5,_):_t(.2,.3,_)}else{const _=Math.min(1,Math.max(0,(c-yy)/(15*yy)));u=s?_t(.5,1,_):_t(.3,.6,_)}const d=rb(Math.round(u*e.bindParameters.camera.fullViewport[2])),p=rb(Math.round(u*e.bindParameters.camera.fullViewport[3]));e.rctx.setViewport(0,0,d,p);const m=o.renderToCachedFBO(null,()=>this._renderCommon(a,e),[0,0,0,1],hi.RGBA,null,d,p);e.rctx.setViewport(l.x,l.y,l.width,l.height),this._atmosphereCompositionParameters.color=m.colorTexture,this._atmosphereCompositionParameters.depth=r,this._atmosphereConfiguration.haze=s;const y=this._context.techniqueRepository.acquire(Tve,this._atmosphereConfiguration);e.rctx.bindTechnique(y,this._atmosphereCompositionParameters,e.bindParameters),o.renderDepthDetached(()=>e.rctx.screen.draw()),y.release(),m.release()}}_renderCommon(e,i){this._vao!=null&&(i.rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.rctx.drawArrays(Qt.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(e){return e*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const e=this._view.basemapTerrain.rootTileElevationBounds.min;e!==this._rootTileElevationMin&&(this._rootTileElevationMin=e,this._lowerBoundEarthRadius=yi.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=this._adjustRadiusForTesselation(yi.radius+this._view.basemapTerrain.visibleElevationBounds.min);e<this._lowerBoundEarthRadius&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e,si(this._passParameters.radii,e,e+yy),this._passParameters.innerFadeDistance=2*Math.sqrt((2*e-w7)*w7)}_update(e){if(!e)return;const i=Oo(e.eye),r=Math.sqrt(i),n=i-this._passParameters.radii[1]*this._passParameters.radii[1],s=_e((r-this._passParameters.radii[0])/yy,0,1);Mr(this._passParameters.heightParameters,r,i,n,s),this._passParameters.altitudeFade=uY(r-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=_t(_t(.6,1,X3(9500,10500,r-yi.radius)),1,this._fadeHaze)}static isSupported(e){return e.renderContext.rctx.capabilities.depthTexture}};function Eve(t){t.fragment.code.add(b`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function yY(t,e){switch(t.include(xf,e),e.textureCoordinateType){case In.Default:case In.Compressed:return void t.fragment.code.add(b`vec4 textureLookup(sampler2D tex, vec2 uv) {
return texture(tex, uv);
}`);case In.Atlas:return t.include(Eve),void t.fragment.code.add(b`vec4 textureLookup(sampler2D tex, vec2 uv) {
return textureAtlasLookup(tex, uv, vuvRegion);
}`);default:e.textureCoordinateType;case In.None:case In.COUNT:return}}let nu=class extends Qr{constructor(e,i){super(e,"vec3",_i.Draw,(r,n,s,o)=>r.setUniform3fv(e,i(n,s,o)))}},oh=class extends Qr{constructor(e,i){super(e,"sampler2D",_i.Draw,(r,n,s)=>r.bindTexture(e,i(n,s)))}},P_=class{constructor(e){this._material=e.material,this._techniqueRepository=e.techniqueRep,this._output=e.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}get _markerTextureRepository(){return this._techniqueRepository.constructionContext.markerTextureRepository}ensureTechnique(e,i){return this._technique=this._techniqueRepository.releaseAndAcquire(e,this._material.getConfiguration(this._output,i),this._technique),this._technique}ensureResources(e){return l_.LOADED}},_Y=class extends P_{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textureRepository=e.textureRepository,this._textureId=e.textureId,this._acquire(e.textureId,i=>this._texture=i),this._acquire(e.normalTextureId,i=>this._textureNormal=i),this._acquire(e.emissiveTextureId,i=>this._textureEmissive=i),this._acquire(e.occlusionTextureId,i=>this._textureOcclusion=i),this._acquire(e.metallicRoughnessTextureId,i=>this._textureMetallicRoughness=i)}dispose(){this._texture=Jt(this._texture),this._textureNormal=Jt(this._textureNormal),this._textureEmissive=Jt(this._textureEmissive),this._textureOcclusion=Jt(this._textureOcclusion),this._textureMetallicRoughness=Jt(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?l_.LOADED:l_.LOADING}get textureBindParameters(){return new Cve(this._texture!=null?this._texture.glTexture:null,this._textureNormal!=null?this._textureNormal.glTexture:null,this._textureEmissive!=null?this._textureEmissive.glTexture:null,this._textureOcclusion!=null?this._textureOcclusion.glTexture:null,this._textureMetallicRoughness!=null?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){this._texture!=null&&e===this._texture.id||(this._texture=Jt(this._texture),this._textureId=e,this._acquire(this._textureId,i=>this._texture=i))}_acquire(e,i){if(e==null)return void i(null);const r=this._textureRepository.acquire(e);if(dc(r))return++this._numLoading,void r.then(n=>{if(this._disposed)return Jt(n),void i(null);i(n)}).finally(()=>--this._numLoading);i(r)}},Cve=class extends Ki{constructor(e=null,i=null,r=null,n=null,s=null){super(),this.texture=e,this.textureNormal=i,this.textureEmissive=r,this.textureOcclusion=n,this.textureMetallicRoughness=s}};var it;(function(t){t[t.Disabled=0]="Disabled",t[t.Normal=1]="Normal",t[t.Schematic=2]="Schematic",t[t.Water=3]="Water",t[t.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",t[t.Terrain=5]="Terrain",t[t.TerrainWithWater=6]="TerrainWithWater",t[t.COUNT=7]="COUNT"})(it||(it={}));function vY(t,e){const i=t.fragment,r=e.hasMetallicRoughnessTexture||e.hasEmissionTexture||e.hasOcclusionTexture;if(e.pbrMode===it.Normal&&r&&t.include(yY,e),e.pbrMode!==it.Schematic)if(e.pbrMode!==it.Disabled){if(e.pbrMode===it.Normal){i.code.add(b`vec3 mrr;
vec3 emission;
float occlusion;`);const n=e.pbrTextureBindType;e.hasMetallicRoughnessTexture&&(i.uniforms.add(n===_i.Pass?new Je("texMetallicRoughness",s=>s.textureMetallicRoughness):new oh("texMetallicRoughness",s=>s.textureMetallicRoughness)),i.code.add(b`void applyMetallnessAndRoughness(vec2 uv) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),e.hasEmissionTexture&&(i.uniforms.add(n===_i.Pass?new Je("texEmission",s=>s.textureEmissive):new oh("texEmission",s=>s.textureEmissive)),i.code.add(b`void applyEmission(vec2 uv) {
emission *= textureLookup(texEmission, uv).rgb;
}`)),e.hasOcclusionTexture?(i.uniforms.add(n===_i.Pass?new Je("texOcclusion",s=>s.textureOcclusion):new oh("texOcclusion",s=>s.textureOcclusion)),i.code.add(b`void applyOcclusion(vec2 uv) {
occlusion *= textureLookup(texOcclusion, uv).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):i.code.add(b`float getBakedOcclusion() { return 1.0; }`),n===_i.Pass?i.uniforms.add(new $t("emissionFactor",s=>s.emissiveFactor),new $t("mrrFactors",s=>s.mrrFactors)):i.uniforms.add(new nu("emissionFactor",s=>s.emissiveFactor),new nu("mrrFactors",s=>s.mrrFactors)),i.code.add(b`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;

      ${e.hasMetallicRoughnessTexture?b`applyMetallnessAndRoughness(${e.hasMetallicRoughnessTextureTransform?b`metallicRoughnessUV`:"vuv0"});`:""}

      ${e.hasEmissionTexture?b`applyEmission(${e.hasEmissiveTextureTransform?b`emissiveUV`:"vuv0"});`:""}

      ${e.hasOcclusionTexture?b`applyOcclusion(${e.hasOcclusionTextureTransform?b`occlusionUV`:"vuv0"});`:""}
    }
  `)}}else i.code.add(b`float getBakedOcclusion() { return 1.0; }`);else i.code.add(b`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function bY(t,e){const i=t.fragment,r=e.lightingSphericalHarmonicsOrder!==void 0?e.lightingSphericalHarmonicsOrder:2;r===0?(i.uniforms.add(new $t("lightingAmbientSH0",(n,s)=>oe(wte,s.lighting.sh.r[0],s.lighting.sh.g[0],s.lighting.sh.b[0]))),i.code.add(b`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===1?(i.uniforms.add(new ai("lightingAmbientSH_R",(n,s)=>Mr(am,s.lighting.sh.r[0],s.lighting.sh.r[1],s.lighting.sh.r[2],s.lighting.sh.r[3])),new ai("lightingAmbientSH_G",(n,s)=>Mr(am,s.lighting.sh.g[0],s.lighting.sh.g[1],s.lighting.sh.g[2],s.lighting.sh.g[3])),new ai("lightingAmbientSH_B",(n,s)=>Mr(am,s.lighting.sh.b[0],s.lighting.sh.b[1],s.lighting.sh.b[2],s.lighting.sh.b[3]))),i.code.add(b`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===2&&(i.uniforms.add(new $t("lightingAmbientSH0",(n,s)=>oe(wte,s.lighting.sh.r[0],s.lighting.sh.g[0],s.lighting.sh.b[0])),new ai("lightingAmbientSH_R1",(n,s)=>Mr(am,s.lighting.sh.r[1],s.lighting.sh.r[2],s.lighting.sh.r[3],s.lighting.sh.r[4])),new ai("lightingAmbientSH_G1",(n,s)=>Mr(am,s.lighting.sh.g[1],s.lighting.sh.g[2],s.lighting.sh.g[3],s.lighting.sh.g[4])),new ai("lightingAmbientSH_B1",(n,s)=>Mr(am,s.lighting.sh.b[1],s.lighting.sh.b[2],s.lighting.sh.b[3],s.lighting.sh.b[4])),new ai("lightingAmbientSH_R2",(n,s)=>Mr(am,s.lighting.sh.r[5],s.lighting.sh.r[6],s.lighting.sh.r[7],s.lighting.sh.r[8])),new ai("lightingAmbientSH_G2",(n,s)=>Mr(am,s.lighting.sh.g[5],s.lighting.sh.g[6],s.lighting.sh.g[7],s.lighting.sh.g[8])),new ai("lightingAmbientSH_B2",(n,s)=>Mr(am,s.lighting.sh.b[5],s.lighting.sh.b[6],s.lighting.sh.b[7],s.lighting.sh.b[8]))),i.code.add(b`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),e.pbrMode!==it.Normal&&e.pbrMode!==it.Schematic||i.code.add(b`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const wte=C(),am=Kt();function CR(t){t.vertex.code.add(b`const float PI = 3.141592653589793;`),t.fragment.code.add(b`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}var ff,kb;function kGe(t){return t?.cubeMap!=null}function UGe(t){return t!=null&&!t.running}(function(t){t[t.RENDERING=0]="RENDERING",t[t.FADING=1]="FADING",t[t.FINISHED=2]="FINISHED"})(ff||(ff={})),function(t){t[t.RG=0]="RG",t[t.BA=1]="BA"}(kb||(kb={}));function Vg(t=Ave){return[t[0],t[1],t[2],t[3]]}function xL(t,e,i=Vg()){return se(i,t),i[3]=e,i}function xte(t,e,i=Vg()){return nt(i,t,e),ge(i,i),i[3]=-Hde(t,e),i}function Tte(t,e,i=Vg()){return uO(lM,t,P7(t)),uO(Ste,e,P7(e)),YW(lM,Ste,lM),BGe(i,za(WW(i,lM)))}function qRt(t,e,i,r=Vg()){return xL(Bde,t,cM),xL(Vde,e,Ete),xL(aq,i,Cte),Tte(cM,Ete,cM),Tte(cM,Cte,r),r}function WRt(t){return t}function zGe(t){return t[3]}function P7(t){return Rt(t[3])}function BGe(t,e){return t[3]=e,t}const Ave=[0,0,1,0],lM=Sh(),Ste=Sh();Vg();const cM=Vg(),Ete=Vg(),Cte=Vg();let VGe=class{constructor(){this.readChannels=kb.RG,this.renderingStage=ff.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=C(),this.parallax=new Ate,this.parallaxNew=new Ate,this.pointOnGround=C(),this.fadeMode=_r.HIDE,this.fadeFactor=0,this.opacity=0}updateParallax(e){const i=this.parallax,r=we(e.eye);if(i.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(r*r-yi.radius*yi.radius,0))/r,xte(Ote,i.anchorPointClouds,Vw),Jl(i.transform,zr,Vw[3],Vw),this.fadeMode===_r.CROSS_FADE){const n=this.parallaxNew;xte(Ote,n.anchorPointClouds,Vw),Jl(n.transform,zr,Vw[3],Vw)}}updateFading(e,i,r,n){this.isFading&&this._advanceFading(r,n),this._evaluateFading(e,i,r)}_evaluateFading(e,i,r){const n=e.relativeElevation,s=this._calculateDistanceToAnchorPoint(e);if((n>1.7*Wm||n<-Wm||s>WGe)&&this.opacity>0)this._setFade(_r.HIDE,r);else if(!this.isFading){if((n>Wm||n<-.35*Wm||s>qGe)&&this.opacity>0)this._setFade(_r.FADE_OUT,r);else if(n<=Wm&&n>=-.35*Wm&&i===Si.IDLE&&UGe(this.data)){if(this.opacity===0)return void this._setFade(_r.FADE_IN,r);(s>HGe||this.renderingStage===ff.FADING)&&this._setFade(_r.CROSS_FADE,r)}}}_advanceFading(e,i){this._switchReadChannels(),this._updateAnchorPoint(),this._advanceFadingFactorAndOpacity(e,i)}_advanceFadingFactorAndOpacity(e,i){if(this.fadeFactor<1)return this.fadeFactor=i?_e((e-this.startTime)/(jGe*i),0,1):1,this.fadeMode===_r.FADE_OUT&&(this.opacity=1-this.fadeFactor),this.fadeMode===_r.FADE_IN&&(this.opacity=this.fadeFactor),void(this.fadeMode===_r.CROSS_FADE&&(this.opacity=1));this.fadeFactor=0,this.fadeMode===_r.FADE_OUT&&(this.opacity=0),this.fadeMode===_r.FADE_IN&&(this.opacity=1),this.fadeMode===_r.CROSS_FADE&&(this.opacity=1),this.fadeMode=_r.NONE}_switchReadChannels(){const e=this.fadeMode===_r.CROSS_FADE&&this.fadeFactor===1,i=this.fadeMode===_r.FADE_IN&&this.fadeFactor===0;this.renderingStage===ff.FADING&&(e||i)&&(this.readChannels=1-this.readChannels,this.renderingStage=ff.FINISHED)}_calculateDistanceToAnchorPoint(e){return ge(this.pointOnGround,e.eye),te(this.pointOnGround,this.pointOnGround,yi.radius),we(he(GGe,this.parallax.anchorPointClouds,this.pointOnGround))}_updateAnchorPoint(){this.fadeMode===_r.CROSS_FADE&&(this.fadeFactor===0&&se(this.parallaxNew.anchorPointClouds,this.pointOnGround),this.fadeFactor===1&&se(this.parallax.anchorPointClouds,this.parallaxNew.anchorPointClouds)),this.fadeMode===_r.FADE_IN&&this.fadeFactor===0&&se(this.parallax.anchorPointClouds,this.pointOnGround)}_setFade(e,i){switch(e){case _r.HIDE:this.opacity=0;break;case _r.FADE_OUT:this.opacity=1;break;case _r.FADE_IN:this.opacity=0;break;case _r.CROSS_FADE:this.opacity=1}this.fadeMode=e,this.fadeFactor=0,this.startTime=i}get isFading(){return this.fadeMode===_r.FADE_OUT||this.fadeMode===_r.FADE_IN||this.fadeMode===_r.CROSS_FADE}};var _r;(function(t){t[t.NONE=0]="NONE",t[t.HIDE=1]="HIDE",t[t.FADE_OUT=2]="FADE_OUT",t[t.FADE_IN=3]="FADE_IN",t[t.CROSS_FADE=4]="CROSS_FADE"})(_r||(_r={}));let Ate=class{constructor(){this.anchorPointClouds=C(),this.radiusCurvatureCorrectionFactor=0,this.transform=be()}};const Ote=Ce(0,0,1),Vw=Vg(),GGe=C(),jGe=1.25,HGe=34e3,qGe=64e3,WGe=2e5;let Tf=class extends Qr{constructor(e,i){super(e,"bool",_i.Pass,(r,n,s)=>r.setUniform1b(e,i(n,s)))}},YGe=class extends Qr{constructor(e,i){super(e,"samplerCube",_i.Pass,(r,n,s)=>r.bindTexture(e,i(n,s)))}};function Ove(t){const e=t.fragment;e.uniforms.add(new Vr("rotationMatrixClouds",(i,r)=>r.cloudsFade.parallax.transform),new Vr("rotationMatrixCloudsCrossFade",(i,r)=>r.cloudsFade.parallaxNew.transform),new $t("anchorPosition",(i,r)=>r.cloudsFade.parallax.anchorPointClouds),new $t("anchorPositionCrossFade",(i,r)=>r.cloudsFade.parallaxNew.anchorPointClouds),new Oe("cloudsHeight",()=>t5e),new Oe("radiusCurvatureCorrectionFactor",(i,r)=>r.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new Oe("totalFadeInOut",(i,r)=>1-r.cloudsFade.opacity),new Oe("crossFadeAnchorFactor",(i,r)=>_e(r.cloudsFade.fadeFactor,0,1)),new YGe("cubeMap",(i,r)=>r.cloudsFade.data?.cubeMap?.colorTexture??null),new Tf("crossFade",(i,r)=>r.cloudsFade.fadeMode===_r.CROSS_FADE),new Tf("readChannelsRG",(i,r)=>r.cloudsFade.readChannels===kb.RG),new Tf("fadeTextureChannels",(i,r)=>r.cloudsFade.renderingStage===ff.FADING)),e.constants.add("planetRadius","float",yi.radius),e.code.add(b`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),e.code.add(b`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),e.code.add(b`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),Bg(e),Wf(e),e.code.add(b`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),e.code.add(b`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = texture(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),e.code.add(b`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),e.code.add(b`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),e.code.add(b`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function Jf(t){t.code.add(b`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function XGe(){const t=new mi,{attributes:e,varyings:i,vertex:r,fragment:n}=t;return e.add(O.POSITION,"vec2"),i.add("worldRay","vec3"),r.uniforms.add(new Vr("inverseProjectionMatrix",(s,o)=>o.camera.inverseProjectionMatrix),new Vr("inverseViewMatrix",(s,o)=>$S(ZGe,o.camera.viewMatrix))),r.code.add(b`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),n.include(Jf),n.include(Eh),t.include(bY,{pbrMode:it.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(CR),t.include(EF),t.include(CN),t.include(Ove),n.uniforms.add(new $t("cameraPosition",(s,o)=>o.camera.eye)),n.code.add(b`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),t}const ZGe=be(),JGe=Object.freeze(Object.defineProperty({__proto__:null,build:XGe},Symbol.toStringTag,{value:"Module"}));let Rve=class Pve extends Ci{constructor(e){super(e,new bl,()=>this.destroy())}initializeProgram(e){return new wi(e.rctx,Pve.shader.get().build(),fi)}initializePipeline(){return Ot({blending:fo(Te.ONE,Te.ZERO,Te.SRC_ALPHA,Te.ONE),depthTest:{func:Pi.LEQUAL},colorWrite:Ft})}};Rve.shader=new bi(JGe,()=>pe(()=>import("./CloudsComposition.glsl-57e9e51f.js"),[],import.meta.url));let n1=class extends xe{constructor(e){super(e),this._technique=new Rve(e),this._vao=Zf(e.rctx)}destroy(){this._technique=Jt(this._technique),this._vao=et(this._vao)}render(e){if(!this._technique.compiled)return void this.requestRender();const i=e.bindParameters.cloudsFade;if(this._vao==null||i.data==null)return;const r=e.rctx.bindTechnique(this._technique,KGe,e.bindParameters);e.rctx.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(Qt.TRIANGLE_STRIP,0,4)}};h([f({constructOnly:!0})],n1.prototype,"rctx",void 0),h([f({constructOnly:!0})],n1.prototype,"viewingMode",void 0),h([f({constructOnly:!0})],n1.prototype,"planetRadius",void 0),h([f({constructOnly:!0})],n1.prototype,"requestRender",void 0),n1=h([z("esri.views.3d.environment.CloudsComposition")],n1);const KGe=new Ki;function mn(){return new Float32Array(3)}function M7(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Hi(t,e,i){const r=new Float32Array(3);return r[0]=t,r[1]=e,r[2]=i,r}function QGe(t,e){return new Float32Array(t,e,3)}function wY(){return mn()}function Mve(){return Hi(1,1,1)}function $ve(){return Hi(1,0,0)}function Ive(){return Hi(0,1,0)}function Lve(){return Hi(0,0,1)}const eje=wY(),tje=Mve(),ije=$ve(),rje=Ive(),nje=Lve();Object.freeze(Object.defineProperty({__proto__:null,ONES:tje,UNIT_X:ije,UNIT_Y:rje,UNIT_Z:nje,ZEROS:eje,clone:M7,create:mn,createView:QGe,fromValues:Hi,ones:Mve,unitX:$ve,unitY:Ive,unitZ:Lve,zeros:wY},Symbol.toStringTag,{value:"Module"}));var fl;(function(t){t[t.SIXTEEN=0]="SIXTEEN",t[t.HUNDRED=1]="HUNDRED",t[t.TWOHUNDRED=2]="TWOHUNDRED",t[t.COUNT=3]="COUNT"})(fl||(fl={}));let TL=class extends bl{constructor(){super(...arguments),this.steps=fl.SIXTEEN,this.writeTextureChannels=kb.RG}};h([V({count:fl.COUNT})],TL.prototype,"steps",void 0),h([V({constValue:ie("esri-mobile")?1024:2048})],TL.prototype,"cubeMapSize",void 0),h([V()],TL.prototype,"writeTextureChannels",void 0);let cA=class{constructor(e,i,r,n,s,o,a,l,c=.5){this.coverage=e,this.density=i,this.absorption=r,this.cloudSize=n,this.detailSize=s,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}};const Rte=new cA([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],fl.SIXTEEN),jo={sunny:Rte,cloudy:new cA([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],fl.TWOHUNDRED,.6),rainy:new cA([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],fl.TWOHUNDRED,.4),snowy:new cA([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],fl.HUNDRED,.65),foggy:new cA([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],fl.SIXTEEN),default:Rte},Wu=ie("esri-mobile")?64:128,sje=Wu/128,dd=Math.ceil(Math.sqrt(Wu)),Wy=(Wu+2)*dd,oje=1e5,q6=128,aje=Wy/1560;let mO=class extends Qr{constructor(e,i){super(e,"mat3",_i.Draw,(r,n,s)=>r.setUniformMatrix3fv(e,i(n,s)))}},Dve=class extends Ki{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=jo.default.raymarchingSteps,this.weatherTile=Ue()}},Nve=class extends Ki{constructor(){super(...arguments),this.viewMatrix=Hr()}};function lje(t){const e=new mi;e.include(ha,!1);const i=e.fragment;return i.uniforms.add(new Oe("cloudRadius",r=>r.cloudRadius),new Oe("power",r=>_t(35,120,r.absorption)),new Oe("sigmaE",r=>1+r.absorption),new Oe("density",r=>_t(0,.3,r.density)),new Oe("cloudSize",r=>_t(0,.02,Math.max(.01,1-r.cloudSize))),new Oe("detailSize",r=>_t(0,.2,Math.max(.01,1-r.detailSize))),new Oe("smoothness",r=>_t(0,.5,1-r.smoothness)),new Oe("cloudHeight",r=>_t(0,1500,r.cloudHeight)),new Oe("coverage",r=>r.coverage),new mO("view",r=>r.viewMatrix),new Je("cloudShapeTexture",r=>r.noiseTexture!=null?r.noiseTexture.textureAtlas:null),new zi("cloudVariables",r=>si(cje,r.coverage,r.absorption))),i.constants.add("halfCubeMapSize","float",.5*t.cubeMapSize),i.code.add(b`
    const int STEPS = ${t.steps===fl.SIXTEEN?b`16`:t.steps===fl.HUNDRED?b`100`:b`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),i.code.add(b`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${b.float(Wy)};
      const float dataWidth = ${b.float(Wy)};
      const float tileRows = ${b.float(dd)};
      const vec3 atlasDimensions = vec3(${b.float(Wu)}, ${b.float(Wu)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${b.float(sje)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${b.float(aje)} * p) / ${b.float(Wy)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `),i.code.add(b`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),i.code.add(b`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),i.code.add(`
    float multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      float luminance = 0.0;

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),i.code.add(b`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),i.code.add(b`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),i.code.add(b`void main() {
if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),e}const cje=Ue(),uje=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:Nve,CloudsPassParameters:Dve,build:lje},Symbol.toStringTag,{value:"Module"}));let Fve=class kve extends Ci{constructor(e,i){super(e,i,()=>this.destroy())}initializeProgram(e){return new wi(e.rctx,kve.shader.get().build(this.configuration),fi)}initializePipeline(){return Ot({blending:cc(Te.CONSTANT_COLOR,Te.ONE_MINUS_CONSTANT_COLOR,Df.ADD,this.configuration.writeTextureChannels===kb.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:Pi.LEQUAL},colorWrite:Ft})}};Fve.shader=new bi(uje,()=>pe(()=>import("./Clouds.glsl-7914cf1f.js"),[],import.meta.url));var qc;(function(t){t[t.Full=0]="Full",t[t.WeatherMap=1]="WeatherMap",t[t.COUNT=2]="COUNT"})(qc||(qc={}));let $7=class extends bl{constructor(){super(...arguments),this.mode=qc.Full}};h([V({count:qc.COUNT})],$7.prototype,"mode",void 0);let Uve=class extends Ki{constructor(){super(...arguments),this.weatherTile=ri(0,0)}};function hje(t){const e=new mi;return e.include(ha,!1),e.fragment.code.add(b`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.mode===qc.Full&&e.fragment.code.add(b`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${b.float(dd)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${b.float(8)});

      float worley0 = worley(p, ${b.float(2)} * 2.0);
      float worley1 = worley(p, ${b.float(2)} * 8.0);
      float worley2 = worley(p, ${b.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${b.float(2)});
      float worley1 = worley(p, ${b.float(2)} * 2.0);
      float worley2 = worley(p, ${b.float(2)} * 4.0);
      float worley3 = worley(p, ${b.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),e.fragment.uniforms.add(new zi("weatherTile",i=>i.weatherTile)),e.fragment.code.add(b`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${b.float(q6)});

      // Get global coordinates of p
      p += weatherTile * ${b.float(q6)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${b.float(oje)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),e.fragment.code.add(b`void main() {`),t.mode===qc.Full&&e.fragment.code.add(b`
        float padWidth = 1.0;
        float paddedSize = ${b.float(Wu)} + 2.0 * padWidth;
        float tileCount = ${b.float(dd)} * ${b.float(dd)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${b.float(Wu)};
          }

          if (startPadY) {
            pixel.y += ${b.float(Wu)};
          }

          if (endPadX) {
            pixel.x -= ${b.float(Wu)};
          }

          if (endPadY) {
            pixel.y -= ${b.float(Wu)};
          }

          uv = vec2(pixel.xy / ${b.float(Wu)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${b.float(Wu)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${b.float(dd)} * ${b.float(dd)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${b.float(dd)} * ${b.float(dd)});
        p = p_;
        p.z /= (${b.float(dd)} * ${b.float(dd)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),e.fragment.code.add(b`
      vec2 mapUV = ${b.float(q6)} * (gl_FragCoord.xy / ${b.float(Wy)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${t.mode===qc.Full?b`fragColor.ba = vec2(0.0, map);`:b`fragColor = vec4(map);`};
    }
  `),e}const dje=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:Uve,build:hje},Symbol.toStringTag,{value:"Module"}));let I7=class zve extends Ci{initializeProgram(e){return new wi(e.rctx,zve.shader.get().build(this.configuration),fi)}initializePipeline(){return Ot({blending:this.configuration.mode===qc.Full?cc(Te.ONE,Te.ZERO):fo(Te.ZERO,Te.ONE,Te.ONE,Te.ZERO),depthTest:{func:Pi.ALWAYS},colorWrite:Ft})}};I7.shader=new bi(dje,()=>pe(()=>import("./NoiseTextureAtlas.glsl-75bad04c.js"),[],import.meta.url));let uA=class extends xe{constructor(e){super(e),this._needsRender=!0,this._passParameters=new Uve,this._frameBuffer=new rp(e.context.renderContext.rctx,new Li(Wy)),this._vao=Zf(e.context.renderContext.rctx)}get _techniqueRepository(){return this.context.techniqueRepository}get textureAtlas(){return this._texture!=null?this._weatherMapTechnique!=null&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(qc.WeatherMap)):this._fullTechnique!=null&&this._fullTechnique.compiled&&(this._texture=this._render(qc.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||(Yn(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=Jt(this._fullTechniqueCached),this._weatherMapTechniqueCached=Jt(this._weatherMapTechniqueCached),this._frameBuffer=et(this._frameBuffer),this._vao=et(this._vao)}get _fullTechnique(){if(this._fullTechniqueCached==null){const e=new $7;e.mode=qc.Full,this._fullTechniqueCached=this._techniqueRepository.acquire(I7,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(this._weatherMapTechniqueCached==null){const e=new $7;e.mode=qc.WeatherMap,this._weatherMapTechniqueCached=this._techniqueRepository.acquire(I7,e)}return this._weatherMapTechniqueCached}_render(e){if(this._vao==null||this._frameBuffer==null)return null;const i=e===qc.Full?this._fullTechnique:this._weatherMapTechnique,r=this.context.renderContext.rctx,n=r.getViewport();r.setViewport(0,0,Wy,Wy),r.bindFramebuffer(this._frameBuffer);const s=r.bindTechnique(i,this._passParameters,null);return r.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.setViewport(n.x,n.y,n.width,n.height),this._needsRender=!1,this._frameBuffer.colorTexture}};h([f({constructOnly:!0})],uA.prototype,"context",void 0),h([f({readOnly:!0})],uA.prototype,"_techniqueRepository",null),uA=h([z("esri.views.3d.environment.NoiseTextureAtlas")],uA);var kl;(function(t){t[t.Occluded=0]="Occluded",t[t.NotOccluded=1]="NotOccluded",t[t.Both=2]="Both",t[t.COUNT=3]="COUNT"})(kl||(kl={}));function Bve(t){t.include(vh),t.uniforms.add(new Je("geometryDepthTexture",(e,i)=>i.multipassGeometry.linearDepth?.colorTexture),new zi("nearFar",(e,i)=>i.camera.nearFar)),t.code.add(b`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}let pje=class{};function uc(t,e){if(!e.multipassEnabled)return;t.fragment.include(vh),t.fragment.uniforms.add(new Je("terrainDepthTexture",(r,n)=>n.multipassTerrain.linearDepth?.colorTexture)),t.fragment.uniforms.add(new zi("nearFar",(r,n)=>n.camera.nearFar));const i=e.occlusionPass;t.fragment.code.add(b`
   ${i?"bool":"void"} terrainDepthTest(float fragmentDepth) {
      vec4 data = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0);
      float linearDepth = linearDepthFromRGBA(data, nearFar);
      ${i?b`return fragmentDepth < linearDepth && data != vec4(0.0, 0.0, 0.0, 1.0);`:b`
          if(fragmentDepth ${e.cullAboveGround?">":"<="} linearDepth){
            discard;
          }`}
    }`)}let fje=class{constructor(){this.cullAboveGround=!1}};function AF(t){return t?{ray:_s(t.ray),c0:t.c0,c1:t.c1}:{ray:_s(),c0:0,c1:Number.MAX_VALUE}}function mje(t,e=AF()){return fN(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function gje(t,e,i=AF()){const r=we(t.vector);return I0e(t.origin,e,i.ray),i.c0=0,i.c1=r,i}function cPt(t,e){return Vve(t,t.c0,e)}function uPt(t,e){return Vve(t,t.c1,e)}function Vve(t,e,i){return ce(i,t.ray.origin,te(i,t.ray.direction,e))}new kg(()=>AF());function gO(t){return t?[Ti(t[0]),Ti(t[1]),Ti(t[2]),Ti(t[3]),Ti(t[4]),Ti(t[5])]:[Ti(),Ti(),Ti(),Ti(),Ti(),Ti()]}function Gve(){return[C(),C(),C(),C(),C(),C(),C(),C()]}function RN(t,e){for(let i=0;i<jS;i++)uF(t[i],e[i]);return t}function jve(t,e,i,r=xje){const n=Di(EW.get(),e,t);qn(n,n);for(let s=0;s<bje;++s){const o=Xc(SW.get(),wje[s],n);oe(r[s],o[0]/o[3],o[1]/o[3],o[2]/o[3])}Hve(i,r)}function Hve(t,e){Ko(e[We.FAR_BOTTOM_LEFT],e[We.NEAR_BOTTOM_LEFT],e[We.NEAR_TOP_LEFT],t[ur.LEFT]),Ko(e[We.NEAR_BOTTOM_RIGHT],e[We.FAR_BOTTOM_RIGHT],e[We.FAR_TOP_RIGHT],t[ur.RIGHT]),Ko(e[We.FAR_BOTTOM_LEFT],e[We.FAR_BOTTOM_RIGHT],e[We.NEAR_BOTTOM_RIGHT],t[ur.BOTTOM]),Ko(e[We.NEAR_TOP_LEFT],e[We.NEAR_TOP_RIGHT],e[We.FAR_TOP_RIGHT],t[ur.TOP]),Ko(e[We.NEAR_BOTTOM_LEFT],e[We.NEAR_BOTTOM_RIGHT],e[We.NEAR_TOP_RIGHT],t[ur.NEAR]),Ko(e[We.FAR_BOTTOM_RIGHT],e[We.FAR_BOTTOM_LEFT],e[We.FAR_TOP_LEFT],t[ur.FAR])}function Uy(t,e){for(let i=0;i<jS;i++){const r=t[i];if(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]>=e[3])return!1}return!0}function yje(t,e){return Wve(t,mje(e,Yve.get()))}function hPt(t,e){for(let i=0;i<jS;i++){const r=t[i];if(!XUe(r,e))return!1}return!0}function _je(t,e,i){return Wve(t,gje(e,i,Yve.get()))}function qve(t,e){for(let i=0;i<jS;i++)if(ir(t[i],e)>0)return!1;return!0}function Wve(t,e){for(let i=0;i<jS;i++)if(!YUe(t[i],e))return!1;return!0}var ur,We;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.TOP=3]="TOP",t[t.NEAR=4]="NEAR",t[t.FAR=5]="FAR"})(ur||(ur={})),function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",t[t.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(We||(We={}));const vje={bottom:[We.FAR_BOTTOM_RIGHT,We.NEAR_BOTTOM_RIGHT,We.NEAR_BOTTOM_LEFT,We.FAR_BOTTOM_LEFT],near:[We.NEAR_BOTTOM_LEFT,We.NEAR_BOTTOM_RIGHT,We.NEAR_TOP_RIGHT,We.NEAR_TOP_LEFT],far:[We.FAR_BOTTOM_RIGHT,We.FAR_BOTTOM_LEFT,We.FAR_TOP_LEFT,We.FAR_TOP_RIGHT],right:[We.NEAR_BOTTOM_RIGHT,We.FAR_BOTTOM_RIGHT,We.FAR_TOP_RIGHT,We.NEAR_TOP_RIGHT],left:[We.FAR_BOTTOM_LEFT,We.NEAR_BOTTOM_LEFT,We.NEAR_TOP_LEFT,We.FAR_TOP_LEFT],top:[We.FAR_TOP_LEFT,We.NEAR_TOP_LEFT,We.NEAR_TOP_RIGHT,We.FAR_TOP_RIGHT]},jS=6,bje=8,wje=[Mt(-1,-1,-1,1),Mt(1,-1,-1,1),Mt(1,1,-1,1),Mt(-1,1,-1,1),Mt(-1,-1,1,1),Mt(1,-1,1,1),Mt(1,1,1,1),Mt(-1,1,1,1)],Yve=new kg(AF),xje=Gve();function Tje(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/e)}function Sje(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/i)}function Eje(t,e,i){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}function Cje(t,e,i){return 2*Math.atan(i*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}var L7;let ht=L7=class extends xe{constructor(t={}){super(t),this._center=C(),this._up=C(),this._viewUp=C(),this._viewForward=C(),this._viewRight=C(),this._ray=_s(),this._viewport=Mt(0,0,1,1),this._padding=Mt(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=ri(1,1e3),this._viewDirty=!0,this._viewMatrix=be(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=be(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=be(),this._frustumDirty=!0,this._frustum=gO(),this._fullViewport=Kt(),this._pixelRatio=1,this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return he(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){Nn(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=Tb(Kt(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&Sb(t,e)?e:t}get screenPadding(){if(this.pixelRatio===1)return this._padding;const t=Tb(Kt(),this._padding,1/this.pixelRatio),e=this._get("screenPadding");return e&&Sb(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[Xt.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[Xt.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[Xt.RIGHT]+this._padding[Xt.LEFT]}set fullWidth(t){this.width=t-(this._padding[Xt.RIGHT]+this._padding[Xt.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[Xt.TOP]+this._padding[Xt.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[Xt.TOP]+this._padding[Xt.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[Xt.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[Xt.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){nT(this._padding,t)||(this._viewport[0]+=t[Xt.LEFT]-this._padding[Xt.LEFT],this._viewport[1]+=t[Xt.BOTTOM]-this._padding[Xt.BOTTOM],this._viewport[2]-=t[Xt.RIGHT]+t[Xt.LEFT]-(this._padding[Xt.RIGHT]+this._padding[Xt.LEFT]),this._viewport[3]-=t[Xt.TOP]+t[Xt.BOTTOM]-(this._padding[Xt.TOP]+this._padding[Xt.BOTTOM]),Cd(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Di(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){const t=this.width,e=this.height,i=this.near*Math.tan(this.fovY/2),r=i*this._aspect,n=ppe(be(),-r*(1+2*this._padding[Xt.LEFT]/t),r*(1+2*this._padding[Xt.RIGHT]/t),-i*(1+2*this._padding[Xt.BOTTOM]/e),i*(1+2*this._padding[Xt.TOP]/e),this.near,this.far),s=this._get("projectionMatrix");return s&&I4(s,n)?s:n}get inverseProjectionMatrix(){return qn(be(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||be()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return Eje(this._fov,this.width,this.height)}set fovX(t){this._fov=Tje(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return Cje(this._fov,this.width,this.height)}set fovY(t){this._fov=Sje(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return br(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(qn(this._viewInverseTransposeMatrix,this.viewMatrix),sc(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const e=2*t-1;return 2*this.near*this.far/(this.far+this.near-e*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}copyFrom(t){se(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,Cd(this._viewport,t.viewport),this.notifyChange("_viewport"),Cd(this._padding,t.padding),this.notifyChange("_padding"),Yn(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||(Nn(this._viewMatrix,t.viewMatrix),se(this._viewRight,t.viewRight),se(this._viewUp,t.viewUp),se(this._viewForward,t.viewForward)),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(RN(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Nn(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Cd(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new L7().copyFrom(this)}equals(t){return Po(this.eye,t.eye)&&Po(this.center,t.center)&&Po(this.up,t.up)&&nT(this._viewport,t.viewport)&&nT(this._padding,t.padding)&&X_e(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){const e=Math.max(1,1/this.pixelRatio,1/t.pixelRatio);if(Math.abs(t.fov-this._fov)>=.001||GD(t.screenPadding,this.screenPadding)>=e||GD(this.screenViewport,t.screenViewport)>=e)return!1;zs(Fo,t.eye,t.center),zs(W6,this.eye,this.center);const i=me(Fo,W6),r=FB(Fo),n=FB(W6),s=5e-4;return i*i>=(1-1e-10)*r*n&&R4(t.eye,this.eye)<Math.max(r,n)*s*s}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(i3(this.viewForward,he(Fo,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=Zr()){return t[0]=(this.padding[Xt.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[Xt.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,i=.5){return t[0]=this.padding[Xt.LEFT]+this.width*e,t[1]=this.padding[Xt.BOTTOM]+this.height*i,t[2]=.5,t}setGLViewport(t){const e=this.viewport,i=this.padding;t.setViewport(e[0]-i[3],e[1]-i[2],e[2]+i[1]+i[3],e[3]+i[0]+i[2])}applyProjection(t,e){t!==Yt&&se(Yt,t),Yt[3]=1,Xc(Yt,Yt,this.projectionMatrix);const i=Math.abs(Yt[3]);te(Yt,Yt,1/i);const r=this.fullViewport;e[0]=_t(0,r[0]+r[2],.5+.5*Yt[0]),e[1]=_t(0,r[1]+r[3],.5+.5*Yt[1]),e[2]=.5*(Yt[2]+1),e[3]=i}unapplyProjection(t,e){const i=this.fullViewport;Yt[0]=(t[0]/(i[0]+i[2])*2-1)*t[3],Yt[1]=(t[1]/(i[1]+i[3])*2-1)*t[3],Yt[2]=(2*t[2]-1)*t[3],Yt[3]=t[3],this.inverseProjectionMatrix!=null&&(Xc(Yt,Yt,this.inverseProjectionMatrix),e[0]=Yt[0],e[1]=Yt[1],e[2]=Yt[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,Y6),this.renderToScreen(Y6,e),e}projectToRenderScreen(t,e){if(Yt[0]=t[0],Yt[1]=t[1],Yt[2]=t[2],Yt[3]=1,Xc(Yt,Yt,this.viewProjectionMatrix),Yt[3]===0)return null;te(Yt,Yt,1/Math.abs(Yt[3]));const i=this.fullViewport;return"x"in e?(e.x=_t(0,i[0]+i[2],.5+.5*Yt[0]),e.y=_t(0,i[1]+i[3],.5+.5*Yt[1])):(e[0]=_t(0,i[0]+i[2],.5+.5*Yt[0]),e[1]=_t(0,i[1]+i[3],.5+.5*Yt[1]),e.length>2&&(e[2]=.5*(Yt[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,Y6),e)}unprojectFromRenderScreen(t,e){if(Di(uM,this.projectionMatrix,this.viewMatrix),!qn(uM,uM))return null;const i=this.fullViewport;return Yt[0]=2*(t[0]-i[0])/i[2]-1,Yt[1]=2*(t[1]-i[1])/i[3]-1,Yt[2]=2*t[2]-1,Yt[3]=1,Xc(Yt,Yt,uM),Yt[3]===0?null:(e[0]=Yt[0]/Yt[3],e[1]=Yt[1]/Yt[3],e[2]=Yt[2]/Yt[3],e)}constrainWindowSize(t,e,i,r){const n=t*this.pixelRatio,s=e*this.pixelRatio,o=Math.max(n-i/2,0),a=Math.max(this.fullHeight-s-r/2,0),l=-Math.min(n-i/2,0),c=-Math.min(this.fullHeight-s-r/2,0),u=i-l- -Math.min(this.fullWidth-n-i/2,0),d=r-c- -Math.min(s-r/2,0);return[Math.round(o),Math.round(a),Math.round(u),Math.round(d)]}computeUp(t){t===Me.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const i=t[0]*this.pixelRatio,r=this.fullHeight-t[1]*this.pixelRatio;return e[0]=i,e[1]=r,e}renderToScreen(t,e){const i=t[0]/this.pixelRatio,r=(this.fullHeight-t[1])/this.pixelRatio;e[0]=i,e[1]=r}_computeUpGlobal(){he(Fo,this.center,this.eye);const t=we(this.center);t<1?(oe(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(me(Fo,this.center))>.9999*we(Fo)*t||(nt(this._up,Fo,this.center),nt(this._up,this._up,Fo),ge(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){Ng(Fo,this.eye,this.center),Math.abs(Fo[2])<=.9999&&(te(Fo,Fo,Fo[2]),oe(this._up,-Fo[0],-Fo[1],1-Fo[2]),ge(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,i=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?Po(t,e)||(se(e,t),this._markViewDirty(),i.length&&this.notifyChange(i)):ne.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(jve(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&($4(this._viewMatrix,this.eye,this.center,this.up),oe(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),oe(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),oe(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};h([f()],ht.prototype,"_center",void 0),h([f()],ht.prototype,"_up",void 0),h([f()],ht.prototype,"_viewport",void 0),h([f()],ht.prototype,"_padding",void 0),h([f()],ht.prototype,"_fov",void 0),h([f()],ht.prototype,"_nearFar",void 0),h([f()],ht.prototype,"_pixelRatio",void 0),h([f()],ht.prototype,"pixelRatio",null),h([f()],ht.prototype,"eye",null),h([f()],ht.prototype,"center",null),h([f()],ht.prototype,"up",null),h([f({readOnly:!0})],ht.prototype,"nearFar",null),h([f()],ht.prototype,"near",null),h([f()],ht.prototype,"far",null),h([f()],ht.prototype,"viewport",null),h([f({readOnly:!0})],ht.prototype,"screenViewport",null),h([f({readOnly:!0})],ht.prototype,"screenPadding",null),h([f()],ht.prototype,"x",null),h([f()],ht.prototype,"y",null),h([f()],ht.prototype,"width",null),h([f()],ht.prototype,"height",null),h([f()],ht.prototype,"fullWidth",null),h([f()],ht.prototype,"fullHeight",null),h([f({readOnly:!0})],ht.prototype,"_aspect",null),h([f()],ht.prototype,"padding",null),h([f({readOnly:!0})],ht.prototype,"projectionMatrix",null),h([f({readOnly:!0})],ht.prototype,"inverseProjectionMatrix",null),h([f()],ht.prototype,"fov",null),h([f()],ht.prototype,"fovX",null),h([f()],ht.prototype,"fovY",null),ht=L7=h([z("esri.views.3d.webgl-engine.lib.Camera")],ht);const Yt=Kt(),uM=be(),Fo=C(),W6=C(),Y6=Mo();var Xt;(function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"})(Xt||(Xt={}));var ae;(function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",t[t.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",t[t.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",t[t.ANTIALIASING=10]="ANTIALIASING",t[t.COMPOSITE=11]="COMPOSITE",t[t.BLIT=12]="BLIT",t[t.SSAO=13]="SSAO",t[t.HIGHLIGHT=14]="HIGHLIGHT",t[t.SHADOW_HIGHLIGHT=15]="SHADOW_HIGHLIGHT",t[t.ENVIRONMENT_OPAQUE=16]="ENVIRONMENT_OPAQUE",t[t.ENVIRONMENT_TRANSPARENT=17]="ENVIRONMENT_TRANSPARENT",t[t.LASERLINES=18]="LASERLINES",t[t.LASERLINES_CONTRAST_CONTROL=19]="LASERLINES_CONTRAST_CONTROL",t[t.HUD_MATERIAL=20]="HUD_MATERIAL",t[t.LABEL_MATERIAL=21]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=22]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=23]="LINE_CALLOUTS_HUD_DEPTH",t[t.DRAPED_MATERIAL=24]="DRAPED_MATERIAL",t[t.DRAPED_WATER=25]="DRAPED_WATER",t[t.VOXEL=26]="VOXEL",t[t.MAX_SLOTS=27]="MAX_SLOTS"})(ae||(ae={}));var Qe;(function(t){t[t.Color=0]="Color",t[t.Alpha=1]="Alpha",t[t.FrontFace=2]="FrontFace",t[t.NONE=3]="NONE",t[t.COUNT=4]="COUNT"})(Qe||(Qe={}));let xY=class{constructor(e=C()){this.intensity=e}},Xve=class{constructor(e=C(),i=Ce(.57735,.57735,.57735)){this.intensity=e,this.direction=i}},PN=class{constructor(e=C(),i=Ce(.57735,.57735,.57735),r=!0,n=1,s=1){this.intensity=e,this.direction=i,this.castShadows=r,this.specularStrength=n,this.environmentStrength=s}},Zve=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}};function Aje(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e[r];return i}function X6(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e;return i}function uT(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]+e[r];return i}function Jve(t){return(t+1)*(t+1)}function Oje(t){return _e(Math.floor(Math.sqrt(t)-1),0,2)}function Kve(t,e,i){const r=t[0],n=t[1],s=t[2],o=i||[];return o.length=Jve(e),e>=0&&(o[0]=.28209479177),e>=1&&(o[1]=.4886025119*r,o[2]=.4886025119*s,o[3]=.4886025119*n),e>=2&&(o[4]=1.09254843059*r*n,o[5]=1.09254843059*n*s,o[6]=.31539156525*(3*s*s-1),o[7]=1.09254843059*r*s,o[8]=.54627421529*(r*r-n*n)),o}function Rje(t,e){const i=Jve(t),r=e||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let n=0;n<i;n++)r.r[n]=r.g[n]=r.b[n]=0;return r}function Pje(t,e){const i=Oje(e.r.length);for(const r of t)na(D7,r.direction),Kve(D7,i,Zm),Aje(Zm,SL),X6(Zm,r.intensity[0],Gw),uT(e.r,Gw),X6(Zm,r.intensity[1],Gw),uT(e.g,Gw),X6(Zm,r.intensity[2],Gw),uT(e.b,Gw);return e}function Mje(t,e){Kve(D7,0,Zm);for(const i of t)e.r[0]+=Zm[0]*SL[0]*i.intensity[0]*4*Math.PI,e.g[0]+=Zm[0]*SL[0]*i.intensity[1]*4*Math.PI,e.b[0]+=Zm[0]*SL[0]*i.intensity[2]*4*Math.PI;return e}function $je(t,e,i,r){Rje(e,r),oe(i.intensity,0,0,0);let n=!1;const s=Ije,o=Lje,a=Dje;s.length=0,o.length=0,a.length=0;for(const l of t)l instanceof PN&&!n?(se(i.direction,l.direction),se(i.intensity,l.intensity),i.specularStrength=l.specularStrength,i.environmentStrength=l.environmentStrength,i.castShadows=l.castShadows,n=!0):l instanceof PN||l instanceof Xve?s.push(l):l instanceof xY?o.push(l):l instanceof Zve&&a.push(l);Pje(s,r),Mje(o,r);for(const l of a)uT(r.r,l.r),uT(r.g,l.g),uT(r.b,l.b)}const Ije=[],Lje=[],Dje=[],Zm=[0],Gw=[0],D7=C(),SL=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];let Pte=class{constructor(){this.color=C(),this.intensity=1}},Nje=class{constructor(){this.direction=C(),this.ambient=new Pte,this.diffuse=new Pte}};const Qve=.4;let Z6=class{constructor(){this._shOrder=2,this._legacy=new Nje,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new Zve,this._mainLight=new PN(C(),Ce(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){$je(e,this._shOrder,this._mainLight,this._sphericalHarmonics),se(this._legacy.direction,this._mainLight.direction);const i=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*i,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*i,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*i,te(this._legacy.diffuse.color,this._mainLight.intensity,i),se(hM,this._legacy.diffuse.color),te(hM,hM,Qve*this.globalFactor),ce(this._legacy.ambient.color,this._legacy.ambient.color,hM)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),se(this._mainLight.direction,e.mainLight.direction),se(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,i,r){if(Ui(this._mainLight.intensity,e.mainLight.intensity,i.mainLight.intensity,r),this._mainLight.environmentStrength=_t(e.mainLight.environmentStrength,i.mainLight.environmentStrength,r),this._mainLight.specularStrength=_t(e.mainLight.specularStrength,i.mainLight.specularStrength,r),se(this._mainLight.direction,i.mainLight.direction),this._mainLight.castShadows=i.mainLight.castShadows,this.globalFactor=_t(e.globalFactor,i.globalFactor,r),this.noonFactor=_t(e.noonFactor,i.noonFactor,r),e.sh.r.length===i.sh.r.length)for(let n=0;n<i.sh.r.length;n++)this._sphericalHarmonics.r[n]=_t(e.sh.r[n],i.sh.r[n],r),this._sphericalHarmonics.g[n]=_t(e.sh.g[n],i.sh.g[n],r),this._sphericalHarmonics.b[n]=_t(e.sh.b[n],i.sh.b[n],r);else for(let n=0;n<i.sh.r.length;n++)this._sphericalHarmonics.r[n]=i.sh.r[n],this._sphericalHarmonics.g[n]=i.sh.g[n],this._sphericalHarmonics.b[n]=i.sh.b[n]}};const hM=C();let OF=class{constructor(e,i){this.shadowMap=e,this.slicePlane=i,this.slot=ae.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=Qe.NONE,this.alignPixelEnabled=!1,this.decorations=Ql.ON,this.overlayStretch=1,this._camera=new ht,this._inverseViewport=Ue(),this.oldLighting=new Z6,this.newLighting=new Z6,this._fadedLighting=new Z6,this._lighting=this.newLighting,this.ssr=new Fje,this.multipassEnabled=!1,this.multipassTerrain=new fje,this.multipassGeometry=new pje,this.hudRenderStyle=kl.Occluded,this.cloudsFade=new VGe}get camera(){return this._camera}set camera(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:i,newLighting:r}=this;e>=1?this._lighting=r:(this._fadedLighting.lerpLighting(i,r,e),this._lighting=this._fadedLighting)}},Fje=class{constructor(){this.fadeFactor=1,this.reprojectionMatrix=be()}},il=class extends xe{constructor(e){super(e),this._techniques=new Array,this._techniqueConfiguration=new TL,this._bindParameters=new OF(null,null),this._passParameters=new Dve,this._drawParameters=new Nve,this._weatherTile=Ue(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=_t(jo.default.coverage[0],jo.default.coverage[1],.5),this.density=_t(jo.default.density[0],jo.default.density[1],.5),this.absorption=_t(jo.default.absorption[0],jo.default.absorption[1],.5),this.cloudSize=_t(jo.default.cloudSize[0],jo.default.cloudSize[1],.5),this.detailSize=_t(jo.default.detailSize[0],jo.default.detailSize[1],.5),this.smoothness=_t(jo.default.smoothness[0],jo.default.smoothness[1],.5),this.cloudHeight=_t(jo.default.cloudHeight[0],jo.default.cloudHeight[1],.5),this.raymarchingSteps=jo.default.raymarchingSteps,this._viewMatrix=be(),this._dirty=!1,this.running=!1,this._vao=Zf(e.context.renderContext.rctx)}_getTechnique(e){const i=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,r=i===kb.RG?2*e:2*e+1;return this._techniques[r]||(this._techniqueConfiguration.writeTextureChannels=i,this._techniqueConfiguration.steps=e,this._techniques[r]=new Fve({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[r])}updateWeatherTile(){const e=this.view.camera.position.latitude,i=this.view.camera.position.longitude;if(e==null||i==null)return;si(this._weatherTile,(e+90)/180,(i+180)/360);const r=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-r)*this._weatherTile[1]);let n=0,s=0;if(this.view.environment!=null&&this.view.environment.lighting.type!=="virtual"&&this.view.environment.lighting.date!=null){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),n=31*o.getUTCMonth()+o.getUTCDate(),s=o.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+n)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+s%100)%(4*this._weatherTileCount),Z_e(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){const e=Fi(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this.addHandles([this.view.resourceController.scheduler.registerTask(ut.CLOUDS_GENERATOR,this),le(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),Zi)])}destroy(){this._techniques.forEach(e=>Jt(e)),this._frameBufferCube=et(this._frameBufferCube),this._techniques.length=0,this._vao.dispose(),this._passParameters.noiseTexture=Pe(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case fl.SIXTEEN:return 1;case fl.HUNDRED:return 4;case fl.COUNT:case fl.TWOHUNDRED:return 8}}get usedMemory(){return(this._frameBufferCube?.gpuMemoryUsage??0)+(this._passParameters.noiseTexture?.textureAtlas?.gpuMemoryUsage??0)}_ensureNoiseTexture(){if(this._passParameters.noiseTexture!=null)this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);else{const e=this.context;this._passParameters.noiseTexture=new uA({context:e}),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile)}return this._passParameters.noiseTexture.textureAtlas!=null}_ensureFrameBufferCube(e){if(this._frameBufferCube==null){const i=new Li(e);i.target=sn.TEXTURE_CUBE_MAP,i.wrapMode=Nt.CLAMP_TO_EDGE,this._frameBufferCube=new rp(this.context.renderContext.rctx,i)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=et(this._frameBufferCube)}applyPreset(e,i){const r=e.median,n=s=>{const o=_t(s[0],s[1],r);return i<.5?_t(s[0],o,2*i):_t(o,s[1],2*(i-.5))};this.coverage=n(e.coverage),this.density=n(e.density),this.absorption=n(e.absorption),this.cloudSize=n(e.cloudSize),this.detailSize=n(e.detailSize),this.smoothness=n(e.smoothness),this.cloudHeight=n(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){this._faceIndex===0&&this._tileIndex===0&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),Yn(this._passParameters.weatherTile,this._weatherTile));const i=this._getTechnique(this._passParameters.raymarchingSteps);if(!i.compiled||this.context.renderContext.bindParameters.cloudsFade.fadeMode===_r.CROSS_FADE||!this._ensureNoiseTexture())return Lo.YIELD;this._faceIndex===0&&this._tileIndex===0&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=ff.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const r=this.context.renderContext.rctx,n=r.bindTechnique(i,this._passParameters,this._bindParameters);r.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao);const s=r.getViewport(),o=i.configuration.cubeMapSize,a=o/this._tilesPerFace,l=this._tileIndex*a;r.setViewport(0,l,o,a);const c=this._ensureFrameBufferCube(o);r.bindFramebuffer(c);const u=kje[this._faceIndex],d=Uje[this._faceIndex];mpe(this._viewMatrix,zje,u,d),gh(this._drawParameters.viewMatrix,this._viewMatrix);const p=sn.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return c.setColorTextureTarget(p),n.bindDraw(this._drawParameters,this._bindParameters,this._passParameters),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.gl.flush(),r.setViewport(s.x,s.y,s.width,s.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.running||(this.context.renderContext.bindParameters.cloudsFade.renderingStage=ff.FADING)):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),Lo.YIELD}};h([f({constructOnly:!0})],il.prototype,"context",void 0),h([f({constructOnly:!0})],il.prototype,"view",void 0),h([f({constructOnly:!0})],il.prototype,"requestRender",void 0),h([f()],il.prototype,"coverage",void 0),h([f()],il.prototype,"density",void 0),h([f()],il.prototype,"absorption",void 0),h([f()],il.prototype,"cloudSize",void 0),h([f()],il.prototype,"detailSize",void 0),h([f()],il.prototype,"smoothness",void 0),h([f()],il.prototype,"cloudHeight",void 0),h([f()],il.prototype,"raymarchingSteps",void 0),h([f()],il.prototype,"running",void 0),il=h([z("esri.views.3d.environment.CloudsGenerator")],il);const kje=[Hi(1,0,0),Hi(-1,0,0),Hi(0,1,0),Hi(0,-1,0),Hi(0,0,1)],Uje=[Hi(0,1,0),Hi(0,1,0),Hi(0,0,-1),Hi(0,0,1),Hi(0,1,0)],zje=wY();let e1e=class extends Ki{constructor(){super(...arguments),this.fogColor=C(),this.fogStrength=4e-6,this.atmosphereC=1,this.fogAmount=0}};function Bje(){const t=new mi;t.attributes.add(O.POSITION,"vec2"),t.include(xf,{textureCoordinateType:In.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:e,fragment:i}=t;return e.uniforms.add(new Vr("inverseProjectionMatrix",(r,n)=>n.camera.inverseProjectionMatrix),new Vr("inverseViewMatrix",(r,n)=>$S(Vje,n.camera.viewMatrix))),e.code.add(b`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add(new Oe("atmosphereC",r=>r.atmosphereC),new $t("cameraPosition",(r,n)=>n.camera.eye),new zi("nearFar",(r,n)=>n.camera.nearFar),new Je("depthTexture",r=>r.depthTexture),new Oe("fogStrength",r=>r.fogStrength),new Oe("fogAmount",r=>r.fogAmount),new $t("fogColor",r=>r.fogColor)),t.include(EF),i.include(vh),i.code.add(b`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(b`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),i.code.add(b`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}
void main() {
vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = texture(depthTexture, vuv0).r;
float zNorm = 2.0 * depthSample - 1.0;
float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linDepth;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
vec4 fog = applyFog(terrainDepth, rayDir);
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
}`),t}const Vje=be(),Gje=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:e1e,build:Bje},Symbol.toStringTag,{value:"Module"}));let t1e=class i1e extends Ci{constructor(e){super(e,new bl,()=>this.destroy())}initializeProgram(e){return new wi(e.rctx,i1e.shader.get().build(),fi)}initializePipeline(){return Ot({blending:fo(Te.SRC_ALPHA,Te.ZERO,Te.ONE_MINUS_SRC_ALPHA,Te.ONE),colorWrite:Ft})}};t1e.shader=new bi(Gje,()=>pe(()=>import("./Fog.glsl-c5792bca.js"),[],import.meta.url));const jje=.95,Hje=1;let s1=class extends xe{constructor(e){super(e),this._passParameters=new e1e;const i=e.context.renderContext.rctx;this._vao=Zf(i,ER),this._technique=new t1e(e);const r=Fi(e.view.spatialReference);this._planetRadius=r.radius,this._atmosphereRadius=r.radius+yy}destroy(){this._technique.release(),this._vao.dispose()}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}render(e,i){if(this._update(e,i),this._passParameters.fogAmount<=0)return;const r=this._technique;if(!r.compiled)return void this.context.requestRender();const n=e.offscreenRenderingHelper;n.renderDepthDetached(()=>{this._passParameters.depthTexture=n.depthTexture;const s=e.rctx.bindTechnique(r,this._passParameters,e.bindParameters);this._renderFog(s,e)})}_renderFog(e,i){const r=i.rctx;r.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Qt.TRIANGLE_STRIP,0,4)}_update(e,i){const r=e.bindParameters.camera;ge(Mte,r.eye);const n=Math.max(0,me(Mte,e.bindParameters.lighting.mainLight.direction)),s=i.color;te($te,s,.1),Ui(this._passParameters.fogColor,$te,s,n);const o=we(r.eye),a=o*o;this._passParameters.atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-X3(jje*Wm,Hje*Wm,Math.abs(o-this._planetRadius)))*i.amount,this._passParameters.fogStrength=i.strength}static isSupported(e){return e.capabilities.depthTexture}};h([f({constructOnly:!0})],s1.prototype,"context",void 0),h([f({constructOnly:!0})],s1.prototype,"view",void 0),h([f({constructOnly:!0})],s1.prototype,"rctx",void 0),h([f({constructOnly:!0})],s1.prototype,"viewingMode",void 0),s1=h([z("esri.views.3d.environment.Fog")],s1);let qje=class{constructor(){this.color=C(),this.strength=0,this.amount=0}};const Mte=C(),$te=C();var U;(function(t){t[t.Color=0]="Color",t[t.Depth=1]="Depth",t[t.Normal=2]="Normal",t[t.Shadow=3]="Shadow",t[t.ShadowHighlight=4]="ShadowHighlight",t[t.ShadowExcludeHighlight=5]="ShadowExcludeHighlight",t[t.Highlight=6]="Highlight",t[t.Alpha=7]="Alpha",t[t.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",t[t.CompositeColor=9]="CompositeColor",t[t.COUNT=10]="COUNT"})(U||(U={}));function TY({code:t},e){e.doublePrecisionRequiresObfuscation?t.add(b`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):t.add(b`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}let r1e=class extends Qr{constructor(e,i){super(e,"mat4",_i.Draw,(r,n,s)=>r.setUniformMatrix4fv(e,i(n,s)))}};function Xd(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",Gs):t.uniforms.add(new nu("cameraPosition",(i,r)=>oe(n1e,r.camera.viewInverseTransposeMatrix[3]-i.origin[0],r.camera.viewInverseTransposeMatrix[7]-i.origin[1],r.camera.viewInverseTransposeMatrix[11]-i.origin[2])))}function tc(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add(new Vr("proj",(r,n)=>n.camera.projectionMatrix),new r1e("view",(r,n)=>yl(Ite,n.camera.viewMatrix,r.origin)),new nu("localOrigin",r=>r.origin));const i=r=>oe(n1e,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]);t.uniforms.add(new Vr("proj",(r,n)=>n.camera.projectionMatrix),new Vr("view",(r,n)=>yl(Ite,n.camera.viewMatrix,i(n))),new $t("localOrigin",(r,n)=>i(n)))}const Ite=be(),n1e=C();function aS(t){t.uniforms.add(new Vr("viewNormal",(e,i)=>i.camera.viewInverseTransposeMatrix))}function HS(t){t.uniforms.add(new Oe("pixelRatio",(e,i)=>i.camera.pixelRatio/i.overlayStretch))}let sp=class extends Qr{constructor(e,i){super(e,"mat3",_i.Pass,(r,n,s)=>r.setUniformMatrix3fv(e,i(n,s)))}};function N7(t,e,i){for(let r=0;r<i;++r)e[2*r]=t[r],e[2*r+1]=t[r]-e[2*r]}function Wje(t,e){const i=t.length;for(let r=0;r<i;++r)G2[0]=t[r],e[r]=G2[0];return e}function Yje(t,e){const i=t.length;for(let r=0;r<i;++r)G2[0]=t[r],G2[1]=t[r]-G2[0],e[r]=G2[1];return e}const G2=new Float32Array(2);let F7=class extends bl{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}};h([V()],F7.prototype,"instancedDoublePrecision",void 0),h([V()],F7.prototype,"hasModelTransformation",void 0);const Lte=Hr();function s1e(t,e){const i=e.hasModelTransformation,r=e.instancedDoublePrecision;i&&(t.vertex.uniforms.add(new Vr("model",s=>s.modelTransformation??zr)),t.vertex.uniforms.add(new sp("normalLocalOriginFromModel",s=>(Ag(Lte,s.modelTransformation??zr),Lte)))),e.instanced&&r&&(t.attributes.add(O.INSTANCEMODELORIGINHI,"vec3"),t.attributes.add(O.INSTANCEMODELORIGINLO,"vec3"),t.attributes.add(O.INSTANCEMODEL,"mat3"),t.attributes.add(O.INSTANCEMODELNORMAL,"mat3"));const n=t.vertex;r&&(n.include(TY,e),n.uniforms.add(new nu("viewOriginHi",(s,o)=>Wje(oe(dM,o.camera.viewInverseTransposeMatrix[3],o.camera.viewInverseTransposeMatrix[7],o.camera.viewInverseTransposeMatrix[11]),dM)),new nu("viewOriginLo",(s,o)=>Yje(oe(dM,o.camera.viewInverseTransposeMatrix[3],o.camera.viewInverseTransposeMatrix[7],o.camera.viewInverseTransposeMatrix[11]),dM)))),n.code.add(b`
    vec3 getVertexInLocalOriginSpace() {
      return ${i?r?"(model * vec4(instanceModel * localPosition().xyz, 1.0)).xyz":"(model * localPosition()).xyz":r?"instanceModel * localPosition().xyz":"localPosition().xyz"};
    }

    vec3 subtractOrigin(vec3 _pos) {
      ${r?b`
          // Negated inputs are intentionally the first two arguments. The other way around the obfuscation in dpAdd() stopped
          // working for macOS 14+ and iOS 17+.
          // Issue: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/56280
          vec3 originDelta = dpAdd(-instanceModelOriginHi, -instanceModelOriginLo, viewOriginHi, viewOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),n.code.add(b`
    vec3 dpNormal(vec4 _normal) {
      return normalize(${i?r?"normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz)":"normalLocalOriginFromModel * _normal.xyz":r?"instanceModelNormal * _normal.xyz":"_normal.xyz"});
    }
    `),e.output===U.Normal&&(aS(n),n.code.add(b`
    vec3 dpNormalView(vec4 _normal) {
      return normalize((viewNormal * ${i?r?"vec4(normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz), 1.0)":"vec4(normalLocalOriginFromModel * _normal.xyz, 1.0)":r?"vec4(instanceModelNormal * _normal.xyz, 1.0)":"_normal"}).xyz);
    }
    `)),e.hasVertexTangents&&n.code.add(b`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${i?r?"return vec4(normalLocalOriginFromModel * (instanceModelNormal * _tangent.xyz), _tangent.w);":"return vec4(normalLocalOriginFromModel * _tangent.xyz, _tangent.w);":r?"return vec4(instanceModelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}
    }`)}const dM=C();let Ua=class extends F7{};h([V({constValue:!0})],Ua.prototype,"hasSliceHighlight",void 0),h([V({constValue:!1})],Ua.prototype,"hasSliceInVertexProgram",void 0),h([V({constValue:_i.Pass})],Ua.prototype,"pbrTextureBindType",void 0);var Nf;(function(t){t[t.Cone=0]="Cone",t[t.Cylinder=1]="Cylinder",t[t.Underground=2]="Underground",t[t.COUNT=3]="COUNT"})(Nf||(Nf={}));let SY=class extends Ua{constructor(){super(...arguments),this.geometry=Nf.Cone}};h([V({count:Nf.COUNT})],SY.prototype,"geometry",void 0);function AR(t){t.attributes.add(O.POSITION,"vec3"),t.vertex.code.add(b`vec3 positionModel() { return position; }`)}function hT(t,e){t.include(AR);const i=t.vertex;i.include(TY,e),t.varyings.add("vPositionWorldCameraRelative","vec3"),t.varyings.add("vPosition_view","vec3"),i.uniforms.add(new $t("transformWorldFromViewTH",r=>r.transformWorldFromViewTH),new $t("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new sp("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new Vr("transformProjFromView",r=>r.transformProjFromView),new mO("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new nu("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new nu("transformWorldFromModelTL",r=>r.transformWorldFromModelTL)),i.code.add(b`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),i.code.add(b`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${e.spherical?b`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:b`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),t.fragment.uniforms.add(new $t("transformWorldFromViewTL",r=>r.transformWorldFromViewTL)),i.code.add(b`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),t.fragment.code.add(b`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}let o1e=class extends Ki{constructor(){super(...arguments),this.transformWorldFromViewTH=C(),this.transformWorldFromViewTL=C(),this.transformViewFromCameraRelativeRS=Hr(),this.transformProjFromView=be()}},a1e=class extends Ki{constructor(){super(...arguments),this.transformWorldFromModelRS=Hr(),this.transformWorldFromModelTH=C(),this.transformWorldFromModelTL=C()}};function u_(t){t.varyings.add("linearDepth","float")}function Ub(t){t.vertex.uniforms.add(new zi("nearFar",(e,i)=>i.camera.nearFar))}function RF(t){t.vertex.code.add(b`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function qS(t,e){const{vertex:i}=t;switch(e.output){case U.Color:if(e.receiveShadows)return u_(t),void i.code.add(b`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case U.Depth:case U.Shadow:case U.ShadowHighlight:case U.ShadowExcludeHighlight:return t.include(hT,e),u_(t),Ub(t),RF(t),void i.code.add(b`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}i.code.add(b`void forwardLinearDepth() {}`)}function ml(t){RF(t),t.vertex.code.add(b`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(b`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}let EY=class extends Ki{constructor(){super(...arguments),this.texV=Ue(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new l1e}},l1e=class{constructor(){this.center=C(),this.v1=C(),this.v2=C()}};function Xje(t){const e=new mi,{vertex:i,fragment:r}=e;if(Bg(i),t.geometry===Nf.Underground)e.attributes.add(O.POSITION,"vec2"),e.varyings.add("color","vec4"),i.uniforms.add(new $t("cameraPosition",(n,s)=>s.camera.eye),new Oe("undergroundFadeAlpha",n=>n.undergroundFadeAlpha)),i.code.add(b`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),r.code.add(b`void main() {
fragColor = color;
}`);else{e.include(ml,t),e.attributes.add(O.POSITION,"vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const n=t.geometry===Nf.Cylinder;i.uniforms.add(new Vr("proj",(a,l)=>l.camera.projectionMatrix),new Vr("view",(a,l)=>l.camera.viewMatrix)),n||(e.varyings.add("innerFactor","float"),i.uniforms.add(new $t("silCircleCenter",a=>a.silhouette.center)),i.uniforms.add(new $t("silCircleV1",a=>a.silhouette.v1)),i.uniforms.add(new $t("silCircleV2",a=>a.silhouette.v2)),i.uniforms.add(new zi("texV",a=>a.texV)),i.uniforms.add(new Oe("innerScale",a=>a.innerScale)));const s=6.2831853,o=1/128;i.code.add(b`
		void main(void) {
      ${n?b`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:b`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${b.float(s*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${b.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),r.uniforms.add(new Je("tex",a=>a.texture)),n||r.uniforms.add(new Oe("altitudeFade",a=>a.altitudeFade)),r.code.add(b`
		void main() {
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${n?b`fragColor = atmosphereColor;`:b`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return e}const Zje=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:l1e,SimpleAtmospherePassParameters:EY,build:Xje},Symbol.toStringTag,{value:"Module"}));let MN=class c1e extends Ci{initializeProgram(e){return new wi(e.rctx,c1e.shader.get().build(this.configuration),fi)}initializePipeline(){return this.configuration.geometry===Nf.Cylinder?Ot({blending:fo(Te.SRC_ALPHA,Te.ONE,Te.ONE_MINUS_SRC_ALPHA,Te.ONE_MINUS_SRC_ALPHA),culling:hY,depthTest:{func:Pi.LEQUAL},colorWrite:Ft}):Ot({blending:fo(Te.SRC_ALPHA,Te.ONE,Te.ONE_MINUS_SRC_ALPHA,Te.ONE_MINUS_SRC_ALPHA),depthTest:{func:Pi.LEQUAL},colorWrite:Ft})}};MN.shader=new bi(Zje,()=>pe(()=>import("./SimpleAtmosphere.glsl-ef5c328c.js"),[],import.meta.url));const Jje=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);function pc(t,e=0){const i=t.stride;return Array.from(t.fields.keys()).map(r=>{const n=t.fields.get(r),s=n.constructor.ElementCount,o=Kje(n.constructor.ElementType),a=n.offset,l=!(!n.optional||!n.optional.glNormalized);return new po(r,s,o,a,i,l,e)})}function Kje(t){const e=Qje[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}const Qje={u8:Ze.UNSIGNED_BYTE,u16:Ze.UNSIGNED_SHORT,u32:Ze.UNSIGNED_INT,i8:Ze.BYTE,i16:Ze.SHORT,i32:Ze.INT,f32:Ze.FLOAT};let CY=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.elementCount=9;const o=this.TypedArrayConstructor;n===void 0&&(n=9*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=s==null?new o(i,a):new o(i,a,(s-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let n=0;n<9;n++)i[n]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let n=0;n<9;n++)this.typedBuffer[r++]=i[n]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){const n=this.typedBuffer,s=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<9;++l)n[o++]=s[a++]}get buffer(){return this.typedBuffer.buffer}};CY.ElementCount=9;let AY=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.elementCount=16;const o=this.TypedArrayConstructor;n===void 0&&(n=16*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=s==null?new o(i,a):new o(i,a,(s-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let n=0;n<16;n++)i[n]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let n=0;n<16;n++)this.typedBuffer[r++]=i[n]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){const n=this.typedBuffer,s=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<16;++l)n[o++]=s[a++]}get buffer(){return this.typedBuffer.buffer}};AY.ElementCount=16;let Gg=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.elementCount=1;const o=this.TypedArrayConstructor;n===void 0&&(n=o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=s==null?new o(i,a):new o(i,a,(s-r)/o.BYTES_PER_ELEMENT),this.stride=n,this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,i){this.typedBuffer[e*this.typedBufferStride]=i}get buffer(){return this.typedBuffer.buffer}};Gg.ElementCount=1;let jg=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.elementCount=2;const o=this.TypedArrayConstructor;n===void 0&&(n=2*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=s==null?new o(i,a):new o(i,a,(s-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,si(i,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e]=i[1]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e]=r}copyFrom(e,i,r){const n=this.typedBuffer,s=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;n[o++]=s[a++],n[o]=s[a]}get buffer(){return this.typedBuffer.buffer}};jg.ElementCount=2;let Hg=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.elementCount=3;const o=this.TypedArrayConstructor;n===void 0&&(n=3*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=s==null?new o(i,a):new o(i,a,(s-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,oe(i,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e]=i[2]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,n){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e]=n}copyFrom(e,i,r){const n=this.typedBuffer,s=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;n[o++]=s[a++],n[o++]=s[a++],n[o]=s[a]}get buffer(){return this.typedBuffer.buffer}};Hg.ElementCount=3;let qg=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.start=r,this.elementCount=4;const o=this.TypedArrayConstructor;n===void 0&&(n=4*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=s==null?new o(i,a):new o(i,a,(s-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,Mr(i,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e++]=i[2],this.typedBuffer[e]=i[3]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,n,s){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e++]=n,this.typedBuffer[e]=s}copyFrom(e,i,r){const n=this.typedBuffer,s=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;n[o++]=s[a++],n[o++]=s[a++],n[o++]=s[a++],n[o]=s[a]}get buffer(){return this.typedBuffer.buffer}};qg.ElementCount=4;let PF=class u1e extends Gg{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}static fromTypedArray(e,i){return new u1e(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};PF.ElementType="f32";let dw=class k7 extends jg{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}slice(e,i){return this.sliceBuffer(k7,e,i)}static fromTypedArray(e,i){return new k7(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};dw.ElementType="f32";let ws=class U7 extends Hg{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}slice(e,i){return this.sliceBuffer(U7,e,i)}static fromTypedArray(e,i){return new U7(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ws.ElementType="f32";let Zd=class z7 extends qg{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}slice(e,i){return this.sliceBuffer(z7,e,i)}static fromTypedArray(e,i){return new z7(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Zd.ElementType="f32";let h_=class B7 extends CY{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}slice(e,i){return this.sliceBuffer(B7,e,i)}static fromTypedArray(e,i){return new B7(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};h_.ElementType="f32";let OY=class V7 extends CY{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(V7,e,i)}static fromTypedArray(e,i){return new V7(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};OY.ElementType="f64";let RY=class G7 extends AY{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}slice(e,i){return this.sliceBuffer(G7,e,i)}static fromTypedArray(e,i){return new G7(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};RY.ElementType="f32";let yO=class j7 extends AY{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(j7,e,i)}static fromTypedArray(e,i){return new j7(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};yO.ElementType="f64";let PY=class H7 extends Gg{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(H7,e,i)}static fromTypedArray(e,i){return new H7(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};PY.ElementType="f64";let MY=class q7 extends jg{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(q7,e,i)}static fromTypedArray(e,i){return new q7(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};MY.ElementType="f64";let wh=class W7 extends Hg{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(W7,e,i)}static fromTypedArray(e,i){return new W7(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};wh.ElementType="f64";let MF=class Y7 extends qg{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(Y7,e,i)}static fromTypedArray(e,i){return new Y7(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};MF.ElementType="f64";let lS=class X7 extends Gg{constructor(e,i=0,r,n){super(Uint8Array,e,i,r,n),this.elementType="u8"}slice(e,i){return this.sliceBuffer(X7,e,i)}static fromTypedArray(e,i){return new X7(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};lS.ElementType="u8";let $F=class Z7 extends jg{constructor(e,i=0,r,n){super(Uint8Array,e,i,r,n),this.elementType="u8"}slice(e,i){return this.sliceBuffer(Z7,e,i)}static fromTypedArray(e,i){return new Z7(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};$F.ElementType="u8";let IF=class J7 extends Hg{constructor(e,i=0,r,n){super(Uint8Array,e,i,r,n),this.elementType="u8"}slice(e,i){return this.sliceBuffer(J7,e,i)}static fromTypedArray(e,i){return new J7(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};IF.ElementType="u8";let la=class K7 extends qg{constructor(e,i=0,r,n){super(Uint8Array,e,i,r,n),this.elementType="u8"}slice(e,i){return this.sliceBuffer(K7,e,i)}static fromTypedArray(e,i){return new K7(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};la.ElementType="u8";let LF=class Q7 extends Gg{constructor(e,i=0,r,n){super(Uint16Array,e,i,r,n),this.elementType="u16"}slice(e,i){return this.sliceBuffer(Q7,e,i)}static fromTypedArray(e,i){return new Q7(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};LF.ElementType="u16";let $Y=class eG extends jg{constructor(e,i=0,r,n){super(Uint16Array,e,i,r,n),this.elementType="u16"}slice(e,i){return this.sliceBuffer(eG,e,i)}static fromTypedArray(e,i){return new eG(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};$Y.ElementType="u16";let DF=class tG extends Hg{constructor(e,i=0,r,n){super(Uint16Array,e,i,r,n),this.elementType="u16"}slice(e,i){return this.sliceBuffer(tG,e,i)}static fromTypedArray(e,i){return new tG(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};DF.ElementType="u16";let OR=class iG extends qg{constructor(e,i=0,r,n){super(Uint16Array,e,i,r,n),this.elementType="u16"}slice(e,i){return this.sliceBuffer(iG,e,i)}static fromTypedArray(e,i){return new iG(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};OR.ElementType="u16";let NF=class rG extends Gg{constructor(e,i=0,r,n){super(Uint32Array,e,i,r,n),this.elementType="u32"}slice(e,i){return this.sliceBuffer(rG,e,i)}static fromTypedArray(e,i){return new rG(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};NF.ElementType="u32";let IY=class nG extends jg{constructor(e,i=0,r,n){super(Uint32Array,e,i,r,n),this.elementType="u32"}slice(e,i){return this.sliceBuffer(nG,e,i)}static fromTypedArray(e,i){return new nG(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};IY.ElementType="u32";let h1e=class sG extends Hg{constructor(e,i=0,r,n){super(Uint32Array,e,i,r,n),this.elementType="u32"}slice(e,i){return this.sliceBuffer(sG,e,i)}static fromTypedArray(e,i){return new sG(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};h1e.ElementType="u32";let d1e=class oG extends qg{constructor(e,i=0,r,n){super(Uint32Array,e,i,r,n),this.elementType="u32"}slice(e,i){return this.sliceBuffer(oG,e,i)}static fromTypedArray(e,i){return new oG(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};d1e.ElementType="u32";let LY=class aG extends Gg{constructor(e,i=0,r,n){super(Int8Array,e,i,r,n),this.elementType="i8"}slice(e,i){return this.sliceBuffer(aG,e,i)}static fromTypedArray(e,i){return new aG(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};LY.ElementType="i8";let FF=class lG extends jg{constructor(e,i=0,r,n){super(Int8Array,e,i,r,n),this.elementType="i8"}slice(e,i){return this.sliceBuffer(lG,e,i)}static fromTypedArray(e,i){return new lG(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};FF.ElementType="i8";let p1e=class cG extends Hg{constructor(e,i=0,r,n){super(Int8Array,e,i,r,n),this.elementType="i8"}slice(e,i){return this.sliceBuffer(cG,e,i)}static fromTypedArray(e,i){return new cG(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};p1e.ElementType="i8";let f1e=class uG extends qg{constructor(e,i=0,r,n){super(Int8Array,e,i,r,n),this.elementType="i8"}slice(e,i){return this.sliceBuffer(uG,e,i)}static fromTypedArray(e,i){return new uG(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};f1e.ElementType="i8";let m1e=class hG extends Gg{constructor(e,i=0,r,n){super(Int16Array,e,i,r,n),this.elementType="i16"}slice(e,i){return this.sliceBuffer(hG,e,i)}static fromTypedArray(e,i){return new hG(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};m1e.ElementType="i16";let RR=class dG extends jg{constructor(e,i=0,r,n){super(Int16Array,e,i,r,n),this.elementType="i16"}slice(e,i){return this.sliceBuffer(dG,e,i)}static fromTypedArray(e,i){return new dG(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};RR.ElementType="i16";let g1e=class pG extends Hg{constructor(e,i=0,r,n){super(Int16Array,e,i,r,n),this.elementType="i16"}slice(e,i){return this.sliceBuffer(pG,e,i)}static fromTypedArray(e,i){return new pG(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};g1e.ElementType="i16";let y1e=class fG extends qg{constructor(e,i=0,r,n){super(Int16Array,e,i,r,n),this.elementType="i16"}slice(e,i){return this.sliceBuffer(fG,e,i)}static fromTypedArray(e,i){return new fG(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};y1e.ElementType="i16";let _1e=class mG extends Gg{constructor(e,i=0,r,n){super(Int32Array,e,i,r,n),this.elementType="i32"}slice(e,i){return this.sliceBuffer(mG,e,i)}static fromTypedArray(e,i){return new mG(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};_1e.ElementType="i32";let v1e=class gG extends jg{constructor(e,i=0,r,n){super(Int32Array,e,i,r,n),this.elementType="i32"}slice(e,i){return this.sliceBuffer(gG,e,i)}static fromTypedArray(e,i){return new gG(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};v1e.ElementType="i32";let b1e=class yG extends Hg{constructor(e,i=0,r,n){super(Int32Array,e,i,r,n),this.elementType="i32"}slice(e,i){return this.sliceBuffer(yG,e,i)}static fromTypedArray(e,i){return new yG(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};b1e.ElementType="i32";let w1e=class _G extends qg{constructor(e,i=0,r,n){super(Int32Array,e,i,r,n),this.elementType="i32"}slice(e,i){return this.sliceBuffer(_G,e,i)}static fromTypedArray(e,i){return new _G(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};w1e.ElementType="i32";function Dte(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}let Nte=class x1e{constructor(e,i){this.layout=e,this.buffer=typeof i=="number"?new ArrayBuffer(i*e.stride):i;for(const r of e.fields.keys()){const n=e.fields.get(r);this[r]=new n.constructor(this.buffer,n.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,i){const r=this[e];return r&&r.elementCount===i.ElementCount&&r.elementType===i.ElementType?r:null}slice(e,i){return new x1e(this.layout,this.buffer.slice(e*this.stride,i*this.stride))}copyFrom(e,i=0,r=0,n=e.count){const s=this.stride;if(s%4==0){const o=new Uint32Array(e.buffer,i*s,n*s/4);new Uint32Array(this.buffer,r*s,n*s/4).set(o)}else{const o=new Uint8Array(e.buffer,i*s,n*s);new Uint8Array(this.buffer,r*s,n*s).set(o)}return this}get usedMemory(){return this.byteLength}dispose(){}},T1e=class S1e{constructor(e=null){this._stride=0,this._lastAligned=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach(i=>this._fields.set(i[0],{...i[1],constructor:iHe(i[1].constructor)})))}vec2f(e,i){return this._appendField(e,dw,i),this}vec2f64(e,i){return this._appendField(e,MY,i),this}vec3f(e,i){return this._appendField(e,ws,i),this}vec3f64(e,i){return this._appendField(e,wh,i),this}vec4f(e,i){return this._appendField(e,Zd,i),this}vec4f64(e,i){return this._appendField(e,MF,i),this}mat3f(e,i){return this._appendField(e,h_,i),this}mat3f64(e,i){return this._appendField(e,OY,i),this}mat4f(e,i){return this._appendField(e,RY,i),this}mat4f64(e,i){return this._appendField(e,yO,i),this}vec4u8(e,i){return this._appendField(e,la,i),this}f32(e,i){return this._appendField(e,PF,i),this}f64(e,i){return this._appendField(e,PY,i),this}u8(e,i){return this._appendField(e,lS,i),this}u16(e,i){return this._appendField(e,LF,i),this}i8(e,i){return this._appendField(e,LY,i),this}vec2i8(e,i){return this._appendField(e,FF,i),this}vec2i16(e,i){return this._appendField(e,RR,i),this}vec2u8(e,i){return this._appendField(e,$F,i),this}vec4u16(e,i){return this._appendField(e,OR,i),this}u32(e,i){return this._appendField(e,NF,i),this}_appendField(e,i,r){if(this._fields.has(e))return void Ke(!1,`${e} already added to vertex buffer layout`);const n=i.ElementCount*Dte(i.ElementType),s=this._stride;this._stride+=n,this._fields.set(e,{size:n,constructor:i,offset:s,optional:r})}createBuffer(e){return new Nte(this,e)}createView(e){return new Nte(this,e)}clone(){const e=new S1e;return e._stride=this._stride,e._fields=new Map,this._fields.forEach((i,r)=>e._fields.set(r,i)),e.BufferType=this.BufferType,e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach(i=>e=Math.max(e,Dte(i.constructor.ElementType))),this._stride=Math.floor((this._stride+e-1)/e)*e,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}};function Ir(){return new T1e}let eHe=class{constructor(e){this.fields=new Array,e.fields.forEach((i,r)=>{const n={...i,constructor:E1e(i.constructor)};this.fields.push([r,n])}),this.stride=e.stride}};const tHe=[PF,dw,ws,Zd,h_,RY,PY,MY,wh,MF,OY,yO,lS,$F,IF,la,LF,$Y,DF,OR,NF,IY,h1e,d1e,LY,FF,p1e,f1e,m1e,RR,g1e,y1e,_1e,v1e,b1e,w1e];function E1e(t){return`${t.ElementType}_${t.ElementCount}`}function iHe(t){return C1e.get(t)}const C1e=new Map;tHe.forEach(t=>C1e.set(E1e(t),t));function Vs(t,e=!1){return t<=lu?e?new Array(t).fill(0):new Array(t):new Float64Array(t)}function A1e(t){return(uh(t)?t.length:t.byteLength/8)<=lu?Array.from(t):new Float64Array(t)}function ah(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}function rHe(t,e){for(let i=0;i<e.length;++i)t[i]=e[i];return t}function BPt(t){return Array.isArray(t)?new Float64Array(t):t}function Jr(t,e=!1){return t<=lu?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function VPt(t){return uh(t)?t.length<lu?t:new Float32Array(t):t.length<lu?Array.from(t):t}function Fte(t){return(uh(t)?t.length:t.byteLength/8)<=lu?Array.from(t):new Float32Array(t)}function $N(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}function Sf(t){if(uh(t)){if(t.length<lu)return t}else if(t.length<lu)return Array.from(t);let e=!0,i=!0;return t.some((r,n)=>(e=e&&r===0,i=i&&r===n,!e&&!i)),e?M_(t.length):i?pw(t.length):uh(t)||t.BYTES_PER_ELEMENT!==Uint16Array.BYTES_PER_ELEMENT?nHe(t):t}function nHe(t){let e=!0;for(const i of t){if(i>=65536)return uh(t)?new Uint32Array(t):t;i>=256&&(e=!1)}return e?new Uint8Array(t):new Uint16Array(t)}function IN(t){return t<=lu?new Array(t):t<=65536?new Uint16Array(t):new Uint32Array(t)}function sHe(t){return t<=lu?new Array(t):new Uint32Array(t)}let jw=(()=>{const t=new Uint32Array(131072);for(let e=0;e<t.length;++e)t[e]=e;return t})();const O1e=[0],J6=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function pw(t){if(t===1)return O1e;if(t<lu)return Array.from(new Uint16Array(J6.buffer,0,t));if(t<J6.length)return new Uint16Array(J6.buffer,0,t);if(t>jw.length){const e=Math.max(2*jw.length,t);jw=new Uint32Array(e);for(let i=0;i<jw.length;i++)jw[i]=i}return new Uint32Array(jw.buffer,0,t)}let pM=new Uint8Array(65536);function M_(t){if(t===1)return O1e;if(t<lu)return new Array(t).fill(0);if(t>pM.length){const e=Math.max(2*pM.length,t);pM=new Uint8Array(e)}return new Uint8Array(pM.buffer,0,t)}var vG;(function(t){function e(o,a){const l=o[a],c=o[a+1],u=o[a+2];return Math.sqrt(l*l+c*c+u*u)}function i(o,a){const l=o[a],c=o[a+1],u=o[a+2],d=1/Math.sqrt(l*l+c*c+u*u);o[a]*=d,o[a+1]*=d,o[a+2]*=d}function r(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function n(o,a,l,c,u,d=a){(u=u||o)[d]=o[a]+l[c],u[d+1]=o[a+1]+l[c+1],u[d+2]=o[a+2]+l[c+2]}function s(o,a,l,c,u,d=a){(u=u||o)[d]=o[a]-l[c],u[d+1]=o[a+1]-l[c+1],u[d+2]=o[a+2]-l[c+2]}t.length=e,t.normalize=i,t.scale=r,t.add=n,t.subtract=s})(vG||(vG={}));var on;(function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"})(on||(on={}));function oHe(t){if(t.length<lu)return Array.from(t);if(uh(t))return Float64Array.from(t);if(!("BYTES_PER_ELEMENT"in t))return Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return l4(t)?Uint16Array.from(t):Int16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}let R1e=class P1e{constructor(e,i,r){this.primitiveIndices=e,this._numIndexPerPrimitive=i,this.position=r,this._children=void 0,Ke(e.length>=1),Ke(r.size===3||r.size===4);const{data:n,size:s,indices:o}=r;Ke(o.length%this._numIndexPerPrimitive==0),Ke(o.length>=e.length*this._numIndexPerPrimitive);const a=e.length;let l=s*o[this._numIndexPerPrimitive*e[0]];Z_.clear(),Z_.push(l);const c=Ce(n[l],n[l+1],n[l+2]),u=Br(c);for(let m=0;m<a;++m){const y=this._numIndexPerPrimitive*e[m];for(let _=0;_<this._numIndexPerPrimitive;++_){l=s*o[y+_],Z_.push(l);let v=n[l];c[0]=Math.min(v,c[0]),u[0]=Math.max(v,u[0]),v=n[l+1],c[1]=Math.min(v,c[1]),u[1]=Math.max(v,u[1]),v=n[l+2],c[2]=Math.min(v,c[2]),u[2]=Math.max(v,u[2])}}this.bbMin=c,this.bbMax=u;const d=Ui(C(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(u[0]-c[0],u[1]-c[1]),u[2]-c[2]);let p=this.radius*this.radius;for(let m=0;m<Z_.length;++m){l=Z_.at(m);const y=n[l]-d[0],_=n[l+1]-d[1],v=n[l+2]-d[2],w=y*y+_*_+v*v;if(w<=p)continue;const x=Math.sqrt(w),T=.5*(x-this.radius);this.radius=this.radius+T,p=this.radius*this.radius;const S=T/x;d[0]+=y*S,d[1]+=_*S,d[2]+=v*S}this.center=d,Z_.clear()}getChildren(){if(this._children||bs(this.bbMin,this.bbMax)<=1)return this._children;const e=Ui(C(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,r=new Uint8Array(i),n=new Array(8);for(let u=0;u<8;++u)n[u]=0;const{data:s,size:o,indices:a}=this.position;for(let u=0;u<i;++u){let d=0;const p=this._numIndexPerPrimitive*this.primitiveIndices[u];let m=o*a[p],y=s[m],_=s[m+1],v=s[m+2];for(let w=1;w<this._numIndexPerPrimitive;++w){m=o*a[p+w];const x=s[m],T=s[m+1],S=s[m+2];x<y&&(y=x),T<_&&(_=T),S<v&&(v=S)}y<e[0]&&(d|=1),_<e[1]&&(d|=2),v<e[2]&&(d|=4),r[u]=d,++n[d]}let l=0;for(let u=0;u<8;++u)n[u]>0&&++l;if(l<2)return;const c=new Array(8);for(let u=0;u<8;++u)c[u]=n[u]>0?new Uint32Array(n[u]):void 0;for(let u=0;u<8;++u)n[u]=0;for(let u=0;u<i;++u){const d=r[u];c[d][n[d]++]=this.primitiveIndices[u]}this._children=new Array;for(let u=0;u<8;++u)c[u]!==void 0&&this._children.push(new P1e(c[u],this._numIndexPerPrimitive,this.position));return this._children}static prune(){Z_.prune()}};const Z_=new It({deallocator:null});let PR=class{constructor(){this.id=Kc()}};function aHe(t){return t?{p0:Br(t.p0),p1:Br(t.p1),p2:Br(t.p2)}:{p0:C(),p1:C(),p2:C()}}function kte(t,e,i){const r=e[0]-t[0],n=e[1]-t[1],s=i[0]-t[0],o=i[1]-t[1];return .5*Math.abs(r*o-n*s)}function lHe(t,e,i){return he(K6,e,t),he(Ute,i,t),we(nt(K6,K6,Ute))/2}new kg(tp);new kg(()=>aHe());const K6=C(),Ute=C();function cHe(t,e){if(!t)return!1;const{size:i,data:r,indices:n}=t;oe(e,0,0,0),oe(ju,0,0,0);let s=0,o=0;for(let a=0;a<n.length-2;a+=3){const l=n[a]*i,c=n[a+1]*i,u=n[a+2]*i;oe(Ns,r[l],r[l+1],r[l+2]),oe(Jm,r[c],r[c+1],r[c+2]),oe(fM,r[u],r[u+1],r[u+2]);const d=lHe(Ns,Jm,fM);d?(ce(Ns,Ns,Jm),ce(Ns,Ns,fM),te(Ns,Ns,1/3*d),ce(e,e,Ns),s+=d):(ce(ju,ju,Ns),ce(ju,ju,Jm),ce(ju,ju,fM),o+=3)}return(o!==0||s!==0)&&(s!==0?(te(e,e,1/s),!0):o!==0&&(te(e,ju,1/o),!0))}function uHe(t,e){if(!t)return!1;const{size:i,data:r,indices:n}=t;oe(e,0,0,0);let s=-1,o=0;for(let a=0;a<n.length;a++){const l=n[a]*i;s!==l&&(e[0]+=r[l],e[1]+=r[l+1],e[2]+=r[l+2],o++),s=l}return o>1&&te(e,e,1/o),o>0}function hHe(t,e,i){if(!t)return!1;oe(i,0,0,0),oe(ju,0,0,0);let r=0,n=0;const{size:s,data:o,indices:a}=t,l=a.length-1,c=l+(e?2:0);for(let u=0;u<c;u+=2){const d=u<l?u+1:0,p=a[u<l?u:l]*s,m=a[d]*s;Ns[0]=o[p],Ns[1]=o[p+1],Ns[2]=o[p+2],Jm[0]=o[m],Jm[1]=o[m+1],Jm[2]=o[m+2],te(Ns,ce(Ns,Ns,Jm),.5);const y=aR(Ns,Jm);y>0?(ce(i,i,te(Ns,Ns,y)),r+=y):r===0&&(ce(ju,ju,Ns),n++)}return r!==0?(te(i,i,1/r),!0):n!==0&&(te(i,ju,1/n),!0)}const Ns=C(),Jm=C(),fM=C(),ju=C();let LN=class{constructor(e){this.channel=e,this.id=Kc()}};function bG(t,e){return t==null&&(t=[]),t.push(e),t}function wG(t,e){if(t==null)return null;const i=t.filter(r=>r!==e);return i.length===0?null:i}function dHe(t,e,i,r,n){mM[0]=t.get(e,0),mM[1]=t.get(e,1),mM[2]=t.get(e,2),N7(mM,J_,3),i.set(n,0,J_[0]),r.set(n,0,J_[1]),i.set(n,1,J_[2]),r.set(n,1,J_[3]),i.set(n,2,J_[4]),r.set(n,2,J_[5])}const mM=C(),J_=new Float32Array(6);let Wn=class M1e extends PR{constructor(e,i,r=null,n=on.Mesh,s=null,o=-1){super(),this.material=e,this.mapPositions=r,this.type=n,this.objectAndLayerIdColor=s,this.edgeIndicesLength=o,this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(const[a,l]of i)this._attributes.set(a,{...l,indices:Sf(l.indices)}),a===O.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(a).indices.length:this.edgeIndicesLength)}instantiate(e={}){const i=new M1e(e.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach((r,n)=>{r.exclusive=!1,i._attributes.set(n,r)}),i._boundingInfo=this._boundingInfo,i.transformation=e.transformation||this.transformation,i}get attributes(){return this._attributes}getMutableAttribute(e){let i=this._attributes.get(e);return i&&!i.exclusive&&(i={...i,exclusive:!0,data:oHe(i.data)},this._attributes.set(e,i)),i}setAttributeData(e,i){const r=this._attributes.get(e);r&&this._attributes.set(e,{...r,exclusive:!0,data:i})}get indexCount(){return this._attributes.values().next().value.indices?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo==null&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===on.Mesh?this._computeAttachmentOriginTriangles(e):this.type===on.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(this._transformation!=null&&Fe(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const i=this.attributes.get(O.POSITION);return cHe(i,e)}_computeAttachmentOriginLines(e){const i=this.attributes.get(O.POSITION);return hHe(i,pHe(this.material.parameters,i),e)}_computeAttachmentOriginPoints(e){const i=this.attributes.get(O.POSITION);return uHe(i,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.attributes.get(O.POSITION);if(!e||e.indices.length===0)return null;const i=this.type===on.Mesh?3:1;Ke(e.indices.length%i==0,"Indexing error: "+e.indices.length+" not divisible by "+i);const r=pw(e.indices.length/i);return new R1e(r,i,e)}get transformation(){return this._transformation??zr}set transformation(e){this._transformation=e&&e!==zr?JT(e):null}addHighlight(){const e=new LN(Rg.Highlight);return this.highlights=bG(this.highlights,e),e}removeHighlight(e){this.highlights=wG(this.highlights,e)}};function pHe(t,e){return!(!("isClosed"in t)||!t.isClosed)&&e.indices.length>2}const Hw=vG,Q6=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],fHe=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],mHe=[0,0,1,0,1,1,0,1],gHe=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],$1e=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)$1e[6*t+e]=t;const o1=new Array(36);for(let t=0;t<6;t++)o1[6*t]=0,o1[6*t+1]=1,o1[6*t+2]=2,o1[6*t+3]=2,o1[6*t+4]=3,o1[6*t+5]=0;function yHe(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(24);for(let r=0;r<8;r++)i[3*r]=Q6[r][0]*e[0],i[3*r+1]=Q6[r][1]*e[1],i[3*r+2]=Q6[r][2]*e[2];return new Wn(t,[[O.POSITION,new ke(i,gHe,3,!0)],[O.NORMAL,new ke(fHe,$1e,3)],[O.UV0,new ke(mHe,o1,2)]])}const eU=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],_He=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],vHe=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],bHe=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function wHe(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(18);for(let r=0;r<6;r++)i[3*r]=eU[r][0]*e[0],i[3*r+1]=eU[r][1]*e[1],i[3*r+2]=eU[r][2]*e[2];return new Wn(t,[[O.POSITION,new ke(i,vHe,3,!0)],[O.NORMAL,new ke(_He,bHe,3)]])}const EL=Hi(-.5,0,-.5),CL=Hi(.5,0,-.5),AL=Hi(0,0,.5),OL=Hi(0,.5,0),qw=mn(),Ww=mn(),dT=mn(),pT=mn(),fT=mn();he(qw,EL,OL),he(Ww,EL,CL),nt(dT,qw,Ww),ge(dT,dT),he(qw,CL,OL),he(Ww,CL,AL),nt(pT,qw,Ww),ge(pT,pT),he(qw,AL,OL),he(Ww,AL,EL),nt(fT,qw,Ww),ge(fT,fT);const tU=[EL,CL,AL,OL],xHe=[0,-1,0,dT[0],dT[1],dT[2],pT[0],pT[1],pT[2],fT[0],fT[1],fT[2]],THe=[0,1,2,3,1,0,3,2,1,3,0,2],SHe=[0,0,0,1,1,1,2,2,2,3,3,3];function EHe(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(12);for(let r=0;r<4;r++)i[3*r]=tU[r][0]*e[0],i[3*r+1]=tU[r][1]*e[1],i[3*r+2]=tU[r][2]*e[2];return new Wn(t,[[O.POSITION,new ke(i,THe,3,!0)],[O.NORMAL,new ke(xHe,SHe,3)]])}function HPt(t,e,i,r,n={uv:!0}){const s=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(i)),u=Math.max(2,Math.floor(r)),d=(c+1)*(u+1),p=Jr(3*d),m=Jr(3*d),y=Jr(2*d),_=[];let v=0;for(let T=0;T<=u;T++){const S=[],E=T/u,A=a+E*l,P=Math.cos(A);for(let N=0;N<=c;N++){const F=N/c,D=s+F*o,$=Math.cos(D)*P,R=Math.sin(A),k=-Math.sin(D)*P;p[3*v]=$*e,p[3*v+1]=R*e,p[3*v+2]=k*e,m[3*v]=$,m[3*v+1]=R,m[3*v+2]=k,y[2*v]=F,y[2*v+1]=E,S.push(v),++v}_.push(S)}const w=new Array;for(let T=0;T<u;T++)for(let S=0;S<c;S++){const E=_[T][S],A=_[T][S+1],P=_[T+1][S+1],N=_[T+1][S];T===0?(w.push(E),w.push(P),w.push(N)):T===u-1?(w.push(E),w.push(A),w.push(P)):(w.push(E),w.push(A),w.push(P),w.push(P),w.push(N),w.push(E))}const x=[[O.POSITION,new ke(p,w,3,!0)],[O.NORMAL,new ke(m,w,3,!0)]];return n.uv&&x.push([O.UV0,new ke(y,w,2,!0)]),n.offset&&(x[0][0]=O.OFFSET,x.push([O.POSITION,new ke(Float64Array.from(n.offset),M_(w.length),3,!0)])),new Wn(t,x)}function CHe(t,e,i,r){const n=I1e(e,i,r);return new Wn(t,n)}function I1e(t,e,i){const r=t;let n,s;if(i)n=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],s=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const c=r*(1+Math.sqrt(5))/2;n=[-r,c,0,r,c,0,-r,-c,0,r,-c,0,0,-r,c,0,r,c,0,-r,-c,0,r,-c,c,0,-r,c,0,r,-c,0,-r,-c,0,r],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let c=0;c<n.length;c+=3)Hw.scale(n,c,t/Hw.length(n,c));let o={};function a(c,u){c>u&&([c,u]=[u,c]);const d=c.toString()+"."+u.toString();if(o[d])return o[d];let p=n.length;return n.length+=3,Hw.add(n,3*c,n,3*u,n,p),Hw.scale(n,p,t/Hw.length(n,p)),p/=3,o[d]=p,p}for(let c=0;c<e;c++){const u=s.length,d=new Array(4*u);for(let p=0;p<u;p+=3){const m=s[p],y=s[p+1],_=s[p+2],v=a(m,y),w=a(y,_),x=a(_,m),T=4*p;d[T]=m,d[T+1]=v,d[T+2]=x,d[T+3]=y,d[T+4]=w,d[T+5]=v,d[T+6]=_,d[T+7]=x,d[T+8]=w,d[T+9]=v,d[T+10]=w,d[T+11]=x}s=d,o={}}const l=Fte(n);for(let c=0;c<l.length;c+=3)Hw.normalize(l,c);return[[O.POSITION,new ke(Fte(n),s,3,!0)],[O.NORMAL,new ke(l,s,3,!0)]]}function xG(t,e,i,r,n,s,o,a,l=null){const c=i?[i[0],i[1],i[2]]:[0,0,0],u=e?[e[0],e[1],e[2]]:[0,0,1];o=o||[0,0];const d=r?[255*r[0],255*r[1],255*r[2],r.length>3?255*r[3]:255]:[255,255,255,255],p=n!=null&&n.length===2?n:[1,1],m=M_(1),y=[[O.POSITION,new ke(c,m,3,!0)],[O.NORMAL,new ke(u,m,3,!0)],[O.UV0,new ke(o,m,o.length)],[O.COLOR,new ke(d,m,4,!0)],[O.SIZE,new ke(p,m,2)]];if(s!=null){const _=[s[0],s[1],s[2],s[3]];y.push([O.AUXPOS1,new ke(_,m,4)])}if(a!=null){const _=[a[0],a[1],a[2],a[3]];y.push([O.FEATUREATTRIBUTE,new ke(_,m,4)])}return new Wn(t,y,null,on.Point,l)}const AHe=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function qPt(t,e=AHe){const i=new Array(12);for(let c=0;c<4;c++)for(let u=0;u<3;u++)i[3*c+u]=e[c][u];const r=[0,1,2,2,3,0],n=[0,0,1],s=[0,0,0,0,0,0],o=[0,0,1,0,1,1,0,1],a=[255,255,255,255],l=[[O.POSITION,new ke(i,r,3,!0)],[O.NORMAL,new ke(n,s,3,!0)],[O.UV0,new ke(o,r,2,!0)],[O.COLOR,new ke(a,s,4,!0)]];return new Wn(t,l)}function zte(t,e,i,r,n,s=!0,o=!0){let a=0;const l=i,c=e;let u=Hi(0,a,0),d=Hi(0,a+c,0),p=Hi(0,-1,0),m=Hi(0,1,0);n&&(a=c,d=Hi(0,0,0),u=Hi(0,a,0),p=Hi(0,1,0),m=Hi(0,-1,0));const y=[d,u],_=[p,m],v=r+2,w=Math.sqrt(c*c+l*l);if(n)for(let P=r-1;P>=0;P--){const N=P*(2*Math.PI/r),F=Hi(Math.cos(N)*l,a,Math.sin(N)*l);y.push(F);const D=Hi(c*Math.cos(N)/w,-l/w,c*Math.sin(N)/w);_.push(D)}else for(let P=0;P<r;P++){const N=P*(2*Math.PI/r),F=Hi(Math.cos(N)*l,a,Math.sin(N)*l);y.push(F);const D=Hi(c*Math.cos(N)/w,l/w,c*Math.sin(N)/w);_.push(D)}const x=new Array,T=new Array;if(s){for(let P=3;P<y.length;P++)x.push(1),x.push(P-1),x.push(P),T.push(0),T.push(0),T.push(0);x.push(y.length-1),x.push(2),x.push(1),T.push(0),T.push(0),T.push(0)}if(o){for(let P=3;P<y.length;P++)x.push(P),x.push(P-1),x.push(0),T.push(P),T.push(P-1),T.push(1);x.push(0),x.push(2),x.push(y.length-1),T.push(1),T.push(2),T.push(_.length-1)}const S=Jr(3*v);for(let P=0;P<v;P++)S[3*P]=y[P][0],S[3*P+1]=y[P][1],S[3*P+2]=y[P][2];const E=Jr(3*v);for(let P=0;P<v;P++)E[3*P]=_[P][0],E[3*P+1]=_[P][1],E[3*P+2]=_[P][2];const A=[[O.POSITION,new ke(S,x,3,!0)],[O.NORMAL,new ke(E,T,3,!0)]];return new Wn(t,A)}function OHe(t,e,i,r,n,s,o){const a=n?M7(n):Hi(1,0,0),l=s?M7(s):Hi(0,0,0);o??(o=!0);const c=mn();ge(c,a);const u=mn();te(u,c,Math.abs(e));const d=mn();te(d,u,-.5),ce(d,d,l);const p=Hi(0,1,0);Math.abs(1-me(c,p))<.2&&oe(p,0,0,1);const m=mn();nt(m,c,p),ge(m,m),nt(p,m,c);const y=2*r+(o?2:0),_=r+(o?2:0),v=Jr(3*y),w=Jr(3*_),x=Jr(2*y),T=new Array(3*r*(o?4:2)),S=new Array(3*r*(o?4:2));o&&(v[3*(y-2)]=d[0],v[3*(y-2)+1]=d[1],v[3*(y-2)+2]=d[2],x[2*(y-2)]=0,x[2*(y-2)+1]=0,v[3*(y-1)]=v[3*(y-2)]+u[0],v[3*(y-1)+1]=v[3*(y-2)+1]+u[1],v[3*(y-1)+2]=v[3*(y-2)+2]+u[2],x[2*(y-1)]=1,x[2*(y-1)+1]=1,w[3*(_-2)]=-c[0],w[3*(_-2)+1]=-c[1],w[3*(_-2)+2]=-c[2],w[3*(_-1)]=c[0],w[3*(_-1)+1]=c[1],w[3*(_-1)+2]=c[2]);const E=(D,$,R)=>{T[D]=$,S[D]=R};let A=0;const P=mn(),N=mn();for(let D=0;D<r;D++){const $=D*(2*Math.PI/r);te(P,p,Math.sin($)),te(N,m,Math.cos($)),ce(P,P,N),w[3*D]=P[0],w[3*D+1]=P[1],w[3*D+2]=P[2],te(P,P,i),ce(P,P,d),v[3*D]=P[0],v[3*D+1]=P[1],v[3*D+2]=P[2],x[2*D]=D/r,x[2*D+1]=0,v[3*(D+r)]=v[3*D]+u[0],v[3*(D+r)+1]=v[3*D+1]+u[1],v[3*(D+r)+2]=v[3*D+2]+u[2],x[2*(D+r)]=D/r,x[2*D+1]=1;const R=(D+1)%r;E(A++,D,D),E(A++,D+r,D),E(A++,R,R),E(A++,R,R),E(A++,D+r,D),E(A++,R+r,R)}if(o){for(let D=0;D<r;D++){const $=(D+1)%r;E(A++,y-2,_-2),E(A++,D,_-2),E(A++,$,_-2)}for(let D=0;D<r;D++){const $=(D+1)%r;E(A++,D+r,_-1),E(A++,y-1,_-1),E(A++,$+r,_-1)}}const F=[[O.POSITION,new ke(v,T,3,!0)],[O.NORMAL,new ke(w,S,3,!0)],[O.UV0,new ke(x,T,2,!0)]];return new Wn(t,F)}function WPt(t,e,i,r,n,s,o=Hi(0,0,0)){const a=e.length,l=Jr(i.length*a*3+(6*r.length||0)),c=Jr(i.length*a*3+(r?6:0)),u=new Array,d=new Array;let p=0,m=0;const y=mn(),_=mn(),v=mn(),w=mn(),x=mn(),T=mn(),S=mn(),E=C(),A=mn(),P=mn(),N=mn(),F=mn(),D=mn(),$=Ti();oe(A,0,1,0),he(_,i[1],i[0]),ge(_,_),s?(ce(E,i[0],o),ge(v,E)):oe(v,0,0,1),DN(_,v,A,A,x,v,Bte),se(w,v),se(F,x);for(let I=0;I<r.length;I++)te(T,x,r[I][0]),te(E,v,r[I][2]),ce(T,T,E),ce(T,T,i[0]),l[p++]=T[0],l[p++]=T[1],l[p++]=T[2];c[m++]=-_[0],c[m++]=-_[1],c[m++]=-_[2];for(let I=0;I<n.length;I++)u.push(n[I][0]>0?n[I][0]:-n[I][0]-1+r.length),u.push(n[I][1]>0?n[I][1]:-n[I][1]-1+r.length),u.push(n[I][2]>0?n[I][2]:-n[I][2]-1+r.length),d.push(0),d.push(0),d.push(0);let R=r.length;const k=r.length-1;for(let I=0;I<i.length;I++){let G=!1;I>0&&(se(y,_),I<i.length-1?(he(_,i[I+1],i[I]),ge(_,_)):G=!0,ce(P,y,_),ge(P,P),ce(N,i[I-1],w),xR(i[I],P,$),aw($,pu(N,y),E)?(he(E,E,i[I]),ge(v,E),nt(x,P,v),ge(x,x)):DN(P,w,F,A,x,v,Bte),se(w,v),se(F,x)),s&&(ce(E,i[I],o),ge(D,E));for(let q=0;q<a;q++)if(te(T,x,e[q][0]),te(E,v,e[q][1]),ce(T,T,E),ge(S,T),c[m++]=S[0],c[m++]=S[1],c[m++]=S[2],ce(T,T,i[I]),l[p++]=T[0],l[p++]=T[1],l[p++]=T[2],!G){const Z=(q+1)%a;u.push(R+q),u.push(R+a+q),u.push(R+Z),u.push(R+Z),u.push(R+a+q),u.push(R+a+Z);for(let K=0;K<6;K++){const Q=u.length-6;d.push(u[Q+K]-k)}}R+=a}const B=i[i.length-1];for(let I=0;I<r.length;I++)te(T,x,r[I][0]),te(E,v,r[I][1]),ce(T,T,E),ce(T,T,B),l[p++]=T[0],l[p++]=T[1],l[p++]=T[2];const j=m/3;c[m++]=_[0],c[m++]=_[1],c[m++]=_[2];const X=R-a;for(let I=0;I<n.length;I++)u.push(n[I][0]>=0?R+n[I][0]:-n[I][0]-1+X),u.push(n[I][2]>=0?R+n[I][2]:-n[I][2]-1+X),u.push(n[I][1]>=0?R+n[I][1]:-n[I][1]-1+X),d.push(j),d.push(j),d.push(j);const M=[[O.POSITION,new ke(l,u,3,!0)],[O.NORMAL,new ke(c,d,3,!0)]];return new Wn(t,M)}function YPt(t,e,i,r){Ke(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),Ke(e[0].length===3,"createPolylineGeometry(): malformed vertex"),Ke(i==null||i.length===e.length,"createPolylineGeometry: need same number of points and normals"),Ke(i==null||i[0].length===3,"createPolylineGeometry(): malformed normal");const n=Vs(3*e.length),s=new Array(2*(e.length-1));let o=0,a=0;for(let c=0;c<e.length;c++){for(let u=0;u<3;u++)n[o++]=e[c][u];c>0&&(s[a++]=c-1,s[a++]=c)}const l=[[O.POSITION,new ke(n,s,3,!0)]];if(i){const c=Jr(3*i.length);let u=0;for(let d=0;d<e.length;d++)for(let p=0;p<3;p++)c[u++]=i[d][p];l.push([O.NORMAL,new ke(c,s,3,!0)])}return r&&l.push([O.COLOR,new ke(r,pw(r.length/4),4)]),new Wn(t,l,null,on.Line)}function RHe(t,e=t){const i=t.attributes,r=i.get(O.POSITION).data,n=i.get(O.NORMAL).data;if(n){const s=e.getMutableAttribute(O.NORMAL).data;for(let o=0;o<n.length;o+=3){const a=n[o+1];s[o+1]=-n[o+2],s[o+2]=a}}if(r){const s=e.getMutableAttribute(O.POSITION).data;for(let o=0;o<r.length;o+=3){const a=r[o+1];s[o+1]=-r[o+2],s[o+2]=a}}}function iU(t,e,i,r,n){return!(Math.abs(me(e,t))>n)&&(nt(i,t,e),ge(i,i),nt(r,i,t),ge(r,r),!0)}function DN(t,e,i,r,n,s,o){return iU(t,e,n,s,o)||iU(t,i,n,s,o)||iU(t,r,n,s,o)}const Bte=.99619469809;let PHe=class{constructor(e,i){this.type=Ho.Local,this._configuration=new SY,this._passParameters=new EY,this._configuration.geometry=Nf.Cylinder,this._technique=i.techniqueRepository.acquire(MN,this._configuration);const r=i.renderContext.rctx;this._vao=this._createVertexArrayObject(r),this._vaoCount=cg(this._vao,"geometry");const n=new Li;n.wrapMode=Nt.CLAMP_TO_EDGE,n.flipped=!0,n.width=1,n.height=512,this._passParameters.texture=new Pt(r,n,Jje)}destroy(){this._passParameters.texture=et(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(e){const i=e.rctx,r=i.bindTechnique(this._technique,this._passParameters,e.bindParameters);MHe(Vte,e.bindParameters.camera.viewMatrix),r.setUniformMatrix4fv("view",Vte),i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Qt.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(e){const i=I1e(1,2,!1),{data:r,indices:n}=i[0][1],s=Gte.createBuffer(n.length),o=s.position;for(let a=0;a<n.length;++a){const l=3*n[a%3==0?a+2:a%3==2?a-2:a];o.set(a,0,r[l]),o.set(a,1,r[l+1]),o.set(a,2,r[l+2])}return new np(e,fi,{geometry:pc(Gte)},{geometry:Ri.createVertex(e,vi.STATIC_DRAW,s.buffer)})}};function MHe(t,e){Nn(t,e),t[12]=0,t[13]=0,t[14]=0,t[15]=1}const Vte=be(),Gte=Ir().vec3f(O.POSITION),$He=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),gM=128,jte=-w7,Hte=0,rU=50,IHe=()=>1-511/512,LHe=oL([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let DHe=class{constructor(e,i){this.view=e,this.type=Ho.Mars,this._passParameters=new EY,this._vaoCount=0,this._texV1=1;const r=Fi(e.spatialReference);this._planetRadius=r.radius,this._outerRimWidth=r.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+jte)/this._planetRadius,this._middleRimFactor=(this._planetRadius+Hte)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=Hte/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniqueRepository=i.techniqueRepository;const n=i.renderContext.rctx;this._cameraChangeHandle=le(()=>this.view.state?.camera,()=>i.requestRender(),Yi),this._vao=this._createRibbon(n),this._vaoCount=cg(this._vao,"geometry"),this._fadeVao=Zf(n),this._fadeVaoCount=cg(this._fadeVao,"geometry");const s=new Li;s.wrapMode=Nt.CLAMP_TO_EDGE,s.flipped=!0,s.width=1,s.height=512,this._passParameters.texture=new Pt(n,s,$He);const o=new SY;o.geometry=Nf.Cone,this._coneTechnique=this._techniqueRepository.acquire(MN,o),o.geometry=Nf.Underground,this._undergroundTechnique=this._techniqueRepository.acquire(MN,o)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=et(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(e){const i=e.bindParameters.camera;this._update(i);const r=e.rctx;this._passParameters.undergroundFadeAlpha<1&&(r.bindTechnique(this._coneTechnique,this._passParameters,e.bindParameters),r.bindVAO(this._vao),r.drawArrays(Qt.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(r.bindTechnique(this._undergroundTechnique,this._passParameters,e.bindParameters),r.bindVAO(this._fadeVao),r.drawArrays(Qt.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(e){const i=C(),r=this._planetRadius,n=we(e.eye),s=n-r;if(s<0){const m=Math.min(-s/5e3,1);this._passParameters.undergroundFadeAlpha=m}else this._passParameters.undergroundFadeAlpha=0;const o=Math.max(rU,s),a=r+jte;this._passParameters.innerScale=NHe(r+o,r,a)-1,this._passParameters.altitudeFade=uY(s),te(i,e.eye,(r+rU)/n),qte(i,e.center,e.up,r,this._passParameters.silhouette);const l=this._computeScreenRimWidth(e,i,e.up,this._passParameters.silhouette),c=IHe(),u=LHe(s);let d=this._texV0+c*this._texVScale,p=this._texV0+l*u*this._texVScale;if(s>rU){qte(e.eye,e.center,e.up,r,this._passParameters.silhouette);const m=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),y=_e((m-1.5)/(l-1.5),0,1);d=this._texV0+y*c*this._texVScale,p=this._texV0+_t(this._texV1,l*u,y)*this._texVScale}si(this._passParameters.texV,d,p)}_createRibbon(e){const i=Jr(3+3*gM*3),r=new Uint32Array(3*gM*5);i[0]=0,i[1]=0,i[2]=-1;for(let o=0;o<gM;o++){const a=9*o+3;i[a]=o,i[a+1]=this._innerRimFactor,i[a+2]=-1,i[a+3]=o,i[a+4]=this._middleRimFactor,i[a+5]=0,i[a+6]=o,i[a+7]=this._outerRimFactor,i[a+8]=1;const l=3*o+1,c=o===gM-1?1:l+3,u=15*o;r[u]=l,r[u+1]=l+1,r[u+2]=c+1,r[u+3]=c+1,r[u+4]=c,r[u+5]=l,r[u+6]=l+1,r[u+7]=l+2,r[u+8]=c+2,r[u+9]=c+2,r[u+10]=c+1,r[u+11]=l+1,r[u+12]=l,r[u+13]=c,r[u+14]=0}const n=Wte.createBuffer(r.length),s=n.position;for(let o=0;o<r.length;++o){const a=3*r[o];s.set(o,0,i[a]),s.set(o,1,i[a+1]),s.set(o,2,i[a+2])}return new np(e,fi,{geometry:pc(Wte)},{geometry:Ri.createVertex(e,vi.STATIC_DRAW,n.buffer)})}_computeScreenRimWidth(e,i,r,n){return ce(Yw,n.center,n.v2),te(yM,Yw,this._outerRimFactor),$4(nU,i,Yw,r),nte(Yw,nU,e.projectionMatrix,e.viewport,Yw),nte(yM,nU,e.projectionMatrix,e.viewport,yM),br(Yw,yM)/e.height}};function qte(t,e,i,r,n){const s=we(t),o=r*Math.sqrt(s*s-r*r)/s,a=Math.sqrt(r*r-o*o),l=n.v1,c=n.v2;return te(n.center,t,a/s),nt(l,t,e),Oo(l)<1&&nt(l,t,i),te(l,l,o/we(l)),nt(c,l,t),te(c,c,o/we(c)),o}const nU=be(),Yw=C(),yM=C();function NHe(t,e,i){return t*t/(Math.sqrt(t*t-e*e)*Math.sqrt(t*t-i*i)+e*i)}const Wte=Ir().vec3f(O.POSITION);var Pg;(function(t){t[t.Rain=0]="Rain",t[t.Snow=1]="Snow",t[t.COUNT=2]="COUNT"})(Pg||(Pg={}));let TG=class extends bl{constructor(){super(...arguments),this.type=Pg.Rain}};h([V({count:Pg.COUNT})],TG.prototype,"type",void 0);function FHe(t){const e=new mi;return e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.INSTANCEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add(new $t("cameraPosition",(i,r)=>r.camera.eye)),e.vertex.uniforms.add(new $t("offset",(i,r)=>kHe(i,r))),e.vertex.uniforms.add(new Oe("width",i=>i.width)),e.vertex.uniforms.add(new Vr("proj",(i,r)=>r.camera.projectionMatrix)),e.vertex.uniforms.add(new Vr("view",(i,r)=>r.camera.viewMatrix)),e.vertex.uniforms.add(new Oe("time",i=>i.time)),e.varyings.add("vUv","vec2"),e.vertex.code.add(b`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${t.type===Pg.Rain?b`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:b`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),e.fragment.uniforms.add(new Oe("opacity",i=>i.opacity),new $t("particleColor",(i,r)=>UHe(r,t))),e.fragment.code.add(b`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${t.type===Pg.Rain?b`d = 0.35 * smoothstep(0.5, 0.0, d);`:b`d = smoothstep(0.5, 0.1, d);`}
      fragColor = opacity * vec4(particleColor * d, d);
    }
  `),e}function kHe(t,e){const i=e.camera.eye,r=.5*t.width,n=1/t.width,s=Gde(SG,oe(SG,(i[0]+r)*n,(i[1]+r)*n,(i[2]+r)*n));return zs(s,i,te(s,s,t.width))}function UHe(t,e){const i=e.type===Pg.Rain?BHe:zHe,r=te(SG,i,VHe),n=t.camera.eye;ge(Yte,n);const s=Math.max(0,me(Yte,t.lighting.mainLight.direction));return Ui(r,r,i,s)}const SG=C(),Yte=C(),zHe=Ce(1,1,1),BHe=Ce(.85,.85,.85),VHe=.7,GHe=Object.freeze(Object.defineProperty({__proto__:null,build:FHe},Symbol.toStringTag,{value:"Module"}));let jHe=class extends Ki{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}},EG=class L1e extends Ci{initializeProgram(e){return new wi(e.rctx,L1e.shader.get().build(this.configuration),RL)}initializePipeline(){return Ot({blending:fo(Te.ONE,Te.ONE,Te.ONE_MINUS_SRC_ALPHA,Te.ONE_MINUS_SRC_ALPHA),depthTest:{func:Pi.LEQUAL},colorWrite:Ft})}};EG.shader=new bi(GHe,()=>pe(()=>import("./Precipitation.glsl-d8c52251.js"),[],import.meta.url));const RL=new Map([[O.POSITION,0],[O.INSTANCEFEATUREATTRIBUTE,1]]);let D1e=class{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance({deltaTime:e,fixedTime:i}){return i!=null?this._time!==i&&(this._time=i,!0):(this._time=this._time+e,e!==0)}},HHe=class{constructor(e,i){this.deltaTime=e,this.fixedTime=i}},a1=class extends xe{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new jHe,this._animation=new D1e,this._updatingTracking=new Ud,this._passParameters.time=0,this._passParameters.radius=Fi(e.view.spatialReference).radius,this._techniqueRepository=e.context.techniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechniqueCached=Jt(this._snowTechniqueCached),this._rainTechniqueCached=Jt(this._rainTechniqueCached),this._vao=et(this._vao),this._instanceIdBuffer=et(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get _rainTechnique(){if(this._rainTechniqueCached==null){const e=new TG;e.type=Pg.Rain,this._rainTechniqueCached=this._techniqueRepository.acquire(EG,e)}return this._rainTechniqueCached}get _snowTechnique(){if(this._snowTechniqueCached==null){const e=new TG;e.type=Pg.Snow,this._snowTechniqueCached=this._techniqueRepository.acquire(EG,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,i,r){const n=r==="rainy"?this._rainTechnique:this._snowTechnique;if(!n.compiled)return void this.context.requestRender();const s=e.rctx;if(this._ensureResources(s),n==null||this._vao==null||this._instanceIdBuffer==null||(e.bindParameters.cloudsFade.data!=null&&(this._passParameters.opacity=e.bindParameters.cloudsFade.opacity),this._passParameters.opacity<=0))return;const o=.35;i=i<.5?_t(0,o,2*i):_t(o,1,2*(i-.5)),this._passParameters.time=(r==="rainy"?this._rainSpeed:this._snowSpeed)*AH(this._animation.time)%1e5;const a=s.bindTechnique(n,this._passParameters,e.bindParameters);s.bindVAO(this._vao),a.assertCompatibleVertexAttributeLocations(this._vao),dY(s,RL,this._instanceIdBuffer,Xte,0),s.drawArraysInstanced(Qt.TRIANGLES,0,3,this._numParticles*i),pY(s,RL,this._instanceIdBuffer,Xte)}_ensureResources(e){this._vao==null&&(this._vao=this._createVertexArrayObject(e)),this._instanceIdBuffer==null&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const i=[];for(let r=0;r<this._numParticles;r++)i.push(r);return Ri.createVertex(e,vi.STATIC_DRAW,new Float32Array(i))}_createVertexArrayObject(e){const i=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new np(e,RL,{geometry:pc(qHe)},{geometry:Ri.createVertex(e,vi.STATIC_DRAW,i)})}};h([f({constructOnly:!0})],a1.prototype,"context",void 0),h([f({constructOnly:!0})],a1.prototype,"view",void 0),h([f({readOnly:!0})],a1.prototype,"updating",null),h([f()],a1.prototype,"_updatingTracking",void 0),a1=h([z("esri.views.3d.environment.Precipitation")],a1);const qHe=Ir().vec3f(O.POSITION),Xte=pc(Ir().f32(O.INSTANCEFEATUREATTRIBUTE),1);function WHe(){const t=new mi;return t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.COLOR,"vec4"),t.attributes.add(O.SIZE,"float"),t.varyings.add("vcolor","vec4"),t.varyings.add("vsize","float"),t.vertex.uniforms.add(new Vr("transform",(e,i)=>YHe(e,i)),new ai("viewport",(e,i)=>i.camera.fullViewport),new Oe("pixelRatio",(e,i)=>i.camera.pixelRatio)),t.vertex.code.add(b`void main(void) {
gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),t.fragment.code.add(b`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);
}`),t}function YHe(t,e){return Nn(f0,e.camera.projectionMatrix),f0[10]=24e-8-1,f0[11]=-1,f0[14]=(24e-8-2)*e.camera.near,Di(f0,f0,e.camera.viewMatrix),Di(f0,f0,t.modelMatrix)}const f0=be(),XHe=Object.freeze(Object.defineProperty({__proto__:null,build:WHe},Symbol.toStringTag,{value:"Module"}));let ZHe=class extends Ki{constructor(){super(...arguments),this.modelMatrix=be()}},N1e=class F1e extends Ci{constructor(e){super(e,new bl,()=>this.destroy())}initializeProgram(e){return new wi(e.rctx,F1e.shader.get().build(),fi)}initializePipeline(){return Ot({blending:fo(Te.SRC_ALPHA,Te.ONE,Te.ONE_MINUS_SRC_ALPHA,Te.ONE_MINUS_SRC_ALPHA),depthTest:{func:Pi.LEQUAL},colorWrite:Ft})}};N1e.shader=new bi(XHe,()=>pe(()=>import("./Stars.glsl-b8c99921.js"),[],import.meta.url));let oy=class extends xe{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return this._loadDataTask!=null&&!this._loadDataTask.finished}constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new ZHe,this._updatingTracking=new Ud}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=nc(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=Jt(this._technique),this._vao=et(this._vao),K_=null}render(e){const{rctx:i}=e;if(this._ensureResources(i),this._technique==null||this._vao==null)return;if(!this._technique.compiled)return void this.requestRender();const r=i.bindTechnique(this._technique,this._renderParameter,e.bindParameters);i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Qt.POINTS,0,this._numPoints)}_ensureResources(e){if(this._technique!=null||K_==null)return;this._technique=new N1e({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=K_.byteLength/Zte;const i=new Float32Array(K_,0,2*this._numPoints),r=new Uint8Array(K_,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,i,r,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type!=="virtual"?this.view.environment.lighting.date:null,n=>this._update(n),Zi)}_computeDayDuration(e){const i=e,r=new Date(e.getFullYear(),0,1,11,58,56);return(+i-+r)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+r)}_update(e){if(!e)return;const i=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,r=2*this._computeDayDuration(e),n=Nn(this._renderParameter.modelMatrix,QHe);FT(n,n,-r*Math.PI),Di(n,KHe,n),FT(n,n,-i*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,i,r,n){const s=Jte.createBuffer(n),o=s.position,a=s.color,l=s.size;for(let c=0;c<n;c++){const u=i[2*c],d=i[2*c+1];o.set(c,0,-Math.cos(u)*Math.sin(d)),o.set(c,1,-Math.sin(u)*Math.sin(d)),o.set(c,2,-Math.cos(d));const p=this._unpackUint8Attributes(r[c]),m=this._hexToRGB(JHe[p[1]]);a.set(c,0,255*m[0]),a.set(c,1,255*m[1]),a.set(c,2,255*m[2]),a.set(c,3,255),l.set(c,p[0])}return new np(e,fi,{geometry:pc(Jte)},{geometry:Ri.createVertex(e,vi.STATIC_DRAW,s.buffer)})}_createLoadDataTask(){if(K_!=null)return null;const e=S_(async i=>{const{data:r}=await DMe("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:i});this._verifyStarData(r),K_=r});return e.promise.catch(i=>{Fn(i)||ne.getLogger(this).error(i)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new W("stars:no-data-received","Failed to create stars because star catalogue is missing");const i=e.byteLength/Zte;if(i%1!=0||i>5e4||i<5e3)throw new W("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};h([f({constructOnly:!0})],oy.prototype,"view",void 0),h([f({constructOnly:!0})],oy.prototype,"requestRender",void 0),h([f({readOnly:!0})],oy.prototype,"updating",null),h([f()],oy.prototype,"_loadDataTask",void 0),h([f()],oy.prototype,"_updatingTracking",void 0),oy=h([z("esri.views.3d.environment.Stars")],oy);const JHe=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],KHe=xW(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),QHe=xW(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),Zte=9,Jte=Ir().vec3f(O.POSITION).vec4u8(O.COLOR).f32(O.SIZE);let K_=null;const kF={required:[]},k1e={required:[U.Depth]},U1e={required:[U.CompositeColor]},z1e={required:[U.Highlight]},eqe={required:[U.Depth,U.Normal]};let UF=class extends xe{consumes(){return kF}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}},fw=class extends UF{},B1e=class extends UF{},tqe=class extends UF{},iqe=class extends UF{};var mT;(function(t){t[t.Immediate=0]="Immediate",t[t.Faded=1]="Faded"})(mT||(mT={}));var hA;let xo=hA=class extends fw{constructor(t){super(t),this.produces=new Map([[ae.ENVIRONMENT_OPAQUE,()=>!(this._atmosphere===null&&this._stars===null)],[ae.ENVIRONMENT_TRANSPARENT,()=>this._atmosphere!==null]]),this._context=null,this._atmosphere=null,this._oldWeatherParameters=new sU,this._newWeatherParameters=new sU,this._fadedWeatherParameters=new sU,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(this)}destroy(){this.removeHandles(),this.uninitializeRenderContext(),this.view?._stage!=null&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return this._atmosphere}get _atmosphereType(){return this.atmosphere!=null?this.atmosphere.type:Ho.None}consumes(){return this._atmosphereType===Ho.Realistic?k1e:kF}updateAnimation(t){return this._precipitation!=null&&this._precipitation.update(t)}get updating(){return this._stars!=null&&this._stars.updating||this._clouds!=null&&this._clouds.running}get weatherVisible(){return we(this.view.state.camera.eye)-Fi(this.view.spatialReference).radius<=Wm}get usedMemory(){return this._clouds?.usedMemory??0}get _stars(){const t=this.view,e=t.environment?.starsEnabled??!1,i=this._get("_stars");return e&&this._context!=null?i??new oy({view:t,requestRender:()=>this._setNeedsRender()}):(Pe(i),null)}get _precipitation(){const t=this._get("_precipitation");if(!this._precipitationEnabled||this._context==null)return Pe(t),null;const e=this.view,i=this._context;return t!=null&&t.context===i?t:(Pe(t),new a1({context:i,view:e}))}get _clouds(){const t=this._get("_clouds");if(!this.weatherEnabled||this._context==null)return Pe(t),null;if(t!=null)return t;const e=this.view,i=this._context;return Pe(t),new il({context:i,view:e,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const t=this._get("_cloudsComposition");if(!this.weatherEnabled||this._context==null)return Pe(t),null;const e=this.view.state.viewingMode,i=this._context.renderContext.rctx,r=Fi(this.view.spatialReference).radius;return t!=null&&t.viewingMode===e&&t.planetRadius===r?t:(Pe(t),new n1({rctx:i,viewingMode:e,planetRadius:r,requestRender:()=>this._setNeedsRender()}))}get _fog(){const t=this._get("_fog");if(!this.weatherEnabled||this._context==null)return Pe(t),null;if(t!=null)return t;const e=this.view,i=this._context,r=this._context.renderContext.rctx,n=this.view.state.viewingMode;return new s1({context:i,view:e,rctx:r,viewingMode:n})}get weatherEnabled(){return!!this.view?.environmentManager?.weatherEnabled}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(t=null){this._context=t;const e=()=>this._setNeedsRender();this.addHandles([le(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),i=>this._updateAtmosphere(i),Yi),le(()=>this._stars,e),le(()=>this._precipitation,e),le(()=>this._clouds,()=>this._updateWeather(),Zi),le(()=>this._fog,()=>this._updateFogHaze(),Zi),le(()=>this.view.state.mode,()=>{this._setNeedsRender()},qi),le(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},Yi)])}uninitializeRenderContext(){this._context=null,this._atmosphere=Pe(this._atmosphere),this._set("_stars",Pe(this._stars)),this._set("_precipitation",Pe(this._precipitation)),this._set("_clouds",Pe(this._clouds)),this._set("_cloudsComposition",Pe(this._cloudsComposition)),this._set("_fog",Pe(this._fog))}prepareRender(t){t.bindParameters.cloudsFade.data=kGe(this._clouds)?this._clouds:null,this.view.viewingMode!=="local"&&t.bindParameters.cloudsFade.data?.cubeMap!=null&&(this._updateWeatherFading(t.bindParameters,t.time),t.bindParameters.cloudsFade.renderingStage===ff.FINISHED&&this._clouds!=null&&this._clouds.coverage===0&&this._clouds.running===!1&&(this._clouds.destroyFrameBufferCube(),t.bindParameters.cloudsFade.data=null))}renderNode(t){switch(t.bindParameters.slot){case ae.ENVIRONMENT_OPAQUE:this._stars!=null&&this._stars.render(t),this.atmosphere!=null&&(this.atmosphere.render(t,this.view?._stage?.renderer?.fullResolutionAtmosphere),this._cloudsComposition!=null&&t.bindParameters.cloudsFade.data!=null&&(this.weatherVisible&&this._clouds!=null&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(t)),t.bindParameters.cloudsFade.isFading&&this._context!=null&&t.bindParameters.cloudsFade.data?.cubeMap!=null&&this._context.requestRender());break;case ae.ENVIRONMENT_TRANSPARENT:if(this.atmosphere!=null&&(this.atmosphere.renderHaze(t,this._weatherParameters.hazeAmount,this.view?._stage?.renderer?.fullResolutionAtmosphere),this._weatherParameters.fog.amount>0&&this._fog!=null&&this._fog.render(t,this._weatherParameters.fog),this._precipitation!=null)){const e=this.view.environment.weather;e.type!=="rainy"&&e.type!=="snowy"||this._precipitation.render(t,e.precipitation,e.type)}}}updateLightSources(t,e,i,r){if(this._context!=null){const n=this._context.renderContext;n.bindParameters.oldLighting.copyFrom(n.bindParameters.lighting),n.bindParameters.newLighting.noonFactor=e,n.bindParameters.newLighting.globalFactor=i,n.bindParameters.newLighting.set(t),r===mT.Faded||n.bindParameters.weatherFading?n.bindParameters.fadeLighting(0):n.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const t=this.weatherEnabled?this.view.environment.weather:null;return t==null?null:t.type==="rainy"||t.type==="snowy"?{type:t.type,weatherAdjustment:t.cloudCover,effect:t.precipitation}:{type:t.type,weatherAdjustment:t.type==="foggy"?t.fogStrength:t.cloudCover}}_updateWeatherFading(t,e){t.cloudsFade.updateFading(t.camera,this.view.state.mode,e,this.view.qualitySettings.fadeDuration),t.cloudsFade.updateParallax(t.camera),t.weatherFading&&(this._updateLighting(t),this._updateFogAtmoshpere(t))}_updateLighting(t){t.cloudsFade.fadeMode!==_r.CROSS_FADE&&t.cloudsFade.fadeMode!==_r.FADE_IN?t.fadeLighting(0):t.fadeLighting(t.cloudsFade.fadeFactor)}_updateFogAtmoshpere(t){t.cloudsFade.fadeMode!==_r.CROSS_FADE&&t.cloudsFade.fadeMode!==_r.FADE_IN?this._fadeWeather(0):this._fadeWeather(t.cloudsFade.fadeFactor)}_fadeWeather(t){const{_newWeatherParameters:e,_oldWeatherParameters:i}=this;t>=1?this._weatherParameters=e:(this._fadedWeatherParameters.lerp(i,e,t),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const t=this._weatherUpdateParameters;t!=null&&this._clouds!=null&&(this._clouds.applyPreset(jo[t.type],t.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){this._context!=null&&this._context.requestRender()}_updateFogHaze(){const t=this._weatherUpdateParameters;if(this._fog==null||t==null||this._context==null)return;const e=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),t.type){case"foggy":this._newWeatherParameters.fog.strength=_t(3e-5,.005,t.weatherAdjustment**3),se(this._newWeatherParameters.fog.color,Kte),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=_t(4e-6,2e-4,(t.effect??0)**3),se(this._newWeatherParameters.fog.color,rqe),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=_t(4e-6,2e-4,(t.effect??0)**3),se(this._newWeatherParameters.fog.color,Kte),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender()}e.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(t){const e=this._selectAtmosphereType(t);if(e!==Ho.None&&this._context){if(!this._atmosphere||this._atmosphere.type!==e){this._atmosphere=Pe(this._atmosphere);const i=this._getAtmosphereClass(e);i&&(this._atmosphere=new i(this.view,this._context))}}else this._atmosphere=Pe(this._atmosphere);this._setNeedsRender()}_getAtmosphereClass(t){switch(t){case Ho.Realistic:return bte;case Ho.Local:return PHe;case Ho.Mars:return DHe;default:case Ho.None:return null}}_selectAtmosphereType(t){const{enabled:e,viewingMode:i}=t;return!e||Gf(this.view.spatialReference)?Ho.None:i===Me.Local?Ho.Local:this._context!=null&&bte.isSupported(this._context)&&$T(this.view.spatialReference)?Ho.Realistic:Vf(this.view.spatialReference)?Ho.Mars:Ho.None}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),stubGetAtmosphereClass:t=>{Qte=hA.prototype._getAtmosphereClass,hA.prototype._getAtmosphereClass=t},restoreGetAtmosphereClass:()=>{hA.prototype._getAtmosphereClass=Qte}}}};h([f({constructOnly:!0})],xo.prototype,"view",void 0),h([f({readOnly:!0})],xo.prototype,"atmosphere",null),h([f({readOnly:!0})],xo.prototype,"_atmosphereType",null),h([f({type:Boolean,readOnly:!0})],xo.prototype,"updating",null),h([f({readOnly:!0})],xo.prototype,"weatherVisible",null),h([f()],xo.prototype,"_context",void 0),h([f()],xo.prototype,"_atmosphere",void 0),h([f({readOnly:!0})],xo.prototype,"_stars",null),h([f({readOnly:!0})],xo.prototype,"_precipitation",null),h([f({readOnly:!0})],xo.prototype,"_clouds",null),h([f({readOnly:!0})],xo.prototype,"_cloudsComposition",null),h([f({readOnly:!0})],xo.prototype,"_fog",null),h([f({readOnly:!0})],xo.prototype,"weatherEnabled",null),h([f({readOnly:!0})],xo.prototype,"_precipitationEnabled",null),h([f({readOnly:!0})],xo.prototype,"_weatherUpdateParameters",null),xo=hA=h([z("esri.views.3d.environment.EnvironmentRenderer")],xo);let sU=class{constructor(){this.fog=new qje,this.hazeAmount=1}copyFrom(e){this.fog.amount=e.fog.amount,this.hazeAmount=e.hazeAmount,this.fog.strength=e.fog.strength,se(this.fog.color,e.fog.color)}lerp(e,i,r){this.fog.amount=_t(e.fog.amount,i.fog.amount,r),this.hazeAmount=_t(e.hazeAmount,i.hazeAmount,r),this.fog.strength=_t(e.fog.strength,i.fog.strength,r),Ui(this.fog.color,e.fog.color,i.fog.color,r)}};const rqe=Ce(.5,.5,.5),Kte=Ce(1.5,1.5,1.5);let Qte;var uMt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function MR(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var eie,tie,iie,CG={exports:{}};CG.exports,eie=CG,tie=function(){var t=Math.PI,e=Math.sin,i=Math.cos,r=Math.tan,n=Math.asin,s=Math.atan2,o=Math.acos,a=t/180,l=864e5,c=2440588,u=2451545,d={dec:0,ra:0};function p(M){return M.valueOf()/l-.5+c}function m(M){return new Date((M+.5-c)*l)}function y(M){return p(M)-u}var _=23.4397*a;function v(M,I){return s(e(M)*i(_)-r(I)*e(_),i(M))}function w(M,I){return n(e(I)*i(_)+i(I)*e(_)*e(M))}function x(M,I,G){return s(e(M),i(M)*e(I)-r(G)*i(I))}function T(M,I,G){return n(e(I)*e(G)+i(I)*i(G)*i(M))}function S(M,I){return a*(280.16+360.9856235*M)-I}function E(M){return a*(357.5291+.98560028*M)}function A(M){return a*(1.9148*e(M)+.02*e(2*M)+3e-4*e(3*M))}function P(M,I){return M+I+102.9372*a+t}function N(M,I){var G=E(M),q=P(G,A(G));return I||(I={dec:0,ra:0}),I.dec=w(q,0),I.ra=v(q,0),I}var F={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(M,I,G,q){var Z=a*-G,K=a*I,Q=y(M),de=N(Q,d),Ae=S(Q,Z)-de.ra;return q||(q={azimuth:0,altitude:0}),q.azimuth=x(Ae,K,de.dec),q.altitude=T(Ae,K,de.dec),q}},D=[[-.83,"sunrise","sunset"]];F.addTime=function(M,I,G){D.push([M,I,G])};var $=9e-4;function R(M,I){return Math.round(M-$-I/(2*t))}function k(M,I,G){return $+(M+I)/(2*t)+G}function B(M,I,G){return u+M+.0053*e(I)-.0069*e(2*G)}function j(M,I,G){return o((e(M)-e(I)*e(G))/(i(I)*i(G)))}function X(M){var I=a*(134.963+13.064993*M),G=a*(93.272+13.22935*M),q=a*(218.316+13.176396*M)+6.289*a*e(I),Z=5.128*a*e(G),K=385001-20905*i(I);return{ra:v(q,Z),dec:w(q,Z),dist:K}}return F.getTimes=function(M,I,G){var q=a*-G,Z=a*I,K=R(y(M),q),Q=k(0,q,K),de=E(Q),Ae=A(de),st=P(de,Ae),vt=w(st,0),ot=B(Q,de,st);function gt(bt){return B(k(j(bt,Z,vt),q,K),de,st)}function ze(bt){var At=(e(bt)-e(Z)*e(vt))/(i(Z)*i(vt));return At<-1?F.PolarException.MIDNIGHT_SUN:At>1?F.PolarException.POLAR_NIGHT:F.PolarException.NORMAL}var ue,xt,ve,De,tt,mt={solarNoon:m(ot),nadir:m(ot-.5),polarException:F.PolarException.NORMAL};for(ue=0,xt=D.length;ue<xt;ue+=1)tt=ot-((De=gt((ve=D[ue])[0]*a))-ot),mt[ve[1]]=m(tt),mt[ve[2]]=m(De);return mt.polarException=ze(D[0][0]*a),mt},F.getMoonPosition=function(M,I,G){var q=a*-G,Z=a*I,K=y(M),Q=X(K),de=S(K,q)-Q.ra,Ae=T(de,Z,Q.dec);return Ae+=.017*a/r(Ae+10.26*a/(Ae+5.1*a)),{azimuth:x(de,Z,Q.dec),altitude:Ae,distance:Q.dist}},F.getMoonFraction=function(M){var I=y(M),G=N(I),q=X(I),Z=149598e3,K=o(e(G.dec)*e(q.dec)+i(G.dec)*i(q.dec)*i(G.ra-q.ra)),Q=s(Z*e(K),q.dist-Z*i(K));return(1+i(Q))/2},F},(iie=tie())!==void 0&&(eie.exports=iie);const zb=MR(CG.exports),Ma={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};let _M=class{constructor(e,i){this.direct=e,this.ambient=i}};function nqe(t,e,i,r,n,s){oe(s.ambient.color,1,1,1),s.ambient.intensity=Ma.global.ambient,oe(s.direct.color,1,1,1),s.direct.intensity=Ma.global.direct;const o=e[2],a=_e((Math.abs(o)-Ma.local.altitude)/(Ma.global.altitude-Ma.local.altitude),0,1);let l;if(s.globalFactor=a,t!=null&&(l=zb.getTimes(t,e[1],e[0])),a<1){let c;if(t!=null)c=hqe(t,l,r);else{const u=j1e(r);c={direct:{intensity:Ma.local.directAtNoon*u.direct,color:Ce(1,1,1)},ambient:{intensity:Ma.local.ambientAtNoon*u.ambient,color:Ce(1,1,1)},timeOfDay:"early afternoon"}}Ui(s.ambient.color,c.ambient.color,s.ambient.color,a),s.ambient.intensity=_t(c.ambient.intensity,s.ambient.intensity,a),Ui(s.direct.color,c.direct.color,s.direct.color,a),s.direct.intensity=_t(c.direct.intensity,s.direct.intensity,a),s.specularStrength=r==="rainy"||r==="snowy"||r==="foggy"?0:1,s.environmentStrength=r==="rainy"?.7:r==="snowy"||r==="foggy"?.75:1}s.noonFactor=t!=null?uqe(t,l):1,t!=null?sqe(t,e,i,s.direct.directionToLightSource):V1e(n,i,s.direct.directionToLightSource)}function V1e(t,e,i){e===Me.Global?ge(cU,t.eye):oe(cU,0,0,1),te(uU,t.viewForward,-1);const r=sL(uU,cU),n=Math.max(r-2*hU,0),s=.85*n/(n+1),o=Math.max(hU,r-hU-s);hu(pie,-o,t.viewRight),Fe(i,uU,pie),ce(i,i,te(dqe,t.viewRight,pqe)),ge(i,i)}function sqe(t,e,i,r){const n=cqe,s=fh(lqe);if(i===Me.Global)zb.getPosition(t,0,0,n),oe(r,0,0,-1),NT(s,s,-n.azimuth),M4(s,s,-n.altitude),Fe(r,r,s);else{const o=Ma.planarDirection,a=o.globalAngles,l=e[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=_e(c,0,1),c<1?(zb.getPosition(t,e[1],e[0],n),n.azimuth=(1-c)*n.azimuth+c*a.azimuth,n.altitude=(1-c)*n.altitude+c*a.altitude):(n.azimuth=a.azimuth,n.altitude=a.altitude),oe(r,0,-1,0),FT(s,s,-n.azimuth),NT(s,s,-n.altitude),Fe(r,r,s)}}function oqe(t,e){if(e===Me.Global)return!0;const i=Ma.planarDirection;return Math.abs(t)<i.localAltitude}const aqe=Ce(.5773502691896258,-.5773502691896258,.5773502691896258);let G1e=class{constructor(){this.ambient={color:Ce(1,1,1),intensity:.55},this.direct={color:Ce(1,1,1),intensity:.55,directionToLightSource:Br(aqe)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const lqe=be(),cqe={azimuth:0,altitude:0};function uqe(t,e){const i=t.valueOf();let r,n;e.polarException===zb.PolarException.MIDNIGHT_SUN?(r=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,n=r+432e6):e.polarException===zb.PolarException.POLAR_NIGHT?(r=i-2,n=i-1):(r=e.sunrise.valueOf(),n=e.sunset.valueOf());const s=r+(n-r)/2;return 1-_e(Math.abs(i-s)/432e5,0,1)}function j1e(t){switch(t){case"disabled":case"sunny":case"cloudy":return new _M(1,1);case"rainy":return new _M(.4,1.2);case"snowy":return new _M(.5,1.3);case"foggy":return new _M(.2,1.6)}}function rie(t,e){const i=(t[0]+t[1]+t[2])/3;t[0]+=(i-t[0])*e,t[1]+=(i-t[1])*e,t[2]+=(i-t[2])*e}const oU=Ce(.01,.01,.01),AG=Ce(1,.6,.5),OG=Ce(1,.98,.98),nie=Ce(1,1,1),aU=Ce(.8,.8,1),RG=Ce(.8,.8,1),PG=Ce(.98,.98,1),sie=Ce(1,1,1),lU=ri(.01,Ma.local.ambientAtNight),MG=ri(Ma.local.directAtTwilight,Ma.local.ambientAtTwilight),$G=ri(.9*Ma.local.directAtNoon,Ma.local.ambientAtNoon),oie=ri(Ma.local.directAtNoon,Ma.local.ambientAtNoon),aie=$G,lie=OG,cie=PG,uie=MG,hie=AG,die=RG;function hqe(t,e,i){const r=t.valueOf();let n,s;e.polarException===zb.PolarException.MIDNIGHT_SUN?(n=r-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,s=n+432e6):e.polarException===zb.PolarException.POLAR_NIGHT?(n=r-2,s=r-1):(n=e.sunrise.valueOf(),s=e.sunset.valueOf());const o=s-n,a=n+o/2,l=o/4,c=a-l,u=a+l,d=.06*o,p=n-d/2,m=n+d/2,y=s-d/2,_=s+d/2,v=Ue(),w=C(),x=C();let T="";if(r<p||r>_)Yn(v,lU),se(w,oU),se(x,aU),T="night";else if(r<m){const A=(r-p)/(m-p);Ku(v,lU,MG,A),Ui(w,oU,AG,A),Ui(x,aU,RG,A),T="sun rising"}else if(r<c){const A=(r-m)/(c-m);Ku(v,MG,$G,A),Ui(w,AG,OG,A),Ui(x,RG,PG,A),T="early morning"}else if(r<a){const A=(r-c)/(a-c);Ku(v,$G,oie,A),Ui(w,OG,nie,A),Ui(x,PG,sie,A),T="late morning"}else if(r<u){const A=(r-a)/(u-a);Ku(v,oie,aie,A),Ui(w,nie,lie,A),Ui(x,sie,cie,A),T="early afternoon"}else if(r<y){const A=(r-u)/(y-u);Ku(v,aie,uie,A),Ui(w,lie,hie,A),Ui(x,cie,die,A),T="late afternoon"}else if(r<_){const A=(r-y)/(_-y);Ku(v,uie,lU,A),Ui(w,hie,oU,A),Ui(x,die,aU,A),T="sun setting"}let S=0;switch(i){case"rainy":case"foggy":S=.8;break;case"snowy":S=.5}S>0&&(rie(w,S),rie(x,S));const E=j1e(i);return{direct:{intensity:v[0]*E.direct,color:w},ambient:{intensity:v[1]*E.ambient,color:x},timeOfDay:T}}const pie=be(),cU=C(),uU=C(),dqe=C(),hU=.25,pqe=.2;let td=class extends Tn.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandlesKey="viewHandles",this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new PN,this._ambientLight=new xY,this._moonLight=new Xve,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView()}get _view(){return this._renderer?.view}get updating(){return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!this._renderer?.updating)}get weatherEnabled(){return this._view?.environment.atmosphereEnabled&&!this._disableWeather&&this._view?.state?.viewingMode===Me.Global&&$T(this._view.spatialReference)}get weatherVisible(){return this.weatherEnabled&&this._renderer?.weatherVisible}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new xo({view:e});const i=()=>this._updateRenderParameters(),r=()=>this._cameraHandler();this.addHandles([le(()=>e.environment.lighting,n=>this._updateLightingHandler(n),qi),le(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,n=>this._lightingDateHandler(n),qi),le(()=>e.stationary,()=>this._interactingStationaryHandler()),le(()=>e.environment.lighting.directShadowsEnabled,i,qi),le(()=>e.qualitySettings.ambientOcclusion,i,qi),le(()=>e.qualitySettings.reflections,i,qi),le(()=>e.spatialReference,()=>this._resetReferencePosition(!0),qi),le(()=>e.environment.weather.type,()=>this._updateLighting(null,mT.Faded),qi),le(()=>this.weatherEnabled,()=>this._updateLighting(null,mT.Faded),qi),le(()=>e.viewingMode,()=>this._resetReferencePosition(!0),Yi),le(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,n=>this._updateCameraTracking(n),Yi),le(()=>e.state.camera,r,Yi),le(()=>this.disableQueries,r)],this._viewHandlesKey),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this.removeHandles(this._viewHandlesKey),this._resetReferencePosition(),this._renderer=Pe(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const i=this._view.environment.lighting;i?.type!=="virtual"&&(i.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const i=this._view.environment.lighting;if(i?.type!=="virtual"){if(e){if(!i.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const r=this._view.spatialReference;if(!n_(r)){const n=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(n))return void this._requestReferencePositionUpdate(n)}if(this._preupdateTracking(e),this._referencePosWGS84Comparable!=null){const n=Lee(this._referencePosWGS84Comparable,fie);n!=null&&(i.autoUpdate(null,n),this._trackingEnabled&&(i.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const i=this._view;if(!i.ready)return;const r=i.stateManager.camera;r&&(this._cameraHandlerClientSide(r,e)||this._cameraHandlerServerSide(r))}_cameraHandlerClientSide(e,i){const r=$T(this._view.spatialReference);if(r&&!n_(this._view.spatialReference))return this._view.environment.lighting.type==="virtual"&&this._updateLighting(),!1;const n=e.position;return this._referencePosWGS84Comparable==null&&(this._referencePosWGS84Comparable=C()),r?VVe(n,this._referencePosWGS84Comparable):oe(this._referencePosWGS84Comparable,n.longitude??0,n.latitude??0,n.z??0),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,i)||this._updateLighting(i),!0}_cameraHandlerServerSide(e){const i=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(i))&&this._requestReferencePositionUpdate(i,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=(i.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e,i=mT.Immediate){const r=this._view;e=e||(r.environment.lighting.type==="virtual"?null:r.environment.lighting.date);const n=this._referencePosWGS84Comparable,s=n!=null?fqe:mqe,o=this.weatherVisible?r.environment.weather.type:"disabled";n!=null?nqe(e,n,r.state.viewingMode,o,r.state.camera,s):r.environment.lighting.type==="virtual"&&V1e(r.state.camera,r.state.viewingMode,s.direct.directionToLightSource);const a=this._mainLight,l=s.direct;te(a.intensity,l.color,l.intensity*Math.PI),se(a.direction,l.directionToLightSource),a.specularStrength=s.specularStrength,a.environmentStrength=s.environmentStrength;const c=this._ambientLight;te(c.intensity,s.ambient.color,s.ambient.intensity);const u=this._moonLight;Ui(u.intensity,yqe,_qe,s.globalFactor);const d=(1-.5*s.globalFactor)*(1-.4*s.noonFactor*(1-s.globalFactor));te(u.intensity,u.intensity,d),se(u.direction,l.directionToLightSource),this._renderer.updateLightSources([a,c,u],s.noonFactor,s.globalFactor,i),this._updateRenderParameters()}_autoUpdateTimezone(e,i=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||e==null)return!1;const r=gqe;r.setTime((i||this._view.environment.lighting.date).getTime());const n=Lee(e,fie);if(n==null)return!1;let s=this._view.environment.lighting.positionTimezoneInfo;if(s.autoUpdated){if(s.hours===n.hours&&s.minutes===n.minutes&&s.seconds===n.seconds)return!1}else s=n;const o=r.getUTCHours()-(n.hours-s.hours),a=r.getUTCMinutes()-(n.minutes-s.minutes),l=r.getUTCSeconds()-(n.seconds-s.seconds);return r.setUTCHours(o),r.setUTCMinutes(a),r.setUTCSeconds(l),!i&&this._view.environment.lighting.autoUpdate(r,n)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const i=this._referencePosWGS84Comparable==null||oqe(this._referencePosWGS84Comparable[2],this._view.state.viewingMode);e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&i,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible,qualitySettings:this._view.qualitySettings})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,i=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!i,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const r=this._referencePosUpdateQuery=V3(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===r){const s=()=>this._referencePosUpdateQuery!==r;return this._doReferencePositionUpdateQuery(s)}}).catch(s=>{s.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===r&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),n=this._referencePosUpdateTimer=V3(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===n&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const i=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(i[0])&&!isNaN(i[1])){const r=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=i[0],this._referencePosWGS84Comparable[1]=i[1],this._referencePosWGS84Comparable[2]=r):this._referencePosWGS84Comparable=[i[0],i[1],r],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let i=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(i*=this._view.mapCoordsHelper.unitInMeters),i>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(i){e._referencePointUpdateInterval=i},set referencePointUpdateDistThreshold(i){e._referencePointUpdateDistThreshold=i},set referencePosUpdateTimer(i){e._referencePosUpdateTimer=i},set referencePointUpdateDelay(i){e._referencePointUpdateDelay=i},set disableWeather(i){e._disableWeather=i}}}};h([f({type:Boolean,readOnly:!0})],td.prototype,"updating",null),h([f()],td.prototype,"disableQueries",void 0),h([f()],td.prototype,"_disableWeather",void 0),h([f()],td.prototype,"weatherEnabled",null),h([f()],td.prototype,"weatherVisible",null),h([f()],td.prototype,"referencePositionWGS84Comparable",null),h([f()],td.prototype,"_renderer",void 0),h([f()],td.prototype,"_referencePosWGS84Comparable",void 0),td=h([z("esri.views.3d.environment.SceneViewEnvironmentManager")],td);const fqe=new G1e,mqe=new G1e,gqe=new Date,fie={hours:0,minutes:0,seconds:0},yqe=Ce(.22,.22,.33),_qe=Ce(.22,.22,.22);var Ar;(function(t){t[t.NONE=0]="NONE",t[t.TILT=1]="TILT",t[t.ALTITUDE=2]="ALTITUDE",t[t.DISTANCE=4]="DISTANCE",t[t.COLLISION=8]="COLLISION",t[t.ALL=15]="ALL",t[t.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(Ar||(Ar={}));var qt;(function(t){t[t.NONE=0]="NONE",t[t.ZOOM=1]="ZOOM",t[t.TUMBLE=2]="TUMBLE",t[t.LOOK_AROUND=3]="LOOK_AROUND",t[t.PAN=4]="PAN",t[t.ASCEND=5]="ASCEND"})(qt||(qt={}));var js;(function(t){t[t.TUMBLE=0]="TUMBLE",t[t.LOOK_AROUND=1]="LOOK_AROUND"})(js||(js={}));function _O(t,e){return(t&e)!=0}function NN(t,e,i,r,n,s){t!==0&&(i?(s.min=Math.min(s.min,e),s.max=Math.max(s.max,e)):r!=null?(s.min-=Math.max(0,(e-s.min)*(1-r)),s.max+=Math.max(0,(e-s.max)*(1-r))):n&&(s.min-=Math.max(0,e-s.min-n),s.max+=Math.max(0,e-s.max-n)))}const d_={selection:Ar.NONE,interactionType:qt.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:js.TUMBLE};function H1e(t,e,i,r){return e=e||t.viewForward,se(r,e),te(r,r,Math.sign(me(e,i))),r}function vqe(t,e,i,r){return Sqe(t,e,i,xqe(r,e,i,!0))}function bqe(t,e,i,r){const n=me(i,he(t,r,e));return ce(t,e,te(t,i,n))}const wqe={dir:C(),len:0,clip:Ue()};function xqe(t,e,i,r){const n=wqe;return t?(i&&r&&(n.len=br(e,i)),se(n.dir,t)):r?(n.len=br(e,i),he(n.dir,i,e),te(n.dir,n.dir,1/n.len)):(he(n.dir,i,e),ge(n.dir,n.dir)),n}function Tqe(t,e,i){const r=me(t,i.dir),n=-ir(t,e);if(n<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return n>0;if((n<0||r<0)&&!(n<0&&r<0))return!0;const s=n/r;return r>0?s<i.clip[1]&&(i.clip[1]=s):s>i.clip[0]&&(i.clip[0]=s),i.clip[0]<=i.clip[1]}function Sqe(t,e,i,r){r.clip[0]=0,r.clip[1]=i?r.len:Number.MAX_VALUE;for(let n=0;n<t.length;n++)if(!Tqe(t[n],e,r))return!1;return!0}function Eqe(t,e,i=d_){const r=DY(t,e,i);if(r===0)return!1;const n=t.renderCoordsHelper,s=n.getAltitude(e.eye)+r,o=H1e(e,i.interactionDirection,Oqe(t,e,Math.sign(r),$qe),Mqe),a=se(Iqe,e.viewForward),l=n.intersectInfiniteManifold(pu(e.eye,o),s,dU);return e.eye=l??n.setAltitude(dU,s,e.eye),e.center=bqe(dU,e.eye,a,e.center),!0}function DY(t,e,i=d_){if(!Cqe(t,i)||!t.state.constraints.altitude)return 0;const r=Rqe(t.state.constraints.altitude,Pqe);Aqe(t,i,r);const n=t.renderCoordsHelper.getAltitude(e.eye),s=_e(n,r.min,r.max)-n;return Math.abs(s)<=1e-6?0:s}function Cqe(t,e){const i=t.state.constraints.altitude;return!(!t.state.isGlobal||!i)&&(e.interactionType!==qt.TUMBLE||!_O(e.selection,Ar.TILT))}function Aqe(t,e,i){const r=e.interactionType;if(r===qt.NONE)return;const{min:n,max:s}=i,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=r===qt.TUMBLE||r===qt.ZOOM,c=DY(t,o),u=c===0?0:t.renderCoordsHelper.getAltitude(o.eye);i.min=n,i.max=s,NN(c,u,l,a,.05*u,i)}function Oqe(t,e,i,r){return t.renderCoordsHelper.worldUpAtPosition(e.eye,r),te(r,r,i),r}function Rqe(t,e){return e.min=t.min,e.max=t.max,e}const Pqe={min:0,max:0},Mqe=C(),$qe=C(),Iqe=C(),dU=C();function NY(t,e,i=d_){if(!t.state.isLocal)return 0;const r=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;vM.min=0,vM.max=r,Dqe(t,i,vM);const n=FY(t,e),s=vM.max-n;return s>=-1e-6?0:s}function Lqe(t,e,i=d_){const r=NY(t,e,i);if(r===0)return!1;const n=t.pointsOfInterest.surfaceOrigin;if(!n.renderLocation)return!1;const s=FY(t,e)+r,o=se(Fqe,e.eye),a=H1e(e,i.interactionDirection,Nqe(e,n.renderLocation,zqe),Uqe);if(!O_(N0e(n.renderLocation,s),pu(e.eye,a),bM))return!1;e.eye=bM;const l=he(kqe,e.eye,o);e.center=ce(bM,e.center,l);const c=t.renderCoordsHelper.getAltitude(e.center),u=t.renderCoordsHelper.intersectInfiniteManifold(e.ray,c,bM);return u!=null&&(e.center=u),!0}function Dqe(t,e,i){const r=e.interactionType;if(r===qt.NONE)return;const{min:n,max:s}=i,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=r===qt.ZOOM||r===qt.PAN,c=NY(t,o),u=c===0?0:FY(t,o);i.min=n,i.max=s,NN(c,u,l,a,.05*u,i)}function FY(t,e){const i=t.pointsOfInterest.surfaceOrigin;return i.renderLocation?br(e.eye,i.renderLocation):0}function Nqe(t,e,i){return Ng(i,t.eye,e)}const vM={min:0,max:0},Fqe=C(),kqe=C(),Uqe=C(),zqe=C(),bM=C();function WS(t,e,i=sh.EYE){const r=t.state.constraints;if(!r.collision.enabled)return!1;const n=wF(t,e.eye),s=t.renderCoordsHelper.getAltitude(e.eye),o=n+r.collision.elevationMargin;if(s>=o)return!1;const a=we(e.eye);if(he(wM,e.center,e.eye),e.eye=t.renderCoordsHelper.setAltitude(Bqe,o,e.eye),i===sh.EYE_AND_CENTER)e.center=ce(wM,e.eye,wM);else if(i===sh.EYE_AND_CENTER_SCALE){const l=(a-s+o)/a;e.center=te(wM,e.center,l)}return!0}var sh;(function(t){t[t.EYE=0]="EYE",t[t.EYE_AND_CENTER=1]="EYE_AND_CENTER",t[t.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(sh||(sh={}));const wM=C(),Bqe=C();function p_(t,e,i){t.worldUpAtPosition(e,mie),he(pU,i,e);const r=we(pU);return r===0?0:xs(me(pU,mie)/r)}const mie=C(),pU=C();function q1e(t,e,i=d_,r=!0){ME.eyeCenterDistance=0,ME.requiresTwoSteps=!1;const n=kY(t,e,i,void 0,ME);if(n===0)return!1;switch(hu(xM,-n,e.viewRight),i.tiltMode){case js.LOOK_AROUND:Fe(m0,e.viewForward,xM),te(m0,m0,ME.eyeCenterDistance),e.center=ce(xy,e.eye,m0);break;case js.TUMBLE:he(m0,e.center,e.eye),Fe(m0,m0,xM),e.eye=he(xy,e.center,m0);break;default:i.tiltMode}return e.up=Fe(xy,e.up,xM),!ME.requiresTwoSteps||!r||q1e(t,e,i,!1)}function kY(t,e,i=d_,r=d_,n){if(!t.state.constraints.tilt)return 0;const s=e.distance,o=t.state.constraints.tilt(s,Jqe);return Zqe(t,i,o),r.interactionType===qt.TUMBLE&&_O(r.selection,Ar.ALTITUDE)&&W1e(t,r.interactionStartCamera,o),i.tiltMode===js.LOOK_AROUND||r.tiltMode===js.LOOK_AROUND?Gqe(t,e,o,n):Vqe(t,e,o)}function Vqe(t,e,i){const r=p_(t.renderCoordsHelper,e.center,e.eye),n=r-_e(r,i.min,i.max);return vO(n)?n:0}function Gqe(t,e,i,r){switch(r&&(r.requiresTwoSteps=!1),t.viewingMode){case"global":return Hqe(t,e,i,r);case"local":return jqe(t,e,i,r)}}function jqe(t,e,i,r){const n=p_(t.renderCoordsHelper,e.center,e.eye),s=_e(n,i.min,i.max),o=n-s;if(!vO(o))return 0;if(r){const a=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=t.renderCoordsHelper.getAltitude(e.eye)-a,c=Math.cos(s);Math.abs(c)>1e-4?r.eyeCenterDistance=l/c:r.eyeCenterDistance=e.distance}return o}function Hqe(t,e,i,r){const n=qqe(t,e,Kqe),s=_e(n.tiltAtCenter,i.min,i.max);if(!vO(n.tiltAtCenter-s))return 0;let o,a;return n.centerIsOnSurface?(o=Wqe(n),a=Yqe(n,o)):(o=n.constraints.clampTilt(n.eyeCenterDistance,n.tiltAtCenter),r&&o<Math.PI/2&&(r.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=Xqe(n,o)),r&&(r.eyeCenterDistance=IG(n,o)),a}function qqe(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,n=r+Fi(t.spatialReference).radius,s=t.renderCoordsHelper.intersectManifold(e.ray,r,xy);return i.eyeCenterDistance=e.distance,i.centerIsOnSurface=!1,s!=null?(i.eyeCenterDistance=br(e.eye,s),i.tiltAtCenter=p_(t.renderCoordsHelper,s,e.eye),i.centerIsOnSurface=!0):t.state.isLocal?i.tiltAtCenter=p_(t.renderCoordsHelper,e.center,e.eye):(BS(lF(cF,n),e.ray,xy),i.eyeCenterDistance=br(e.eye,xy),i.tiltAtCenter=xs(-me(e.viewForward,ge(xy,xy)))),i.radius=n,i.eyeRadius=we(e.eye),i.constraints=t.state.constraints,i}function vO(t){return Math.abs(t)>1e-9}function Wqe(t){const{constraints:e,eyeCenterDistance:i,tiltAtCenter:r}=t;let n=r,s=e.clampTilt(i,r);const o=IG(t,s);if(e.clampTilt(o,r)===s)return s;let a=0;for(;a<10&&vO(s-n);){const l=(n+s)/2,c=IG(t,l);vO(e.clampTilt(c,l)-l)?n=l:s=l,a++}return s}function IG(t,e){if(!t.centerIsOnSurface)return t.eyeCenterDistance;const i=Math.PI-_e(e,0,Math.PI),r=dh(t.radius/t.eyeRadius*Math.sin(i)),n=Math.PI-i-r,s=Math.sin(n)/Math.sin(i);if(t.eyeRadius<t.radius&&s>1){const o=Math.PI-r,a=Math.PI-i-o;return Math.sin(a)/Math.sin(i)*t.eyeRadius}return s*t.eyeRadius}function Yqe(t,e){const i=dh(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter)),r=dh(t.radius/t.eyeRadius*Math.sin(e));return t.eyeRadius>t.radius?i-r:r-i}function Xqe(t,e){return t.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function Zqe(t,e,i){if(e.interactionType===qt.NONE)return;const{interactionStartCamera:r,interactionFactor:n}=e;if(!r)return;const{min:s,max:o}=i,a=kY(t,r,d_,e),l=a===0?0:p_(t.renderCoordsHelper,r.center,r.eye);i.min=s,i.max=o,e.interactionType===qt.TUMBLE?(_O(e.selection,Ar.ALTITUDE)&&W1e(t,r,i),NN(a,l,!0,n,gie,i)):NN(a,l,!1,n,gie,i)}function W1e(t,e,i){const r=t.state.constraints;if(t.state.isLocal||!r.altitude||!e)return;const n=Oo(e.center),s=Math.sqrt(n),o=e.distance,a=Fi(t.spatialReference).radius,l=r.altitude.min+a,c=r.altitude.max+a,u=(l*l-o*o-n)/(-2*s*o),d=(c*c-o*o-n)/(-2*s*o);i.min=Math.max(i.min,Math.min(Math.PI-xs(d),i.max)),i.max=Math.min(i.max,Math.PI-xs(u))}const m0=C(),xM=be(),xy=C(),gie=Rt(5),Jqe={min:0,max:0},Kqe={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},ME={eyeCenterDistance:0,requiresTwoSteps:!1},Qqe=t=>t,zF=t=>t*t,UY=t=>1-zF(1-t),eWe=t=>t<.5?zF(2*t)/2:(UY(2*(t-.5))+1)/2,zY=t=>t*t*t,Y1e=t=>1-zY(1-t),X1e=t=>t<.5?zY(2*t)/2:(Y1e(2*(t-.5))+1)/2,BY=t=>t*t*t*t,Z1e=t=>1-BY(1-t),tWe=t=>t<.5?BY(2*t)/2:(Z1e(2*(t-.5))+1)/2,VY=t=>t*t*t*t*t,J1e=t=>1-VY(1-t),iWe=t=>t<.5?VY(2*t)/2:(J1e(2*(t-.5))+1)/2,GY=t=>1-Math.cos(t*Math.PI/2),K1e=t=>1-GY(1-t),rWe=t=>t<.5?GY(2*t)/2:(K1e(2*(t-.5))+1)/2,jY=t=>2**(10*(t-1)),$R=t=>1-jY(1-t),nWe=t=>t<.5?jY(2*t)/2:($R(2*(t-.5))+1)/2,HY=t=>-(Math.sqrt(1-t*t)-1),Q1e=t=>1-HY(1-t),sWe=t=>t<.5?HY(2*t)/2:(Q1e(2*(t-.5))+1)/2;function Ch(t){const e=2*(t-Math.sqrt((t-1)*t)),i=e/2/t;return r=>r<i?t*r*r:e*r-e+1}function Ah(t,e){return(i,r)=>i<e?e*t(i/e,r):1-t((1-i)/(1-e),r)*(1-e)}const oWe=Ah(Ch(1),1),aWe=Ah(Ch(1),0),ebe=Ah(Ch(1),.5),lWe=Ah(Ch(2),1),cWe=Ah(Ch(2),0),uWe=Ah(Ch(2),.5),hWe=Ah(Ch(3),1),dWe=Ah(Ch(3),0),pWe=Ah(Ch(3),.5),fWe=Ah(Ch(4),1),mWe=Ah(Ch(4),0),gWe=Ah(Ch(4),.5),yWe={linear:Qqe,"in-quad":zF,"out-quad":UY,"in-out-quad":eWe,"in-coast-quad":oWe,"out-coast-quad":aWe,"in-out-coast-quad":ebe,"in-cubic":zY,"out-cubic":Y1e,"in-out-cubic":X1e,"in-coast-cubic":lWe,"out-coast-cubic":cWe,"in-out-coast-cubic":uWe,"in-quart":BY,"out-quart":Z1e,"in-out-quart":tWe,"in-coast-quart":hWe,"out-coast-quart":dWe,"in-out-coast-quart":pWe,"in-quint":VY,"out-quint":J1e,"in-out-quint":iWe,"in-coast-quint":fWe,"out-coast-quint":mWe,"in-out-coast-quint":gWe,"in-sine":GY,"out-sine":K1e,"in-out-sine":rWe,"in-expo":jY,"out-expo":$R,"in-out-expo":nWe,"in-circ":HY,"out-circ":Q1e,"in-out-circ":sWe};function $n(t,e,i=wWe,r=e){r!==e&&r.copyFrom(e),r.computeUp(t.state.viewingMode);let n=!1;for(let a=0;a<xWe;a++){let l=0;for(const c of bWe)if(_O(i.selection,c.type)){const u=Math.abs(c.error(t,r,i));c.apply(t,r,i)&&(n=!0,l+=u)}if(l===0)break}const s=_O(i.selection,Ar.COLLISION),o=_We(i.interactionType,t);return s&&WS(t,r,o)&&(n=!0),n&&r.computeUp(t.state.viewingMode),n}function _We(t,e){switch(t){case qt.PAN:return sh.EYE_AND_CENTER;case qt.ASCEND:return e.state.isGlobal?sh.EYE_AND_CENTER_SCALE:sh.EYE_AND_CENTER;default:return sh.EYE}}function xd(t){const e=Math.min(1,t/150);return X1e(e)}function vWe(t,e,i){return kY(t,e,i)*e.distance}const bWe=[{type:Ar.TILT,error:vWe,apply:q1e},{type:Ar.ALTITUDE,error:DY,apply:Eqe},{type:Ar.DISTANCE,error:NY,apply:Lqe}],wWe={selection:Ar.ALL,interactionType:qt.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:js.TUMBLE},xWe=5,mc=C(),Sl=C(),g0=C(),ko=C(),Q_=C(),TWe=C(),gc={upward:Ce(0,0,1),forward:Ce(0,1,0),sideway:Ce(1,0,0)},yie=Hr();let _ie=class{constructor(e=Me.Global){this.viewingMode=e,this.center=C(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=Br(gc.forward)}pixelsPerPanAtZoom(e){return this.size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this.size/2/(this._zoomToPanScale*e)}pixelsPerRotateAtZoom(){const e=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/e}compareTo(e,i){if(i||(i={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===Me.Global){const s=(we(this.center)+we(e.center))/2;i.pan=sL(this.center,e.center)*s}else i.pan=br(this.center,e.center);let r=Math.abs(e.yaw-this.yaw);r>=Math.PI&&(r=2*Math.PI-r);const n=Math.abs(e.pitch-this.pitch);return i.rotate=Math.max(r,n),i.sourceZoom=this.distance,i.targetZoom=e.distance,i}interpolate(e,i,r){this.viewingMode===Me.Global?BUe(e.center,i.center,r.pan,this.center):Ui(this.center,e.center,i.center,r.pan),this.distance=isFinite(i.distance)?_t(e.distance,i.distance,r.zoom):e.distance,this.pitch=_t(e.pitch,i.pitch,r.rotate);let n=e.yaw;const s=i.yaw;Math.abs(s-n)>=Math.PI&&(n+=2*(n<s?1:-1)*Math.PI),this.yaw=_t(n,s,r.rotate)}copyFrom(e){se(this.center,e.center),this.pitch=e.pitch,this.yaw=e.yaw,this.distance=e.distance,se(this.lookAtDirection,e.lookAtDirection),this.size=e.size,this.copyFromCommon(e),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const i=this._lookAtOrientation(e.center,yie);se(this.center,e.center),he(ko,e.center,e.eye),Zl(ko,ko,i),Zl(Q_,e.up,i),this.distance=we(ko),this.distance!==0&&(ko[0]/=this.distance,ko[1]/=this.distance,ko[2]/=this.distance),this.pitch=this._eyeUpToPitch(ko),this.yaw=this._eyeUpToYaw(ko,Q_),this.size=Math.sqrt(e.width*e.width+e.height*e.height),this.copyFromCommon(e)}copyFromCommon(e){this.fov=e.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(e){const i=this._lookAtOrientation(this.center,yie);yh(i,i),this._axisAngleVec3(gc.sideway,this.pitch-Math.PI/2,gc.forward,ko),this._axisAngleVec3(gc.upward,this.yaw,ko),this._axisAngleVec3(gc.sideway,this.pitch-Math.PI/2,gc.upward,Q_),this._axisAngleVec3(gc.upward,this.yaw,Q_),te(ko,ko,this.distance),Zl(ko,ko,i),Zl(Q_,Q_,i),e.center=this.center,e.eye=he(ko,this.center,ko),e.up=Q_}_axisAngleVec3(e,i,r,n=r){const s=Math.cos(i),o=Math.sin(i);return te(mc,r,s),nt(Sl,e,r),te(Sl,Sl,o),te(g0,e,(1-s)*me(e,r)),ce(n,ce(n,mc,Sl),g0)}_lookAtOrientation(e,i=Hr()){return this._upAtLookAt(e,g0),nt(mc,this.lookAtDirection,g0),ge(mc,mc),mc[0]===0&&mc[1]===0&&mc[2]===0&&se(mc,gc.sideway),nt(Sl,g0,mc),ge(Sl,Sl),i[0]=mc[0],i[1]=Sl[0],i[2]=g0[0],i[3]=mc[1],i[4]=Sl[1],i[5]=g0[1],i[6]=mc[2],i[7]=Sl[2],i[8]=g0[2],i}_upAtLookAt(e,i){return this.viewingMode===Me.Local?se(i,gc.upward):ge(i,e)}_eyeUpToPitch(e){return Math.PI-sL(gc.upward,e)}_eyeUpToYaw(e,i){const r=TWe;return Math.abs(i[2])<.5?(se(r,i),e[2]>0&&te(r,r,-1)):se(r,e),nt(Sl,r,gc.upward),ge(Sl,Sl),sL(gc.sideway,Sl,gc.upward)}};const FN={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};let SWe=class tbe{constructor(e){this._createCamera=e,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:FN.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new tbe(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,i,r){this.source!==e&&this.source.copyFrom(e),this.target!==i&&this.target.copyFrom(i),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=r.desiredScreenFlow!=null?r.desiredScreenFlow:FN.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const i=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/i}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}},EWe=class{constructor(){this.segments=[]}get time(){return this.segments.reduce((e,i)=>e+i.time,0)}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1),e*=this.time;let r=0,n=0;const s=this.definition;for(let o=0;o<this.segments.length;o++){const a=this.segments[o],l=a.definition;if(e<=a.time||o===this.segments.length-1){if(i=this.segmentInterpolateComponentsAt(a,a.time===0?0:e/a.time,i),s.hasPan&&!isNaN(i.pan)&&isFinite(s.compared.pan)?i.pan=(r+l.compared.pan*i.pan)/s.compared.pan:i.pan=1,s.hasRotate&&!isNaN(i.rotate)&&isFinite(s.compared.rotate)?i.rotate=(n+l.compared.rotate*i.rotate)/s.compared.rotate:i.rotate=1,s.hasZoom&&!isNaN(i.zoom)&&isFinite(l.compared.targetZoom)){const c=i.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,u=this.segments[0].definition.compared.sourceZoom,d=this.segments[this.segments.length-1].definition.compared.targetZoom;i.zoom=(c-u)/(d-u)}else i.zoom=1;return i}e-=a.time,r+=l.compared.pan,n+=l.compared.rotate}}segmentInterpolateComponentsAt(e,i,r){return e.interpolateComponentsAt(i,r)}},fU=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,i=e.compared,r=i.sourceZoom,n=i.targetZoom;this._zoomSign=r>n?1:-1,this._panPixelsAtSource=i.pan*e.source.pixelsPerPanAtZoom(r);const s=(e.source.pixelsPerRotateAtZoom(r)+e.target.pixelsPerRotateAtZoom(n))/2;this._rotatePixels=i.rotate*s}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom,{hasZoom:r,hasPan:n,hasRotate:s}=this.definition;let o=0,a=0;r&&(n&&(o=(i/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),s&&(a=this._zoomSign*(Math.log(e/i)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(r&&n&&s){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(r&&n){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(r&&s){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(n&&s){const c=this._panPixelsAtSource/this._rotatePixels,u=1+c;this._panPixelFlow=c/u*l,this._rotatePixelFlow=1/u*l}else n?this._panPixelFlow=l:r?this._zoomPixelFlow=l:s&&(this._rotatePixelFlow=l);this._time=s?this.rotateTime:r?this.zoomTime:n?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,i=e*this._panPixelsAtSource;return Math.log(i*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const i=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom;return(i*(i/r)**-e-i)/(r-i)}return e}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const i=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(i*e*this._time)-1))/(i*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1);const r=this._interpolateComponentsZoom(e),n=this._interpolateComponentsPan(e),s=this._interpolateComponentsRotate(e);return i?(i.zoom=r,i.pan=n,i.rotate=s):i={zoom:r,pan:n,rotate:s},i}};function CWe(t,e,i){const r=e-t.compared.sourceZoom,n=t.halfWindowPanAtZoom(r);return-t.halfWindowSize*(i.ascensionFactor*Math.LN2*t.compared.pan+n)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*n)}function AWe(t,e,i){const r=1/e,n=Math.log(t.compared.sourceZoom*r),s=1/t.desiredPixelFlow,o=1/Math.LN2,a=e-t.compared.sourceZoom,l=1/a,c=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(a))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*r*s*o*l*c-t.halfWindowSize*n*s*o*l+t.halfWindowSize*n*s*o*c/(a*a)}function OWe(t,e,i){const r=e-t.compared.sourceZoom,n=1/r,s=1/e,o=Math.log(t.compared.sourceZoom*s),a=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(r))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*n*(-2*n*s*a+2*n*o+2*s-2*o*a/(r*r)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function RWe(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function PWe(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function MWe(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function $We(t,e,i){return-t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function IWe(t,e,i){return t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function LWe(t,e,i){return-2*t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function DWe(t,e,i){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function NWe(t,e,i){const r=Math.log(e/t.compared.targetZoom),n=1/t.desiredPixelFlow,s=1/Math.LN2,o=-e+t.compared.targetZoom,a=1/o,l=(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*r*n*s*a+t.halfWindowSize*r*n*s*l/(o*o)+t.halfWindowSize*n*s*a*l/e}function FWe(t,e,i){const r=e-t.compared.targetZoom,n=1/r,s=1/e,o=Math.log(e/t.compared.targetZoom),a=(t.halfWindowPanAtZoom(e)+i.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*n*(-2*n*s*a-2*n*o+2*s+2*o*a/(r*r)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function kWe(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function UWe(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function zWe(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function BWe(t){const e=Math.LN2*t.compared.pan,i=t.compared.sourceZoom-t.compared.targetZoom,r=t.halfWindowPanAtZoom(i),n=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*r);return t.compared.sourceZoom<=t.compared.targetZoom?n*(e-r):n*(e+r)}function VWe(t,e){let i=GWe(t,e);const r={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},n=r.ascensionFactor===0,s=r.descensionFactor===0,o=n?RWe:CWe,a=n?PWe:AWe,l=n?MWe:OWe,c=s?kWe:DWe,u=s?UWe:NWe,d=s?zWe:FWe,p=S=>o(t,S,r)+$We(t,S,r)+c(t,S,r),m=S=>a(t,S,r)+IWe(t,S,r)+u(t,S,r),y=S=>l(t,S,r)+LWe(t,S,r)+d(t,S,r);let _=p(i);const v=BWe(t);let w;const x=e.maximumIterations||20,T=e.maximumDistance!=null?e.maximumDistance:1/0;for(w=0;w<x;w++){const E=(m(i)+1e-6)/y(i);if(isNaN(E)||i>=T&&E<0){if(!isFinite(T))return null;i=T,_=p(i);break}if(i-=E,i<t.compared.sourceZoom||i<t.compared.targetZoom)return null;const A=p(i);if(Math.abs(A-_)/_<=.005)break;_=A}return _>v*(1-.3)||i<t.compared.sourceZoom||i<t.compared.targetZoom?null:i}function GWe(t,e){const i=Math.max(t.compared.sourceZoom,t.compared.targetZoom),r=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return r<i?e.maximumDistance!=null?i+(e.maximumDistance-i)/2:1.5*i:e.maximumDistance?Math.min(e.maximumDistance,r):r}let jWe=class extends EWe{constructor(e,i){super(),this._preallocSegments=[new fU,new fU,new fU],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,i)}update(e,i){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();let r=null;i?.apex&&(r=VWe(e,i.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,r==null?this._updateWithoutApex():this._updateWithApex(r,i?.apex)}segmentInterpolateComponentsAt(e,i,r){return r=e.interpolateComponentsAt(i,r),e===this._ascensionSegment?r.zoom=UY(r.zoom):e===this._descensionSegment&&(r.zoom=zF(r.zoom)),r}_updateWithApex(e,i){const[r,n,s]=this._preallocSegments,o=i?.ascensionFactor??.5,a=Math.min(1-o,i?.ascensionFactor!=null&&i.descensionFactor!=null?i.descensionFactor:.5),l=1-o-a;r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.compared.targetZoom=e,r.definition.compared.pan=this.definition.compared.pan*o,r.definition.compared.rotate=this.definition.compared.rotate*o,r.update(),this._ascensionSegment=r,this.segments.push(r),l>0&&(n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.copyFrom(this.definition),n.definition.compared.sourceZoom=e,n.definition.compared.targetZoom=e,n.definition.compared.pan=this.definition.compared.pan*l,n.definition.compared.rotate=this.definition.compared.rotate*l,n.update(),this.segments.push(n)),s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.compared.sourceZoom=e,s.definition.compared.pan=this.definition.compared.pan*a,s.definition.compared.rotate=this.definition.compared.rotate*a,s.update(),this._descensionSegment=s,this.segments.push(s)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const HWe={zoom:0,pan:0,rotate:0};let qWe=class{get time(){return this._time}constructor(e){this._createCamera=e,this._time=0,this.definition=new SWe(e),this.path=new jWe}update(e,i,r){this.definition.update(e,i,r),this.path.update(this.definition,r),this._time=this._applyTimeSettings(uhe(isFinite(this.path.time)?this.path.time:0),r),this._easing=r.easing??(this._time>=1e3?ebe:$R)}cameraAt(e,i){i=i||this._createCamera(),e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const r=this.path.interpolateComponentsAt(e,HWe);return i.interpolate(this.definition.source,this.definition.target,r),i}_normalizedEasing(e){const i=this._easing(0,this._time),r=this._easing(1,this._time);return(this._easing(e,this._time)-i)/(r-i)}_applyTimeSettings(e,i){const r=i.speedFactor!=null?i.speedFactor:1;i.duration!=null?e=i.duration:i.speedFactor!=null&&(e=e/r);const n=i.minDuration!=null?i.minDuration:FN.minDuration/r,s=i.maxDuration!=null?i.maxDuration:FN.maxDuration/r;return Math.min(Math.max(n,e),s)}};const WWe=C();let YWe=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=0,this._animation=new qWe(()=>new _ie(e)),this._current=new _ie(e)}update(e,i,r){const n=this._animation.definition.source,s=this._animation.definition.target,o=he(WWe,i.center,e.center),a=we(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),se(n.lookAtDirection,o),se(s.lookAtDirection,o),n.copyFromRenderCamera(e),s.copyFromRenderCamera(i),this._current.copyFrom(n),this._animation.update(n,s,r),this.currentTime=0,e.almostEquals(i)&&(this.currentTime=this._animation.time)}cameraAt(e,i){return this._animation.cameraAt(e,this._current),i=i||new ht,this._current.copyToRenderCamera(i),i}step(e,i){return this.finished||(this.currentTime=this.currentTime+uhe(e),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,i)}};var Wr;(function(t){t.Ready="ready",t.Rejected="rejected",t.Running="running",t.Stopped="stopped",t.Finished="finished"})(Wr||(Wr={}));let Ym=class extends xe{constructor(e){super(e),this.state=Wr.Ready}get active(){return this.state===Wr.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=Wr.Stopped,!0)}finishController(){this.state=Wr.Finished}get steppingFinished(){return!1}};h([f({constructOnly:!0})],Ym.prototype,"view",void 0),h([f({readOnly:!0})],Ym.prototype,"active",null),h([f()],Ym.prototype,"state",void 0),h([f({readOnly:!0})],Ym.prototype,"isInteractive",null),Ym=h([z("esri.views.3d.state.controllers.CameraController")],Ym);let bO=class extends Ym{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(pi()),this._asyncResult=null),this.state===Wr.Finished||this.state===Wr.Stopped?(d4(e),this.state===Wr.Finished?e.resolve():e.reject(pi())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=Wr.Running,this.viewAnimation!=null&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){this.viewAnimation==null||this.state!==Wr.Ready&&this.state!==Wr.Running||(this.viewAnimation.state===sS.State.FINISHED?this.finish():this.viewAnimation.state===sS.State.STOPPED&&(this.state=Wr.Stopped))}onControllerEnd(){this.viewAnimation==null||this.viewAnimation.done||(this.state===Wr.Finished?this.viewAnimation.finish():this.state===Wr.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===Wr.Finished?this._asyncResult.resolve():this._asyncResult.reject(pi()))}finish(){this.finishController()}};bO=h([z("esri.views.3d.state.controllers.AnimationController")],bO);let rg=class extends bO{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new YWe(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new sS}get isInteractive(){return this.mode==="interaction"}begin(e,i){this._hasTarget=!0;const r=this.animationSettings(i);TM.copyFrom(this.view.state.camera);const n=_h(this.view.state.viewingMode);this.intersectionHelper.intersectRay(TM.ray,n,vie)&&(TM.center=vie),this.animation.update(TM,e,r),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,i){this._hasTarget&&this.animation.step(e,i)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?yWe[e.easing]:e.easing}}};h([f({constructOnly:!0})],rg.prototype,"mode",void 0),h([f({readOnly:!0})],rg.prototype,"isInteractive",null),rg=h([z("esri.views.3d.state.controllers.PointToPointAnimationController")],rg);const TM=new ht,vie=C();function BF(t=ZWe){return[t[0],t[1],t[2],t[3]]}function wO(t,e){return XWe(t[0],t[1],t[2],e,SW.get())}function XWe(t,e,i,r,n=BF()){return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n}function qY(t,e,i){return nt(i,t,e),ge(i,i),i[3]=aF(t,e),i}const ZWe=[0,0,1,0];function TMt(t,e,i=_s()){return WY(t,Ed(e),i),ge(i.direction,i.direction),i}function WY(t,e,i){return JWe(t,t.screenToRender(e,Le.get()),i)}function JWe(t,e,i){const r=Yn(Le.get(),e);if(r[2]=0,!t.unprojectFromRenderScreen(r,i.origin))return null;const n=Yn(Le.get(),e);n[2]=1;const s=t.unprojectFromRenderScreen(n,Le.get());return s==null?null:(he(i.direction,s,i.origin),i)}function YS(t,e,i){return YY(t,t.screenToRender(e,Le.get()),i)}function YY(t,e,i){se(i.origin,t.eye);const r=oe(Le.get(),e[0],e[1],1),n=t.unprojectFromRenderScreen(r,Le.get());return n==null?null:(he(i.direction,n,i.origin),i)}function XY(t,e,i,r){const n=YS(e,i,KWe);return O_(t,n,r)}const KWe=_s();var cS;(function(t){t[t.Ellipsoid=0]="Ellipsoid",t[t.Silhouette=1]="Silhouette"})(cS||(cS={}));const ibe=30,kN=[1,3e8],VF=80,rbe=8,nbe=200,sbe=1508e5,obe=5,abe=50,QWe=5,eYe=10,mU=90,mw={exclude:new Set([wy])};function nb(t,e,i){return i[0]=e[0]/(t.fullWidth/t.pixelRatio),i[1]=e[1]/(t.fullHeight/t.pixelRatio),i}function LG(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function f_(t,e,i){const r=hu(EW.get(),i[3],i);r==null||yq(r,zr)||(he(ji,t.eye,e),Fe(ji,ji,r),t.eye=ce(ji,ji,e),he(ji,t.center,e),Fe(ji,ji,r),t.center=ce(ji,ji,e),t.up=Fe(ji,t.up,r))}function tYe(t,e,i,r){return aw(t,WY(e,i,KY),r)}function DG(t,e,i,r){return aw(t,YS(e,i,KY),r)}function ZY(t,e,i,r){const n=Le.get();let s=1-i;he(n,e,t.eye);const o=we(n);let a=o*(1-s);s>=0&&a<r&&(a=r,s=-(a-o)/o),Math.abs(o-a)<1e-6||(te(n,n,s),t.eye=ce(ji,t.eye,n),t.center=Ui(ji,t.center,e,s))}function lbe(t,e,i){e.getScreenCenter(bie),XY(t,e,bie,ji)&&(e.center=ji);const r=e.distance,n=r*i;if(Math.abs(r-n)<1e-6)return;const s=te(Le.get(),e.viewForward,n);e.eye=he(ji,e.center,s)}const bie=Zr();function gU(t,e){oe(e,0,0,0);for(const i of t)ce(e,e,i);te(e,e,1/t.length)}function PL(t,e,i,r){return Math.sin(t/we(e))*(i+r.radius)}function wie(t,e,i,r){return PL(Math.PI/2,e,i,r)+(t-Math.PI/2)}var Bs;(function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"})(Bs||(Bs={}));const xie={Elevation:3e4,Angle:Rt(16)},SM={Pole:.95,Angle:Rt(18),Tilt:45},cbe=Rt(80);function ube(t,e,i,r,n,s){const o=C(),a=xn();let l=!0,c=!0;return t.intersectScreen(i,o,s)?a[3]=we(o):(c=!1,e.aboveGround&&n!==cS.Ellipsoid?a[3]=Math.max(we(e.center),.9*r.radius):a[3]=we(e.eye)-e.relativeElevation,n===cS.Silhouette?xO(a,e,i,o):l=XY(a,e,i,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function GF(t,e,i){return we(t.eye)-i.radius>xie.Elevation?Bs.Horizontal:(YS(t,e,Pie),-Math.sign(t.relativeElevation)*(.5*Math.PI+aF(t.eye,Pie.direction))<xie.Angle?Bs.Vertical:Bs.Horizontal)}function hbe(t,e,i){he(yU,i,e),t.eye=he(ji,t.eye,yU),t.center=he(ji,t.center,yU)}const yU=C();function xO(t,e,i,r){const n=YS(e,i,KY);return n!=null&&(BS(t,n,EM),O_(t,n,r)?!(bs(EM,n.origin)<bs(r,n.origin))||(se(r,EM),!1):(he(Xw,e.eye,e.center),ge(Xw,Xw),G0e(Xw,-me(ge(Xw,Xw),EM),Tie),aw(Tie,n,r),!1))}const EM=C(),Xw=C(),Tie=Ti();function dbe(t,e,i,r,n,s){let o=0;if(nt(BN,t,e),he(RM,t,e),we(t)<=n||!r.aboveGround){nt(i,RM,r.eye);const a=me(t,e)/(we(t)*we(e));if(a<.9999)o=xs(a);else{const c=we(nt(C(),t,e))/(we(t)*we(e));o=dh(c)}const l=Math.cos(_e(i_.normalize(Rt(s)),0,cbe));o=-o-Math.max(0,we(e)-n)/(l*n)}else he(Sie,r.eye,r.center),nt(i,RM,Sie),o=-we(RM)/n;return ge(i,i),te(i,i,we(BN)),o}const Sie=C();function Eie(t,e,i,r){let n,s;const o=Math.cos(_e(i_.normalize(Rt(r)),0,cbe));return n=e>i?-(e-i)/(o*i):e<-i?Math.PI-(e+i)/(o*i):xs(e/i),s=t>i?-(t-i)/(o*i):t<-i?Math.PI-(t+i)/(o*i):xs(t/i),(s-n)*i}function iYe(t,e,i,r,n,s,o,a,l,c){const u=Eie(t[2],e[2],s[3],a),d=l?Eie(t[0],e[0],s[3],180):e[0]-t[0],p=Math.sin(o)*d-Math.cos(o)*u,m=Math.cos(o)*d+Math.sin(o)*u;ge(ji,n);const y=l?p/Math.sqrt(Math.abs(s[3]**2-me(i,ji)**2)):p/s[3],_=m/Math.sqrt(Math.abs(s[3]**2-me(i,r)**2));si(c,y,_)}function pbe(t,e,i,r,n,s,o,a,l,c){nt(BN,t,e),t7(s.up,s.eye,CM,AM,OM),t7([0,0,1],s.eye,ug,Yy,ybe),se(i,Yy),se(r,ug),ge(i,i),te(i,i,we(BN)),nee(t,ge(AM,AM),ge(OM,OM),ge(CM,CM),Cie),nee(e,AM,OM,CM,Aie),iYe(Cie,Aie,t,ug,Yy,o,a,l,c,n)}function rYe(t,e,i,r,n,s,o){hu(UN,n,r),hu(zN,o,s),Di(j2,UN,zN),he(e,t,i),Fe(e,e,j2),ce(e,e,i)}function fbe(t,e,i,r,n,s){hu(UN,r,i),hu(zN,s,n),Di(j2,UN,zN),he(ji,t.eye,e),Fe(ji,ji,j2),t.eye=ce(ji,ji,e),he(ji,t.center,e),Fe(ji,ji,j2),t.center=ce(ji,ji,e),he(ji,t.up,e),Fe(ji,ji,j2),t.up=ce(ji,ji,e)}function JY(t,e,i,r,n,s){return(Math.abs(r)>Math.PI-SM.Angle||Math.abs(r)<SM.Angle)&&(Math.abs(t[2])<i*SM.Pole||Math.abs(e)>i)&&s.aboveGround&&n<SM.Tilt}function mbe(t,e,i,r,n,s){if(s)qY(i,r,Oie),f_(e,t,Oie);else{const o=dbe(i,r,Rie,e,t[3],n);f_(e,t,wO(Rie,o))}}function gbe(t,e,i,r,n,s,o){const a=o?20:1,l=1e-12;let c,u;se(ev,r),PM.copyFrom(e);for(let d=0;d<a&&bs(i,ev)>l&&(c=bs(i,ev),pbe(i,ev,Yy,ug,$E,PM,t,n,s,o),fbe(PM,t,ug,$E[1],Yy,$E[0]),rYe(ev,ev,t,ug,$E[1],Yy,$E[0]),u=bs(i,ev),u<c||d===0);d++)e.copyFrom(PM)}function nYe(t,e,i,r,n,s,o){JY(i,me(e.up,i),t[3],-i_.normalize(Rt(n)),s,e)?gbe(t,e,i,r,-i_.normalize(Rt(n)),s,o):mbe(t,e,i,r,s,o)}function sYe(t,e,i,r,n,s){const{eye:o}=t;t7([0,0,1],o,ug,Yy,ybe);const a=e.translation[0]*i.pan,l=n.mode==="zoom"?0:e.translation[1]*i.pan,c=Math.max(Math.sqrt(Math.abs(1-me(t.center,ug)**2/we(t.center)**2)),.5),u=(Math.sin(s)*l+Math.cos(s)*a)/c,d=-Math.cos(s)*l+Math.sin(s)*a;switch(Jl(r.pan.matrix,r.pan.matrix,u,ug),r.pan.enabled=!0,n.mode){case"pan":Jl(r.pan.matrix,r.pan.matrix,d,Yy),r.pan.enabled=!0;break;case"zoom":r.zoom=-e.translation[1]*i.zoom}}function oYe(t,e,i,r,n){const{eye:s,viewRight:o}=t,a=nt(Le.get(),o,s),l=e.translation[0]*i.pan;switch(l!==0&&(Jl(r.pan.matrix,r.pan.matrix,-l,a),r.pan.enabled=!0),n.mode){case"pan":{const c=e.translation[1]*i.pan;c!==0&&(Jl(r.pan.matrix,r.pan.matrix,c,o),r.pan.enabled=!0);break}case"zoom":r.zoom=-e.translation[1]*i.zoom}}function aYe(t,e,i,r,n,s,o,a,l){JY(t.center,me(t.up,t.center),we(t.center),-i_.normalize(Rt(s)),o,e)?sYe(e,i,r,a,l,-i_.normalize(Rt(n))):oYe(e,i,r,a,l)}const ug=C(),Yy=C(),ybe=C(),CM=C(),AM=C(),OM=C(),Cie=C(),Aie=C(),$E=Ue(),Oie=BF(),UN=be(),zN=be(),j2=be(),ev=C(),ji=C(),RM=C(),PM=new ht,BN=C(),Rie=C(),KY={origin:C(),direction:C()},Pie={origin:C(),direction:C()},Mie=.6,_U=4,lYe=60;let VN=class extends rg{constructor(){super(...arguments),this._zoomLocation=C(),this._tmpCamera=new ht,this._tmpViewDir=C(),this._tmpRayDir={origin:C(),direction:C()},this._targetOnSphere=C(),this._tmpCenter=C(),this._constraintOptions={selection:Ar.ALL_EXCEPT_COLLISION,interactionType:qt.ZOOM,interactionFactor:null,interactionStartCamera:new ht,interactionDirection:null,tiltMode:js.TUMBLE},this._sphere=xn()}initialize(){this._intersector=_h(this.view.state.viewingMode)}zoomStep(e,i){if(!this.active)return;const r=this.view.state,{interactionStartCamera:n}=this._constraintOptions;n&&(this.animation.finished?n.copyFrom(r.camera):this.animation.cameraAt(1,n));let s=!1,o=!1;this.intersectionHelper.intersectScreen(i,this._zoomLocation,this.view.map.ground.opacity===0?mw:{})&&(s=e>0,o=!0),this._tmpCamera.copyFrom(r.camera),s?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:se(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,i,o),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:$R}}_updateCamera(e,i,r,n,s){const o=Fi(this.view.spatialReference),a=GF(e,n,o),l=Math.abs(this.view.camera.position.z);ge($M,e.eye),te($M,$M,-1),YS(e,n,this._tmpRayDir),ge(this._tmpRayDir.direction,this._tmpRayDir.direction);const c=_e(Math.min(rbe,1/Math.abs(me($M,this._tmpRayDir.direction)))*l,nbe,sbe);if(a===Bs.Horizontal){let u=Mie**i;this._sphere[3]=we(r),he(this._tmpViewDir,e.center,e.eye);const d=Math.min(we(this._tmpViewDir),c);let p=d*u;if(u<=1&&p<_U&&(p=_U,u=p/d),Math.abs(d-p)<1e-6)return;const m=we(e.center);if(this._sphere[3]!==m){const y=this._sphere[3]+u*(m-this._sphere[3]);e.center=te(MM,e.center,y/m)}te(this._tmpViewDir,this._tmpViewDir,-u),e.eye=ce(MM,e.center,this._tmpViewDir),$n(this.view,e,this._constraintOptions),bs(r,e.center)>1e-12&&XY(this._sphere,e,n,this._targetOnSphere)&&nYe(this._sphere,e,r,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let u=Mie**Math.abs(i);const d=i>0?1:-1;he(this._tmpViewDir,r,e.eye);const p=we(this._tmpViewDir),m=this.view._stage.renderView.getMinimalDepthForArea(null,n[0],n[1],this.view.state.camera,lYe);let y=m??c;y=s&&i>0?Math.min(y,p):y,te(this._tmpRayDir.direction,this._tmpRayDir.direction,y),ce(r,this._tmpRayDir.origin,this._tmpRayDir.direction);let _=y*u;const v=Math.max(_U,1.01*e.nearFar[0]);if(i>0&&_<v&&(_=v,u=_/y),Math.abs(y-_)<1e-6)return;te(this._tmpRayDir.direction,this._tmpRayDir.direction,d*(1-u)),e.eye=ce(MM,e.eye,this._tmpRayDir.direction),e.center=ce(MM,e.center,this._tmpRayDir.direction)}WS(this.view,e)}};VN=h([z("esri.views.3d.state.controllers.global.ZoomStepController")],VN);const MM=C(),$M=C();let ML;const gT=new Map;async function EMt(t){ML==null&&(ML=pe(()=>import("./VoxelWasmPerSceneView-505557e9.js"),[],import.meta.url));const e=t.view,i=gT.get(e);return i?i.addVoxelLayer(t):(await ML.then(r=>{const n=new r.default({view:e});return gT.set(e,n),n})).addVoxelLayer(t)}function TO(t){return gT.get(t)}function CMt(t){const e=t.view,i=gT.get(e);i&&i.removeVoxelLayer(t)<1&&(gT.delete(e),gT.size===0&&(ML=null))}const cYe=.6,uYe=4,hYe=60;let GN=class extends rg{constructor(){super(...arguments),this._zoomLocation=C(),this._tmpCamera=new ht,this._tmpRayDir=C(),this._tmpCenter=C(),this._constraintOptions={selection:Ar.ALL,interactionType:qt.ZOOM,interactionFactor:null,interactionStartCamera:new ht,interactionDirection:null,tiltMode:js.TUMBLE}}zoomStep(e,i){if(!this.active)return;const r=this.view.state,{interactionStartCamera:n}=this._constraintOptions;n&&(this.animation.finished?n.copyFrom(r.camera):this.animation.cameraAt(1,n)),this._tmpCamera.copyFrom(r.camera);const s=_h(this.view.state.viewingMode);let o=!1;e>0?(o=this.intersectionHelper.intersectScreenFreePointFallback(i,this._zoomLocation,this.view.map.ground.opacity===0?mw:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:se(this._zoomLocation,this._tmpCamera.center);const a=cYe**e;let l=this.view._stage.renderView.getMinimalDepthForArea(TO(this.view),i[0],i[1],this.view.state.camera,hYe);he(IM,this._tmpCamera.eye,this._zoomLocation),ge(IM,IM);const c=_e(Math.min(rbe,1/Math.abs(me(dYe,IM)))*Math.abs(this.view.camera.position.z),nbe,sbe);if(l=l??c,l){const u=C();he(u,this._zoomLocation,this._tmpCamera.eye),(l<we(u)||!o)&&(ge(u,u),ce(this._zoomLocation,this._tmpCamera.eye,te(u,u,l)))}this._updateCamera(this._tmpCamera,a,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:$R}}_updateCamera(e,i,r){he(this._tmpRayDir,r,e.eye);const n=we(this._tmpRayDir);let s=n*i;const o=i<=1,a=Math.max(uYe,1.01*e.nearFar[0]);s!==0&&(o&&s<a&&(s=a,i=s/n),Math.abs(n-s)<1e-6||(te(this._tmpRayDir,this._tmpRayDir,i),e.eye=he($ie,r,this._tmpRayDir),e.center=Ui($ie,e.center,r,1-i),$n(this.view,e,this._constraintOptions)))}};GN=h([z("esri.views.3d.state.controllers.local.ZoomStepController")],GN);const $ie=C(),dYe=Ce(0,0,1),IM=C();function pYe(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}function QY(t,e){if(t.pointerType==="touch")return!1;switch(e){case"primary":return t.button===0;case"secondary":return t.button===2;case"tertiary":return t.button===1}}let fYe=class extends go{constructor(e,i){super(!0),this._view=e,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r))}_handleDoubleClick(e){const i=e.data;if(pYe(i,"primary")){const r=this._view.state.isGlobal?new VN({view:this._view,mode:"animation"}):new GN({view:this._view,mode:"animation"});this._view.state.switchCameraController(r),r.zoomStep(Math.log(.5)/Math.log(.6),Zr(i.x,i.y)),e.stopPropagation()}}};function mYe(t,e,i){return t===Me.Global?new yYe(i):new gYe(e,i)}let gYe=class{constructor(e,i){this._elevationProvider=e,this._referenceEllipsoid=Fi(i),this._unitInMeters=ua(i,this._referenceEllipsoid.metersPerDegree)}compute(e,i,r,n,s){s||(s={near:0,far:0});let o=e[2]*this._unitInMeters;const a=o,l=o-n,c=this._elevationProvider?.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);const u={x:(r=r??new Xi({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-r.xmin,y:r.ymax-r.ymin,z:4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},d=Math.max(u.x,u.y,u.z);he(tv,i,e),Zw[0]=tv[0]>0?r.xmax:r.xmin,Zw[1]=tv[1]>0?r.ymax:r.ymin,Zw[2]=tv[2]>0?d/2:-d/2,he(Zw,Zw,e),ge(tv,tv);const p=1.1*me(Zw,tv)*this._unitInMeters,m=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),y=Math.max(r.xmax-r.xmin,r.ymax-r.ymin),_=y*bYe*this._unitInMeters,v=y*wYe*this._unitInMeters,w=_e((o-v)/(_-v),0,1)**3,x=Math.min(_t(m,p,w),m)*Math.max(Math.log(Math.abs(l)),1);return _be(Math.min(x,Math.max(34064e4,d))/this._unitInMeters,_Ye,this._unitInMeters,s)}},yYe=class{constructor(e){this._referenceEllipsoid=Fi(e)}compute(e,i,r,n,s){s||(s={near:0,far:0});const o=we(e),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,n),c=Math.abs(a-n),u=Math.max(c,Math.abs(a)),d=Math.sqrt(u*(u+2*l)),p=o+this._referenceEllipsoid.radius;return _be(1.2*_t(d,p,uY(u)),_e(2e4-(Math.log(u)-7.983)/9.011*19e3,1e3,2e4),1,s)}};function _be(t,e,i,r){const n=vYe/i;return t/e>n?(r.far=t,r.near=r.far/e):(r.near=n,r.far=r.near*e),r}const _Ye=2e4,vYe=2,bYe=.001,wYe=1e-4,Zw=C(),tv=C();let $L=class extends xe{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const i=this.view.state.camera;e.spatialReference!=null&&Vye(this.view,i,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>WS(this.view,e,sh.EYE_AND_CENTER))}};h([f({constructOnly:!0})],$L.prototype,"view",void 0),$L=h([z("esri.views.3d.state.ElevationCollisionConstraint")],$L);let dA=class extends xe{constructor(e){super(e),this.nearFarHeuristic=mYe(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([le(()=>[this.view.constraints?.clipDistance?.near,this.view.constraints?.clipDistance?.far],()=>this._clipDistanceNearFarChanged()),le(()=>this.view.constraints?.clipDistance?.mode,()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),le(()=>this.view.renderDataExtent,()=>this._updateNearFar(),qi),le(()=>[this.view.constraints?.altitude?.min,this.view.constraints?.altitude?.max],()=>this._updateAltitude(),qi),le(()=>this.view.constraints?.tilt?.max,()=>this._updateTiltMax(),qi),le(()=>this.view.constraints?.tilt?.mode,()=>this._updateTilt(),qi),le(()=>this.view.state?.camera,()=>this._updateTiltAutoMax(),qi),le(()=>[this.view.map?.ground?.navigationConstraint?.type,this.view.state?.constraints?.collision?.enabled],()=>this._updateCollision(),qi)]),this.view.state.isLocal&&this.addHandles(le(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),Zi)),this._updateNearFar(),this.view.state.viewingMode!==Me.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new $L({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){const e=this.view.constraints?.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(i=>this._updateCameraNearFarManual(i,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const i=this.view.constraints&&this.view.constraints.clipDistance;(i?i.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,i):this._updateCameraNearFarAuto(e,i)}_updateCameraNearFarAuto(e,i){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,wF(this.view,e.eye),e),i&&i.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,i){i&&(e.near=i.near,e.far=i.far)}_updateCollision(){const e=this.view.map?.ground?.navigationConstraint?.type,i=!e||e==="stay-above",r=this.view.state.constraints.collision;if(i!==r.enabled){r.enabled=i,i&&this._reapplyConstraints(Ar.COLLISION);const n=this.view.constraints&&this.view.constraints.tilt;n&&n.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==Me.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const i=this.view.state.constraints;i.tilt=i.createConstantMaxTilt(Rt(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const i=this.view.state.constraints;if(i.tilt){const r=i.tilt(this.view.state.camera.distance).max;e.autoUpdate(za(r))}}_updateLocalSurfaceDistance(e){if(e==null)return;let i=Math.max(e.width,e.height);if(i<=0)return;e.zmax!=null&&e.zmin!=null&&(i=Math.max(i,e.zmax-e.zmin));const r=this.view.state,n=3*i/Math.atan(r.camera.fov/2);n!==r.constraints.distance&&(r.constraints.distance=n)}_reapplyConstraints(e=Ar.ALL){this.view.state.updateCamera(i=>$n(this.view,i,{selection:e,interactionType:qt.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:js.TUMBLE}))}};h([f({constructOnly:!0})],dA.prototype,"view",void 0),h([f({readOnly:!0})],dA.prototype,"surfaceCollisionConstraint",void 0),dA=h([z("esri.views.3d.state.ConstraintsManager")],dA);let Ty=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}constructor(e){this.renderCoordsHelper=e,this.frustum=gO(),this._points=Gve(),this.lines=new Array(12),this._origin=C(),this._direction=C(),this._altitude=null;for(let i=0;i<12;i++)this.lines[i]={origin:null,direction:C(),endpoint:null}}update(e){jve(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),se(this._origin,e.eye),se(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let i=0;i<this._points.length;i++)se(this._points[i],e[i]);Hve(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return Uy(this.frustum,e)}intersectsRay(e){return yje(this.frustum,e)}intersectsLineSegment(e,i){return _je(this.frustum,e,i)}intersectsPoint(e){return qve(this.frustum,e)}_updateLines(){const e=this._points;for(let i=0;i<4;i++){const r=i+4;vU(this.lines[i],e[i],e[r]),vU(this.lines[i+4],e[i],i===3?e[0]:e[i+1]),vU(this.lines[i+8],e[r],i===3?e[4]:e[r+1])}}};function vU(t,e,i){t.origin=e,t.endpoint=i,Ng(t.direction,e,i)}Ty.planePointIndices=vje,Ty.nearFarLineIndices=[[We.NEAR_BOTTOM_LEFT,We.FAR_BOTTOM_LEFT],[We.NEAR_BOTTOM_RIGHT,We.FAR_BOTTOM_RIGHT],[We.NEAR_TOP_RIGHT,We.FAR_TOP_RIGHT],[We.NEAR_TOP_LEFT,We.FAR_TOP_LEFT]];let l3=class extends Ym{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=Wr.Running,this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(e){(e.spatialReference==null||Vye(this.view,this.desiredCamera,e.extent,e.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),WS(this.view,e,sh.EYE_AND_CENTER)||this.constraintEnabled||(this.state=Wr.Stopped)})}};h([f({constructOnly:!0})],l3.prototype,"desiredCamera",null),l3=h([z("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],l3);function vbe(t,e,i){const r=Math.sin(t),n=Math.cos(t),s=Math.sin(e),o=Math.cos(e),a=i;return a[0]=-r,a[4]=-s*n,a[8]=o*n,a[12]=0,a[1]=n,a[5]=-s*r,a[9]=o*r,a[13]=0,a[2]=0,a[6]=o,a[10]=s,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function xYe(t,e,i){return vbe(t,e,i),sc(i,i),i}function ic(t,e,i,r){if(t==null||r==null)return!1;const n=K3(t,ffe),s=K3(r,HDe);if(n===s&&!Iie(s)&&(n!==J.UNKNOWN||wn(t,r)))return cR(i,e),!0;if(Iie(s)){const o=I2[n][J.LON_LAT],a=I2[J.LON_LAT][s];return o!=null&&a!=null&&(o(e,0,y0,0),a(y0,0,_0,0),vbe(LM*y0[0],LM*y0[1],i),i[12]=_0[0],i[13]=_0[1],i[14]=_0[2],!0)}if((s===J.WEB_MERCATOR||s===J.PLATE_CARREE)&&(n===J.WGS84||n===J.CGCS2000&&s===J.PLATE_CARREE||n===J.SPHERICAL_ECEF||n===J.WEB_MERCATOR)){const o=I2[n][J.LON_LAT],a=I2[J.LON_LAT][s];return o!=null&&a!=null&&(o(e,0,y0,0),a(y0,0,_0,0),n===J.SPHERICAL_ECEF?xYe(LM*y0[0],LM*y0[1],i):fh(i),i[12]=_0[0],i[13]=_0[1],i[14]=_0[2],!0)}return!1}function Iie(t){return t===J.SPHERICAL_ECEF||t===J.SPHERICAL_MARS_PCPF||t===J.SPHERICAL_MOON_PCPF}const LM=Rt(1),y0=C(),_0=C(),TYe=.66;function bbe(t){return 360-$q.normalize(t)}function jF(t){return $q.normalize(360-t)}function wbe(t,e,i){const r=e.camera;if(r!=null)return SYe(r,zg(t));const{targetGeometry:n}=e;if(n==null)return null;const{camera:s,mode:o}=Tbe(t,e.rotation,i);if(n.type==="point")return CYe(t,e,n,s,o);const a=n.extent;return a==null?null:hL(t,a,s.heading,s.tilt,o)}async function xbe(t,e,i,r){const n=e.camera;if(n!=null)return EYe(n,zg(t),r);const{targetGeometry:s}=e;if(s==null)throw new Error("Viewpoint has no targetGeometry!");const{camera:o,mode:a}=Tbe(t,e.rotation,i);if(s.type==="point")return AYe(t,e,s,o,a,r);const l=s.extent;if(l==null)throw new Error("Target geometry has no extent!");return m_e(t,l,o.heading,o.tilt,a,r)}function SYe(t,e){const i=t.position;let r;try{r=Hf(i,e)}catch{return null}const n=t.clone();return n.position=r.clone(),n}async function EYe(t,e,i){const r=t.position,n=await $f(r,e,{signal:i});Et(i);const s=t.clone();return s.position=n.clone(),s}function Tbe(t,e,i){const r=nS(t,t.state.camera);let n=$o.ADJUST;return e!=null&&(r.heading=bbe(e),n=$o.LOCKED),i!=null&&(r.tilt=i),{camera:r,mode:n}}function CYe(t,e,i,r,n){const s=t.spatialReference;let o;try{o=Hf(i.clone(),s)}catch{return null}const a=e.scale!=null?xF(t,e.scale,o.latitude):t.state.camera.distance;return N9e(t,o,a,r,n)}async function AYe(t,e,i,r,n,s){const o=t.spatialReference,a=await $f(i.clone(),o,{signal:s});Et(s);const l=e.scale!=null?xF(t,e.scale,a.latitude):t.state.camera.distance;return n_e(t,a,l,r,n,s)}function Sbe(t,e,i=null){return i==null&&(i=new oc),iX(t,null,e.clone(),i)}async function Ebe(t,e,i){const r=FYe(t,e);if(!r)throw new W("viewpointutils-create:no-target","Missing target for creating viewpoint");const n=new du({fov:t.camera.fov}),s=new oc({camera:n});if(r.target instanceof oc)return iv(await PYe(t,r.target,r,i,s));if(r.target instanceof du)return iv(await Abe(t,r.target,i,s));const o=r.scale!=null||r.zoom!=null;if(r.target instanceof Xi){const c=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax;return iv(o||c?await NG(t,r,r.target.center,n,i,s):await LYe(t,r,r.target,n,i,s))}const a={boundingBox:vr(),hasZ:!1,screenSpaceObjects:[]},l=o?OYe(t,r):void 0;if(await Cbe(t,r.target,l,a,i),isFinite(a.boundingBox[0])){let c;if(Rd(a.boundingBox,yn),Fc.x=yn[0],Fc.y=yn[1],Fc.z=yn[2],Fc.spatialReference=t.spatialReference,isFinite(Fc.z)&&a.hasZ?c=dW(a.boundingBox):(Fc.z=void 0,c=dDe(hW(a.boundingBox,UYe))),o||c)return iv(await NG(t,r,Fc,n,i,s));const u=kYe(t,a.screenSpaceObjects);return iv(await NYe(t,r,Fc,a.boundingBox,u,n,i,s))}return r.position?iv(await $Ye(t,r,n,s,i)):iv(await IYe(t,r,n,i,s))}function eX(t,e){return e.scale==null&&e.zoom!=null?b_e(t,e.zoom):e.scale}function OYe(t,e){const i=eX(t,e);return i?O8e(i):void 0}function tX(t,e){let i=!1;return e.heading!=null?(t.heading=e.heading,i=!0):e.rotation!=null&&(t.heading=bbe(e.rotation),i=!0),e.tilt!=null&&(t.tilt=e.tilt,i=!0),e.fov!=null&&(t.fov=e.fov),i}function iX(t,e,i,r){const n=t.spatialReference||je.WGS84;return(e=e??Vm(t,i))==null||(r.targetGeometry=Cg(e.center,t.renderSpatialReference,n),r.scale=w_e(t,e),r.rotation=jF(i.heading),r.camera=i),r}async function jN(t,e,i,r){const n=()=>new W("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!e)throw n();e.type==="mesh"&&(e=e.extent);const s=e.spatialReference,o=t.spatialReference,a=t.basemapTerrain.spatialReference;if(!e.hasZ&&t.basemapTerrain){let d;switch(e.type){case"point":d=e;break;case"multipoint":case"polyline":d=e.extent?.center;break;case"extent":d=e.center;break;case"polygon":d=e.centroid}d!=null&&a!=null&&t.elevationProvider!=null?(d=await $f(d,a,{signal:r}),yn[2]=pf(t.elevationProvider,d)??0):yn[2]=0}const l=zYe[e.type],c=new Array;if(l(e,e.hasZ?d=>{c.push([d[0],d[1],d[2]])}:d=>{c.push([d[0],d[1]])},yn),c.length===0)throw n();const u=await $f(new IS({spatialReference:s,hasZ:e.hasZ,hasM:!1,points:c}),o,{signal:r});if(e.hasZ&&(i.hasZ=!0),e.hasZ)for(const[d,p,m]of u.points)yn[0]=d,yn[1]=p,yn[2]=m,Yd(i.boundingBox,yn);else for(const[d,p]of u.points)yn[0]=d,yn[1]=p,Yd(i.boundingBox,yn)}async function RYe(t,e,i,r,n){const s=await hh(t.whenViewForGraphic(e));if(s.ok===!1||s.value==null||!("whenGraphicBounds"in s.value))return void await jN(t,e.geometry,r,n);const o=s.value,a=await hh(o.whenGraphicBounds(e,{minDemResolution:i}));if(a.ok===!1||!a.value)return void await jN(t,e.geometry,r,n);const{screenSpaceObjects:l,boundingBox:c}=a.value;ZT(r.boundingBox,c),l&&l.forEach(u=>{r.screenSpaceObjects.push(u)}),isFinite(c[2])&&(r.hasZ=!0)}async function Cbe(t,e,i,r,n){if(Array.isArray(e)&&e.length===2){const s=e[0],o=e[1];if(typeof s=="number"&&typeof o=="number")return Fc.x=s,Fc.y=o,Fc.z=void 0,Fc.spatialReference=t.spatialReference?.isGeographic?t.spatialReference:je.WGS84,void await jN(t,Fc,r,n)}e&&"map"in e&&typeof e.map=="function"?await Promise.allSettled(e.map(s=>Cbe(t,s,i,r,n))):e instanceof E_?await jN(t,e,r,n):e instanceof Lb&&await RYe(t,e,i,r,n)}async function PYe(t,e,i,r,n){if(e.camera!=null)return Abe(t,e.camera,r,n);n.scale=e.scale,n.rotation=e.rotation,n.targetGeometry=e.targetGeometry!=null?e.targetGeometry.clone():null,n.camera=null,i.heading!=null?n.rotation=jF(i.heading):i.rotation!=null&&(n.rotation=i.rotation);const s=eX(t,i);return s!=null&&(n.scale=s),n.camera=await xbe(t,n,i.tilt,r),n}async function Abe(t,e,i,r){const n=t.spatialReference,s=await $f(e.position,n,{signal:i});return(e=e.clone()).fov=t.camera.fov,e.position=s,iX(t,null,e,r)}async function MYe(t,e,i,r,n,s,o){const a=t.renderSpatialReference;return await vN(e,bU,a,0,{signal:o}),await vN(i,NM,a,0,{signal:o}),s.targetGeometry=new lt(e),n.position=new lt(i),he(HN,bU,NM),TF(t,NM,HN,r.up,n),s.scale=Nb(t,br(NM,bU),s.targetGeometry.latitude),s.rotation=jF(n.heading),s.camera=n,s}async function NG(t,e,i,r,n,s){if(i==null)throw new W("createfromcenter","invalid point");s.targetGeometry=i.clone();const o=hw(t);if(e.position)return MYe(t,s.targetGeometry,e.position,o,r,s,n);if(e.zoomFactor){const l=o.distance/e.zoomFactor,c=te(yn,o.viewForward,-l);o.eye=ce(yn,o.center,c),s.scale=Nb(t,l,i.latitude)}nS(t,o,r);const a=tX(r,e)?$o.LOCKED:$o.ADJUST;if(!e.zoomFactor){const l=eX(t,e);if(l==null){const{renderSpatialReference:c}=t;await vN(i,yn,c,0,{signal:n}),qve(o.frustum,yn)?s.scale=Nb(t,br(o.eye,yn),i.latitude):s.scale=w_e(t,o)}else s.scale=l;s.camera=await r_e(t,s.targetGeometry,s.scale,r,a,n)}return s}async function $Ye(t,e,i,r,n){const s=hw(t);se(HN,s.viewForward),TF(t,s.eye,HN,s.up,wU);const o=t.spatialReference,{position:a}=e;if(a){const l=await $f(a,o,{signal:n});i.position=l}else i.position=new lt;return i.heading=e.heading!=null?e.heading:wU.heading,i.tilt=e.tilt!=null?e.tilt:wU.tilt,iX(t,null,i,r)}async function IYe(t,e,i,r,n){const s=hw(t),{spatialReference:o,renderSpatialReference:a}=t;return NG(t,e,Cg(s.center,a,o),i,r,n)}async function LYe(t,e,i,r,n,s){s.targetGeometry=i.clone();const o=hw(t);nS(t,o,r);const a=tX(r,e)?$o.LOCKED:$o.ADJUST;return s.camera=await m_e(t,i,r.heading,r.tilt,a,n),s}function DYe(t,e,i,r,n){let s=0;i.z!=null?s=i.z:t.basemapTerrain&&t.elevationProvider&&(s=pf(t.elevationProvider,i)),oe(yn,i.x,i.y,s),ic(t.spatialReference,yn,Lie,t.renderSpatialReference),gh(DM,Lie),yh(DM,DM),vr(IE);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let y=0;y<o.length;y++){const _=o[y];let v=r[_[2]];isFinite(v)||(v=s),oe(yn,r[_[0]],r[_[1]],v),Do(yn,t.spatialReference,yn,t.renderSpatialReference),Yd(IE,Zl(yn,yn,DM))}const a=nw(IE),l=A_(IE),c=sw(IE),u=1/Math.tan(e.fovX/2),d=1/Math.tan(e.fovY/2),p=.5*Math.sqrt(a*a+c*c)*Math.max(d,u)+.5*l,m=.5*l*d+.5*Math.max(a,c);return Math.max(p,m)/n}async function NYe(t,e,i,r,n,s,o,a){a.targetGeometry=i.clone();const l=hw(t),c=DYe(t,l,i,r,n);nS(t,l,s);const u=tX(s,e)?$o.LOCKED:$o.ADJUST;return a.scale=Nb(t,c,a.targetGeometry.latitude),a.camera=await r_e(t,a.targetGeometry,a.scale,s,u,o),a}function FYe(t,e){if(!e||!t.spatialReference)return null;const i={target:void 0};return"declaredClass"in e||Array.isArray(e)?i.target=e:(Object.assign(i,e),e.center&&!i.target&&(i.target=e.center)),i}function iv(t){return t?.camera!=null&&(t.rotation=jF(t.camera.heading)),t}function kYe(t,e){const i=TYe;if(!e.length)return i;let r=Number.NEGATIVE_INFINITY;for(let n=0;n<e.length;n++){const s=e[n].screenSpaceBoundingRect;r=Math.max(r,Math.abs(s[0]),Math.abs(s[1]),Math.abs(s[2]),Math.abs(s[3]))}return i-r/Math.min(t.width,t.height)*2}const yn=C(),Lie=be(),DM=Hr(),IE=ds(),UYe=Gt(),HN=C(),NM=C(),bU=C(),wU={heading:0,tilt:0},Fc=new lt,zYe={point(t,e,i){i[0]=t.x,i[1]=t.y,t.z!=null&&(i[2]=t.z),e(i)},polygon(t,e,i){const r=t.hasZ;for(let n=0;n<t.rings.length;n++){const s=t.rings[n];for(let o=0;o<s.length;o++)i[0]=s[o][0],i[1]=s[o][1],r&&(i[2]=s[o][2]),e(i)}},polyline(t,e,i){const r=t.hasZ;for(let n=0;n<t.paths.length;n++){const s=t.paths[n];for(let o=0;o<s.length;o++)i[0]=s[o][0],i[1]=s[o][1],r&&(i[2]=s[o][2]),e(i)}},multipoint(t,e,i){const r=t.points,n=t.hasZ;for(let s=0;s<r.length;s++)i[0]=r[s][0],i[1]=r[s][1],n&&(i[2]=r[s][2]),e(i)},extent(t,e,i){t.zmin!=null&&t.zmax!=null?(e(oe(i,t.xmin,t.ymin,t.zmin)),e(oe(i,t.xmax,t.ymin,t.zmin)),e(oe(i,t.xmin,t.ymax,t.zmin)),e(oe(i,t.xmax,t.ymax,t.zmin)),e(oe(i,t.xmin,t.ymin,t.zmax)),e(oe(i,t.xmax,t.ymin,t.zmax)),e(oe(i,t.xmin,t.ymax,t.zmax)),e(oe(i,t.xmax,t.ymax,t.zmax))):(e(oe(i,t.xmin,t.ymin,i[2])),e(oe(i,t.xmax,t.ymin,i[2])),e(oe(i,t.xmin,t.ymax,i[2])),e(oe(i,t.xmax,t.ymax,i[2])))}},BYe=Object.freeze(Object.defineProperty({__proto__:null,create:Ebe,fromCamera:Sbe,toCameraAsync:xbe,toCameraSync:wbe},Symbol.toStringTag,{value:"Module"}));let VYe=class{constructor(e,i,r){this.target=e,this.options=i,this.view=r,this.state="pending",this._animationController=null,this.promise=new Promise((n,s)=>{this._resolveCallback=n,this._rejectCallback=s;const o=new AbortController;this.options.signal!=null&&os(this.options.signal,()=>{this.abort()}),this._abortController=o,this.waitForReady()})}resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&this._animationController!=null&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this.reject(pi())}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await Tg(()=>this.view.ready,this._abortController.signal)}catch(e){return this.reject(e)}this.createViewPoint()}async createViewPoint(){if(this.state!=="finished"){this.state="wait-for-viewpoint",this._animationController=this.options.animate?this._getAnimationController():null;try{const e=await Ebe(this.view,this.target,this._abortController.signal);if(this.state==="finished")return;const i=e?this._getCameraFromViewpoint(e):null;if(i==null)return;if(this.options.animate){if(this._animationController==null)return;this.startAnimation(i,this._animationController)}else this.view.stateManager.setStateCamera(i.camera,{applyConstraints:!i.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()}catch(e){this.reject(e)}}}_getCameraFromViewpoint(e){const i=!!(this.target instanceof oc&&this.target.camera||this.target instanceof du),r=e.camera;if(r==null)return null;if(!this.view.stateManager.isCompatible(r)){const s=r.position,o=s&&s.spatialReference,a=o?o.wkid:"none",l=this.view.spatialReference?.wkid;return this.reject(new W("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${a}, view: ${l})`,{camera:r})),null}const n=Vm(this.view,r);return n==null?(this.reject(new W("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:n,isFullySpecified:i}}startAnimation(e,i){this.state="wait-for-animation-finish";const r=i.viewAnimation;if(r==null)return void this.reject(new W("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(r.update(e.viewpoint,"running"),!i.active||i.viewAnimation==null||i.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==i)return this.abort();let n;e.isFullySpecified?(n=new l3({view:this.view,desiredCamera:e.camera}),WS(this.view,e.camera,sh.EYE_AND_CENTER)):$n(this.view,e.camera),i.begin(e.camera,this.options);const s=()=>{const a=this.view.state.cameraController;n&&(a&&a.active?a instanceof rg&&a.viewAnimation!=null&&a.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=n):i.viewAnimation!=null&&i.viewAnimation.target===e.viewpoint&&i.state==="finished"&&(this.view.state.cameraController=n))},o=a=>{if(this.view.state!=null)switch(i.state){case Wr.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case Wr.Ready:case Wr.Rejected:case Wr.Running:case Wr.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(a)}}};r.when(s,a=>o(a)),i.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let e=null,i=null;const r=this.view.state.cameraController;return r instanceof rg&&(r.updateStateFromViewAnimation(),r.active&&(e=r,i=e.viewAnimation)),e!=null||(e=new rg({view:this.view,mode:"animation"}),i=e.viewAnimation,this.view.state.switchCameraController(e))?e:(i?.stop(),this.reject(new W("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}},XS=class{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(e,i){return this._outer.get(e)?.get(i)}set(e,i,r){const n=this._outer.get(e);n?n.set(i,r):this._outer.set(e,new Map([[i,r]]))}delete(e,i){const r=this._outer.get(e);r&&(r.delete(i),r.size===0&&this._outer.delete(e))}forEach(e){this._outer.forEach((i,r)=>e(i,r))}};var Gn;function xU(t=!ie("disable-feature:high-quality-idle"),e=null){const i=new XS;return t?(i.set(Si.IDLE,Gn.Antialiasing,e!=="low"),i.set(Si.IDLE,Gn.HighResolutionAtmosphere,e!=="low"),i.set(Si.IDLE,Gn.HighQualityTransparency,!0),i.set(Si.IDLE,Gn.SSAO,!0),i.set(Si.IDLE,Gn.WaterReflection,!0),i.set(Si.IDLE,Gn.PhysicalPixelRendering,!0)):(i.set(Si.ANIMATING,Gn.HighResolutionShadows,!0),i.set(Si.INTERACTING,Gn.HighResolutionShadows,!0)),i.set(Si.IDLE,Gn.HighResolutionShadows,!0),i.set(Si.IDLE,Gn.HighResolutionVoxel,!0),i}(function(t){t[t.Antialiasing=0]="Antialiasing",t[t.HighQualityTransparency=1]="HighQualityTransparency",t[t.HighResolutionVoxel=2]="HighResolutionVoxel",t[t.HighResolutionAtmosphere=3]="HighResolutionAtmosphere",t[t.SSAO=4]="SSAO",t[t.WaterReflection=5]="WaterReflection",t[t.HighResolutionShadows=6]="HighResolutionShadows",t[t.PhysicalPixelRendering=7]="PhysicalPixelRendering"})(Gn||(Gn={}));let Jn=class extends xe{get camera(){const e=this._get("camera");if(!this.ready)return e;const i=nS(this.view,this.view.state.camera,TU);return i&&e&&i.equals(e)?e:i.clone()}set camera(e){this._updatePropertyBeforeReady("camera",e)||(this.view.elevationProvider?.enableElevationCache(!0),this.setStateCamera(Vm(this.view,e),{applyConstraints:!1})||ne.getLogger(this).error("#camera=","Invalid camera",e),this.view.elevationProvider?.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const i=nS(this.view,this.view.state.contentCamera,TU);return i&&e&&i.equals(e)?e:i.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const i=Vm(this.view,e);i!=null?(this._updateElevation(i),this.view.state.contentCamera=i):this.view.state.contentCamera=null}installContentCameraReset(e){if(this.removeHandles(SU),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const i=this.zoom,r=this.view.state.camera.distance**2,n=Xo(this.view.state.camera.center),s=e.sticky?this.contentCamera.clone():null;return this.addHandles([le(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(SU),this.test.contentCameraResetState.clear())}),le(()=>this.zoom,o=>{o!==void 0&&i!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(o-i)/2),Math.abs(o-i)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s))}),le(()=>this.view.state.camera,o=>{const a=bs(n,o.center);this.test.contentCameraResetState.set("camera.center",a/r),a>r?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)})],SU),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():ne.getLogger(this).error("#center=","Invalid center",e):ne.getLogger(this).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e):ne.getLogger(this).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,i=g_e(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return i??this._get("extent")}set extent(e){this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||ne.getLogger(this).error("#extent=","Invalid extent",e):ne.getLogger(this).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e):ne.getLogger(this).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get _initialViewpoint(){const e=this.view.map;return e&&"initialViewProperties"in e?e.initialViewProperties?.viewpoint:void 0}get hasInitialView(){return!!this._initialViewpoint}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return Nb(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||ne.getLogger(this).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,i=e.padding,r=e.pixelRatio,n=this._get("padding"),s=Math.round(i[Xt.TOP]/r),o=Math.round(i[Xt.RIGHT]/r),a=Math.round(i[Xt.BOTTOM]/r),l=Math.round(i[Xt.LEFT]/r);return n!=null&&n.top===s&&n.right===o&&n.bottom===a&&n.left===l?n:{top:s,right:o,bottom:a,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,FM),this.view.state.updateCamera(i=>i.padding=FM))}_paddingToArray(e,i,r){e?Mr(r,e.top||0,e.right||0,e.bottom||0,e.left||0):Mr(r,0,0,0,0);for(let n=0;n<4;n++)r[n]=Math.round(r[n]*i)}get screenCenter(){const e=this.padding;return ph((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?Sbe(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||ne.getLogger(this).error("#viewpoint=","Invalid viewpoint",e);else{const i=e.camera!=null?e.camera.position:e.targetGeometry,r=i!=null&&i.spatialReference;ne.getLogger(this).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(r?r.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e)}else ne.getLogger(this).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?j9e(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||ne.getLogger(this).error("#zoom=","Invalid zoom",e)}_computeCanvasSize(){if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;const e=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio),i=(this._usePhysicalPixelRendering?this._windowDevicePixelRatio:e)*this.view.resolutionScale;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*i),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*i);const r=this.view._stage.renderView.renderingContext.parameters.maxTextureSize;return G1(this._tmpCanvasSize,r),this._tmpCanvasSize.pixelRatio=this._tmpCanvasSize.width>0?this._tmpCanvasSize.width/this.view.surface.clientWidth*.5+this._tmpCanvasSize.height/this.view.surface.clientHeight*.5:i,this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)),this._tmpCanvasSize}get _rasterPixelRatio(){return this._devicePixelRatioOverride!=null?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){return this.view?._stage?.renderer.isFeatureEnabled(Gn.PhysicalPixelRendering)??!1}get _usePhysicalPixelRenderingAny(){const e=this.view?._stage?.renderer;return e&&(e.isFeatureEnabled(Gn.PhysicalPixelRendering,Si.IDLE)||e.isFeatureEnabled(Gn.PhysicalPixelRendering,Si.INTERACTING)||e.isFeatureEnabled(Gn.PhysicalPixelRendering,Si.ANIMATING))}constructor(e){super(e),this.constraintsManager=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._idleTimeout=Die,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:i=>this._devicePixelRatioOverride=i,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},get updatingIgnoreRenderState(){return this.renderState!=null},get idleTimeoutEnabled(){return this.viewStateManager._idleTimeout>0},set idleTimeoutEnabled(i){this.viewStateManager._idleTimeout=i?Die:0}},this._propertiesPool=new Og({frustum:Ty},this),this._cameraSetByUser=!1,this._gotoOperation=null,this._cameraChangeTime=0,this._tmpCanvasSize=new GYe}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([Io(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),le(()=>this.view.state?.camera,(e,i)=>this._cameraChangedHandler(e,i),qi)]),ac(()=>this.view.state?.camera,e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([fb({prepare:()=>this._prepareFrame()}),le(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(kM)}),Io(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=Pe(this._propertiesPool)}init(){this.constraintsManager=new dA({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const i of e)this.set(i.name,i.value);if(!this._cameraSetByUser){const i=this._initialViewpoint||this.view.initialExtent;i&&this.isCompatible(i)?this._setInitialView(i):this.view.state.viewingMode===Me.Local&&this.addHandles(ac(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(kM),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),kM)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(kM),this.constraintsManager=Pe(this.constraintsManager))}async goTo(e,i){const r={animate:!0,...i};return this._gotoOperation!=null&&this._gotoOperation.abort(r.animate),this._gotoOperation=new VYe(e,r,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation.promise}debugSetCameraOnContent(){this.setStateCamera(hw(this.view),{applyConstraints:!1})}step(e){const i=this.view.state,r=i?.cameraController;r&&(i.updateCamera(n=>r.stepController(e,n)),r.steppingFinished&&r.finishController())}_cancelGoToOperation(){this._gotoOperation!=null&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,i=[];for(const{propertyName:r,overrides:n}of HYe){const s=e.has(r),o=this._isOverridden(r);!s&&o&&i.push({name:r,value:this._get(r)}),this._clearOverride(r),(s||o)&&n.forEach(a=>e.add(a))}return i}_setInitialView(e){if(e==null||this._cameraSetByUser)return;if(e instanceof du)return void this.setStateCamera(Vm(this.view,e),{applyConstraints:!1});if(e instanceof oc){if(e.targetGeometry instanceof Xi){const s=hL(this.view,e.targetGeometry,0,.5,$o.LOCKED);return void(s!=null&&this.setStateCamera(Vm(this.view,s),{applyConstraints:!0}))}const r={applyConstraints:!e.camera},n=this._viewpointToCamera(e);return void this.setStateCamera(n,r)}const i=hL(this.view,e,0,.5,$o.LOCKED);i!=null&&this.setStateCamera(Vm(this.view,i),{applyConstraints:!0})}_updatePropertyBeforeReady(e,i){return!this.ready&&(this._override(e,i),i&&jYe.has(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return e!=null&&(e instanceof oc?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof du?this.isCompatible(e.position):e.spatialReference&&UA(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=qYe){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,i,r=v0){const{heading:n,tilt:s}=this._getPreservingHeadingTilt(),o=tY(this.view,n,s,e,i,$o.ADJUST);return o==null?null:(r.copyFrom(this.view.state.camera),r.eye=o.eye,r.center=o.center,r.up=o.up,r)}_centerToCamera(e){const i=this.view.pointsOfInterest.centerOnContent;i.runTask();const r=i.distance;return this._centerPointAtDistanceToCamera(e,r)}_extentToCamera(e){const{heading:i,tilt:r}=this._getPreservingHeadingTilt(),n=hL(this.view,e,i,r,$o.ADJUST,TU);return n?Vm(this.view,n):null}_scaleToCamera(e){if(e==null)return null;const i=this.view.pointsOfInterest.centerOnContent;i.runTask();const r=i.renderLocation,n=i.location.latitude;if(n==null)return null;const s=xF(this.view,e,n);return this._centerPointAtDistanceToCamera(r,s)}_zoomToCamera(e){return this._scaleToCamera(b_e(this.view,e))}_viewpointToCamera(e){return Vm(this.view,wbe(this.view,e))}setStateCamera(e,i){return!(e==null||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,i.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(r=>{i.positionAndOrientationOnly?(r.eye=e.eye,r.center=e.center,r.up=e.up):r.copyFrom(e),i.applyConstraints&&$n(this.view,r)}),i.applyConstraints||(this.view.state.cameraController=new l3({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:i}=this.view;if(!e||!i)return;this._windowDevicePixelRatio=window.devicePixelRatio;const r=this._computeCanvasSize();if(r.width!==0&&r.height!==0&&(i.width===r.width&&i.height===r.height||(i.width=r.width,i.height=r.height),this.view.state)){const n=this.view.state.camera;n.fullWidth===r.width&&n.fullHeight===r.height&&n.pixelRatio===r.pixelRatio||(v0.copyFrom(n),v0.pixelRatio!==r.pixelRatio&&(this._paddingToArray(this.padding,r.pixelRatio,FM),v0.padding=FM),v0.fullWidth=r.width,v0.fullHeight=r.height,v0.pixelRatio=r.pixelRatio,this.view.state.camera=v0),this._updateViewState()}}_updateElevation(e){const i=this.view.basemapTerrain?.spatialReference,r=this.view.renderCoordsHelper?.getAltitude(e.eye)??0,n=i?wF(this.view,e.eye):0;e.relativeElevation=r-n}_updateViewState(){this.test.renderState!=null?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=Si.ANIMATING:this.view.interacting?this.view.state.mode=Si.INTERACTING:(this.view.state.mode===Si.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<this._idleTimeout?this.view.state.mode=Si.INTERACTING:this.view.state.mode=Si.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(e,i){e&&i&&e.almostEquals(i)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};h([f({type:du,dependsOn:["view.state.camera","ready"]})],Jn.prototype,"camera",null),h([f({type:du,dependsOn:["view.state.contentCamera","ready"]})],Jn.prototype,"contentCamera",null),h([f({type:lt})],Jn.prototype,"center",null),h([f({type:Xi})],Jn.prototype,"extent",null),h([f({readOnly:!0})],Jn.prototype,"frustum",null),h([f()],Jn.prototype,"_initialViewpoint",null),h([f({readOnly:!0})],Jn.prototype,"hasInitialView",null),h([f({readOnly:!0,type:Boolean})],Jn.prototype,"ready",void 0),h([f({type:Number})],Jn.prototype,"scale",null),h([f()],Jn.prototype,"padding",null),h([f({readOnly:!0})],Jn.prototype,"screenCenter",null),h([f({constructOnly:!0})],Jn.prototype,"view",void 0),h([f({type:oc})],Jn.prototype,"viewpoint",null),h([f({type:Number})],Jn.prototype,"zoom",null),h([f({readOnly:!0})],Jn.prototype,"_rasterPixelRatio",null),h([f({readOnly:!0})],Jn.prototype,"_usePhysicalPixelRendering",null),h([f({readOnly:!0})],Jn.prototype,"_usePhysicalPixelRenderingAny",null),h([f()],Jn.prototype,"_windowDevicePixelRatio",void 0),h([f()],Jn.prototype,"_devicePixelRatioOverride",void 0),Jn=h([z("esri.views.3d.state.ViewStateManager")],Jn);let GYe=class{constructor(){this.width=0,this.height=0,this.pixelRatio=1}};const jYe=new Set(["camera","viewpoint","extent","scale","center","zoom"]),HYe=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],qYe={heading:0,tilt:0},TU=new du,v0=new ht,FM=Kt(),kM="pending-initial-view",SU="content-camera-reset",Die=300,Nie=100;let mf=class extends Ym{constructor(){super(...arguments),this.startCamera=new ht,this.currentCamera=new ht,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<Nie}stepController(e,i){i.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(i)}onControllerStart(e){this.state=Wr.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),Nie),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};h([f({readOnly:!0})],mf.prototype,"isInteractive",null),h([f()],mf.prototype,"_lastInteraction",void 0),mf=h([z("esri.views.3d.state.controllers.InteractiveController")],mf);var Vl;(function(t){t[t.CENTER=0]="CENTER",t[t.EYE=1]="EYE"})(Vl||(Vl={}));let c3=class extends mf{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=Vl.CENTER,this._rotScale=0,this._lastPoint=Ue(),this._tmpWorldUp=C(),this._tmpViewDir=C(),this._tmpRotCurPoint=Ue(),this._tmpTransf=be(),this._tmpAxis=C(),this._tmpPivotPoint=C(),this._pivotPos=C(),this._constraintOptions={selection:Ar.ALL,interactionType:qt.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:js.TUMBLE}}initialize(){this._rotScale=this.pivot===Vl.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case Vl.EYE:se(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=qt.LOOK_AROUND,this._constraintOptions.tiltMode=js.LOOK_AROUND,this._constraintOptions.selection=Ar.NONE;break;case Vl.CENTER:{const i=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?mw:{});i||se(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,i),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=qt.TUMBLE,this._constraintOptions.tiltMode=js.TUMBLE,this._constraintOptions.selection=Ar.ALL&~Ar.DISTANCE;break}}this._constraintOptions.interactionStartCamera=this.startCamera,nb(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,i){const r=this.startCamera,n=C();he(n,this._pivotPos,r.eye);const s=we(n),o=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(r.eye,Fie);let a=Math.max(Math.min(QWe,1/Math.abs(me(Fie,r.viewForward)))*o,eYe);i&&(a=Math.min(s,a));const l=Fi(this.view.spatialReference),c=Zr(r.width/r.pixelRatio*.5,r.height/r.pixelRatio*.5),u=GF(this.startCamera,c,l);let d=this.view._stage.renderView.getMinimalDepthForArea(TO(this.view),r.fullWidth/r.pixelRatio*.5,r.fullHeight/r.pixelRatio*.5,r,2.5*mU,mU),p=this.view._stage.renderView.getMinimalDepthForArea(TO(this.view),e[0],e[1],r,mU);d==null&&p==null||(d=d??p??0,p=p==null||u===Bs.Horizontal?d:p,a=d>p?p:d,a=i?Math.min(a,s):a),ge(n,n),se(this._pivotPos,ce(this._tmpPivotPoint,r.eye,te(this._tmpPivotPoint,n,a)))}update(e){if(this.active){switch(this.pivot){case Vl.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case Vl.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}$n(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,i,r,n){this.view.renderCoordsHelper.worldUpAtPosition(n,this._tmpWorldUp),nb(e,i,this._tmpRotCurPoint);let s=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,o=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;he(this._tmpViewDir,r,n);const a=we(this._tmpViewDir),l=xs(me(this._tmpViewDir,this._tmpWorldUp)/a);if(this.pivot===Vl.EYE){s*=-.5;const c=.5*Math.PI-l,u=.5*Math.PI*.99;s=c-Math.max(-u,Math.min(u,c+s))}return s=_e(s+l,Co.min,Co.max)-l,nt(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===Vl.CENTER&&(o=-o),hu(this._tmpTransf,o,this._tmpWorldUp),Jl(this._tmpTransf,this._tmpTransf,s,this._tmpAxis),Fe(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=Fe(EU,e.up,this._tmpTransf),ce(EU,n,this._tmpViewDir),Yn(this._lastPoint,this._tmpRotCurPoint),EU}};h([f()],c3.prototype,"pivot",void 0),c3=h([z("esri.views.3d.state.controllers.RotateController")],c3);const EU=C(),Fie=C();let CU=class extends go{constructor(e,i,r,n){super(!0),this._view=e,this.pointerAction=i,this._pivot=r,this.registerIncoming("drag",n,s=>this._handleDrag(s))}_handleDrag(e){const i=e.data;if(i.pointers.size>1||!QY(e.data,this.pointerAction))return;const r=Zr(i.center.x,i.center.y);switch(i.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new c3({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}},FG=class extends mf{constructor(){super(...arguments),this._pickPoint=C(),this._tmpP0=Ue(),this._panAxisAngle=BF(),this._tmpRayDir=C(),this._tmpRayDirPick=C(),this._targetOnSphere=C(),this._navMode=Bs.Horizontal,this._tmpRay={origin:C(),direction:C()},this.dragBeginPoint=Zr(),this._normalizedAnchorPoint=Ue(),this._constraintOptions={selection:Ar.ALL_EXCEPT_COLLISION,interactionType:qt.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:js.TUMBLE},this._sphere=xn(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Yn(this.dragBeginPoint,e),nb(this.startCamera,e,this._normalizedAnchorPoint);const i=Fi(this.view.spatialReference),r=ube(this._intersectionHelper,this.startCamera,e,i,cS.Ellipsoid,this.view.map.ground.opacity===0?mw:{});if(this._navMode=GF(this.startCamera,e,i),this._navMode===Bs.Horizontal)this._hasPickPoint=!!r.scenePickPoint,this._pickPoint=r.scenePickPoint??this._pickPoint,this._sphere=r.sphere;else{let n;YS(this.startCamera,e,this._tmpRay),ge(this._tmpRay.direction,this._tmpRay.direction),r.scenePickPoint!=null&&(he(this._tmpRayDirPick,this.startCamera.eye,r.scenePickPoint),n=we(this._tmpRayDirPick));const s=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,kie);let o=_e(Math.min(ibe,1/Math.abs(me(kie,this._tmpRay.direction)))*s,kN[0],kN[1]);const a=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,VF);o=a??o,o=n!=null?Math.min(o,n):o,this._hasPickPoint=!0,te(this._tmpRay.direction,this._tmpRay.direction,o),ce(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===Bs.Horizontal){he(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const i=we(this._tmpRayDir);nb(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let n=i*2**r;const s=this.view.state.constraints.minimumPoiDistance;if(r<0&&n<s&&(n=s),Math.abs(i-n)<1e-6)return;if(this._hasPickPoint&&n<i){const o=1-(1-n/i)*(1-this._sphere[3]/we(this.currentCamera.center));this.currentCamera.center=te(UM,this.currentCamera.center,o)}te(this._tmpRayDir,this._tmpRayDir,-n/i),this.currentCamera.eye=ce(UM,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=xd(a_(this.dragBeginPoint,e)),$n(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(xO(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),qY(this._pickPoint,this._targetOnSphere,this._panAxisAngle),f_(this.currentCamera,this._sphere,this._panAxisAngle))}else{const i=we(this._tmpRay.direction);nb(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let n=i*2**r;const s=this.view.state.constraints.minimumPoiDistance;if(r<0&&n<s&&(n=s),Math.abs(i-n)<1e-6)return;te(this._tmpRayDir,this._tmpRay.direction,1-n/i),this.currentCamera.eye=ce(UM,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=ce(UM,this.currentCamera.center,this._tmpRayDir)}WS(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};FG=h([z("esri.views.3d.state.controllers.global.ZoomController")],FG);const UM=C(),kie=C();let kG=class extends mf{constructor(){super(...arguments),this._tmpP=C(),this._tmpDir=C(),this._tmpN=C(),this._tmpP0=Ue(),this._tmpPoi=C(),this._tmpRayDir=C(),this.dragBeginPoint=Zr(),this._normalizedAnchorPoint=Ue(),this._constraintOptions={selection:Ar.ALL,interactionType:qt.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:C(),tiltMode:js.TUMBLE},this._plane=Ti()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Yn(this.dragBeginPoint,e),nb(this.startCamera,e,this._normalizedAnchorPoint);const i=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?mw:{});he(this._tmpDir,this._tmpP,this.startCamera.eye);const r=we(this._tmpDir);ge(this._tmpDir,this._tmpDir);const n=Math.abs(this.view.camera.position.z);let s=_e(Math.min(ibe,1/Math.abs(me(WYe,this._tmpDir)))*n,kN[0],kN[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(TO(this.view),e[0],e[1],this.view.state.camera,VF);s=o??s,s=i?Math.min(s,r):s,te(this._tmpDir,this._tmpDir,s),ce(this._tmpP,this.startCamera.eye,this._tmpDir),he(this._tmpN,this.startCamera.eye,this.startCamera.center),ge(this._tmpN,this._tmpN),this._tmpN[1]<0&&na(this._tmpN,this._tmpN),xR(this._tmpP,this._tmpN,this._plane),this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;tYe(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||se(this._tmpPoi,this.currentCamera.center),nb(this.currentCamera,e,this._tmpP0);let i=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);Yn(this._normalizedAnchorPoint,this._tmpP0),he(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const r=we(this._tmpRayDir);let n=r*(1-i);this._constraintOptions.interactionDirection&&(se(this._constraintOptions.interactionDirection,this._tmpRayDir),te(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(i)/r));const s=this.view.state.constraints.minimumPoiDistance;i>=0&&n<s&&(n=s,i=-(n-r)/r),Math.abs(r-n)<1e-6||(te(this._tmpRayDir,this._tmpRayDir,i),this.currentCamera.eye=ce(rv,this.currentCamera.eye,this._tmpRayDir),Ui(rv,this.currentCamera.center,this._tmpPoi,i),this._tmpPoi[2]>this.startCamera.center[2]?rv[2]=Math.max(this.startCamera.center[2],rv[2]):rv[2]=Math.min(this.startCamera.center[2],rv[2]),this.currentCamera.center=rv,this._constraintOptions.interactionFactor=xd(a_(this.dragBeginPoint,e)),$n(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};kG=h([z("esri.views.3d.state.controllers.local.ZoomController")],kG);const rv=C(),WYe=Ce(0,0,1);let YYe=class extends go{constructor(e,i,r){super(!0),this._view=e,this.pointerAction=i,this.registerIncoming("drag",r,n=>this._handleDrag(n))}_handleDrag(e){const i=e.data;if(i.pointers.size>1||!QY(e.data,this.pointerAction))return;const r=Zr(i.center.x,i.center.y);switch(i.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new FG({view:this._view}):this._cameraController=new kG({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}};function kh(t){let e=t*t;return t<0&&(e*=-1),e}function Uie(t,e,i){const r=i,n=t.state,s=t.device,o=e.tiltDirection==="forward-down"?1:-1,a=1;return s.deviceType==="standard"?(r.translation[0]=kh(n.axes[0]),r.translation[1]=kh(n.axes[1]),r.translation[2]=kh(n.buttons[7])-kh(n.buttons[6]),r.heading=kh(n.axes[2]),r.tilt=kh(n.axes[3])):s.deviceType==="spacemouse"&&(r.translation[0]=1.2*kh(n.axes[0]),r.translation[1]=1.2*kh(n.axes[1]),r.translation[2]=2*-kh(n.axes[2]),r.heading=1.2*kh(n.axes[5]),r.tilt=1.2*kh(n.axes[3])),r.tilt*=o,te(r.translation,r.translation,a),r}function zie(t,e){const i=e;return i.translation[0]=t[1]-t[0],i.translation[1]=t[3]-t[2],i.translation[2]=t[4]-t[5],i.heading=t[7]-t[6],i.tilt=t[8]-t[9],i.zoom=t[10]-t[11],i}function AU(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}let j1=class extends mf{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new ht,this._headingStart=0,this._constraintOptions={selection:Ar.ALL,interactionType:qt.NONE,interactionStartCamera:new ht,interactionFactor:0,interactionDirection:null,tiltMode:js.LOOK_AROUND}}handleEventGamepad(e){const i=Uie(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||AU(i))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,zie(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;const i=zie(this._keysButtonState,this._transformation);AU(i)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const i=this.view.pointsOfInterest.cameraOnSurface.location.z,r=1;this._filteredSurfaceElevation+=r*(i-this._filteredSurfaceElevation)*e}stepController(e,i){this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(i),this._updateCameraCenter(),this._constraintOptions.interactionStartCamera?.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,nv),this._applyDisabledMovementTypes(nv),this._applyPan(nv.pan),this._applyRotate(nv.rotate),this._applyZoom(nv.zoom),this._applyAscend(nv.ascend),this._constraintOptions.interactionType=qt.NONE,this._constraintOptions.selection=Ar.COLLISION,$n(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,i)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const i=this.currentCamera;he(ja,i.center,i.eye),Fe(ja,ja,e.matrix),i.center=ce(ja,ja,i.eye),i.up=Fe(ja,i.up,e.matrix),this._constraintOptions.interactionType=qt.LOOK_AROUND,this._constraintOptions.selection=Ar.ALL_EXCEPT_COLLISION,$n(this.view,i,this._constraintOptions)}_applyPan(e,i=this.currentCamera){e.enabled&&(i.eye=Fe(ja,i.eye,e.matrix),i.center=Fe(ja,i.center,e.matrix),this.view.state.isGlobal&&(i.up=Fe(ja,i.up,e.matrix)),this._constraintOptions.interactionType=qt.PAN,this._constraintOptions.selection=Ar.ALL,$n(this.view,i,this._constraintOptions))}_applyZoom(e){if(!e)return;const i=this.currentCamera.viewForward;this.currentCamera.eye=ce(ja,this.currentCamera.eye,te(Le.get(),i,e)),se(LE,i),na(LE,LE),this._constraintOptions.interactionDirection=LE,this._constraintOptions.interactionType=qt.ZOOM,this._constraintOptions.selection=Ar.ALL_EXCEPT_COLLISION,$n(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const i=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Le.get());if(this._constraintOptions.interactionDirection=se(LE,i),this.view.state.isGlobal){const r=we(this.currentCamera.eye),n=(r+e)/r;this.currentCamera.eye=te(ja,this.currentCamera.eye,n),this.currentCamera.center=te(ja,this.currentCamera.center,n)}else{const r=te(Le.get(),i,e);this.currentCamera.eye=ce(ja,this.currentCamera.eye,r),this.currentCamera.center=ce(ja,this.currentCamera.center,r)}this._updateCameraCenter(),this._constraintOptions.interactionType=qt.ASCEND,this._constraintOptions.selection=Ar.COLLISION,$n(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=Ar.ALL_EXCEPT_COLLISION,$n(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,i,r){tXe(r);const n=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(n,i,r):this._calculateControlTransformationGlobal(n,i,r)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,i=this.view.renderCoordsHelper,r=this.currentCamera.ray;this.currentCamera.center=i.intersectManifoldClosestSilhouette(r,e,ja)}_calculateControlTransformationLocal(e,i,r){const{viewRight:n,viewForward:s}=i,o=this._transformation,a=this.view.navigation.gamepad,l=oe(Le.get(),s[0],s[1],0);ge(l,l);const c=o.translation[0]*e.pan;if(c!==0){const _=te(Le.get(),n,c);yl(r.pan.matrix,r.pan.matrix,_),r.pan.enabled=!0}switch(a.mode){case"pan":{const _=-o.translation[1]*e.pan;if(_!==0){const v=te(Le.get(),l,_);yl(r.pan.matrix,r.pan.matrix,v),r.pan.enabled=!0}r.zoom=o.zoom*e.zoom;break}case"zoom":r.zoom=(-o.translation[1]+o.zoom)*e.zoom;break;default:a.mode}const u=o.translation[2]*e.ascend;r.ascend=u;const d=-o.heading*e.rotate;d!==0&&(Jl(r.rotate.matrix,r.rotate.matrix,d,this.view.renderCoordsHelper.worldUpAtPosition(i.eye,Le.get())),r.rotate.enabled=!0);const p=o.tilt*e.rotate,m=p_(this.view.renderCoordsHelper,i.center,i.eye),y=_e(m+p,Co.min,Co.max)-m;y&&(Jl(r.rotate.matrix,r.rotate.matrix,y,n),r.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,i,r){const{eye:n,viewRight:s}=i,o=this._transformation,a=this.view.navigation.gamepad,l=nt(Le.get(),s,n);ge(l,l),na(l,l),aYe(this.startCamera,i,o,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,r,a),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(nv.pan,this._tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,u=o.translation[2]*e.ascend;r.ascend=u;const d=-o.heading*e.rotate;d!==0&&(Jl(r.rotate.matrix,r.rotate.matrix,d,this._tmpCamera.eye),r.rotate.enabled=!0);const p=o.tilt*e.rotate,m=this._clampTiltDeltaGlobalToValidRange(p,i.ray,c);m!==0&&(Jl(r.rotate.matrix,r.rotate.matrix,m,this._tmpCamera.viewRight),r.rotate.enabled=!0),r.zoom+=o.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,i,r){const n=Fi(this.view.spatialReference),s=PL(Co.min,i.origin,r,n);let o=0,a=0;const l=Le.get();if(this.view.renderCoordsHelper.intersectManifold(i,r,l)){const c=p_(this.view.renderCoordsHelper,l,i.origin);o=PL(c,i.origin,r,n),a=PL(Co.max,i.origin,r,n)}else{BS(lF(cF,r+n.radius),i,l);const c=Math.PI+aF(i.direction,l);o=wie(c,i.origin,r,n),a=wie(Co.max,i.origin,r,n)}return _e(o+e,s,a)-o}_getPointAbsoluteSurfaceElevation(e,i,r){const{renderCoordsHelper:n}=this.view,s=n.getAltitude(e),o=i+Math.abs(s-i);return n.setAltitude(r,o,e),o}_clampedDistanceToSurface(e,i){const{renderCoordsHelper:r}=this.view,{camera:n}=this.view.state,{direction:s}=D9e(this.view,i,0,Obe,eXe),o=r.intersectManifoldClosestSilhouette(pu(i,s),e,Le.get()),a=br(i,o),l=r.intersectManifoldClosestSilhouette(pu(i,Ng(Le.get(),i,n.center)),e,Le.get()),c=br(i,l);return Math.min(a,c)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:i,state:r}=this.view,{camera:n,isGlobal:s}=r,o=i.intersectManifoldClosestSilhouette(n.ray,this._filteredSurfaceElevation,Le.get());if(s){const a=he(Le.get(),e,o),l=we(a);te(a,a,1/l);const c=ge(Le.get(),e),u=xs(me(c,a));return l*Math.sin(Math.min(ZYe,u))}{const a=se(Le.get(),e);return i.setAltitude(a,this._filteredSurfaceElevation),br(o,a)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:JYe}_computeVelocities(e){const i=this._filteredSurfaceElevation,r=i+Fi(this.view.spatialReference).radius,{camera:n,isGlobal:s}=this.view.state,o=Le.get(),a=this._getPointAbsoluteSurfaceElevation(n.eye,i,o),l=this._clampedDistanceToSurface(i,o),c=n.width/2,u=Bie*n.width,d=Bie*n.width,p=l*Math.tan(.5*n.fovX)/c,m=p/r,y=p/this._computeHeadingRotateRadius(o),_=a-i;return{pan:(s?m:p)*u*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(u*e/c)*_-_),zoom:2**(u*e/c)*l-l,rotate:_e(y*d,KYe,QYe)*e}}_applyDisabledMovementTypes(e){this.disableMovements==null||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&fh(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&fh(e.rotate.matrix))}static activatesFor(e,i){const r=Uie(i,e.navigation.gamepad,XYe);return!(i.action==="end"||AU(r))}};h([f({constructOnly:!0})],j1.prototype,"gamepadDevice",void 0),h([f({constructOnly:!0})],j1.prototype,"disableMovements",void 0),j1=h([z("esri.views.3d.state.controllers.GamepadKeyboardController")],j1);const XYe={translation:[0,0,0],heading:0,tilt:0,zoom:0},Obe=80,ZYe=Rt(Obe),Bie=.75,JYe=5,KYe=Rt(30),QYe=Rt(80),nv={zoom:0,ascend:0,pan:{enabled:!1,matrix:be()},rotate:{enabled:!1,matrix:be()}},ja=C(),LE=C(),eXe=QW();function tXe(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,fh(t.pan.matrix),t.rotate.enabled=!1,fh(t.rotate.matrix)}let iXe=class extends go{constructor(e){super(!0),this._view=e,this._watchHandles=new Dg,this._handle=this.registerIncoming("gamepad",i=>this._handleEventGamepad(i)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([le(()=>this._view.navigation.gamepad.enabled,i=>{i?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},Zi),le(()=>this._view.navigation.gamepad.device,i=>{this._cameraControllerGamepad&&i&&this._cameraControllerGamepad.gamepadDevice!==i&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){const i=this._view.navigation.gamepad.device;if(i&&e.data.device!==i)return;const r=this._cameraControllerGamepad&&this._cameraControllerGamepad.active;if(r||j1.activatesFor(this._view,e.data)){if(!r){const n=new j1({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(n)&&(this._cameraControllerGamepad=n)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}};function rXe(t){const e=()=>t(document.visibilityState==="visible");return document.addEventListener("visibilitychange",e),{remove:()=>document.addEventListener("visibilitychange",e)}}var Ll;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.FORWARD=2]="FORWARD",t[t.BACKWARD=3]="BACKWARD",t[t.UP=4]="UP",t[t.DOWN=5]="DOWN",t[t.HEADINGLEFT=6]="HEADINGLEFT",t[t.HEADINGRIGHT=7]="HEADINGRIGHT",t[t.TILTUP=8]="TILTUP",t[t.TILTDOWN=9]="TILTDOWN",t[t.ZOOMIN=10]="ZOOMIN",t[t.ZOOMOUT=11]="ZOOMOUT"})(Ll||(Ll={}));let nXe=class extends go{constructor(e,i){super(!0),this._view=e,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:Me.Local},this._keyToNumber={[i.left]:Ll.LEFT,[i.right]:Ll.RIGHT,[i.forward]:Ll.FORWARD,[i.backward]:Ll.BACKWARD,[i.up]:Ll.UP,[i.down]:Ll.DOWN,[i.headingLeft]:Ll.HEADINGLEFT,[i.headingRight]:Ll.HEADINGRIGHT,[i.tiltUp]:Ll.TILTUP,[i.tiltDown]:Ll.TILTDOWN,[i.zoomIn]:Ll.ZOOMIN,[i.zoomOut]:Ll.ZOOMOUT},this.registerIncoming("key-down",null,r=>this._handleKeyDown(r)),this.registerIncoming("key-up",null,r=>this._handleKeyUp(r)),this.registerIncoming("blur",null,()=>this._handleStop()),this._visibilityHandle=rXe(r=>r?null:this._handleStop())}onUninstall(){this._visibilityHandle?.remove(),this._handleStop()}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const i=this._keyToNumber[e.data.key];i!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new j1({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(i),e.stopPropagation()))}_handleStop(){this._cameraControllerKeyboard?.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const i=this._keyToNumber[e.data.key];i!=null&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(i),e.stopPropagation())}},sXe=class extends go{constructor(e,i){super(!0),this._view=e,this.registerIncoming("mouse-wheel",i,r=>this._handleMouseWheel(r))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled)return;const i=e.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new VN({view:this._view,mode:"interaction"}):new GN({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*i.deltaY,Zr(i.x,i.y)),e.preventDefault(),e.stopPropagation()}},qN=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},Bb=class extends bO{constructor(){super(...arguments),this._beginCamera=new ht,this._elapsedTimeSec=0,this.constraintOptions={selection:Ar.ALL,interactionType:qt.PAN,interactionFactor:0,interactionStartCamera:new ht,interactionDirection:null,tiltMode:js.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new sS}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this._beginCamera,super.onControllerStart(e)}stepController(e,i){i.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,i),$n(this.view,i,this.constraintOptions)}};Bb=h([z("esri.views.3d.state.controllers.momentum.MomentumController")],Bb);let u3=class extends Bb{constructor(e){super(e),this.interactionType=qt.PAN,this._tmpPan=C()}momentumStep(e,i){const r=this.momentum.value(e);te(this._tmpPan,this.momentum.direction,r),i.eye=he(Vie,i.eye,this._tmpPan),i.center=he(Vie,i.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};h([f({constructOnly:!0})],u3.prototype,"momentum",void 0),u3=h([z("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],u3);const Vie=C(),oXe=C(),zM=C();let IL=class extends Bb{constructor(e){super(e),this.interactionType=qt.PAN}momentumStep(e,i){const r=this.momentum.value1(e),n=this.momentum.value2(e);se(zM,i.eye),ge(zM,zM),nt(this.momentum.axis2,zM,this.momentum.axis1),fbe(i,oXe,this.momentum.axis1,r,this.momentum.axis2,n)}};h([f({constructOnly:!0})],IL.prototype,"momentum",void 0),IL=h([z("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],IL);let R1=class extends Bb{set center(e){this._set("center",Br(e))}set axis(e){this._set("axis",Br(e))}constructor(e){super(e),this.interactionType=qt.TUMBLE}momentumStep(e,i){const r=this.momentum.value(e);f_(i,this.center,wO(this.axis,r))}};h([f({constructOnly:!0})],R1.prototype,"momentum",void 0),h([f({constructOnly:!0})],R1.prototype,"center",null),h([f({constructOnly:!0})],R1.prototype,"axis",null),R1=h([z("esri.views.3d.state.controllers.momentum.MomentumController")],R1);let H2=class extends Bb{set zoomCenter(e){this._set("zoomCenter",Br(e))}constructor(e){super(e),this.interactionType=qt.ZOOM,this.constraintOptions.interactionDirection=C()}momentumStep(e,i){const{interactionDirection:r}=this.constraintOptions;if(!r)return;se(r,i.eye);const n=this.momentum.valueDelta(0,e);ZY(i,this.zoomCenter,n,this.view.state.constraints.minimumPoiDistance),Ng(r,i.eye,r)}};h([f({constructOnly:!0})],H2.prototype,"momentum",void 0),h([f({constructOnly:!0})],H2.prototype,"zoomCenter",null),H2=h([z("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],H2);let l1=class extends Bb{set screenCenter(e){this._set("screenCenter",Zr(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",Br(e))}constructor(e){super(e),this.interactionType=qt.ZOOM,this.radius=0,this._tmpSceneCenter=C(),this._tmpZoomAxisAngle=BF(),this._sphere=xn()}initialize(){this._sphere[3]=this.radius}momentumStep(e,i){const r=this.momentum.valueDelta(0,e);lbe(this._sphere,i,r),this.constraintOptions.interactionType=qt.ZOOM,$n(this.view,i,this.constraintOptions),xO(this._sphere,i,this.screenCenter,this._tmpSceneCenter),qY(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),f_(i,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=qt.PAN}};h([f({constructOnly:!0})],l1.prototype,"momentum",void 0),h([f({constructOnly:!0})],l1.prototype,"screenCenter",null),h([f({constructOnly:!0})],l1.prototype,"sceneCenter",null),h([f({constructOnly:!0})],l1.prototype,"radius",void 0),l1=h([z("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],l1);let Td=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const i=this.computeDelta(e);this._updateDelta(i)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},HF=class{constructor(e,i,r){this._initialVelocity=e,this._stopVelocity=i,this._friction=r,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,i){const r=this.value(e);return this.value(e+i)-r}valueFromInitialVelocity(e,i){i=Math.min(i,this.duration);const r=1-this.friction;return e*(r**i-1)/Math.log(r)}},aXe=class extends HF{constructor(e,i,r,n,s){super(e,i,r),this._sceneVelocity=n,this.direction=s}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},Rbe=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._time=new Td(.6),this._screen=[new Td(.4),new Td(.4)],this._scene=[new Td(.6),new Td(.6),new Td(.6)],this._tmpDirection=C()}add(e,i,r){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(r)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(i[0]),this._scene[1].update(i[1]),this._scene[2].update(i[2]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?0:Math.sqrt(e*e+i*i),n=this._time.filteredDelta,s=n==null||r==null?0:r/n;return Math.abs(s)<this._minimumInitialVelocity?null:this.createMomentum(s,this._stopVelocity,this._friction)}createMomentum(e,i,r){oe(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const n=we(this._tmpDirection);n>0&&te(this._tmpDirection,this._tmpDirection,1/n);const s=this._time.filteredDelta;return new aXe(e,i,r,s==null?0:n/s,this._tmpDirection)}},Gie=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const jie=1e-5;let lXe=class extends HF{constructor(e,i,r,n,s,o=0,a){super(e,i,r),this._angularVelocity1=n,this.axis1=s,this.angularVelocity2=o,this.axis2=a}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},cXe=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._tmpAxis1=C(),this._tmpAxis2=C(),this._tmpAngles=Ue(),this._time=new Td(.3),this._screen=[new Td(.4),new Td(.4)],this._angle1=new Gie(.6),this._angle2=new Gie(.6),this._axis1=C(),this._axis2=C(),this._lastScene=C()}addMomentumDirectRotation(e,i,r,n,s,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;let a=dbe(this._lastScene,i,this._tmpAxis2,n,s,o);this._angle2.update(0),Oo(this._tmpAxis2)<jie?a=0:ge(this._axis1,this._tmpAxis2),this._angle1.update(a),se(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}addMomentumPreserveHeading(e,i,r,n,s,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;pbe(this._lastScene,i,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,n,s,o,a,!1),Oo(this._tmpAxis2)<jie?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),ge(this._axis1,this._tmpAxis1),ge(this._axis2,this._tmpAxis2)),se(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?null:Math.sqrt(e*e+i*i),n=this._time.filteredDelta,s=r==null||n==null?0:r/n;return Math.abs(s)<this._minimumInitialVelocity?null:this.createMomentum(s,this._stopVelocity,this._friction)}createMomentum(e,i,r){const n=this._time.filteredDelta,s=this._angle1.filteredValue,o=this._angle2.filteredValue,a=n==null||o==null?0:o/n;return new lXe(e,i,r,n==null||s==null?0:s/n,this._axis1,a,this._axis2)}},Pbe=class{constructor(e=2.5,i=.01,r=.95,n=12){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this._maxVelocity=n,this.enabled=!0,this.value=new Td(.8),this.time=new Td(.3)}add(e,i){if(this.enabled&&i!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(i)<.01)return;if(this.value.hasFilteredDelta()){const r=this.value.computeDelta(e);this.value.filteredDelta*r<0&&this.value.reset()}}this.time.update(i),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=_e(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,i,r){return new HF(e,i,r)}},Mbe=class extends Pbe{constructor(e=3,i=.01,r=.95,n=12){super(e,i,r,n)}add(e,i){const r=this.value.lastValue;if(r!=null){let n=e-r;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;e=r+n}super.add(e,i)}},uXe=class extends HF{constructor(e,i,r){super(e,i,r)}value(e){const i=super.value(e);return Math.exp(i)}valueDelta(e,i){const r=super.value(e),n=super.value(e+i)-r;return Math.exp(n)}},$be=class extends Pbe{constructor(e=2.5,i=.01,r=.95,n=12){super(e,i,r,n)}add(e,i){super.add(Math.log(e),i)}createMomentum(e,i,r){return new uXe(e,i,r)}},UG=class extends mf{constructor(){super(...arguments),this._smoothRotation=new qN(.05),this._rotationAxis=C(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=Ti(),this._beginRadius=0,this._smoothScaling=new qN(.05),this._zoomCenterScreen=Zr(),this._zoomMomentumEstimator=new $be,this._rotationMomentumEstimator=new Mbe,this._panSphericalMomentumEstimator=new cXe,this._panPlanarMomentumEstimator=new Rbe,this._adjustedSphere=xn(),this._tmp3d=C(),this._tmpScreenPointArray=Zr(),this._beginScreenPoint=Zr(),this._beginScenePoint=C(),this._screenPickPoint=Zr(),this._scenePickPoint=C(),this._mode=Bs.Horizontal,this._sphere=xn(),this._pointerCount=0,this._tmpInteractionDirection=C(),this._constraintOptions={selection:Ar.ALL,interactionType:qt.NONE,interactionFactor:0,interactionStartCamera:new ht,interactionDirection:null,tiltMode:js.TUMBLE}}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const i=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=i,this._rotationMomentumEstimator.enabled=i,this._panPlanarMomentumEstimator.enabled=i,this._panSphericalMomentumEstimator.enabled=i,this._beginHeading=-i_.normalize(Rt(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),Ed(e.center,this._screenPickPoint),Yn(this._beginScreenPoint,this._screenPickPoint);const r=Fi(this.view.spatialReference),n=ube(this._intersectionHelper,this.startCamera,this._screenPickPoint,r,cS.Silhouette,this.view.map.ground.opacity===0?mw:{});n.scenePickPoint!=null&&(this._scenePickPoint=n.scenePickPoint,this._sphere=n.sphere,se(this._beginScenePoint,this._scenePickPoint),this._mode=GF(this.startCamera,this._screenPickPoint,r),this._mode===Bs.Vertical&&this._preparePlanarPanMode(e,n.hasGeometryIntersection),this._constraintOptions.interactionStartCamera?.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1;this._mode===Bs.Horizontal?(i&&this._zoomSpherical(e),this._panningSpherical(e),i&&this._rotateSpherical(e)):(i&&this._zoomPlanar(e),this._panningPlanar(e),i&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return this._mode===Bs.Horizontal?new l1({view:this.view,momentum:i,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new H2({view:this.view,momentum:i,zoomCenter:this._beginScenePoint});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new R1({view:this.view,momentum:r,center:this._sphere,axis:this._rotationAxis});if(this._mode===Bs.Horizontal){const n=this._panSphericalMomentumEstimator.evaluateMomentum();if(n)return new IL({view:this.view,momentum:n})}else{const n=this._panPlanarMomentumEstimator.evaluateMomentum();if(n)return new u3({view:this.view,momentum:n})}return null}_preparePlanarPanMode(e,i){const r=na(this._tmp3d,this.startCamera.viewForward);xR(this._scenePickPoint,r,this._panningPlane);const n=Zr(this._screenPickPoint[0],0),s=C(),o=we(this.startCamera.eye);this._adjustedSphere[3]=o<this._sphere[3]?o-100:this._sphere[3],xO(this._adjustedSphere,this.startCamera,n,s);const a=Mo();this.startCamera.projectToRenderScreen(s,a);const l=C(),c=C(),u=C();he(l,this._scenePickPoint,this.currentCamera.eye);const d=we(l);ge(l,l);const p=obe*Math.max(Math.abs(this.view.camera.position.z),abe),m=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,VF);let y=m??p;y=i?Math.min(y,d):y,se(u,ce(c,this.currentCamera.eye,te(c,l,y))),this._panningPlane[3]=-me(this._panningPlane,u),this.startCamera.center=ce(c,this.startCamera.eye,te(c,this.startCamera.viewForward,y));const _=Ed(e.center,this._tmpScreenPointArray);DG(this._panningPlane,this.startCamera,_,this._beginScenePoint)}_zoomSpherical(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),lbe(this._sphere,this.currentCamera,this._smoothScaling.value),Ed(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=qt.ZOOM,this._constraintOptions.interactionFactor=xd(e.radius-this._beginRadius),$n(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const i=Ed(e.center,this._tmpScreenPointArray);xO(this._sphere,this.currentCamera,i,this._tmp3d),JY(this._beginScenePoint,me(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(gbe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(mbe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=qt.PAN,this._constraintOptions.interactionFactor=xd(a_(this._screenPickPoint,i)),$n(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){ge(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||na(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value,r=i+LG(e.angle-i),n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(r);const s=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(s,.001*e.timestamp),f_(this.currentCamera,this._sphere,wO(this._rotationAxis,s)),this._constraintOptions.interactionType=qt.TUMBLE,this._constraintOptions.interactionFactor=xd(e.radius*r),$n(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const i=Ed(e.center,this._tmpScreenPointArray);DG(this._panningPlane,this.currentCamera,i,this._tmp3d)&&(hbe(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(i,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=qt.PAN,this._constraintOptions.interactionFactor=xd(a_(this._beginScreenPoint,i)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),$n(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),ZY(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=qt.ZOOM,this._constraintOptions.interactionFactor=xd(e.radius-this._beginRadius),$n(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){se(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||na(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value;let r=e.angle-i;r=LG(r);const n=i+r,s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(n);const o=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(o,.001*e.timestamp),f_(this.currentCamera,this._sphere,wO(this._rotationAxis,o)),this._constraintOptions.interactionType=qt.TUMBLE,this._constraintOptions.interactionFactor=xd(e.radius*o),$n(this.view,this.currentCamera,this._constraintOptions)}};UG=h([z("esri.views.3d.state.controllers.global.PinchAndPanController")],UG);const Hie=Ce(0,0,1),hXe={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI};let zG=class extends mf{constructor(){super(...arguments),this._rotationValueSmooth=new qN(.05),this._scalingValueSmooth=new qN(.05),this._planeHorizontal=Ti(),this._planeVertical=Ti(),this._rotationMomentumEstimator=new Mbe,this._panMomentumEstimator=new Rbe(300,12,.9),this._zoomMomentumEstimator=new $be,this._beginRadius=0,this._beginCenter=C(),this._beginAngle=0,this._tmpPoints=[],this._panMode=Bs.Horizontal,this._beginCenterScreen=Zr(),this._tmpCentroid3d=C(),this._tmpCentroid2d=Zr(),this._tmp2d=Zr(),this._pointerCount=0,this._constraintOptions={selection:Ar.ALL,interactionType:qt.NONE,interactionFactor:0,interactionStartCamera:new ht,interactionDirection:null,tiltMode:js.TUMBLE}}begin(e){if(!this.active)return;const i=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=i,this._rotationMomentumEstimator.enabled=i,this._panMomentumEstimator.enabled=i,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),Ed(e.center,this._beginCenterScreen),G0e(Hie,0,this._planeHorizontal);const r=C(),n=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,r,this.view.map.ground.opacity===0?mw:{}),s=C();na(s,this.startCamera.viewForward);const o=C();se(o,Hie);const a=me(s,o),l=dh(a<0?-a:a);this._panMode=l>=hXe.ANGLE_THRESHOLD?Bs.Horizontal:Bs.Vertical;const c=Math.min(obe,1/Math.abs(me(o,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),abe);KV(this._planeHorizontal,this._planeHorizontal,r),this.startCamera.aboveGround||QV(this._planeHorizontal,this._planeHorizontal);const u=C(),d=C(),p=C();he(u,r,this.currentCamera.eye);const m=we(u);if(ge(u,u),this._panMode===Bs.Vertical){te(o,o,a),he(this._planeVertical,s,o),ge(this._planeVertical,this._planeVertical),KV(this._planeVertical,this._planeVertical,r);const y=this.view._stage.renderView.getMinimalDepthForArea(TO(this.view),this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,VF);let _=y??c;_=n?Math.min(_,m):_,se(p,ce(d,this.currentCamera.eye,te(d,u,_))),this._planeVertical[3]=-me(this._planeVertical,p),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),gU(this._tmpPoints,this._beginCenter)}else{const y=n?m:c;se(p,ce(d,this.currentCamera.eye,te(d,u,y))),this._planeHorizontal[3]=-me(this._planeHorizontal,p),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),gU(this._tmpPoints,this._beginCenter)}this._constraintOptions.interactionStartCamera?.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1,r=this._panMode===Bs.Horizontal?this._planeHorizontal:this._planeVertical,n=this._beginCenter;if(i){const s=this._beginRadius/e.radius,o=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=o,this._scalingValueSmooth.update(s),ZY(this.currentCamera,n,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=qt.ZOOM,this._constraintOptions.interactionFactor=xd(Math.abs(e.radius-this._beginRadius)),$n(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,r,this.currentCamera,this._tmpPoints),gU(this._tmpPoints,this._tmpCentroid3d),Ed(e.center,this._tmpCentroid2d),hbe(this.currentCamera,n,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=qt.PAN,this._constraintOptions.interactionFactor=xd(a_(this._beginCenterScreen,this._tmpCentroid2d)),$n(this.view,this.currentCamera,this._constraintOptions),i){const s=this._planeHorizontal,o=n,a=this._rotationValueSmooth.value,l=a+LG(e.angle-a),c=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=c,this._rotationValueSmooth.update(l);const u=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(u,.001*e.timestamp),f_(this.currentCamera,o,wO(s,u)),this._constraintOptions.interactionType=qt.TUMBLE,this._constraintOptions.interactionFactor=xd(Math.abs(e.radius*u)),$n(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return new H2({view:this.view,momentum:i,zoomCenter:this._beginCenter});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new R1({view:this.view,momentum:r,center:this._beginCenter,axis:this._planeHorizontal});const n=this._panMomentumEstimator.evaluateMomentum();return n?new u3({view:this.view,momentum:n}):null}_computePlanePoints(e,i,r,n){n.length=e.size;const s=this._tmp2d;let o=0;return e.forEach(a=>{s[0]=a.x,s[1]=a.y,n[o]===void 0&&(n[o]=C()),DG(i,r,s,n[o]),o+=1}),n}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};zG=h([z("esri.views.3d.state.controllers.local.PinchAndPanController")],zG);let qie=class extends go{constructor(e,i,r){super(!0),this._view=e,this.pointerAction=i,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",r,n=>this._handleDrag(n))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!QY(e.data,this.pointerAction))return;const i=e.timestamp-this._lastEndTimestamp,r=40,n=this._momentum&&this._momentum.active&&i<r;switch(e.data.action){case"start":case"update":if(n)break;this._controller&&this._controller.active?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,i){if(this._controller&&this._controller.active){this._lastEndTimestamp=e.timestamp;const r=this._controller.end(e.data);i&&r&&(this._momentum=r,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new UG({view:this._view}):new zG({view:this._view})}},dXe=class extends go{constructor(e,i){super(!0),this.view=e,this.registerIncoming("pointer-down",i,()=>this.view.state.stopActiveCameraController())}},Ibe=class extends go{constructor(e,i){super(!0),this.key=e,this.registerIncoming("key-down",i,r=>this._handleKeyDown(r))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}},pXe=class extends Ibe{constructor(e,i,r){super(i,r),this.view=e}activate(){this.view.goTo({heading:0}).catch(()=>{})}},fXe=class extends Ibe{constructor(e,i,r){super(i,r),this.view=e}activate(){this.view.goTo({tilt:0}).catch(()=>{})}},mXe=class extends go{constructor(e,i=!1){super(!0),this._view=e,this._invert=i,this.registerIncoming("vertical-two-finger-drag",r=>this._handleTwoFinger(r))}_handleTwoFinger(e){const i=this._invert?-1:1,r=Zr(0,e.data.delta*i);switch(e.data.action){case"begin":this._cameraController?.end(),this._cameraController=new c3({view:this._view,pivot:Vl.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController?.update(r);break;case"end":this._cameraController?.end(),this._cameraController=null}}};function Wie(t){const e=t.native;return e?{buttons:e.buttons.map(i=>i.pressed?i.value||1:0),axes:e.axes.map(i=>_Xe(i,t.axisThreshold))}:{buttons:[],axes:[]}}function gXe(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let i=0;i<t.axes.length;i++)if(t.axes[i]!==e.axes[i])return!1;for(let i=0;i<t.buttons.length;i++)if(t.buttons[i]!==e.buttons[i])return!1;return!0}function yXe(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function _Xe(t,e){const i=Math.abs(t);return i<e?0:Math.sign(t)*(i-e)/(1-e)}let vXe=class{constructor(e,i){this._element=e,this._input=i,this._hasEventListeners=!1,this._onConnectGamepad=s=>{this._connectGamepad(s.gamepad)},this._onDisconnectGamepad=s=>{const o=s.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,Wie(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const r="getGamepads"in window.navigator,n=window.isSecureContext;this.supported=r&&n,this.supported&&(this._forEachGamepad(s=>this._connectGamepad(s)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const i=new sY(e);i.deviceType!=="unknown"&&(this._inputDevices[e.index]=i,this._input.gamepad.devices.add(i)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=fb({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),i=this._element.contains(document.activeElement),r=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!i;this._forEachGamepad(n=>{const s=this._inputDevices[n.index];if(!s)return;const o=this._latestUpdate[n.index],a=Wie(s),l=r||yXe(a);o&&(o.timestamp===n.timestamp||!o.active&&l||gXe(o.state,a))||this._emitGamepadEvent(n,a,!l)})}_forEachGamepad(e){const i=window.navigator.getGamepads();for(let r=0;r<i.length;r++){const n=i[r];this._validate(n)&&e(n)}}_emitGamepadEvent(e,i,r){const n=this._latestUpdate[e.index],s=n&&n.active;if(!s&&!r)return;const o=!s&&r?"start":s&&r?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:i,active:r},this._callback&&this._callback({device:this._inputDevices[e.index],state:i,action:o})}_validate(e){if(!e||!e.connected)return!1;for(let i=0;i<e.axes.length;i++)if(isNaN(e.axes[i]))return!1;return!0}};const Yie=ie("edge"),bXe=ie("chrome"),wXe=ie("ff"),xXe=ie("safari"),Xie="esri-view-surface",Jw={touchNone:`${Xie}--touch-none`,touchPan:`${Xie}--touch-pan`};let Lbe=class Dbe{constructor(e,i){this._input=i,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new vXe(e,this._input),this._gamepadSource.onEvent=r=>this._callback("gamepad",r)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=Pe(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const i in this._active)if(!e||!e.has(i)){const r=this._active[i];this._element.removeEventListener(OU[i],r),delete this._active[i]}e&&e.forEach(i=>{if(!this._active[i]&&OU[i]){const r=(this._eventHandlers[i]||this._handleDefault).bind(this,i);this._element.addEventListener(OU[i],r),this._active[i]=r}}),this._gamepadSource.hasEventListeners=e?.has("gamepad")??!1}setPointerCapture(e,i){i?this._setPointerCatpureSafe(e.pointerId):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?Jw.touchNone:Jw.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?Jw.touchPan:Jw.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(Jw.touchNone),this._element.classList.remove(Jw.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(e){try{this._element.setPointerCapture(e),this._activePointerCaptures.add(e)}catch{}}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,i){const r=$_e(this._element,e);return Dbe.test.disableSubpixelCoordinates&&(r.x=Math.round(r.x),r.y=Math.round(r.y)),i.x=r.x,i.y=r.y,i}_handleKey(e,i){const r=oVe(i);r&&e==="key-up"&&this._keyDownState.delete(r);const n={native:i,key:r,repeat:!!r&&this._keyDownState.has(r)};r&&e==="key-down"&&this._keyDownState.add(n.key),this._callback(e,n)}_handlePointer(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});this._callback(e,r)}_handlePointerPreventDefault(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});i.preventDefault(),this._callback(e,r)}_handleMouseWheel(e,i){let r=i.deltaY;switch(i.deltaMode){case 0:Yie&&(r=r/document.documentElement.clientHeight*600);break;case 1:r*=30;break;case 2:r*=900}Yie?r*=.7:bXe||xXe?r*=.6:wXe&&(r*=1.375);const n=100,s=Math.abs(r);s>n&&(r=r/s*200/(1+Math.exp(-.02*(s-n))));const o=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,deltaY:r});this._callback(e,o)}_handlePointerCaptureLost(e,i){this._activePointerCaptures.delete(i.pointerId),this._handleDefault(e,i)}_handleDefault(e,i){const r={native:i};i.preventDefault(),this._callback(e,r)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};Lbe.test={disableSubpixelCoordinates:!1};const OU={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let TXe=class extends go{constructor(){super(!0),this.registerIncoming("context-menu",e=>{e.data.native.preventDefault()})}};const Wc={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500,maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};function BG(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function SXe(t,e){const i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)}function EXe(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:ph()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[T,S]=t,[E,A]=[S.x-T.x,S.y-T.y];return e.radius=Math.sqrt(E*E+A*A)/2,e.center.x=(T.x+S.x)/2,e.center.y=(T.y+S.y)/2,e}let i=0,r=0;for(let T=0;T<t.length;T++)i+=t[T].x,r+=t[T].y;i/=t.length,r/=t.length;const n=t.map(T=>T.x-i),s=t.map(T=>T.y-r);let o=0,a=0,l=0,c=0,u=0,d=0,p=0;for(let T=0;T<n.length;T++){const S=n[T],E=s[T],A=S*S,P=E*E;o+=A,a+=P,l+=S*E,c+=A*S,u+=P*E,d+=S*P,p+=E*A}const m=.5*(c+d),y=.5*(u+p),_=o*a-l*l,v=(m*a-y*l)/_,w=(o*y-l*m)/_,x=ph(v+i,w+r);return{radius:Math.sqrt(v*v+w*w+(o+a)/t.length),center:x}}function h3(t){const{native:e}=t,{pointerId:i,button:r,pointerType:n}=e;return n==="mouse"?`${i}:${r}`:`${n}`}let CXe=class extends go{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,i,r,n){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:i.buttons,timestamp:n,pointers:AXe(this._activePointerMap),pointer:i,angle:r.angle,radius:r.radius,center:r.center}}_addPointer(e){const i=e.native.pointerId,r=BM(this._activePointerMap).angle,n={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(i,n);const s=LL(n,Nbe(this._activePointerMap));n.initialAngle=s,n.lastAngle=s,this._updatePointerAngles(r)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const i=e.native.pointerId,r=this._activePointerMap.get(i);r?r.event=e:this._addPointer(e)}_removePointer(e){const i=BM(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(i)}_updatePointerAngles(e){const i=BM(this._activePointerMap);this._activePointerMap.forEach(r=>{r.initialAngle=LL(r,i)-e,r.lastAngle=LL(r,i)-e})}_emitEvent(e,i,r){const n=BM(this._activePointerMap);this._drag.emit(this._createPayload(e,i,n,r),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const i=e.data.native.pointerId,r=e.timestamp;this._activePointerMap.get(i)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,r),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(i)):(this._removePointer(i),this._emitEvent("removed",e.data,e.timestamp)))}_handlePointerDrag(e){const i=e.data,r=i.currentEvent,n=e.timestamp;switch(i.action){case"start":case"update":this._isDragging?this._activePointerMap.has(r.native.pointerId)?(this._updatePointer(r),!this._isCurrentDragSuppressed&&this._emitEvent("update",r,n)):(this._addPointer(r),this._emitEvent("added",r,n),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(r),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",r,n))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function Nbe(t){const e=[];return t.forEach(i=>{e.push(ph(i.event.x,i.event.y))}),EXe(e)}function BM(t){const e=Nbe(t);let i=0;return t.forEach(r=>{let n=LL(r,e),s=n-r.lastAngle;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;n=r.lastAngle+s,r.lastAngle=n;const o=n-r.initialAngle;i+=o}),i/=t.size||1,{angle:i,radius:e.radius,center:e.center}}function AXe(t){const e=new Map;return t.forEach((i,r)=>e.set(r,i.event)),e}function LL(t,e){const i=t.event,r=i.x-e.center.x,n=i.y-e.center.y;return Math.atan2(n,r)}var Zie;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"})(Zie||(Zie={}));let OXe=class extends go{constructor(e=Wc.maximumDoubleClickDelay,i=Wc.maximumDoubleClickDistance,r=Wc.maximumDoubleTouchDelay,n=Wc.maximumDoubleTouchDistance,s=QO){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=n,this._clock=s,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=h3(i);if(!this._pointerState.has(r)){const n={downButton:i.native.button,x:i.x,y:i.y,immediateDoubleClick:null};this._pointerState.set(r,n),this.startCapturingPointer(i.native)}}_handlePointerUp(e){const i=e.data,r=h3(i),n=this._pointerState.get(r);if(n&&n.downButton===i.native.button){const s=n.immediateDoubleClick,o=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;s?(s.timeoutHandle.remove(),BG(s,e.data)>o?this._startImmediateDoubleClick(e,n):(this._immediateDoubleClick.emit(e.data,void 0,s.modifiers),this._removeState(i))):BG(n,e.data)>o?this._removeState(i):this._startImmediateDoubleClick(e,n)}}_startImmediateDoubleClick(e,i){const r=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;i.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),r)}}_removeState(e){const i=h3(e);this._pointerState.delete(i),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}},RXe=class extends go{constructor(e=Wc.maximumClickDelay,i=Wc.movementUntilMouseDrag,r=Wc.movementUntilPenDrag,n=Wc.movementUntilTouchDrag,s=Wc.holdDelay,o=QO){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=i,this._movementUntilPenDrag=r,this._movementUntilTouchDrag=n,this._holdDelay=s,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=pr(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=i.native.pointerId;let n=null;this._pointerState.size===0&&(n=this._clock.setTimeout(()=>{const o=this._pointerState.get(r);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,e.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const s={startEvent:i,previousEvent:i,startTimestamp:e.timestamp,isDragging:!1,downButton:i.native.button,holdTimeout:n,modifiers:new Set};this._pointerState.set(r,s),this.startCapturingPointer(i.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_createPointerDragData(e,i,r){return{action:e,startEvent:i.startEvent,previousEvent:i.previousEvent,currentEvent:r}}_handlePointerMove(e){const i=e.data,r=i.native.pointerId,n=this._pointerState.get(r);n&&(n.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",n,i),void 0,n.modifiers):SXe(i,n.startEvent)>this._getDragThreshold(i.native.pointerType)&&this._startDragging(e),n.previousEvent=i)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const i=e.data,r=i.native.pointerId;this._pointerState.forEach(n=>{n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging||(n.modifiers=e.modifiers,n.isDragging=!0,r===n.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",n,i)):this._pointerDrag.emit(this._createPointerDragData("start",n,n.previousEvent),e.timestamp))})}_handlePointerLoss(e,i){const r=e.data,n=r.native.pointerId,s=this._pointerState.get(n);s&&(s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",s,i==="pointer-up"?r:s.previousEvent),void 0,s.modifiers):i==="pointer-up"&&s.downButton===r.native.button&&e.timestamp-s.startTimestamp<=this._maximumClickDelay&&!s.holdEmitted&&this._immediateClick.emit(r),this._pointerState.delete(n),this.stopCapturingPointer(r.native),this._pointerState.size===0&&this._moveHandle.pause())}},PXe=class extends go{constructor(e=Wc.maximumDoubleClickDelay,i=Wc.maximumDoubleClickDistance,r=Wc.maximumDoubleTouchDelay,n=Wc.maximumDoubleTouchDistance,s=QO){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=n,this._clock=s,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=pr(e.doubleClickTimer))}get hasPendingInputs(){return Hc(this._pointerState,e=>e.doubleClickTimer!=null)}_clearDoubleClickTimer(e,i){const r=this._pointerState.get(e);r&&(r.doubleClickTimer=pr(r.doubleClickTimer),i&&this._click.emit(r.event.data,void 0,r.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const i=this._pointerState.get(e);i.pointerDownCount===1&&this._click.emit(i.event.data,void 0,i.event.modifiers),i.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_getPointerId(e){const{pointerId:i,pointerType:r,button:n}=e.native;return r==="mouse"?`${i}:${n}`:`${r}`}_handleImmediateClick(e){const i=e.data,{pointerType:r}=i.native,n=this._getPointerId(i);if(!this._pointerState.has(n))return void this._startClick(e);const s=this._pointerState.get(n),{data:o,modifiers:a}=s.event,l=r==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;BG(o,i)>l?(this._clearDoubleClickTimer(n,!0),this._startClick(e)):(this._clearDoubleClickTimer(n,!1),s.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(e){const i=h3(e.data),r=this._pointerState.get(i);r&&(r.pointerDownCount+=1)}_startClick(e){const{data:i}=e,{native:{pointerType:r}}=i,n=h3(i),s=r==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(n),s),a=1;this._pointerState.set(n,{event:e,doubleClickTimer:o,pointerDownCount:a}),this.refreshHasPendingInputs()}},MXe=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const i=e.data,r=i.pointers.size;switch(i.action){case"start":this._currentCount=r,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){this._startEvent=e,this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},$Xe=class extends go{constructor(e=20,i=40){super(!1),this._threshold=e,this._maxDelta=i,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new MXe({start:(r,n)=>this._observeStart(r,n),update:(r,n,s)=>this._observeUpdate(r,n,s),end:(r,n)=>this._observeEnd(n)}),this.registerIncoming("drag",r=>this._dragEventSeparator.handle(r))}get failed(){return this._state==="failed"}_observeStart(e,i){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),i.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,i,r){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void i.stopPropagation()):void(this._checkMovementWithinLimits(i.data,r.data)?this._checkVerticalThresholdReached(i.data,r.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=i.data.center,this._artificalDrag.emit({action:"end",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),i.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,i){let r=-1/0,n=1/0,s=-1/0,o=1/0;for(const{x:_,y:v}of i.pointers.values())r=Math.max(r,_),n=Math.min(n,_),s=Math.max(s,v),o=Math.min(o,v);let a=-1/0,l=1/0,c=-1/0,u=1/0;for(const{x:_,y:v}of e.pointers.values())a=Math.max(a,_),l=Math.min(l,_),c=Math.max(c,v),u=Math.min(u,v);const d=r-n,p=s-o,m=a-l,y=c-u;return Math.abs(e.center.x-i.center.x)<this._threshold&&Math.abs(m-d)<=this._maxDelta&&Math.abs(y-p)<=this._maxDelta}_checkVerticalThresholdReached(e,i){let r=Math.abs(e.center.y-i.center.y);return e.pointers.forEach((n,s)=>{const o=i.pointers.get(s);r=Math.min(r,Math.abs(n.y-o.y))}),r>=this._threshold}},id=class extends xe{destroy(){this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get updating(){return!!this._inputManager?.updating}get latestPointerType(){return this._inputManager?.latestPointerType}get latestPointerLocation(){return this._inputManager?.latestPointerLocation}get multiTouchActive(){return this._inputManager?.multiTouchActive??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=Pe(this._inputManager)}connect(){const e=this.view;this._source=new Lbe(this.view.surface,e.input);const i=[new OXe,new RXe,new PXe,new CXe(this.view.navigation),new $Xe],r=new Nu({eventSource:this._source,recognizers:i});this._inputManager=r,r.installHandlers("prevent-context-menu",[new TXe],qy.INTERNAL),this._modeDragPan=new qie(e,"primary"),this._modeDragRotate=new CU(e,"secondary",Vl.CENTER),this._modeDragZoom=new YYe(e,"tertiary");const n={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};r.installHandlers("navigation",[new dXe(e),new fYe(e),new iXe(e),new nXe(e,n.pan),new sXe(e),new fXe(e,n.resetTilt),new pXe(e,n.resetHeading),new CU(e,"primary",Vl.EYE,[n.lookAround]),new CU(e,"secondary",Vl.CENTER,[n.lookAround]),new qie(e,"tertiary",[n.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new mXe(e)],qy.INTERNAL),this.view.viewEvents.connect(r),this._updateMode(),this.addHandles(le(()=>this.view.navigation?.browserTouchPanEnabled,s=>{this._source.browserTouchPanningEnabled=!s},Zi))}_updateMode(){const e=this.mode,i=this.primaryDragAction,r=VG.get(e)?.get(i);r&&(this._modeDragPan&&(this._modeDragPan.pointerAction=r.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=r.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=r.zoom))}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};h([f()],id.prototype,"view",void 0),h([f({value:"pan"})],id.prototype,"primaryDragAction",null),h([f({value:"default"})],id.prototype,"mode",null),h([f({readOnly:!0})],id.prototype,"updating",null),h([f()],id.prototype,"latestPointerType",null),h([f()],id.prototype,"latestPointerLocation",null),h([f()],id.prototype,"multiTouchActive",null),h([f()],id.prototype,"_inputManager",void 0),id=h([z("esri.views.3d.input.SceneInputManager")],id);const VG=new Map,RU=new Map,PU=new Map;RU.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),RU.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),PU.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),PU.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),VG.set("default",RU),VG.set("pro",PU);const IXe=id;let Cn=class extends xe{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};h([f()],Cn.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),h([f()],Cn.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),h([f()],Cn.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),h([f()],Cn.prototype,"DECONFLICTOR_SHOW_GRID",void 0),h([f()],Cn.prototype,"LABELS_SHOW_BORDER",void 0),h([f()],Cn.prototype,"TEXT_SHOW_BASELINE",void 0),h([f()],Cn.prototype,"TEXT_SHOW_BORDER",void 0),h([f()],Cn.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),h([f()],Cn.prototype,"OVERLAY_SHOW_CENTER",void 0),h([f()],Cn.prototype,"SHOW_POI",void 0),h([f()],Cn.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),h([f()],Cn.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),h([f()],Cn.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),h([f()],Cn.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),h([f()],Cn.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),h([f()],Cn.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),h([f()],Cn.prototype,"I3S_TREE_SHOW_TILES",void 0),h([f()],Cn.prototype,"I3S_SHOW_MODIFICATIONS",void 0),h([f()],Cn.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),h([f()],Cn.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),h([f()],Cn.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),h([f()],Cn.prototype,"LINE_WIREFRAMES",void 0),Cn=h([z("esri.views.3d.support.DebugFlags")],Cn);const nr=new Cn;let kc,yT,GG=!1,jG=!1,HG=!1,qG=!1,d3=null;function LXe(t,e){if(!jG||!yT)return;Fbe();const i=yT;let r=0;for(let n=0;n<t.accBinsNumX;n++)for(let s=0;s<t.accBinsNumY;s++){const o=t.accBins[n][t.accBinsNumY-1-s];r+=o.length;const a=n*t.accBinsSizeX,l=(n+1)*t.accBinsSizeX,c=s*t.accBinsSizeY,u=(s+1)*t.accBinsSizeY;i.fillText(o.length.toFixed(),a+5,c+15),kbe(a,l,c,u,"blue")}i.fillText("total totalShownLabels: "+r,70,40),i.fillText("total visible labels: "+e.size,70,50),i.fillText("total numTests: "+t.accNumTests,70,30)}function DXe(t){HG=nr.DECONFLICTOR_SHOW_VISIBLE,qG=nr.DECONFLICTOR_SHOW_INVISIBLE,GG=HG||qG,jG=nr.DECONFLICTOR_SHOW_GRID,d3=null,GG||jG?d3=()=>NXe(t):kc&&(kc.parentElement.removeChild(kc),kc=null)}function Fbe(){d3&&(d3(),d3=null)}function NXe(t){kc==null&&(kc=document.createElement("canvas"),kc.setAttribute("id","debugCanvas2d"),t.surface.parentElement.style.position="relative",t.surface.parentElement.appendChild(kc));const{state:e}=t,{camera:i,pixelRatio:r}=e,{width:n,height:s}=i,o=n*r,a=s*r;kc.setAttribute("width",`${o}px`),kc.setAttribute("height",`${a}px`),kc.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${n}px;height:${s}px`),yT=kc.getContext("2d"),yT.clearRect(0,0,n,s),yT.font="12px Arial"}function kbe(t,e,i,r,n){Fbe();const s=kc.height,o=yT;o.beginPath(),o.lineWidth=1,o.strokeStyle=n,o.moveTo(t,s-i),o.lineTo(e,s-i),o.stroke(),o.lineTo(e,s-r),o.stroke(),o.lineTo(e,s-i),o.stroke(),o.lineTo(t,s-i),o.stroke(),o.lineTo(t,s-i),o.stroke(),o.closePath()}function FXe(t,e){GG&&(e&&HG||!e&&qG)&&kbe(t.aabr[0],t.aabr[2],t.aabr[1],t.aabr[3],e?"green":"red")}var Ro,Us;(function(t){t[t.USER=1]="USER",t[t.SCALE_RANGE=2]="SCALE_RANGE",t[t.FILTER=4]="FILTER",t[t.DECONFLICTION=8]="DECONFLICTION",t[t.ALL_GRAPHIC=15]="ALL_GRAPHIC",t[t.ALL_LABEL=255]="ALL_LABEL"})(Ro||(Ro={})),function(t){t[t.GRAPHIC=1]="GRAPHIC",t[t.LABEL=16]="LABEL"}(Us||(Us={}));function Ube(t,e){return new Vbe(t,jbe,e)}function kXe(t,e){const{curvatureDependent:i,scaleStart:r,scaleFallOffRange:n}=jbe;return new Vbe(t,{curvatureDependent:{min:{curvature:i.min.curvature,tiltAngle:i.min.tiltAngle,scaleFallOffFactor:MU.curvatureDependent.min.scaleFallOffFactor},max:{curvature:i.max.curvature,tiltAngle:i.max.tiltAngle,scaleFallOffFactor:MU.curvatureDependent.max.scaleFallOffFactor}},scaleStart:r,scaleFallOffRange:n,minPixelSize:MU.minPixelSize},e)}function UXe(t){return Math.abs(t*t*t)}function zbe(t,e,i){const r=i.parameters;return $U.scale=Math.min(r.divisor/(e-r.offset),1),$U.factor=UXe(t),$U}function rX(t,e){return _t(t*Math.max(e.scale,e.minScaleFactor),t,e.factor)}function zXe(t,e,i){const r=zbe(t,e,i);return r.minScaleFactor=0,rX(1,r)}function Jie(t,e,i,r){r.scale=zXe(t,e,i),r.factor=0,r.minScaleFactor=i.minScaleFactor}function Bbe(t,e,i=[0,0]){const r=Math.min(Math.max(e.scale,e.minScaleFactor),1);return i[0]=t[0]*r,i[1]=t[1]*r,i}function BXe(t,e,i,r){return rX(t,zbe(e,i,r))}let Vbe=class Gbe{get minScaleFactor(){return this._fontHeight!=null?Math.min(this._description.minPixelSize/this._fontHeight,1):0}constructor(e,i,r,n=VXe(),s){this._viewingMode=e,this._description=i,this._ellipsoidRadius=r,this.parameters=n,this._fontHeight=s,this._viewingMode===Me.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),!0)}overrideFontHeight(e){return e!==this._fontHeight?new Gbe(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,i,r){const{scaleStart:n,scaleFallOffRange:s}=this._description,{fovY:o,distance:a}=e,l=this._calculateCurvatureDependentParameters(e,i),c=this._coverageCompensation(e,i,l),{tiltAngle:u,scaleFallOffFactor:d}=l,p=Math.sin(u)*a,m=.5*Math.PI-u-o*(.5-n*c),y=p/Math.cos(m),_=m+o*s*c,v=(y-d*(p/Math.cos(_)))/(1-d);return r.camera.fovY=e.fovY,r.camera.distance=e.distance,r.offset=v,r.divisor=y-v,r}_calculateCurvatureDependentParametersLocal(e,i,r=Kie){return r.tiltAngle=this._description.curvatureDependent.min.tiltAngle,r.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,r}_calculateCurvatureDependentParametersGlobal(e,i,r=Kie){const n=this._description.curvatureDependent,s=1+e.distance/i,o=Math.sqrt(s*s-1),[a,l]=[n.min.curvature,n.max.curvature],c=_e((o-a)/(l-a),0,1),[u,d]=[n.min,n.max];return r.tiltAngle=_t(u.tiltAngle,d.tiltAngle,c),r.scaleFallOffFactor=_t(u.scaleFallOffFactor,d.scaleFallOffFactor,c),r}_surfaceCoverageCompensationLocal(e,i,r){return(e.fovY-r.tiltAngle)/e.fovY}_surfaceCoverageCompensationGlobal(e,i,r){const n=i*i,s=r.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=e,l=a*a+n-2*Math.cos(s)*a*i,c=Math.sqrt(l),u=Math.sqrt(l-n);return(Math.acos(u/c)-Math.asin(i/(c/Math.sin(s)))+.5*o)/o}};const jbe={curvatureDependent:{min:{curvature:Rt(10),tiltAngle:Rt(12),scaleFallOffFactor:.5},max:{curvature:Rt(70),tiltAngle:Rt(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},MU={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function VXe(){return{camera:{distance:0,fovY:0},divisor:0,offset:0}}const $U={scale:0,factor:0,minScaleFactor:0},Kie={tiltAngle:0,scaleFallOffFactor:0};function GXe(t){return t instanceof Float32Array&&t.length>=16}function jXe(t){return Array.isArray(t)&&t.length>=16}function HXe(t){return GXe(t)||jXe(t)}const uS={unknown:1,inches:ao(1,"meters","inches"),feet:ao(1,"meters","feet"),"us-feet":ao(1,"meters","us-feet"),yards:ao(1,"meters","yards"),miles:ao(1,"meters","miles"),"nautical-miles":ao(1,"meters","nautical-miles"),millimeters:ao(1,"meters","millimeters"),centimeters:ao(1,"meters","centimeters"),decimeters:ao(1,"meters","decimeters"),meters:ao(1,"meters","meters"),kilometers:ao(1,"meters","kilometers"),"decimal-degrees":1/t$e(1,"meters",yi.radius)};var Qo,Qie;(function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"})(Qo||(Qo={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(Qie||(Qie={}));let nX=class{constructor(e){this.field=e}},qXe=class extends nX{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[Qo.Undefined,Qo.Undefined,Qo.Undefined]}},WXe=class extends nX{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}},YXe=class extends nX{constructor(e){super(e),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}},XXe=class{};function DE(t){return t!=null}function Kw(t){return typeof t=="number"}function qF(t){return typeof t=="string"}function ZXe(t){return t==null||qF(t)}function as(t,e){t&&t.push(e)}function JXe(t,e,i,r=be()){const n=t||0,s=e||0,o=i||0;return n!==0&&FT(r,r,-n/180*Math.PI),s!==0&&NT(r,r,s/180*Math.PI),o!==0&&M4(r,r,o/180*Math.PI),r}function b0(t,e,i,r,n){const s=t.minSize,o=t.maxSize;if(t.expression)return as(n,"Could not convert size info: expression not supported"),!1;if(t.useSymbolValue){const a=r.symbolSize[i];return e.minSize[i]=a,e.maxSize[i]=a,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=Qo.DefinedSize,!0}if(DE(t.field))return DE(t.stops)?t.stops.length===2&&Kw(t.stops[0].size)&&Kw(t.stops[1].size)?(ere(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,i),e.type[i]=Qo.DefinedSize,!0):(as(n,"Could not convert size info: stops only supported with 2 elements"),!1):Kw(s)&&Kw(o)&&DE(t.minDataValue)&&DE(t.maxDataValue)?(ere(s,o,t.minDataValue,t.maxDataValue,e,i),e.type[i]=Qo.DefinedSize,!0):t.valueUnit==="unknown"?(as(n,"Could not convert size info: proportional size not supported"),!1):uS[t.valueUnit]!=null?(e.minSize[i]=-1/0,e.maxSize[i]=1/0,e.offset[i]=0,e.factor[i]=1/uS[t.valueUnit],e.type[i]=Qo.DefinedSize,!0):(as(n,"Could not convert size info: scale-dependent size not supported"),!1);if(!DE(t.field)){if(t.stops?.[0]&&Kw(t.stops[0].size))return e.minSize[i]=t.stops[0].size,e.maxSize[i]=t.stops[0].size,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=Qo.DefinedSize,!0;if(Kw(s))return e.minSize[i]=s,e.maxSize[i]=s,e.offset[i]=s,e.factor[i]=0,e.type[i]=Qo.DefinedSize,!0}return as(n,"Could not convert size info: unsupported variant of sizeInfo"),!1}function ere(t,e,i,r,n,s){const o=Math.abs(r-i)>0?(e-t)/(r-i):0;n.minSize[s]=o>0?t:e,n.maxSize[s]=o>0?e:t,n.offset[s]=t-i*o,n.factor[s]=o}function KXe(t,e,i,r){if(t.normalizationField||t.valueRepresentation)return as(r,"Could not convert size info: unsupported property"),null;if(!ZXe(t.field))return as(r,"Could not convert size info: field is not a string"),null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return as(r,"Could not convert size info: multiple fields in use"),null}else e.size.field=t.field}else e.size=new qXe(t.field);let n;switch(t.axis){case"width":return n=b0(t,e.size,0,i,r),n?e:null;case"height":return n=b0(t,e.size,2,i,r),n?e:null;case"depth":return n=b0(t,e.size,1,i,r),n?e:null;case"width-and-depth":return n=b0(t,e.size,0,i,r),n&&b0(t,e.size,1,i,r),n?e:null;case null:case void 0:case"all":return n=b0(t,e.size,0,i,r),n=n&&b0(t,e.size,1,i,r),n=n&&b0(t,e.size,2,i,r),n?e:null;default:return as(r,`Could not convert size info: unknown axis "${t.axis}""`),null}}function QXe(t,e,i){for(let n=0;n<3;++n){let s=e.unitInMeters;t.type[n]===Qo.DefinedSize&&(s*=e.modelSize[n],t.type[n]=Qo.DefinedScale),t.minSize[n]=t.minSize[n]/s,t.maxSize[n]=t.maxSize[n]/s,t.offset[n]=t.offset[n]/s,t.factor[n]=t.factor[n]/s}let r;if(t.type[0]!==Qo.Undefined)r=0;else if(t.type[1]!==Qo.Undefined)r=1;else{if(t.type[2]===Qo.Undefined)return as(i,"No size axis contains a valid size or scale"),!1;r=2}for(let n=0;n<3;++n)t.type[n]===Qo.Undefined&&(t.minSize[n]=t.minSize[r],t.maxSize[n]=t.maxSize[r],t.offset[n]=t.offset[r],t.factor[n]=t.factor[r],t.type[n]=t.type[r]);return!0}function tre(t,e,i){t[4*e]=i.r/255,t[4*e+1]=i.g/255,t[4*e+2]=i.b/255,t[4*e+3]=i.a}function eZe(t,e,i){if(t.normalizationField)return as(i,"Could not convert color info: unsupported property"),null;if(qF(t.field)){if(!t.stops)return as(i,"Could not convert color info: missing stops or colors"),null;{if(t.stops.length>8)return as(i,"Could not convert color info: too many color stops"),null;e.color=new WXe(t.field);const r=t.stops;for(let n=0;n<8;++n){const s=r[Math.min(n,r.length-1)];e.color.values[n]=s.value,tre(e.color.colors,n,s.color)}}}else{if(!(t.stops&&t.stops.length>=0))return as(i,"Could not convert color info: no field and no colors/stops"),null;{const r=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let n=0;n<8;n++)e.color.values[n]=1/0,tre(e.color.colors,n,r)}}return e}function tZe(t,e,i){if(t.normalizationField)return as(i,"Could not convert opacity info: unsupported property"),null;if(qF(t.field)){if(!t.stops)return as(i,"Could not convert opacity info: missing stops or opacities"),null;{if(t.stops.length>8)return as(i,"Could not convert opacity info: too many opacity stops"),null;e.opacity=new YXe(t.field);const r=t.stops;for(let n=0;n<8;++n){const s=r[Math.min(n,r.length-1)];e.opacity.values[n]=s.value,e.opacity.opacityValues[n]=s.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return as(i,"Could not convert opacity info: no field and no opacities/stops"),null;{const r=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let n=0;n<8;n++)e.opacity.values[n]=1/0,e.opacity.opacityValues[n]=r}}return e}function IU(t,e,i){const r=i===2&&t.rotationType==="arithmetic";e.offset[i]=r?90:0,e.factor[i]=r?-1:1,e.type[i]=1}function iZe(t,e,i){if(!qF(t.field))return as(i,"Could not convert rotation info: field is not a string"),null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return as(i,"Could not convert rotation info: multiple fields in use"),null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return IU(t,e.rotation,0),e;case"roll":return IU(t,e.rotation,1),e;case null:case void 0:case"heading":return IU(t,e.rotation,2),e;default:return as(i,`Could not convert rotation info: unknown axis "${t.axis}""`),null}}let IR=class{constructor(e,i=[1,1,1],r=[1,1,1],n=1,s=[0,0,0],o=[1,1,1],a=[0,0,0]){this.supports=e,this.modelSize=i,this.symbolSize=r,this.unitInMeters=n,this.anchor=s,this.scale=o,this.rotation=a}};function Hbe(t,e,i){if(!t)return null;const r=t.reduce((n,s)=>{if(!n)return n;if(s.valueExpression)return as(i,"Could not convert visual variables: arcade expressions not supported"),null;switch(s.type){case"size":return e.supports.size?KXe(s,n,e,i):n;case"color":return e.supports.color?eZe(s,n,i):n;case"opacity":return e.supports.opacity?tZe(s,n,i):null;case"rotation":return e.supports.rotation?iZe(s,n,i):n;default:return null}},new XXe);return!(t.length>0&&r)||r.size||r.color||r.opacity||r.rotation?r?.size&&!QXe(r.size,e,i)?null:r:null}let rZe=class{constructor(e,i,r){this.visualVariables=e,this.materialParameters=i,this.requiresShaderTransformation=r}};function hS(t,e){if(!t||nr.TESTS_DISABLE_FAST_UPDATES)return null;const i=Hbe(t.visualVariables,e);return i?new rZe(i,Wbe(i,e),!!i.size):null}function dS(t,e,i){if(!e||!t)return!1;const r=t.visualVariables,n=Hbe(e.visualVariables,i);return!!n&&!!(VM(r.size,n.size,"size")&&VM(r.color,n.color,"color")&&VM(r.rotation,n.rotation,"rotation")&&VM(r.opacity,n.opacity,"opacity"))&&(t.visualVariables=n,t.materialParameters=Wbe(n,i),t.requiresShaderTransformation=!!n.size,!0)}function VM(t,e,i){if(!!t!=!!e||t&&t.field!==e?.field)return!1;if(t&&i==="rotation"){const r=t,n=e;for(let s=0;s<3;s++)if(r.type[s]!==n.type[s]||r.offset[s]!==n.offset[s]||r.factor[s]!==n.factor[s])return!1}return!0}let qbe=class extends Ki{constructor(e){super(),this.vvSize=e?.size??null,this.vvColor=e?.color??null,this.vvOpacity=e?.opacity??null}};function Wbe(t,e){const i=new qbe(t);return i.vvSize&&(i.vvSymbolAnchor=e.anchor,fh(p3),JXe(e.rotation[2],e.rotation[0],e.rotation[1],p3),i.vvSymbolRotationMatrix=i.vvSymbolRotationMatrix||Hr(),gh(i.vvSymbolRotationMatrix,p3)),i}function nZe(t,e,i){if(!t.vvSize)return i;Nn(w0,i);const r=t.vvSymbolRotationMatrix;jf(p3,r[0],r[1],r[2],0,r[3],r[4],r[5],0,r[6],r[7],r[8],0,0,0,0,1),Di(w0,w0,p3);for(let n=0;n<3;++n){const s=t.vvSize.offset[n]+e[0]*t.vvSize.factor[n];ire[n]=_e(s,t.vvSize.minSize[n],t.vvSize.maxSize[n])}return lR(w0,w0,ire),yl(w0,w0,t.vvSymbolAnchor),w0}function sX(t,e,i){if(!e.vvSize)return oe(t,1,1,1),t;for(let r=0;r<3;++r){const n=e.vvSize.offset[r]+i[0]*e.vvSize.factor[r];t[r]=_e(n,e.vvSize.minSize[r],e.vvSize.maxSize[r])}return t}function zd(t,e){const i=t==null?0:e.attributes[t];return typeof i=="number"&&isFinite(i)?i:0}const w0=be(),ire=C(),p3=be();function oX(t){t.vertex.code.add(b`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(b`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`),t.vertex.code.add(b`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),t.vertex.code.add(b`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(b`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),t.vertex.code.add(b`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function sZe(t){t.uniforms.add(new $t("screenSizePerspective",e=>Ybe(e.screenSizePerspective)))}function WF(t){t.uniforms.add(new $t("screenSizePerspectiveAlignment",e=>Ybe(e.screenSizePerspectiveAlignment||e.screenSizePerspective)))}function Ybe(t){return oe(oZe,t.parameters.divisor,t.parameters.offset,t.minScaleFactor)}const oZe=C();function Xbe(t,e){const i=t.vertex;e.hasVerticalOffset?(Zbe(i),e.hasScreenSizePerspective&&(t.include(oX),WF(i),Xd(t.vertex,e)),i.code.add(b`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?b`vec3 worldNormal = normalize(worldPos + localOrigin);`:b`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?b`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:b`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):i.code.add(b`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const aZe=Kt();function Zbe(t){t.uniforms.add(new ai("verticalOffset",(e,i)=>{const{minWorldLength:r,maxWorldLength:n,screenLength:s}=e.verticalOffset,o=Math.tan(.5*i.camera.fovY)/(.5*i.camera.fullViewport[3]),a=i.camera.pixelRatio||1;return Mr(aZe,s*a,o,r,n)}))}const Jbe=.5;function Kbe(t,e){t.include(oX),t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.NORMAL,"vec3"),t.attributes.add(O.AUXPOS1,"vec4");const i=t.vertex;tc(i,e),Xd(i,e),i.uniforms.add(new ai("viewport",(r,n)=>n.camera.fullViewport),new Oe("polygonOffset",r=>r.shaderPolygonOffset),new Oe("cameraGroundRelative",(r,n)=>n.camera.aboveGround?1:-1)),e.hasVerticalOffset&&Zbe(i),i.constants.add("smallOffsetAngle","float",.984807753012208),i.code.add(b`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.code.add(b`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${e.multipassEnabled?b.float(0):b`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),e.draped&&!e.hasVerticalOffset||aS(i),e.draped||(i.uniforms.add(new Oe("perDistancePixelRatio",(r,n)=>Math.tan(n.camera.fovY/2)/(n.camera.fullViewport[2]/2))),i.code.add(b`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${b.float(Jbe)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),e.screenCenterOffsetUnitsEnabled&&HS(i),e.hasScreenSizePerspective&&WF(i),i.code.add(b`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offset of labels with respect to objects.
      // It also pulls the label towards the viewer so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective&&(e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${e.hasVerticalOffset?b`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled?"":b`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled?e.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)}const GM=ds();function Qbe(t,e,i,r,n,s){if(t.visible)if(t.boundingInfo){Ke(t.type===on.Mesh);const o=e.tolerance;ewe(t.boundingInfo,i,r,o,n,s)}else{const o=t.attributes.get(O.POSITION),a=o.indices;LR(i,r,0,a.length/3,a,o,void 0,n,s)}}const lZe=C();function ewe(t,e,i,r,n,s){if(t==null)return;const o=iwe(e,i,lZe);if(Lge(GM,t.bbMin),Dge(GM,t.bbMax),n?.applyToAabb(GM),lX(GM,e,o,r)){const{primitiveIndices:a,position:l}=t,c=a?a.length:l.indices.length/3;if(c>dZe){const u=t.getChildren();if(u!==void 0){for(const d of u)ewe(d,e,i,r,n,s);return}}LR(e,i,0,c,l.indices,l,a,n,s)}}const twe=C();function LR(t,e,i,r,n,s,o,a,l){if(o)return cZe(t,e,i,r,n,s,o,a,l);const{data:c,stride:u}=s,d=t[0],p=t[1],m=t[2],y=e[0]-d,_=e[1]-p,v=e[2]-m;for(let w=i,x=3*i;w<r;++w){let T=u*n[x++],S=c[T++],E=c[T++],A=c[T];T=u*n[x++];let P=c[T++],N=c[T++],F=c[T];T=u*n[x++];let D=c[T++],$=c[T++],R=c[T];a!=null&&([S,E,A]=a.applyToVertex(S,E,A,w),[P,N,F]=a.applyToVertex(P,N,F,w),[D,$,R]=a.applyToVertex(D,$,R,w));const k=P-S,B=N-E,j=F-A,X=D-S,M=$-E,I=R-A,G=_*I-M*v,q=v*X-I*y,Z=y*M-X*_,K=k*G+B*q+j*Z;if(Math.abs(K)<=Number.EPSILON)continue;const Q=d-S,de=p-E,Ae=m-A,st=Q*G+de*q+Ae*Z;if(K>0){if(st<0||st>K)continue}else if(st>0||st<K)continue;const vt=de*j-B*Ae,ot=Ae*k-j*Q,gt=Q*B-k*de,ze=y*vt+_*ot+v*gt;if(K>0){if(ze<0||st+ze>K)continue}else if(ze>0||st+ze<K)continue;const ue=(X*vt+M*ot+I*gt)/K;ue>=0&&l(ue,aX(k,B,j,X,M,I,twe),w,!1)}}function cZe(t,e,i,r,n,s,o,a,l){const{data:c,stride:u}=s,d=t[0],p=t[1],m=t[2],y=e[0]-d,_=e[1]-p,v=e[2]-m;for(let w=i;w<r;++w){const x=o[w];let T=3*x,S=u*n[T++],E=c[S++],A=c[S++],P=c[S];S=u*n[T++];let N=c[S++],F=c[S++],D=c[S];S=u*n[T];let $=c[S++],R=c[S++],k=c[S];a!=null&&([E,A,P]=a.applyToVertex(E,A,P,w),[N,F,D]=a.applyToVertex(N,F,D,w),[$,R,k]=a.applyToVertex($,R,k,w));const B=N-E,j=F-A,X=D-P,M=$-E,I=R-A,G=k-P,q=_*G-I*v,Z=v*M-G*y,K=y*I-M*_,Q=B*q+j*Z+X*K;if(Math.abs(Q)<=Number.EPSILON)continue;const de=d-E,Ae=p-A,st=m-P,vt=de*q+Ae*Z+st*K;if(Q>0){if(vt<0||vt>Q)continue}else if(vt>0||vt<Q)continue;const ot=Ae*X-j*st,gt=st*B-X*de,ze=de*j-B*Ae,ue=y*ot+_*gt+v*ze;if(Q>0){if(ue<0||vt+ue>Q)continue}else if(ue>0||vt+ue<Q)continue;const xt=(M*ot+I*gt+G*ze)/Q;xt>=0&&l(xt,aX(B,j,X,M,I,G,twe),x,!1)}}const rre=C(),nre=C();function aX(t,e,i,r,n,s,o){return oe(rre,t,e,i),oe(nre,r,n,s),nt(o,rre,nre),ge(o,o),o}function iwe(t,e,i){return oe(i,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}function lX(t,e,i,r){return cX(t,e,i,r,1/0)}function cX(t,e,i,r,n){const s=(t[0]-r-e[0])*i[0],o=(t[3]+r-e[0])*i[0];let a=Math.min(s,o),l=Math.max(s,o);const c=(t[1]-r-e[1])*i[1],u=(t[4]+r-e[1])*i[1];if(l=Math.min(l,Math.max(c,u)),l<0||(a=Math.max(a,Math.min(c,u)),a>l))return!1;const d=(t[2]-r-e[2])*i[2],p=(t[5]+r-e[2])*i[2];return l=Math.min(l,Math.max(d,p)),!(l<0)&&(a=Math.max(a,Math.min(d,p)),!(a>l)&&a<n)}function rwe(t,e,i,r,n){let s=(i.screenLength||0)*t.pixelRatio;n!=null&&(s=BXe(s,r,e,n));const o=s*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return _e(o*e,i.minWorldLength||0,i.maxWorldLength!=null?i.maxWorldLength:1/0)}function nwe(t,e){const i=e?nwe(e):{};for(const r in t){let n=t[r];n?.forEach&&(n=hZe(n)),n==null&&r in i||(i[r]=n)}return i}function uZe(t,e){let i=!1;for(const r in e){const n=e[r];n!==void 0&&(Array.isArray(n)?t[r]===null?(t[r]=n.slice(),i=!0):_H(t[r],n)&&(i=!0):t[r]!==n&&(i=!0,t[r]=n))}return i}function hZe(t){const e=[];return t.forEach(i=>e.push(i)),e}const swe={multiply:1,ignore:2,replace:3,tint:4},dZe=1e3;let $_=class extends PR{constructor(e,i){super(),this.type=on.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._vertexAttributeLocations=fi,this._pp0=Ce(0,0,1),this._pp1=Ce(0,0,0),this._parameters=nwe(e,i),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(e){return!1}setParameters(e,i=!0){uZe(this._parameters,e)&&(this.validateParameters(this._parameters),i&&this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleForOutput(e.output)&&(!this.parameters.isDecoration||e.bindParameters.decorations===Ql.ON)&&(this.parameters.renderOccluded&e.renderOccludedMask)!=0}isVisibleForOutput(e){return!0}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){this.repository?.materialChanged(this)}intersectDraped(e,i,r,n,s,o){return this._pp0[0]=this._pp1[0]=n[0],this._pp0[1]=this._pp1[1]=n[1],this.intersect(e,i,r,this._pp0,this._pp1,s)}},owe=class extends HHe{constructor(e,i,r){super(i,r),this.camera=e}};var Pr;(function(t){t[t.None=0]="None",t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"})(Pr||(Pr={}));let uX=class extends Ki{constructor(){super(...arguments),this.renderOccluded=Pr.Occlude,this.isDecoration=!1}},awe=class{constructor(){this.factor=new sre,this.factorAlignment=new sre}},sre=class{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}};function j$t(t,e,i,r=1){const{data:n,indices:s}=t,o=e.typedBuffer,a=e.typedBufferStride,l=s.length;if(i*=a,r===1)for(let c=0;c<l;++c)o[i]=n[s[c]],i+=a;else for(let c=0;c<l;++c){const u=n[s[c]];for(let d=0;d<r;d++)o[i]=u,i+=a}}function ore(t,e,i){const{data:r,indices:n}=t,s=e.typedBuffer,o=e.typedBufferStride,a=n.length;i*=o;for(let l=0;l<a;++l){const c=2*n[l];s[i]=r[c],s[i+1]=r[c+1],i+=o}}function lwe(t,e,i,r){const{data:n,indices:s}=t,o=e.typedBuffer,a=e.typedBufferStride,l=s.length;if(i*=a,r==null||r===1)for(let c=0;c<l;++c){const u=3*s[c];o[i]=n[u],o[i+1]=n[u+1],o[i+2]=n[u+2],i+=a}else for(let c=0;c<l;++c){const u=3*s[c];for(let d=0;d<r;++d)o[i]=n[u],o[i+1]=n[u+1],o[i+2]=n[u+2],i+=a}}function pS(t,e,i,r=1){const{data:n,indices:s}=t,o=e.typedBuffer,a=e.typedBufferStride,l=s.length;if(i*=a,r===1)for(let c=0;c<l;++c){const u=4*s[c];o[i]=n[u],o[i+1]=n[u+1],o[i+2]=n[u+2],o[i+3]=n[u+3],i+=a}else for(let c=0;c<l;++c){const u=4*s[c];for(let d=0;d<r;++d)o[i]=n[u],o[i+1]=n[u+1],o[i+2]=n[u+2],o[i+3]=n[u+3],i+=a}}function are(t,e,i){const r=t.typedBuffer,n=t.typedBufferStride;e*=n;for(let s=0;s<i;++s)r[e]=0,r[e+1]=0,r[e+2]=0,r[e+3]=0,e+=n}function hX(t,e,i,r,n=1){if(!e)return void lwe(t,i,r,n);const{data:s,indices:o}=t,a=i.typedBuffer,l=i.typedBufferStride,c=o.length,u=e[0],d=e[1],p=e[2],m=e[4],y=e[5],_=e[6],v=e[8],w=e[9],x=e[10],T=e[12],S=e[13],E=e[14];r*=l;let A=0,P=0,N=0;const F=L4(e)?D=>{A=s[D]+T,P=s[D+1]+S,N=s[D+2]+E}:D=>{const $=s[D],R=s[D+1],k=s[D+2];A=u*$+m*R+v*k+T,P=d*$+y*R+w*k+S,N=p*$+_*R+x*k+E};if(n===1)for(let D=0;D<c;++D)F(3*o[D]),a[r]=A,a[r+1]=P,a[r+2]=N,r+=l;else for(let D=0;D<c;++D){F(3*o[D]);for(let $=0;$<n;++$)a[r]=A,a[r+1]=P,a[r+2]=N,r+=l}}function dX(t,e,i,r,n=1){if(!e)return void lwe(t,i,r,n);const{data:s,indices:o}=t,a=e,l=i.typedBuffer,c=i.typedBufferStride,u=o.length,d=a[0],p=a[1],m=a[2],y=a[4],_=a[5],v=a[6],w=a[8],x=a[9],T=a[10],S=!_q(a),E=1e-6,A=1-E;r*=c;let P=0,N=0,F=0;const D=L4(a)?$=>{P=s[$],N=s[$+1],F=s[$+2]}:$=>{const R=s[$],k=s[$+1],B=s[$+2];P=d*R+y*k+w*B,N=p*R+_*k+x*B,F=m*R+v*k+T*B};if(n===1)if(S)for(let $=0;$<u;++$){D(3*o[$]);const R=P*P+N*N+F*F;if(R<A&&R>E){const k=1/Math.sqrt(R);l[r]=P*k,l[r+1]=N*k,l[r+2]=F*k}else l[r]=P,l[r+1]=N,l[r+2]=F;r+=c}else for(let $=0;$<u;++$)D(3*o[$]),l[r]=P,l[r+1]=N,l[r+2]=F,r+=c;else for(let $=0;$<u;++$){if(D(3*o[$]),S){const R=P*P+N*N+F*F;if(R<A&&R>E){const k=1/Math.sqrt(R);P*=k,N*=k,F*=k}}for(let R=0;R<n;++R)l[r]=P,l[r+1]=N,l[r+2]=F,r+=c}}function pZe(t,e,i,r,n=1){if(!e)return void pS(t,i,r,n);const{data:s,indices:o}=t,a=e,l=i.typedBuffer,c=i.typedBufferStride,u=o.length,d=a[0],p=a[1],m=a[2],y=a[4],_=a[5],v=a[6],w=a[8],x=a[9],T=a[10],S=!_q(a),E=1e-6,A=1-E;if(r*=c,n===1)for(let P=0;P<u;++P){const N=4*o[P],F=s[N],D=s[N+1],$=s[N+2],R=s[N+3];let k=d*F+y*D+w*$,B=p*F+_*D+x*$,j=m*F+v*D+T*$;if(S){const X=k*k+B*B+j*j;if(X<A&&X>E){const M=1/Math.sqrt(X);k*=M,B*=M,j*=M}}l[r]=k,l[r+1]=B,l[r+2]=j,l[r+3]=R,r+=c}else for(let P=0;P<u;++P){const N=4*o[P],F=s[N],D=s[N+1],$=s[N+2],R=s[N+3];let k=d*F+y*D+w*$,B=p*F+_*D+x*$,j=m*F+v*D+T*$;if(S){const X=k*k+B*B+j*j;if(X<A&&X>E){const M=1/Math.sqrt(X);k*=M,B*=M,j*=M}}for(let X=0;X<n;++X)l[r]=k,l[r+1]=B,l[r+2]=j,l[r+3]=R,r+=c}}function cwe(t,e,i,r,n=1){const{data:s,indices:o}=t,a=i.typedBuffer,l=i.typedBufferStride,c=o.length;if(r*=l,e!==s.length||e!==4)if(n!==1)if(e!==4)for(let u=0;u<c;++u){const d=3*o[u];for(let p=0;p<n;++p)a[r]=s[d],a[r+1]=s[d+1],a[r+2]=s[d+2],a[r+3]=255,r+=l}else for(let u=0;u<c;++u){const d=4*o[u];for(let p=0;p<n;++p)a[r]=s[d],a[r+1]=s[d+1],a[r+2]=s[d+2],a[r+3]=s[d+3],r+=l}else{if(e===4){for(let u=0;u<c;++u){const d=4*o[u];a[r]=s[d],a[r+1]=s[d+1],a[r+2]=s[d+2],a[r+3]=s[d+3],r+=l}return}for(let u=0;u<c;++u){const d=3*o[u];a[r]=s[d],a[r+1]=s[d+1],a[r+2]=s[d+2],a[r+3]=255,r+=l}}else{a[r]=s[0],a[r+1]=s[1],a[r+2]=s[2],a[r+3]=s[3];const u=new Uint32Array(i.typedBuffer.buffer,i.start),d=l/4,p=u[r/=4];r+=d;const m=c*n;for(let y=1;y<m;++y)u[r]=p,r+=d}}function fZe(t,e,i){const{data:r,indices:n}=t,s=e.typedBuffer,o=e.typedBufferStride,a=n.length,l=r[0];i*=o;for(let c=0;c<a;++c)s[i]=l,i+=o}function uwe(t,e,i,r,n=1){const s=e.typedBuffer,o=e.typedBufferStride;if(r*=o,n===1)for(let a=0;a<i;++a)s[r]=t[0],s[r+1]=t[1],s[r+2]=t[2],s[r+3]=t[3],r+=o;else for(let a=0;a<i;++a)for(let l=0;l<n;++l)s[r]=t[0],s[r+1]=t[1],s[r+2]=t[2],s[r+3]=t[3],r+=o}function mZe(t,e,i,r,n,s){for(const o of e.fields.keys()){const a=t.attributes.get(o),l=a?.indices;if(a&&l)hwe(o,a,i,r,n,s);else if(o===O.OBJECTANDLAYERIDCOLOR&&t.objectAndLayerIdColor!=null){const c=t.attributes.get(O.POSITION)?.indices;if(c){const u=c.length,d=n.getField(o,la);uwe(t.objectAndLayerIdColor,d,u,s)}}}}function hwe(t,e,i,r,n,s){switch(t){case O.POSITION:{Ke(e.size===3);const o=n.getField(t,ws);Ke(!!o,`No buffer view for ${t}`),o&&hX(e,i,o,s);break}case O.NORMAL:{Ke(e.size===3);const o=n.getField(t,ws);Ke(!!o,`No buffer view for ${t}`),o&&dX(e,r,o,s);break}case O.NORMALCOMPRESSED:{Ke(e.size===2);const o=n.getField(t,RR);Ke(!!o,`No buffer view for ${t}`),o&&ore(e,o,s);break}case O.UV0:{Ke(e.size===2);const o=n.getField(t,dw);Ke(!!o,`No buffer view for ${t}`),o&&ore(e,o,s);break}case O.COLOR:case O.SYMBOLCOLOR:{const o=n.getField(t,la);Ke(!!o,`No buffer view for ${t}`),Ke(e.size===3||e.size===4),!o||e.size!==3&&e.size!==4||cwe(e,e.size,o,s);break}case O.COLORFEATUREATTRIBUTE:{const o=n.getField(t,PF);Ke(!!o,`No buffer view for ${t}`),Ke(e.size===1),o&&e.size===1&&fZe(e,o,s);break}case O.TANGENT:{Ke(e.size===4);const o=n.getField(t,Zd);Ke(!!o,`No buffer view for ${t}`),o&&pZe(e,r,o,s);break}case O.PROFILERIGHT:case O.PROFILEUP:case O.PROFILEVERTEXANDNORMAL:case O.FEATUREVALUE:{Ke(e.size===4);const o=n.getField(t,Zd);Ke(!!o,`No buffer view for ${t}`),o&&pS(e,o,s)}}}let H$t=class extends Ki{constructor(e){super(),this.slicePlaneLocalOrigin=e}};function gZe(t,e){dwe(t,e,new $t("slicePlaneOrigin",(i,r)=>gwe(e,i,r)),new $t("slicePlaneBasis1",(i,r)=>WN(e,i,r,r.slicePlane?.basis1)),new $t("slicePlaneBasis2",(i,r)=>WN(e,i,r,r.slicePlane?.basis2)))}function vn(t,e){dwe(t,e,new nu("slicePlaneOrigin",(i,r)=>gwe(e,i,r)),new nu("slicePlaneBasis1",(i,r)=>WN(e,i,r,r.slicePlane?.basis1)),new nu("slicePlaneBasis2",(i,r)=>WN(e,i,r,r.slicePlane?.basis2)))}function dwe(t,e,...i){if(!e.hasSlicePlane){const o=b`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return e.hasSliceInVertexProgram&&t.vertex.code.add(o),void t.fragment.code.add(o)}e.hasSliceInVertexProgram&&t.vertex.uniforms.add(...i),t.fragment.uniforms.add(...i);const r=b`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,n=b`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,s=e.hasSliceHighlight?b`
        ${n}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:b`#define highlightSlice(_color_, _pos_) (_color_)`;e.hasSliceInVertexProgram&&t.vertex.code.add(r),t.fragment.code.add(r),t.fragment.code.add(s)}function pwe(t,e,i){return t.instancedDoublePrecision?oe(yZe,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function fwe(t,e){return t!=null?he(YN,e.origin,t):e.origin}function mwe(t,e,i){return t.hasSliceTranslatedView?e!=null?yl(_Ze,i.camera.viewMatrix,e):i.camera.viewMatrix:null}function gwe(t,e,i){if(i.slicePlane==null)return Gs;const r=pwe(t,e,i),n=fwe(r,i.slicePlane),s=mwe(t,r,i);return s!=null?Fe(YN,n,s):n}function WN(t,e,i,r){if(r==null||i.slicePlane==null)return Gs;const n=pwe(t,e,i),s=fwe(n,i.slicePlane),o=mwe(t,n,i);return o!=null?(ce(NE,r,s),Fe(YN,s,o),Fe(NE,NE,o),he(NE,NE,YN)):r}const yZe=C(),YN=C(),NE=C(),_Ze=be();function DR(t,e){const i=e.output===U.ObjectAndLayerIdColor,r=e.objectAndLayerIdColorInstanced;i&&(t.varyings.add("objectAndLayerIdColorVarying","vec4"),r?t.attributes.add(O.INSTANCEOBJECTANDLAYERIDCOLOR,"vec4"):t.attributes.add(O.OBJECTANDLAYERIDCOLOR,"vec4")),t.vertex.code.add(b`
     void forwardObjectAndLayerIdColor() {
      ${i?r?b`objectAndLayerIdColorVarying = instanceObjectAndLayerIdColor * 0.003921568627451;`:b`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:b``} }`),t.fragment.code.add(b`
      void outputObjectAndLayerIdColor() {
        ${i?b`fragColor = objectAndLayerIdColorVarying;`:b``} }`)}function YF(t){t.uniforms.add(new Tf("alignPixelEnabled",(e,i)=>i.alignPixelEnabled)),t.code.add(b`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),t.code.add(b`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}function vZe(t,e){const{vertex:i,fragment:r}=t;i.include(YF),e.multipassEnabled&&(i.include(Bve),t.varyings.add("depth","float")),i.code.add(b`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${e.multipassEnabled?b`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${e.multipassEnabled?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.include(uc,e),r.code.add(b`
  void main() {
    fragColor = vec4(1);
    ${e.multipassEnabled?b`
        if(terrainDepthTest(depth)) {
          fragColor.g = 0.5;
        }`:""}
  }
  `)}function ywe(t){t.vertex.uniforms.add(new Oe("renderTransparentlyOccludedHUD",(e,i)=>i.hudRenderStyle===kl.Occluded?1:i.hudRenderStyle===kl.NotOccluded?0:.75),new ai("viewport",(e,i)=>i.camera.fullViewport),new Je("hudVisibilityTexture",(e,i)=>i.hudVisibility?.colorTexture)),t.vertex.include(YF),t.vertex.code.add(b`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}const _we=Mt(1,1,0,1),pX=Mt(1,0,1,1);function I_(t){t.fragment.uniforms.add(new Je("depthTexture",(e,i)=>i.mainDepth)),t.fragment.constants.add("occludedHighlightFlag","vec4",_we).add("unoccludedHighlightFlag","vec4",pX),t.fragment.code.add(b`void outputHighlight() {
float sceneDepth = float(texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x);
if (gl_FragCoord.z > sceneDepth + 5e-7) {
fragColor = occludedHighlightFlag;
} else {
fragColor = unoccludedHighlightFlag;
}
}`)}let vwe=class extends Qr{constructor(e,i,r){super(e,"vec4",_i.Pass,(n,s,o)=>n.setUniform4fv(e,i(s,o)),r)}},hl=class extends Qr{constructor(e,i,r){super(e,"float",_i.Pass,(n,s,o)=>n.setUniform1fv(e,i(s,o)),r)}},NR=class extends qbe{constructor(){super(...arguments),this.renderOccluded=Pr.Occlude,this.isDecoration=!1}};const _T=8;function hg(t,e){const{vertex:i,attributes:r}=t;e.hasVvInstancing&&(e.vvSize||e.vvColor)&&r.add(O.INSTANCEFEATUREATTRIBUTE,"vec4"),e.vvSize?(i.uniforms.add(new $t("vvSizeMinSize",n=>n.vvSize.minSize)),i.uniforms.add(new $t("vvSizeMaxSize",n=>n.vvSize.maxSize)),i.uniforms.add(new $t("vvSizeOffset",n=>n.vvSize.offset)),i.uniforms.add(new $t("vvSizeFactor",n=>n.vvSize.factor)),i.uniforms.add(new sp("vvSymbolRotationMatrix",n=>n.vvSymbolRotationMatrix)),i.uniforms.add(new $t("vvSymbolAnchor",n=>n.vvSymbolAnchor)),i.code.add(b`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),i.code.add(b`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?b`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):i.code.add(b`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),e.vvColor?(i.constants.add("vvColorNumber","int",_T),i.uniforms.add(new hl("vvColorValues",n=>n.vvColor.values,_T),new vwe("vvColorColors",n=>n.vvColor.colors,_T)),i.code.add(b`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${e.hasVvInstancing?b`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):i.code.add(b`vec4 vvColor() { return vec4(1.0); }`)}const XN=.1,co=.001;function bZe(t){const e=new mi,i=t.signedDistanceFieldEnabled;if(e.include(Kbe,t),e.include(vn,t),t.occlusionPass)return e.include(vZe,t),e;const{vertex:r,fragment:n}=e;e.include(oX),n.include(Eh),n.include(Jf),e.include(hg,t),e.include(DR,t),e.include(ywe),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2"),e.varyings.add("voccluded","float"),r.uniforms.add(new ai("viewport",(c,u)=>u.camera.fullViewport),new zi("screenOffset",(c,u)=>si(bwe,2*c.screenOffset[0]*u.camera.pixelRatio,2*c.screenOffset[1]*u.camera.pixelRatio)),new zi("anchorPosition",c=>ZN(c)),new ai("materialColor",c=>c.color)),HS(r),i&&(r.uniforms.add(new ai("outlineColor",c=>c.outlineColor)),n.uniforms.add(new ai("outlineColor",c=>lre(c)?c.outlineColor:ru),new Oe("outlineSize",c=>lre(c)?c.outlineSize:0))),t.pixelSnappingEnabled&&r.include(YF),t.hasScreenSizePerspective&&(sZe(r),WF(r)),t.debugDrawLabelBorder&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add(O.UV0,"vec2"),e.attributes.add(O.COLOR,"vec4"),e.attributes.add(O.SIZE,"vec2"),e.attributes.add(O.FEATUREATTRIBUTE,"vec4"),r.code.add(b`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${t.hasScreenSizePerspective?b`
            inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
            vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:b`
            inputSize = size;
            vec2 screenOffsetScaled = screenOffset;`}

      ${t.vvSize?"inputSize *= vvScale(featureAttribute).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);
      bool visible = testHUDVisibility(posProj);
      voccluded = visible ? 0.0 : 1.0;
    `);const s=b`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,o=t.pixelSnappingEnabled?i?b`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:b`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:b`posProj += quadOffset;`;r.code.add(b`
    ${t.occlusionTestEnabled?"if (visible) {":""}
    ${s}
    ${t.vvColor?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${t.output===U.ObjectAndLayerIdColor?b`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${b.float(co)};
    ${i?`alphaDiscard = alphaDiscard && outlineColor.a < ${b.float(co)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv;

    ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${t.occlusionTestEnabled?b`} else { vtc = vec2(0.0);
      ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),n.uniforms.add(new Je("tex",c=>c.texture));const a=t.debugDrawLabelBorder?b`(isBorder > 0.0 ? 0.0 : ${b.float(XN)})`:b.float(XN),l=b`
    ${t.debugDrawLabelBorder?b`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${t.sampleSignedDistanceFieldTexelCenter?b`
      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;
      `:b`
      vec2 samplePos = vtc;
      `}

    ${i?b`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${b.float(co)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        fragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        fragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:b`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          fragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${t.debugDrawLabelBorder?b`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;switch(t.output){case U.Color:n.code.add(b`
        void main() {
          ${l}
          ${t.transparencyPassType===Qe.FrontFace?"fragColor.rgb /= fragColor.a;":""}
        }`);break;case U.Alpha:n.code.add(b`
        void main() {
          ${l}
          fragColor = vec4(fragColor.a);
        }`);break;case U.ObjectAndLayerIdColor:n.code.add(b`
        void main() {
          ${l}
          outputObjectAndLayerIdColor();
        }`);break;case U.Highlight:n.constants.add("occludedHighlightFlag","vec4",_we).add("unoccludedHighlightFlag","vec4",pX),n.code.add(b`
        void main() {
          ${l}
          if (voccluded == 1.0) {
            fragColor = occludedHighlightFlag;
          } else {
            fragColor = unoccludedHighlightFlag;
          }
        }`)}return e}function lre(t){return t.outlineColor[3]>0&&t.outlineSize>0}function ZN(t,e=bwe){return t.textureIsSignedDistanceField?wZe(t.anchorPosition,t.distanceFieldBoundingBox,e):Yn(e,t.anchorPosition),e}function wZe(t,e,i){e!=null?si(i,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1]):si(i,0,0)}const bwe=Ue(),xZe=Object.freeze(Object.defineProperty({__proto__:null,build:bZe,calculateAnchorPosForRendering:ZN},Symbol.toStringTag,{value:"Module"})),su=fo(Te.SRC_ALPHA,Te.ONE,Te.ONE_MINUS_SRC_ALPHA,Te.ONE_MINUS_SRC_ALPHA),TZe=cc(Te.ONE,Te.ONE),wwe=cc(Te.ZERO,Te.ONE_MINUS_SRC_ALPHA);function Wg(t){return t===Qe.FrontFace?null:t===Qe.Alpha?wwe:TZe}function XF(t){return t===Qe.FrontFace?_l:null}const ZF=5e5,JF={factor:-1,units:-2};function KF(t){return t?JF:null}function L_(t,e=Pi.LESS){return t===Qe.NONE||t===Qe.FrontFace?e:Pi.LEQUAL}let xwe=class Twe extends Ci{initializeConfiguration(e,i){i.spherical=e.viewingMode===Me.Global}initializeProgram(e){return new wi(e.rctx,Twe.shader.get().build(this.configuration),fi)}initializePipeline(){const e=this.configuration.transparencyPassType,i=this.configuration,r=e===Qe.NONE,n=e===Qe.FrontFace,s=this.configuration.hasPolygonOffset?SZe:null,o=(r||n)&&i.output!==U.Highlight&&(i.depthEnabled||i.occlusionPass)?_l:null;return Ot({blending:i.output===U.Color||i.output===U.Alpha||i.output===U.Highlight?r?EZe:Wg(e):null,depthTest:{func:Pi.LEQUAL},depthWrite:o,colorWrite:Ft,polygonOffset:s})}get primitiveType(){return this.configuration.occlusionPass?Qt.POINTS:Qt.TRIANGLES}};xwe.shader=new bi(xZe,()=>pe(()=>import("./HUDMaterial.glsl-3bbd1b6b.js"),[],import.meta.url));const SZe={factor:0,units:-4},EZe=cc(Te.ONE,Te.ONE_MINUS_SRC_ALPHA);let kn=class extends Ua{constructor(){super(...arguments),this.output=U.Color,this.transparencyPassType=Qe.NONE,this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}};h([V({count:U.COUNT})],kn.prototype,"output",void 0),h([V({count:Qe.COUNT})],kn.prototype,"transparencyPassType",void 0),h([V()],kn.prototype,"screenCenterOffsetUnitsEnabled",void 0),h([V()],kn.prototype,"spherical",void 0),h([V()],kn.prototype,"occlusionTestEnabled",void 0),h([V()],kn.prototype,"signedDistanceFieldEnabled",void 0),h([V()],kn.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),h([V()],kn.prototype,"vvSize",void 0),h([V()],kn.prototype,"vvColor",void 0),h([V()],kn.prototype,"hasVerticalOffset",void 0),h([V()],kn.prototype,"hasScreenSizePerspective",void 0),h([V()],kn.prototype,"debugDrawLabelBorder",void 0),h([V()],kn.prototype,"hasSlicePlane",void 0),h([V()],kn.prototype,"hasPolygonOffset",void 0),h([V()],kn.prototype,"depthEnabled",void 0),h([V()],kn.prototype,"pixelSnappingEnabled",void 0),h([V()],kn.prototype,"draped",void 0),h([V()],kn.prototype,"multipassEnabled",void 0),h([V()],kn.prototype,"cullAboveGround",void 0),h([V()],kn.prototype,"occlusionPass",void 0),h([V()],kn.prototype,"objectAndLayerIdColorInstanced",void 0),h([V({constValue:!0})],kn.prototype,"hasSliceInVertexProgram",void 0),h([V({constValue:!1})],kn.prototype,"hasVvInstancing",void 0);let fS=class extends $_{constructor(e){super(e,new FZe),this._configuration=new kn}getConfiguration(e,i){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.isDraped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=i.slot===ae.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(e===U.Color||e===U.Alpha),e===U.Color&&(this._configuration.debugDrawLabelBorder=!!nr.LABELS_SHOW_BORDER),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(e,i,r,n,s,o){if(!(r.options.selectionMode&&r.options.hud&&e.visible&&r.point))return;const a=this.parameters,l=r.point,c=r.camera;let{scaleX:u,scaleY:d}=this._getScreenScale(e);u*=c.pixelRatio,d*=c.pixelRatio,gh(DU,i),e.attributes.has(O.FEATUREATTRIBUTE)&&OZe(DU);const p=e.attributes.get(O.POSITION),m=e.attributes.get(O.SIZE),y=e.attributes.get(O.NORMAL),_=e.attributes.get(O.AUXPOS1);Ke(p.size>=3);const v=ZN(a),w=this.parameters.centerOffsetUnits==="screen";for(let x=0;x<p.data.length/p.size;x++){const T=x*p.size;oe(Uo,p.data[T],p.data[T+1],p.data[T+2]),Fe(Uo,Uo,i);const S=x*m.size;x0[0]=m.data[S]*u,x0[1]=m.data[S+1]*d,Fe(Uo,Uo,c.viewMatrix);const E=x*_.size;if(oe(yc,_.data[E],_.data[E+1],_.data[E+2]),!w&&(Uo[0]+=yc[0],Uo[1]+=yc[1],yc[2]!==0)){const P=yc[2];ge(yc,Uo),he(Uo,Uo,te(yc,yc,P))}const A=x*y.size;if(oe(FE,y.data[A],y.data[A+1],y.data[A+2]),this._normalAndViewAngle(FE,DU,c,NU),this._applyVerticalOffsetTransformationView(Uo,NU,c,LU),c.applyProjection(Uo,ga),ga[0]>-1){w&&(yc[0]||yc[1])&&(ga[0]+=yc[0]*c.pixelRatio,yc[1]!==0&&(ga[1]+=rX(yc[1],LU.factorAlignment)*c.pixelRatio),c.unapplyProjection(ga,Uo)),ga[0]+=this.parameters.screenOffset[0]*c.pixelRatio,ga[1]+=this.parameters.screenOffset[1]*c.pixelRatio,ga[0]=Math.floor(ga[0]),ga[1]=Math.floor(ga[1]),Bbe(x0,LU.factor,x0);const P=LZe*c.pixelRatio;let N=0;if(a.textureIsSignedDistanceField&&(N=a.outlineSize*c.pixelRatio/2),cre(l,ga[0],ga[1],x0,P,N,a,v)){const F=r.ray;if(Fe(ure,Uo,qn(MZe,c.viewMatrix)),ga[0]=l[0],ga[1]=l[1],c.unprojectFromRenderScreen(ga,Uo)){const D=C();se(D,F.direction);const $=1/we(D);te(D,D,$),o(br(F.origin,Uo)*$,D,-1,!0,1,ure)}}}}}intersectDraped(e,i,r,n,s,o){const a=e.attributes.get(O.POSITION),l=e.attributes.get(O.SIZE),c=this.parameters,u=ZN(c);let{scaleX:d,scaleY:p}=this._getScreenScale(e);d*=e.screenToWorldRatio,p*=e.screenToWorldRatio;const m=DZe*e.screenToWorldRatio;for(let y=0;y<a.data.length/a.size;y++){const _=y*a.size,v=a.data[_],w=a.data[_+1],x=y*l.size;x0[0]=l.data[x]*d,x0[1]=l.data[x+1]*p;let T=0;c.textureIsSignedDistanceField&&(T=c.outlineSize*e.screenToWorldRatio/2),cre(n,v,w,x0,m,T,c,u)&&s(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new UZe(this)}_normalAndViewAngle(e,i,r,n){return HXe(i)&&(i=gh(PZe,i)),Zl(n.normal,e,i),Fe(n.normal,n.normal,r.viewInverseTransposeMatrix),n.cosAngle=me(Swe,NZe),n}_updateScaleInfo(e,i,r){const n=this.parameters;n.screenSizePerspective!=null?Jie(r,i,n.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minScaleFactor=0),n.screenSizePerspectiveAlignment!=null?Jie(r,i,n.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minScaleFactor=e.factor.minScaleFactor)}applyShaderOffsetsView(e,i,r,n,s,o,a){const l=this._normalAndViewAngle(i,r,s,NU);return this._applyVerticalGroundOffsetView(e,l,s,a),this._applyVerticalOffsetTransformationView(a,l,s,o),this._applyPolygonOffsetView(a,l,n[3],s,a),this._applyCenterOffsetView(a,n,a),a}applyShaderOffsetsNDC(e,i,r,n,s){return this._applyCenterOffsetNDC(e,i,r,n),s!=null&&se(s,n),this._applyPolygonOffsetNDC(n,i,r,n),n}_applyPolygonOffsetView(e,i,r,n,s){const o=n.aboveGround?1:-1;let a=Math.sign(r);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return se(s,e);const c=_e(Math.abs(i.cosAngle),.01,1),u=1-Math.sqrt(1-c*c)/c/n.viewport[2];return te(s,e,l>0?u:1/u),s}_applyVerticalGroundOffsetView(e,i,r,n){const s=we(e),o=r.aboveGround?1:-1,a=r.computeRenderPixelSizeAtDist(s)*Jbe,l=te(Uo,i.normal,o*a);return ce(n,e,l),n}_applyVerticalOffsetTransformationView(e,i,r,n){const s=this.parameters;if(!s.verticalOffset?.screenLength){if(s.screenSizePerspective||s.screenSizePerspectiveAlignment){const c=we(e);this._updateScaleInfo(n,c,i.cosAngle)}else n.factor.scale=1,n.factorAlignment.scale=1;return e}const o=we(e),a=s.screenSizePerspectiveAlignment??s.screenSizePerspective,l=rwe(r,o,s.verticalOffset,i.cosAngle,a);return this._updateScaleInfo(n,o,i.cosAngle),te(i.normal,i.normal,l),ce(e,e,i.normal)}_applyCenterOffsetView(e,i,r){const n=this.parameters.centerOffsetUnits!=="screen";return r!==e&&se(r,e),n&&(r[0]+=i[0],r[1]+=i[1],i[2]&&(ge(FE,r),ce(r,r,te(FE,FE,i[2])))),r}_applyCenterOffsetNDC(e,i,r,n){const s=this.parameters.centerOffsetUnits!=="screen";return n!==e&&se(n,e),s||(n[0]+=i[0]/r.fullWidth*2,n[1]+=i[1]/r.fullHeight*2),n}_applyPolygonOffsetNDC(e,i,r,n){const s=this.parameters.shaderPolygonOffset;if(e!==n&&se(n,e),s){const o=r.aboveGround?1:-1,a=o*Math.sign(i[3]);n[2]-=(a||o)*s}return n}produces(e,i){if(i===U.Color||i===U.Alpha||i===U.Highlight||i===U.ObjectAndLayerIdColor){if(e===ae.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:r,occlusionTest:n}=this.parameters;return e===(r?ae.LABEL_MATERIAL:ae.HUD_MATERIAL)||n&&e===ae.OCCLUSION_PIXELS}return!1}createGLMaterial(e){return new CZe(e)}calculateRelativeScreenBounds(e,i,r=Gt()){return AZe(this.parameters,e,i,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}_getScreenScale(e){const i=e.attributes.get(O.FEATUREATTRIBUTE);if(i==null)return{scaleX:1,scaleY:1};const r=TW(i.data,IZe),[n,s]=sX($Ze,this.parameters,r);return{scaleX:n,scaleY:s}}},CZe=class extends _Y{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(xwe,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}};function AZe(t,e,i,r=RZe){return Yn(r,t.anchorPosition),r[0]*=-e[0],r[1]*=-e[1],r[0]+=t.screenOffset[0]*i,r[1]+=t.screenOffset[1]*i,r}function OZe(t){const e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=1/Math.sqrt(e*e+i*i+r*r),d=1/Math.sqrt(n*n+s*s+o*o),p=1/Math.sqrt(a*a+l*l+c*c);return t[0]=e*u,t[1]=i*u,t[2]=r*u,t[3]=n*d,t[4]=s*d,t[5]=o*d,t[6]=a*p,t[7]=l*p,t[8]=c*p,t}function cre(t,e,i,r,n,s,o,a){let l=e-n-(a[0]>0?r[0]*a[0]:0),c=l+r[0]+2*n,u=i-n-(a[1]>0?r[1]*a[1]:0),d=u+r[1]+2*n;const p=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&p!=null&&(l+=r[0]*p[0],u+=r[1]*p[1],c-=r[0]*(1-p[2]),d-=r[1]*(1-p[3]),l-=s,c+=s,u-=s,d+=s),t[0]>l&&t[0]<c&&t[1]>u&&t[1]<d}const LU=new awe,RZe=Ue(),Uo=C(),FE=C(),ga=Kt(),Swe=C(),ure=C(),DU=Hr(),PZe=Hr(),MZe=be(),yc=C(),$Ze=Kt(),IZe=Kt(),NU={normal:Swe,cosAngle:0},LZe=1,DZe=2,x0=[0,0],NZe=Ce(0,0,1);let FZe=class extends Cve{constructor(){super(...arguments),this.renderOccluded=Pr.Occlude,this.isDecoration=!1,this.color=Mt(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=ri(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=Mt(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}};const Ewe=Ir().vec3f(O.POSITION).vec3f(O.NORMAL).vec2f(O.UV0).vec4u8(O.COLOR).vec2f(O.SIZE).vec4f(O.AUXPOS1).vec4f(O.FEATUREATTRIBUTE),kZe=Ewe.clone().vec4u8(O.OBJECTANDLAYERIDCOLOR);let UZe=class{constructor(e){this._material=e,this.vertexBufferLayout=ie("enable-feature:objectAndLayerId-rendering")?kZe:Ewe}elementCount(e){return 6*e.attributes.get(O.POSITION).indices.length}write(e,i,r,n,s){hX(r.attributes.get(O.POSITION),e,n.position,s,6),dX(r.attributes.get(O.NORMAL),i,n.normal,s,6);const o=r.attributes.get(O.UV0).data;let a,l,c,u;if(o==null||o.length<4){const w=this._material.parameters;a=0,l=0,c=w.texCoordScale[0],u=w.texCoordScale[1]}else a=o[0],l=o[1],c=o[2],u=o[3];c=Math.min(1.99999,c+1),u=Math.min(1.99999,u+1);let d=r.attributes.get(O.POSITION).indices.length,p=s;const m=n.uv0;for(let w=0;w<d;++w)m.set(p,0,a),m.set(p,1,l),p++,m.set(p,0,c),m.set(p,1,l),p++,m.set(p,0,c),m.set(p,1,u),p++,m.set(p,0,c),m.set(p,1,u),p++,m.set(p,0,a),m.set(p,1,u),p++,m.set(p,0,a),m.set(p,1,l),p++;cwe(r.attributes.get(O.COLOR),4,n.color,s,6);const{data:y,indices:_}=r.attributes.get(O.SIZE);d=_.length;const v=n.size;p=s;for(let w=0;w<d;++w){const x=y[2*_[w]],T=y[2*_[w]+1];for(let S=0;S<6;++S)v.set(p,0,x),v.set(p,1,T),p++}if(r.attributes.get(O.AUXPOS1)?pS(r.attributes.get(O.AUXPOS1),n.auxpos1,s,6):are(n.auxpos1,s,6*d),r.attributes.get(O.FEATUREATTRIBUTE)?pS(r.attributes.get(O.FEATUREATTRIBUTE),n.featureAttribute,s,6):are(n.featureAttribute,s,6*d),r.objectAndLayerIdColor!=null){const w=r.attributes.get(O.POSITION)?.indices;if(w){const x=w.length,T=n.getField(O.OBJECTANDLAYERIDCOLOR,la);uwe(r.objectAndLayerIdColor,T,x,s,6)}}}};const mp=C(),Qw=Kt(),kE=Kt(),FU=C(),zZe=be(),BZe=xn(),kU=_s(),VZe=C(),GZe=Gt();class jZe{constructor(){this.aabr=Gt(),this.distance=0,this.culled=!1,this.visible=!1}}class HZe{constructor(e,i){this.graphics3DGraphic=e,this.slicePlaneEnabled=i,this.info={}}}var Fl;(function(t){t[t.Idle=0]="Idle",t[t.Process=1]="Process",t[t.Sort=2]="Sort",t[t.Deconflict=3]="Deconflict",t[t.NumStates=4]="NumStates"})(Fl||(Fl={}));class Cwe{constructor(){this.camera=new ht,this.slicePlane=Ug(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),lw(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let q2=class extends xe{get dirty(){return this._dirty}get state(){return this._state}constructor(t){super(t),this._dirty=!1,this._runningViewState=new Cwe,this._state=Fl.Idle,this._active=new Map,this._visible=new Map,this._iterators=new XZe,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==Fl.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const t=this._state/Fl.NumStates;return this._dirty?.5*t:t}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(t){switch(this._state){case Fl.Idle:this._startUpdate(),t.madeProgress();case Fl.Process:if(this._state=Fl.Process,!this._processActiveGraphics(t))return;case Fl.Sort:if(this._state=Fl.Sort,!this._sortVisibleGraphics(t))return;case Fl.Deconflict:if(this._state=Fl.Deconflict,!this._deconflictVisibleGraphics(t))return;default:LXe(this,this._visible),this._state=Fl.Idle,this.notifyChange("updating")}}modifyGraphics(t,e){e?t.forEach(i=>this.addToActiveGraphics(i)):t.forEach(i=>this.removeFromActiveGraphics(i)),this.setDirty()}layerSupportsDeconfliction(t){if(t==null||t.type!=="object3d")return!1;const e=t.stageObject;return(e?.geometries.length??0)!==1?!1:e?.geometries[0]?.material instanceof fS}_startUpdate(){DXe(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:t,fullHeight:e}=this._runningViewState.camera;this._initBins(t,e),this._resetIterators()}addToActiveGraphics(t){t.info[this.visibilityGroup]=new jZe,this._active.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromActiveGraphics(t){this._visible.delete(t.graphics3DGraphic.graphic.uid),qZe(t,this.visibilityGroup),delete t.info[this.visibilityGroup],this._active.delete(t.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(t){const e=this._ensureActiveGraphicsIterator(),i=$S(zZe,this._runningViewState.camera.projectionMatrix),r=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?BZe:null;let n=0;for(r!=null&&(Fe(r,Gs,this._runningViewState.camera.viewMatrix),r[3]=Fi(this.view.spatialReference).radius,n=U0e(r,Gs));!t.done;){t.madeProgress();const s=e.next();if(s.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=s.value,a=o?.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,i,r,n),a.culled?this._visible.delete(o.graphics3DGraphic.graphic.uid):this._visible.set(o.graphics3DGraphic.graphic.uid,o))}return!1}_sortVisibleGraphics(t){const e=this._ensureSortGraphicsIterator();for(;!t.done;){const i=e.next();if(t.madeProgress(),i.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(t){const e=this._ensureVisibleGraphicsIterator(),i=this.visibilityGroup===Us.LABEL;for(;!t.done;){t.madeProgress();const r=e.next();if(r.done===!0)return this._resetVisibleGraphicsIterator(),!0;const n=r.value,s=n.info[this.visibilityGroup];if(!s||s.culled){this._setGraphicVisibility(n,!1);continue}const o=n.graphics3DGraphic,a=!i||o.isVisible();s.visible=a&&!this._isConflicted(n),s.visible&&this._addToBins(n),this._setGraphicVisibility(n,s.visible),FXe(s,s.visible)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=hre(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=hre(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=WZe(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(t,e,i,r){const n=t.graphics3DGraphic;if(n.destroyed)return;const s=t.info[this.visibilityGroup];if(!n.isVisible(Us.GRAPHIC,Ro.DECONFLICTION))return void(s.culled=!0);const o=this.getGraphicsLayers(n);mh(s.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometries[0].material;if(a==null&&(a=KZe,this._getProjectionInfo(l,e,a),a.isOutsideScreen||this._isCulledBySlice(t,mp)||i!=null&&this._isCulledByHorizon(a,i,r)))return void(s.culled=!0);this._expandBoundingRect(s,l,c,a)}a==null?s.culled=!0:(s.distance=a.distance,s.culled=!1)}_getProjectionInfo(t,e,i){const r=this._runningViewState.camera,n=t.stageObject,s=n.geometries[0],o=s.material,a=n.boundingVolumeWorldSpace.bounds;Fe(mp,a,r.viewMatrix);const l=s.attributes,c=l.get(O.NORMAL).data,u=l.get(O.AUXPOS1).data;o.applyShaderOffsetsView(mp,c,n.transformation,u,r,i.scaleInfo,mp),Mr(Qw,mp[0],mp[1],mp[2],1),Xc(kE,Qw,r.projectionMatrix),te(i.positionNDC,kE,1/kE[3]),o.applyShaderOffsetsNDC(i.positionNDC,u,r,i.positionNDC,FU),i.distanceWithoutPolygonOffset=r.depthNDCToWorld(FU[2]),i.distance=FU[2]===i.positionNDC[2]?i.distanceWithoutPolygonOffset:r.depthNDCToWorld(i.positionNDC[2]),Mr(kE,i.positionNDC[0],i.positionNDC[1],i.positionNDC[2],1),Xc(Qw,kE,e),Tb(Qw,Qw,1/Qw[3]),oe(i.positionView,mp[0],mp[1],mp[2])}_isCulledByHorizon(t,e,i){return se(kU.direction,t.positionView),oe(kU.origin,0,0,0),!!O_(e,kU,VZe)&&t.distanceWithoutPolygonOffset>i}_isCulledBySlice(t,e){return t.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&IW(this._runningViewState.slicePlane,e)}_expandBoundingRect(t,e,i,{positionNDC:r,scaleInfo:n}){const s=this._runningViewState.camera,o=e.getScreenSize(ZZe);Bbe(o,n.factor,o),o[0]*=s.pixelRatio,o[1]*=s.pixelRatio;const a=WD(i.calculateRelativeScreenBounds(o,n.factorAlignment.scale,GZe),_t(0,s.fullWidth,.5+.5*r[0]),_t(0,s.fullHeight,.5+.5*r[1])),l=this.marginFactor;if(l!==0){const c=l*Math.min(ea(a),pl(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}Hy(t.aabr,a,t.aabr)}_isConflicted(t){const e=t.graphics3DGraphic.graphic.uid,i=t.info[this.visibilityGroup];let r=!0;for(let n=Math.floor(i.aabr[0]/this._accBinsSizeX);n<=Math.floor(i.aabr[2]/this._accBinsSizeX);n++)if(!(n<0||n>=this._accBinsNumX))for(let s=Math.floor(i.aabr[1]/this._accBinsSizeY);s<=Math.floor(i.aabr[3]/this._accBinsSizeY);s++){if(s<0||s>=this._accBinsNumY)continue;r=!1;const o=this._accBins[n][s];for(let a=0;a<o.length;a++){const l=o.data[a],c=l.info[this.visibilityGroup];if(c&&c.visible&&l.graphics3DGraphic.graphic.uid!==e&&(this.accNumTests++,k4(c.aabr,i.aabr)))return!0}}return r}_initBins(t,e){if(this._accBins==null){this._accBins=[];for(let i=0;i<this._accBinsNumX;i++){this._accBins.push([]);const r=this._accBins[this._accBins.length-1];for(let n=0;n<this._accBinsNumY;n++)r.push(new It)}}else for(let i=0;i<this._accBinsNumX;i++)for(let r=0;r<this._accBinsNumY;r++)this._accBins[i][r].clear();this._accBinsSizeX=t/this._accBinsNumX,this._accBinsSizeY=e/this._accBinsNumY,this.accNumTests=0}_addToBins(t){const e=t.info[this.visibilityGroup],i=Math.floor(e.aabr[0]/this._accBinsSizeX),r=Math.floor(e.aabr[2]/this._accBinsSizeX),n=Math.floor(e.aabr[1]/this._accBinsSizeY),s=Math.floor(e.aabr[3]/this._accBinsSizeY);for(let o=i;o<=r;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=n;a<=s;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(t)}_setGraphicVisibility(t,e){const i=t.graphics3DGraphic;i.destroyed||(i.setVisibilityFlag(this.visibilityGroup,Ro.DECONFLICTION,e),this.visibilityGroup===Us.LABEL&&this.view.labeler.setLabelGraphicVisibility(i,e))}};function qZe(t,e){const i=t.graphics3DGraphic;i.destroyed||i.setVisibilityFlag(e,Ro.DECONFLICTION,!0)}function*hre(t){if(Map.prototype.entries){const e=t.entries();for(let i=e.next();!i.done;i=e.next())yield i.value[1]}else yield*t.values()}function*WZe(t,e,i){e.clear(),t.forEach((n,s)=>{const o=e.pushNew();o.id=s,o.visible=n.graphics3DGraphic.getVisibilityFlag(i,Ro.DECONFLICTION);const a=n.info?.[i];o.prio=n.graphics3DGraphic.deconflictionPriority,o.distance=a?a.distance:Number.MAX_VALUE}),yield;const r=e.iterableSort((n,s)=>n.prio!==s.prio?s.prio-n.prio:n.distance!==s.distance?n.distance-s.distance:n.visible!==s.visible?n.visible?-1:1:n.id-s.id);for(let n=r.next();!n.done;n=r.next())yield;e.forAll(n=>{const s=t.get(n.id);s&&(t.delete(n.id),t.set(n.id,s))}),e.clear()}h([f({constructOnly:!0})],q2.prototype,"view",void 0),h([f({type:Boolean,readOnly:!0})],q2.prototype,"updating",null),q2=h([z("esri.views.3d.layers.graphics.Deconflictor")],q2);class YZe{constructor(){this.id=0,this.visible=!1,this.prio=0,this.distance=0}}class XZe{constructor(e=null,i=null,r=null){this.active=e,this.visible=i,this.sort=r,this.sortArray=new It({allocator:n=>n||new YZe})}}const ZZe=Ue();class JZe{constructor(){this.positionView=C(),this.positionNDC=C(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new awe}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}}const KZe=new JZe,QZe=2e3;let DL=class extends q2{constructor(e){super(e),this.visibilityGroup=Us.LABEL,this.marginFactor=.05,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return Lo.YIELD;const i=performance.now();if(e.state!==Si.IDLE&&i-this._lastDeconfliction<QZe)return Lo.YIELD;super.runTask(e),this.state===Fl.Idle&&(this._lastDeconfliction=i)}enabledChanged(e,i){this.modifyGraphics(i,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};h([f({constructOnly:!0})],DL.prototype,"parent",void 0),DL=h([z("esri.views.3d.layers.graphics.LabelDeconflictor")],DL);let WG=class extends q2{constructor(){super(...arguments),this._contexts=new Map,this._viewState=new Cwe,this.visibilityGroup=Us.GRAPHIC,this._marginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this.addHandles([le(()=>this.view?.state?.camera,()=>{this._updateViewState(),this.setDirty()}),le(()=>this.view?.map?.ground?.opacity,(e,i)=>{e!==1&&i!==1||this.setDirty()}),le(()=>this.view?.slicePlane,()=>{this._updateSlicePlane(),this._slicePlaneChanged()},Zi)]),this._frameTask=this.view.resourceController.scheduler.registerTask(ut.GRAPHICS_DECONFLICTOR,this),this._labels=new DL({view:this.view,parent:this})}destroy(){this._labels=Pe(this._labels),this._frameTask=pr(this._frameTask)}get marginFactor(){return this._marginFactor}set marginFactor(e){this._marginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,i){const r=!(this._graphicSupportsDeconfliction(i)&&UU(e));i.setVisibilityFlag(Us.GRAPHIC,Ro.DECONFLICTION,r)}_updateViewState(){this.view?.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;e!=null&&Q0e(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=e!=null}_slicePlaneChanged(){Hc(this._contexts,(e,i)=>i.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){const i=this._getGraphicsContext(e);return{addGraphic:r=>this._addGraphic(e,i,r),removeGraphic:r=>this._removeGraphic(i,r),labelingInfoChange:()=>this._labels.enabledChanged(e,i),featureReductionChange:()=>this.enabledChanged(e,i),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,i),clear:()=>i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic))}}removeGraphicsOwner(e){const i=this._contexts.get(e);i&&(i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,i,r){const n=r.graphic.uid,s=new HZe(r,e.symbolCreationContext.slicePlaneEnabled);i.set(n,s),UU(e)&&this.addToActiveGraphics(s),e.labelsEnabled&&this._labels.addToActiveGraphics(s)}_removeGraphic(e,i){const r=i.graphic.uid,n=e.get(r);n&&(this.removeFromActiveGraphics(n),this._labels.removeFromActiveGraphics(n),e.delete(r),this.setDirty())}enabledChanged(e,i){const r=UU(e);r||eJe(e),this.modifyGraphics(i,r)}_slicePlaneEnabledChanged(e,i){const r=e.symbolCreationContext.slicePlaneEnabled;i.forEach(n=>n.slicePlaneEnabled=r),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const i=e.layers;if(!i?.length)return!1;for(const r of i)if(this.layerSupportsDeconfliction(r))return!0;return!1}_getGraphicsContext(e){const i=this._contexts.get(e);if(i)return i;const r=new Map;return this._contexts.set(e,r),this.setDirty(),r}};function UU(t){const e=t.layer;return!(!e?.featureReduction||e.featureReduction.type!=="selection")}function eJe(t){const e=t.graphics3DGraphics;e&&e.forEach(i=>i.setVisibilityFlag(Us.GRAPHIC,Ro.DECONFLICTION,!0))}WG=h([z("esri.views.3d.layers.graphics.GraphicsDeconflictor")],WG);function Awe(t){return"declaredClass"in t}function dre(t){return"declaredClass"in t}function tJe(t){return"declaredClass"in t}function iJe(t,e){return t?tJe(t)?t:new Lb({layer:e,sourceLayer:e,visible:t.visible,symbol:ye(t.symbol),attributes:ye(t.attributes),geometry:Owe(t.geometry)}):null}function Owe(t){return t==null?null:Awe(t)?t:Cb(rJe(t))}function rJe(t){const{wkid:e,wkt:i,wkt2:r,latestWkid:n}=t.spatialReference,s={wkid:e,wkt:i,wkt2:r,latestWkid:n};switch(t.type){case"point":{const{x:o,y:a,z:l,m:c}=t;return{x:o,y:a,z:l,m:c,spatialReference:s}}case"polygon":{const{rings:o,hasZ:a,hasM:l}=t;return{rings:pre(o),hasZ:a,hasM:l,spatialReference:s}}case"polyline":{const{paths:o,hasZ:a,hasM:l}=t;return{paths:pre(o),hasZ:a,hasM:l,spatialReference:s}}case"extent":{const{xmin:o,xmax:a,ymin:l,ymax:c,zmin:u,zmax:d,mmin:p,mmax:m,hasZ:y,hasM:_}=t;return{xmin:o,xmax:a,ymin:l,ymax:c,zmin:u,zmax:d,mmin:p,mmax:m,hasZ:y,hasM:_,spatialReference:s}}case"multipoint":{const{points:o,hasZ:a,hasM:l}=t;return{points:Pwe(o)?Rwe(o):o,hasZ:a,hasM:l,spatialReference:s}}default:return}}function pre(t){return nJe(t)?t.map(e=>Rwe(e)):t}function Rwe(t){return t.map(e=>Array.from(e))}function nJe(t){for(const e of t)if(e.length!==0)return Pwe(e);return!1}function Pwe(t){return t.length>0&&(AS(t[0])||OS(t[0]))}function sJe(t,e){if(!t)return null;let i;if(dre(t)){if(e==null)return t.clone();if(dre(e))return e.copy(t)}return e!=null?(i=e,i.x=t.x,i.y=t.y,i.spatialReference=t.spatialReference,t.hasZ?(i.z=t.z,i.hasZ=t.hasZ):(i.z=void 0,i.hasZ=!1),t.hasM?(i.m=t.m,i.hasM=!0):(i.m=void 0,i.hasM=!1)):(i=R_(t.x,t.y,t.z,t.spatialReference),t.hasM&&(i.m=t.m,i.hasM=!0)),i}function rIt(t){const{wkid:e,wkt:i,wkt2:r,latestWkid:n}=t,s={wkid:e,wkt:i,wkt2:r,latestWkid:n};return je.fromJSON(s)}const fX="__begin__",mX="__end__",oJe=new RegExp(fX,"ig"),aJe=new RegExp(mX,"ig"),fre=new RegExp("^"+fX,"i"),mre=new RegExp(mX+"$","i"),JN='"',lJe=JN+" + ",cJe=" + "+JN;function uJe(t){return t.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function nIt(t){return t.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function gX(t){const e={expression:"",type:"none"};return t.labelExpressionInfo?t.labelExpressionInfo.value?(e.expression=t.labelExpressionInfo.value,e.type="conventional"):t.labelExpressionInfo.expression&&(e.expression=t.labelExpressionInfo.expression,e.type="arcade"):t.labelExpression!=null&&(e.expression=uJe(t.labelExpression),e.type="conventional"),e}function sIt(t){const e=gX(t);if(!e)return null;switch(e.type){case"conventional":return hJe(e.expression);case"arcade":return e.expression}return null}function oIt(t){const e=gX(t);if(!e)return null;switch(e.type){case"conventional":return pJe(e.expression);case"arcade":return Mwe(e.expression)}return null}function hJe(t){let e;return t?(e=h4(t,i=>fX+'$feature["'+i+'"]'+mX),e=fre.test(e)?e.replace(fre,""):JN+e,e=mre.test(e)?e.replace(mre,""):e+JN,e=e.replaceAll(oJe,lJe).replaceAll(aJe,cJe)):e='""',e}const dJe=/^\s*\{([^}]+)\}\s*$/i;function pJe(t){return t?.match(dJe)?.[1].trim()||null}const fJe=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,mJe=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,gJe=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function Mwe(t){if(!t)return null;let e=fJe.exec(t)||mJe.exec(t);return e?e[1]||e[3]:(e=gJe.exec(t),e?e[2]:null)}const zU=ne.getLogger("esri.layers.support.labelFormatUtils"),BU={type:"simple",evaluate:()=>null},yJe={getAttribute:(t,e)=>t.field(e)};async function $we(t,e,i){if(!t||!t.symbol||!e)return BU;const r=t.where,n=gX(t);let s;if(n.type==="arcade"){const o=await XFe(n.expression,i,e);if(o==null)return BU;s={type:"arcade",evaluate(a,l){try{const c="attributes"in a?o.repurposeFeature(a):a;c.contextTimeZone=l??null;const u=o.evaluate({$view:{timeZone:l},$feature:c},o.services);if(u!=null)return u.toString()}catch(c){zU.error(new W("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:c,feature:a,expression:n}))}return null},needsHydrationToEvaluate:()=>Mwe(n.expression)==null}}else s={type:"simple",evaluate:o=>n.expression.replaceAll(/{[^}]*}/g,a=>{const l=a.slice(1,-1),c=e.get(l);if(!c)return a;let u=null;return"attributes"in o?o&&o.attributes&&(u=o.attributes[c.name]):u=o.field(c.name),u==null?"":Iwe(u,c)})};if(r){let o;try{o=await Zfe(r,e)}catch(l){return zU.error(new W("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:r,error:l})),BU}const a=s.evaluate;s.evaluate=(l,c)=>{const u="attributes"in l?void 0:yJe;try{if(o.testFeature(l,u))return a(l,c)}catch(d){zU.error(new W("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:r,feature:l,error:d}))}return null}}return s}function Iwe(t,e){if(t==null)return"";const i=e.domain;if(i){if(i.type==="codedValue"||i.type==="coded-value"){const n=t;for(const s of i.codedValues)if(s.code===n)return s.name}else if(i.type==="range"){const{max:n,min:s}=sge(e),o=+t;if(s!=null&&n!=null&&s<=o&&o<=n)return i.name}}let r=t;return Tke(e)?r=s_(r,MFe("short-date")):fge(e)&&(r=rO(+r)),r||""}const aIt=Object.freeze(Object.defineProperty({__proto__:null,createLabelFunction:$we,formatField:Iwe},Symbol.toStringTag,{value:"Module"}));function yX(t,e){if(t.type==="point")return T0(t,e,!1);if(Awe(t))switch(t.type){case"extent":return T0(t.center,e,!1);case"polygon":return T0(t.centroid,e,!1);case"polyline":return T0(gre(t),e,!0);case"mesh":return T0(t.origin,e,!1)}else switch(t.type){case"extent":return T0(_Je(t),e,!0);case"polygon":return T0(vJe(t),e,!0);case"polyline":return T0(gre(t),e,!0)}}function gre(t){const e=t.paths[0];if(!e||e.length===0)return null;const i=Mpe(e,Ppe(e)/2);return R_(i[0],i[1],i[2],t.spatialReference)}function _Je(t){return R_(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),t.zmin!=null&&t.zmax!=null&&isFinite(t.zmin)&&isFinite(t.zmax)?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function vJe(t){const e=t.rings[0];if(!e||e.length===0)return null;const i=$pe(t.rings,!!t.hasZ);return R_(i[0],i[1],i[2],t.spatialReference)}function T0(t,e,i){const r=i?t:sJe(t);return e&&t?yfe(t,r,e)?r:null:r}function lIt(t,e,i,r=0){if(t){e||(e=Gt());const n=t;let s=.5*n.width*(i-1),o=.5*n.height*(i-1);return n.width<1e-7*n.height?s+=o/20:n.height<1e-7*n.width&&(o+=s/20),Mr(e,n.xmin-s-r,n.ymin-o-r,n.xmax+s+r,n.ymax+o+r),e}return null}function Lwe(t,e){for(let i=0;i<t.geometries.length;++i){const r=t.geometries[i].getMutableAttribute(O.AUXPOS1);r&&r.data[3]!==e&&(r.data[3]=e,t.geometryVertexAttributeUpdated(t.geometries[i],O.AUXPOS1))}}function f3(t,e,i=null){const r=wR(rh);return t!=null&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),e!=null?r[3]=e:t!=null&&t.length>3&&(r[3]=t[3]),i&&(r[0]*=i,r[1]*=i,r[2]*=i,r[3]*=i),r}function cIt(t,e,i,r,n,s=[0,0,0,0]){for(let o=0;o<3;++o)s[o]=t?.[o]!=null?t[o]:i?.[o]!=null?i[o]:n[o];return s[3]=e??r??n[3],s}function yre(t=eg,e,i,r=1){const n=new Array(3);if(e==null||i==null)n[0]=1,n[1]=1,n[2]=1;else{let s,o=0;for(let a=2;a>=0;a--){const l=t[a];let c;const u=l!=null,d=a===0&&!s&&!u,p=i[a];l==="symbol-value"||d?c=p!==0?e[a]/p:1:u&&l!=="proportional"&&isFinite(l)&&(c=p!==0?l/p:1),c!=null&&(n[a]=c,s=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)n[a]==null?n[a]=s:n[a]===0&&(n[a]=.001*o)}for(let s=2;s>=0;s--)n[s]/=r;return Xo(n)}function bJe(t){return t.isPrimitive!=null}function QF(t){return YG(bJe(t)?[t.width,t.depth,t.height]:t)?null:"Symbol sizes may not be negative values"}function YG(t){const e=i=>i==null||i>=0;return Array.isArray(t)?t.every(e):e(t)}function wJe(t,e,i,r=be()){return t&&FT(r,r,-t/180*Math.PI),e&&NT(r,r,e/180*Math.PI),i&&M4(r,r,i/180*Math.PI),r}function _X(t,e,i){if(i.minDemResolution!=null)return i.minDemResolution;const r=ua(e),n=nw(t)*r,s=sw(t)*r,o=A_(t)*(e.isGeographic?1:r);return n===0&&s===0&&o===0?i.minDemResolutionForPoints:.01*Math.max(n,s,o)}function Dwe(t,e,i,r,n,s,o,a,l,c,u){const d=RJe[u.mode];let p,m,y=0;if(jr(t,e,i,r,l.spatialReference,n,a))return d.requiresAlignment(u)?(y=d.applyElevationAlignmentBuffer(r,n,s,o,a,l,c,u),p=s,m=o):(p=r,m=n),jr(p,l.spatialReference,m,s,c.spatialReference,o,a)?y:void 0}function m_(t,e,i,r,n){const s=(TN(t)?t.z:Kye(t)?t.array[t.offset+2]:t[2])||0;switch(i.mode){case"on-the-ground":{const o=pf(e,t,"ground")??0;return n.verticalDistanceToGround=0,n.sampledElevation=o,void(n.z=o)}case"relative-to-ground":{const o=pf(e,t,"ground")??0,a=i.geometryZWithOffset(s,r);return n.verticalDistanceToGround=a,n.sampledElevation=o,void(n.z=a+o)}case"relative-to-scene":{const o=pf(e,t,"scene")??0,a=i.geometryZWithOffset(s,r);return n.verticalDistanceToGround=a,n.sampledElevation=o,void(n.z=a+o)}case"absolute-height":{const o=i.geometryZWithOffset(s,r),a=pf(e,t,"ground")??0;return n.verticalDistanceToGround=o-a,n.sampledElevation=a,void(n.z=o)}default:return void(n.z=0)}}function xJe(t,e,i,r){return m_(t,e,i,r,W2),W2.z}function FR(t,e,i){return e==null||i==null?t.definedChanged:e==="on-the-ground"&&i==="on-the-ground"?t.staysOnTheGround:e===i||e!=="on-the-ground"&&i!=="on-the-ground"?an.UPDATE:t.onTheGroundChanged}function xh(t){return t==="relative-to-ground"||t==="relative-to-scene"}function g_(t){return t!=="absolute-height"}function TJe(t,e,i,r,n){m_(e,i,n,r,W2),Lwe(t,W2.verticalDistanceToGround);const s=W2.sampledElevation,o=Nn(PJe,t.transformation);return jM[0]=e.x,jM[1]=e.y,jM[2]=W2.z,ic(e.spatialReference,jM,o,r.spatialReference)?t.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),s}function SJe(t,e,i,r,n,s){let o=0;const a=s.spatialReference;e*=3,r*=3;for(let l=0;l<n;++l){const c=t[e],u=t[e+1],d=t[e+2],p=s.getElevation(c,u,d,a,"ground")??0;o+=p,i[r]=c,i[r+1]=u,i[r+2]=p,e+=3,r+=3}return o/n}function EJe(t,e,i,r,n,s,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,d=s.spatialReference;e*=3,r*=3;for(let p=0;p<n;++p){const m=t[e],y=t[e+1],_=t[e+2],v=s.getElevation(m,y,_,d,"ground")??0;l+=v,i[r]=m,i[r+1]=y,i[r+2]=u==null?_+v+c:v+c,e+=3,r+=3}return l/n}function CJe(t,e,i,r,n,s,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,d=s.spatialReference;e*=3,r*=3;for(let p=0;p<n;++p){const m=t[e],y=t[e+1],_=t[e+2],v=s.getElevation(m,y,_,d,"scene")??0;l+=v,i[r]=m,i[r+1]=y,i[r+2]=u==null?_+v+c:v+c,e+=3,r+=3}return l/n}function AJe(t){const e=t.meterUnitOffset,i=t.featureExpressionInfoContext;return e!==0||i!=null}function OJe(t,e,i,r,n,s,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;e*=3,r*=3;for(let u=0;u<n;++u){const d=t[e],p=t[e+1],m=t[e+2];i[r]=d,i[r+1]=p,i[r+2]=c==null?m+l:l,e+=3,r+=3}return 0}let kR=class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};var an;(function(t){t[t.NONE=0]="NONE",t[t.UPDATE=1]="UPDATE",t[t.RECREATE=2]="RECREATE"})(an||(an={}));const RJe={"absolute-height":{applyElevationAlignmentBuffer:OJe,requiresAlignment:AJe},"on-the-ground":{applyElevationAlignmentBuffer:SJe,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:EJe,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:CJe,requiresAlignment:()=>!0}},PJe=be(),W2=new kR,jM=C();function vX(t){return t.mapPositions!=null}function Nwe(t,e,i,r,n){const s=t.stageObject,o=s.geometries;let a=0;for(const l of o){if(!vX(l))continue;const{update:c,averageGeometrySampledElevation:u}=kwe(l,e,i,r,n);a+=u,c&&s.geometryVertexAttributeUpdated(l,O.POSITION)}return a/o.length}function sb(t,e,i,r,n,s){const o=t.stageObject,a=e.centerPointInElevationSR;let l=0;o.usesVerticalDistanceToGround?(r(a,ul),Lwe(o,ul.verticalDistanceToGround),l=ul.sampledElevation):(r(a,ul),e.mode!=="absolute-height"&&(l=ul.sampledElevation));const c=Nn(MJe,s??o.transformation),u=oe(Fwe,c[12],c[13],c[14]);nr.TESTS_DISABLE_OPTIMIZATIONS?(cl[0]=a.x,cl[1]=a.y,cl[2]=ul.z,ic(a.spatialReference,cl,c,n.spatialReference)&&(s?Nn(s,c):o.transformation=c)):n.setAltitudeOfTransformation(ul.z,c);const d=bX/n.unitInMeters;return(Math.abs(c[12]-u[0])>=d||Math.abs(c[13]-u[1])>=d||Math.abs(c[14]-u[2])>=d)&&(s?Nn(s,c):o.transformation=c),l}const MJe=be();function $Je(t,e,i,r,n){const s=t.graphics3DSymbolLayer.lodRenderer;if(s==null)return 0;const o=e.centerPointInElevationSR;r(o,ul);const a=e.mode!=="absolute-height"?ul.sampledElevation:0,l=s.instanceData,c=t.instanceIndex,u=LJe;l.getGlobalTransform(c,u);const d=oe(Fwe,u[12],u[13],u[14]);nr.TESTS_DISABLE_OPTIMIZATIONS?(cl[0]=o.x,cl[1]=o.y,cl[2]=ul.z,ic(o.spatialReference,cl,u,n.spatialReference)&&l.setGlobalTransform(c,u)):n.setAltitudeOfTransformation(ul.z,u);const p=bX/n.unitInMeters;return(nr.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(u[12]-d[0])>=p||Math.abs(u[13]-d[1])>=p||Math.abs(u[14]-d[2])>=p)&&l.setGlobalTransform(c,u),a}function IJe(t,e,i,r,n){const s=t.stageObject,o=s.geometries;if(o.length===0)return 0;let a=0,l=null,c=0,u=!1;for(const d of o){if(!vX(d))continue;const p=d.attributes.get(O.POSITION);if(p!==l){const{update:m,averageGeometrySampledElevation:y}=kwe(d,e,i,r,n);c=y,l=p,u=m}u&&s.geometryVertexAttributeUpdated(d,O.POSITION),a+=c}return a/o.length}const bX=.01,cl=C(),Cu=C(),ex=C(),LJe=be(),Fwe=C(),ul=new kR;function kwe(t,e,i,r,n){let s=!1;const o=t.transformation,a=e.requiresSampledElevationInfo;Cu[0]=o[12],Cu[1]=o[13],Cu[2]=o[14],t.invalidateBoundingInfo();const l=t.getMutableAttribute(O.POSITION),c=l.data,u=l.size,d=c.length/u,p=new eY(t.mapPositions,i);let m=0,y=0;for(let _=0;_<d;_++){if(ex[0]=c[m],ex[1]=c[m+1],ex[2]=c[m+2],r(p,ul),a&&(y+=ul.sampledElevation),nr.TESTS_DISABLE_OPTIMIZATIONS)c[m]=p.array[p.offset],c[m+1]=p.array[p.offset+1],c[m+2]=ul.z,jr(c,i,m,c,n.spatialReference,m,1),c[m]-=Cu[0],c[m+1]-=Cu[1],c[m+2]-=Cu[2],s=!0;else{cl[0]=c[m]+Cu[0],cl[1]=c[m+1]+Cu[1],cl[2]=c[m+2]+Cu[2],n.setAltitude(cl,ul.z),c[m]=cl[0]-Cu[0],c[m+1]=cl[1]-Cu[1],c[m+2]=cl[2]-Cu[2];const v=bX/n.unitInMeters;(Math.abs(ex[0]-c[m])>=v||Math.abs(ex[1]-c[m+1])>=v||Math.abs(ex[2]-c[m+2])>=v)&&(s=!0)}m+=u,p.offset+=3}return y/=d,{update:s,averageGeometrySampledElevation:y}}function DJe(t){return!!t&&uS[t]!=null}function NJe(t){return 1/(uS[t]||1)}function FJe(){const t=Object.keys(uS);return t.sort(),t}const hIt=FJe(),kJe=ne.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function UJe(t){return{cachedResult:t.cachedResult,arcade:t.arcade?{func:t.arcade.func,context:t.arcade.modules.arcadeUtils.createExecContext(null,{sr:t.arcade.context.spatialReference}),modules:t.arcade.modules}:null}}function dIt(t){const e=t?.expression;if(typeof e=="string"){const i=Bwe(e);if(i!=null)return{cachedResult:i}}return null}async function pIt(t,e,i,r){const n=t?.expression;if(typeof n!="string")return null;const s=Bwe(n);if(s!=null)return{cachedResult:s};const o=await rW();Et(i);const a=o.arcadeUtils,l=a.createSyntaxTree(n);return a.dependsOnView(l)?(r?.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:e}),modules:o}}}function Uwe(t,e,i){return t.arcadeUtils.createFeature(e.attributes,e.geometry,i)}function ek(t,e){if(t!=null&&!zwe(t)){if(!e||!t.arcade)return void kJe.errorOncePerTick("Arcade support required but not provided");const i=e;i._geometry&&(i._geometry=Owe(i._geometry)),t.arcade.modules.arcadeUtils.updateExecContext(t.arcade.context,e)}}function zJe(t){if(t!=null){if(zwe(t))return t.cachedResult;const e=t.arcade;let i=e?.modules.arcadeUtils.executeFunction(e.func,e.context);return typeof i!="number"&&(t.cachedResult=0,i=0),i}return 0}function fIt(t,e=!1){let i=t?.featureExpressionInfo;const r=i?.expression;return e||r==="0"||(i=null),i??null}const BJe={cachedResult:0};function zwe(t){return t.cachedResult!=null}function Bwe(t){return t==="0"?0:null}let KN=class Vwe{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=NJe(e)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,i){const r=this.calculateOffsetRenderUnits(i);return this.featureExpressionInfoContext!=null?r:e+r}calculateOffsetRenderUnits(e){let i=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return r!=null&&(i+=zJe(r)*this._metersPerElevationInfoUnit),i/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=DJe(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}updateFeatureExpressionInfoContext(e,i,r){if(e==null)return void(this._featureExpressionInfoContext=null);const n=e?.arcade;n&&i!=null&&r!=null?(this._featureExpressionInfoContext=UJe(e),ek(this._featureExpressionInfoContext,Uwe(n.modules,i,r))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const i=new Vwe;return e!=null&&i.setFromElevationInfo(e),i}},VJe=class{constructor(e,i,r){this.graphic=e,this.renderingInfo=i,this.layer=r}};var Bt;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OPAQUE=2]="OPAQUE"})(Bt||(Bt={}));let GJe=class{constructor(e,i,r){this.baseMaterial=e,this.edgeMaterials=i,this.properties=r}},Kf=class{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,i,r,n,s,o,a,l=null){this.graphics3DSymbolLayer=e,this.stageObject=i,this._uniqueGeometries=r,this._uniqueMaterials=n,this._sharedResource=s,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e;const i=e.stage;i.addMany(this._uniqueMaterials),i.addMany(this._uniqueGeometries),i.add(this.stageObject)}destroy(){if(!this._stageLayer)return;const e=this._stageLayer.stage;e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const i=e.renderer.edgeView;i?.hasObject(this.stageObject)&&i.removeObject(this.stageObject),this.stageObject.dispose(),this._sharedResource?.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(e,i){if(this._edgeState==null)return;const r=_re(this._edgeState.baseMaterial);let n=!1;for(const s of this._edgeState.edgeMaterials)s.objectTransparency!==r&&(s.objectTransparency=r,n=!0);n&&this.resetEdgeObject(i),this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[e])}slicePlaneEnabledChanged(e,i){this._edgeState!=null&&(this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:e},!i),this._edgeState.properties.hasSlicePlane=e)}setVisibility(e){if(this._stageLayer!=null&&this._visible!==e&&(this._visible=e,this.stageObject.visible=e,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),this._edgeState)){const i=this._stageLayer.stage.renderer.ensureEdgeView();i.hasObject(this.stageObject)?i.updateObjectVisibility(this.stageObject,e):e&&this._addOrUpdateEdgeObject(i,!1)}}get visible(){return this._visible}alignWithElevation(e,i,r,n){if(this.elevationAligner==null)return;r!=null&&ek(this.elevationContext.featureExpressionInfoContext,r);const s=(o,a)=>m_(o,e,this.elevationContext,i,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,s,i),this.resetEdgeObject(n)}alignWithAbsoluteElevation(e,i,r){const n=(s,o)=>{o.sampledElevation=e,o.verticalDistanceToGround=0,o.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,n,i),this.resetEdgeObject(r)}getCenterObjectSpace(e=C()){return se(e,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(e=ds()){const i=this.stageObject.boundingVolumeObjectSpace;return Lge(e,i.min),Dge(e,i.max),e}computeAttachmentOrigin(e){const i=this.stageObject.effectiveTransformation;if(this.useObjectOriginAsAttachmentOrigin)e.render.origin[0]+=i[12],e.render.origin[1]+=i[13],e.render.origin[2]+=i[14],e.render.num++;else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(lm)&&(Fe(lm,lm,i),ce(e.render.origin,e.render.origin,lm),e.render.num++)}async getProjectedBoundingBox(e,i,r,n,s){const o=this.getBoundingBoxObjectSpace(s),a=jJe,l=dW(o)?1:a.length;for(let u=0;u<l;u++){const d=a[u];S0[0]=o[d[0]],S0[1]=o[d[1]],S0[2]=o[d[2]],Fe(S0,S0,this.stageObject.transformation),sv[3*u]=S0[0],sv[3*u+1]=S0[1],sv[3*u+2]=S0[2]}if(!e(sv,0,l))return null;vr(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let d=0;d<3;d++)o[d]=Math.min(o[d],sv[u+d]),o[d+3]=Math.max(o[d+3],sv[u+d]);c&&r.push({location:sv.slice(u,u+3),screenSpaceBoundingRect:c})}if(i?.service&&this.elevationContext.mode!=="absolute-height"){Rd(o,lm);const u=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let d=0;if(i.useViewElevation)d=i.service.getElevation(lm[0],lm[1],u)??0;else try{const p=_X(o,i.service.spatialReference,i);d=await i.service.queryElevation(lm[0],lm[1],n,p,u)??0}catch{}Ige(o,0,0,-this.alignedSampledElevation+d)}return o}addObjectState(e,i){e===Rg.Highlight&&i.addObject(this.stageObject,this.stageObject.highlight()),e===Rg.MaskOccludee&&i.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}resetEdgeObject(e){if(this._edgeState==null)return;const i=this._stageLayer.stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(i,e):i.removeObject(this.stageObject)}_addOrUpdateEdgeObject(e,i){const r=this._edgeState;if(r==null)return;const n=_re(r.baseMaterial);for(const s of r.edgeMaterials)s.objectTransparency=n;e.addOrUpdateObject3D(this.stageObject,r.edgeMaterials,r.properties,!i).then(()=>this._stageLayer?.sync())}};function _re(t){return t.isVisible()?t.parameters.transparent?Bt.TRANSPARENT:Bt.OPAQUE:Bt.INVISIBLE}const sv=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],S0=C(),lm=C(),jJe=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];let Gwe=class{constructor(e,i=null){this.labelText=i,this.elevationOffset=e??0}};const jwe=3,XG=3,Hwe=10;let qwe=class{constructor(e,i=null){this.geometry=e,this.textures=i}},Wwe=class{constructor(e,i,r){this.components=e,this.minScreenSpaceRadius=i,this.pivotOffset=r;const n=this.geometries;this.numVertices=n.reduce((s,o)=>s+o.attributes.get(O.POSITION).indices.length,0)}get geometries(){return a4(this.components.map(e=>e.geometry))}},Ywe=class{constructor(e){this.levels=e,this.levels.sort((i,r)=>i.minScreenSpaceRadius===r.minScreenSpaceRadius?i.numVertices-r.numVertices:i.minScreenSpaceRadius-r.minScreenSpaceRadius)}};function HM(t){const e=[];return t.levels.forEach(i=>i.components.forEach(r=>e.push(r.geometry.material))),a4(e)}function vre(t){const e=new Array;return t.levels.forEach(i=>i.components.forEach(r=>{r.textures!=null&&e.push(...r.textures)})),a4(e)}function bre(t){const e=new Array;return t.levels.forEach(i=>i.components.forEach(r=>e.push(r.geometry))),a4(e)}function HJe(t){switch(t){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function Xwe(t,e){const i=(r,n,s=!1)=>new Ywe(r.map(o=>{const a=n(o.tesselation);return s&&RHe(a),new Wwe([new qwe(a)],o.minScreenSpaceRadius)}));switch(t){case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],r=>CHe(e,.5,r,!0));case"cube":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>yHe(e,1));case"cone":return i(VU,r=>zte(e,1,.5,r,!1),!0);case"inverted-cone":return i(VU,r=>zte(e,1,.5,r,!0),!0);case"cylinder":return i(VU,r=>OHe(e,1,.5,r,[0,0,1],[0,0,.5]));case"tetrahedron":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>EHe(e,1),!0);case"diamond":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>wHe(e,1),!0);default:return}}const VU=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];let Yu=class{constructor(e){this.estimated=!1,this.verticesPerFeature=e.verticesPerFeature??0,this.verticesPerCoordinate=e.verticesPerCoordinate??0,this.drawCallsPerFeature=e.drawCallsPerFeature??0,this.memory=e.memory??new Zwe}},wX=class extends Yu{constructor(e){super(e),this.estimated=!0}},qJe=class extends Yu{constructor(e,i){super(i),this.numComplexities=e}},WJe=class extends wX{constructor(e,i){super(i),this.numComplexities=e}},Zwe=class{constructor(){this.bytesPerFeature=0,this.bytesPerFeatureLabel=0,this.resourceBytes=0,this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}};function YJe(t){return t.type==="fill"}function XJe(t){return t.type==="extrude"}function ZJe(t){return t&&t.enabled&&(XJe(t)||YJe(t))&&t.edges!=null}function JJe(t){return t&&t.enabled&&t.edges||null}function Jwe(t,e){return KJe(JJe(t),e)}function KJe(t,e){if(t==null)return null;const i=t.color!=null?TW(Ye.toUnitRGBA(t.color)):Mt(0,0,0,0),r=ra(t.size),n=ra(t.extensionLength);switch(t.type){case"solid":return QJe({color:i,size:r,extensionLength:n,...e});case"sketch":return eKe({color:i,size:r,extensionLength:n,...e});default:return}}function QJe(t){return{...tKe,...t,type:"solid"}}function eKe(t){return{...iKe,...t,type:"sketch"}}const tKe={color:Mt(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Bt.OPAQUE,hasSlicePlane:!1},iKe={color:Mt(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Bt.OPAQUE,hasSlicePlane:!1};function UR(t,e){switch(e.normalType){case Ei.Compressed:t.attributes.add(O.NORMALCOMPRESSED,"vec2"),t.vertex.code.add(b`vec3 normalModel() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
return vec3(normalCompressed + sign(normalCompressed) * min(z, 0.0), z);
}`);break;case Ei.Attribute:t.attributes.add(O.NORMAL,"vec3"),t.vertex.code.add(b`vec3 normalModel() {
return normal;
}`);break;case Ei.ScreenDerivative:t.fragment.code.add(b`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:e.normalType;case Ei.COUNT:case Ei.Ground:}}var Ei;(function(t){t[t.Attribute=0]="Attribute",t[t.Compressed=1]="Compressed",t[t.Ground=2]="Ground",t[t.ScreenDerivative=3]="ScreenDerivative",t[t.COUNT=4]="COUNT"})(Ei||(Ei={}));function Kwe(t,e){const i=t.fragment;switch(i.code.add(b`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),e.doubleSidedMode){case Kr.None:i.code.add(b`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case Kr.View:i.code.add(b`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case Kr.WindingOrder:i.code.add(b`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:e.doubleSidedMode;case Kr.COUNT:}}var Kr;(function(t){t[t.None=0]="None",t[t.View=1]="View",t[t.WindingOrder=2]="WindingOrder",t[t.COUNT=3]="COUNT"})(Kr||(Kr={}));let ZS=class{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.attributes.get(O.POSITION).indices.length}write(e,i,r,n,s){mZe(r,this.vertexBufferLayout,e,i,n,s)}};function tk(t,e){switch(e.normalType){case Ei.Attribute:case Ei.Compressed:t.include(UR,e),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("vNormalView","vec3"),t.vertex.uniforms.add(new mO("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel),new sp("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal)),t.vertex.code.add(b`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case Ei.Ground:t.include(hT,e),t.varyings.add("vNormalWorld","vec3"),t.vertex.code.add(b`
        void forwardNormal() {
          vNormalWorld = ${e.spherical?b`normalize(vPositionWorldCameraRelative);`:b`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case Ei.ScreenDerivative:t.vertex.code.add(b`void forwardNormal() {}`);break;default:e.normalType;case Ei.COUNT:}}let Qwe=class extends o1e{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Hr()}},exe=class extends a1e{constructor(){super(...arguments),this.transformNormalGlobalFromModel=Hr(),this.toMapSpace=Kt()}};const xX={func:Pi.LESS},QN={func:Pi.ALWAYS},Ff={mask:255},txe={mask:0},rKe=t=>({function:{func:Pi.NOTEQUAL,ref:t,mask:t},operation:{fail:Gr.KEEP,zFail:Gr.KEEP,zPass:Gr.KEEP}}),nKe=t=>({function:{func:Pi.ALWAYS,ref:t,mask:t},operation:{fail:Gr.KEEP,zFail:Gr.KEEP,zPass:Gr.REPLACE}}),D_={function:{func:Pi.ALWAYS,ref:gl.OutlineVisualElementMask,mask:gl.OutlineVisualElementMask},operation:{fail:Gr.KEEP,zFail:Gr.KEEP,zPass:Gr.ZERO}},y_={function:{func:Pi.ALWAYS,ref:gl.OutlineVisualElementMask,mask:gl.OutlineVisualElementMask},operation:{fail:Gr.KEEP,zFail:Gr.KEEP,zPass:Gr.REPLACE}},ixe={function:{func:Pi.EQUAL,ref:gl.OutlineVisualElementMask,mask:gl.OutlineVisualElementMask},operation:{fail:Gr.KEEP,zFail:Gr.KEEP,zPass:Gr.KEEP}},rxe={function:{func:Pi.NOTEQUAL,ref:gl.OutlineVisualElementMask,mask:gl.OutlineVisualElementMask},operation:{fail:Gr.KEEP,zFail:Gr.KEEP,zPass:Gr.KEEP}};function nxe({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:i,roughnessFactor:r,emissiveTexture:n,emissiveFactor:s,occlusionTexture:o}){return t==null&&e==null&&n==null&&(s==null||Po(s,Gs))&&o==null&&(r==null||r===1)&&(i==null||i===1||i===0)}const ik=[1,1,.5],TX=[0,.6,.2],sKe=[0,1,.2];function sxe(t){t.vertex.code.add(b`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}var ls;function oKe(t){switch(t){case"multiply":default:return ls.Multiply;case"ignore":return ls.Ignore;case"replace":return ls.Replace;case"tint":return ls.Tint}}function oxe(t,e,i){if(t==null||e===ls.Ignore)return i[0]=255,i[1]=255,i[2]=255,void(i[3]=255);const r=_e(Math.round(t[3]*e5),0,e5),n=r===0||e===ls.Tint?0:e===ls.Replace?aKe:lKe;i[0]=_e(Math.round(t[0]*tx),0,tx),i[1]=_e(Math.round(t[1]*tx),0,tx),i[2]=_e(Math.round(t[2]*tx),0,tx),i[3]=r+n}(function(t){t[t.Multiply=1]="Multiply",t[t.Ignore=2]="Ignore",t[t.Replace=3]="Replace",t[t.Tint=4]="Tint"})(ls||(ls={}));const tx=255,e5=85,aKe=e5,lKe=2*e5;function axe(t){t.vertex.code.add(b`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${b.int(ls.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${b.int(ls.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${b.int(ls.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${b.int(ls.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}let zR=class extends Qr{constructor(e,i){super(e,"int",_i.Pass,(r,n,s)=>r.setUniform1i(e,i(n,s)))}};function lxe(t,e){e.hasSymbolColors?(t.include(axe),t.attributes.add(O.SYMBOLCOLOR,"vec4"),t.varyings.add("colorMixMode","mediump float"),t.vertex.code.add(b`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(t.fragment.uniforms.add(new zR("colorMixMode",i=>swe[i.colorMixMode])),t.vertex.code.add(b`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function gw(t,e){e.hasVertexColors?(t.attributes.add(O.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(b`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(b`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):t.vertex.code.add(b`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function cxe(t){t.code.add(b`const float MAX_RGBA4_FLOAT =
15.0 / 16.0 +
15.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 / 16.0;
const vec4 FIXED_POINT_FACTORS_RGBA4 = vec4(1.0, 16.0, 16.0 * 16.0, 16.0 * 16.0 * 16.0);
vec4 floatToRgba4(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA4_FLOAT);
vec4 fixedPointU4 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS_RGBA4) * 16.0);
const float toU4AsFloat = 1.0 / 15.0;
return fixedPointU4 * toU4AsFloat;
}
const vec4 RGBA4_2_FLOAT_FACTORS = vec4(
15.0 / (16.0),
15.0 / (16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0 * 16.0)
);
float rgba4ToFloat(vec4 rgba) {
return dot(rgba, RGBA4_2_FLOAT_FACTORS);
}`)}function Mg(t,e){switch(e.output){case U.Shadow:case U.ShadowHighlight:case U.ShadowExcludeHighlight:t.fragment.include(cxe),t.fragment.code.add(b`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
return depth + SLOPE_SCALE * m + BIAS;
}
void outputDepth(float _linearDepth) {
fragColor = floatToRgba4(_calculateFragDepth(_linearDepth));
}`);break;case U.Depth:t.fragment.include(Eh),t.fragment.code.add(b`void outputDepth(float _linearDepth) {
fragColor = float2rgba(_linearDepth);
}`)}}function cKe(t){t.fragment.code.add(b`
    #define discardOrAdjustAlpha(color) { if (color.a < ${b.float(co)}) { discard; } }
  `)}let ob=class extends Qr{constructor(e,i){super(e,"float",_i.Draw,(r,n,s)=>r.setUniform1f(e,i(n,s)))}};function ab(t,e){uxe(t,e,new Oe("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function uKe(t,e){uxe(t,e,new ob("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function uxe(t,e,i){const r=t.fragment;switch(e.alphaDiscardMode!==Wi.Mask&&e.alphaDiscardMode!==Wi.MaskBlend||r.uniforms.add(i),e.alphaDiscardMode){case Wi.Blend:return t.include(cKe);case Wi.Opaque:r.code.add(b`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case Wi.Mask:r.code.add(b`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case Wi.MaskBlend:t.fragment.code.add(b`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function hxe(t,e){const{vertex:i,fragment:r}=t,n=e.hasColorTexture&&e.alphaDiscardMode!==Wi.Opaque;switch(e.output){case U.Depth:case U.Shadow:case U.ShadowHighlight:case U.ShadowExcludeHighlight:case U.ObjectAndLayerIdColor:tc(i,e),t.include(ml,e),t.include(xf,e),t.include(hg,e),t.include(Mg,e),t.include(vn,e),t.include(DR,e),Ub(t),t.varyings.add("depth","float"),n&&r.uniforms.add(new Je("tex",s=>s.texture)),i.code.add(b`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
forwardTextureCoordinates();
forwardObjectAndLayerIdColor();
}`),t.include(ab,e),r.code.add(b`
          void main(void) {
            discardBySlice(vpos);
            ${n?b`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${e.output===U.ObjectAndLayerIdColor?b`outputObjectAndLayerIdColor();`:b`outputDepth(depth);`}
          }
        `);break;case U.Normal:{tc(i,e),t.include(ml,e),t.include(UR,e),t.include(tk,e),t.include(xf,e),t.include(hg,e),n&&r.uniforms.add(new Je("tex",o=>o.texture)),e.normalType===Ei.ScreenDerivative&&t.varyings.add("vPositionView","vec3");const s=e.normalType===Ei.Attribute||e.normalType===Ei.Compressed;i.code.add(b`
          void main(void) {
            vpos = getVertexInLocalOriginSpace();

            ${s?b`vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:b`
                  // Get vertex position in camera space for screen-space derivative normals
                  vPositionView = (view * vec4(vpos, 1.0)).xyz;
                `}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),t.include(vn,e),t.include(ab,e),r.code.add(b`
          void main() {
            discardBySlice(vpos);
            ${n?b`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${e.normalType===Ei.ScreenDerivative?b`vec3 normal = screenDerivativeNormal(vPositionView);`:b`
                  vec3 normal = normalize(vNormalWorld);
                  if (gl_FrontFacing == false){
                    normal = -normal;
                  }`}
            fragColor = vec4(0.5 + 0.5 * normal, 1.0);
          }
        `);break}case U.Highlight:tc(i,e),t.include(ml,e),t.include(xf,e),t.include(hg,e),n&&r.uniforms.add(new Je("tex",s=>s.texture)),i.code.add(b`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();
}`),t.include(vn,e),t.include(ab,e),t.include(I_,e),r.code.add(b`
          void main() {
            discardBySlice(vpos);
            ${n?b`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}function dxe(t,e){const i=t.fragment;e.hasVertexTangents?(t.attributes.add(O.TANGENT,"vec4"),t.varyings.add("vTangent","vec4"),e.doubleSidedMode===Kr.WindingOrder?i.code.add(b`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):i.code.add(b`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):i.code.add(b`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),e.textureCoordinateType!==In.None&&(t.include(yY,e),i.uniforms.add(e.pbrTextureBindType===_i.Pass?new Je("normalTexture",r=>r.textureNormal):new oh("normalTexture",r=>r.textureNormal)),i.code.add(b`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;
return tangentSpace * rawNormal;
}`))}let pxe=class extends Qr{constructor(e,i){super(e,"vec2",_i.Draw,(r,n,s,o)=>r.setUniform2fv(e,i(n,s,o)))}};const GU=4;function hKe(){const t=new mi,e=t.fragment;t.include(ha);const i=(GU+1)/2,r=1/(2*i*i);return e.include(vh),e.uniforms.add(new Je("depthMap",n=>n.depthTexture),new oh("tex",n=>n.colorTexture),new pxe("blurSize",n=>n.blurSize),new Oe("projScale",(n,s)=>{const o=br(s.camera.eye,s.camera.center);return o>5e4?Math.max(0,n.projScale-(o-5e4)):n.projScale}),new zi("nearFar",(n,s)=>s.camera.nearFar)),e.code.add(b`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${b.float(r)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),t.outputs.add("fragBlur","float"),e.code.add(b`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${b.int(GU)}; r <= ${b.int(GU)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      fragBlur = b / w_total;
    }
  `),t}const dKe=Object.freeze(Object.defineProperty({__proto__:null,build:hKe},Symbol.toStringTag,{value:"Module"}));let fxe=class mxe extends Ci{initializeProgram(e){return new wi(e.rctx,mxe.shader.get().build(),fi)}initializePipeline(){return Ot({colorWrite:Ft})}};fxe.shader=new bi(dKe,()=>pe(()=>import("./SSAOBlur.glsl-933fc80f.js"),[],import.meta.url));const pKe="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";let fKe=class extends Ki{constructor(){super(...arguments),this.projScale=1}},mKe=class extends fKe{constructor(){super(...arguments),this.intensity=1}},gKe=class extends Ki{},yKe=class extends gKe{constructor(){super(...arguments),this.blurSize=Ue()}};function rk(t){t.fragment.uniforms.add(new ai("projInfo",(e,i)=>_Ke(i))),t.fragment.uniforms.add(new zi("zScale",(e,i)=>vKe(i))),t.fragment.code.add(b`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function _Ke(t){const e=t.camera.projectionMatrix;return e[11]===0?Mr(wre,2/(t.camera.fullWidth*e[0]),2/(t.camera.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):Mr(wre,-2/(t.camera.fullWidth*e[0]),-2/(t.camera.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}const wre=Kt();function vKe(t){return t.camera.projectionMatrix[11]===0?si(xre,0,1):si(xre,1,0)}const xre=Ue(),Tre=16;function bKe(){const t=new mi,e=t.fragment;return t.include(ha),e.include(vh),t.include(rk),e.uniforms.add(new Oe("radius",(i,r)=>SX(r.camera))),e.code.add(b`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),e.code.add(b`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),e.uniforms.add(new zi("nearFar",(i,r)=>r.camera.nearFar),new Je("normalMap",i=>i.normalTexture),new Je("depthMap",i=>i.depthTexture),new Oe("projScale",i=>i.projScale),new Je("rnm",i=>i.noiseTexture),new zi("rnmScale",(i,r)=>si(Sre,r.camera.fullWidth/i.noiseTexture.descriptor.width,r.camera.fullHeight/i.noiseTexture.descriptor.height)),new Oe("intensity",i=>i.intensity),new zi("screenSize",(i,r)=>si(Sre,r.camera.fullWidth,r.camera.fullHeight))),t.outputs.add("fragOcclusion","float"),e.code.add(b`
    void main(void) {
      fillSphere();
      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
        fragOcclusion = 0.0;
        return;
      }

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy, currentPixelDepth);

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
      bool isTerrain = norm4.w < 0.5;

      float sum = 0.0;
      vec3 tapPixelPos;

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${b.int(Tre)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        //don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        if (isTerrain) {
          if (texture(normalMap, tcTap).w < 0.5) {
            continue;
          }
        }

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum += aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${b.int(Tre)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;

      fragOcclusion = A;
    }
  `),t}function SX(t){return Math.max(10,20*t.computeScreenPixelSizeAtDist(Math.abs(4*t.relativeElevation)))}const Sre=Ue(),wKe=Object.freeze(Object.defineProperty({__proto__:null,build:bKe,getRadius:SX},Symbol.toStringTag,{value:"Module"}));let gxe=class yxe extends Ci{initializeProgram(e){return new wi(e.rctx,yxe.shader.get().build(),fi)}initializePipeline(){return Ot({colorWrite:Ft})}};gxe.shader=new bi(wKe,()=>pe(()=>import("./SSAO.glsl-d3c5b1e9.js"),[],import.meta.url));const pA=2;let fA=class extends fw{constructor(e){super(e),this._context=null,this._passParameters=new mKe,this._drawParameters=new yKe,this.produces=new Map([[ae.SSAO,()=>this._produces()]])}_produces(){return this._enableTime!=null&&this._context!=null}consumes(){return this._produces()?eqe:kF}initializeRenderContext(e){this._context=e,this.addHandles([le(()=>this.view.qualitySettings.ambientOcclusion||this._context?.isFeatureEnabled(Gn.SSAO),i=>i?this._enable():this._disable(),Yi)])}uninitializeRenderContext(){this._disable(),this._context=null}_disable(){this._passParameters.noiseTexture=et(this._passParameters.noiseTexture),this._enableTime=null}destroy(){this._disable()}_enable(){if(this._enableTime!=null||!this._context)return;const e=Uint8Array.from(atob(pKe),r=>r.charCodeAt(0)),i=new Li;i.wrapMode=Nt.CLAMP_TO_EDGE,i.pixelFormat=pt.RGB,i.wrapMode=Nt.REPEAT,i.hasMipmap=!0,i.width=32,i.height=32,this._passParameters.noiseTexture=new Pt(this._context.renderContext.rctx,i,e),this._ssaoTechnique==null&&(this._ssaoTechnique=this._context.techniqueRepository.acquire(gxe)),this._blurTechnique==null&&(this._blurTechnique=this._context.techniqueRepository.acquire(fxe)),this._enableTime=0,this._context?.requestRender()}renderNode(e,i,r){const n=e.bindParameters,s=n.linearDepth?.colorTexture,o=r?.normal?.colorTexture;if(this._enableTime==null||this._context==null||s==null||!o)return;if(!this._ssaoTechnique.compiled||!this._blurTechnique.compiled)return this._enableTime=e.time,void this._context.requestRender();this._enableTime===0&&(this._enableTime=e.time);const a=e.rctx,l=n.camera,c=this.view.qualitySettings.fadeDuration,u=c>0?Math.min(c,e.time-this._enableTime)/c:1;this._passParameters.normalTexture=o,this._passParameters.depthTexture=s,this._passParameters.projScale=1/l.computeScreenPixelSizeAtDist(1),this._passParameters.intensity=4*xKe/SX(l)**6*u;const d=l.fullViewport[2],p=l.fullViewport[3],m=Math.round(d/pA),y=Math.round(p/pA),_=this._context.fbos,v=_.acquire(hi.RED,d,p);a.bindFramebuffer(v.fbo),a.setViewport(0,0,d,p),a.bindTechnique(this._ssaoTechnique,this._passParameters,n).bindDraw(this._drawParameters,n,this._passParameters),a.screen.draw();const w=a.bindTechnique(this._blurTechnique,this._passParameters,n);a.setViewport(0,0,m,y);const x=_.acquire(hi.RED,m,y);a.bindFramebuffer(x.fbo),this._drawParameters.colorTexture=v.colorTexture,si(this._drawParameters.blurSize,0,pA/p),w.bindDraw(this._drawParameters,n,this._passParameters),a.setViewport(0,0,m,y),a.screen.draw(),v.release();const T=_.acquire(hi.RED,m,y);return a.bindFramebuffer(T.fbo),a.setViewport(0,0,d,p),a.setClearColor(1,1,1,0),a.clear(hr.COLOR_BUFFER_BIT),a.setViewport(0,0,m,y),this._drawParameters.colorTexture=x.colorTexture,si(this._drawParameters.blurSize,pA/d,0),w.bindDraw(this._drawParameters,n,this._passParameters),a.screen.draw(),a.setViewport4fv(l.fullViewport),x.release(),u<1&&this._context.requestRender(),T}};h([f({constructOnly:!0})],fA.prototype,"view",void 0),h([f()],fA.prototype,"_context",void 0),fA=h([z("esri.views.3d.webgl-engine.effects.ssao.SSAO")],fA);const xKe=.5;function BR(t,e){const i=t.fragment;e.receiveAmbientOcclusion?(i.uniforms.add(new Je("ssaoTex",(r,n)=>n.ssao?.colorTexture)),i.constants.add("blurSizePixelsInverse","float",1/pA),i.code.add(b`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).r;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):i.code.add(b`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function TKe(t){const e=t.fragment.code;e.add(b`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),e.add(b`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),e.add(b`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function EX(t,e){const i=t.fragment.code;t.include(CR),e.pbrMode!==it.Normal&&e.pbrMode!==it.Schematic&&e.pbrMode!==it.Terrain&&e.pbrMode!==it.TerrainWithWater||(i.add(b`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),i.add(b`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),e.pbrMode!==it.Normal&&e.pbrMode!==it.Schematic||(t.include(TKe),i.add(b`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),i.add(b`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),i.add(b`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),i.add(b`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function SKe(t,e){const i=t.fragment.code;t.include(CR),i.add(b`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),i.add(b`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),i.add(b`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),i.add(b`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),i.add(b`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}function VR(t){t.constants.add("ambientBoostFactor","float",Qve)}function JS(t){t.uniforms.add(new Oe("lightingGlobalFactor",(e,i)=>i.lighting.globalFactor))}function Vb(t,e){const i=t.fragment;switch(t.include(BR,e),e.pbrMode!==it.Disabled&&t.include(EX,e),t.include(bY,e),t.include(CR),i.code.add(b`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${e.pbrMode===it.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),VR(i),JS(i),Bg(i),i.code.add(b`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${e.spherical?b`normalize(vPosWorld)`:b`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),Wf(i),i.code.add(b`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),e.pbrMode){case it.Disabled:case it.WaterOnIntegratedMesh:case it.Water:t.include(CN),i.code.add(b`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case it.Normal:case it.Schematic:i.code.add(b`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),i.code.add(b`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),e.useFillLights?i.uniforms.add(new Tf("hasFillLights",(r,n)=>n.enableFillLights)):i.constants.add("hasFillLights","bool",!1),i.code.add(b`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0) ? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),i.uniforms.add(new Oe("lightingSpecularStrength",(r,n)=>n.lighting.mainLight.specularStrength),new Oe("lightingEnvironmentStrength",(r,n)=>n.lighting.mainLight.environmentStrength)),i.code.add(b`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
float normalDirectionModifier = mix(1., min(mix(0.1, 2.0, (inputs.NdotNG + 1.) * 0.5), 1.0), clamp(inputs.roughness * 5.0, 0.0 , 1.0));
inputs.skyRadianceToSurface = (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.groundRadianceToSurface = 0.5 * GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),i.code.add(b`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = _emission == vec3(0.0) ? _emission : pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${e.pbrMode!==it.Schematic||e.hasColorTexture?b`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`:b`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case it.Terrain:case it.TerrainWithWater:t.include(CN),i.code.add(b`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluateTerrainLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:e.pbrMode;case it.COUNT:}}let EKe=class extends Qr{constructor(e,i,r){super(e,"mat4",_i.Draw,(n,s,o,a)=>n.setUniformMatrix4fv(e,i(s,o,a)),r)}},CKe=class extends Qr{constructor(e,i,r){super(e,"mat4",_i.Pass,(n,s,o)=>n.setUniformMatrix4fv(e,i(s,o)),r)}},AKe=class extends Ki{constructor(){super(...arguments),this.origin=C()}},OKe=class extends AKe{},RKe=class extends Ki{constructor(){super(...arguments),this.modelTransformation=zr}},CX=class extends RKe{constructor(){super(...arguments),this.origin=C()}};function nk(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new CKe("shadowMapMatrix",(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),_xe(t))}function Gb(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new EKe("shadowMapMatrix",(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),_xe(t))}function _xe(t){const e=t.fragment;e.include(cxe),e.uniforms.add(new Je("shadowMapTex",(i,r)=>r.shadowMap.depthTexture),new zR("numCascades",(i,r)=>r.shadowMap.numCascades),new ai("cascadeDistances",(i,r)=>r.shadowMap.cascadeDistances)),e.code.add(b`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, ivec2 textureSize, vec3 lvpos) {
float xScale = float(textureSize.y) / float(textureSize.x);
return vec2((float(i) + lvpos.x) * xScale, lvpos.y);
}
float readShadowMapDepth(ivec2 uv, sampler2D _depthTex) {
return rgba4ToFloat(texelFetch(_depthTex, uv, 0));
}
float posIsInShadow(ivec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, ivec2 texSize, sampler2D _depthTex) {
vec2 st = fract(uv * vec2(texSize) + vec2(0.5));
ivec2 base = ivec2(uv * vec2(texSize) - vec2(0.5));
float s00 = posIsInShadow(ivec2(base.x, base.y), lvpos, _depthTex);
float s10 = posIsInShadow(ivec2(base.x + 1, base.y), lvpos, _depthTex);
float s11 = posIsInShadow(ivec2(base.x + 1, base.y + 1), lvpos, _depthTex);
float s01 = posIsInShadow(ivec2(base.x, base.y + 1), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
ivec2 size = textureSize(shadowMapTex, 0);
vec2 uv = cascadeCoordinates(i, size, lvpos);
return filterShadow(uv, lvpos, size, shadowMapTex);
}`)}function sa(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function vxe(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function NL(t,e,i,r,n,s,o,a,l){const c=new Float32Array(9);return c[0]=t,c[1]=e,c[2]=i,c[3]=r,c[4]=n,c[5]=s,c[6]=o,c[7]=a,c[8]=l,c}function PKe(t,e){return new Float32Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:vxe,create:sa,createView:PKe,fromValues:NL},Symbol.toStringTag,{value:"Module"}));function MKe(t){t.vertex.uniforms.add(new sp("colorTextureTransformMatrix",e=>e.colorTextureTransformMatrix!=null?e.colorTextureTransformMatrix:sa())),t.varyings.add("colorUV","vec2"),t.vertex.code.add(b`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function $Ke(t){t.vertex.uniforms.add(new sp("normalTextureTransformMatrix",e=>e.normalTextureTransformMatrix!=null?e.normalTextureTransformMatrix:sa())),t.varyings.add("normalUV","vec2"),t.vertex.code.add(b`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function IKe(t){t.vertex.uniforms.add(new sp("emissiveTextureTransformMatrix",e=>e.emissiveTextureTransformMatrix!=null?e.emissiveTextureTransformMatrix:sa())),t.varyings.add("emissiveUV","vec2"),t.vertex.code.add(b`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function LKe(t){t.vertex.uniforms.add(new sp("occlusionTextureTransformMatrix",e=>e.occlusionTextureTransformMatrix!=null?e.occlusionTextureTransformMatrix:sa())),t.varyings.add("occlusionUV","vec2"),t.vertex.code.add(b`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function DKe(t){t.vertex.uniforms.add(new sp("metallicRoughnessTextureTransformMatrix",e=>e.metallicRoughnessTextureTransformMatrix!=null?e.metallicRoughnessTextureTransformMatrix:sa())),t.varyings.add("metallicRoughnessUV","vec2"),t.vertex.code.add(b`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function SO(t){t.include(Jf),t.code.add(b`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${b.int(ls.Multiply)}) {
        return allMixed;
      }
      if (mode == ${b.int(ls.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${b.int(ls.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${b.int(ls.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${b.int(ls.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function NKe(t){const e=new mi,{vertex:i,fragment:r,varyings:n}=e;if(tc(i,t),e.include(AR),n.add("vpos","vec3"),e.include(hg,t),e.include(s1e,t),e.include(Xbe,t),t.hasColorTextureTransform&&e.include(MKe),t.output===U.Color||t.output===U.Alpha){t.hasNormalTextureTransform&&e.include($Ke),t.hasEmissionTextureTransform&&e.include(IKe),t.hasOcclusionTextureTransform&&e.include(LKe),t.hasMetallicRoughnessTextureTransform&&e.include(DKe),Xd(i,t),e.include(UR,t),e.include(ml,t);const s=t.normalType===Ei.Attribute||t.normalType===Ei.Compressed;s&&t.offsetBackfaces&&e.include(sxe),e.include(dxe,t),e.include(tk,t),t.instancedColor&&e.attributes.add(O.INSTANCECOLOR,"vec4"),n.add("vPositionLocal","vec3"),e.include(xf,t),e.include(qS,t),e.include(lxe,t),e.include(gw,t),i.uniforms.add(new ai("externalColor",o=>o.externalColor)),n.add("vcolorExt","vec4"),t.multipassEnabled&&n.add("depth","float"),i.code.add(b`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${b.float(co)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = getVertexInLocalOriginSpace();
          vPositionLocal = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${s?b`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${t.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${s&&t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        ${t.hasColorTextureTransform?b`forwardColorUV();`:""}
        ${t.hasNormalTextureTransform?b`forwardNormalUV();`:""}
        ${t.hasEmissionTextureTransform?b`forwardEmissiveUV();`:""}
        ${t.hasOcclusionTextureTransform?b`forwardOcclusionUV();`:""}
        ${t.hasMetallicRoughnessTextureTransform?b`forwardMetallicRoughnessUV();`:""}
      }
    `)}switch(t.output){case U.Alpha:e.include(vn,t),e.include(ab,t),e.include(uc,t),r.uniforms.add(new Oe("opacity",s=>s.opacity),new Oe("layerOpacity",s=>s.layerOpacity)),t.hasColorTexture&&r.uniforms.add(new Je("tex",s=>s.texture)),r.include(SO),r.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        ${t.hasColorTexture?b`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:b`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?b`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:b`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        fragColor = vec4(opacity_);
      }
    `);break;case U.Color:e.include(vn,t),e.include(Vb,t),e.include(BR,t),e.include(ab,t),e.include(t.instancedDoublePrecision?nk:Gb,t),e.include(uc,t),Xd(r,t),r.uniforms.add(i.uniforms.get("localOrigin"),new $t("ambient",s=>s.ambient),new $t("diffuse",s=>s.diffuse),new Oe("opacity",s=>s.opacity),new Oe("layerOpacity",s=>s.layerOpacity)),t.hasColorTexture&&r.uniforms.add(new Je("tex",s=>s.texture)),e.include(vY,t),e.include(EX,t),r.include(SO),e.include(Kwe,t),VR(r),JS(r),Wf(r),r.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        ${t.hasColorTexture?b`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:b`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${t.normalType===Ei.ScreenDerivative?b`
                vec3 normal = screenDerivativeNormal(vPositionLocal);`:b`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${t.pbrMode===it.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${t.receiveShadows?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?b`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:b`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.hasNormalTexture?b`
                mat3 tangentSpace = ${t.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, ${t.hasNormalTextureTransform?b`normalUV`:"vuv0"});`:b`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${t.spherical?b`normalize(posWorld);`:b`vec3(0.0, 0.0, 1.0);`}

        ${t.snowCover?b`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${t.pbrMode===it.Normal||t.pbrMode===it.Schematic?b`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?b`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:b`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===Qe.Color?b`fragColor = premultiplyAlpha(fragColor);`:""}
      }
    `)}return e.include(hxe,t),e}const FKe=Object.freeze(Object.defineProperty({__proto__:null,build:NKe},Symbol.toStringTag,{value:"Module"}));let kKe=class extends Qwe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=Xo(ik),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=dr.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveFactor=Ce(0,0,0),this.instancedDoublePrecision=!1,this.normalType=Ei.Attribute,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Ce(.2,.2,.2),this.diffuse=Ce(.8,.8,.8),this.externalColor=Mt(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=C(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.transparent=!1,this.writeDepth=!0,this.customDepthTest=Fb.Less,this.textureAlphaMode=Wi.Blend,this.textureAlphaCutoff=XN,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=Pr.Occlude,this.isDecoration=!1}},UKe=class extends exe{constructor(){super(...arguments),this.origin=C(),this.slicePlaneLocalOrigin=this.origin}},AX=class bxe extends Ci{initializeConfiguration(e,i){i.spherical=e.viewingMode===Me.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result,i.textureCoordinateType=i.hasColorTexture||i.hasMetallicRoughnessTexture||i.hasEmissionTexture||i.hasOcclusionTexture||i.hasNormalTexture?In.Default:In.None,i.objectAndLayerIdColorInstanced=i.instanced}initializeProgram(e){return this._initializeProgram(e,bxe.shader)}_initializeProgram(e,i){return new wi(e.rctx,i.get().build(this.configuration),fi)}_convertDepthTestFunction(e){return e===Fb.Lequal?Pi.LEQUAL:Pi.LESS}_makePipeline(e,i){const r=this.configuration,n=e===Qe.NONE,s=e===Qe.FrontFace;return Ot({blending:r.output!==U.Color&&r.output!==U.Alpha||!r.transparent?null:n?su:Wg(e),culling:zKe(r)?CF(r.cullFace):null,depthTest:{func:L_(e,this._convertDepthTestFunction(r.customDepthTest))},depthWrite:(n||s)&&r.writeDepth?_l:null,colorWrite:Ft,stencilWrite:r.hasOccludees?Ff:null,stencilTest:r.hasOccludees?i?y_:D_:null,polygonOffset:n||s?null:KF(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};function zKe(t){return t.cullFace!==dr.None||!t.hasSlicePlane&&!t.transparent&&!t.doubleSidedMode}AX.shader=new bi(FKe,()=>pe(()=>import("./DefaultMaterial.glsl-3a9fc69e.js"),[],import.meta.url));let Dt=class extends Ua{constructor(){super(...arguments),this.output=U.Color,this.alphaDiscardMode=Wi.Opaque,this.doubleSidedMode=Kr.None,this.pbrMode=it.Disabled,this.cullFace=dr.None,this.transparencyPassType=Qe.NONE,this.normalType=Ei.Attribute,this.textureCoordinateType=In.None,this.customDepthTest=Fb.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}};h([V({count:U.COUNT})],Dt.prototype,"output",void 0),h([V({count:Wi.COUNT})],Dt.prototype,"alphaDiscardMode",void 0),h([V({count:Kr.COUNT})],Dt.prototype,"doubleSidedMode",void 0),h([V({count:it.COUNT})],Dt.prototype,"pbrMode",void 0),h([V({count:dr.COUNT})],Dt.prototype,"cullFace",void 0),h([V({count:Qe.COUNT})],Dt.prototype,"transparencyPassType",void 0),h([V({count:Ei.COUNT})],Dt.prototype,"normalType",void 0),h([V({count:In.COUNT})],Dt.prototype,"textureCoordinateType",void 0),h([V({count:Fb.COUNT})],Dt.prototype,"customDepthTest",void 0),h([V()],Dt.prototype,"spherical",void 0),h([V()],Dt.prototype,"hasVertexColors",void 0),h([V()],Dt.prototype,"hasSymbolColors",void 0),h([V()],Dt.prototype,"hasVerticalOffset",void 0),h([V()],Dt.prototype,"hasSlicePlane",void 0),h([V()],Dt.prototype,"hasSliceHighlight",void 0),h([V()],Dt.prototype,"hasColorTexture",void 0),h([V()],Dt.prototype,"hasMetallicRoughnessTexture",void 0),h([V()],Dt.prototype,"hasEmissionTexture",void 0),h([V()],Dt.prototype,"hasOcclusionTexture",void 0),h([V()],Dt.prototype,"hasNormalTexture",void 0),h([V()],Dt.prototype,"hasScreenSizePerspective",void 0),h([V()],Dt.prototype,"hasVertexTangents",void 0),h([V()],Dt.prototype,"hasOccludees",void 0),h([V()],Dt.prototype,"multipassEnabled",void 0),h([V()],Dt.prototype,"hasModelTransformation",void 0),h([V()],Dt.prototype,"offsetBackfaces",void 0),h([V()],Dt.prototype,"vvSize",void 0),h([V()],Dt.prototype,"vvColor",void 0),h([V()],Dt.prototype,"receiveShadows",void 0),h([V()],Dt.prototype,"receiveAmbientOcclusion",void 0),h([V()],Dt.prototype,"textureAlphaPremultiplied",void 0),h([V()],Dt.prototype,"instanced",void 0),h([V()],Dt.prototype,"instancedColor",void 0),h([V()],Dt.prototype,"objectAndLayerIdColorInstanced",void 0),h([V()],Dt.prototype,"instancedDoublePrecision",void 0),h([V()],Dt.prototype,"doublePrecisionRequiresObfuscation",void 0),h([V()],Dt.prototype,"writeDepth",void 0),h([V()],Dt.prototype,"transparent",void 0),h([V()],Dt.prototype,"enableOffset",void 0),h([V()],Dt.prototype,"cullAboveGround",void 0),h([V()],Dt.prototype,"snowCover",void 0),h([V()],Dt.prototype,"hasColorTextureTransform",void 0),h([V()],Dt.prototype,"hasEmissionTextureTransform",void 0),h([V()],Dt.prototype,"hasNormalTextureTransform",void 0),h([V()],Dt.prototype,"hasOcclusionTextureTransform",void 0),h([V()],Dt.prototype,"hasMetallicRoughnessTextureTransform",void 0),h([V({constValue:!1})],Dt.prototype,"occlusionPass",void 0),h([V({constValue:!0})],Dt.prototype,"hasVvInstancing",void 0),h([V({constValue:!1})],Dt.prototype,"useCustomDTRExponentForWater",void 0),h([V({constValue:!1})],Dt.prototype,"supportsTextureAtlas",void 0),h([V({constValue:!0})],Dt.prototype,"useFillLights",void 0);function BKe(t){const e=new mi,{vertex:i,fragment:r,varyings:n}=e;return tc(i,t),e.include(AR),n.add("vpos","vec3"),e.include(hg,t),e.include(s1e,t),e.include(Xbe,t),t.output!==U.Color&&t.output!==U.Alpha||(Xd(e.vertex,t),e.include(UR,t),e.include(ml,t),t.offsetBackfaces&&e.include(sxe),t.instancedColor&&e.attributes.add(O.INSTANCECOLOR,"vec4"),n.add("vNormalWorld","vec3"),n.add("localvpos","vec3"),t.multipassEnabled&&n.add("depth","float"),e.include(xf,t),e.include(qS,t),e.include(lxe,t),e.include(gw,t),i.uniforms.add(new ai("externalColor",s=>s.externalColor)),n.add("vcolorExt","vec4"),i.code.add(b`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${b.float(co)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = getVertexInLocalOriginSpace();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${t.multipassEnabled?b`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),t.output===U.Alpha&&(e.include(vn,t),e.include(ab,t),e.include(uc,t),r.uniforms.add(new Oe("opacity",s=>s.opacity),new Oe("layerOpacity",s=>s.layerOpacity)),t.hasColorTexture&&r.uniforms.add(new Je("tex",s=>s.texture)),r.include(SO),r.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?b`terrainDepthTest(depth);`:""}
        ${t.hasColorTexture?b`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:b`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?b`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:b`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        fragColor = vec4(opacity_);
      }
    `)),t.output===U.Color&&(e.include(vn,t),e.include(Vb,t),e.include(BR,t),e.include(ab,t),e.include(t.instancedDoublePrecision?nk:Gb,t),e.include(uc,t),Xd(e.fragment,t),Bg(r),VR(r),JS(r),r.uniforms.add(i.uniforms.get("localOrigin"),i.uniforms.get("view"),new $t("ambient",s=>s.ambient),new $t("diffuse",s=>s.diffuse),new Oe("opacity",s=>s.opacity),new Oe("layerOpacity",s=>s.layerOpacity)),t.hasColorTexture&&r.uniforms.add(new Je("tex",s=>s.texture)),e.include(vY,t),e.include(EX,t),r.include(SO),Wf(r),r.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?b`terrainDepthTest(depth);`:""}
        ${t.hasColorTexture?b`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:b`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${t.pbrMode===it.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?b`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:b`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.snowCover?b`albedo = mix(albedo, vec3(1), 0.9);`:b``}
        ${b`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${t.pbrMode===it.Normal||t.pbrMode===it.Schematic?t.spherical?b`vec3 normalGround = normalize(vpos + localOrigin);`:b`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:b``}
        ${t.pbrMode===it.Normal||t.pbrMode===it.Schematic?b`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?b`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:b`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===Qe.Color?b`fragColor = premultiplyAlpha(fragColor);`:b``}
      }
    `)),e.include(hxe,t),e}const VKe=Object.freeze(Object.defineProperty({__proto__:null,build:BKe},Symbol.toStringTag,{value:"Module"}));let wxe=class xxe extends AX{initializeConfiguration(e,i){super.initializeConfiguration(e,i),i.hasMetallicRoughnessTexture=!1,i.hasEmissionTexture=!1,i.hasOcclusionTexture=!1,i.hasNormalTexture=!1,i.hasModelTransformation=!1,i.normalType=Ei.Attribute,i.doubleSidedMode=Kr.WindingOrder,i.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,xxe.shader)}};wxe.shader=new bi(VKe,()=>pe(()=>import("./RealisticTree.glsl-4a5208ff.js"),[],import.meta.url));let Jd=class extends $_{constructor(e){super(e,HKe),this.supportsEdges=!0,this._configuration=new Dt,this._vertexBufferLayout=qKe(this.parameters)}isVisibleForOutput(e){return e!==U.Shadow&&e!==U.ShadowExcludeHighlight&&e!==U.ShadowHighlight||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||e.layerOpacity===0)return!1;const{hasInstancedColor:i,hasVertexColors:r,hasSymbolColors:n,vvColor:s}=e,o=e.colorMixMode==="replace",a=e.opacity>0,l=e.externalColor&&e.externalColor[3]>0,c=i||s||n;return r&&c?o||a:r?o?l:a:c?o||a:o?l:a}getConfiguration(e,i){return this._configuration.output=e,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=this.parameters.isInstanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this.parameters.customDepthTest!=null&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?dr.None:this.parameters.cullFace,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=this.parameters.modelTransformation!=null,e!==U.Color&&e!==U.Alpha||(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=Kr.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Kr.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Kr.WindingOrder:Kr.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=i.ssao!=null,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?it.Schematic:it.Normal:it.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<ZF,this._configuration.snowCover=this.hasSnowCover(i),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}intersect(e,i,r,n,s,o){if(this.parameters.verticalOffset!=null){const a=r.camera;oe(HU,i[12],i[13],i[14]);let l=null;switch(r.viewingMode){case Me.Global:l=ge(Ere,HU);break;case Me.Local:l=se(Ere,XKe)}let c=0;const u=he(ZKe,HU,a.eye),d=we(u),p=te(u,u,1/d);let m=null;this.parameters.screenSizePerspective&&(m=me(l,p)),c+=rwe(a,d,this.parameters.verticalOffset,m??0,this.parameters.screenSizePerspective),te(l,l,c),Zl(jU,l,r.transform.inverseRotation),n=he(WKe,n,jU),s=he(YKe,s,jU)}Qbe(e,r,n,s,c7(r.verticalOffset),o)}produces(e,i){return i===U.Color||i===U.Alpha||i===U.Depth||i===U.Normal||i===U.Shadow||i===U.ShadowHighlight||i===U.ShadowExcludeHighlight||i===U.Highlight||i===U.ObjectAndLayerIdColor?e===(this.parameters.transparent?this.parameters.writeDepth?ae.TRANSPARENT_MATERIAL:ae.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:ae.OPAQUE_MATERIAL)||e===ae.DRAPED_MATERIAL:!1}createGLMaterial(e){return new GKe(e)}createBufferWriter(){return new ZS(this._vertexBufferLayout)}},GKe=class extends _Y{constructor(e){super({...e,...e.material.parameters})}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==U.Color&&this._output!==U.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e));const i=this._material.parameters;this.updateTexture(i.textureId);const r=e.camera.viewInverseTransposeMatrix;return oe(i.origin,r[3],r[7],r[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(i.treeRendering?wxe:AX,e)}},jKe=class extends kKe{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}};const HKe=new jKe;function qKe(t){const e=Ir().vec3f(O.POSITION);return t.normalType===Ei.Compressed?e.vec2i16(O.NORMALCOMPRESSED,{glNormalized:!0}):e.vec3f(O.NORMAL),t.hasVertexTangents&&e.vec4f(O.TANGENT),(t.textureId||t.normalTextureId||t.metallicRoughnessTextureId||t.emissiveTextureId||t.occlusionTextureId)&&e.vec2f(O.UV0),t.hasVertexColors&&e.vec4u8(O.COLOR),t.hasSymbolColors&&e.vec4u8(O.SYMBOLCOLOR),ie("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(O.OBJECTANDLAYERIDCOLOR),e}const WKe=C(),YKe=C(),XKe=Ce(0,0,1),Ere=C(),jU=C(),HU=C(),ZKe=C(),Txe=new wX({});function ZIt(t){return t.type==="web-style"?Txe:OX(t.symbolLayers.toArray().map(e=>Sxe(t,e)))}function OX(t){let e=0,i=0,r=0,n=!1,s=0;const o=new Zwe;for(const a of t)a!=null&&(e+=a.verticesPerFeature,i+=a.verticesPerCoordinate,r+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,n=n||a.estimated,++s);return n?new WJe(s,{verticesPerFeature:e,verticesPerCoordinate:i,drawCallsPerFeature:r,memory:o}):new qJe(s,{verticesPerFeature:e,verticesPerCoordinate:i,drawCallsPerFeature:r,memory:o})}function JIt(t){const e=OX(t);return e.numComplexities>0&&(e.verticesPerFeature/=e.numComplexities,e.verticesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities),e}const qU={};function Sxe(t,e){const i=Exe(t,e),r=ZJe(e)?2:0;switch(e.type){case"extrude":return new Yu({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:r,memory:i});case"fill":if(t.type==="mesh-3d")return new Yu({drawCallsPerFeature:r,memory:i});if(e.outline!=null&&e.outline.size>0)return new Yu({verticesPerFeature:-12,verticesPerCoordinate:9,memory:i});case"water":return new Yu({verticesPerFeature:-6,verticesPerCoordinate:3,memory:i});case"line":return new Yu({verticesPerFeature:-6,verticesPerCoordinate:6,memory:i});case"object":return e.resource?.href?new wX({verticesPerFeature:100,memory:i}):{...JKe(e.resource?.primitive??Vge),memory:i};case"path":{let n=0,s=0;switch(e.profile){case"circle":n=Hwe;break;case"quad":n=4;break;default:return void(e.profile,void 0)}switch(e.join??"simple"){case"round":s=jwe;break;case"miter":case"bevel":s=1;break;default:return}const o=2*n,a=n*s*2,l=a+o;let c=-2*a-o;switch(e.cap){case"none":break;case"butt":case"square":c+=2*(n-1);break;case"round":c+=2*(n*(XG-1)*2+n);break;default:return}return new Yu({verticesPerFeature:c,verticesPerCoordinate:l,memory:i})}case"text":case"icon":return new Yu({verticesPerFeature:6,memory:i});default:return}}function Exe(t,e){const i=t.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?Ha.EXTRUDE_EDGES:Ha.EXTRUDE;case"fill":return e.outline!=null&&e.outline.size>0?Ha.FILL_OUTLINE:Ha.FILL;case"water":return Ha.FILL;case"line":return e.join==="round"?Ha.LINE_ROUND:Ha.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return Ha.PATH_ROUND_CIRCLE;case"quad":return Ha.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return Ha.PATH_MITER_CIRCLE;case"quad":return Ha.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return i?Ha.OBJECT_POINT:Ha.OBJECT_POLYGON;case"icon":case"text":return i?Ha.ICON_POINT:Ha.ICON_POLYGON;default:return}}function JKe(t){const e=qU[t];if(e)return e;const i=Cxe(Xwe(t,new Jd({})).levels);return qU[t]=new Yu({verticesPerFeature:i}),qU[t]}function Cxe(t){return t.reduce((e,i,r)=>e+i.numVertices*(1/10**r),0)/t.reduce((e,i,r)=>e+1/10**r,0)}const Ha={ICON_POINT:{bytesPerFeature:2111.586639736967,bytesPerFeatureLabel:870.520855,resourceBytes:0,draped:{bytesPerFeature:1799.2619971817762,bytesPerFeatureLabel:857.4890149999999}},ICON_POLYGON:{bytesPerFeature:2829.8183316810564,bytesPerFeatureLabel:858.0951816666667,resourceBytes:0,draped:{bytesPerFeature:2521.242008227286,bytesPerFeatureLabel:869.6919750000001}},OBJECT_POINT:{bytesPerFeature:607.8007336777831,bytesPerFeatureLabel:715.7017950000001,resourceBytes:0,draped:{bytesPerFeature:607.8007336777831,bytesPerFeatureLabel:715.7017950000001}},OBJECT_POLYGON:{bytesPerFeature:1111.4123028075749,bytesPerFeatureLabel:684.5498416666667,resourceBytes:0,draped:{bytesPerFeature:1111.4123028075749,bytesPerFeatureLabel:684.5498416666667}},LINE_MITER:{bytesPerFeature:3053.034748007272,bytesPerFeatureLabel:804.5473016666666,resourceBytes:0,draped:{bytesPerFeature:2649.5661560225844,bytesPerFeatureLabel:843.3404083333334}},LINE_ROUND:{bytesPerFeature:3225.35183564197,bytesPerFeatureLabel:807.296835,resourceBytes:0,draped:{bytesPerFeature:2650.9229994933276,bytesPerFeatureLabel:861.108335}},PATH_MITER_CIRCLE:{bytesPerFeature:38664.832646351235,bytesPerFeatureLabel:862.95665,resourceBytes:0,draped:{bytesPerFeature:38664.832646351235,bytesPerFeatureLabel:862.95665}},PATH_ROUND_CIRCLE:{bytesPerFeature:42462.97022293504,bytesPerFeatureLabel:851.35885,resourceBytes:0,draped:{bytesPerFeature:42462.97022293504,bytesPerFeatureLabel:851.35885}},PATH_MITER_QUAD:{bytesPerFeature:25558.22153327986,bytesPerFeatureLabel:838.56885,resourceBytes:0,draped:{bytesPerFeature:25558.22153327986,bytesPerFeatureLabel:838.56885}},PATH_ROUND_QUAD:{bytesPerFeature:42274.86801764233,bytesPerFeatureLabel:867.5658500000001,resourceBytes:0,draped:{bytesPerFeature:42274.86801764233,bytesPerFeatureLabel:867.5658500000001}},FILL:{bytesPerFeature:3124.272297197038,bytesPerFeatureLabel:850.6966816666666,resourceBytes:0,draped:{bytesPerFeature:2630.99580851019,bytesPerFeatureLabel:845.464495}},FILL_OUTLINE:{bytesPerFeature:4501.643043274039,bytesPerFeatureLabel:866.3982816666668,resourceBytes:0,draped:{bytesPerFeature:3841.8870233416183,bytesPerFeatureLabel:854.9969683333334}},EXTRUDE:{bytesPerFeature:7545.975968446941,bytesPerFeatureLabel:859.7106016666668,resourceBytes:0,draped:{bytesPerFeature:7545.975968446941,bytesPerFeatureLabel:859.7106016666668}},EXTRUDE_EDGES:{bytesPerFeature:2872.306473115409,bytesPerFeatureLabel:604.556581666667,resourceBytes:0,draped:{bytesPerFeature:2872.306473115409,bytesPerFeatureLabel:604.556581666667}}};var Dn;(function(t){t[t.RecreateSymbol=0]="RecreateSymbol",t[t.RecreateGraphics=1]="RecreateGraphics",t[t.FastUpdate=2]="FastUpdate"})(Dn||(Dn={}));let RX=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=Vc.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,i){return this._loadStatus===Vc.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===Vc.FAILED?(i&&i(this._loadError),this._loader??Promise.resolve()):(this._loader==null&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=Vc.LOADED},r=>{throw this._loadError=r,this._abortController=null,this._loadStatus=Vc.FAILED,!Fn(r)&&this.logger&&r.message&&this.logger.warn(r.message),r})),this._loader.then(e,i).catch(()=>{}),this._loader)}abortLoad(){this._abortController!=null?this._abortController=nc(this._abortController):this._loadStatus===Vc.LOADING&&(this._loadStatus=Vc.FAILED),this._loader=null}};var Vc;(function(t){t[t.LOADING=0]="LOADING",t[t.LOADED=1]="LOADED",t[t.FAILED=2]="FAILED"})(Vc||(Vc={}));const ix=ne.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let Qf=class extends RX{constructor(e,i,r,n){super(r.schedule),this.symbol=e,this.symbolLayer=i,this._context=r,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this._materials=[],this.usedMemory=0,this.logger=ix,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=n.renderPriority,this._renderPriorityStep=n.renderPriorityStep,this._elevationContext=new KN,this.complexity=this.computeComplexity(),this.ignoreDrivers=n.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=Cre(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const i=this._drivenProperties,r=Cre(e);return r.color!==i.color||r.opacity!==i.opacity||r.opacityAlwaysOpaque!==i.opacityAlwaysOpaque||r.size!==i.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,i,r,n){const s=e.projectionSuccess,o="polygons"in e?e.polygons:null,a=`${n} geometry failed to be created`;let l=null;s?!this._logGeometryValidationWarnings(i,r,n)&&o&&o.length===0&&r==="rings"&&i.length>0&&i[0].length>2&&(l=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${a} (failed to project geometry to view spatial reference)`,l&&ix.warnOncePerTick(l)}_logGeometryValidationWarnings(e,i,r){const n=`${r} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(ix.warnOncePerTick(`${n} (no ${i} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(ix.warnOncePerTick(`${n} (${i} should be defined as a 2D array)`),!0)}_validateGeometry(e,i=null,r=null){if(i!=null&&!i.includes(e.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${e.type}`),!1;if(e.type==="point"){const n=e;if(!isFinite(n.x)||!isFinite(n.y))return ix.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return KKe}_defaultElevationInfoZ(){return QKe}_updateElevationContext(){this._elevationInfoOverride!=null?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,i=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||i.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,i=new KN){const r=e.geometry,n=this.getDefaultElevationInfo(r);i.unit=this._elevationContext.unit!=null?this._elevationContext.unit:n.unit,i.mode=this.getGeometryElevationMode(r,n),i.offsetMeters=this._elevationContext.meterUnitOffset??n.offset??0;const s=!this._elevationOptions.supportsOnTheGround&&i.mode==="on-the-ground";s&&(i.mode="relative-to-ground",i.offsetMeters=0);const o=s?BJe:this._elevationContext.featureExpressionInfoContext;return i.updateFeatureExpressionInfoContext(o,e,this._context.layer),i}prepareSymbolLayerPatch(e){}updateGeometry(e,i){return!1}updateTransform(e,i,r,n){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,i=Are){let r=1;return this.draped||(r*=this._getLayerOpacity()),this._drivenProperties.opacity||(e!=null?r*=e.a:i.hasIntrinsicColor||(r=0)),r}_getCombinedOpacityAndColor(e,i=Are){const r=this._getCombinedOpacity(e,i);if(this._drivenProperties.color)return f3(null,r);const n=e!=null?Ye.toUnitRGB(e):eg;return f3(n,r)}_getVertexOpacityAndColor(e,i=null){const r=this._drivenProperties.color?e.color:null,n=this._drivenProperties.opacity?e.opacity:null,s=f3(r,n);return i&&(s[0]*=i,s[1]*=i,s[2]*=i,s[3]*=i),s}isFastUpdatesEnabled(){return this._fastUpdates!=null}computeComplexity(){return Sxe(this.symbol,this.symbolLayer)}globalPropertyChanged(e,i,r){switch(e){case"opacity":return this.layerOpacityChanged(i,r),!0;case"elevationInfo":{const n=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(i,r,n)!==an.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(i,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,i,r){let n=an.UPDATE;return e.forEach(s=>{const o=i(s);if(o!=null){const a=s.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=r(o.elevationContext.mode)}else n=an.RECREATE}),n}applyRendererDiff(e,i){return Dn.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const i=this._fastUpdates.visualVariables,r=i.size?zd(i.size.field,e):0,n=i.color?zd(i.color.field,e):0,s=i.opacity?zd(i.opacity.field,e):0;return Mt(r,n,s,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&ix.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>({size:this._fastUpdates?.visualVariables.size?.field??null,color:this._fastUpdates?.visualVariables.color?.field??null,opacity:this._fastUpdates?.visualVariables.opacity?.field??null,rotation:this._fastUpdates?.visualVariables.rotation?.field??null});return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function Cre(t){const e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return t&&"visualVariables"in t&&t.visualVariables&&t.visualVariables.forEach(i=>{switch(i.type){case"color":if(e.color=!0,i.stops)for(let r=0;r<i.stops.length;r++){const n=i.stops[r].color;n&&(e.opacity=!0,n.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0}}),e}const KKe={mode:"on-the-ground",offset:0,unit:"meters"},QKe={mode:"absolute-height",offset:0,unit:"meters"},Are={hasIntrinsicColor:!1};let Yg=class extends PR{get geometries(){return this._geometries}get transformation(){return this._transformation??zr}set transformation(e){this._transformation=Nn(this._transformation??be(),e),this._invalidateBoundingVolume(),this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(e){this._shaderTransformation=e?Nn(this._shaderTransformation??be(),e):null,this._invalidateBoundingVolume(),this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){return this.shaderTransformation??this.transformation}constructor(e={}){super(),this.type=on.Object,this._shaderTransformation=null,this._parentLayer=null,this._visible=!0,this.castShadow=e.castShadow??!0,this.usesVerticalDistanceToGround=e.usesVerticalDistanceToGround??!1,this.graphicUid=e.graphicUid,this.layerUid=e.layerUid,e.isElevationSource&&(this.lastValidElevationBB=new Axe),this._geometries=e.geometries?Array.from(e.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){Ke(this._parentLayer==null||e==null,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._emit("geometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const i=this._geometries.splice(e,1)[0];i&&(this._emit("geometryRemoved",{object:this,geometry:i}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttributeUpdated(e,i,r=!1){this._emit("attributesChanged",{object:this,geometry:e,attribute:i,sync:r}),C7e(i)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const i of this._geometries)i.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new LN(Rg.MaskOccludee);for(const i of this._geometries)i.occludees=bG(i.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const i of this._geometries)i.occludees=wG(i.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new LN(Rg.Highlight);for(const i of this._geometries)i.highlights=bG(i.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const i of this._geometries)i.highlights=wG(i.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,i){return Di(i,this.transformation,e.transformation)}getCombinedShaderTransformation(e,i=be()){return Di(i,this.effectiveTransformation,e.transformation)}get boundingVolumeWorldSpace(){return this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new Ore,this._validateBoundingVolume(this._bvWorldSpace,m3.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace||(this._bvObjectSpace=this._bvObjectSpace||new Ore,this._validateBoundingVolume(this._bvObjectSpace,m3.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,i){const r=i===m3.ObjectSpace;for(const n of this._geometries){const s=n.boundingInfo;s&&eQe(s,e,r?n.transformation:this.getCombinedShaderTransformation(n))}Ui(e.bounds,e.min,e.max,.5);for(const n of this._geometries){const s=n.boundingInfo;if(s==null)continue;const o=r?n.transformation:this.getCombinedShaderTransformation(n),a=QT(o);Fe(Rre,s.center,o);const l=br(Rre,e.bounds),c=s.radius*a;e.bounds[3]=Math.max(e.bounds[3],l+c)}}_invalidateBoundingVolume(){const e=this._bvWorldSpace?.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&e&&this._parentLayer.notifyObjectBBChanged(this,e)}_emit(e,i){this._parentLayer&&this._parentLayer.events.emit(e,i)}get test(){const e=this;return{hasGeometry:i=>e._geometries.includes(i),getGeometryIndex:i=>e._geometries.indexOf(i)}}},Axe=class{constructor(){this.min=Ce(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Ce(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},Ore=class extends Axe{constructor(){super(...arguments),this.bounds=xn()}};function eQe(t,e,i){const r=t.bbMin,n=t.bbMax;if(L4(i)){const s=oe(tQe,i[12],i[13],i[14]);ce(_c,r,s),ce(Uh,n,s);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],_c[o]),e.max[o]=Math.max(e.max[o],Uh[o])}else if(Fe(_c,r,i),Po(r,n))for(let s=0;s<3;++s)e.min[s]=Math.min(e.min[s],_c[s]),e.max[s]=Math.max(e.max[s],_c[s]);else{Fe(Uh,n,i);for(let s=0;s<3;++s)e.min[s]=Math.min(e.min[s],_c[s],Uh[s]),e.max[s]=Math.max(e.max[s],_c[s],Uh[s]);for(let s=0;s<3;++s){se(_c,r),se(Uh,n),_c[s]=n[s],Uh[s]=r[s],Fe(_c,_c,i),Fe(Uh,Uh,i);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],_c[o],Uh[o]),e.max[o]=Math.max(e.max[o],_c[o],Uh[o])}}}const tQe=C(),_c=C(),Uh=C(),Rre=C();var m3;(function(t){t[t.WorldSpace=0]="WorldSpace",t[t.ObjectSpace=1]="ObjectSpace"})(m3||(m3={}));function PX(t,e,i,r,n){const s=t.clippingExtent;if(lc(e,zy,t.elevationProvider.spatialReference),s!=null&&!uW(s,zy))return null;lc(e,zy,t.renderCoordsHelper.spatialReference),i.localOrigin=t.localOriginFactory.getOrigin(zy);const o=new Yg({geometries:[i],castShadow:!1,layerUid:t.layer.uid,graphicUid:n,usesVerticalDistanceToGround:!0});return{object:o,sampledElevation:TJe(o,e,t.elevationProvider,t.renderCoordsHelper,r)}}function EO(t,e,i){const r=t.elevationContext,n=i.spatialReference;lc(e,zy,n),r.centerPointInElevationSR=R_(zy[0],zy[1],e.hasZ?zy[2]:0,n??null)}function CO(t){switch(t.type){case"point":return t;case"polygon":case"extent":return yX(t);case"polyline":{const e=t.paths[0];if(!e||e.length===0)return null;const i=Mpe(e,Ppe(e)/2);return R_(i[0],i[1],i[2],t.spatialReference)}case"mesh":return t.origin}return null}const zy=C();function Oxe(){return new Float32Array(2)}function iQe(t){const e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}function Qu(t,e){const i=new Float32Array(2);return i[0]=t,i[1]=e,i}function rQe(t,e){return new Float32Array(t,e,2)}function Rxe(){return Oxe()}function Pxe(){return Qu(1,1)}function Mxe(){return Qu(1,0)}function $xe(){return Qu(0,1)}const Ixe=Rxe(),Lxe=Pxe(),nQe=Mxe(),sQe=$xe();Object.freeze(Object.defineProperty({__proto__:null,ONES:Lxe,UNIT_X:nQe,UNIT_Y:sQe,ZEROS:Ixe,clone:iQe,create:Oxe,createView:rQe,fromValues:Qu,ones:Pxe,unitX:Mxe,unitY:$xe,zeros:Rxe},Symbol.toStringTag,{value:"Module"}));function oQe(t){const e=new mi,{vertex:i,fragment:r}=e;return i.include(YF),e.include(Kbe,t),e.include(vn,t),e.attributes.add(O.UV0,"vec2"),i.uniforms.add(new ai("viewport",(n,s)=>s.camera.fullViewport),new Oe("lineSize",(n,s)=>n.size>0?Math.max(1,n.size)*s.camera.pixelRatio:0),new zi("pixelToNDC",(n,s)=>si(Mre,2/s.camera.fullViewport[2],2/s.camera.fullViewport[3])),new Oe("borderSize",(n,s)=>n.borderColor!=null?s.camera.pixelRatio:0),new zi("screenOffset",(n,s)=>si(Mre,n.horizontalScreenOffset*s.camera.pixelRatio,0))),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),t.multipassEnabled&&e.varyings.add("depth","float"),t.occlusionTestEnabled&&e.include(ywe),t.hasScreenSizePerspective&&WF(i),i.code.add(b`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${t.occlusionTestEnabled?b`
      if (!testHUDVisibility(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${t.hasScreenSizePerspective?b`
      vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:b`vec2 screenOffsetScaled = screenOffset;`}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
      // correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${t.multipassEnabled?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${t.depthHudEnabled?t.depthHudAlignStartEnabled?b`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:b`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${t.hasScreenSizePerspective?b`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:b`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),r.uniforms.add(new ai("uColor",n=>Pre(n.color)),new ai("borderColor",n=>Pre(n.borderColor))),t.multipassEnabled&&(r.include(Bve,t),r.uniforms.add(new zi("inverseViewport",(n,s)=>s.inverseViewport))),r.code.add(b`
    void main() {
      ${t.multipassEnabled?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line blends on top of the
      // border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${t.depthHudEnabled?b`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:b`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      fragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),e}function Pre(t){return t??ru}const Mre=Ue(),aQe=Object.freeze(Object.defineProperty({__proto__:null,build:oQe},Symbol.toStringTag,{value:"Module"}));let Dxe=class Nxe extends Ci{initializeConfiguration(e,i){i.spherical=e.viewingMode===Me.Global}initializeProgram(e){return new wi(e.rctx,Nxe.shader.get().build(this.configuration),fi)}setPipelineState(e){const i=e?Pi.ALWAYS:Pi.LESS;return this.configuration.depthHudEnabled?Ot({depthTest:{func:i},depthWrite:_l}):Ot({blending:fo(Te.ONE,Te.SRC_ALPHA,Te.ONE_MINUS_SRC_ALPHA,Te.ONE_MINUS_SRC_ALPHA),depthTest:{func:i},colorWrite:Ft})}initializePipeline(){return this.setPipelineState(this.configuration.multipassEnabled)}};Dxe.shader=new bi(aQe,()=>pe(()=>import("./LineCallout.glsl-51764ecb.js"),[],import.meta.url));let ku=class extends Ua{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.multipassEnabled=!1}};h([V()],ku.prototype,"screenCenterOffsetUnitsEnabled",void 0),h([V()],ku.prototype,"spherical",void 0),h([V()],ku.prototype,"occlusionTestEnabled",void 0),h([V()],ku.prototype,"hasVerticalOffset",void 0),h([V()],ku.prototype,"hasScreenSizePerspective",void 0),h([V()],ku.prototype,"depthHudEnabled",void 0),h([V()],ku.prototype,"depthHudAlignStartEnabled",void 0),h([V()],ku.prototype,"hasSlicePlane",void 0),h([V()],ku.prototype,"multipassEnabled",void 0),h([V({constValue:!0})],ku.prototype,"hasSliceInVertexProgram",void 0),h([V({constValue:!1})],ku.prototype,"draped",void 0);let qM=class ZG extends $_{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(e){super(e,new Fxe),this._configuration=new ku,this._uniqueMaterialIdentifier=ZG.uniqueMaterialIdentifier(this.parameters)}getPassParameters(){return this.parameters}getConfiguration(e,i){const r=i?.slot!==ae.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.depthHudEnabled=r,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration}intersect(){}produces(e,i){if(i===U.Color)switch(e){case ae.LINE_CALLOUTS:case ae.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(e){return new lQe(e)}createBufferWriter(){return new uQe}validateParameters(e){const i=ZG.uniqueMaterialIdentifier(e);i!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=i)}static uniqueMaterialIdentifier(e){return JSON.stringify({horizontalScreenOffset:e.horizontalScreenOffset??0,centerOffsetUnits:e.centerOffsetUnits||"world"})}},lQe=class extends P_{beginSlot(e){return this.ensureTechnique(Dxe,e)}},Fxe=class extends uX{constructor(){super(...arguments),this.horizontalScreenOffset=0,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const cQe=Ir().vec3f(O.POSITION).vec3f(O.NORMAL).vec2f(O.UV0).vec4f(O.AUXPOS1),$re=[Qu(0,0),Qu(1,0),Qu(0,1),Qu(1,0),Qu(1,1),Qu(0,1)];let uQe=class{constructor(){this.vertexBufferLayout=cQe}elementCount(e){return 6*e.attributes.get(O.POSITION).indices.length}write(e,i,r,n,s){hX(r.attributes.get(O.POSITION),e,n.position,s,6),dX(r.attributes.get(O.NORMAL),i,n.normal,s,6),pS(r.attributes.get(O.AUXPOS1),n.auxpos1,s,6);for(let o=0;o<$re.length;++o)n.uv0.setVec(s+o,$re[o])}},kxe=class Uxe extends Qf{constructor(e,i){super(e,null,i,dQe),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new qM(this._materialParameters),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}_perInstanceMaterialParameters(e){const i=this._materialParameters;return i.horizontalScreenOffset=e.horizontalScreenOffset??0,i.centerOffsetUnits=e.centerOffsetUnits||"world",i}get _materialParameters(){const e=new Fxe,i=this.symbol,r=i.callout;if(e.color=r.color!=null?Ye.toUnitRGBA(r.color):[0,0,0,0],e.color[3]*=this._getLayerOpacity(),e.size=ra(r.size||0),i.verticalOffset){const{screenLength:o,minWorldLength:a,maxWorldLength:l}=i.verticalOffset;e.verticalOffset={screenLength:ra(o),minWorldLength:a||0,maxWorldLength:l??1/0}}e.borderColor=r.border?.color!=null?Ye.toUnitRGBA(r.border.color):null;const n=i.symbolLayers.at(0).type==="object",s=i.type==="label-3d";return e.occlusionTest=!n,e.shaderPolygonOffset=n?0:void 0,e.depthHUDAlignStart=s,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return hQe}createGraphics3DGraphic(e){const i=e.renderingInfo,r=e.graphic,n=this.setGraphicElevationContext(r,new KN,i.elevationOffset||0),s=i.symbol,o=this._elevationContext.mode==="on-the-ground"&&(s.type==="cim"||!s.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(s.type!=="label-3d"&&o||s.type==="point-3d"&&s.symbolLayers.every(l=>l.type==="text"&&!Yge(l)))return null;const a=yX(r.geometry);return a==null?null:this._createAs3DShape(a,n,i,r.uid)}layerOpacityChanged(){this._materials[0]?.setParameters(this._materialParameters)}layerElevationInfoChanged(e,i,r){const n=this._elevationContext.mode,s=FR(Uxe.elevationModeChangeTypes,r,n);return s!==an.UPDATE||e.forEach(o=>{const a=i(o);a!=null&&this.updateGraphicElevationContext(o.graphic,a)}),s}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,i,r=0){return super.setGraphicElevationContext(e,i),i.addOffsetRenderUnits(r),i}updateGraphicElevationContext(e,i){this.setGraphicElevationContext(e,i.elevationContext,i.metadata!=null?i.metadata.elevationOffset:0),i.needsElevationUpdates=xh(i.elevationContext.mode)}computeComplexity(){return new Yu({verticesPerFeature:6})}_createVertexData(e){const{translation:i,centerOffset:r}=e,n=new ke(i?[i[0],i[1],i[2]]:[0,0,0],WU,3,!0),s=new ke(r?[r[0],r[1],r[2],r[3]]:[0,0,0,1],WU,4,!0);return[[O.POSITION,n],[O.NORMAL,new ke([0,0,1],WU,3,!0)],[O.AUXPOS1,s]]}_getOrCreateMaterial(e){const i=this._perInstanceMaterialParameters(e),r=qM.uniqueMaterialIdentifier(i);if(r===this._materials[0]?.uniqueMaterialIdentifier)return{material:this._materials[0],isUnique:!1};if(e.materialCollection!=null){let n=e.materialCollection.get(r);return n==null&&(n=new qM(i),e.materialCollection.add(r,n)),{material:n,isUnique:!1}}return{material:new qM(i),isUnique:!0}}_createAs3DShape(e,i,r,n){const s=this._context.layer.uid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:s}),a=this._getOrCreateMaterial(r),l=new Wn(a.material,this._createVertexData(r),null,on.Point,o),c=PX(this._context,e,l,i,n);if(c==null)return null;const u=new Kf(this,c.object,[l],a.isUnique?[a.material]:null,null,sb,i);return u.metadata=new Gwe(r.elevationOffset),u.alignedSampledElevation=c.sampledElevation,u.needsElevationUpdates=xh(i.mode),EO(u,e,this._context.elevationProvider),u}};kxe.elevationModeChangeTypes={definedChanged:an.UPDATE,staysOnTheGround:an.UPDATE,onTheGroundChanged:an.RECREATE};const WU=[0],hQe={mode:"relative-to-ground",offset:0},dQe={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let pQe=class{constructor(e,i,r=C(),n=Kt(),s=0,o="world",a=0,l=null){this.renderer=e,this.symbol=i,this.translation=r,this.centerOffset=n,this.horizontalScreenOffset=s,this.centerOffsetUnits=o,this.elevationOffset=a,this.materialCollection=l}},fQe=class extends VJe{};const Ire=ne.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function mQe(t,e){if(!yW(t))return Ire.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${t.type}' does not support callouts`),null;if(!t.callout)return null;const i=gQe[t.callout.type];return i?new i(t,e):(Ire.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${t.callout.type}`),null)}const gQe={line:kxe},MX=(t,e,i)=>[e,i],mS=(t,e,i)=>[e,i,t[2]],$X=(t,e,i)=>[e,i,t[2],t[3]];function cLt(t){return t?{originPosition:t.originPosition==="upper-left"?"upperLeft":t.originPosition==="lower-left"?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance]:[1,1],translate:t.extent!=null?[t.extent.xmin,t.extent.ymax]:[0,0]}:null}function yQe({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function _Qe({scale:t,translate:e},i){return Math.round((e[1]-i)/t[1])}function zxe({scale:t,translate:e},i){return i*t[0]+e[0]}function Bxe({scale:t,translate:e},i){return e[1]-i*t[1]}function Vxe(t,e,i){const r=new Array(i.length);if(!i.length)return r;const[n,s]=t.scale;let o=zxe(t,i[0][0]),a=Bxe(t,i[0][1]);r[0]=e(i[0],o,a);for(let l=1;l<i.length;l++){const c=i[l];o+=c[0]*n,a-=c[1]*s,r[l]=e(c,o,a)}return r}function Gxe(t,e,i){const r=new Array(i.length);for(let n=0;n<i.length;n++)r[n]=Vxe(t,e,i[n]);return r}function vQe(t,e,i,r){return Vxe(t,i?r?$X:mS:r?mS:MX,e)}function bQe(t,e,i,r){return Gxe(t,i?r?$X:mS:r?mS:MX,e)}function wQe(t,e,i,r){return Gxe(t,i?r?$X:mS:r?mS:MX,e)}function uLt(t,e,i,r,n){return e.x=yQe(t,i.x),e.y=_Qe(t,i.y),e!==i&&(r&&(e.z=i.z),n&&(e.m=i.m)),e}function jxe(t,e,i,r,n){return i!=null&&(e.points=vQe(t,i.points,r,n)),e}function Hxe(t,e,i,r,n){return i==null||(e.x=zxe(t,i.x),e.y=Bxe(t,i.y),e!==i&&(r&&(e.z=i.z),n&&(e.m=i.m))),e}function qxe(t,e,i,r,n){return i!=null&&(e.rings=wQe(t,i.rings,r,n)),e}function Wxe(t,e,i,r,n){return i!=null&&(e.paths=bQe(t,i.paths,r,n)),e}var JG;let mA=JG=class extends $e{constructor(t){super(t),this.name=null,this.code=null}clone(){return new JG({name:this.name,code:this.code})}};h([f({type:String,json:{write:!0}})],mA.prototype,"name",void 0),h([f({type:[String,Number],json:{write:!0}})],mA.prototype,"code",void 0),mA=JG=h([z("esri.layers.support.CodedValue")],mA);const xQe=new uu({inherited:"inherited",codedValue:"coded-value",range:"range"});let gA=class extends $e{constructor(e){super(e),this.name=null,this.type=null}};h([f({type:String,json:{write:!0}})],gA.prototype,"name",void 0),h([Ut(xQe)],gA.prototype,"type",void 0),gA=h([z("esri.layers.support.Domain")],gA);const sk=gA;var KG;let yA=KG=class extends sk{constructor(t){super(t),this.codedValues=null,this.type="coded-value"}getName(t){let e=null;if(this.codedValues){const i=String(t);this.codedValues.some(r=>(String(r.code)===i&&(e=r.name),!!e))}return e}clone(){return new KG({codedValues:ye(this.codedValues),name:this.name})}};h([f({type:[mA],json:{write:!0}})],yA.prototype,"codedValues",void 0),h([Ut({codedValue:"coded-value"})],yA.prototype,"type",void 0),yA=KG=h([z("esri.layers.support.CodedValueDomain")],yA);const Yxe=yA;var QG;let FL=QG=class extends sk{constructor(t){super(t),this.type="inherited"}clone(){return new QG}};h([Ut({inherited:"inherited"})],FL.prototype,"type",void 0),FL=QG=h([z("esri.layers.support.InheritedDomain")],FL);const Xxe=FL;var ej;let d2=ej=class extends sk{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new ej({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};h([f({json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range?.[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(t,e,i){e[i]=[this.minValue||0,t]}}}})],d2.prototype,"maxValue",void 0),h([f({json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range?.[0]},write:{target:"range",writer(t,e,i){e[i]=[t,this.maxValue||0]}}}})],d2.prototype,"minValue",void 0),h([Ut({range:"range"})],d2.prototype,"type",void 0),d2=ej=h([z("esri.layers.support.RangeDomain")],d2);const Zxe=d2,TQe={key:"type",base:sk,typeMap:{range:Zxe,"coded-value":Yxe,inherited:Xxe}};function SQe(t){if(!t?.type)return null;switch(t.type){case"range":return Zxe.fromJSON(t);case"codedValue":return Yxe.fromJSON(t);case"inherited":return Xxe.fromJSON(t)}return null}var tj;const EQe=new uu({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let Ta=tj=class extends $e{constructor(t){super(t),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=void 0,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(t,{description:e}){let i=null;try{i=e?JSON.parse(e):null}catch{}return i?.value??null}readValueType(t,{description:e}){let i=null;try{i=e?JSON.parse(e):null}catch{}return i?EQe.fromJSON(i.fieldValueType):null}clone(){return new tj({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};h([f({type:String,json:{write:!0}})],Ta.prototype,"alias",void 0),h([f({type:[String,Number],json:{write:{allowNull:!0}}})],Ta.prototype,"defaultValue",void 0),h([f()],Ta.prototype,"description",void 0),h([Ni("description")],Ta.prototype,"readDescription",null),h([f({types:TQe,json:{read:{reader:SQe},write:!0}})],Ta.prototype,"domain",void 0),h([f({type:Boolean,json:{write:!0}})],Ta.prototype,"editable",void 0),h([f({type:Ln,json:{write:{overridePolicy:t=>({enabled:Number.isFinite(t)})}}})],Ta.prototype,"length",void 0),h([f({type:String,json:{write:!0}})],Ta.prototype,"name",void 0),h([f({type:Boolean,json:{write:!0}})],Ta.prototype,"nullable",void 0),h([Ut(qq)],Ta.prototype,"type",void 0),h([f()],Ta.prototype,"valueType",void 0),h([Ni("valueType",["description"])],Ta.prototype,"readValueType",null),h([f({type:Boolean,json:{read:!1}})],Ta.prototype,"visible",void 0),Ta=tj=h([z("esri.layers.support.Field")],Ta);const CQe=Ta;let dLt=class{constructor(e,i,r){this.uid=e,this.geometry=i,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null}};function fLt(t){return t.geometry!=null}let mLt=class{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}};function yLt(t){const e=TDe.fromJSON(t.geometryType),i=je.fromJSON(t.spatialReference),r=t.transform,n=t.features.map(s=>{const o=AQe(s,e,i,t.objectIdFieldName),a=o.geometry;if(a!=null&&r)switch(a.type){case"point":o.geometry=Hxe(r,a,a,a.hasZ,a.hasM);break;case"multipoint":o.geometry=jxe(r,a,a,!!a.hasZ,!!a.hasM);break;case"polygon":o.geometry=qxe(r,a,a,!!a.hasZ,!!a.hasM);break;case"polyline":o.geometry=Wxe(r,a,a,!!a.hasZ,!!a.hasM);break;case"extent":case"mesh":o.geometry=a}return o});return{geometryType:e,features:n,spatialReference:i,fields:t.fields?.map(s=>CQe.fromJSON(s))??[],objectIdFieldName:t.objectIdFieldName,globalIdFieldName:t.globalIdFieldName,geohashFieldName:t.geohashFieldName,geometryProperties:t.geometryProperties,hasZ:t.hasZ,hasM:t.hasM,exceededTransferLimit:t.exceededTransferLimit,transform:null}}function AQe(t,e,i,r){return{uid:Kc(),objectId:r&&t.attributes?t.attributes[r]:null,attributes:t.attributes,geometry:OQe(t.geometry,e,i),visible:!0}}function OQe(t,e,i){if(t==null)return null;switch(e){case"point":{const r=t;return{x:r.x,y:r.y,z:r.z,m:r.m,hasZ:r.z!=null,hasM:r.m!=null,type:"point",spatialReference:i}}case"polyline":{const r=t;return{paths:r.paths,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polyline",spatialReference:i}}case"polygon":{const r=t;return{rings:r.rings,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polygon",spatialReference:i}}case"multipoint":{const r=t;return{points:r.points,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"multipoint",spatialReference:i}}}}function RQe(t){if(t==null)return 0;let e=32;switch(t.type){case"point":e+=42;break;case"polyline":case"polygon":{let i=0;const r=2+(t.hasZ?1:0)+(t.hasM?1:0),n=t.type==="polyline"?t.paths:t.rings;for(const s of n)i+=s.length;e+=8*i*r+64,e+=128*i,e+=34,e+=32*(n.length+1);break}case"multipoint":{const i=2+(t.hasZ?1:0)+(t.hasM?1:0),r=t.points.length;e+=8*r*i+64,e+=128*r,e+=34,e+=32;break}case"extent":e+=98,t.hasM&&(e+=32),t.hasZ&&(e+=32);break;case"mesh":e+=Jy(t.vertexAttributes.position,t.vertexAttributes.normal,t.vertexAttributes.uv,t.vertexAttributes.tangent)}return e}function _Lt(t){let e=32;return e+=Iue(t.attributes),e+=3,e+=8+RQe(t.geometry),e}function vLt(t){if(t==null)return 0;switch(t.type){case"point":return 1;case"polyline":{let e=0;for(const i of t.paths)e+=i.length;return e}case"polygon":{let e=0;for(const i of t.rings)e+=i.length;return e}case"multipoint":return t.points.length;case"extent":return 2;case"mesh":{const e=t.vertexAttributes&&t.vertexAttributes.position;return e?e.length/3:0}default:return}}function bLt(t){if(t==null)return!1;switch(t.type){case"extent":case"point":return!0;case"polyline":for(const e of t.paths)if(e.length>0)return!0;return!1;case"polygon":for(const e of t.rings)if(e.length>0)return!0;return!1;case"multipoint":return t.points.length>0;case"mesh":return!t.loaded||t.vertexAttributes.position.length>0}}function wLt(t,e){switch(vr(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[3]=t.x,e[1]=e[4]=t.y,t.hasZ&&(e[2]=e[5]=t.z);break;case"polyline":for(let i=0;i<t.paths.length;i++)v6(e,t.paths[i],!!t.hasZ);break;case"polygon":for(let i=0;i<t.rings.length;i++)v6(e,t.rings[i],!!t.hasZ);break;case"multipoint":v6(e,t.points,!!t.hasZ);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[3]=t.xmax,e[4]=t.ymax,t.zmin!=null&&(e[2]=t.zmin),t.zmax!=null&&(e[5]=t.zmax)}}function PQe(t,e){switch(mh(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[2]=t.x,e[1]=e[3]=t.y;break;case"polyline":for(let i=0;i<t.paths.length;i++)t6(e,t.paths[i]);break;case"polygon":for(let i=0;i<t.rings.length;i++)t6(e,t.rings[i]);break;case"multipoint":t6(e,t.points);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax}}function xLt(t,e){return t.objectId!=null?t.objectId:t.attributes&&e?t.attributes[e]:null}let jb=class Jxe{constructor(e=null,i={},r,n){this.geometry=e,this.attributes=i,this.centroid=r,this.objectId=n,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const e=new Jxe(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}};function TLt(t){return!!t.geometry?.coords?.length}let SLt=class extends jb{},MQe=class Kxe{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new Kxe;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}},__=class kL{constructor(e=[],i=[],r=!1){this.lengths=e??[],this.coords=i??[],this.hasIndeterminateRingOrder=r}static fromRect(e){const[i,r,n,s]=e,o=n-i,a=s-r;return new kL([5],[i,r,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,i)=>e+i)}forEachVertex(e){let i=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const n=this.lengths[r];for(let s=0;s<n;s++)e(this.coords[2*(s+i)],this.coords[2*(s+i)+1]);i+=n}}clone(e){return e?(e.set(this.coords),new kL(this.lengths.slice(),e,this.hasIndeterminateRingOrder)):new kL(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}};function ca(t,e){return t?e?4:3:e?3:2}const GR=ne.getLogger("esri.layers.graphics.featureConversionUtils"),Qxe={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryEnvelope:0},$Qe=(t,e,i,r,n,s)=>{t[i]=n,t[i+1]=s},Lre=(t,e,i,r,n,s)=>{t[i]=n,t[i+1]=s,t[i+2]=e[r+2]},IQe=(t,e,i,r,n,s)=>{t[i]=n,t[i+1]=s,t[i+2]=e[r+3]},LQe=(t,e,i,r,n,s)=>{t[i]=n,t[i+1]=s,t[i+2]=e[r+2],t[i+3]=e[r+3]};function IX(t,e,i,r){if(t){if(i)return e&&r?LQe:Lre;if(e&&r)return IQe}else if(e&&r)return Lre;return $Qe}function YU({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function XU({scale:t,translate:e},i){return Math.round((e[1]-i)/t[1])}function ZU({scale:t,translate:e},i,r){return i*t[r]+e[r]}function CLt(t,e,i){return t?e?i?NX(t):LX(t):i?DX(t):ok(t):null}function ok(t){const e=t.coords;return{x:e[0],y:e[1]}}function e2e(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function LX(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function DQe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function DX(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function NQe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function NX(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function FQe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function kQe(t,e,i,r){let n=ok;i&&r?n=NX:i?n=LX:r&&(n=DX);for(const s of e){const{geometry:o,attributes:a}=s,l=o!=null?n(o):null;t.push({attributes:a,geometry:l})}return t}function FX(t,e){return t&&e?FQe:t?DQe:e?NQe:e2e}function UQe(t,e,i,r,n){const s=FX(i,r);for(const{geometry:o,attributes:a}of e){const l=o!=null?s(new __,o):null;t.push(new jb(l,a,null,n?a[n]:void 0))}return t}function ALt(t,e,i=FX(e.z!=null,e.m!=null)){return i(t,e)}function zQe(t,e,i,r){for(const{geometry:n,attributes:s}of e)t.push({attributes:s,geometry:n!=null?t2e(n,i,r):null});return t}function t2e(t,e,i){if(t==null)return null;const r=ca(e,i),n=[];for(let s=0;s<t.coords.length;s+=r){const o=[];for(let a=0;a<r;a++)o.push(t.coords[s+a]);n.push(o)}return e?i?{points:n,hasZ:e,hasM:i}:{points:n,hasZ:e}:i?{points:n,hasM:i}:{points:n}}function BQe(t,e,i,r,n){const s=ca(i,r);for(const{geometry:o,attributes:a}of e){const l=o!=null?i2e(new __,o,s):null;t.push(new jb(l,a,null,n?a[n]:void 0))}return t}function i2e(t,e,i=ca(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const r=t.coords;let n=0;for(const s of e.points)for(let o=0;o<i;o++)r[n++]=s[o];return t}function VQe(t,e,i,r){for(const{geometry:n,attributes:s}of e)t.push({attributes:s,geometry:n!=null?r2e(n,i,r):null});return t}function r2e(t,e,i){if(!t)return null;const r=ca(e,i),{coords:n,lengths:s}=t,o=[];let a=0;for(const l of s){const c=[];for(let u=0;u<l;u++){const d=[];for(let p=0;p<r;p++)d.push(n[a++]);c.push(d)}o.push(c)}return e?i?{paths:o,hasZ:e,hasM:i}:{paths:o,hasZ:e}:i?{paths:o,hasM:i}:{paths:o}}function GQe(t,e,i,r,n){const s=ca(i,r);for(const{geometry:o,attributes:a}of e){const l=o!=null?n2e(new __,o,s):null;t.push(new jb(l,a,null,n?a[n]:void 0))}return t}function n2e(t,e,i=ca(e.hasZ,e.hasM)){const{lengths:r,coords:n}=t;let s=0;for(const o of e.paths){for(const a of o)for(let l=0;l<i;l++)n[s++]=a[l];r.push(o.length)}return t}function jQe(t,e,i,r){for(const{geometry:n,attributes:s,centroid:o}of e){const a=n!=null?s2e(n,i,r):null;if(o!=null){const l=ok(o);t.push({attributes:s,centroid:l,geometry:a})}else t.push({attributes:s,geometry:a})}return t}function s2e(t,e,i){if(!t)return null;const r=ca(e,i),{coords:n,lengths:s}=t,o=[];let a=0;for(const l of s){const c=[];for(let u=0;u<l;u++){const d=[];for(let p=0;p<r;p++)d.push(n[a++]);c.push(d)}o.push(c)}return e?i?{rings:o,hasZ:e,hasM:i}:{rings:o,hasZ:e}:i?{rings:o,hasM:i}:{rings:o}}function HQe(t,e,i,r,n){for(const{geometry:s,centroid:o,attributes:a}of e){const l=s!=null?o2e(new __,s,i,r):null,c=n?a[n]:void 0;o!=null?t.push(new jb(l,a,e2e(new __,o),c)):t.push(new jb(l,a,null,c))}return t}function o2e(t,e,i=e.hasZ,r=e.hasM){return qQe(t,e.rings,i,r)}function qQe(t,e,i,r){const n=ca(i,r),{lengths:s,coords:o}=t;let a=0;dg(t);for(const l of e){for(const c of l)for(let u=0;u<n;u++)o[a++]=c[u];s.push(l.length)}return t}const vT=[],g3=[];function OLt(t,e,i,r,n){vT[0]=t;const[s]=a2e(g3,vT,e,i,r,n);return Kd(vT),Kd(g3),s}function a2e(t,e,i,r,n,s){if(Kd(t),!i){for(const o of e){const a=s?o.attributes[s]:void 0;t.push(new jb(null,o.attributes,null,a))}return t}switch(i){case"esriGeometryPoint":return UQe(t,e,r,n,s);case"esriGeometryMultipoint":return BQe(t,e,r,n,s);case"esriGeometryPolyline":return GQe(t,e,r,n,s);case"esriGeometryPolygon":return HQe(t,e,r,n,s);default:GR.error("convertToFeatureSet:unknown-geometry",new W(`Unable to parse unknown geometry type '${i}'`)),Kd(t)}return t}function RLt(t,e,i,r){g3[0]=t,l2e(vT,g3,e,i,r);const n=vT[0];return Kd(vT),Kd(g3),n}function WQe(t,e,i){if(t==null)return null;const r=new __;return"hasZ"in t&&e==null&&(e=t.hasZ),"hasM"in t&&i==null&&(i=t.hasM),Aq(t)?FX(e??t.z!=null,i??t.m!=null)(r,t):U4(t)?o2e(r,t,e,i):Oq(t)?n2e(r,t,ca(e,i)):Cq(t)?i2e(r,t,ca(e,i)):void GR.error("convertFromGeometry:unknown-geometry",new W(`Unable to parse unknown geometry type '${t}'`))}function YQe(t,e,i,r){const n=t&&("coords"in t?t:t.geometry);if(n==null)return null;switch(e){case"esriGeometryPoint":{let s=ok;return i&&r?s=NX:i?s=LX:r&&(s=DX),s(n)}case"esriGeometryMultipoint":return t2e(n,i,r);case"esriGeometryPolyline":return r2e(n,i,r);case"esriGeometryPolygon":return s2e(n,i,r);default:return GR.error("convertToGeometry:unknown-geometry",new W(`Unable to parse unknown geometry type '${e}'`)),null}}function XQe(t,e){for(const i of e)t.push({attributes:i.attributes});return t}function l2e(t,e,i,r,n){if(Kd(t),i==null)return XQe(t,e);switch(i){case"esriGeometryPoint":return kQe(t,e,r,n);case"esriGeometryMultipoint":return zQe(t,e,r,n);case"esriGeometryPolyline":return VQe(t,e,r,n);case"esriGeometryPolygon":return jQe(t,e,r,n);default:GR.error("convertToFeatureSet:unknown-geometry",new W(`Unable to parse unknown geometry type '${i}'`))}return t}function PLt(t){const{objectIdFieldName:e,spatialReference:i,transform:r,fields:n,hasM:s,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:u,queryGeometry:d,queryGeometryType:p}=t,m={features:l2e([],a,l,o,s),fields:n,geometryType:l,objectIdFieldName:e,spatialReference:i,uniqueIdField:u,queryGeometry:YQe(d,p,!1,!1)};return r&&(m.transform=r),c&&(m.exceededTransferLimit=c),s&&(m.hasM=s),o&&(m.hasZ=o),m}function MLt(t,e){const i=new MQe,{hasM:r,hasZ:n,features:s,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:u,fields:d}=t;return d&&(i.fields=d),i.geometryType=l??null,i.objectIdFieldName=o??e??null,i.spatialReference=a??null,i.objectIdFieldName?(s&&a2e(i.features,s,l,n,r,i.objectIdFieldName),c&&(i.exceededTransferLimit=c),r&&(i.hasM=r),n&&(i.hasZ=n),u&&(i.transform=u),i):(GR.error(new W("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),i)}function $Lt(t){const{transform:e,features:i,hasM:r,hasZ:n}=t;if(!e)return t;for(const s of i)s.geometry!=null&&Nre(s.geometry,s.geometry,r,n,e),s.centroid!=null&&Nre(s.centroid,s.centroid,r,n,e);return t.transform=null,t}function ILt(t,e){const{geometryType:i,features:r,hasM:n,hasZ:s}=e;if(!t)return e;for(let o=0;o<r.length;o++){const a=r[o],l=a.weakClone();l.geometry=new __,Dre(l.geometry,a.geometry,n,s,i,t),a.centroid&&(l.centroid=new __,Dre(l.centroid,a.centroid,n,s,"esriGeometryPoint",t)),r[o]=l}return e.transform=t,e}function Dre(t,e,i,r,n,s,o=i,a=r){if(dg(t),!e?.coords.length)return null;const l=Qxe[n],{coords:c,lengths:u}=e,d=ca(i,r),p=ca(i&&o,r&&a),m=IX(i,r,o,a);if(!u.length)return m(t.coords,c,0,0,YU(s,c[0]),XU(s,c[1])),dg(t,d,0),t;let y,_,v,w,x=0,T=0,S=T;for(const E of u){if(E<l)continue;let A=0;T=S,v=y=YU(s,c[x]),w=_=XU(s,c[x+1]),m(t.coords,c,T,x,v,w),A++,x+=d,T+=p;for(let P=1;P<E;P++,x+=d)v=YU(s,c[x]),w=XU(s,c[x+1]),v===y&&w===_||(m(t.coords,c,T,x,v-y,w-_),T+=p,A++,y=v,_=w);A>=l&&(t.lengths.push(A),S=T)}return Kd(t.coords,S),t.coords.length?t:null}function LLt(t,e,i,r,n,s,o=i,a=r){if(dg(t),!e?.coords.length)return null;const l=Qxe[n],{coords:c,lengths:u}=e,d=ca(i,r),p=ca(i&&o,r&&a),m=IX(i,r,o,a);if(!u.length)return m(t.coords,c,0,0,c[0],c[1]),dg(t,d,0),t;let y=0;const _=s*s;for(const v of u){if(v<l){y+=v*d;continue}const w=t.coords.length/p,x=y,T=y+(v-1)*d;m(t.coords,c,t.coords.length,x,c[x],c[x+1]),ij(t.coords,c,d,_,m,x,T),m(t.coords,c,t.coords.length,T,c[T],c[T+1]);const S=t.coords.length/p-w;S>=l?t.lengths.push(S):Kd(t.coords,w*p),y+=v*d}return t.coords.length?t:null}function ZQe(t,e,i,r){const n=t[e],s=t[e+1],o=t[i],a=t[i+1],l=t[r],c=t[r+1];let u=o,d=a,p=l-u,m=c-d;if(p!==0||m!==0){const y=((n-u)*p+(s-d)*m)/(p*p+m*m);y>1?(u=l,d=c):y>0&&(u+=p*y,d+=m*y)}return p=n-u,m=s-d,p*p+m*m}function ij(t,e,i,r,n,s,o){let a,l=r,c=0;for(let u=s+i;u<o;u+=i)a=ZQe(e,u,s,o),a>l&&(c=u,l=a);l>r&&(c-s>i&&ij(t,e,i,r,n,s,c),n(t,e,t.length,c,e[c],e[c+1]),o-c>i&&ij(t,e,i,r,n,c,o))}function DLt(t,e,i,r){if(!e?.coords?.length)return null;const n=ca(i,r);let s=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&e.coords){const c=e.coords;for(let u=0;u<c.length;u+=n){const d=c[u],p=c[u+1];s=Math.min(s,d),a=Math.max(a,d),o=Math.min(o,p),l=Math.max(l,p)}}return wV(t)?h6e(t,s,o,a,l):bq(s,o,a,l,t),t}function Nre(t,e,i,r,n){const{coords:s,lengths:o}=e,a=ca(i,r);if(!s.length)return t!==e&&dg(t),t;d4(n);const{originPosition:l,scale:c,translate:u}=n,d=KQe;d.originPosition=l;const p=d.scale;p[0]=c[0]??1,p[1]=-(c[1]??1),p[2]=c[2]??1,p[3]=c[3]??1;const m=d.translate;if(m[0]=u[0]??0,m[1]=u[1]??0,m[2]=u[2]??0,m[3]=u[3]??0,!o.length){for(let _=0;_<a;++_)t.coords[_]=ZU(d,s[_],_);return t!==e&&dg(t,a,0),t}let y=0;for(let _=0;_<o.length;_++){const v=o[_];t.lengths[_]=v;for(let T=0;T<a;++T)t.coords[y+T]=ZU(d,s[y+T],T);let w=t.coords[y],x=t.coords[y+1];y+=a;for(let T=1;T<v;T++,y+=a){w+=s[y]*p[0],x+=s[y+1]*p[1],t.coords[y]=w,t.coords[y+1]=x;for(let S=2;S<a;++S)t.coords[y+S]=ZU(d,s[y+S],S)}}return t!==e&&dg(t,s.length,o.length),t}function NLt(t,e,i,r,n,s){if(dg(t),t.lengths.push(...e.lengths),i===n&&r===s)for(let o=0;o<e.coords.length;o++)t.coords.push(e.coords[o]);else{const o=ca(i,r),a=IX(i,r,n,s),l=e.coords;for(let c=0;c<l.length;c+=o)a(t.coords,l,t.coords.length,c,l[c],l[c+1])}return t}function JQe(t,e,i,r){let n=0,s=t[r*e],o=t[r*(e+1)];for(let a=1;a<i;a++){const l=s+t[r*(e+a)],c=o+t[r*(e+a)+1],u=(l-s)*(c+o);s=l,o=c,n+=u}return .5*n}function FLt(t,e){const{coords:i,lengths:r}=t;let n=0,s=0;for(let o=0;o<r.length;o++){const a=r[o];s+=JQe(i,n,a,e),n+=a}return Math.abs(s)}function dg(t,e=0,i=0){Kd(t.lengths,i),Kd(t.coords,e)}function Kd(t,e=0){t.length!==e&&(t.length=e)}const KQe={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]},Fre=new aa(Array,t=>Z4(t,Nge),null,10,5),QQe=Gt();let eet=class{get labelLayers(){return this._labelLayers||EOe}get extent(){return this._extent}get isElevationSource(){return this.layers.some(e=>e?.isElevationSource)}constructor(e,i,r,n,s){this.graphic=e,this.graphics3DSymbol=i,this.layers=r,this._visibleFlags=Ro.ALL_LABEL,this.deconflictionPriority=0,++i.referenced,this._featureExpressionFeature=s?Uwe(s,e,n):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic(i=>{i.initialize(e),i.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers=null}addLabelGraphic(e,i){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(i),e.setVisibility(this.isVisible(Us.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(i=>{i.type==="draped"&&(e=!0)}),e}isVisible(e=Us.GRAPHIC,i){const r=i?this._visibleFlags|i|Us.LABEL*i:this._visibleFlags;return e===Us.GRAPHIC?(r&Ro.ALL_GRAPHIC)===Ro.ALL_GRAPHIC:(r&Ro.ALL_LABEL)===Ro.ALL_LABEL}setVisibilityFlag(e,i,r){const n=this.isVisible(e);r?this._visibleFlags|=e*i:this._visibleFlags&=~(e*i);const s=this.isVisible(e);if(n===s)return!1;if(e===Us.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(s));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(s));const o=this.isVisible(Us.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}getVisibilityFlag(e,i){return(this._visibleFlags&e*i)!=0}computeExtent(e){if(!this._extent){const i=this.graphic.geometry;if(i==null)return!1;this._extent=Gt(),PQe(i,this._extent);const r=i.spatialReference;if(!wn(r,e)&&!oF(this._extent,r,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,i){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,i)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,i,r){let n=e.geometry;return n.type!=="mesh"&&n.type!=="extent"||(n=Mf.fromExtent(n.type==="mesh"?n.extent:n)),WQe(n,i,r)}get usedMemory(){let e=Iue(this.graphic.attributes);return this._forEachSymbolLayerGraphic(i=>e+=i.graphics3DSymbolLayer.usedMemory),e}computeAttachmentOrigin(){const e={render:{origin:C(),num:0},draped:{origin:Ue(),num:0}};for(const i of this.layers)i?.computeAttachmentOrigin(e);return e.render.num>1&&te(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&Yl(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,i,r,n,s){return s||(s={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),s.boundingBox?vr(s.boundingBox):s.boundingBox=vr(),s.requiresDrapedElevation=!1,await b4(this.layers,async o=>{if(o==null)return;const a=o.type==="draped"?i:e,l=Fre.acquire(),c=await o.getProjectedBoundingBox(a,r,s.screenSpaceObjects,n,l);isFinite(c[2])&&isFinite(c[5])||(s.requiresDrapedElevation=!0),c&&ZT(s.boundingBox,l),Fre.release(l)}),c6e(s.boundingBox)||HB(hW(s.boundingBox,QQe))?s:null}needsElevationUpdates(){for(const e of this.layers)if(e!=null&&(e.type==="object3d"||e.type==="lod-instance")&&e.needsElevationUpdates)return!0;return this._labelLayers?.some(e=>e?.needsElevationUpdates??!1)??!1}alignWithElevation(e,i,r){this._forEachRenderedGraphic(n=>{n.type!=="object3d"&&n.type!=="lod-instance"||n.alignWithElevation(e,i,this._featureExpressionFeature,r)})}alignWithAbsoluteElevation(e,i,r){this._forEachRenderedGraphic(n=>{n.type==="object3d"&&n.alignWithAbsoluteElevation(e,i,r)})}addObjectStateSet(e,i){this._forEachSymbolLayerGraphic(r=>r.addObjectState(e,i))}removeObjectState(e){this._forEachSymbolLayerGraphic(i=>i.removeObjectState(e))}_forEachGraphicList(e,i){e?.forEach(r=>r&&i(r))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){const e=this;return{addLabelLayer:i=>{e._labelLayers||(e._labelLayers=new Array),e._labelLayers.push(i)}}}},ULt=class{constructor(e,i){this.scheduler=e,this.schedule=i,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}},tet=class{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}};var kre,Ure,zre,rj={exports:{}};rj.exports,kre=rj,Ure=function(){function t(M,I,G){G=G||2;var q,Z,K,Q,de,Ae,st,vt=I&&I.length,ot=vt?I[0]*G:M.length,gt=e(M,0,ot,G,!0),ze=[];if(!gt||gt.next===gt.prev)return ze;if(vt&&(gt=l(M,I,gt,G)),M.length>80*G){q=K=M[0],Z=Q=M[1];for(var ue=G;ue<ot;ue+=G)(de=M[ue])<q&&(q=de),(Ae=M[ue+1])<Z&&(Z=Ae),de>K&&(K=de),Ae>Q&&(Q=Ae);st=(st=Math.max(K-q,Q-Z))!==0?1/st:0}return r(gt,ze,G,q,Z,st),ze}function e(M,I,G,q,Z){var K,Q;if(Z===X(M,I,G,q)>0)for(K=I;K<G;K+=q)Q=k(K,M[K],M[K+1],Q);else for(K=G-q;K>=I;K-=q)Q=k(K,M[K],M[K+1],Q);if(Q&&E(Q,Q.next)){var de=Q.next;B(Q),Q=de}return Q}function i(M,I){if(!M)return M;I||(I=M);var G,q=M;do if(G=!1,q.steiner||!E(q,q.next)&&S(q.prev,q,q.next)!==0)q=q.next;else{var Z=q.prev;if(B(q),(q=I=Z)===q.next)break;G=!0}while(G||q!==I);return I}function r(M,I,G,q,Z,K,Q){if(M){!Q&&K&&y(M,q,Z,K);for(var de,Ae,st=M;M.prev!==M.next;)if(de=M.prev,Ae=M.next,K?s(M,q,Z,K):n(M))I.push(de.i/G),I.push(M.i/G),I.push(Ae.i/G),B(M),M=Ae.next,st=Ae.next;else if((M=Ae)===st){Q?Q===1?r(M=o(i(M),I,G),I,G,q,Z,K,2):Q===2&&a(M,I,G,q,Z,K):r(i(M),I,G,q,Z,K,1);break}}}function n(M){var I=M.prev,G=M,q=M.next;if(S(I,G,q)>=0)return!1;for(var Z=M.next.next;Z!==M.prev;){if(x(I.x,I.y,G.x,G.y,q.x,q.y,Z.x,Z.y)&&S(Z.prev,Z,Z.next)>=0)return!1;Z=Z.next}return!0}function s(M,I,G,q){var Z=M.prev,K=M,Q=M.next;if(S(Z,K,Q)>=0)return!1;for(var de=Z.x<K.x?Z.x<Q.x?Z.x:Q.x:K.x<Q.x?K.x:Q.x,Ae=Z.y<K.y?Z.y<Q.y?Z.y:Q.y:K.y<Q.y?K.y:Q.y,st=Z.x>K.x?Z.x>Q.x?Z.x:Q.x:K.x>Q.x?K.x:Q.x,vt=Z.y>K.y?Z.y>Q.y?Z.y:Q.y:K.y>Q.y?K.y:Q.y,ot=v(de,Ae,I,G,q),gt=v(st,vt,I,G,q),ze=M.prevZ,ue=M.nextZ;ze&&ze.z>=ot&&ue&&ue.z<=gt;){if(ze!==M.prev&&ze!==M.next&&x(Z.x,Z.y,K.x,K.y,Q.x,Q.y,ze.x,ze.y)&&S(ze.prev,ze,ze.next)>=0||(ze=ze.prevZ,ue!==M.prev&&ue!==M.next&&x(Z.x,Z.y,K.x,K.y,Q.x,Q.y,ue.x,ue.y)&&S(ue.prev,ue,ue.next)>=0))return!1;ue=ue.nextZ}for(;ze&&ze.z>=ot;){if(ze!==M.prev&&ze!==M.next&&x(Z.x,Z.y,K.x,K.y,Q.x,Q.y,ze.x,ze.y)&&S(ze.prev,ze,ze.next)>=0)return!1;ze=ze.prevZ}for(;ue&&ue.z<=gt;){if(ue!==M.prev&&ue!==M.next&&x(Z.x,Z.y,K.x,K.y,Q.x,Q.y,ue.x,ue.y)&&S(ue.prev,ue,ue.next)>=0)return!1;ue=ue.nextZ}return!0}function o(M,I,G){var q=M;do{var Z=q.prev,K=q.next.next;!E(Z,K)&&A(Z,q,q.next,K)&&D(Z,K)&&D(K,Z)&&(I.push(Z.i/G),I.push(q.i/G),I.push(K.i/G),B(q),B(q.next),q=M=K),q=q.next}while(q!==M);return i(q)}function a(M,I,G,q,Z,K){var Q=M;do{for(var de=Q.next.next;de!==Q.prev;){if(Q.i!==de.i&&T(Q,de)){var Ae=R(Q,de);return Q=i(Q,Q.next),Ae=i(Ae,Ae.next),r(Q,I,G,q,Z,K),void r(Ae,I,G,q,Z,K)}de=de.next}Q=Q.next}while(Q!==M)}function l(M,I,G,q){var Z,K,Q,de=[];for(Z=0,K=I.length;Z<K;Z++)(Q=e(M,I[Z]*q,Z<K-1?I[Z+1]*q:M.length,q,!1))===Q.next&&(Q.steiner=!0),de.push(w(Q));for(de.sort(c),Z=0;Z<de.length;Z++)G=i(G=d(de[Z],G),G.next);return G}function c(M,I){return M.x-I.x}function u(M){if(M.next.prev===M)return M;let I=M;for(;;){const G=I.next;if(G.prev===I||G===I||G===M)break;I=G}return I}function d(M,I){var G=p(M,I);if(!G)return I;var q=R(G,M),Z=i(G,G.next);let K=u(q);return i(K,K.next),Z=u(Z),u(I===G?Z:I)}function p(M,I){var G,q=I,Z=M.x,K=M.y,Q=-1/0;do{if(K<=q.y&&K>=q.next.y&&q.next.y!==q.y){var de=q.x+(K-q.y)*(q.next.x-q.x)/(q.next.y-q.y);if(de<=Z&&de>Q){if(Q=de,de===Z){if(K===q.y)return q;if(K===q.next.y)return q.next}G=q.x<q.next.x?q:q.next}}q=q.next}while(q!==I);if(!G)return null;if(Z===Q)return G;var Ae,st=G,vt=G.x,ot=G.y,gt=1/0;q=G;do Z>=q.x&&q.x>=vt&&Z!==q.x&&x(K<ot?Z:Q,K,vt,ot,K<ot?Q:Z,K,q.x,q.y)&&(Ae=Math.abs(K-q.y)/(Z-q.x),D(q,M)&&(Ae<gt||Ae===gt&&(q.x>G.x||q.x===G.x&&m(G,q)))&&(G=q,gt=Ae)),q=q.next;while(q!==st);return G}function m(M,I){return S(M.prev,M,I.prev)<0&&S(I.next,M,M.next)<0}function y(M,I,G,q){var Z=M;do Z.z===null&&(Z.z=v(Z.x,Z.y,I,G,q)),Z.prevZ=Z.prev,Z.nextZ=Z.next,Z=Z.next;while(Z!==M);Z.prevZ.nextZ=null,Z.prevZ=null,_(Z)}function _(M){var I,G,q,Z,K,Q,de,Ae,st=1;do{for(G=M,M=null,K=null,Q=0;G;){for(Q++,q=G,de=0,I=0;I<st&&(de++,q=q.nextZ);I++);for(Ae=st;de>0||Ae>0&&q;)de!==0&&(Ae===0||!q||G.z<=q.z)?(Z=G,G=G.nextZ,de--):(Z=q,q=q.nextZ,Ae--),K?K.nextZ=Z:M=Z,Z.prevZ=K,K=Z;G=q}K.nextZ=null,st*=2}while(Q>1);return M}function v(M,I,G,q,Z){return(M=1431655765&((M=858993459&((M=252645135&((M=16711935&((M=32767*(M-G)*Z)|M<<8))|M<<4))|M<<2))|M<<1))|(I=1431655765&((I=858993459&((I=252645135&((I=16711935&((I=32767*(I-q)*Z)|I<<8))|I<<4))|I<<2))|I<<1))<<1}function w(M){var I=M,G=M;do(I.x<G.x||I.x===G.x&&I.y<G.y)&&(G=I),I=I.next;while(I!==M);return G}function x(M,I,G,q,Z,K,Q,de){return(Z-Q)*(I-de)-(M-Q)*(K-de)>=0&&(M-Q)*(q-de)-(G-Q)*(I-de)>=0&&(G-Q)*(K-de)-(Z-Q)*(q-de)>=0}function T(M,I){return M.next.i!==I.i&&M.prev.i!==I.i&&!F(M,I)&&(D(M,I)&&D(I,M)&&$(M,I)&&(S(M.prev,M,I.prev)||S(M,I.prev,I))||E(M,I)&&S(M.prev,M,M.next)>0&&S(I.prev,I,I.next)>0)}function S(M,I,G){return(I.y-M.y)*(G.x-I.x)-(I.x-M.x)*(G.y-I.y)}function E(M,I){return M.x===I.x&&M.y===I.y}function A(M,I,G,q){var Z=N(S(M,I,G)),K=N(S(M,I,q)),Q=N(S(G,q,M)),de=N(S(G,q,I));return Z!==K&&Q!==de||!(Z!==0||!P(M,G,I))||!(K!==0||!P(M,q,I))||!(Q!==0||!P(G,M,q))||!(de!==0||!P(G,I,q))}function P(M,I,G){return I.x<=Math.max(M.x,G.x)&&I.x>=Math.min(M.x,G.x)&&I.y<=Math.max(M.y,G.y)&&I.y>=Math.min(M.y,G.y)}function N(M){return M>0?1:M<0?-1:0}function F(M,I){var G=M;do{if(G.i!==M.i&&G.next.i!==M.i&&G.i!==I.i&&G.next.i!==I.i&&A(G,G.next,M,I))return!0;G=G.next}while(G!==M);return!1}function D(M,I){return S(M.prev,M,M.next)<0?S(M,I,M.next)>=0&&S(M,M.prev,I)>=0:S(M,I,M.prev)<0||S(M,M.next,I)<0}function $(M,I){var G=M,q=!1,Z=(M.x+I.x)/2,K=(M.y+I.y)/2;do G.y>K!=G.next.y>K&&G.next.y!==G.y&&Z<(G.next.x-G.x)*(K-G.y)/(G.next.y-G.y)+G.x&&(q=!q),G=G.next;while(G!==M);return q}function R(M,I){var G=new j(M.i,M.x,M.y),q=new j(I.i,I.x,I.y),Z=M.next,K=I.prev;return M.next=I,I.prev=M,G.next=Z,Z.prev=G,q.next=G,G.prev=q,K.next=q,q.prev=K,q}function k(M,I,G,q){var Z=new j(M,I,G);return q?(Z.next=q.next,Z.prev=q,q.next.prev=Z,q.next=Z):(Z.prev=Z,Z.next=Z),Z}function B(M){M.next.prev=M.prev,M.prev.next=M.next,M.prevZ&&(M.prevZ.nextZ=M.nextZ),M.nextZ&&(M.nextZ.prevZ=M.prevZ)}function j(M,I,G){this.i=M,this.x=I,this.y=G,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function X(M,I,G,q){for(var Z=0,K=I,Q=G-q;K<G;K+=q)Z+=(M[Q]-M[K])*(M[K+1]+M[Q+1]),Q=K;return Z}return t.deviation=function(M,I,G,q){var Z=I&&I.length,K=Z?I[0]*G:M.length,Q=Math.abs(X(M,0,K,G));if(Z)for(var de=0,Ae=I.length;de<Ae;de++){var st=I[de]*G,vt=de<Ae-1?I[de+1]*G:M.length;Q-=Math.abs(X(M,st,vt,G))}var ot=0;for(de=0;de<q.length;de+=3){var gt=q[de]*G,ze=q[de+1]*G,ue=q[de+2]*G;ot+=Math.abs((M[gt]-M[ue])*(M[ze+1]-M[gt+1])-(M[gt]-M[ze])*(M[ue+1]-M[gt+1]))}return Q===0&&ot===0?0:Math.abs((ot-Q)/Q)},t.flatten=function(M){for(var I=M[0][0].length,G={vertices:[],holes:[],dimensions:I},q=0,Z=0;Z<M.length;Z++){for(var K=0;K<M[Z].length;K++)for(var Q=0;Q<I;Q++)G.vertices.push(M[Z][K][Q]);Z>0&&(q+=M[Z-1].length,G.holes.push(q))}return G},t},(zre=Ure())!==void 0&&(kre.exports=zre);const gS=MR(rj.exports),ak=ne.getLogger("esri.views.3d.support.buffer.math");function iet(t,e,i){Qd(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function Qd(t,e,i,r=3,n=r){if(t.length/r!==Math.ceil(e.length/n))return ak.error("source and destination buffers need to have the same number of elements"),t;const s=t.length/r,o=i[0],a=i[1],l=i[2],c=i[4],u=i[5],d=i[6],p=i[8],m=i[9],y=i[10],_=i[12],v=i[13],w=i[14];let x=0,T=0;for(let S=0;S<s;S++){const E=e[x],A=e[x+1],P=e[x+2];t[T]=o*E+c*A+p*P+_,t[T+1]=a*E+u*A+m*P+v,t[T+2]=l*E+d*A+y*P+w,x+=n,T+=r}return t}function c2e(t,e,i){ep(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function ep(t,e,i,r=3,n=r){if(t.length/r!==Math.ceil(e.length/n))return void ak.error("source and destination buffers need to have the same number of elements");const s=t.length/r,o=i[0],a=i[1],l=i[2],c=i[3],u=i[4],d=i[5],p=i[6],m=i[7],y=i[8];let _=0,v=0;for(let w=0;w<s;w++){const x=e[_],T=e[_+1],S=e[_+2];t[v]=o*x+c*T+p*S,t[v+1]=a*x+u*T+m*S,t[v+2]=l*x+d*T+y*S,_+=n,v+=r}}function ret(t,e,i){t5(t.typedBuffer,e,i,t.typedBufferStride)}function t5(t,e,i,r=3){const n=Math.min(t.length/r,e.count),s=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<n;c++)t[l]=i*s[a],t[l+1]=i*s[a+1],t[l+2]=i*s[a+2],a+=o,l+=r}function net(t,e){lk(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function lk(t,e,i=3,r=i){const n=Math.min(t.length/i,e.length/r);let s=0,o=0;for(let a=0;a<n;a++){const l=e[s],c=e[s+1],u=e[s+2],d=l*l+c*c+u*u;if(d>0){const p=1/Math.sqrt(d);t[o]=p*l,t[o+1]=p*c,t[o+2]=p*u}s+=r,o+=i}}function set(t,e,i){const r=Math.min(t.count,e.count),n=t.typedBuffer,s=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;let l=0,c=0;for(let u=0;u<r;u++)n[c]=o[l]>>i,n[c+1]=o[l+1]>>i,n[c+2]=o[l+2]>>i,l+=a,c+=s}Object.freeze(Object.defineProperty({__proto__:null,normalize:lk,normalizeView:net,scale:t5,scaleView:ret,shiftRight:set,transformMat3:ep,transformMat3View:c2e,transformMat4:Qd,transformMat4View:iet},Symbol.toStringTag,{value:"Module"}));function oet(t,e,i){return{objectId:t,target:e,distance:i,type:"vertex"}}function Bre(t,e,i,r,n,s=!1){return{objectId:t,target:e,distance:i,type:"edge",start:r,end:n,draped:s}}var pg,Yo;function aet(t){return t&&t.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function AO(t){return t!=null&&!isNaN(t)&&isFinite(t)}function cet(t){return t.valueExpression?pg.Expression:t.field&&typeof t.field=="string"?pg.Field:pg.Unknown}function VLt(t,e){const i=e||cet(t),r=t.valueUnit||"unknown";return i===pg.Unknown?Yo.Constant:t.stops?Yo.Stops:t.minSize!=null&&t.maxSize!=null&&t.minDataValue!=null&&t.maxDataValue!=null?Yo.ClampedLinear:r==="unknown"?t.minSize!=null&&t.minDataValue!=null?t.minSize&&t.minDataValue?Yo.Proportional:Yo.Additive:Yo.Identity:Yo.RealWorldSize}(function(t){t.Unknown="unknown",t.Expression="expression",t.Field="field"})(pg||(pg={})),function(t){t.Unknown="unknown",t.Stops="stops",t.ClampedLinear="clamped-linear",t.Proportional="proportional",t.Additive="additive",t.Constant="constant",t.Identity="identity",t.RealWorldSize="real-world-size"}(Yo||(Yo={}));const v_=ne.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),Vre=new Lb,UL=Math.PI,uet=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function u2e(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(y=>y.type==="color"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void v_.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const n=typeof e=="number",s=n?null:e,o=s?.attributes;let a=n?e:null;const l=r.field,{ipData:c,hasExpression:u}=r.cache;let d=r.cache.compiledFunc;if(!l&&!u){const y=r.stops;return y&&y[0]&&y[0].color}if(typeof a!="number")if(u){if(i?.arcade==null)return void v_.error("Use of arcade expressions requires an arcade context");const y={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},_=i.arcade.arcadeUtils,v=_.getViewInfo(y),w=_.createExecContext(s,v,i.timeZone);if(!d){const x=_.createSyntaxTree(r.valueExpression);d=_.createFunction(x),r.cache.compiledFunc=d}a=_.executeFunction(d,w)}else o&&(a=o[l]);const p=r.normalizationField,m=o!=null&&p!=null?parseFloat(o[p]):void 0;if(a!=null&&(!p||n||!isNaN(m)&&m!==0)){isNaN(m)||n||(a/=m);const y=UX(a,c);if(y){const _=y[0],v=y[1],w=_===v?r.stops[_].color:Ye.blendColors(r.stops[_].color,r.stops[v].color,y[2],i?.color);return new Ye(w)}}}function h2e(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(y=>y.type==="opacity"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void v_.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const n=typeof e=="number",s=n?null:e,o=s?.attributes;let a=n?e:null;const l=r.field,{ipData:c,hasExpression:u}=r.cache;let d=r.cache.compiledFunc;if(!l&&!u){const y=r.stops;return y&&y[0]&&y[0].opacity}if(typeof a!="number")if(u){if(i?.arcade==null)return void v_.error("Use of arcade expressions requires an arcade context");const y={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},_=i.arcade.arcadeUtils,v=_.getViewInfo(y),w=_.createExecContext(s,v,i.timeZone);if(!d){const x=_.createSyntaxTree(r.valueExpression);d=_.createFunction(x),r.cache.compiledFunc=d}a=_.executeFunction(d,w)}else o&&(a=o[l]);const p=r.normalizationField,m=o!=null&&p!=null?parseFloat(o[p]):void 0;if(a!=null&&(!p||n||!isNaN(m)&&m!==0)){isNaN(m)||n||(a/=m);const y=UX(a,c);if(y){const _=y[0],v=y[1];if(_===v)return r.stops[_].opacity;{const w=r.stops[_].opacity;return w+(r.stops[v].opacity-w)*y[2]}}}}function d2e(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(m=>m.type==="rotation"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void v_.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const n=r.axis||"heading",s=n==="heading"&&r.rotationType==="arithmetic"?90:0,o=n==="heading"&&r.rotationType==="arithmetic"?-1:1,a=typeof e=="number"?null:e,l=a?.attributes,c=r.field,{hasExpression:u}=r.cache;let d=r.cache.compiledFunc,p=0;if(!c&&!u)return p;if(u){if(i?.arcade==null)return void v_.error("Use of arcade expressions requires an arcade context");const m={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},y=i.arcade.arcadeUtils,_=y.getViewInfo(m),v=y.createExecContext(a,_,i.timeZone);if(!d){const w=y.createSyntaxTree(r.valueExpression);d=y.createFunction(w),r.cache.compiledFunc=d}p=y.executeFunction(d,v)}else l&&(p=l[c]||0);return p=typeof p!="number"||isNaN(p)?null:s+o*p,p}function het(t,e,i){const r=typeof e=="number",n=r?null:e,s=n?.attributes;let o=r?e:null;const{isScaleDriven:a}=t.cache;let l=t.cache.compiledFunc;if(a){const u=i?.scale,d=i?.view;o=u==null||d==="3d"?det(t):u}else if(!r)switch(t.inputValueType){case pg.Expression:{if(i?.arcade==null)return void v_.error("Use of arcade expressions requires an arcade context");const u={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},d=i.arcade.arcadeUtils,p=d.getViewInfo(u),m=d.createExecContext(n,p,i.timeZone);if(!l){const y=d.createSyntaxTree(t.valueExpression);l=d.createFunction(y),t.cache.compiledFunc=l}o=d.executeFunction(l,m);break}case pg.Field:s&&(o=s[t.field]);break;case pg.Unknown:o=null}if(!AO(o))return null;if(r||!t.normalizationField)return o;const c=s?parseFloat(s[t.normalizationField]):null;return AO(c)&&c!==0?o/c:null}function det(t){let e=null,i=null;const r=t.stops;return r?(e=r[0].value,i=r[r.length-1].value):(e=t.minDataValue||0,i=t.maxDataValue||0),(e+i)/2}function ck(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(s=>s.type==="size"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void v_.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const n=f2e(het(r,e,i),r,e,i,r.cache.ipData);return n==null||isNaN(n)?0:n}function rc(t,e,i){return t==null?null:aet(t)?ck(t,e,i):AO(t)?t:null}function p2e(t,e,i){return AO(i)&&t>i?i:AO(e)&&t<e?e:t}function pet(t,e,i,r){return t+((rc(e.minSize,i,r)||e.minDataValue)??0)}function fet(t,e,i){const r=t.stops;let n=r?.length&&r[0].size;return n==null&&(n=t.minSize),rc(n,e,i)}function met(t,e,i,r){const n=(t-e.minDataValue)/(e.maxDataValue-e.minDataValue),s=rc(e.minSize,i,r),o=rc(e.maxSize,i,r),a=r?.shape;if(t<=e.minDataValue)return s;if(t>=e.maxDataValue)return o;if(s==null||o==null)return null;if(e.scaleBy==="area"&&a){const l=a==="circle",c=l?UL*(s/2)**2:s*s,u=c+n*((l?UL*(o/2)**2:o*o)-c);return l?2*Math.sqrt(u/UL):Math.sqrt(u)}return s+n*(o-s)}function get(t,e,i,r){const n=r?.shape,s=t/e.minDataValue,o=rc(e.minSize,i,r),a=rc(e.maxSize,i,r);let l=null;return l=n==="circle"?2*Math.sqrt(s*(o/2)**2):n==="square"||n==="diamond"||n==="image"?Math.sqrt(s*o**2):s*o,p2e(l,o,a)}function yet(t,e,i,r,n){const[s,o,a]=UX(t,n);if(s===o)return rc(e.stops?.[s].size,i,r);{const l=rc(e.stops?.[s].size,i,r);return l+(rc(e.stops?.[o].size,i,r)-l)*a}}function _et(t,e,i,r){const n=(r?.resolution??1)*uS[e.valueUnit],s=rc(e.minSize,i,r),o=rc(e.maxSize,i,r),{valueRepresentation:a}=e;let l=null;return l=a==="area"?2*Math.sqrt(t/UL)/n:a==="radius"||a==="distance"?2*t/n:t/n,p2e(l,s,o)}function f2e(t,e,i,r,n){switch(e.transformationType){case Yo.Additive:return pet(t,e,i,r);case Yo.Constant:return fet(e,i,r);case Yo.ClampedLinear:return met(t,e,i,r);case Yo.Proportional:return get(t,e,i,r);case Yo.Stops:return yet(t,e,i,r,n);case Yo.RealWorldSize:return _et(t,e,i,r);case Yo.Identity:return t;case Yo.Unknown:return null}}function vet(t,e,i){const{isScaleDriven:r}=t.cache;if(!(r&&i==="3d"||e))return null;const n={scale:e,view:i};let s=rc(t.minSize,Vre,n),o=rc(t.maxSize,Vre,n);if(s!=null||o!=null){if(s>o){const a=o;o=s,s=a}return{minSize:s,maxSize:o}}}function kX(t,e,i){if(!t.visualVariables)return;const r=[],n=[],s=[],o=[],a=[];for(const l of t.visualVariables)switch(l.type){case"color":n.push(l);break;case"opacity":s.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return n.forEach(l=>{const c=u2e(l,e,i);r.push({variable:l,value:c})}),s.forEach(l=>{const c=h2e(l,e,i);r.push({variable:l,value:c})}),a.forEach(l=>{const c=d2e(l,e,i);r.push({variable:l,value:c})}),o.forEach(l=>{const c=ck(l,e,i);r.push({variable:l,value:c})}),r.filter(l=>l.value!=null)}function UX(t,e){if(!e)return;let i=0,r=e.length-1;return e.some((n,s)=>t<n?(r=s,!0):(i=s,!1)),[i,r,(t-e[i])/(e[r]-e[i])]}function bet(t,e,i){const r=["proportional","proportional","proportional"];for(const n of t){const s=n.useSymbolValue?"symbol-value":ck(n,e,i);switch(n.axis){case"width":r[0]=s;break;case"depth":r[1]=s;break;case"height":r[2]=s;break;case"width-and-depth":r[0]=s,r[1]=s;break;case"all":case void 0:case null:r[0]=s,r[1]=s,r[2]=s;break;default:n.axis}}return r}const GLt=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:bet,getColor:u2e,getOpacity:h2e,getRotationAngle:d2e,getSize:ck,getSizeForValue:f2e,getSizeFromNumberOrVariable:rc,getSizeRangeAtScale:vet,getVisualVariableValues:kX,viewScaleRE:uet},Symbol.toStringTag,{value:"Module"}));function uk(t,e){if(!t||t.symbol)return null;const i=e?.renderer;return t&&i!=null&&i.getObservationRenderer?i.getObservationRenderer(t):i}function wet(t,e){if(t.symbol!=null)return t.symbol;const i=uk(t,e);return i!=null&&i.type!=="dot-density"?i.getSymbol(t,e):null}function jLt(t,e){const i=uk(t,e),r=wet(t,e);if(r==null)return null;const n={renderer:i,symbol:r};if(i==null||!("visualVariables"in i)||!i.visualVariables)return n;const s=kX(i,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of s)switch(a.type){case"color":n.color=l.toRgba();break;case"size":if(a.target==="outline")n.outlineSize=l;else{const c=a.axis,u=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=u;break;case"depth":o[1]=u;break;case"height":o[2]=u;break;case"width-and-depth":o[0]=o[1]=u;break;default:o[0]=o[1]=o[2]=u}}break;case"opacity":n.opacity=l;break;case"rotation":switch(a.axis){case"tilt":n.tilt=l;break;case"roll":n.roll=l;break;default:n.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(n.size=o),n}async function xet(t,e){if(t.symbol!=null)return t.symbol;const i=uk(t,e);return i!=null?i.getSymbolAsync(t,e):null}async function HLt(t,e){const i=uk(t,e),r=await xet(t,e);if(!r)return null;const n={renderer:i,symbol:r};if(!i||!("visualVariables"in i)||!i.visualVariables)return n;const s=kX(i,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of s)if(a.type==="color")n.color=Ye.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")n.outlineSize=l;else{const c=a.axis,u=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=u:c==="depth"?o[1]=u:c==="height"?o[2]=u:o[0]=o[1]=c==="width-and-depth"?u:o[2]=u}else a.type==="opacity"?n.opacity=l:a.type==="rotation"&&a.axis==="tilt"?n.tilt=l:a.type==="rotation"&&a.axis==="roll"?n.roll=l:a.type==="rotation"&&(n.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(n.size=o),n}function Tet(t,e=0){const i=t[e];return typeof i=="number"&&isFinite(i)?i:null}function Eet(t){for(let e=0;e<3;e++){const i=t[e];if(typeof i=="number")return isFinite(i)?i:0}return 0}function Cet(t,e,i,r){const n=(o=>!Array.isArray(o[0]))(e)?(o,a)=>e[3*o+a]:(o,a)=>e[o][a],s=r?ua(r)/FD(r):1;return RW(t,(o,a)=>oe(o,n(a,0)*s,n(a,1)*s,n(a,2)),i)}function m2e(t,e,i){const r=Cet(Gre,t,e,i)?Gre:[0,0,1];return Math.abs(r[2])>Math.cos(Rt(80))?Yr.Z:Math.abs(r[1])>Math.abs(r[0])?Yr.Y:Yr.X}const Gre=Ti();function Aet(t,e,i){const r=m2e(t,(e.length>0?e[0]:t.length/3)-1,i);if(r!==Yr.Z){t=t.slice();for(let n=0;n<t.length;n+=3)t[n+r]=t[n+2]}return gS(t,e,3)}function jre(t){const e=[[O.POSITION,new ke(t.attributeData.position,t.indices,3,!0)]],i=M_(t.indices.length);return t.attributeData.colorFeature!=null?e.push([O.COLORFEATUREATTRIBUTE,new ke([t.attributeData.colorFeature],i,1,!0)]):t.attributeData.color&&e.push([O.COLOR,new ke(t.attributeData.color,i,4,!0)]),t.attributeData.uvMapSpace&&e.push([O.UVMAPSPACE,new ke(t.attributeData.uvMapSpace,t.indices,4,!0)]),t.attributeData.boundingRect&&e.push([O.BOUNDINGRECT,new ke(t.attributeData.boundingRect,t.indices,9,!0)]),new Wn(t.material,e,t.mapPositions,on.Mesh,t.attributeData.objectAndLayerIdColor)}function Hre(t,e=null){const i=[[O.POSITION,new ke(t.attributeData.position,t.indices,3,!0)],[O.UV0,new ke(t.attributeData.uv0,t.indices,2,!0)]];return new Wn(t.material,i,t.mapPositions,on.Mesh,e)}function OO(t){switch(t.type){case"extent":if(t instanceof Xi)return Mf.fromExtent(t);break;case"polygon":return t}return null}let hk=class{constructor(e,i,r){this.renderData=e,this.layerUid=i,this.graphicUid=r,this.outGeometries=new Array}};function nj(t,e,i){const r=Array.isArray(t),n=r?t.length/e:t.byteLength/(4*e),s=r?t:new Uint32Array(t,0,n*e),o=i?.minReduction??0,a=i?.originalIndices||null,l=a?a.length:0,c=i?.componentOffsets||null;let u=0;if(c)for(let A=0;A<c.length-1;A++){const P=c[A+1]-c[A];P>u&&(u=P)}else u=n;const d=Math.floor(1.1*u)+1;(gp==null||gp.length<2*d)&&(gp=new Uint32Array(Qde(2*d)));for(let A=0;A<2*d;A++)gp[A]=0;let p=0;const m=!!c&&!!a,y=m?l:n;let _=IN(n);const v=new Uint32Array(l),w=1.96;let x=o!==0?Math.ceil(4*w*w/(o*o)*o*(1-o)):y,T=1,S=c?c[1]:y;for(let A=0;A<y;A++){if(A===x){const R=1-p/A;if(R+w*Math.sqrt(R*(1-R)/A)<o)return null;x*=2}if(A===S){for(let R=0;R<2*d;R++)gp[R]=0;if(a)for(let R=c[T-1];R<c[T];R++)v[R]=_[a[R]];S=c[++T]}const P=m?a[A]:A,N=P*e,F=Pet(s,N,e);let D=F%d,$=p;for(;gp[2*D+1]!==0;){if(gp[2*D]===F){const R=gp[2*D+1]-1;if(Oet(s,N,R*e,e)){$=_[R];break}}D++,D>=d&&(D-=d)}$===p&&(gp[2*D]=F,gp[2*D+1]=P+1,p++),_[P]=$}if(o!==0&&1-p/n<o)return null;if(m){for(let A=c[T-1];A<v.length;A++)v[A]=_[a[A]];_=Sf(v)}const E=r?new Array(p):new Uint32Array(p*e);p=0;for(let A=0;A<y;A++)_[A]===p&&(Ret(s,(m?a[A]:A)*e,E,p*e,e),p++);if(a&&!m){const A=new Uint32Array(l);for(let P=0;P<A.length;P++)A[P]=_[a[P]];_=Sf(A)}return{buffer:Array.isArray(E)?E:E.buffer,indices:_,uniqueCount:p}}function Oet(t,e,i,r){for(let n=0;n<r;n++)if(t[e+n]!==t[i+n])return!1;return!0}function Ret(t,e,i,r,n){for(let s=0;s<n;s++)i[r+s]=t[e+s]}function Pet(t,e,i){let r=0;for(let n=0;n<i;n++)r=t[e+n]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let gp=null;function WLt(t){const e=jR(t.rings,t.hasZ,kf.CCW_IS_HOLE,t.spatialReference),i=new Array;let r=0,n=0;for(const a of e.polygons){const l=a.count,c=a.index,u=ah(e.position,3*c,3*l),d=a.holeIndices.map(m=>m-c),p=Sf(gS(u,d,3));i.push({position:u,faces:p}),r+=u.length,n+=p.length}const s=Met(i,r,n),o=Array.isArray(s.position)?nj(s.position,3,{originalIndices:s.faces}):nj(s.position.buffer,6,{originalIndices:s.faces});return s.position=A1e(new Float64Array(o.buffer)),s.faces=o.indices,s}function Met(t,e,i){if(t.length===1)return t[0];const r=Vs(e),n=new Array(i);let s=0,o=0,a=0;for(const l of t){for(let c=0;c<l.position.length;c++)r[s++]=l.position[c];for(const c of l.faces)n[o++]=c+a;a=s/3}return{position:r,faces:Sf(n)}}function jR(t,e,i,r){const n=t.length,s=new Array(n),o=new Array(n),a=new Array(n);let l=0,c=0,u=0,d=0;for(let y=0;y<n;++y)d+=t[y].length;const p=Vs(3*d);let m=0;for(let y=n-1;y>=0;y--){const _=t[y],v=i===kf.CCW_IS_HOLE&&$et(_,e,r);if(v&&n!==1)s[l++]=_;else{let w=_.length;for(let T=0;T<l;++T)w+=s[T].length;const x={index:m,pathLengths:new Array(l+1),count:w,holeIndices:new Array(l)};x.pathLengths[0]=_.length,_.length>0&&(a[u++]={index:m,count:_.length}),m=v?WM(_,_.length-1,-1,p,m,_.length,e):WM(_,0,1,p,m,_.length,e);for(let T=0;T<l;++T){const S=s[T];x.holeIndices[T]=m,x.pathLengths[T+1]=S.length,S.length>0&&(a[u++]={index:m,count:S.length}),m=WM(S,0,1,p,m,S.length,e)}l=0,x.count>0&&(o[c++]=x)}}for(let y=0;y<l;++y){const _=s[y];_.length>0&&(a[u++]={index:m,count:_.length}),m=WM(_,0,1,p,m,_.length,e)}return o.length=c,a.length=u,{position:p,polygons:o,outlines:a}}function WM(t,e,i,r,n,s,o){n*=3;for(let a=0;a<s;++a){const l=t[e];r[n++]=l[0],r[n++]=l[1],r[n++]=o?l[2]:0,e+=i}return n/3}function $et(t,e,i){if(e){const r=t.length-1,n=m2e(t,r,i);if(n===Yr.X)return!EI(t,Yr.Y,Yr.Z);if(n===Yr.Y)return!EI(t,Yr.X,Yr.Z)}return!EI(t,Yr.X,Yr.Y)}var kf;(function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(kf||(kf={}));var y3,i5,sj;(function(t){t[t.RasterImage=0]="RasterImage",t[t.Features=1]="Features"})(y3||(y3={})),function(t){t[t.MapLayer=0]="MapLayer",t[t.ViewLayer=1]="ViewLayer",t[t.Outline=2]="Outline",t[t.SnappingHint=3]="SnappingHint"}(i5||(i5={})),function(t){t[t.WithRasterImage=0]="WithRasterImage",t[t.WithoutRasterImage=1]="WithoutRasterImage"}(sj||(sj={}));var zn,eh,_3,ss;(function(t){t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER"})(zn||(zn={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",t[t.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",t[t.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(eh||(eh={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(_3||(_3={})),function(t){t[t.FADING=0]="FADING",t[t.IMMEDIATE=1]="IMMEDIATE",t[t.UNFADED=2]="UNFADED"}(ss||(ss={}));let Iet=class{constructor(e,i){this.vec3=e,this.id=i}};function r5(t,e,i,r){return new Iet(Ce(t,e,i),r)}let qre=class{constructor(){this._extent=Gt(),this.resolution=0,this.renderLocalOrigin=r5(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new Let}get extent(){return this._extent}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const i=.001*e.range;if(this._extent[0]-i<=e.min){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];WD(this._extent,e.range,0,r)}if(this._extent[2]+i>=e.max){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];WD(this._extent,-e.range,0,r)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,xg(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const i=this.canvasGeometries.extents[e];if(i[0]!==i[2]&&i[1]!==i[3])return!0}return!1}},Let=class{constructor(){this.extents=[Gt(),Gt(),Gt()],this.numViews=0}};var $r;(function(t){t[t.Color=0]="Color",t[t.ColorNoRasterImage=1]="ColorNoRasterImage",t[t.Highlight=2]="Highlight",t[t.WaterNormal=3]="WaterNormal",t[t.Occluded=4]="Occluded",t[t.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"})($r||($r={}));let Det=class{constructor(e,i){this._fbos=e,this._format=i}get valid(){return this._handle!=null}dispose(){this._handle=Jt(this._handle)}get texture(){return this._handle?.colorTexture}bind(e,i,r){this._handle&&this._handle.fbo.width===i&&this._handle.fbo.height===r||(this._handle?.release(),this._handle=this._fbos.acquire(this._format,i,r)),e.bindFramebuffer(this._handle?.fbo)}generateMipMap(){this._handle?.colorTexture?.descriptor?.hasMipmap&&this._handle?.colorTexture?.generateMipmap()}},rx=class{constructor(e,i,r,n=hi.RGBA_MIPMAP){this.output=i,this.content=r,this.fbo=new Det(e,n)}get valid(){return this.fbo.valid}},Net=class{constructor(e){this.targets=[new rx(e,U.Color,$r.Color),new rx(e,U.Color,$r.ColorNoRasterImage),new rx(e,U.Highlight,$r.Highlight,hi.RGBA4),new rx(e,U.Normal,$r.WaterNormal),new rx(e,U.Color,$r.Occluded)],ie("enable-feature:objectAndLayerId-rendering")&&this.targets.push(new rx(e,U.ObjectAndLayerIdColor,$r.ObjectAndLayerIdColor))}getTexture(e){return this.targets[e]?.fbo.texture}dispose(){for(const e of this.targets)e.fbo.dispose()}computeValidity(){return this.targets.reduce((e,i,r)=>i.valid?e|=1<<r:e,0)}},zX=class extends Qwe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=C(),this.origin=this.slicePlaneLocalOrigin,this.modelTransformation=null}};var Xl;(function(t){t[t.Material=0]="Material",t[t.ShadowMap=1]="ShadowMap",t[t.Highlight=2]="Highlight"})(Xl||(Xl={}));let Fet=class extends zX{constructor(){super(...arguments),this.identifier=Xl.Material,this.output=U.Color,this.transparent=!1}},ket=class extends zX{constructor(){super(...arguments),this.identifier=Xl.ShadowMap}},Uet=class extends zX{constructor(){super(...arguments),this.identifier=Xl.Highlight}};function zet(t){t.fragment.code.add(b`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function Bet(t){t.fragment.code.add(b`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function Vet(t,e){const i=t.fragment;i.include(vh),i.uniforms.add(new zi("nearFar",(r,n)=>n.camera.nearFar)),i.uniforms.add(new Je("depthMap",(r,n)=>n.linearDepth?.colorTexture)),i.uniforms.add(new Vr("proj",(r,n)=>n.camera.projectionMatrix)),i.uniforms.add(new Oe("invResolutionHeight",(r,n)=>1/n.camera.height)),i.uniforms.add(new Vr("reprojectionMatrix",(r,n)=>n.ssr.reprojectionMatrix)),i.code.add(b`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P = clamp(P + dP, vec2(0.0), vec2(0.999));
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}function g2e(t,e){t.include(SKe,e),t.include(EF),t.include(Bet),e.hasCloudsReflections&&t.include(Ove,e),e.hasScreenSpaceReflections&&t.include(Vet,e);const i=t.fragment;i.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),i.code.add(b`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),i.uniforms.add(new Oe("lightingSpecularStrength",(r,n)=>n.lighting.mainLight.specularStrength),new Oe("lightingEnvironmentStrength",(r,n)=>n.lighting.mainLight.environmentStrength)),i.code.add(b`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),e.hasCloudsReflections&&i.code.add(b`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),e.hasScreenSpaceReflections?(i.uniforms.add(new Vr("view",(r,n)=>n.camera.viewMatrix),new Je("lastFrameColorTexture",(r,n)=>n.ssr.lastFrameColor?.colorTexture),new Oe("fadeFactorSSR",(r,n)=>n.ssr.fadeFactor)),i.code.add(b`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):i.code.add(b`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),e.hasCloudsReflections?e.hasScreenSpaceReflections?i.code.add(b`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):i.code.add(b`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):i.code.add(b`return waterRenderedColor;
}`)}let n5=class extends Qr{constructor(e,i){super(e,"vec4",_i.Draw,(r,n,s)=>r.setUniform4fv(e,i(n,s)))}};var gf;function Get(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add(new n5("overlayTexOffset",(n,s)=>jet(n,s)),new n5("overlayTexScale",(n,s)=>Het(n,s))),r.constants.add("overlayOpacity","float",1),r.uniforms.add(new Je("ovColorTex",(n,s)=>oj(n,s))),y2e(t,e)}function UE(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add(new Wre("overlayTexOffset"),new Wre("overlayTexScale")),r.uniforms.add(new Oe("overlayOpacity",n=>n.overlayOpacity),new Je("ovColorTex",(n,s)=>s.overlay?.getTexture(n.overlayContent))),y2e(t,e)}(function(t){t[t.Disabled=0]="Disabled",t[t.Enabled=1]="Enabled",t[t.EnabledWithWater=2]="EnabledWithWater",t[t.COUNT=3]="COUNT"})(gf||(gf={}));let Wre=class extends Qr{constructor(e){super(e,"vec4")}};function y2e(t,e){e.pbrMode!==it.Water&&e.pbrMode!==it.WaterOnIntegratedMesh&&e.pbrMode!==it.TerrainWithWater||t.include(g2e,e);const{vertex:i,fragment:r}=t;t.varyings.add("vtcOverlay","vec4"),i.code.add(b`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),r.code.add(b`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),r.code.add(b`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),r.code.add(b`vec4 getOverlayColorTexel(vec4 texCoords) {
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y) * texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w) * texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),e.pbrMode!==it.Water&&e.pbrMode!==it.WaterOnIntegratedMesh&&e.pbrMode!==it.TerrainWithWater||(Bg(r),Wf(r),r.code.add(b`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function oj(t,e){return t.identifier===Xl.Material&&t.output===U.Color?e.overlay?.getTexture($r.ColorNoRasterImage):t.identifier===Xl.Material&&t.output===U.ObjectAndLayerIdColor?e.overlay?.getTexture($r.ObjectAndLayerIdColor):t.identifier===Xl.Highlight?e.overlay?.getTexture($r.Highlight):null}function jet(t,e){const i=e.overlay?.overlays[zn.INNER]?.extent;qD(i)&&(uf[0]=t.toMapSpace[0]/ea(i)-i[0]/ea(i),uf[1]=t.toMapSpace[1]/pl(i)-i[1]/pl(i));const r=e.overlay?.overlays[zn.OUTER]?.extent;return qD(r)&&(uf[2]=t.toMapSpace[0]/ea(r)-r[0]/ea(r),uf[3]=t.toMapSpace[1]/pl(r)-r[1]/pl(r)),uf}function Het(t,e){const i=e.overlay?.overlays[zn.INNER]?.extent;qD(i)&&(uf[0]=t.toMapSpace[2]/ea(i),uf[1]=t.toMapSpace[3]/pl(i));const r=e.overlay?.overlays[zn.OUTER]?.extent;return qD(r)&&(uf[2]=t.toMapSpace[2]/ea(r),uf[3]=t.toMapSpace[3]/pl(r)),uf}const uf=Kt();let _2e=class extends Ki{constructor(){super(...arguments),this.color=Mt(1,1,1,1)}};function qet(){const t=new mi;return t.include(ha),t.fragment.uniforms.add(new Je("tex",e=>e.texture),new ai("uColor",e=>e.color)),t.fragment.code.add(b`void main() {
vec4 texColor = texture(tex, uv);
fragColor = texColor * uColor;
}`),t}const Wet=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:_2e,build:qet},Symbol.toStringTag,{value:"Module"}));let v2e=class{constructor(e){this._context=e,this._perConstructorInstances=new XS,this._frameCounter=0,this._keepAliveFrameCount=Yre}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(e=>e.forEach(i=>i.technique.destroy())),this._perConstructorInstances.clear()}acquire(e,i=Xet){const r=i.key;let n=this._perConstructorInstances.get(e,r);if(n==null){const s=new e(this._context,i,()=>this.release(s));n=new Yet(s),this._perConstructorInstances.set(e,r,n)}return++n.refCount,n.technique}releaseAndAcquire(e,i,r){if(r!=null){if(i.key===r.key)return r;this.release(r)}return this.acquire(e,i)}release(e){if(e==null||this._perConstructorInstances.empty)return;const i=this._perConstructorInstances.get(e.constructor,e.key);i!=null&&(--i.refCount,i.refCount===0&&(i.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==Yre&&this._perConstructorInstances.forEach((e,i)=>{e.forEach((r,n)=>{r.refCount===0&&r.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(r.technique.destroy(),this._perConstructorInstances.delete(i,n))})})}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach((i,r)=>{const n=async(s,o)=>{const a=o.shader;a&&(await a.reload(),s.forEach(l=>l.technique.reload(this._context)))};e.push(n(i,r))}),await Promise.all(e)}},Yet=class{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}};const Yre=-1,Xet=new bl;let b2e=class{constructor(e,i,r,n){this._textureRepository=e,this._techniqueRepository=i,this.materialChanged=r,this.requestRender=n,this._id2glMaterialRef=new XS}dispose(){this._textureRepository.destroy()}acquire(e,i,r){if(this._ownMaterial(e),!e.produces(i,r))return null;let n=this._id2glMaterialRef.get(r,e.id);if(n==null){const s=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRepository:this._textureRepository,output:r});n=new Zet(s),this._id2glMaterialRef.set(r,e.id,n)}return n.ref(),n.glMaterial}release(e,i){const r=this._id2glMaterialRef.get(i,e.id);r!=null&&(r.unref(),r.referenced||(et(r.glMaterial),this._id2glMaterialRef.delete(i,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&ne.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},Zet=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,Ke(this._refCnt>=0)}get referenced(){return this._refCnt>0}};const Jet=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","transformationChanged","shaderTransformationChanged","visibilityChanged","occlusionChanged","highlightChanged","geometryAdded","geometryRemoved","attributesChanged"];let aj=class zL{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,i){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new Is,this._objectCount=0,i&&(i.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=i.maximumObjectsPerNode),i.maximumDepth!==void 0&&(this._maximumDepth=i.maximumDepth))}destroy(){this._degenerateObjects.clear(),Is.clearPool(),lj[0]=null,ov.prune(),c1.prune()}add(e,i=e.length){this._objectCount+=i,this._grow(e,i);const r=Is.acquire();for(let n=0;n<i;n++){const s=e[n];this._isDegenerate(s)?this._degenerateObjects.add(s):(r.init(this._root),this._add(s,r))}Is.release(r)}remove(e,i=null){this._objectCount-=e.length;const r=Is.acquire();for(const n of e){const s=i??KT(this.objectToBoundingSphere(n),itt);_A(s[3])?(r.init(this._root),this._remove(n,s,r)):this._degenerateObjects.delete(n)}Is.release(r),this._shrink()}update(e,i){if(!_A(i[3])&&this._isDegenerate(e))return;const r=ttt(e);this.remove(r,i),this.add(r)}forEachAlongRay(e,i,r){const n=pu(e,i);this._forEachNode(this._root,s=>{if(!this._intersectsNode(n,s))return!1;const o=s.node;return o.terminals.forAll(a=>{this._intersectsObject(n,a)&&r(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(n,a)&&r(a)}),!0})}forEachAlongRayWithVerticalOffset(e,i,r,n){const s=pu(e,i);this._forEachNode(this._root,o=>{if(!this._intersectsNodeWithOffset(s,o,n))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(s,l,n)&&r(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(s,l,n)&&r(l)}),!0})}forEach(e){this._forEachNode(this._root,i=>{const r=i.node;return r.terminals.forAll(e),r.residents!==null&&r.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,i,r,n=()=>!0,s=1/0){let o=1/0,a=1/0,l=null;const c=JU(e,i),u=d=>{if(--s,!n(d))return;const p=this.objectToBoundingSphere(d);if(!Uy(r,p))return;const m=_y(e,i,p),y=m-p[3],_=m+p[3];y<o&&(o=y,a=_,l=d)};return this._forEachNodeDepthOrdered(this._root,d=>{if(s<=0||!Uy(r,d.bounds)||(te(Au,c,d.halfSize),ce(Au,Au,d.bounds),_y(e,i,Au)>a))return!1;const p=d.node;return p.terminals.forAll(m=>u(m)),p.residents!==null&&p.residents.forAll(m=>u(m)),!0},e,i),l}forEachInDepthRange(e,i,r,n,s,o,a){let l=-1/0,c=1/0;const u={setRange:_=>{r===zL.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,_.near),c=Math.min(c,_.far)):(l=Math.max(l,-_.far),c=Math.min(c,-_.near))}};u.setRange(n);const d=_y(i,r,e),p=JU(i,r),m=JU(i,-r),y=_=>{if(!a(_))return;const v=this.objectToBoundingSphere(_),w=v,x=_y(i,r,w)-d,T=x-v[3],S=x+v[3];T>c||S<l||!Uy(o,v)||s(_,u)};this._forEachNodeDepthOrdered(this._root,_=>{if(!Uy(o,_.bounds)||(te(Au,p,_.halfSize),ce(Au,Au,_.bounds),_y(i,r,Au)-d>c)||(te(Au,m,_.halfSize),ce(Au,Au,_.bounds),_y(i,r,Au)-d<l))return!1;const v=_.node;return v.terminals.forAll(w=>y(w)),v.residents!==null&&v.residents.forAll(w=>y(w)),!0},i,r)}forEachNode(e){this._forEachNode(this._root,i=>e(i.node,i.bounds,i.halfSize,i.depth))}forEachNeighbor(e,i){const r=ag(i),n=i,s=l=>{const c=this.objectToBoundingSphere(l),u=ag(c),d=r+u;return!(bs(c,n)-d*d<=0)||e(l)};let o=!0;const a=l=>{o&&(o=s(l))};this._forEachNode(this._root,l=>{const c=ag(l.bounds),u=r+c;if(bs(l.bounds,n)-u*u>0)return!1;const d=l.node;return d.terminals.forAll(a),o&&d.residents!==null&&d.residents.forAll(a),o}),o&&this.forEachDegenerateObject(a)}_intersectsNode(e,i){return YM(i.bounds,2*-i.halfSize,Uc),YM(i.bounds,2*i.halfSize,zc),rte(e.origin,e.direction,Uc,zc)}_intersectsNodeWithOffset(e,i,r){return YM(i.bounds,2*-i.halfSize,Uc),YM(i.bounds,2*i.halfSize,zc),r.applyToMinMax(Uc,zc),rte(e.origin,e.direction,Uc,zc)}_intersectsObject(e,i){const r=this.objectToBoundingSphere(i);return!(r[3]>0)||ZV(r,e)}_intersectsObjectWithOffset(e,i,r){const n=this.objectToBoundingSphere(i);return!(n[3]>0)||ZV(r.applyToBoundingSphere(n),e)}_forEachNode(e,i){let r=Is.acquire().init(e);const n=[r];for(;n.length!==0;){if(r=n.pop(),i(r)&&!r.isLeaf())for(let s=0;s<r.node.children.length;s++)r.node.children[s]&&n.push(Is.acquire().init(r).advance(s));Is.release(r)}}_forEachNodeDepthOrdered(e,i,r,n=zL.DepthOrder.FRONT_TO_BACK){let s=Is.acquire().init(e);const o=[s];for(ett(r,n,Jre);o.length!==0;){if(s=o.pop(),i(s)&&!s.isLeaf())for(let a=7;a>=0;--a){const l=Jre[a];s.node.children[l]&&o.push(Is.acquire().init(s).advance(l))}Is.release(s)}}_remove(e,i,r){ov.clear();const n=r.advanceTo(i,(s,o)=>{ov.push(s.node),ov.push(o)})?r.node.terminals:r.node.residents;if(n.removeUnordered(e),n.length===0)for(let s=ov.length-2;s>=0;s-=2){const o=ov.data[s],a=ov.data[s+1];if(!this._purge(o,a))break}}_nodeIsEmpty(e){if(e.terminals.length!==0)return!1;if(e.residents!==null)return e.residents.length===0;for(let i=0;i<e.children.length;i++)if(e.children[i])return!1;return!0}_purge(e,i){return i>=0&&(e.children[i]=null),!!this._nodeIsEmpty(e)&&(e.residents===null&&(e.residents=new It({shrink:!0})),!0)}_add(e,i){i.advanceTo(this.objectToBoundingSphere(e))?i.node.terminals.push(e):(i.node.residents.push(e),i.node.residents.length>this._maximumObjectsPerNode&&i.depth<this._maximumDepth&&this._split(i))}_split(e){const i=e.node.residents;e.node.residents=null;for(let r=0;r<i.length;r++){const n=Is.acquire().init(e);this._add(i.at(r),n),Is.release(n)}}_grow(e,i){if(i!==0&&(Xre(e,i,r=>this.objectToBoundingSphere(r),cm),_A(cm[3])&&!this._fitsInsideTree(cm)))if(this._nodeIsEmpty(this._root.node))KT(cm,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const r=this._rootBoundsForRootAsSubNode(cm);this._placingRootViolatesMaxDepth(r)?this._rebuildTree(cm,r):this._growRootAsSubNode(r),Is.release(r)}}_rebuildTree(e,i){se(QU,i.bounds),QU[3]=i.halfSize,Xre([e,QU],2,n=>n,e8);const r=Is.acquire().init(this._root);this._root.initFrom(null,e8,e8[3]),this._root.increaseHalfSize(1.25),this._forEachNode(r,n=>(this.add(n.node.terminals.data,n.node.terminals.length),n.node.residents!==null&&this.add(n.node.residents.data,n.node.residents.length),!0)),Is.release(r)}_placingRootViolatesMaxDepth(e){const i=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let r=0;return this._forEachNode(this._root,n=>(r=Math.max(r,n.depth),r+i<=this._maximumDepth)),r+i>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const i=e[3],r=e;let n=-1/0;const s=this._root.bounds,o=this._root.halfSize;for(let l=0;l<3;l++){const c=s[l]-o-(r[l]-i),u=r[l]+i-(s[l]+o),d=Math.max(0,Math.ceil(c/(2*o))),p=Math.max(0,Math.ceil(u/(2*o)))+1,m=2**Math.ceil(Math.log(d+p)*Math.LOG2E);n=Math.max(n,m),XM[l].min=d,XM[l].max=p}for(let l=0;l<3;l++){let c=XM[l].min,u=XM[l].max;const d=(n-(c+u))/2;c+=Math.ceil(d),u+=Math.floor(d);const p=s[l]-o-c*o*2;KU[l]=p+(u+c)*o}const a=n*o;return KU[3]=a*x2e,Is.acquire().initFrom(null,KU,a,0)}_growRootAsSubNode(e){const i=this._root.node;se(cm,this._root.bounds),cm[3]=this._root.halfSize,this._root.init(e),e.advanceTo(cm,null,!0),e.node.children=i.children,e.node.residents=i.residents,e.node.terminals=i.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(e===-1)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let e=null;const i=this._root.node.children;let r=0,n=0;for(;n<i.length&&e==null;)r=n++,e=i[r];for(;n<i.length;)if(i[n++])return-1;return r}_isDegenerate(e){return!_A(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const i=this._root.bounds,r=this._root.halfSize;return e[3]<=r&&e[0]>=i[0]-r&&e[0]<=i[0]+r&&e[1]>=i[1]-r&&e[1]<=i[1]+r&&e[2]>=i[2]-r&&e[2]<=i[2]+r}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:i,_objectCount:r}=this,n=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:i,objectCount:r,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:n}}}_nodeToJSON(e){const i=e.children.map(s=>s?this._nodeToJSON(s):null),r=e.residents?.map(s=>this.objectToBoundingSphere(s)),n=e.terminals?.map(s=>this.objectToBoundingSphere(s));return{children:i,residents:r,terminals:n}}static fromJSON(e){const i=new zL(r=>r,{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return i._objectCount=e.objectCount,i._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),i}},Is=class p2{constructor(){this.bounds=xn(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,i,r,n=this.depth){return this.node=e??p2.createEmptyNode(),i!=null&&KT(i,this.bounds),this.halfSize=r,this.depth=n,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*x2e}advance(e){let i=this.node.children[e];i||(i=p2.createEmptyNode(),this.node.children[e]=i),this.node=i,this.halfSize/=2,this.depth++;const r=w2e[e];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,i,r=!1){for(;;){if(this.isTerminalFor(e))return i&&i(this,-1),!0;if(this.isLeaf()){if(!r)return i&&i(this,-1),!1;this.node.residents=null}const n=this._childIndex(e);i&&i(this,n),this.advance(n)}}isLeaf(){return this.node.residents!=null}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const i=this.bounds;return(i[0]<e[0]?1:0)+(i[1]<e[1]?2:0)+(i[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new It({shrink:!0}),residents:new It({shrink:!0})}}static acquire(){return p2._pool.acquire()}static release(e){p2._pool.release(e)}static clearPool(){p2._pool.prune()}};function Ket(t,e){t[0]=Math.min(t[0],e[0]-e[3]),t[1]=Math.min(t[1],e[1]-e[3]),t[2]=Math.min(t[2],e[2]-e[3])}function Qet(t,e){t[0]=Math.max(t[0],e[0]+e[3]),t[1]=Math.max(t[1],e[1]+e[3]),t[2]=Math.max(t[2],e[2]+e[3])}function YM(t,e,i){i[0]=t[0]+e,i[1]=t[1]+e,i[2]=t[2]+e}function Xre(t,e,i,r){if(e===1){const n=i(t[0]);KT(n,r)}else{Uc[0]=1/0,Uc[1]=1/0,Uc[2]=1/0,zc[0]=-1/0,zc[1]=-1/0,zc[2]=-1/0;for(let n=0;n<e;n++){const s=i(t[n]);_A(s[3])&&(Ket(Uc,s),Qet(zc,s))}Ui(r,Uc,zc,.5),r[3]=Math.max(zc[0]-Uc[0],zc[1]-Uc[1],zc[2]-Uc[2])/2}}function ett(t,e,i){if(!c1.length)for(let r=0;r<8;++r)c1.push({index:0,distance:0});for(let r=0;r<8;++r){const n=w2e[r];c1.data[r].index=r,c1.data[r].distance=_y(t,e,n)}c1.sort((r,n)=>r.distance-n.distance);for(let r=0;r<8;++r)i[r]=c1.data[r].index}function JU(t,e){let i,r=1/0;for(let n=0;n<8;++n){const s=_y(t,e,Zre[n]);s<r&&(r=s,i=Zre[n])}return i}function _y(t,e,i){return e*(t[0]*i[0]+t[1]*i[1]+t[2]*i[2])}function _A(t){return!isNaN(t)&&t!==-1/0&&t!==1/0&&t>0}Is._pool=new aa(Is),function(t){var e;(e=t.DepthOrder||(t.DepthOrder={}))[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(aj||(aj={}));const w2e=[Ce(-1,-1,-1),Ce(1,-1,-1),Ce(-1,1,-1),Ce(1,1,-1),Ce(-1,-1,1),Ce(1,-1,1),Ce(-1,1,1),Ce(1,1,1)],Zre=[Ce(-1,-1,-1),Ce(-1,-1,1),Ce(-1,1,-1),Ce(-1,1,1),Ce(1,-1,-1),Ce(1,-1,1),Ce(1,1,-1),Ce(1,1,1)],x2e=Math.sqrt(3),lj=[null];function ttt(t){return lj[0]=t,lj}const KU=xn(),Au=C(),Uc=C(),zc=C(),ov=new It,itt=xn(),cm=xn(),QU=xn(),e8=xn(),XM=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],c1=new It,Jre=[0,0,0,0,0,0,0,0],$d=aj;var Xy;(function(t){t[t.ASYNC=0]="ASYNC",t[t.SYNC=1]="SYNC"})(Xy||(Xy={}));let T2e=class extends PR{get objects(){return this._objects}constructor(e,i,r=""){super(),this.stage=e,this.apiLayerUid=r,this.type=on.Layer,this.events=new Tn,this.visible=!0,this.pickable=!0,this.sliceable=!1,this._objects=new It,this._objectsAdded=new It,this._handles=new Dg,this.apiLayerUid=r,this.visible=i?.visible??!0,this.pickable=i?.pickable??!0,this.updatePolicy=i?.updatePolicy??Xy.ASYNC,this._disableOctree=i?.disableOctree??!1,e.add(this);for(const n of Jet)this._handles.add(this.events.on(n,s=>e.handleEvent(n,s)))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),this._octree!=null&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),this._octree!=null&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const i of e)i.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),this._octree!=null&&this._objectsAdded.pushArray(e)}removeMany(e){const i=new Array;if(this._objects.removeUnorderedMany(e,e.length,i),i.length!==0){for(const r of i)r.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:i}),this._octree!=null){for(let r=0;r<i.length;)this._objectsAdded.removeUnordered(i[r])?(i[r]=i[i.length-1],i.length-=1):++r;this._octree.remove(i)}}}sync(){this.updatePolicy!==Xy.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,i){this._octree==null||this._objectsAdded.includes(e)||this._octree.update(e,i)}getSpatialQueryAccelerator(){return this._octree==null&&this._objects.length>50&&!this._disableOctree?(this._octree=new $d(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):this._octree!=null&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}invalidateSpatialQueryAccelerator(){this._octree=Pe(this._octree),this._objectsAdded.clear()}};function s5(t){return t!=null&&t.type===on.Layer}var ou,Hb;(function(t){t[t.Draped=0]="Draped",t[t.Screen=1]="Screen",t[t.World=2]="World",t[t.COUNT=3]="COUNT"})(ou||(ou={})),function(t){t[t.Center=0]="Center",t[t.Tip=1]="Tip",t[t.COUNT=2]="COUNT"}(Hb||(Hb={}));let Ps=class extends Ua{constructor(){super(...arguments),this.output=U.Color,this.transparencyPassType=Qe.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=ou.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=Hb.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}get draped(){return this.space===ou.Draped}};h([V({count:U.COUNT})],Ps.prototype,"output",void 0),h([V({count:Qe.COUNT})],Ps.prototype,"transparencyPassType",void 0),h([V()],Ps.prototype,"occluder",void 0),h([V()],Ps.prototype,"hasSlicePlane",void 0),h([V()],Ps.prototype,"writeDepth",void 0),h([V({count:ou.COUNT})],Ps.prototype,"space",void 0),h([V()],Ps.prototype,"hideOnShortSegments",void 0),h([V()],Ps.prototype,"hasCap",void 0),h([V({count:Hb.COUNT})],Ps.prototype,"anchor",void 0),h([V()],Ps.prototype,"hasTip",void 0),h([V()],Ps.prototype,"vvSize",void 0),h([V()],Ps.prototype,"vvColor",void 0),h([V()],Ps.prototype,"vvOpacity",void 0),h([V()],Ps.prototype,"hasOccludees",void 0),h([V()],Ps.prototype,"multipassEnabled",void 0),h([V()],Ps.prototype,"cullAboveGround",void 0),h([V({constValue:!1})],Ps.prototype,"occlusionPass",void 0),h([V({constValue:!0})],Ps.prototype,"hasVvInstancing",void 0),h([V({constValue:!0})],Ps.prototype,"hasSliceTranslatedView",void 0);const Kre=8;function S2e(t,e){const i=t.vertex;i.uniforms.add(new Oe("intrinsicWidth",r=>r.width)),e.vvSize?(t.attributes.add(O.SIZEFEATUREATTRIBUTE,"float"),i.uniforms.add(new $t("vvSizeMinSize",r=>r.vvSize.minSize),new $t("vvSizeMaxSize",r=>r.vvSize.maxSize),new $t("vvSizeOffset",r=>r.vvSize.offset),new $t("vvSizeFactor",r=>r.vvSize.factor)),i.code.add(b`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(t.attributes.add(O.SIZE,"float"),i.code.add(b`float getSize(){
return intrinsicWidth * size;
}`)),e.vvOpacity?(t.attributes.add(O.OPACITYFEATUREATTRIBUTE,"float"),i.constants.add("vvOpacityNumber","int",8),i.uniforms.add(new hl("vvOpacityValues",r=>r.vvOpacity.values,Kre),new hl("vvOpacityOpacities",r=>r.vvOpacity.opacityValues,Kre)),i.code.add(b`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):i.code.add(b`vec4 applyOpacity( vec4 color ){
return color;
}`),e.vvColor?(t.include(hg,e),t.attributes.add(O.COLORFEATUREATTRIBUTE,"float"),i.code.add(b`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(t.attributes.add(O.COLOR,"vec4"),i.code.add(b`vec4 getColor(){
return applyOpacity(color);
}`))}function RO(t,e,i=0){const r=_e(t,0,stt);for(let n=0;n<4;n++)e[i+n]=Math.floor(256*ott(r*rtt[n]))}function BX(t,e=0){let i=0;for(let r=0;r<4;r++)i+=t[e+r]*ntt[r];return i}const rtt=[1,256,65536,16777216],ntt=[1/256,1/65536,1/16777216,1/4294967296],stt=BX(new Uint8ClampedArray([255,255,255,255]));function ott(t){return t-Math.floor(t)}let E2e=class{constructor(e,i,r){this._createTexture=e,this._parametersKey=i,this._repository=new Map,this._orphanCache=r.newCache(`procedural-texture-repository:${Kc()}`,n=>n.dispose())}destroy(){for(const[e,{texture:i}]of this._repository)i.dispose();this._repository.clear(),this._orphanCache.destroy()}swap(e,i=null){const r=this._acquire(e);return this.release(i),r}release(e){if(e==null)return;const i=this._parametersKey(e),r=this._repository.get(i);if(r&&(r.refCount--,r.refCount===0)){this._repository.delete(i);const{texture:n}=r,s=n.gpuMemoryUsage;this._orphanCache.put(i,n,s)}}_acquire(e){if(e==null)return null;const i=this._parametersKey(e),r=this._repository.get(i);if(r)return r.refCount++,r.texture;const n=this._orphanCache.pop(i)??this._createTexture(e),s=new att(n);return this._repository.set(i,s),n}},att=class{constructor(e){this.texture=e,this.refCount=1}};function ltt(t,e){return new E2e(i=>{const{encodedData:r,textureSize:n}=ctt(i),s=new Li;return s.internalFormat=pt.RGBA,s.width=n,s.height=1,s.wrapMode=Nt.REPEAT,new Pt(t,s,r)},i=>`${i.pattern.join(",")}-r${i.pixelRatio}`,e)}function ctt(t){const e=VX(t),i=1/t.pixelRatio,r=C2e(t),n=A2e(t),s=(Math.floor(.5*(n-1))+.5)*i,o=[];let a=1;for(const p of e){for(let m=0;m<p;m++){const y=a*(Math.min(m,p-1-m)+.5)*i/s*.5+.5;o.push(y)}a=-a}const l=Math.round(e[0]/2),c=[...o.slice(l),...o.slice(0,l)],u=new Uint8Array(4*r);let d=0;for(const p of c)RO(p,u,d),d+=4;return{encodedData:u,textureSize:r}}function VX(t){return t.pattern.map(e=>Math.round(e*t.pixelRatio))}function C2e(t){if(t==null)return 1;const e=VX(t);return Math.floor(e.reduce((i,r)=>i+r))}function A2e(t){return VX(t).reduce((e,i)=>Math.max(e,i))}function utt(t){return t==null?ru:t.length===4?t:Mr(htt,t[0],t[1],t[2],1)}const htt=Kt();function dtt(t,e){t.constants.add("stippleAlphaColorDiscard","float",.001),t.constants.add("stippleAlphaHighlightDiscard","float",.5),e.stippleEnabled?ptt(t,e):ftt(t)}function ptt(t,e){const i=!(e.draped&&e.stipplePreferContinuous),{vertex:r,fragment:n}=t;n.include(Eh),e.draped||(Xd(r,e),r.uniforms.add(new Oe("worldToScreenPerDistanceRatio",(s,o)=>1/o.camera.perScreenPixelRatio)),r.code.add(b`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),t.varyings.add("vStippleDistance","float"),t.varyings.add("vStippleDistanceLimits","vec2"),t.varyings.add("vStipplePatternStretch","float"),r.code.add(b`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${gtt};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),r.code.add(b`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),r.code.add(b`
    if (segmentLengthPseudoScreen >= ${i?"patternLength":"1e4"}) {
  `),HS(r),r.code.add(b`float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
float segmentLengthScreenRounded = flooredRepetitions * patternLength;
float stretch = repetitions / flooredRepetitions;
vStipplePatternStretch = max(0.75, stretch);
return vec2(0.0, segmentLengthScreenRounded);
}
return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
}`),n.uniforms.add(new Je("stipplePatternTexture",s=>s.stippleTexture),new Oe("stipplePatternSDFNormalizer",s=>mtt(s.stipplePattern)),new Oe("stipplePatternPixelSizeInv",s=>1/O2e(s))),n.code.add(b`float getStippleSDF(out bool isClamped) {
float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;
float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv * vLineSizeInv;
u = fract(u);
float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;
return (sdf - 0.5) * vStipplePatternStretch + 0.5;
}
float getStippleSDF() {
bool ignored;
return getStippleSDF(ignored);
}
float getStippleAlpha() {
bool isClamped;
float stippleSDF = getStippleSDF(isClamped);
float antiAliasedResult = clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);
return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
}`),e.stippleOffColorEnabled?(n.uniforms.add(new ai("stippleOffColor",s=>utt(s.stippleOffColor))),n.code.add(b`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):n.code.add(b`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function ftt(t){t.fragment.code.add(b`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}function mtt(t){return t?(Math.floor(.5*(A2e(t)-1))+.5)/t.pixelRatio:1}function O2e(t){const e=t.stipplePattern;return e?C2e(t.stipplePattern)/e.pixelRatio:1}const gtt=b.float(.4);async function $g(t,e){const{data:i}=await Ii(t,{responseType:"image",...e});return i}function ytt(){if(t8==null){const t=e=>lr(`esri/libs/basisu/${e}`);t8=pe(()=>import("./basis_transcoder-0fc65a21.js"),[],import.meta.url).then(e=>e.b).then(({default:e})=>e({locateFile:t}).then(i=>(i.initializeBasis(),delete i.then,i)))}return t8}let t8;var P1;(function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"})(P1||(P1={}));let Bd=null,ZM=null;async function R2e(){return ZM==null&&(ZM=ytt(),Bd=await ZM),ZM}function _tt(t,e){if(Bd==null)return t.byteLength;const i=new Bd.BasisFile(new Uint8Array(t)),r=M2e(i)?P2e(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),e):0;return i.close(),i.delete(),r}function vtt(t,e){if(Bd==null)return t.byteLength;const i=new Bd.KTX2File(new Uint8Array(t)),r=$2e(i)?P2e(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),e):0;return i.close(),i.delete(),r}function P2e(t,e,i,r,n){const s=fY(e?fn.COMPRESSED_RGBA8_ETC2_EAC:fn.COMPRESSED_RGB8_ETC2),o=n&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(i*r*s*o)}function M2e(t){return t.getNumImages()>=1&&!t.isUASTC()}function $2e(t){return t.getFaces()>=1&&t.isETC1S()}async function btt(t,e,i){Bd==null&&(Bd=await R2e());const r=new Bd.BasisFile(new Uint8Array(i));if(!M2e(r))return null;r.startTranscoding();const n=I2e(t,e,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),(s,o)=>r.getImageTranscodedSizeInBytes(0,s,o),(s,o,a)=>r.transcodeImage(a,0,s,o,0,0));return r.close(),r.delete(),n}async function wtt(t,e,i){Bd==null&&(Bd=await R2e());const r=new Bd.KTX2File(new Uint8Array(i));if(!$2e(r))return null;r.startTranscoding();const n=I2e(t,e,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),(s,o)=>r.getImageTranscodedSizeInBytes(s,0,0,o),(s,o,a)=>r.transcodeImage(a,s,0,0,o,0,-1,-1));return r.close(),r.delete(),n}function I2e(t,e,i,r,n,s,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=t.capabilities,[u,d]=l?r?[P1.ETC2_RGBA,fn.COMPRESSED_RGBA8_ETC2_EAC]:[P1.ETC1_RGB,fn.COMPRESSED_RGB8_ETC2]:c?r?[P1.BC3_RGBA,fn.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[P1.BC1_RGB,fn.COMPRESSED_RGB_S3TC_DXT1_EXT]:[P1.RGBA32,pt.RGBA],p=e.hasMipmap?i:Math.min(1,i),m=[];for(let y=0;y<p;y++)m.push(new Uint8Array(o(y,u))),a(y,u,m[y]);return e.internalFormat=d,e.hasMipmap=m.length>1,e.samplingMode=e.hasMipmap?Lt.LINEAR_MIPMAP_LINEAR:Lt.LINEAR,e.width=n,e.height=s,new Pt(t,e,{type:"compressed",levels:m})}const JM=ne.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),xtt=542327876,Ttt=131072,Stt=4;function GX(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function Ett(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}const Ctt=GX("DXT1"),Att=GX("DXT3"),Ott=GX("DXT5"),Rtt=31,Ptt=0,Mtt=1,$tt=2,Itt=3,Ltt=4,Dtt=7,Ntt=20,Ftt=21;function ktt(t,e,i){const r=Utt(i,e.hasMipmap??!1);if(r==null)throw new Error("DDS texture data is null");const{textureData:n,internalFormat:s,width:o,height:a}=r;return e.samplingMode=n.levels.length>1?Lt.LINEAR_MIPMAP_LINEAR:Lt.LINEAR,e.hasMipmap=n.levels.length>1,e.internalFormat=s,e.width=o,e.height=a,new Pt(t,e,n)}function Utt(t,e){const i=new Int32Array(t,0,Rtt);if(i[Ptt]!==xtt)return JM.error("Invalid magic number in DDS header"),null;if(!(i[Ntt]&Stt))return JM.error("Unsupported format, must contain a FourCC code"),null;const r=i[Ftt];let n,s;switch(r){case Ctt:n=8,s=fn.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case Att:n=16,s=fn.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case Ott:n=16,s=fn.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return JM.error("Unsupported FourCC code:",Ett(r)),null}let o=1,a=i[Ltt],l=i[Itt];!(3&a)&&!(3&l)||(JM.warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,u=l;let d,p;i[$tt]&Ttt&&e!==!1&&(o=Math.max(1,i[Dtt]));let m=i[Mtt]+4;const y=[];for(let _=0;_<o;++_)p=(a+3>>2)*(l+3>>2)*n,d=new Uint8Array(t,m,p),y.push(d),m+=p,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:y},internalFormat:s,width:c,height:u}}let yw=class extends PR{get parameters(){return this._parameters}constructor(e,i){super(),this._data=e,this.type=on.Texture,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this.events=new Tn,this._parameters={...Btt,...i},this._startPreload(e)}dispose(){this.unload(),this._data=this.frameUpdate=void 0}_startPreload(e){e!=null&&(e instanceof HTMLVideoElement?(this.frameUpdate=i=>this._frameUpdate(e,i),this._startPreloadVideoElement(e)):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(q3(e.src)||e.preload==="auto"&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const i=!e.paused;if(e.src=e.src,i&&e.autoplay){const r=()=>{e.removeEventListener("canplay",r),e.play()};e.addEventListener("canplay",r)}}}_startPreloadImageElement(e){Bf(e.src)||q3(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}_createDescriptor(e){const i=new Li;return i.wrapMode=this._parameters.wrap??Nt.REPEAT,i.flipped=!this._parameters.noUnpackFlip,i.samplingMode=this._parameters.mipmap?Lt.LINEAR_MIPMAP_LINEAR:Lt.LINEAR,i.hasMipmap=!!this._parameters.mipmap,i.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha,i.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?e.parameters.maxMaxAnisotropy:1),i}get glTexture(){return this._glTexture}get memoryEstimate(){return this._glTexture?.gpuMemoryUsage||ztt(this._data,this._parameters)}load(e){if(this._glTexture)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const i=this._data;return i==null?(this._glTexture=new Pt(e,this._createDescriptor(e),null),this._glTexture):(this._parameters.reloadable||(this._data=void 0),typeof i=="string"?this._loadFromURL(e,i):i instanceof Image?this._loadFromImageElement(e,i):i instanceof HTMLVideoElement?this._loadFromVideoElement(e,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this._loadFromImage(e,i):(pC(i)||Cy(i))&&this._parameters.encoding===lg.DDS_ENCODING?this._loadFromDDSData(e,i):(pC(i)||Cy(i))&&this._parameters.encoding===lg.KTX2_ENCODING?this._loadFromKTX2(e,i):(pC(i)||Cy(i))&&this._parameters.encoding===lg.BASIS_ENCODING?this._loadFromBasis(e,i):Cy(i)?this._loadFromPixelData(e,i):pC(i)?this._loadFromPixelData(e,new Uint8Array(i)):null)}_frameUpdate(e,i){return this._glTexture==null||e.readyState<v3.HAVE_CURRENT_DATA||i===e.currentTime?i:(this._glTexture.setData(e),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this._parameters.updateCallback&&this._parameters.updateCallback(),e.currentTime)}_loadFromDDSData(e,i){return this._glTexture=ktt(e,this._createDescriptor(e),i),this._glTexture}_loadFromKTX2(e,i){return this._loadAsync(()=>wtt(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromBasis(e,i){return this._loadAsync(()=>btt(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromPixelData(e,i){Ke(this._parameters.width>0&&this._parameters.height>0);const r=this._createDescriptor(e);return r.pixelFormat=this._parameters.components===1?pt.LUMINANCE:this._parameters.components===3?pt.RGB:pt.RGBA,r.width=this._parameters.width??0,r.height=this._parameters.height??0,this._glTexture=new Pt(e,r,i),this._glTexture}_loadFromURL(e,i){return this._loadAsync(async r=>{const n=await $g(i,{signal:r});return Et(r),this._loadFromImage(e,n)})}_loadFromImageElement(e,i){return i.complete?this._loadFromImage(e,i):this._loadAsync(async r=>{const n=await sde(i,i.src,!1,r);return Et(r),this._loadFromImage(e,n)})}_loadFromVideoElement(e,i){return i.readyState>=v3.HAVE_CURRENT_DATA?this._loadFromImage(e,i):this._loadFromVideoElementAsync(e,i)}_loadFromVideoElementAsync(e,i){return this._loadAsync(r=>new Promise((n,s)=>{const o=()=>{i.removeEventListener("loadeddata",a),i.removeEventListener("error",l),pr(c)},a=()=>{i.readyState>=v3.HAVE_CURRENT_DATA&&(o(),n(this._loadFromImage(e,i)))},l=u=>{o(),s(u||new W("Failed to load video"))};i.addEventListener("loadeddata",a),i.addEventListener("error",l);const c=os(r,()=>l(pi()))}))}_loadFromImage(e,i){let r=i;if(!(r instanceof HTMLVideoElement)){const{maxTextureSize:o}=e.parameters;r=this._parameters.downsampleUncompressed?LGe(r,o):DGe(r,o)}const n=L2e(r);this._parameters.width=n.width,this._parameters.height=n.height;const s=this._createDescriptor(e);return s.pixelFormat=this._parameters.components===3?pt.RGB:pt.RGBA,s.width=n.width,s.height=n.height,this._glTexture=new Pt(e,s,r),this._glTexture}_loadAsync(e){const i=new AbortController;this._loadingController=i;const r=e(i.signal);this._loadingPromise=r;const n=()=>{this._loadingController===i&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null)};return r.then(n,n),r}unload(){if(this._glTexture=et(this._glTexture),this._loadingController!=null){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}};function ztt(t,e){if(t==null)return 0;if(pC(t)||Cy(t))return e.encoding===lg.KTX2_ENCODING?vtt(t,!!e.mipmap):e.encoding===lg.BASIS_ENCODING?_tt(t,!!e.mipmap):t.byteLength;const{width:i,height:r}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?L2e(t):e;return(e.mipmap?4/3:1)*i*r*(e.components||4)||0}function L2e(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}var v3;(function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(v3||(v3={}));const Btt={wrap:{s:Nt.REPEAT,t:Nt.REPEAT},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1,downsampleUncompressed:!1},o5=128,jX=.5;function Vtt(t){return t==="cross"||t==="x"}function Gtt(t,e=o5,i=e*jX,r=0){const n=D2e(t,e,i,r);return new yw(n,{mipmap:!1,wrap:{s:Nt.CLAMP_TO_EDGE,t:Nt.CLAMP_TO_EDGE},width:e,height:e,components:4,noUnpackFlip:!0,reloadable:!0})}function D2e(t,e=o5,i=e*jX,r=0){switch(t){case"circle":default:return jtt(e,i);case"square":return Htt(e,i);case"cross":return Wtt(e,i,r);case"x":return Ytt(e,i,r);case"kite":return qtt(e,i);case"triangle":return Xtt(e,i);case"arrow":return Ztt(e,i)}}function jtt(t,e){const i=t/2-.5;return HR(t,k2e(i,i,e/2))}function Htt(t,e){return N2e(t,e,!1)}function qtt(t,e){return N2e(t,e,!0)}function Wtt(t,e,i=0){return F2e(t,e,!1,i)}function Ytt(t,e,i=0){return F2e(t,e,!0,i)}function Xtt(t,e){return HR(t,U2e(t/2,e,e/2))}function Ztt(t,e){const i=e,r=e/2,n=t/2,s=.8*i,o=k2e(n,(t-e)/2-s,Math.sqrt(s*s+r*r)),a=U2e(n,i,r);return HR(t,(l,c)=>Math.max(a(l,c),-o(l,c)))}function N2e(t,e,i){return i&&(e/=Math.SQRT2),HR(t,(r,n)=>{let s=r-.5*t+.25,o=.5*t-n-.75;if(i){const a=(s+o)/Math.SQRT2;o=(o-s)/Math.SQRT2,s=a}return Math.max(Math.abs(s),Math.abs(o))-.5*e})}function F2e(t,e,i,r=0){e-=r,i&&(e*=Math.SQRT2);const n=.5*e;return HR(t,(s,o)=>{let a,l=s-.5*t,c=.5*t-o-1;if(i){const u=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=u}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>n?Math.sqrt((l-n)*(l-n)+c*c):c:c>n?Math.sqrt(l*l+(c-n)*(c-n)):l,a-=r/2,a})}function k2e(t,e,i){return(r,n)=>{const s=r-t,o=n-e;return Math.sqrt(s*s+o*o)-i}}function U2e(t,e,i){const r=Math.sqrt(e*e+i*i);return(n,s)=>{const o=Math.abs(n-t)-i,a=s-t+e/2+.75,l=(e*o+i*a)/r,c=-a;return Math.max(l,c)}}function HR(t,e){const i=new Uint8Array(4*t*t);for(let r=0;r<t;r++)for(let n=0;n<t;n++){const s=n+t*r;let o=e(n,r);o=o/t+.5,RO(o,i,4*s)}return i}const lb=64,HX=lb/2,z2e=HX/5,Jtt=lb/z2e,Ktt=.25;function Qtt(t,e){const i=D2e(t,lb,HX,z2e),r=new Li;return r.internalFormat=pt.RGBA,r.width=lb,r.height=lb,r.wrapMode=Nt.CLAMP_TO_EDGE,new Pt(e,r,i)}function B2e(t,e){const{vertex:i,constants:r}=t;r.add("markerSizePerLineWidth","float",Jtt),HS(i),i.uniforms.get("markerScale")==null&&i.constants.add("markerScale","float",1),i.code.add(b`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),e.space===ou.World&&(i.constants.add("maxSegmentLengthFraction","float",.45),i.uniforms.add(new Oe("perRenderPixelRatio",(n,s)=>s.camera.perRenderPixelRatio)),i.code.add(b`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))}var lh;(function(t){t[t.BUTT=0]="BUTT",t[t.SQUARE=1]="SQUARE",t[t.ROUND=2]="ROUND",t[t.COUNT=3]="COUNT"})(lh||(lh={}));let tn=class extends Ua{constructor(){super(...arguments),this.output=U.Color,this.capType=lh.BUTT,this.transparencyPassType=Qe.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}};h([V({count:U.COUNT})],tn.prototype,"output",void 0),h([V({count:lh.COUNT})],tn.prototype,"capType",void 0),h([V({count:Qe.COUNT})],tn.prototype,"transparencyPassType",void 0),h([V()],tn.prototype,"occluder",void 0),h([V()],tn.prototype,"hasSlicePlane",void 0),h([V()],tn.prototype,"hasPolygonOffset",void 0),h([V()],tn.prototype,"writeDepth",void 0),h([V()],tn.prototype,"draped",void 0),h([V()],tn.prototype,"stippleEnabled",void 0),h([V()],tn.prototype,"stippleOffColorEnabled",void 0),h([V()],tn.prototype,"stipplePreferContinuous",void 0),h([V()],tn.prototype,"roundJoins",void 0),h([V()],tn.prototype,"applyMarkerOffset",void 0),h([V()],tn.prototype,"vvSize",void 0),h([V()],tn.prototype,"vvColor",void 0),h([V()],tn.prototype,"vvOpacity",void 0),h([V()],tn.prototype,"falloffEnabled",void 0),h([V()],tn.prototype,"innerColorEnabled",void 0),h([V()],tn.prototype,"hasOccludees",void 0),h([V()],tn.prototype,"multipassEnabled",void 0),h([V()],tn.prototype,"cullAboveGround",void 0),h([V()],tn.prototype,"wireframe",void 0),h([V()],tn.prototype,"objectAndLayerIdColorInstanced",void 0),h([V({constValue:!1})],tn.prototype,"occlusionPass",void 0),h([V({constValue:!0})],tn.prototype,"hasVvInstancing",void 0),h([V({constValue:!0})],tn.prototype,"hasSliceTranslatedView",void 0);const a5=1;function eit(t){const e=new mi,{vertex:i,fragment:r}=e,n=t.multipassEnabled&&(t.output===U.Color||t.output===U.Alpha);e.include(CR),e.include(S2e,t),e.include(dtt,t);const s=t.applyMarkerOffset&&!t.draped;s&&(i.uniforms.add(new Oe("markerScale",m=>m.markerScale)),e.include(B2e,{space:ou.World,draped:!1})),t.output===U.Depth&&e.include(Mg,t),e.include(DR,t),tc(i,t),i.uniforms.add(new Vr("inverseProjectionMatrix",(m,y)=>y.camera.inverseProjectionMatrix),new zi("nearFar",(m,y)=>y.camera.nearFar),new Oe("miterLimit",m=>m.join!=="miter"?0:m.miterLimit),new ai("viewport",(m,y)=>y.camera.fullViewport)),i.constants.add("LARGE_HALF_FLOAT","float",65500),e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.SUBDIVISIONFACTOR,"float"),e.attributes.add(O.UV0,"vec2"),e.attributes.add(O.AUXPOS1,"vec3"),e.attributes.add(O.AUXPOS2,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),u_(e),n&&e.varyings.add("depth","float");const o=t.stippleEnabled;o&&e.varyings.add("vLineSizeInv","float");const a=t.capType===lh.ROUND,l=o||a;l&&e.varyings.add("vLineWidth","float");const c=t.innerColorEnabled||a;c&&e.varyings.add("vLineDistance","float");const u=t.stippleEnabled&&a,d=t.falloffEnabled||u;d&&e.varyings.add("vLineDistanceNorm","float"),a&&(e.varyings.add("vSegmentSDF","float"),e.varyings.add("vReverseSegmentSDF","float")),i.code.add(b`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),i.code.add(b`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),RF(e),i.code.add(b`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${n?"depth = pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),HS(i),i.code.add(b`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${l?b`vLineWidth = lineWidth;`:""}
      ${o?b`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);
  `),s&&i.code.add(b`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),i.code.add(b`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(t.stippleEnabled||a)&&i.code.add(b`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${a?b`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),i.code.add(b`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),t.roundJoins?i.code.add(b`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${t.stippleEnabled?b`min(1.0, subdivisionFactor * ${b.float((a5+2)/(a5+1))})`:b`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):i.code.add(b`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const p=t.capType!==lh.BUTT;return i.code.add(b`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${p?b`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),i.code.add(b`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${d||c?b`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${c?b`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${d?b`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),a&&i.code.add(b`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),t.stippleEnabled&&(t.draped?i.uniforms.add(new Oe("worldToScreenRatio",(m,y)=>1/y.screenToPCSRatio)):i.code.add(b`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),i.code.add(b`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),t.draped?i.code.add(b`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):i.code.add(b`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),i.uniforms.add(new Oe("stipplePatternPixelSize",m=>O2e(m))),i.code.add(b`float patternLength = lineSize * stipplePatternPixelSize;
vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);
vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);
if (segmentLengthScreenDouble >= 0.001) {
vec2 stippleDisplacement = pos.xy - segmentOrigin;
float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);
vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
}
vStippleDistanceLimits *= pos.w;
vStippleDistance *= pos.w;
vStippleDistanceLimits = isJoin ?
vStippleDistanceLimits :
isStartVertex ?
vec2(-1e34, vStippleDistanceLimits.y) :
vec2(vStippleDistanceLimits.x, 1e34);`)),i.code.add(b`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${t.wireframe&&!t.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),n&&e.include(uc,t),e.include(vn,t),r.include(Jf),r.code.add(b`
  void main() {
    discardBySlice(vpos);
    ${n?"terrainDepthTest(depth);":""}
  `),t.wireframe?r.code.add(b`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(a&&r.code.add(b`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${b.float(co)}) {
        discard;
      }
    `),u?r.code.add(b`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${b.float(co)}, stippleCoverage);
      `):r.code.add(b`float stippleAlpha = getStippleAlpha();`),t.output!==U.ObjectAndLayerIdColor&&r.code.add(b`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),r.uniforms.add(new ai("intrinsicColor",m=>m.color)),r.code.add(b`vec4 color = intrinsicColor * vColor;`),t.innerColorEnabled&&(r.uniforms.add(new ai("innerColor",m=>m.innerColor??m.color),new Oe("innerWidth",(m,y)=>m.innerWidth*y.camera.pixelRatio)),r.code.add(b`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),r.code.add(b`vec4 finalColor = blendStipple(color, stippleAlpha);`),t.falloffEnabled&&(r.uniforms.add(new Oe("falloff",m=>m.falloff)),r.code.add(b`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),r.code.add(b`
    ${t.output===U.ObjectAndLayerIdColor?b`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${b.float(co)}) {
      discard;
    }

    ${t.output===U.Alpha?b`fragColor = vec4(finalColor.a);`:""}
    ${t.output===U.Color?b`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===U.Color&&t.transparencyPassType===Qe.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${t.output===U.Highlight?b`fragColor = vec4(1.0);`:""}
    ${t.output===U.Depth?b`outputDepth(linearDepth);`:""}
    ${t.output===U.ObjectAndLayerIdColor?b`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const tit=Object.freeze(Object.defineProperty({__proto__:null,build:eit,ribbonlineNumRoundJoinSubdivisions:a5},Symbol.toStringTag,{value:"Module"})),V2e=new Map([[O.POSITION,0],[O.SUBDIVISIONFACTOR,1],[O.UV0,2],[O.AUXPOS1,3],[O.AUXPOS2,4],[O.COLOR,5],[O.COLORFEATUREATTRIBUTE,5],[O.SIZE,6],[O.SIZEFEATUREATTRIBUTE,6],[O.OPACITYFEATUREATTRIBUTE,7],[O.OBJECTANDLAYERIDCOLOR,8]]);let G2e=class j2e extends Ci{initializeProgram(e){return new wi(e.rctx,j2e.shader.get().build(this.configuration),V2e)}_makePipelineState(e,i){const r=this.configuration,n=e===Qe.NONE,s=e===Qe.FrontFace;return Ot({blending:r.output===U.Color||r.output===U.Alpha?n?su:Wg(e):null,depthTest:{func:L_(e)},depthWrite:n?r.writeDepth?_l:null:XF(e),colorWrite:Ft,stencilWrite:r.hasOccludees?Ff:null,stencilTest:r.hasOccludees?i?y_:D_:null,polygonOffset:n||s?r.hasPolygonOffset?Qre:null:JF})}initializePipeline(){const e=this.configuration;if(e.occluder){const i=e.hasPolygonOffset?Qre:null;this._occluderPipelineTransparent=Ot({blending:su,polygonOffset:i,depthTest:QN,depthWrite:null,colorWrite:Ft,stencilWrite:null,stencilTest:rxe}),this._occluderPipelineOpaque=Ot({blending:su,polygonOffset:i,depthTest:QN,depthWrite:null,colorWrite:Ft,stencilWrite:txe,stencilTest:ixe}),this._occluderPipelineMaskWrite=Ot({blending:null,polygonOffset:i,depthTest:xX,depthWrite:null,colorWrite:null,stencilWrite:Ff,stencilTest:y_})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?Qt.LINES:Qt.TRIANGLE_STRIP}getPipeline(e,i,r){return e?this._occludeePipelineState:this.configuration.occluder?r?this._occluderPipelineTransparent:i?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}};G2e.shader=new bi(tit,()=>pe(()=>import("./RibbonLine.glsl-bcb215f1.js"),[],import.meta.url));const Qre={factor:0,units:-4};var Dl;(function(t){t[t.LEFT_JOIN_START=-2]="LEFT_JOIN_START",t[t.LEFT_JOIN_END=-1]="LEFT_JOIN_END",t[t.LEFT_CAP_START=-4]="LEFT_CAP_START",t[t.LEFT_CAP_END=-5]="LEFT_CAP_END",t[t.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",t[t.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",t[t.RIGHT_CAP_START=4]="RIGHT_CAP_START",t[t.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(Dl||(Dl={}));let Y2=class extends $_{constructor(e){super(e,new rit),this._configuration=new tn,this._vertexAttributeLocations=V2e}getConfiguration(e,i){this._configuration.output=e,this._configuration.draped=i.slot===ae.DRAPED_MATERIAL;const r=this.parameters.stipplePattern!=null&&e!==U.Highlight;return this._configuration.stippleEnabled=r,this._configuration.stippleOffColorEnabled=r&&this.parameters.stippleOffColor!=null,this._configuration.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=this.parameters.markerParameters!=null&&sit(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&this.parameters.innerColor!=null,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===Pr.OccludeAndTransparentStencil,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,i,r,n,s,o){if(!r.options.selectionMode)return;const a=e.attributes.get(O.POSITION).data,l=e.attributes.get(O.SIZE);let c=this.parameters.width;if(this.parameters.vvSize){const _=e.attributes.get(O.SIZEFEATUREATTRIBUTE).data[0];c*=_e(this.parameters.vvSize.offset[0]+_*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else l&&(c*=l.data[0]);const u=n[0],d=n[1],p=(c/2+4)*e.screenToWorldRatio;let m=Number.MAX_VALUE,y=0;for(let _=0;_<a.length-5;_+=3){const v=a[_],w=a[_+1],x=u-v,T=d-w,S=a[_+3]-v,E=a[_+4]-w,A=_e((S*x+E*T)/(S*S+E*E),0,1),P=S*A-x,N=E*A-T,F=P*P+N*N;F<m&&(m=F,y=_/3)}m<p*p&&s(o.dist,o.normal,y,!1)}intersect(e,i,r,n,s,o){if(!r.options.selectionMode||!e.visible)return;if(!K_e(i))return void ne.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const a=e.attributes,l=a.get(O.POSITION).data;let c=this.parameters.width;if(this.parameters.vvSize){const x=a.get(O.SIZEFEATUREATTRIBUTE).data[0];c*=_e(this.parameters.vvSize.offset[0]+x*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else a.has(O.SIZE)&&(c*=a.get(O.SIZE).data[0]);const u=r.camera,d=oit;Yn(d,r.point);const p=c*u.pixelRatio/2+4*u.pixelRatio;oe(zE[0],d[0]-p,d[1]+p,0),oe(zE[1],d[0]+p,d[1]+p,0),oe(zE[2],d[0]+p,d[1]-p,0),oe(zE[3],d[0]-p,d[1]-p,0);for(let x=0;x<4;x++)if(!u.unprojectFromRenderScreen(zE[x],um[x]))return;Ko(u.eye,um[0],um[1],r8),Ko(u.eye,um[1],um[2],n8),Ko(u.eye,um[2],um[3],s8),Ko(u.eye,um[3],um[0],o8);let m=Number.MAX_VALUE,y=0;const _=H2e(this.parameters,a)?l.length-2:l.length-5;for(let x=0;x<_;x+=3){qa[0]=l[x]+i[12],qa[1]=l[x+1]+i[13],qa[2]=l[x+2]+i[14];const T=(x+3)%l.length;if(Wa[0]=l[T]+i[12],Wa[1]=l[T+1]+i[13],Wa[2]=l[T+2]+i[14],ir(r8,qa)<0&&ir(r8,Wa)<0||ir(n8,qa)<0&&ir(n8,Wa)<0||ir(s8,qa)<0&&ir(s8,Wa)<0||ir(o8,qa)<0&&ir(o8,Wa)<0)continue;if(u.projectToRenderScreen(qa,lv),u.projectToRenderScreen(Wa,cv),lv[2]<0&&cv[2]>0){he(yp,qa,Wa);const E=u.frustum,A=-ir(E[ur.NEAR],qa)/me(yp,E[ur.NEAR]);te(yp,yp,A),ce(qa,qa,yp),u.projectToRenderScreen(qa,lv)}else if(lv[2]>0&&cv[2]<0){he(yp,Wa,qa);const E=u.frustum,A=-ir(E[ur.NEAR],Wa)/me(yp,E[ur.NEAR]);te(yp,yp,A),ce(Wa,Wa,yp),u.projectToRenderScreen(Wa,cv)}else if(lv[2]<0&&cv[2]<0)continue;lv[2]=0,cv[2]=0;const S=CW(tb(lv,cv,ine),d);S<m&&(m=S,se(ene,qa),se(tne,Wa),y=x/3)}const v=r.rayBegin,w=r.rayEnd;if(m<p*p){let x=Number.MAX_VALUE;if(P0e(tb(ene,tne,ine),tb(v,w,ait),av)){he(av,av,v);const T=we(av);te(av,av,1/T),x=T/br(v,w)}o(x,av,y,!1)}}get _layout(){const e=Ir().vec3f(O.POSITION).f32(O.SUBDIVISIONFACTOR).vec2f(O.UV0).vec3f(O.AUXPOS1).vec3f(O.AUXPOS2);return this.parameters.vvSize?e.f32(O.SIZEFEATUREATTRIBUTE):e.f32(O.SIZE),this.parameters.vvColor?e.f32(O.COLORFEATUREATTRIBUTE):e.vec4f(O.COLOR),this.parameters.vvOpacity&&e.f32(O.OPACITYFEATUREATTRIBUTE),ie("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(O.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new nit(this._layout,this.parameters)}produces(e,i){return i===U.Color||i===U.Alpha||i===U.Highlight||i===U.Depth||i===U.ObjectAndLayerIdColor?e===ae.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===Pr.OccludeAndTransparentStencil?e===ae.OPAQUE_MATERIAL||e===ae.OCCLUDER_MATERIAL||e===ae.TRANSPARENT_OCCLUDER_MATERIAL:i===U.Color||i===U.Alpha?e===(this.parameters.writeDepth?ae.TRANSPARENT_MATERIAL:ae.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===ae.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new iit(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),e.markerParameters!=null&&(e.markerScale=e.markerParameters.width/e.width)}},iit=class extends P_{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==U.Color&&this._output!==U.Alpha||this._updateOccludeeState(e);const i=this._material.parameters.stipplePattern;return this._stipplePattern!==i&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(i,this._stipplePattern)}),this._stipplePattern=i),this.ensureTechnique(G2e,e)}},rit=class extends NR{constructor(){super(...arguments),this.width=0,this.color=rh,this.join="miter",this.cap=lh.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}},nit=class{constructor(e,i){this.vertexBufferLayout=e,this._parameters=i,this.numJoinSubdivisions=0;const r=i.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=a5+r}}_isClosed(e){return H2e(this._parameters,e.attributes)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const r=e.attributes.get(O.POSITION).indices.length/2+1,n=this._isClosed(e);let s=n?2:2*2;return s+=((n?r:r-1)-(n?0:1))*(2*this.numJoinSubdivisions+4),s+=2,this._parameters.wireframe&&(s=2+4*(s-2)),s}write(e,i,r,n,s){const o=lit,a=cit,l=uit,c=r.attributes.get(O.POSITION),u=c.indices,d=c.data.length/3,p=r.attributes.get(O.DISTANCETOSTART)?.data;u&&u.length!==2*(d-1)&&console.warn("RibbonLineMaterial does not support indices");let m=1,y=0;const _=this.vertexBufferLayout.fields.has(O.SIZEFEATUREATTRIBUTE);_?y=r.attributes.get(O.SIZEFEATUREATTRIBUTE).data[0]:r.attributes.has(O.SIZE)&&(m=r.attributes.get(O.SIZE).data[0]);let v=[1,1,1,1],w=0;const x=this.vertexBufferLayout.fields.has(O.COLORFEATUREATTRIBUTE);x?w=r.attributes.get(O.COLORFEATUREATTRIBUTE).data[0]:r.attributes.has(O.COLOR)&&(v=r.attributes.get(O.COLOR).data);const T=ie("enable-feature:objectAndLayerId-rendering")?r.objectAndLayerIdColor:null;let S=0;const E=this.vertexBufferLayout.fields.has(O.OPACITYFEATUREATTRIBUTE);E&&(S=r.attributes.get(O.OPACITYFEATUREATTRIBUTE).data[0]);const A=new Float32Array(n.buffer),P=ie("enable-feature:objectAndLayerId-rendering")?new Uint8Array(n.buffer):null,N=this.vertexBufferLayout.stride/4;let F=s*N;const D=F;let $=0;const R=p?(I,G,q)=>$=p[q]:(I,G,q)=>$+=br(I,G),k=ie("enable-feature:objectAndLayerId-rendering"),B=(I,G,q,Z,K,Q,de)=>{if(A[F++]=G[0],A[F++]=G[1],A[F++]=G[2],A[F++]=Z,A[F++]=de,A[F++]=K,A[F++]=I[0],A[F++]=I[1],A[F++]=I[2],A[F++]=q[0],A[F++]=q[1],A[F++]=q[2],A[F++]=_?y:m,x)A[F++]=w;else{const Ae=Math.min(4*Q,v.length-4);A[F++]=v[Ae],A[F++]=v[Ae+1],A[F++]=v[Ae+2],A[F++]=v[Ae+3]}E&&(A[F++]=S),k&&(T!=null&&(P[4*F]=T[0],P[4*F+1]=T[1],P[4*F+2]=T[2],P[4*F+3]=T[3]),F++)};F+=N,oe(a,c.data[0],c.data[1],c.data[2]),e&&Fe(a,a,e);const j=this._isClosed(r);if(j){const I=c.data.length-3;oe(o,c.data[I],c.data[I+1],c.data[I+2]),e&&Fe(o,o,e)}else oe(l,c.data[3],c.data[4],c.data[5]),e&&Fe(l,l,e),B(a,a,l,1,Dl.LEFT_CAP_START,0,0),B(a,a,l,1,Dl.RIGHT_CAP_START,0,0),se(o,a),se(a,l);const X=j?0:1,M=j?d:d-1;for(let I=X;I<M;I++){const G=(I+1)%d*3;oe(l,c.data[G],c.data[G+1],c.data[G+2]),e&&Fe(l,l,e),R(o,a,I),B(o,a,l,0,Dl.LEFT_JOIN_END,I,$),B(o,a,l,0,Dl.RIGHT_JOIN_END,I,$);const q=this.numJoinSubdivisions;for(let Z=0;Z<q;++Z){const K=(Z+1)/(q+1);B(o,a,l,K,Dl.LEFT_JOIN_END,I,$),B(o,a,l,K,Dl.RIGHT_JOIN_END,I,$)}B(o,a,l,1,Dl.LEFT_JOIN_START,I,$),B(o,a,l,1,Dl.RIGHT_JOIN_START,I,$),se(o,a),se(a,l)}j?(oe(l,c.data[3],c.data[4],c.data[5]),e&&Fe(l,l,e),$=R(o,a,M),B(o,a,l,0,Dl.LEFT_JOIN_END,X,$),B(o,a,l,0,Dl.RIGHT_JOIN_END,X,$)):($=R(o,a,M),B(o,a,a,0,Dl.LEFT_CAP_END,M,$),B(o,a,a,0,Dl.RIGHT_CAP_END,M,$)),i8(A,D+N,A,D,N),F=i8(A,F-N,A,F,N),this._parameters.wireframe&&this._addWireframeVertices(n,D,F,N)}_addWireframeVertices(e,i,r,n){const s=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT,r-i);let a=0;const l=c=>a=i8(o,c,s,a,n);for(let c=0;c<o.length-1;c+=2*n)l(c),l(c+2*n),l(c+1*n),l(c+2*n),l(c+1*n),l(c+3*n)}};function i8(t,e,i,r,n){for(let s=0;s<n;s++)i[r++]=t[e++];return r}function H2e(t,e){return t.isClosed?e.get(O.POSITION).indices.length>2:!1}function sit(t){return t.anchor===Hb.Tip&&t.hideOnShortSegments&&t.placement==="begin-end"&&t.worldSpace}const qa=C(),Wa=C(),yp=C(),av=C(),oit=C(),lv=Mo(),cv=Mo(),ene=C(),tne=C(),ine=tp(),ait=tp(),lit=C(),cit=C(),uit=C(),zE=[Mo(),Mo(),Mo(),Mo()],um=[C(),C(),C(),C()],r8=Ti(),n8=Ti(),s8=Ti(),o8=Ti();let qX=class{constructor(e){this._originSR=e,this._rootOriginId="root/"+Kc(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}getOrigin(e){const i=this._origins.get(this._rootOriginId);if(i==null){const u=r5(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,u),u}const r=this._gridSize,n=Math.round(e[0]/r),s=Math.round(e[1]/r),o=Math.round(e[2]/r),a=`${n}/${s}/${o}`;let l=this._origins.get(a);const c=.5*r;if(he(Ks,e,i.vec3),Ks[0]=Math.abs(Ks[0]),Ks[1]=Math.abs(Ks[1]),Ks[2]=Math.abs(Ks[2]),Ks[0]<c&&Ks[1]<c&&Ks[2]<c){if(l){const u=Math.max(...Ks);if(he(Ks,e,l.vec3),Ks[0]=Math.abs(Ks[0]),Ks[1]=Math.abs(Ks[1]),Ks[2]=Math.abs(Ks[2]),Math.max(...Ks)<u)return l}return i}return l||(l=r5(n*r,s*r,o*r,a),this._origins.set(a,l)),l}_drawOriginBox(e,i=Mt(1,1,0,1)){const r=window.view,n=r._stage,s=i.toString();if(!this._objects.has(s)){this._material=new Y2({width:2,color:i}),n.add(this._material);const m=new T2e(n,{pickable:!1}),y=new Yg({castShadow:!1});n.add(y),m.add(y),this._objects.set(s,y)}const o=this._objects.get(s),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),u=new Array,d=.5*this._gridSize;for(let m=0;m<l;m++)c[3*m]=e[0]+(1&a[m]?d:-d),c[3*m+1]=e[1]+(2&a[m]?d:-d),c[3*m+2]=e[2]+(4&a[m]?d:-d),m>0&&u.push(m-1,m);jr(c,this._originSR,0,c,r.renderSpatialReference,0,l);const p=new Wn(this._material,[[O.POSITION,new ke(c,u,3,!0)]],null,on.Line);n.add(p),o.addGeometry(p)}get test(){const e=this;return{set gridSize(i){e._gridSize=i}}}};const Ks=C();let q2e=class{constructor(e,i,r=null){this.rctx=e,this.sliceHelper=r,this.lastFrameCamera=new ht,this.output=U.Color,this.renderOccludedMask=rne,this.bindParameters=new OF(i,r!=null?r.plane:null),this.bindParameters.alignPixelEnabled=!0}resetRenderOccludedMask(){this.renderOccludedMask=rne}},hit=class extends q2e{constructor(e,i,r,n){super(e,r,n),this.offscreenRenderingHelper=i,this.sliceHelper=n,this.time=0}};const rne=Pr.Occlude|Pr.OccludeAndTransparent|Pr.OccludeAndTransparentStencil;let vA=class extends ht{constructor(){super(...arguments),this._projectionMatrix=be()}get projectionMatrix(){return this._projectionMatrix}};h([f()],vA.prototype,"_projectionMatrix",void 0),h([f({readOnly:!0})],vA.prototype,"projectionMatrix",null),vA=h([z("esri.views.3d.webgl-engine.lib.CascadeCamera")],vA);var yS;(function(t){t[t.Highlight=0]="Highlight",t[t.Default=1]="Default"})(yS||(yS={}));let KM=class{constructor(){this.camera=new vA,this.lightMat=be()}},dit=class{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}},WX=class{get depthTexture(){return this._handle?.colorTexture}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return Mr(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}constructor(e,i){this._fbos=e,this._viewingMode=i,this._enabled=!1,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new dit,this._projectionView=be(),this._projectionViewInverse=be(),this._modelViewLight=be(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=Kt(),this._cascades=[new KM,new KM,new KM,new KM],this._lastOrigin=null,this._maxTextureWidth=Math.min(ie("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._handle=Jt(this._handle),this._discardSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=_e(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&this.depthTexture!=null}get cascades(){for(let e=0;e<this._numCascades;++e)l8[e]=this._cascades[e];return l8.length=this._numCascades,l8}start(e,i,r,n,s){Ke(this.enabled);const{near:o,far:a}=this._clampNearFar(r);this._computeCascadeDistances(o,a,n),this._textureHeight=this._computeTextureHeight(e,s,n),this._setupMatrices(e,i);const{viewMatrix:l,projectionMatrix:c}=e;for(let u=0;u<this._numCascades;++u)this._constructCascade(u,c,l,i);this._lastOrigin=null,this.clear()}finish(){Ke(this.enabled),this._handle?.releaseDepth()}getShadowMapMatrices(e){if(!this._lastOrigin||!Po(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||C(),se(this._lastOrigin,e);for(let i=0;i<this._numCascades;++i){yl(cne,this._cascades[i].lightMat,e);for(let r=0;r<16;++r)une[16*i+r]=cne[r]}}return une}moveSnapshot(e){Ke(this.enabled),this._handle?.releaseDepth(),this._snapshots[e]?.release(),this._snapshots[e]=this._handle,this._handle=null}copySnapshot(e){const i=this._handle?.colorTexture?.descriptor;if(!this.enabled||!i)return;this._snapshots[e]?.release();const{width:r,height:n}=i;this._snapshots[e]=this._fbos.acquire(hi.RGBA4,r,n);const s=this._fbos.rctx;this._bindFbo();const o=s.bindTexture(this._snapshots[e]?.colorTexture,Pt.TEXTURE_UNIT_FOR_UPDATES);s.gl.copyTexSubImage2D(sn.TEXTURE_2D,0,0,0,0,0,r,n),s.bindTexture(o,Pt.TEXTURE_UNIT_FOR_UPDATES)}getSnapshot(e){return this.enabled?this._snapshots[e]?.colorTexture:null}clear(){const e=this._fbos.rctx;this._ensureFbo(),this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(hr.COLOR_BUFFER_BIT|hr.DEPTH_BUFFER_BIT)}_computeTextureHeight(e,i,r){const n=Math.min(window.devicePixelRatio,i)/e.pixelRatio,s=r?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,o=rb(Math.floor(Math.max(e.fullWidth,e.fullHeight)*n*s));return Math.min(this._maxTextureWidth,this._numCascades*o)/this._numCascades}_ensureFbo(){this._handle?.fbo.width===this._textureWidth&&this._handle?.fbo.height===this._textureHeight||(this._handle?.release(),this._handle=this._fbos.acquire(hi.RGBA4,this._textureWidth,this._textureHeight)),this._handle.acquireDepth(rs.DEPTH16_BUFFER)}_discardSnapshot(e){this._snapshots[e]=Jt(this._snapshots[e])}_discardSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){const e=this._fbos.rctx;e.unbindTexture(this.depthTexture),e.bindFramebuffer(this._handle?.fbo)}_constructCascade(e,i,r,n){const s=this._cascades[e],o=-this._cascadeDistances[e],a=-this._cascadeDistances[e+1],l=(i[10]*o+i[14])/Math.abs(i[11]*o+i[15]),c=(i[10]*a+i[14])/Math.abs(i[11]*a+i[15]);Ke(l<c);for(let m=0;m<8;++m){Mr(nne,m%4==0||m%4==3?-1:1,m%4==0||m%4==1?-1:1,m<4?l:c,1);const y=Hu[m];Xc(y,nne,this._projectionViewInverse),y[0]/=y[3],y[1]/=y[3],y[2]/=y[3]}na(a8,Hu[0]),s.camera.viewMatrix=yl(pit,this._modelViewLight,a8);for(let m=0;m<8;++m)Fe(Hu[m],Hu[m],s.camera.viewMatrix);let u=Hu[0][2],d=Hu[0][2];for(let m=1;m<8;++m)u=Math.min(u,Hu[m][2]),d=Math.max(d,Hu[m][2]);u-=200,d+=200,s.camera.near=-d,s.camera.far=-u,yit(r,n,u,d,s.camera),Di(s.lightMat,s.camera.projectionMatrix,s.camera.viewMatrix);const p=this._textureHeight;s.camera.viewport=[e*p,0,p,p]}_setupMatrices(e,i){Di(this._projectionView,e.projectionMatrix,e.viewMatrix),qn(this._projectionViewInverse,this._projectionView);const r=this._viewingMode===Me.Global?e.eye:oe(a8,0,0,1);$4(this._modelViewLight,[0,0,0],[-i[0],-i[1],-i[2]],r)}_clampNearFar(e){let{near:i,far:r}=e;return i<2&&(i=2),r<2&&(r=2),i>=r&&(i=2,r=4),{near:i,far:r}}_computeCascadeDistances(e,i,r){const n=r?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(O7e(i/e,4)),n);const s=(i-e)/this._numCascades,o=(i/e)**(1/this._numCascades);let a=e,l=e;for(let c=0;c<this._numCascades+1;++c)this._cascadeDistances[c]=_t(a,l,this.settings.splitSchemeLambda),a*=o,l+=s}get test(){return{cascades:this._cascades,textureHeight:this._textureHeight}}};const pit=be(),nne=Kt(),Hu=[];for(let t=0;t<8;++t)Hu.push(Kt());const sne=Ue(),one=Ue(),fit=Ue(),ane=Ue(),lne=Ue(),a8=C(),l8=[],cne=be(),une=zr.concat(zr,zr,zr,zr),vc=Ue(),nx=Ue(),uv=[Ue(),Ue(),Ue(),Ue()],ps=Ue(),c8=Ue(),E0=Ue(),BE=Ue(),sx=Ue(),ox=Ue(),QM=Ue();function mit(t,e,i,r,n,s,o,a){si(vc,0,0);for(let E=0;E<4;++E)md(vc,vc,t[E]);Yl(vc,vc,.25),si(nx,0,0);for(let E=4;E<8;++E)md(nx,nx,t[E]);Yl(nx,nx,.25),Ku(uv[0],t[4],t[5],.5),Ku(uv[1],t[5],t[6],.5),Ku(uv[2],t[6],t[7],.5),Ku(uv[3],t[7],t[4],.5);let l=0,c=EN(uv[0],vc);for(let E=1;E<4;++E){const A=EN(uv[E],vc);A<c&&(c=A,l=E)}lf(ps,uv[l],t[l+4]);const u=ps[0];let d,p;ps[0]=-ps[1],ps[1]=u,lf(c8,nx,vc),es(c8,ps)<0&&cY(ps,ps),Ku(ps,ps,c8,i),fO(ps,ps),d=p=es(lf(E0,t[0],vc),ps);for(let E=1;E<8;++E){const A=es(lf(E0,t[E],vc),ps);A<d?d=A:A>p&&(p=A)}Yn(r,vc),Yl(E0,ps,d-e),md(r,r,E0);let m=-1,y=1,_=0,v=0;for(let E=0;E<8;++E){lf(BE,t[E],r),fO(BE,BE);const A=ps[0]*BE[1]-ps[1]*BE[0];A>0?A>m&&(m=A,_=E):A<y&&(y=A,v=E)}zw(m>0,"leftArea"),zw(y<0,"rightArea"),Yl(sx,ps,d),md(sx,sx,vc),Yl(ox,ps,p),md(ox,ox,vc),QM[0]=-ps[1],QM[1]=ps[0];const w=aM(r,t[v],ox,md(E0,ox,QM),1,n),x=aM(r,t[_],ox,E0,1,s),T=aM(r,t[_],sx,md(E0,sx,QM),1,o),S=aM(r,t[v],sx,E0,1,a);zw(w,"rayRay"),zw(x,"rayRay"),zw(T,"rayRay"),zw(S,"rayRay")}function ui(t,e){return 3*e+t}const hne=Ue();function El(t,e){return si(hne,t[e],t[e+3]),hne}const Ya=Ue(),qe=Hr();function git(t,e,i,r,n){lf(Ya,i,r),Yl(Ya,Ya,.5),qe[0]=Ya[0],qe[1]=Ya[1],qe[2]=0,qe[3]=Ya[1],qe[4]=-Ya[0],qe[5]=0,qe[6]=Ya[0]*Ya[0]+Ya[1]*Ya[1],qe[7]=Ya[0]*Ya[1]-Ya[1]*Ya[0],qe[8]=1,qe[ui(0,2)]=-es(El(qe,0),t),qe[ui(1,2)]=-es(El(qe,1),t);let s=es(El(qe,0),i)+qe[ui(0,2)],o=es(El(qe,1),i)+qe[ui(1,2)],a=es(El(qe,0),r)+qe[ui(0,2)],l=es(El(qe,1),r)+qe[ui(1,2)];s=-(s+a)/(o+l),qe[ui(0,0)]+=qe[ui(1,0)]*s,qe[ui(0,1)]+=qe[ui(1,1)]*s,qe[ui(0,2)]+=qe[ui(1,2)]*s,s=1/(es(El(qe,0),i)+qe[ui(0,2)]),o=1/(es(El(qe,1),i)+qe[ui(1,2)]),qe[ui(0,0)]*=s,qe[ui(0,1)]*=s,qe[ui(0,2)]*=s,qe[ui(1,0)]*=o,qe[ui(1,1)]*=o,qe[ui(1,2)]*=o,qe[ui(2,0)]=qe[ui(1,0)],qe[ui(2,1)]=qe[ui(1,1)],qe[ui(2,2)]=qe[ui(1,2)],qe[ui(1,2)]+=1,s=es(El(qe,1),e)+qe[ui(1,2)],o=es(El(qe,2),e)+qe[ui(2,2)],a=es(El(qe,1),i)+qe[ui(1,2)],l=es(El(qe,2),i)+qe[ui(2,2)],s=-.5*(s/o+a/l),qe[ui(1,0)]+=qe[ui(2,0)]*s,qe[ui(1,1)]+=qe[ui(2,1)]*s,qe[ui(1,2)]+=qe[ui(2,2)]*s,s=es(El(qe,1),e)+qe[ui(1,2)],o=es(El(qe,2),e)+qe[ui(2,2)],a=-o/s,qe[ui(1,0)]*=a,qe[ui(1,1)]*=a,qe[ui(1,2)]*=a,n[0]=qe[0],n[1]=qe[1],n[2]=0,n[3]=qe[2],n[4]=qe[3],n[5]=qe[4],n[6]=0,n[7]=qe[5],n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=qe[6],n[13]=qe[7],n[14]=0,n[15]=qe[8]}function yit(t,e,i,r,n){const s=1/Hu[0][3],o=1/Hu[4][3];Ke(s<o);let a=s+Math.sqrt(s*o);const l=Math.sin(xs(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));a/=l,mit(Hu,a,l,sne,one,fit,ane,lne),git(sne,one,ane,lne,n.projectionMatrix),n.projectionMatrix[10]=2/(i-r),n.projectionMatrix[14]=-(i+r)/(i-r)}function _it(t){return ip(t)&&t.intersector===Ur.TERRAIN&&!!t.target}let vit=class extends yF{constructor(e,i,r){super(e,i),this.triangleNr=r}};function W2e(t){return ip(t)&&t.intersector===Ur.OVERLAY&&!!t.target}let cj=class{constructor(){this.adds=new It,this.removes=new It,this.updates=new It({allocator:e=>e||new bit,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},bit=class{},wit=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}};var kr,ns;(function(t){t[t.ADD=0]="ADD",t[t.UPDATE=1]="UPDATE",t[t.REMOVE=2]="REMOVE"})(kr||(kr={})),function(t){t[t.NONE=0]="NONE",t[t.VISIBILITY=1]="VISIBILITY",t[t.GEOMETRY=2]="GEOMETRY",t[t.TRANSFORMATION=4]="TRANSFORMATION",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.OCCLUDEE=16]="OCCLUDEE"}(ns||(ns={}));function Y2e(t){const e=new Map,i=r=>{let n=e.get(r);return n||(n=new wit,e.set(r,n)),n};return t.removes.forAll(r=>{u8(r)&&i(r.material).removes.push(r)}),t.adds.forAll(r=>{u8(r)&&i(r.material).adds.push(r)}),t.updates.forAll(r=>{u8(r.renderGeometry)&&i(r.renderGeometry.material).updates.push(r)}),e}function u8(t){return t.geometry.indexCount>=1}let X2e=class{constructor(e,i){this._material=e,this._repository=i,this._map=new Map}dispose(){this._map.forEach((e,i)=>{e!=null&&this._repository.release(this._material,i)})}load(e,i,r){if(!this._material.produces(i,r))return null;this._map.has(r)||this._map.set(r,this._repository.acquire(this._material,i,r));const n=this._map.get(r);if(n!=null){if(n.ensureResources(e)===l_.LOADED)return n;this._repository.requestRender()}return null}},uj=class extends exe{constructor(e=C()){super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}};const xit=Ir().vec3f(O.POSITION),Tit=Ir().vec3f(O.POSITION).vec2f(O.UV0),Sit=Ir().vec3f(O.POSITION).vec4u8(O.COLOR);Ir().vec3f(O.POSITION).vec4u8(O.OBJECTANDLAYERIDCOLOR);const Eit=Ir().vec3f(O.POSITION).vec2f(O.UV0).vec4u8(O.OBJECTANDLAYERIDCOLOR);Ir().vec3f(O.POSITION).vec4u8(O.COLOR).vec4u8(O.OBJECTANDLAYERIDCOLOR);let YX=class extends $_{intersect(e,i,r,n,s,o){return Qbe(e,r,n,s,void 0,o)}};function dne(t){t.fragment.uniforms.add(new Je("texWaveNormal",e=>e.waveNormal),new Je("texWavePerturbation",e=>e.wavePerturbation),new ai("waveParams",e=>Mr(Cit,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset)),new zi("waveDirection",e=>si(Ait,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity))),t.include(zet),t.fragment.code.add(b`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const Cit=Kt(),Ait=Ue();function PO(t,e){e.spherical?t.vertex.code.add(b`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(b`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(b`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(b`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}function Oit(t){const e=new mi,{vertex:i,fragment:r}=e;tc(i,t),e.include(ml,t),e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.UV0,"vec2");const n=new ai("waterColor",s=>s.color);if(t.output===U.Color&&t.isDraped)return e.varyings.add("vpos","vec3"),i.uniforms.add(n),i.code.add(b`
        void main(void) {
          if (waterColor.a < ${b.float(co)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(n),r.code.add(b`void main() {
fragColor = waterColor;
}`),e;switch(t.output!==U.Color&&t.output!==U.Alpha||(e.include(PO,t),e.include(qS,t),e.varyings.add("vuv","vec2"),e.varyings.add("vpos","vec3"),e.varyings.add("vnormal","vec3"),e.varyings.add("vtbnMatrix","mat3"),t.multipassEnabled&&e.varyings.add("depth","float"),i.uniforms.add(n),i.code.add(b`
      void main(void) {
        if (waterColor.a < ${b.float(co)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${t.output===U.Color?"forwardLinearDepth();":""}
      }
    `)),e.include(uc,t),t.output){case U.Alpha:e.include(vn,t),r.uniforms.add(n),r.code.add(b`
        void main() {
          discardBySlice(vpos);
          ${t.multipassEnabled?"terrainDepthTest(depth);":""}

          fragColor = vec4(waterColor.a);
        }
      `);break;case U.Color:e.include(CN),e.include(bY,{pbrMode:it.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(dne),e.include(vn,t),e.include(Gb,t),e.include(g2e,t),r.uniforms.add(n,new Oe("timeElapsed",s=>s.timeElapsed),i.uniforms.get("view"),i.uniforms.get("localOrigin")),Xd(r,t),r.include(Jf),Bg(r),Wf(r),r.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${t.receiveShadows?b`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        fragColor = delinearizeGamma(final);
        fragColor = highlightSlice(fragColor, vpos);
        ${t.transparencyPassType===Qe.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `);break;case U.Normal:e.include(PO,t),e.include(dne,t),e.include(vn,t),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),i.uniforms.add(n),i.code.add(b`
        void main(void) {
          if (waterColor.a < ${b.float(co)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(new Oe("timeElapsed",s=>s.timeElapsed)),r.code.add(b`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
fragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case U.Highlight:e.include(I_,t),e.varyings.add("vpos","vec3"),i.uniforms.add(n),i.code.add(b`
      void main(void) {
        if (waterColor.a < ${b.float(co)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),e.include(vn,t),r.code.add(b`void main() {
discardBySlice(vpos);
outputHighlight();
}`);break;case U.ObjectAndLayerIdColor:e.include(DR,t),e.varyings.add("vpos","vec3"),i.uniforms.add(n),i.code.add(b`
      void main(void) {
        if (waterColor.a < ${b.float(co)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
        forwardObjectAndLayerIdColor();
      }
    `),e.include(vn,t),r.code.add(b`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`)}return e}const Rit=Object.freeze(Object.defineProperty({__proto__:null,build:Oit},Symbol.toStringTag,{value:"Module"}));let Z2e=class J2e extends Ci{initializeConfiguration(e,i){i.spherical=e.viewingMode===Me.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new wi(e.rctx,J2e.shader.get().build(this.configuration),fi)}_setPipelineState(e){const i=this.configuration,r=e===Qe.NONE,n=e===Qe.FrontFace;return Ot({blending:i.output!==U.Normal&&i.output!==U.Highlight&&i.output!==U.ObjectAndLayerIdColor&&i.transparent?r?su:Wg(e):null,depthTest:{func:L_(e)},depthWrite:r?i.writeDepth?_l:null:XF(e),colorWrite:Ft,polygonOffset:r||n?null:KF(i.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};Z2e.shader=new bi(Rit,()=>pe(()=>import("./WaterSurface.glsl-307a6959.js"),[],import.meta.url));let fs=class extends Ua{constructor(){super(...arguments),this.output=U.Color,this.transparencyPassType=Qe.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.objectAndLayerIdColorInstanced=!1,this.isDraped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}};h([V({count:U.COUNT})],fs.prototype,"output",void 0),h([V({count:Qe.COUNT})],fs.prototype,"transparencyPassType",void 0),h([V()],fs.prototype,"spherical",void 0),h([V()],fs.prototype,"receiveShadows",void 0),h([V()],fs.prototype,"hasSlicePlane",void 0),h([V()],fs.prototype,"transparent",void 0),h([V()],fs.prototype,"enableOffset",void 0),h([V()],fs.prototype,"writeDepth",void 0),h([V()],fs.prototype,"hasScreenSpaceReflections",void 0),h([V()],fs.prototype,"doublePrecisionRequiresObfuscation",void 0),h([V()],fs.prototype,"hasCloudsReflections",void 0),h([V()],fs.prototype,"objectAndLayerIdColorInstanced",void 0),h([V()],fs.prototype,"isDraped",void 0),h([V()],fs.prototype,"multipassEnabled",void 0),h([V()],fs.prototype,"cullAboveGround",void 0),h([V({constValue:!1})],fs.prototype,"occlusionPass",void 0),h([V({constValue:it.Water})],fs.prototype,"pbrMode",void 0),h([V({constValue:!0})],fs.prototype,"useCustomDTRExponentForWater",void 0),h([V({constValue:!0})],fs.prototype,"highStepCount",void 0),h([V({constValue:!1})],fs.prototype,"useFillLights",void 0);let Pit=class extends P_{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){const i=e.ssr.lastFrameColor!=null;i!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:i})}_updateCloudsReflectionState(e){const i=e.cloudsFade.data!=null;i!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:i})}ensureResources(e){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(e)}beginSlot(e){return this._output===U.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(Z2e,e)}},K2e=class extends YX{constructor(e){super(e,new Q2e),this._configuration=new fs,this._animation=new D1e}getConfiguration(e,i){return this._configuration.output=e,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.isDraped=this.parameters.isDraped,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<ZF,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}update(e){const i=Math.min(e.camera.relativeElevation,e.camera.distance);this._animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*i<Mit;const r=this._animation.advance(e);return this.setParameters({timeElapsed:AH(this._animation.time)*this.parameters.animationSpeed},!1),this._animation.enabled&&r}produces(e,i){switch(i){case U.Normal:return e===ae.DRAPED_WATER;case U.Color:if(this.parameters.isDraped)return e===ae.DRAPED_MATERIAL;break;case U.Alpha:break;case U.Highlight:case U.ObjectAndLayerIdColor:return e===ae.OPAQUE_MATERIAL||e===ae.DRAPED_MATERIAL;default:return!1}let r=ae.OPAQUE_MATERIAL;return this.parameters.transparent&&(r=this.parameters.writeDepth?ae.TRANSPARENT_MATERIAL:ae.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===r}createGLMaterial(e){return new Pit(e)}createBufferWriter(){return new ZS(ie("enable-feature:objectAndLayerId-rendering")?Eit:Tit)}get test(){return{animationEnabled:this._animation.enabled}}},Q2e=class extends uX{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=ri(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=Mt(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.origin=C(),this.modelTransformation=null}};const Mit=35e3;let XX=class{constructor(e=0,i=0){this.from=e,this.to=i}get numElements(){return this.to-this.from}};function pne(t){const e=new Map;t.forAll(r=>e.set(r.from,r));let i=!0;for(;i;)i=!1,t.forEach(r=>{const n=e.get(r.to);n&&(r.to=n.to,e.delete(n.from),t.removeUnordered(n),i=!0)})}let fne=class extends XX{constructor(e,i,r){super(i,r),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.geometry.highlights!=null&&this.isVisible}get hasOccludees(){return this.geometry.occludees!=null}},$it=class{constructor(){this.first=0,this.count=0}},Iit=class{constructor(){this._numElements=0,this._instances=new Map,this.holes=new It({allocator:e=>e||new XX,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=e$(),this.drawCommandsHighlight=e$(),this.drawCommandsOccludees=e$(),this.drawCommandsShadowHighlightRest=e$()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,i){this.deleteInstance(e),this._instances.set(e,i),this._numElements+=i.numElements}deleteInstance(e){const i=this._instances.get(e);i&&(this._numElements-=i.numElements,this._instances.delete(e))}updateInstance(e,i,r){const n=this._instances.get(e);n&&(this._numElements-=n.numElements,n.from=i,n.to=r,this._numElements+=n.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;if(!this.needsMultipleCommands()){const r=this.drawCommandsDefault.pushNew(),n=this.holes.front();return this.vao!=null&&this.holes.length===1&&n.to===Math.floor(this.vao.byteSize/e)?(r.first=0,void(r.count=n.from)):(r.first=1/0,r.count=0,this._instances.forEach(s=>{r.first=Math.min(r.first,s.from),r.count=Math.max(r.count,s.to)}),void(r.count-=r.first))}const i=Array.from(this._instances.values()).sort((r,n)=>r.from===n.from?r.to-n.to:r.from-n.from);for(const r of i)r.isVisible&&(mne(r.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,r),mne(r.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,r))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function Lit(t){return t.vao!=null}function e$(){return new It({allocator:t=>t||new $it,deallocator:t=>t})}function mne(t,e){const i=t.back();if(i==null){const r=t.pushNew();return r.first=e.from,void(r.count=e.numElements)}if(Dit(i,e)){const r=e.from-i.first+e.numElements;i.count=r}else{const r=t.pushNew();r.first=e.from,r.count=e.numElements}}function Dit(t,e){return t.first+t.count>=e.from}let Nit=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach(e=>e.vao.dispose()),this.buffers.length=0}findBuffer(e){return this.buffers.find(i=>i.instances.has(e))}};const Fit=a3+1;let kit=class{constructor(e,i,r){this._rctx=e,this._locations=i,this._layout=r,this._cache=new SR(e.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(e){const i=e.toString();let r=this._cache.pop(i);return r||(r=new np(this._rctx,this._locations,{geometry:this._layout},{geometry:Ri.createVertex(this._rctx,vi.STATIC_DRAW)}),r.vertexBuffers.geometry.setSize(e),r)}deleteVao(e){if(e==null)return;const i=e.byteSize.toString();this._cache.put(i,e,Fit)}},b3=class extends B1e{constructor(e){super(e),this._vaoCache=null,this._glMaterials=null,this._bufferWriter=null,this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this.priority=0,this.produces=new Map}dispose(){this._glMaterials=et(this._glMaterials),this._dataByOrigin.forEach(e=>e.dispose()),this._dataByOrigin.clear(),this._vaoCache=et(this._vaoCache)}initializeRenderContext(e,i){const{rctx:r}=e.renderContext;this._glMaterials=new X2e(this.material,i??e.materialRepository),this._bufferWriter=this.material.createBufferWriter(),this._vaoCache=new kit(r,this.material.vertexAttributeLocations,pc(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this.material instanceof K2e}get isDecoration(){return this.material.parameters.isDecoration}get rendersOccluded(){return!this.isEmpty&&this.material.parameters.renderOccluded!==Pr.Occlude}get numGeometries(){let e=0;return this._dataByOrigin.forEach(i=>e+=i.buffers.reduce((r,n)=>r+n.instances.size,0)),e}get usedMemory(){let e=0;return this._dataByOrigin.forEach(i=>e+=i.buffers.reduce((r,n)=>r+n.vao.usedMemory,0)),e}forEachGeometry(e){this._dataByOrigin.forEach(i=>i.buffers.forEach(r=>r.instances.forEach(n=>e(n.geometry))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const i=this._bufferWriter;if(i===null)return;const r=i.vertexBufferLayout.stride/4;for(const n of e){const s=n.renderGeometry,o=this._dataByOrigin.get(s.localOrigin.id),a=o?.findBuffer(s.id);if(a==null)return;const l=a.instances.get(s.id);if(n.updateType&(ns.GEOMETRY|ns.TRANSFORMATION)){const c=r$(i.elementCount(l.geometry.geometry)*r),u=i.vertexBufferLayout.createView(c.buffer);this._writeGeometry(s,u,0),a.vao.vertexBuffers.geometry.setSubData(c,l.from*r,0,l.numElements*r)}n.updateType&(ns.HIGHLIGHT|ns.OCCLUDEE|ns.VISIBILITY)&&(a.drawCommandsDirty=!0)}}_computeDeltas(e,i){const r=new XS;for(const n of e){const s=n.localOrigin;if(s==null)continue;let o=r.get(s.id,null);o==null&&(o=new gne(s.vec3),r.set(s.id,null,o)),o.changes.push(n)}for(const n of i){const s=n.localOrigin;if(s==null)continue;const o=this._dataByOrigin.get(s.id),a=o?.findBuffer(n.id);if(a==null)continue;let l=r.get(s.id,a);l==null&&(l=new gne(s.vec3),r.set(s.id,a,l)),l.changes.push(n)}return r}_addAndRemoveGeometries(e,i){if(this._bufferWriter===null||this._vaoCache===null)return;const{_bufferWriter:r,_dataByOrigin:n}=this,s=r.vertexBufferLayout.stride/4,o=this._computeDeltas(e,i);o.forEach((a,l)=>{const c=a.get(null),u=c!=null?c.changes:[];o.delete(l,null);let d=n.get(l);if(a.forEach((p,m)=>{if(o.delete(l,m),m==null)return void Ke(!1,"No VAO for removed geometries");if(m.instances.size===p.changes.length)return this._vaoCache.deleteVao(m.vao),z3(d.buffers,m),void(d.buffers.length===0&&u.length===0&&n.delete(l));const y=m.numElements,_=m.vao.byteSize/4,v=u.reduce((S,E)=>S+r.elementCount(E.geometry),0),w=p.changes.reduce((S,E)=>S+r.elementCount(E.geometry),0),x=Math.min((y+v-w)*s,i$),T=x>_;x>l5&&x<_/2?(p.changes.forEach(({id:S})=>m.deleteInstance(S)),m.instances.forEach(({geometry:S})=>u.push(S)),this._vaoCache.deleteVao(m.vao),z3(d.buffers,m)):T?this._applyAndRebuild(m,u,p):this._applyRemoves(m,p)}),u.length>0)for(d==null&&(d=new Nit(c.origin),n.set(l,d)),d.buffers.forEach(p=>this._applyAdds(p,u));u.length>0;)d.buffers.push(this._applyAndRebuild(new Iit,u,null))})}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.buffers.forEach(i=>{i.drawCommandsDirty&&(i.hasHiddenInstances=!1,i.hasHighlights=!1,i.hasOccludees=!1,Hc(i.instances,r=>(i.updateDrawState(r),i.hasHiddenInstances&&i.hasHighlights&&i.hasOccludees)),i.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||i.hasHighlights,this._hasOccludees=this._hasOccludees||i.hasOccludees})})}_applyAndRebuild(e,i,r){if(r!=null)for(const y of r.changes)e.deleteInstance(y.id);const n=this._bufferWriter,s=n.vertexBufferLayout.stride,o=s/4,a=Math.floor(i$/o);let l=e.numElements;for(;i.length>0;){const y=i.pop(),_=n.elementCount(y.geometry);if(l+_>a&&l>0){i.push(y);break}l+=_;const v=new fne(y,0,0);Ke(e.instances.get(y.id)==null),e.addInstance(y.id,v)}const c=l*o,u=r$(c),d=n.vertexBufferLayout.createView(u.buffer);let p=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach((y,_)=>{this._writeGeometry(y.geometry,d,p);const v=p;p+=n.elementCount(y.geometry.geometry),e.updateInstance(_,v,p),e.updateDrawState(y)}),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(vne(c)),e.vao.vertexBuffers.geometry.setSubData(u,0,0,p*o),e.holes.clear();const m=e.holes.pushNew();return m.from=p,m.to=Math.floor(e.vao.byteSize/s),e.updateDrawCommands(s),e}_applyRemoves(e,i){if(i.changes.length===0||this._bufferWriter===null)return;for(const a of i.changes){const l=a.id,c=e.instances.get(l);if(!c)continue;e.deleteInstance(l);const u=_p.back();if(u){if(u.to===c.from){u.to=c.to;continue}if(u.from===c.to){u.from=c.from;continue}}const d=_p.pushNew();d.from=c.from,d.to=c.to}pne(_p);const r=this._bufferWriter.vertexBufferLayout.stride/4,n=_p.reduce((a,l)=>Math.max(a,l.numElements),0)*r,s=r$(n);s.fill(0,0,n);const o=e.vao.vertexBuffers.geometry;_p.forAll(a=>o.setSubData(s,a.from*r,0,a.numElements*r)),e.holes.pushArray(_p.data,_p.length),_p.forAll((a,l)=>_p.data[l]=null),_p.clear(),e.drawCommandsDirty=!0}_applyAdds(e,i){if(i.length===0||this._bufferWriter===null)return;if(!Lit(e))return void this._applyAndRebuild(e,i,null);const r=this._bufferWriter,n=r.vertexBufferLayout.stride/4,s=e.numElements,o=i.reduce((w,x)=>w+r.elementCount(x.geometry),0),a=Math.min((s+o)*n,i$),l=4*a;if(e.vao.byteSize<vne(i$-l5)&&l>e.vao.byteSize)return void this._applyAndRebuild(e,i,null);pne(e.holes);const c=new Array;for(const w of i){const x=r.elementCount(w.geometry),T=Uit(e.holes,x);c.push(T)}const u=e.vao.vertexBuffers.geometry;let d=0,p=0,m=0;const y=r$(a),_=r.vertexBufferLayout.createView(y.buffer);i.forEach((w,x)=>{const T=c[x];if(T==null)return;if(m!==T){const A=m-p;A>0&&u.setSubData(y,p*n,0,A*n),p=T,d=0}const S=r.elementCount(w.geometry);this._writeGeometry(w,_,d),d+=S,m=T+S;const E=new fne(w,T,T+S);Ke(e.instances.get(w.id)==null),e.addInstance(w.id,E),e.drawCommandsDirty=!0});const v=m-p;v>0&&u.setSubData(y,p*n,0,v*n),TOe(i,(w,x)=>c[x]==null)}_writeGeometry(e,i,r){if(this._bufferWriter===null)return;const n=e.localOrigin.vec3;R7e(yne,-n[0],-n[1],-n[2]);const s=Di(zit,yne,e.transformation);qn(t$,s),sc(t$,t$),this._bufferWriter.write(s,t$,e.geometry,i,r)}updateAnimation(e){return this.material.update(e)}prepareTechnique(e){if(!this.material.shouldRender(e))return null;const{output:i,bindParameters:r}=e;if(!this.material.produces(r.slot,i))return null;const n=i===U.Highlight||i===U.ShadowHighlight;if(n&&!this._hasHighlights)return null;const s=i===U.ShadowExcludeHighlight,o=!(n||s);for(const a of this._dataByOrigin.values())for(const l of a.buffers){if(n&&!l.hasHighlights)continue;const c=(n?l.drawCommandsHighlight:s&&l.needsMultipleCommands()?l.drawCommandsShadowHighlightRest:l.drawCommandsDefault)||null,u=o&&l.drawCommandsOccludees||null;if(c?.length||u?.length){const d=this._glMaterials.load(e.rctx,r.slot,i),p=d!=null?d.beginSlot(r):null;if(p!=null)return p}}return null}renderNode(e,i){const{output:r,bindParameters:n}=e,s=r===U.Highlight||r===U.ShadowHighlight,o=r===U.ShadowExcludeHighlight,a=!(s||o),l=e.rctx,c=e.bindParameters.slot===ae.OCCLUDER_MATERIAL,u=e.bindParameters.slot===ae.TRANSPARENT_OCCLUDER_MATERIAL;l.runAppleAmdDriverHelper(),l.bindTechnique(i,this.material.parameters,n);for(const d of this._dataByOrigin.values())for(const p of d.buffers){if(s&&!p.hasHighlights)continue;const m=(s?p.drawCommandsHighlight:o&&p.needsMultipleCommands()?p.drawCommandsShadowHighlightRest:p.drawCommandsDefault)||null,y=a&&p.drawCommandsOccludees||null;(m?.length||y?.length)&&(i.program.bindDraw(new uj(d.origin),n,this.material.parameters),i.ensureAttributeLocations(p.vao),l.bindVAO(p.vao),m?.length&&(l.setPipelineState(i.getPipeline(!1,c,u)),m.forAll(_=>l.drawArrays(i.primitiveType,_.first,_.count))),y?.length&&(l.setPipelineState(i.getPipeline(!0,c,u)),y.forAll(_=>l.drawArrays(i.primitiveType,_.first,_.count))))}}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}};h([f({constructOnly:!0})],b3.prototype,"material",void 0),b3=h([z("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],b3);let gne=class{constructor(e){this.origin=e,this.changes=new Array}};function Uit(t,e){let i;if(!t.some(n=>!(n.numElements<e)&&(i=n,!0)))return null;const r=i.from;return i.from+=e,i.from>=i.to&&t.removeUnordered(i),r}const yne=be(),zit=be(),t$=be(),_p=new It({allocator:t=>t||new XX,deallocator:null}),l5=65536,h8=4*l5,_ne=1024,eTe=16777216,i$=eTe/4;let d8=new Float32Array(l5);function r$(t){return d8.length<t&&(d8=new Float32Array(t)),d8}function vne(t){const e=4*t;return e<=_ne?_ne:e<h8?Qde(e):Math.max(Math.min(Math.ceil(1.5*e/h8)*h8,eTe),e)}let Ic=class extends xe{constructor(e){super(e),this._pending=new Bit,this._changes=new cj,this._materialRenderers=new It,this._sortedMaterialRenderers=new It,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forAll(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._materialRenderers.some(e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.length===0&&this._geometries.size===0}getMemoryForMaterial(e){return e==null?0:this._materialRenderers.find(r=>r.material===e)?.usedMemory??0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=Y2e(this._changes);let i=!1,r=!1,n=!1;return e.forEach((s,o)=>{let a=this._materialRenderers.find(u=>u.material===o);if(!a&&s.adds.length>0){const u=new b3({material:o});u.initializeRenderContext(this.rendererContext.pluginContext,this._materialRepository),a=u,this._materialRenderers.push(a),i=!0,r=!0,n=!0}if(!a)return;const l=r||a.hasHighlights,c=n||a.hasWater;a.modify(s),r=r||l!==a.hasHighlights,n=n||c!==a.hasWater,a.isEmpty&&(this._materialRenderers.removeUnordered(a),a.dispose(),i=!0)}),this._changes.clear(),i&&this._updateSortedMaterialRenderers(),r&&(this._hasHighlights=this._materialRenderers.some(s=>s.hasHighlights)),n&&(this._hasWater=this._materialRenderers.some(s=>s.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,i){if(e.length===0)return;const r=this._validateRenderGeometries(e);for(const s of r)this._geometries.set(s.id,s);const n=this._pending.empty;for(const s of r)this._pending.adds.add(s);n&&this.notifyChange("updating"),i===kr.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,i){const r=this._pending.empty,n=this._pending.adds;for(const s of e)n.has(s)?(this._pending.removed.add(s),n.delete(s)):this._pending.removed.has(s)||this._pending.removes.add(s),this._geometries.delete(s.id);r&&!this._pending.empty&&this.notifyChange("updating"),i===kr.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,i){const r=this._changes.updates.length===0;for(const n of e){const s=this._changes.updates.pushNew();s.renderGeometry=this._validateRenderGeometry(n),s.updateType=i}switch(r&&this._changes.updates.length>0&&this.notifyChange("updating"),i){case ns.TRANSFORMATION:case ns.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case ns.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let i=!1;return this._sortedMaterialRenderers.forAll(r=>i=r.updateAnimation(e)||i),i}shouldRender(e){return this._sortedMaterialRenderers.some(i=>i.prepareTechnique(e))}render(e){this._sortedMaterialRenderers.forAll(i=>{const r=i.prepareTechnique(e);r!=null&&i.renderNode(e,r)})}intersect(e,i,r,n,s){return this._geometries.forEach(o=>{if(n&&!n(o))return;this._intersectRenderGeometry(o,r,i,0,e,s);const a=this.rendererContext.longitudeCyclical;a&&(o.boundingSphere[0]-o.boundingSphere[3]<a.min&&this._intersectRenderGeometry(o,r,i,a.range,e,s),o.boundingSphere[0]+o.boundingSphere[3]>a.max&&this._intersectRenderGeometry(o,r,i,-a.range,e,s)),s++}),s}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear(),this._materialRenderers.forAll((e,i)=>{e.priority=i,this._sortedMaterialRenderers.push(e)}),this._sortedMaterialRenderers.sort((e,i)=>i.material.renderPriority===e.material.renderPriority?e.priority-i.priority:i.material.renderPriority-e.material.renderPriority)}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const i=this._changes.updates.data[e];this._pending.has(i.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,i,r,n,s,o){if(!e.visible)return;let a=0;n+=e.transformation[12],a=e.transformation[13],p8[0]=r[0]-n,p8[1]=r[1]-a,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,s,p8,(l,c,u)=>{Vit(i,u,e.material.renderPriority,o,s,e.layerUid,e.graphicUid)},i)}_notifyGraphicGeometryChanged(e){if(this.drapeSource.notifyGraphicGeometryChanged==null)return;let i;for(const r of e){const n=r.graphicUid;n!=null&&n!==i&&(this.drapeSource.notifyGraphicGeometryChanged(n),i=n)}}_notifyGraphicVisibilityChanged(e){if(this.drapeSource.notifyGraphicVisibilityChanged==null)return;let i;for(const r of e){const n=r.graphicUid;n!=null&&n!==i&&(this.drapeSource.notifyGraphicVisibilityChanged(n),i=n)}}_validateRenderGeometries(e){for(const i of e)this._validateRenderGeometry(i);return e}_validateRenderGeometry(e){return e.localOrigin==null&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};h([f()],Ic.prototype,"drapeSource",void 0),h([f()],Ic.prototype,"updating",null),h([f()],Ic.prototype,"rctx",null),h([f({constructOnly:!0})],Ic.prototype,"rendererContext",void 0),h([f()],Ic.prototype,"_materialRepository",null),h([f()],Ic.prototype,"_localOriginFactory",null),h([f({readOnly:!0})],Ic.prototype,"isEmpty",null),h([f()],Ic.prototype,"_materialRenderers",void 0),h([f()],Ic.prototype,"_geometries",void 0),Ic=h([z("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Ic);let Bit=class{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};function Vit(t,e,i,r,n,s,o){const a=new vit(s,o,e),l=c=>{c.set(Ur.OVERLAY,a,t.dist,t.normal,t.transformation,i,r)};if((n.results.min.drapedLayerOrder==null||i>=n.results.min.drapedLayerOrder)&&(n.results.min.dist==null||n.results.ground.dist<=n.results.min.dist)&&l(n.results.min),n.options.store!==ho.MIN&&(n.results.max.drapedLayerOrder==null||i<n.results.max.drapedLayerOrder)&&(n.results.max.dist==null||n.results.ground.dist>n.results.max.dist)&&l(n.results.max),n.options.store===ho.ALL){const c=KW(n.ray);l(c),n.results.all.push(c)}}const p8=Ue();let ZX=class tTe extends Ci{initializeProgram(e){return new wi(e.rctx,tTe.shader.get().build(),fi)}initializePipeline(){return this.configuration.hasAlpha?Ot({blending:fo(Te.SRC_ALPHA,Te.ONE,Te.ONE_MINUS_SRC_ALPHA,Te.ONE_MINUS_SRC_ALPHA),colorWrite:Ft}):Ot({colorWrite:Ft})}};ZX.shader=new bi(Wet,()=>pe(()=>import("./TextureOnly.glsl-6d84aef3.js"),[],import.meta.url));let JX=class extends bl{constructor(){super(...arguments),this.hasAlpha=!1}};h([V()],JX.prototype,"hasAlpha",void 0);let iTe=class extends Ki{constructor(){super(...arguments),this.overlayIndex=zn.INNER,this.opacity=1}};function Git(){const t=new mi;return t.include(ha),t.fragment.uniforms.add(new Je("tex",e=>e.texture)),t.fragment.uniforms.add(new zR("overlayIdx",e=>e.overlayIndex)),t.fragment.uniforms.add(new Oe("opacity",e=>e.opacity)),t.fragment.code.add(b`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;
}`),t}const jit=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:iTe,build:Git},Symbol.toStringTag,{value:"Module"}));let rTe=class nTe extends Ci{initializeProgram(e){return new wi(e.rctx,nTe.shader.get().build(),fi)}initializePipeline(){return Ot({blending:cc(Te.ONE,Te.ONE_MINUS_SRC_ALPHA),colorWrite:Ft})}};rTe.shader=new bi(jit,()=>pe(()=>import("./OverlayCompositing.glsl-59f94f84.js"),[],import.meta.url));let rd=class extends fw{get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new iTe,this.hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new It,this._passParameters=new _2e,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new ht,this.worldToPCSRatio=1,this.events=new Tn,this.longitudeCyclical=null,this.produces=new Map([[ae.DRAPED_MATERIAL,i=>i!==U.Highlight||this.hasHighlights],[ae.DRAPED_WATER,()=>!0]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const e=this.view._stage.renderer.fboCache,i=this.view._stage.renderView,{waterTextureRepository:r,stippleTextureRepository:n,markerTextureRepository:s}=i;this._shaderTechniqueRepository=new v2e({rctx:this._rctx,viewingMode:Me.Local,stippleTextureRepository:n,markerTextureRepository:s,waterTextureRepository:r}),this._renderContext=new q2e(this._rctx,new WX(e,this.view.state.viewingMode),null),this.addHandles([le(()=>r.updating,()=>this.events.emit("content-changed"),Yi),le(()=>this.spatialReference,o=>this._localOriginFactory=new qX(o),Yi),Io(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new b2e(i.textureRepository,this._shaderTechniqueRepository,o=>{(o.parameters.renderOccluded&c5)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed")),this._bindParameters.slot=ae.DRAPED_MATERIAL,this._bindParameters.mainDepth=IGe(this._rctx),this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=Qe.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new xY(Ce(1,1,1))]),this.addHandles(this.view.resourceController.scheduler.registerTask(ut.STAGE,this))}destroy(){this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._debugTextureTechnique=Jt(this._debugTextureTechnique),this._passParameters.texture=et(this._passParameters.texture),this._bindParameters.mainDepth=et(this._bindParameters.mainDepth),this._shaderTechniqueRepository=Pe(this._shaderTechniqueRepository),this.disposeOverlays()}initializeRenderContext(e){this.pluginContext=e}uninitializeRenderContext(){}renderNode(){}get updating(){return this._sortedDrapeSourceRenderersDirty||Hc(this._renderers,e=>e.updating)}get hasOverlays(){return this._overlays!=null&&this._renderTargets!=null}getMemoryForMaterial(e){return Array.from(this._renderers.values()).reduce((i,r)=>i+r.getMemoryForMaterial(e),0)}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,Ic)}createDrapeSourceRenderer(e,i,r){const n=this._renderers.get(e);n?.destroy();const s=new i({...r,rendererContext:this,drapeSource:e});return this._renderers.set(e,s),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles(le(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),s}removeDrapeSourceRenderer(e){if(e==null)return;const i=this._renderers.get(e);i!=null&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),i.destroy())}computeValidity(){return this._renderTargets?.computeValidity()??0}releaseRenderTargets(){this._renderTargets?.dispose()}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&gI(e,i=>i.drapeTargetType===sj.WithoutRasterImage)}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=gI(e,i=>i.drapeSourceType===y3.Features),this._hasDrapedRasterSource=gI(e,i=>i.drapeSourceType===y3.RasterImage)):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,i,r=this._bindParameters.overlayStretch){this._overlays==null&&(this._renderTargets=new Net(this.view._stage.renderer.fboCache),this._overlays=[new qre,new qre]),this.ensureDrapeTargets(e),this.ensureDrapeSources(i),this._bindParameters.overlayStretch=r}disposeOverlays(){this._overlays=null,this._renderTargets=et(this._renderTargets),this.events.emit("textures-disposed")}getTexture(e){if(e!=null)return e===$r.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?this._renderTargets?.getTexture($r.Color):this._renderTargets?.getTexture(e)}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,i){let r=!1;for(const[n,s]of this._renderers){if(e.done)break;(n.destroyed||i(n))&&s.commitChanges()&&(r=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers()),r&&(this._overlays!=null&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=Hc(this._renderers,n=>n.hasHighlights),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(Da,e=>e.updatePolicy===Xy.SYNC)}get isEmpty(){return!nr.OVERLAY_DRAW_DEBUG_TEXTURE&&!Hc(this._renderers,e=>!e.isEmpty)}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}get mode(){return this.isEmpty?gf.Disabled:this._renderTargets?.getTexture($r.WaterNormal)?gf.EnabledWithWater:this._renderTargets?.getTexture($r.Color)?gf.Enabled:gf.Disabled}updateAnimation(e){let i=!1;return this._renderers.forEach(r=>i=r.updateAnimation(e)||i),i}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawOverlays(e){if(this._overlays&&this._renderTargets){for(const i of this._overlays)this.longitudeCyclical?i.setupGeometryViewsCyclical(this.longitudeCyclical):i.setupGeometryViewsDirect();for(const i of this._renderTargets.targets)(i.content!==$r.ColorNoRasterImage||this._needsColorWithoutRasterImage)&&(this._drawTarget(zn.INNER,i,e),this._drawTarget(zn.OUTER,i,e))}}_drawTarget(e,i,r){const n=this._overlays[e],s=n.canvasGeometries;if(s.numViews===0)return;const{alignPixelEnabled:o,contentPixelRatio:a}=r;this._screenToWorldRatio=a*n.mapUnitsPerPixel/this._bindParameters.overlayStretch;const l=i.output;if(this.isEmpty||l===U.Highlight&&!this.hasHighlights||l===U.Normal&&!this.hasWater||!n.hasSomeSizedView())return;const c=this._rctx;this._camera.pixelRatio=n.pixelRatio*a,this._renderContext.output=l,this._bindParameters.alignPixelEnabled=o,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=l===U.Normal?ae.DRAPED_WATER:ae.DRAPED_MATERIAL;const u=nr.OVERLAY_DRAW_DEBUG_TEXTURE&&i.content!==$r.Occluded;if(!u&&!this._sortedRenderers.some(({renderer:_})=>_.shouldRender(this._renderContext)))return;const d=n.resolution;this._rctx.setViewport(e===zn.INNER?0:d,0,d,d);const p=2*n.resolution,m=n.resolution,y=i.fbo;if(y.bind(c,p,m),e===zn.INNER&&(c.setClearColor(0,0,0,0),c.clearSafe(hr.COLOR_BUFFER_BIT)),i.content===$r.Occluded&&(this._renderContext.renderOccludedMask=c5),u)for(let _=0;_<s.numViews;_++)this._setViewParameters(s.extents[_],n),this._ensureDebugPatternResources(n.resolution,qit[e]),this._rctx.bindTechnique(this._debugTextureTechnique,this._passParameters,null),this._rctx.screen.draw();this._sortedRenderers.forAll(({drapeSource:_,renderer:v})=>{if(i.content===$r.ColorNoRasterImage&&_.drapeSourceType===y3.RasterImage)return;const{fullOpacity:w}=_,x=w!=null&&w<1&&l===U.Color?this.bindTemporaryFramebuffer(p,m):null;for(let T=0;T<s.numViews;T++)this._setViewParameters(s.extents[T],n),v.render(this._renderContext);if(x){y.bind(c,p,m),this._overlayParameters.texture=x.colorTexture,this._overlayParameters.opacity=w,this._overlayParameters.overlayIndex=e;const T=this.pluginContext.techniqueRepository.acquire(rTe);this._rctx.bindTechnique(T,this._overlayParameters,this._renderContext.bindParameters),this._rctx.screen.draw(),T.release(),x.release()}}),c.bindFramebuffer(null),e===zn.OUTER&&y.generateMipMap(),this._renderContext.resetRenderOccludedMask()}bindTemporaryFramebuffer(e,i){const r=this.view._stage.renderer.fboCache,n=r.acquire(hi.RGBA,e,i);return r.rctx.bindFramebuffer(n.fbo),r.rctx.clearSafe(hr.COLOR_BUFFER_BIT),n}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,i,r,n){let s=0;for(const o of this._renderers.values())s=o.intersect?.(e,i,r,n,s)??s}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers;this._renderers.forEach((i,r)=>{const n=e.indexOf(r.layer),s=n>=0,o=this._renderers.size*(r.renderGroup??(s?i5.MapLayer:i5.ViewLayer))+(s?n:0);this._sortedRenderers.push(new Hit(r,i,o))}),this._sortedRenderers.sort((i,r)=>i.index-r.index)}_setViewParameters(e,i){const r=this._camera;r.viewport=[0,0,i.resolution,i.resolution],fpe(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),cR(r.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=Hc(this._renderers,i=>i.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateRendersOccluded(){const e=Hc(this._renderers,i=>i.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_ensureDebugPatternResources(e,i){if(oe(this._passParameters.color,i[0],i[1],i[2]),this._passParameters.texture)return;const r=new Uint8Array(e*e*4);let n=0;for(let a=0;a<e;a++)for(let l=0;l<e;l++){const c=Math.floor(l/10),u=Math.floor(a/10);c<2||u<2||10*c>e-20||10*u>e-20?(r[n++]=255,r[n++]=255,r[n++]=255,r[n++]=255):(r[n++]=255,r[n++]=255,r[n++]=255,r[n++]=1&c&&1&u?1&l^1&a?0:255:1&c^1&u?0:128)}const s=new Li(e);s.samplingMode=Lt.NEAREST,this._passParameters.texture=new Pt(this._rctx,s,r);const o=new JX;o.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(ZX,o)}get test(){return{drapedRenderers:Array.from(this._renderers.values()),getDrapeSourceRenderer:e=>this._renderers.get(e)}}};h([f()],rd.prototype,"hasHighlights",void 0),h([f()],rd.prototype,"_sortedDrapeSourceRenderersDirty",void 0),h([f({autoDestroy:!0})],rd.prototype,"_shaderTechniqueRepository",void 0),h([f({constructOnly:!0})],rd.prototype,"view",void 0),h([f()],rd.prototype,"worldToPCSRatio",void 0),h([f()],rd.prototype,"spatialReference",void 0),h([f({type:Boolean,readOnly:!0})],rd.prototype,"updating",null),h([f()],rd.prototype,"isEmpty",null),rd=h([z("esri.views.3d.terrain.OverlayRenderer")],rd);let Hit=class{constructor(e,i,r){this.drapeSource=e,this.renderer=i,this.index=r}};const qit=[[1,.5,.5],[.5,.5,1]],KX=-2,c5=Pr.OccludeAndTransparent;function QX(t,e,i,r){const n=jR(t.rings,!!t.hasZ,kf.CCW_IS_HOLE,t.spatialReference),s=Vs(n.position.length),o=Dwe(n.position,t.spatialReference,0,s,0,n.position,0,n.position.length/3,e,i,r),a=o!=null;return new Xit(n.position,s,aTe(n.polygons,n.position,s),oTe(n.outlines,n.position,s),a,o)}function sTe(t,e){const i=jR(t.rings,!1,kf.CCW_IS_HOLE),r=jr(i.position,t.spatialReference,0,i.position,e,0,i.position.length/3);for(let n=2;n<i.position.length;n+=3)i.position[n]=KX;return{position:i.position,polygons:aTe(i.polygons,i.position),outlines:oTe(i.outlines,i.position),projectionSuccess:r}}function oTe(t,e,i=null){return t.filter(({count:r})=>r>1).map(({index:r,count:n})=>{const s=3*r,o=3*n;return i!=null?new lTe(r,n,ah(e,s,o),ah(i,s,o)):new eZ(r,n,ah(e,s,o))})}function aTe(t,e,i=null){const r=new Array;for(const{index:n,count:s,holeIndices:o,pathLengths:a}of t){if(s<=1)continue;const l=3*n,c=3*s,u=o.map(p=>p-n),d=i!=null?new Wit(n,s,ah(e,3*n,3*s),ah(i,l,c),u,a):new Yit(n,s,ah(e,3*n,3*s),u,a);r.push(d)}return r}let eZ=class{constructor(e,i,r){this.index=e,this.count=i,this.position=r}},lTe=class extends eZ{constructor(e,i,r,n){super(e,i,r),this.mapPositions=n}},Wit=class extends lTe{constructor(e,i,r,n,s,o){super(e,i,r,n),this.holeIndices=s,this.pathLengths=o}},Yit=class extends eZ{constructor(e,i,r,n,s){super(e,i,r),this.holeIndices=n,this.pathLengths=s}},Xit=class{constructor(e,i,r,n,s,o){this.position=e,this.mapPositions=i,this.polygons=r,this.outlines=n,this.projectionSuccess=s,this.sampledElevation=o}};function qb(t,e,i,r,n,s=2){const o=1/(Math.abs(i)+Math.abs(r)+Math.abs(n)),a=i*o,l=r*o,c=n<=0?(a>=0?1:-1)*(1-Math.abs(l)):a,u=n<=0?(l>=0?1:-1)*(1-Math.abs(a)):l,d=e*s;t[d]=bne(c),t[d+1]=bne(u)}function Zit(t){const e=t.length/3,i=new Int16Array(2*e);let r=0;for(let n=0;n<e;++n)qb(i,n,t[r++],t[r++],t[r++]);return i}function Jit(t,e,i,r=2){const n=i*r,s=wne(e[n]),o=wne(e[n+1]),a=1-Math.abs(s)-Math.abs(o);t[2]=a,a<0?(t[0]=(s>=0?1:-1)*(1-Math.abs(o)),t[1]=(o>=0?1:-1)*(1-Math.abs(s))):(t[0]=s,t[1]=o),ge(t,t)}function bne(t){return _e(Math.round(32767*t),-32767,32767)}function wne(t){return _e(t/32767,-1,1)}const Kit=["polygon","extent"];let Qit=class extends Qf{constructor(e,i,r,n){super(e,i,r,n),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const a=QF(this._getSymbolSize());if(a)throw new W("graphics3dextrudesymbollayer:invalid-size",a)}const e=this.symbolLayer?.material?.color,i=this._getCombinedOpacityAndColor(e),r=Xo(i),n=i[3],s=n<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:r,ambient:r,opacity:n,transparent:s,cullFace:s?dr.None:dr.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0,normalType:Ei.Compressed};this._materials[Lc.Main]=new Jd(o),this._materials[Lc.Bottom]=new Jd({...o,cullFace:dr.Back}),this._context.stage.addMany(this._materials)}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,Kit,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),n=this.setGraphicElevationContext(i);return this._createAs3DShape(i,e.renderingInfo,r,n,i.uid)}layerOpacityChanged(e,i){const r=this.symbolLayer?.material?.color,n=this._getCombinedOpacity(r),s=n<1||this.needsDrivenTransparentPass;this._materials[Lc.Main]?.setParameters({opacity:n,transparent:s}),this._materials[Lc.Bottom]?.setParameters({opacity:n,transparent:s});const o=this._getLayerOpacity();e.forEach(a=>{const l=i(a);l?.layerOpacityChanged(o,this._context.isAsync)})}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,g_)}slicePlaneEnabledChanged(e,i){return this._materials[Lc.Main]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._materials[Lc.Bottom]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach(r=>{const n=i(r);n?.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const e={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0};return this._materials[Lc.Main]?.setParameters(e),this._materials[Lc.Bottom]?.setParameters(e),!0}_getExtrusionSize(e){let i;return i=e.size&&this._drivenProperties.size?Tet(e.size,2)??0:this._getSymbolSize(),i/=this._context.renderCoordsHelper.unitInMeters,i}applyRendererDiff(e,i){return this._drivenPropertiesChanged(i)?Dn.RecreateSymbol:Dn.RecreateGraphics}async queryForSnapping(e,i,r,n){const s=this._getExtrusionSize(r)*this._context.renderCoordsHelper.unitInMeters/FD(i),{objectId:o,target:a}=e,l=ye(a);switch(l.z=(l.z??0)+s,e.type){case"edge":{const{start:c,end:u}=e,d=ye(c),p=ye(u);return d.z=(d.z??0)+s,p.z=(p.z??0)+s,[Bre(o,l,1/0,d,p)]}case"vertex":return[oet(o,l,1/0),Bre(o,a,1/0,a,l)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,i,r,n,s){const o=OO(e.geometry);if(o==null)return null;if(o.rings.length===0||!o.rings.some(N=>N.length>0))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;const a=QX(o,this._context.elevationProvider,this._context.renderCoordsHelper,n);this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer");const l=yX(o);if(l==null)return null;const c=new Array,u=new Array,d=ds(),p=be(),m=C(),y=this._context.renderCoordsHelper.viewingMode===Me.Global;y||this._context.renderCoordsHelper.worldUpAtPosition(null,m),ic(o.spatialReference,[l.x,l.y,0],p,this._context.renderCoordsHelper.spatialReference);const _=be();qn(_,p);const v=Hr();Ag(v,_);const{polygons:w,mapPositions:x,position:T}=a;for(const N of w){const F=N.count;if(this._context.clippingExtent&&(vr(d),Zc(d,N.mapPositions),!Pd(d,this._context.clippingExtent)))continue;const D=gS(N.mapPositions,N.holeIndices,3);if(D.length===0)continue;const $=D.length,R=6*F,k=IN(R+$),B=IN($),j=Vs(3*R),X=Vs(3*R),M=Vs(3*R),I=Vs(R);ert(T,x,D,N,j,M,X,I,k,B,this._getExtrusionSize(i),m,y),Qd(j,j,_);const G=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),q=new srt(j,M,Zit(X),I);c.push(xne(this._materials[Lc.Main],k,k.length-B.length,q,r,G),xne(this._materials[Lc.Bottom],B,0,q,r,G)),u.push(q.heights)}if(c.length===0)return null;const S=new Yg({geometries:c,layerUid:this._context.layer.uid,graphicUid:s,isElevationSource:!0});S.transformation=p;const E=Jwe(this.symbolLayer,{opacity:this._getLayerOpacity()}),A=E!=null?{baseMaterial:this._materials[Lc.Main],edgeMaterials:[E],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,P=new Kf(this,S,c,null,null,(N,F,D,$,R)=>rrt(N,F,D,$,R,u),n,A);return P.alignedSampledElevation=a.sampledElevation,P.needsElevationUpdates=g_(n.mode),P}};function xne(t,e,i,r,n,s){const o=M_(e.length),a=[[O.POSITION,new ke(r.positions,e,3,!0)],[O.NORMALCOMPRESSED,new ke(r.normals,e,2,!0)],[O.COLOR,new ke(n,o,4,!0)]];return new Wn(t,a,r.elevation,on.Mesh,s,i)}function ert(t,e,i,r,n,s,o,a,l,c,u,d,p){const m=i.length/3;let y=0,_=2*r.count;trt(t,e,r.index,r.count,i,0,m,n,s,o,a,l,c,_,u,d,p);let v=2*r.count;_=0,Tne(n,s,a,o,y,r.pathLengths[0],r.count,v,l,_,u),v+=4*r.pathLengths[0],_+=2*r.pathLengths[0],y+=r.pathLengths[0];for(let w=1;w<r.pathLengths.length;++w)Tne(n,s,a,o,y,r.pathLengths[w],r.count,v,l,_,u),v+=4*r.pathLengths[w],_+=2*r.pathLengths[w],y+=r.pathLengths[w]}function trt(t,e,i,r,n,s,o,a,l,c,u,d,p,m,y,_,v){se(Xa,_);const w=y>0?1:-1;let x=3*i,T=0,S=3*T,E=r,A=3*E;for(let F=0;F<r;++F)v&&(Xa[0]=t[x],Xa[1]=t[x+1],Xa[2]=t[x+2],ge(Xa,Xa)),a[S]=t[x],a[S+1]=t[x+1],a[S+2]=t[x+2],l[S]=e[x],l[S+1]=e[x+1],l[S+2]=e[x+2],c[S]=-w*Xa[0],c[S+1]=-w*Xa[1],c[S+2]=-w*Xa[2],u[T]=0,a[A]=t[x]+y*Xa[0],a[A+1]=t[x+1]+y*Xa[1],a[A+2]=t[x+2]+y*Xa[2],l[A]=e[x],l[A+1]=e[x+1],l[A+2]=e[x+2],c[A]=w*Xa[0],c[A+1]=w*Xa[1],c[A+2]=w*Xa[2],u[E]=y,S+=3,A+=3,x+=3,T+=1,E+=1;x=3*s,S=0,A=3*m;const P=y<0?Rne:One,N=y<0?One:Rne;for(let F=0;F<o;++F)p[S]=n[x+P[0]],p[S+1]=n[x+P[1]],p[S+2]=n[x+P[2]],d[A]=n[x+N[0]]+r,d[A+1]=n[x+N[1]]+r,d[A+2]=n[x+N[2]]+r,S+=3,A+=3,x+=3}function n$(t,e,i,r,n,s,o){r[s]=r[o],o*=3,t[s*=3]=t[o],t[s+1]=t[o+1],t[s+2]=t[o+2],e[s]=e[o],e[s+1]=e[o+1],e[s+2]=e[o+2],i[s]=n[0],i[s+1]=n[1],i[s+2]=n[2]}const VE=C();function Tne(t,e,i,r,n,s,o,a,l,c,u){let d=n,p=n+1,m=n+o,y=n+o+1,_=a,v=a+1,w=a+2*s,x=a+2*s+1;u<0&&(d=n+o+1,y=n),c*=3;for(let T=0;T<s;++T)T===s-1&&(u>0?(p=n,y=n+o):(p=n,d=n+o)),irt(t,d,p,m,VE),n$(t,e,r,i,VE,_,d),n$(t,e,r,i,VE,v,p),n$(t,e,r,i,VE,w,m),n$(t,e,r,i,VE,x,y),l[c++]=_,l[c++]=w,l[c++]=x,l[c++]=_,l[c++]=x,l[c++]=v,d++,p++,m++,y++,_+=2,v+=2,w+=2,x+=2}const f8=C(),Sne=C(),Ene=C(),Cne=C(),Ane=C();function irt(t,e,i,r,n){e*=3,i*=3,r*=3,oe(f8,t[e++],t[e++],t[e++]),oe(Sne,t[i++],t[i++],t[i++]),oe(Ene,t[r++],t[r++],t[r++]),he(Cne,Sne,f8),he(Ane,Ene,f8),nt(n,Ane,Cne),ge(n,n)}const ax=C();function rrt(t,e,i,r,n,s){const o=t.stageObject,a=o.geometries,l=a.length,c=e.mode!=="absolute-height";let u=0;const d=o.transformation,p=$S(be(),d);for(let m=0;m<l;m+=2){const y=a[m];if(!vX(y))continue;const _=y.getMutableAttribute(O.POSITION).data,v=s[m/2],w=new eY(y.mapPositions),x=_.length/3;let T=0,S=!1,E=0;for(let A=0;A<x;A++){ax[0]=_[T],ax[1]=_[T+1],ax[2]=_[T+2],r(w,s$),c&&(E+=s$.sampledElevation),nr.TESTS_DISABLE_OPTIMIZATIONS?(oe(Cl,w.array[w.offset],w.array[w.offset+1],s$.z+v[T/3]),i!=null&&n.toRenderCoords(Cl,i,Cl),Fe(Cl,Cl,p)):(oe(Cl,_[T],_[T+1],_[T+2]),Fe(Cl,Cl,d),n.setAltitude(Cl,s$.z+v[T/3]),Fe(Cl,Cl,p)),_[T]=Cl[0],_[T+1]=Cl[1],_[T+2]=Cl[2];const P=nrt/n.unitInMeters;(Math.abs(ax[0]-_[T])>=P||Math.abs(ax[1]-_[T+1])>=P||Math.abs(ax[2]-_[T+2])>=P)&&(S=!0),w.offset+=3,T+=3}S&&(y.invalidateBoundingInfo(),o.geometryVertexAttributeUpdated(a[m],O.POSITION),a[m+1].invalidateBoundingInfo(),o.geometryVertexAttributeUpdated(a[m+1],O.POSITION)),u+=E/x}return u/l}const Cl=C(),Xa=C(),s$=new kR,One=[0,2,1],Rne=[0,1,2],nrt=.01;var Lc;(function(t){t[t.Main=0]="Main",t[t.Bottom=1]="Bottom"})(Lc||(Lc={}));class srt{constructor(e,i,r,n){this.positions=e,this.elevation=i,this.normals=r,this.heights=n}}var Pne,Mne,hj={exports:{}};hj.exports,Mne=function(){function t(n,s){function o(){this.constructor=n}o.prototype=s.prototype,n.prototype=new o}function e(n,s,o,a){var l=Error.call(this,n);return Object.setPrototypeOf&&Object.setPrototypeOf(l,e.prototype),l.expected=s,l.found=o,l.location=a,l.name="SyntaxError",l}function i(n,s,o){return o=o||" ",n.length>s?n:(s-=n.length,n+(o+=o.repeat(s)).slice(0,s))}function r(n,s){var o,a={},l=(s=s!==void 0?s:{}).grammarSource,c={start:im},u=im,d="none",p=")",m=",",y="(",_="%",v="px",w="cm",x="mm",T="in",S="pt",E="pc",A="deg",P="rad",N="grad",F="turn",D="#",$=".",R="e",k=/^[ \t\n\r]/,B=/^[a-z\-]/,j=/^[0-9a-fA-F]/,X=/^[+\-]/,M=/^[0-9]/,I=Va("none"),G=Es("none",!1),q=Es(")",!1),Z=Es(",",!1),K=Va("whitespace"),Q=U_([" ","	",`
`,"\r"],!1,!1),de=Va("function"),Ae=Es("(",!1),st=Va("identifier"),vt=U_([["a","z"],"-"],!1,!1),ot=Va("percentage"),gt=Es("%",!1),ze=Va("length"),ue=Es("px",!1),xt=Es("cm",!1),ve=Es("mm",!1),De=Es("in",!1),tt=Es("pt",!1),mt=Es("pc",!1),bt=Va("angle"),At=Es("deg",!1),Ve=Es("rad",!1),Tt=Es("grad",!1),jt=Es("turn",!1),$i=Va("number"),ct=Va("color"),dt=Es("#",!1),at=U_([["0","9"],["a","f"],["A","F"]],!1,!1),Ht=U_(["+","-"],!1,!1),zt=U_([["0","9"]],!1,!1),fr=Es(".",!1),Bi=Es("e",!1),ei=function(){return[]},xi=function(Y,fe){return{type:"function",name:Y,parameters:fe||[]}},wr=function(Y,fe){return fe.length>0?nE(Y,fe,3):[Y]},mr=function(Y){return{type:"quantity",value:Y.value,unit:Y.unit}},gr=function(Y){return{type:"color",colorType:Y.type,value:Y.value}},Ai=function(Y){return Y},Lr=function(){return wl()},ki=function(Y){return{value:Y,unit:"%"}},sr=function(Y){return{value:Y,unit:"px"}},Qi=function(Y){return{value:Y,unit:"cm"}},ci=function(Y){return{value:Y,unit:"mm"}},or=function(Y){return{value:Y,unit:"in"}},Dr=function(Y){return{value:Y,unit:"pt"}},Ys=function(Y){return{value:Y,unit:"pc"}},Xs=function(Y){return{value:Y,unit:"deg"}},Zs=function(Y){return{value:Y,unit:"rad"}},Js=function(Y){return{value:Y,unit:"grad"}},qr=function(Y){return{value:Y,unit:"turn"}},Nr=function(Y){return{value:Y,unit:null}},Vi=function(){return{type:"hex",value:wl()}},Ts=function(Y){return{type:"function",value:Y}},_o=function(){return{type:"named",value:wl()}},da=function(){return parseFloat(wl())},re=0,xr=0,$h=[{line:1,column:1}],Ss=0,Ih=[],Xe=0;if("startRule"in s){if(!(s.startRule in c))throw new Error(`Can't start parsing from rule "`+s.startRule+'".');u=c[s.startRule]}function wl(){return n.substring(xr,re)}function Es(Y,fe){return{type:"literal",text:Y,ignoreCase:fe}}function U_(Y,fe,Ee){return{type:"class",parts:Y,inverted:fe,ignoreCase:Ee}}function z_(){return{type:"end"}}function Va(Y){return{type:"other",description:Y}}function tm(Y){var fe,Ee=$h[Y];if(Ee)return Ee;for(fe=Y-1;!$h[fe];)fe--;for(Ee={line:(Ee=$h[fe]).line,column:Ee.column};fe<Y;)n.charCodeAt(fe)===10?(Ee.line++,Ee.column=1):Ee.column++,fe++;return $h[Y]=Ee,Ee}function B_(Y,fe,Ee){var oi=tm(Y),Vn=tm(fe),yr={source:l,start:{offset:Y,line:oi.line,column:oi.column},end:{offset:fe,line:Vn.line,column:Vn.column}};return Ee&&l&&typeof l.offset=="function"&&(yr.start=l.offset(yr.start),yr.end=l.offset(yr.end)),yr}function Wt(Y){re<Ss||(re>Ss&&(Ss=re,Ih=[]),Ih.push(Y))}function Jg(Y,fe,Ee){return new e(e.buildMessage(Y,fe),Y,fe,Ee)}function im(){var Y;return(Y=Kg())===a&&(Y=pa()),Y}function Kg(){var Y,fe;return Xe++,Y=re,en(),n.substr(re,4)===d?(fe=d,re+=4):(fe=a,Xe===0&&Wt(G)),fe!==a?(en(),xr=Y,Y=ei()):(re=Y,Y=a),Xe--,Y===a&&Xe===0&&Wt(I),Y}function pa(){var Y,fe;if(Y=[],(fe=xl())!==a)for(;fe!==a;)Y.push(fe),fe=xl();else Y=a;return Y}function xl(){var Y,fe,Ee,oi;return Y=re,en(),(fe=Qg())!==a?(en(),(Ee=ap())===a&&(Ee=null),en(),n.charCodeAt(re)===41?(oi=p,re++):(oi=a,Xe===0&&Wt(q)),oi!==a?(en(),xr=Y,Y=xi(fe,Ee)):(re=Y,Y=a)):(re=Y,Y=a),Y}function ap(){var Y,fe,Ee,oi,Vn,yr,fa,H_;if(Y=re,(fe=Cs())!==a){for(Ee=[],oi=re,Vn=en(),n.charCodeAt(re)===44?(yr=m,re++):(yr=a,Xe===0&&Wt(Z)),yr===a&&(yr=null),fa=en(),(H_=Cs())!==a?oi=Vn=[Vn,yr,fa,H_]:(re=oi,oi=a);oi!==a;)Ee.push(oi),oi=re,Vn=en(),n.charCodeAt(re)===44?(yr=m,re++):(yr=a,Xe===0&&Wt(Z)),yr===a&&(yr=null),fa=en(),(H_=Cs())!==a?oi=Vn=[Vn,yr,fa,H_]:(re=oi,oi=a);xr=Y,Y=wr(fe,Ee)}else re=Y,Y=a;return Y}function Cs(){var Y,fe;return Y=re,(fe=G_())===a&&(fe=Sw())===a&&(fe=j_())===a&&(fe=e0()),fe!==a&&(xr=Y,fe=mr(fe)),(Y=fe)===a&&(Y=re,(fe=sP())!==a&&(xr=Y,fe=gr(fe)),Y=fe),Y}function en(){var Y,fe;for(Xe++,Y=[],k.test(n.charAt(re))?(fe=n.charAt(re),re++):(fe=a,Xe===0&&Wt(Q));fe!==a;)Y.push(fe),k.test(n.charAt(re))?(fe=n.charAt(re),re++):(fe=a,Xe===0&&Wt(Q));return Xe--,fe=a,Xe===0&&Wt(K),Y}function Qg(){var Y,fe,Ee;return Xe++,Y=re,(fe=V_())!==a?(n.charCodeAt(re)===40?(Ee=y,re++):(Ee=a,Xe===0&&Wt(Ae)),Ee!==a?(xr=Y,Y=Ai(fe)):(re=Y,Y=a)):(re=Y,Y=a),Xe--,Y===a&&(fe=a,Xe===0&&Wt(de)),Y}function V_(){var Y,fe,Ee;if(Xe++,Y=re,fe=[],B.test(n.charAt(re))?(Ee=n.charAt(re),re++):(Ee=a,Xe===0&&Wt(vt)),Ee!==a)for(;Ee!==a;)fe.push(Ee),B.test(n.charAt(re))?(Ee=n.charAt(re),re++):(Ee=a,Xe===0&&Wt(vt));else fe=a;return fe!==a&&(xr=Y,fe=Lr()),Xe--,(Y=fe)===a&&(fe=a,Xe===0&&Wt(st)),Y}function G_(){var Y,fe,Ee;return Xe++,Y=re,en(),(fe=Ga())!==a?(n.charCodeAt(re)===37?(Ee=_,re++):(Ee=a,Xe===0&&Wt(gt)),Ee!==a?(xr=Y,Y=ki(fe)):(re=Y,Y=a)):(re=Y,Y=a),Xe--,Y===a&&Xe===0&&Wt(ot),Y}function Sw(){var Y,fe,Ee;return Xe++,Y=re,en(),(fe=Ga())!==a?(n.substr(re,2)===v?(Ee=v,re+=2):(Ee=a,Xe===0&&Wt(ue)),Ee!==a?(xr=Y,Y=sr(fe)):(re=Y,Y=a)):(re=Y,Y=a),Y===a&&(Y=re,en(),(fe=Ga())!==a?(n.substr(re,2)===w?(Ee=w,re+=2):(Ee=a,Xe===0&&Wt(xt)),Ee!==a?(xr=Y,Y=Qi(fe)):(re=Y,Y=a)):(re=Y,Y=a),Y===a&&(Y=re,en(),(fe=Ga())!==a?(n.substr(re,2)===x?(Ee=x,re+=2):(Ee=a,Xe===0&&Wt(ve)),Ee!==a?(xr=Y,Y=ci(fe)):(re=Y,Y=a)):(re=Y,Y=a),Y===a&&(Y=re,en(),(fe=Ga())!==a?(n.substr(re,2)===T?(Ee=T,re+=2):(Ee=a,Xe===0&&Wt(De)),Ee!==a?(xr=Y,Y=or(fe)):(re=Y,Y=a)):(re=Y,Y=a),Y===a&&(Y=re,en(),(fe=Ga())!==a?(n.substr(re,2)===S?(Ee=S,re+=2):(Ee=a,Xe===0&&Wt(tt)),Ee!==a?(xr=Y,Y=Dr(fe)):(re=Y,Y=a)):(re=Y,Y=a),Y===a&&(Y=re,en(),(fe=Ga())!==a?(n.substr(re,2)===E?(Ee=E,re+=2):(Ee=a,Xe===0&&Wt(mt)),Ee!==a?(xr=Y,Y=Ys(fe)):(re=Y,Y=a)):(re=Y,Y=a)))))),Xe--,Y===a&&Xe===0&&Wt(ze),Y}function j_(){var Y,fe,Ee;return Xe++,Y=re,(fe=Ga())!==a?(n.substr(re,3)===A?(Ee=A,re+=3):(Ee=a,Xe===0&&Wt(At)),Ee!==a?(xr=Y,Y=Xs(fe)):(re=Y,Y=a)):(re=Y,Y=a),Y===a&&(Y=re,(fe=Ga())!==a?(n.substr(re,3)===P?(Ee=P,re+=3):(Ee=a,Xe===0&&Wt(Ve)),Ee!==a?(xr=Y,Y=Zs(fe)):(re=Y,Y=a)):(re=Y,Y=a),Y===a&&(Y=re,(fe=Ga())!==a?(n.substr(re,4)===N?(Ee=N,re+=4):(Ee=a,Xe===0&&Wt(Tt)),Ee!==a?(xr=Y,Y=Js(fe)):(re=Y,Y=a)):(re=Y,Y=a),Y===a&&(Y=re,(fe=Ga())!==a?(n.substr(re,4)===F?(Ee=F,re+=4):(Ee=a,Xe===0&&Wt(jt)),Ee!==a?(xr=Y,Y=qr(fe)):(re=Y,Y=a)):(re=Y,Y=a)))),Xe--,Y===a&&(fe=a,Xe===0&&Wt(bt)),Y}function e0(){var Y,fe;return Xe++,Y=re,en(),(fe=Ga())!==a?(xr=Y,Y=Nr(fe)):(re=Y,Y=a),Xe--,Y===a&&Xe===0&&Wt($i),Y}function sP(){var Y,fe,Ee,oi;if(Xe++,Y=re,n.charCodeAt(re)===35?(fe=D,re++):(fe=a,Xe===0&&Wt(dt)),fe!==a){if(Ee=[],j.test(n.charAt(re))?(oi=n.charAt(re),re++):(oi=a,Xe===0&&Wt(at)),oi!==a)for(;oi!==a;)Ee.push(oi),j.test(n.charAt(re))?(oi=n.charAt(re),re++):(oi=a,Xe===0&&Wt(at));else Ee=a;Ee!==a?(xr=Y,Y=Vi()):(re=Y,Y=a)}else re=Y,Y=a;return Y===a&&(Y=re,(fe=xl())!==a&&(xr=Y,fe=Ts(fe)),(Y=fe)===a&&(Y=re,(fe=V_())!==a&&(xr=Y,fe=_o()),Y=fe)),Xe--,Y===a&&(fe=a,Xe===0&&Wt(ct)),Y}function Ga(){var Y,fe,Ee,oi,Vn,yr,fa;for(Y=re,X.test(n.charAt(re))?(n.charAt(re),re++):Xe===0&&Wt(Ht),fe=re,Ee=[],M.test(n.charAt(re))?(oi=n.charAt(re),re++):(oi=a,Xe===0&&Wt(zt));oi!==a;)Ee.push(oi),M.test(n.charAt(re))?(oi=n.charAt(re),re++):(oi=a,Xe===0&&Wt(zt));if(n.charCodeAt(re)===46?(oi=$,re++):(oi=a,Xe===0&&Wt(fr)),oi!==a){if(Vn=[],M.test(n.charAt(re))?(yr=n.charAt(re),re++):(yr=a,Xe===0&&Wt(zt)),yr!==a)for(;yr!==a;)Vn.push(yr),M.test(n.charAt(re))?(yr=n.charAt(re),re++):(yr=a,Xe===0&&Wt(zt));else Vn=a;Vn!==a?fe=Ee=[Ee,oi,Vn]:(re=fe,fe=a)}else re=fe,fe=a;if(fe===a)if(fe=[],M.test(n.charAt(re))?(Ee=n.charAt(re),re++):(Ee=a,Xe===0&&Wt(zt)),Ee!==a)for(;Ee!==a;)fe.push(Ee),M.test(n.charAt(re))?(Ee=n.charAt(re),re++):(Ee=a,Xe===0&&Wt(zt));else fe=a;if(fe!==a){if(Ee=re,n.charCodeAt(re)===101?(oi=R,re++):(oi=a,Xe===0&&Wt(Bi)),oi!==a){if(X.test(n.charAt(re))?(Vn=n.charAt(re),re++):(Vn=a,Xe===0&&Wt(Ht)),Vn===a&&(Vn=null),yr=[],M.test(n.charAt(re))?(fa=n.charAt(re),re++):(fa=a,Xe===0&&Wt(zt)),fa!==a)for(;fa!==a;)yr.push(fa),M.test(n.charAt(re))?(fa=n.charAt(re),re++):(fa=a,Xe===0&&Wt(zt));else yr=a;yr!==a?Ee=oi=[oi,Vn,yr]:(re=Ee,Ee=a)}else re=Ee,Ee=a;Ee===a&&(Ee=null),xr=Y,Y=da()}else re=Y,Y=a;return Y}function rE(Y,fe){return Y.map(function(Ee){return Ee[fe]})}function nE(Y,fe,Ee){return[Y].concat(rE(fe,Ee))}if((o=u())!==a&&re===n.length)return o;throw o!==a&&re<n.length&&Wt(z_()),Jg(Ih,Ss<n.length?n.charAt(Ss):null,Ss<n.length?B_(Ss,Ss+1):B_(Ss,Ss))}return t(e,Error),e.prototype.format=function(n){var s="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<n.length;o++)if(n[o].source===this.location.source){a=n[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(l):l,u=this.location.source+":"+c.line+":"+c.column;if(a){var d=this.location.end,p=i("",c.line.toString().length," "),m=a[l.line-1],y=(l.line===d.line?d.column:m.length+1)-l.column||1;s+=`
 --> `+u+`
`+p+` |
`+c.line+" | "+m+`
`+p+" | "+i("",l.column-1," ")+i("",y,"^")}else s+=`
 at `+u}return s},e.buildMessage=function(n,s){var o={literal:function(m){return'"'+l(m.text)+'"'},class:function(m){var y=m.parts.map(function(_){return Array.isArray(_)?c(_[0])+"-"+c(_[1]):c(_)});return"["+(m.inverted?"^":"")+y.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(m){return m.description}};function a(m){return m.charCodeAt(0).toString(16).toUpperCase()}function l(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function c(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function u(m){return o[m.type](m)}function d(m){var y,_,v=m.map(u);if(v.sort(),v.length>0){for(y=1,_=1;y<v.length;y++)v[y-1]!==v[y]&&(v[_]=v[y],_++);v.length=_}switch(v.length){case 1:return v[0];case 2:return v[0]+" or "+v[1];default:return v.slice(0,-1).join(", ")+", or "+v[v.length-1]}}function p(m){return m?'"'+l(m)+'"':"end of input"}return"Expected "+d(n)+" but "+p(s)+" found."},{SyntaxError:e,parse:r}},(Pne=hj).exports&&(Pne.exports=Mne());var ort=hj.exports;function sNt(t){if(!t||t.length===0)return null;if(typeof t=="string"){const i=$ne(t);return i&&i.length!==0?i:null}const e=t.map(i=>{if(!Number.isFinite(i.scale)||i.scale<=0)throw new W("effect:invalid-scale","scale must be finite and greater than 0",{stop:i});return{scale:i.scale,effects:$ne(i.value)}});e.sort((i,r)=>r.effects.length-i.effects.length);for(let i=0;i<e.length-1;i++){if(!VLe(e[i].effects,e[i+1].effects))throw new W("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[i].effects,b:e[i+1].effects});GLe(e[i].effects,e[i+1].effects)}return e.sort((i,r)=>r.scale-i.scale),e}function $ne(t){let e;if(!t)return[];try{e=ort.parse(t)}catch(i){throw new W("effect:invalid-syntax","Invalid effect syntax",{value:t,error:i})}return e.map(i=>art(i))}function art(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return lrt(t);case"opacity":return crt(t);case"hue-rotate":return urt(t);case"blur":return hrt(t);case"drop-shadow":return drt(t);case"bloom":return prt(t)}}catch(e){throw e.details.filter=t,e}throw new W("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function lrt(t){let e=1;return KS(t.parameters,1),t.parameters.length===1&&(e=_d(t.parameters[0])),new GB(t.name,e)}function crt(t){let e=1;return KS(t.parameters,1),t.parameters.length===1&&(e=_d(t.parameters[0])),new Cpe(e)}function urt(t){let e=0;return KS(t.parameters,1),t.parameters.length===1&&(e=vrt(t.parameters[0])),new Spe(e)}function hrt(t){let e=0;return KS(t.parameters,1),t.parameters.length===1&&(e=rZ(t.parameters[0]),qR(e,t.parameters[0])),new vpe(e)}function drt(t){const e=[];let i=null;for(const r of t.parameters)if(r.type==="color"){if(e.length&&Object.freeze(e),i)throw new W("effect:type-error","Accepts only one color",{});i=brt(r)}else{const n=rZ(r);if(Object.isFrozen(e))throw new W("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(n),e.length===3&&qR(n,r)}if(e.length<2||e.length>3)throw new W("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new xpe(e[0],e[1],e[2]||0,i||cTe("black"))}function prt(t){let e=1,i=0,r=0;return KS(t.parameters,3),t.parameters[0]&&(e=_d(t.parameters[0])),t.parameters[1]&&(i=rZ(t.parameters[1]),qR(i,t.parameters[1])),t.parameters[2]&&(r=_d(t.parameters[2])),new ype(e,i,r)}function KS(t,e){if(t.length>e)throw new W("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function dk(t){if(t.type==="color")return"<color>";if(t.unit){if(t.unit in iZ)return"<length>";if(t.unit in tZ)return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function qR(t,e){if(t<0)throw new W("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function frt(t){if(t.type!=="quantity"||t.unit!==null)throw new W("effect:type-error",`Expected <double>, Actual: ${dk(t)}`,{term:t})}function mrt(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new W("effect:type-error",`Expected <double> or <percentage>, Actual: ${dk(t)}`,{term:t})}const tZ={deg:1,grad:.9,rad:180/Math.PI,turn:360};function grt(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&tZ[t.unit]!=null))throw new W("effect:type-error",`Expected <angle>, Actual: ${dk(t)}`,{term:t})}const iZ={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function yrt(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&iZ[t.unit]!=null))throw new W("effect:type-error",`Expected <length>, Actual: ${dk(t)}`,{term:t})}function _d(t){mrt(t);const e=t.value;return qR(e,t),t.unit==="%"?.01*e:e}function _rt(t){return frt(t),qR(t.value,t),t.value}function vrt(t){return grt(t),t.value*tZ[t.unit]||0}function rZ(t){return yrt(t),t.value*iZ[t.unit]||0}function brt(t){switch(t.colorType){case"hex":return fIe(t.value);case"named":return cTe(t.value);case"function":return Trt(t.value)}}function cTe(t){if(!Lde(t))throw new W("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return pIe(t)}const wrt=/^rgba?/i,xrt=/^hsla?/i;function Trt(t){if(KS(t.parameters,4),wrt.test(t.name))return[_d(t.parameters[0]),_d(t.parameters[1]),_d(t.parameters[2]),t.parameters[3]?_d(t.parameters[3]):1];if(xrt.test(t.name))return Dde(_rt(t.parameters[0]),_d(t.parameters[1]),_d(t.parameters[2]),t.parameters[3]?_d(t.parameters[3]):1);throw new W("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}function Srt(t){return typeof t=="function"}function oNt(t,e,i,r){return Srt(t)?t(e,i,r):t}function aNt(t){return[t.r,t.g,t.b,t.a]}const Ert=` /-,
`;function Ine(t){let e=t.length;for(;e--;)if(!Ert.includes(t.charAt(e)))return!1;return!0}function Crt(t,e){const i=[];let r=0,n=-1;do if(n=t.indexOf("[",r),n>=r){if(n>r){const s=t.substr(r,n-r);i.push([s,null,Ine(s)])}if(r=n+1,n=t.indexOf("]",r),n>=r){if(n>r){const s=e[t.substr(r,n-r)];s&&i.push([null,s,!1])}r=n+1}}while(n!==-1);if(r<t.length-1){const s=t.substr(r);i.push([s,null,Ine(s)])}return i}function Art(t,e,i){let r="",n=null;for(const s of e){const[o,a,l]=s;if(o)l?n=o:(n&&(r+=n,n=null),r+=o);else{const c=t.attributes[a];c&&(n&&(r+=n,n=null),r+=c)}}return Ort(r,i)}function lNt(t,e,i){const r=Crt(e,t);return n=>Art(n,r,i)}function Ort(t,e){switch(typeof t!="string"&&(t=String(t)),e){case"LowerCase":return t.toLowerCase();case"Allcaps":return t.toUpperCase();default:return t}}function cNt(t,e,i,r,n,s,o=!0){const a=e/n,l=i/s,c=Math.ceil(a/2),u=Math.ceil(l/2);for(let d=0;d<s;d++)for(let p=0;p<n;p++){const m=4*(p+(o?s-d-1:d)*n);let y=0,_=0,v=0,w=0,x=0,T=0,S=0;const E=(d+.5)*l;for(let A=Math.floor(d*l);A<(d+1)*l;A++){const P=Math.abs(E-(A+.5))/u,N=(p+.5)*a,F=P*P;for(let D=Math.floor(p*a);D<(p+1)*a;D++){let $=Math.abs(N-(D+.5))/c;const R=Math.sqrt(F+$*$);R>=-1&&R<=1&&(y=2*R*R*R-3*R*R+1,y>0&&($=4*(D+A*e),S+=y*t[$+3],v+=y,t[$+3]<255&&(y=y*t[$+3]/250),w+=y*t[$],x+=y*t[$+1],T+=y*t[$+2],_+=y))}}r[m]=w/_,r[m+1]=x/_,r[m+2]=T/_,r[m+3]=S/v}}function uTe(t){return t?{r:t[0],g:t[1],b:t[2],a:t[3]/255}:{r:0,g:0,b:0,a:0}}function Rrt(t){return t.data?.symbol??null}function Prt(t){return t.type==="CIMVectorMarker"||t.type==="CIMPictureMarker"||t.type==="CIMBarChartMarker"||t.type==="CIMCharacterMarker"||t.type==="CIMPieChartMarker"||t.type==="CIMStackedBarChartMarker"}function Mrt(t){return t.type==="CIMGradientStroke"||t.type==="CIMPictureStroke"||t.type==="CIMSolidStroke"}function hTe(t){return t!=null&&(t.type==="CIMMarkerPlacementAlongLineRandomSize"||t.type==="CIMMarkerPlacementAlongLineSameSize"||t.type==="CIMMarkerPlacementAlongLineVariableSize"||t.type==="CIMMarkerPlacementAtExtremities"||t.type==="CIMMarkerPlacementAtMeasuredUnits"||t.type==="CIMMarkerPlacementAtRatioPositions"||t.type==="CIMMarkerPlacementOnLine"||t.type==="CIMMarkerPlacementOnVertices")}const uNt=(t,e=0)=>t==null||isNaN(t)?e:t,hNt=t=>t.tintColor?uTe(t.tintColor):{r:255,g:255,b:255,a:1},dNt=t=>{if(!t)return!1;for(const e of t)switch(e.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function pNt(){return pe(()=>import("./geometryEngineJSON-24073ea5.js"),["./geometryEngineJSON-24073ea5.js","./geometryEngineBase-2020e3dc.js","./geometryEngineJSON-3c45c350.js","./json-48e3ea08.js"],import.meta.url)}function fNt(t){if(!t)return"normal";switch(t.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function mNt(t){if(!t)return"normal";switch(t.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function gNt(t){let e="normal",i="normal";if(t){const r=t.toLowerCase();r.includes("italic")?e="italic":r.includes("oblique")&&(e="oblique"),r.includes("bold")?i="bold":r.includes("light")&&(i="lighter")}return{style:e,weight:i}}function yNt(t){return t.underline?"underline":t.strikethrough?"line-through":"none"}function Lne(t){if(!t)return null;switch(t.type){case"CIMPolygonSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const i=Lne(e);if(i!=null)return i}break;case"CIMTextSymbol":return Lne(t.symbol);case"CIMSolidFill":return t.color}}function Dne(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const e=t.symbolLayers;if(e)for(const i of e){const r=Dne(i);if(r!=null)return r}break}case"CIMTextSymbol":return Dne(t.symbol);case"CIMSolidStroke":return t.color}}function Nne(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const i=Nne(e);if(i!==void 0)return i}break;case"CIMTextSymbol":return Nne(t.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return t.width}}function _Nt(t){switch(t){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function vNt(t){switch(t){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function bNt(t){return(t?Object.keys(t):[]).map(e=>({name:e,alias:e,type:typeof t[e]=="string"?"esriFieldTypeString":"esriFieldTypeDouble"}))}const wNt=t=>t.includes("data:image/svg+xml");function xNt(t){if(!t)return null;switch(t.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function dTe(t,e,i,r){if(t)if(t.type!=="CIMTextSymbol"){if(i&&t.effects)for(const n of t.effects)Lrt(n,e);if(t.symbolLayers)for(const n of t.symbolLayers)switch(n.type){case"CIMPictureMarker":case"CIMVectorMarker":$rt(n,e,r);break;case"CIMPictureStroke":case"CIMSolidStroke":!r?.preserveOutlineWidth&&n.width&&(n.width*=e);break;case"CIMPictureFill":n.height&&(n.height*=e),n.offsetX&&(n.offsetX*=e),n.offsetY&&(n.offsetY*=e);break;case"CIMHatchFill":dTe(n.lineSymbol,e,!0,{...r,preserveOutlineWidth:!1}),n.offsetX&&(n.offsetX*=e),n.offsetY&&(n.offsetY*=e),n.separation&&(n.separation*=e)}}else t.height!=null&&(t.height*=e)}function $rt(t,e,i){if(t&&(t.markerPlacement&&Irt(t.markerPlacement,e),t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.anchorPoint&&t.anchorPointUnits==="Absolute"&&(t.anchorPoint={x:t.anchorPoint.x*e,y:t.anchorPoint.y*e}),t.size=t.size!=null?t.size*e:0,t.type==="CIMVectorMarker"&&t.markerGraphics))for(const r of t.markerGraphics)t.scaleSymbolsProportionally||dTe(r.symbol,e,!0,i)}function Irt(t,e){switch(hTe(t)&&t.offset&&(t.offset*=e),t.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.placementTemplate&&t.placementTemplate.length){const i=t.placementTemplate.map(r=>r*e);t.placementTemplate=i}break;case"CIMMarkerPlacementAlongLineVariableSize":if(t.maxRandomOffset&&(t.maxRandomOffset*=e),t.placementTemplate&&t.placementTemplate.length){const i=t.placementTemplate.map(r=>r*e);t.placementTemplate=i}break;case"CIMMarkerPlacementOnLine":t.startPointOffset&&(t.startPointOffset*=e);break;case"CIMMarkerPlacementAtExtremities":t.offsetAlongLine&&(t.offsetAlongLine*=e);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":t.beginPosition&&(t.beginPosition*=e),t.endPosition&&(t.endPosition*=e);break;case"CIMMarkerPlacementPolygonCenter":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMMarkerPlacementInsidePolygon":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.stepX&&(t.stepX*=e),t.stepY&&(t.stepY*=e)}}function Lrt(t,e){switch(t.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":t.width&&(t.width*=e);break;case"CIMGeometricEffectBuffer":t.size&&(t.size*=e);break;case"CIMGeometricEffectCut":t.beginCut&&(t.beginCut*=e),t.endCut&&(t.endCut*=e),t.middleCut&&(t.middleCut*=e);break;case"CIMGeometricEffectDashes":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.dashTemplate&&t.dashTemplate.length){const i=t.dashTemplate.map(r=>r*e);t.dashTemplate=i}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":t.length&&(t.length*=e);break;case"CIMGeometricEffectMove":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":t.offset&&(t.offset*=e);break;case"CIMGeometricEffectRegularPolygon":t.radius&&(t.radius*=e);break;case"CIMGeometricEffectTaperedPolygon":t.fromWidth&&(t.fromWidth*=e),t.length&&(t.length*=e),t.toWidth&&(t.toWidth*=e);break;case"CIMGeometricEffectWave":t.amplitude&&(t.amplitude*=e),t.period&&(t.period*=e)}}function Drt(t){const e=[];return dj(Rrt(t),e),e.length?new Ye(uTe(e[0])):null}function dj(t,e){if(!t)return;let i;i=t.type==="CIMTextSymbol"?t.symbol:t;const r=t.type==="CIMPolygonSymbol";if(i?.symbolLayers){for(const n of i.symbolLayers)if(!(n.colorLocked||r&&(Mrt(n)||Prt(n)&&n.markerPlacement&&hTe(n.markerPlacement))))switch(n.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":n.tintColor&&Fne(e,n.tintColor);break;case"CIMVectorMarker":n.markerGraphics?.forEach(s=>{dj(s.symbol,e)});break;case"CIMSolidStroke":case"CIMSolidFill":Fne(e,n.color);break;case"CIMHatchFill":dj(n.lineSymbol,e)}}}function Fne(t,e){for(const i of t)if(i.join(".")===e.join("."))return;t.push(e)}let Nrt=class{constructor(e,i){this._storage=new fve,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),i&&this._storage.registerRemoveFunc("",i)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,i,r=1){this._storage.put(this,e,i,r,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}};new Nrt(1e3);new Ye([128,128,128]);const Frt=new Ye("white");function krt(t){return t.resource?.href??""}function SNt(t,e){if(!t)return null;let i=null;return Ib(t)?i=Urt(t):nF(t)&&(i=t.type==="cim"?Drt(t):t.color?new Ye(t.color):null),i?MO(i,e):null}function Urt(t){const e=t.symbolLayers;if(!e)return null;let i=null;return e.forEach(r=>{r.type==="object"&&r.resource?.href||(i=r.type==="water"?r.color:r.material?r.material.color:null)}),i?new Ye(i):null}function MO(t,e){if(e==null||t==null)return t;const i=t.toRgba();return i[3]=i[3]*e,new Ye(i)}function zrt(t,e,i){const r=t.symbolLayers;if(!r)return;const n=s=>MO(e=e??s??(i!=null?Frt:null),i);r.forEach(s=>{if(s.type!=="object"||!s.resource?.href||e)if(s.type==="water")s.color=n(s.color);else{const o=s.material!=null?s.material.color:null,a=n(o);s.material==null?s.material=new iu({color:a}):s.material.color=a,i!=null&&"outline"in s&&s.outline?.color!=null&&(s.outline.color=MO(s.outline.color,i))}})}function Brt(t,e,i){(e=e??t.color)&&(t.color=MO(e,i)),i!=null&&"outline"in t&&t.outline?.color&&(t.outline.color=MO(t.outline.color,i))}function ENt(t,e,i){t&&(e||i!=null)&&(e&&(e=new Ye(e)),Ib(t)?zrt(t,e,i):nF(t)&&Brt(t,e,i))}async function Vrt(t,e){const i=t.symbolLayers;i&&await b4(i,async r=>Grt(r,e))}async function Grt(t,e){switch(t.type){case"extrude":Hrt(t,e);break;case"icon":case"line":case"text":jrt(t,e);break;case"path":Wrt(t,e);break;case"object":await qrt(t,e)}}function jrt(t,e){const i=pTe(e);i!=null&&(t.size=i)}function pTe(t){for(const e of t)if(typeof e=="number")return e;return null}function Hrt(t,e){t.size=typeof e[2]=="number"?e[2]:0}async function qrt(t,e){const{resourceSize:i,symbolSize:r}=await Yrt(t),n=fTe(e,i,r);t.width=w3(e[0],r[0],i[0],n),t.depth=w3(e[1],r[1],i[1],n),t.height=w3(e[2],r[2],i[2],n)}function Wrt(t,e){const i=fTe(e,eg,[t.width,void 0,t.height]);t.width=w3(e[0],t.width,1,i),t.height=w3(e[2],t.height,1,i)}function fTe(t,e,i){for(let r=0;r<3;r++){const n=t[r];switch(n){case"symbol-value":{const s=i[r];return s!=null?s/e[r]:1}case"proportional":break;default:if(n&&e[r])return n/e[r]}}return 1}async function Yrt(t){const{computeObjectLayerResourceSize:e}=await pe(()=>import("./symbolLayerUtils-d7a150d4.js"),[],import.meta.url),i=await e(t,10),{width:r,height:n,depth:s}=t,o=[r,s,n];let a=1;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/i[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=i[l]*a);return{resourceSize:i,symbolSize:o}}function w3(t,e,i,r){switch(t){case"proportional":return i*r;case"symbol-value":return e??i;default:return t}}function Xrt(t,e){const i=pTe(e);if(i!=null)switch(t.type){case"simple-marker":t.size=i;break;case"picture-marker":{const r=t.width/t.height;r>1?(t.width=i,t.height=i*r):(t.width=i*r,t.height=i);break}case"simple-line":t.width=i;break;case"text":t.font.size=i}}async function CNt(t,e){if(t&&e)return Ib(t)?Vrt(t,e):void(nF(t)&&Xrt(t,e))}function ANt(t,e,i){if(t&&e!=null)if(Ib(t)){const r=t.symbolLayers;r&&r.forEach(n=>{if(n&&n.type==="object")switch(i){case"tilt":n.tilt=e;break;case"roll":n.roll=e;break;default:n.heading=e}})}else nF(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle=e))}function ONt(t){return t!=null&&t.type==="polygon-3d"&&t.symbolLayers.some(e=>e.type==="extrude")}async function RNt(t,e){return await t.fetchSymbol(e)||t.fetchCIMSymbol(e)}function Zrt(t,e,i,r,n){if(t==null)return null;const s=t.referencesGeometry()&&n?Jrt(e,r,n):e,o=t.repurposeFeature(s);try{return t.evaluate({...i,$feature:o},t.services)}catch(a){return ne.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const m8=new Map;function Jrt(t,e,i){const{transform:r,hasZ:n,hasM:s}=i;m8.has(e)||m8.set(e,Krt(e));const o=m8.get(e)(t.geometry,r,n,s);return{...t,geometry:o}}function Krt(t){const e={};switch(t){case"esriGeometryPoint":return(i,r,n,s)=>Hxe(r,e,i,n,s);case"esriGeometryPolygon":return(i,r,n,s)=>qxe(r,e,i,n,s);case"esriGeometryPolyline":return(i,r,n,s)=>Wxe(r,e,i,n,s);case"esriGeometryMultipoint":return(i,r,n,s)=>jxe(r,e,i,n,s);default:return ne.getLogger("esri.views.2d.support.arcadeOnDemand").error(new W("mapview-arcade",`Unable to handle geometryType: ${t}`)),i=>i}}const PNt=1.2,Qrt=ru,ent=4;let pk=class{constructor(e,i,r,n){this.graphics3DSymbolLayer=e,this.renderGeometries=i,this.boundingBox=r,this._drapeSourceRenderer=n,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(e){this.stage=e.stage}setVisibility(e){if(this.stage!=null&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,kr.ADD);if(e||this._addedToStage){for(const i of this.renderGeometries)i.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,ns.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,kr.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=C()){return oe(e,0,0,0)}getBoundingBoxObjectSpace(e=ds()){return vr(e)}addObjectState(e,i){e===Rg.Highlight&&(this.renderGeometries.forEach(r=>{const n=r.geometry.addHighlight();i.addRenderGeometry(r,n,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,ns.HIGHLIGHT))}removeObjectState(e){this.renderGeometries.forEach(i=>{e.removeRenderGeometry(i)})}removeRenderGeometryObjectState(e,i){e.geometry.removeHighlight(i),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,ns.HIGHLIGHT)}computeAttachmentOrigin(e){for(const i of this.renderGeometries)i.geometry.computeAttachmentOrigin(lx)&&(e.draped.origin[0]+=lx[0],e.draped.origin[1]+=lx[1],e.draped.num++)}async getProjectedBoundingBox(e,i,r,n,s){vr(s);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,e,kne,r),l6e(s,kne)}if(i){let o;Rd(s,lx);const a=_X(s,i.service.spatialReference,i);try{o=await i.service.queryElevation(lx[0],lx[1],n,a,"ground")}catch{}o!=null&&(s[2]=Math.min(s[2],o),s[5]=Math.max(s[5],o))}return s}_getRenderGeometryProjectedBoundingRect(e,i,r,n){if(this.boundingBox)Z4(vp,this.boundingBox);else{const s=e.boundingSphere,o=s[3];vp[0]=s[0]-o,vp[1]=s[1]-o,vp[2]=s[2]-o,vp[3]=s[0]+o,vp[4]=s[1]+o,vp[5]=s[2]+o}return i(vp,0,2),this.calculateRelativeScreenBounds&&n.push({location:Rd(vp),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),hW(vp,r)}};const kne=Gt(),vp=ds(),lx=C();function u5(t,e,i){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=i,t.canvas}function mTe(t){const{size:e}=t.definition,i=t.fontString(e);let r=Une.get(i);if(!r){const n=u5(int,0,0).getContext("2d");t.setFontProperties(n,e);const s=n.measureText(rnt);r=new tnt(s.actualBoundingBoxAscent,s.actualBoundingBoxDescent),Une.set(i,r)}return r}const Une=new Map;let tnt=class{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(e,i){this.maxAscent=e,this.maxDescent=i}};const int={canvas:null},rnt=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})(),h5=1;let gTe=class{constructor(e,i,r,n){this.text=e,this._alignment=i,this._parameters=r,this._maxSize=n,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`,this._lines=e.replaceAll(" "," ").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let e=this._metrics.firstLineAscent;for(let i=0;i<this._lines.length-1;i++)e+=this._lineSpacing;return e+=this._metrics.lastLineDescent,Math.ceil(e+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(this._metricsCached==null){const e=u5(zne,o$,o$).getContext("2d");this._parameters.setFontProperties(e,this._fontSize);let i=2*this._haloSize;const r=this._parameters.definition.font;r.style!=="italic"&&r.style!=="oblique"&&r.weight!=="bold"&&r.weight!=="bolder"||(i+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let n,s,o=0,a=0,l=0;this._lines.forEach((p,m)=>{const y=e.measureText(p),_=y.width,v=_+i;this._textWidths.push(_),this._lineWidths.push(v),o=Math.max(o,v),a=Math.max(a,y.actualBoundingBoxAscent),l=Math.max(l,y.actualBoundingBoxDescent),m===0&&(n=y),m===this._lines.length-1&&(s=y)});const c=mTe(this._parameters);a=Math.max(a,c.maxAscent),l=Math.max(l,c.maxDescent);const u=n.actualBoundingBoxAscent,d=this._parameters.definition.font.decoration==="underline"?l:s.actualBoundingBoxDescent;this._metricsCached=new snt(u,d,a,l,o)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return this._midLineHeight*nnt}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,h5)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(this._renderPixelRatio==null){const e=this._parameters.definition.pixelRatio;this._renderPixelRatio=Math.min(e,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight))}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case Zy.Left:return this._horizontalPadding;case Zy.Center:return(this.displayWidth-this._lineWidths[e])/2;case Zy.Right:return this.displayWidth-this._horizontalPadding-this._lineWidths[e]}}render(e,i,r){e.save();const n=i/=this.renderPixelRatio,s=r/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset+this._metrics.firstLineAscent;i+=o,r+=a;const l=this._haloSize>0;l&&this._renderHalo(e,n,s,o,a),this._parameters.setFontProperties(e,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const u=this._lines[c],d=this._getLineXOffset(c);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,u,i+d,r),this._renderLineDecoration(e,i+d,r,this._textWidths[c])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,u,i+this._getLineXOffset(c),r),this._renderLineDecoration(e,i+d,r,this._textWidths[c]),r+=this._lineSpacing}if(nr.TEXT_SHOW_BASELINE){e.strokeStyle=Bne,e.setLineDash([2,2]),e.lineWidth=1;let c=s+a;for(let u=0;u<this._lines.length;++u)this._drawLine(e,[n,c],[n+this.displayWidth,c]),c+=this._lineSpacing}if(nr.TEXT_SHOW_BORDER&&(e.strokeStyle=Bne,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[n,s],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,n,s,c),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,i,r,n,s=!1){if(this._parameters.definition.font.decoration==="none"||n===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":r+=2*a;break;case"line-through":r-=.33*this._midLineAscent}const l=s?this._haloSize:0;e.strokeStyle=s?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(a+2*l),e.beginPath(),e.moveTo(this._toRenderUnit(i-l),this._toRenderUnit(r)),e.lineTo(this._toRenderUnit(i+n+l),this._toRenderUnit(r)),e.stroke()}_roundedRect(e,i,r,n){i=this._toRenderUnit(i),r=this._toRenderUnit(r);const s=this.renderedWidth,o=this.renderedHeight;n!==0?(n=_e(n,0,Math.floor(o/2)),e.beginPath(),e.moveTo(i,r+n),e.arcTo(i,r,i+n,r,n),e.lineTo(i+s-n,r),e.arcTo(i+s,r,i+s,r+n,n),e.lineTo(i+s,r+o-n),e.arcTo(i+s,r+o,i+s-n,r+o,n),e.lineTo(i+n,r+o),e.arcTo(i,r+o,i,r+o-n,n),e.closePath()):e.rect(i,r,s,o)}_renderHalo(e,i,r,n,s){const o=this.renderedWidth,a=this.renderedHeight,l=u5(zne,Math.max(o,o$),Math.max(a,o$)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._parameters.setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const u=this._renderedHaloSize<3;c.lineJoin=u?"miter":"round",u?this._renderHaloEmulated(c,n,s):this._renderHaloNative(c,n,s);let d=s;for(let p=0;p<this._lines.length;++p){const m=this._getLineXOffset(p);this._renderLineDecoration(c,n+m,d,this._textWidths[p],!0),d+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,o,a,this._toRenderUnit(i),this._toRenderUnit(r),o,a),e.globalAlpha=1}_renderHaloEmulated(e,i,r){for(let n=0;n<this._lines.length;++n){const s=this._lines[n],o=this._getLineXOffset(n);for(const[a,l]of yTe)this._fillText(e,s,i+o+this._haloSize*a,r+this._haloSize*l);r+=this._lineSpacing}}_renderHaloNative(e,i,r){const n=2*this._haloSize;for(let s=0;s<this._lines.length;++s){const o=this._lines[s],a=this._getLineXOffset(s),l=5,c=.1;for(let u=0;u<l;u++){const d=1-(l-1)*c+u*c;e.lineWidth=this._toRenderUnit(d*n),this._strokeText(e,o,i+a,r)}r+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,i,r,n){e.fillText(i,this._toRenderUnit(r),this._toRenderUnit(n))}_strokeText(e,i,r,n){e.strokeText(i,this._toRenderUnit(r),this._toRenderUnit(n))}_drawLine(e,i,r){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.stroke()}_drawBox(e,i,r){const n=this._toRenderUnit(i[0]),s=this._toRenderUnit(i[1]),o=this._toRenderUnit(r[0]),a=this._toRenderUnit(r[1]),l=Math.floor(n)+.5,c=Math.ceil(n+o)-.5,u=Math.floor(s)+.5,d=Math.ceil(s+a)-.5;e.beginPath(),e.moveTo(l,u),e.lineTo(c,u),e.lineTo(c,d),e.lineTo(l,d),e.lineTo(l,u),e.stroke()}};const yTe=[];for(let e=0;e<360;e+=360/16)yTe.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);var Zy;(function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"})(Zy||(Zy={}));const zne={canvas:null},nnt=.2,o$=512,Bne="rgb(255, 0, 255, 0.5)";let snt=class{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(e,i,r,n,s){this.firstLineAscent=e,this.lastLineDescent=i,this.maxLineAscent=r,this.maxLineDescent=n,this.displayWidth=s}};const ont=Object.freeze({left:0,center:.5,right:1}),BL=Object.freeze({"bottom-left":ri(0,0),bottom:ri(.5,0),"bottom-right":ri(1,0),left:ri(0,.5),center:ri(.5,.5),right:ri(1,.5),"top-left":ri(0,1),top:ri(.5,1),"top-right":ri(1,1)});function _Te(t){switch(t){case"left":return Zy.Left;case"right":return Zy.Right;default:return Zy.Center}}function Vne(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function ant(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function lnt(t,e){switch(e){case"bottom":return t==="left"?"bottom-left":t==="right"?"bottom-right":"bottom";case"center":return t;case"top":return t==="left"?"top-left":t==="right"?"top-right":"top"}}function cnt(t){return t==="middle"?"center":t}function unt(t,e){switch(t){case"top":return si(e,0,h5);case"bottom":return si(e,0,-h5);default:return Yn(e,Sg)}}let _S=class{constructor(e,i={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=be(),this._shaderTransformation=null,this._boundingSphere=null,this.id=Kc(),this.layerUid=i.layerUid,this.graphicUid=i.graphicUid,this.castShadow=i.castShadow??!1,i.objectShaderTransformation!=null&&this.objectShaderTransformationChanged(i.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){Nn(this._transformation,e),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){e==null?this._shaderTransformation=null:(this._shaderTransformation??(this._shaderTransformation=be()),Di(this._shaderTransformation,e,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){return this.boundingInfo?(this._boundingSphere==null&&(this._boundingSphere??(this._boundingSphere=xn()),Fe(this._boundingSphere,this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*QT(this.shaderTransformation)),this._boundingSphere):D0e}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation==null?this.transformation:this._shaderTransformation}get attributes(){return this.geometry.attributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}};const Gne=Ce(0,0,1),hnt=16,dnt=1.5,H1=jX,pnt=[H1/2,H1/2,1-H1/2,1-H1/2],fnt=[o5*H1,o5*H1];let pj=class vTe extends Qf{getCachedSize(){return{size:this._getIconSize()}}constructor(e,i,r,n){super(e,i,r,n),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(e){this._validateOrThrow();const i=this._prepareMaterialParameters(),r=this._getPrimitive();if(r!=null)this._prepareResourcesPrimitive(i,r);else{const n=krt(this.symbolLayer),s=Qy(n);s&&s.mediaType==="application/json"?await this._prepareResourcesCIM(i,JSON.parse(s.data),e):await this._prepareResourcesHref(i,n,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=QF(this._getIconSize());if(e)throw new W("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,i=Math.round(e.size!=null?ra(e.size):hnt);return this._drivenProperties.size?Math.max(i,64):i}_generateTextureCIM(e){const i=this._getGraphicHash(e);let r=i===""?null:this._cimSymbolTextures.get(i);if(!r){const n={scaleFactor:this._cimScaleFactorOrFunction},s=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol3D(this._cimLayers,e,"esriGeometryPoint",n,void 0,void 0);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",s.anchorPosition);const o={width:s.imageData.width,height:s.imageData.height};r=new yw(s.imageData,o),this._cimSymbolTextures.set(i,r),this._context.stage.add(r)}return r}_prepareMaterialParameters(){const e={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},i=this.symbol;if(mnt(i)){const{screenLength:r,minWorldLength:n,maxWorldLength:s}=i.verticalOffset;e.verticalOffset={screenLength:ra(r),minWorldLength:n||0,maxWorldLength:s??1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!0,e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,i){const r=this._getOutlineSize();if(g8(i)&&r===0)throw new Error("Nothing to render");if(this._outlineSize=r,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,this._context.sharedResources.textures!=null){const s=this._context.sharedResources.textures.fromData(`${i}-icon`,()=>Gtt(i));this._textureHandle=s,e.textureId=s.texture.id}e.textureIsSignedDistanceField=!0,e.sampleSignedDistanceFieldTexelCenter=Vtt(i),e.distanceFieldBoundingBox=pnt;const n=this._getIconSize();this._size=[n,n],this._symbolTextureRatio=1/H1,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,i,r){this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const n=this._getIconSize(),s=n*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(this._context.sharedResources.textures!=null){const o=await hh(this._context.sharedResources.textures.fromUrl(i,s,{signal:r}));if(o.ok===!1)throw T_(o.error),new W("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${i})`);this._textureHandle=o.value;const a=o.value.texture,l=a.parameters.width/a.parameters.height;this._size=l>1?[n,Math.round(n/l)]:[Math.round(n*l),n],e.textureId=a.id}this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,i,r){const n=new yR({data:i});if(!this._context.sharedResources.cimSymbolRasterizer){const u=(await pe(()=>import("./CIMSymbolRasterizer-41534a0e.js"),["./CIMSymbolRasterizer-41534a0e.js","./cimAnalyzer-96adb123.js","./labelPoint-fc5dd920.js","./TileClipper-ae6eca9e.js","./definitions-5359da6f.js","./number-e491b09e.js","./BidiEngine-9a40f2f4.js","./rasterizingUtils-13352f0c.js"],import.meta.url)).CIMSymbolRasterizer;Et(r),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new u(this._context.renderCoordsHelper.spatialReference,!0))}const s=this._context.layer.fields?this._context.layer.fields.map(u=>u.toJSON()):null;let o,a;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol3D(n,s,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:r}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const u=this._context.renderer;if(isNaN(u.scaleExpression)){const d=u.scaleExpression,p=await ZFe(d,this._context.layer.spatialReference,s);a=(m,y,_)=>{const v=Zrt(p,m,{$view:_},"esriGeometryPoint",y);return v!==null?v:1}}else o=Number(u.scaleExpression)}this._cimScaleFactorOrFunction=o||a||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];Et(r);const c=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(u=>c.get(u).name),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||E6e}_getOutlineSize(){let e=0;const i=this.symbolLayer;return i.outline?.size!=null?Math.max(ra(i.outline.size),0):(e=g8(this._getPrimitive())?dnt:0,Math.max(e,0))}_getOutlineColor(){const e=this._getLayerOpacity(),i=this.symbolLayer,r=i?.outline?.color;if(r!=null){const n=Ye.toUnitRGB(r),s=r.a*e;return[n[0],n[1],n[2],s]}return[0,0,0,0]}_getFillColor(){if(g8(this._getPrimitive()))return Qrt;const e=this._getPrimitive()==null,i=this.symbolLayer?.material?.color;return this._getCombinedOpacityAndColor(i,{hasIntrinsicColor:e})}_getAnchorPos(e,i){return e==="relative"?ri((i.x||0)+.5,.5-(i.y||0)):e in BL?BL[e]:BL.center}_createMaterialAndAddToStage(e,i){if(this._cimLayers){this._fastUpdates=null;let r=e.textureId?this._cimSymbolMaterials.get(e.textureId):null;return r||(r=new fS(e),this._cimSymbolMaterials.set(e.textureId??0,r),i.add(r)),r}return this._fastUpdates=hS(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates&&(e={...e,...this._fastUpdates.materialParameters}),this._materials[0]=new fS(e),i.add(this._materials[0]),this._materials[0]}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._materials.length=0,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(e=>this._context.stage.remove(e)),this._cimSymbolTextures.clear(),this._textureHandle=Jt(this._textureHandle)}_getScaleFactor(e,i){if(this._drivenProperties.size&&e.size){for(let r=0;r<3;r++){const n=e.size[r];n&&n!=="symbol-value"&&n!=="proportional"&&(e.size[r]=ra(n))}if(e.size[0]==="symbol-value")return 1;if(isFinite(+e.size[0]))return+e.size[0]/i;if(isFinite(+e.size[2]))return+e.size[2]/i}return 1}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry))return null;let r,n=[0,0];if(this._cimLayers){if(!this._cimLayers.length)return null;const d=this._generateTextureCIM(i),p={textureId:d.id,...this._cimMaterialParametersInfo};r=this._createMaterialAndAddToStage(p,this._context.stage),n=[d.parameters.width,d.parameters.height]}else n=this._size,r=this._materials[0];const s=CO(i.geometry);if(s==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const o=e.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!this._fastUpdates?.visualVariables.size){const d=n[0]>n[1]?n[0]:n[1];l=this._getScaleFactor(o,d)}l*=this._symbolTextureRatio;const c=ri(n[0]*l,n[1]*l),u=this.setGraphicElevationContext(i);return this.ensureDrapedStatus(u.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(i,s,r,a,c,e.layer.uid):this._createAs3DShape(i,s,r,a,c,u,i.uid)}layerOpacityChanged(){const e=this._getFillColor(),i=this._getOutlineColor();this._forEachMaterial(r=>{r.setParameters({color:e}),r.setParameters({outlineColor:i})})}layerElevationInfoChanged(e,i,r){const n=this._elevationContext.mode,s=FR(vTe.elevationModeChangeTypes,r,n);if(s!==an.UPDATE)return s;const o=xh(n)||n==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return this._getPrimitive()!=null}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables"||!dS(this._fastUpdates,i,this._fastVisualVariableConvertOptions()))return Dn.RecreateSymbol;this._materials[0]?.setParameters(this._fastUpdates.materialParameters)}return Dn.FastUpdate}_defaultElevationInfoNoZ(){return gnt}_createAs3DShape(e,i,r,n,s,o,a){const l=this.getFastUpdateAttrValues(e),c=this._context.layer.uid,u=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:c}),d=xG(r,Gne,null,n,s,ynt,null,l,u),p=PX(this._context,i,d,o,a);if(p==null)return null;const m=new Kf(this,p.object,[d],null,null,sb,o);return m.alignedSampledElevation=p.sampledElevation,m.needsElevationUpdates=xh(o.mode)||o.mode==="absolute-height",m.getScreenSize=this._createScreenSizeGetter(s,l),m.calculateRelativeScreenBounds=y=>r.calculateRelativeScreenBounds(m.getScreenSize(),1,y),EO(m,i,this._context.elevationProvider),m}_createAsOverlay(e,i,r,n,s,o){r.renderPriority=this._renderPriority;const a=Kt();lc(i,a,this._context.overlaySR),a[2]=KX;const l=this._context.clippingExtent;if(l!=null&&!uW(l,a))return null;const c=this.getFastUpdateAttrValues(e),u=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:e.uid,layerUid:this._context.layer.uid}),d=xG(r,Gne,a,n,s,null,null,c,u),p=new _S(d,{layerUid:o,graphicUid:e.uid}),m=new pk(this,[p],null,this._context.drapeSourceRenderer);return m.getScreenSize=this._createScreenSizeGetter(s,c),m.calculateRelativeScreenBounds=y=>r.calculateRelativeScreenBounds(m.getScreenSize(),1,y),m}_createScreenSizeGetter(e,i){const r=this._outlineSize+2;if(this._fastUpdates&&i){const o=e[0]/this._symbolTextureRatio,a=e[1]/this._symbolTextureRatio;return(l=Ue())=>{const[c,u]=sX(_nt,this._fastUpdates.materialParameters,i);return l[0]=c*o+r,l[1]=u*a+r,l}}const n=e[0]/this._symbolTextureRatio+r,s=e[1]/this._symbolTextureRatio+r;return(o=Ue())=>(o[0]=n,o[1]=s,o)}_fastVisualVariableConvertOptions(){const e=Math.max(this._size[0],this._size[1]),i=Ce(e,e,e),r=jd(1),n=e*r,s=Ce(n,n,n);return new IR({size:!0,color:!0,rotation:!0,opacity:!1},i,s,r)}_getGraphicHash(e){let i="";for(const r of this._cimRequiredFields)i+=r+e.attributes[r];return i}_forEachMaterial(e){this._materials.forEach(e),this._cimSymbolMaterials.forEach(e)}test(){return{...super.test(),material:this._materials[0]}}};function mnt(t){return t&&t.type==="point-3d"&&t.hasVisibleVerticalOffset()}function g8(t){return t!=null&&(t==="cross"||t==="x")}pj.PRIMITIVE_SIZE=fnt,pj.elevationModeChangeTypes={definedChanged:an.UPDATE,staysOnTheGround:an.NONE,onTheGroundChanged:an.RECREATE};const gnt={mode:"relative-to-ground",offset:0},ynt=Mt(0,0,0,1),_nt=C();function fj(t){switch(t){case"butt":return lh.BUTT;case"square":return lh.SQUARE;case"round":return lh.ROUND;default:return null}}function jne(t){return t==="diamond"?"kite":t}function mj(t,e,i=null){const r=[],n=e.mapPositions;vnt(e,r);const s=r[0][1].data,o=r[0][1].indices.length,a=M_(o);return bnt(e,r,a),Tnt(e,r,a),wnt(e,r,a),xnt(e,r,a),Snt(e,r,a),Ent(e,r,a),Cnt(e,r,s),new Wn(t,r,n,on.Line,i)}function vnt(t,e){const{attributeData:{position:i},removeDuplicateStartEnd:r}=t,n=Ant(i)&&r,s=i.length/3-(n?1:0),o=new Array(2*(s-1)),a=n?i.slice(0,-3):i;let l=0;for(let c=0;c<s-1;c++)o[l++]=c,o[l++]=c+1;e.push([O.POSITION,new ke(a,o,3,n)])}function bnt(t,e,i){if(t.attributeData.colorFeature!=null)return;const r=t.attributeData.color;e.push([O.COLOR,new ke(r??rh,i,4)])}function wnt(t,e,i){t.attributeData.normal&&e.push([O.NORMAL,new ke(t.attributeData.normal,i,3)])}function xnt(t,e,i){t.attributeData.colorFeature!=null&&e.push([O.COLORFEATUREATTRIBUTE,new ke([t.attributeData.colorFeature],i,1,!0)])}function Tnt(t,e,i){t.attributeData.sizeFeature==null&&e.push([O.SIZE,new ke([t.attributeData.size??1],i,1,!0)])}function Snt(t,e,i){t.attributeData.sizeFeature!=null&&e.push([O.SIZEFEATUREATTRIBUTE,new ke([t.attributeData.sizeFeature],i,1,!0)])}function Ent(t,e,i){t.attributeData.opacityFeature!=null&&e.push([O.OPACITYFEATUREATTRIBUTE,new ke([t.attributeData.opacityFeature],i,1,!0)])}function Cnt(t,e,i){if(t.overlayInfo==null||t.overlayInfo.renderCoordsHelper.viewingMode!==Me.Global||!t.overlayInfo.spatialReference.isGeographic)return;const r=Vs(i.length),n=Fi(t.overlayInfo.spatialReference);for(let d=0;d<r.length;d+=3)Dq(i,d,r,d,n);const s=i.length/3,o=Jr(s+1);let a=Ont,l=Rnt,c=0,u=0;oe(a,r[u++],r[u++],r[u++]),o[0]=0;for(let d=1;d<s+1;++d)d===s&&(u=0),oe(l,r[u++],r[u++],r[u++]),c+=J_e(a,l),o[d]=c,[a,l]=[l,a];e.push([O.DISTANCETOSTART,new ke(o,e[0][1].indices,1,!0)])}function Ant(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const Ont=C(),Rnt=C();function NNt(t,e){if(t==null||t.length===0)return[];const i=[];return t.forEach(r=>{const n=r.length,s=Vs(3*n);r.forEach((a,l)=>{s[3*l]=a[0],s[3*l+1]=a[1],s[3*l+2]=a[2]});const o={attributeData:{position:s,normal:e},removeDuplicateStartEnd:!1};i.push(o)}),i}function Pnt(t,e,i,r){const n=t.type==="polygon"?kf.CCW_IS_HOLE:kf.NONE,s=t.type==="polygon"?t.rings:t.paths,{position:o,outlines:a}=jR(s,!!t.hasZ,n,t.spatialReference),l=Vs(o.length),c=Dwe(o,t.spatialReference,0,l,0,o,0,o.length/3,e,i,r),u=c!=null;return{lines:u?bTe(a,o,l):[],projectionSuccess:u,sampledElevation:c}}function Mnt(t,e){const i=t.type==="polygon"?kf.CCW_IS_HOLE:kf.NONE,r=t.type==="polygon"?t.rings:t.paths,{position:n,outlines:s}=jR(r,!1,i),o=jr(n,t.spatialReference,0,n,e,0,n.length/3);for(let a=2;a<n.length;a+=3)n[a]=KX;return{lines:o?bTe(s,n):[],projectionSuccess:o}}function bTe(t,e,i=null){const r=new Array;for(const{index:n,count:s}of t){if(s<=1)continue;const o=3*n,a=3*s;r.push({position:ah(e,3*n,3*s),mapPositions:i!=null?ah(i,o,a):void 0})}return r}function $nt(t){const e=new mi,i=t.multipassEnabled&&(t.output===U.Color||t.output===U.Alpha),r=t.space===ou.World;e.include(S2e,t),e.include(B2e,t),t.output===U.Depth&&e.include(Mg,t);const{vertex:n,fragment:s}=e;return s.include(Eh),tc(n,t),e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.UV0,"vec2"),e.attributes.add(O.AUXPOS1,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vUV","vec2"),e.varyings.add("vSize","float"),u_(e),i&&e.varyings.add("depth","float"),t.hasTip&&e.varyings.add("vLineWidth","float"),n.uniforms.add(new zi("nearFar",(o,a)=>a.camera.nearFar),new ai("viewport",(o,a)=>a.camera.fullViewport)),n.code.add(b`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),n.code.add(b`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),r?(e.attributes.add(O.NORMAL,"vec3"),aS(n),n.constants.add("tiltThreshold","float",.7),n.code.add(b`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):n.code.add(b`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),n.code.add(b`
      #define vecN ${r?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${r?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${t.anchor===Hb.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),t.space===ou.Screen&&(n.uniforms.add(new Vr("inverseProjectionMatrix",(o,a)=>a.camera.inverseProjectionMatrix)),n.code.add(b`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),n.code.add(b`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),n.uniforms.add(new Oe("perScreenPixelRatio",(o,a)=>a.camera.perScreenPixelRatio)),n.code.add(b`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${t.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += perpendicular(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),HS(n),RF(e),n.code.add(b`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
clip(pos, prev);`),r?(t.hideOnShortSegments&&n.code.add(b`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),n.code.add(b`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(n.code.add(b`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),t.space===ou.Screen&&n.code.add(b`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),n.code.add(b`
        ${i?"depth = pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${r?"":"vUV *= displacedPosScreen.w;"}

        ${t.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),i&&e.include(uc,t),e.include(vn,t),s.uniforms.add(new ai("intrinsicColor",o=>o.color),new Je("tex",o=>o.markerTexture)),s.include(Jf),e.constants.add("texelSize","float",1/lb),s.code.add(b`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),t.hasTip&&(e.constants.add("relativeMarkerSize","float",HX/lb),e.constants.add("relativeTipLineWidth","float",Ktt),s.code.add(b`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${r?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),e.constants.add("symbolAlphaCutoff","float",co),s.code.add(b`
  void main() {
    discardBySlice(vpos);
    ${i?"terrainDepthTest(depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${r?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${t.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    ${t.output===U.ObjectAndLayerIdColor?b`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${t.output===U.Alpha?b`fragColor = vec4(finalColor.a);`:""}
    ${t.output===U.Color?b`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===U.Color&&t.transparencyPassType===Qe.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${t.output===U.Highlight?b`fragColor = vec4(1.0);`:""}
    ${t.output===U.Depth?b`outputDepth(linearDepth);`:""}
  }
  `),e}const Int=Object.freeze(Object.defineProperty({__proto__:null,build:$nt},Symbol.toStringTag,{value:"Module"})),wTe=new Map([[O.POSITION,0],[O.UV0,1],[O.AUXPOS1,2],[O.NORMAL,3],[O.COLOR,4],[O.COLORFEATUREATTRIBUTE,4],[O.SIZE,5],[O.SIZEFEATUREATTRIBUTE,5],[O.OPACITYFEATUREATTRIBUTE,6]]);let xTe=class TTe extends Ci{initializeProgram(e){return new wi(e.rctx,TTe.shader.get().build(this.configuration),wTe)}_makePipelineState(e,i){const r=this.configuration,n=e===Qe.NONE;return Ot({blending:r.output===U.Color||r.output===U.Alpha?n?su:Wg(e):null,depthTest:{func:L_(e)},depthWrite:n?r.writeDepth?_l:null:XF(e),colorWrite:Ft,stencilWrite:r.hasOccludees?Ff:null,stencilTest:r.hasOccludees?i?y_:D_:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=Ot({blending:su,depthTest:QN,depthWrite:null,colorWrite:Ft,stencilWrite:null,stencilTest:rxe}),this._occluderPipelineOpaque=Ot({blending:su,depthTest:QN,depthWrite:null,colorWrite:Ft,stencilWrite:txe,stencilTest:ixe}),this._occluderPipelineMaskWrite=Ot({blending:null,depthTest:xX,depthWrite:null,colorWrite:null,stencilWrite:Ff,stencilTest:y_})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e,i,r){return e?this._occludeePipelineState:this.configuration.occluder?r?this._occluderPipelineTransparent:i?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}};xTe.shader=new bi(Int,()=>pe(()=>import("./LineMarker.glsl-95afceaf.js"),[],import.meta.url));let Lnt=class extends $_{constructor(e){super(e,new Nnt),this._vertexAttributeLocations=wTe,this._configuration=new Ps,this._layout=this.createLayout()}getConfiguration(e,i){return this._configuration.output=e,this._configuration.space=i.slot===ae.DRAPED_MATERIAL?ou.Draped:this.parameters.worldSpace?ou.World:ou.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==lh.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.occluder=this.parameters.renderOccluded===Pr.OccludeAndTransparentStencil,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const e=Ir().vec3f(O.POSITION).vec2f(O.UV0).vec3f(O.AUXPOS1);return this.parameters.worldSpace&&e.vec3f(O.NORMAL),this.parameters.vvSize?e.f32(O.SIZEFEATUREATTRIBUTE):e.f32(O.SIZE),this.parameters.vvColor?e.f32(O.COLORFEATUREATTRIBUTE):e.vec4f(O.COLOR),this.parameters.vvOpacity&&e.f32(O.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new Fnt(this._layout,this.parameters)}produces(e,i){return i===U.Color||i===U.Alpha||i===U.Highlight||i===U.Depth?e===ae.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===Pr.OccludeAndTransparentStencil?e===ae.OPAQUE_MATERIAL||e===ae.OCCLUDER_MATERIAL||e===ae.TRANSPARENT_OCCLUDER_MATERIAL:i===U.Color||i===U.Alpha?e===(this.parameters.writeDepth?ae.TRANSPARENT_MATERIAL:ae.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===ae.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new Dnt(e)}},Dnt=class extends _Y{constructor(){super(...arguments),this._markerPrimitive=null}dispose(){super.dispose(),this._markerTextureRepository.release(this._markerPrimitive),this._markerPrimitive=null}_updateParameters(e){const i=this._material.parameters.markerPrimitive;return i!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextureRepository.swap(i,this._markerPrimitive)}),this._markerPrimitive=i),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(xTe,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==U.Color&&this._output!==U.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},Nnt=class extends NR{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.markerPrimitive="arrow",this.placement="end",this.cap=lh.BUTT,this.anchor=Hb.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1,this.markerTexture=null}},Fnt=class{constructor(e,i){this.vertexBufferLayout=e,this._parameters=i}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(e,i,r,n,s){const o=r.attributes.get(O.POSITION).data,a=o.length/3;let l=[1,0,0];const c=r.attributes.get(O.NORMAL);this._parameters.worldSpace&&c!=null&&(l=c.data);let u=1,d=0;this._parameters.vvSize?d=r.attributes.get(O.SIZEFEATUREATTRIBUTE).data[0]:r.attributes.has(O.SIZE)&&(u=r.attributes.get(O.SIZE).data[0]);let p=[1,1,1,1],m=0;this._parameters.vvColor?m=r.attributes.get(O.COLORFEATUREATTRIBUTE).data[0]:r.attributes.has(O.COLOR)&&(p=r.attributes.get(O.COLOR).data);let y=0;this._parameters.vvOpacity&&(y=r.attributes.get(O.OPACITYFEATUREATTRIBUTE).data[0]);const _=new Float32Array(n.buffer);let v=s*(this.vertexBufferLayout.stride/4);const w=(E,A,P,N)=>{if(_[v++]=E[0],_[v++]=E[1],_[v++]=E[2],_[v++]=P[0],_[v++]=P[1],_[v++]=A[0],_[v++]=A[1],_[v++]=A[2],this._parameters.worldSpace&&(_[v++]=l[0],_[v++]=l[1],_[v++]=l[2]),this._parameters.vvSize?_[v++]=d:_[v++]=u,this._parameters.vvColor)_[v++]=m;else{const F=Math.min(4*N,p.length-4);_[v++]=p[F],_[v++]=p[F+1],_[v++]=p[F+2],_[v++]=p[F+3]}this._parameters.vvOpacity&&(_[v++]=y)};let x;(function(E){E[E.ASCENDING=1]="ASCENDING",E[E.DESCENDING=-1]="DESCENDING"})(x||(x={}));const T=(E,A)=>{const P=oe(knt,o[3*E],o[3*E+1],o[3*E+2]),N=Unt;let F=E+A;do oe(N,o[3*F],o[3*F+1],o[3*F+2]),F+=A;while(xb(P,N)&&F>=0&&F<a);e&&(Fe(P,P,e),Fe(N,N,e)),w(P,N,[-1,-1],E),w(P,N,[1,-1],E),w(P,N,[1,1],E),w(P,N,[-1,-1],E),w(P,N,[1,1],E),w(P,N,[-1,1],E)},S=this._parameters.placement;S!=="begin"&&S!=="begin-end"||T(0,x.ASCENDING),S!=="end"&&S!=="begin-end"||T(a-1,x.DESCENDING)}};const knt=C(),Unt=C(),zo={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},znt={dash:zo.dash,"dash-dot":[...zo.dash,...zo.dot],dot:zo.dot,"long-dash":zo["long-dash"],"long-dash-dot":[...zo["long-dash"],...zo.dot],"long-dash-dot-dot":[...zo["long-dash"],...zo.dot,...zo.dot],none:null,"short-dash":zo["short-dash"],"short-dash-dot":[...zo["short-dash"],...zo["short-dot"]],"short-dash-dot-dot":[...zo["short-dash"],...zo["short-dot"],...zo["short-dot"]],"short-dot":zo["short-dot"],solid:null},Bnt=8;function Vnt(t,e){return t==null?t:{pattern:t.slice(),pixelRatio:e}}function BNt(t){return{pattern:[t,t],pixelRatio:2}}function STe(t){return t!=null&&t.type==="style"?Gnt(t.style):null}function Gnt(t){return t!=null?Vnt(znt[t],Bnt):null}const jnt=["polyline","polygon","extent"],Hne=new IR({size:!0,color:!0,rotation:!1,opacity:!0});let ETe=class CTe extends Qf{constructor(e,i,r,n){super(e,i,r,n)}async doLoad(){if(this._fastUpdates=hS(this._context.renderer,Hne),!this._drivenProperties.size&&(this.symbolLayer.size!=null?this.symbolLayer.size:jd(1))<0)throw new W("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values")}_getMaterialParameters(e,i=!1){const r=this._getCombinedOpacityAndColor(i&&this._markerColor||this._materialColor);this._patternHidesLine&&!i&&(r[3]=0);const n={width:this._computeMaterialWidth(this.symbolLayer?.size),color:r,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:fj(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:STe(this.symbolLayer.pattern)};return this._fastUpdates?.visualVariables?{...n,...this._fastUpdates.materialParameters}:n}get _materialColor(){return this.symbolLayer.material?.color}get _markerColor(){return this.symbolLayer.marker?.color}get _lineMaterial(){return this._materials[dn.Line]==null&&(this._materials[dn.Line]=new Y2(this._getMaterialParameters(!1)),this._context.stage.add(this._materials[dn.Line])),this._materials[dn.Line]}get _ringMaterial(){return this._materials[dn.Ring]==null&&(this._materials[dn.Ring]=new Y2(this._getMaterialParameters(!0)),this._context.stage.add(this._materials[dn.Ring])),this._materials[dn.Ring]}get _wireframeLineMaterial(){return this._materials[dn.LineWireframe]==null&&(this._materials[dn.LineWireframe]=new Y2({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._materials[dn.LineWireframe])),this._materials[dn.LineWireframe]}get _wireframeRingMaterial(){return this._materials[dn.RingWireframe]==null&&(this._materials[dn.RingWireframe]=new Y2({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._materials[dn.RingWireframe])),this._materials[dn.RingWireframe]}get _markerMaterial(){return this._materials[dn.Marker]==null&&this.symbolLayer.marker!=null&&(this._materials[dn.Marker]=new Lnt({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,markerPrimitive:jne(this.symbolLayer.marker.style)}),this._context.stage.add(this._materials[dn.Marker])),this._materials[dn.Marker]}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._materials.length=0}_getDrivenSize(e){return this._drivenProperties.size&&e.size?ra(Eet(e.size)):1}_getDrivenColor(e){const i=Mt(1,1,1,1);return this._drivenProperties.color&&e.color&&(i[0]=e.color[0],i[1]=e.color[1],i[2]=e.color[2],e.color.length>0&&(i[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(i[3]=e.opacity),i}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,jnt,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,r,i.uid)}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables")return Dn.RecreateSymbol;{const n=this._fastUpdates;if(!dS(n,i,Hne))return Dn.RecreateSymbol;this._forEachMaterial(s=>s?.setParameters(n.materialParameters))}}return Dn.FastUpdate}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const i=e.diff.diff,r={};i.size?.type==="complete"&&(r.width=this._computeMaterialWidth(i.size.newValue),delete i.size),i.cap?.type==="complete"&&(r.cap=fj(i.cap.newValue??"butt"),delete i.cap);const n=this._prepareMarkerPatch(e,i);this._prepareMaterialPatch(e,i,n),e.symbolLayerStatePatches.push(()=>this._forEachMaterial(s=>s?.setParameters(r)))}layerOpacityChanged(){this._forEachMaterial((e,i)=>this._updateMaterialLayerOpacity(e,i===dn.Marker))}_forEachMaterial(e){this._materials.forEach(e)}_updateMaterialLayerOpacity(e,i=!1){if(e==null)return;const r=e.parameters.color,n=this.symbolLayer?.material?.color,s=this._patternHidesLine&&!i?0:this._getCombinedOpacity(n),o=Mt(r[0],r[1],r[2],s);e.setParameters({color:o})}layerElevationInfoChanged(e,i,r){const n=this._elevationContext.mode,s=FR(CTe.elevationModeChangeTypes,r,n);if(s!==an.UPDATE)return s;const o=xh(n);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(i=>i?.setParameters(e)),!0}physicalBasedRenderingChanged(){return!0}_getGeometryAsPolygonOrPolyline(e){switch(e.type){case"extent":if(e instanceof Xi)return Mf.fromExtent(e);break;case"polygon":case"polyline":return e}return null}_createAs3DShape(e,i,r){const n=e.graphic,s=this._getGeometryAsPolygonOrPolyline(n.geometry),o=s.type==="polygon"?s.rings:s.paths,a=new Array,l=ds(),c=Pnt(s,this._context.elevationProvider,this._context.renderCoordsHelper,i),u=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(c,o,u,"LineSymbol3DLayer");for(let m=0;m<c.lines.length;m++){const y=c.lines[m],_=y.position,v=y.mapPositions;if(this._context.clippingExtent!=null&&(vr(l),Zc(l,v),!Pd(l,this._context.clippingExtent)))continue;const w=this._createGeometry(s.type==="polygon"?this._ringMaterial:this._lineMaterial,e,_,v,s.type,x3.ELEVATED,r);a.push(w),nr.LINE_WIREFRAMES&&a.push(w.instantiate({material:s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial})),this._markerMaterial!=null&&a.push(w.instantiate({material:this._markerMaterial}))}if(a.length===0)return null;const d=new Yg({geometries:a,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:r}),p=new Kf(this,d,a,null,null,IJe,i);return p.alignedSampledElevation=c.sampledElevation,p.needsElevationUpdates=xh(i.mode),p}_createGeometry(e,i,r,n,s,o,a){const l=o===x3.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,c=s==="polygon",u=this._fastUpdates?.visualVariables.color,d=this._fastUpdates?.visualVariables.size,p=this._fastUpdates?.visualVariables.opacity,m=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:this._context.layer.uid}),y={position:r,size:d?null:this._getDrivenSize(i.renderingInfo),color:u?null:this._getDrivenColor(i.renderingInfo),sizeFeature:d?zd(d.field,i.graphic):null,colorFeature:u?zd(u.field,i.graphic):null,opacityFeature:p?zd(p.field,i.graphic):null};return mj(e,{overlayInfo:l,removeDuplicateStartEnd:c,mapPositions:n,attributeData:y},m)}_createAsOverlay(e,i){const r=e.graphic,n=this._getGeometryAsPolygonOrPolyline(r.geometry),s=n.type==="polygon"?n.rings:n.paths,o=n.type==="polygon"?this._ringMaterial:this._lineMaterial;o.renderPriority=this._renderPriority;const a=nr.LINE_WIREFRAMES?n.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial:null,l=this._markerMaterial;a!=null&&(a.renderPriority=this._renderPriority-.001),l!=null&&(l.renderPriority=this._renderPriority-.002);const c=new Array,u=ds(),d=vr(),p=Mnt(n,this._context.overlaySR),m=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(p,s,m,"LineSymbol3DLayer");for(const y of p.lines){if(vr(u),Zc(u,y.position),!Pd(u,this._context.clippingExtent))continue;ZT(d,u);const _=v=>{const w=this._createGeometry(v,e,y.position,void 0,n.type,x3.DRAPED,r.uid),x=new _S(w,{layerUid:i,graphicUid:r.uid});c.push(x)};if(l!=null){_(l);const v=this.symbolLayer.marker.placement;v!=="begin"&&v!=="begin-end"||Zc(u,y.position,0,1),v!=="end"&&v!=="begin-end"||Zc(u,y.position,y.position.length-3,1)}_(o),nr.LINE_WIREFRAMES&&_(a)}return new pk(this,c,d,this._context.drapeSourceRenderer)}get _patternHidesLine(){const e=this.symbolLayer.pattern;return e!=null&&e.type==="style"&&e.style==="none"}_computeMaterialWidth(e){return e=e??jd(1),this._drivenProperties.size?this._fastUpdates?.visualVariables.size?ra(1):1:ra(e)}_prepareMaterialPatch(e,i,r){const n=i.material;if(n==null)return void(r.changed&&r.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._materials[dn.Marker],e));if(n.type==="collection")return;const s=n.type==="complete"?n.newValue?.color:n.diff.color?.type==="complete"?n.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(s);r.useMaterialColor&&this._patchMaterialColor(wR(o),this._materials[dn.Marker],e),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._materials[dn.Line],e),delete i.material}_prepareMarkerPatch(e,i){const r=i.marker,n=this._markerMaterial;if(r==null||r.type!=="partial"||r.diff==null||r.diff.placement!=null||r.diff.style!=null&&r.diff.style.type!=="complete"||r.diff.color!=null&&r.diff.color.type!=="complete"||n==null)return{changed:!1,useMaterialColor:this._markerColor==null};const s=r.diff.color,o=s!=null,a=o?s.newValue:null,l=a==null&&this._markerColor==null;a&&this._patchMaterialColor(this._getCombinedOpacityAndColor(a),n,e);const c=r.diff.style?.newValue;return c&&e.symbolLayerStatePatches.push(()=>n.setParameters({markerPrimitive:jne(c)})),delete i.marker,{changed:o,useMaterialColor:l}}_patchMaterialColor(e,i,r){i!=null&&r.symbolLayerStatePatches.push(()=>i.setParameters({color:e}))}};var x3,dn;ETe.elevationModeChangeTypes={definedChanged:an.RECREATE,staysOnTheGround:an.NONE,onTheGroundChanged:an.RECREATE},function(t){t[t.DRAPED=0]="DRAPED",t[t.ELEVATED=1]="ELEVATED"}(x3||(x3={})),function(t){t[t.Line=0]="Line",t[t.Ring=1]="Ring",t[t.LineWireframe=2]="LineWireframe",t[t.RingWireframe=3]="RingWireframe",t[t.Marker=4]="Marker"}(dn||(dn={}));function ATe(t,e,i){return jr(t,e,0,a$,i.spatialReference,0,1)?(i.x=a$[0],i.y=a$[1],i.z=a$[2],i):null}const a$=C();let GE=null,d5=!0;function y8(t,e,i){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(d5)try{return new ImageData(t,e)}catch{d5=!1}return OTe(t,e,i)}function Hnt(t,e,i,r){if(!e||!i)throw new Error("Cannot construct image data without dimensions");if(d5)try{return new ImageData(t,e,i)}catch{d5=!1}const n=OTe(e,i,r);return n.data.set(t,0),n}function qnt(){return GE||(GE=document.createElement("canvas"),GE.width=1,GE.height=1),GE}function OTe(t,e,i){return i||(i=qnt()),i.getContext("2d").createImageData(t,e)}async function Wnt(t,e){const i=window.URL.createObjectURL(t);try{const{data:r}=await Ii(i,{...e,responseType:"image"});return r}catch(r){throw Fn(r)?r:new W("invalid-image",`Could not fetch requested image at ${i}`)}finally{window.URL.revokeObjectURL(i)}}async function VNt(t,e){const{arrayBuffer:i,mediaType:r}=await Ynt(t,e),n=r==="image/png";if(r==="image/gif"){const{isAnimatedGIF:s,parseGif:o}=await pe(()=>import("./gif-2a4958e6.js"),[],import.meta.url);if(s(i))return o(i,e)}if(n){const{isAnimatedPNG:s,parseApng:o}=await pe(()=>import("./apng-d31cdb46.js"),[],import.meta.url);if(s(i))return o(i,e)}return Wnt(new Blob([i],{type:r}),e)}async function Ynt(t,e){const i=Qy(t);if(i?.isBase64)return{arrayBuffer:qhe(i.data),mediaType:i.mediaType};const r=await Ii(t,{responseType:"array-buffer",...e});return{arrayBuffer:r.data,mediaType:r.getHeader("Content-Type")}}var f2;const _8=new WeakMap;let Xnt=0,Hp=f2=class extends $e{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,e,i,r){if(t instanceof HTMLImageElement){const n={type:"image-element",src:jT(t.src,r),crossOrigin:t.crossOrigin};e[i]=n}else if(t instanceof HTMLCanvasElement){const n=t.getContext("2d").getImageData(0,0,t.width,t.height),s={type:"canvas-element",imageData:this._encodeImageData(n)};e[i]=s}else if(t instanceof HTMLVideoElement){const n={type:"video-element",src:jT(t.src,r),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};e[i]=n}else if(t instanceof ImageData){const n={type:"image-data",imageData:this._encodeImageData(t)};e[i]=n}}readData(t){switch(t.type){case"image-element":{const e=new Image;return e.src=t.src,e.crossOrigin=t.crossOrigin,e}case"canvas-element":{const e=this._decodeImageData(t.imageData),i=document.createElement("canvas");return i.width=e.width,i.height=e.height,i.getContext("2d").putImageData(e,0,0),i}case"image-data":return this._decodeImageData(t.imageData);case"video-element":{const e=document.createElement("video");return e.src=t.src,e.crossOrigin=t.crossOrigin,e.autoplay=t.autoplay,e.loop=t.loop,e.muted=t.muted,e.preload=t.preload,e}default:return}}get transparent(){const t=this.data,e=this.url;if(t instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(t.getContext("2d").getImageData(0,0,t.width,t.height));if(t instanceof ImageData)return this._imageDataContainsTransparent(t);if(e){const i=e.substr(e.length-4,4).toLowerCase(),r=e.substr(0,15).toLocaleLowerCase();if(i===".png"||r==="data:image/png;")return!0}return!1}set transparent(t){this._overrideIfSome("transparent",t)}get contentHash(){const t=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e=(i="")=>`d:${i},t:${this.transparent},w:${t}`;return this.url!=null?e(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e(this.data.src):(_8.has(this.data)||_8.set(this.data,++Xnt),e(_8.get(this.data))):e()}get memoryUsage(){let t=0;if(t+=this.url!=null?this.url.length:0,this.data!=null){const e=this.data;"data"in e?t+=e.data.byteLength:e instanceof HTMLImageElement?t+=e.naturalWidth*e.naturalHeight*3:e instanceof HTMLCanvasElement&&(t+=e.width*e.height*3)}return t}clone(){const t={url:this.url,data:this.data,wrap:this._cloneWrap()};return new f2(t)}cloneWithDeduplication(t){const e=t.get(this);if(e)return e;const i=this.clone();return t.set(this,i),i}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(t){let e="";for(let i=0;i<t.data.length;i++)e+=String.fromCharCode(t.data[i]);return{data:btoa(e),width:t.width,height:t.height}}_decodeImageData(t){const e=atob(t.data),i=new Uint8ClampedArray(e.length);for(let r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return Hnt(i,t.width,t.height)}_imageDataContainsTransparent(t){for(let e=3;e<t.data.length;e+=4)if(t.data[e]!==255)return!0;return!1}static from(t){return typeof t=="string"?new f2({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new f2({data:t}):MT(f2,t)}};h([f({type:String,json:{write:Ob}})],Hp.prototype,"url",null),h([f({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),f()],Hp.prototype,"data",null),h([di("data")],Hp.prototype,"writeData",null),h([Ni("data")],Hp.prototype,"readData",null),h([f({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],Hp.prototype,"transparent",null),h([f({json:{write:!0}})],Hp.prototype,"wrap",void 0),h([f({readOnly:!0})],Hp.prototype,"contentHash",null),Hp=f2=h([z("esri.geometry.support.MeshTexture")],Hp);const T3=Hp;let m2=class extends mu($e){constructor(e){super(e),this.offset=[0,0],this.rotation=0,this.scale=[1,1]}};h([f({type:[Number],nonNullable:!0,json:{write:!0}})],m2.prototype,"offset",void 0),h([f({type:Number,nonNullable:!0,json:{write:!0}})],m2.prototype,"rotation",void 0),h([f({type:[Number],nonNullable:!0,json:{write:!0}})],m2.prototype,"scale",void 0),m2=h([z("esri.geometry.support.MeshTextureTransform")],m2);const bT=m2;var gj;let nd=gj=class extends $e{constructor(t){super(t),this.color=null,this.colorTexture=null,this.colorTextureTransform=null,this.normalTexture=void 0,this.normalTextureTransform=void 0,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const i=t!=null?t.get(this):null;if(i)return i;const r=new gj(this.clonePropertiesWithDeduplication(e));return t?.set(this,r),r}clonePropertiesWithDeduplication(t){return{color:this.color!=null?this.color.clone():null,colorTexture:this.colorTexture?.cloneWithDeduplication(t),normalTexture:this.normalTexture?.cloneWithDeduplication(t),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:this.colorTextureTransform?.clone(),normalTextureTransform:this.normalTextureTransform?.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let t=0;return t+=this.color!=null?16:0,this.colorTexture!=null&&(t+=this.colorTexture.memoryUsage),t+=this.colorTextureTransform!=null?20:0,this.normalTexture!=null&&(t+=this.normalTexture.memoryUsage),t+=this.normalTextureTransform!=null?20:0,t}};h([f({type:Ye,json:{write:!0}})],nd.prototype,"color",void 0),h([f({type:T3,json:{write:!0}})],nd.prototype,"colorTexture",void 0),h([f({type:bT,json:{write:!0}})],nd.prototype,"colorTextureTransform",void 0),h([f({type:T3,json:{write:!0}})],nd.prototype,"normalTexture",void 0),h([f({type:bT,json:{write:!0}})],nd.prototype,"normalTextureTransform",void 0),h([f({nonNullable:!0,json:{write:!0}})],nd.prototype,"alphaMode",void 0),h([f({nonNullable:!0,json:{write:!0}})],nd.prototype,"alphaCutoff",void 0),h([f({nonNullable:!0,json:{write:!0}})],nd.prototype,"doubleSided",void 0),nd=gj=h([z("esri.geometry.support.MeshMaterial")],nd);const nZ=nd;var yj;let Uu=yj=class extends nZ{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.emissiveTextureTransform=void 0,this.occlusionTexture=null,this.occlusionTextureTransform=void 0,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null,this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const i=t!=null?t.get(this):null;if(i)return i;const r=new yj(this.clonePropertiesWithDeduplication(e));return t?.set(this,r),r}getMemoryUsage(){let t=super.getMemoryUsage();return t+=this.emissiveColor!=null?16:0,this.emissiveTexture!=null&&(t+=this.emissiveTexture.memoryUsage),t+=this.emissiveTextureTransform!=null?20:0,this.occlusionTexture!=null&&(t+=this.occlusionTexture.memoryUsage),t+=this.occlusionTextureTransform!=null?20:0,this.metallicRoughnessTexture!=null&&(t+=this.metallicRoughnessTexture.memoryUsage),t+=this.metallicRoughnessTextureTransform!=null?20:0,t}clonePropertiesWithDeduplication(t){return{...super.clonePropertiesWithDeduplication(t),emissiveColor:this.emissiveColor?.clone(),emissiveTexture:this.emissiveTexture?.cloneWithDeduplication(t),emissiveTextureTransform:this.emissiveTextureTransform?.clone(),occlusionTexture:this.occlusionTexture?.cloneWithDeduplication(t),occlusionTextureTransform:this.occlusionTextureTransform?.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:this.metallicRoughnessTexture?.cloneWithDeduplication(t),metallicRoughnessTextureTransform:this.metallicRoughnessTextureTransform?.clone()}}};h([f({type:Ye,json:{write:!0}})],Uu.prototype,"emissiveColor",void 0),h([f({type:T3,json:{write:!0}})],Uu.prototype,"emissiveTexture",void 0),h([f({type:bT,json:{write:!0}})],Uu.prototype,"emissiveTextureTransform",void 0),h([f({type:T3,json:{write:!0}})],Uu.prototype,"occlusionTexture",void 0),h([f({type:bT,json:{write:!0}})],Uu.prototype,"occlusionTextureTransform",void 0),h([f({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Uu.prototype,"metallic",void 0),h([f({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Uu.prototype,"roughness",void 0),h([f({type:T3,json:{write:!0}})],Uu.prototype,"metallicRoughnessTexture",void 0),h([f({type:bT,json:{write:!0}})],Uu.prototype,"metallicRoughnessTextureTransform",void 0),Uu=yj=h([z("esri.geometry.support.MeshMaterialMetallicRoughness")],Uu);const RTe=Uu;var VL;const PTe="esri.geometry.support.MeshVertexAttributes",cx=ne.getLogger(PTe);let Ou=VL=class extends $e{constructor(t){super(t),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(t){return g2(t,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},cx)}castPosition(t){return t&&t instanceof Float32Array&&cx.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),g2(t,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},cx)}castUv(t){return g2(t,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},cx)}castNormal(t){return g2(t,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},cx)}castTangent(t){return g2(t,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},cx)}clone(){const t={position:ye(this.position),uv:ye(this.uv),normal:ye(this.normal),tangent:ye(this.tangent),color:ye(this.color)};return new VL(t)}clonePositional(){const t={position:ye(this.position),normal:ye(this.normal),tangent:ye(this.tangent),uv:this.uv,color:this.color};return new VL(t)}get memoryUsage(){let t=0;return t+=this.position.byteLength,this.uv!=null&&(t+=this.uv.byteLength),this.normal!=null&&(t+=this.normal.byteLength),this.tangent!=null&&(t+=this.tangent.byteLength),this.color!=null&&(t+=this.color.byteLength),t}};function v8(t,e,i,r){const{loggerTag:n,stride:s}=e;return t.length%s!=0?(r.error(n,`Invalid array length, expected a multiple of ${s}`),new i([])):t}function g2(t,e,i,r,n){if(!t)return t;if(t instanceof e)return v8(t,r,e,n);for(const s of i)if(t instanceof s)return v8(new e(t),r,e,n);if(Array.isArray(t))return v8(new e(t),r,e,n);{const s=i.map(o=>`'${o.name}'`);return n.error(`Failed to set property, expected one of ${s}, but got ${t.constructor.name}`),new e([])}}function jE(t,e,i){e[i]=Znt(t)}function Znt(t){const e=new Array(t.length);for(let i=0;i<t.length;i++)e[i]=t[i];return e}h([f({json:{write:jE}})],Ou.prototype,"color",void 0),h([rr("color")],Ou.prototype,"castColor",null),h([f({nonNullable:!0,json:{write:jE}})],Ou.prototype,"position",void 0),h([rr("position")],Ou.prototype,"castPosition",null),h([f({json:{write:jE}})],Ou.prototype,"uv",void 0),h([rr("uv")],Ou.prototype,"castUv",null),h([f({json:{write:jE}})],Ou.prototype,"normal",void 0),h([rr("normal")],Ou.prototype,"castNormal",null),h([f({json:{write:jE}})],Ou.prototype,"tangent",void 0),h([rr("tangent")],Ou.prototype,"castTangent",null),Ou=VL=h([z(PTe)],Ou);var bA;const MTe="esri.geometry.support.MeshComponent",Jnt=ne.getLogger(MTe);let qp=bA=class extends $e{static from(t){return MT(bA,t)}constructor(t){super(t),this.faces=null,this.material=null,this.name=void 0,this.shading="source",this.trustSourceNormals=!1}castFaces(t){return g2(t,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},Jnt)}castMaterial(t){return MT(t&&typeof t=="object"&&("metallic"in t||"roughness"in t||"metallicRoughnessTexture"in t)?RTe:nZ,t)}clone(){return new bA({faces:ye(this.faces),shading:this.shading,material:ye(this.material),trustSourceNormals:this.trustSourceNormals,name:this.name})}cloneWithDeduplication(t,e){const i={faces:ye(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,e):null,trustSourceNormals:this.trustSourceNormals,name:this.name};return new bA(i)}get memoryUsage(){let t=0;return this.faces!=null&&(t+=this.faces.byteLength),this.material!=null&&(t+=this.material.memoryUsage),t}};h([f({json:{write:!0}})],qp.prototype,"faces",void 0),h([rr("faces")],qp.prototype,"castFaces",null),h([f({type:nZ,json:{write:!0}})],qp.prototype,"material",void 0),h([rr("material")],qp.prototype,"castMaterial",null),h([f()],qp.prototype,"name",void 0),h([f({type:String,json:{write:!0}})],qp.prototype,"shading",void 0),h([f({type:Boolean})],qp.prototype,"trustSourceNormals",void 0),qp=bA=h([z(MTe)],qp);const Knt=qp;let wA=class extends mu($e){constructor(e){super(e),this.type="georeferenced-relative",this.isRelative=!0,this.isGeoreferenced=!0,this.origin=C()}getOriginPoint(e){const[i,r,n]=this.origin;return new lt({x:i,y:r,z:n,spatialReference:e})}setOriginFromPoint({x:e,y:i,z:r}){this.origin=Ce(e,i,r??0)}};h([Ut({georeferencedRelative:"georeferenced-relative"},{readOnly:!0})],wA.prototype,"type",void 0),h([f({type:[Number],nonNullable:!0,json:{write:!0}})],wA.prototype,"origin",void 0),wA=h([z("esri.geometry.support.MeshGeoreferencedRelativeVertexSpace")],wA);const Qnt=wA;let GL=class extends mu($e){constructor(){super({}),this.type="georeferenced",this.isRelative=!1,this.isGeoreferenced=!0}};h([Ut({georeferenced:"georeferenced"},{readOnly:!0})],GL.prototype,"type",void 0),GL=h([z("esri.geometry.support.MeshGeoreferencedVertexSpace")],GL);const est=GL;let xA=class extends mu($e){constructor(e){super(e),this.type="local",this.isRelative=!0,this.isGeoreferenced=!1,this.origin=C()}getOriginPoint(e){const[i,r,n]=this.origin;return new lt({x:i,y:r,z:n,spatialReference:e})}setOriginFromPoint({x:e,y:i,z:r}){this.origin=Ce(e,i,r??0)}};h([Ut({local:"local"},{readOnly:!0})],xA.prototype,"type",void 0),h([f({type:[Number],nonNullable:!0,json:{write:!0}})],xA.prototype,"origin",void 0),xA=h([z("esri.geometry.support.MeshLocalVertexSpace")],xA);const tst=xA;var _j;let Wp=_j=class extends $e{constructor(t){super(t),this.translation=C(),this.rotationAxis=Xo(Ave),this.rotationAngle=0,this.scale=Ce(1,1,1)}get rotation(){return xL(this.rotationAxis,this.rotationAngle)}set rotation(t){this.rotationAxis=Br(t),this.rotationAngle=zGe(t)}get localMatrix(){const t=be();return uO(qne,this.rotation,P7(this.rotation)),dpe(t,qne,this.translation,this.scale),t}get localMatrixInverse(){return qn(be(),this.localMatrix)}applyLocal(t,e){return Fe(e,t,this.localMatrix)}applyLocalInverse(t,e){return Fe(e,t,this.localMatrixInverse)}equals(t){return this===t||t!=null&&yq(this.localMatrix,t.localMatrix)}clone(){const t={translation:Br(this.translation),rotationAxis:Br(this.rotationAxis),rotationAngle:this.rotationAngle,scale:Br(this.scale)};return new _j(t)}};h([f({type:[Number],nonNullable:!0,json:{write:!0}})],Wp.prototype,"translation",void 0),h([f({type:[Number],nonNullable:!0,json:{write:!0}})],Wp.prototype,"rotationAxis",void 0),h([f({type:Number,nonNullable:!0,json:{write:!0}})],Wp.prototype,"rotationAngle",void 0),h([f({type:[Number],nonNullable:!0,json:{write:!0}})],Wp.prototype,"scale",void 0),h([f()],Wp.prototype,"rotation",null),h([f()],Wp.prototype,"localMatrix",null),h([f()],Wp.prototype,"localMatrixInverse",null),Wp=_j=h([z("esri.geometry.support.MeshTransform")],Wp);const qne=Sh(),ist=Wp;function $Te(t,e){return t.isGeographic||t.isWebMercator&&(e?.geographic??!0)}function WNt(t,e,i){const r=!t.isGeoreferenced;i?.geographic!=null&&i.geographic!==r&&ne.getLogger(e).warnOnce(`Specifying the 'geographic' parameter (${i.geographic}) for a Mesh vertex space of type "${t.type}" is not supported. This parameter will be ignored.`)}const fk=ne.getLogger("esri.geometry.support.meshUtils.normalProjection");function ITe(t,e,i,r,n){return gk(r)?(mk(fg.TO_PCPF,ws.fromTypedArray(t),wh.fromTypedArray(e),wh.fromTypedArray(i),r,ws.fromTypedArray(n)),n):(fk.error("Cannot convert spatial reference to PCPF"),n)}function rst(t,e,i,r,n){return gk(r)?(mk(fg.FROM_PCPF,ws.fromTypedArray(t),wh.fromTypedArray(e),wh.fromTypedArray(i),r,ws.fromTypedArray(n)),n):(fk.error("Cannot convert to spatial reference from PCPF"),n)}function nst(t,e,i){return jr(t,e,0,i,VS(e),0,t.length/3),i}function sst(t,e,i){return jr(t,VS(i),0,e,i,0,t.length/3),e}function LTe(t,e,i){return Ag(Ls,i),ep(e,t,Ls),qW(Ls)||lk(e,e),e}function DTe(t,e,i){if(Ag(Ls,i),ep(e,t,Ls,4),qW(Ls)||lk(e,e,4),t!==e)for(let r=3;r<t.length;r+=4)e[r]=t[r];return e}function NTe(t,e,i,r,n){if(!gk(r))return fk.error("Cannot convert spatial reference to PCPF"),n;mk(fg.TO_PCPF,ws.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),wh.fromTypedArray(e),wh.fromTypedArray(i),r,ws.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT));for(let s=3;s<t.length;s+=4)n[s]=t[s];return n}function ost(t,e,i,r,n){if(!gk(r))return fk.error("Cannot convert to spatial reference from PCPF"),n;mk(fg.FROM_PCPF,ws.fromTypedArray(t,16),wh.fromTypedArray(e),wh.fromTypedArray(i),r,ws.fromTypedArray(n,16));for(let s=3;s<t.length;s+=4)n[s]=t[s];return n}function mk(t,e,i,r,n,s){if(!e)return;const o=i.count,a=VS(n);if(FTe(n))for(let l=0;l<o;l++)r.getVec(l,l$),e.getVec(l,bp),ic(a,l$,c$,a),gh(Ls,c$),t===fg.FROM_PCPF&&yh(Ls,Ls),Zl(bp,bp,Ls),s.setVec(l,bp);else for(let l=0;l<o;l++){r.getVec(l,l$),e.getVec(l,bp),ic(a,l$,c$,a),gh(Ls,c$);const c=kD(i.get(l,1));let u=Math.cos(c);t===fg.TO_PCPF&&(u=1/u),Ls[0]*=u,Ls[1]*=u,Ls[2]*=u,Ls[3]*=u,Ls[4]*=u,Ls[5]*=u,t===fg.FROM_PCPF&&yh(Ls,Ls),Zl(bp,bp,Ls),ge(bp,bp),s.setVec(l,bp)}return s}function gk(t){return FTe(t)||ast(t)}function FTe(t){return t.isWGS84||_de(t)||Vf(t)||Gf(t)}function ast(t){return t.isWebMercator}var fg;(function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"})(fg||(fg={}));const l$=C(),bp=C(),c$=be(),Ls=Hr();function sZ(t,e,i){return $Te(e.spatialReference,i)?hst(t,e,i):ust(t,e,i)}function kTe(t,e=zr){const{position:i,normal:r,tangent:n}=t;return{position:Qd(new Float64Array(i.length),i,e),normal:r!=null?LTe(r,new Float32Array(r.length),e):null,tangent:n!=null?DTe(n,new Float32Array(n.length),e):null}}function UTe(t,e,i,r){const{position:n,normal:s,tangent:o}=t;return e.isRelative?sZ(kTe(t,i?.localMatrix),e.getOriginPoint(r),{geographic:!e.isGeoreferenced}):{position:n,normal:s,tangent:o}}function lst(t,e,i){if(i?.useTransform){const{position:r,normal:n,tangent:s}=t,{x:o,y:a,z:l}=e,c=Ce(o,a,l??0);return{vertexAttributes:{position:r,normal:n,tangent:s},vertexSpace:i.geographic??1?new tst({origin:c}):new Qnt({origin:c}),transform:new ist}}return{vertexAttributes:sZ(t,e,i),vertexSpace:new est,transform:null}}function vj(t,e,i){return $Te(e.spatialReference,i)?mst(t,e,i):BTe(t,e,i)}function cst(t,e,i,r,n){if(!e.isRelative)return vj(t,r,n);const{spatialReference:s}=r,o=UTe(t,e,i,s);return r.equals(e.getOriginPoint(s))?BTe(o,r,n):vj(o,r,n)}function zTe({positions:t,transform:e,vertexSpace:i,inSpatialReference:r,outSpatialReference:n,outPositions:s,localMode:o}){const a=i.isRelative?i.origin:Gs,l=i.isRelative?e?.localMatrix??zr:zr;if(i.isGeoreferenced){const p=s??Vs(t.length);if(I4(l,zr)?rHe(p,t):Qd(p,t,l),!Po(a,Gs)){const[m,y,_]=a;for(let v=0;v<p.length;v+=3)p[v]+=m,p[v+1]+=y,p[v+2]+=_}return jr(p,r,0,p,n,0,p.length/3),p}let c=r;const u=VS(r);c=n.isWebMercator&&o||!Hd(r,u)?c:u,ic(r,a,q1,c),Di(q1,q1,l);const d=s??Vs(t.length);return Qd(d,t,q1),jr(d,c,0,d,n,0,d.length/3),d}function ust(t,e,i){const r=new Float64Array(t.position.length),n=t.position,s=e.x,o=e.y,a=e.z??0,l=oZ(i?i.unit:null,e.spatialReference);for(let c=0;c<n.length;c+=3)r[c]=n[c]*l+s,r[c+1]=n[c+1]*l+o,r[c+2]=n[c+2]*l+a;return{position:r,normal:t.normal,tangent:t.tangent}}function hst(t,e,i){const r=e.spatialReference,n=VTe(e,i,q1),s=new Float64Array(t.position.length),o=dst(t.position,n,r,s),a=Ag(GTe,n);return{position:o,normal:pst(o,s,t.normal,a,r),tangent:fst(o,s,t.tangent,a,r)}}function dst(t,e,i,r){Qd(r,t,e);const n=new Float64Array(t.length);return sst(r,n,i)}function pst(t,e,i,r,n){if(i==null)return null;const s=new Float32Array(i.length);return ep(s,i,r),rst(s,t,e,n,s),s}function fst(t,e,i,r,n){if(i==null)return null;const s=new Float32Array(i.length);ep(s,i,r,4);for(let o=3;o<s.length;o+=4)s[o]=i[o];return ost(s,t,e,n,s),s}function BTe(t,e,i){const r=new Float64Array(t.position.length),n=t.position,s=e.x,o=e.y,a=e.z??0,l=oZ(i?i.unit:null,e.spatialReference);for(let c=0;c<n.length;c+=3)r[c]=(n[c]-s)/l,r[c+1]=(n[c+1]-o)/l,r[c+2]=(n[c+2]-a)/l;return{position:r,normal:t.normal,tangent:t.tangent}}function mst(t,e,i){const r=e.spatialReference;VTe(e,i,q1);const n=qn(vst,q1),s=new Float64Array(t.position.length),o=gst(t.position,r,n,s),a=Ag(GTe,n);return{position:o,normal:yst(t.normal,t.position,s,r,a),tangent:_st(t.tangent,t.position,s,r,a)}}function VTe(t,e,i){ic(t.spatialReference,[t.x,t.y,t.z??0],i,VS(t.spatialReference));const r=oZ(e?e.unit:null,t.spatialReference);return lR(i,i,[r,r,r]),i}function gst(t,e,i,r){const n=nst(t,e,r),s=new Float64Array(n.length);return Qd(s,n,i),s}function yst(t,e,i,r,n){if(t==null)return null;const s=ITe(t,e,i,r,new Float32Array(t.length));return ep(s,s,n),s}function _st(t,e,i,r,n){if(t==null)return null;const s=NTe(t,e,i,r,new Float32Array(t.length));return ep(s,s,n,4),s}function oZ(t,e){if(t==null)return 1;const i=OB(e);return 1/ao(i,"meters",t)}const q1=be(),vst=be(),GTe=Hr(),YNt=Object.freeze(Object.defineProperty({__proto__:null,applyTransform:kTe,georeference:sZ,georeferenceApplyTransform:UTe,georeferenceByTransform:lst,project:zTe,ungeoreference:vj,ungeoreferenceByTransform:cst},Symbol.toStringTag,{value:"Module"}));var S3;(function(t){t[t.EnableFastUpdates=0]="EnableFastUpdates",t[t.DisableFastUpdates=1]="DisableFastUpdates",t[t.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"})(S3||(S3={}));let jTe=class{constructor(e){this.data=e,this.type="encoded-mesh-texture",this.encoding=lg.KTX2_ENCODING}};function E3(t){return t?.type==="encoded-mesh-texture"}async function bst(t){const e=new Blob([t]),i=await e.text();return JSON.parse(i)}async function wst(t,e){if(e===lg.KTX2_ENCODING)return new jTe(t);const i=new Blob([t],{type:e}),r=URL.createObjectURL(i),n=new Image;if(ie("esri-iPhone"))return new Promise((s,o)=>{const a=()=>{c(),s(n)},l=u=>{c(),o(u)},c=()=>{URL.revokeObjectURL(r),n.removeEventListener("load",a),n.removeEventListener("error",l)};n.addEventListener("load",a),n.addEventListener("error",l),n.src=r});try{n.src=r,await n.decode()}catch{console.warn("Failed decoding HTMLImageElement")}return URL.revokeObjectURL(r),n}function hf(t){if(t==null)return null;const e=t.offset!=null?t.offset:Ixe,i=t.rotation!=null?t.rotation:0,r=t.scale!=null?t.scale:Lxe,n=NL(1,0,0,0,1,0,e[0],e[1],1),s=NL(Math.cos(i),-Math.sin(i),0,Math.sin(i),Math.cos(i),0,0,0,1),o=NL(r[0],0,0,0,r[1],0,0,0,1),a=sa();return tS(a,s,o),tS(a,n,a),a}let xst=class extends Kf{constructor(){super(...arguments),this._originalGeometries=[],this._fastTransformUpdatesEnabled=!1}get fastTransformUpdatesEnabled(){return this._fastTransformUpdatesEnabled}enableFastTransformUpdates(e,i){if(this._fastTransformUpdatesEnabled)return;this._fastTransformUpdatesEnabled=!0;const{stageObject:r}=this,n=r.geometries.slice();r.removeAllGeometries();const s=HD(b8,r.transformation),o=i.getOrigin(s);for(const a of n){const l=e(a.material),c=a.instantiate({material:l});c.localOrigin=o,r.addGeometry(c)}this._originalGeometries=n}disableFastTransformUpdates(e){if(!this._fastTransformUpdatesEnabled)return;this._fastTransformUpdatesEnabled=!1;const{stageObject:i}=this,r=i.geometries.map(n=>e(n.material));i.removeAllGeometries();for(let n=0;n<this._originalGeometries.length;n++){const s=this._originalGeometries[n],o=r[n];o.setParameters({modelTransformation:null}),o===s.material?i.addGeometry(s):i.addGeometry(s.instantiate({material:o}))}this._originalGeometries.length=0}updateFastLocalOrigin(e,i,r){if(!this._fastTransformUpdatesEnabled)return;const{stageObject:n}=this;if(n.geometries.length===0)return;const s=n.geometries[0].localOrigin,o=HD(b8,e),a=r.getOrigin(o);if(a===s)return;const l=i?.localMatrix??zr;n.shaderTransformation=null,n.transformation=e,n.geometries.forEach(c=>{c.transformation=l,c.localOrigin=a})}updateTransform(e,i,r){const{stageObject:n}=this,s=i?.localMatrix??zr;if(!this._fastTransformUpdatesEnabled)return n.shaderTransformation=null,n.transformation=e,n.geometries.forEach(m=>{m.transformation=s}),void(this._fastUpdateEdgeTransform()||this.resetEdgeObject(r));const o=n.transformation,a=n.geometries[0].transformation,l=e,c=s,u=Di(Wne,o,a),d=Di(Yne,l,c),p=Di(Xne,d,qn(Xne,a));n.shaderTransformation=p,this._setFastMaterialTransformation({matA:u,matB:d}),this._fastUpdateEdgeTransform()||this.resetEdgeObject(r)}alignWithElevation(e,i,r,n){if(!this._fastTransformUpdatesEnabled)return void super.alignWithElevation(e,i,r,n);r!=null&&ek(this.elevationContext.featureExpressionInfoContext,r);const s=(y,_)=>m_(y,e,this.elevationContext,i,_),{stageObject:o}=this;if(!o.geometries[0].material.parameters.modelTransformation)return;const a=o.transformation,l=o.geometries[0].transformation,c=Di(Wne,a,l),u=o.effectiveTransformation,d=Nn(Tst,u);this.alignedSampledElevation=sb(this,this.elevationContext,e.spatialReference,s,i,d),o.shaderTransformation=d;const p=o.geometries[0].transformation,m=Di(Yne,d,p);this._setFastMaterialTransformation({matA:c,matB:m}),this._fastUpdateEdgeTransform()||this.resetEdgeObject(n)}_setFastMaterialTransformation({matA:e,matB:i}){const{stageObject:r}=this;if(r.geometries.length===0)return;const n=r.geometries[0].localOrigin,s=cR(Sst,te(b8,n.vec3,-1)),o=Di(Zne,s,e),a=Di(Jne,s,i),l=qn(Zne,o),c=Di(Jne,a,l);for(const u of r.geometries)u.material.setParameters({modelTransformation:c})}_fastUpdateEdgeTransform(){return this._stageLayer.stage.renderer.ensureEdgeView().fastUpdateObject3DEdgesTransform(this.stageObject)}};const b8=C(),Wne=be(),Yne=be(),Tst=be(),Xne=be(),Zne=be(),Jne=be(),Sst=be();let Est=class{constructor(){this._fastTransformOriginalMaterials=new Map,this._fastTransformClonedMaterials=new Map,this._graphicReferenceCount=0}enable(e,i,r){e.enableFastTransformUpdates(n=>{if(this._graphicReferenceCount<=1){if(this._fastTransformOriginalMaterials.has(n))return n;const o=i.byMaterial(n);return this._fastTransformOriginalMaterials.set(n,o),i.delete(n),n}const s=new Jd(n.parameters);return r.stage.add(s),this._fastTransformClonedMaterials.set(s,n),s},r.localOriginFactory)}disable(e,i,r){const n=new Set,s=new Set;e.disableFastTransformUpdates(o=>{if(!this._fastTransformClonedMaterials.has(o)){const c=o,u=this._fastTransformOriginalMaterials.get(c);return i.has(u.uid)?(n.add(c),i.byUid(u.uid).material):(s.add(c),u.material)}const a=o,l=this._fastTransformClonedMaterials.get(a);return this._fastTransformClonedMaterials.delete(a),r.stage.remove(a),l});for(const o of n)this._fastTransformOriginalMaterials.delete(o),r.stage.remove(o);for(const o of s){const a=this._fastTransformOriginalMaterials.get(o);this._fastTransformOriginalMaterials.delete(o),i.set(a.uid,a)}}onAddGraphic(){this._graphicReferenceCount++}onRemoveGraphic(e,i,r){this._graphicReferenceCount--,this.disable(e,i,r)}forEachMaterialInfo(e){this._fastTransformOriginalMaterials.forEach(e)}forEachClonedMaterial(e){this._fastTransformClonedMaterials.forEach(e)}destroy(e){e.removeMany(Array.from(this._fastTransformClonedMaterials.keys())),e.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),({material:i})=>i)),this._fastTransformClonedMaterials.clear(),this._fastTransformOriginalMaterials.clear()}},Cst=class{constructor(){this._byUid=new Map,this._byMaterial=new Map}get materials(){return Array.from(this._byUid.values(),e=>e.material)}byUid(e){return this._byUid.get(e)}byMaterial(e){return this._byMaterial.get(e)}set(e,i){this._byUid.set(e,i),this._byMaterial.set(i.material,i)}delete(e){const i=this._byMaterial.get(e)?.uid;i&&(this._byUid.delete(i),this._byMaterial.delete(e))}has(e){return this._byUid.has(e)}forEachMaterialInfo(e){this._byUid.forEach(e)}clear(){this._byUid.clear(),this._byMaterial.clear()}};function Ast(t){const e=new mi,{vertex:i,fragment:r}=e;return e.include(ml,t),e.include(gw,t),tc(i,t),e.attributes.add(O.POSITION,"vec3"),e.varyings.add("vpos","vec3"),i.code.add(b`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);
}`),t.output===U.Highlight&&e.include(I_,t),e.include(vn,t),r.uniforms.add(new Oe("alphaCoverage",(n,s)=>Math.min(1,n.width*s.camera.pixelRatio))),t.hasVertexColors||r.uniforms.add(new ai("constantColor",n=>n.color)),r.code.add(b`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${t.hasVertexColors?"vColor":"constantColor"};

    ${t.output===U.ObjectAndLayerIdColor?b`color.a = 1.0;`:""}

    if (color.a < ${b.float(co)}) {
      discard;
    }

    ${t.output===U.Color?b`fragColor = highlightSlice(color, vpos);`:""}
    ${t.output===U.Highlight?b`outputHighlight();`:""}
  }
  `),e}const Ost=Object.freeze(Object.defineProperty({__proto__:null,build:Ast},Symbol.toStringTag,{value:"Module"}));let HTe=class qTe extends Ci{initializeProgram(e){return new wi(e.rctx,qTe.shader.get().build(this.configuration),fi)}initializePipeline(){const e=this.configuration,i=fo(Te.SRC_ALPHA,Te.ONE,Te.ONE_MINUS_SRC_ALPHA,Te.ONE_MINUS_SRC_ALPHA),r=(n,s=null,o=null)=>Ot({blending:s,depthTest:xX,depthWrite:o,colorWrite:Ft,stencilWrite:e.hasOccludees?Ff:null,stencilTest:e.hasOccludees?n?y_:D_:null});return e.output===U.Color?(this._occludeePipelineState=r(!0,e.transparent?i:null,_l),r(!1,e.transparent?i:null,_l)):r(!1)}get primitiveType(){return Qt.LINES}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};HTe.shader=new bi(Ost,()=>pe(()=>import("./NativeLine.glsl-d112d237.js"),[],import.meta.url));let y2=class extends Ua{constructor(){super(...arguments),this.output=U.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.hasOccludees=!1}};h([V({count:U.COUNT})],y2.prototype,"output",void 0),h([V()],y2.prototype,"hasSlicePlane",void 0),h([V()],y2.prototype,"hasVertexColors",void 0),h([V()],y2.prototype,"transparent",void 0),h([V()],y2.prototype,"hasOccludees",void 0);let Kne=class extends $_{constructor(e){super(e,new Pst),this._configuration=new y2}getConfiguration(e){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration}intersect(e,i,r,n,s,o){if(!r.options.selectionMode||!e.visible)return;if(!K_e(i))return void ne.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const a=e.attributes.get(O.POSITION).data,l=r.camera,c=$st;Yn(c,r.point);const u=2;oe(HE[0],c[0]-u,c[1]+u,0),oe(HE[1],c[0]+u,c[1]+u,0),oe(HE[2],c[0]+u,c[1]-u,0),oe(HE[3],c[0]-u,c[1]-u,0);for(let _=0;_<4;_++)if(!l.unprojectFromRenderScreen(HE[_],hm[_]))return;Ko(l.eye,hm[0],hm[1],w8),Ko(l.eye,hm[1],hm[2],x8),Ko(l.eye,hm[2],hm[3],T8),Ko(l.eye,hm[3],hm[0],S8);let d=Number.MAX_VALUE,p=0;for(let _=0;_<a.length-5;_+=3){if(Za[0]=a[_]+i[12],Za[1]=a[_+1]+i[13],Za[2]=a[_+2]+i[14],Ja[0]=a[_+3]+i[12],Ja[1]=a[_+4]+i[13],Ja[2]=a[_+5]+i[14],ir(w8,Za)<0&&ir(w8,Ja)<0||ir(x8,Za)<0&&ir(x8,Ja)<0||ir(T8,Za)<0&&ir(T8,Ja)<0||ir(S8,Za)<0&&ir(S8,Ja)<0)continue;if(l.projectToRenderScreen(Za,dv),l.projectToRenderScreen(Ja,pv),dv[2]<0&&pv[2]>0){he(wp,Za,Ja);const w=l.frustum,x=-ir(w[ur.NEAR],Za)/me(wp,w[ur.NEAR]);te(wp,wp,x),ce(Za,Za,wp),l.projectToRenderScreen(Za,dv)}else if(dv[2]>0&&pv[2]<0){he(wp,Ja,Za);const w=l.frustum,x=-ir(w[ur.NEAR],Ja)/me(wp,w[ur.NEAR]);te(wp,wp,x),ce(Ja,Ja,wp),l.projectToRenderScreen(Ja,pv)}else if(dv[2]<0&&pv[2]<0)continue;dv[2]=0,pv[2]=0;const v=CW(tb(dv,pv,tse),c);v<d&&(d=v,se(Qne,Za),se(ese,Ja),p=_/3)}const m=r.rayBegin,y=r.rayEnd;if(d<u*u){let _=Number.MAX_VALUE;if(P0e(tb(Qne,ese,tse),tb(m,y,Mst),hv)){he(hv,hv,m);const v=we(hv);te(hv,hv,1/v),_=v/br(m,y)}o(_,hv,p,!1)}}intersectDraped(e,i,r,n,s,o){if(!r.options.selectionMode)return;const a=e.attributes.get(O.POSITION).data,l=e.attributes.get(O.SIZE),c=l?l.data[0]:0,u=n[0],d=n[1],p=((c+1)/2+4)*e.screenToWorldRatio;let m=Number.MAX_VALUE,y=0;for(let _=0;_<a.length-5;_+=3){const v=a[_],w=a[_+1],x=u-v,T=d-w,S=a[_+3]-v,E=a[_+4]-w,A=_e((S*x+E*T)/(S*S+E*E),0,1),P=S*A-x,N=E*A-T,F=P*P+N*N;F<m&&(m=F,y=_/3)}m<p*p&&s(o.dist,o.normal,y,!1)}produces(e,i){return!(i!==U.Color&&i!==U.Highlight&&i!==U.ObjectAndLayerIdColor||e!==ae.OPAQUE_MATERIAL&&e!==ae.DRAPED_MATERIAL)}createGLMaterial(e){return new Rst(e)}createBufferWriter(){const e=this.parameters.hasVertexColors?Sit:xit;return new ZS(e)}},Rst=class extends P_{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===U.Color&&this._updateOccludeeState(e),this.ensureTechnique(HTe,e)}},Pst=class extends uX{constructor(){super(...arguments),this.color=rh,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.hasOccludees=!1}};const Za=C(),Ja=C(),wp=C(),hv=C(),dv=Mo(),pv=Mo(),Qne=C(),ese=C(),tse=tp(),Mst=tp(),$st=C(),HE=[Mo(),Mo(),Mo(),Mo()],hm=[C(),C(),C(),C()],w8=Ti(),x8=Ti(),T8=Ti(),S8=Ti(),Ist=["mesh"];class Lst extends Qf{constructor(e,i,r,n){super(e,i,r,n),this._materialInfoCache=new Cst,this._fastUpdateProcessor=new Est,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){nr.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new Kne({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new Kne({color:[0,1,1,1]}))}destroy(){super.destroy(),this._textures.forEach(e=>e.unload()),this._context.stage.removeMany(this._materialInfoCache.materials),this._context.stage.removeMany(Array.from(this._textures.values())),this._materialInfoCache.clear(),this._textures.clear(),this._fastUpdateProcessor.destroy(this._context.stage)}get materials(){return this._materialInfoCache.materials}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,Ist,"fill on mesh-3d"))return null;const r=this.setGraphicElevationContext(i),n=e.renderingInfo;return this._createAs3DShape(i,n,r,i.uid)}onRemoveGraphic(e){this._fastUpdateProcessor.onRemoveGraphic(e,this._materialInfoCache,this._context)}layerOpacityChanged(e,i){const r=this._getLayerOpacity();this._updateMaterialParameters(n=>{n.material.setParameters({layerOpacity:r});const s=n.material.parameters;this._setMaterialTransparentParameter(s,n),n.material.setParameters({transparent:s.transparent})}),e.forEach(n=>i(n)?.layerOpacityChanged(r,this._context.isAsync))}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,g_)}slicePlaneEnabledChanged(e,i){return this._updateMaterialParameters(({material:r})=>{r.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),e.forEach(r=>i(r)?.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._updateMaterialParameters(({material:i})=>i.setParameters({usePBR:e})),!0}updateTransform(e,i,r,n){const s=this._context.renderCoordsHelper.spatialReference,o=Dst,{origin:a,transform:l}=r;switch(ic(i,oe(As,a.x,a.y,a.z??0),o,s),n){case S3.EnableFastUpdates:this._fastUpdateProcessor.enable(e,this._materialInfoCache,this._context);break;case S3.DisableFastUpdates:this._fastUpdateProcessor.disable(e,this._materialInfoCache,this._context);break;case S3.UpdateFastLocalOrigin:e.updateFastLocalOrigin(o,l,this._context.localOriginFactory)}const{elevationContext:c}=e;c.centerPointInElevationSR=this._getCenterPointInElevationSR(o);const{elevationProvider:u,renderCoordsHelper:d}=this._context,p=(m,y)=>m_(m,u,c,d,y);return e.alignedSampledElevation=sb(e,c,u.spatialReference,p,d,o),e.updateTransform(o,l,this._context.isAsync),!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(e){return e==null?"-":e instanceof Ye?e.toHex():e.contentHash}_materialPropertiesDefault(e,i){const r=this._requiresSymbolVertexColors(),n=!!e.vertexAttributes.color,s=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:r,hasVertexColors:n,hasVertexTangents:s,uid:`vc:${n},vt:${s},vct${i},svc:${r}`}}_textureTransformUid(e){const{offset:i,scale:r,rotation:n}=e??Fst;return`${i[0]},${i[1]},${n},${r[0]},${r[1]}`}_materialProperties(e,i,r){const n=this._materialPropertiesDefault(e,r);if(!i.material)return n;const{color:s,colorTexture:o,colorTextureTransform:a,normalTexture:l,normalTextureTransform:c,doubleSided:u,alphaCutoff:d,alphaMode:p}=i.material,m=this._colorOrTextureUid(s),y=this._colorOrTextureUid(o),_=this._textureTransformUid(a),v=this._colorOrTextureUid(l),w=this._textureTransformUid(c);if(n.color=s,n.colorTexture=o,n.normalTexture=l,n.uid=`${n.uid},cmuid:${m},ctmuid:${y},cttuid:${_},ntmuid:${v},nttuid:${w},ds:${u},ac:${d},am:${p}`,i.material instanceof RTe){const{metallic:x,roughness:T,metallicRoughnessTexture:S,metallicRoughnessTextureTransform:E,emissiveColor:A,emissiveTexture:P,emissiveTextureTransform:N,occlusionTexture:F,occlusionTextureTransform:D}=i.material,$=this._colorOrTextureUid(S),R=this._textureTransformUid(E),k=this._colorOrTextureUid(A),B=this._colorOrTextureUid(P),j=this._textureTransformUid(N),X=this._colorOrTextureUid(F),M=this._textureTransformUid(D);n.metallic=x,n.roughness=T,n.metallicRoughnessTexture=S,n.emissiveColor=A,n.emissiveTexture=P,n.occlusionTexture=F,n.colorTextureTransform=this._convertTextureTransform(a),n.normalTextureTransform=this._convertTextureTransform(c),n.emissiveTextureTransform=this._convertTextureTransform(N),n.occlusionTextureTransform=this._convertTextureTransform(D),n.metallicRoughnessTextureTransform=this._convertTextureTransform(E),n.uid=`${n.uid},mrm:${x},mrr:${T},mrt:${$},mrtt:${R},emuid:${k},etmuid:${B},ett:${j},otmuid:${X},ott:${M}`}return n}_convertTextureTransform(e){if(!e)return null;const{scale:i,offset:r,rotation:n}=e;return{scale:i,offset:r,rotation:Rt(n)}}_setInternalColorValueParameters(e,i){i.diffuse=Ye.toUnitRGB(e),i.opacity=e.a}_getLoadableTextureResource(e){return e.data??e.url}_getInternalTextureId(e){return this._getInternalTexture(e,Wi.Opaque)?.id}_getInternalTexture(e,i){const r=this._getLoadableTextureResource(e);if(!r)return null;const n=`${e.contentHash}/${i}`;let s=this._textures.get(n);if(!s){let o=null;const a=this._context.stage.renderView.renderingContext.parameters.maxMaxAnisotropy,l={wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0,maxAnisotropy:a,mipmap:a>1};E3(r)?(o=r.data,l.preMultiplyAlpha=!1,l.encoding=r.encoding):(o=r,l.preMultiplyAlpha=i!==Wi.Opaque,l.downsampleUncompressed=this._context.graphicsCoreOwner.view.qualitySettings.graphics3D.uncompressedTextureDownsamplingEnabled),s=new yw(o,l),this._textures.set(n,s),s.load(this._context.stage.renderView.renderingContext),this._context.stage.add(s)}return s}_castTextureWrap(e="repeat"){if(typeof e=="string"){const i=this._castTextureWrapIndividual(e);return{s:i,t:i}}return{s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}}_castTextureWrapIndividual(e){switch(e){case"clamp":return Nt.CLAMP_TO_EDGE;case"mirror":return Nt.MIRRORED_REPEAT;default:return Nt.REPEAT}}_setInternalMaterialParameters(e,i){if(e.color!=null&&this._setInternalColorValueParameters(e.color,i),e.colorTexture!=null){const r=this._getInternalTexture(e.colorTexture,i.textureAlphaMode);r?(i.textureId=r.id,i.textureAlphaPremultiplied=!!r.parameters.preMultiplyAlpha):i.textureId=void 0}e.normalTexture&&(i.normalTextureId=this._getInternalTextureId(e.normalTexture)),e.emissiveColor&&(i.emissiveFactor=Ye.toUnitRGB(e.emissiveColor)),e.emissiveTexture&&(i.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),e.occlusionTexture&&(i.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),e.metallicRoughnessTexture&&(i.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture)),i.colorTextureTransformMatrix=hf(e.colorTextureTransform),i.normalTextureTransformMatrix=hf(e.normalTextureTransform),i.occlusionTextureTransformMatrix=hf(e.occlusionTextureTransform),i.emissiveTextureTransformMatrix=hf(e.emissiveTextureTransform),i.metallicRoughnessTextureTransformMatrix=hf(e.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(e){const i=this._drivenProperties.color;let r=this.symbolLayer.material?.colorMixMode??null;if(i)e.externalColor=rh;else{const n=this.symbolLayer.material?.color??null;n?e.externalColor=Ye.toUnitRGBA(n):(r=null,e.externalColor=rh)}r&&(e.colorMixMode=r),e.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(e){const i=e.vertexAttributes.color;if(i==null)return!1;for(let r=3;r<i.length;r+=4)if(i[r]!==255)return!0;return!1}_getOrCreateMaterial(e,i){const r=i.material?.color,n=i.material?.colorTexture,s=i.material?.alphaMode,o=s==="blend",a=s!=="opaque"&&(this._hasTransparentVertexColors(e)||r!=null&&r.a<1||n?.transparent||o),l=this._materialProperties(e,i,a),c=this._materialInfoCache.byUid(l.uid);if(c)return c.material;const u={uid:l.uid,material:null,isComponentTransparent:a,alphaMode:i.material?i.material.alphaMode:"opaque"},d=nxe({normalTexture:l.normalTexture,metallicRoughnessTexture:l.metallicRoughnessTexture,metallicFactor:l.metallic,roughnessFactor:l.roughness,emissiveTexture:l.emissiveTexture,emissiveFactor:Ye.toUnitRGB(l.emissiveColor),occlusionTexture:l.occlusionTexture}),p={usePBR:this._usePBR(),isSchematic:d,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:Gs,diffuse:eg,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:dr.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};p.mrrFactors=d?[...TX]:[l.metallic,l.roughness,ik[2]],i.material&&(p.doubleSided=i.material.doubleSided,p.cullFace=i.material.doubleSided?dr.None:dr.Back,p.textureAlphaCutoff=i.material.alphaCutoff),this._setExternalMaterialParameters(p),this._setMaterialTransparentParameter(p,u),this._setInternalMaterialParameters(l,p);const m=new Jd(p);return u.material=m,this._materialInfoCache.set(l.uid,u),this._context.stage.add(m),m}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,i){e.transparent=this.needsDrivenTransparentPass||i.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,i.alphaMode==="auto"?e.textureAlphaMode=e.transparent?Wi.MaskBlend:Wi.Opaque:e.textureAlphaMode=i.alphaMode==="opaque"?Wi.Opaque:i.alphaMode==="mask"?Wi.Mask:Wi.Blend}_addDebugNormals(e,i){const r=i.length,n=e.spatialReference.isGeographic?20015077/180:1,s=.1*Math.max(e.extent.width*n,e.extent.height*n,e.extent.zmax-e.extent.zmin),o=[],a=[],l=[],c=[];for(let m=0;m<r;m++){const y=i[m],_=y.attributes.get(O.POSITION),v=y.attributes.get(O.NORMAL),w=_.data,x=_.indices,T=v.data,S=v.indices;for(let E=0;E<x.length;E++){const A=3*x[E],P=3*S[E];for(let N=0;N<3;N++)o.push(w[A+N]);for(let N=0;N<3;N++)o.push(w[A+N]+T[P+N]*s);if(a.push(a.length),a.push(a.length),E%3==0){this._calculateFaceNormal(w,x,E,dx),this._getFaceVertices(w,x,E,As,ux,hx),ce(As,As,ux),ce(As,As,hx),te(As,As,1/3);for(let N=0;N<3;N++)l.push(As[N]);for(let N=0;N<3;N++)l.push(As[N]+dx[N]*s);c.push(c.length),c.push(c.length)}}}const u=i[0].transformation,d=new Wn(this._debugVertexNormalMaterial,[[O.POSITION,new ke(o,a,3,!0)]],null,on.Line);i.push(d),d.transformation=u;const p=new Wn(this._debugFaceNormalMaterial,[[O.POSITION,new ke(l,c,3,!0)]],null,on.Line);p.transformation=u,i.push(p)}_createAs3DShape(e,i,r,n){const s=e.geometry;if(s.type!=="mesh")return null;const o=this._createGeometryInfo(s,i,n);if(o==null)return null;const{geometries:a,objectTransformation:l}=o;nr.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(s,a);const c=new Yg({geometries:a,layerUid:this._context.layer.uid,graphicUid:n});c.transformation=l;const u=Jwe(this.symbolLayer,{opacity:this._getLayerOpacity()}),d=u?new GJe(a[0].material,[u],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,p=new xst(this,c,a,null,null,sb,r,d);this._fastUpdateProcessor.onAddGraphic(),p.needsElevationUpdates=g_(r.mode),p.useObjectOriginAsAttachmentOrigin=!0,r.centerPointInElevationSR=this._getCenterPointInElevationSR(c.transformation);const{elevationProvider:m,renderCoordsHelper:y}=this._context,_=(v,w)=>m_(v,m,r,y,w);return p.alignedSampledElevation=sb(p,r,m.spatialReference,_,y),p}_getCenterPointInElevationSR(e){const i=R_(0,0,0,this._context.elevationProvider.spatialReference!=null?this._context.elevationProvider.spatialReference:null);return ATe([e[12],e[13],e[14]],this._context.renderCoordsHelper.spatialReference,i),i}_createComponentNormals(e,i,r,n){switch(r.shading||"flat"){default:case"source":return this._createComponentNormalsSource(e,i,r,n);case"flat":return this._createComponentNormalsFlat(e,n);case"smooth":return this._createComponentNormalsSmooth(e,n)}}_createComponentNormalsSource(e,i,r,n){if(i==null)return this._createComponentNormalsFlat(e,n);let s=!1;if(!r.trustSourceNormals)for(let o=0;o<n.length;o+=3){this._calculateFaceNormal(e,n,o,dx);for(let a=0;a<3;a++){const l=3*n[o+a];As[0]=i[l],As[1]=i[l+1],As[2]=i[l+2],me(dx,As)<0&&(i[l]=-i[l],i[l+1]=-i[l+1],i[l+2]=-i[l+2],s=!0)}}return new E8(i,n,s)}_createComponentNormalsFlat(e,i){const r=Jr(i.length),n=new Array(3*i.length);for(let s=0;s<i.length;s+=3){const o=this._calculateFaceNormal(e,i,s,dx);for(let a=0;a<3;a++)r[s+a]=o[a],n[s+a]=s/3}return new E8(r,n,!1)}_createComponentNormalsSmooth(e,i){const r={};for(let o=0;o<i.length;o+=3){const a=this._calculateFaceNormal(e,i,o,dx);for(let l=0;l<3;l++){const c=i[o+l];let u=r[c];u||(u={normal:C(),count:0},r[c]=u),ce(u.normal,u.normal,a),u.count++}}const n=Jr(3*i.length),s=new Array(3*i.length);for(let o=0;o<i.length;o++){const a=r[i[o]];a.count!==1&&(ge(a.normal,a.normal),a.count=1);for(let l=0;l<3;l++)n[3*o+l]=a.normal[l];s[o]=o}return new E8(n,s,!1)}_getFaceVertices(e,i,r,n,s,o){const a=3*i[r],l=3*i[r+1],c=3*i[r+2];n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],s[0]=e[l],s[1]=e[l+1],s[2]=e[l+2],o[0]=e[c],o[1]=e[c+1],o[2]=e[c+2]}_calculateFaceNormal(e,i,r,n){return this._getFaceVertices(e,i,r,As,ux,hx),he(ux,ux,As),he(hx,hx,As),nt(As,ux,hx),ge(n,As),n}_getOrCreateComponents(e){return e.components??Nst}_createPositionBuffer(e,i){let r=e.vertexAttributes.position;const n=i.reprojection===Nl.ECEF?i.transformBeforeProject:null;if(n&&(r=Qd(new Float64Array(r.length),r,n)),i.reprojection===Nl.NONE)return i.needsBufferCopy?new Float64Array(r):r;const s=n?r:new Float64Array(r.length);return jr(r,e.spatialReference,0,s,this._context.renderCoordsHelper.spatialReference,0,r.length/3),s}_createNormalBuffer(e,i,r){let n=e.vertexAttributes.normal;if(n==null)return null;const s=r.reprojection===Nl.ECEF?r.transformBeforeProject:null;if(s&&(n=LTe(n,new Float32Array(n.length),s)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===Nl.NONE)return r.needsBufferCopy&&e.vertexAttributes.normal===n?new Float32Array(n):n;const o=e.vertexAttributes.position,a=s?n:new Float32Array(n.length);return ITe(n,o,i,e.spatialReference,a)}_createTangentBuffer(e,i,r){let n=e.vertexAttributes.tangent;if(n==null)return null;const s=r.reprojection===Nl.ECEF?r.transformBeforeProject:null;if(s&&(n=DTe(n,new Float32Array(n.length),s)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===Nl.NONE)return r.needsBufferCopy&&e.vertexAttributes.normal===n?new Float32Array(n):n;const o=e.vertexAttributes.position,a=s?n:new Float32Array(n.length);return NTe(n,o,i,e.spatialReference,a)}_createColorBuffer(e){return e.vertexAttributes.color}_createSymbolColorBuffer(e){if(this._requiresSymbolVertexColors()){const i=this._getVertexOpacityAndColor(e),r=oKe(this.symbolLayer?.material?.colorMixMode),n=new Uint8Array(4);return oxe(i,r,n),n}return null}_createBuffers(e,i){const r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const n=e.vertexAttributes.normal,s=e.vertexAttributes.uv,o=e.vertexAttributes.tangent;if(n&&n.length!==r.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(o&&o.length/4!=r.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(s&&s.length/2!=r.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(e),l=this._createPositionBuffer(e,a),c=this._createColorBuffer(e),u=this._createSymbolColorBuffer(i),d=this._createNormalBuffer(e,l,a),p=this._createTangentBuffer(e,l,a);return{positionBuffer:l,normalBuffer:d,tangentBuffer:p,uvBuffer:s,colorBuffer:c,symbolColorBuffer:u,objectTransformation:a.reprojection===Nl.NONE&&a.objectTransformation?a.objectTransformation:this._transformOriginLocal(e,l,d,p),geometryTransformation:a.reprojection===Nl.NONE&&a.geometryTransformation?a.geometryTransformation:be()}}_computeReprojectionInfo(e){const{vertexSpace:i}=e,r=i.isRelative,n=i.isGeoreferenced?this._context.renderCoordsHelper.viewingMode===Me.Local?Nl.NONE:Nl.ECEF:Nl.NONE;if(r){const{origin:s}=i,o=be(),a=e.transform?.localMatrix??zr;if(n===Nl.NONE)return ic(e.spatialReference,s,o,this._context.renderCoordsHelper.spatialReference),{reprojection:n,objectTransformation:o,geometryTransformation:JT(a),needsBufferCopy:!1};const l=cR(be(),s);return Di(l,l,a),{reprojection:n,transformBeforeProject:l,needsBufferCopy:!0}}return{reprojection:n,needsBufferCopy:!0}}_transformOriginLocal(e,i,r,n){const s=this._context.renderCoordsHelper.spatialReference,o=e.anchor;u$[0]=o.x,u$[1]=o.y,u$[2]=o.z??0;const a=be();return ic(e.spatialReference,u$,a,s),qn(ise,a),Qd(i,i,ise),(r||n)&&(gh(qE,a),yh(qE,qE),r&&ep(r,r,qE),n&&ep(n,n,qE,4)),a}_validateFaces(e,i){const r=e.vertexAttributes.position.length/3,n=i.faces;if(n){let s=-1;for(let o=0;o<n.length;o++){const a=n[o];a>s&&(s=a)}if(r<=s)return this.logger.warn(`Vertex index ${s} is out of bounds of the mesh position buffer`),!1}else if(r%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(e,i){return i.faces??pw(e.vertexAttributes.position.length/3)}_isOutsideClippingArea(e){if(!this._context.clippingExtent)return!1;const i=e.vertexAttributes?.position;if(!i)return!1;const r=this._context.elevationProvider.spatialReference,n=zTe({positions:i,transform:e.transform,vertexSpace:e.vertexSpace,inSpatialReference:e.spatialReference,outSpatialReference:r??e.spatialReference,localMode:this._context.stage.viewingMode===Me.Local}),s=n.length/3;return vr(C8),Zc(C8,n,0,s),!Pd(C8,this._context.clippingExtent)}_createGeometryInfo(e,i,r){if(!Hd(e.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(e))return null;const n=this._createBuffers(e,i);if(n==null)return null;const{positionBuffer:s,uvBuffer:o,colorBuffer:a,symbolColorBuffer:l,normalBuffer:c,tangentBuffer:u,objectTransformation:d,geometryTransformation:p}=n,m=this._getOrCreateComponents(e),y=new Array;let _=!1;const v=HD(As,d),w=this._context.localOriginFactory.getOrigin(v);for(const x of m){if(!this._validateFaces(e,x))return null;const T=this._getOrCreateFaces(e,x);if(T.length===0)continue;const S=this._createComponentNormals(s,c,x,T);S.didFlipNormals&&(_=!0);const E=[[O.POSITION,new ke(s,T,3,!0)],[O.NORMAL,new ke(S.normals,S.indices,3,!0)]];a&&E.push([O.COLOR,new ke(a,T,4,!0)]),l&&E.push([O.SYMBOLCOLOR,new ke(l,M_(T.length),4,!0)]),o&&E.push([O.UV0,new ke(o,T,2,!0)]),u&&E.push([O.TANGENT,new ke(u,T,4,!0)]);const A=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:r,layerUid:this._context.layer.uid}),P=this._getOrCreateMaterial(e,x),N=new Wn(P,E,null,on.Mesh,A);N.transformation=p,N.localOrigin=w,y.push(N)}return _&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:y,objectTransformation:d}}_updateMaterialParameters(e){this._materialInfoCache.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachClonedMaterial((i,r)=>{r.setParameters(i.parameters)})}test(){return{...super.test(),materials:this._materialInfoCache.materials}}}class E8{constructor(e,i,r){this.normals=e,this.indices=i,this.didFlipNormals=r}}const u$=C(),As=C(),ux=C(),hx=C(),dx=C(),ise=be(),qE=Hr(),Dst=be(),C8=ds(),Nst=[new Knt],Fst=new bT;var Nl;(function(t){t[t.NONE=0]="NONE",t[t.ECEF=1]="ECEF"})(Nl||(Nl={}));let kst=class{constructor(e,i,r,n){this.graphics3DSymbolLayer=e,this.instanceIndex=i,this.elevationAligner=r,this.elevationContext=n,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const i=this._lodRenderer.instanceData;e!==i.getVisible(this.instanceIndex)&&i.setVisible(this.instanceIndex,e)}destroy(){this.instanceIndex!=null&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,i,r){if(this.elevationAligner){ek(this.elevationContext.featureExpressionInfoContext,r);const n=(o,a)=>m_(o,e,this.elevationContext,i,a),s=this.elevationAligner(this,this.elevationContext,e.spatialReference,n,i);s!=null&&(this.alignedSampledElevation=s)}}getCenterObjectSpace(e=C()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,xp),Fe(e,this._lodRenderer.baseBoundingSphere.center,xp)}getBoundingBoxObjectSpace(e=ds()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,xp);const i=this._lodRenderer.baseBoundingBox;vr(e);for(let r=0;r<8;++r)oe(Ru,1&r?i[3]:i[0],2&r?i[4]:i[1],4&r?i[5]:i[2]),Fe(Ru,Ru,xp),Yd(e,Ru);return e}computeAttachmentOrigin(e){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,xp),e.render.origin[0]+=xp[12],e.render.origin[1]+=xp[13],e.render.origin[2]+=xp[14],e.render.num++}async getProjectedBoundingBox(e,i,r,n,s){const o=this.getBoundingBoxObjectSpace(s),a=Ust,l=dW(o)?1:a.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,xp);for(let u=0;u<l;u++){const d=a[u];Ru[0]=o[d[0]],Ru[1]=o[d[1]],Ru[2]=o[d[2]],Fe(Ru,Ru,xp),fv[3*u]=Ru[0],fv[3*u+1]=Ru[1],fv[3*u+2]=Ru[2]}if(!e(fv,0,l))return null;vr(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let d=0;d<3;d++)o[d]=Math.min(o[d],fv[u+d]),o[d+3]=Math.max(o[d+3],fv[u+d]);c&&r.push({location:fv.slice(u,u+3),screenSpaceBoundingRect:c})}if(i&&(Rd(o,A8),this.elevationContext.mode!=="absolute-height")){let u;const d=_X(o,i.service.spatialReference,i);try{u=await i.service.queryElevation(A8[0],A8[1],n,d,"ground")}catch{}u!=null&&Ige(o,0,0,-this.alignedSampledElevation+u)}return o}addObjectState(e,i){if(e===Rg.Highlight){const r=new LN(e);this._addHighlightId(r),i.addExternal(n=>{this._removeHighlightId(n)},r)}}removeObjectState(e){this._highlights.forEach(i=>e.remove(i))}_addHighlightId(e){this._highlights.add(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(e){this._highlights.delete(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}};const fv=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Ru=C(),A8=C(),Ust=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],xp=be();function zst(t,e){const i=t.stageResources.geometries.map(n=>new qwe(n,t.stageResources.textures)),r=t.lodThreshold==null||t.lodThreshold===0&&e>0?Vst(i):t.lodThreshold;return new Wwe(i,r,t.pivotOffset)}function Bst(t){return new Ywe(t.map((e,i)=>zst(e,i)))}function Vst(t){const e=t.reduce((i,{geometry:r})=>i+r.indexCount/3,0);return Math.sqrt(e*Gst/Math.PI)}const Gst=20;function jst(t){return t=t||globalThis.location.hostname,Hst.some(e=>t?.match(e)!=null)}function bj(t,e){return t&&(e=e||globalThis.location.hostname)?e.match(WTe)!=null||e.match(XTe)!=null?t.replace("static.arcgis.com","staticdev.arcgis.com"):e.match(YTe)!=null||e.match(ZTe)!=null?t.replace("static.arcgis.com","staticqa.arcgis.com"):t:t}const WTe=/^devext.arcgis.com$/,YTe=/^qaext.arcgis.com$/,XTe=/^[\w-]*\.mapsdevext.arcgis.com$/,ZTe=/^[\w-]*\.mapsqa.arcgis.com$/,Hst=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,WTe,YTe,/^jsapps.esri.com$/,XTe,ZTe];function qst(t,e,i){if(t.count!==e.count)return void ak.error("source and destination buffers need to have the same number of elements");const r=t.count,n=i[0],s=i[1],o=i[2],a=i[3],l=i[4],c=i[5],u=i[6],d=i[7],p=i[8],m=i[9],y=i[10],_=i[11],v=i[12],w=i[13],x=i[14],T=i[15],S=t.typedBuffer,E=t.typedBufferStride,A=e.typedBuffer,P=e.typedBufferStride;for(let N=0;N<r;N++){const F=N*E,D=N*P,$=A[D],R=A[D+1],k=A[D+2],B=A[D+3];S[F]=n*$+l*R+p*k+v*B,S[F+1]=s*$+c*R+m*k+w*B,S[F+2]=o*$+u*R+y*k+x*B,S[F+3]=a*$+d*R+_*k+T*B}}function Wst(t,e,i){aZ(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function aZ(t,e,i,r=4,n=r){if(t.length/r!=e.length/n)return void ak.error("source and destination buffers need to have the same number of elements");const s=t.length/r,o=i[0],a=i[1],l=i[2],c=i[3],u=i[4],d=i[5],p=i[6],m=i[7],y=i[8];let _=0,v=0;for(let w=0;w<s;w++){const x=e[_],T=e[_+1],S=e[_+2],E=e[_+3];t[v]=o*x+c*T+p*S,t[v+1]=a*x+u*T+m*S,t[v+2]=l*x+d*T+y*S,t[v+3]=E,_+=n,v+=r}}function Yst(t,e){const i=Math.min(t.count,e.count),r=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride;for(let a=0;a<i;a++){const l=a*n,c=a*o,u=s[c],d=s[c+1],p=s[c+2],m=u*u+d*d+p*p;if(m>0){const y=1/Math.sqrt(m);r[l]=y*u,r[l+1]=y*d,r[l+2]=y*p}}}function Xst(t,e,i){p5(t.typedBuffer,e,i,t.typedBufferStride)}function p5(t,e,i,r=4){const n=Math.min(t.length/r,e.count),s=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<n;c++)t[l]=i*s[a],t[l+1]=i*s[a+1],t[l+2]=i*s[a+2],t[l+3]=i*s[a+3],a+=o,l+=r}Object.freeze(Object.defineProperty({__proto__:null,normalize:Yst,scale:p5,scaleView:Xst,transformMat3:aZ,transformMat3View:Wst,transformMat4:qst},Symbol.toStringTag,{value:"Module"}));function Zst(t,e){lZ(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function lZ(t,e,i=2,r=i){const n=e.length/2;let s=0,o=0;if(uh(e)||ROe(e)){for(let l=0;l<n;++l)t[s]=e[o],t[s+1]=e[o+1],s+=i,o+=r;return}const a=POe(e);if(OOe(e))for(let l=0;l<n;++l)t[s]=Math.max(e[o]/a,-1),t[s+1]=Math.max(e[o+1]/a,-1),s+=i,o+=r;else for(let l=0;l<n;++l)t[s]=e[o]/a,t[s+1]=e[o+1]/a,s+=i,o+=r}function Jst(t,e,i,r){const n=t.typedBuffer,s=t.typedBufferStride,o=r?.count??t.count;let a=(r?.dstIndex??0)*s;for(let l=0;l<o;++l)n[a]=e,n[a+1]=i,a+=s}Object.freeze(Object.defineProperty({__proto__:null,fill:Jst,normalizeIntegerBuffer:lZ,normalizeIntegerBufferView:Zst},Symbol.toStringTag,{value:"Module"}));function Kst(t,e){WR(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function WR(t,e,i=3,r=i){const n=e.length/r;let s=0,o=0;for(let a=0;a<n;++a)t[s]=e[o],t[s+1]=e[o+1],t[s+2]=e[o+2],s+=i,o+=r}function Qst(t,e,i,r,n){const s=t.typedBuffer,o=t.typedBufferStride,a=n?.count??t.count;let l=(n?.dstIndex??0)*o;for(let c=0;c<a;++c)s[l]=e,s[l+1]=i,s[l+2]=r,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:WR,copyView:Kst,fill:Qst},Symbol.toStringTag,{value:"Module"}));function eot(t,e){cZ(t.typedBuffer,e,t.typedBufferStride)}function cZ(t,e,i=4){const r=e.typedBuffer,n=e.typedBufferStride,s=e.count;let o=0,a=0;for(let l=0;l<s;++l)t[o]=r[a],t[o+1]=r[a+1],t[o+2]=r[a+2],t[o+3]=r[a+3],o+=i,a+=n}function tot(t,e,i,r,n,s){const o=t.typedBuffer,a=t.typedBufferStride,l=s?.count??t.count;let c=(s?.dstIndex??0)*a;for(let u=0;u<l;++u)o[c]=e,o[c+1]=i,o[c+2]=r,o[c+3]=n,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:cZ,copyView:eot,fill:tot},Symbol.toStringTag,{value:"Module"}));let JTe=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,i){return this._load("json",e,i)}async loadBinary(e,i){return Bf(e)?(Et(i),FH(e)):this._load("binary",e,i)}async loadImage(e,i){return this._load("image",e,i)}async _load(e,i,r){if(this._streamDataRequester==null)return(await Ii(i,{responseType:iot[e]})).data;const n=await hh(this._streamDataRequester.request(i,e,r));if(n.ok===!0)return n.value;throw T_(n.error),new W("",`Request for resource failed: ${n.error}`)}};const iot={image:"image",binary:"array-buffer",json:"json","image+type":void 0};function rot(t={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...t}}function not(t,e={}){return{data:t,parameters:{wrap:{s:Nt.REPEAT,t:Nt.REPEAT,...e.wrap},noUnpackFlip:!0,mipmap:!1,...e}}}function jL(t,e){const i=t.count;e||(e=new t.TypedArrayConstructor(i));for(let r=0;r<i;r++)e[r]=t.get(r);return e}Object.freeze(Object.defineProperty({__proto__:null,makeDense:jL},Symbol.toStringTag,{value:"Module"}));let rse=class{constructor(e){this._data=e,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const e=this._offset4;return this._offset4+=1,this._dataUint32[e]}readUint8Array(e){const i=4*this._offset4;return this._offset4+=e/4,new Uint8Array(this._data,i,e)}remainingBytes(){return this._data.byteLength-4*this._offset4}};var C3,nse;(function(t){t.SCALAR="SCALAR",t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4",t.MAT2="MAT2",t.MAT3="MAT3",t.MAT4="MAT4"})(C3||(C3={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(nse||(nse={}));const KTe={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},sot={pbrMetallicRoughness:KTe,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},oot={ESRI_externalColorMixMode:"tint"},sse=(t={})=>{const e={...KTe,...t.pbrMetallicRoughness},i=aot({...oot,...t.extras});return{...sot,...t,pbrMetallicRoughness:e,extras:i}};function aot(t){switch(t.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:t.ESRI_externalColorMixMode,t.ESRI_externalColorMixMode="tint"}return t}const lot={magFilter:Lt.LINEAR,minFilter:Lt.LINEAR_MIPMAP_LINEAR,wrapS:Nt.REPEAT,wrapT:Nt.REPEAT},cot=t=>({...lot,...t});function uot(t){let e,i;return t.replace(/^(.*\/)?([^/]*)$/,(r,n,s)=>(e=n||"",i=s||"","")),{dirPart:e,filePart:i}}const h$={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};let hot=class ay{constructor(e,i,r,n){if(this._context=e,this.uri=i,this.json=r,this._glbBuffer=n,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu"],this._baseUri=uot(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),r.scenes==null)throw new W("gltf-loader-unsupported-feature","Scenes must be defined.");if(r.meshes==null)throw new W("gltf-loader-unsupported-feature","Meshes must be defined");if(r.nodes==null)throw new W("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(e,i,r){if(Bf(i)){const o=Qy(i);if(o&&o.mediaType!=="model/gltf-binary")try{const l=JSON.parse(o.isBase64?atob(o.data):o.data);return new ay(e,i,l)}catch{}const a=FH(i);if(ay._isGLBData(a))return this._fromGLBData(e,i,a)}if(yot.test(i)||r?.expectedType==="gltf"){const o=await e.loadJSON(i,r);return new ay(e,i,o)}const n=await e.loadBinary(i,r);if(ay._isGLBData(n))return this._fromGLBData(e,i,n);if(_ot.test(i)||r?.expectedType==="glb")throw new W("gltf-loader-invalid-glb","This is not a valid glb file.");const s=await e.loadJSON(i,r);return new ay(e,i,s)}static _isGLBData(e){if(e==null)return!1;const i=new rse(e);return i.remainingBytes()>=4&&i.readUint32()===h$.MAGIC}static async _fromGLBData(e,i,r){const n=await ay._parseGLBData(r);return new ay(e,i,n.json,n.binaryData)}static async _parseGLBData(e){const i=new rse(e);if(i.remainingBytes()<12)throw new W("gltf-loader-error","glb binary data is insufficiently large.");const r=i.readUint32(),n=i.readUint32(),s=i.readUint32();if(r!==h$.MAGIC)throw new W("gltf-loader-error","Magic first 4 bytes do not fit to expected glb value.");if(e.byteLength<s)throw new W("gltf-loader-error","glb binary data is smaller than header specifies.");if(n!==2)throw new W("gltf-loader-unsupported-feature","An unsupported glb container version was detected. Only version 2 is supported.");let o,a,l=0;for(;i.remainingBytes()>=8;){const c=i.readUint32(),u=i.readUint32();if(l===0){if(u!==h$.CHUNK_TYPE_JSON)throw new W("gltf-loader-error","First glb chunk must be JSON.");if(c<0)throw new W("gltf-loader-error","No JSON data found.");o=await bst(i.readUint8Array(c))}else if(l===1){if(u!==h$.CHUNK_TYPE_BIN)throw new W("gltf-loader-unsupported-feature","Second glb chunk expected to be BIN.");a=i.readUint8Array(c)}else ne.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 glb chunks detected. Skipping.");l+=1}if(!o)throw new W("gltf-loader-error","No glb JSON chunk detected.");return{json:o,binaryData:a}}async getBuffer(e,i){const r=this.json.buffers[e];if(r.uri==null){if(this._glbBuffer==null)throw new W("gltf-loader-error","glb buffer not present");return this._glbBuffer}const n=await this._getBufferLoader(e,i);if(n.byteLength!==r.byteLength)throw new W("gltf-loader-error","Buffer byte lengths should match.");return n}async _getBufferLoader(e,i){const r=this._bufferLoaders.get(e);if(r)return r;const n=this.json.buffers[e].uri,s=this._context.loadBinary(this._resolveUri(n),i).then(o=>new Uint8Array(o));return this._bufferLoaders.set(e,s),s}async getAccessor(e,i){if(!this.json.accessors)throw new W("gltf-loader-unsupported-feature","Accessors missing.");const r=this.json.accessors[e];if(r?.bufferView==null)throw new W("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(r.type in[C3.MAT2,C3.MAT3,C3.MAT4])throw new W("gltf-loader-unsupported-feature",`AttributeType ${r.type} is not supported`);const n=this.json.bufferViews[r.bufferView],s=await this.getBuffer(n.buffer,i),o=fot[r.type],a=mot[r.componentType],l=o*a,c=n.byteStride||l;return{raw:s.buffer,byteStride:c,byteOffset:s.byteOffset+(n.byteOffset||0)+(r.byteOffset||0),entryCount:r.count,isDenselyPacked:c===l,componentCount:o,componentByteSize:a,componentType:r.componentType,min:r.min,max:r.max,normalized:!!r.normalized}}async getIndexData(e,i){if(e.indices==null)return;const r=await this.getAccessor(e.indices,i);if(r.isDenselyPacked)switch(r.componentType){case Ze.UNSIGNED_BYTE:return new Uint8Array(r.raw,r.byteOffset,r.entryCount);case Ze.UNSIGNED_SHORT:return new Uint16Array(r.raw,r.byteOffset,r.entryCount);case Ze.UNSIGNED_INT:return new Uint32Array(r.raw,r.byteOffset,r.entryCount)}else switch(r.componentType){case Ze.UNSIGNED_BYTE:return jL(this._wrapAccessor(lS,r));case Ze.UNSIGNED_SHORT:return jL(this._wrapAccessor(LF,r));case Ze.UNSIGNED_INT:return jL(this._wrapAccessor(NF,r))}}async getPositionData(e,i){if(e.attributes.POSITION==null)throw new W("gltf-loader-unsupported-feature","No POSITION vertex data found.");const r=await this.getAccessor(e.attributes.POSITION,i);if(r.componentType!==Ze.FLOAT)throw new W("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+Ze[r.componentType]);if(r.componentCount!==3)throw new W("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+r.componentCount.toFixed());return this._wrapAccessor(ws,r)}async getNormalData(e,i){if(e.attributes.NORMAL==null)throw new W("gltf-loader-error","No NORMAL vertex data found.");const r=await this.getAccessor(e.attributes.NORMAL,i);if(r.componentType!==Ze.FLOAT)throw new W("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+Ze[r.componentType]);if(r.componentCount!==3)throw new W("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+r.componentCount.toFixed());return this._wrapAccessor(ws,r)}async getTangentData(e,i){if(e.attributes.TANGENT==null)throw new W("gltf-loader-error","No TANGENT vertex data found.");const r=await this.getAccessor(e.attributes.TANGENT,i);if(r.componentType!==Ze.FLOAT)throw new W("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+Ze[r.componentType]);if(r.componentCount!==4)throw new W("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+r.componentCount.toFixed());return new Zd(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*r.entryCount)}async getTextureCoordinates(e,i){if(e.attributes.TEXCOORD_0==null)throw new W("gltf-loader-error","No TEXCOORD_0 vertex data found.");const r=await this.getAccessor(e.attributes.TEXCOORD_0,i);if(r.componentCount!==2)throw new W("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+r.componentCount.toFixed());if(r.componentType===Ze.FLOAT)return this._wrapAccessor(dw,r);if(!r.normalized)throw new W("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return got(r)}async getVertexColors(e,i){if(e.attributes.COLOR_0==null)throw new W("gltf-loader-error","No COLOR_0 vertex data found.");const r=await this.getAccessor(e.attributes.COLOR_0,i);if(r.componentCount!==4&&r.componentCount!==3)throw new W("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+r.componentCount.toFixed());if(r.componentCount===4){if(r.componentType===Ze.FLOAT)return this._wrapAccessor(Zd,r);if(r.componentType===Ze.UNSIGNED_BYTE)return this._wrapAccessor(la,r);if(r.componentType===Ze.UNSIGNED_SHORT)return this._wrapAccessor(OR,r)}else if(r.componentCount===3){if(r.componentType===Ze.FLOAT)return this._wrapAccessor(ws,r);if(r.componentType===Ze.UNSIGNED_BYTE)return this._wrapAccessor(IF,r);if(r.componentType===Ze.UNSIGNED_SHORT)return this._wrapAccessor(DF,r)}throw new W("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+Ze[r.componentType])}hasPositions(e){return e.attributes.POSITION!==void 0}hasNormals(e){return e.attributes.NORMAL!==void 0}hasVertexColors(e){return e.attributes.COLOR_0!==void 0}hasTextureCoordinates(e){return e.attributes.TEXCOORD_0!==void 0}hasTangents(e){return e.attributes.TANGENT!==void 0}async getMaterial(e,i,r){let n=e.material?this._materialCache.get(e.material):void 0;if(!n){const s=e.material!=null?sse(this.json.materials[e.material]):sse(),o=s.pbrMetallicRoughness,a=this.hasVertexColors(e),l=this.getTexture(o.baseColorTexture,i),c=this.getTexture(s.normalTexture,i),u=r?this.getTexture(s.occlusionTexture,i):void 0,d=r?this.getTexture(s.emissiveTexture,i):void 0,p=r?this.getTexture(o.metallicRoughnessTexture,i):void 0,m=e.material!=null?e.material:-1;n={alphaMode:s.alphaMode,alphaCutoff:s.alphaCutoff,color:o.baseColorFactor,doubleSided:!!s.doubleSided,colorTexture:await l,normalTexture:await c,name:s.name,id:m,occlusionTexture:await u,emissiveTexture:await d,emissiveFactor:s.emissiveFactor,metallicFactor:o.metallicFactor,roughnessFactor:o.roughnessFactor,metallicRoughnessTexture:await p,hasVertexColors:a,ESRI_externalColorMixMode:s.extras.ESRI_externalColorMixMode,colorTextureTransform:o?.baseColorTexture?.extensions?.KHR_texture_transform,normalTextureTransform:s.normalTexture?.extensions?.KHR_texture_transform,occlusionTextureTransform:s.occlusionTexture?.extensions?.KHR_texture_transform,emissiveTextureTransform:s.emissiveTexture?.extensions?.KHR_texture_transform,metallicRoughnessTextureTransform:o?.metallicRoughnessTexture?.extensions?.KHR_texture_transform}}return n}async getTexture(e,i){if(!e)return;if((e.texCoord||0)!==0)throw new W("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const r=e.index,n=this.json.textures[r],s=cot(n.sampler!=null?this.json.samplers[n.sampler]:{}),o=this._getTextureSourceId(n),a=this.json.images[o],l=await this._loadTextureImageData(r,n,i);return bhe(this._textureCache,r,()=>{const c=d=>d===33071||d===33648||d===10497,u=d=>{throw new W("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${d}`)};return{data:l,wrapS:c(s.wrapS)?s.wrapS:u(s.wrapS),wrapT:c(s.wrapT)?s.wrapT:u(s.wrapT),minFilter:s.minFilter,name:a.name,id:r}})}getNodeTransform(e){if(e===void 0)return dot;let i=this._nodeTransformCache.get(e);if(!i){const r=this.getNodeTransform(this._getNodeParent(e)),n=this.json.nodes[e];n.matrix?i=Di(be(),r,n.matrix):n.translation||n.rotation||n.scale?(i=JT(r),n.translation&&yl(i,i,n.translation),n.rotation&&(d$[3]=WW(d$,n.rotation),Jl(i,i,d$[3],d$)),n.scale&&lR(i,i,n.scale)):i=JT(r),this._nodeTransformCache.set(e,i)}return i}_wrapAccessor(e,i){return new e(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*(i.entryCount-1)+i.componentByteSize*i.componentCount)}_resolveUri(e){return La(e,this._baseUri)}_getNodeParent(e){return this._nodeParentMap.get(e)}_checkVersionSupported(){const e=Pb.parse(this.json.asset.version,"glTF");pot.validate(e)}_checkRequiredExtensionsSupported(){const e=this.json;if(e.extensionsRequired&&!e.extensionsRequired.every(i=>this._supportedExtensions.includes(i)))throw new W("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((e,i)=>{e.children&&e.children.forEach(r=>{this._nodeParentMap.set(r,i)})})}async _loadTextureImageData(e,i,r){const n=this._textureLoaders.get(e);if(n)return n;const s=this._createTextureLoader(i,r);return this._textureLoaders.set(e,s),s}_getTextureSourceId(e){if(e.extensions!==void 0&&e.extensions.KHR_texture_basisu!==null)return e.extensions.KHR_texture_basisu.source;if(e.source!==null)return e.source;throw new W("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}async _createTextureLoader(e,i){const r=this._getTextureSourceId(e),n=this.json.images[r];if(n.uri){if(n.uri.endsWith(".ktx2")){const l=await this._context.loadBinary(this._resolveUri(n.uri),i);return new jTe(new Uint8Array(l))}return this._context.loadImage(this._resolveUri(n.uri),i)}if(n.bufferView==null)throw new W("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(n.mimeType==null)throw new W("gltf-loader-unsupported-feature","Image mimeType must be defined.");const s=this.json.bufferViews[n.bufferView],o=await this.getBuffer(s.buffer,i);if(s.byteStride!=null)throw new W("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const a=o.byteOffset+(s.byteOffset||0);return wst(new Uint8Array(o.buffer,a,s.byteLength),n.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const e=await $J(Array.from(this._bufferLoaders.values())),i=await $J(Array.from(this._textureLoaders.values()));return e.reduce((r,n)=>r+(n?.byteLength??0),0)+i.reduce((r,n)=>r+(n?E3(n)?n.data.byteLength:n.width*n.height*4:0),0)}};const dot=lpe(be(),Math.PI/2),pot=new Pb(2,0,"glTF"),d$=Sh(),fot={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},mot={[Ze.BYTE]:1,[Ze.UNSIGNED_BYTE]:1,[Ze.SHORT]:2,[Ze.UNSIGNED_SHORT]:2,[Ze.FLOAT]:4,[Ze.INT]:4,[Ze.UNSIGNED_INT]:4};function got(t){switch(t.componentType){case Ze.BYTE:return new FF(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Ze.UNSIGNED_BYTE:return new $F(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Ze.SHORT:return new RR(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Ze.UNSIGNED_SHORT:return new $Y(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Ze.UNSIGNED_INT:return new IY(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Ze.FLOAT:return new dw(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount)}}const yot=/\.gltf$/i,_ot=/\.glb$/i;let vot=0;async function QTe(t,e,i={},r=!0){const n=await hot.load(t,e,i),s="gltf_"+vot++,o={lods:[],materials:new Map,textures:new Map,meta:bot(n)},a=!(!n.json.asset.extras||n.json.asset.extras.ESRI_type!=="symbolResource"),l=new Map;await wot(n,async(u,d,p,m)=>{const y=l.get(p)??0;l.set(p,y+1);const _=u.mode!==void 0?u.mode:Qt.TRIANGLES,v=_===Qt.TRIANGLES||_===Qt.TRIANGLE_STRIP||_===Qt.TRIANGLE_FAN?_:null;if(v==null)return void ne.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+Qt[_]+"). Skipping primitive.");if(!n.hasPositions(u))return void ne.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const w=n.getPositionData(u,i),x=n.getMaterial(u,i,r),T=n.hasNormals(u)?n.getNormalData(u,i):null,S=n.hasTangents(u)?n.getTangentData(u,i):null,E=n.hasTextureCoordinates(u)?n.getTextureCoordinates(u,i):null,A=n.hasVertexColors(u)?n.getVertexColors(u,i):null,P=n.getIndexData(u,i),N={name:m,transform:JT(d),attributes:{position:await w,normal:T?await T:null,texCoord0:E?await E:null,color:A?await A:null,tangent:S?await S:null},indices:await P,primitiveType:v,material:Tot(o,await x,s)};let F=null;o.meta?.ESRI_lod!=null&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(F=o.meta.ESRI_lod.thresholds[p]),o.lods[p]=o.lods[p]||{parts:[],name:m,lodThreshold:F},o.lods[p].parts[y]=N});for(const u of o.lods)u.parts=u.parts.filter(d=>!!d);const c=await n.getLoadedBuffersSize();return{model:o,meta:{isEsriSymbolResource:a,uri:n.uri},customMeta:{},size:c}}function bot(t){const e=t.json;let i=null;return e.nodes.forEach(r=>{const n=r.extras;n!=null&&(n.ESRI_proxyEllipsoid||n.ESRI_lod)&&(i=n)}),i}async function wot(t,e){const i=t.json,r=i.scenes[i.scene||0].nodes,n=r.length>1,s=[];for(const a of r){const l=i.nodes[a];s.push(o(a,0)),xot(l)&&!n&&l.extensions.MSFT_lod.ids.forEach((c,u)=>o(c,u+1))}async function o(a,l){const c=i.nodes[a],u=t.getNodeTransform(a);if(c.weights!=null&&ne.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),c.mesh!=null){const d=i.meshes[c.mesh];for(const p of d.primitives)s.push(e(p,u,l,d.name))}for(const d of c.children||[])s.push(o(d,l))}await Promise.all(s)}function xot(t){return t.extensions?.MSFT_lod&&Array.isArray(t.extensions.MSFT_lod.ids)}function Tot(t,e,i){const r=s=>{const o=`${i}_tex_${s&&s.id}${s?.name?"_"+s.name:""}`;if(s&&!t.textures.has(o)){const a=not(s.data,{wrap:{s:s.wrapS,t:s.wrapT},mipmap:Sot.has(s.minFilter),noUnpackFlip:!0});t.textures.set(o,a)}return o},n=`${i}_mat_${e.id}_${e.name}`;if(!t.materials.has(n)){const s=rot({color:[e.color[0],e.color[1],e.color[2]],opacity:e.color[3],alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,colorMixMode:e.ESRI_externalColorMixMode,textureColor:e.colorTexture?r(e.colorTexture):void 0,textureNormal:e.normalTexture?r(e.normalTexture):void 0,textureOcclusion:e.occlusionTexture?r(e.occlusionTexture):void 0,textureEmissive:e.emissiveTexture?r(e.emissiveTexture):void 0,textureMetallicRoughness:e.metallicRoughnessTexture?r(e.metallicRoughnessTexture):void 0,emissiveFactor:[e.emissiveFactor[0],e.emissiveFactor[1],e.emissiveFactor[2]],colorTextureTransform:e.colorTextureTransform,normalTextureTransform:e.normalTextureTransform,occlusionTextureTransform:e.occlusionTextureTransform,emissiveTextureTransform:e.emissiveTextureTransform,metallicRoughnessTextureTransform:e.metallicRoughnessTextureTransform,metallicFactor:e.metallicFactor,roughnessFactor:e.roughnessFactor});t.materials.set(n,s)}return n}const Sot=new Set([Lt.LINEAR_MIPMAP_LINEAR,Lt.LINEAR_MIPMAP_NEAREST]);function Eot(t,e){switch(e){case Qt.TRIANGLES:return Cot(t);case Qt.TRIANGLE_STRIP:return Aot(t);case Qt.TRIANGLE_FAN:return Oot(t)}}function Cot(t){return typeof t=="number"?pw(t):Cy(t)?new Uint16Array(t):t}function Aot(t){const e=typeof t=="number"?t:t.length;if(e<3)return[];const i=e-2,r=IN(3*i);if(typeof t=="number"){let n=0;for(let s=0;s<i;s+=1)s%2==0?(r[n++]=s,r[n++]=s+1,r[n++]=s+2):(r[n++]=s+1,r[n++]=s,r[n++]=s+2)}else{let n=0;for(let s=0;s<i;s+=1)s%2==0?(r[n++]=t[s],r[n++]=t[s+1],r[n++]=t[s+2]):(r[n++]=t[s+1],r[n++]=t[s],r[n++]=t[s+2])}return r}function Oot(t){const e=typeof t=="number"?t:t.length;if(e<3)return new Uint16Array(0);const i=e-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if(typeof t=="number"){let a=0;for(let l=0;l<i;++l)r[a++]=0,r[a++]=l+1,r[a++]=l+2;return r}const n=t[0];let s=t[1],o=0;for(let a=0;a<i;++a){const l=t[a+2];r[o++]=n,r[o++]=s,r[o++]=l,s=l}return r}let Rot=class{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}},Pot=class{constructor(e,i,r){this.name=e,this.lodThreshold=i,this.pivotOffset=r,this.stageResources=new Rot,this.numberOfVertices=0}};const Lm=ne.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function eSe(t,e){const i=await Mot(t,e),r=await Not(i.textureDefinitions??{},e);let n=0;for(const s in r)if(r.hasOwnProperty(s)){const o=r[s];n+=o?.image?o.image.width*o.image.height*4:0}return{resource:i,textures:r,size:n+Lue(i)}}async function Mot(t,e){const i=e?.streamDataRequester;if(i)return $ot(t,i,e);const r=await hh(Ii(t,e));if(r.ok===!0)return r.value.data;T_(r.error),tSe(r.error)}async function $ot(t,e,i){const r=await hh(e.request(t,"json",i));if(r.ok===!0)return r.value;T_(r.error),tSe(r.error.details.url)}function tSe(t){throw new W("",`Request for object resource failed: ${t}`)}function Iot(t){const e=t.params,i=e.topology;let r=!0;switch(e.vertexAttributes||(Lm.warn("Geometry must specify vertex attributes"),r=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const s=e.faces;if(s){if(e.vertexAttributes)for(const o in e.vertexAttributes){const a=s[o];a?.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(Lm.warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),r=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(Lm.warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),r=!1)):(Lm.warn(`Indexed geometry does not specify face indices for '${o}' attribute`),r=!1)}}else Lm.warn("Indexed geometries must specify faces"),r=!1;break}default:Lm.warn(`Unsupported topology '${i}'`),r=!1}t.params.material||(Lm.warn("Geometry requires material"),r=!1);const n=t.params.vertexAttributes;for(const s in n)n[s].values||(Lm.warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function Lot(t,e){const i=new Array,r=new Array,n=new Array,s=new XS,o=t.resource,a=Pb.parse(o.version||"1.0","wosr");kot.validate(a);const l=o.model.name,c=o.model.geometries,u=o.materialDefinitions??{},d=t.textures;let p=0;const m=new Map;for(let y=0;y<c.length;y++){const _=c[y];if(!Iot(_))continue;const v=Fot(_),w=_.params.vertexAttributes,x=[],T=k=>{if(_.params.topology==="PerAttributeArray")return null;const B=_.params.faces;for(const j in B)if(j===k)return B[j].values;return null},S=w[O.POSITION],E=S.values.length/S.valuesPerElement;for(const k in w){const B=w[k],j=B.values,X=T(k)??pw(E);x.push([k,new ke(j,X,B.valuesPerElement,!0)])}const A=v.texture,P=d&&d[A];if(P&&!m.has(A)){const{image:k,parameters:B}=P,j=new yw(k,B);r.push(j),m.set(A,j)}const N=m.get(A),F=N?N.id:void 0,D=v.material;let $=s.get(D,A);if($==null){const k=u[D.substring(D.lastIndexOf("/")+1)].params;k.transparency===1&&(k.transparency=0);const B=P&&P.alphaChannelUsage,j=k.transparency>0||B==="transparency"||B==="maskAndTransparency",X=P?iSe(P.alphaChannelUsage):void 0,M={ambient:Xo(k.diffuse),diffuse:Xo(k.diffuse),opacity:1-(k.transparency||0),transparent:j,textureAlphaMode:X,textureAlphaCutoff:.33,textureId:F,initTextureTransparent:!0,doubleSided:!0,cullFace:dr.None,colorMixMode:k.externalColorMixMode||"tint",textureAlphaPremultiplied:P?.parameters.preMultiplyAlpha??!1};e?.materialParameters&&Object.assign(M,e.materialParameters),$=new Jd(M),s.set(D,A,$)}n.push($);const R=new Wn($,x);p+=x.find(k=>k[0]===O.POSITION)?.[1]?.indices.length??0,i.push(R)}return{engineResources:[{name:l,stageResources:{textures:r,materials:n,geometries:i},pivotOffset:o.model.pivotOffset,numberOfVertices:p,lodThreshold:null}],referenceBoundingBox:Dot(i)}}function Dot(t){const e=vr();return t.forEach(i=>{const r=i.boundingInfo;r!=null&&(Yd(e,r.bbMin),Yd(e,r.bbMax))}),e}async function Not(t,e){const i=new Array;for(const s in t){const o=t[s],a=o.images[0].data;if(!a){Lm.warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+s,u=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",d={noUnpackFlip:!0,wrap:{s:Nt.REPEAT,t:Nt.REPEAT},preMultiplyAlpha:iSe(u)!==Wi.Opaque},p=e!=null&&e.disableTextures?Promise.resolve(null):$g(l,e);i.push(p.then(m=>({refId:c,image:m,parameters:d,alphaChannelUsage:u})))}const r=await Promise.all(i),n={};for(const s of r)n[s.refId]=s;return n}function iSe(t){switch(t){case"mask":return Wi.Mask;case"maskAndTransparency":return Wi.MaskBlend;case"none":return Wi.Opaque;default:return Wi.Blend}}function Fot(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const kot=new Pb(1,2,"wosr"),px=2.1;async function rSe(t,e){const i=nSe(bj(t));if(i.fileType==="wosr"){const d=await(e.cache?e.cache.loadWOSR(i.url,e):eSe(i.url,e)),{engineResources:p,referenceBoundingBox:m}=Lot(d,e);return{lods:p,referenceBoundingBox:m,isEsriSymbolResource:!1,isWosr:!0}}const r=await(e.cache?e.cache.loadGLTF(i.url,e,!!e.usePBR):QTe(new JTe(e.streamDataRequester),i.url,e,e.usePBR)),n=r.model.meta?.ESRI_proxyEllipsoid,s=r.meta.isEsriSymbolResource&&n!=null&&r.meta.uri.includes("/RealisticTrees/");s&&!r.customMeta.esriTreeRendering&&(r.customMeta.esriTreeRendering=!0,Vot(r,n));const o=!!e.usePBR,a=r.meta.isEsriSymbolResource?{usePBR:o,isSchematic:!1,treeRendering:s,mrrFactors:[...sKe]}:{usePBR:o,isSchematic:!1,treeRendering:!1,mrrFactors:[...ik]},l={...e.materialParameters,treeRendering:s},{engineResources:c,referenceBoundingBox:u}=sSe(r,a,l,e.skipHighLods&&i.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:i.specifiedLodIndex});return{lods:c,referenceBoundingBox:u,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1}}function nSe(t){const e=t.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return e?{fileType:"gltf",url:e[1],specifiedLodIndex:e[4]!=null?Number(e[4]):null}:t.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:t,specifiedLodIndex:null}:{fileType:"unknown",url:t,specifiedLodIndex:null}}function sSe(t,e,i,r){const n=t.model,s=new Array,o=new Map,a=new Map,l=n.lods.length,c=vr();return n.lods.forEach((u,d)=>{const p=r.skipHighLods===!0&&(l>1&&d===0||l>3&&d===1)||r.skipHighLods===!1&&r.singleLodIndex!=null&&d!==r.singleLodIndex;if(p&&d!==0)return;const m=new Pot(u.name,u.lodThreshold,[0,0,0]);u.parts.forEach(y=>{const _=p?new Jd({}):Uot(n,y,m,e,i,o,a),{geometry:v,vertexCount:w}=zot(y,_??new Jd({})),x=v.boundingInfo;x!=null&&d===0&&(Yd(c,x.bbMin),Yd(c,x.bbMax)),_!=null&&(m.stageResources.geometries.push(v),m.numberOfVertices+=w)}),p||s.push(m)}),{engineResources:s,referenceBoundingBox:c}}function Uot(t,e,i,r,n,s,o){const a=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),l=t.materials.get(e.material),c=e.attributes.texCoord0!=null,u=e.attributes.normal!=null;if(l==null)return null;const d=Bot(l.alphaMode);if(!s.has(a)){if(c){const E=(A,P=!1)=>{if(A!=null&&!o.has(A)){const N=t.textures.get(A);if(N!=null){const F=N.data;o.set(A,new yw(E3(F)?F.data:F,{...N.parameters,preMultiplyAlpha:!E3(F)&&P,encoding:E3(F)&&F.encoding!=null?F.encoding:void 0}))}}};E(l.textureColor,d!==Wi.Opaque),E(l.textureNormal),E(l.textureOcclusion),E(l.textureEmissive),E(l.textureMetallicRoughness)}const m=l.color[0]**(1/px),y=l.color[1]**(1/px),_=l.color[2]**(1/px),v=l.emissiveFactor[0]**(1/px),w=l.emissiveFactor[1]**(1/px),x=l.emissiveFactor[2]**(1/px),T=l.textureColor!=null&&c?o.get(l.textureColor):null,S=nxe({normalTexture:l.textureNormal,metallicRoughnessTexture:l.textureMetallicRoughness,metallicFactor:l.metallicFactor,roughnessFactor:l.roughnessFactor,emissiveTexture:l.textureEmissive,emissiveFactor:l.emissiveFactor,occlusionTexture:l.textureOcclusion});s.set(a,new Jd({...r,transparent:d===Wi.Blend,customDepthTest:Fb.Lequal,textureAlphaMode:d,textureAlphaCutoff:l.alphaCutoff,diffuse:[m,y,_],ambient:[m,y,_],opacity:l.opacity,doubleSided:l.doubleSided,doubleSidedType:"winding-order",cullFace:l.doubleSided?dr.None:dr.Back,hasVertexColors:!!e.attributes.color,hasVertexTangents:!!e.attributes.tangent,normalType:u?Ei.Attribute:Ei.ScreenDerivative,castShadows:!0,textureId:T?.id,colorMixMode:l.colorMixMode,normalTextureId:l.textureNormal!=null&&c?o.get(l.textureNormal).id:void 0,textureAlphaPremultiplied:T!=null&&!!T.parameters.preMultiplyAlpha,occlusionTextureId:l.textureOcclusion!=null&&c?o.get(l.textureOcclusion).id:void 0,emissiveTextureId:l.textureEmissive!=null&&c?o.get(l.textureEmissive).id:void 0,metallicRoughnessTextureId:l.textureMetallicRoughness!=null&&c?o.get(l.textureMetallicRoughness).id:void 0,emissiveFactor:[v,w,x],mrrFactors:S?[...TX]:[l.metallicFactor,l.roughnessFactor,r.mrrFactors[2]],isSchematic:S,colorTextureTransformMatrix:hf(l.colorTextureTransform),normalTextureTransformMatrix:hf(l.normalTextureTransform),occlusionTextureTransformMatrix:hf(l.occlusionTextureTransform),emissiveTextureTransformMatrix:hf(l.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:hf(l.metallicRoughnessTextureTransform),...n}))}const p=s.get(a);if(i.stageResources.materials.push(p),c){const m=y=>{y!=null&&i.stageResources.textures.push(o.get(y))};m(l.textureColor),m(l.textureNormal),m(l.textureOcclusion),m(l.textureEmissive),m(l.textureMetallicRoughness)}return p}function zot(t,e){const i=t.attributes.position.count,r=Eot(t.indices||i,t.primitiveType),n=Jr(3*i),{typedBuffer:s,typedBufferStride:o}=t.attributes.position;Qd(n,s,t.transform,3,o);const a=[[O.POSITION,new ke(n,r,3,!0)]];if(t.attributes.normal!=null){const l=Jr(3*i),{typedBuffer:c,typedBufferStride:u}=t.attributes.normal;Ag(p$,t.transform),ep(l,c,p$,3,u),a.push([O.NORMAL,new ke(l,r,3,!0)])}if(t.attributes.tangent!=null){const l=Jr(4*i),{typedBuffer:c,typedBufferStride:u}=t.attributes.tangent;Ag(p$,t.transform),aZ(l,c,p$,4,u),a.push([O.TANGENT,new ke(l,r,4,!0)])}if(t.attributes.texCoord0!=null){const l=Jr(2*i),{typedBuffer:c,typedBufferStride:u}=t.attributes.texCoord0;lZ(l,c,2,u),a.push([O.UV0,new ke(l,r,2,!0)])}if(t.attributes.color!=null){const l=new Uint8Array(4*i);t.attributes.color.elementCount===4?t.attributes.color instanceof Zd?p5(l,t.attributes.color,255):t.attributes.color instanceof la?cZ(l,t.attributes.color):t.attributes.color instanceof OR&&p5(l,t.attributes.color,1/256):(l.fill(255),t.attributes.color instanceof ws?t5(l,t.attributes.color,255,4):t.attributes.color instanceof IF?WR(l,t.attributes.color.typedBuffer,4,t.attributes.color.typedBufferStride):t.attributes.color instanceof DF&&t5(l,t.attributes.color,1/256,4)),a.push([O.COLOR,new ke(l,r,4,!0)])}return{geometry:new Wn(e,a),vertexCount:i}}const p$=Hr();function Bot(t){switch(t){case"BLEND":return Wi.Blend;case"MASK":return Wi.Mask;case"OPAQUE":case null:case void 0:return Wi.Opaque}}function Vot(t,e){for(let i=0;i<t.model.lods.length;++i){const r=t.model.lods[i];for(const n of r.parts){const s=n.attributes.normal;if(s==null)return;const o=n.attributes.position,a=o.count,l=C(),c=C(),u=C(),d=new Uint8Array(4*a),p=new Float64Array(3*a),m=qn(be(),n.transform);let y=0,_=0;for(let v=0;v<a;v++){o.getVec(v,c),s.getVec(v,l),Fe(c,c,n.transform),he(u,c,e.center),BD(u,u,e.radius);const w=u[2],x=we(u),T=Math.min(.45+.55*x*x,1);BD(u,u,e.radius),m!==null&&Fe(u,u,m),ge(u,u),i+1!==t.model.lods.length&&t.model.lods.length>1&&Ui(u,u,l,w>-1?.2:Math.min(-4*w-3.8,1)),p[y]=u[0],p[y+1]=u[1],p[y+2]=u[2],y+=3,d[_]=255*T,d[_+1]=255*T,d[_+2]=255*T,d[_+3]=255,_+=4}n.attributes.normal=new ws(p),n.attributes.color=new la(d)}}}const l5t=Object.freeze(Object.defineProperty({__proto__:null,fetch:rSe,gltfToEngineResources:sSe,parseUrl:nSe},Symbol.toStringTag,{value:"Module"})),Got=()=>!!ie("enable-feature:force-wosr"),c5t=()=>!!ie("enable-feature:direct-3d-object-feature-layer-display"),jot=()=>ie.add("enable-feature:direct-3d-object-feature-layer-display",!0,!0,!0),Hot=()=>ie.add("enable-feature:direct-3d-object-feature-layer-display",!1,!0,!0),u5t=()=>!!ie("enable-i3s-patching"),qot=()=>ie.add("enable-i3s-patching",!0,!0,!0),Wot=()=>ie.add("enable-i3s-patching",!1,!0,!0),h5t=()=>!!ie("enable-feature:SceneLayer-editing"),Yot=(t="i3s-patching")=>{switch(Wot(),Hot(),ie.add("enable-feature:SceneLayer-editing",!0,!0,!0),t){case"feature-layer-view":jot();break;case"i3s-patching":qot()}};Yot("i3s-patching");let O8={};async function Xot(t,e){try{return{data:(await uZ(t,e)).data,baseUrl:zH(t),styleUrl:t}}catch(i){return T_(i),null}}function Zot(t,e,i){const r=e.portal!=null?e.portal:ia.getDefault();let n;const s=`${r.url} - ${r.user&&r.user.username} - ${t}`;return O8[s]||(O8[s]=Jot(t,r,i).then(o=>(n=o,o.fetchData())).then(o=>({data:o,baseUrl:n.itemUrl??"",styleName:t}))),O8[s]}function Jot(t,e,i){return e.load(i).then(()=>{const r=new of({disableExtraQuery:!0,query:`owner:${ose} AND type:${ase} AND typekeywords:"${t}"`});return e.queryItems(r,i)}).then(({results:r})=>{let n=null;const s=t.toLowerCase();if(r&&Array.isArray(r)){for(const o of r)if(o.typeKeywords?.some(l=>l.toLowerCase()===s)&&o.type===ase&&o.owner===ose){n=o;break}}if(!n)throw new W("symbolstyleutils:style-not-found",`The style '${t}' could not be found`,{styleName:t});return n.load(i)})}function oSe(t,e,i){return t?.styleUrl!=null?Xot(t.styleUrl,i):t?.styleName!=null?Zot(t.styleName,e,i):Promise.reject(new W("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function aSe(t){return t===null||t.type==="CIMSymbolReference"?t:{type:"CIMSymbolReference",symbol:t}}function lSe(t,e,i=["gltf"]){if(e==="cimRef")return t.cimRef;if(t.formatInfos&&!Got())for(const r of i){const n=t.formatInfos.find(s=>s.type===r);if(n)return n.href}return t.webRef}function uZ(t,e){const i={responseType:"json",query:{f:"json"},...e};return Ii(Dd(t),i)}const ose="esri_en",ase="Style",Kot="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json",WE={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function Qot(t,e=WE){if(!t)return{symbol:null};const{retainId:i=WE.retainId,ignoreDrivers:r=WE.ignoreDrivers,hasLabelingContext:n=WE.hasLabelingContext,retainCIM:s=WE.retainCIM}=e;let o=null;if(Ib(t)||t instanceof US)o=t.clone();else if(t.type==="cim"){const a=t.data?.symbol?.type;if(a!=="CIMPointSymbol")return{error:new W("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${a||"unknown"}' is unsupported in 3D`,{symbol:t})};o=s?t.clone():Fy.fromCIMSymbol(t)}else if(t instanceof rw)o=Q4.fromSimpleLineSymbol(t);else if(t instanceof rF)o=Fy.fromSimpleMarkerSymbol(t);else if(t instanceof tF)o=Fy.fromPictureMarkerSymbol(t);else if(t instanceof vW)o=e.geometryType&&e.geometryType==="mesh"?eF.fromSimpleFillSymbol(t):iF.fromSimpleFillSymbol(t);else{if(!(t instanceof bR))return{error:new W("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${t.type||t.declaredClass}' is unsupported in 3D`,{symbol:t})};o=n?K4.fromTextSymbol(t):Fy.fromTextSymbol(t)}return i&&o&&o.type!=="cim"&&(o.id=t.id),r&&Ib(o)&&o.symbolLayers.forEach(a=>a.ignoreDrivers=!0),{symbol:o}}function d5t(t,e,i,r){const n=cSe(t,{},{context:r,isLabelSymbol:!1});n!=null&&(e[i]=n)}function p5t(t,e,i,r){const n=cSe(t,{},{context:r,isLabelSymbol:!0});n!=null&&(e[i]=n)}function lse(t){return t instanceof kS||t instanceof US}function cSe(t,e,i){if(t==null)return null;const{context:r,isLabelSymbol:n}=i,s=r?.origin,o=r?.messages;if(s==="web-scene"&&!lse(t)){const a=Qot(t,{retainCIM:!0,hasLabelingContext:n});return a.symbol!=null?a.symbol.write(e,r):(o?.push(new W("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:t,context:r,error:a.error})),null)}return(s==="web-map"||s==="portal-item"&&!Z$e(r?.layer))&&lse(t)?(o?.push(new W("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:t,context:r})),null):t.write(e,r)}function uSe(t,e){return N6e(t,null,e)}function eat(t,e,i,r){const n=t.name;return n==null?Promise.reject(new W("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):t.styleName&&t.styleName==="Esri2DPointSymbolsStyle"?tat(n,e,r):oSe(t,e,r).then(s=>dZ(s,n,e,i,lSe,r))}function hZ(t,e){return e.items.find(i=>i.name===t)}function dZ(t,e,i,r,n,s){const o=i?.portal!=null?i.portal:ia.getDefault(),a={portal:o,url:bn(t.baseUrl),origin:"portal-item"},l=hZ(e,t.data);if(!l){const m=`The symbol name '${e}' could not be found`;return Promise.reject(new W("symbolstyleutils:symbol-name-not-found",m,{symbolName:e}))}let c=Ab(n(l,r),a),u=l.thumbnail?.href??null;const d=l.thumbnail?.imageData;jst()&&(c=bj(c)??"",u=bj(u));const p={portal:o,url:bn(zH(c)),origin:"portal-item"};return uZ(c,s).then(m=>{const y=r==="cimRef"?aSe(m.data):m.data,_=uSe(y,p);if(_&&Ib(_)){if(u){const v=Ab(u,a);_.thumbnail=new eb({url:v})}else d&&(_.thumbnail=new eb({url:`data:image/png;base64,${d}`}));t.styleUrl?_.styleOrigin=new sO({portal:i.portal,styleUrl:t.styleUrl,name:e}):t.styleName&&(_.styleOrigin=new sO({portal:i.portal,styleName:t.styleName,name:e}))}return _})}function tat(t,e,i){const r=Kot.replaceAll(/\{SymbolName\}/gi,t),n=e.portal!=null?e.portal:ia.getDefault();return uZ(r,i).then(s=>{const o=aSe(s.data);return uSe(o,{portal:n,url:bn(zH(r)),origin:"portal-item"})})}const iat=Object.freeze(Object.defineProperty({__proto__:null,fetchSymbolFromStyle:dZ,getStyleItemFromStyle:hZ,resolveWebStyleSymbol:eat},Symbol.toStringTag,{value:"Module"}));async function rat(t){if(t===null||t.styleName==null&&t.styleUrl==null)return null;const e=t.name;if(e==null)throw new W("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference");const i={portal:t.portal},r=await oSe(t,i).catch(()=>null);if(r===null)return null;const n=hZ(e,r.data);if(n&&!n.formatInfos?.some(a=>a.type==="gltf_basisu"))return null;const s=await dZ(r,e,i,"webRef",(a,l)=>lSe(a,l,["gltf_basisu","gltf"])).catch(()=>null);if(s===null||s.type!=="point-3d")return null;const o=s.symbolLayers.items[0];return o.type==="object"?o.resource:null}let nat=class{constructor(e,i,r){this._elementSize=i,this._buffer=Ri.createVertex(e,vi.STATIC_DRAW),this.resize(r)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get usedMemory(){return this._array.byteLength+this._buffer.byteLength}copyRange(e,i,r,n=0){const s=new Uint8Array(this.array,e*this.elementSize,(i-e)*this.elementSize);new Uint8Array(r.array,n*this.elementSize).set(s)}transferAll(){this._buffer.setData(this._array)}transferRange(e,i){const r=e*this._elementSize,n=i*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),r,r,n)}resize(e){const i=e*this._elementSize,r=new ArrayBuffer(i);this._array&&(e>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=r,this._buffer.setSize(i),this._capacity=e}},sat=class{constructor(e){this.modelOriginHi=e.getField(O.INSTANCEMODELORIGINHI,ws),this.modelOriginLo=e.getField(O.INSTANCEMODELORIGINLO,ws),this.model=e.getField(O.INSTANCEMODEL,h_),this.modelNormal=e.getField(O.INSTANCEMODELNORMAL,h_),this.featureAttribute=e.getField(O.INSTANCEFEATUREATTRIBUTE,Zd),this.color=e.getField(O.INSTANCECOLOR,la),this.objectAndLayerIdColor=e.getField(O.INSTANCEOBJECTANDLAYERIDCOLOR,la)}},cse=class{constructor(e,i){this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=e,this._instanceBufferLayout=i,this._elementSize=i.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,i=this._tailIndex;return e>=i?e-i:e+this._capacity-i}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get usedMemory(){return this._buffer?.usedMemory??0}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){Ke(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){Ke(this._updating,"not updating"),this.size<gOe*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){Ke(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),Ke(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){Ke(this._updating,"not updating"),Ke(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(f5,Math.floor(this._capacity*o4));this._resize(e)}_shrink(){const e=Math.max(f5,Math.floor(this._capacity*mOe));this._resize(e)}_resize(e){if(Ke(this._updating,"not updating"),e===this._capacity)return;const i=new nat(this._rctx,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const r=this.size,n=this._compactInstances(i);Ke(n===r,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=n,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=i,this._view=new sat(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const i=this._headIndex,r=this._tailIndex;return r<i?(this._buffer.copyRange(r,i,e),i-r):r>i?(this._buffer.copyRange(r,this._capacity,e),i>0&&this._buffer.copyRange(0,i,e,this._capacity-r),i+(this._capacity-r)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,i){e<i?this._buffer.transferRange(e,i):e>i&&(i>0&&this._buffer.transferRange(0,i),this._buffer.transferRange(e,this._capacity))}};const f5=64;var Rr;function oat(t){let e=Ir().mat4f64(O.LOCALTRANSFORM).mat4f64(O.GLOBALTRANSFORM).vec4f64(O.BOUNDINGSPHERE).vec3f64(O.MODELORIGIN).mat3f(O.INSTANCEMODEL).mat3f(O.INSTANCEMODELNORMAL).vec2f(O.MODELSCALEFACTORS);return t.includes(O.FEATUREATTRIBUTE)&&(e=e.vec4f(O.FEATUREATTRIBUTE)),t.includes(O.COLOR)&&(e=e.vec4u8(O.COLOR)),t.includes(O.OBJECTANDLAYERIDCOLOR)&&(e=e.vec4u8(O.OBJECTANDLAYERIDCOLOR)),e=e.u8(O.STATE).u8(O.LODLEVEL),e}(function(t){t[t.ALLOCATED=1]="ALLOCATED",t[t.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",t[t.VISIBLE=4]="VISIBLE",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",t[t.REMOVE=32]="REMOVE",t[t.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",t[t.ACTIVE=18]="ACTIVE"})(Rr||(Rr={}));let use=class{constructor(e){this.localTransform=e.getField(O.LOCALTRANSFORM,yO),this.globalTransform=e.getField(O.GLOBALTRANSFORM,yO),this.modelOrigin=e.getField(O.MODELORIGIN,wh),this.model=e.getField(O.INSTANCEMODEL,h_),this.modelNormal=e.getField(O.INSTANCEMODELNORMAL,h_),this.modelScaleFactors=e.getField(O.MODELSCALEFACTORS,dw),this.boundingSphere=e.getField(O.BOUNDINGSPHERE,MF),this.featureAttribute=e.getField(O.FEATUREATTRIBUTE,Zd),this.color=e.getField(O.COLOR,la),this.objectAndLayerIdColor=e.getField(O.OBJECTANDLAYERIDCOLOR,la),this.state=e.getField(O.STATE,lS),this.lodLevel=e.getField(O.LODLEVEL,lS)}},_2=class extends xe{constructor(e,i){super(e),this.events=new Tn,this._capacity=0,this._size=0,this._next=0,this._layout=oat(i),this._capacity=f5,this._buffer=this._layout.createBuffer(this._capacity),this._view=new use(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,Rr.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const i=this._view.state;Ke(e>=0&&e<this._capacity&&(i.get(e)&Rr.ALLOCATED)!=0,"invalid instance handle"),this._getStateFlag(e,Rr.ACTIVE)?this._setStateFlags(e,Rr.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const i=this._view.state;Ke(e>=0&&e<this._capacity&&(i.get(e)&Rr.ALLOCATED)!=0,"invalid instance handle"),i.set(e,0),this._size--}setLocalTransform(e,i,r=!0){this._view.localTransform.setMat(e,i),r&&this.updateModelTransform(e)}getLocalTransform(e,i){this._view.localTransform.getMat(e,i)}setGlobalTransform(e,i,r=!0){this._view.globalTransform.setMat(e,i),r&&this.updateModelTransform(e)}getGlobalTransform(e,i){this._view.globalTransform.getMat(e,i)}updateModelTransform(e){const i=this._view,r=Al,n=zh;i.localTransform.getMat(e,hse),i.globalTransform.getMat(e,R8);const s=Di(R8,R8,hse);oe(r,s[12],s[13],s[14]),i.modelOrigin.setVec(e,r),gh(n,s),i.model.setMat(e,n);const o=zUe(Al,s);o.sort(),i.modelScaleFactors.set(e,0,o[1]),i.modelScaleFactors.set(e,1,o[2]),uw(n,n),yh(n,n),i.modelNormal.setMat(e,n),this._setStateFlags(e,Rr.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,i){const r=this._view;r.model.getMat(e,zh),r.modelOrigin.getVec(e,Al),i[0]=zh[0],i[1]=zh[1],i[2]=zh[2],i[3]=0,i[4]=zh[3],i[5]=zh[4],i[6]=zh[5],i[7]=0,i[8]=zh[6],i[9]=zh[7],i[10]=zh[8],i[11]=0,i[12]=Al[0],i[13]=Al[1],i[14]=Al[2],i[15]=1}applyShaderTransformation(e,i){this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i)}getCombinedModelTransform(e,i){return this.getModelTransform(e,i),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i),i}getCombinedLocalTransform(e,i){this._view.localTransform.getMat(e,i),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i)}getCombinedMaxScaleFactor(e){let i=this._view.modelScaleFactors.get(e,1);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(Al,this,e),i*=Math.max(Al[0],Al[1],Al[2])),i}getCombinedMedianScaleFactor(e){let i=this._view.modelScaleFactors.get(e,0);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(Al,this,e),i*=aat(Al[0],Al[1],Al[2])),i}getModel(e,i){this._view.model.getMat(e,i)}setFeatureAttribute(e,i){this._view.featureAttribute.setVec(e,i)}getFeatureAttribute(e,i){this._view.featureAttribute.getVec(e,i)}setColor(e,i){this._view.color.setVec(e,i)}setObjectAndLayerIdColor(e,i){this._view.objectAndLayerIdColor.setVec(e,i)}setVisible(e,i){i!==this.getVisible(e)&&(this._setStateFlag(e,Rr.VISIBLE,i),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,Rr.VISIBLE)}setHighlight(e,i){i!==this.getHighlight(e)&&(this._setStateFlag(e,Rr.HIGHLIGHT,i),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,Rr.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let i=0;for(let r=0;r<this._capacity;++r)this.getState(r)&e&&++i;return i}_setStateFlags(e,i){const r=this._view.state;i=r.get(e)|i,r.set(e,i)}_clearStateFlags(e,i){const r=this._view.state;i=r.get(e)&~i,r.set(e,i)}_setStateFlag(e,i,r){r?this._setStateFlags(e,i):this._clearStateFlags(e,i)}_getStateFlag(e,i){return!!(this._view.state.get(e)&i)}_grow(){this._capacity=Math.max(f5,Math.floor(this._capacity*o4)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new use(this._buffer)}_findSlot(){const e=this._view.state;let i=this._next;for(;e.get(i)&Rr.ALLOCATED;)i=i+1===this._capacity?0:i+1;return this._next=i+1===this._capacity?0:i+1,i}};function aat(t,e,i){return Math.max(Math.min(t,e),Math.min(Math.max(t,e),i))}h([f({constructOnly:!0})],_2.prototype,"shaderTransformation",void 0),h([f()],_2.prototype,"_size",void 0),h([f({readOnly:!0})],_2.prototype,"size",null),_2=h([z("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],_2);const Al=C(),zh=Hr(),hse=be(),R8=be();let lat=class extends $d{constructor(e,i){super(r=>this._instanceData.view.boundingSphere.getVec(r,this._tmpSphere),{maximumDepth:25}),this._instanceData=e,this._boundingSphere=i,this._tmpSphere=xn(),this._tmpMat4=be()}addInstance(e){const i=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);Fe(this._tmpSphere,this._boundingSphere.center,r),this._tmpSphere[3]=this._boundingSphere.radius*QT(r),i.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}},cat=class{constructor(e,i){this._worldSpaceRadius=e,this._minScreenSpaceRadii=i}selectLevel(e,i,r){const n=r.computeScreenPixelSizeAt(e),s=this._worldSpaceRadius*i/n;let o=0;for(let a=1;a<this._minScreenSpaceRadii.length;++a)s>=this._minScreenSpaceRadii[a]&&(o=a);return o}},uat=class extends yF{constructor(e,i,r,n,s,o){super(e,i),this.layerUid=e,this.graphicUid=i,this.geometryId=r,this.triangleNr=n,this.baseBoundingSphere=s,this.numLodLevels=o}};function pZ(t){return ip(t)&&t.intersector===Ur.LOD&&!!t.target}let hat=class{constructor(e,i){const r=e.renderContext.rctx,n=i.geometry;this._materialRepository=e.materialRepository,n.material.setParameters({instancedDoublePrecision:!0});const s=n.material.createBufferWriter(),o=s.vertexBufferLayout,a=s.elementCount(n),l=o.createBuffer(a);s.write(null,null,n,l,0),this.geometry=n,this.material=n.material,this.glMaterials=new X2e(n.material,this._materialRepository),this.vertexBufferLayout=o,this.vbo=Ri.createVertex(r,vi.STATIC_DRAW,l.buffer),this.vao=new np(r,fi,{geometry:pc(o)},{geometry:this.vbo}),this.vertexCount=a}destroy(){this.glMaterials.dispose(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,i,r,n,s,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,r,n,(u,d,p,m,y)=>{if(u>=0){if(i!=null&&!i(e.rayBegin,e.rayEnd,u))return;const _=new uat(o.layerUid,o.graphicUid(s),c,p,a,l);if((e.results.min.drapedLayerOrder==null||y>=e.results.min.drapedLayerOrder)&&(e.results.min.dist==null||u<e.results.min.dist)&&e.results.min.set(Ur.LOD,_,u,d,e.transform.transform,y),e.options.store!==ho.MIN&&(e.results.max.drapedLayerOrder==null||y>=e.results.max.drapedLayerOrder)&&(e.results.max.dist==null||u>e.results.max.dist)&&e.results.max.set(Ur.LOD,_,u,d,e.transform.transform,y),e.options.store===ho.ALL){const v=KW(e.results.min.ray);v.set(Ur.LOD,_,u,d,e.transform.transform,y),e.results.all.push(v)}}})}},dat=class hSe{static async create(e,i,r){const n=await Promise.allSettled(i.components.map(o=>e.controller.schedule(()=>new hat(e,o),r))),s=n.map(o=>o.status==="fulfilled"?o.value:null).filter(ZO);if(Hn(r)||s.length!==n.length){s.forEach(o=>o.destroy()),Et(r);for(const o of n)if(o.status==="rejected")throw o.reason}return new hSe(i.minScreenSpaceRadius,s)}constructor(e,i){this.minScreenSpaceRadius=e,this.components=i}destroy(){this.components.forEach(e=>e.destroy())}intersect(e,i,r,n,s,o,a){this.components.forEach(l=>l.intersect(e,i,r,n,s,o,this.boundingSphere,a))}get boundingBox(){if(this._boundingBox==null){const e=vr();this.components.forEach(i=>{i.boundingInfo!=null&&(Yd(e,i.boundingInfo.bbMin),Yd(e,i.boundingInfo.bbMax))}),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(this._boundingSphere==null){const e=this.boundingBox,i=C();Rd(e,i),this._boundingSphere={center:i,radius:.5*$ge(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((e,i)=>e+i.triangleCount,0)}};const pat=t=>{const e=t.baseBoundingSphere.radius,i=t.levels.map(r=>r.minScreenSpaceRadius);return new cat(e,i)};let zu=class extends iqe{constructor(e,i){super(e),this.type=Ur.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[new Array],this._highlightRenderInstanceData=[new Array],this._allRenderInstanceData=[this._defaultRenderInstanceData[0],this._highlightRenderInstanceData[0]],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new ht,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.produces=new Map([[ae.OPAQUE_MATERIAL,r=>this._produces(r)],[ae.TRANSPARENT_MATERIAL,r=>!!this._hasTransparentLevels()&&this._produces(r)]]),this._instanceData=new _2({shaderTransformation:e.shaderTransformation},e.optionalFields),this.addHandles(i.registerTask(ut.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=mat(this.optionalFields),this._glInstanceBufferLayout=pc(this._instanceBufferLayout,1),this.addHandles([this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)}),this._instanceData.events.on("instance-visibility-changed",({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)}),this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))])}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get usedMemory(){return this._allRenderInstanceData.reduce((e,i)=>i.reduce((r,n)=>r+n.usedMemory,e),0)}get renderStats(){const e=this._instanceData.size,i=[];return this._levels.forEach((r,n)=>{const s=this._allRenderInstanceData[0][n].size+this._allRenderInstanceData[1][n].size,o=r.triangleCount;i.push({renderedInstances:s,renderedTriangles:s*o,trianglesPerInstance:o})}),{totalInstances:e,renderedInstances:i.reduce((r,n)=>r+n.renderedInstances,0),renderedTriangles:i.reduce((r,n)=>r+n.renderedTriangles,0),levels:i}}async initializeRenderContext(e,i){this._context=e;const r=e.renderContext.rctx,n=await Promise.allSettled(this.symbol.levels.map(o=>(this._defaultRenderInstanceData[0].push(new cse(r,this._instanceBufferLayout)),this._highlightRenderInstanceData[0].push(new cse(r,this._instanceBufferLayout)),dat.create(e,o,i)))),s=n.map(o=>o.status==="fulfilled"?o.value:null).filter(ZO);if(Hn(i)||s.length!==n.length){s.forEach(o=>o.destroy()),Et(i);for(const o of n)if(o.status==="rejected")throw o.reason}this._levels=s,this._levelSelector=pat(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData[0].forEach(e=>e.destroy()),this._highlightRenderInstanceData[0].forEach(e=>e.destroy())}_hasTransparentLevels(){return this._levels.some(e=>e.components.some(i=>i.material.produces(ae.TRANSPARENT_MATERIAL,U.Color)))}hasHighlights(){return this._highlightRenderInstanceData[0].some(e=>e.size>0)}_produces(e){return e!==U.Highlight&&e!==U.ShadowHighlight||this.hasHighlights()}prepareRender(e){if(!nr.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const i=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),i||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(Da),this._needFullCycle=!1)}}prepareTechniques(e){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output))return null;const i=this._getInstanceDatas(e.output);if(!i)return null;const r=new Array;return i.forEach(n=>this.levels.forEach((s,o)=>{s.components.forEach(a=>r.push(this._beginComponent(e,n[o],a)))})),r}renderNode(e,i){const r=this._getInstanceDatas(e.output);if(!r||i==null)return;let n=0;e.rctx.bindVAO(),r.forEach(s=>this.levels.forEach((o,a)=>{o.components.forEach(l=>this._renderComponent(e,i[n++],s[a],l,a))}))}_getInstanceDatas(e){const i=e!==U.Highlight&&e!==U.ShadowHighlight,r=e!==U.ShadowExcludeHighlight;return i&&r?this._allRenderInstanceData:i?this._defaultRenderInstanceData:r?this._highlightRenderInstanceData:null}intersect(e,i,r,n){if(!this.baseMaterial.isVisible()||this._octree==null)return;const s=C();he(s,n,r);const o=a=>{this._instanceData.getCombinedModelTransform(a,fse),e.transform.set(fse),Fe(mse,r,e.transform.inverse),Fe(gse,n,e.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),u=this._levels.length;Ke((l&Rr.ACTIVE)!=0,"invalid instance state"),Ke(c>=0&&c<u,"invaid lod level"),this._levels[c].intersect(e,i,mse,gse,a,this.metadata,u)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(o):this._octree.forEachAlongRay(r,s,o)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){if(this._octreeCached==null){const e=this._instanceData,i=e.view?.state;if(!i)return null;this._octreeCached=new lat(e,this.baseBoundingSphere);for(let r=0;r<e.capacity;++r)i.get(r)&Rr.ACTIVE&&this._octreeCached.addInstance(r)}return this._octreeCached}_invalidateOctree(){this._octreeCached=Pe(this._octreeCached)}queryDepthRange(e){if(this._octree==null)return{near:1/0,far:-1/0};const i=e.viewForward,r=this._octree.findClosest(i,$d.DepthOrder.FRONT_TO_BACK,e.frustum),n=this._octree.findClosest(i,$d.DepthOrder.BACK_TO_FRONT,e.frustum);if(r==null||n==null)return{near:1/0,far:-1/0};const s=e.eye,o=this._instanceData.view;o.boundingSphere.getVec(r,Tp),he(Tp,Tp,s);const a=me(Tp,i)-Tp[3];o.boundingSphere.getVec(n,Tp),he(Tp,Tp,s);const l=me(Tp,i)+Tp[3];return{near:Math.max(e.near,a),far:Math.min(e.far,l)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._allRenderInstanceData.forEach(e=>e.forEach(i=>i.startUpdateCycle()))}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:i,_camera:r,_levelSelector:n}=this;this._allRenderInstanceData.forEach(d=>d.forEach(p=>p.beginUpdate()));const s=this._instanceData,o=s.view;let a=s.size;const l=s.capacity;let c=this._instanceIndex;const u=Math.ceil(l/500);for(let d=0;d<a&&!e.done;++d){c===this._cycleStartIndex&&this._startUpdateCycle();const p=o.state.get(c);let m=0;if(!(p&Rr.ALLOCATED)){c=c+1===l?0:c+1,a++;continue}const y=o.lodLevel.get(c);if(p&Rr.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[0][y].freeTail(),p&Rr.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[0][y].freeTail(),p&Rr.REMOVE)s.freeInstance(c);else if(p&Rr.VISIBLE){let _=0;i&&(o.modelOrigin.getVec(c,pse),_=n.selectLevel(pse,s.getCombinedMedianScaleFactor(c),r)),m=p&~(Rr.ACTIVE|Rr.TRANSFORM_CHANGED),_>=0&&(p&Rr.HIGHLIGHT?(dse(this._highlightRenderInstanceData[0][_],o,c),m|=Rr.HIGHLIGHT_ACTIVE):(dse(this._defaultRenderInstanceData[0][_],o,c),m|=Rr.DEFAULT_ACTIVE)),o.state.set(c,m),o.lodLevel.set(c,_)}else m=p&~(Rr.ACTIVE|Rr.TRANSFORM_CHANGED),o.state.set(c,m);if(this._octreeCached!=null){const _=!!(p&Rr.ACTIVE),v=!!(m&Rr.ACTIVE);!_&&v?this._octreeCached.addInstance(c):_&&!v?this._octreeCached.removeInstance(c):_&&v&&p&Rr.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(c),this._octreeCached.addInstance(c))}c=c+1===l?0:c+1,c%u==0&&e.madeProgress()}this._instanceIndex=c,this._allRenderInstanceData.forEach(d=>d.forEach(p=>p.endUpdate())),this._context.requestRender()}_beginComponent(e,i,r){if(i.size===0)return null;const n=r.glMaterials.load(e.rctx,e.bindParameters.slot,e.output);return n!=null?n.beginSlot(e.bindParameters):null}_renderComponent(e,i,r,n,s){if(!i)return;const{bindParameters:o,rctx:a}=e;a.runAppleAmdDriverHelper();const l=a.bindTechnique(i,n.material.parameters,o);a.bindVAO(n.vao),i.ensureAttributeLocations(n.vao),l.bindDraw(gat,o,n.material.parameters),nr.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===U.Color&&(l.setUniform4fv("externalColor",yse[Math.min(s,yse.length-1)]),l.setUniform1i("colorMixMode",swe.replace));const c=r.capacity,u=r.headIndex,d=r.tailIndex,p=r.firstIndex,m=this._glInstanceBufferLayout,y=(_,v)=>{dY(a,fi,r.buffer,m,_),a.drawArraysInstanced(i.primitiveType,0,n.vertexCount,v-_),pY(a,fi,r.buffer,m)};n.material.parameters.transparent&&p!=null?u>d?(Ke(p>=d&&p<=u,"invalid firstIndex"),y(p,u),y(d,p)):u<d&&(p<=u?(Ke(p>=0&&p<=u,"invalid firstIndex"),y(p,u),y(d,c),y(0,p)):(Ke(p>=d&&p<=c,"invalid firstIndex"),y(p,c),y(0,u),y(d,p))):u>d?y(d,u):u<d&&(y(0,u),y(d,c)),a.bindVAO(null)}};function dse(t,e,i){const r=t.allocateHead();fat(e,i,t.view,r)}function fat(t,e,i,r){dHe(t.modelOrigin,e,i.modelOriginHi,i.modelOriginLo,r),i.model.copyFrom(r,t.model,e),i.modelNormal.copyFrom(r,t.modelNormal,e),t.color&&i.color&&i.color.copyFrom(r,t.color,e),t.objectAndLayerIdColor&&i.objectAndLayerIdColor&&i.objectAndLayerIdColor.copyFrom(r,t.objectAndLayerIdColor,e),t.featureAttribute&&i.featureAttribute&&i.featureAttribute.copyFrom(r,t.featureAttribute,e)}function mat(t){let e=Ir().vec3f(O.INSTANCEMODELORIGINHI).vec3f(O.INSTANCEMODELORIGINLO).mat3f(O.INSTANCEMODEL).mat3f(O.INSTANCEMODELNORMAL);return t!=null&&t.includes("featureAttribute")&&(e=e.vec4f(O.INSTANCEFEATUREATTRIBUTE)),t!=null&&t.includes("color")&&(e=e.vec4u8(O.INSTANCECOLOR)),t!=null&&t.includes("objectAndLayerIdColor")&&(e=e.vec4u8(O.INSTANCEOBJECTANDLAYERIDCOLOR)),e}h([f({constructOnly:!0})],zu.prototype,"symbol",void 0),h([f({constructOnly:!0})],zu.prototype,"optionalFields",void 0),h([f({constructOnly:!0})],zu.prototype,"metadata",void 0),h([f({constructOnly:!0})],zu.prototype,"shaderTransformation",void 0),h([f()],zu.prototype,"_instanceData",void 0),h([f()],zu.prototype,"_cycleStartIndex",void 0),h([f({readOnly:!0})],zu.prototype,"_enableLevelSelection",null),h([f()],zu.prototype,"_updateCyclesWithStaticCamera",void 0),h([f({readOnly:!0})],zu.prototype,"running",null),zu=h([z("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],zu);const pse=C(),Tp=Kt(),fse=be(),mse=C(),gse=C(),yse=[Mt(1,0,1,1),Mt(0,0,1,1),Mt(0,1,0,1),Mt(1,1,0,1),Mt(1,0,0,1)],gat=new UKe;let _se=class{constructor(e,i,r,n,s,o,a,l,c,u,d,p){this.lodResources=e,this.lodRenderer=i,this.stageResources=r,this.originalMaterialParameters=n,this.resourceSize=s,this.isEsriSymbolResource=o,this.isWosr=a,this.resourceBoundingBox=l,this.symbolSize=c,this.extentPadding=u,this.physicalBasedRenderingEnabled=d,this.pivotOffset=p}},yat=class extends Qf{getCachedSize(){const[e,i,r]=this._resources!=null?this._resources.symbolSize:[1,1,1];return{width:e,depth:i,height:r}}constructor(e,i,r,n){super(e,i,r,n),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.skipHighSymbolLodsChanged=!1,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=r.physicalBasedRenderingEnabled}async doLoad(e){if(!this._drivenProperties.size&&QF(this.symbolLayer))throw new Error;if(this._isPrimitive){const i=this.symbolLayer.resource,r=i&&HJe(i.primitive)?i.primitive:Vge;this._resources=await this._createResourcesForPrimitive(r,e)}else{const i=await rat(this.symbol.styleOrigin),r=i?.href??this.symbolLayer.resource.href;this._resources=await this._createResourcesForUrl(r,e)}this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return this._resources!=null?this._resources.extentPadding:0}get _isPrimitive(){return!this.symbolLayer.resource?.href}get lodRenderer(){return this._resources?.lodRenderer}get materials(){return this._resources?.stageResources.materials??[]}_setMaterialTransparencyParameters(e,i=this.symbolLayer?.material?.color){const r=this._getCombinedOpacity(i),n=r<1||this.needsDrivenTransparentPass;return e.transparent=n,e.opacity=r,e.cullFace=n?dr.None:dr.Back,e}async _createResourcesForPrimitive(e,i){const r=this.symbolLayer,n=ds(y6e(e)),s=Xo(PP(n)),o=Xo(b6(s,r)),a=we(o),l=!1,c=!1,u={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:[...TX],ambient:eg,diffuse:eg,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},d=!!u.usePBR;this._setMaterialTransparencyParameters(u);const p=this.symbol;if(p.type==="point-3d"&&p.verticalOffset){const{screenLength:x,minWorldLength:T,maxWorldLength:S}=p.verticalOffset;u.verticalOffset={screenLength:ra(x),minWorldLength:T||0,maxWorldLength:S??1/0},u.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(u.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)u.externalColor=rh;else{const x=r.material!=null?r.material.color:null,T=x!=null?Ye.toUnitRGBA(x):rh;u.externalColor=T}this._fastUpdates=hS(this._context.renderer,this._fastVisualVariableConvertOptions(n,o,s,null)),u.isInstanced=!0,this._fastUpdates?(Object.assign(u,this._fastUpdates.materialParameters),this._optionalFields.push(O.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(u.hasInstancedColor=!0,this._optionalFields.push(O.COLOR)),ie("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(O.OBJECTANDLAYERIDCOLOR);const m=new Jd(u),y=Xwe(e,m);if(!y)throw new Error(`Unknown object symbol primitive: ${e}`);const _=HM(y).map(x=>({opacity:1,transparent:x.parameters.transparent})),v=await this._createStageResources(y,d,i),w=await this._createLodRenderer(y,i);return new _se(y,w,v,_,s,l,c,n,o,a,d,null)}async _createResourcesForUrl(e,i){const r={materialParameters:{isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=hS(this._context.renderer,this._fastVisualVariableConvertOptions(null,null,null,null)),this._fastUpdates?(Object.assign(r.materialParameters,this._fastUpdates.materialParameters),this._optionalFields.push(O.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(r.materialParameters.hasInstancedColor=!0,this._optionalFields.push(O.COLOR)),ie("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(O.OBJECTANDLAYERIDCOLOR);const n=this.symbol;if(n.type==="point-3d"&&n.verticalOffset){const{screenLength:D,minWorldLength:$,maxWorldLength:R}=n.verticalOffset;r.materialParameters.verticalOffset={screenLength:ra(D),minWorldLength:$||0,maxWorldLength:R??1/0},r.materialParameters.castShadows=!1}const s=this._context.physicalBasedRenderingEnabled;r.signal=i,r.usePBR=s,r.skipHighLods=this._context.skipHighSymbolLods;const o=await rSe(e,r),a=o.isEsriSymbolResource,l=o.isWosr,c=Bst(o.lods),u=this._context,d=this.symbolLayer.material,p=this._getExternalColorParameters(d),m=this.symbolLayer?.material?.color,y=this._getCombinedOpacity(m,{hasIntrinsicColor:!0}),_=this.needsDrivenTransparentPass,v=HM(c),w=HM(c).map(D=>({opacity:D.parameters.opacity||1,transparent:D.parameters.transparent}));v.forEach(D=>{const $=D.parameters;D.setParameters(p);const R=$.opacity*y,k=R<1||_||$.transparent;D.setParameters({opacity:R,transparent:k}),u.screenSizePerspectiveEnabled&&D.setParameters({screenSizePerspective:u.sharedResources.screenSizePerspectiveSettings})});const x=o.referenceBoundingBox,T=Xo(PP(x)),S=Xo(c.levels[0].pivotOffset),E=Xo(b6(T,this.symbolLayer)),A=we(E),P=this._fastUpdates;dS(P,this._context.renderer,this._fastVisualVariableConvertOptions(x,E,T,S))&&v.forEach(D=>D.setParameters(P.materialParameters));const N=await this._createStageResources(c,s,i),F=await this._createLodRenderer(c,i);return new _se(c,F,N,w,T,a,l,x,E,A,s,S)}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,i,r){const n=this._context.stage,s=HM(e);i!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),n.addMany(s),this._addDisposeResource(()=>n.removeMany(s));const o=vre(e);n.addMany(o),this._addDisposeResource(()=>{o.forEach(l=>l.unload()),n.removeMany(o)}),await Promise.all(o.map(l=>this._context.stage.schedule(()=>l.load(n.renderView.renderingContext),r))),Et(r);const a=bre(e);return n.addMany(a),this._addDisposeResource(()=>n.removeMany(a)),{materials:s,textures:o,geometries:a}}async _createLodRenderer(e,i){const r=this._context.stage,n={layerUid:this._context.layer.uid,graphicUid:l=>this._instanceIndexToGraphicUid.get(l),notifyGraphicGeometryChanged:l=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(l)),notifyGraphicVisibilityChanged:l=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(l))},s=this._fastUpdates,o=s?{applyTransform:(l,c,u)=>{l.getFeatureAttribute(c,f$),Nn(u,nZe(s.materialParameters,f$,u))},scaleFactor:(l,c,u)=>{c.getFeatureAttribute(u,f$),sX(l,s.materialParameters,f$)}}:null,a=new zu({symbol:e,optionalFields:this._optionalFields,metadata:n,shaderTransformation:o},this._context.scheduler);return a.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{r.removeRenderPlugin(a),a.destroy()}),await r.addRenderPlugin(a,i),a}_getExternalColorParameters(e){const i={};return this._drivenProperties.color?i.externalColor=rh:e?.color!=null?i.externalColor=Ye.toUnitRGBA(e.color):(i.externalColor=rh,i.colorMixMode="ignore"),i}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(e=>e()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry))return null;const r=CO(i.geometry);if(r==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const n=this.setGraphicElevationContext(i),s=e.renderingInfo;return this._createAs3DShape(i,r,s,n,i.uid,e.layer.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(this._resources==null)return;const e=this._drivenProperties.opacity,i=!this._isPrimitive,r=this._resources.stageResources.materials,n=this._resources.originalMaterialParameters;for(let s=0;s<r.length;s++){const o=r[s],a=this.symbolLayer?.material?.color,l=n[s],c=this._getCombinedOpacity(a,{hasIntrinsicColor:i})*l.opacity,u=c<1||e||l.transparent;o.setParameters({opacity:c,transparent:u}),this._isPrimitive&&o.setParameters({cullFace:u?dr.None:dr.Back})}}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,g_)}slicePlaneEnabledChanged(){if(this._resources==null)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(this._resources==null)return!0;const{stageResources:e,isWosr:i}=this._resources;for(const r of e.materials)this._isPrimitive?r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):i||r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this._hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this._hasLoadedPBRTextures=!0,!1)}applyRendererDiff(e,i){if(this._resources==null)return Dn.RecreateSymbol;const{stageResources:{materials:r},lodRenderer:n,resourceBoundingBox:s,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in e.diff){if(c!=="visualVariables"||!dS(this._fastUpdates,i,this._fastVisualVariableConvertOptions(s,o,a,l)))return Dn.RecreateSymbol;for(const u of r)u.setParameters(this._fastUpdates.materialParameters);n.notifyShaderTransformationChanged()}return Dn.FastUpdate}computeComplexity(){if(this._resources==null)return super.computeComplexity();const e=this._resources.lodResources,i=Cxe(e.levels),r=a=>Array.from(a.attributes.values()).reduce((l,c)=>l+Jy(c.data,c.indices),0),n=bre(e).reduce((a,l)=>a+r(l),0),s=vre(e).reduce((a,l)=>a+l.memoryEstimate,0)+n,o={...Exe(this.symbol,this.symbolLayer),resourceBytes:s};return new Yu({verticesPerFeature:i,memory:o})}_hasLodRenderer(){return this._resources!=null}_createAs3DShape(e,i,r,n,s,o){if(!this._hasLodRenderer()||this._resources==null)return null;const a=this.getFastUpdateAttrValues(e),l=this._context.clippingExtent;if(lc(i,fx,this._context.elevationProvider.spatialReference),l!=null&&!uW(l,fx))return null;const c=this._requiresTerrainElevation(n),u=this._computeGlobalTransform(i,n,P8,m$),d=this._computeLocalTransform(this._resources,this.symbolLayer,r,vse),p=this._resources.lodRenderer.instanceData,m=p.addInstance();this._instanceIndexToGraphicUid.set(m,s),p.setLocalTransform(m,d,!1),p.setGlobalTransform(m,u),a&&p.setFeatureAttribute(m,a),this._fastUpdates==null&&this._hasPerInstanceColor()&&p.setColor(m,f3(r.color,r.opacity,255)),this._context.stage.renderView.objectAndLayerIdRenderHelper!=null&&p.setObjectAndLayerIdColor(m,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:s,layerUid:o}));const y=new kst(this,m,$Je,n);return c&&(y.alignedSampledElevation=m$.sampledElevation),y.needsElevationUpdates=g_(n.mode),EO(y,i,this._context.elevationProvider),y}_computeGlobalTransform(e,i,r,n){return m_(e,this._context.elevationProvider,i,this._context.renderCoordsHelper,n),fx[0]=e.x,fx[1]=e.y,fx[2]=n.z,ic(e.spatialReference,fx,r,this._context.renderCoordsHelper.spatialReference),r}_computeLocalTransform(e,i,r,n){return fh(n),this._applyObjectRotation(r,!1,n),this._applyObjectRotation(i,!0,n),this._applyObjectScale(e,r,n),this._applyAnchor(e,i,n),n}_applyObjectScale(e,i,r){if(this._fastUpdates?.requiresShaderTransformation)return;const n=this._drivenProperties.size&&i.size?i.size:e.symbolSize,s=yre(n,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);s[0]===1&&s[1]===1&&s[2]===1||lR(r,r,s)}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const i=e.diff.diff;this._preparePatchTransform(e,i),this._preparePatchColor(e,i)}updateGeometry(e,i){if(this._resources==null)return!0;const r=i&&CO(i);if(r==null)return!1;const n=this.getGeometryElevationMode(i);return e.elevationContext.mode===n&&(this._computeGlobalTransform(r,e.elevationContext,P8,m$),this._requiresTerrainElevation(e.elevationContext)&&(e.alignedSampledElevation=m$.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,P8,!0),EO(e,r,this._context.elevationProvider),!0)}_preparePatchTransform(e,i){if(!(i.heading||i.tilt||i.roll||i.width||i.height||i.depth||i.anchor||i.anchorPosition)||this._resources==null)return;const r=(y,_,v)=>(y!=null&&y.type==="complete"?y.newValue:_)??v,n=r(i.heading,this.symbolLayer.heading,0),s=r(i.tilt,this.symbolLayer.tilt,0),o=r(i.roll,this.symbolLayer.roll,0),a=r(i.width,this.symbolLayer.width,void 0),l=r(i.height,this.symbolLayer.height,void 0),c=r(i.depth,this.symbolLayer.depth,void 0),u=r(i.anchor,this.symbolLayer.anchor,void 0),d=r(i.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete i.heading,delete i.tilt,delete i.roll,delete i.width,delete i.height,delete i.depth,delete i.anchor,delete i.anchorPosition;const p={heading:n,tilt:s,roll:o,anchor:u,anchorPosition:d},m=this._resources;this.loadStatus===Vc.LOADED&&e.symbolLayerStatePatches.push(()=>{m.symbolSize=Xo(b6(m.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),e.graphics3DGraphicPatches.push((y,_)=>{const v=this._computeLocalTransform(m,p,_,vse),w=y.instanceIndex;m.lodRenderer.instanceData.setLocalTransform(w,v,!0)})}_preparePatchColor(e,i){if(!i.material||i.material.type!=="partial")return;const r=i.material.diff;if(!r.color||r.color.type!=="complete"||r.color.newValue==null||r.color.oldValue==null)return;const n=r.color.newValue,s=n!=null?Ye.toUnitRGBA(n):rh;delete r.color;const o=this._resources;o!=null&&e.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,s),l=this._setMaterialTransparencyParameters({},n)):l=this._setMaterialTransparencyParameters({externalColor:s},n);for(const c of o.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(e){return e.mode!=="absolute-height"}_applyObjectRotation(e,i,r){if(!this._fastUpdates?.requiresShaderTransformation||!i)return wJe(e.heading,e.tilt,e.roll,r)}_computeAnchor(e,i,r){const n=C();switch(r.anchor){case"center":se(n,Rd(e)),na(n,n);break;case"top":{const s=Rd(e);oe(n,-s[0],-s[1],-e[5]);break}case"bottom":{const s=Rd(e);oe(n,-s[0],-s[1],-e[2]);break}case"relative":{const s=Rd(e),o=PP(e),a=r.anchorPosition,l=a?Ce(a.x,a.y,a.z):Gs;A4(n,o,l),ce(n,n,s),na(n,n);break}default:i!=null?na(n,i):se(n,Gs)}return n}_applyAnchor(e,i,r){if(this._fastUpdates?.requiresShaderTransformation)return;const n=this._computeAnchor(e.resourceBoundingBox,e.pivotOffset,i);n&&yl(r,r,n)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,i,r,n){const s=e!=null?Xo(PP(e)):eg,o=e!=null?this._computeAnchor(e,n,this.symbolLayer):Gs,a=this._context.renderCoordsHelper.unitInMeters,l=yre(i??void 0,i,r,a),c=Ce(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new IR({size:!0,color:!0,rotation:!0,opacity:!1},s,i??eg,a,o,l,c)}};const fx=C(),vse=be(),P8=be(),f$=Kt(),m$=new kR;let _at=class{constructor(e,i,r,n){this.vertices=e,this.positionsES=i,this.offset=n;const s=e.length,o=Math.floor(s/2),a=this.offset+3*o,l=r[a],c=r[a+1],u=r[a+2];this.origin=Ce(l,c,u),this.positions=Jr(3*s);const d=this.offset+3*s;for(let p=this.offset;p<d;p+=3)this.positions[p]=r[p]-l,this.positions[p+1]=r[p+1]-c,this.positions[p+2]=r[p+2]-u;this.updatePathVertexInformation()}get usedMemory(){return Jy(this.positions)}updatePathVertexInformation(){const e=this.vertices.length,i=this.vertices[0];let r=this.offset;const n=this.positions;i.vRight[0]=n[r+3]-n[r],i.vRight[1]=n[r+4]-n[r+1],i.vRight[2]=n[r+5]-n[r+2],r+=3;let s=we(i.vRight);i.vMinSiblingLength=s,ge(i.vRight,i.vRight);let o=i;for(let a=1;a<e;++a){const l=this.vertices[a];if(l.vLeft=o.vRight,a<e-1){l.vRight[0]=n[r+3]-n[r],l.vRight[1]=n[r+4]-n[r+1],l.vRight[2]=n[r+5]-n[r+2];const c=we(l.vRight);l.vMinSiblingLength=Math.min(s,c),s=c,ge(l.vRight,l.vRight)}else se(l.vRight,l.vLeft),l.vMinSiblingLength=s;o=l,r+=3}}},vat=class{constructor(e,i,r,n,s,o={}){this.path=e,this.profile=i,this.extruder=r,this.startCap=n,this.endCap=s,this.options=o,this._extrusionVertexCount=0;const a=this.path.vertices.length-2;this.numExtrusionProfiles=r.numProfilesPerJoin()*a+2,this.numVerticesTotal=i.vertices.length*this.numExtrusionProfiles,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.numVertices;this.numVerticesTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.numVertices;this.numVerticesTotal+=c,this.pathVertexData=sHe(1*this.numVerticesTotal),this.profileRightAxes=Jr(4*this.numVerticesTotal),this.profileUpAxes=Jr(4*this.numVerticesTotal),this.profileVertexAndNormals=Jr(4*this.numVerticesTotal),this.positions=$N(e.positions,e.offset,3*e.vertices.length),this._rebuildGeometry(),this.buildTopology()}get usedMemory(){return Jy(this.pathVertexData,this.profileRightAxes,this.profileUpAxes,this.profileVertexAndNormals)+this.path.usedMemory+this.profile.usedMemory}emitVertex(e,i,r,n,s){const o=4*this._extrusionVertexCount;if(this.profileRightAxes[o]=i.right[0],this.profileRightAxes[o+1]=i.right[1],this.profileRightAxes[o+2]=i.right[2],this.profileUpAxes[o]=i.up[0],this.profileUpAxes[o+1]=i.up[1],this.profileUpAxes[o+2]=i.up[2],this.profileVertexAndNormals[o]=r[0],this.profileVertexAndNormals[o+1]=r[1],this.profileVertexAndNormals[o+2]=n[0],this.profileVertexAndNormals[o+3]=n[1],this.pathVertexData[this._extrusionVertexCount]=e,s){const a=this.path.vertices[e],l=a.maxStretchDistance;this.profileRightAxes[o+3]=a.rotationRight[0]*l,this.profileUpAxes[o+3]=a.rotationRight[1]*l}else this.profileRightAxes[o+3]=0,this.profileUpAxes[o+3]=0;++this._extrusionVertexCount}emitCapVertex(e,i,r,n,s,o){const a=4*this._extrusionVertexCount;this.profileRightAxes[a]=i.right[0],this.profileRightAxes[a+1]=i.right[1],this.profileRightAxes[a+2]=i.right[2],this.profileRightAxes[a+3]=s,this.profileUpAxes[a]=i.up[0],this.profileUpAxes[a+1]=i.up[1],this.profileUpAxes[a+2]=i.up[2],this.profileUpAxes[a+3]=o,this.profileVertexAndNormals[a]=r[0],this.profileVertexAndNormals[a+1]=r[1],this.profileVertexAndNormals[a+2]=n[0],this.profileVertexAndNormals[a+3]=n[1],this.pathVertexData[this._extrusionVertexCount]=e,++this._extrusionVertexCount}_rebuildGeometry(){this._extrusionVertexCount=0;const{positions:e,offset:i,vertices:r}=this.path;this.positions=$N(e,i,3*r.length);let n=0;const s=(a,l,c,u,d)=>this.emitCapVertex(n,a,l,c,u,d),o=(a,l,c,u)=>this.emitVertex(n,a,l,c,u);for(this.startCap.rebuildConnectingProfileGeometry(r[n],this.profile,s),n=1;n<r.length-1;++n)this.extruder.extrude(r[n],this.profile,o);this.endCap.rebuildConnectingProfileGeometry(r[n],this.profile,s),n=0,this.startCap.rebuildCapGeometry(r[n],s),n=r.length-1,this.endCap.rebuildCapGeometry(r[n],s)}buildTopology(){const e=this.profile.vertices.length,i=this.profile.numSegments,r=this.numExtrusionProfiles-1;let n=3*(2*(i*r));this.startCap.indexBufferStart=n,this.startCap.firstProfileVertexIndex=0,n+=this.startCap.numIndices,this.endCap.indexBufferStart=n,this.endCap.firstProfileVertexIndex=e*(this.numExtrusionProfiles-1);const s=new Array,o=new Array,a=new Array,l=(c,u,d)=>{s.push(c),s.push(u),s.push(d),o.push(c),o.push(u),o.push(d),a.push(this.pathVertexData[c]),a.push(this.pathVertexData[u]),a.push(this.pathVertexData[d])};for(let c=0;c<i;++c){const u=this.profile.indices[2*c],d=this.profile.indices[2*c+1];for(let p=0;p<r;++p){const m=p*e+u,y=(p+1)*e+d,_=p*e+d;l(m,(p+1)*e+u,y),l(m,y,_)}}this.startCap.buildTopology(this.path.vertices[0],l),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],l),this.vertexIndices=Sf(s),this.normalIndices=Sf(o),this.pathVertexIndices=Sf(a)}onPathChanged(){this._rebuildGeometry()}},fZ=class{rebuildConnectingProfileGeometry(e,i,r){for(let n=0;n<i.vertices.length;++n)r(e.frame,i.vertices[n],i.normals[n],0,0)}},bse=class extends fZ{constructor(){super(),this.numVertices=0,this.numIndices=0}rebuildCapGeometry(){}buildTopology(){}},g$=class extends fZ{constructor(e,i=0,r=!1){super(),this.profile=e,this.profilePlaneOffset=i,this.flip=r}get numVertices(){return this.profile.vertices.length}get numIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,i,r){const n=this.profilePlaneOffset;for(let s=0;s<i.vertices.length;++s)r(e.frame,i.vertices[s],i.normals[s],n,0)}rebuildCapGeometry(e,i){const r=this.profile,n=this.flip?1:-1,s=this.profilePlaneOffset,o=dSe;si(o,0,0);for(let a=0;a<r.vertices.length;++a)i(e.frame,r.vertices[a],o,s,n)}buildTopology(e,i){const r=this.profile,n=this.vertexBufferStart+r.indices[0];for(let s=1;s<r.numSegments;++s){const o=r.indices[2*s],a=r.indices[2*s+1],l=this.vertexBufferStart+o,c=this.vertexBufferStart+a;this.flip?i(c,l,n):i(n,l,c)}}},wse=class extends fZ{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}get numVertices(){let e=this.profile.vertices.length*(this.numSegments-1)+this.profile.poles.length;return this.breakNormals&&(e+=this.profile.vertices.length),e}get numIndices(){let e=0;const i=this.profile;e+=2*i.numSegments*(this.numSegments-1);for(let r=0;r<i.numSegments;++r){const n=i.indices[2*r],s=i.indices[2*r+1];i.poleIndices[n]===i.poleIndices[s]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,i){const r=this.profile,n=e.frame,s=.5*this.sign,o=bat,a=dSe;si(a,0,0);for(const l of r.poles)l.normal?i(n,l.position,l.normal,s,0):i(n,l.position,a,s,this.sign);if(this.breakNormals)for(let l=0;l<r.vertices.length;++l)i(n,r.vertices[l],r.normals[l],0,0);for(let l=0;l<this.numSegments-1;++l){const c=(1-(l+1)/this.numSegments)*Math.PI*.5,u=Math.sin(c),d=Math.cos(c);for(let p=0;p<r.vertices.length;++p){const m=r.poles[r.poleIndices[p]];lf(o,r.vertices[p],m.position),Yl(o,o,u),m.normal?(md(o,o,m.position),i(n,o,m.normal,s*d,0)):(fO(a,o),Yl(a,a,u),md(o,o,m.position),i(n,o,a,s*d,this.sign*d))}}}buildTopology(e,i){const r=this.profile,n=this.breakNormals?this.vertexBufferStart+r.poles.length:this.firstProfileVertexIndex,s=this.breakNormals?this.vertexBufferStart+r.poles.length+r.vertices.length:this.vertexBufferStart+r.poles.length;for(let o=0;o<r.numSegments;++o){const a=r.indices[2*o],l=r.indices[2*o+1],c=this.vertexBufferStart+r.poleIndices[a],u=this.vertexBufferStart+r.poleIndices[l];let d=n+a,p=n+l;for(let m=0;m<this.numSegments-1;++m){const y=s+m*r.vertices.length+a,_=s+m*r.vertices.length+l;this.flip?(i(y,p,d),i(p,y,_)):(i(d,p,y),i(_,y,p)),d=y,p=_}this.flip?(i(c,p,d),c!==u&&i(c,u,p)):(i(d,p,c),c!==u&&i(p,u,c))}}};const bat=Ue(),dSe=Ue();let wat=class{numProfilesPerJoin(){return 1}extrude(e,i,r){for(let n=0;n<i.vertices.length;++n)r(e.frame,i.vertices[n],i.normals[n],!1)}},M8=class{constructor(e,i){this.cutoffAngle=e,this.numBendSubdivisions=i}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,i,r){const n=Tat,{rotationAngle:s,rotationRight:o,frame:a}=e;if(Math.abs(s)>=this.cutoffAngle){const l=e.rotationFrameUp;for(let c=0;c<this.numBendSubdivisions+1;++c){hu(Tse,.5*-s+c*s/this.numBendSubdivisions,l),xat(n,a,Tse);for(let u=0;u<i.vertices.length;++u)es(i.vertices[u],o)*s>=0?r(n,i.vertices[u],i.normals[u],!1):r(a,e.applyMiterStretch(xse,i.vertices[u]),i.normals[u],!0)}}else for(let l=0;l<this.numBendSubdivisions+1;++l)for(let c=0;c<i.vertices.length;++c){const u=es(i.vertices[c],o)*s>=0;r(a,e.applyMiterStretch(xse,i.vertices[c]),i.normals[c],!u)}}},pSe=class{constructor(){this.up=C(),this.right=C()}};function xat(t,e,i){Fe(t.up,e.up,i),Fe(t.right,e.right,i)}const xse=Ue(),Tse=be(),Tat=new pSe;let Sat=class extends Wn{constructor(e,i,r,n,s,o){super(e,i,null,on.Mesh,o),this.path=r,this.geometrySR=n,this.stencilWidth=s}};var Ef;function fSe(t){return"path"in t}(function(t){t[t.World=0]="World",t[t.Path=1]="Path"})(Ef||(Ef={}));let mSe=class{constructor(e){this.builder=e}onPathChanged(e){this.builder.onPathChanged()}},gSe=class extends mSe{constructor(e){super(e),this.vertexAttributeColor=Mt(255,255,255,255),this.size=new Array,this.vertexAttributePosition=Jr(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Int16Array(2*this.builder.numVerticesTotal)}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;const{numVerticesTotal:i,pathVertexData:r,path:n,positions:s,profileRightAxes:o,profileUpAxes:a,profileVertexAndNormals:l}=this.builder;for(let c=0;c<i;++c){let u=r[c];const d=u===0||u===n.vertices.length-1;u*=3;const p=Rat;let m=0,y=0;const _=4*c,v=oe(Pat,o[_],o[_+1],o[_+2]),w=oe(Mat,a[_],a[_+1],a[_+2]),x=si(Sse,l[_]*e[0],l[_+1]*e[1]);if(d)nt(p,w,v),m=o[_+3]*e[0],y=a[_+3];else{const A=Cat,P=Aat;si(A,o[_+3],a[_+3]);const N=lY(A);fO(A,A);const F=es(x,A);if(Math.abs(F)>N){si(P,-A[1],A[0]);const D=es(x,P);Yl(A,A,N*Math.sign(F)),Yl(P,P,D),md(x,A,P)}oe(p,0,0,0)}const T=oe(Oat,v[0]*x[0]+w[0]*x[1],v[1]*x[0]+w[1]*x[1],v[2]*x[0]+w[2]*x[1]),S=3*c;this.vertexAttributePosition[S]=s[u]+T[0]+p[0]*m,this.vertexAttributePosition[S+1]=s[u+1]+T[1]+p[1]*m,this.vertexAttributePosition[S+2]=s[u+2]+T[2]+p[2]*m;const E=si(Sse,l[_+2],l[_+3]);qb(this.vertexAttributeNormal,c,v[0]*E[0]+w[0]*E[1]+p[0]*y,v[1]*E[0]+w[1]*E[1]+p[1]*y,v[2]*E[0]+w[2]*E[1]+p[2]*y)}}createGeometryData(){const e=this.builder.vertexIndices.length,{normalIndices:i,vertexIndices:r}=this.builder;return[[O.POSITION,new ke(this.vertexAttributePosition,r,3,!0)],[O.NORMALCOMPRESSED,new ke(this.vertexAttributeNormal,i,2,!0)],[O.COLOR,new ke(this.vertexAttributeColor,M_(e),4)]]}onPathChanged(e){super.onPathChanged(e),this.bake(this.size)}intersect(e,i,r){const n=this.builder.vertexIndices,s=new TR(this.vertexAttributePosition,3),o=n.length/3;LR(e,i,0,o,n,s,void 0,void 0,r)}},Eat=class extends mSe{constructor(e,i,r,n){super(e),this.sizeAttributeValue=i,this.colorAttributeValue=r,this.opacityAttributeValue=n,this.vvData=null,this.baked=new gSe(e),this.vvData=Jr(4*this.builder.path.vertices.length);for(let s=0;s<this.builder.path.vertices.length;++s){this.vvData[4*s]=i,this.vvData[4*s+1]=r,this.vvData[4*s+2]=n;const o=s===0||s===this.builder.path.vertices.length-1;this.vvData[4*s+3]=o?1:0}}createGeometryData(){const{positions:e,profileRightAxes:i,profileUpAxes:r,profileVertexAndNormals:n,pathVertexIndices:s,vertexIndices:o}=this.builder;return[[O.POSITION,new ke(e,s,3,!0)],[O.PROFILERIGHT,new ke(i,o,4,!0)],[O.PROFILEUP,new ke(r,o,4,!0)],[O.PROFILEVERTEXANDNORMAL,new ke(n,o,4,!0)],[O.FEATUREVALUE,new ke(this.vvData,s,4,!0)]]}onPathChanged(e){super.onPathChanged(e);const i=e.getMutableAttribute(O.POSITION);i&&(i.data=this.builder.positions)}};const Sse=Ue(),Cat=Ue(),Aat=Ue(),Oat=C(),Rat=C(),Pat=C(),Mat=C();function $at(t,e){let i=null;const r=t.vertices.length,n=.99619469809,s=C(),o=C(),a=C(),l=C(),c=C(),u=C(),d=Ti();let p=t.vertices[0];se(o,e),oe(s,0,1,0),DN(p.vRight,o,s,s,a,o,n),se(p.frame.up,o),se(p.frame.right,a);const m=t.positions;let y=t.offset;i=p;for(let _=1;_<r;++_){p=t.vertices[_],ce(c,p.vLeft,p.vRight);let v=we(c);v>0?(v=1/Math.sqrt(v),c[0]=c[0]*v,c[1]=c[1]*v,c[2]=c[2]*v):(c[0]=p.vRight[0],c[1]=p.vRight[1],c[2]=p.vRight[2]),u[0]=m[y]+i.frame.up[0],u[1]=m[y+1]+i.frame.up[1],u[2]=m[y+2]+i.frame.up[2],y+=3;const w=oe(Iat,m[y],m[y+1],m[y+2]);xR(w,c,d),aw(d,pu(u,p.vLeft),l)?(l[0]-=m[y],l[1]-=m[y+1],l[2]-=m[y+2],ge(o,l),nt(a,c,o),ge(a,a)):DN(c,i.frame.up,i.frame.right,s,a,o,n),se(p.frame.up,o),se(p.frame.right,a),i=p}}const Iat=C();let ySe=class{constructor(){this.vertices=new Array,this.normals=new Array,this.indices=new Array,this.poles=new Array,this.poleIndices=new Array}addVertex(e,i){return this.vertices.push(ZC(e)),this.normals.push(ZC(i)),this.vertices.length-1}addPole(e,i=null){return this.poles.push({position:ZC(e),normal:i?ZC(i):null}),this.poles.length-1}addSegment(e,i=null){this.indices.push(e.v0),this.indices.push(e.v1),i&&(this.poleIndices.push(i.v0),this.poleIndices.push(i.v1))}get numSegments(){return this.indices.length/2}translate(e,i){for(const r of this.vertices)r[0]+=e,r[1]+=i;for(const r of this.poles)r.position[0]+=e,r.position[1]+=i}get usedMemory(){return this.vertices.length*Jy(this.vertices[0])*2+Jy(this.indices)}};const _Se={top:[0,-.5],bottom:[0,.5]};function $8(t){const i=Hwe,r=new ySe,n={v0:0,v1:0};r.addPole(ri(0,0));for(let o=0;o<i;++o){const a=2*o*Math.PI/i,l=Math.cos(a),c=Math.sin(a),u=ri(l*.5,c*.5),d=ri(l,c);r.addVertex(u,d)}for(let o=0;o<i-1;++o){const a={v0:o,v1:o+1};r.addSegment(a,n)}const s={v0:i-1,v1:0};if(r.addSegment(s,n),t!=="center"){const o=_Se[t];r.translate(o[0],o[1])}return r}const Lat={center:$8("center"),top:$8("top"),bottom:$8("bottom")},Dat={center:I8("center"),top:I8("top"),bottom:I8("bottom")};function I8(t){const r=new ySe,n=ri(.5*-1,.5*-1),s=ri(.5*1,.5*-1),o=ri(.5*1,.5*1),a=ri(.5*-1,.5*1),l=ri(0,-1),c=ri(1,0),u=ri(0,1),d=ri(-1,0);if(r.addPole(ri(0,.5*1),u),r.addPole(ri(0,.5*1)),r.addPole(ri(0,.5*-1)),r.addPole(ri(0,.5*-1),l),r.addVertex(n,l),r.addVertex(s,l),r.addSegment({v0:0,v1:1},{v0:3,v1:3}),r.addVertex(s,c),r.addVertex(o,c),r.addSegment({v0:2,v1:3},{v0:2,v1:1}),r.addVertex(o,u),r.addVertex(a,u),r.addSegment({v0:4,v1:5},{v0:0,v1:0}),r.addVertex(a,d),r.addVertex(n,d),r.addSegment({v0:6,v1:7},{v0:1,v1:2}),t!=="center"){const p=_Se[t];r.translate(p[0],p[1])}return r}function Nat(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Fat(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function vSe(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t}function kat(t,e){if(t===e){const i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function Uat(t,e){const i=e[0],r=e[1],n=e[2],s=e[3];let o=i*s-n*r;return o?(o=1/o,t[0]=s*o,t[1]=-r*o,t[2]=-n*o,t[3]=i*o,t):null}function zat(t,e){const i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t}function Bat(t){return t[0]*t[3]-t[2]*t[1]}function bSe(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=i[0],l=i[1],c=i[2],u=i[3];return t[0]=r*a+s*l,t[1]=n*a+o*l,t[2]=r*c+s*u,t[3]=n*c+o*u,t}function Vat(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+s*a,t[1]=n*l+o*a,t[2]=r*-a+s*l,t[3]=n*-a+o*l,t}function Gat(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=i[0],l=i[1];return t[0]=r*a,t[1]=n*a,t[2]=s*l,t[3]=o*l,t}function jat(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t}function Hat(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function qat(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function Wat(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2)}function Yat(t,e,i,r){return t[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-t[2]*i[1],[t,e,i]}function Xat(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function wSe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function Zat(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Jat(t,e){const i=t[0],r=t[1],n=t[2],s=t[3],o=e[0],a=e[1],l=e[2],c=e[3],u=mo();return Math.abs(i-o)<=u*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=u*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-l)<=u*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=u*Math.max(1,Math.abs(s),Math.abs(c))}function Kat(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function Qat(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t}const elt=bSe,tlt=wSe;Object.freeze(Object.defineProperty({__proto__:null,LDU:Yat,add:Xat,adjoint:zat,copy:Nat,determinant:Bat,equals:Jat,exactEquals:Zat,frob:Wat,fromRotation:jat,fromScaling:Hat,identity:Fat,invert:Uat,mul:elt,multiply:bSe,multiplyScalar:Kat,multiplyScalarAndAdd:Qat,rotate:Vat,scale:Gat,set:vSe,str:qat,sub:tlt,subtract:wSe,transpose:kat},Symbol.toStringTag,{value:"Module"}));function xSe(){return[1,0,0,1]}function ilt(t){return[t[0],t[1],t[2],t[3]]}function rlt(t,e,i,r){return[t,e,i,r]}function nlt(t,e){return new Float64Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:ilt,create:xSe,createView:nlt,fromValues:rlt},Symbol.toStringTag,{value:"Module"}));let TSe=class{constructor(){this.vLeft=C(),this.vRight=C(),this.vMinSiblingLength=0,this.frame=new pSe}setFrameFromUpVector(e){se(this.frame.up,e),ce(XE,this.vLeft,this.vRight),ge(XE,XE),te(Ase,this.frame.up,me(XE,this.frame.up)),he(y$,XE,Ase),ge(y$,y$),nt(this.frame.right,y$,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}},slt=class extends TSe{get rotationFrameUp(){return this.frame.up}get rotationRight(){return x0e}get rotationAngle(){return te(C0,this.frame.up,me(this.frame.up,this.vLeft)),he(C0,this.vLeft,C0),na(C0,C0),ge(C0,C0),te(gx,this.frame.up,me(this.frame.up,this.vRight)),he(gx,this.vRight,gx),ge(gx,gx),nt(m5,this.rotationFrameUp,this.vLeft),Math.sign(me(m5,this.vRight))*(Math.PI-xs(me(C0,gx)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(e,i){const r=this.rotationAngle;if(Math.abs(r)<=0)return i;const n=kB(Math.cos(.5*r));return si(e,(n-1+1)*i[0],i[1])}},olt=class extends TSe{get rotationFrameUp(){const e=Math.sign(me(this.frame.right,this.vRight));return nt(YE,this.vRight,this.vLeft),te(YE,YE,e),ge(YE,YE)}get rotationRight(){const e=this.rotationFrameUp,i=me(e,this.frame.up),r=me(e,this.frame.right);return te(mx,this.frame.up,-r),te(Cse,this.frame.right,i),ce(mx,mx,Cse),ge(mx,mx),alt(Ese,this.frame,mx),Ese}get rotationAngle(){const e=Math.sign(me(this.frame.right,this.vRight));return na(m5,this.vLeft),-e*(Math.PI-xs(me(m5,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*kB(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(e,i){const r=this.rotationAngle;if(Math.abs(r)===0)return i;const n=kB(Math.cos(.5*r)),s=this.rotationRight,o=vSe(clt,1+(n-1)*s[0]*s[0],(n-1)*s[0]*s[1],(n-1)*s[0]*s[1],1+(n-1)*s[1]*s[1]);return Y_e(e,i,o)}};function alt(t,e,i){si(t,me(i,e.right),me(i,e.up))}function llt(t){switch(t){case Ef.World:return new slt;case Ef.Path:return new olt}}const YE=C(),Ese=Ue(),mx=C(),Cse=C(),m5=C(),C0=C(),gx=C(),Ase=C(),XE=C(),y$=C(),clt=xSe(),L8=8;function ult(t,e){const i=O.FEATUREVALUE;t.attributes.add(i,"vec4");const r=t.vertex;r.code.add(b`
  bool isCapVertex() {
    return ${i}.w == 1.0;
  }
  `),r.uniforms.add(new zi("size",n=>n.size)),e.vvSize?(r.uniforms.add(new $t("vvSizeMinSize",n=>n.vvSize.minSize),new $t("vvSizeMaxSize",n=>n.vvSize.maxSize),new $t("vvSizeOffset",n=>n.vvSize.offset),new $t("vvSizeFactor",n=>n.vvSize.factor)),r.code.add(b`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${i}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):r.code.add(b`vec2 getSize(){
return size;
}`),e.vvOpacity?(r.constants.add("vvOpacityNumber","int",L8),r.uniforms.add(new hl("vvOpacityValues",n=>n.vvOpacity.values,L8),new hl("vvOpacityOpacities",n=>n.vvOpacity.opacityValues,L8)),r.code.add(b`
    vec4 applyOpacity(vec4 color) {
      float value = ${i}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):r.code.add(b`vec4 applyOpacity(vec4 color){
return color;
}`),e.vvColor?(r.constants.add("vvColorNumber","int",_T),r.uniforms.add(new hl("vvColorValues",n=>n.vvColor.values,_T),new vwe("vvColorColors",n=>n.vvColor.colors,_T)),r.code.add(b`
    vec4 getColor() {
      float value = ${i}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):r.code.add(b`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),t.include(AR),t.attributes.add(O.PROFILERIGHT,"vec4"),t.attributes.add(O.PROFILEUP,"vec4"),t.attributes.add(O.PROFILEVERTEXANDNORMAL,"vec4"),r.code.add(b`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),r.code.add(b`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),r.code.add(b`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),r.code.add(b`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}let hlt=class extends NR{constructor(){super(...arguments),this.size=ri(1,1)}};function dlt(t){const e=new mi,{vertex:i,fragment:r}=e;switch(tc(i,t),e.varyings.add("vpos","vec3"),e.include(ult,t),t.output!==U.Color&&t.output!==U.Alpha||(e.include(ml,t),e.include(Gb,t),e.include(qS,t),e.varyings.add("vnormal","vec3"),e.varyings.add("vcolor","vec4"),t.multipassEnabled&&e.varyings.add("depth","float"),i.code.add(b`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${t.output===U.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),e.include(uc,t),t.output){case U.Alpha:e.include(vn,t),r.uniforms.add(new Oe("opacity",n=>n.opacity)),r.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        fragColor = vec4(combinedOpacity);
      }
    `);break;case U.Color:e.include(vn,t),e.include(Vb,t),e.include(BR,t),e.include(Gb,t),e.include(Kwe,t),Xd(r,t),VR(r),JS(r),r.uniforms.add(i.uniforms.get("localOrigin"),new $t("ambient",n=>n.ambient),new $t("diffuse",n=>n.diffuse),new $t("specular",n=>n.specular),new Oe("opacity",n=>n.opacity)),r.include(Jf),Wf(r),r.code.add(b`
        void main() {
          discardBySlice(vpos);
          ${t.multipassEnabled?"terrainDepthTest(depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          fragColor = vec4(shadedColor, combinedOpacity);
          fragColor = highlightSlice(fragColor, vpos);
          ${t.transparencyPassType===Qe.Color?"fragColor = premultiplyAlpha(fragColor);":""}
        }
      `);break;case U.Depth:case U.Shadow:case U.ShadowHighlight:case U.ShadowExcludeHighlight:e.include(ml,t),Ub(e),e.varyings.add("depth","float"),i.code.add(b`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),e.include(vn,t),e.include(Mg,t),r.code.add(b`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case U.Normal:e.include(ml,t),e.include(PO,t),aS(i),e.varyings.add("vnormal","vec3"),i.code.add(b`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(vn,t),r.code.add(b`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case U.Highlight:e.include(ml,t),e.include(PO,t),e.varyings.add("vnormal","vec3"),i.code.add(b`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(vn,t),e.include(I_,t),r.code.add(b`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return e}const plt=Object.freeze(Object.defineProperty({__proto__:null,build:dlt},Symbol.toStringTag,{value:"Module"})),SSe=new Map([[O.POSITION,0],[O.PROFILERIGHT,1],[O.PROFILEUP,2],[O.PROFILEVERTEXANDNORMAL,3],[O.FEATUREVALUE,4]]);let flt=class extends hlt{constructor(){super(...arguments),this.ambient=Ce(.2,.2,.2),this.diffuse=Ce(.8,.8,.8),this.specular=Ce(0,0,0),this.opacity=1,this.origin=C(),this.modelTransformation=null}},ESe=class CSe extends Ci{initializeConfiguration(e,i){i.spherical=e.viewingMode===Me.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new wi(e.rctx,CSe.shader.get().build(this.configuration),SSe)}initializePipeline(){const e=this.configuration.transparencyPassType,i=this.configuration,r=e===Qe.NONE,n=e===Qe.FrontFace;return Ot({blending:i.output!==U.Color&&i.output!==U.Alpha||!i.transparent?null:r?su:Wg(e),culling:i.hasSlicePlane&&!i.transparent&&i.doubleSidedMode!==Kr.None?rve:null,depthTest:{func:L_(e)},depthWrite:r||n?_l:null,colorWrite:Ft,stencilWrite:i.hasOccludees?Ff:null,stencilTest:i.hasOccludees?D_:null,polygonOffset:r||n?null:JF})}};ESe.shader=new bi(plt,()=>pe(()=>import("./Path.glsl-f20d87d0.js"),[],import.meta.url));let Kn=class extends Ua{constructor(){super(...arguments),this.output=U.Color,this.doubleSidedMode=Kr.None,this.transparencyPassType=Qe.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}};h([V({count:U.COUNT})],Kn.prototype,"output",void 0),h([V({count:Kr.COUNT})],Kn.prototype,"doubleSidedMode",void 0),h([V({count:Qe.COUNT})],Kn.prototype,"transparencyPassType",void 0),h([V()],Kn.prototype,"spherical",void 0),h([V()],Kn.prototype,"receiveShadows",void 0),h([V()],Kn.prototype,"receiveAmbientOcclusion",void 0),h([V()],Kn.prototype,"vvSize",void 0),h([V()],Kn.prototype,"vvColor",void 0),h([V()],Kn.prototype,"vvOpacity",void 0),h([V()],Kn.prototype,"hasSlicePlane",void 0),h([V()],Kn.prototype,"transparent",void 0),h([V()],Kn.prototype,"hasOccludees",void 0),h([V()],Kn.prototype,"multipassEnabled",void 0),h([V()],Kn.prototype,"cullAboveGround",void 0),h([V()],Kn.prototype,"doublePrecisionRequiresObfuscation",void 0),h([V({constValue:!1})],Kn.prototype,"occlusionPass",void 0),h([V({constValue:it.Disabled})],Kn.prototype,"pbrMode",void 0),h([V({constValue:!0})],Kn.prototype,"hasVvInstancing",void 0),h([V({constValue:!1})],Kn.prototype,"useCustomDTRExponentForWater",void 0),h([V({constValue:!1})],Kn.prototype,"useFillLights",void 0),h([V({constValue:!1})],Kn.prototype,"hasColorTexture",void 0);let mlt=class ASe extends $_{constructor(e){super(e,new ylt),this.supportsEdges=!0,this._vertexAttributeLocations=SSe,this._configuration=new Kn,this._vertexBufferLayout=ASe.getVertexBufferLayout()}getConfiguration(e,i){return this._configuration.output=e,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e!==U.Color&&e!==U.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Kr.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Kr.WindingOrder:Kr.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=i.ssao!=null),this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(e){return e!==U.Shadow&&e!==U.ShadowExcludeHighlight&&e!==U.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(e,i,r,n,s,o){const a=e;if(!fSe(a))return;const l=a.path,c=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const{offset:v,factor:w,minSize:x,maxSize:T}=this.parameters.vvSize,S=l.sizeAttributeValue;c[0]*=_e(v[0]+S*w[0],x[0],T[0]),c[1]*=_e(v[2]+S*w[2],x[2],T[2])}const u=Math.max(c[0],c[1]),d=e.boundingInfo;if(d==null)return void this._intersectTriangles(l,c,n,s,o);const p=$b(d.bbMin[0]-u,d.bbMin[1]-u,d.bbMin[2]-u,d.bbMax[0]+u,d.bbMax[1]+u,d.bbMax[2]+u),m=[s[0]-n[0],s[1]-n[1],s[2]-n[2]],y=Math.sqrt(m[0]*m[0]+m[1]*m[1]+m[2]*m[2]),_=[y/m[0],y/m[1],y/m[2]];lX(p,n,_,r.tolerance)&&this._intersectTriangles(l,c,n,s,o)}_intersectTriangles(e,i,r,n,s){e.baked.size&&e.baked.size[0]===i[0]&&e.baked.size[1]===i[1]||e.baked.bake(i),e.baked.intersect(r,n,s)}createBufferWriter(){return new ZS(this._vertexBufferLayout)}produces(e,i){switch(i){case U.Shadow:case U.ShadowHighlight:case U.ShadowExcludeHighlight:if(!this.parameters.castShadows)return!1;case U.Color:case U.Alpha:case U.Depth:case U.Normal:case U.Highlight:case U.ObjectAndLayerIdColor:return e===(this.parameters.transparent?ae.TRANSPARENT_MATERIAL:ae.OPAQUE_MATERIAL)||e===ae.DRAPED_MATERIAL;default:return!1}}createGLMaterial(e){return new glt(e)}static getVertexBufferLayout(){return Ir().vec3f(O.POSITION).vec4f(O.PROFILERIGHT).vec4f(O.PROFILEUP).vec4f(O.PROFILEVERTEXANDNORMAL).vec4f(O.FEATUREVALUE)}},glt=class extends P_{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}_updateShadowState(e){this.technique!=null&&e.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:e.shadowMap.enabled})}beginSlot(e){return this._output!==U.Color&&this._output!==U.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(ESe,e)}},ylt=class extends flt{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}};const _lt=["polyline"];let vlt=class extends Qf{constructor(e,i,r,n){super(e,i,r,n),this._intrinsicSize=ri(1,1),this._upVectorAlignment=Ef.Path,this._stencilWidth=.1,this.usedMemory=0,this.ensureDrapedStatus(!1)}async doLoad(){const e=this.symbolLayer.width!=null?this.symbolLayer.width:this.symbolLayer.height,i=this.symbolLayer.height!=null?this.symbolLayer.height:e;this._vvConvertOptions=new IR({size:!0,color:!0,rotation:!1,opacity:!0},[1,1,1],[e,1,i],this._context.renderCoordsHelper.unitInMeters),this._fastUpdates=this._context.renderer?.visualVariables?.length>0?hS(this._context.renderer,this._vvConvertOptions):null;const r=this.symbolLayer.anchor||"center";this._upVectorAlignment=this.symbolLayer.profileRotation==="heading"?Ef.World:Ef.Path;const n=this.symbolLayer.profile||"circle";switch(n){default:case"circle":this._profile=Lat[r];break;case"quad":this._profile=Dat[r]}switch(this.symbolLayer.join){case"round":this._extruder=new M8(0,jwe);break;case"bevel":this._extruder=new M8(0,1);break;case"miter":this._extruder=new M8(.8*Math.PI,1);break;default:this._extruder=new wat}const s=this.symbolLayer.cap||"butt";switch(s){case"none":this._startCap=new bse,this._endCap=new bse;break;case"butt":default:this._startCap=new g$(this._profile,0),this._endCap=new g$(this._profile,0,!0);break;case"square":this._startCap=new g$(this._profile,-.5),this._endCap=new g$(this._profile,.5,!0);break;case"round":{const p=n==="quad";this._startCap=new wse({profile:this._profile,flip:!1,breakNormals:p,subdivisions:XG}),this._endCap=new wse({profile:this._profile,flip:!0,breakNormals:p,subdivisions:XG});break}}const o=this.symbolLayer?.material?.color,a=this._getCombinedOpacityAndColor(o),l=Xo(a),c=a[3],u=c<1||this.needsDrivenTransparentPass,d={diffuse:l,ambient:l,opacity:c,transparent:u,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:u||s==="none"?dr.None:dr.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(si(this._intrinsicSize,e,i),!YG(this._intrinsicSize[0])||!YG(this._intrinsicSize[1])))throw new W("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates?.visualVariables.size||Yl(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates){const p={...d,...this._fastUpdates.materialParameters,size:g0e(this._intrinsicSize)};this._materials[0]=new mlt(p)}else d.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,d.normalType=Ei.Compressed,this._materials[0]=new Jd(d);this._materials[0].setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials[0]=null,this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,_lt,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i),n=e.renderingInfo;return this._createAs3DShape(i,n,r,i.uid)}layerOpacityChanged(){const e=this.symbolLayer?.material?.color,i=this._getCombinedOpacity(e),r=i<1||this.needsDrivenTransparentPass;this._materials[0]?.setParameters({opacity:i,transparent:r})}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,g_)}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._materials[0]?.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables"||!dS(this._fastUpdates,i,this._vvConvertOptions))return Dn.RecreateSymbol;this._materials[0]?.setParameters(this._fastUpdates.materialParameters)}return Dn.FastUpdate}_getVertexData(e){let i=0;const r=e.paths,n=[],s=e.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const d of r)i+=d.length;const l=Vs(3*i);let c,u=0;for(const d of r){n.push({offset:u,numVertices:d.length});for(const p of d)l[u++]=p[0],l[u++]=p[1],l[u++]=e.hasZ?p[2]:0}return o==null||s.equals(o)||jr(l,s,0,l,o,0,i)?(o==null||o.equals(a)?c=A1e(l):(c=Vs(3*i),jr(l,o,0,c,a,0,i)),{pathVertexDataInfos:n,vertexDataES:l,vertexDataRS:c}):null}_createAs3DShape(e,i,r,n){this.usedMemory=0;const s=e.geometry,o=this._getVertexData(s);if(o==null)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(o.pathVertexDataInfos.length===0)return s.paths.length!==0&&s.paths.some(y=>y.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;const a=new Array,l=s.spatialReference,c=ds(),u=this._context.renderCoordsHelper,d=new eY(o.vertexDataES);for(const y of o.pathVertexDataInfos){const _=y.numVertices;if(_<2)continue;const v=y.offset;if(this._context.clippingExtent!=null&&(vr(c),Zc(c,o.vertexDataES,v,_),!Pd(c,this._context.clippingExtent)))continue;const w=new Array,x=v+3*_;for(let F=v;F<x;F+=3){d.offset=F;const D=xJe(d,this._context.elevationProvider,r,u);oe(gn,o.vertexDataRS[F],o.vertexDataRS[F+1],o.vertexDataRS[F+2]),u.setAltitude(gn,D),o.vertexDataRS[F]=gn[0],o.vertexDataRS[F+1]=gn[1],o.vertexDataRS[F+2]=gn[2],w.push(llt(this._upVectorAlignment))}const T=new _at(w,o.vertexDataES,o.vertexDataRS,v);OSe(T,this._upVectorAlignment,this._context.renderCoordsHelper);const S=new vat(T,this._profile,this._extruder,this._startCap,this._endCap);let E=null;if(this._fastUpdates){const F=this._fastUpdates.visualVariables,D=zd(F.size?.field,e)??0,$=zd(F.color?.field,e)??0,R=zd(F.opacity?.field,e)??0;E=new Eat(S,D,$,R)}else{const F=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const R=i.size;F[0]*=Ose(R[0],R[2]==="symbol-value"?this.symbolLayer.height||0:R[2],this.symbolLayer.width||0),F[1]*=Ose(R[2],R[0]==="symbol-value"?this.symbolLayer.width||0:R[0],this.symbolLayer.height||0)}let D;this._drivenProperties.color&&(D=i.color),this._drivenProperties.opacity&&i.opacity!=null&&(D=D?[D[0],D[1],D[2],i.opacity]:[1,1,1,i.opacity]);const $=new gSe(S);$.bake(F),D&&$.bakeVertexColors(D),E=$}const A=E.createGeometryData(),P=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),N=new Sat(this._materials[0],A,E,l,this._stencilWidth,P);N.transformation=yl(be(),zr,S.path.origin),a.push(N),this.usedMemory+=S.usedMemory}if(a.length===0)return null;const p=new Yg({geometries:a,layerUid:this._context.layer.uid,graphicUid:n}),m=new Kf(this,p,a,null,null,(y,_,v,w,x)=>wlt(y,_,w,x,this._upVectorAlignment),r);return m.alignedSampledElevation=0,m.needsElevationUpdates=g_(r.mode),m}};function OSe(t,e,i){const{origin:r,positions:n}=t;let s=t.offset;switch(e){default:case Ef.World:for(const o of t.vertices)gn[0]=n[s++]+r[0],gn[1]=n[s++]+r[1],gn[2]=n[s++]+r[2],i.worldUpAtPosition(gn,gn),o.setFrameFromUpVector(gn);break;case Ef.Path:gn[0]=n[s]+r[0],gn[1]=n[s+1]+r[1],gn[2]=n[s+2]+r[2],i.worldUpAtPosition(gn,gn),$at(t,gn)}}function Ose(t,e,i){switch(t){case"symbol-value":return i;case"proportional":return e;default:return t}}function blt(t,e,i,r){let n=0;const{origin:s,vertices:o,positions:a,positionsES:l}=t,c=t.offset+3*o.length;for(let u=t.offset;u<c;u+=3)oe(gn,l[u],l[u+1],l[u+2]),i(gn,D8),n+=D8.sampledElevation,gn[0]=a[u]+s[0],gn[1]=a[u+1]+s[1],gn[2]=a[u+2]+s[2],r.setAltitude(gn,D8.z),a[u]=gn[0]-s[0],a[u+1]=gn[1]-s[1],a[u+2]=gn[2]-s[2];return t.updatePathVertexInformation(),n/o.length}function wlt(t,e,i,r,n){const s=t.stageObject,o=s.geometries;let a=0;for(const l of o){if(!fSe(l))continue;const c=l.path,u=c.builder.path;a+=blt(u,e,i,r),n!==Ef.World&&OSe(u,n,r),c.onPathChanged(l),l.invalidateBoundingInfo(),s.geometryVertexAttributeUpdated(l,O.POSITION)}return a/o.length}const gn=C(),D8=new kR;function xlt(t,e,i,r,n=1){if(i.isGeographic&&r===Me.Global){const c=Vs(e.length),u=e.length,d=Fi(i);for(let p=0;p<u;p+=3)Dq(e,p,c,p,d);e=c}si(is,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let c=0;c<e.length;c+=3)is[0]=Math.min(is[0],e[c]),is[1]=Math.min(is[1],e[c+1]);const s=is[0]%n,o=is[1]%n,a=is[0]-s,l=is[1]-o;for(let c=0;c<e.length;c+=3){const u=c/3*4;t[u]=(e[c]-a)/n,t[u+1]=(e[c+1]-l)/n,t[u+2]=a/n,t[u+3]=l/n}}function RSe(t,e,i,r,n=1){oe(mv,1,0,0),oe(gv,0,1,0),oe(_x,0,0,1),Slt(N8,i),jUe(Rse,i)&&Tlt(Rse,mv,gv,_x,r,N8),si(is,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),si(yv,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let u=0;u<i.length;u+=3){oe(yx,i[u],i[u+1],i[u+2]);const d=me(mv,yx),p=me(gv,yx);is[0]=Math.min(is[0],d),is[1]=Math.min(is[1],p),yv[0]=Math.max(yv[0],d),yv[1]=Math.max(yv[1],p)}const s=me(_x,N8);k8(A0,is[0],is[1],s,mv,gv,_x),k8(_v,yv[0],is[1],s,mv,gv,_x),k8(vv,is[0],yv[1],s,mv,gv,_x),he(_v,_v,A0),te(_v,_v,.5),he(vv,vv,A0),te(vv,vv,.5),ce(A0,A0,_v),ce(A0,A0,vv);const o=is[0]%n,a=is[1]%n,l=is[0]-o,c=is[1]-a;for(let u=0;u<i.length;u+=3){oe(yx,i[u],i[u+1],i[u+2]);const d=u/3,p=4*d;t[p]=(me(mv,yx)-l)/n,t[p+1]=(me(gv,yx)-c)/n,t[p+2]=l/n,t[p+3]=c/n;const m=9*d;for(let y=0;y<3;y++)e[m+y]=A0[y],e[m+y+3]=_v[y],e[m+y+6]=vv[y]}}const N8=C(),yx=C(),Rse=Ti(),mv=C(),gv=C(),_x=C(),is=Ue(),yv=Ue(),A0=C(),_v=C(),vv=C();function Tlt(t,e,i,r,n,s){n!=null?(n.basisMatrixAtPosition(s,Sp),oe(_$,Sp[0],Sp[1],Sp[2]),oe(v$,Sp[4],Sp[5],Sp[6]),oe(F8,Sp[8],Sp[9],Sp[10])):(oe(_$,1,0,0),oe(v$,0,1,0),oe(F8,0,0,1));const o=t;me(o,F8)<0&&te(o,o,-1),se(r,o);const a=me(o,v$),l=me(o,_$);Math.abs(a)>Math.abs(l)?(dl(e,_$,o,-l),ge(e,e),nt(i,e,o),ge(i,i),te(i,i,-1)):(dl(i,v$,o,-a),ge(i,i),nt(e,i,o),ge(e,e))}const Sp=be(),_$=C(),v$=C(),F8=C();function Slt(t,e){oe(ZE,0,0,0);for(let i=0;i<e.length-3;i+=3)ZE[0]+=e[i],ZE[1]+=e[i+1],ZE[2]+=e[i+2];te(t,ZE,1/(e.length/3-1))}const ZE=C();function k8(t,e,i,r,n,s,o){oe(t,e*n[0]+i*s[0]+r*o[0],e*n[1]+i*s[1]+r*o[1],e*n[2]+i*s[2]+r*o[2])}function Elt(t){const e=new mi,{vertex:i,fragment:r,attributes:n,varyings:s}=e;tc(i,t),e.include(ml,t),e.include(gw,t),e.include(hg,t),e.include(DR,t),n.add(O.POSITION,"vec3"),t.vvColor&&n.add(O.COLORFEATUREATTRIBUTE,"float"),s.add("vColor","vec4"),s.add("vpos","vec3");const o=t.multipassEnabled&&(t.output===U.Color||t.output===U.Alpha);o&&s.add("depth","float"),i.uniforms.add(new ai("eColor",c=>c.color));const a=t.output===U.Depth;a&&(e.include(Mg,t),Ub(e),u_(e)),i.code.add(b`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${t.hasVertexColors?"vColor *= eColor;":t.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;"}
      ${o?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${a?b`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:b`transformPosition(proj, view, vpos);`}
    }
  `),e.include(vn,t),o&&e.include(uc,t),r.include(Jf);const l=t.output===U.Highlight;return l&&e.include(I_,t),r.code.add(b`
  void main() {
    discardBySlice(vpos);
    ${o?"terrainDepthTest(depth);":""}
    vec4 fColor = vColor;

    ${t.output===U.ObjectAndLayerIdColor?b`fColor.a = 1.0;`:""}

    if (fColor.a < ${b.float(co)}) {
      discard;
    }

    ${t.output===U.Alpha?b`fragColor = vec4(fColor.a);`:""}

    ${t.output===U.Color?b`fragColor = highlightSlice(fColor, vpos); ${t.transparencyPassType===Qe.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
    ${l?b`outputHighlight();`:""};
    ${t.output===U.Depth?b`outputDepth(linearDepth);`:""};
    ${t.output===U.ObjectAndLayerIdColor?b`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const Clt=Object.freeze(Object.defineProperty({__proto__:null,build:Elt},Symbol.toStringTag,{value:"Module"}));let PSe=class MSe extends Ci{initializeProgram(e){return new wi(e.rctx,MSe.shader.get().build(this.configuration),fi)}_createPipeline(e,i){const r=this.configuration,n=e===Qe.NONE,s=e===Qe.FrontFace;return Ot({blending:r.output!==U.Color&&r.output!==U.Alpha||!r.transparent?null:n?su:Wg(e),culling:CF(r.cullFace),depthTest:{func:L_(e)},depthWrite:(n||s)&&r.writeDepth?_l:null,colorWrite:Ft,stencilWrite:r.hasOccludees?Ff:null,stencilTest:r.hasOccludees?i?y_:D_:null,polygonOffset:n||s?r.polygonOffset?Alt:null:KF(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};PSe.shader=new bi(Clt,()=>pe(()=>import("./ColorMaterial.glsl-b384a239.js"),[],import.meta.url));const Alt={factor:1,units:1};let ro=class extends Ua{constructor(){super(...arguments),this.output=U.Color,this.cullFace=dr.None,this.transparencyPassType=Qe.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1}};h([V({count:U.COUNT})],ro.prototype,"output",void 0),h([V({count:dr.COUNT})],ro.prototype,"cullFace",void 0),h([V({count:Qe.COUNT})],ro.prototype,"transparencyPassType",void 0),h([V()],ro.prototype,"hasSlicePlane",void 0),h([V()],ro.prototype,"hasVertexColors",void 0),h([V()],ro.prototype,"transparent",void 0),h([V()],ro.prototype,"polygonOffset",void 0),h([V()],ro.prototype,"enableOffset",void 0),h([V()],ro.prototype,"writeDepth",void 0),h([V()],ro.prototype,"hasOccludees",void 0),h([V()],ro.prototype,"multipassEnabled",void 0),h([V()],ro.prototype,"cullAboveGround",void 0),h([V()],ro.prototype,"objectAndLayerIdColorInstanced",void 0),h([V()],ro.prototype,"vvColor",void 0),h([V({constValue:!1})],ro.prototype,"occlusionPass",void 0),h([V({constValue:!0})],ro.prototype,"hasVvInstancing",void 0),h([V({constValue:!1})],ro.prototype,"vvSize",void 0),h([V({constValue:!1})],ro.prototype,"vvOpacity",void 0);let Pse=class extends YX{constructor(e){super(e,new Rlt),this.supportsEdges=!0,this._configuration=new ro}getConfiguration(e,i){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._isTransparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<ZF,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}produces(e,i){return i===U.Color||i===U.Alpha||i===U.Highlight||i===U.Depth&&this.parameters.writeLinearDepth||i===U.ObjectAndLayerIdColor?e===ae.DRAPED_MATERIAL?!0:i===U.Highlight?e===ae.OPAQUE_MATERIAL:e===(this._isTransparent?this.parameters.writeDepth?ae.TRANSPARENT_MATERIAL:ae.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:ae.OPAQUE_MATERIAL):!1}createGLMaterial(e){return new Olt(e)}createBufferWriter(){const e=Ir().vec3f(O.POSITION);return ie("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(O.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(O.COLORFEATUREATTRIBUTE):e.vec4u8(O.COLOR),new ZS(e)}get _isTransparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}},Olt=class extends P_{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==U.Color&&this._output!==U.Alpha||this._updateOccludeeState(e),this.ensureTechnique(PSe,e)}},Rlt=class extends NR{constructor(){super(...arguments),this.color=ru,this.forceTransparentMode=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=dr.None,this.hasOccludees=!1}};var lo;(function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Cross=2]="Cross",t[t.ForwardDiagonal=3]="ForwardDiagonal",t[t.BackwardDiagonal=4]="BackwardDiagonal",t[t.DiagonalCross=5]="DiagonalCross",t[t.COUNT=6]="COUNT"})(lo||(lo={}));const wj=.70710678118,Mse=wj,Plt=.08715574274;function Mlt(t){const e=new mi,i=t.multipassEnabled&&(t.output===U.Color||t.output===U.Alpha),{vertex:r,fragment:n,attributes:s,varyings:o}=e;tc(r,t),e.include(ml,t),e.include(gw,t),e.include(hg,t),t.draped?r.uniforms.add(new Oe("worldToScreenRatio",(c,u)=>1/u.screenToPCSRatio)):s.add(O.BOUNDINGRECT,"mat3"),s.add(O.POSITION,"vec3"),s.add(O.UVMAPSPACE,"vec4"),t.vvColor&&s.add(O.COLORFEATUREATTRIBUTE,"float"),o.add("vColor","vec4"),o.add("vpos","vec3"),o.add("vuv","vec2"),i&&o.add("depth","float"),r.uniforms.add(new ai("uColor",c=>c.color));const a=t.style===lo.ForwardDiagonal||t.style===lo.BackwardDiagonal||t.style===lo.DiagonalCross;a&&r.code.add(b`
      const mat2 rotate45 = mat2(${b.float(wj)}, ${b.float(-Mse)},
                                 ${b.float(Mse)}, ${b.float(wj)});
    `),t.draped||(Xd(r,t),r.uniforms.add(new Oe("worldToScreenPerDistanceRatio",(c,u)=>1/u.camera.perScreenPixelRatio)),r.code.add(b`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),r.code.add(b`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),r.code.add(b`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${b.float(Plt)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),r.code.add(b`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${a?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${a?" * rotate45":""};

      ${t.draped?"":b`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${b.float(t.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);const l=t.output===U.Depth;return l&&(e.include(Mg,t),Ub(e),u_(e)),r.code.add(b`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${i?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      ${t.hasVertexColors?"vColor *= uColor;":t.vvColor?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      gl_Position = ${l?b`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:b`transformPosition(proj, view, vpos);`}
    }
  `),e.include(vn,t),n.include(Jf),t.draped&&n.uniforms.add(new Oe("texelSize",(c,u)=>1/u.camera.pixelRatio)),t.output===U.Highlight&&e.include(I_,t),i&&e.include(uc,t),t.output!==U.Highlight&&(n.code.add(b`
      const float lineWidth = ${b.float(t.lineWidth)};
      const float spacing = ${b.float(t.patternSpacing)};
      const float spacingINV = ${b.float(1/t.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),t.draped||n.code.add(b`const int maxSamples = 5;
float sampleAA(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),n.code.add(b`
    void main() {
      discardBySlice(vpos);
      ${i?"terrainDepthTest(depth);":""}
      vec4 color = vColor;
      color = highlightSlice(color, vpos);

      ${t.output!==U.Highlight?b`color.a *= ${$lt(t)};`:""}

      ${t.output===U.ObjectAndLayerIdColor?b`color.a = 1.0;`:""}

      if (color.a < ${b.float(co)}) {
        discard;
      }

      ${t.output===U.Alpha?b`fragColor = vec4(color.a);`:""}

      ${t.output===U.Color?b`fragColor = color; ${t.transparencyPassType===Qe.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
      ${t.output===U.Highlight?b`outputHighlight();`:""}
      ${t.output===U.Depth?b`outputDepth(linearDepth);`:""};
    }
  `),e}function $lt(t){function e(i){return t.draped?b`coverage(vuv.${i}, texelSize)`:b`sampleAA(vuv.${i})`}switch(t.style){case lo.ForwardDiagonal:case lo.Horizontal:return e("y");case lo.BackwardDiagonal:case lo.Vertical:return e("x");case lo.DiagonalCross:case lo.Cross:return b`
        1.0 - (1.0 - ${e("x")}) * (1.0 - ${e("y")})
      `;default:return"0.0"}}const Ilt=Object.freeze(Object.defineProperty({__proto__:null,build:Mlt},Symbol.toStringTag,{value:"Module"}));let $Se=class ISe extends Ci{initializeProgram(e){return new wi(e.rctx,ISe.shader.get().build(this.configuration),LSe)}_setPipelineState(e,i){const r=this.configuration,n=e===Qe.NONE,s=e===Qe.FrontFace;return Ot({blending:r.output===U.Color||r.output===U.Alpha?n?su:Wg(e):null,culling:CF(r.cullFace),depthTest:{func:L_(e)},depthWrite:n?r.writeDepth?_l:null:XF(e),colorWrite:Ft,stencilWrite:r.hasOccludees?Ff:null,stencilTest:r.hasOccludees?i?y_:D_:null,polygonOffset:n||s?r.polygonOffset?Llt:null:KF(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};$Se.shader=new bi(Ilt,()=>pe(()=>import("./Pattern.glsl-013e1cc9.js"),[],import.meta.url));const Llt={factor:1,units:1};let ms=class extends Ua{constructor(){super(...arguments),this.output=U.Color,this.cullFace=dr.None,this.transparencyPassType=Qe.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.multipassEnabled=!1,this.cullAboveGround=!1,this.vvColor=!1}};h([V({count:U.COUNT})],ms.prototype,"output",void 0),h([V({count:dr.COUNT})],ms.prototype,"cullFace",void 0),h([V({count:lo.COUNT})],ms.prototype,"style",void 0),h([V({count:Qe.COUNT})],ms.prototype,"transparencyPassType",void 0),h([V()],ms.prototype,"hasSlicePlane",void 0),h([V()],ms.prototype,"hasVertexColors",void 0),h([V()],ms.prototype,"polygonOffset",void 0),h([V()],ms.prototype,"writeDepth",void 0),h([V()],ms.prototype,"hasOccludees",void 0),h([V()],ms.prototype,"patternSpacing",void 0),h([V()],ms.prototype,"lineWidth",void 0),h([V()],ms.prototype,"enableOffset",void 0),h([V()],ms.prototype,"draped",void 0),h([V()],ms.prototype,"multipassEnabled",void 0),h([V()],ms.prototype,"cullAboveGround",void 0),h([V()],ms.prototype,"vvColor",void 0),h([V({constValue:!1})],ms.prototype,"occlusionPass",void 0),h([V({constValue:!1})],ms.prototype,"hasVvInstancing",void 0),h([V({constValue:!1})],ms.prototype,"vvSize",void 0),h([V({constValue:!1})],ms.prototype,"vvOpacity",void 0);const LSe=new Map([[O.POSITION,0],[O.COLOR,3],[O.UVMAPSPACE,4],[O.COLORFEATUREATTRIBUTE,5],[O.BOUNDINGRECT,6]]);let mZ=class extends YX{constructor(e){super(e,new Flt),this.supportsEdges=!0,this._vertexAttributeLocations=LSe,this._configuration=new ms}getConfiguration(e,i){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<ZF,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}produces(e,i){return i===U.Color||i===U.Alpha||i===U.Highlight||i===U.Depth&&this.parameters.writeLinearDepth?e===ae.DRAPED_MATERIAL?!0:i===U.Highlight?e===ae.OPAQUE_MATERIAL:e===(this.parameters.writeDepth?ae.TRANSPARENT_MATERIAL:ae.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):!1}createGLMaterial(e){return new Dlt(e)}createBufferWriter(){const e=Ir().vec3f(O.POSITION).vec4f(O.UVMAPSPACE);return this.parameters.draped||e.mat3f(O.BOUNDINGRECT),this.parameters.vvColor?e.f32(O.COLORFEATUREATTRIBUTE):e.vec4u8(O.COLOR),new Nlt(e)}},Dlt=class extends P_{_updateParameters(e){return this.ensureTechnique($Se,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==U.Color&&this._output!==U.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},Nlt=class extends ZS{write(e,i,r,n,s){for(const o of this.vertexBufferLayout.fields.keys()){const a=r.attributes.get(o),l=a?.indices;if(a&&l)switch(o){case O.UVMAPSPACE:{Ke(a.size===4);const c=n.getField(o,Zd);c&&pS(a,c,s);break}case O.BOUNDINGRECT:{Ke(a.size===9);const c=n.getField(o,h_);c&&this.writeBoundingRect(a,e,c,s);break}default:hwe(o,a,e,i,n,s)}}}writeBoundingRect(e,i,r,n){const{data:s,indices:o}=e,a=i,l=r.typedBuffer,c=r.typedBufferStride,u=o.length;n*=c;for(let d=0;d<u;++d){const p=9*o[d],m=s[p],y=s[p+1],_=s[p+2];l[n]=a[0]*m+a[4]*y+a[8]*_+a[12],l[n+1]=a[1]*m+a[5]*y+a[9]*_+a[13],l[n+2]=a[2]*m+a[6]*y+a[10]*_+a[14];for(let v=3;v<9;++v)l[n+v]=s[p+v];n+=c}}},Flt=class extends NR{constructor(){super(...arguments),this.color=Mt(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=dr.None,this.hasOccludees=!1,this.style=lo.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}};function klt(t,e){const i=t?.pattern??null;return i==null?new Pse(e):i.style==="none"||i.style==="solid"?(i.style==="none"&&(e.color=Mt(0,0,0,0),e.forceTransparentMode=!0),new Pse(e)):(e.style=Ult(i.style),new mZ(e))}function Ult(t){switch(t){case"horizontal":return lo.Horizontal;case"vertical":return lo.Vertical;case"cross":return lo.Cross;case"forward-diagonal":return lo.ForwardDiagonal;case"backward-diagonal":return lo.BackwardDiagonal;case"diagonal-cross":return lo.DiagonalCross;default:return}}function zlt(t){return t.material instanceof mZ&&!t.material.parameters.draped}function Blt(t,e){if(zlt(t)){const i=t.attributes.get(O.POSITION).data,r=t.getMutableAttribute(O.UVMAPSPACE).data,n=t.getMutableAttribute(O.BOUNDINGRECT).data;RSe(r,n,i,e)}}function Vlt(t,e,i,r,n){const s=Nwe(t,e,i,r,n),o=t.stageObject.geometries;for(const a of o)Blt(a,n);return s}const Glt=["polyline","polygon","extent"],$se=new IR({size:!1,color:!0,rotation:!1,opacity:!1});let DSe=class NSe extends Qf{constructor(e,i,r,n){super(e,i,r,n),this._needsUV=!1}async doLoad(){this._fastUpdates=hS(this._context.renderer,$se)}_createMaterials(){if(this._materials.length>0)return;const e=this.symbolLayer?.material?.color,i=this._getCombinedOpacityAndColor(e);this._materials[pn.Fill]=klt(this.symbolLayer,{color:i,forceTransparentMode:this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled,...this._fastUpdates?.materialParameters}),this._needsUV=this._materials[pn.Fill]instanceof mZ;const r=this.symbolLayer.outline;if(this._isValidOutline(r)){const n=STe(r.pattern);this._materials[pn.Outline]=new Y2({width:ra(r.size),color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:n,cap:fj(r.patternCap||"butt")})}this._context.stage.addMany(this._materials)}_isValidOutline(e){return e?.size!=null&&e.size>0&&e.color!=null&&(e.pattern==null||e.pattern.type!=="style"||e.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,Glt,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),n=this.setGraphicElevationContext(i);return this.ensureDrapedStatus(n.mode==="on-the-ground"),this._createMaterials(),this.draped?this._createAsOverlay(i,r):this._createAs3DShape(i,r,n)}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables"||!dS(this._fastUpdates,i,$se))return Dn.RecreateSymbol;this._materials[pn.Fill]?.setParameters(this._fastUpdates.materialParameters)}return Dn.FastUpdate}layerOpacityChanged(){if(this._materials[pn.Fill]!=null){const e=this._materials[pn.Fill].parameters.color,i=this.symbolLayer?.material?.color,r=this._getCombinedOpacity(i);this._materials[pn.Fill].setParameters({color:[e[0],e[1],e[2],r],forceTransparentMode:this.needsDrivenTransparentPass})}if(this._materials[pn.Outline]!=null){const e=this._materials[pn.Outline].parameters.color;this._materials[pn.Outline].setParameters({color:[e[0],e[1],e[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(e,i,r){const n=this._elevationContext.mode,s=FR(NSe.elevationModeChangeTypes,r,n);if(s!==an.UPDATE)return s;const o=xh(n);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){if(this._materials[pn.Fill]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._materials[pn.Outline]){const e={hasSlicePlane:this._context.slicePlaneEnabled};this._materials[pn.Outline].setParameters(e)}return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,i,r){const n=OO(e.geometry);if(!n)return null;const s=QX(n,this._context.elevationProvider,this._context.renderCoordsHelper,r),o=new jlt(s,i,this._context.layer.uid,e.uid),a=o.renderData.position.length/3;if(this._needsUV&&(o.uvMapSpace=Jr(4*a,!0),o.boundingRect=Vs(9*a,!0),RSe(o.uvMapSpace,o.boundingRect,o.renderData.position,this._context.renderCoordsHelper)),o.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(o),this._createAs3DShapeFill(e,o),this._materials[pn.Outline]&&this._createAs3DShapeOutline(o),this._logGeometryCreationWarnings(o.renderData,n.rings,"rings","FillSymbol3DLayer"),o.outGeometries.length===0)return null;const l=new Yg({geometries:o.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:e.uid}),c=new Kf(this,l,o.outGeometries,null,null,Vlt,r);return c.alignedSampledElevation=o.renderData.sampledElevation,c.needsElevationUpdates=xh(r.mode),c}_createAs3DShapeFill(e,i){const r=i.renderData.polygons;for(const{position:n,mapPositions:s,holeIndices:o,index:a,count:l}of r){if(this._context.clippingExtent!=null&&(vr(Bh),Zc(Bh,s),!Pd(Bh,this._context.clippingExtent)))continue;const c=Aet(s,o,this._context.elevationProvider.spatialReference);if(c.length===0)continue;const u=this._fastUpdates?.visualVariables.color,d=jre({material:this._materials[pn.Fill],indices:c,mapPositions:s,attributeData:{position:n,color:u?null:i.color,colorFeature:u?zd(u.field,e):null,uvMapSpace:this._needsUV?$N(i.uvMapSpace,4*a,4*l):null,boundingRect:this._needsUV?ah(i.boundingRect,9*a,9*l):null,objectAndLayerIdColor:i.objectAndLayerIdColor}});i.outGeometries.push(d)}}_createAs3DShapeOutline(e){if(this._materials[pn.Outline]==null)return;const i=e.renderData.outlines;for(const{mapPositions:r,position:n}of i){if(this._context.clippingExtent!=null&&(vr(Bh),Zc(Bh,r),!Pd(Bh,this._context.clippingExtent)))continue;const s=mj(this._materials[pn.Outline],{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:r,attributeData:{position:n}},e.objectAndLayerIdColor);e.outGeometries.push(s)}}_createAsOverlay(e,i){const r=OO(e.geometry);if(r==null)return null;this._materials[pn.Fill].renderPriority=this._renderPriority+this._renderPriorityStep/2,this._materials[pn.Outline]!=null&&(this._materials[pn.Outline].renderPriority=this._renderPriority);const n=sTe(r,this._context.overlaySR),s=new Hlt(n,i,this._context.layer.uid,e.uid),o=s.renderData.position.length/3;return this._needsUV&&(s.uvMapSpace=Jr(4*o,!0),xlt(s.uvMapSpace,s.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),s.outBoundingBox=vr(),s.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(s),this._createAsOverlayFill(e,s),this._materials[pn.Outline]&&this._createAsOverlayOutline(s),this._logGeometryCreationWarnings(s.renderData,r.rings,"rings","FillSymbol3DLayer"),s.outGeometries.length===0?null:new pk(this,s.outGeometries,s.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(e,i){const r=i.renderData.polygons;for(const{position:n,holeIndices:s,index:o,count:a}of r){const l=vr(Bh);if(Zc(l,n),!Pd(l,this._context.clippingExtent))continue;const c=gS(n,s,3);if(c.length===0)continue;ZT(i.outBoundingBox,l);const u=this._fastUpdates?.visualVariables.color,d=jre({material:this._materials[pn.Fill],indices:c,attributeData:{position:n,color:u?null:i.color,colorFeature:u?zd(u.field,e):null,uvMapSpace:this._needsUV?$N(i.uvMapSpace,4*o,4*a):null,objectAndLayerIdColor:i.objectAndLayerIdColor}});i.outGeometries.push(new _S(d,i))}}_createAsOverlayOutline(e){if(this._materials[pn.Outline]==null)return;const i=e.renderData.outlines;for(let r=0;r<i.length;++r){const{position:n}=i[r];if(vr(Bh),Zc(Bh,n),!Pd(Bh,this._context.clippingExtent))continue;ZT(e.outBoundingBox,Bh);const s=mj(this._materials[pn.Outline],{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:n}},e.objectAndLayerIdColor);e.outGeometries.push(new _S(s,e))}}_getOutlineOpacity(){const e=this.symbolLayer?.outline?.color;return(this.draped?1:this._getLayerOpacity())*(e!=null?e.a:0)}_getOutlineColor(){const e=this.symbolLayer?.outline?.color,i=this._getOutlineOpacity();return f3(e!=null?Ye.toUnitRGB(e):null,i)}test(){return{...super.test(),createAsOverlay:(e,i)=>this._createAsOverlay(e,i),createAs3DShape:(e,i,r)=>this._createAs3DShape(e,i,r)}}};DSe.elevationModeChangeTypes={definedChanged:an.RECREATE,staysOnTheGround:an.NONE,onTheGroundChanged:an.RECREATE};const Bh=ds();let jlt=class extends hk{constructor(e,i,r,n){super(e,r,n),this.color=i}},Hlt=class extends hk{constructor(e,i,r,n){super(e,r,n),this.color=i}};var pn;(function(t){t[t.Fill=0]="Fill",t[t.Outline=1]="Outline"})(pn||(pn={}));let FSe=class{constructor(e,i="center",r=!1,n=Ue(),s=Mt(0,0,0,-1),o="world",a=C(),l=0){this.verticalOffset=e,this.anchor=i,this.hasLabelVerticalOffset=r,this.screenOffset=n,this.centerOffset=s,this.centerOffsetUnits=o,this.translation=a,this.elevationOffset=l}},kSe=class{constructor(e,i="center",r="center",n=null,s=Ue()){this.placement=e,this.horizontalPlacement=i,this.verticalPlacement=r,this.text=n,this.displaySize=s}};const qlt="arial-unicode-ms",Ise="woff2",Lse=new Map,USe=new Set;let Wlt=class{constructor(e,i){this.fontFace=e,this.promise=i}};async function Ylt(t){const e=Jlt(t),i=Lse.get(e);if(i)return i.promise;const r=new FontFace(t.family,`url('${Oi.fontsUrl}/woff2/${e}.${Ise}') format('${Ise}')`,{style:t.style,weight:t.weight}),n=document.fonts;if(n.has(r)&&r.status==="loading")return r.loaded;const s=r.load().then(()=>(n.add(r),r));return Lse.set(e,new Wlt(r,s)),USe.add(r),s}function Xlt(t){return USe.has(t)}function Zlt(t){if(!t)return qlt;const e=t.toLowerCase().split(" ").join("-");switch(e){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return e}}function Jlt(t){const e=Klt(t)+Qlt(t);return Zlt(t.family)+(e.length>0?e:"-regular")}function Klt(t){if(!t.weight)return"";switch(t.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function Qlt(t){if(!t.style)return"";switch(t.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}let zSe=class BSe{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=this._colorToRGBA(e.color),this.haloStyle=this._colorToRGB(e.halo.color),this.backgroundStyle=e.background.color[3]!==0?this._colorToRGBA(e.background.color):null}fontString(e){const i=this.definition.font,r="sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji";return`${i.style} ${i.weight} ${e}px ${i.family}, ${r}`}setFontProperties(e,i){e.font=this.fontString(i),e.textAlign="left",e.textBaseline="alphabetic"}_colorToRGB(e){return`rgb(${e.slice(0,3).map(i=>Math.floor(255*i)).toString()})`}_colorToRGBA(e){return`rgba(${e.slice(0,3).map(i=>Math.floor(255*i)).toString()},${e[3]})`}static async fromSymbol(e,i){const r=e?.material?.color,n=Ye.toUnitRGBA(r)??ru,s=e.size!=null?ra(e.size):12,o=e.lineHeight,a=e.background!=null?Ye.toUnitRGBA(e.background.color):ru,l={family:e.font?.family??"sans-serif",decoration:e.font?.decoration??"none",weight:e.font?.weight??"normal",style:e.font?.style??"normal"},c=e.halo,u=c?.color!=null&&c.size>0?{size:ra(c.size),color:Ye.toUnitRGBA(c.color)}:{size:0,color:ru},d=new BSe({color:n,size:s,background:{color:a,padding:e.background!=null?[.65*s,.5*s]:[0,0],borderRadius:e.background!=null?s*(6/16):0},lineSpacingFactor:o,font:l,halo:u,pixelRatio:i});if(e.font){let p=!1;const m=d.fontString(s);try{p=(await document.fonts.load(m)).some(y=>!Xlt(y))}catch{ne.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${m}'. Some text symbology may be rendered using the default browser font.`)}if(!p&&!ect.has(e.font.family))try{await Ylt(e.font)}catch{}}return d}};const ect=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),O0=4096;let W1=class extends xe{constructor(e){super(e),this.type=on.Texture,this.id=Kc(),this.events=new Tn,this._glTexture=null,this._atlas=new rct(256,256),this._needsRepack=!1,this._canRepack=!0,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view._stage,this._stage.add(this),this._updateCanvasElementSize(this._atlas),this._reset()}unload(){this._glTexture=et(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get glTexture(){return this._glTexture}static get maxSize(){return A3=0,[O0-R0-A3,O0-R0-A3-Dse]}load(e){if(this._glTexture)return this._glTexture;const i=new Li;return i.wrapMode=Nt.CLAMP_TO_EDGE,i.samplingMode=Lt.LINEAR_MIPMAP_LINEAR,i.hasMipmap=!0,i.preMultiplyAlpha=!0,i.maxAnisotropy=e.parameters.maxMaxAnisotropy,this._glTexture=new Pt(e,i,this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(ut.TEXT_TEXTURE_ATLAS,this),this.setDirty(),this._glTexture}dispose(){this._elements.clear(),this._elementsToRender.clear(),this._frameWorker=pr(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=et(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(e){this._canvas.setAttribute("width",e.width.toString()),this._canvas.setAttribute("height",e.height.toString())}_resizeAtlas(e,i){const{width:r,height:n}=this._atlas;r===e&&n===i||(this._atlas.width=e,this._atlas.height=i,this._glTexture?.resize(e,i),this._glTexture?.updateData(0,0,0,r,n,this._canvas),this._updateCanvasElementSize(this._atlas),this._elements.forEach(s=>{this._stageObjects.get(s.textRenderer.key)?.forEach(a=>U8(a,s))}),this._reset())}_reset(){this._elementsToRender.clear(),this._atlas.reset(),this._needsRepack=!0,this.setDirty()}_addAtlasElement(e,i,r,n){const s=this._atlas;if(s.width<r||s.height<n)return!1;let o=s.cursors.get(n);if(!o){if(s.height<s.nextY+n)return!1;o=[new Nse(s.nextY)],s.cursors.set(n,o),s.nextY+=n}let a=o.find(l=>s.width>=l.x+r);if(a==null){if(s.height<s.nextY+n)return!1;a=new Nse(s.nextY),s.nextY+=n,o.push(a)}return e.setNewPosition(a),this._elements.set(i,e),this._elementsToRender.set(i,e),a.x+=r,!0}_ensureStageObjects(e){const i=this._stageObjects.get(e);if(i)return i;const r=new Set;return this._stageObjects.set(e,r),r}_addStageObject(e,i){this._ensureStageObjects(e).add(i)}_removeStageObject(e,i){this._stageObjects.get(e)?.delete(i)&&(i.geometries[0].setAttributeData(O.SIZE,[0,0]),i.geometryVertexAttributeUpdated(i.geometries[0],O.SIZE),this._elementsToRender.delete(e))}_processAddition(e){const i=e.textRenderer.key;if(this._needsRepack)return void this._elements.set(i,e);const r=this._atlas,n=e.textRenderer.renderedWidth,s=e.textRenderer.renderedHeight,o=n+R0,a=s+R0+Dse;if(!this._addAtlasElement(e,i,o,a)){if(this._canRepack)this._reset();else if(r.width<o){const l=Math.min(rb(Math.max(o,1.5*r.width)),O0);this._resizeAtlas(l,r.height)}else{const l=r.nextY+a,c=Math.min(rb(Math.max(l,1.5*r.height)),O0);if(c>r.height)this._resizeAtlas(r.width,c);else if(r.width<O0){const u=Math.min(rb(1.5*r.width),O0);this._resizeAtlas(u,r.height)}}this._elements.set(i,e)}}_renderElement(e){const i=e.commitNewPosition();this._ctx.clearRect(i[0]-R0,i[1]-R0,e.textRenderer.renderedWidth+2*R0,e.textRenderer.renderedHeight+2*R0),e.textRenderer.render(this._ctx,i[0],i[1]),this._stageObjects.get(e.textRenderer.key)?.forEach(n=>U8(n,e))}get running(){return this.updating}runTask(e){if(this._glTexture==null)return Lo.YIELD;for(;this._needsRepack&&(this._canRepack||this._atlas.height<O0&&this._atlas.height<O0);){this._canRepack=this._needsRepack=!1;const i=this._elements;this._elements=new Map,i.forEach(r=>this._processAddition(r)),e.madeProgress()}if(this._elementsToRender.size>0){for(const[i,r]of this._elementsToRender){if(e.done)break;this._renderElement(r),this._elementsToRender.delete(i),e.madeProgress()}this._glTexture.setData(this._canvas)}this.updating=this._elementsToRender.size>0}addTextTexture(e,i){const r=e.key;this._addStageObject(r,i);let n=this._elements.get(r);n==null&&(n=new ict(this._atlas,e),this._processAddition(n),this.setDirty()),tct(i,n),U8(i,n)}removeTextTexture(e,i){const r=e.key;if(!this._elements.get(r))return;this._removeStageObject(r,i);const n=this._stageObjects.get(r);n&&n.size!==0||this._elements.delete(r),n?.size===0&&this._stageObjects.delete(r),this._canRepack=!0}setDirty(){this._glTexture&&(this.updating=!0)}get test(){const{_elements:e,_stageObjects:i,_atlas:r}=this,n=this;return{elements:e,stageObjects:i,atlas:r,resizeAtlas:(s,o)=>n._resizeAtlas(s,o),run:s=>n.runTask(s)}}};function tct(t,e){t.geometries[0].setAttributeData(O.SIZE,[e.textRenderer.displayWidth,e.textRenderer.displayHeight]),t.geometryVertexAttributeUpdated(t.geometries[0],O.SIZE)}function U8(t,e){t.geometries[0].setAttributeData(O.UV0,e.uv),t.geometryVertexAttributeUpdated(t.geometries[0],O.UV0,!0)}h([f({constructOnly:!0})],W1.prototype,"view",void 0),h([f({type:Boolean})],W1.prototype,"updating",void 0),W1=h([z("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],W1);const R0=2,Dse=2;let ict=class{constructor(e,i){this._atlas=e,this.textRenderer=i,this._uv=Kt(),this._newPosition=[0,0]}get uv(){if(this._xOffset==null||this._yOffset==null)return ru;const{renderedWidth:e,renderedHeight:i}=this.textRenderer;return Mr(this._uv,this._xOffset/this._atlas.width,(this._yOffset+i)/this._atlas.height,(this._xOffset+e)/this._atlas.width,this._yOffset/this._atlas.height)}setNewPosition(e){this._newPosition[0]=e.x,this._newPosition[1]=e.y}commitNewPosition(){return this._xOffset=this._newPosition[0],this._yOffset=this._newPosition[1],this._newPosition}get xOffset(){return this._xOffset}get yOffset(){return this._yOffset}},rct=class{constructor(e,i){this.width=e,this.height=i,this.cursors=new Map,this.nextY=0}reset(){this.cursors.clear(),this.nextY=A3}},Nse=class{constructor(e){this.y=e,this.x=A3}},A3=0,nct=class{constructor(e,i,r){this._renderer=new gTe(e,i,r,W1.maxSize)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const e=u5(sct,this._renderer.renderedWidth,this._renderer.renderedHeight),i=e.getContext("2d");return i.save(),this._renderer.render(i,0,0),i.restore(),new yw(e,{wrap:{s:Nt.CLAMP_TO_EDGE,t:Nt.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0})}};const sct={canvas:null},oct=[0,0,1];let act=class extends Qf{constructor(e,i,r,n){super(e,i,r,n),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=QF(this.symbolLayer.size);if(e)throw new W("graphics3dtextsymbollayer:invalid-size",e)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await zSe.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const i=e.graphic,r=CO(i.geometry);if(r==null)return this.logger.warn(`unsupported geometry type for text symbol: ${i.geometry.type}`),null;const n=this.symbolLayer.text;if(n==null||n==="")return null;const s=yW(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(s!=null&&!Yge(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const{verticalAlignment:o}=this.symbolLayer,a=new FSe(s);unt(o,a.screenOffset);const l=new kSe(a,this.symbolLayer.horizontalAlignment,cnt(o));return this._createAs3DShape(i,r,n,l)}createLabel(e,i,r,n,s){const o=e.graphic,a=CO(o.geometry);if(a==null)return this.logger.warn(`unsupported geometry type for label: ${o.geometry.type}`),null;const l=i.text;return!l||/^\s+$/.test(l)?null:this._createAs3DShape(o,a,l,i,r,n,s)}setGraphicElevationContext(e,i,r=0){return super.setGraphicElevationContext(e,i),i.addOffsetRenderUnits(r),i}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,i){return Fse(e,i,(r,n)=>{this.updateGraphicElevationContext(n,r)}),an.UPDATE}slicePlaneEnabledChanged(e,i){return Fse(e,i,r=>{for(const n of r.stageObject.geometries)n.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return!1}updateGraphicElevationContext(e,i){const r=i.elevationContext;this.setGraphicElevationContext(e,r,i.metadata!=null?i.metadata.elevationOffset:0),i.needsElevationUpdates=xh(r.mode)||r.mode==="absolute-height"}_defaultElevationInfoNoZ(){return cct}_createAs3DShape(e,i,r,n,s=null,o=null,a=()=>n.placement.elevationOffset){const l=this.setGraphicElevationContext(e,new KN,n.placement.elevationOffset),c=e.geometry?.type==="polyline",u=e.uid;let d=null,p=null;if(o==null){const F=_Te(n.horizontalPlacement);d=new nct(r,F,this._textRenderParameters);let D=null;if(this._context.sharedResources.textures!=null){p=this._context.sharedResources.textures.fromData(d.key,()=>d.create()),p.texture.events.on("unloaded",()=>D?.release());const $=this._context.stage.renderView.textureRepository.acquire(p.texture.id);if($==null||dc($))return p.release(),null;D=$}}const m=lct(d,n),y={occlusionTest:!0,screenOffset:n.placement.screenOffset,anchorPosition:m,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:n.placement.centerOffsetUnits,drawInSecondSlot:!0};if(o?y.textureId=o.id:p&&(y.textureId=p.texture.id),n.placement.verticalOffset!=null){const{screenLength:F,minWorldLength:D,maxWorldLength:$}=n.placement.verticalOffset;y.verticalOffset={screenLength:ra(F),minWorldLength:D||0,maxWorldLength:$??1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:F,screenSizePerspectiveSettingsLabels:D}=this._context.sharedResources,$=mTe(this._textRenderParameters);y.screenSizePerspective=D.overrideFontHeight($.maxHeight),y.screenSizePerspectiveAlignment=F}c&&(y.shaderPolygonOffset=1e-4),y.hasSlicePlane=this._context.slicePlaneEnabled;const _=(F,D)=>{const $=JSON.stringify(D);let R=F.get($);return R==null&&(R=new fS(D),F.add($,R)),R},v=s?_(s,y):new fS(y),w=n.placement.translation,x=d?ri(d.displayWidth,d.displayHeight):Sg,T=n.placement.centerOffset,S=xG(v,oct,w,null,x,T,[0,0],null),E=PX(this._context,i,S,l,u);if(E==null)return null;const A=(F,D,$,R,k,B)=>{const j=a()||n.placement.elevationOffset,X=this.setGraphicElevationContext(e,D,j);return sb(F,X,$,R,k,B)},P=new Kf(this,E.object,[S],s==null?[v]:null,p,A,l);P.alignedSampledElevation=E.sampledElevation,P.needsElevationUpdates=xh(l.mode)||l.mode==="absolute-height",P.getScreenSize=(F=Ue())=>(F[0]=d?d.displayWidth:n.displaySize[0],F[1]=d?d.displayHeight:n.displaySize[1],F);const N=new Gwe(n.placement.elevationOffset,r);return P.metadata=N,EO(P,i,this._context.elevationProvider),P}};function Fse(t,e,i){t&&t.forEach(r=>{const n=e(r);n!=null&&i(n,r.graphic)})}function lct(t,e){if(e.verticalPlacement==="baseline"){const r=ont[e.horizontalPlacement],n=t!=null?t.baselineAnchorY:0;return ri(r,n)}const i=lnt(e.horizontalPlacement,e.verticalPlacement);return BL[i]}const cct={mode:"relative-to-ground",offset:0},uct={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},hct=["polyline","polygon","extent"];let xj=class u1 extends Qf{constructor(e,i,r,n){super(e,i,r,n)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,hct,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(i):this._createAs3DShape(i,r,i.uid)}ensureMaterial(){if(this._materials[0])return;const e=new Q2e,i=this.symbolLayer.color;i!=null&&(e.color=Ye.toUnitRGBA(i));const r=this._getCombinedOpacity(i,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],r],e.transparent=r<1||this.needsDrivenTransparentPass,e.waveDirection=this.symbolLayer.waveDirection!=null?u1.headingVectorFromAngle(this.symbolLayer.waveDirection):ri(0,0);const n=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,s=uct[n];e.waveStrength=s.waveStrength,e.waveTextureRepeat=s.textureRepeat,e.waveVelocity=s.waveVelocity,e.flowStrength=s.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.isDraped=this.draped,this._materials[0]=new K2e(e),this._context.stage.add(this._materials[0])}layerOpacityChanged(){if(this._materials[0]==null)return;const e=this._materials[0].parameters.color,i=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),r=i<1||this.needsDrivenTransparentPass;this._materials[0].setParameters({color:[e[0],e[1],e[2],i],transparent:r})}layerElevationInfoChanged(e,i,r){const n=this._elevationContext.mode,s=FR(u1.elevationModeChangeTypes,r,n);if(s!==an.UPDATE)return s;const o=xh(n);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,i,r){const n=OO(e.geometry);if(n==null)return null;const s=QX(n,this._context.elevationProvider,this._context.renderCoordsHelper,i),o=s.position.length/3,a=Vs(2*o);this._createUVCoordsFromVertices(a,s.mapPositions,o,this._context.elevationProvider.spatialReference);const l=new dct(s,a,this._context.layer.uid,e.uid);if(l.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(l),this._create3DShapeGeometries(l),this._logGeometryCreationWarnings(l.renderData,n.rings,"rings","WaterSymbol3DLayer"),l.outGeometries.length===0)return null;const c=new Yg({geometries:l.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:r}),u=new Kf(this,c,l.outGeometries,null,null,Nwe,i);return u.alignedSampledElevation=l.renderData.sampledElevation,u.needsElevationUpdates=xh(i.mode),u}_createUVCoordsFromVertices(e,i,r,n){const s=ua(n);mh(P0);for(let l=0;l<r;l++)si(kse,i[3*l],i[3*l+1]),wq(P0,kse);Tb(P0,P0,s);const o=P0[0]%u1.unitSizeOfTexture,a=P0[1]%u1.unitSizeOfTexture;b$[0]=P0[0]-o,b$[1]=P0[1]-a;for(let l=0;l<r;l++)e[2*l]=(i[3*l]*s-b$[0])/u1.unitSizeOfTexture,e[2*l+1]=(i[3*l+1]*s-b$[1])/u1.unitSizeOfTexture}_create3DShapeGeometries(e){const i=e.renderData.polygons,r=e.uvCoords;for(const{count:n,index:s,position:o,mapPositions:a,holeIndices:l}of i){if(this._context.clippingExtent!=null&&(vr(bv),Zc(bv,a),!Pd(bv,this._context.clippingExtent)))continue;const c=gS(a,l,3);if(c.length===0)continue;const u=ah(r,2*s,2*n),d=Hre({material:this._materials[0],indices:c,mapPositions:a,attributeData:{position:o,uv0:u}},e.objectAndLayerIdColor);e.outGeometries.push(d)}}_createAsOverlay(e){const i=OO(e.geometry);if(i==null)return null;this._materials[0].renderPriority=this._renderPriority;const r=sTe(i,this._context.overlaySR),n=r.position.length/3,s=Vs(2*n);this._createUVCoordsFromVertices(s,r.position,n,this._context.overlaySR);const o=new pct(r,s,this._context.layer.uid,e.uid);return o.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(o),o.outBoundingBox=vr(),this._createAsOverlayWater(o),this._logGeometryCreationWarnings(o.renderData,i.rings,"rings","WaterSymbol3DLayer"),o.outGeometries.length===0?null:new pk(this,o.outGeometries,o.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(e){const i=e.uvCoords,r=e.renderData.polygons;for(const{position:n,holeIndices:s,index:o,count:a}of r){if(vr(bv),Zc(bv,n),!Pd(bv,this._context.clippingExtent))continue;ZT(e.outBoundingBox,bv);const l=gS(n,s,3);if(l.length===0)continue;const c=ah(i,2*o,2*a),u=Hre({material:this._materials[0],indices:l,attributeData:{position:n,uv0:c}},e.objectAndLayerIdColor);e.outGeometries.push(new _S(u,e))}}static headingVectorFromAngle(e){const i=Ue(),r=C4(e);return i[0]=Math.sin(r),i[1]=Math.cos(r),i}test(){return{...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}};xj.unitSizeOfTexture=100,xj.elevationModeChangeTypes={definedChanged:an.RECREATE,staysOnTheGround:an.NONE,onTheGroundChanged:an.RECREATE};const b$=Ue(),P0=Gt(),kse=Ue(),bv=ds();let dct=class extends hk{constructor(e,i,r,n){super(e,r,n),this.uvCoords=i}},pct=class extends hk{constructor(e,i,r,n){super(e,r,n),this.uvCoords=i}};function fct(t,e,i,r){const n=gct[t.type]?.[e.type]||mct[e.type];return n?new n(t,e,i,r):(ne.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${e.type}`),null)}const mct={icon:pj,object:yat,line:ETe,path:vlt,fill:DSe,extrude:Qit,text:act,water:xj},gct={"mesh-3d":{fill:Lst}};let yct=class extends RX{set symbol(e){this._symbol=e,e.symbolLayers.forEach((i,r)=>{const n=this.symbolLayers[r];n!=null&&(n.symbol=e,n.symbolLayer=i)})}get symbol(){return this._symbol}constructor(e,i,r){super(i.schedule),this._symbol=e,this._context=i,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let i=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(i=this._backgroundLayers.concat(i));const r=i.length;for(;this.symbolLayers.length<i.length;)this.symbolLayers.push(null);this.symbolLayers.length=i.length;const n=[];for(let s=0;s<r;s++){const o=i.at(s);if(o.enabled===!1)continue;w$.renderPriority=1-(1+s)/r,w$.renderPriorityStep=1/r,w$.ignoreDrivers=o.ignoreDrivers;const a=fct(this.symbol,o,this._context,w$),l=eR(e,()=>{this.symbolLayers[s]=null,a.destroy()});l&&n.push(l),this.symbolLayers[s]=a}if(await b4(this.symbolLayers,async(s,o)=>{if(s!=null)try{await s.load(),this._extentPadding+=Math.max(this._extentPadding,s.extentPadding)}catch{this.symbolLayers[o]=null}}),n.forEach(s=>s.remove()),Et(e),this.symbolLayers.length&&!this.symbolLayers.some(s=>!!s))throw new Error}getSymbolLayerSize(e){const i=this.symbolLayers[e];return i!=null?i.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>e?.queryForSnapping)}createGraphics3DGraphic(e,i){const r=e.graphic,n=this.symbolLayers.map(o=>o?.createGraphics3DGraphic(e)??null),s=this._context.arcade||this._context.featureExpressionInfoContext?.arcade?.modules||null;return new eet(r,i||this,n,e.layer,s)}get complexity(){return OX(this.symbolLayers.map(e=>e!=null?e.complexity:null))}globalPropertyChanged(e,i){const r=this.symbolLayers.length;for(let n=0;n<r;n++){const s=this.symbolLayers[n],o=a=>{const l=a.layers[n];return l instanceof Kf?l:null};if(s!=null&&!s.globalPropertyChanged(e,i,o))return!1}return!0}applyRendererDiff(e,i){return this.loadStatus!==Vc.LOADED?Dn.RecreateSymbol:this.symbolLayers.reduce((r,n)=>r!==Dn.RecreateSymbol&&n!=null?Math.min(r,n.applyRendererDiff(e,i)):r,Dn.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===Vc.FAILED||e.diff.type!=="partial")return;const i=e.diff.diff;if(!i.symbolLayers||i.symbolLayers.type!=="partial")return;const r=i.symbolLayers.diff;this.symbolLayers.forEach((n,s)=>{if(n==null)return;const o=r[s];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};n.prepareSymbolLayerPatch(a),e.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,c)=>{const u=l.layers[s];u!=null&&a.graphics3DGraphicPatches.forEach(d=>d(u,c))})}})}updateGeometry(e,i){return this._updateGeometryOrTransform(e,(r,n)=>r.updateGeometry(n,i))}updateTransform(e,i,r,n){return this._updateGeometryOrTransform(e,(s,o)=>s.updateTransform(o,i,r,n))}_updateGeometryOrTransform(e,i){for(let r=0;r<this.symbolLayers.length;r++){const n=this.symbolLayers[r];if(n==null)continue;const s=e.layers[r];if(!s||!i(n,s))return!1}return!0}onRemoveGraphic(e){for(let i=0;i<this.symbolLayers.length;i++){const r=this.symbolLayers[i];if(r==null)continue;const n=e.layers[i];n!=null&&r.onRemoveGraphic(n)}}getFastUpdateStatus(){let e=0,i=0,r=0;return this.symbolLayers.forEach(n=>{n!=null&&(n.loadStatus===Vc.LOADING?e++:n.isFastUpdatesEnabled()?r++:i++)}),{loading:e,slow:i,fast:r}}async queryForSnapping(e,i,r,n){const s=this.symbolLayers.filter(ZO).filter(a=>a.queryForSnapping!=null).map(a=>a.queryForSnapping(e,i,r,n)),o=await Promise.all(s);return Et(n),o.flat()}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const e of this.symbolLayers)e?.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}};const w$=new tet;let _ct=class extends RX{constructor(e,i,r){super(i),this.symbol=e,this._convert=r,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const i=await this.symbol.fetchSymbol({signal:e});i.id=this.symbol.id,this.graphics3DSymbol=this._convert(i),this.graphics3DSymbol!=null&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.complexity:Txe}globalPropertyChanged(e,i){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.globalPropertyChanged(e,i)}applyRendererDiff(e,i){return this.graphics3DSymbol!=null?this.graphics3DSymbol.applyRendererDiff(e,i):Dn.RecreateSymbol}prepareSymbolPatch(e){this.graphics3DSymbol!=null&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,i){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.updateGeometry(e,i)}updateTransform(e,i,r,n){return this.graphics3DSymbol?.updateTransform(e,i,r,n)??!1}onRemoveGraphic(){}getFastUpdateStatus(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){this.graphics3DSymbol!=null&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}};function gZ(t){return t instanceof _ct?t.graphics3DSymbol:t instanceof yct?t:null}const $O=ne.getLogger("esri.views.3d.layers.graphics.labelPlacement");let vct=class{constructor(e,i,r,n=null){this.graphics3DGraphic=e,this.labelSymbol=i,this.labelClass=r,this.disablePlacement=n}};function Use(t){const e=Oct(t);if(e==null)return null;const i=bct(t,e);if(i==null)return null;const r=i.anchor,n=!!e.hasLabelVerticalOffset,s=e.verticalOffset;return xct(new FSe(s,r,n),i,t)}function bct(t,e){if(e.anchor)return e;const i=t.labelClass.labelPlacement,r=Id[i],n=r||g5(t);return i&&!r&&$O.warnOncePerTick(`the requested label placement '${i}' is currently unsupported in SceneView.`),wct(n,t)}function yZ(t){const e=t.graphics3DGraphic.graphics3DSymbol,i=gZ(e);return i!=null?i.symbol.symbolLayers.at(0):null}function wct(t,e){const i=e.graphics3DGraphic.graphic.geometry;if(i==null)return null;if(e.disablePlacement!=null)return e.labelClass.labelPlacement?($O.warnOncePerTick(zse(t?.placement,e.disablePlacement.logEntityDescription)),g5(e)):t;const r=i.type;switch(r){case"polyline":case"polygon":case"extent":case"multipoint":if(e.labelClass.labelPlacement)return $O.warnOncePerTick(zse(t?.placement,`'${r}' geometries`)),g5(e);break;case"point":case"mesh":return t}return t}function zse(t,e){return`the requested label placement '${t}' is currently unsupported for ${e} in SceneView.`}function g5(t){const e=t.graphics3DGraphic.graphic.geometry;if(e==null)return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:Gs,anchor:"center"};case"polygon":{const i=yZ(t);return i!=null&&i.type==="extrude"?Id["above-center"]:{placement:"center-center",normalizedOffset:Gs,anchor:"center"}}case"point":case"mesh":return Id["above-center"];default:return}}function xct(t,e,i){const r=i.graphics3DGraphic.graphic.geometry;if(r==null)return null;switch(r.type){case"point":Sct(t,e,i);break;case"polygon":Tct(t,e,i);break;case"mesh":_Z(t,e,i.graphics3DGraphic.layers[0])}const n=ent-h5;return t.screenOffset[0]+=n*e.normalizedOffset[0],t.screenOffset[1]+=n*e.normalizedOffset[1],t}function Tct(t,e,i){const r=yZ(i);if(r!=null)switch(r.type){case"extrude":{const n=i.graphics3DGraphic.layers[0];n!=null?(n.getBoundingBoxObjectSpace(O3),Rd(O3,t.translation),t.translation[2]=A_(O3)/2):oe(t.translation,0,0,0),_Z(t,e,n);break}}}function Sct(t,e,i){const r=yZ(i);if(r==null)return;const n=i.graphics3DGraphic.layers[0];switch(n!=null?n.getCenterObjectSpace(t.translation):oe(t.translation,0,0,0),r.type){case"icon":case"text":Ect(t,e,i,n);break;case"object":_Z(t,e,n)}}function Ect(t,e,i,r){const{graphics3DGraphic:n}=i,s=r!=null?r.getScreenSize():null;if(n.isDraped||s==null)t.hasLabelVerticalOffset||t.anchor==="center"||(Id[i.labelClass.labelPlacement]&&$O.warnOncePerTick(`the requested placement '${e.placement}' is currently unsupported for draped graphics`),t.anchor="center");else{const o=Cct(i);t.screenOffset[0]=s[0]/2*(e.normalizedOffset[0]-o[0]);const a=s[1]/2*(e.normalizedOffset[1]-o[1]);t.hasLabelVerticalOffset?(t.centerOffset[1]=a,t.centerOffsetUnits="screen"):t.screenOffset[1]=a}}function Cct(t,e=Rct){const{graphics3DGraphic:i}=t,r=i.layers[0],n=r?.stageObject.geometries[0].material??null;if(n&&n instanceof fS){const s=n.parameters.anchorPosition;e[0]=2*(s[0]-.5),e[1]=2*(s[1]-.5)}else e[0]=0,e[1]=0;return e}function _Z(t,e,i){const r=i!=null?i.getBoundingBoxObjectSpace(O3):O3,n=Ce(r[3]-r[0],r[4]-r[1],r[5]-r[2]),s=Math.sqrt(n[0]*n[0]+n[1]*n[1]);t.centerOffset[0]=s/2*e.normalizedOffset[0];const o=t.translation[2],a=n[2]/2*e.normalizedOffset[1];t.translation[2]=0,t.elevationOffset=o+a;const l=we(n);t.centerOffset[2]=l/2*e.normalizedOffset[2]}function Act(t){return t==="above-center"}function Oct(t){const e=t.labelClass.labelPlacement,{labelSymbol:i,graphics3DGraphic:r}=t,n=gZ(r.graphics3DSymbol),s=n?.symbol.type==="point-3d"?n.symbol:null,o=Id[e]||g5(t);return s!=null&&s.supportsCallout()&&s.hasVisibleVerticalOffset()&&!r.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:Bse(s.verticalOffset),anchor:null,normalizedOffset:null}:!i||!i.hasVisibleVerticalOffset()||s!=null&&s.supportsCallout()&&s.verticalOffset&&!r.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:o&&Act(o.placement)?{placement:"above-center",verticalOffset:Bse(i.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:($O.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null)}function Bse(t){const{screenLength:e,minWorldLength:i,maxWorldLength:r}=t;return{screenLength:e,minWorldLength:i,maxWorldLength:r}}const Id={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},Vse={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in Vse){const e=Vse[t],i=Id[t];e.forEach(r=>{Id[r]=i})}Object.freeze&&(Object.freeze(Id),Object.keys(Id).forEach(t=>{Object.freeze(Id[t]),Object.freeze(Id[t]?.normalizedOffset)}));const Rct=[0,0],O3=ds();let Gse=class{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,i){this._materials.set(e,i),this._stage.add(i)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}},jse=class{constructor(e,i){this.labelingContext=e,this.graphics3DGraphic=i,this.hasGraphics3DResources=!1,this.visible=!1,this.addedToTextureAtlas=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},Pct=class{constructor(e,i,r,n,s){this.labelClass=e,this.graphics3DSymbol=i,this.graphics3DCalloutSymbolLayer=r,this.textRenderParameters=n,this.labelFunction=s,this.calloutSymbolLayerIndex=0}},Mct=class{constructor(e,i,r,n,s,o,a,l){this.layer=i,this.graphics3DCore=r,this.scaleVisibility=n,this.emptySymbolLabelSupported=s,this.elevationInfoOverride=o,this.disablePlacement=a,this.active=l,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new T2e(e,{pickable:!0,disableOctree:!0},i.uid)}destroy(){this.stageLayer.destroy()}},h1=class extends xe{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this.addHandles([le(()=>this.view.state?.camera,()=>this.setDirty()),le(()=>this.view.state?.rasterPixelRatio,()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(ut.LABELER,this)]),this._textTextureAtlas=new W1({view:this.view}),this._hudMaterialCollection=new Gse(this.view._stage),this._calloutMaterialCollection=new Gse(this.view._stage)}dispose(){this.removeAllHandles(),this._textTextureAtlas=et(this._textTextureAtlas),this._hudMaterialCollection=et(this._hudMaterialCollection),this._calloutMaterialCollection=et(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear()}destroy(){this.dispose(),Vh.graphic=null,Vh.renderingInfo=null,Vh.layer=null}_activateLabelingContext(e){e.graphics.forEach((i,r)=>{const n=new jse(e,i);this._labels.set(r,n),e.labelsToInitialize.set(r,n),i.setVisibilityFlag(Us.LABEL,Ro.USER,!0)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((i,r)=>{i.setVisibilityFlag(Us.LABEL,Ro.USER,!1),this.setLabelGraphicVisibility(i,!1),this._labels.delete(r)}),e.active=!1}_addLabelTextureToAtlas(e){for(const i of e.graphics3DGraphic.labelLayers){if(!i._labelClass)continue;const r=e.textRenderers[i._labelIndex];r&&(this._textTextureAtlas.addTextTexture(r,i.stageObject),e.addedToTextureAtlas=!0)}}_removeLabelTextureFromAtlas(e){for(const i of e.graphics3DGraphic.labelLayers){if(!i._labelClass)continue;const r=e.textRenderers[i._labelIndex];r!=null&&(this._textTextureAtlas.removeTextTexture(r,i.stageObject),e.addedToTextureAtlas=!1)}}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),Lo.YIELD}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const i of this._labelingContexts)if(i.active)if(z8(i))this._dirty=!0;else if(B8(i.labelClassContexts)){if(i.labelClassContexts===null){this._deactivateLabelingContext(i);continue}this._createLabelClassContext(i),this._dirty=!0}else Hc(i.labelsToInitialize,(r,n)=>(this._ensureGraphics3DResources(r)&&(this._labels.set(n,r),this.deconflictor.setDirty(),e.madeProgress()),(r.visible&&r.textInitialized||!r.visible&&r.hasGraphics3DResources)&&(i.labelsToInitialize.delete(n),e.madeProgress()),e.done))&&(this._dirty=!0);this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){const i=e.labelClassAbortController?.signal;e.layer.when&&await e.layer.when(),Et(i),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const r=e.graphics3DCore,n=r.layer,s=n.labelingInfo?.filter(o=>!!o.symbol);!s||s.length===0||(await b4(s,async(o,a)=>{const l=o.symbol,c=gZ(r.getOrCreateGraphics3DSymbol(l));if(c==null)return void ne.getLogger(this).error("Failed to create Graphics3DSymbol for label");await c.load(),Et(i);let u=null;yW(l)&&l.hasVisibleCallout()&&(u=mQe(l,r.symbolCreationContext),await u.load(),Et(i));const d=await hh($we(o,e.layer.fieldsIndex,this.view.spatialReference));if(Et(i),d.ok===!0){const p=await this._createTextRenderParameters(c.symbol);Et(i),e.labelClassContexts[a]=new Pct(o,c,u,p,d.value)}else ne.getLogger(this).error(`Label expression failed to evaluate: ${d.error}`)}),Et(i))}async _createLabelClassContext(e){return e.labelClassPromise==null&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(i=>{if(Fn(i))throw i;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const i=e.symbolLayers.at(0);return i?.type!=="text"?null:zSe.fromSymbol(i,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(e){for(const r of e.labelClassContexts)--r.graphics3DSymbol.referenced;const i=e.labelClassAbortController;e.labelClassAbortController=new AbortController,nc(i),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,i,r,n,s,o){const a=new kSe(r,Vne(r.anchor),ant(r.anchor),e.text,ri(e.displayWidth,e.displayHeight));return Vh.graphic=i,Vh.renderingInfo=null,Vh.layer=n,s.createLabel(Vh,a,this._hudMaterialCollection,this._textTextureAtlas,()=>{const l=Use(o);return l?l.elevationOffset:null})}_createLineCalloutGraphic(e,i,r,n,s){Vh.graphic=e,Vh.layer=s;const o=n.screenOffset[0];return Vh.renderingInfo=new pQe(null,i,n.translation,n.centerOffset,o,n.centerOffsetUnits,n.elevationOffset,this._calloutMaterialCollection),r.createGraphics3DGraphic(Vh)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const i=e.graphics3DGraphic;if(i.destroyed)return!1;this._ensureTextTextureResources(e);const r=e.labelingContext,n=r.labelClassContexts;if(B8(n)||!r.emptySymbolLabelSupported&&i.layers.length===0)return!1;let s=!1;const o=i.graphic,a=r.layer,l=x$(r.layer);for(let c=0;c<n.length;c++){const u=e.textRenderers[c],d=e.textLabelPlacements[c];if(u==null||d==null)continue;const p=n[c],m=p.graphics3DSymbol,y=m.symbol&&m.symbol.type==="label-3d"?m.symbol:null,_=m.symbolLayers[0];if(!_)continue;_.setElevationInfoOverride(r.elevationInfoOverride);const v=new vct(i,y,p.labelClass),w=this._createTextSymbolGraphic(u,o,d,a,_,v);if(w==null)return!1;w._labelClass=p.labelClass,w._labelIndex=c,i.addLabelGraphic(w,r.stageLayer),i.deconflictionPriority=p.textRenderParameters?.definition.size??0,i.setVisibilityFlag(Us.LABEL,Ro.USER,l),i.setVisibilityFlag(Us.LABEL,Ro.SCALE_RANGE,!0),i.setVisibilityFlag(Us.LABEL,Ro.DECONFLICTION,!1),s=!0;const x=p.graphics3DCalloutSymbolLayer;if(x&&d.hasLabelVerticalOffset){x.setElevationInfoOverride(r.elevationInfoOverride);const T=this._createLineCalloutGraphic(o,y,x,d,a);T!=null&&(p.calloutSymbolLayerIndex=i.labelLayers.length,i.addLabelGraphic(T,r.stageLayer))}break}return r.scaleVisibility&&s&&r.scaleVisibility.updateGraphicLabelScaleVisibility(i),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const i=e.labelingContext.labelClassContexts;for(const r of e.graphics3DGraphic.labelLayers){if(r._labelClass==null)continue;i[r._labelIndex].graphics3DSymbol.symbolLayers[0]?.onRemoveGraphic(r)}e.graphics3DGraphic.deconflictionPriority=0,e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){if(e.textInitialized)return;const i=e.labelingContext,r=i.labelClassContexts;if(B8(r))return;const n=e.graphics3DGraphic.graphic;for(let s=0;s<r.length;s++){const o=r[s];if(e.textRenderers[s]=null,e.textLabelPlacements[s]=null,o?.textRenderParameters==null)continue;const a=o.labelFunction;let l;if(a.type==="arcade")try{const w=a.needsHydrationToEvaluate()?iJe(n,i.layer):n;l=a.evaluate(w)}catch{l=null}else l=a.evaluate(n);if(l==null||l===""||/^\s+$/.test(l))continue;const c=o.graphics3DSymbol,u=c.symbol?.type==="label-3d"?c.symbol:null;if(!c.symbolLayers[0])continue;const d=e.graphics3DGraphic,p=o.labelClass,m=i.disablePlacement,y=Use({graphics3DGraphic:d,labelSymbol:u,labelClass:p,disablePlacement:m});if(y==null)continue;const _=Vne(y.anchor),v=_Te(_);e.textRenderers[s]=new gTe(l,v,o.textRenderParameters,W1.maxSize),e.textLabelPlacements[s]=y}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,i){const r=i.graphic.uid;if(e.graphics.set(r,i),e.active){const n=new jse(e,i);this._labels.set(r,n),e.labelsToInitialize.set(r,n)}this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,i){const r=i.graphic.uid,n=this._labels.get(r);e.graphics.delete(r),n&&(this._destroyGraphic(n,r),e.labelsToInitialize.delete(r),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,i){this._labels.delete(i),e.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,i){if(!i)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const r of i){const n=e.graphics.get(r);n&&(this._removeGraphic(e,n),this._addGraphic(e,n))}}_globalPropertyChanged(e,i){for(const r of i.labelClassContexts){const n=new Map;i.graphics.forEach(o=>n.set(o.graphic.uid,o));const s=o=>o.labelLayers[0];if(r.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,n,s),r.graphics3DCalloutSymbolLayer){const o=a=>a.labelLayers[r.calloutSymbolLayerIndex];r.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,n,o)}}}_visibilityInfoChange(e){const i=x$(e.layer);i&&!e.active&&this._activateLabelingContext(e),!i&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((i,r)=>{const n=this._labels.get(r);n&&(this._destroyGraphic(n,r),n.visible=!1,e.labelsToInitialize.set(r,n))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const i of this._labelingContexts)if(i.graphics3DCore===e)return i;return null}addGraphicsOwner(e,i,r){const n=r&&r.emptySymbolLabelSupported||!1,s=r?.elevationInfoOverride||null,o=r?.disablePlacement||null;if(this._findLabelingContext(e))return;const a=e.layer,l=new Mct(this.view._stage,a,e,i,n,s,o,x$(a));return this._labelingContexts.push(l),this.setDirty(),{addGraphic:c=>this._addGraphic(l,c),removeGraphic:c=>this._removeGraphic(l,c),featureReductionChange:()=>{},layerLabelsEnabled:()=>x$(l.layer),labelingInfoChange:c=>this._labelingInfoChange(l,c),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),clear:()=>{}}}removeGraphicsOwner(e){const i=this._findLabelingContext(e);if(!i)return;const r=this._labelingContexts.indexOf(i);this._labelingContexts.splice(r,1),i.graphics.forEach(n=>this._removeGraphic(i,n)),i.destroy(),this.setDirty()}setLabelGraphicVisibility(e,i){const r=e.graphic.uid,n=this._labels.get(r);n&&n.visible!==i&&(i&&!n.addedToTextureAtlas?(this._addLabelTextureToAtlas(n),n.textInitialized||n.labelingContext.labelsToInitialize.set(r,n)):!i&&n.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(n),n.visible=i,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._dirty||this._textTextureAtlas?.updating||this.deconflictor.updating||this._labelingContexts.some(e=>z8(e))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((i,r)=>i+(z8(r)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function z8(t){return!!t.labelClassPromise&&!!t.labelClassAbortController}function B8(t){return!t||t.length===0}function x$(t){return t.labelsVisible===!0&&!!t.labelingInfo?.some(e=>!!e.symbol)}h([f({constructOnly:!0})],h1.prototype,"view",void 0),h([f({constructOnly:!0})],h1.prototype,"deconflictor",void 0),h([f()],h1.prototype,"_textTextureAtlas",void 0),h([f({type:Boolean,readOnly:!0})],h1.prototype,"updating",null),h1=h([z("esri.views.3d.layers.graphics.Labeler")],h1);const Vh=new fQe(null,null,null);let TA=class v2{constructor(e,i,r,n=null){this.lij=[0,0,0],this.extent=Gt(),this.resolution=0,this.loadPriority=0,this.measures={visibility:qo.VISIBLE_ON_SURFACE,screenRect:Gt(),distance:0,shouldSplit:!1},this.used=!1,n&&this.acquire(e,i,r,n)}acquire(e,i,r,n){this.tilingScheme=n,this.id=v2.id(e,i,r),this.lij[0]=e,this.lij[1]=i,this.lij[2]=r,n.getExtent(e,i,r,this.extent),this.resolution=n.resolutionAtLevel(e)}release(){this.tilingScheme=null}getChildren(e){const i=this.lij[0]+1,r=2*this.lij[1],n=2*this.lij[2];return e?(e[0].acquire(i,r,n,this.tilingScheme),e[1].acquire(i,r+1,n,this.tilingScheme),e[2].acquire(i,r,n+1,this.tilingScheme),e[3].acquire(i,r+1,n+1,this.tilingScheme),e):[new v2(i,r,n,this.tilingScheme),new v2(i,r+1,n,this.tilingScheme),new v2(i,r,n+1,this.tilingScheme),new v2(i,r+1,n+1,this.tilingScheme)]}copyMeasurementsFrom(e){this.measures.visibility=e.measures.visibility,this.measures.shouldSplit=e.measures.shouldSplit,this.measures.distance=e.measures.distance,xg(e.measures.screenRect,this.measures.screenRect)}static id(e,i,r){return`${e}/${i}/${r}`}};var qo;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",t[t.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(qo||(qo={}));const VSe=.5*Math.PI,$ct=VSe/Math.PI*180;let Ict=class{constructor(e){this._renderCoordsHelper=e.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:C(),direction:C()};for(let i=0;i<4;i++)this._extent[i]={origin:C(),direction:C(),cap:{next:null,direction:C()}},this._planes[i]=Ti();this._planes[ur.NEAR]=Ti(),this._planes[ur.FAR]=Ti(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,i,r,n=!0){const s=this._extent;this._toRenderBoundingExtent(e,i,r),ce(this._center.origin,s[0].origin,s[2].origin),te(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),n||te(this._center.direction,this._center.direction,-1);for(let o=0;o<4;o++){const a=s[o];this._renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=s[o===3?0:o+1];a.cap.next=l.origin,Ng(a.cap.direction,a.origin,l.origin),lO(a.direction,a.cap.direction,a.origin,this._planes[o]),n||te(a.direction,a.direction,-1)}lO(s[0].cap.direction,s[1].cap.direction,s[0].origin,this._planes[ur.NEAR]),n?QV(this._planes[ur.NEAR],this._planes[ur.FAR]):(uF(this._planes[ur.FAR],this._planes[ur.NEAR]),QV(this._planes[ur.NEAR],this._planes[ur.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=i,this._minGlobalAltitude=.9*Fi(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,i,r=!1){if(e==null)return!1;if(this._renderCoordsHelper.viewingMode===Me.Global){const s=this._maxSpanSpatialReference.isGeographic?$ct:VSe*i;if(this._maxSpan>s)return!0;if(e.altitude!=null&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(this._maxSpan===0){const s=this._extent[0];return!(r||!e.intersectsRay(pu(s.origin,s.direction)))}for(let s=0;s<this._extent.length;s++){const o=this._extent[s];if(!r&&e.intersectsRay(pu(o.origin,o.direction))||e.intersectsLineSegment(tb(o.origin,o.cap.next,Dct),o.cap.direction))return!0}const n=r?this._planes:this._planesWithoutFar;for(let s=0;s<e.lines.length;s++){const o=e.lines[s];if(vqe(n,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,i,r){xq(e,Gh),Gh[2]=r,ic(i,Gh,V8,this._renderCoordsHelper.spatialReference),qn(Hse,V8),vr(Ol);for(const{x0:s,x1:o,y0:a,y1:l}of Lct)for(let c=0;c<5;c++){const u=c/4;Gh[0]=_t(e[s],e[o],u),Gh[1]=_t(e[a],e[l],u),Gh[2]=r,Do(Gh,i,Gh,this._renderCoordsHelper.spatialReference),Fe(Gh,Gh,Hse),Yd(Ol,Gh)}oe(this._extent[0].origin,Ol[0],Ol[1],Ol[2]),oe(this._extent[1].origin,Ol[3],Ol[1],Ol[2]),oe(this._extent[2].origin,Ol[3],Ol[4],Ol[2]),oe(this._extent[3].origin,Ol[0],Ol[4],Ol[2]);for(let s=0;s<4;++s)Fe(this._extent[s].origin,this._extent[s].origin,V8)}_toRenderBoundingExtentLocal(e,i,r){oF(e,i,dm,this._renderCoordsHelper.spatialReference),oe(this._extent[0].origin,dm[0],dm[1],r),oe(this._extent[1].origin,dm[2],dm[1],r),oe(this._extent[2].origin,dm[2],dm[3],r),oe(this._extent[3].origin,dm[0],dm[3],r)}_toRenderBoundingExtent(e,i,r){switch(this._renderCoordsHelper.viewingMode){case Me.Global:this._toRenderBoundingExtentGlobal(e,i,r);break;case Me.Local:this._toRenderBoundingExtentLocal(e,i,r);break;default:this._renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(e){if(ir(e.planes[ur.NEAR],this._center.origin)<0&&me(this._center.direction,e.direction)<0)return!0;for(let i=0;i<4;i++){const r=this._extent[i];if(ir(e.planes[ur.NEAR],r.origin)<0&&me(r.direction,e.direction)<0)return!0}return!1}};const Lct=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],Gh=C(),V8=be(),Hse=be(),Ol=ds(),dm=Gt(),Dct=tp();let Nct=class{constructor(e){this._renderCoordsHelper=e,this._surfaceElevation=0,this._cache=new Map,this._frustum=new Ty(e),this._extendedFrustum=new Ty(e),this._intersector=new Ict({renderCoordsHelper:e}),this._renderCoordsHelper=e}begin(e,i){this._surfaceElevation=i,this._aboveGround=this._renderCoordsHelper.getAltitude(e.eye)>i,this._frustum.update(e),this._shortenFrustumFarPlane(this._frustum),this._updateExtendedFrustum(e)}end(){this._cache.clear()}calculate(e){if(this._allTilesInvisible)return qo.INVISIBLE;const i=this._renderCoordsHelper.viewingMode===Me.Global&&e.lij[0]>=Fct&&e.lij[0]<kct,r=this._getOrCalculateSingleTileVisibility(e,!i);return r!==qo.INVISIBLE&&i?this._calculateAggregatedChildrenVisibility(e):r}_shortenFrustumFarPlane(e){const i=Ty.nearFarLineIndices,r=e.mutablePoints;for(const n of i){const[s,o]=n,a=r[s],l=r[o];he(bc,l,a),te(bc,bc,zct),ce(r[o],a,bc)}e.updatePoints(r)}_calculateAggregatedChildrenVisibility(e){let i=qo.INVISIBLE;const r=this._cache.get(e.id);if(r!=null)return r;const n=Xse.acquire();e.getChildren(n);for(const s of n){const o=this.calculate(s);if(o!==qo.INVISIBLE&&(i=o,o===qo.VISIBLE_ON_SURFACE))break}return Xse.release(n),this._cache.set(e.id,i),i}_getOrCalculateSingleTileVisibility(e,i){const r=this._cache.get(e.id);if(r!=null)return r;const n=this._calculateSingleTileVisibility(e);return i&&this._cache.set(e.id,n),n}_calculateSingleTileVisibility(e){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===Me.Global&&e.lij[0]<Uct?this._calculateSingleTileVisibilitySided(e,!1)===qo.INVISIBLE?this._calculateSingleTileVisibilitySided(e,!0):void 0:this._calculateSingleTileVisibilitySided(e,this._aboveGround)}_calculateSingleTileVisibilitySided(e,i){this._intersector.update(e.extent,e.tilingScheme.spatialReference,this._surfaceElevation,i);const r=Fi(e.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._extendedFrustum,r)?this._intersector.isVisibleInFrustum(this._frustum,r,!0)?qo.VISIBLE_ON_SURFACE:qo.VISIBLE_WHEN_EXTENDED:qo.INVISIBLE}_updateExtendedFrustum(e){this._extendedFrustum.update(e),this._shortenFrustumFarPlane(this._extendedFrustum);const i=this._renderCoordsHelper.worldUpAtPosition(e.eye,bc);this._aboveGround||na(i,i);const r=xs(-me(i,e.viewForward));if(this._allTilesInvisible=r>(Math.PI+e.fovY)/2,this._allTilesInvisible||(this._hasExtendedFrustum=r>e.fovY/2,!this._hasExtendedFrustum))return;const n=this._extendedFrustumParameters(),s=this._extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=n.pointIndices[o],l=s[a],c=this._renderCoordsHelper.getAltitude(l);if(n.needsAltitudeAdjustment(c)){switch(this._renderCoordsHelper.worldUpAtPosition(l,bc),a){case We.FAR_BOTTOM_LEFT:case We.FAR_TOP_LEFT:case We.NEAR_BOTTOM_LEFT:case We.NEAR_TOP_LEFT:e7(this._extendedFrustum.planes[ur.LEFT],bc,bc);break;case We.FAR_BOTTOM_RIGHT:case We.FAR_TOP_RIGHT:case We.NEAR_BOTTOM_RIGHT:case We.NEAR_TOP_RIGHT:e7(this._extendedFrustum.planes[ur.RIGHT],bc,bc)}te(bc,bc,n.direction),this._renderCoordsHelper.intersectInfiniteManifold(pu(l,bc),n.zWithMargin,l)}}if(this._extendedFrustum.updatePoints(s),Ko(s[We.NEAR_BOTTOM_LEFT],s[We.NEAR_BOTTOM_RIGHT],s[We.NEAR_TOP_RIGHT],Wse),Ko(s[We.NEAR_BOTTOM_RIGHT],s[We.NEAR_TOP_RIGHT],s[We.NEAR_TOP_LEFT],Yse),me(Wse,Yse)<0){const o=this._extendedFrustum.mutablePoints;this._aboveGround?[o[We.NEAR_BOTTOM_LEFT],o[We.NEAR_BOTTOM_RIGHT]]=[o[We.NEAR_BOTTOM_RIGHT],o[We.NEAR_BOTTOM_LEFT]]:[o[We.NEAR_TOP_LEFT],o[We.NEAR_TOP_RIGHT]]=[o[We.NEAR_TOP_RIGHT],o[We.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const e=this._surfaceElevation-qse;return{zWithMargin:e,pointIndices:Ty.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:i=>i>e}}_extendedFrustumParametersBelowSurface(){const e=this._surfaceElevation+qse;return{zWithMargin:e,pointIndices:Ty.planePointIndices.top,direction:1,needsAltitudeAdjustment:i=>i<e}}};const Fct=2,kct=6,Uct=12,zct=.95,qse=1,bc=C(),Wse=Ti(),Yse=Ti(),Xse=new aa(Array,t=>{t.length!==4&&(t[0]=new TA,t[1]=new TA,t[2]=new TA,t[3]=new TA)},t=>{t[0].release(),t[1].release(),t[2].release(),t[3].release()});let Bct=class{constructor(e){this._camera=new ht,this._focusOnMap=[0,0],this._screenRect=Gt(),this._tileSize=e.tileSize,this._renderCoordsHelper=e.renderCoordsHelper,this._tilingScheme=e.tilingScheme,this._visibility=new Nct(e.renderCoordsHelper)}begin(e,i,r){this._camera.copyFrom(e),this._surfaceElevation=r,this._focusOnMap[0]=i.x,this._focusOnMap[1]=i.y,bq(0,0,e.fullWidth,e.fullHeight,this._screenRect),this._visibility.begin(this._camera,r)}end(){this._visibility.end()}updateTile(e){e.measures.visibility=this._visibility.calculate(e),e.measures.distance=hDe(e.extent,this._focusOnMap),e.measures.visibility!==qo.INVISIBLE&&this._updateScreenMeasure(e)}_updateScreenMeasure(e){const i=Vct,r=1<<i,n=e.measures.screenRect;mh(n);let s=0;const o=e.lij[0]+i,a=e.lij[1]<<i,l=e.lij[2]<<i,c=this._tileSizeWithBias(e),u=c*c;for(let d=0;d<r;d++)for(let p=0;p<r;p++)if(s+=this._computeScreenArea(e,o,a+d,l+p,n),s>u)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}_tileSizeWithBias(e){return e.measures.visibility===qo.VISIBLE_WHEN_EXTENDED?this._tileSize*Gct:this._tileSize}_computeScreenArea(e,i,r,n,s){const o=e.measures.visibility===qo.VISIBLE_WHEN_EXTENDED;this._projectToScreen(i,r,n,o,M0),mh(G8);for(let a=0;a<4;a++)wq(G8,M0[a]);return Hy(s,G8,s),kte(M0[0],M0[1],M0[2])+kte(M0[0],M0[2],M0[3])}_projectToScreen(e,i,r,n,s){this._tilingScheme.ensureMaxLod(e),this._tilingScheme.getExtent(e,i,r,JE),this._toRenderCoords(JE,0,3,$0[0]),this._toRenderCoords(JE,2,3,$0[1]),this._toRenderCoords(JE,2,1,$0[2]),this._toRenderCoords(JE,0,1,$0[3]),n&&(this._projectToPlane($0,this._camera.frustum[ur.NEAR]),this._projectToPlane($0,this._camera.frustum[ur.TOP]),this._projectToPlane($0,this._camera.frustum[ur.BOTTOM]));for(let o=0;o<4;o++)this._camera.projectToRenderScreen($0[o],Zse),this._camera.renderToScreen(Zse,s[o])}_projectToPlane(e,i){for(let n=0;n<4;n++)QE[n]=ir(i,e[n]);const r=Math.max(QE[0],QE[1],QE[2],QE[3]);if(r>0){const n=te(KE,i,-r);for(let s=0;s<4;s++)ce(e[s],e[s],n)}}_toRenderCoords(e,i,r,n){return KE[0]=e[i],KE[1]=e[r],KE[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(KE,this._tilingScheme.spatialReference,n),n}};const G8=Gt(),Vct=2,Gct=5,M0=[Zr(),Zr(),Zr(),Zr()],JE=Gt(),KE=C(),$0=[C(),C(),C(),C()],QE=[0,0,0,0],Zse=Mo();function O4t(t,e,i){if(t==null||i==null)return!1;let r=!0;return ts[0]=t.xmin!=null?t.xmin:0,ts[1]=t.ymin!=null?t.ymin:0,ts[2]=t.zmin!=null?t.zmin:0,r=r&&jr(ts,t.spatialReference,0,e,i,0,1),ts[0]=t.xmax!=null?t.xmax:0,ts[1]=t.ymax!=null?t.ymax:0,ts[2]=t.zmax!=null?t.zmax:0,r=r&&jr(ts,t.spatialReference,0,e,i,3,1),t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.zmin==null&&(e[2]=-1/0),t.xmax==null&&(e[3]=1/0),t.ymax==null&&(e[4]=1/0),t.zmax==null&&(e[5]=1/0),r}function GSe(t,e,i){if(t==null||i==null)return!1;let r=!0;return ts[0]=t.xmin!=null?t.xmin:0,ts[1]=t.ymin!=null?t.ymin:0,ts[2]=t.zmin!=null?t.zmin:0,r=r&&jr(ts,t.spatialReference,0,ts,i,0,1),e[0]=ts[0],e[1]=ts[1],ts[0]=t.xmax!=null?t.xmax:0,ts[1]=t.ymax!=null?t.ymax:0,ts[2]=t.zmax!=null?t.zmax:0,r=r&&jr(ts,t.spatialReference,0,ts,i,0,1),e[2]=ts[0],e[3]=ts[1],t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.xmax==null&&(e[2]=1/0),t.ymax==null&&(e[3]=1/0),r}const ts=C();let so=class extends xe{get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(e!=null&&!e.spatialReference.equals(this.viewState.spatialReference))return void ne.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const i=this._get("filterExtent");if(i===e||i!=null&&e&&i.equals(e))return;const r=e!=null?e.clone():null;this._set("filterExtent",r),this._setDirty()}get _filterExtentRect(){if(this.filterExtent==null)return null;const e=Gt();return GSe(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(e){super(e),this.tiles=new ft,this.tileSize=512,this._idToTile=new Map,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new It}initialize(){this.addHandles([le(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),qi),le(()=>[this.tileSize,this.cameraOnSurface?.location,this.tilingScheme,this.viewState?.contentCamera,this.focus?.location],()=>this._setDirty(),Yi)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(ut.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=pr(this._frameWorker)}addClient(){const e=Kc();return this._clients.add(e),this._clients.size===1&&this._setDirty(),Mi(()=>this._removeClient(e))}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(Da))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),this._frameWorker!=null&&(this._frameWorker.priority=ut.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),this._pendingTiles||this._frameWorker==null||(this._frameWorker.priority=ut.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new Bct({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:e}=this;return this._rootTileIds.map(i=>new TA(i[0],i[1],i[2],e))}_purgeHorizonTiles(e){e.sort((i,r)=>{const n=i.measures.screenRect,s=r.measures.screenRect;return n[1]+n[3]-(s[1]+s[3])}),mh(T$);for(let i=0;i<e.length;i++)if(Hy(T$,e.data[i].measures.screenRect,T$),pl(T$)>jct)return e.data.slice(i,e.length);return[]}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:i}=this;for(;this._pendingTiles.length>0&&!e.done;){const r=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!k4(this._filterExtentRect,r.extent)||(this._tileMeasurements.updateTile(r),r.measures.visibility!==qo.INVISIBLE&&(r.measures.shouldSplit?(i.ensureMaxLod(r.lij[0]+1),this._pendingTiles.push(...r.getChildren())):this._newTiles.push(r)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const n of this.tiles.items)n.used=!1;const i=e.filter(n=>{const s=this._idToTile.get(n.id);return s?(s.copyMeasurementsFrom(n),s.used=!0):this._idToTile.set(n.id,n),!s}),r=this.tiles.items.filter(n=>!n.used&&(this._idToTile.delete(n.id),!0));this.tiles.removeMany(r),this.tiles.addMany(i),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,i)=>e.measures.visibility!==i.measures.visibility?e.measures.visibility===qo.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-i.measures.distance),this.tiles.forEach((e,i)=>e.loadPriority=i)}};h([f({constructOnly:!0})],so.prototype,"scheduler",void 0),h([f({constructOnly:!0})],so.prototype,"renderCoordsHelper",void 0),h([f({constructOnly:!0})],so.prototype,"tilingSchemeOwner",void 0),h([f({constructOnly:!0})],so.prototype,"cameraOnSurface",void 0),h([f({constructOnly:!0})],so.prototype,"focus",void 0),h([f({constructOnly:!0})],so.prototype,"viewState",void 0),h([f({constructOnly:!0})],so.prototype,"terrain",void 0),h([f()],so.prototype,"tiles",void 0),h([f()],so.prototype,"tileSize",void 0),h([f({readOnly:!0})],so.prototype,"tilingScheme",null),h([f()],so.prototype,"filterExtent",null),h([f({readOnly:!0})],so.prototype,"_filterExtentRect",null),h([f({readOnly:!0})],so.prototype,"_rootTileIds",null),h([f({value:!1})],so.prototype,"suspended",null),h([f({readOnly:!0})],so.prototype,"updating",null),so=h([z("esri.views.3d.layers.support.FeatureTileTree3D")],so);const T$=Gt(),jct=10;let rn=class extends xe{constructor(){super(...arguments),this._propertiesPool=new Og({camera:ht},this),this._lastSeenCameraProjectionValues=new ht,this.mode=Si.ANIMATING,this._cssCamera=new ht,this._camera=new ht,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new Tn,this.viewingMode=Me.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,i){this._set("viewingMode",e),this._set("spatialReference",i),this._set("constraints",new Im({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new Og({camera:ht},this)}destroy(){this.cameraController=null,this._propertiesPool?.destroy(),this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===Me.Global){const e=Fi(this.spatialReference).radius;this.camera=new ht({eye:Ce(4*e,0,0),center:Ce(e,0,0),up:Ce(0,0,1)})}else this.camera=new ht({eye:Ce(0,0,100),center:Ce(0,0,0),up:Ce(0,1,0)})}get animation(){return this.cameraController instanceof bO&&this.cameraController.viewAnimation!=null?this.cameraController.viewAnimation:null}get camera(){return this._camera}get cssCamera(){const e=this._cssCamera.copyFrom(this.camera),{height:i,width:r,pixelRatio:n}=this.camera;return e.pixelRatio=1,e.height=Math.round(i/n),e.width=Math.round(r/n),e}set camera(e){e!==Pu&&Pu.copyFrom(e),Pu.computeUp(this.viewingMode),this.events.emit("before-camera-change",Pu);const i=this._camera;if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,Pu)&&(this._lastSeenCameraProjectionValues.copyFrom(Pu),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),!i.equals(Pu)&&(this._camera=this._propertiesPool.get("camera").copyFrom(Pu),this._cameraChanged=!i.almostEquals(Pu),this._cameraChanged)){const r=vhe(()=>{this._cameraChanged=!1,r.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===Si.IDLE}get updating(){return this.mode!==Si.IDLE}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(e){this._contentCamera=e!=null?e.clone():null}get fixedContentCamera(){return this._contentCamera!=null}get isGlobal(){return this.viewingMode===Me.Global}get isLocal(){return this.viewingMode===Me.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(this.cameraController?.destroy(),e&&(this.removeHandles(Jse),this.addHandles(ac(()=>e.state===Wr.Finished||e.state===Wr.Stopped,()=>{this._set("cameraController",null),this.updateCamera(i=>e.onControllerEnd(i))},{sync:!0,once:!0}),Jse),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=Wr.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==Wr.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();Pu.copyFrom(this._get("camera")),e(Pu),this.camera=Pu,this._processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,i){return e.fov!==i.fov||e.fullViewport[0]!==i.fullViewport[0]||e.fullViewport[1]!==i.fullViewport[1]||e.fullViewport[2]!==i.fullViewport[2]||e.fullViewport[3]!==i.fullViewport[3]||e.padding[Xt.TOP]!==i.padding[Xt.TOP]||e.padding[Xt.RIGHT]!==i.padding[Xt.RIGHT]||e.padding[Xt.BOTTOM]!==i.padding[Xt.BOTTOM]||e.padding[Xt.LEFT]!==i.padding[Xt.LEFT]}};h([f()],rn.prototype,"mode",void 0),h([f({readOnly:!0,type:sS})],rn.prototype,"animation",null),h([f({type:ht})],rn.prototype,"camera",null),h([f({type:ht})],rn.prototype,"cssCamera",null),h([f()],rn.prototype,"_cssCamera",void 0),h([f()],rn.prototype,"_camera",void 0),h([f({readOnly:!0})],rn.prototype,"pixelRatio",null),h([f()],rn.prototype,"rasterPixelRatio",void 0),h([f()],rn.prototype,"contentPixelRatio",void 0),h([f({readOnly:!0})],rn.prototype,"alignPixelEnabled",null),h([f({readOnly:!0})],rn.prototype,"updating",null),h([f({})],rn.prototype,"_contentCamera",void 0),h([f({type:ht})],rn.prototype,"contentCamera",null),h([f({readOnly:!0})],rn.prototype,"fixedContentCamera",null),h([f({readOnly:!0})],rn.prototype,"constraints",void 0),h([f({readOnly:!0})],rn.prototype,"events",void 0),h([f({readOnly:!0})],rn.prototype,"isGlobal",null),h([f({readOnly:!0})],rn.prototype,"isLocal",null),h([f({readOnly:!0})],rn.prototype,"viewingMode",void 0),h([f({readOnly:!0})],rn.prototype,"spatialReference",void 0),h([f()],rn.prototype,"navigating",null),h([f()],rn.prototype,"stationary",null),h([f()],rn.prototype,"_cameraChanged",void 0),h([f()],rn.prototype,"cameraController",null),rn=h([z("esri.views.3d.state.ViewState")],rn);const Hct=rn,Pu=new ht,Jse="ViewStateHandles";let qct=class{constructor(e,i,r){this.viewingMode=e,this._forEachLayer=i,this._view=r,this._externalIntersectionHandlers=new It,this._tolerance=rS,this._tmpRay=_s(),this._tmpRegion=Gt(),this._validateHUDIntersector=_h(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,i,r){return this.intersectRay(this._getPickRay(e,this._tmpRay),Kse(this.viewingMode),i,r)}intersectScreenFreePointFallback(e,i,r){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),i,r)}intersectRayFreePointFallback(e,i,r){return this.intersectRay(e,Kse(this.viewingMode),i,r)||this._intersectRayFreePointLocal(e,i)}intersectRay(e,i,r,n){return i.options.selectionMode=!1,i.options.store=ho.MIN,this.computeIntersection(e,i,n),!!i.results.min&&i.results.min.getIntersectionPoint(r)}getCenterRayWithSubpixelOffset(e,i,r=.5,n=.5){return e.getRenderCenter(C$,r,n),C$[0]+=.0466,C$[1]-=.0123,YY(e,C$,i)}intersectIntersectorScreen(e,i,r){this.computeIntersection(this._getPickRay(e,this._tmpRay),i,r)}intersectToolIntersectorScreen(e,i,r){const n=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(n,i,r)}intersectToolIntersectorRay(e,i,r){i.options.selectionMode=!0,this.computeIntersection(e,i,r);const n=i.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||ip(n)&&n.intersector!==Ur.TERRAIN||(i.options.selectionMode=!1,this.computeIntersection(e,i,r))}setTolerance(e=rS){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((i,r)=>i.type===Ur.TERRAIN?1:r.type===Ur.TERRAIN?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((i,r)=>i.type===Ur.TERRAIN?1:r.type===Ur.TERRAIN?-1:0)}_getPickRay(e,i){const r=this._view.state.camera;return WY(r,e,i)}_intersectRayFreePointLocal(e,i){return this.viewingMode!==Me.Local||e==null||ce(i,e.origin,ge(Le.get(),e.direction)),!1}intersectElevationFromScreen(e,i,r=0,n=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),i,r,n)}_intersectElevation(e,i,r=0,n=null){if(e==null)return null;const s=i!=null?i.mode:"absolute-height",o=i?.offset??0,a=s!=="on-the-ground"?o+r:0,l=a/this._view.renderCoordsHelper.unitInMeters;if(s==="absolute-height"){if(this._view.renderCoordsHelper.intersectInfiniteManifold(e,a,E$)){const x=this._view.computeMapPointFromVec3d(E$);return x.z??(x.z=0),x.z-=o,x}return null}const c=this._view.state.camera,u=Le.get();c.projectToRenderScreen(e.origin,u);const d=new Qse(null,this._forEachLayer),p=this._view.slicePlane,m=p!=null?yee(p):null,y=_h(this.viewingMode);y.options.store=ho.MIN,y.options.verticalOffset=l;const _=e.origin,v=ce(Le.get(),_,e.direction);y.reset(_,v,c),y.point=u;const w=n?"type"in n&&n.type==="graphics"?x=>x.layerUid!==n.uid:x=>x.graphicUid!==n.uid:null;switch(s){case"relative-to-scene":{const x=T=>(!w||w(T))&&!!T.lastValidElevationBB;y.intersect(d.layers,u,this._tolerance,null,x),this._externalIntersectionHandlers.forAll(T=>{if(T.type===Ur.I3S||T.type===Ur.TERRAIN){const S=T.slicePlaneEnabled?m:null;T.intersect(y,S,y.rayBegin,y.rayEnd,u)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(x=>{if(x.isGround){const T=x.slicePlaneEnabled?m:null;x.intersect(y,T,y.rayBegin,y.rayEnd,u)}})}if(y.results.min.getIntersectionPoint(E$)){const x=this._view.computeMapPointFromVec3d(E$);return x.z=r,x}return null}computeIntersection(e,i,r){if(e==null)return;const n=this._view.state.camera,s=Le.get();n.projectToRenderScreen(e.origin,s);const o=new Qse(r,this._forEachLayer);i.options.selectOpaqueTerrainOnly=!r||!("include"in r||"exclude"in r);const a=e.origin,l=ce(Le.get(),e.origin,e.direction);i.reset(a,l,n),i.intersect(o.layers,s,this._tolerance);const c=this._view.slicePlane,u=c!=null?yee(c):null;i.intersect(o.sliceableLayers,s,this._tolerance,u);const d=r&&(r.requiresGroundFeedback||r.enableDraped);this._externalIntersectionHandlers.forAll(y=>{const _=y.layerUid,v=Array.isArray(_),w=v?_:[_];v&&(i.options.filteredLayerUids=[]);let x=!1;for(const T of w)o.filterLayerUid(T)?x=!0:v&&i.options.filteredLayerUids.push(T);if(i.options.isFiltered=!x,y.isGround&&d||!i.options.isFiltered){const T=y.slicePlaneEnabled?u:null;y.intersect(i,T,a,l,s)}});const p=Le.get(),m=this._view.basemapTerrain;if(r&&r.enableDraped&&m.spatialReference!=null&&i.results.ground.getIntersectionPoint(p)){const y=m.overlayManager.renderer,_=this._view.renderCoordsHelper.spatialReference,v=Le.get();this._view.renderCoordsHelper.fromRenderCoords(p,v,m.spatialReference),v[2]=this._view.elevationProvider?.getElevation(p[0],p[1],p[2],_,"ground")??0,y.intersect(i,v,i.results.ground,w=>o.filterRenderGeometry(w))}i.sortResults(),this._processHUDResults(i)}_processHUDResults(e){const i=e.results.hud;xg(this._tmpRegion,YB);const r=this._view.state.camera,n=[],s=this._tmpRegion,o=w=>{const x=new Yct(w);r.projectToRenderScreen(w.target.center,x.screenPoint),x.screenPoint[0]=Math.floor(x.screenPoint[0]),x.screenPoint[1]=Math.floor(x.screenPoint[1]),n.push(x),wq(s,x.screenPoint)};e.sortResults(i.all),i.min.dist!=null&&o(i.min);for(const w of i.all)i.min.target.object!==w.target.object&&i.max.target.object!==w.target.object&&o(w);if(i.max.dist!=null&&i.max.target.object!==i.min.target.object&&o(i.max),!n.length)return;s[0]===s[2]&&(s[2]+=1),s[1]===s[3]&&(s[3]+=1);const a=r.fullWidth,l=r.fullHeight,c=Math.max(0,s[0]-SA),u=Math.max(0,s[1]-SA),d=Math.min(ea(s)+2*SA,a-c),p=Math.min(pl(s)+2*SA,l-u),m=new Uint8Array(d*p*4);this._view._stage.renderer.readHUDVisibility(c,u,d,p,m);let y=!0;const _=e.results.max.dist==null;let v=0;for(const w of n)for(const x of Wct)if(m[4*(Math.min(w.screenPoint[0]+x[0],a)-s[0]+(Math.min(w.screenPoint[1]+x[1],l)-s[1])*d)]){y&&(e.results.min.copy(w.result),y=!1),_&&e.results.max.copy(w.result),e.options.store===ho.ALL&&e.results.all.splice(v++,0,w.result);break}}};const SA=1,Wct=(()=>{const t=[],e=SA;for(let i=-e;i<=e;i++)for(let r=-e;r<=e;r++)t.push([r+e,i+e]);return t})();let Yct=class{constructor(e){this.result=e,this.screenPoint=Mo()}},S$;function Kse(t){return S$&&S$.viewingMode===t||(S$=_h(t)),S$}let Qse=class{constructor(e,i){this.layers=new Array,this.sliceableLayers=new Array,this.include=e?.include,this.exclude=e?.exclude,i(r=>{r.pickable&&this.filterLayerUid(r.apiLayerUid)&&(r.sliceable?this.sliceableLayers:this.layers).push(r)})}filterLayerUid(e){const{include:i,exclude:r}=this;return e==null?i==null&&r==null:(i==null||i.has(e))&&(r==null||!r.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}};function eoe(t){return typeof t=="object"&&"intersect"in t}const E$=C(),C$=Mo();let L4t=class{constructor(e,i){this.spatialReference=e,this._view=i}getElevation(e,i,r){return this._view.elevationProvider.getElevation(e,i,0,this.spatialReference,r)}async queryElevation(e,i,r,n,s){return this._view.elevationProvider.queryElevation(e,i,0,this.spatialReference,s,r,n)}},Xct=class{constructor(e,i,r,n){this.spatialReference=i,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions={...n,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(ut.ELEVATION_QUERY,this)}destroy({completeTasks:e}={completeTasks:!1}){if(this._frameTask.remove(),this.running)if(e)this.runTask(Da);else for(const i of this._queries)i.result.reject(pi())}queryElevation(e,i,r,n=0){const s=vs(),o={x:e,y:i,minDemResolution:n,result:s,signal:r};return this._queries.push(o),os(r,()=>{vH(this._queries,o),s.reject(pi())}),s.promise}get running(){return this._queries.length>0}runTask(e){const i=this._queries;this._queries=[];const r=this._getElevationQueryProvider();if(!r)return i.forEach(u=>u.result.reject()),void e.madeProgress();const n=i.map(u=>[u.x,u.y]),s=i.reduce((u,d)=>Math.min(u,d.minDemResolution),1/0),o=new IS({points:n,spatialReference:this.spatialReference}),a=i.length>1&&i.some(u=>!!u.signal)?new AbortController:null,l=a!=null?a.signal:i[0].signal;if(a!=null){let u=0;i.forEach(d=>os(d.signal,()=>{u++,d.result.reject(pi()),u===i.length&&a.abort()}))}const c={...this._queryOptions,minDemResolution:s,signal:l};r.queryElevation(o,c).then(u=>{i.forEach((d,p)=>{d.signal!=null&&d.signal.aborted?d.result.reject(pi()):d.result.resolve(u.geometry.points[p][2])})}).catch(u=>{i.forEach(d=>d.result.reject(u))}),e.madeProgress()}get test(){const e=this;return{update:()=>e._queries.length>0&&e.runTask(Da)}}},EA=class extends Tn.EventedMixin(xe){get spatialReference(){return this.view?.basemapTerrain?.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQueryCached=Pe(this._elevationQueryCached)}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,i,r,n,s){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const a=this.lastElevationQuery;if(e===a.x&&i===a.y&&r===a.z&&wn(n,a.spatialReference)&&s===a.queryContext)return a.result}let o=null;return o=A$(o,this._im,e,i,r,n,s),o==null&&(o=A$(o,this._ground,e,i,r,n,s)),s==="scene"&&(o=A$(o,this._scene,e,i,r,n,s)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:i,z:r,spatialReference:n,queryContext:s,result:o}),o}getSphereElevationBounds(e,i){let r=1/0,n=-1/0;for(const s of[this._im,this._ground,this._scene])s.forEach(o=>{if(o.getSphereElevationBounds){const a=o.getSphereElevationBounds(e,i);a!=null&&(r=Math.min(r,a.min),n=Math.max(n,a.max))}});return{min:r,max:n}}getRootElevationBounds(){let e=1/0,i=-1/0;for(const r of[this._im,this._ground,this._scene])r.forEach(n=>{if(n.getRootElevationBounds){const s=n.getRootElevationBounds();s!=null&&(e=Math.min(e,s.min),i=Math.max(i,s.max))}});return{min:e,max:i}}async queryElevation(e,i,r,n,s,o=null,a=0){const l=this._getElevationQuery(n);try{const c=await l.queryElevation(e,i,o,a);return s==="scene"?A$(c,this._scene,e,i,r,n,s):c}catch(c){return T_(c),this.getElevation(e,i,r,n,s)}}register(e,i){this.addHandles(i.on("elevation-change",r=>this.emit("elevation-change",r)),i),this._providersFromContext(e).push(i)}unregister(e){this.removeHandles(e);for(const i of[this._im,this._ground,this._scene]){const r=i.indexOf(e);r>-1&&i.splice(r,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}_getElevationQuery(e=this.view.spatialReference){const i=this._elevationQueryCached;if(i!=null&&wn(e,i.spatialReference))return i;i?.destroy({completeTasks:!0});const{wkid:r,wkt:n,wkt2:s,latestWkid:o}=e,a=new Xct(this.view.resourceController.scheduler,new je({wkid:r,wkt:n,wkt2:s,latestWkid:o}),()=>this.view.map?.ground,{maximumAutoTileRequests:4});return this._elevationQueryCached=a,a}};function A$(t,e,i,r,n,s,o){for(const a of e){const l=a.getElevation(i,r,n,s,o);l!=null&&(t=t!=null?Math.max(l,t):l)}return t}h([f({constructOnly:!0})],EA.prototype,"view",void 0),h([f()],EA.prototype,"spatialReference",null),EA=h([z("esri.views.3d.support.CombinedElevationProvider")],EA);let IO=class Tj{static isValidProfile(e){return e in Tj.profiles}static getDefaultProfile(){return ie("esri-iPhone")?"low":"medium"}static apply(e,i){const r=Tj.profiles[e];i.graphics3D.maxTotalNumberOfFeatures=r.graphics3D.maxTotalNumberOfFeatures,i.graphics3D.maxNumberOfDrawCalls=r.graphics3D.maxNumberOfDrawCalls,i.graphics3D.maxTotalNumberOfVertices=r.graphics3D.maxTotalNumberOfVertices,i.graphics3D.polygonLodFactor=r.graphics3D.polygonLodFactor,i.graphics3D.polylineLodFactor=r.graphics3D.polylineLodFactor,i.graphics3D.snapshotAvailable=r.graphics3D.snapshotAvailable,i.graphics3D.skipHighSymbolLods=r.graphics3D.skipHighSymbolLods,i.graphics3D.uncompressedTextureDownsamplingEnabled=r.graphics3D.uncompressedTextureDownsamplingEnabled;const n=i.sceneService.object,s=r.sceneService.object;n.lodFactor=s.lodFactor,n.lodCrossfadeinDuration=s.lodCrossfadeinDuration,n.lodCrossfadeoutDuration=s.lodCrossfadeoutDuration,n.lodCrossfadeUncoveredDuration=s.lodCrossfadeUncoveredDuration,i.sceneService.point.lodFactor=r.sceneService.point.lodFactor,i.sceneService.integratedMesh.lodFactor=r.sceneService.integratedMesh.lodFactor,i.sceneService.pointCloud.lodFactor=r.sceneService.pointCloud.lodFactor,i.sceneService.uncompressedTextureDownsamplingEnabled=r.sceneService.uncompressedTextureDownsamplingEnabled,i.tiledSurface.lodBias=r.tiledSurface.lodBias,i.tiledSurface.angledSplitBias=r.tiledSurface.angledSplitBias,i.tiledSurface.vtlContentZoom=r.tiledSurface.vtlContentZoom,i.tiledSurface.reduceTileLevelDifferences=r.tiledSurface.reduceTileLevelDifferences,i.tiledSurface.textureFadeDuration=r.tiledSurface.textureFadeDuration,i.heatmap.pixelRatio=r.heatmap.pixelRatio,i.heatmap.maxTotalNumberOfFeatures=r.heatmap.maxTotalNumberOfFeatures,i.fadeDuration=r.fadeDuration,i.antialiasingEnabled=r.antialiasingEnabled,i.physicallyBasedRenderingEnabled=r.physicalBasedRenderingEnabled,i.highQualityTransparency=r.highQualityTransparency,i.highResolutionAtmosphere=r.highResolutionAtmosphere,i.reflections=r.reflections,i.ambientOcclusion=r.ambientOcclusion,i.memoryLimit=r.memoryLimit,i.additionalCacheMemory=r.additionalCacheMemory,i.frameRate=r.frameRate,i.maximumPixelRatio=r.maximumPixelRatio}};IO.test={reset(){const t=jSe();for(const e of Object.keys(t))IO.profiles[e]=t[e]}};const eC={IPhone12Pro:120,GalaxyS20:200,FullHD:240,SurfacePro7:300,FullHDRetina:430};function jSe(){const t=!!ie("esri-mobile"),e=!!ie("ios"),i=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxNumberOfDrawCalls:8e3,maxTotalNumberOfVertices:255e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0,uncompressedTextureDownsamplingEnabled:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{object:{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,vtlContentZoom:.75,reduceTileLevelDifferences:!0,textureFadeDuration:0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200+eC.IPhone12Pro,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:625e4,polygonLodFactor:t?.8:1,polylineLodFactor:t?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:t},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:i},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:t},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,reduceTileLevelDifferences:!ie("disable-feature:reduce-map-tile-levels"),textureFadeDuration:i},fadeDuration:i,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:t?600+eC.GalaxyS20:750+eC.FullHD,additionalCacheMemory:t?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:125e5,polygonLodFactor:t?1.2:2,polylineLodFactor:t?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:i},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,reduceTileLevelDifferences:!ie("disable-feature:reduce-map-tile-levels"),textureFadeDuration:i},fadeDuration:i,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:t?900+eC.SurfacePro7:1500+eC.FullHDRetina,additionalCacheMemory:t?-150:0,frameRate:0,maximumPixelRatio:t?1:1/0}}}(function(t){t.profiles=jSe()})(IO||(IO={}));const HL=IO,HSe=new Ye([0,255,255]),qSe=1,WSe=.25,YSe=new Ye([0,0,0]),XSe=.4,ZSe=.2;let Yp=class extends xe{constructor(){super(...arguments),this.color=HSe.clone(),this.haloColor=null,this.haloOpacity=qSe,this.fillOpacity=WSe,this.shadowOpacity=XSe,this.shadowColor=YSe.clone(),this.shadowDifference=ZSe}};h([f({type:Ye})],Yp.prototype,"color",void 0),h([f({type:Ye})],Yp.prototype,"haloColor",void 0),h([f()],Yp.prototype,"haloOpacity",void 0),h([f()],Yp.prototype,"fillOpacity",void 0),h([f()],Yp.prototype,"shadowOpacity",void 0),h([f({type:Ye})],Yp.prototype,"shadowColor",void 0),h([f()],Yp.prototype,"shadowDifference",void 0),Yp=h([z("esri.views.3d.support.HighlightOptions")],Yp);const JSe=Yp;function Zct(t,e){return e?{...e,query:{...t??{},...e.query}}:{query:t}}function KSe(t){return typeof t=="string"?bn(t):ye(t)}function Jct(t,e,i){const r={};for(const n in t){if(n==="declaredClass")continue;const s=t[n];if(s!=null&&typeof s!="function")if(Array.isArray(s)){r[n]=[];for(let o=0;o<s.length;o++)r[n][o]=Jct(s[o])}else if(typeof s=="object")if(s.toJSON){const o=s.toJSON(i?.[n]);r[n]=e?o:JSON.stringify(o)}else r[n]=e?s:JSON.stringify(s);else r[n]=s}return r}function Kct(t){return{geometryType:uR(t[0]),geometries:t.map(e=>e.toJSON())}}function QSe(t,e,i){const r=EDe(e);return t.map(n=>{const s=r.fromJSON(n);return s.spatialReference=i,s})}let d1=class extends $e{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(n=>n.toJSON()),i=this.geometries[0],r={};return r.outSR=DD(this.outSpatialReference),r.inSR=DD(i.spatialReference),r.geometries=JSON.stringify({geometryType:uR(i),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(r.transformForward=this.transformForward),r}};h([f()],d1.prototype,"geometries",void 0),h([f({json:{read:{source:"outSR"}}})],d1.prototype,"outSpatialReference",void 0),h([f()],d1.prototype,"transformation",void 0),h([f()],d1.prototype,"transformForward",void 0),d1=h([z("esri.rest.support.ProjectParameters")],d1);const vZ=d1,Qct=uo(vZ);async function eEe(t,e,i){e=Qct(e);const r=KSe(t),n={...r.query,f:"json",...e.toJSON()},s=e.outSpatialReference,o=uR(e.geometries[0]),a=Zct(n,i);return Ii(r.path+"/project",a).then(({data:{geometries:l}})=>QSe(l,o,s))}async function bZ(t=null,e){if(Oi.geometryServiceUrl)return Oi.geometryServiceUrl;if(!t)throw new W("internal:geometry-service-url-not-configured");let i;i="portal"in t?t.portal||ia.getDefault():t,await i.load({signal:e});const r=i.helperServices?.geometry?.url;if(!r)throw new W("internal:geometry-service-url-not-configured");return r}async function eut(t,e,i=null,r){const n=await bZ(i,r),s=new vZ;s.geometries=[t],s.outSpatialReference=e;const o=await eEe(n,s,{signal:r});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new W("internal:geometry-service-projection-failed")}const tut=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:bZ,projectGeometry:eut},Symbol.toStringTag,{value:"Module"}));let iut=class{constructor(e,i){this.spatialReference=i,this.unitInMeters=ua(this.spatialReference,Fi(this.spatialReference).metersPerDegree);const r=e&&"portalItem"in e?e.portalItem:void 0;this._geometryServiceURLPromise=bZ(r).catch(()=>{throw new W("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(e){const i=await this._geometryServiceURLPromise;let r,n=!0;Array.isArray(e[0])&&typeof e[0]!="number"?r=e:(r=[e],n=!1);const s=r.map(l=>l instanceof lt?l:new lt(l,this.spatialReference)),o=new vZ({geometries:s,outSpatialReference:je.WGS84}),a=(await eEe(i,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0).filter(l=>!!l);return n?a:a[0]}},Dc=class extends xe{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxNumberOfDrawCalls=17e3,this.maxTotalNumberOfVertices=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1,this.uncompressedTextureDownsamplingEnabled=!1}};h([f()],Dc.prototype,"minTotalNumberOfFeatures",void 0),h([f()],Dc.prototype,"maxTotalNumberOfFeatures",void 0),h([f()],Dc.prototype,"maxNumberOfDrawCalls",void 0),h([f()],Dc.prototype,"maxTotalNumberOfVertices",void 0),h([f()],Dc.prototype,"snapshotAvailable",void 0),h([f()],Dc.prototype,"polygonLodFactor",void 0),h([f()],Dc.prototype,"polylineLodFactor",void 0),h([f()],Dc.prototype,"skipHighSymbolLods",void 0),h([f()],Dc.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Dc=h([z("esri.views.3d.support.QualitySettings.Graphics3DSettings")],Dc);let Cf=class extends xe{constructor(){super(...arguments),this.lodFactor=1}};h([f()],Cf.prototype,"lodFactor",void 0),Cf=h([z("esri.views.3d.support.QualitySettings.LoDFactorSettings")],Cf);let y5=class extends Cf{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};y5=h([z("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],y5);let jm=class extends xe{constructor(){super(...arguments),this.object=new y5,this.point=new Cf,this.integratedMesh=new Cf,this.pointCloud=new Cf,this.uncompressedTextureDownsamplingEnabled=!1}};h([f({type:y5})],jm.prototype,"object",void 0),h([f({type:Cf})],jm.prototype,"point",void 0),h([f({type:Cf})],jm.prototype,"integratedMesh",void 0),h([f({type:Cf})],jm.prototype,"pointCloud",void 0),h([f()],jm.prototype,"uncompressedTextureDownsamplingEnabled",void 0),jm=h([z("esri.views.3d.support.QualitySettings.SceneServiceSettings")],jm);let Hm=class extends xe{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.vtlContentZoom=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=400}};h([f()],Hm.prototype,"lodBias",void 0),h([f()],Hm.prototype,"angledSplitBias",void 0),h([f()],Hm.prototype,"vtlContentZoom",void 0),h([f()],Hm.prototype,"reduceTileLevelDifferences",void 0),h([f()],Hm.prototype,"textureFadeDuration",void 0),Hm=h([z("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],Hm);let X2=class extends xe{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};h([f()],X2.prototype,"pixelRatio",void 0),h([f()],X2.prototype,"maxTotalNumberOfFeatures",void 0),X2=h([z("esri.views.3d.support.QualitySettings.HeatmapSettings")],X2);let To=class extends xe{constructor(){super(...arguments),this.graphics3D=new Dc,this.sceneService=new jm,this.tiledSurface=new Hm,this.heatmap=new X2,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.highResolutionAtmosphere=!1,this.reflections=!1,this.ambientOcclusion=!1,this.memoryLimit=750,this.additionalCacheMemory=0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};h([f({type:Dc})],To.prototype,"graphics3D",void 0),h([f({type:jm})],To.prototype,"sceneService",void 0),h([f({type:Hm})],To.prototype,"tiledSurface",void 0),h([f({type:X2})],To.prototype,"heatmap",void 0),h([f()],To.prototype,"fadeDuration",void 0),h([f()],To.prototype,"antialiasingEnabled",void 0),h([f()],To.prototype,"physicallyBasedRenderingEnabled",void 0),h([f()],To.prototype,"highQualityTransparency",void 0),h([f()],To.prototype,"highResolutionAtmosphere",void 0),h([f()],To.prototype,"reflections",void 0),h([f()],To.prototype,"ambientOcclusion",void 0),h([f()],To.prototype,"memoryLimit",void 0),h([f()],To.prototype,"additionalCacheMemory",void 0),h([f()],To.prototype,"frameRate",void 0),h([f()],To.prototype,"maximumPixelRatio",void 0),To=h([z("esri.views.3d.support.QualitySettings.QualitySettings")],To);const toe=To;function rut(t){return AS(t)&&t.length>=3}function nut(t){return(OS(t)||Array.isArray(t))&&t.length>=3}function sut(t){return rut(t)||nut(t)}let out=class Sj{constructor(e,i,r,n){this.viewingMode=e,this.spatialReference=i,this.unitInMeters=r,this._coordinateSystem=n,this._tmpCoordinateSystem=m8e(n)}set extent(e){e&&g8e(this._coordinateSystem,e,this._coordinateSystem)}getAltitude(e){return S8e(this._coordinateSystem,e)}setAltitude(e,i,r=e){return nye(this._coordinateSystem,r,i,e)}setAltitudeOfTransformation(e,i){E8e(this._coordinateSystem,i,e,i)}worldUpAtPosition(e,i){return b8e(this._coordinateSystem,e,i)}worldBasisAtPosition(e,i,r){return w8e(this._coordinateSystem,e,i,r)}basisMatrixAtPosition(e,i){const r=this.worldBasisAtPosition(e,Yr.X,Le.get()),n=this.worldBasisAtPosition(e,Yr.Y,Le.get()),s=this.worldBasisAtPosition(e,Yr.Z,Le.get());return jf(i,r[0],r[1],r[2],0,n[0],n[1],n[2],0,s[0],s[1],s[2],0,0,0,0,1),i}headingAtPosition(e,i){const r=this.worldUpAtPosition(e,Le.get()),n=this.worldBasisAtPosition(e,Yr.Y,Le.get()),s=L0e(i,n,r);return za(s)}intersectManifoldClosestSilhouette(e,i,r){return A6(this._coordinateSystem,i,this._tmpCoordinateSystem),T8e(this._tmpCoordinateSystem,e,r),r}intersectManifold(e,i,r){A6(this._coordinateSystem,i,this._tmpCoordinateSystem);const n=Le.get();return x8e(this._tmpCoordinateSystem,e,n)?se(r,n):null}intersectInfiniteManifold(e,i,r){if(this.viewingMode===Me.Global)return this.intersectManifold(e,i,r);A6(this._coordinateSystem,i,this._tmpCoordinateSystem);const n=this._tmpCoordinateSystem.value,s=Le.get();return aw(n.plane,e,s)?se(r,s):null}toRenderCoords(e,i,r){return TN(e)?lc(e,i,this.spatialReference):Do(e,i,r,this.spatialReference)}fromRenderCoords(e,i,r=null){return TN(i)?(r!=null&&(i.spatialReference=r),ATe(e,this.spatialReference,i)):sut(i)?Do(e,this.spatialReference,i,r)?i:null:Cg(e,this.spatialReference,i)}static create(e,i){switch(e){case Me.Local:return new Sj(Me.Local,i,ua(i),v8e());case Me.Global:return new Sj(Me.Global,i,1,_8e(i))}}static renderUnitScaleFactor(e,i){return OB(e)/OB(i)}};var df;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.BASEMAP=1]="BASEMAP",t[t.I3S_INDEX=2]="I3S_INDEX",t[t.I3S_DATA=3]="I3S_DATA",t[t.SYMBOLOGY=4]="SYMBOLOGY"})(df||(df={}));const aut=(()=>{const t=new Array;return t[df.ELEVATION]=10,t[df.BASEMAP]=10,t[df.I3S_INDEX]=10,t[df.I3S_DATA]=10,t[df.SYMBOLOGY]=5,t})(),lut=30;function tEe(t){return"usedMemory"in t&&"unloadedMemory"in t&&"ignoresMemoryFactor"in t}function cut(t){return new Sa({view:t})}const ioe=.1,O$=1,j8=1,uut=.75,hut=.6,roe=1.3;let Sa=class extends xe{constructor(e){super(e),this._quality=1,this._usedMemory=0,this._updating=!1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new fve,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=750,this._additionalCacheMemory=0,this.addHandles(fb({prepare:()=>this._updateMemory()}))}destroy(){this._cacheStorage.destroy()}get maxMemory(){return this._maxMemory}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(O$),this._maxMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}set additionalCacheMemory(e){e!=null&&(this._additionalCacheMemory=e)}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}get usedCacheMemory(){return this._cacheStorage.size}newCache(e,i){return new hGe(e,this._cacheStorage,i)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<hut&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(O$);else if(e)(this._memoryPredicted>1.1*j8||this._usedMemory>j8)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>ioe&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/roe),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._usedMemory>j8)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/roe),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._usedMemory<uut&&this._quality<O$){this._stableQuality=this._quality;const i=.05;e=this._updateQuality(this._quality+i)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,ioe),O$))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){if(!this.view)return;this.view._stage?.renderer?.tick();let e=(this.view.basemapTerrain?.usedMemory??0)+(this.view._stage?.renderer?.usedMemory??0),i=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(o=>{if(tEe(o)){const a=o.ignoresMemoryFactor?this._quality:1;e+=o.usedMemory*a,i+=o.unloadedMemory*a}});const r=this._warnMemoryUsage==null||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),n=1048576*this.maxMemory;if(e>n&&r){this._warnMemoryUsage=e;const o=l=>(l/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",a=Math.round(100*this._quality);ne.getLogger(this).warn(`Memory Limit exceeded! Limit: ${o(n)} Current: ${o(e)} Projected: ${o(e+i)} Quality: ${a}%`)}this._usedMemory=e/n,this._memoryPredicted=(e+i)/n;const s=n-e;this._cacheStorage.maxSize=Math.max(0,s+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const i=e._numQualityChanges;return e._numQualityChanges=0,i}}}};h([f({constructOnly:!0})],Sa.prototype,"view",void 0),h([f()],Sa.prototype,"maxMemory",null),h([f()],Sa.prototype,"additionalCacheMemory",null),h([f({readOnly:!0})],Sa.prototype,"memoryFactor",null),h([f({readOnly:!0})],Sa.prototype,"updating",null),h([f({readOnly:!0})],Sa.prototype,"usedMemory",null),h([f({readOnly:!0})],Sa.prototype,"usedCacheMemory",null),h([f()],Sa.prototype,"_quality",void 0),h([f()],Sa.prototype,"_usedMemory",void 0),h([f()],Sa.prototype,"_updating",void 0),h([f()],Sa.prototype,"_stableQuality",void 0),h([f()],Sa.prototype,"_maxMemory",void 0),h([f()],Sa.prototype,"_additionalCacheMemory",void 0),Sa=h([z("esri.views.3d.support.MemoryController")],Sa);let dut=class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}},put=class{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new fut}},fut=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},mut=class{constructor(e,i,r,n){this._workerFunc=e,this._callbackFunc=i,this._maxTotalNumWorkers=r,this._totalNumWorkers=0,this._clients=n.map(s=>new put(s))}destroy(){this._clients.length=0}hasQuota(e){const i=this._clients[e];return!!i&&(this._totalNumWorkers<this._maxTotalNumWorkers||i.numWorkers+i.tasks.length<i.typeWorkerQuota)}push(e){const i=this._clients[e.client];i&&(this._totalNumWorkers<this._maxTotalNumWorkers?(i.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(r,n)=>this._taskCallback(r,n))):i.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const i=this._clients[e.client];this._totalNumWorkers--,i&&(i.numWorkers--,i.statistics.requests++,i.statistics.size+=e.size||0,i.statistics.duration+=e.duration||0,i.statistics.speed=i.statistics.duration>0?i.statistics.size/i.statistics.duration:0,Ke(i.numWorkers>=0)),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(i,r)=>this._taskCallback(i,r)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,i){e._cancelled||(this._callbackFunc(e,i),this._taskFinished(e))}getStatsForType(e){const i=this._clients[e];return i?{quota:i.typeWorkerQuota,workers:i.numWorkers,queueSize:i.tasks.length,requestStats:i.statistics}:null}get test(){const e=this;return{set workerFunc(i){e._workerFunc=i}}}},qL=class extends xe{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,i,r){this._loadQueue=new mut((n,s)=>this._startLoading(n,s),(n,s)=>this._doneLoadingCB(n,s),e,i),r&&(this._frameTask=r.registerTask(ut.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=pr(this._frameTask),this._tasks.forEach(e=>nc(e.abortController)),this._loadQueue=Pe(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,i,r,n={}){const s=vs();s.__signal=n!=null?n.signal:null;const o=this._createOrUpdateTask(e,i,r,n,s);return os(n,()=>this._cancelRequest(o,s)),s.promise}_createTask(e,i,r,n,s,o){const a=new vut(e,i,r,n,s);return this._updateTask(a,o),this._tasks.set(s,a),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(a),a}_cancelRequest(e,i){z3(e.resolvers,i),i.reject(pi()),e.resolvers.length===0&&(e.status===Vu.DOWNLOADING&&(e.status=Vu.CANCELLED,this._loadQueue.cancel(e),e.abortController?.abort(),e.request=null,e.abortController=null),e.status=Vu.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,i){e.resolvers.push(i)}_createOrUpdateTask(e,i,r,n,s){const o=but(n?.uid||e,i,r),a=this._tasks.get(o);return a?(this._updateTask(a,s),a):this._createTask(e,n,i,r,o,s)}_doneLoadingCB(e,i){this._loadQueue&&(Ke(e.status===Vu.DOWNLOADING),e.status=Vu.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:i}):this._doneLoading(e,i))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const i=this._onLoadQueue.shift();Et(i.task.abortController),i.task.abortController=null,i.callback(i.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const i=this._doneQueue.shift();i.task.status!==Vu.DOWNLOADED&&(i.err=i.err||pi()),this._doneLoading(i.task,i.err),e.madeProgress()}}_doneLoading(e,i){if(i&&!Fn(i)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let r=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const n of e.resolvers)if(i)Fn(i)?n.reject(i):n.reject(new W("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${i}`,{url:e.url,error:i}));else{--r;const s=r>0?ye(e.result):e.result;n.resolve(s)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,i){if(e.status===Vu.CANCELLED)return!1;let r,n;switch(e.startTime=performance.now(),e.status=Vu.DOWNLOADING,e.docType){case"binary":n="array-buffer",r=0;break;case"image":n="image";break;case"image+type":n="array-buffer";break;default:n="json"}e.abortController=new AbortController;const s=e.abortController.signal;e.request=Ii(e.url,{...e.options,responseType:n,timeout:r,signal:s});let o=()=>{};const a=c=>{e.duration=performance.now()-e.startTime,e.size=c instanceof ArrayBuffer?c.byteLength:e.size||0,e.result=c,this._frameTask?this._onLoadQueue.push({callback:i,task:e}):(e.abortController=null,i(e))},l=c=>{e.status===Vu.DOWNLOADING&&i(e,c),o()};return e.docType!=="image+type"?(e.request.then(c=>a(c.data),l),!0):(e.request.then(c=>{const u=c.data,d=yut(u);if(n="image",e.size=u.byteLength,d==="unknown")return e.request=Ii(e.url,{responseType:n,timeout:r,signal:s}),void e.request.then(y=>a(y.data),l);const p=new Blob([u],{type:d}),m=window.URL.createObjectURL(p);o=()=>window.URL.revokeObjectURL(m),e.request=Ii(m,{responseType:n,timeout:r,signal:s}),e.request.then(y=>a(new wZ(y.data,d,o)),l)},l),!0)}get test(){return{loadQueue:this._loadQueue}}};h([f({readOnly:!0})],qL.prototype,"updating",void 0),qL=h([z("esri.views.3d.support.StreamDataLoader")],qL);const gut={numRetries:0};function yut(t){if(t.byteLength<2)return"unknown";const e=new Uint8Array(t,0,t.byteLength);return e[0]===137&&e[1]===80?"image/png":e[0]===71&&e[1]===73?"image/gif":e[0]===66&&e[1]===77?"image/bmp":e[0]===255&&e[1]===216?"image/jpeg":"unknown"}let wZ=class{constructor(e,i,r){this.image=e,this.type=i,this.release=r}get isOpaque(){return this.type==="image/jpeg"}};function _ut(t){return"image"in t&&"type"in t}let vut=class extends dut{constructor(e,i,r,n,s){super(n),this.url=e,this.options=i,this.docType=r,this.key=s,this.result=null,this.status=Vu.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=gut.numRetries}};function but(t,e,i){return`${t}:${e}:${i}`}var Vu;(function(t){t[t.QUEUED=1]="QUEUED",t[t.DOWNLOADING=2]="DOWNLOADING",t[t.DOWNLOADED=3]="DOWNLOADED",t[t.CANCELLED=4]="CANCELLED"})(Vu||(Vu={}));let WL=class extends xe{constructor(){super(...arguments),this.updating=!1}};function wut(t){return new sd({view:t})}h([f({readOnly:!0})],WL.prototype,"updating",void 0),WL=h([z("esri.views.3d.support.ResourceControllerMain")],WL);let sd=class extends WL{constructor(){super(...arguments),this._immediateTask=WT,this._normalTask=WT,this._updatingObjects=qT([]),this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=h5e(),this._memoryController=cut(this.view),this._streamDataLoader=new qL,this._streamDataLoader.setup(lut,aut,this._scheduler),this.addHandles([le(()=>this.view.state?.mode,e=>{e!=null&&(this._scheduler.state=e)},qi),le(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=fb({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(ut.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(ut.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=pr(this._frameTask),this._streamDataLoader=Pe(this._streamDataLoader),this._memoryController=Pe(this._memoryController),this._scheduler=Pe(this._scheduler),this.view=null}get updating(){return!!(this._memoryController?.updating||this._streamDataLoader?.updating||this._immediateTask?.updating)||this._updatingObjects?.value.some(e=>e.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const i=this._streamDataLoader;return{request:(r,n,s)=>i.request(r,n,e,s),get busy(){return!i.hasDownloadSlots(e)}}}addUpdatingObject(e){const i=this._updatingObjects;return i.value=[...i.value,e],Mi(()=>{i.value=i.value.filter(r=>r!==e)})}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(AH(e.deltaTime)),!this._scheduler)||(this._memoryController.update(),this._scheduler.updateBudget(e)&&this._scheduler.frame())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){return{getQueueStats:e=>this._streamDataLoader.test.loadQueue.getStatsForType(e)}}};h([f()],sd.prototype,"view",void 0),h([f()],sd.prototype,"_scheduler",void 0),h([f()],sd.prototype,"_memoryController",void 0),h([f()],sd.prototype,"_streamDataLoader",void 0),h([f()],sd.prototype,"_immediateTask",void 0),h([f()],sd.prototype,"_normalTask",void 0),h([f()],sd.prototype,"_updatingObjects",void 0),h([f({readOnly:!0})],sd.prototype,"updating",null),sd=h([z("esri.views.3d.support.ResourceControllerImpl")],sd);function xut(t){return tEe(t)}function Tut(t){return"performanceInfo"in t}var Zo,rt;(function(t){t[t.INSIDE=0]="INSIDE",t[t.INTERSECTS=1]="INTERSECTS",t[t.OUTSIDE=2]="OUTSIDE"})(Zo||(Zo={})),function(t){t[t.NORTH=0]="NORTH",t[t.NORTH_EAST=1]="NORTH_EAST",t[t.EAST=2]="EAST",t[t.SOUTH_EAST=3]="SOUTH_EAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTH_WEST=5]="SOUTH_WEST",t[t.WEST=6]="WEST",t[t.NORTH_WEST=7]="NORTH_WEST"}(rt||(rt={}));const vx=C(),Sut=C(),pm=C(),fm=C();function Eut(t,e,i=0){const r=t.extent;if(r==null)return!1;if(i===0)return Dpe(r,e);const n=Math.min(r[2]-r[0],r[3]-r[1]);return uDe(r,e,i*n)}function R$(t,e,i,r){se(vx,i),vx[r]=e[r];const n=he(vx,vx,e),s=he(Sut,t,e),o=me(s,n),a=me(n,n);let l;l=o<=0?e:a<=o?i:ce(vx,e,te(n,n,o/a));const c=he(vx,t,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function Cut(t,e,i){const r=t.extent;if(r==null)return 0;pm[0]=r[0],pm[1]=r[1],pm[2]=i,fm[0]=r[2],fm[1]=r[3],fm[2]=i;let n=1/0,s=1/0;return e[0]<pm[0]?n=R$(e,pm,fm,0):e[0]>fm[0]&&(n=R$(e,fm,pm,0)),e[1]<pm[1]?s=R$(e,pm,fm,1):e[1]>fm[1]&&(s=R$(e,fm,pm,1)),Math.min(n,s)}function Aut(t,e,i){if(t==null)return nY();if(t.spatialReference.isGeographic&&!n_(t.spatialReference))return new W("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const r=ql.checkUnsupported(t);if(r!=null)return r;if(i==null)return new W("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const n=Out(t,i);if(n)return n;const s=t.spatialReference;return e==null||s.equals(e)||e.isWGS84&&s.isWebMercator?null:new W("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")}function Out(t,e){const i=t.lods,r=i[0].resolution*2**i[0].level,n=[r*t.size[0],r*t.size[1]],s=[t.origin.x,t.origin.y],o=Lpe(e),a=Gt();ql.computeRowColExtent(o,n,s,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>z2){const c=i[0].scale*2**i[0].level;let u=Math.max((o[3]-o[1])/t.size[1],(o[2]-o[0])/t.size[0])*c/r;const d=Math.floor(Math.log(u)/Math.log(10));return u=Math.ceil(u/10**d)*10**d,new W("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+u.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:u,requiredNumRootTiles:l,allowedNumRootTiles:z2})}return null}const Rut=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:Aut,isInsideExtent:Eut,tiltToExtentEdge:Cut},Symbol.toStringTag,{value:"Module"}));function Put(){return!0}function Mut(){return 0}function $ut(t,e){if(t==null)return nY();const i=t.lods.length-1,r=t.spatialReference,n=n_(r)||Vf(r)||Gf(r);if(r.isWebMercator){if(!ql.makeWebMercatorAuxiliarySphere(i).compatibleWith(t))return new W("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!n)return new W("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!ql.makeGCSWithTileSize(t.spatialReference,t.size[0],i).compatibleWith(t))return t.spatialReference.isWGS84?new W("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new W("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return e==null||t.spatialReference.equals(e)?void 0:new W("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const Iut=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:$ut,isInsideExtent:Put,tiltToExtentEdge:Mut},Symbol.toStringTag,{value:"Module"})),Lut={[Me.Global]:Iut,[Me.Local]:Rut};function sf(t,e){t||console.warn("Terrain: "+e)}let us=!1,_5=!1;function Dut(t){_5=t,us=us||t}function Nut(t){us=t}function Se(t,e){if(us&&!t){const i=new Error().stack?.slice(5);throw console.warn("Terrain internal: "+(e??"")+" at "+i),new Error("Assertion failed"+(e?": "+e:""))}}function Ej(t){return yk(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale,tilemapCache:null}:t.layer}function v5(t){return t?.type==="imagery-tile"||t?.type==="wcs"}function yk(t){return t?.type==="imagery-tile-3d"}function xZ(t){return t?.type==="tile-3d"}function vS(t){return t?.type==="vector-tile-3d"}function iEe(t){return t?.type==="wmts-3d"}function Cj(t){return t?.type==="elevation-3d"}function tC(t){return t?.type==="group"}function LO(t){return t&&(xZ(t)||iEe(t)||yk(t)||vS(t))}function Aj(t){return t&&(xZ(t)||yk(t)||vS(t)||iEe(t))}function DO(t){return Aj(t)||Cj(t)}function Fut(t){const e=t?.sourceLayerInfo?.data;return e!=null&&"type"in e&&e.type==="raster-tile"}function kut(t){return rEe(t?.sourceLayerInfo)||!!t?.isVTLBackground}function Uut(t){const e=t?.sourceLayerInfo?.data;return e!=null&&"type"in e&&e.type==="tile-texture"}function zut(t){const e=t?.sourceLayerInfo?.data;return e instanceof HTMLImageElement||e instanceof wZ||e instanceof HTMLCanvasElement||e instanceof ImageData}function rEe(t){return t?.data!=null&&"type"in t.data&&t.data.type==="vector-tile"}function wT(t){return t!=null&&"release"in t&&t.release(),null}function noe(t){return t.fetchTile&&t.hasOverriddenFetchTile!==!1}function TZ(t,e,i,r){return Lut[r].checkIfTileInfoSupportedForViewSR(t,i,e)}function _k(t,e,i){let r=null,n=null;if(t?.type==="wmts"){const s=But(t,e,i);r=s.tileInfo,n=s.fullExtent}else{n=v5(t)?t.getCompatibleFullExtent(e):t.fullExtent;const s=i===Me.Local;if(v5(t))r=t.getCompatibleTileInfo(e,n,s);else if(t?.type==="vector-tile"){const o=s&&!Vut(e)||Gut.force512VTL,a=t.tileInfo.spatialReference.isGeographic;r=o?t.tileInfo:t.tileInfo.getOrCreateCompatible(256,a?1:2)}else r=t.tileInfo}return r!=null&&n!=null&&TZ(r,n,e,i)==null?{tileInfo:r,fullExtent:n}:null}function But(t,e,i){const r=J$e(t);if(r!=null){if(!ft.isCollection(r))return{tileInfo:r.tileInfo,fullExtent:r.fullExtent};{const n=r.find(s=>TZ(s.tileInfo,s.fullExtent,e,i)==null);if(n)return{tileInfo:n.tileInfo,fullExtent:n.fullExtent}}}return{tileInfo:null,fullExtent:null}}function Vut(t){return t.isWGS84||t.isWebMercator||_de(t)||!$T(t)}const Gut={force512VTL:!1};function soe(t){return"["+t[0]+","+t[1]+","+t[2]+"]"}function mm(t){return"("+t[0]+","+t[1]+","+t[2]+")"}function th(t,e,i=qut){return Math.abs(t-e)<i}function b5(t){return t===rt.NORTH_EAST?rt.SOUTH_WEST:t===rt.NORTH_WEST?rt.SOUTH_EAST:t===rt.SOUTH_WEST?rt.NORTH_EAST:rt.NORTH_WEST}function SZ(t){return t===rt.NORTH?rt.SOUTH:t===rt.EAST?rt.WEST:t===rt.SOUTH?rt.NORTH:rt.EAST}function jut(t){return t===rt.NORTH_WEST||t===rt.SOUTH_WEST}function Hut(t){return t===rt.NORTH_WEST||t===rt.NORTH_EAST}function ooe(t){return t===rt.NORTH_WEST||t===rt.WEST||t===rt.SOUTH_WEST}function aoe(t){return t===rt.NORTH_EAST||t===rt.EAST||t===rt.SOUTH_EAST}function loe(t){return t===rt.SOUTH_EAST||t===rt.SOUTH||t===rt.SOUTH_WEST}function coe(t){return t===rt.NORTH_EAST||t===rt.NORTH||t===rt.NORTH_WEST}const ng=[rt.NORTH,rt.EAST,rt.SOUTH,rt.WEST],w5=[rt.NORTH_EAST,rt.SOUTH_EAST,rt.SOUTH_WEST,rt.NORTH_WEST],qut=1e-5;let Wut=class{constructor(e,i){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer,this.memory=DO(e)?i.basemapTerrain.getUsedMemoryForLayerView(e):e.usedMemory,Tut(e)){const r=e.performanceInfo;this.displayedNumberOfFeatures=r.displayedNumberOfFeatures,this.maximumNumberOfFeatures=r.maximumNumberOfFeatures,this.totalNumberOfFeatures=r.totalNumberOfFeatures}}},Yut=class{constructor(e){if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,this.cachedMemory=0,this.fboMemory=0,e.resourceController!=null){const i=e.resourceController.memoryController;this.totalMemory=(i.maxMemory??0)*dN.MEGABYTES,this.usedMemory=Math.round(i.usedMemory*this.totalMemory),this.quality=e.quality,this.load=e.resourceController.scheduler.load,this.cachedMemory=i.usedCacheMemory}this.terrainMemory=e.basemapTerrain?.usedMemory??0,this.edgesMemory=e?._stage?.renderer?.edgeView?.usedMemory??0,this.fboMemory=e?._stage?.renderer?.memoryInfo?.fbos??0,e.allLayerViews.items.forEach(i=>{(xut(i)||DO(i))&&this.layerPerformanceInfos.push(new Wut(i,e))}),this.layerPerformanceInfos.sort((i,r)=>r.memory-i.memory)}},Xut=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",()=>{}),this._wosrMemCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,i,r){const n=r?`gltfPBR:${e}`:`gltf:${e}`,s=this._gltfMemCache.get(n);return s!=null?Promise.resolve(s):this._loadOnce(this._gltfLoading,this._gltfMemCache,n,o=>QTe(new JTe(o.streamDataRequester),e,o,r),i)}loadWOSR(e,i){const r=`wosr:${e}:${i.disableTextures}`,n=this._wosrMemCache.get(r);return n!=null?Promise.resolve(n):this._loadOnce(this._wosrLoading,this._wosrMemCache,r,s=>eSe(e,s),i)}async _loadOnce(e,i,r,n,s){Et(s);const o=os(s,()=>this._abortLoad(e,r));let a=e.get(r);if(a)a.refCount++;else{const l=new AbortController;a={refCount:1,abortController:l,promise:n({...s,signal:l.signal})},e.set(r,a)}try{const l=await a.promise;return i.put(r,l,l.size),e.delete(r),Et(s),l}finally{pr(o)}}_abortLoad(e,i){const r=e.get(i);r!=null&&--r.refCount>0||(e.delete(i),r?.abortController.abort())}},Z2=class extends xe{constructor(e,i){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=i?.registerTask(ut.TEXTURE_UNLOAD)??WT}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask?.remove(),this._textureRequests?.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests?.clear()}get updating(){return this._frameTask.updating}fromData(e,i){const r=this.makeUid(e);let n=this._textureRequests.get(r);if(!n){const s=new nEe;s.texture=i(),this._stage&&(s.texture.load(this._stage.renderView.renderingContext),this._stage.add(s.texture)),this._textureRequests.set(r,s),n=s}return n.referenceCount++,{uid:r,texture:n.texture,release:()=>this._release(r)}}_release(e){const i=this._textureRequests.get(e);i?(i.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),i.referenceCount--,i.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const i=this._textureRequests.get(e);!i||i.referenceCount>0||(i.texture?.unload(),this._releaseTextureRequest(i),this._textureRequests.delete(e))}_releaseTextureRequest(e){e.texture?this._stage?.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,i=null){return i!=null?`${e}.${i}px`:e}};h([f()],Z2.prototype,"_frameTask",void 0),h([f()],Z2.prototype,"updating",null),Z2=h([z("esri.views.3d.support.TextureCollection")],Z2);let nEe=class{constructor(){this.referenceCount=0}},Zut=class extends Z2{constructor(e,i,r){super(i,r),this._streamDataRequester=e}async fromUrl(e,i,r){Et(r);const n=r!=null?r.signal:null,s=this.makeUid(e,i);let o=this._textureRequests.get(s);if(!o){const a=new AbortController,l=this._streamDataRequester.request(e,"image",{uid:s,signal:a.signal});o=new nEe,o.abortController=a;const c=o;this._textureRequests.set(s,o),o.textureAsync=l.then(async u=>{const d=this._createTexture(e,u,i);return c.texture=d,c.abortController=null,await d.load(this._stage.renderView.renderingContext),this._stage.add(d),{uid:s,texture:d,release:()=>this._release(s)}},u=>{throw c.abortController=null,u})}o.referenceCount++;try{return await fRe(o.textureAsync,n)}catch(a){throw this._release(s),a}}_createTexture(e,i,r){const n={width:i.width,height:i.height,wrap:{s:Nt.CLAMP_TO_EDGE,t:Nt.CLAMP_TO_EDGE},preMultiplyAlpha:!0,reloadable:!0};if(Qhe(e)){if(r||i.width===0&&i.height===0){const s=i.width?i.height/i.width:1;r=r||64,s>1?(i.width=Math.round(r/s),i.height=r):(i.width=r,i.height=Math.round(r*s))}this._stage.renderView?.renderingContext.driverTest.svgPremultipliesAlpha.result&&(n.preMultiplyAlpha=!1)}return new yw(i,n)}},Jut=class{constructor(e){this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester(df.SYMBOLOGY),this.objectResourceCache=new Xut((r,n)=>e.resourceController.memoryController.newCache(r,n)),this.textures=new Zut(this.streamDataRequester,e.view._stage,e.resourceController.scheduler);const i=Fi(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=Ube(e.viewingMode,i),this.screenSizePerspectiveSettingsLabels=kXe(e.viewingMode,i)}destroy(){this.textures.destroy(),this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return Mi();this._graphicsOwners.push(e);const i=le(()=>e.layer?.screenSizePerspectiveEnabled,()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),Mi(()=>{i.remove(),z3(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some(i=>i.layer?.screenSizePerspectiveEnabled===!0);if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new Dg;const i=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([le(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,i,qi),this._viewState.events.on("camera-projection-changed",i)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=Pe(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;P$.distance=e.centerOnSurfaceInfrequent.distance,P$.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(P$),this.screenSizePerspectiveSettingsLabels.update(P$),this._view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}};const P$={distance:0,fovY:0};let b2=class{constructor(e,i,r=""){this.graphics=e,this._symbol=new Fy({symbolLayers:new ft([new Ny({material:{color:i},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new ow({text:r,halo:{color:"white",size:1/.75},material:{color:i},size:12})])})}show(e,i){if(i==null)return;this.hide();const r=new lt({x:e[0],y:e[1],z:e[2],spatialReference:i});this._graphic=new Lb({geometry:r,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){this._graphic!=null&&(this.graphics.remove(this._graphic),this._graphic=null)}},Sy=class extends xe{constructor(e){super(e)}};h([f({constructOnly:!0})],Sy.prototype,"renderCoordsHelper",void 0),h([f({constructOnly:!0})],Sy.prototype,"surface",void 0),h([f({constructOnly:!0})],Sy.prototype,"state",void 0),Sy=h([z("esri.views.3d.support.PointOfInterest")],Sy);const Kut=Array;let od=class extends Sy{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new Og({location:lt,renderLocation:Kut},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=C(),this._tmpPoint=new lt}initialize(){if(this.scheduler&&this.addHandles(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.addHandles(Io(()=>this.map?.ground?.layers,"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=Pe(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,i=br(e.eye,this.renderLocation),r={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return Nb(r,i,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map?.ground)return this._updateSurfaceAltitude(0),Lo.YIELD;const e=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint,e);const i=(this._tmpPoint.z??0)>Qut&&this.renderCoordsHelper.viewingMode===Me.Global&&(e.isWGS84||e.isWebMercator);let r=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:r.signal,cache:this.cache,minDemResolution:i?eht:0}).then(n=>this._updateSurfaceAltitude(n.geometry.z??0)).catch(n=>{Fn(n)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===r&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),r=null}),this._pendingElevationQueryController=r,Lo.YIELD}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(H8,this._estimatedSurfaceAltitude,this._camera.eye),Po(this._get("renderLocation"),H8)||(this._set("renderLocation",se(this._propertiesPool.get("renderLocation"),H8)),this.notifyChange("renderLocation"))}};h([f({constructOnly:!0})],od.prototype,"scheduler",void 0),h([f({constructOnly:!0})],od.prototype,"cache",void 0),h([f({constructOnly:!0})],od.prototype,"task",void 0),h([f({readOnly:!0})],od.prototype,"location",null),h([f({constructOnly:!0})],od.prototype,"map",void 0),h([f({readOnly:!0})],od.prototype,"renderLocation",void 0),h([f({readOnly:!0})],od.prototype,"scale",null),h([f({readOnly:!0})],od.prototype,"updating",null),od=h([z("esri.views.3d.support.CameraOnSurface")],od);const H8=C(),Qut=1e5,eht=1e6,tht=Array;let Gu=class extends Sy{constructor(e){super(e),this._propertiesPool=new Og({location:lt,renderLocation:tht},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=C(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=pr(this._frameWorker),this._propertiesPool=Pe(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,Lo.YIELD}_updateRenderLocation(){const e=rht;let i=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const r=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!i&&r&&(i=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),i&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const n=nht;i&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,n)&&(se(e,n),this._currentSurfaceAltitude=this._latestSurfaceAltitude),i?this.distance=br(this._camera.eye,e):(te(e,this._camera.viewForward,this._get("distance")),ce(e,e,this._camera.eye)),Po(this._get("renderLocation"),e)||this._set("renderLocation",se(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,i){const r=this._camera;if(!this.renderCoordsHelper.intersectInfiniteManifold(r.ray,e,i))return!1;if(this.state.isGlobal){const n=Fi(this.renderCoordsHelper.spatialReference).radius,s=n+e,o=Oo(r.eye),a=o<s*s,l=br(r.eye,i);if(a&&l>n/4){const c=s-Math.sqrt(o);return te(i,r.viewForward,c),ce(i,i,r.eye),!0}}else{const n=this.surface?.ready?this.surface.extent:null;n!=null&&oF(n,this.surface?.spatialReference,iC,this.renderCoordsHelper.spatialReference)&&(i[0]=_e(i[0],iC[0],iC[2]),i[1]=_e(i[1],iC[1],iC[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,i){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,i)){if(nr.TESTS_DISABLE_OPTIMIZATIONS)return!0;const r=this._camera.eye,n=br(r,e),s=br(r,i);if(Math.abs(s-n)/n>iht)return!0}return!1}};h([f({constructOnly:!0})],Gu.prototype,"scheduler",void 0),h([f({constructOnly:!0})],Gu.prototype,"task",void 0),h([f()],Gu.prototype,"distance",void 0),h([f({constructOnly:!0})],Gu.prototype,"estimateSurfaceAltitudeAtCenter",void 0),h([f({readOnly:!0})],Gu.prototype,"location",null),h([f({readOnly:!0})],Gu.prototype,"renderLocation",void 0),h([f()],Gu.prototype,"updating",void 0),Gu=h([z("esri.views.3d.support.CenterOnSurface")],Gu);const iht=.05,rht=C(),nht=C(),iC=Gt();let sht=class{constructor(e){this._handles=new Dg,this.events=new Tn,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",i=>this._layerViewsChanged(i))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=Pe(this._handles),this._contentLayerViews.destroy()}_layerViewsChanged(e){e.added.forEach(i=>{i.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(i.on("visible-geometry-changed",()=>this._contentChanged()),i.uid)}),e.removed.forEach(i=>this._handles.remove(i.uid))}_contentChanged(){this.events.emit("request-update",oht)}};const oht={},aht=Array;let Xp=class extends Sy{constructor(e){super(e),this._propertiesPool=new Og({location:lt,renderLocation:aht},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.addHandles([le(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),le(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.addHandles(this.scheduler.registerTask(ut.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=Pe(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),i=this.centerOnSurface.renderLocation,r=this.renderCoordsHelper,n=this.state.contentCamera;this._dirty=!1,r.worldUpAtPosition(i,uoe);const s=Math.max(0,(Math.acos(me(uoe,n.viewForward))-.5*Math.PI)*(n.aboveGround?1:-1));if(Number.isNaN(s)){if(!e||!xb(e,i)){const c=this._propertiesPool.get("renderLocation");se(c,i),this._set("renderLocation",c)}return Lo.YIELD}const o=1-_e(s/(.5*Math.PI),0,1),a=o*o*o;this._calculateScreenHorizontalEdgeOnSurface(hoe);const l=this._propertiesPool.get("renderLocation");return Ui(l,i,hoe,a),e&&xb(e,l)||this._set("renderLocation",l),Lo.YIELD}_calculateScreenHorizontalEdgeOnSurface(e){const i=this.state.contentCamera,r=i.getRenderCenter(Mo());if(r[1]=i.aboveGround?i.padding[Xt.BOTTOM]:i.fullHeight-i.padding[Xt.TOP],this.estimateSurfaceIntersectionAtRenderPoint(r,e))return e;const n=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(i.unprojectFromRenderScreen(r,rC)){he(rC,rC,i.eye);const s=ge(rC,rC);if(this.renderCoordsHelper.intersectInfiniteManifold(pu(i.eye,s),n,e))return e}return this.renderCoordsHelper.setAltitude(e,n,i.eye)}updateRenderLocation(){this._dirty=!0}};h([f()],Xp.prototype,"_dirty",void 0),h([f({constructOnly:!0})],Xp.prototype,"scheduler",void 0),h([f({constructOnly:!0})],Xp.prototype,"centerOnSurface",void 0),h([f({constructOnly:!0})],Xp.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),h([f({readOnly:!0})],Xp.prototype,"updating",null),h([f({readOnly:!0})],Xp.prototype,"location",null),h([f({readOnly:!0})],Xp.prototype,"renderLocation",void 0),Xp=h([z("esri.views.3d.support.pointsOfInterest.Focus")],Xp);const uoe=C(),rC=C(),hoe=C();let Dm=class extends xe{get surface(){return this.view.map?.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=C();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null}initialize(){this.view.state.isLocal&&(this.addHandles([le(()=>[this.surfaceView?.spatialReference,this.surfaceView?.extent],()=>this._update()),Io(()=>this.surface?.layers,"change",()=>this._update())]),this._update())}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),this.surfaceView?.extent==null||this.surfaceView.spatialReference==null)return void this._set("location",null);const e=xq(this.surfaceView.extent),i=new lt({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(i,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(r=>{this._updateController=null,this._set("location",r.geometry)}).catch(r=>{Fn(r)||r&&r.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",r)})):this._set("location",i)}};h([f({constructOnly:!0})],Dm.prototype,"view",void 0),h([f({constructOnly:!0})],Dm.prototype,"cache",void 0),h([f()],Dm.prototype,"surface",null),h([f()],Dm.prototype,"surfaceView",null),h([f({readOnly:!0})],Dm.prototype,"location",void 0),h([f({readOnly:!0})],Dm.prototype,"renderLocation",null),Dm=h([z("esri.views.3d.terrain.StableSurfaceCenter")],Dm);let Nm=class extends xe{constructor(e){super(e),this._tileGeometryUpdateExtent=mh(),this._tileGeometryUpdateSpatialReference=null,this.events=new Tn,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(ut.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",lht),mh(this._tileGeometryUpdateExtent),this._set("updating",!1)),Lo.YIELD}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,Hy(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let i=1;i<this.centerOnSurfaces.length;i++){const r=this.centerOnSurfaces[i];r.distance>e.distance&&(e=r)}return e}_centerIntersectsExtent(e,i){const r=this.state.contentCamera.eye,n=cht,s=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(r,wv,i),this.renderCoordsHelper.fromRenderCoords(s.renderLocation,xv,i),wv[0]<xv[0]?(n[0]=wv[0],n[2]=xv[0]):(n[0]=xv[0],n[2]=wv[0]),wv[1]<xv[1]?(n[1]=wv[1],n[3]=xv[1]):(n[1]=xv[1],n[3]=wv[1]),k4(n,e)}};h([f({constructOnly:!0})],Nm.prototype,"state",void 0),h([f({constructOnly:!0})],Nm.prototype,"centerOnSurfaces",void 0),h([f({constructOnly:!0})],Nm.prototype,"renderCoordsHelper",void 0),h([f({constructOnly:!0})],Nm.prototype,"scheduler",void 0),h([f({constructOnly:!0})],Nm.prototype,"surface",void 0),h([f({readOnly:!0})],Nm.prototype,"updating",void 0),Nm=h([z("esri.views.3d.support.SurfaceGeometryUpdates")],Nm);const lht={},wv=C(),xv=C(),cht=mh();let sl=class extends xe{constructor(e){super(e),this._handles=new Dg,this._tmpRay=_s(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new Og({renderPointOfView:uht},this),this.renderPointOfView=C(),this._pois=new Array,this._debugCenters=new Map}initialize(){const{state:e,basemapTerrain:i,renderCoordsHelper:r,map:n}=this.view;this._surfaceIntersector=_h(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=ho.MIN,this._contentIntersector=_h(e.viewingMode);const s=()=>this._estimateSurfaceAltitudeAtCenter(),o=this.view.resourceController.scheduler,a=this.view.basemapTerrain?.elevationQueryCache,l={state:e,scheduler:o,surface:i,renderCoordsHelper:r};this._set("centerOnSurfaceInfrequent",new Gu({...l,task:ut.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnSurfaceFrequent",new Gu({...l,task:ut.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnContent",new Gu({...l,task:ut.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new od({...l,cache:a,task:ut.POINT_OF_INTEREST_INFREQUENT,map:n})),this._set("surfaceGeometryUpdates",new Nm({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new sht({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:r})),this._set("surfaceOrigin",new Dm({cache:a,view:this.view})),this._set("focus",new Xp({state:e,scheduler:o,surface:i,renderCoordsHelper:r,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(u,d)=>this._estimateSurfaceIntersectionAtRenderPoint(u,this.view.state.contentCamera,d)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const c=this.view.graphics;this._debugCenters.set(this.centerOnContent,new b2(c,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new b2(c,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new b2(c,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new b2(c,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new b2(c,"green","Focus")),this._handles.add([le(()=>e.contentCamera,u=>this._cameraChanged(u),qi),le(()=>i.extent,()=>this._updateCenterPointsOfInterest()),ac(()=>!i.updating,()=>this._updateCenterPointsOfInterest(),qi),Io(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),Io(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),ac(()=>nr.SHOW_POI,u=>this._setDebug(u),Zi)]),this._cameraChanged(this.view.state.contentCamera);for(const u of this._pois)u.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){return!(!this.surfaceGeometryUpdates?.updating&&!this._pois.some(e=>e.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return e==null||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,bx,dht)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(bx):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(e==null)return this._surfaceAltitudeAtCenter;const i=e.origin,r=ce(bx,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,i,r),this._surfaceIntersector.results.min.getIntersectionPoint(bx)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(bx)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,i,r){const n=YY(i,e,hht);if(n==null)return null;const s=n.origin,o=ce(bx,n.origin,n.direction);return this._surfaceIntersector.resetWithRay(n,i),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,s,o),this._surfaceIntersector.results.min.getIntersectionPoint(r)?r:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const i=e.eye;Po(this.renderPointOfView,i)||this._set("renderPointOfView",se(this._propertiesPool.get("renderPointOfView"),i))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(i=>i.hide()),void this._handles.remove("debug");for(const i of this._pois)this._handles.add(le(()=>i.renderLocation,r=>this._debugCenters.get(i)?.show(r,i.renderCoordsHelper.spatialReference),Zi),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};h([f({readOnly:!0})],sl.prototype,"centerOnContent",void 0),h([f({readOnly:!0})],sl.prototype,"centerOnSurfaceFrequent",void 0),h([f({readOnly:!0})],sl.prototype,"centerOnSurfaceInfrequent",void 0),h([f({readOnly:!0})],sl.prototype,"cameraOnSurface",void 0),h([f({readOnly:!0})],sl.prototype,"focus",void 0),h([f({readOnly:!0})],sl.prototype,"renderPointOfView",void 0),h([f({readOnly:!0})],sl.prototype,"surfaceOrigin",void 0),h([f({readOnly:!0})],sl.prototype,"contentGeometryUpdates",void 0),h([f({readOnly:!0})],sl.prototype,"surfaceGeometryUpdates",void 0),h([f({constructOnly:!0})],sl.prototype,"view",void 0),h([f({readOnly:!0})],sl.prototype,"updating",null),sl=h([z("esri.views.3d.support.PointsOfInterest")],sl);const uht=Array,bx=C(),hht=_s(),dht={exclude:new Set([wy])},pht=(t=>t)(["operational-layers","basemap","ground"]),By=new ft,R3=new WeakMap;function fht(t){ght(t)&&By.push(new WeakRef(t))}function mht(t){const e=By.find(i=>i.deref()===t);e&&By.remove(e)}function ght(t){return t!=null&&typeof t=="object"&&"refreshInterval"in t&&"refresh"in t}function sEe(t,e){return Number.isFinite(t)&&Number.isFinite(e)?e<=0?t:sEe(e,t%e):0}let q8=0,M$=0;function yht(){const t=Date.now();let e=!1;for(const i of By){const r=i.deref();r?r.refreshInterval&&t-(R3.get(r)??0)+5>=6e4*r.refreshInterval&&(R3.set(r,t),r.refresh(t)):e=!0}if(e)for(let i=By.length-1;i>=0;i--)By.at(i).deref()||By.removeAt(i)}ghe(()=>{const t=Date.now();let e=0;for(const i of By){const r=i.deref();r&&(e=sEe(Math.round(6e4*r.refreshInterval),e),r.refreshInterval?R3.get(r)||R3.set(r,t):R3.delete(r))}if(e!==M$){if(M$=e,clearInterval(q8),M$===0)return void(q8=0);q8=setInterval(yht,M$)}});function _ht(t){return t!=null&&typeof t=="object"&&"refreshTimestamp"in t&&"refresh"in t}const doe=.1,bFt=t=>{let e=class extends t{constructor(...i){super(...i),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=CH(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||fht(this)},()=>{})}destroy(){mht(this)}castRefreshInterval(i){return i>=doe?i:i<=0?0:doe}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(i=Date.now()){B3(this._debounceHasDataChanged()).then(r=>{r&&this._set("refreshTimestamp",i),this.emit("refresh",{dataChanged:r})},r=>{ne.getLogger(this).error(r),this.emit("refresh",{dataChanged:!1,error:r})})}async hasDataChanged(){return!0}get test(){const i=this;return{set refreshInterval(r){i._set("refreshInterval",r)}}}};return h([f({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:pht}}}}})],e.prototype,"refreshInterval",void 0),h([rr("refreshInterval")],e.prototype,"castRefreshInterval",null),h([f({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),h([f({readOnly:!0})],e.prototype,"refreshParameters",null),e=h([z("esri.layers.mixins.RefreshableLayer")],e),e};let vht=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,i){this._store.put(e,i,i.values.byteLength+256)}},bht=class{constructor(e,i,r,n){this._hasNoDataValues=null,this._minValue=null,this._maxValue=null,"pixelData"in e?(this.values=e.pixelData,this.width=e.width,this.height=e.height,this.noDataValue=e.noDataValue):(this.values=e,this.width=i,this.height=r,this.noDataValue=n)}get hasNoDataValues(){if(this._hasNoDataValues==null){const e=this.noDataValue;this._hasNoDataValues=this.values.includes(e)}return this._hasNoDataValues}get minValue(){return this._ensureBounds(),this._minValue}get maxValue(){return this._ensureBounds(),this._maxValue}_ensureBounds(){if(this._minValue!=null)return;const{noDataValue:e,values:i}=this;let r=1/0,n=-1/0,s=!0;for(const o of i)o===e?this._hasNoDataValues=!0:(r=o<r?o:r,n=o>n?o:n,s=!1);s?(this._minValue=0,this._maxValue=0):(this._minValue=r,this._maxValue=n>-3e38?n:0)}},oEe=class{constructor(e,i,r,n,s={}){this._mainMethod=i,this._transferLists=r,this._listeners=[],this._promise=cUe(e,{...s,schedule:n}).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,s.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>ne.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${o}`))}on(e,i){const r={removed:!1,eventName:e,callback:i,threadHandle:null};return this._listeners.push(r),this._connectListener(r),Mi(()=>{r.removed=!0,vH(this._listeners,r),this._thread&&r.threadHandle!=null&&r.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(e,i){return this.invokeMethod(this._mainMethod,e,i)}invokeMethod(e,i,r){if(this._thread){const n=this._transferLists[e],s=n?n(i):[];return this._thread.invoke(e,i,{transferList:s,signal:r})}return this._promise?this._promise.then(()=>(Et(r),this.invokeMethod(e,i,r))):Promise.reject(null)}broadcast(e,i){return this._thread?Promise.all(this._thread.broadcast(i,e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,i)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(i=>{e.removed||(e.threadHandle=i)})}},poe=class extends oEe{constructor(e=null){super("LercWorker","_decode",{_decode:i=>[i.buffer]},e,{strategy:"dedicated"}),this.schedule=e,this.ref=0}decode(e,i,r){return e&&e.byteLength!==0?this.invoke({buffer:e,options:i},r):Promise.resolve(null)}release(){--this.ref<=0&&(P3.forEach((e,i)=>{e===this&&P3.delete(i)}),this.destroy())}};const P3=new Map;function wht(t=null){let e=P3.get(t);return e||(t!=null?(e=new poe(i=>t.immediate.schedule(i)),P3.set(t,e)):(e=new poe,P3.set(null,e))),++e.ref,e}var jl,foe,moe;(function(t){t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(jl||(jl={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.OUTLINE=2]="OUTLINE",t[t.LINE=3]="LINE",t[t.ICON=4]="ICON",t[t.CIRCLE=5]="CIRCLE",t[t.TEXT=6]="TEXT",t[t.TILEINFO=7]="TILEINFO"}(foe||(foe={})),function(t){t[t.PAINTER_CHANGED=0]="PAINTER_CHANGED",t[t.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",t[t.LAYER_CHANGED=2]="LAYER_CHANGED",t[t.LAYER_REMOVED=3]="LAYER_REMOVED",t[t.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(moe||(moe={}));let xht=class{constructor(e){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}},CFt=class{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}};function OFt(t,e,i,r,n,s){const o=i-n;if(o>=0)return(e>>o)+(r-(s<<o))*(t>>o);const a=-o;return e-(s-(r<<a))*(t>>a)<<a}let RFt=class{constructor(e,i,r){this._rows=Math.ceil(i/r),this._columns=Math.ceil(e/r),this._cellSize=r,this.cells=new Array(this._rows);for(let n=0;n<this._rows;n++){this.cells[n]=new Array(this._columns);for(let s=0;s<this._columns;s++)this.cells[n][s]=[]}}getCell(e,i){const r=Math.min(Math.max(Math.floor(i/this._cellSize),0),this._rows-1),n=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][n]||null}getCellSpan(e,i,r,n){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(n/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function Tht(t,e,i,r,n,s){const o=e[r++];for(let a=0;a<o;a++){const l=new xht(s);l.xTile=e[r++],l.yTile=e[r++],l.hash=e[r++],l.priority=e[r++];const c=e[r++];for(let p=0;p<c;p++){const m=e[r++],y=e[r++],_=e[r++],v=e[r++],w=!!e[r++],x=e[r++],T=i[r++],S=i[r++],E=e[r++],A=e[r++];l.colliders.push({xTile:m,yTile:y,dxPixels:_,dyPixels:v,hard:w,partIndex:x,width:E,height:A,minLod:T,maxLod:S})}const u=t[r++];for(let p=0;p<u;p++)l.textVertexRanges.push([t[r++],t[r++]]);const d=t[r++];for(let p=0;p<d;p++)l.iconVertexRanges.push([t[r++],t[r++]]);n.push(l)}return r}function MFt(t,e,i){for(const[r,n]of t.symbols)Sht(t,e,i,n,r)}function Sht(t,e,i,r,n){const s=t.layerData.get(n);if(s.type===jl.SYMBOL){for(const o of r){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],u=c.startOpacity,d=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&d===0;const p=i?Math.floor(127*u)|d<<7:d?255:0;l=p<<24|p<<16|p<<8|p}else l=0;for(const[c,u]of o.iconVertexRanges)for(let d=c;d<c+u;d+=4)s.iconOpacity[d/4]=l;if(o.selectedForRendering){const c=a.parts[1],u=c.startOpacity,d=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&d===0;const p=i?Math.floor(127*u)|d<<7:d?255:0;l=p<<24|p<<16|p<<8|p}else l=0;for(const[c,u]of o.textVertexRanges)for(let d=c;d<c+u;d+=4)s.textOpacity[d/4]=l}s.lastOpacityUpdate=e,s.opacityChanged=!0}}let vk=class{constructor(e,i){this.layerUIDs=[],this.isDestroyed=!1,this._data=e;let r=1;const n=new Uint32Array(e);this.layerUIDs=[];const s=n[r++];for(let o=0;o<s;o++)this.layerUIDs[o]=n[r++];this.bufferDataOffset=r,i&&(this.layer=i.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return this._data==null}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(e){this._data!=null&&(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}},Eht=class extends vk{constructor(e,i){super(e,i),this.type=jl.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const r=new Uint32Array(e);let n=this.bufferDataOffset;this.lineIndexStart=r[n++],this.lineIndexCount=r[n++];const s=r[n++];if(s>0){this.patternMap=new Map;for(let o=0;o<s;o++){const a=r[n++],l=r[n++],c=r[n++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=n}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=et(this.vao)}doPrepareForRendering(e,i,r){const n=new Uint32Array(i),s=new Int32Array(n.buffer),o=n[r++],a=Ri.createVertex(e,vi.STATIC_DRAW,new Int32Array(s.buffer,4*r,o));r+=o;const l=n[r++],c=Ri.createIndex(e,vi.STATIC_DRAW,new Uint32Array(n.buffer,4*r,l));r+=l;const u=this.layer.lineMaterial;this.vao=new bh(e,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:a},c)}},Cht=class extends vk{constructor(e,i){super(e,i),this.type=jl.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const r=new Uint32Array(e);let n=this.bufferDataOffset;this.fillIndexStart=r[n++],this.fillIndexCount=r[n++],this.outlineIndexStart=r[n++],this.outlineIndexCount=r[n++];const s=r[n++];if(s>0){this.patternMap=new Map;for(let o=0;o<s;o++){const a=r[n++],l=r[n++],c=r[n++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=n}get memoryUsed(){return(this.data?.byteLength??0)+(this.fillVAO?.usedMemory??0)+(this.outlineVAO?.usedMemory??0)}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=et(this.fillVAO),this.outlineVAO=et(this.outlineVAO)}doPrepareForRendering(e,i,r){const n=new Uint32Array(i),s=new Int32Array(n.buffer),o=n[r++],a=Ri.createVertex(e,vi.STATIC_DRAW,new Int32Array(s.buffer,4*r,o));r+=o;const l=n[r++],c=Ri.createIndex(e,vi.STATIC_DRAW,new Uint32Array(n.buffer,4*r,l));r+=l;const u=n[r++],d=Ri.createVertex(e,vi.STATIC_DRAW,new Int32Array(s.buffer,4*r,u));r+=u;const p=n[r++],m=Ri.createIndex(e,vi.STATIC_DRAW,new Uint32Array(n.buffer,4*r,p));r+=p;const y=this.layer,_=y.fillMaterial,v=y.outlineMaterial;this.fillVAO=new bh(e,_.getAttributeLocations(),_.getLayoutInfo(),{geometry:a},c),this.outlineVAO=new bh(e,v.getAttributeLocations(),v.getLayoutInfo(),{geometry:d},m)}},Aht=class extends vk{constructor(e,i,r){super(e,i),this.type=jl.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const n=new Uint32Array(e),s=new Int32Array(e),o=new Float32Array(e);let a=this.bufferDataOffset;this.isIconSDF=!!n[a++];const l=n[a++];for(let p=0;p<l;p++){const m=n[a++],y=n[a++],_=n[a++];this.iconPerPageElementsMap.set(m,[y,_])}const c=n[a++];for(let p=0;p<c;p++){const m=n[a++],y=n[a++],_=n[a++];this.glyphPerPageElementsMap.set(m,[y,_])}const u=n[a++],d=n[a++];this.iconOpacity=new Int32Array(u),this.textOpacity=new Int32Array(d),a=Tht(n,s,o,a,this.symbols,r),this.bufferDataOffset=a}get memoryUsed(){return(this.data?.byteLength??0)+(this.iconVAO?.usedMemory??0)+(this.textVAO?.usedMemory??0)+Jy(this.iconOpacity)+Jy(this.textOpacity)}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[i,r]of this.iconPerPageElementsMap)e+=r[1];for(const[i,r]of this.glyphPerPageElementsMap)e+=r[1];return e/3}doDestroy(){this.iconVAO=et(this.iconVAO),this.textVAO=et(this.textVAO)}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,i=this.iconVAO.vertexBuffers.opacity;e.length>0&&e.byteLength===i.byteLength&&i.setSubData(e,0,0,e.length);const r=this.textOpacity,n=this.textVAO.vertexBuffers.opacity;r.length>0&&r.byteLength===n.byteLength&&n.setSubData(r,0,0,r.length)}doPrepareForRendering(e,i,r){const n=new Uint32Array(i),s=new Int32Array(n.buffer),o=n[r++],a=Ri.createVertex(e,vi.STATIC_DRAW,new Int32Array(s.buffer,4*r,o));r+=o;const l=n[r++],c=Ri.createIndex(e,vi.STATIC_DRAW,new Uint32Array(n.buffer,4*r,l));r+=l;const u=n[r++],d=Ri.createVertex(e,vi.STATIC_DRAW,new Int32Array(s.buffer,4*r,u));r+=u;const p=n[r++],m=Ri.createIndex(e,vi.STATIC_DRAW,new Uint32Array(n.buffer,4*r,p));r+=p;const y=Ri.createVertex(e,vi.STATIC_DRAW,this.iconOpacity.buffer),_=Ri.createVertex(e,vi.STATIC_DRAW,this.textOpacity.buffer),v=this.layer,w=v.iconMaterial,x=v.textMaterial;this.iconVAO=new bh(e,w.getAttributeLocations(),w.getLayoutInfo(),{geometry:a,opacity:y},c),this.textVAO=new bh(e,x.getAttributeLocations(),x.getLayoutInfo(),{geometry:d,opacity:_},m)}},Oht=class extends vk{constructor(e,i){super(e,i),this.type=jl.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const r=new Uint32Array(e);let n=this.bufferDataOffset;this.circleIndexStart=r[n++],this.circleIndexCount=r[n++],this.bufferDataOffset=n}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=et(this.vao)}doPrepareForRendering(e,i,r){const n=new Uint32Array(i),s=new Int32Array(n.buffer),o=n[r++],a=Ri.createVertex(e,vi.STATIC_DRAW,new Int32Array(s.buffer,4*r,o));r+=o;const l=n[r++],c=Ri.createIndex(e,vi.STATIC_DRAW,new Uint32Array(n.buffer,4*r,l));r+=l;const u=this.layer.circleMaterial;this.vao=new bh(e,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:a},c)}};const FFt=!0,kFt=32,goe=200,Rht=1/ie("mapview-transitions-duration");let Pht=class extends Tn{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){if(this._stage===e)return;const i=this._stage;this._stage=e,e?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):i?.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return this._transforms==null&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=vs(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=vs(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){this._fadeInResolver?.(),this._fadeInResolver=null,this._fadeOutResolver?.(),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale),this.setTransform(e.state)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){this.parent?.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(e,i){if(this.fadeTransitionEnabled){const r=this._fadeOutResolver||!this.visible?0:this.opacity,n=this.computedOpacity;if(n===r)this.computedVisible=this.visible;else{const s=e*Rht;this.computedOpacity=n>r?Math.max(r,n-s):Math.min(r,n+s),this.computedVisible=this.computedOpacity>0;const o=r===this.computedOpacity;this.inFadeTransition=!o,o||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},Wb=class p1{static getId(e,i,r,n){return typeof e=="object"?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${i}/${r}/${n}`}constructor(e,i,r,n){this.set(e,i,r,n)}get key(){return this}get id(){return this.toString()}set id(e){this.set(e)}get hash(){const e=4095&this.row,i=4095&this.col,r=63&this.level;return(3&this.world)<<30|i<<22|e<<8|r}acquire(e,i,r,n){this.set(e,i,r,n)}contains(e){const i=e.level-this.level;return i>=0&&this.row===e.row>>i&&this.col===e.col>>i&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new p1(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,i,r,n){if(e==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof e=="object")this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if(typeof e=="string"){const[s,o,a,l]=e.split("/");this.level=parseFloat(s),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+e,this.row=+i,this.col=+r,this.world=+n||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new p1(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const e=this.level+1,i=this.row<<1,r=this.col<<1,n=this.world;return[new p1(e,i,r,n),new p1(e,i,r+1,n),new p1(e,i+1,r,n),new p1(e,i+1,r+1,n)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}};Wb.pool=new aa(Wb,null,null,25,50);let aEe=class extends Pht{constructor(e,i,r,n,s,o,a=s,l=o){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new Wb(e),this.resolution=i,this.x=r,this.y=n,this.width=s,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(e){const i=this.resolution/(e.resolution*e.pixelRatio),r=this.transforms.tileMat3,[n,s]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*i,a=this.height/this.rangeY*i;BW(r,o,0,0,0,a,0,n,s,1),tS(this.transforms.dvs,e.displayViewMat3,r)}},W8=class lEe extends aEe{constructor(e,i,r,n,s,o,a,l=null){super(e,i,r,n,s,o,4096,4096),this.styleRepository=a,this._memCache=l,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.id=e.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<goe}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<goe)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this._processed=!0}deleteLayerData(e){let i=!1;for(const r of e){const n=this.layerData.get(r);n&&(this._memoryUsedByLayerData-=n.memoryUsed,n.type===jl.SYMBOL&&this.symbols.delete(r)&&(i=!0),n.destroy(),this.layerData.delete(r))}this._memCache?.updateSize(this.key.id,this,this._memoryUsedByLayerData),i&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerData.size>0}dispose(){this.status!=="unloaded"&&(cEe.delete(this),lEe._destroyRenderBuckets(this.layerData),this.layerData=null,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsed(){return this._memoryUsedByLayerData+256}changeDataImpl(e){let i=!1;if(e){const{bucketsWithData:r,emptyBuckets:n}=e,s=this._createRenderBuckets(r);if(n&&n.byteLength>0){const o=new Uint32Array(n);for(const a of o)this._deleteLayerData(a)}for(const[o,a]of s)this._deleteLayerData(o),a.type===jl.SYMBOL&&(this.symbols.set(o,a.symbols),i=!0),this._memoryUsedByLayerData+=a.memoryUsed,this.layerData.set(o,a);this._memCache?.updateSize(this.key.id,this,this.memoryUsed)}this._hasSymbolBuckets=!1;for(const[r,n]of this.layerData)n.type===jl.SYMBOL&&(this._hasSymbolBuckets=!0);i&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(i){i.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const i=this.resolution/(e.resolution*e.pixelRatio),r=this.width/this.rangeX*i,n=this.height/this.rangeY*i,s=[0,0];e.toScreen(s,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;VW(o),bN(o,o,s),GW(o,o,Math.PI*e.rotation/180),jW(o,o,[r,n,1])}_createTransforms(){return{dvs:sa(),tileMat3:sa(),tileUnitsToPixels:sa()}}static _destroyRenderBuckets(e){if(!e)return;const i=new Set;for(const r of e.values())i.has(r)||(r.destroy(),i.add(r));e.clear()}_createRenderBuckets(e){const i=new Map,r=new Map;for(const n of e){const s=this._deserializeBucket(n,r);for(const o of s.layerUIDs)i.set(o,s)}return i}_deserializeBucket(e,i){let r=i.get(e);if(r)return r;switch(new Uint32Array(e)[0]){case jl.FILL:r=new Cht(e,this.styleRepository);break;case jl.LINE:r=new Eht(e,this.styleRepository);break;case jl.SYMBOL:r=new Aht(e,this.styleRepository,this);break;case jl.CIRCLE:r=new Oht(e,this.styleRepository)}return i.set(e,r),r}_deleteLayerData(e){if(!this.layerData.has(e))return;const i=this.layerData.get(e);this._memoryUsedByLayerData-=i.memoryUsed,i.destroy(),this.layerData.delete(e)}};const cEe=new Map;function Mht(){cEe.forEach((t,e)=>{console.log(`
${e.key}:`),t[0].forEach(i=>console.log(i)),console.log("========"),t[1].forEach(i=>console.log(i))})}const BFt={value:.5,readOnly:!0},$ht={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let J2=class{constructor(e=0,i=0){this.min=e,this.max=i,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},Iht=class{constructor(e,i){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(i[2]-i[0]),this.dy=(e.width-1)/(i[3]-i[1]),this.x0=i[0],this.y1=i[3]}},Lht=class{constructor(e,i,r){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=i,this.samplerData=new Iht(r,i)}computeMinMaxValue(e,i,r,n){n.min=1/0,n.max=-1/0,n.hasNoDataValues=!1;const s=e-this.level;if(s<=0)return n;const o=2**s;if(!(Math.floor(i/o)===this.i&&Math.floor(r/o)===this.j))return n;let a=1/0,l=-1/0;const c=this.samplerData.data.width,u=this.samplerData.data.values,d=.5*hO;let p=(c-1)/o,m=(r-this.j*o)*p,y=(i-this.i*o)*p;if(p<1){const _=Math.floor(m),v=Math.floor(y),w=_+v*c,x=u[w],T=u[w+1],S=u[w+c],E=u[w+c+1];if(x+T+S+E<d){const A=m-_,P=y-v,N=kP(x,T,S,E,A,P),F=kP(x,T,S,E,A+p,P),D=kP(x,T,S,E,A,P+p),$=kP(x,T,S,E,A+p,P+p);return n.min=Math.min(N,F,D,$),n.max=Math.max(N,F,D,$),n}m=_,y=v,p=1}else m=Math.floor(m),y=Math.floor(y),p=Math.ceil(p);for(let _=m;_<=m+p;_++)for(let v=y;v<=y+p;v++){const w=u[_+v*c];w<d?(a=Math.min(a,w),l=Math.max(l,w)):n.hasNoDataValues=!0}return n.min=a,n.max=l,n}};const Dht=.5*hO;function Xr(t,e,i){if(i==null)return null;for(const r of i){if(!r)continue;const n=r.safeWidth;let s=_e(r.dy*(r.y1-e),0,n),o=_e(r.dx*(t-r.x0),0,n);const a=Math.floor(s),l=Math.floor(o),c=r.data.width,u=a*c+l,d=r.data.values,p=d[u],m=d[u+1],y=u+c,_=d[y],v=d[y+1];if(p+_+m+v<Dht){s-=a,o-=l;const w=p+(m-p)*o;return w+(_+(v-_)*o-w)*s}}return null}let Bu=class extends xe{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(i=>{const r=i.layer;if(r.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const n=uEe(r.fullExtent,this.viewSpatialReference);n!=null&&e.push(Lpe(n))}}),e}};function Nht(t,e){return t===Me.Global?new Oj(e):new Rj(e)}h([f({readOnly:!0})],Bu.prototype,"layerViewsExtent",null),h([f({readOnly:!0})],Bu.prototype,"tiledLayersExtent",null),h([f({readOnly:!0})],Bu.prototype,"stencilEnabledExtents",null),h([f()],Bu.prototype,"viewSpatialReference",void 0),h([f()],Bu.prototype,"tilingScheme",void 0),h([f()],Bu.prototype,"defaultTiledLayersExtent",void 0),h([f({constructOnly:!0})],Bu.prototype,"layers",void 0),h([f({constructOnly:!0})],Bu.prototype,"layerViews",void 0),Bu=h([z("esri.views.3d.terrain.ExtentHelper")],Bu);let Oj=class extends Bu{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?C_e:K9e}};Oj=h([z("esri.views.3d.terrain.ExtentHelperGlobal")],Oj);let Rj=class extends Bu{_computeLayerViewsExtent(){const e=mh(),i=this.viewSpatialReference;this.layerViews.forEach(s=>{const o=s.layer;if(s.isResolved()&&(o.type!=="graphics"||!o.internal)){const a=uEe("fullExtentInLocalViewSpatialReference"in s&&s.fullExtentInLocalViewSpatialReference||s.layer.fullExtent,i);Hy(e,a,e)}});const r=HB(e)?e:null,n=this._get("layerViewsExtent");return Z1(r,n)?n:r}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const i=this.viewSpatialReference,r=mh();this.layers.forEach(o=>{if(o.loaded&&GA(o)){const a=_k(o,i,Me.Local);if(a==null)return;const{tileInfo:l,fullExtent:c}=a;l!=null&&c!=null&&(v5(o)||e.compatibleWith(l)&&c.spatialReference.equals(e.spatialReference))&&Hy(r,c,r)}}),Hy(r,this.defaultTiledLayersExtent,r);const n=HB(r)?r:null,s=this._get("tiledLayersExtent");return Z1(n,s)?s:n}};function uEe(t,e){return t==null||t.spatialReference.equals(e)?t:WA(t,t.spatialReference,e)}Rj=h([z("esri.views.3d.terrain.ExtentHelperLocal")],Rj);var Vt;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.MAP=1]="MAP"})(Vt||(Vt={}));const f1=[Vt.ELEVATION,Vt.MAP];function hEe(){const t=globalThis.require?.modules;if(t){const e=Object.keys(t);for(const i of e)i.includes(".glsl")&&delete t[i]}}const dEe=1.3,Fht=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let I0,rl=class extends xe{get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||nr.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return this._spatialReference!=null&&this._spatialReference.isGeographic&&!this.view.state.isLocal?Fi(this._spatialReference).metersPerDegree:1}get _overlayStretch(){return dEe/this.view.resolutionScale}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get rendersOccluded(){return this.renderer.rendersOccluded}constructor(e){super(e),this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=ie("esri-mobile")?2048:4096,this._animationTimeLast=0}initialize(){const e=this.view;this.renderer=new rd({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),e._stage.renderer.renderPlugins.add(this.renderer);const i=()=>this.setDrawTexturesDirty();this._groundIntersector=_h(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this.addHandles([le(()=>this.renderer.hasHighlights,i),this.renderer.events.on("has-water",r=>e._stage?.renderer.setParameters({hasOverlayWater:r})),this.renderer.events.on("renders-occluded",()=>{i(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",i),le(()=>e.state.camera.pixelRatio,i),le(()=>e.state.alignPixelEnabled,i),this.renderer.events.on("textures-disposed",()=>this.surface.requestRender()),le(()=>[e.pointsOfInterest?.renderPointOfView,e.pointsOfInterest?.centerOnSurfaceFrequent?.location],()=>this.setPlacementDirty()),le(()=>[e.state?.pixelRatio,e.state?.contentPixelRatio],()=>this.setPlacementDirty(),qi),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(ut.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",r=>{this._updateOverlays(Da,r.camera,_n.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlays(_n.BACKGROUND,r)})]),e._stage.renderer.renderOverlay=r=>this._renderOverlay(r)}_renderOverlay(e){if(this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays)return this._dispatchAnimationUpdate(e),this._drawOverlays(_n.UPDATE,this.view.state)}destroy(){this.view?._stage&&(this.view._stage.renderer.renderPlugins.remove(this.renderer),this.view._stage.renderer.renderOverlay=()=>{}),I0&&(I0.hide(),I0=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const i=this.view.renderSpatialReference;e!=null&&i!=null?(this._renderSR=i,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new t_(-20037508342787e-6,20037508342787e-6):new t_(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}registerDrapeSource(e,i,r){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const n=this.renderer.createDrapeSourceRenderer(e,i,r);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),n}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,Ic)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&e.setDrapingExtent!=null&&this._spatialReference!=null&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this.view.state.contentCamera,_n.UPDATE)}_updateOverlays(e,i,r){if(!this._spatialReference)return Lo.YIELD;const n=this._computeOverlayResolution(i);this._computeOverlayExtents(i,n,Ep),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources,Ep.stretch);const s=this._updateOverlay(zn.INNER,Ep.inner,n,1*Ep.pixelRatioAdjustment,Ep.mapUnitsPerPixel),o=ea(Ep.inner)/ea(Ep.outer),a=this._updateOverlay(zn.OUTER,Ep.outer,n,o*Ep.pixelRatioAdjustment,Ep.mapUnitsPerPixel);s!==tf.EXTENT&&a!==tf.EXTENT||(this._drapeSources.forEach(l=>this._updateDrapeSourceExtent(l)),this.surface.updateTileOverlayParams(r)),s===tf.NONE&&a===tf.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const i=this.view.state.contentPixelRatio*this.view.resolutionScale,r=e.fullWidth/e.pixelRatio*i,n=e.fullHeight/e.pixelRatio*i,s=Math.ceil(1.5*Math.max(r,n));return Math.min(rb(s),this._maxResolution)}_updateOverlay(e,i,r,n,s){if(this.renderer.overlays.length===0)return tf.NONE;const o=this.renderer.overlays[e],a=o.mapUnitsPerPixel;if(o.mapUnitsPerPixel=s,o.pixelRatio=n,kht(i,o.extent)&&r===o.resolution)return a===s?tf.NONE:tf.RERENDER_ONLY;xg(o.extent,i),o.resolution=r;const l=xq(o.extent);return o.renderLocalOrigin=r5(l[0],l[1],0,"OV_"+this._latestOriginId++),tf.EXTENT}setTileParameters(e){const i=e.renderData.overlay;if(this.renderer.overlays.length>0){const r=this.renderer.overlays[zn.INNER],n=this.renderer.overlays[zn.OUTER],s=e.extent;this._rectInsideRect(r.extent,s)||this._rectanglesOverlap(s,r.extent)||this._rectanglesOverlap(s,n.extent)?(this._setTileOverlayData(s,zn.INNER,i),this._setTileOverlayData(s,zn.OUTER,i)):(this._clearTileOverlayData(zn.INNER,i),this._clearTileOverlayData(zn.OUTER,i))}else this._clearTileOverlayData(zn.INNER,i),this._clearTileOverlayData(zn.OUTER,i)}overlayPixelSizeInMapUnits(e,i){if(this.renderer.overlays.length===0)return i();const r=this.renderer.overlays[zn.INNER],n=this.renderer.overlays[zn.OUTER],s=this._pointIsInExtent(e,r.extent)?r:n;return(s.extent[2]-s.extent[0])/s.resolution}_setTileOverlayData(e,i,r){if(this.renderer.overlays.length===0)return;const n=this.renderer.overlays[i].extent,s=ea(n),o=pl(n);let a=e[0];if(this._longitudeCyclical){a=this._longitudeCyclical.minimalMonotonic(n[0],a);const l=this._longitudeCyclical.minimalMonotonic(n[0],e[2]);a>l&&(a=l-(e[2]-e[0]))}r.setScale(i,ea(e)/s,pl(e)/o),r.setOffset(i,(a-n[0])/s,(e[1]-n[1])/o)}_clearTileOverlayData(e,i){i.setScale(e,-1,-1),i.setOffset(e,-1,-1)}async reloadShaders(){hEe(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(Da)}_dispatchAnimationUpdate(e){const i=e-this._animationTimeLast;if(i>=this.surface.view._stage.renderer.animationTimestep||this.view.state.forcedAnimationTime!=null||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const r=i/this.surface.view._stage.renderer.animationTimeDilation,n=new owe(this.view.state.camera,r,this.view.state.forcedAnimationTime);this.renderer.updateAnimation(n)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,i,r,n){const s=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,Vht,i,r);if(s==null)return!1;const o=s.origin,a=ce($$,s.origin,s.direction);return this._groundIntersector.reset(o,a,e),this._groundIntersector.intersect([]),this.view.basemapTerrain.intersect(this._groundIntersector,null,o,a),this._groundIntersector.results.min.getIntersectionPoint(n)}_findHorizonBasedPointOfInterest(e,i){let r=.5;const n=.55,s=this.view.renderCoordsHelper.getAltitude(e.eye),o=this.view.pointsOfInterest.centerOnSurfaceFrequent,a=1e-5,l=_e(o.estimatedSurfaceAltitude,e.aboveGround?-1/0:s+a,e.aboveGround?s-a:1/0),c=e.aboveGround;if(this.view.viewingMode==="global"){const u=$$;BS(lF(cF,Fi(this.view.spatialReference).radius+l),pu(e.eye,e.viewForward),u),he(u,u,e.eye);const d=i_.normalize(L0e(e.viewForward,u,e.viewRight))/e.fovY+.5,p=d<=0||d>=1?.5:n;r=c?p*d:d+p*(1-d)}else{const u=.5*Math.PI-Math.acos(-e.viewForward[2]),d=Math.tan(u),p=Mt(0,d,1,0),m=Xc(p,p,e.projectionMatrix)[1],y=_e(.5+.5*m,0,1);r=y===1||y===0?.5:c?y*n:1-(1-y)*n}return!!this._intersectGroundFromView(e,.5,r,i)&&R4(i,e.eye)<o.distance*o.distance}_computeOverlayExtents(e,i,r){const n=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s=C();this._findHorizonBasedPointOfInterest(e,s)||se(s,n),nr.OVERLAY_SHOW_CENTER?(I0==null&&(I0=new b2(this.view.graphics,"red")),I0.show(s,this._renderSR)):I0?.hide();const o=Math.max(.1,br(e.eye,s)),a=p_(this.view.renderCoordsHelper,n,e.eye);this._overlaySREqualsRenderSR||Do(s,this._renderSR,s,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&this._spatialReference&&this._spatialReference.isGeographic,u=c&&this._spatialReference?1/Fi(this._spatialReference).metersPerDegree:1,d=this.view.state.contentPixelRatio,p=e.perScreenPixelRatio/d*o*u;r.mapUnitsPerPixel=p/this._worldToPCSRatio,r.stretch=this._overlayStretch;let m=i*p/2*r.stretch,y=!1,_=c?90:1/0;this._isSpherical&&l&&this._spatialReference&&(this._spatialReference.isWebMercator?(m/=Math.cos(kD(s[1])),_=l[3]):(y=!0,m/=Fi(this._spatialReference).metersPerDegree,_=90),m>=_&&(m=_,s[1]=0,this._spatialReference.isWebMercator&&(s[0]=0)));let v=1;y&&(v=1/Math.max(.2,Math.cos(Math.abs(Rt(s[1])))),m*v>180&&(v=180/m),r.mapUnitsPerPixel*=v);const w=Math.log(2)/12;m=Math.exp(Math.round(Math.log(m)/w)*w);const x=m*v,T=32,S=.5*i/(T*x),E=.5*i/(T*m);s[0]=Math.round(s[0]*S)/S,s[1]=Math.round(s[1]*E)/E;const A=r.inner;A[0]=s[0]-x,A[1]=s[1]-m,A[2]=s[0]+x,A[3]=s[1]+m,this._isSpherical&&this._shiftExtentToFitBounds(A,1/0,_);const P=r.outer;if(6*x>ea(l))xg(P,l);else if(Math.PI/2-Math.abs(a-Math.PI/2)<=.25*Math.PI)P[0]=A[0]-x,P[1]=A[1]-m,P[2]=A[2]+x,P[3]=A[3]+m;else{Do(e.eye,this._renderSR,$$,this._spatialReference),lf(Tv,s,$$);let F=-Math.atan2(Tv[1],Tv[0])+.125*Math.PI;F<0&&(F+=2*Math.PI);const D=Math.floor(F/(.25*Math.PI));Tb(Tv,Fht[D],2*m),Tv[0]*=v,Tv[2]*=v,cq(P,A,Tv)}if(this._isSpherical)P[0]=this._longitudeCyclical.clamp(P[0]),P[2]=this._longitudeCyclical.clamp(P[2]),P[1]=Math.max(P[1],-_),P[3]=Math.min(P[3],_);else{const F=qB(A,l,zht),D=qB(P,l,Bht);AK(F,D)&&(P[2]=P[0],P[3]=P[1])}const N=Math.abs(A[2]-A[0])/i;r.mapUnitsPerPixel=Math.max(r.mapUnitsPerPixel,N),r.pixelRatioAdjustment=r.mapUnitsPerPixel/N}_drawOverlays(e,i){if(!this.renderer.hasOverlays)return;if(!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return this.renderer;const r=this._drawTexturesDirty;this._drawTexturesDirty=this._drawTexturesAnimateDirty=!1;const n=this.renderer.computeValidity();return this.renderer.releaseRenderTargets(),this.renderer.drawOverlays(i),n!==this.renderer.computeValidity()&&this.surface.updateTileOverlayParams(_n.UPDATE),r?(this.surface.requestRender(e),e===_n.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(_n.BACKGROUND),this.renderer}_rectanglesOverlap(e,i){return e!=null&&(this._longitudeCyclical?(this._longitudeCyclical.contains(i[0],i[2],e[0])||this._longitudeCyclical.contains(i[0],i[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],i[0]))&&!(e[1]>i[3]||e[3]<i[1]):k4(e,i))}_rectInsideRect(e,i){return i!=null&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],i[0])&&this._longitudeCyclical.contains(e[0],e[2],i[2])&&i[1]>e[1]&&i[3]<e[3]:AK(e,i))}_pointIsInExtent(e,i){if(this._longitudeCyclical)return this._longitudeCyclical.contains(i[0],i[2],e.x)&&e.y>=i[1]&&e.y<=i[3];const r=e.x,n=e.y;return r>i[0]&&r<i[2]&&n>i[1]&&n<i[3]}_shiftExtentToFitBounds(e,i,r){let n=0,s=0;e[0]<-i?n=e[0]+i:e[2]>i&&(n=i-e[2]),e[1]<-r?s=e[1]+r:e[3]>r&&(s=r-e[3]),WD(e,n,s)}get test(){return{renderer:this.renderer,update:()=>this.runTask(Da)}}};function kht(t,e){const r=nr.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(t[2]-t[0],t[3]-t[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r&&Math.abs(e[2]-t[2])<=r&&Math.abs(e[3]-t[3])<=r}h([f()],rl.prototype,"_spatialReference",void 0),h([f({readOnly:!0})],rl.prototype,"running",null),h([f()],rl.prototype,"_placementDirty",void 0),h([f()],rl.prototype,"_contentUpdated",void 0),h([f()],rl.prototype,"_isSpherical",null),h([f()],rl.prototype,"_worldToPCSRatio",null),h([f({autoDestroy:!0})],rl.prototype,"renderer",void 0),h([f({constructOnly:!0})],rl.prototype,"view",void 0),h([f({constructOnly:!0})],rl.prototype,"surface",void 0),h([f()],rl.prototype,"suspended",null),h([f()],rl.prototype,"updating",null),h([f({type:Boolean})],rl.prototype,"rendersOccluded",null),rl=h([z("esri.views.3d.terrain.OverlayManager")],rl);let Uht=class{constructor(){this.inner=Gt(),this.outer=Gt(),this.mapUnitsPerPixel=0,this.pixelRatioAdjustment=1,this.stretch=dEe}};const Tv=Kt(),$$=C(),Ep=new Uht,zht=Gt(),Bht=Gt(),Vht=_s();var tf;(function(t){t[t.NONE=0]="NONE",t[t.EXTENT=1]="EXTENT",t[t.RERENDER_ONLY=2]="RERENDER_ONLY"})(tf||(tf={}));let Ght=class{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=vr(),this.indexCount=0,this.numVerticesPerSide=0,this.uvRange=[0,0,1,1],this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}release(){this.vertexAttributes=Jt(this.vertexAttributes),this.indices=null}},yoe=class{constructor(e,i,r,n,s){this.attributes=e,this.localOrigin=i,this.index0=r,this.stride=n,this.count=s}getVertexIndex(e){return this.getAttributeIndex(e)}getAttributeIndex(e){return Se(0<=e&&e<this.count),this.index0+this.stride*e}_getVertexRaw(e,i){this.attributes.position.getVec(e,i)}getVertexPos(e,i){this._getVertexRaw(this.getAttributeIndex(i),e),ce(e,e,this.localOrigin)}getNormal(e,i){const{typedBuffer:r,typedBufferStride:n}=this.attributes.normalCompressed;Jit(e,r,this.getAttributeIndex(i),n)}_setNormal(e,i,r,n){const{typedBuffer:s,typedBufferStride:o}=this.attributes.normalCompressed;qb(s,e,i,r,n,o)}_setUV(e,i,r){Vd(this.attributes.uv0,e,i,r)}setNormalFromValues(e,i,r,n){this._setNormal(this.getAttributeIndex(e),i,r,n)}setVertexFromValuesRawPositionUV(e,i,r,n,s,o){const a=this.getAttributeIndex(e);this.attributes.position.setValues(a,i,r,n),this._setUV(a,s,o)}setVertexFromValuesRawPositionUVNormal(e,i,r,n,s,o,a,l,c){const u=this.getAttributeIndex(e);this.attributes.position.setValues(u,i,r,n),this._setUV(u,s,o),this._setNormal(u,a,l,c)}};const _oe=16384;function Vd(t,e,i,r){t.setValues(e,i*_oe,r*_oe)}function ch(t,e,i,r){t<r[0]?r[0]=t:t>r[3]&&(r[3]=t),e<r[1]?r[1]=e:e>r[4]&&(r[4]=e),i<r[2]?r[2]=i:i>r[5]&&(r[5]=i)}let jht=class{constructor(){this.sinLonLUT=new Array(KC+1),this.cosLonLUT=new Array(KC+1),this.sinLatLUT=new Array(KC+1),this.cosLatLUT=new Array(KC+1)}update(e,i,r){const n=i[0],s=i[2];for(let o=0;o<=e;o++){const a=o/e,l=n*(1-a)+s*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);const c=r(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}},I$=class{constructor(){this.cornerTiles=[null,null,null,null],this.cornerTileSamplerVersions=[-1,-1,-1,-1]}},Hht=class{constructor(){this.cornerNeighborData=[new I$,new I$,new I$,new I$],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1],this.cornerPeerNeighbors=[null,null,null,null]}},qht=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.samplerDataVersion=0,this.neighborData=new Hht}},pEe=class YL{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=Pe(this._current),this._next=Pe(this._next),this._waiting=Pe(this._waiting),this._delayed=Pe(this._delayed)}get current(){if(this._current==null)return null;if(!this._isFadingEnabled){const i=this._delayed||this._waiting||this._next||this._current;i!==this._current&&(this._current=null,this.clear(),this._current=i)}let e=YL.test.fadeMoment;if(this._delayed!=null&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,mg.Immediate),this._delayed=null)),this._next!=null){e=e||performance.now();const i=this._fadeDuration,r=this._current!=null&&this._next.texture===this._current.texture,n=this._next.type!==ss.FADING,s=e-this._fadeStart>=i;(r||n||s)&&(Pe(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(this._next==null)return 1;const e=YL.test.fadeMoment||performance.now(),i=Math.max(0,e-this._fadeStart),r=this._fadeDuration;return i>r?0:1-i/r}get isFading(){return this._next!=null||this._delayed!=null}push(e,i=mg.Immediate){this._delayed=Pe(this._delayed),this._push(e,i)}_push(e,i){if(this._isFadingEnabled||this.clear(),this._current==null)return void(this._current=e);const r=YL.test.fadeMoment||performance.now();return i!==mg.Immediate?(this._delayed=e,void(this._delayedTime=r+i)):this._next==null?(this._next=e,void(this._fadeStart=this._alignFadeStart(r))):void(e!=null&&(Pe(this._waiting),this._waiting=e))}get _fadeDuration(){return this._waiting==null?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(e){const i=this._getFadeDuration();return e+i-e%i}get _isFadingEnabled(){return this._getFadeDuration()>0}};var mg;pEe.test={fadeMoment:0},function(t){t[t.Immediate=0]="Immediate",t[t.Delayed=5e3]="Delayed"}(mg||(mg={}));var bS;(function(t){t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT",t[t.NONE=0]="NONE",t[t.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(bS||(bS={}));let fEe=class{constructor(){this._queue=new It,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),e!=null&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){const e=this._last?.children;return e?.[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},Wht=class{constructor(){this._q=new It}get done(){return this._q.length===0}reset(e){if(this._q.clear(),e!=null){this._q.pushArray(e);for(let i=0;i<this._q.length;++i){const r=this._q.data[i];r.isLeaf||this._q.pushArray(r.children)}}}next(){return this._q.pop()}};function M3(t,e,i){if(e?.fullExtent==null)return!1;const r=e.fullExtent,n=t.extent;if(i){if(n[0]<r.xmin||n[1]<r.ymin||n[2]>r.xmax||n[3]>r.ymax)return!1}else if(r.xmin>n[2]||r.ymin>n[3]||r.xmax<n[0]||r.ymax<n[1])return!1;const s=t.surface.tilingScheme.levels[t.level].scale,o=e.minScale;if(o>0&&s>1.00000001*o)return!1;const a=e.maxScale;return!(a>0&&s<.99999999*a)}function gg(t,e){const i=t.lij,r=e.lij;return i[0]-r[0]||i[1]-r[1]||i[2]-r[2]}function mEe(t,e,i=null){i==null||i.length===0?t===bS.BACK_TO_FRONT?e.sort(Yht):e.sort(Xht):e.sort((r,n)=>Zht(r,n,t,i))}function Yht(t,e){const i=e.screenDepth-t.screenDepth;if(i!==0)return i;const r=t.lij,n=e.lij;return r[0]-n[0]||r[1]-n[1]||r[2]-n[2]}function Xht(t,e){const i=t.screenDepth-e.screenDepth;if(i!==0)return i;const r=t.lij,n=e.lij;return r[0]-n[0]||r[1]-n[1]||r[2]-n[2]}function gEe(t,e,i){const r=t.screenDepth,n=e.screenDepth;return r<n?-i:r>n?i:gg(t,e)}function Zht(t,e,i,r){return voe(t,r)===voe(e,r)?gEe(t,e,i):t?i:-i}function voe(t,e){for(const i of e)if(t.intersectsExtent(i))return!0;return!1}function Jht(t,e){const i=t.distanceToPOI-e.distanceToPOI;if(i!==0)return i;const r=t.lij,n=e.lij;return r[0]-n[0]||r[1]-n[1]||r[2]-n[2]}function Kht(t,e){const i=t.length;for(let r=0;r<i;++r)t.at(r).updateDistanceToPOI(e);t.sort(Jht)}function Qht(t,e,i){let r=1,n=0,s=0;for(;t!==e;)if(r*=.5,n*=.5,s*=.5,1&t.lij[2]&&(n+=.5),!(1&t.lij[1])&&(s+=.5),(t=t.parent)==null)throw new Error("tile was not a descendant of upsampleTile");i.init(e,n,s,r)}function edt(t){for(let e=0;e<t.length;e++){const i=t[e],r=i.parent;if(r)for(let n=0;n<4;n++){const s=r.children[n];if(s&&s!==i)return!0}}return!1}function nkt(t,e){if(!t||!e||t[0]===e[0])return!1;const i=t[0]<e[0],r=i?t:e,n=i?e:t,s=1<<n[0]-r[0];return Math.floor(n[1]/s)===r[1]&&Math.floor(n[2]/s)===r[2]}let EZ=class{get updating(){return!!this._tileRequested}init(e,i,r,n){this.tile=e,this._layerIdx=i,this._layerClass=r,this._suspended=n,this._tileLayerInfo=e.getLayerInfo(i,r),this._tileRequested=null;const s=this._findAncestorWithData();this._setUpsampleTile(s)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e,i){this._setUpsampleTile(e,i),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,ss.FADING,i):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return e!=null?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,i=this._layerClass,r=this.tile.surface.layerViewByIndex(e,i),n=Ej(r),{minLevel:s,maxLevel:o}=r.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?M3:()=>!0;let u=this.tile;const d=u.level;let p;const m=this._tileLayerInfo.upsampleInfo,y=m!=null?m.tile.level:-1,_=m!=null&&y-d>=a,v=n?.tilemapCache,w=r.type==="vector-tile-3d"?r.schemaHelper:null;for(;u&&c(u,n,!1)&&u.level>=s;){const x=u.level,T=d-x,S=u.layerInfo[i][e];if(S.data&&T>=a){(!_||x>y)&&this._setUpsampleTile(u),S.dataInvalidated&&(p=u);break}const E=w?.getLevelRowColumn(u.lij)??u.lij;if(v?.getAvailability(E[0],E[1],u.lij[2])!=="unavailable"&&x<=o&&!S.data&&!S.dataMissing&&((!p||u.level===s||x%E_e==0||d-p.level<a)&&(p=u),T>=l))break;u=u.parent}if(p!=null&&d-p.level<a)if(m)p=null;else{const x=this._findAncestorWithData();x!=null&&(this._setUpsampleTile(x),p=x.layerInfo[i][e].dataInvalidated?x:null)}return p}_findAncestorWithData(){const e=this.tile.elevationLevel,i=this._desiredMinLevelDelta;let r;for(let n=this.tile;n;n=n.parent)if(n.hasLayerData(this._layerIdx,this._layerClass)){if(e-n.level>=i)return n;r=n}return r}_setUpsampleTile(e,i){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,ss.FADING,i)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}},tdt=class extends EZ{get _desiredMinLevelDelta(){throw boe}get _progressiveLevelModulo(){throw boe}dispose(){}};const boe=new Error("Abstract method called on TileAgent"),Rl=new tdt;let yEe=class extends EZ{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return f7(this.tile.level)-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}},_Ee=class extends EZ{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return E_e}};var cb,Yb;(function(t){t[t.Stretch=0]="Stretch",t[t.Lut=1]="Lut",t[t.Hillshade=2]="Hillshade",t[t.COUNT=3]="COUNT"})(cb||(cb={})),function(t){t[t.Noop=0]="Noop",t[t.PerBand=1]="PerBand",t[t.COUNT=2]="COUNT"}(Yb||(Yb={}));function idt(t){t.fragment.uniforms.add(new Je("u_colormap",e=>e.u_colormap),new Oe("u_colormapOffset",e=>e.colormap.u_colormapOffset),new Oe("u_colormapMaxIndex",e=>e.colormap.u_colormapMaxIndex),new Oe("u_opacity",e=>e.common.u_opacity)),t.fragment.code.add(b`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)}function rdt(t){t.fragment.uniforms.add(new Je("u_transformGrid",e=>e.u_transformGrid),new zi("u_transformSpacing",e=>e.common.u_transformSpacing),new zi("u_targetImageSize",e=>e.common.u_targetImageSize)),t.fragment.code.add(b`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)}let vEe=class extends Ki{constructor(){super(...arguments),this.scale=1,this.offset=Sg}};function bEe(t){t.attributes.add(O.POSITION,"vec2"),t.attributes.add(O.UV0,"vec2"),t.vertex.uniforms.add(new Oe("scale",e=>e.scale)),t.vertex.uniforms.add(new zi("offset",e=>e.offset)),t.varyings.add("uv","vec2"),t.varyings.add("vuv","vec2"),t.vertex.code.add(b`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}let ndt=class extends vEe{constructor(e,i,r){super(),this.common=e,this.u_image=i,this.u_transformGrid=r}};function sdt(t,e){t.include(rdt),t.fragment.uniforms.add(new Je("u_image",r=>r.u_image),new Tf("u_flipY",r=>r.common.u_flipY),new Tf("u_applyTransform",r=>r.common.u_applyTransform));const{requireBilinearWithNN:i}=e;i&&t.fragment.uniforms.add(new zi("u_srcImageSize",r=>r.common.u_srcImageSize)),t.fragment.code.add(b`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`),i?t.fragment.code.add(b`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):t.fragment.code.add(b`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)}var Re;(function(t){t[t.Normal=0]="Normal",t[t.Average=1]="Average",t[t.Lighten=2]="Lighten",t[t.Lighter=3]="Lighter",t[t.Plus=4]="Plus",t[t.Screen=5]="Screen",t[t.ColorDodge=6]="ColorDodge",t[t.Darken=7]="Darken",t[t.Multiply=8]="Multiply",t[t.ColorBurn=9]="ColorBurn",t[t.Overlay=10]="Overlay",t[t.SoftLight=11]="SoftLight",t[t.HardLight=12]="HardLight",t[t.VividLight=13]="VividLight",t[t.Hue=14]="Hue",t[t.Saturation=15]="Saturation",t[t.Luminosity=16]="Luminosity",t[t.Color=17]="Color",t[t.DestinationOver=18]="DestinationOver",t[t.DestinationAtop=19]="DestinationAtop",t[t.DestinationIn=20]="DestinationIn",t[t.DestinationOut=21]="DestinationOut",t[t.SourceAtop=22]="SourceAtop",t[t.SourceIn=23]="SourceIn",t[t.SourceOut=24]="SourceOut",t[t.Xor=25]="Xor",t[t.Difference=26]="Difference",t[t.Exclusion=27]="Exclusion",t[t.Minus=28]="Minus",t[t.Invert=29]="Invert",t[t.Reflect=30]="Reflect",t[t.COUNT=31]="COUNT"})(Re||(Re={}));const Pj={normal:Re.Normal,average:Re.Average,lighten:Re.Lighten,lighter:Re.Lighter,screen:Re.Screen,plus:Re.Plus,"color-dodge":Re.ColorDodge,darken:Re.Darken,multiply:Re.Multiply,"color-burn":Re.ColorBurn,overlay:Re.Overlay,"soft-light":Re.SoftLight,"hard-light":Re.HardLight,"vivid-light":Re.VividLight,hue:Re.Hue,saturation:Re.Saturation,luminosity:Re.Luminosity,color:Re.Color,difference:Re.Difference,exclusion:Re.Exclusion,minus:Re.Minus,invert:Re.Invert,reflect:Re.Reflect,"destination-over":Re.DestinationOver,"destination-atop":Re.DestinationAtop,"destination-in":Re.DestinationIn,"destination-out":Re.DestinationOut,"source-atop":Re.SourceAtop,"source-in":Re.SourceIn,"source-out":Re.SourceOut,xor:Re.Xor};function odt(t){return t===Re.DestinationOver||t===Re.DestinationAtop||t===Re.DestinationIn||t===Re.DestinationOut||t===Re.SourceAtop||t===Re.SourceIn||t===Re.SourceOut||t===Re.Xor}function CZ(t){t.code.add(b`
    float lineFactorAtPosition(float value) {
      float pos = value * ${b.float(257)};
      if(pos < 0.5 || pos > ${b.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}function adt(t,e){const i=e.blendMode;i!==Re.Normal&&(i===Re.Reflect&&t.code.add(b`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),i!==Re.ColorDodge&&i!==Re.VividLight||t.code.add(b`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),i!==Re.ColorBurn&&i!==Re.VividLight||t.code.add(b`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),i===Re.Overlay&&t.code.add(b`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),i===Re.HardLight&&t.code.add(b`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),i===Re.SoftLight&&t.code.add(b`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),i===Re.VividLight&&t.code.add(b`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),i!==Re.Hue&&i!==Re.Saturation&&i!==Re.Color&&i!==Re.Luminosity||(t.code.add(b`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),i!==Re.Hue&&i!==Re.Saturation||t.code.add(b`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),t.code.add(b`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${i===Re.Multiply?b`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Re.Average?b`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Re.Lighten?b`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Re.Darken?b`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Re.Lighter?b`return vec4(cl * ol + cb * ob, ol + ob);`:i===Re.Plus?b`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:i===Re.Minus?b`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:i===Re.Screen?b`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Re.Difference?b`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Re.Invert?b`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Re.DestinationOver?b`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:i===Re.DestinationAtop?b`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:i===Re.DestinationOut?b`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:i===Re.SourceAtop?b`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Re.SourceOut?b`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:i===Re.Xor?b`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:i===Re.DestinationIn?b`return vec4(cb * ob * ol, ol * ob);`:i===Re.SourceIn?b`return vec4(cl * ol * ob, ol * ob);`:i===Re.Hue?b`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Re.Saturation?b`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Re.Color?b`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Re.Luminosity?b`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Re.Exclusion?b`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Re.Reflect?b`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Re.ColorDodge?b`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Re.ColorBurn?b`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Re.Overlay?b`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Re.SoftLight?b`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Re.HardLight?b`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Re.VividLight?b`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:b``}
    }
  `))}var jn,Jc,vd;(function(t){t[t.Composite=0]="Composite",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.GroupBackgroundComposite=3]="GroupBackgroundComposite",t[t.COUNT=4]="COUNT"})(jn||(jn={})),function(t){t[t.NotRequired=0]="NotRequired",t[t.Required=1]="Required",t[t.COUNT=2]="COUNT"}(Jc||(Jc={})),function(t){t[t.Off=0]="Off",t[t.On=1]="On",t[t.COUNT=2]="COUNT"}(vd||(vd={}));function wEe(t,e){const i=e.output===jn.GridComposite,r=e.output===jn.ColorComposite,n=e.output===jn.GroupBackgroundComposite,s=e.output===jn.Composite;i&&t.fragment.include(CZ),r&&t.fragment.uniforms.add(new $t("backgroundColor",c=>c.backgroundColor));const o=e.baseOpacityMode===Jc.Required;o&&t.fragment.uniforms.add(new Oe("baseOpacity",c=>c.baseOpacity)),s&&t.fragment.uniforms.add(new Je("fboColor",c=>c.fboTexture));const a=e.blendMode!==Re.Normal,l=e.premultipliedSource===vd.On;t.fragment.include(adt,e),t.fragment.code.add(b`
    vec4 getBackground(vec2 uv) {
      return ${o?b`baseOpacity *`:""} ${n?b`vec4(0.0, 0.0, 0.0, 0.0)`:r?b`vec4(backgroundColor, 1.0)`:i?b`vec4(gridColor(uv), 1.0)`:b`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${a?b`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:b`
          float composeAlpha = colorLayer.a * opacity;
          return ${!l&&(s&&!o||n)?b`colorLayer * opacity;`:b`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}let bk=class extends ndt{constructor(e,i,r,n,s,o){super(e,n,s),this.colormap=i,this.symbolizer=r,this.u_colormap=o,this.backgroundColor=Gs,this.fboTexture=null,this.baseOpacity=1}},ldt=class extends bk{},cdt=class extends bk{};function udt(t){const e=new mi;return e.include(bEe),e.include(sdt,t),e.include(idt,t),e.include(wEe,t),e.fragment.code.add(b`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`),t.colorizerType===cb.Stretch?ddt(e,t):t.colorizerType===cb.Lut?hdt(e):t.colorizerType===cb.Hillshade&&pdt(e,t),e}function hdt(t){t.fragment.code.add(b`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function ddt(t,e){t.fragment.uniforms.add(new zR("u_bandCount",r=>r.symbolizer.u_bandCount),new hl("u_minCutOff",r=>r.symbolizer.u_minCutOff,3),new hl("u_maxCutOff",r=>r.symbolizer.u_maxCutOff,3),new hl("u_factor",r=>r.symbolizer.u_factor,3),new Oe("u_minOutput",r=>r.symbolizer.u_minOutput),new Oe("u_maxOutput",r=>r.symbolizer.u_maxOutput),new Tf("u_useGamma",r=>r.symbolizer.u_useGamma),new hl("u_gamma",r=>r.symbolizer.u_gamma,3),new hl("u_gammaCorrection",r=>r.symbolizer.u_gammaCorrection,3),new Oe("u_opacity",r=>r.common.u_opacity)),t.fragment.code.add(b`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const i=e.applyColormap?b`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:b`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;t.fragment.code.add(b`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${e.stretchType===Yb.Noop?b`
        fragColor = applyBackgroundBlend(currentPixel);`:b`
        if (currentPixel.a == 0.0) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${i}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function pdt(t,e){const i=t.fragment;i.uniforms.add(new Je("u_image",n=>n.u_image),new zR("u_hillshadeType",n=>n.symbolizer.u_hillshadeType),new hl("u_sinZcosAs",n=>n.symbolizer.u_sinZcosAs,6),new hl("u_sinZsinAs",n=>n.symbolizer.u_sinZsinAs,6),new hl("u_cosZs",n=>n.symbolizer.u_cosZs,6),new hl("u_weights",n=>n.symbolizer.u_weights,6),new zi("u_factor",n=>n.symbolizer.u_factor),new Oe("u_minValue",n=>n.symbolizer.u_minValue),new Oe("u_maxValue",n=>n.symbolizer.u_maxValue),new zi("u_srcImageSize",n=>n.common.u_srcImageSize)),i.include(Jf),i.code.add(b`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),i.code.add(b`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const r=e.applyColormap?b`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:b`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;i.code.add(b`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${r}
    }
  `)}const fdt=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:cdt,ColorizerStretchUniforms:ldt,ColorizerUniforms:bk,build:udt},Symbol.toStringTag,{value:"Module"}));function mdt(t,e,i="nearest",r=!1){const n=!(r&&e.pixelType==="u8"),s=n?hs.FLOAT:hs.UNSIGNED_BYTE,o=e.pixels==null||e.pixels.length===0?null:n?e.getAsRGBAFloat():e.getAsRGBA(),a=t.capabilities.textureFloat?.textureFloatLinear,l=new Li;return l.width=e.width,l.height=e.height,l.internalFormat=t.type===ni.WEBGL2&&n?Ge.RGBA32F:pt.RGBA,l.samplingMode=!a||i!=="bilinear"&&i!=="cubic"?Lt.NEAREST:Lt.LINEAR,l.dataType=s,l.wrapMode=Nt.CLAMP_TO_EDGE,new Pt(t,l,o)}function gdt(t,e){const{spacing:i,offsets:r,coefficients:n,size:[s,o]}=e,a=i[0]>1,l=new Li;l.width=a?4*s:s,l.height=o,l.internalFormat=t.type===ni.WEBGL2?Ge.RGBA32F:pt.RGBA,l.dataType=hs.FLOAT,l.samplingMode=Lt.NEAREST,l.wrapMode=Nt.CLAMP_TO_EDGE;const c=new Float32Array(a?s*o*16:2*r.length);if(a&&n!=null)for(let u=0,d=0;u<n.length;u++)c[d++]=n[u],u%3==2&&(c[d++]=1);else for(let u=0;u<o;u++)for(let d=0;d<s;d++){const p=4*(u*s+d),m=2*(d*o+u);c[p]=r[m],c[p+1]=r[m+1],c[p+3]=r[m]===-1?0:1}return new Pt(t,l,c)}function woe(t,e){const i=new Li;return i.internalFormat=pt.RGBA,i.width=e.length/4,i.height=1,i.samplingMode=Lt.NEAREST,i.wrapMode=Nt.CLAMP_TO_EDGE,new Pt(t,i,e)}function ydt(t,e,i,r=1,n=!0){return{u_flipY:n,u_applyTransform:!!t,u_opacity:r,u_transformSpacing:t?t.spacing:Sg,u_transformGridSize:t?t.size:Sg,u_targetImageSize:e,u_srcImageSize:i}}function _dt(t,e){return{u_colormapOffset:e||0,u_colormapMaxIndex:t?t.length/4-1:0}}function vdt(t){return{u_bandCount:t.bandCount,u_minOutput:t.outMin,u_maxOutput:t.outMax,u_minCutOff:t.minCutOff,u_maxCutOff:t.maxCutOff,u_factor:t.factor,u_useGamma:t.useGamma,u_gamma:t.gamma,u_gammaCorrection:t.gammaCorrection}}function bdt(t){return{u_hillshadeType:t.hillshadeType,u_sinZcosAs:t.sinZcosAs,u_sinZsinAs:t.sinZsinAs,u_cosZs:t.cosZs,u_weights:t.weights,u_factor:t.factor,u_minValue:t.minValue,u_maxValue:t.maxValue}}const xoe={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};let wdt=class{constructor(e,i,r=null,n=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=e,this.source=i,this.width=r||i.width,this.height=n||i.height}get source(){return this._source}set source(e){this._source=e,this._rasterTexture=et(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...xoe,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||xoe}set symbolizerParameters(e){this._symbolizerParameters=e}get bandIds(){return this._bandIds}set bandIds(e){e!=null&&e.length>0?this._bandIds&&e.every((i,r)=>!!this._bandIds?.[r]&&i===this._bandIds[r])||(this._bandIds=e,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(e){if(this._interpolation=e,this._rasterTexture!=null){const i=this._getRasterTextureInterpolation(e);this._rasterTexture.setSamplingMode(i==="bilinear"?Lt.LINEAR:Lt.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid=e,this._transformGridTexture=et(this._transformGridTexture),this._memoryUsed=null}bind(e){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((this._rasterTexture==null||this._dirty)&&this._updateRasterTexture(e,this.bandIds),this._rasterTexture!=null&&(this._updateColormapTexture(e),this.transformGrid&&this._transformGridTexture==null&&(this._transformGridTexture=gdt(e,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:e,transformGrid:i,width:r,height:n,opacity:s}=this,o=ydt(i,[r,n],[this.source.width,this.source.height],s),a=_dt(e.colormap,e.colormapOffset),l=this.symbolizerParameters.type==="stretch"?vdt(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?bdt(this.symbolizerParameters):null;return new bk(o,a,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get isBilinearWithStretchColorRamp(){const{symbolizerParameters:e}=this;return this.interpolation==="bilinear"&&e.colormap!=null&&e.type==="stretch"}get memoryUsage(){if(this._memoryUsed==null){const e=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=e.map(i=>i!=null?i.descriptor.width*i.descriptor.height*4:0).reduce((i,r)=>i+r,0)}return this._memoryUsed}release(){return this._rasterTexture=et(this._rasterTexture),this._transformGridTexture=et(this._transformGridTexture),this._colormapTexture=et(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(e,i){const r=this.source?this.source.extractBands(i):null;if(!(r&&r.pixels&&r.pixels.length>0))return void(this._rasterTexture=et(this._rasterTexture));const n=i==null&&this.bandIds==null||i!=null&&this.bandIds!=null&&i.join("")===this.bandIds.join("");if(this._rasterTexture!=null&&n)return;this._rasterTexture=et(this._rasterTexture);const s=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=mdt(e,r,s,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(e){return this.symbolizerParameters.type==="lut"||e==="nearest"||e==="majority"||this.isBilinearWithStretchColorRamp?"nearest":"bilinear"}_updateColormapTexture(e){const i=this._colormap,r=this.symbolizerParameters.colormap;return r?i?r.length!==i.length||r.some((n,s)=>n!==i[s])?(this._colormapTexture=et(this._colormapTexture),this._colormapTexture=woe(e,r),void(this._colormap=r)):void 0:(this._colormapTexture=woe(e,r),void(this._colormap=r)):(this._colormapTexture=et(this._colormapTexture),void(this._colormap=null))}},XL=class{constructor(){this.waitingAgents=new It,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(e){const i=Y8.acquire();return i._init(e),i}release(){this.dispose(),ZL.delete(this),Y8.release(this)}dispose(){this.loadingAgent=et(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=wT(this._data)}static prune(){Y8.prune(0)}_init(e){this.waitingAgents.clear(),this._data=wT(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=nc(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){this._upsampleInfo!=null&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,i){if(e!==i&&i!=null){if(this._upsampleInfo==null)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===i)return;this._upsampleInfo.tile.unrefMapData()}i.refMapData(),Qht(e,i,this._upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(e){wT(this._data),this._data=e}};const Y8=new aa(XL,null,()=>{}),ZL=new Map;function xdt(){ZL.size>0&&(console.log(`${ZL.size} live TilePerLayerInfo allocations:`),ZL.forEach(t=>console.log(t,`
`)))}let CA=class{constructor(e,i){this._texture=e,this._cache=i,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){if(--this._refCount,this._refCount===0)if(this._cache){const e=`${this._texture.descriptor.width} ${this._texture.descriptor.pixelFormat}`;this._cache.put(e,this)}else this.dispose()}dispose(){this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}get usedMemory(){return this._texture.gpuMemoryUsage}};var yt;(function(t){t[t.NONE=0]="NONE",t[t.SPLIT=1]="SPLIT",t[t.ELEVATION=2]="ELEVATION",t[t.MERGE=4]="MERGE",t[t.RENDERDATA=8]="RENDERDATA",t[t.GEOMETRY=16]="GEOMETRY",t[t.TEXTURE_NOFADING=32]="TEXTURE_NOFADING",t[t.TEXTURE_FADING=64]="TEXTURE_FADING"})(yt||(yt={}));const Tdt=.1;let AZ=class{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=Gt(),this._elevationBounds=Ue(),this.layerInfo=[[],[]],this.extentInRadians=Gt(),this.centerAtSeaLevel=C(),this._center=[C(),xn(),C()],this.up=oq(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=C()}static prune(){OZ.prune(0),RZ.prune(0),XL.prune()}get _isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[Un.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;const e=this.parent,i=e?.frustumVisibility??Zo.INTERSECTS;this._frustumVisibility=i===Zo.INSIDE?Zo.INSIDE:i===Zo.OUTSIDE?Zo.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const r=this._frustumVisibility!==Zo.OUTSIDE&&this._intersectsClippingArea;r!==this._visible&&(this._visible=r,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}get shouldLoad(){return this.isLeaf}init(e,i,r,n,s){this.lij[0]=e,this.lij[1]=i,this.lij[2]=r,this.ellipsoid=Fi(s.tilingScheme.spatialReference),s.tilingScheme.getExtent(e,i,r,this.extent),s.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,s.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[Un.MIDDLE][3]=0,this.elevationLevel=e,n&&n.elevationBounds?Yn(this._elevationBounds,n.elevationBounds):si(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=n,this.unsetChildren(),this._surface=s,this.updateVisibility();for(const o of f1){const a=s.numLayers(o),l=this.layerInfo[o];for(const c of l)c.release();l.length=a;for(let c=0;c<a;c++)l[c]=XL.acquire(this._surface.upsampleInfoPool),o===Vt.ELEVATION&&this.findElevationBoundsForLayer(c,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(s.tilingScheme.pixelSize,KC)}dispose(){sf(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const e of f1){for(const i of this.layerInfo[e])i.release();this.layerInfo[e].length=0}this._parent=null;for(let e=0;e<4;++e)this._children[e]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const e=this._cachedMemory;e>0&&this._surface.upsampleMapCache.put(this.key,this,e)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[Vt.MAP].reduce((e,i)=>e+(i instanceof W8?i.memoryUsed/i.referenced:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const i=this._surface.tilingScheme.pixelSize;return i*i*4}_ensureUsedMemory(){if(this._usedMemory!=null)return this._usedMemory;this._usedMemory=this._baseUsedMemory,this._mapTileMemoryInternal=0;let e=0;for(const{data:r}of this.layerInfo[Vt.MAP])r instanceof W8?e+=this._getTerrainDataMemory(r):this._mapTileMemoryInternal+=this._getTerrainDataMemory(r);const i=this._cpuImageMemorySize;for(const r of this.layerInfo[Vt.ELEVATION])this._usedMemory+=r.data?i:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=this.renderData.texture?.usedMemory??0),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+e),this._usedMemory}getUsedMemoryForLayer(e,i){const r=this.layerInfo[e][i];return r?.data?e===Vt.MAP?this._isCached?0:this._getTerrainDataMemory(r.data):e===Vt.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(e){return e instanceof CA?e.texture.gpuMemoryUsage:e instanceof HTMLImageElement||e instanceof wZ?this._cpuImageMemorySize:e instanceof wdt?e.memoryUsage:e instanceof W8?e.memoryUsed/e.referenced:0}updateScreenDepth(e){const i=this._center[Un.MIDDLE],r=e,n=i[0],s=i[1],o=i[2],a=r[2]*n+r[6]*s+r[10]*o+r[14];this.screenDepth=a<0?0:a/(r[3]*n+r[7]*s+r[11]*o+r[15])}shouldSplit(e,i,r){if(!this.visible||e.frustum&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(e.frustum)===Zo.OUTSIDE))return yt.NONE;const n=this.level;he(D$,this._center[Un.MIDDLE],i);let s=Oo(D$),o=D$,a=Un.MIDDLE;he(X8,this._center[Un.TOP],i);const l=Oo(X8);l<s&&(s=l,o=X8,a=Un.TOP),he(Z8,this._center[Un.BOTTOM],i);const c=Oo(Z8);if(c<s&&(s=c,o=Z8,a=Un.BOTTOM),this._edgeLen2>s&&n<e.maxLod)return yt.SPLIT;const u=r!=null?r-n:1/0,d=Math.sqrt(s),p=e.fovX*d*2,m=this._edgeLen/p,y=()=>{if(n<e.maxLod)return this.elevationLevel=n,yt.NONE;const P=n+Math.ceil(-Math.log2(e.relativeWidthLimit/m));return P!==this.elevationLevel?(this.elevationLevel=P,yt.ELEVATION):yt.NONE};if(u<=.5)return y();const _=me(this.up,D$),v=this._elevationBounds[1]-this._elevationBounds[0],w=v/this.edgeLen;if(e.aboveGround&&_>0&&w<.001&&_/d-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-w>0)return yt.NONE;const x=r!=null?3-Math.min(u,2):1;if(m*x<e.relativeWidthLimit||n>=e.maxLod)return y();if(n<7)return yt.SPLIT;te(Qs,this.up,_),he(Qs,Qs,o);const T=Oo(Qs);if(T<=this.radius*this.radius)return yt.SPLIT;te(Qs,Qs,this.radius/Math.sqrt(T)),ce(Qs,Qs,this._center[a]),he(Qs,i,Qs);const S=Math.min(1,(Math.abs(me(Qs,this.up))+.5*v+this._curvatureHeight)/we(Qs)),E=Tdt/e.angledSplitBias,A=e.fovY*d*2;return S*(this._edgeLen/A*x)<E*e.relativeHeightLimit?yt.NONE:yt.SPLIT}setChildren(e,i,r,n){sf(!!(e&&i&&r&&n),"Null child passed"),this._children[0]=e,this._children[1]=i,this._children[2]=r,this._children[3]=n}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){return this.renderData?.hasGeometry??!1}load(){this.refMapData();for(const e of f1)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(e){e.unloadTile(this);for(const i of f1){const r=this.layerInfo[i];for(const n of r)n.loadingAgent&&n.loadingAgent!==Rl&&(L$(n.loadingAgent),n.loadingAgent=null),n.pendingUpdates=0}this.resetPendingUpdate(yt.GEOMETRY),this.resetPendingUpdate(yt.TEXTURE_NOFADING),this.resetPendingUpdate(yt.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[Vt.MAP];for(const i of e)i.loadingAgent&&i.loadingAgent!==Rl&&(L$(i.loadingAgent),i.loadingAgent=null),i.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(Z1(e,this._clippingArea))return!1;const i=this._intersectsClippingArea,r=this._isWithinClippingArea;e!=null?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const n=r&&this._isWithinClippingArea,s=!(r||i||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||n||s||this.setPendingUpdate(yt.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,i){return this.layerInfo[i][e]}hasLayerData(e,i){const r=this.layerInfo[i][e];return!(!r?.data||r.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of f1){const i=this.layerInfo[e];for(const r of i)if(r.loadingAgent&&r.loadingAgent!==Rl&&r.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(yt.SPLIT)||e!==Vt.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){this._pendingUpdates|=e,e===yt.SPLIT||e===yt.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,i,r){const n=this.layerInfo[i][e];if(n.waitingAgents.has(r))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),i,e),!0;if(n.waitingAgents.push(r),n.data&&!n.dataInvalidated){console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),i,e);const a=n.data&&"type"in n.data&&n.data.type==="vector-tile";return r.dataArrived(this,a),!0}if(n.requestPromise)return!0;nc(n.requestAbort),n.requestAbort=new AbortController;const s=this._surface.requestTileData(this,e,i,n.requestAbort);if(!s)return n.requestAbort=null,!1;const o=()=>{n.requestPromise===s&&(n.requestPromise=null,n.requestAbort=null)};return n.requestPromise=s,s.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(e){return this.lij[0]===e[0]&&this.lij[1]===e[1]&&this.lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const i=this._children;return i[0]?i[0].findByLij(e)||i[1].findByLij(e)||i[2].findByLij(e)||i[3].findByLij(e):null}distanceToSquared(e){return Oo(he(Qs,this._center[Un.MIDDLE],e))}containsPoint(e){const i=this.extent;return e[0]>=i[0]&&e[1]>=i[1]&&e[0]<=i[2]&&e[1]<=i[3]}containsPointXY(e,i){const r=this.extent;return e>=r[0]&&i>=r[1]&&e<=r[2]&&i<=r[3]}unrequestLayerData(e,i,r){const n=this.layerInfo[i][e],s=n.waitingAgents,o=s.removeUnordered(r)!=null;sf(o,"agent has not requested this piece of map data"),s.length<1&&(n.abortRequest(),this.setMemoryDirty())}dataArrived(e,i,r){const n=r!=null&&"type"in r&&r.type==="vector-tile",s=this.layerInfo[i][e];s.data=r,s.dataInvalidated=!1,s.waitingAgents.forAll(o=>o.dataArrived(this,n)),s.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,i,r){r.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${i}/${e} error ${r}`);const n=this.layerInfo[i][e];n.dataMissing=!0,n.waitingAgents.forAll(s=>s.dataMissing()),n.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,i,r){switch(r&&this.forEachLoadedNeighbor(n=>n.updateRenderData(e,i)),e){case Vt.MAP:return this._updateTexture(i);case Vt.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===ss.FADING?yt.TEXTURE_NOFADING:yt.TEXTURE_FADING),this.setPendingUpdate(e===ss.FADING?yt.TEXTURE_FADING:yt.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(yt.GEOMETRY);for(const e of this.layerInfo[Vt.ELEVATION])e.pendingUpdates|=yt.GEOMETRY}invalidateLayerData(e,i){this.layerInfo[i][e].invalidateSourceData(),this.restartAgents(i)}computeElevationBounds(){const e=this._elevationBounds,i=e[0],r=e[1];si(e,1/0,-1/0);const n=this.layerInfo[Vt.ELEVATION];let s=!0;for(const o of n)o.elevationBounds!=null&&(e[0]=Math.min(e[0],o.elevationBounds.min),e[1]=Math.max(e[1],o.elevationBounds.max),o.elevationBounds.hasNoDataValues||(s=!1));s&&(e[0]=Math.min(e[0],0),e[1]=Math.max(e[1],0)),i===e[0]&&r===e[1]||(this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBounds,i=.5*(e[0]+e[1]),r=this._center;te(Qs,this.up,i),ce(r[Un.MIDDLE],this.centerAtSeaLevel,Qs),te(Qs,this.up,e[0]),ce(r[Un.TOP],this.centerAtSeaLevel,Qs),te(Qs,this.up,e[1]),ce(r[Un.BOTTOM],this.centerAtSeaLevel,Qs)}findElevationBoundsForLayer(e,i){const r=this.layerInfo[Vt.ELEVATION][e],n=f7(this.level),s=Math.max(this.elevationLevel-n,0),o=r.elevationBounds;if(o!=null&&o.level>=i&&o.level<=s)return;const a=this._surface.layerViewByIndex(e,Vt.ELEVATION),l=Ej(a);if(!M3(this,l,!1))return;const c=Edt;let u=!1;const d=r.data;if(d&&d.level<=s){const p=r.data;c.min=p.samplerData.data.minValue,c.max=p.samplerData.data.maxValue,c.hasNoDataValues=p.samplerData.data.hasNoDataValues,c.level=this.level,u=!0}else{let p,m,y=0;for(let _=this._parent;_&&(!m||y<n)&&(y=this.elevationLevel-_.level,p=m||p,m=_.layerInfo[Vt.ELEVATION][e].data,!(!m&&p&&_.level<=s));_=_.parent);m=m||p,m&&(m.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],c),c.min!==1/0&&(c.level=m.level,u=!0))}u&&(r.elevationBounds==null&&(r.elevationBounds=new J2),r.elevationBounds.copyFrom(c))}modifyLayers(e,i,r){const n=this.layerInfo[r];for(const a of n)a.loadingAgent&&a.loadingAgent!==Rl&&(L$(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<n.length;++a)e[a]===void 0&&n[a].release();const s=new Array(...n),o=i.length;n.length=o;for(let a=0;a<o;a++){const l=i[a];n[a]=l>-1?s[l]:XL.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,ss.FADING))}updateAgents(e){if(this.renderData){const i=this.layerInfo[e];for(const r of i)r.loadingAgent===Rl&&(r.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of f1){const i=this._isSuspended(e);for(const r of this.layerInfo[e])r.loadingAgent&&r.loadingAgent!==Rl&&(r.loadingAgent.setSuspension(i),r.loadingAgent===Rl&&this.updateRenderData(e,ss.FADING))}}removeLayerAgent(e,i){const r=this.layerInfo[i][e];r.loadingAgent&&r.loadingAgent!==Rl&&r.loadingAgent.dispose(),r.loadingAgent=null}agentDone(e,i){const r=this.layerInfo[i][e];r.loadingAgent=Rl,r.data||r.upsampleInfo!=null||this._createOrUpdateAgents(e+1,i)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||LT(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,i,r){for(let n=e;n<i;++n){const s=this._surface.layerViewByIndex(n,r);if(LO(s)&&s?.layer?.blendMode!=="normal"||LT(s?.layer?.parent)&&this._hasBlendableAncestor(s?.layer?.parent))return!0}return!1}_createOrUpdateAgents(e,i){const r=this.layerInfo[i];if(r.length===0)return;const n=this._isSuspended(i);for(let s=e;s<r.length;++s){const o=r[s];let a=!1;const l=this._surface.layerViewByIndex(s,i),c=Ej(l);if(o.loadingAgent?M3(this,c,!1)?(o.loadingAgent!==Rl&&o.loadingAgent.setSuspension(n),o.loadingAgent!==Rl&&(a=o.loadingAgent.update())):o.dispose():M3(this,c,!1)&&(o.loadingAgent=Sdt(this,s,i,n),a=o.loadingAgent.startLoading(),a?o.loadingAgent===Rl&&this.setPendingUpdate(yt.GEOMETRY):(L$(o.loadingAgent),o.loadingAgent=Rl)),o.loadingAgent===Rl&&this.updateRenderData(i,ss.FADING),!this._hasBlendModes(e,r.length,i)&&a&&l.isOpaque)return}}_isWithinExtent(e){const i=this.extent;return i[0]>=e[0]&&e[2]>=i[2]&&i[1]>=e[1]&&e[3]>=i[3]}intersectsExtent(e){const i=this.extent;return i[2]>=e[0]&&e[2]>=i[0]&&i[3]>=e[1]&&e[3]>=i[1]}getElevationVerticesPerSide(e){const i=this.elevationLevel-this.level,r=Math.max(this.level-e,f7(this.level)-i),n=_e(1+(this.maxTesselation>>r),2,this.maxTesselation+1),s=this.getDefaultVerticesPerSide();return Math.max(n,s)}get test(){return{cachedMemory:this._cachedMemory}}_findLIJ(e,i){if(!e)return null;const r=this.surface.rootTiles;if(r!=null){for(const n of r)if(Cdt(n,e)){let s=n,o=e[0]-s.level-1;for(;o>=0&&!s.isLeaf&&!i(s);){const a=e[1]>>o&1,l=e[2]>>o&1;s=s.children[2*a+l],o--}return i(s)?s:null}}return null}findNeighborTile(e,i){const r=this.lij,n=this.getNeighborLIJ(r,e);return n?Adt(r,n)?i(this)?this:null:this._findLIJ(n,i):null}findCorner(e,i){const r=e===rt.NORTH_EAST?1:e===rt.NORTH_WEST?0:e===rt.SOUTH_WEST?2:3;let n=this;for(;n.children[0]&&(!i||!i(n));)n=n.children[r];return n}findNeighborCornerTileExact(e,i){return this.findNeighborTile(e,r=>i(r)||r.level===this.level)?.findCorner(b5(e),i)||null}forAllSubtreeOnSide(e,i){const r=e===rt.NORTH?[0,1]:e===rt.NORTH_EAST?[1]:e===rt.EAST?[1,3]:e===rt.SOUTH_EAST?[3]:e===rt.SOUTH?[2,3]:e===rt.SOUTH_WEST?[2]:e===rt.WEST?[0,2]:[0],n=s=>{const o=s.children;!i(s)&&o[0]&&r.forEach(a=>n(o[a]))};n(this)}getNeighborEdgeStartVertexIndex(e,i){if(!i)return 0;const r=this.level-i.level;if(Se(!us||r>=0),r===0)return 0;const n=2**r,s=(1&e)==1,o=s?0:1,a=i.lij[o+1]*n,l=this.lij[o+1],c=l-a,u=s?n-1-c:c;return us&&(Se(a<=l&&l<a+n),Se(0<=u&&u<n)),u}forEachLoadedNeighbor(e){const i=this.level,r=n=>n.level===i||n.isLoaded;ng.forEach(n=>{const s=this.findNeighborTile(n,r);s!=null&&s!==this&&s.forAllSubtreeOnSide(SZ(n),o=>!!o.isLoaded&&(e(o,n),!0))}),w5.forEach(n=>{const s=this.findNeighborTile(n,r)?.findCorner(b5(n),o=>o.isLoaded);Se(!s||Mj(this,s,n)),s?.isLoaded&&e(s,n)})}getNeighborLIJ(e,i){const r=coe(i)?-1:loe(i)?1:0,n=ooe(i)?-1:aoe(i)?1:0,s=[e[0],e[1]+r,e[2]+n];return s[1]<0?null:this.surface.isGlobal?this.wrapLIJ(s):s[2]<0?null:s}wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){const e=this.surface.extent,i=e?.[1]??null;return i!=null&&this.extent[1]+mo()>=i}checkGeometryWaterproofness(){_5&&(Se(this.isLoaded),this.renderData?.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const i=this.extent,r=this.surface.rootTilesExtent,n=.25*(i[2]-i[0]);if(coe(e)&&i[3]+n>=r[3]||loe(e)&&i[1]-n<=r[1])return!1;const s=this.surface.isGlobal;return!(!s&&ooe(e)&&i[0]-n<=r[0])&&!(!s&&aoe(e)&&i[2]+n>=r[2])}updateDistanceToPOI(e){const i=this._lastPOI;if(this.distanceToPOI>=0&&i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2])return;se(this._lastPOI,e);const r=this._center[Un.MIDDLE],n=e[0]-r[0],s=e[1]-r[1],o=e[2]-r[2];this.distanceToPOI=n*n+s*s+o*o}};function Sdt(t,e,i,r){const n=i===Vt.ELEVATION?RZ.acquire():OZ.acquire();return n.init(t,e,i,r),n}function L$(t){t.dispose(),t instanceof yEe?RZ.release(t):t instanceof _Ee&&OZ.release(t)}const OZ=new aa(_Ee),RZ=new aa(yEe),Edt=new J2;var Un;function Cdt(t,e){const i=t.level,r=e[0];if(i>r)return!1;const n=r-i,s=Math.floor(e[1]/2**n),o=Math.floor(e[2]/2**n);return s===t.lij[1]&&o===t.lij[2]}function Adt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Odt(t,e,i){if(t==null||e==null)return!1;if(t.level===0&&e.level===0&&(t.isEastEnd&&e.isWestEnd&&i===rt.EAST||t.isWestEnd&&e.isEastEnd&&i===rt.WEST))return!0;const r=Math.max(1e-6*(t.extent[2]-t.extent[0]),1);switch(i){case rt.NORTH:return th(t.extent[3],e.extent[1],r);case rt.SOUTH:return th(t.extent[1],e.extent[3],r);case rt.EAST:return th(t.extent[2],e.extent[0],r)||th(t.extent[2],-e.extent[0],r);case rt.WEST:return th(t.extent[0],e.extent[2],r)||th(t.extent[0],-e.extent[2],r)}}function Mj(t,e,i){return t!=null&&e!=null&&e!==t&&(t.level>=e.level?Toe(t,e,i):Toe(e,t,b5(i)))}function Toe(t,e,i){Se(t.level>=e.level);const r=jut(i),n=Hut(i),s=t.extent,o=e.extent,a=[r?s[0]:s[2],n?s[3]:s[1]],l=[r?o[2]:o[0],n?o[1]:o[3]],c=1e-5*(s[2]-s[0]),u=th(a[0],l[0],c)||t.surface.isGlobal&&th(a[0],-l[0],c),d=th(a[1],l[1],c);if(u&&d)return!0;if(t.level===e.level||!u&&!d)return Se(!1),!1;const p=u?Soe(o[1],o[3],s[1],s[3],c):Soe(o[0],o[2],s[0],s[2],c);return Se(p),p}function Soe(t,e,i,r,n){return t-n<=i&&i<=r&&r<=e+n}(function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM"})(Un||(Un={}));const D$=C(),X8=C(),Z8=C(),Qs=C();let Rdt=class{constructor(){this._scales=Mt(-1,-1,-1,-1),this._offsets=Mt(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,i,r){this._scales[2*e]=i,this._scales[2*e+1]=r}setOffset(e,i,r){this._offsets[2*e]=i,this._offsets[2*e+1]=r}get scales(){return this._scales}get offsets(){return this._offsets}};function Pdt(t,e){t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),e.spherical?t.vertex.code.add(b`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):t.vertex.code.add(b`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),t.fragment.code.add(b`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}var yf;(function(t){t[t.LayerOnly=0]="LayerOnly",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.COUNT=3]="COUNT"})(yf||(yf={}));let Mdt=class extends CX{constructor(){super(...arguments),this.overlayOpacity=1}};function $dt(t,e){const{vertex:i,fragment:r,varyings:n}=t;n.add("vtc","vec2"),i.uniforms.add(new Eoe("texOffsetAndScale")),r.uniforms.add(new Coe("tex")),r.uniforms.add(new J8("textureOpacities"));const s=e.textureFadingEnabled&&!e.renderOccluded;s&&(i.uniforms.add(new Eoe("nextTexOffsetAndScale")),n.add("nvtc","vec2"),r.uniforms.add(new Coe("texNext")),r.uniforms.add(new J8("nextTexOpacities")),r.uniforms.add(new Idt("fadeFactor")));const o=e.tileBlendInput===yf.ColorComposite,a=e.tileBlendInput===yf.GridComposite;a&&r.include(CZ),o&&r.uniforms.add(new J8("backgroundColor")),i.code.add(b`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${s?b`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:b``}
  }`),r.code.add(b`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${a||o?b`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${o?b`backgroundColor`:b`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:b`return color;`}
    }`),s?r.code.add(b`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):r.code.add(b`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)}let Idt=class extends Qr{constructor(e){super(e,"float")}},J8=class extends Qr{constructor(e){super(e,"vec3")}},Eoe=class extends Qr{constructor(e){super(e,"vec4")}},Coe=class extends Qr{constructor(e){super(e,"sampler2D")}},xEe=class extends Mdt{};function Ldt(t){const e=new mi,{vertex:i,fragment:r,varyings:n}=e;e.include(AR),e.include(UR,t),e.include(xf,t);const s=()=>{e.include(PO,t),i.code.add(b`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};tc(i,t),e.include(ml,t);const o=t.overlayMode!==gf.Disabled,a=o&&t.invisible;switch(t.output){case U.Color:{e.include($dt,t),e.include(Vb,t),o&&e.include(UE,{...t,pbrMode:t.pbrMode===it.Terrain?it.TerrainWithWater:it.Water});const l=t.overlayMode===gf.EnabledWithWater;l&&e.include(Pdt,t),n.add("vnormal","vec3"),n.add("vpos","vec3"),n.add("vup","vec3"),s(),t.screenSizePerspective&&aS(i);const c=t.receiveShadows&&!t.renderOccluded;c&&e.include(qS,t),t.screenSizePerspective&&(n.add("screenSizeDistanceToCamera","float"),n.add("screenSizeCosAngle","float")),i.code.add(b`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${l?b`forwardVertexTangent(vnormal);`:b``}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${o?b`setOverlayVTC(uv);`:""}
          ${t.tileBorders?b`forwardTextureCoordinates();`:""}

          ${t.screenSizePerspective?b`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${c?b`forwardLinearDepth();`:""}

        }
      `),e.include(vn,t),e.include(Vb,t),e.include(BR,t),e.include(Gb,t),Xd(r,t),VR(r),JS(r),r.uniforms.add(i.uniforms.get("localOrigin"),new $t("viewDirection",(u,d)=>ge(Aoe,oe(Aoe,d.camera.viewMatrix[12],d.camera.viewMatrix[13],d.camera.viewMatrix[14])))),l&&r.uniforms.add(new Je("ovWaterTex",(u,d)=>d.overlay?.getTexture($r.WaterNormal)),new r1e("view",(u,d)=>yl(Ddt,d.camera.viewMatrix,u.origin))),r.code.add(b`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),Bg(r),Wf(r),r.code.add(b`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${t.receiveShadows&&!t.renderOccluded?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${o?b`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${t.invisible?b`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${t.pbrMode===it.Terrain||t.pbrMode===it.TerrainWithWater?b`fragColor = vec4(evaluateTerrainLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:b`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${l?b`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${t.screenSizePerspective?b`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${t.visualizeNormals?t.spherical?b`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:b`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${t.tileBorders?b`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          fragColor = highlightSlice(fragColor, vpos);
        }
      `)}break;case U.Depth:a&&e.include(UE,t),e.include(Mg,t),u_(e),Ub(e),i.code.add(b`
              void main(void) {
                ${a?b`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `),r.code.add(b`
              void main() {
                ${a?b`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case U.Shadow:case U.ShadowHighlight:case U.ShadowExcludeHighlight:e.include(Mg,t),u_(e),Ub(e),i.code.add(b`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),r.code.add(b`void main() {
outputDepth(linearDepth);
}`);break;case U.Normal:a&&e.include(UE,t),n.add("vnormal","vec3"),aS(i),s(),i.code.add(b`
            void main(void) {
              ${a?b`setOverlayVTC(getUV0());`:""}
              gl_Position = transformPosition(proj, view, position);
              vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
            }
        `),r.code.add(b`
            void main() {
              ${a?b`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              vec3 normal = normalize(vnormal);
              if (gl_FrontFacing == false) {
                normal = -normal;
              }
              fragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
            }
        `);break;case U.Highlight:o&&e.include(UE,t),i.code.add(b`
          void main() {
            ${o?b`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),e.include(I_,t),r.code.add(b`
          void main() {
            ${o?b`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return t.output===U.ObjectAndLayerIdColor&&(o?(e.include(UE,{...t,pbrMode:it.Disabled}),i.code.add(b`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),r.code.add(b`void main() {
fragColor = getOverlayColorTexel(vtcOverlay);
}`)):(i.code.add(b`void main(void) {}`),r.code.add(b`void main() {
fragColor = vec4(0.0);
}`))),e}const Ddt=be(),Aoe=C(),Ndt=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:xEe,build:Ldt},Symbol.toStringTag,{value:"Module"}));let TEe=class SEe extends Ci{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(e,i){i.spherical=e.viewingMode===Me.Global}initializeProgram(e){return new wi(e.rctx,SEe.shader.get().build(this.configuration),EEe)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const i=this.configuration,r=i.backfaceCullingEnabled&&!i.renderOccluded;return Ot({blending:i.renderOccluded?cc(Te.ONE,Te.ONE_MINUS_SRC_ALPHA):null,culling:r?hY:null,depthTest:i.renderOccluded?null:{func:Pi.LESS},depthWrite:i.renderOccluded?null:_l,colorWrite:Ft,stencilTest:e?rKe(gl.IntegratedMeshMaskExcluded):null})}getPipeline(){return this.useStencil?this._stencilPipelineState:super.getPipeline()}};TEe.shader=new bi(Ndt,()=>pe(()=>import("./Terrain.glsl-a4742dec.js"),[],import.meta.url));const EEe=new Map([[O.POSITION,0],[O.UV0,1],[O.NORMALCOMPRESSED,2]]);let Fdt=class{constructor(){this.geometry=new Ght,this.intersectionData=null,this.geometryState=null,this._textureRef=new pEe(()=>this.tile.surface.textureFadeDuration),this.overlay=new Rdt,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._dirtyEdgeResolutions=15,this._dirtyEdges=15,this._dirtyCorners=15}get tile(){return this._tile}init(e){this.clear(),this._tile=e;const i=this.geometry;i.indices=null,i.vertexAttributes=null,vr(i.boundingBox),i.indexCount=0,i.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new qht,this.localOrigin=null,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this._wireframeChanged||this._clippingAreaChanged||this._samplerDataChanged||this._numVerticesPerSideChanged||this._dirtyCorners||this._dirtyEdgeResolutions||this._dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),us&&this.tile.intersectsClippingArea)for(let i=0;i<4;++i)Se(this.geometry.outerEdges[i].count===this.geometryState.neighborData.edgeResolutions[i]+1)}_calculateEdgeResolution(e,i){const r=this.tile,n=this.geometryState.numVerticesPerSide-1;if(!r.surface.isGlobal){const l=r.surface.extent;if(l!=null&&(e===0&&r.extent[3]>l[3]||e===1&&r.extent[2]>l[2]||e===2&&r.extent[1]<l[1]||e===3&&r.extent[0]<l[0]))return n}const s=r.level,o=ng[e];if(!i)return Se(r.surface?.rootTiles==null||r.surface.updatingRootTiles||!r.shouldHaveNeighbor(o)),n;if(i.isLoaded){const l=i,c=l.renderData.geometryState,u=s-l.level;if(Se(u>=0),u===0){const m=c.numVerticesPerSide-1;return Math.max(m,n)}const d=2**u,p=c.neighborData.edgeResolutions[(e+2)%4]/d;return Math.max(1,p)}Se(!i.isLeaf);let a=n;return i.forAllSubtreeOnSide(SZ(o),l=>l===r||(l.isLoaded?(a=Math.max(a,2**(l.level-s)),!0):(Se(!l.isLeaf),!1))),a}updateNeighborData(){const e=this.tile;if(!e.intersectsClippingArea)return;const i=e.renderData.geometryState.neighborData,r=a=>(a.isLoaded||a.level===e.level)&&a?.intersectsClippingArea,n=i.edgePeerNeighbors,s=i.edgePeerNeighborSamplerVersions;for(let a=0;a<4;++a){const l=e.findNeighborTile(ng[a],r),c=M1(e,l),u=c?.renderData?.geometryState.samplerDataVersion??-1,d=n[a],p=c!==M1(e,d),m=s[a]!==u;n[a]=l,(p||m)&&(s[a]=u,this._markEdgeDirty(a));const y=i.edgeResolutions[a],_=this._calculateEdgeResolution(a,l);Se(Eb(_)),Se(_>=1),i.edgeResolutions[a]=_,y!==_&&this._markEdgeResolutionDirty(a)}const o=i.cornerPeerNeighbors;for(let a=0;a<4;++a){const l=e.findNeighborTile(w5[a],r);o[a]=l;const c=M1(e,n[a]),u=M1(e,n[(a+1)%4]),d=M1(e,l);jh[a]=d,jh[(a+1)%4]=u,jh[(a+2)%4]=e,jh[(a+3)%4]=c,Se(jh.some(_=>_?.isLoaded||_===e));const p=jh.reduce((_,v)=>Math.min(_,v?.level??1/0),1/0);jh.forEach((_,v)=>{_&&_?.level>p&&(jh[v]=null)}),Se(jh.some(_=>_?.isLoaded||_===e));const m=i.cornerNeighborData[a].cornerTiles,y=i.cornerNeighborData[a].cornerTileSamplerVersions;for(let _=0;_<4;++_){const v=jh[_],w=v?.renderData.geometryState.samplerDataVersion??-1,x=m[_]!==v,T=!x&&y[_]!==w;(x||T)&&(m[_]=v,y[_]=w,this._markCornerDirty(a))}Se(m.some(_=>_?.isLoaded||_===e))}us&&Se(this.geometryState.neighborData.edgeResolutions.every(a=>a>0));for(let a=0;a<4;++a)jh[a]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;us&&Se(!this.tile.intersectsClippingArea||this.geometryState.neighborData.edgeResolutions.every(l=>l>0)),this.intersectionData=null;const i=this.tile,r=this._vao,n=this.geometry.vertexAttributes,s=!r||!n||this._wireframeChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._dirtyEdgeResolutions,o=!s&&(this._dirtyEdges!==0||this._dirtyEdgeResolutions!==0),a=!o&&this._dirtyCorners!==0;s?(this.releaseGeometry(),this._createGeometry(e)):o||a?i.updateEdgeElevations():a?i.updateCornerElevations():console.warn("Update for no reason?"),this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._dirtyEdgeResolutions=0,this._dirtyEdges=0,this._dirtyCorners=0,this._clippingAreaChanged=!1,this._wireframeChanged=!1}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao=et(this._vao),this.geometry.release(),!0)}ensureTexture(e,i,r){const n=i?pt.RGBA:pt.RGB;return this._texture==null||this._texture.descriptor.width===e&&this._texture.descriptor.pixelFormat===n||this.releaseTexture(),this._texture==null&&(this._texture=r(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){this._texture!=null&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}_markCornerDirty(e){const i=1<<e;this._dirtyCorners|=i}_markEdgeDirty(e){const i=1<<e;this._dirtyEdges|=i,this._markCornerDirty((e+0)%4),this._markCornerDirty((e+3)%4)}_markEdgeResolutionDirty(e){const i=1<<e;this._dirtyEdgeResolutions|=i,this._markEdgeDirty(e)}_markAllEdgesAndCornersDirty(){this._dirtyCorners=15,this._dirtyEdges=15,this._dirtyEdgeResolutions=15}updateGeometryState(){const e=this._getElevationInfo(),i=this.tile,r=e.samplerData?i.getElevationVerticesPerSide(e.maxTileLevel):i.getDefaultVerticesPerSide(),n=Math.max(r,5);let s=i.clippingArea;i.intersectsClippingArea&&!i.isWithinClippingArea||(s=null);const o=this.geometryState;let a=!1;o.numVerticesPerSide!==n&&(this._numVerticesPerSideChanged=!0,o.numVerticesPerSide=n,o.samplerDataVersion++,a=!0),e.changed&&(this._samplerDataChanged=!0,o.samplerData=e.samplerData,o.samplerDataVersion++,a=!0),yg(o.clippingArea,s)||(this._clippingAreaChanged=!0,o.clippingArea=s,a=!0);const l=i.surface.wireframe;return o.wireframe!==l&&(this._wireframeChanged=!0,o.wireframe=l,a=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const i=this.geometry.vertexAttributes,r=this.geometry.indices,n=e.gl;this._vao=new np(e,EEe,{geometry:pc(i.layout)},{geometry:Ri.createVertex(e,n.STATIC_DRAW,i.buffer)},Ri.createIndex(e,n.STATIC_DRAW,r)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,i=mg.Immediate){e!=null&&e.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(e,i)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,i=this.tile.layerInfo[Vt.ELEVATION],r=i.length,n=new Array(r);let s=0,o=0,a=!1;for(let u=0;u<r;u++){const d=i[u];if(d.upsampleInfo!=null){const p=d.upsampleInfo.tile,m=p.layerInfo[Vt.ELEVATION][u].data,y=m&&m.samplerData;e&&e[s]===y||(a=!0),n[s++]=y,o=Math.max(o,p.lij[0])}else if(d.data){const p=this.tile.surface.layerViewByIndex(u,Vt.ELEVATION);if(M3(this.tile,p.layer,!1)){const m=d.data;e&&e[s]===m.samplerData||(a=!0),n[s++]=m.samplerData,o=this.tile.level}}}e!=null&&e.length!==s&&(a=!0);const l=s>0,c=l?n:null;return l&&(n.length=s),{changed:a,samplerData:c,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){const e=this.intersectionData?.estimatedMemoryUsage??0;return(this.geometry.indices?.byteLength??0)+(this.geometry.vertexAttributes?.byteLength??0)+e}get texture(){return this._texture}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){if(!us)return;const e=this.tile;if(!e.isLoaded||!e.intersectsClippingArea||e.level===0)return void Se(e?.isLoaded);const i=e.surface.extent;if(i!=null&&!e.intersectsExtent(i))return;const r=ng.map((a,l)=>i!=null&&(l<2?-1:1)*(e.extent[3-l]-i[3-l])<0),n=e.level;Se(this._dirtyCorners===0),Se(this._dirtyEdges===0),Se(this._dirtyEdgeResolutions===0),Se(!this._numVerticesPerSideChanged),Se(!this._samplerDataChanged),Se(!this._clippingAreaChanged),Se(!this._wireframeChanged);const s=w5.map(a=>e.findNeighborCornerTileExact(a,l=>!l.intersectsClippingArea||l.isLoaded||l.level===e.level)??null).map(a=>a?.intersectsClippingArea?a:null),o=this.geometryState.neighborData;for(let a=0;a<4;++a){const l=o.cornerPeerNeighbors[a],c=s[a];Se(c===l,`Tile[${e.lij}].corner[${a}] out of date: cur=[${l?.lij}] exp=[${c?.lij}]`)}ng.forEach((a,l)=>{if(r[l])return;const c=e.findNeighborTile(a,G=>(G.level===n||G?.isLoaded)&&G?.intersectsClippingArea);if(!c){const G=!e.surface.updatingRootTiles&&e.surface.rootTiles!=null&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(a);return void Se(!G)}Se(c.isLoaded||c.level===e.level),Se(c===this.geometryState.neighborData.edgePeerNeighbors[l]);const u=n-c.level;if(!c.isLoaded)return Se(!c.isLeaf),void Se(u===0);const d=c.renderData;Se(Odt(e,c,a)),Se(u>=0);const p=2**u;if(u<0)return void Se(!1);const m=e.renderData,y=m.geometry,_=y.outerEdges[l],v=y.numVerticesPerSide-1,w=d.geometry;if(!w)return void Se(!1);const x=this.geometryState.neighborData.edgePeerNeighbors[l];if(x?.isLoaded){const G=x.renderData;Se(x==x),Se(m.geometryState.neighborData.edgePeerNeighborSamplerVersions[l]===G.geometryState.samplerDataVersion),Se(this.geometryState.neighborData.edgePeerNeighborSamplerVersions[l]===G.geometryState.samplerDataVersion)}const T=(l+2)%4,S=w.outerEdges[T],E=_.count-1,A=S.count-1;Se(E*p===A,`Tile[${e.lij}]:e${l},res=${E} edgeRes mismatch with Neighbor[${c.lij}]:e${T},res=${A} (expected:${E*p})`);const P=e.extent,N=a===rt.NORTH||a===rt.SOUTH,F=S.count-1,D=F/2**u,$=_.count-1;if(D<1)return void Se($===1);Se(D===$),Se(Eb(D));const R=w.numVerticesPerSide-1;Se(u>0||D===Math.max(R,v));const k=e.getNeighborEdgeStartVertexIndex(l,c);Se(0<=k&&k<p);const B=k*D;Se(0<=B&&B<=F-D);let j=0,X=B;_.getVertexPos(Cp,0),_.getVertexPos(Ap,_.count-1);const M=br(Cp,Ap),I=Math.max(kdt,1e-4*M);for(let G=0;G<=D;++G){_.getVertexPos(Cp,j),S.getVertexPos(Ap,X);const q=G/D,Z=N?P[0]+q*(P[2]-P[0]):a===rt.WEST?P[0]:P[2],K=N?a===rt.SOUTH?P[1]:P[3]:P[1]+q*(P[3]-P[1]),Q=e.surface.extent;if(Q==null||F4(Q,Z,K)){const de=aR(Cp,Ap),Ae=zl(Cp)-yi.radius,st=zl(Ap)-yi.radius,vt=de<I;if(!vt){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${l}[${j}/${_.count}] and [${c.lij}].edge${T}[${X}/${S.count}]`),Q!=null&&console.warn("  surface extent= ",Q," x,y=",Z,",",K);const ze=C();he(ze,m.localOrigin,d.localOrigin),zl(ze)>0&&console.warn(`   localOrigins: ${m.localOrigin} vs ${d.localOrigin} d=${zl(ze)} [${ze}]`),(()=>{const ue=Br(Cp),xt=Br(Ap);e.updateEdgeElevations(),c.updateEdgeElevations(),_.getVertexPos(Cp,j),S.getVertexPos(Ap,X);const ve=C();zs(ve,Cp,ue),zl(ve)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${ue} vs ${Cp} d=${zl(ve)} [${ve}]`),zs(ve,Ap,xt),zl(ve)>0&&console.warn(`  XXX Neighbor[${c.lij}] edge out of date: ${xt} vs ${Ap} d=${zl(ve)} [${ve}]`)})(),Se(vt,`Mismatch in tile [${e.lij}].edge[${l}][${j}/${_.count}] vs neighbor [${c.lij}].edge[${T}][${X}/${S.count}] ${mm(Cp)} vs ${mm(Ap)}  dist=${de} h(t|n|d)=${Ae}|${st}|${st-Ae}`)}_.getNormal(wx,j),S.getNormal(xx,X),ge(Ooe,wx),ge(Roe,xx);const ot=me(Ooe,Roe),gt=1-ot<.01||!1||e===c;if(!gt){const ze=C();zs(ze,wx,xx);const ue=()=>`Mismatch in tile edge normal ${soe(e.lij)} (${j}/${_.count-1}) edge ${l} vs neighbor ${soe(c.lij)}  (${X}/${S.count-1}) nedge ${T} :${mm(wx)} vs ${mm(xx)}  dot = ${ot} : ${mm(ze)}`;console.warn("Mismatch in tile edge normal: ",ue());{e.updateEdgeElevations(),c.updateEdgeElevations();const xt=C(),ve=C();_.getNormal(xt,j),S.getNormal(ve,X),xb(wx,xt)||console.warn("Missing update in tile normal: ",mm(wx)," => ",mm(xt)),xb(xx,ve)||console.warn("Missing update in neighbor normal: ",mm(xx)," => ",mm(ve))}Se(gt,ue())}}j+=1,X+=1}})}};const Cp=C(),Ap=C(),wx=C(),xx=C(),Ooe=C(),Roe=C(),kdt=1,jh=[null,null,null,null];function M1(t,e){return e?.isLoaded||e===t?e:null}const Udt=65536;function zdt(t,e){const i=t.tile,{extent:r,extentInRadians:n,surface:s}=i,o=t.localOrigin,a=t.geometryState,l=s.isWebMercator,c=a.numVerticesPerSide,u=c-1,d=(c-2)**2,p=l&&(e===eh.HAS_SOUTH_POLE||e===eh.HAS_BOTH_POLES),m=l&&(e===eh.HAS_NORTH_POLE||e===eh.HAS_BOTH_POLES),y=6,_=((p?1:0)+(m?1:0))*y*(u+1),v=a.neighborData,w=v.edgeResolutions.reduce((N,F)=>N+F+1,0),x=d+_+w,T=s.renderer.tileGeometryCache.acquire(x),S=t.geometry;S.numVerticesPerSide=a.numVerticesPerSide,S.vertexAttributes=T;const E=S.boundingBox;vr(E);const A=PZ(t);oo.update(u,n,A),Bdt(t),DEe(t,d),CEe(t);const P=[];if((()=>{let N=d+w;const F=o[0],D=o[1],$=o[2],R=i.ellipsoid.radius,k=r[1],B=r[3],j=(X,M)=>{const I=M*c;ch(-F,-D,X*R-$,E),P.push({connectedRowOffset:I,connectedOuterEdgeOffset:X===1?0:2,rowOffset:N,latitudeResolution:y});const G=REe(X===-1?k:B,R),q=X*Math.PI/2-G,Z=.99*(X===1?1:-1),K=R+0,{position:Q,uv0:de}=T,{typedBuffer:Ae,typedBufferStride:st}=T.normalCompressed;for(let vt=1;vt<=y;++vt){const ot=G+q*(vt/y),gt=Math.cos(ot),ze=Math.sin(ot);for(let ue=0;ue<=u;ue++){const xt=ue/u,ve=oo.sinLonLUT[ue],De=oo.cosLonLUT[ue]*gt,tt=ve*gt,mt=ze,bt=De*K-F,At=tt*K-D,Ve=mt*K-$;ch(bt,At,Ve,E),Q.setValues(N,bt,At,Ve),Vd(de,N,xt,Z),qb(Ae,N,De,tt,mt,st),++N}}};p&&j(-1,0),m&&j(1,u)})(),LEe(S,a.numVerticesPerSide,P,[0,c-1],[0,c-1],a.wireframe),t.intersectionData=null,us)for(let N=0;N<4;++N)Se(S.outerEdges[N].count===v.edgeResolutions[N]+1)}function Bdt(t){const e=t.tile;if(!e.intersectsClippingArea)return;const i=t.geometryState,r=i.numVerticesPerSide,n=r-2,s=r-1,o=t.geometry,a=o.vertexAttributes,l=a.position,c=a.uv0,{typedBuffer:u,typedBufferStride:d}=a.normalCompressed,p=e.extent,m=p[0],y=p[2],_=p[1],v=p[3],w=e.ellipsoid.radius,x=i.samplerData,T=t.localOrigin,S=T[0],E=T[1],A=T[2],P=l.typedBuffer,N=l.typedBufferStride,F=1/s,D=o.boundingBox;let $=0;if(1<=n){const R=F,k=_*(1-R)+v*R,B=oo.sinLatLUT[1],j=oo.cosLatLUT[1];for(let X=1;X<=n;X++){const M=X*F,I=m*(1-M)+y*M,G=oo.sinLonLUT[X],q=oo.cosLonLUT[X],Z=w+Xr(I,k,x),K=Z*q*j-S,Q=Z*G*j-E,de=Z*B-A;ch(K,Q,de,D);const Ae=(X-1)*N;P[Ae]=K,P[Ae+1]=Q,P[Ae+2]=de,Vd(c,X-1,M,R)}}for(let R=1;R<=n;R++){const k=R*F,B=_*(1-k)+v*k,j=oo.sinLatLUT[R],X=oo.cosLatLUT[R],M=R+1,I=M*F,G=_*(1-I)+v*I,q=oo.sinLatLUT[M],Z=oo.cosLatLUT[M],K=oo.sinLonLUT[0],Q=oo.cosLonLUT[0],de=w+Xr(m,B,x);let Ae=Q*X*de-S,st=K*X*de-E,vt=j*de-A;const ot=$*N;let gt=P[ot],ze=P[ot+1],ue=P[ot+2];for(let xt=1;xt<=n;xt++){const ve=xt*F,De=m*(1-ve)+y*ve,tt=oo.sinLonLUT[xt],mt=oo.cosLonLUT[xt];let bt=0,At=0,Ve=0;if(xt<n){const ci=($+1)*N;bt=P[ci],At=P[ci+1],Ve=P[ci+2]}else{const ci=oo.sinLonLUT[s],or=oo.cosLonLUT[s],Dr=w+Xr(y,B,x);bt=or*X*Dr-S,At=ci*X*Dr-E,Ve=j*Dr-A}const Tt=Ae,jt=st,$i=vt;Ae=gt,st=ze,vt=ue,gt=bt,ze=At,ue=Ve;const ct=bt-Tt,dt=At-jt,at=Ve-$i;let Ht=0,zt=0,fr=0;if(R>1){const ci=($-n)*N;Ht=P[ci],zt=P[ci+1],fr=P[ci+2]}else{const ci=oo.sinLatLUT[0],or=oo.cosLatLUT[0],Dr=w+Xr(De,_,x);Ht=mt*or*Dr-S,zt=tt*or*Dr-E,fr=ci*Dr-A}const Bi=w+Xr(De,G,x),ei=mt*Z*Bi-S,xi=tt*Z*Bi-E,wr=q*Bi-A;if(R<n){const ci=$+n,or=ci*N;P[or]=ei,P[or+1]=xi,P[or+2]=wr,ch(ei,xi,wr,D),Vd(c,ci,ve,I)}const mr=Ht-ei,gr=zt-xi,Ai=fr-wr;let Lr=mt*X,ki=tt*X,sr=j;sr*sr<.999&&(Lr=at*gr-dt*Ai,ki=ct*Ai-at*mr,sr=dt*mr-ct*gr);const Qi=1/Math.sqrt(Lr*Lr+ki*ki+sr*sr);qb(u,$,Lr*Qi,ki*Qi,sr*Qi,d),++$}}}function Vdt(t){t.tile.intersectsClippingArea&&(CEe(t),wk(t))}function Gdt(t){t.tile.intersectsClippingArea&&(OEe(t),AEe(t,!0),wk(t))}function CEe(t){t.tile.intersectsClippingArea&&(OEe(t),AEe(t))}function AEe(t,e=!1){const i=t.geometryState,r=t.geometry,n=i.neighborData,s=t.tile,o=s.level,a=s.extent,l=s.ellipsoid.radius,c=s.extentInRadians,u=c[0],d=c[2],p=c[1],m=c[3],y=i.samplerData,_=a[0],v=a[2],w=a[1],x=a[3],T=PZ(t),S=r.boundingBox,E=t.localOrigin,A=E[0],P=E[1],N=E[2],F=r.vertexAttributes,D=F.position,$=D.typedBuffer,R=D.typedBufferStride,k=F.uv0;for(let B=0;B<4;++B){const j=B===1||B===3,X=n.edgeResolutions[B];Se(Eb(X));const M=X+1,I=M1(s,n.edgePeerNeighbors[B]);if(kEe(s,I,B)){NEe(t,B,I);continue}const G=I!=null;Se(!G||I.level===s.level),Se(!G||gg(s,I)<=0);const q=I?.renderData,Z=q?.geometryState;if(us){const ct=s.surface;if(!I&&ct&&!ct.updatingRootTiles){const dt=ng[B],at=s.findNeighborTile(dt,Ht=>Ht.isLoaded||Ht.isLeaf||Ht.level===s.level);at?at.intersectsClippingArea&&(Se(!at.isLoaded),Se(!at.isLeaf),Se(at.level===o)):Se(ct?.rootTiles==null||!s.shouldHaveNeighbor(dt))}}const K=B===1?a[2]:a[0],Q=I?.extent,de=Q&&j?B===1?Q[0]:Q[2]:K,Ae=B===0?a[3]:a[1],st=B===1?1:0,vt=B===0?1:0,ot=B===1?d:u,gt=B===0?m:p,ze=Math.sin(ot),ue=Math.cos(ot),xt=Math.sin(gt),ve=Math.cos(gt),De=Z?.samplerData,tt=G?(ct,dt,at)=>.5*(Xr(ct,dt,y)+Xr(at,dt,De)):(ct,dt,at)=>Xr(ct,dt,y),mt=r.outerEdges[B],bt=e&&M>3?M-3:1,At=y!=null&&y.some(ct=>ct!=null),Ve=De!=null&&De.some(ct=>ct!=null),Tt=At||Ve,jt=1/X,$i=mt.index0;Se(!Q||th(Q[2]-Q[0],a[2]-a[0])),(()=>{const ct=B===1?-1:B===3?1:0,dt=B===0?-1:B===2?1:0,at=(a[2]-a[0])*jt,Ht=ct*at,zt=dt*at,fr=j?ct*((d-u)*jt):0,Bi=j?0:dt*jt,ei=vt,xi=j?ot+fr:ot,wr=j?Math.sin(xi):ze,mr=j?Math.cos(xi):ue,gr=j?ot-fr:ot,Ai=j?Math.sin(gr):ze,Lr=j?Math.cos(gr):ue,ki=j?gt:T(ei+Bi),sr=j?xt:Math.sin(ki),Qi=j?ve:Math.cos(ki),ci=j?gt:T(ei-Bi),or=j?xt:Math.sin(ci),Dr=j?ve:Math.cos(ci);let Ys=0,Xs=0,Zs=0;{const Vi=0*jt,Ts=j?K:_*(1-Vi)+v*Vi,_o=j?de:Ts,da=j?w*(1-Vi)+x*Vi:Ae,re=j?ot:u*(1-Vi)+d*Vi,xr=j?ze:Math.sin(re),$h=j?ue:Math.cos(re),Ss=j?T(Vi):gt,Ih=j?Math.sin(Ss):xt,Xe=j?Math.cos(Ss):ve,wl=l+tt(Ts,da,_o);Ys=$h*Xe*wl,Xs=xr*Xe*wl,Zs=Ih*wl}let Js=0,qr=0,Nr=0;{const Vi=1*jt,Ts=j?K:_*(1-Vi)+v*Vi,_o=j?de:Ts,da=j?w*(1-Vi)+x*Vi:Ae,re=j?ot:u*(1-Vi)+d*Vi,xr=j?ze:Math.sin(re),$h=j?ue:Math.cos(re),Ss=j?T(Vi):gt,Ih=j?Math.sin(Ss):xt,Xe=j?Math.cos(Ss):ve,wl=l+tt(Ts,da,_o);Js=$h*Xe*wl,qr=xr*Xe*wl,Nr=Ih*wl}for(let Vi=1;Vi<M-1;Vi+=bt){let Ts=0,_o=0,da=0;{const pa=(Vi+1)*jt,xl=j?K:_*(1-pa)+v*pa,ap=j?de:xl,Cs=j?w*(1-pa)+x*pa:Ae,en=j?ot:u*(1-pa)+d*pa,Qg=j?ze:Math.sin(en),V_=j?ue:Math.cos(en),G_=j?T(pa):gt,Sw=j?Math.sin(G_):xt,j_=j?Math.cos(G_):ve,e0=l+tt(xl,Cs,ap);Ts=V_*j_*e0,_o=Qg*j_*e0,da=Sw*e0}const re=Ts,xr=_o,$h=da,Ss=Js,Ih=qr,Xe=Nr;Js=re,qr=xr,Nr=$h;{const pa=$i+Vi,xl=pa*R,ap=Ss-A,Cs=Ih-P,en=Xe-N;$[xl]=ap,$[xl+1]=Cs,$[xl+2]=en,ch(ap,Cs,en,S);const Qg=Vi*jt;Vd(k,pa,j?st:Qg,j?Qg:vt)}const wl=Ys,Es=Xs,U_=Zs;Ys=Ss,Xs=Ih,Zs=Xe;const z_=Ss,Va=Ih,tm=Xe,B_=1/Math.sqrt(z_*z_+Va*Va+tm*tm),Wt=tm*B_;let Jg=0,im=0,Kg=0;if(Tt&&Wt*Wt<.999){let pa=0,xl=0,ap=0;{const Cs=B===0?-1:1;pa=Cs*(re-wl),xl=Cs*(xr-Es),ap=Cs*($h-U_)}{const Cs=Vi*jt,en=j?K:_*(1-Cs)+v*Cs,Qg=j?de:en,V_=j?w*(1-Cs)+x*Cs:Ae,G_=j?ot:u*(1-Cs)+d*Cs,Sw=j?ze:Math.sin(G_),j_=j?ue:Math.cos(G_),e0=j?T(Cs):gt,sP=j?Math.sin(e0):xt,Ga=j?Math.cos(e0):ve;let rE=z_,nE=Va,Y=tm;if(G){const fe=l+Xr(Qg-Ht,V_-zt,De),Ee=j?Ga:Dr;rE=(j?Lr:j_)*Ee*fe,nE=(j?Ai:Sw)*Ee*fe,Y=(j?sP:or)*fe}{const fe=l+Xr(en+Ht,V_+zt,y),Ee=j?Ga:Qi,oi=(j?mr:j_)*Ee*fe,Vn=(j?wr:Sw)*Ee*fe,yr=(j?sP:sr)*fe;G||(rE=2*z_-oi,nE=2*Va-Vn,Y=2*tm-yr);const fa=B===3?-1:1,H_=fa*(rE-oi),fJ=fa*(nE-Vn),mJ=fa*(Y-yr);Jg=ap*fJ-xl*mJ,im=pa*mJ-ap*H_,Kg=xl*H_-pa*fJ;const zk=1/Math.sqrt(Jg*Jg+im*im+Kg*Kg);Jg*=zk,im*=zk,Kg*=zk}}}else Jg=z_*B_,im=Va*B_,Kg=tm*B_;mt.setNormalFromValues(Vi,Jg,im,Kg)}})()}}function OEe(t){FEe(t)}function REe(t,e){return Math.PI/2-2*Math.atan(Math.exp(-t/e))}function jdt(t,e,i,r){return REe(t*(1-r)+e*r,i)}function Hdt(t,e,i){return t*(1-i)+e*i}function PZ(t){const e=t.tile;if(e.surface.isWebMercator){const r=e.extent,n=e.ellipsoid.radius;return s=>jdt(r[1],r[3],n,s)}const i=e.extentInRadians;return r=>Hdt(i[1],i[3],r)}function qdt(t,e){const i=t.tile,{extent:r,surface:n}=i,s=t.geometryState,o=r[0],a=r[1],l=r[2]-o,c=r[3]-a,u=s.clippingArea,d=u!=null?Math.max(0,(u[0]-o)/l):0,p=u!=null?Math.max(0,(u[1]-a)/c):0,m=u!=null?Math.min(1,(u[2]-o)/l):1,y=u!=null?Math.min(1,(u[3]-a)/c):1,_=s.numVerticesPerSide,v=(_-2)**2,w=v+s.neighborData.edgeResolutions.reduce((E,A)=>E+A+1,0),x=n.renderer.tileGeometryCache.acquire(w),T=t.geometry,S=T.boundingBox;vr(S),T.numVerticesPerSide=s.numVerticesPerSide,T.vertexAttributes=x,Mr(T.uvRange,d,p,m,y),Wdt(t),DEe(t,v),PEe(t),LEe(T,s.numVerticesPerSide,[],[0,_-1],[0,_-1],s.wireframe),t.intersectionData=null}function Wdt(t){const e=t.tile;if(!e.intersectsClippingArea)return;const i=e.surface,r=t.geometryState,n=r.samplerData,s=t.localOrigin,o=i.isWebMercatorOnPlateeCarree,a=r.clippingArea,l=a??MZ,c=e.extent,u=c[0],d=c[1],p=c[2],m=c[3],y=Math.max(u,l[0]),_=Math.min(p,l[2]),v=Math.max(d,l[1]),w=Math.min(m,l[3]),x=e.ellipsoid.radius,T=e.horizontalScale,S=r.numVerticesPerSide,E=S-1,A=S-2,P=t.geometry,N=P.vertexAttributes,F=N.position,D=N.uv0,{typedBuffer:$,typedBufferStride:R}=N.normalCompressed,k=P.uvRange,B=k[0],j=k[1],X=k[2],M=k[3],I=P.boundingBox,G=s[0],q=s[1],Z=s[2],K=F.typedBuffer,Q=F.typedBufferStride;let de=0;const Ae=_e(d,v,w),st=o?(Math.PI/2-2*Math.atan(Math.exp(-Ae/x)))*x:Ae*T,vt=1/E,ot=_e(d*(1-vt)+m*vt,v,w);let gt=st,ze=o?(Math.PI/2-2*Math.atan(Math.exp(-ot/x)))*x:ot*T;for(let ue=1;ue<=A;ue++){const xt=ue/E,ve=_e(d*(1-xt)+m*xt,v,w),De=_e(xt,j,M),tt=ze,mt=(ue-1)/E,bt=_e(d*(1-mt)+m*mt,v,w),At=gt,Ve=(ue+1)/E,Tt=_e(d*(1-Ve)+m*Ve,v,w),jt=o?(Math.PI/2-2*Math.atan(Math.exp(-Tt/x)))*x:Tt*T,$i=_e(Ve,j,M);gt=ze,ze=jt;const ct=_e(u,y,_);let dt=ct*T,at=Xr(ct,ve,n);const Ht=1/E,zt=_e(Ht,B,X),fr=_e(u*(1-zt)+p*zt,y,_);let Bi=zt,ei=fr,xi=fr*T,wr=Xr(fr,ve,n);if(ue===1){const mr=xi-G,gr=gt-q,Ai=wr-Z,Lr=0*Q;K[Lr]=mr,K[Lr+1]=gr,K[Lr+2]=Ai,ch(mr,gr,Ai,I);const ki=_e(Ht,B,X);Vd(D,de,ki,De)}for(let mr=1;mr<=A;mr++){const gr=xi,Ai=wr,Lr=(mr+1)/E,ki=_e(Lr,B,X),sr=_e(u*(1-Lr)+p*Lr,y,_),Qi=ei;ei=sr;{const qr=de+1,Nr=qr*Q;if(ue===1||mr===A){const Vi=sr*T,Ts=Xr(sr,ve,n);if(ue===1&&mr<A){const _o=Vi-G,da=tt-q,re=Ts-Z;K[Nr]=_o,K[Nr+1]=da,K[Nr+2]=re,ch(_o,da,re,I),Vd(D,qr,ki,De)}xi=Vi,wr=Ts}else xi=K[Nr]+G,wr=K[Nr+2]+Z}const ci=xi,or=wr,Dr=dt,Ys=at;dt=gr,at=Ai;const Xs=(de-A)*Q,Zs=ue===1?Xr(Qi,bt,n):K[Xs+2]+Z,Js=Xr(Qi,Tt,n);if(ue<A){const qr=de+A,Nr=qr*Q,Vi=gr-G,Ts=jt-q,_o=Js-Z;K[Nr]=Vi,K[Nr+1]=Ts,K[Nr+2]=_o,ch(Vi,Ts,_o,I);const da=Bi;Bi=ki,Vd(D,qr,da,$i)}{const qr=ci-Dr,Nr=At-jt,Vi=Nr*(or-Ys),Ts=qr*(Zs-Js),_o=-Nr*qr,da=Vi*Vi+Ts*Ts+_o*_o;if(da===0)qb($,de,0,0,1,R);else{const re=1/Math.sqrt(da);qb($,de,Vi*re,Ts*re,_o*re,R)}}++de}}}function Ydt(t,e){t.tile.intersectsClippingArea&&($Ee(t),MEe(t,!0),wk(t))}function Xdt(t,e){t.tile.intersectsClippingArea&&(PEe(t),wk(t))}function PEe(t,e){t.tile.intersectsClippingArea&&($Ee(t),MEe(t,!1))}function MEe(t,e){const i=t.geometryState,r=i.neighborData,n=t.tile,s=n.surface,o=n.extent,a=i.clippingArea,l=a??MZ,c=o[0],u=o[2],d=o[1],p=o[3],m=[p>l[3],u>l[2],d<l[1],c<l[0]],y=t.geometry,_=n.horizontalScale,v=IEe(s.isWebMercatorOnPlateeCarree,n.ellipsoid.radius,_),w=y.boundingBox,x=y.uvRange[0],T=y.uvRange[1],S=y.uvRange[2],E=y.uvRange[3],A=Math.max(c,l[0]),P=Math.min(u,l[2]),N=Math.max(d,l[1]),F=Math.min(p,l[3]),D=t.localOrigin,$=D[0],R=D[1],k=D[2],B=i.samplerData;for(let j=0;j<4;++j){const X=j===1||j===3,M=r.edgeResolutions[j];Se(Eb(M));const I=M+1,G=m[j],q=M1(n,r.edgePeerNeighbors[j]);if(!G&&kEe(n,q,j)){NEe(t,j,q);continue}const Z=q!=null&&!G,K=q?.renderData,Q=K?.geometryState;if(us&&(Se(!Z||q.level===n.level),Se(!Z||gg(n,q)<=0),n&&!q&&!s.updatingRootTiles)){const ct=ng[j],dt=n.findNeighborTile(ct,at=>at.isLoaded||at.isLeaf||at.level===n.level);s.updatingRootTiles||(dt?dt.intersectsClippingArea&&(Se(!dt.isLoaded),Se(!dt.isLeaf),Se(dt.level===n.level)):Se(s?.rootTiles==null||!n.shouldHaveNeighbor(ct)))}const de=_e(j===1?u:c,A,P),Ae=_e(j===0?p:d,N,F),st=Q?.samplerData,vt=y.outerEdges[j],ot=e&&I>3?I-3:1,gt=_e(j===1?1:0,x,S),ze=_e(j===0?1:0,T,E),ue=Z?(ct,dt)=>.5*(Xr(ct,dt,st)+Xr(ct,dt,B)):(ct,dt)=>Xr(ct,dt,B),xt=(u-c)/M,ve=X?j===1?xt:-xt:0,De=X?0:j===0?xt:-xt,tt=-ve,mt=-De;let bt=0,At=0,Ve=0;{const ct=0/M,dt=X?de:_e(c*(1-ct)+u*ct,A,P),at=X?_e(d*(1-ct)+p*ct,N,F):Ae,Ht=ue(dt,at);bt=dt*_,At=v(at),Ve=Ht}let Tt=0,jt=0,$i=0;{const ct=1/M,dt=X?de:_e(c*(1-ct)+u*ct,A,P),at=X?_e(d*(1-ct)+p*ct,N,F):Ae,Ht=ue(dt,at);Tt=dt*_,jt=v(at),$i=Ht}for(let ct=1;ct<I-1;ct+=ot){const dt=ct/M,at=Tt,Ht=jt,zt=$i;{const ki=X?gt:_e(dt,x,S),sr=X?_e(dt,T,E):ze,Qi=at-$,ci=Ht-R,or=zt-k;ch(at,ci,or,w),vt.setVertexFromValuesRawPositionUV(ct,Qi,ci,or,ki,sr)}{const ki=(ct+1)/M,sr=X?de:_e(c*(1-ki)+u*ki,A,P),Qi=X?_e(d*(1-ki)+p*ki,N,F):Ae,ci=ue(sr,Qi);Tt=sr*_,jt=v(Qi),$i=ci}const fr=Tt,Bi=$i,ei=bt,xi=At,wr=Ve;bt=at,At=Ht,Ve=zt;let mr=0,gr=0,Ai=0;if(X){const ki=jt-Ht,sr=Bi-zt,Qi=xi-Ht,ci=wr-zt,or=_e(d*(1-dt)+p*dt,N,F),Dr=de+tt,Ys=Dr*_-at,Xs=Xr(Dr,or,B)-zt,Zs=j===3?-1:1;if(mr=Zs*(-Qi+ki)*Xs,gr=Zs*Ys*(-ci+sr),Ai=-Zs*Ys*(-Qi+ki),Z){const Js=de+ve,qr=Js*_-at;mr=(-Qi+ki)*(Xs-(Xr(Js,or,st)-zt)),gr=(Ys-qr)*(-ci+sr),Ai=-(Ys-qr)*(-Qi+ki)}}else{const ki=fr-at,sr=Bi-zt,Qi=ei-at,ci=wr-zt,or=_e(c*(1-dt)+u*dt,A,P),Dr=Ae+mt,Ys=Xr(or,Dr,B)-zt,Xs=v(Dr)-Ht,Zs=j===2?-1:1;if(mr=Zs*Xs*(-ci+sr),gr=Zs*(-Qi+ki)*Ys,Ai=-Zs*Xs*(-Qi+ki),Z){const Js=or,qr=Ae+De,Nr=v(qr)-Ht;mr=(-Xs+Nr)*(-ci+sr),gr=(-Qi+ki)*(-Ys+(Xr(Js,qr,st)-zt)),Ai=-(-Xs+Nr)*(-Qi+ki)}}const Lr=1/Math.sqrt(mr*mr+gr*gr+Ai*Ai);vt.setNormalFromValues(ct,mr*Lr,gr*Lr,Ai*Lr)}}}function $Ee(t,e){FEe(t)}function Zdt(t,e){return(Math.PI/2-2*Math.atan(Math.exp(-t/e)))*e}function Jdt(t,e){return t*e}function IEe(t,e,i){return t?r=>Zdt(r,e):r=>Jdt(r,i)}function LEe(t,e,i,r,n,s){const o=e-1,a=t.vertexAttributes.count,l=2*(Math.min(e-2,r[1])-Math.max(1,r[0]))*(Math.min(e-2,n[1])-Math.max(1,n[0])),c=ng.map((T,S)=>S===0&&n[1]<e-2||S===1&&r[1]<e-2||S===2&&n[0]>1||S===3&&r[0]>1),u=t.outerEdges.reduce((T,S,E)=>T+(c[E]?0:o-2+S.count-1),0),d=i.reduce((T,S)=>T+o*(2*(S.latitudeResolution-1)+1),0),p=s?2:1,m=3*(l+u+d)*p,y=a>=Udt?new Uint32Array(m):new Uint16Array(m);let _=0;const v=e-2,w=o-2;Se(w>=0);const x=(T,S,E,A,P,N)=>{const F=T*P,D=N[F],$=N[F+1],R=N[F+2],k=S*P,B=N[k],j=N[k+1],X=N[k+2],M=E*P,I=N[M],G=N[M+1],q=N[M+2],Z=A*P,K=N[Z],Q=N[Z+1],de=N[Z+2];return(B-K)*(B-K)+(j-Q)*(j-Q)+(X-de)*(X-de)>(D-I)*(D-I)+($-G)*($-G)+(R-q)*(R-q)};if(s){const T=(E,A,P)=>{y[_++]=E,y[_++]=A,y[_++]=A,y[_++]=P,y[_++]=P,y[_++]=E,us&&(Se(E<a),Se(A<a),Se(P<a),Se(_<=m))};(()=>{for(let E=Math.max(n[0],1)-1;E<Math.min(n[1],e-2)-1;++E){const A=E*v;for(let P=Math.max(r[0],1)-1;P<Math.min(r[1],e-2)-1;++P){const N=E*v+P,F=N+1,D=F+v,$=D-1,R=A+P,k=R+1,B=k+v,j=B-1,X=t.vertexAttributes.position.typedBuffer,M=t.vertexAttributes.position.typedBufferStride;x(R,k,B,j,M,X)?(T(N,F,D),T(D,$,N)):(T(N,F,$),T($,D,F))}}})(),Se(_===3*l*p),(()=>{for(let E=0;E<4;++E){const A=_;if(c[E])continue;const P=t.outerEdges[E],N=t.innerEdges[E];let F=0,D=0;const $=P.count,R=N.count;Se(R===o-1);let k=0;const B=E===1||E===2?(j,X,M)=>T(j,X,M):(j,X,M)=>T(j,M,X);for(;F<$-1||D<R-1;){const j=N.getVertexIndex(D),X=P.getVertexIndex(F),M=F<$-1,I=D<R-1;M&&(!I||(M?0+o*(F+.5)/($-1):0)<=(I?1+w*(D+.5)/(R-1):0))?(++F,us&&Se(F<$),B(j,X,P.getVertexIndex(F)),k++):(++D,us&&Se(D<R),B(j,X,N.getVertexIndex(D)),k++)}us&&(Se(F===$-1),Se(D===R-1),Se(k===$+R-2),Se(k===o-2+P.count-1),Se(_===A+3*k*p))}})(),Se(_===3*(l+u)*p);const S=E=>{const A=t.outerEdges[E.connectedOuterEdgeOffset];let P=A.getVertexIndex(0),N=A.stride;for(let F=0;F<E.latitudeResolution;++F){const D=F===0?E.rowOffset:P+e;for(let $=0;$<o;$++)T(P,P+1,D+$),F<E.latitudeResolution-1&&T(P+1,D+$+1,D+$),P+=N;P=D,N=1}};i.forEach(S)}else{(()=>{const S=Math.max(n[0],1)-1,E=Math.min(n[1],e-2)-1,A=Math.max(r[0],1)-1,P=Math.min(r[1],e-2)-1;for(let N=S;N<E;++N){const F=N*v;for(let D=A;D<P;++D){const $=F+D,R=$+1,k=R+v,B=k-1,j=t.vertexAttributes.position.typedBuffer,X=t.vertexAttributes.position.typedBufferStride;x($,R,k,B,X,j)?(y[_]=$,y[_+1]=R,y[_+2]=k,y[_+3]=k,y[_+4]=B,y[_+5]=$):(y[_]=$,y[_+1]=R,y[_+2]=B,y[_+3]=B,y[_+4]=R,y[_+5]=k),_+=6}}})(),Se(_===3*l*p),(()=>{for(let S=0;S<4;++S){if(c[S])continue;const E=t.outerEdges[S],A=t.innerEdges[S];let P=0,N=0;const F=E.count,D=A.count;Se(D===o-1);const $=S===1||S===2,R=$?1:2,k=$?2:1,B=E.index0,j=E.stride,X=A.index0,M=A.stride;for(;P<F-1||N<D-1;){const I=X+N*M,G=B+P*j,q=P<F-1,Z=N<D-1,K=q&&(!Z||(q?0+o*(P+.5)/(F-1):0)<=(Z?1+w*(N+.5)/(D-1):0));K?++P:++N;const Q=K?G+j:I+M;y[_]=I,y[_+R]=G,y[_+k]=Q,_+=3}}})(),Se(_===3*(l+u)*p);const T=S=>{const E=t.outerEdges[S.connectedOuterEdgeOffset];let A=E.getVertexIndex(0),P=E.stride;for(let N=0;N<S.latitudeResolution;++N){const F=N===0?S.rowOffset:A+e;for(let D=0;D<o;D++){const $=F+D;y[_]=A,y[_+1]=A+1,y[_+2]=$,N<S.latitudeResolution-1?(y[_+3]=A+1,y[_+4]=$+1,y[_+5]=$,_+=6):_+=3,A+=P}A=F,P=1}};i.forEach(T)}Se(_===m),t.indices=y,t.indexCount=m}function DEe(t,e){const i=t.localOrigin,r=t.geometry,n=t.geometryState.neighborData.edgeResolutions,s=r.numVerticesPerSide-2,o=r.vertexAttributes;let a=e;for(let l=0;l<4;++l){{const c=l===0||l===2,u=(l===0?s-1:0)*s+(l===1?s-1:0),d=(c?0:1)*s+(c?1:0);r.innerEdges[l]=new yoe(o,i,u,d,s)}{const c=a,u=n[l]+1;r.outerEdges[l]=new yoe(o,i,c,1,u),a+=u}}}function NEe(t,e,i){const r=(e+2)%4,n=t.geometryState,s=t.tile,o=n.neighborData,a=s.level-i.level,l=e===1||e===3,c=o.edgeResolutions[e];Se(Eb(c));const u=c+1,d=t.geometry,p=d.boundingBox,m=d.outerEdges[e],y=d.uvRange[0],_=d.uvRange[1],v=d.uvRange[2],w=d.uvRange[3],x=_e(e===1?1:0,y,v),T=_e(e===0?1:0,_,w),S=i.renderData,E=S.geometryState,A=S.geometry.outerEdges[r],P=s.getNeighborEdgeStartVertexIndex(e,i)*c,N=c*2**a;Se(E.neighborData.edgeResolutions[r]===N),Se(A.count-1===N);const F=S.localOrigin[0]-t.localOrigin[0],D=S.localOrigin[1]-t.localOrigin[1],$=S.localOrigin[2]-t.localOrigin[2],R=m.attributes,k=m.index0,B=m.stride,j=R.position.typedBuffer,X=R.position.typedBufferStride,M=R.normalCompressed.typedBuffer,I=R.normalCompressed.typedBufferStride,G=R.uv0,q=A.attributes,Z=A.index0,K=A.stride,Q=q.position.typedBuffer,de=q.position.typedBufferStride,Ae=q.normalCompressed.typedBuffer,st=q.normalCompressed.typedBufferStride;for(let vt=1;vt<u-1;++vt){const ot=k+B*vt,gt=Z+K*(P+vt),ze=ot*X,ue=gt*de,xt=Q[ue]+F,ve=Q[ue+1]+D,De=Q[ue+2]+$;j[ze]=xt,j[ze+1]=ve,j[ze+2]=De,ch(xt,ve,De,p);const tt=ot*I,mt=gt*st;M[tt]=Ae[mt],M[tt+1]=Ae[mt+1];const bt=vt/c,At=l?x:_e(bt,y,v),Ve=l?_e(bt,_,w):T;Vd(G,ot,At,Ve)}}function FEe(t){const e=t.geometryState,i=e.neighborData,r=t.localOrigin,n=i.cornerNeighborData,s=t.geometry,o=s.outerEdges,a=s.boundingBox,l=t.tile,c=t.tile.surface.view?.viewingMode==="local",u=l.ellipsoid.radius,d=l.extentInRadians,p=l.horizontalScale;let m=0,y=0,_=0;const v=(ue,xt,ve)=>{const De=d[xt===0?1:3],tt=d[ue===0?0:2],mt=Math.cos(De),bt=Math.sin(De),At=Math.sin(tt),Ve=Math.cos(tt),Tt=u+ve;m=Ve*mt*Tt,y=At*mt*Tt,_=bt*Tt},w=c?(()=>{const ue=t.geometryState.clippingArea,xt=l.extent,ve=ue!=null&&(xt[3]>ue[3]||xt[2]>ue[2]||xt[1]<ue[1]||xt[0]<ue[0]),De=IEe(l.surface.isWebMercatorOnPlateeCarree,l.ellipsoid.radius,p);return(tt,mt,bt)=>{const At=tt===0?k[0]:k[2],Ve=mt===0?k[1]:k[3],Tt=ve?_e(At,ue[0],ue[2]):At,jt=ve?_e(Ve,ue[1],ue[3]):Ve,$i=bt;m=Tt*p,y=De(jt),_=$i}})():v;let x=0,T=0,S=0,E=0,A=0,P=0,N=0,F=0,D=0;const $=c&&t.tile.surface.isWebMercatorOnPlateeCarree,R=(ue,xt,ve,De,tt)=>{let mt=0,bt=0,At=0;if(c){const Ve=xt*p,Tt=$?(Math.PI/2-2*Math.atan(Math.exp(-ve/u)))*u:ve*p;mt=Ve-m,bt=Tt-y,At=De-_}else{const Ve=PZ(ue),Tt=ue.tile,jt=Tt.extent,$i=Tt.extentInRadians,ct=(xt-jt[0])/(jt[2]-jt[0]),dt=(ve-jt[1])/(jt[3]-jt[1]),at=$i[0]*(1-ct)+$i[2]*ct,Ht=Ve(dt),zt=Math.cos(Ht),fr=Math.sin(Ht),Bi=Math.sin(at),ei=Math.cos(at),xi=u+De;mt=ei*zt*xi-m,bt=Bi*zt*xi-y,At=fr*xi-_}switch(tt){case 0:N+=mt,F+=bt,D+=At;break;case 1:E-=mt,A-=bt,P-=At;break;case 2:N-=mt,F-=bt,D-=At;break;case 3:E+=mt,A+=bt,P+=At}},k=l.extent,B=e.clippingArea??MZ,j=k[0],X=k[2],M=k[1],I=k[3],G=[I>B[3],X>B[2],M<B[1],j<B[0]],q=Math.max(j,B[0]),Z=Math.min(X,B[2]),K=Math.max(M,B[1]),Q=Math.min(I,B[3]),de=ue=>Math.max(B[0],Math.min(B[2],ue)),Ae=ue=>Math.max(B[1],Math.min(B[3],ue)),st=s.uvRange[0],vt=s.uvRange[1],ot=s.uvRange[2],gt=s.uvRange[3],ze=ue=>{const xt=n[ue].cornerTiles;x=0,T=0,S=1,E=0,A=0,P=0,N=0,F=0,D=0;let ve=1/0;for(let Ve=0;Ve<4;++Ve)ve=Math.min(ve,xt[Ve]?.level??1/0);for(let Ve=0;Ve<4;++Ve){const Tt=xt[Ve];nC[Ve]=Tt?.level===ve?Tt:null}let De=1,tt=0;for(let Ve=0;Ve<4;++Ve){const Tt=nC[Ve];Tt&&(De=Math.max(De,Tt?.renderData.geometryState.numVerticesPerSide),tt=Tt.extent[2]-Tt.extent[0])}const mt=tt,bt=De;Se(bt>1);const At=mt/bt;for(let Ve=0;Ve<4;++Ve){const Tt=nC[(Ve+3)%4],jt=nC[Ve%4];if(!Tt&&!jt)continue;const $i=Ve===0?1:Ve===1?2:Ve===2?3:0,ct=Ve===0?2:Ve===1?3:Ve===2?0:1;if(Tt&&jt){const dt=K8[Ve][0]*At,at=K8[Ve][1]*At,Ht=Tt.extent,zt=de(Ht[$i===0||$i===1?2:0]+dt),fr=Ae(Ht[$i===0||$i===3?3:1]+at),Bi=jt.extent,ei=de(Bi[ct===0||ct===1?2:0]+dt),xi=Ae(Bi[ct===0||ct===3?3:1]+at),wr=Tt.renderData,mr=jt.renderData,gr=Xr(zt,fr,wr.geometryState.samplerData),Ai=Xr(ei,xi,mr.geometryState.samplerData);R(wr,zt,fr,.5*(gr+Ai),Ve)}else{const dt=Tt??jt,at=Tt?$i:ct,Ht=dt.extent,zt=K8[Ve],fr=de(Ht[at===0||at===1?2:0]+zt[0]*At),Bi=Ae(Ht[at===0||at===3?3:1]+zt[1]*At),ei=dt.renderData,xi=Xr(fr,Bi,ei.geometryState.samplerData);R(ei,fr,Bi,xi,Ve)}}if(!c){const Ve=Math.sqrt(m*m+y*y+_*_);x=m/Ve,T=y/Ve,S=_/Ve}if(c||S*S<.999){const Ve=Math.sqrt(E*E+A*A+P*P);E/=Ve,A/=Ve,P/=Ve;const Tt=Math.sqrt(N*N+F*F+D*D);N/=Tt,F/=Tt,D/=Tt,x=P*F-A*D,T=E*D-P*N,S=A*N-E*F;const jt=1/Math.sqrt(x*x+T*T+S*S);x*=jt,T*=jt,S*=jt}};for(let ue=0;ue<4;++ue){const xt=ue,ve=(ue+1)%4,De=ue===0||ue===1?1:0,tt=ue===0||ue===3?1:0,mt=_e(De,st,ot),bt=_e(tt,vt,gt),At=o[xt],Ve=ue===0||ue===3?At.count-1:0,Tt=o[ve],jt=ue===0||ue===1?Tt.count-1:0,$i=n[ue].cornerTiles;let ct=-1;for(let Ht=0;Ht<4;++Ht){const zt=$i[Ht];zt&&(ct===-1||gg($i[ct],zt)>0)&&(ct=Ht)}const dt=ct,at=$i[dt];if(at!==l){const Ht=l.level-at.level,zt=2**Ht,fr=[at.lij[0]+Ht,at.lij[1]*zt,at.lij[2]*zt],Bi=[fr[1]+zt===l.lij[1],ue===0&&(dt===1||dt===0&&at!==$i[3])||ue===1&&(dt===0||dt===1&&at!==$i[2]),fr[1]===l.lij[1]+1,ue===2&&(dt===3||dt===2&&at!==$i[1])||ue===3&&(dt===2||dt===3&&at!==$i[0])],ei=Bi.reduce((Ai,Lr)=>Ai+(Lr?1:0),0);Se(ei===1||ei===2);let xi=-1,wr=-1;const mr=at.renderData;if(ei===1){const Ai=Bi.findIndex(ki=>ki);Se(0<=Ai&&Ai<=3),xi=(Ai+2)%4;const Lr=t.geometryState.neighborData.edgeResolutions[Ai];wr=l.getNeighborEdgeStartVertexIndex(Ai,at)*Lr+Lr*(Ai===0&&ue===0||Ai===1&&ue===0||Ai===2&&ue===1||Ai===3&&ue===3?1:0)}else{Se(Bi[1]||Bi[3]),xi=Bi[1]?3:1;const Ai=mr.geometryState.neighborData.edgeResolutions[xi];wr=ue===0||ue===3?0:Ai}const gr=mr.geometry.outerEdges[xi];{const Ai=At.index0+Ve*At.stride,Lr=Tt.index0+jt*Tt.stride,ki=gr.index0+wr*gr.stride;{const sr=gr.attributes.position,Qi=sr.typedBuffer,ci=ki*sr.typedBufferStride,or=t.localOrigin,Dr=gr.localOrigin,Ys=Qi[ci]+Dr[0]-or[0],Xs=Qi[ci+1]+Dr[1]-or[1],Zs=Qi[ci+2]+Dr[2]-or[2];ch(Ys,Xs,Zs,a);{const Js=At.attributes.position,qr=Js.typedBuffer,Nr=Ai*Js.typedBufferStride;qr[Nr]=Ys,qr[Nr+1]=Xs,qr[Nr+2]=Zs}{const Js=Tt.attributes.position,qr=Js.typedBuffer,Nr=Lr*Js.typedBufferStride;qr[Nr]=Ys,qr[Nr+1]=Xs,qr[Nr+2]=Zs}}Vd(At.attributes.uv0,Ai,mt,bt),Vd(Tt.attributes.uv0,Lr,mt,bt);{const sr=gr.attributes.normalCompressed.typedBuffer,Qi=ki*gr.attributes.normalCompressed.typedBufferStride;{const ci=At.attributes.normalCompressed,or=ci.typedBuffer,Dr=Ai*ci.typedBufferStride;or[Dr]=sr[Qi],or[Dr+1]=sr[Qi+1]}{const ci=Tt.attributes.normalCompressed,or=ci.typedBuffer,Dr=Lr*ci.typedBufferStride;or[Dr]=sr[Qi],or[Dr+1]=sr[Qi+1]}}}}else{const Ht=G[xt],zt=G[ve];let fr;if(Ht||zt){const wr=_e(j*(1-De)+X*De,q,Z),mr=_e(M*(1-tt)+I*tt,K,Q),gr=e.samplerData;fr=Xr(wr,mr,gr)}else fr=Kdt($i);w(De,tt,fr),ze(ue);const Bi=m-r[0],ei=y-r[1],xi=_-r[2];ch(Bi,ei,xi,a),At.setVertexFromValuesRawPositionUVNormal(Ve,Bi,ei,xi,mt,bt,x,T,S),Tt.setVertexFromValuesRawPositionUVNormal(jt,Bi,ei,xi,mt,bt,x,T,S)}}for(let ue=0;ue<4;++ue)nC[ue]=null}function Kdt(t){const e=t.reduce((s,o)=>Math.min(s,o?.level??1/0),1/0);us&&(Se(!t[0]||!t[2]||Mj(t[0],t[2],rt.SOUTH_WEST)),Se(!t[1]||!t[3]||Mj(t[1],t[3],rt.NORTH_WEST)));let i=0,r=0;for(let s=0;s<4;++s){const o=t[s];if(o&&o.level===e){const a=s===0||s===1,l=s===0||s===3,c=o.extent,u=c[a?0:2],d=c[l?1:3],p=o.renderData?.geometryState?.samplerData;r+=Xr(u,d,p),i++}}const n=i?r/i:0;return Se(n!=null),n}function wk(t){const e=t.vao,i=t.geometry.vertexAttributes.position.typedBuffer;e.vertexBuffers.geometry.setSubData(i,0,0,i.length)}const K8=[[0,1],[1,0],[0,-1],[-1,0]],oo=new jht,MZ=bq(-1/0,-1/0,1/0,1/0),nC=[null,null,null,null];function kEe(t,e,i){if(!e)return!1;const r=gg(t,e);return r>0||r===0&&i>=2}let Qdt=class extends AZ{constructor(e,i,r,n,s){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=Gt(),this._baseUsedMemory=900,this.init(e,i,r,n,s)}init(e,i,r,n,s){super.init(e,i,r,n,s);const o=s.view.renderSpatialReference,a=s.spatialReference,l=o!=null&&ZH(o)&&a!=null&&a.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=l;const c=this.surface.isWebMercatorOnPlateeCarree,u=this._extentInRenderSR,d=this.extent;if(c){const p=Ce(d[0],d[1],0);Do(p,je.WebMercator,p,je.PlateCarree);const m=Ce(d[2],d[3],0);Do(m,je.WebMercator,m,je.PlateCarree),u[0]=p[0],u[1]=p[1],u[2]=m[0],u[3]=m[1]}else for(let p=0;p<4;++p)u[p]=d[p]*l;this.centerAtSeaLevel[0]=.5*(u[0]+u[2]),this.centerAtSeaLevel[1]=.5*(u[1]+u[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(u[2]-u[0],u[3]-u[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,i=.5*(e[2]-e[0]),r=.5*(e[3]-e[1]),n=Math.sqrt(i*i+r*r),s=.5*(this.elevationBounds[0]-this.elevationBounds[1]),o=Math.max(n,s);this._center[Un.MIDDLE][3]=o}_calculateFrustumVisibilityStatus(e){const i=this._aabb(),r=i[0],n=i[1],s=i[2],o=i[3],a=i[4],l=i[5];let c=!0;for(let u=0;u<6;u++){const d=e[u],p=d[0],m=d[1],y=d[2],_=d[3];if(p*(p>0?r:o)+m*(m>0?n:a)+y*(y>0?s:l)+_>=0)return Zo.OUTSIDE;c=c&&p*(p<0?r:o)+m*(m<0?n:a)+y*(y<0?s:l)+_<=0}return c?Zo.INSIDE:Zo.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return d6e(e[0],e[1],this.elevationBounds[0],e[2],e[3],this.elevationBounds[1])}intersectsRay(e,i,r,n){return N$[0]=1/i[0],N$[1]=1/i[1],N$[2]=1/i[2],cX(this._aabb(),e,N$,r,n)}createGeometry(){qdt(this.renderData,this._horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){Ydt(this.renderData,this._horizontalScaleFactor)}updateEdgeElevations(){Xdt(this.renderData,this._horizontalScaleFactor)}get horizontalScale(){return this._horizontalScaleFactor}};const N$=C();let ept=class{constructor(){this.extent=Kt(),this.minLevel=0,this.maxLevel=0,this.callback=null}},JL=class extends xe{constructor(){super(...arguments),this._queries=new It({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new It({initialSize:30}),this._queryPool=new aa(ept)}queryVisibleLevelRange(e,i,r,n){const s=this._queryPool.acquire();Cd(s.extent,e),s.minLevel=i??-Number.MAX_VALUE,s.maxLevel=r??Number.MAX_VALUE,s.callback=n,this._queryQueue.push(s),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const i=this._queries.data[e];this._queryPool.release(i),i.callback(e>=this._queriesInvPtr),i.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const i=e.level;let r=0;for(;r<this._queriesInvPtr;){const n=this._queries.data[r],s=n.extent;i>=n.minLevel&&i<=n.maxLevel&&s[0]<=e.extent[2]&&s[2]>=e.extent[0]&&s[1]<=e.extent[3]&&s[3]>=e.extent[1]?(this._queries.swapElements(r,this._queriesInvPtr-1),this._queriesInvPtr--):r++}}};h([f()],JL.prototype,"updating",null),JL=h([z("esri.views.3d.terrain.ScaleRangeQueries")],JL);function tpt(t,e,i,r){const n=Math.cos(i);t[0]=Math.cos(e)*n*r,t[1]=Math.sin(e)*n*r,t[2]=Math.sin(i)*r}let ipt=class extends AZ{constructor(e,i,r,n,s){super(),this._convexHull=new Array(24),this._boundingSphere=xn(),this._baseUsedMemory=1816,this.init(e,i,r,n,s)}init(e,i,r,n,s){super.init(e,i,r,n,s);const o=this.ellipsoid.radius,a=this.extentInRadians[0],l=this.extentInRadians[1],c=this.extentInRadians[2],u=this.extentInRadians[3],d=_t(l,u,.5),p=_t(a,c,.5),m=e===0?0:Math.min(Math.abs(l),Math.abs(u));this._edgeLen=(c-a)*Math.cos(m)*o,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=o-Math.sqrt(o*o-this._edgeLen2/4),tpt(this.centerAtSeaLevel,p,d,this.ellipsoid.radius),ge(this.up,this.centerAtSeaLevel),this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)oe(e[Un.MIDDLE],0,0,0),oe(e[Un.TOP],0,0,0),oe(e[Un.BOTTOM],0,0,0),e[Un.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const i=e[Un.MIDDLE],r=this.convexHull;let n=0;for(let s=0;s<8;++s)n=Math.max(n,rpt(i,r,3*s));e[Un.MIDDLE][3]=Math.sqrt(n)}}_calculateFrustumVisibilityStatus(e){if(!Uy(e,this._boundingSphere))return Zo.OUTSIDE;if(this.lij[0]<10)return Zo.INTERSECTS;const i=this.convexHull,r=this.surface.view.state.camera.near;let n=!0;for(let s=0;s<jS;s++){const o=s===ur.NEAR,a=e[s],l=a[0],c=a[1],u=a[2],d=a[3]-(o?r:0);let p=!1;for(let m=0;m<8;++m){const y=3*m;if(l*i[y]+c*i[y+1]+u*i[y+2]+d<0){if(p=!0,!n)break}else n=!1}if(!p)return Zo.OUTSIDE}return n?Zo.INSIDE:Zo.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){zdt(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),us&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,i=e,r=this.elevationBounds,n=this.ellipsoid.radius,s=r[1];if(this.level===0)oe(i,0,0,0),e[3]=n+s;else{const o=this.extentInRadians,a=.5*(o[0]+o[2]),l=o[1],c=o[3];Sv($oe,a,l,n),Sv(Ioe,a,c,n),ce(i,$oe,Ioe);const u=.5*(r[0]+r[1]);te(i,i,(n+u)/zl(i));const d=this.convexHull;let p=0;const m=(_,v)=>{const w=_[0]-d[3*v],x=_[1]-d[3*v+1],T=_[2]-d[3*v+2];return Math.sqrt(w*w+x*x+T*T)};for(let _=0;_<8;++_){const v=m(i,_);p=Math.max(p,v)}const y=p;e[3]=y+2}}_updateConvexHull(){const e=this.extentInRadians,i=this.ellipsoid.radius;if(this.level===0)return;const r=this.elevationBounds,n=this._getPatchType(),s=this.surface.isWebMercator,o=s&&n===eh.HAS_NORTH_POLE,a=s&&n===eh.HAS_SOUTH_POLE,l=a||o,c=Math.PI/2,u=e[0],d=e[2],p=a?-c:e[1],m=o?c:e[3],y=.5*(u+d),_=r[0],v=i+(l?Math.min(0,_-1):_),w=(X,M,I)=>Sv(X,M,I,v),x=C(),T=C(),S=C(),E=C();w(x,u,p),w(T,u,m),w(S,d,m),w(E,d,p);const A=(X,M)=>{for(let I=0;I<3;++I)this._convexHull[3*M+I]=X[I]};A(x,0),A(T,1),A(S,2),A(E,3);const P=r[1],N=i+(l?Math.max(0,P+1):P),F=C(),D=C(),$=C();Sv(D,y,m,v),Sv($,y,p,v),ce(F,D,$),ge(F,F);const R=C(),k=C(),B=(X,M)=>{zs(k,X,M),ge(k,k);const I=-me(X,R)/me(k,R);Se(I>=0),te(k,k,I),ce(X,X,k)};if(2**this.lij[0]>2*this.lij[1]){const X=$,M=C();nt(M,Moe,X),ge(M,M),nt(R,X,M),ge(R,R),Se(th(me(R,X)/zl(X),0)),B(x,T),B(E,S),A(x,0),A(E,3)}else if(2**this.lij[0]!==2*this.lij[1]){const X=D,M=C();nt(M,Moe,X),ge(M,M),nt(R,M,X),ge(R,R),B(T,x),B(S,E),A(T,1),A(S,2)}const j=(X,M)=>{const I=N/me(M,F);for(let G=0;G<3;++G)this._convexHull[3*X+G]=M[G]*I};j(4,x),j(5,T),j(6,S),j(7,E)}_getPatchType(){const e=this.lij[1],i=e===0,r=e===(1<<this.level)-1;return i?r?eh.HAS_BOTH_POLES:eh.HAS_NORTH_POLE:r?eh.HAS_SOUTH_POLE:eh.REGULAR}intersectsRay(e,i,r,n){const s=this._boundingSphere,o=s[3]+r,a=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],l=s[0]-e[0],c=s[1]-e[1],u=s[2]-e[2],d=(l*i[0]+c*i[1]+u*i[2])/a,p=i[0]*d-l,m=i[1]*d-c,y=i[2]*d-u;return p*p+m*m+y*y<o*o}getDefaultVerticesPerSide(){return this.level<Poe.length?Poe[this.level]+1:2}updateCornerElevations(){Gdt(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){Vdt(this.renderData),this._updateBoundingVolumes()}_checkBVs(){if(!us||this.level<=2)return;const e=this._boundingSphere,i=e[3],r=e,n=C(),s=this.ellipsoid.radius,o=this.elevationBounds;o[1],o[0];const a=s+o[0],l=1,c=0,u=this._center[Un.MIDDLE][3],d=this.convexHull,p=(ve,De)=>{for(let tt=0;tt<3;++tt)ve[tt]=d[3*De+tt]};{const ve=C(),De=C(),tt=C(),mt=C(),bt=C(),At=(Ve,Tt,jt,$i)=>{p(De,Ve),p(tt,Tt),p(mt,jt),zs(De,De,tt),zs(mt,mt,tt),nt(ve,De,mt),ge(ve,ve);const ct=me(ve,tt);p(bt,$i);const dt=me(ve,bt),at=Math.abs(dt-ct);Se(th(at,0),`Non coplanar ${Ve},${Tt},${jt},${$i} diff = ${at}`)};At(0,1,2,3),At(4,5,6,7),At(0,1,4,5),At(1,2,5,6),At(2,3,6,7),At(3,0,7,4)}const m=Vs(24),y=(ve,De,tt)=>{const mt=4*ve;for(let bt=0;bt<3;++bt)m[mt+bt]=De[bt];m[mt+3]=tt},_=C(),v=C(),w=C(),x=C(),T=(ve,De,tt,mt)=>{p(_,De),p(v,tt),p(w,mt),zs(_,_,v),ge(_,_),zs(w,w,v),ge(w,w),nt(x,_,w),ge(x,x);const bt=me(x,v);y(ve,x,bt)};T(0,0,1,2),T(1,1,0,4),T(2,1,5,2),T(3,3,2,6),T(4,4,0,3),T(5,4,6,5);const S=1,E=(ve,De,tt,mt)=>{const bt=4*ve;return m[bt]*De+m[bt+1]*tt+m[bt+2]*mt-m[bt+3]},A=(ve,De,tt,mt)=>E(ve,De,tt,mt)>=-S,P=(ve,De)=>A(ve,De[0],De[1],De[2]),N=2**this.lij[0]>2*this.lij[1],F=(ve,De,tt)=>Math.sqrt(UEe(ve,De,tt,r[0],r[1],r[2]))<i,D=ve=>F(ve[0],ve[1],ve[2]),$=(ve,De)=>F(ve[De],ve[De+1],ve[De+2]),R=this.extentInRadians,k=.5*(R[0]+R[2]),B=R[1],j=R[3],X=C(),M=C();Sv(X,k,j,a),Sv(M,k,B,a);const I=N?"Upper":"Lower";let G=!0;for(let ve=0;ve<6;++ve){for(let De=0;De<8;++De){const tt=3*De,mt=A(ve,d[tt],d[tt+1],d[tt+2]);G&&(G=mt),Se(mt,`Tile[${this.lij}] Convex hull point ${De} outside of plane ${ve}`)}Se(P(ve,M),`Tile[${this.lij}] (${I}) bottom mid outside of plane ${ve}`),Se(P(ve,X),`Tile[${this.lij}] (${I}) top mid outside of plane ${ve}`)}Se(G,"Not all convex hull points are inside  convex hull polyhedron"),Se(D(M),`Tile[${this.lij}] (${I}) bottom mid outside of bounding sphere`),Se(D(X),`Tile[${this.lij}] (${I}) top mid outside of bounding sphere`);for(let ve=0;ve<8;++ve){const De=$(d,3*ve);Se(De,`Tile[${this.lij}] Convex hull point ${ve} outside of bounding sphere`)}for(let ve=0;ve<6;++ve)for(let De=0;De<8;++De){const tt=3*De;A(ve,d[tt],d[tt+1],d[tt+2])||console.error(`Tile[${this.lij}] Convex hull point ${De} outside of plane ${ve}`)}const q=this.extentInRadians,Z=Math.max(q[2]-q[0],q[3]-q[1]),K=Math.round(Z*s),Q=this.renderData;if(!Q)return;const{geometry:de,localOrigin:Ae}=Q,st=de.vertexAttributes?.position;if(!st)return;const vt=st.count,ot=C(),gt=de.numVerticesPerSide-2,ze=gt*gt,ue=Q.geometryState.neighborData,xt=ue.edgeResolutions.reduce((ve,De)=>ve+De+1,0);for(let ve=0;ve<vt;++ve){const De=ve<ze,tt=!De&&ve<ze+xt;let mt=!1,bt=-1;if(tt){let ei=ze;for(let xi=0;xi<4;++xi){const wr=ue.edgeResolutions[xi];if(ve===ei||ve===ei+wr-1){mt=!0;break}if(ei+=wr,ve<ei){bt=xi;break}}}const At=tt?ue.edgePeerNeighbors[bt]:null,Ve=tt&&At&&gg(this,At)>0;st.getVec(ve,n),ce(ot,n,Ae);const Tt=zl(ot)-s;let jt=0,$i=!1;const ct=o[0]-Tt,dt=Tt-o[1],at=ct>l,Ht=dt>l,zt=at||Ht,fr=()=>{const ei=De?"internal":tt&&!mt?"edge":mt?"corner":"pole";return`Tile[${this.lij}].vertex[${ve}]:${ei}`+(at?"(below)":Ht?"(above)":"")+(Ve?"(Neighbor)":"")},Bi=aR(ot,r);if(Bi>=i+c){const ei=Bi-i;zt||(console.error(`${fr()} is out of the bounding sphere by ${ei.toFixed(0)} / ${i.toFixed(0)}[tol=${c}] h=${Tt.toFixed(0)} / [${o[0].toFixed(0)}..${o[1].toFixed(0)}] (${(ei/i).toFixed(0)})`),$i=!0)}for(let ei=0;ei<6;++ei)if(!A(ei,ot[0],ot[1],ot[2])){const xi=E(ei,ot[0],ot[1],ot[2]),wr=ve%gt,mr=(ve-wr)/gt;ei===0&&ct||ei===5&&dt||(console.error(`${fr()} (${wr},${mr})|${gt}] is out of the bounding trapezoid plane ${ei} h=${Math.round(Tt)} / [${Math.round(o[0])}..${Math.round(o[1])}] dist=${Math.round(xi)} radii = ${Math.round(i)}/${Math.round(u)}} : maxL = ${K}`),++jt)}if($i||jt>0)break}}get convexHull(){return this._convexHull}};const Poe=[128,64,64,32,16,8,8,4];function rpt(t,e,i){return UEe(t[0],t[1],t[2],e[i],e[i+1],e[i+2])}function UEe(t,e,i,r,n,s){const o=r-t,a=n-e,l=s-i;return o*o+a*a+l*l}const Sv=(t,e,i,r)=>{const n=Math.cos(e),s=Math.sin(e),o=Math.cos(i),a=Math.sin(i);t[0]=r*o*n,t[1]=r*o*s,t[2]=r*a},Moe=[0,0,1],$oe=C(),Ioe=C();let ad=class extends xe{constructor(){super(...arguments),this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}};h([f()],ad.prototype,"fovX",void 0),h([f()],ad.prototype,"fovY",void 0),h([f()],ad.prototype,"relativeWidthLimit",void 0),h([f()],ad.prototype,"relativeHeightLimit",void 0),h([f()],ad.prototype,"maxLod",void 0),h([f()],ad.prototype,"angledSplitBias",void 0),h([f()],ad.prototype,"aboveGround",void 0),h([f()],ad.prototype,"frustum",void 0),ad=h([z("esri.views.3d.terrain.SplitLimits")],ad);const npt=Ir().vec3f(O.POSITION).vec2i16(O.UV0).vec2i16(O.NORMALCOMPRESSED,{glNormalized:!0});let spt=class{constructor(e){this._storage=new SR((i,r)=>e.newCache(i,r),"TileGeometry")}acquire(e){const r=Math.ceil(e/4)*4,n=this._storage.pop(Loe(r));if(n)return n;const s=npt.createBuffer(r);return s.release=()=>this._release(s),s}_release(e){const i=e.count;this._storage.put(Loe(i),e)}clear(){this._storage.clear()}destroy(){this._storage.destroy()}};function Loe(t){return t.toString()}let zEe=class extends bl{constructor(){super(...arguments),this.blendMode=Re.Normal}};h([V({count:Re.COUNT})],zEe.prototype,"blendMode",void 0);let $3=class extends zEe{constructor(){super(...arguments),this.output=jn.Composite,this.baseOpacityMode=Jc.NotRequired,this.premultipliedSource=vd.Off}};h([V({count:jn.COUNT})],$3.prototype,"output",void 0),h([V({count:Jc.COUNT})],$3.prototype,"baseOpacityMode",void 0),h([V()],$3.prototype,"premultipliedSource",void 0);var Xb;function opt(t){const e=new mi;if(e.include(bEe),t.background===Xb.Only){const i=t.output===jn.ColorComposite;return i?e.fragment.uniforms.add(new $t("backgroundColor",r=>r.backgroundColor)):e.fragment.include(CZ),e.fragment.code.add(b`
    void main() {
      fragColor = vec4(${i?b`backgroundColor`:b`gridColor(uv)`}, 1.0);
    }
  `),e}return e.include(wEe,t),e.fragment.uniforms.add(new Je("tex",i=>i.texture)),e.fragment.uniforms.add(new Oe("opacity",i=>i.opacity)),e.fragment.code.add(b`void main() {
vec4 bgColor = getBackground(uv);
fragColor = blendLayers(bgColor, texture(tex, uv), opacity);
}`),e}(function(t){t[t.BelowLayer=0]="BelowLayer",t[t.Only=1]="Only",t[t.COUNT=2]="COUNT"})(Xb||(Xb={}));const apt=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return Xb},build:opt},Symbol.toStringTag,{value:"Module"}));let lpt=class extends vEe{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=Gs}},BEe=class VEe extends Ci{initializeProgram(e){return new wi(e.rctx,VEe.shader.get().build(this.configuration),fi)}initializePipeline(){return Ot({blending:cc(Te.ONE,Te.ONE_MINUS_SRC_ALPHA),colorWrite:Ft})}};BEe.shader=new bi(apt,()=>pe(()=>import("./BlendLayers.glsl-934730c5.js"),[],import.meta.url));let GEe=class extends $3{constructor(){super(...arguments),this.background=Xb.BelowLayer}};h([V()],GEe.prototype,"background",void 0);let Q8=class{constructor(e,i,r,n,s,o){this.texture=e,this.type=i,e.retain(),this.offsetAndScale=Mt(r.offset[0],r.offset[1],r.scale,r.scale),this.opacities=Ce(n,s,o)}destroy(){this.texture.release()}};function L0(t,e){return[t,e]}function Ev(t,e,i){return t[0]=e,t[1]=i,t}function cpt(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t}const Hh=new Wb("0/0/0/0");let upt=class jEe{static create(e,i,r=null){const n=Fd(e.spatialReference),s=i.origin||L0(e.origin.x,e.origin.y),o=L0(e.size[0]*i.resolution,e.size[1]*i.resolution),a=L0(-1/0,-1/0),l=L0(1/0,1/0),c=L0(1/0,1/0);r!=null&&(Ev(a,Math.max(0,Math.floor((r.xmin-s[0])/o[0])),Math.max(0,Math.floor((s[1]-r.ymax)/o[1]))),Ev(l,Math.max(0,Math.floor((r.xmax-s[0])/o[0])),Math.max(0,Math.floor((s[1]-r.ymin)/o[1]))),Ev(c,l[0]-a[0]+1,l[1]-a[1]+1));const{cols:u,rows:d}=i;let p,m,y,_;return!r&&u&&d&&(Ev(a,u[0],d[0]),Ev(l,u[1],d[1]),Ev(c,u[1]-u[0]+1,d[1]-d[0]+1)),e.isWrappable?(p=L0(Math.ceil(Math.round((n.valid[1]-n.valid[0])/i.resolution)/e.size[0]),c[1]),m=L0(Math.floor((n.origin[0]-s[0])/o[0]),a[1]),y=L0(p[0]+m[0]-1,l[1]),_=!0):(m=a,y=l,p=c,_=!1),new jEe(i.level,i.resolution,i.scale,s,a,l,c,o,m,y,p,_)}constructor(e,i,r,n,s,o,a,l,c,u,d,p){this.level=e,this.resolution=i,this.scale=r,this.origin=n,this.first=s,this.last=o,this.size=a,this.norm=l,this.worldStart=c,this.worldEnd=u,this.worldSize=d,this.wrap=p}normalizeCol(e){if(!this.wrap)return e;const i=this.worldSize[0];return e<0?i-1-Math.abs((e+1)%i):e%i}denormalizeCol(e,i){return this.wrap?this.worldSize[0]*i+e:e}getWorldForColumn(e){return this.wrap?Math.floor(e/this.worldSize[0]):0}getFirstColumnForWorld(e){return e*this.worldSize[0]+this.first[0]}getLastColumnForWorld(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(e){return(e-this.origin[0])/this.norm[0]}getXForColumn(e){return this.origin[0]+e*this.norm[0]}getRowForY(e){return(this.origin[1]-e)/this.norm[1]}getYForRow(e){return this.origin[1]-e*this.norm[1]}getTileBounds(e,i,r=!1){Hh.set(i);const n=r?Hh.col:this.denormalizeCol(Hh.col,Hh.world),s=Hh.row;return cpt(e,this.getXForColumn(n),this.getYForRow(s+1),this.getXForColumn(n+1),this.getYForRow(s)),e}getTileCoords(e,i,r=!1){Hh.set(i);const n=r?Hh.col:this.denormalizeCol(Hh.col,Hh.world);return Array.isArray(e)?Ev(e,this.getXForColumn(n),this.getYForRow(Hh.row)):(e.x=this.getXForColumn(n),e.y=this.getYForRow(Hh.row)),e}},$j=class{constructor(){this.spans=[]}acquire(e){this.lodInfo=e}release(){this.lodInfo=null,this.spans.length=0}forEach(e,i){const{spans:r,lodInfo:n}=this,{level:s}=n;if(r.length!==0)for(const{row:o,colFrom:a,colTo:l}of r)for(let c=a;c<=l;c++)e.call(i,s,o,n.normalizeCol(c),n.getWorldForColumn(c))}};$j.pool=new aa($j);let ez=class{constructor(e,i,r){this.row=e,this.colFrom=i,this.colTo=r}};const Sn=new Wb("0/0/0/0");let hpt=class HEe{static create(e,i){e[1]>i[1]&&([e,i]=[i,e]);const[r,n]=e,[s,o]=i,a=s-r,l=o-n,c=l!==0?a/l:0,u=(Math.ceil(n)-n)*c,d=(Math.floor(n)-n)*c;return new HEe(r,Math.floor(n),Math.ceil(o),c,a<0?u:d,a<0?d:u,a<0?s:r,a<0?r:s)}constructor(e,i,r,n,s,o,a,l){this.x=e,this.ymin=i,this.ymax=r,this.invM=n,this.leftAdjust=s,this.rightAdjust=o,this.leftBound=a,this.rightBound=l}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}};const wc=[[0,0],[0,0],[0,0],[0,0]],dpt=1e-6;let Ukt=class{constructor(e,i=null,r=e.lods[0].level,n=e.lods[e.lods.length-1].level){this.tileInfo=e,this.fullExtent=i,this.scales=[],this._infoByScale={},this._infoByLevel={};const s=e.lods.filter(a=>a.level>=r&&a.level<=n);this.minScale=s[0].scale,this.maxScale=s[s.length-1].scale;const o=this._lodInfos=s.map(a=>upt.create(e,a,i));s.forEach((a,l)=>{this._infoByLevel[a.level]=o[l],this._infoByScale[a.scale]=o[l],this.scales[l]=a.scale},this),this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel[typeof e=="number"?e:e.level]}getTileBounds(e,i,r=!1){Sn.set(i);const n=this._infoByLevel[Sn.level];return n?n.getTileBounds(e,Sn,r):e}getTileCoords(e,i,r=!1){Sn.set(i);const n=this._infoByLevel[Sn.level];return n?n.getTileCoords(e,Sn,r):e}getTileCoverage(e,i=192,r=!0,n="closest"){if(!r&&(e.scale>this.minScale||e.scale<this.maxScale))return null;const s=n==="closest"?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),o=$j.pool.acquire(s),a=this._wrap;let l,c,u,d=1/0,p=-1/0;const m=o.spans;wc[0][0]=wc[0][1]=wc[1][1]=wc[3][0]=-i,wc[1][0]=wc[2][0]=e.size[0]+i,wc[2][1]=wc[3][1]=e.size[1]+i;for(const w of wc)e.toMap(w,w),w[0]=s.getColumnForX(w[0]),w[1]=s.getRowForY(w[1]);const y=[];let _=3;for(let w=0;w<4;w++){if(wc[w][1]===wc[_][1]){_=w;continue}const x=hpt.create(wc[w],wc[_]);d=Math.min(x.ymin,d),p=Math.max(x.ymax,p),y[x.ymin]===void 0&&(y[x.ymin]=[]),y[x.ymin].push(x),_=w}if(d==null||p==null||p-d>100)return null;let v=[];for(l=d;l<p;){y[l]!=null&&(v=v.concat(y[l])),c=1/0,u=-1/0;for(let w=v.length-1;w>=0;w--){const x=v[w];c=Math.min(c,x.getLeftCol()),u=Math.max(u,x.getRightCol())}if(c=Math.floor(c),u=Math.floor(u),l>=s.first[1]&&l<=s.last[1])if(a)if(s.size[0]<s.worldSize[0]){const w=Math.floor(u/s.worldSize[0]);for(let x=Math.floor(c/s.worldSize[0]);x<=w;x++)m.push(new ez(l,Math.max(s.getFirstColumnForWorld(x),c),Math.min(s.getLastColumnForWorld(x),u)))}else m.push(new ez(l,c,u));else c>s.last[0]||u<s.first[0]||(c=Math.max(c,s.first[0]),u=Math.min(u,s.last[0]),m.push(new ez(l,c,u)));l+=1;for(let w=v.length-1;w>=0;w--){const x=v[w];x.ymax>=l?x.incrRow():v.splice(w,1)}}return o}getTileParentId(e){Sn.set(e);const i=this._infoByLevel[Sn.level],r=this._lodInfos.indexOf(i)-1;return r<0?null:(this._getTileIdAtLOD(Sn,this._lodInfos[r],Sn),Sn.id)}getTileResolution(e){const i=this._infoByLevel[typeof e=="object"?e.level:e];return i?i.resolution:-1}getTileScale(e){const i=this._infoByLevel[e.level];return i?i.scale:-1}intersects(e,i){Sn.set(i);const r=this._infoByLevel[Sn.level],n=e.lodInfo;if(n.resolution>r.resolution){this._getTileIdAtLOD(Sn,n,Sn);const o=n.denormalizeCol(Sn.col,Sn.world);for(const a of e.spans)if(a.row===Sn.row&&a.colFrom<=o&&a.colTo>=o)return!0}if(n.resolution<r.resolution){const[o,a,l,c]=e.spans.reduce((_,v)=>(_[0]=Math.min(_[0],v.row),_[1]=Math.max(_[1],v.row),_[2]=Math.min(_[2],v.colFrom),_[3]=Math.max(_[3],v.colTo),_),[1/0,-1/0,1/0,-1/0]),u=r.denormalizeCol(Sn.col,Sn.world),d=n.getColumnForX(r.getXForColumn(u)),p=n.getRowForY(r.getYForRow(Sn.row)),m=n.getColumnForX(r.getXForColumn(u+1))-1,y=n.getRowForY(r.getYForRow(Sn.row+1))-1;return!(d>c||m<l||p>a||y<o)}const s=n.denormalizeCol(Sn.col,Sn.world);return e.spans.some(o=>o.row===Sn.row&&o.colFrom<=s&&o.colTo>=s)}normalizeBounds(e,i,r){if(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],this._wrap){const n=Fd(this.tileInfo.spatialReference),s=-r*(n.valid[1]-n.valid[0]);e[0]+=s,e[2]+=s}return e}getSmallestInfoForScale(e){const i=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>i[0])return this._infoByScale[i[0]];for(let r=1;r<i.length-1;r++)if(e>i[r]+dpt)return this._infoByScale[i[r-1]];return this._infoByScale[i[i.length-1]]}getClosestInfoForScale(e){const i=this.scales;return this._infoByScale[e]||(e=i.reduce((r,n)=>Math.abs(n-e)<Math.abs(r-e)?n:r,i[0])),this._infoByScale[e]}scaleToLevel(e){const i=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(let r=i.length-1;r>=0;r--)if(e<i[r])return r===i.length-1?this._infoByScale[i[i.length-1]].level:this._infoByScale[i[r]].level+(i[r]-e)/(i[r]-i[r+1]);return this._infoByScale[i[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}_getTileIdAtLOD(e,i,r){const n=this._infoByLevel[r.level];return e.set(r),i.resolution<n.resolution?null:(i.resolution===n.resolution||(e.level=i.level,e.col=Math.floor(r.col*n.resolution/i.resolution+.01),e.row=Math.floor(r.row*n.resolution/i.resolution+.01)),e)}},tz=class{constructor(){this._map=new Map,this._observable=new nR}get size(){return Ct(this._observable),this._map.size}clear(){this._map.size>0&&(this._map.clear(),this._observable.notify())}delete(e){const i=this._map.delete(e);return i&&this._observable.notify(),i}entries(){return Ct(this._observable),this._map.entries()}forEach(e,i){Ct(this._observable),this._map.forEach((r,n)=>e.call(i,r,n,this),i)}get(e){return Ct(this._observable),this._map.get(e)}has(e){return Ct(this._observable),this._map.has(e)}keys(){return Ct(this._observable),this._map.keys()}set(e,i){return this._map.set(e,i),this._observable.notify(),this}values(){return Ct(this._observable),this._map.values()}[Symbol.iterator](){return Ct(this._observable),this._map[Symbol.iterator]()}get[Symbol.toStringTag](){return this._map[Symbol.toStringTag]}},ppt=class{constructor(e,i){this.item=e,this.controller=i,this.promise=null}},fpt=class{constructor(e){this._schedule=null,this._task=null,this._deferreds=new tz,this._controllers=new tz,this._processingItems=new tz,this._pausedSignal=qT(!1),this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new hN(e.peeker),this.process=e.process;const i=e.scheduler;e.priority&&i&&(this._task=i.registerTask(e.priority,this))}destroy(){this.clear(),this._schedule=pr(this._schedule),this._task=pr(this._task)}get updating(){return!!this._task?.updating||this.running}get length(){return this._processingItems.size+this._queue.length}abort(e){const i=this._controllers.get(e);i&&i.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach(i=>e.push(i)),this._controllers.clear(),e.forEach(i=>i.abort()),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach((i,r)=>e(r))}get(e){const i=this._deferreds.get(e);return i?i.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,i){const r=this.get(e);if(r)return r;const n=new AbortController;let s=null;i&&(s=os(i,()=>n.abort()));const o=()=>{const u=this._processingItems.get(e);u&&u.controller.abort(),a(),c.reject(pi())},a=()=>{l.remove(),s?.remove(),this._deferreds.delete(e),this._controllers.delete(e),this._queue.remove(e),this._processingItems.delete(e),this._scheduleNext()},l=eR(n.signal,o),c=vs();return this._deferreds.set(e,c),this._controllers.set(e,n),c.promise.then(a,a),this._queue.push(e),this._scheduleNext(),c.promise}last(){return this._queue.last()}peek(){return this._queue.peek()}popLast(){return this._queue.popLast()}reset(){const e=[];this._processingItems.forEach(i=>e.push(i)),this._processingItems.clear();for(const i of e)this._queue.push(i.item),i.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}get running(){return!this._pausedSignal.value&&this._queue.length>0&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_scheduleNext(){this._task||this._pausedSignal.value||this._schedule||(this._schedule=PS(()=>{this._schedule=null,this._next()}))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,i){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(i))}_processError(e,i){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(i))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(e==null)return;let i;const r=new AbortController,n=new ppt(e,r);this._processingItems.set(e,n);try{i=this.process(e,r.signal)}catch(s){this._processError(n,s)}dc(i)?(n.promise=i,i.then(s=>this._processResult(n,s),s=>this._processError(n,s))):this._processResult(n,i)}get test(){return{update:e=>this.runTask(e)}}};function mpt(t,e){return t.length=0,e.forEach(i=>t.push(i)),t}const iz=new Set,F$=[],Tx=new Map,Doe=[0,0];let Cv=class extends xe{constructor(e){super(e),this._keyToItem=new Map,this.concurrency=6,this.strategy="scale-first",this.tileInfoView=null}initialize(){const{concurrency:e,process:i,strategy:r}=this;this._queue=new fpt({concurrency:e,process:(n,s)=>{const o=this._keyToItem.get(n);return i(o,{signal:s})},peeker:r==="scale-first"?n=>this._peekByScaleFirst(n):n=>this._peekByCenterFirst(n)})}destroy(){this.clear(),this._queue=Pe(this._queue)}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}abort(e){const i=typeof e=="string"?e:e.id;this._queue.abort(i)}clear(){this._queue.clear(),this._keyToItem.clear()}has(e){return typeof e=="string"?this._keyToItem.has(e):this._keyToItem.has(e.id)}isOngoing(e){const i=typeof e=="string"?e:e.id;return this.has(i)&&this._queue.isOngoing(i)}pause(){this._queue.pause()}push(e){const i=e.key.id;if(this._queue.has(i))return this._queue.get(i);const r=this._queue.push(i),n=()=>{this._keyToItem.delete(i)};return this._keyToItem.set(i,e),r.then(n,n),r}reset(){this._queue.reset()}resume(){this._queue.resume()}_peekByScaleFirst(e){if(!this.state)return e.values().next().value;const i=this.tileInfoView;let r=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY;e.forEach(u=>{const d=this._keyToItem.get(u),p=this.tileInfoView.getTileScale(d.key);Tx.has(p)||(Tx.set(p,[]),r=Math.max(p,r),n=Math.min(p,n)),Tx.get(p).push(d.key),iz.add(p)});let s=this.state.scale;Tx.has(s)||(mpt(F$,iz),F$.sort((u,d)=>u-d),s=F$.reduce((u,d)=>Math.abs(d-s)<Math.abs(u-s)?d:u,F$[0])),s=Math.min(s,r),s=Math.max(s,n);const o=Tx.get(s),a=i.getClosestInfoForScale(s),l=a.getColumnForX(this.state.center[0]),c=a.getRowForY(this.state.center[1]);return o.sort((u,d)=>{const p=a.denormalizeCol(u.col,u.world),m=a.denormalizeCol(d.col,d.world);return Math.sqrt((l-p)*(l-p)+(c-u.row)*(c-u.row))-Math.sqrt((l-m)*(l-m)+(c-d.row)*(c-d.row))}),iz.clear(),Tx.clear(),o[0].id}_peekByCenterFirst(e){if(!this.state)return e.values().next().value;const i=this.tileInfoView,r=this.state.center;let n,s=Number.POSITIVE_INFINITY;return e.forEach(o=>{const a=this._keyToItem.get(o);i.getTileCoords(Doe,a.key);const l=a_(Doe,r);l<s&&(s=l,n=a.key)}),n.id}};h([f({constructOnly:!0})],Cv.prototype,"concurrency",void 0),h([f({constructOnly:!0})],Cv.prototype,"process",void 0),h([f()],Cv.prototype,"state",void 0),h([f({constructOnly:!0})],Cv.prototype,"strategy",void 0),h([f({constructOnly:!0})],Cv.prototype,"tileInfoView",void 0),Cv=h([z("esri.views.2d.tiling.TileQueue")],Cv);new Wb(0,0,0,0);function gpt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function ypt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function _pt(t,e,i,r,n,s,o){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=s,t[5]=o,t}function qEe(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5];let l=i*s-r*n;return l?(l=1/l,t[0]=s*l,t[1]=-r*l,t[2]=-n*l,t[3]=i*l,t[4]=(n*a-s*o)*l,t[5]=(r*o-i*a)*l,t):null}function vpt(t){return t[0]*t[3]-t[1]*t[2]}function WEe(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=i[0],u=i[1],d=i[2],p=i[3],m=i[4],y=i[5];return t[0]=r*c+s*u,t[1]=n*c+o*u,t[2]=r*d+s*p,t[3]=n*d+o*p,t[4]=r*m+s*y+a,t[5]=n*m+o*y+l,t}function $Z(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=Math.sin(i),u=Math.cos(i);return t[0]=r*u+s*c,t[1]=n*u+o*c,t[2]=r*-c+s*u,t[3]=n*-c+o*u,t[4]=a,t[5]=l,t}function YEe(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=i[0],u=i[1];return t[0]=r*c,t[1]=n*c,t[2]=s*u,t[3]=o*u,t[4]=a,t[5]=l,t}function IZ(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=i[0],u=i[1];return t[0]=r,t[1]=n,t[2]=s,t[3]=o,t[4]=r*c+s*u+a,t[5]=n*c+o*u+l,t}function bpt(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t[4]=0,t[5]=0,t}function wpt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function LZ(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function xpt(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function Tpt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)}function Spt(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t}function XEe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}function Ept(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t}function Cpt(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t}function Apt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function Opt(t,e){const i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=e[0],c=e[1],u=e[2],d=e[3],p=e[4],m=e[5],y=mo();return Math.abs(i-l)<=y*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-c)<=y*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-u)<=y*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(s-d)<=y*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(o-p)<=y*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-m)<=y*Math.max(1,Math.abs(a),Math.abs(m))}const Rpt=WEe,Ppt=XEe;Object.freeze(Object.defineProperty({__proto__:null,add:Spt,copy:gpt,determinant:vpt,equals:Opt,exactEquals:Apt,frob:Tpt,fromRotation:bpt,fromScaling:wpt,fromTranslation:LZ,identity:ypt,invert:qEe,mul:Rpt,multiply:WEe,multiplyScalar:Ept,multiplyScalarAndAdd:Cpt,rotate:$Z,scale:YEe,set:_pt,str:xpt,sub:Ppt,subtract:XEe,translate:IZ},Symbol.toStringTag,{value:"Module"}));function ZEe(){const t=new Float32Array(6);return t[0]=1,t[3]=1,t}function Mpt(t){const e=new Float32Array(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function $pt(t,e,i,r,n,s){const o=new Float32Array(6);return o[0]=t,o[1]=e,o[2]=i,o[3]=r,o[4]=n,o[5]=s,o}function Ipt(t,e){return new Float32Array(t,e,6)}function JEe(t,e,i,r){const n=e[r],s=e[r+1];t[r]=i[0]*n+i[2]*s+i[4],t[r+1]=i[1]*n+i[3]*s+i[5]}function Lpt(t,e,i,r=0,n=0,s=2){const o=n||e.length/s;for(let a=r;a<o;a++)JEe(t,e,i,a*s)}Object.freeze(Object.defineProperty({__proto__:null,clone:Mpt,create:ZEe,createView:Ipt,fromValues:$pt,transform:JEe,transformMany:Lpt},Symbol.toStringTag,{value:"Module"}));function KL(){return[1,0,0,1,0,0]}function Dpt(t){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function Npt(t,e,i,r,n,s){return[t,e,i,r,n,s]}function Fpt(t,e){return new Float64Array(t,e,6)}Object.freeze(Object.defineProperty({__proto__:null,clone:Dpt,create:KL,createView:Fpt,fromValues:Npt},Symbol.toStringTag,{value:"Module"}));function kpt(t){return t instanceof Float32Array&&t.length>=2}function Upt(t){return Array.isArray(t)&&t.length>=2}function k$(t){return kpt(t)||Upt(t)}const U$={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new Ad({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:je.WebMercator}),minus180Line:new Ad({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:je.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new Ad({paths:[[[180,-180],[180,180]]],spatialReference:je.WGS84}),minus180Line:new Ad({paths:[[[-180,-180],[-180,180]]],spatialReference:je.WGS84})}};function Y1(t,e){return Math.ceil((t-e)/(2*e))}function KEe(t,e){const i=I3(t);for(const r of i)for(const n of r)n[0]+=e;return t}function I3(t){return U4(t)?t.rings:t.paths}async function zpt(t,e,i,r){const n=KSe(t),s=e[0].spatialReference,o={...r,responseType:"json",query:{...n.query,f:"json",sr:DD(s),target:JSON.stringify({geometryType:uR(e[0]),geometries:e}),cutter:JSON.stringify(i)}},a=await Ii(n.path+"/cut",o),{cutIndexes:l,geometries:c=[]}=a.data;return{cutIndexes:l,geometries:c.map(u=>{const d=Cb(u);return d.spatialReference=s,d})}}async function Bpt(t,e,i){const r=typeof t=="string"?bn(t):t,n=e[0].spatialReference,s=uR(e[0]),o={...i,query:{...r.query,f:"json",sr:DD(n),geometries:JSON.stringify(Kct(e))}},{data:a}=await Ii(r.path+"/simplify",o);return QSe(a.geometries,s,n)}const QEe=ne.getLogger("esri.geometry.support.normalizeUtils");function Vpt(t){return t.type==="polygon"}function Gpt(t){return t[0].type==="polygon"}function jpt(t){return t[0].type==="polyline"}function Hpt(t,e){if(!(t instanceof Ad||t instanceof Mf)){const n="straightLineDensify: the input geometry is neither polyline nor polygon";throw QEe.error(n),new W(n)}const i=I3(t),r=[];for(const n of i){const s=[];r.push(s),s.push([n[0][0],n[0][1]]);for(let o=0;o<n.length-1;o++){const a=n[o][0],l=n[o][1],c=n[o+1][0],u=n[o+1][1],d=Math.sqrt((c-a)*(c-a)+(u-l)*(u-l)),p=(u-l)/d,m=(c-a)/d,y=d/e;if(y>1){for(let x=1;x<=y-1;x++){const T=x*e,S=m*T+a,E=p*T+l;s.push([S,E])}const _=(d+Math.floor(y-1)*e)/2,v=m*_+a,w=p*_+l;s.push([v,w])}s.push([c,u])}}return Vpt(t)?new Mf({rings:r,spatialReference:t.spatialReference}):new Ad({paths:r,spatialReference:t.spatialReference})}function Noe(t,e,i){if(e){const r=Hpt(t,1e6);t=$2(r,!0)}return i&&(t=KEe(t,i)),t}function Foe(t,e,i){if(Array.isArray(t)){const r=t[0];if(r>e){const n=Y1(r,e);t[0]=r+n*(-2*e)}else if(r<i){const n=Y1(r,i);t[0]=r+n*(-2*i)}}else{const r=t.x;if(r>e){const n=Y1(r,e);t=t.clone().offset(n*(-2*e),0)}else if(r<i){const n=Y1(r,i);t=t.clone().offset(n*(-2*i),0)}}return t}function qpt(t,e){let i=-1;for(let r=0;r<e.cutIndexes.length;r++){const n=e.cutIndexes[r],s=e.geometries[r],o=I3(s);for(let a=0;a<o.length;a++){const l=o[a];l.some(c=>{if(c[0]<180)return!0;{let u=0;for(let p=0;p<l.length;p++){const m=l[p][0];u=m>u?m:u}u=Number(u.toFixed(9));const d=-360*Y1(u,180);for(let p=0;p<l.length;p++){const m=s.getPoint(a,p);s.setPoint(a,p,m.clone().offset(d,0))}return!0}})}if(n===i){if(Gpt(t))for(const a of I3(s))t[n]=t[n].addRing(a);else if(jpt(t))for(const a of I3(s))t[n]=t[n].addPath(a)}else i=n,t[n]=s}return t}async function Wpt(t,e,i){if(!Array.isArray(t))return Wpt([t],e);e&&typeof e!="string"&&QEe.warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const r=typeof e=="string"?e:e?.url??Oi.geometryServiceUrl;let n,s,o,a,l,c,u,d,p=0;const m=[],y=[];for(const S of t)if(S!=null)if(n||(n=S.spatialReference,s=Fd(n),o=n.isWebMercator,c=o?102100:4326,a=U$[c].maxX,l=U$[c].minX,u=U$[c].plus180Line,d=U$[c].minus180Line),s)if(S.type==="mesh")y.push(S);else if(S.type==="point")y.push(Foe(S.clone(),a,l));else if(S.type==="multipoint"){const E=S.clone();E.points=E.points.map(A=>Foe(A,a,l)),y.push(E)}else if(S.type==="extent"){const E=S.clone()._normalize(!1,!1,s);y.push(E.rings?new Mf(E):E)}else if(S.extent){const E=S.extent,A=Y1(E.xmin,l)*(2*a);let P=A===0?S.clone():KEe(S.clone(),A);E.offset(A,0),E.intersects(u)&&E.xmax!==a?(p=E.xmax>p?E.xmax:p,P=Noe(P,o),m.push(P),y.push("cut")):E.intersects(d)&&E.xmin!==l?(p=E.xmax*(2*a)>p?E.xmax*(2*a):p,P=Noe(P,o,360),m.push(P),y.push("cut")):y.push(P)}else y.push(S.clone());else y.push(S);else y.push(S);let _=Y1(p,a),v=-90;const w=_,x=new Ad;for(;_>0;){const S=360*_-180;x.addPath([[S,v],[S,-1*v]]),v*=-1,_--}if(m.length>0&&w>0){const S=qpt(m,await zpt(r,m,x,i)),E=[],A=[];for(let F=0;F<y.length;F++){const D=y[F];if(D!=="cut")A.push(D);else{const $=S.shift(),R=t[F];R!=null&&R.type==="polygon"&&R.rings&&R.rings.length>1&&$.rings.length>=R.rings.length?(E.push($),A.push("simplify")):A.push(o?Gy($):$)}}if(!E.length)return A;const P=await Bpt(r,E,i),N=[];for(let F=0;F<A.length;F++){const D=A[F];D!=="simplify"?N.push(D):N.push(o?Gy(P.shift()):P.shift())}return N}const T=[];for(let S=0;S<y.length;S++){const E=y[S];if(E!=="cut")T.push(E);else{const A=m.shift();T.push(o===!0?Gy(A):A)}}return T}function Ypt(t,e,i){const r=Fd(i);if(r==null)return t;const[n,s]=r.valid,o=2*s;let a=0,l=0;e>s?a=Math.ceil(Math.abs(e-s)/o):e<n&&(a=-Math.ceil(Math.abs(e-n)/o)),t>s?l=Math.ceil(Math.abs(t-s)/o):t<n&&(l=-Math.ceil(Math.abs(t-n)/o));let c=t+(a-l)*o;const u=c-e;return u>s?c-=o:u<n&&(c+=o),c}const Xpt=96,Zpt=39.37;function DZ(t,e){return e.type?si(t,e.x,e.y):Yn(t,e)}function Jpt(t){return ua(t)}function Kpt(t,e){const i=t.targetGeometry,r=e.targetGeometry;return i.x=r.x,i.y=r.y,i.spatialReference=r.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}const Qpt=function(){const t=Ue();return function(e,i,r){const n=i.targetGeometry;DZ(t,n);const s=.5*xk(i);return e.xmin=t[0]-s*r[0],e.ymin=t[1]-s*r[1],e.xmax=t[0]+s*r[0],e.ymax=t[1]+s*r[1],e.spatialReference=n.spatialReference,e}}();function xk(t){return t.scale*eft(t.targetGeometry)}function eft(t){return t!=null&&ta(t.spatialReference)?1/(Jpt(t.spatialReference)*Zpt*Xpt):1}function tft(t){return C4(t.rotation)||0}const NZ=function(){const t=Ue(),e=Ue(),i=Ue();return function(r,n,s,o,a,l){return cY(t,n),Yl(e,s,.5*l),si(i,1/o*l,-1/o*l),LZ(r,e),a&&$Z(r,r,a),YEe(r,r,i),IZ(r,r,t),r}}(),ift=function(){const t=Ue();return function(e,i,r,n){const s=xk(i),o=tft(i);return DZ(t,i.targetGeometry),NZ(e,t,r,s,o,n)}}(),rft=function(){const t=Ue();return function(e,i,r,n){const s=xk(i);return DZ(t,i.targetGeometry),NZ(e,t,r,s,0,n)}}();function nft(t){const e=Fd(t);return e?e.valid[1]-e.valid[0]:0}function sft(t,e){return Math.round(nft(t)/e)}var Ij;const ya=[0,0];let ly=Ij=class extends $e{constructor(t){super(t),this._viewpoint2D={center:Ue(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new Xi,this.id=0,this.inverseTransform=KL(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=KL(),this.transformNoRotation=KL(),this.displayMat3=sa(),this.displayViewMat3=sa(),this.viewMat3=sa(),this.viewMat2d=ZEe(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(t){this._set("pixelRatio",t),this._update()}set size(t){this._set("size",t),this._update()}set viewpoint(t){if(t){const e=this._viewpoint2D,i=t.targetGeometry;e.center[0]=i.x,e.center[1]=i.y,e.rotation=t.rotation,e.scale=t.scale,e.spatialReference=i.spatialReference}this._update()}copy(t){const e=this.size,i=this.viewpoint;return i&&e?(this.viewpoint=Kpt(i,t.viewpoint),this._set("size",Yn(e,t.size))):(this.viewpoint=t.viewpoint.clone(),this._set("size",[t.size[0],t.size[1]])),this._set("pixelRatio",t.pixelRatio),this}clone(){return new Ij({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(t,e,i){return k$(e)?sy(t,e,this.inverseTransform):(ya[0]=e,ya[1]=i,sy(t,ya,this.inverseTransform))}toScreen(t,e,i){return k$(e)?sy(t,e,this.transform):(ya[0]=e,ya[1]=i,sy(t,ya,this.transform))}toScreenNoRotation(t,e,i){return k$(e)?sy(t,e,this.transformNoRotation):(ya[0]=e,ya[1]=i,sy(t,ya,this.transformNoRotation))}toScreenClosest(t,e,i){k$(e)?(ya[0]=e[0],ya[1]=e[1]):(ya[0]=e,ya[1]=i);const[r]=ya,{center:n,extent:s,spatialReference:o,transform:a}=this;return(r<s.xmin||r>s.xmax)&&(ya[0]=Ypt(r,n[0],o)),sy(t,ya,a)}getScreenTransform(t,e){const{center:i}=this._viewpoint2D,r=this._get("pixelRatio")||1,n=this._get("size");return NZ(t,i,n,e,0,r),t}_update(){const{center:t,spatialReference:e,scale:i,rotation:r}=this._viewpoint2D,n=this._get("pixelRatio")||1,s=this._get("size"),o=new oc({targetGeometry:new lt(t[0],t[1],e),scale:i,rotation:r});if(this._set("viewpoint",o),!s||!e||!i)return;this.resolution=xk(o),this.rotation=r,this.scale=i,this.spatialReference=e,Yn(this.center,t);const a=s[0]!==0?2/s[0]:0,l=s[1]!==0?-2/s[1]:0;BW(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=VW(this.viewMat3),u=Qu(s[0]/2,s[1]/2),d=Qu(-s[0]/2,-s[1]/2),p=C4(r);bN(c,c,u),GW(c,c,p),bN(c,c,d),tS(this.displayViewMat3,this.displayMat3,c);const m=LZ(this.viewMat2d,u);return $Z(m,m,p),IZ(m,m,d),Qpt(this.extent,o,s),ift(this.transform,o,s,n),qEe(this.inverseTransform,this.transform),rft(this.transformNoRotation,o,s,n),this.worldScreenWidth=sft(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};h([f({readOnly:!0})],ly.prototype,"id",void 0),h([f({value:1,json:{write:!0}})],ly.prototype,"pixelRatio",null),h([f({json:{write:!0}})],ly.prototype,"size",null),h([f()],ly.prototype,"spatialReference",void 0),h([f({type:oc,json:{write:!0}})],ly.prototype,"viewpoint",null),ly=Ij=h([z("esri.views.2d.ViewState")],ly);const oft=ly;var Lj,Dj,koe,Uoe,zoe,Boe,Voe,Goe,joe,Hoe,qoe,Woe,Yoe,Xoe,Zoe,Joe,Koe,Qoe,eae,tae,iae,rae,nae,sae,oae,aae,lae,cae,uae,hae,dae,pae,fae,mae,gae,yae,_ae,vae,bae,wae,xae,Tae,Sae,Eae,Cae,Aae,Oae,Rae,Pae,Mae,$ae,Iae,Lae,Dae,Nae,Fae,kae,Uae,zae,Bae,Vae;(function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE",t[t.UNKNOWN=4]="UNKNOWN"})(Lj||(Lj={})),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER",t[t.UNKNOWN=4]="UNKNOWN"}(Dj||(Dj={})),function(t){t[t.SCREEN=0]="SCREEN",t[t.MAP=1]="MAP"}(koe||(koe={})),function(t){t[t.Tint=0]="Tint",t[t.Ignore=1]="Ignore",t[t.Multiply=99]="Multiply"}(Uoe||(Uoe={})),function(t){t.Both="Both",t.JustBegin="JustBegin",t.JustEnd="JustEnd",t.None="None"}(zoe||(zoe={})),function(t){t[t.Mosaic=0]="Mosaic",t[t.Centered=1]="Centered"}(Boe||(Boe={})),function(t){t[t.Normal=0]="Normal",t[t.Superscript=1]="Superscript",t[t.Subscript=2]="Subscript"}(Voe||(Voe={})),function(t){t[t.MSSymbol=0]="MSSymbol",t[t.Unicode=1]="Unicode"}(Goe||(Goe={})),function(t){t[t.Unspecified=0]="Unspecified",t[t.TrueType=1]="TrueType",t[t.PSOpenType=2]="PSOpenType",t[t.TTOpenType=3]="TTOpenType",t[t.Type1=4]="Type1"}(joe||(joe={})),function(t){t[t.Display=0]="Display",t[t.Map=1]="Map"}(Hoe||(Hoe={})),function(t){t.None="None",t.Loop="Loop",t.Oscillate="Oscillate"}(qoe||(qoe={})),function(t){t[t.Z=0]="Z",t[t.X=1]="X",t[t.Y=2]="Y"}(Woe||(Woe={})),function(t){t[t.XYZ=0]="XYZ",t[t.ZXY=1]="ZXY",t[t.YXZ=2]="YXZ"}(Yoe||(Yoe={})),function(t){t[t.Rectangle=0]="Rectangle",t[t.RoundedRectangle=1]="RoundedRectangle",t[t.Oval=2]="Oval"}(Xoe||(Xoe={})),function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.Screen=2]="Screen",t[t.Multiply=3]="Multiply",t[t.Add=4]="Add"}(Zoe||(Zoe={})),function(t){t[t.TTB=0]="TTB",t[t.RTL=1]="RTL",t[t.BTT=2]="BTT"}(Joe||(Joe={})),function(t){t[t.None=0]="None",t[t.SignPost=1]="SignPost",t[t.FaceNearPlane=2]="FaceNearPlane"}(Koe||(Koe={})),function(t){t[t.Float=0]="Float",t[t.String=1]="String",t[t.Boolean=2]="Boolean"}(Qoe||(Qoe={})),function(t){t[t.Intersect=0]="Intersect",t[t.Subtract=1]="Subtract"}(eae||(eae={})),function(t){t.OpenEnded="OpenEnded",t.Block="Block",t.Crossed="Crossed"}(tae||(tae={})),function(t){t.FullGeometry="FullGeometry",t.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",t.ReversedFirstSegment="ReversedFirstSegment",t.PerpendicularToSecondSegment="PerpendicularToSecondSegment",t.SecondSegmentWithTicks="SecondSegmentWithTicks",t.DoublePerpendicular="DoublePerpendicular",t.OppositeToFirstSegment="OppositeToFirstSegment",t.TriplePerpendicular="TriplePerpendicular",t.HalfCircleFirstSegment="HalfCircleFirstSegment",t.HalfCircleSecondSegment="HalfCircleSecondSegment",t.HalfCircleExtended="HalfCircleExtended",t.OpenCircle="OpenCircle",t.CoverageEdgesWithTicks="CoverageEdgesWithTicks",t.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",t.GapExtentMidline="GapExtentMidline",t.Chevron="Chevron",t.PerpendicularWithArc="PerpendicularWithArc",t.ClosedHalfCircle="ClosedHalfCircle",t.TripleParallelExtended="TripleParallelExtended",t.ParallelWithTicks="ParallelWithTicks",t.Parallel="Parallel",t.PerpendicularToFirstSegment="PerpendicularToFirstSegment",t.ParallelOffset="ParallelOffset",t.OffsetOpposite="OffsetOpposite",t.OffsetSame="OffsetSame",t.CircleWithArc="CircleWithArc",t.DoubleJog="DoubleJog",t.PerpendicularOffset="PerpendicularOffset",t.LineExcludingLastSegment="LineExcludingLastSegment",t.MultivertexArrow="MultivertexArrow",t.CrossedArrow="CrossedArrow",t.ChevronArrow="ChevronArrow",t.ChevronArrowOffset="ChevronArrowOffset",t.PartialFirstSegment="PartialFirstSegment",t.Arch="Arch",t.CurvedParallelTicks="CurvedParallelTicks",t.Arc90Degrees="Arc90Degrees"}(iae||(iae={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square",t.TrueBuffer="TrueBuffer"}(rae||(rae={})),function(t){t.ClosePath="ClosePath",t.ConvexHull="ConvexHull",t.RectangularBox="RectangularBox"}(nae||(nae={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(sae||(sae={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square"}(oae||(oae={})),function(t){t.Fast="Fast",t.Accurate="Accurate"}(aae||(aae={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(lae||(lae={})),function(t){t.Sinus="Sinus",t.Square="Square",t.Triangle="Triangle",t.Random="Random"}(cae||(cae={})),function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Force=2]="Force"}(uae||(uae={})),function(t){t[t.Buffered=0]="Buffered",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.AlongLine=3]="AlongLine"}(hae||(hae={})),function(t){t[t.Linear=0]="Linear",t[t.Rectangular=1]="Rectangular",t[t.Circular=2]="Circular",t[t.Buffered=3]="Buffered"}(dae||(dae={})),function(t){t[t.Discrete=0]="Discrete",t[t.Continuous=1]="Continuous"}(pae||(pae={})),function(t){t[t.AcrossLine=0]="AcrossLine",t[t.AloneLine=1]="AloneLine"}(fae||(fae={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Center=2]="Center",t[t.Justify=3]="Justify"}(mae||(mae={})),function(t){t[t.Base=0]="Base",t[t.MidPoint=1]="MidPoint",t[t.ThreePoint=2]="ThreePoint",t[t.FourPoint=3]="FourPoint",t[t.Underline=4]="Underline",t[t.CircularCW=5]="CircularCW",t[t.CircularCCW=6]="CircularCCW"}(gae||(gae={})),function(t){t.Butt="Butt",t.Round="Round",t.Square="Square"}(yae||(yae={})),function(t){t.NoConstraint="NoConstraint",t.HalfPattern="HalfPattern",t.HalfGap="HalfGap",t.FullPattern="FullPattern",t.FullGap="FullGap",t.Custom="Custom"}(_ae||(_ae={})),function(t){t[t.None=-1]="None",t[t.Custom=0]="Custom",t[t.Circle=1]="Circle",t[t.OpenArrow=2]="OpenArrow",t[t.ClosedArrow=3]="ClosedArrow",t[t.Diamond=4]="Diamond"}(vae||(vae={})),function(t){t[t.ExtraLeading=0]="ExtraLeading",t[t.Multiple=1]="Multiple",t[t.Exact=2]="Exact"}(bae||(bae={})),function(t){t.Bevel="Bevel",t.Round="Round",t.Miter="Miter"}(wae||(wae={})),function(t){t[t.Default=0]="Default",t[t.String=1]="String",t[t.Numeric=2]="Numeric"}(xae||(xae={})),function(t){t[t.InsidePolygon=0]="InsidePolygon",t[t.PolygonCenter=1]="PolygonCenter",t[t.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(Tae||(Tae={})),function(t){t[t.Tint=0]="Tint",t[t.Replace=1]="Replace",t[t.Multiply=2]="Multiply"}(Sae||(Sae={})),function(t){t[t.ClipAtBoundary=0]="ClipAtBoundary",t[t.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",t[t.DoNotTouchBoundary=2]="DoNotTouchBoundary",t[t.DoNotClip=3]="DoNotClip"}(Eae||(Eae={})),function(t){t.NoConstraint="NoConstraint",t.WithMarkers="WithMarkers",t.WithFullGap="WithFullGap",t.WithHalfGap="WithHalfGap",t.Custom="Custom"}(Cae||(Cae={})),function(t){t.Fixed="Fixed",t.Random="Random",t.RandomFixedQuantity="RandomFixedQuantity"}(Aae||(Aae={})),function(t){t.LineMiddle="LineMiddle",t.LineBeginning="LineBeginning",t.LineEnd="LineEnd",t.SegmentMidpoint="SegmentMidpoint"}(Oae||(Oae={})),function(t){t.OnPolygon="OnPolygon",t.CenterOfMass="CenterOfMass",t.BoundingBoxCenter="BoundingBoxCenter"}(Rae||(Rae={})),function(t){t[t.Low=0]="Low",t[t.Medium=1]="Medium",t[t.High=2]="High"}(Pae||(Pae={})),function(t){t[t.MarkerCenter=0]="MarkerCenter",t[t.MarkerBounds=1]="MarkerBounds"}(Mae||(Mae={})),function(t){t[t.None=0]="None",t[t.PropUniform=1]="PropUniform",t[t.PropNonuniform=2]="PropNonuniform",t[t.DifUniform=3]="DifUniform",t[t.DifNonuniform=4]="DifNonuniform"}($ae||($ae={})),function(t){t.Tube="Tube",t.Strip="Strip",t.Wall="Wall"}(Iae||(Iae={})),function(t){t[t.Random=0]="Random",t[t.Increasing=1]="Increasing",t[t.Decreasing=2]="Decreasing",t[t.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(Lae||(Lae={})),function(t){t[t.Relative=0]="Relative",t[t.Absolute=1]="Absolute"}(Dae||(Dae={})),function(t){t[t.Normal=0]="Normal",t[t.LowerCase=1]="LowerCase",t[t.Allcaps=2]="Allcaps"}(Nae||(Nae={})),function(t){t[t.LTR=0]="LTR",t[t.RTL=1]="RTL"}(Fae||(Fae={})),function(t){t.Draft="Draft",t.Picture="Picture",t.Text="Text"}(kae||(kae={})),function(t){t[t.Top=0]="Top",t[t.Center=1]="Center",t[t.Baseline=2]="Baseline",t[t.Bottom=3]="Bottom"}(Uae||(Uae={})),function(t){t[t.Right=0]="Right",t[t.Upright=1]="Upright"}(zae||(zae={})),function(t){t[t.Small=0]="Small",t[t.Medium=1]="Medium",t[t.Large=2]="Large"}(Bae||(Bae={})),function(t){t[t.Calm=0]="Calm",t[t.Rippled=1]="Rippled",t[t.Slight=2]="Slight",t[t.Moderate=3]="Moderate"}(Vae||(Vae={}));var Nj,$1,Fj,x5,kj,T5,Uj,I1,zj;(function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(Nj||(Nj={})),function(t){t[t.VISIBLE=0]="VISIBLE",t[t.NONE=1]="NONE"}($1||($1={})),function(t){t[t.POINT=0]="POINT",t[t.LINE=1]="LINE",t[t.LINE_CENTER=2]="LINE_CENTER"}(Fj||(Fj={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT",t[t.AUTO=2]="AUTO"}(x5||(x5={})),function(t){t[t.AUTO=0]="AUTO",t[t.LEFT=1]="LEFT",t[t.CENTER=2]="CENTER",t[t.RIGHT=3]="RIGHT"}(kj||(kj={})),function(t){t[t.CENTER=0]="CENTER",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.TOP_LEFT=5]="TOP_LEFT",t[t.TOP_RIGHT=6]="TOP_RIGHT",t[t.BOTTOM_LEFT=7]="BOTTOM_LEFT",t[t.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(T5||(T5={})),function(t){t[t.NONE=0]="NONE",t[t.UPPERCASE=1]="UPPERCASE",t[t.LOWERCASE=2]="LOWERCASE"}(Uj||(Uj={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT"}(I1||(I1={})),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(zj||(zj={}));let qh=class{};qh.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:$1.VISIBLE}},qh.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:$1.VISIBLE}},qh.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:$1.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:Lj.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:Dj.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}},qh.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:$1.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:Fj.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:T5.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:x5.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:T5.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:kj.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:x5.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:Uj.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[zj.HORIZONTAL]}},qh.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:$1.VISIBLE}},qh.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}},qh.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:I1.MAP}},qh.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:I1.MAP},"line-width":{type:"number",minimum:0,default:1}},qh.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:I1.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:I1.MAP}},qh.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}},qh.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:I1.MAP}};let aft=class extends aEe{_createTransforms(){return{dvs:sa(),tileMat3:sa()}}};const lft=.125;let cft=class{constructor(){this._renderParams={context:null,drawPhase:1,state:new oft({viewpoint:new oc({targetGeometry:new lt(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null,stencilSymbols:!0,is3D:!0,backgroundColor:null},this._backgroundTile=new aft(new Wb(0,0,0,0),0,0,0,512,512,4096,4096)}dispose(){this._renderParams=null}renderBackground(e,i,r,n,s,o,a,l,c,u){const d=this._backgroundTile;this._updateRenderParams(e,i,d,r,s,o,a,l,c,u),this._renderParams.stencilSymbols=!1,r.drawBackground(this._renderParams,d,n)}renderContent(e,i,r,n,s,o,a,l,c,u,d,p){this._stencilSymbols(e,i,r,n,s,o,a,Math.round(1/l),c,u,d,p);let m=1;r.stencilRef=m++,e.setStencilFunction(Pi.EQUAL,r.stencilRef,255),this._render(e,i,r,s,o,a,l,c,u,d,p),n.forAll(y=>{y.sourceLayerInfo.data.stencilRef=m++,this._renderSymbols(e,y.sourceLod,y.sourceLayerInfo.data,s,o,a,Math.round(1/l),y.offset,u,d,p)})}_stencilSymbols(e,i,r,n,s,o,a,l,c,u,d,p){let m=1;r.stencilRef=m++,e.setDepthTestEnabled(!1),e.setDepthWriteEnabled(!1),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(Gr.KEEP,Gr.KEEP,Gr.REPLACE),e.setStencilWriteMask(255),e.setStencilFunction(Pi.ALWAYS,r.stencilRef,255),this._stencilTileSymbols(e,i,r,s,o,a,l,c,u,d,p);for(const y of n.toArray()){const{sourceLod:_,offset:v,sourceLayerInfo:w}=y;w.data.stencilRef=m++,e.setStencilFunction(Pi.ALWAYS,w.data.stencilRef,255),this._stencilTileSymbols(e,_,w.data,s,o,a,l,v,u,d,p)}e.setStencilWriteMask(0),e.setBlendingEnabled(!0),e.setDepthTestEnabled(!0),e.setColorMask(!0,!0,!0,!0)}_renderSymbols(e,i,r,n,s,o,a,l,c,u,d){e.setStencilFunction(Pi.EQUAL,r.stencilRef,255),this._render(e,i,r,n,s,o,a,l,c,u,d,Nj.SYMBOL)}_render(e,i,r,n,s,o,a,l,c,u,d,p){this._updateRenderParams(e,i,r,n,o,a,l,c,u,d),this._renderParams.stencilSymbols=!1,n.drawTile(this._renderParams,r,s,p)}_stencilTileSymbols(e,i,r,n,s,o,a,l,c,u,d){this._updateRenderParams(e,i,r,n,o,a,l,c,u,d),this._renderParams.stencilSymbols=!0,r.triangleCount=0,n.drawSymbols(this._renderParams,r,s)}_updateRenderParams(e,i,r,n,s,o,a,l,c,u){"type"in r&&r.type==="vector-tile"&&!r.stage&&r.attachWithContext(e);const d=i[0]-s.getLevelShift(i[0]),p=this._renderParams;p.context=e,p.painter=n,p.glyphMosaic=n.glyphMosaic,p.spriteMosaic=n.spriteMosaic,p.pixelRatio=c*u,p.displayLevel=d,p.requiredLevel=d;const m=s.getScale(i[0]),[y,_]=s.getOffset(i,o*m),v=lft*o*m/l,w=r.transforms.dvs;w[0]=v,w[4]=-v,w[6]=-1-y-a[0]*o*2,w[7]=1+_+(1-a[1])*o*2-2,p.state.size[0]=l/u,p.state.size[1]=l/u,p.state.pixelRatio=u}},eCe=class tCe extends Ci{initializeProgram(e){return new wi(e.rctx,tCe.shader.get().build(this.configuration),fi)}initializePipeline(){return Ot({blending:cc(Te.ONE,Te.ONE_MINUS_SRC_ALPHA),colorWrite:Ft})}};eCe.shader=new bi(fdt,()=>pe(()=>import("./RasterColorizer.glsl-2ea42739.js"),[],import.meta.url));let AA=class extends $3{constructor(){super(...arguments),this.colorizerType=cb.Stretch,this.stretchType=Yb.Noop,this.applyColormap=!0,this.requireBilinearWithNN=!1}};h([V({count:cb.COUNT})],AA.prototype,"colorizerType",void 0),h([V({count:Yb.COUNT})],AA.prototype,"stretchType",void 0),h([V()],AA.prototype,"applyColormap",void 0),h([V()],AA.prototype,"requireBilinearWithNN",void 0);let Gae=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const i=this._fbos.get(e);if(i)return i;const r=new rp(this._rctx,new Li(e),new mL(ks.DEPTH24_STENCIL8,e));return this._fbos.set(e,r),r}};const uft=ne.getLogger("esri.views.3d.terrain");let hft=class{constructor(e,i){this._rctx=e,this._techniqueRepository=i,this._fbos=[],this._vectorTileHelper=new cft,this._bindParameters=new OF(null,null),this._blendLayersTechniqueConfig=new GEe,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=Zf(this._rctx,ER)}dispose(){this._fbos.forEach(et),this._fbos=null,this._vtFBO=et(this._vtFBO),this._vaoQuad=et(this._vaoQuad),this._vectorTileHelper=et(this._vectorTileHelper),this._backgroundTechnique=Jt(this._backgroundTechnique),this._applyOpacityTechnique=Jt(this._applyOpacityTechnique),this._blendLayersTechnique=Jt(this._blendLayersTechnique)}_getBlendLayersTechnique(e,i,r,n=vd.Off,s=Xb.BelowLayer){return this._blendLayersTechniqueConfig.output=i,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=r,this._blendLayersTechniqueConfig.premultipliedSource=n,this._blendLayersTechniqueConfig.background=s,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(BEe,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(e,i){const r=this._getBlendLayersTechnique(Re.Normal,i?jn.ColorComposite:jn.GridComposite,Jc.NotRequired,vd.Off,Xb.Only),n=this._rctx.bindTechnique(r,e,this._bindParameters);this._render(n)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(Qt.TRIANGLE_STRIP,0,cg(this._vaoQuad,"geometry"))}drawGroup(e,i,r,n,s,o=vd.On){i===jn.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(r).colorTexture),e.texture=this.currentFBO(r).colorTexture,this.closeGroup(r);const a=this._getBlendLayersTechnique(n,i,s,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawRasterData(e,i,r,n,s,o=vd.Off){if(e.texture==null)return;e.fboTexture=i===jn.GroupBackgroundComposite||n===Re.Normal&&s===Jc.NotRequired&&o===vd.Off?null:this.switch(r).colorTexture;const a=this._getBlendLayersTechnique(n,i,s,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawImageryTileData(e,i,r,n,s,o){const a=o.sourceLayerInfo.data;if(!a.source||(o.tile.surface.layerViewByIndex(o.layerIndex,Vt.MAP).ensureSymbolizerParameters(a),!a.bind(this._rctx)))return;e.fboTexture=n===Re.Normal&&s===Jc.NotRequired?null:this.switch(r).colorTexture;const l=this._getRasterColorizerTechnique(a,i,n,s);a.opacity=e.opacity;const c=a.getUniforms();c.scale=o.scale,c.offset=o.offset,c.backgroundColor=e.backgroundColor,c.fboTexture=e.fboTexture,c.baseOpacity=e.baseOpacity;const u=this._rctx.bindTechnique(l,c,null);this._render(u)}_getRasterColorizerTechnique(e,i,r,n){const s=e.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(s.type);return this._rasterColorizerConfig==null&&(this._rasterColorizerConfig=new AA,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=i,this._rasterColorizerConfig.blendMode=r,this._rasterColorizerConfig.baseOpacityMode=n,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!s.colormap,this._rasterColorizerConfig.requireBilinearWithNN=e.isBilinearWithStretchColorRamp,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?Yb.Noop:Yb.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(eCe,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(e,i,r,n,s,o,a,l,c){const u=this._rctx,d=o.sourceLayerInfo.data,p=o.tile.surface.layerViewByIndex(o.layerIndex,Vt.MAP),m=s===Jc.Required||e.opacity<1||n!==Re.Normal||i!==jn.Composite,y=m?vd.On:vd.Off,_=this._getBlendLayersTechnique(n,i,s,y);u.setPipelineState(_.getPipeline());let v=null,w=null;m?(w=this.currentFBO(r),this._vtFBO==null&&(this._vtFBO=new Gae(this._rctx)),v=this._vtFBO.get(r),u.bindFramebuffer(v),this._clearCurrentFBO()):c&&u.clearSafe(hr.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.renderBackground(u,o.sourceLod,p.painter,p.layer.styleRepository,p.schemaHelper,Math.round(1/o.scale),o.offset,l,a,p.contentZoom),d&&this._vectorTileHelper.renderContent(u,o.sourceLod,d,o.vtlNeighborInfos,p.painter,p.layer.styleRepository,p.schemaHelper,Math.round(1/o.scale),o.offset,l,a,p.contentZoom)}catch(x){uft.warnOnce("A render call containing vector tiles did not resolve correctly.",x)}return v==null||(u.bindFramebuffer(w),e.texture=v.colorTexture,e.offset=Sg,e.scale=1,this.drawRasterData(e,i,r,n,s,y),c)}copyFBOToTexture(e){const i=this._rctx,r=i.bindTexture(e.texture,Pt.TEXTURE_UNIT_FOR_UPDATES),n=e.descriptor;i.gl.copyTexImage2D(sn.TEXTURE_2D,0,n.pixelFormat,0,0,n.width,n.height,0),e.generateMipmap(),i.bindTexture(r,Pt.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setStencilWriteMask(255),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.setClearStencil(0),this._rctx.clearSafe(hr.COLOR_BUFFER_BIT|hr.DEPTH_BUFFER_BIT|hr.STENCIL_BUFFER_BIT)}_initFBO(e,i,r){this._rctx.bindFramebuffer(e),r&&(this._rctx.setViewport(0,0,i,i),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,i=0,r=!0){if(this._current=i,i>=this._fbos.length)for(let n=this._fbos.length;n<=i;n++)this._fbos.push(new Gae(this._rctx));this._initFBO(this._fbos[i].get(e),e,r)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const i=this.currentFBO(e),r=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),i}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const i=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(i),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},dft=class{constructor(){this.sourceLod=[0,0,0],this.offset=[0,0],this.scale=1,this.layerIndex=0,this.isVTLBackground=!1,this.vtlNeighborInfos=new It({allocator:e=>e||new pft})}},pft=class{constructor(){this.sourceLayerInfo=null,this.sourceLod=[0,0,0],this.offset=[-1,0]}},fft=class{constructor(e,i,r,n,s,o){this.start=e,this.end=i,this.blendMode=r,this.opacity=n,this.output=s,this.baseOpacity=o}},mft=class{constructor(e,i,r,n){this._rctx=e,this.tileSize=i,this._techniques=r,this._cache=n,this._passParameters=new lpt,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new hft(this._rctx,this._techniques),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=et(this._composition),this._backgroundTexture=Jt(this._backgroundTexture)}get backgroundIsGrid(){return this._backgroundColor==null}get backgroundColor(){return this._backgroundColor}updateTileTexture(e,i){if(!e.renderData)return;const r=e.surface,n=r.baseOpacity;let s=0,o=0,a=this.tileSize,l=!1,c=!1;const u=r.view.state.contentPixelRatio;let d=!1;S5.clear(),Sx.length=0;const p=e.layerInfo[Vt.MAP];let m=0,y=null;for(;m<p.length;m++){const v=r.layerViewByIndex(m,Vt.MAP),w=v.layer.opacity,x=v.fullOpacity;if(c=c||wI(v.layer),LO(v)){let E=v.layer.blendMode!=="normal";if(LT(v.layer.parent)){const A=Bj(v.layer.parent);A!=null&&A!==""&&(E=iCe(v.layer.parent)||E)}E&&(d=E,l=!1)}if(w===0&&!d){p[m].pendingUpdates&=~(yt.TEXTURE_NOFADING&yt.TEXTURE_FADING);continue}++o;const T=vS(v),S=rz(e,m,T);if(S){if(p[m].pendingUpdates&=~(yt.TEXTURE_NOFADING&yt.TEXTURE_FADING),LT(v.layer.parent)){const E=Bj(v.layer.parent);E!=null&&E!==""&&rCe(v.layer.parent,m)}T?a=Math.max(a,this.tileSize*u):n===1&&x===1&&(v.isOpaque||this._dataToTexture(S)&&S.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++s,y===null&&(y=m)}}const _=a/this.tileSize;s!==0&&y!==null?s===1&&!d&&this._useLayerTexture(e,y)||this._composeMapLayers(e,i,m-1,c,a,_,!l||d,S5,d):this._useBackgroundTexture(e,o)}_ensureBackgroundTexture(e){return this._backgroundTexture==null&&(this._backgroundTexture=this._buildTexture(e,!1),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bind(e),this._passParameters.offset=Sg,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,this.backgroundColor!=null),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1),this._backgroundTexture}_useBackgroundTexture(e,i){const r=this._ensureBackgroundTexture(this.tileSize);let n=mg.Immediate;(e.surface.view.layerViewManager.updating||i>0)&&(n=mg.Delayed);const s=e.renderData;s.textureReference==null&&(n=mg.Immediate),s.setTextureReference(new Q8(r,ss.FADING,jae,e.surface.baseOpacity,0,1),n)}_useLayerTexture(e,i){const r=e.surface.layerViewByIndex(i,Vt.MAP),n=wI(r.layer),s=n?e.surface.baseOpacity:1,o=n?1:e.surface.baseOpacity,a=r.fullOpacity,l=rz(e,i,!1);return!!this._dataToTexture(l)&&(e.renderData.setTextureReference(new Q8(l.sourceLayerInfo.data,ss.FADING,l,s,o,a)),!0)}_composeMapLayers(e,i,r,n,s,o,a,l,c){this._composition.ensureBuffer(s);const u=e.surface.baseOpacity;let d=!1,p=Lt.LINEAR_MIPMAP_LINEAR,m=!1,y=0;for(let x=r;x>=0;x--){const T=e.surface.layerViewByIndex(x,Vt.MAP),S=vS(T),E=rz(e,x,S),A=T.layer.opacity;if(!E||A===0&&!c)continue;const P=!wI(T.layer)&&!d;P&&(d=!0);let N=!1;l.forEach(k=>{k.start===x&&(k.output=n?jn.Composite:a&&P?this.backgroundIsGrid?jn.GridComposite:jn.ColorComposite:jn.Composite,k.baseOpacity=P?u:1,Sx.push(k),this._composition.openGroup(s),N=!0)}),this._passParameters.baseOpacity=P&&!N&&u<1?u:1;const F=this._passParameters.baseOpacity<1?Jc.Required:Jc.NotRequired,D=y===0,$=N?jn.GroupBackgroundComposite:a&&D?this.backgroundIsGrid?jn.GridComposite:jn.ColorComposite:jn.Composite,R=Pj[LO(T)?T.layer.blendMode:"normal"];for(this._passParameters.opacity=A,kut(E)?m=this._composition.drawVectorData(this._passParameters,$,s,R,F,E,o,this.tileSize,m):Fut(E)?(this._composition.drawImageryTileData(this._passParameters,$,s,R,F,E),this._hasNearestInterpolation(E)&&(p=Lt.NEAREST)):this._dataToTexture(E)&&(this._passParameters.texture=E.sourceLayerInfo.data.texture,this._passParameters.offset=E.offset,this._passParameters.scale=E.scale,this._composition.drawRasterData(this._passParameters,$,s,R,F));Sx.length>0&&Sx[Sx.length-1].end===x;){const k=Sx.pop();this._passParameters.baseOpacity=k.baseOpacity;const B=this._passParameters.baseOpacity<1?Jc.Required:Jc.NotRequired;this._passParameters.opacity=k.opacity,this._passParameters.offset=Sg,this._passParameters.scale=1,this._composition.drawGroup(this._passParameters,k.output,s,Pj[k.blendMode],B)}y++}const _=e.renderData,v=c||d&&u<1,w=_.ensureTexture(s,v,()=>this._buildTexture(s,v,p));this._composition.copyFBOToTexture(w),this._composition.unbind(),_.setTextureReference(new Q8(w,i,jae,d?1:u,0,1))}_hasNearestInterpolation(e){const i=e.sourceLayerInfo.data;return!!i.source&&i.interpolation==="nearest"}_dataToTexture(e){if(zut(e)){const i=e.sourceLayerInfo;i.data=this._buildTexture(i.data,!0),e.tile.setMemoryDirty()}return Uut(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,i,r=Lt.LINEAR_MIPMAP_LINEAR){if(e==null)return null;const n=new Li;n.wrapMode=Nt.CLAMP_TO_EDGE,n.samplingMode=r,n.maxAnisotropy=this._maxAnisotropy,n.preMultiplyAlpha=!0,n.flipped=!0,n.hasMipmap=!0,i||(n.pixelFormat=pt.RGB);const s=this._rctx;let o;if(typeof e=="number"){n.width=n.height=e;const l=`${e} ${n.pixelFormat}`;o=this._cache.pop(l),o?o.retain():o=new CA(new Pt(s,n),this._cache)}else if(_ut(e)){n.isOpaque=e.isOpaque,n.isOpaque&&(n.pixelFormat=pt.RGB);const l=`${e} ${n.pixelFormat}`;o=this._cache.pop(l),o?(o.retain(),o.texture.setData(e.image)):o=new CA(new Pt(s,n,e.image),this._cache),e.release()}else try{n.width=e.width,n.height=e.height,o=new CA(new Pt(s,n,e))}catch{o=new CA(bve(s)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const a=s.bindTexture(o.texture,Pt.TEXTURE_UNIT_FOR_UPDATES);return o.generateMipmap(),s.bindTexture(a,Pt.TEXTURE_UNIT_FOR_UPDATES),o}get test(){return{backgroundTexture:this._backgroundTexture}}};function rz(t,e,i){Bo.layerIndex=e,Bo.vtlNeighborInfos.clear();const r=t.layerInfo[Vt.MAP][e];if(si(Bo.offset,0,0),Bo.tile=t,Bo.scale=1,Bo.sourceLod=t.lij,Bo.sourceLayerInfo=r,Bo.isVTLBackground=i,r.data)return i&&t.forEachLoadedNeighbor((s,o)=>{if(s.level!==t.level)return;const a=s.layerInfo[Vt.MAP][e];if(!rEe(a)||r.data===a.data)return;const l=Bo.vtlNeighborInfos.pushNew();l.offset=Fm[o],l.sourceLod=s.lij,l.sourceLayerInfo=a}),Bo;const n=r.upsampleInfo;if(n){const s=n.tile.layerInfo[Vt.MAP][e];return Bo.tile=n.tile,Yn(Bo.offset,n.offset),Bo.scale=n.scale,Bo.sourceLod=n.tile.lij,Bo.sourceLayerInfo=s,Bo}return i?Bo:null}function Bj(t){return t.uid}function iCe(t){let e=t.blendMode!=="normal";return LT(t.parent)&&(e=iCe(t.parent)||e),e}function rCe(t,e){LT(t.parent)&&rCe(t.parent,e);const i=Bj(t);if(i!=null&&i!==""){const r=S5.get(i);r?r.start=e:S5.set(i,new fft(e,e,t.blendMode,t.opacity,jn.Composite,1))}}const S5=new Map,Sx=new Array,Bo=new dft,jae={offset:[0,0],scale:1},Fm=new Array;Fm[rt.NORTH]=[0,-1],Fm[rt.NORTH_EAST]=[-1,-1],Fm[rt.EAST]=[-1,0],Fm[rt.SOUTH_EAST]=[-1,1],Fm[rt.SOUTH]=[0,1],Fm[rt.SOUTH_WEST]=[1,1],Fm[rt.WEST]=[1,0],Fm[rt.NORTH_WEST]=[1,-1];const nCe=200,nz=40,gft=.8,yft=10,OA=1e-6;function _ft(t,e,i){const r=e,n=i;let s=0,o=1/0;for(let a=0;a<3;++a){{const l=t[a];if(r[a]<l){if(n[a]<=OA)return!1;const c=(l-r[a])/n[a];s=Math.max(s,c)}else if(n[a]<=-OA){const c=(l-r[a])/n[a];o=Math.min(o,c)}if(s>o)return!1}{const l=t[a+3];if(r[a]>l){if(n[a]>=-OA)return!1;const c=(l-r[a])/n[a];s=Math.max(s,c)}else if(n[a]>=OA){const c=(l-r[a])/n[a];o=Math.min(o,c)}if(s>o)return!1}}return!0}let Hae=class{constructor(e,i,r,n,s){this.aabb=e,this.axis=i,this.d=r,this.midStartIndex=n,this.rightStartIndex=s}},FZ=class Vj{constructor(e,i,r,n){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=i,this.positions=n,this._rayDirection=C(),this.bspNodeTree=new Array;const s=r-i,o=s<=sCe?new Uint16Array(s):new Uint32Array(s);this.indices=o;for(let a=0;a<s;++a)o[a]=a;{const a=Tft(e,i,r,n.data,n.stride),l=_e(Math.log2(s/nz),2,yft),c=(u,d,p)=>{const m=wft(o,a,u,d),y=d-u;if(y<=nz){const S=new Hae(m,void 0,0,u,d);return this.bspNodeTree.push(S),S}const{axis:_,midValue:v}=xft(m),w=bft(o,a,u,d,_,v),x=(S,E)=>{if(p>l)return;const A=E-S;return A<nz||A>=gft*y?void 0:c(S,E,p+1)},T=new Hae(m,_,v,w.next,w.mid);return this.bspNodeTree.push(T),T.leftNode=x(u,w.next),T.rightNode=x(w.mid,d),T};c(0,s,0),this.triangleVertexIndices=Sft(o,e,i,r)}}intersectRayTriangleRange(e,i){{if(e>=i)return;const r=this.triangleVertexIndices,n=this.positions.data,s=this.positions.stride,o=this._rayOrigin,a=o[0],l=o[1],c=o[2],u=this._rayDirection,d=u[0],p=u[1],m=u[2];for(let y=e,_=3*e;y<i;++y){let v=r[_++]*s;const w=n[v++],x=n[v++],T=n[v];v=r[_++]*s;const S=n[v++],E=n[v++],A=n[v];v=r[_++]*s;const P=S-w,N=E-x,F=A-T,D=n[v++]-w,$=n[v++]-x,R=n[v]-T,k=p*R-$*m,B=m*D-R*d,j=d*$-D*p,X=P*k+N*B+F*j;if(Math.abs(X)<=Number.EPSILON)continue;const M=a-w,I=l-x,G=c-T,q=M*k+I*B+G*j;if(X>0){if(q<0||q>X)continue}else if(q>0||q<X)continue;const Z=I*F-N*G,K=G*P-F*M,Q=M*N-P*I,de=d*Z+p*K+m*Q;if(X>0){if(de<0||q+de>X)continue}else if(de>0||q+de<X)continue;const Ae=(D*Z+$*K+R*Q)/X;if(Ae>=0){const st=this.indices[y]+this.firstTriangleIndex,vt=aX(P,N,F,D,$,R,vft);this._callback(Ae,vt,st,!1)}}}Vj.numFacesTested+=i-e}intersectRay(e,i){Vj.numFacesTested=0;const r=Ce(e.r0[0],e.r0[1],e.r0[2]),n=Ce(e.r1[0],e.r1[1],e.r1[2]),s=n[0]-r[0],o=n[1]-r[1],a=n[2]-r[2];if(s*s+o*o+a*a<OA)return;this._rayOrigin=r;const l=this._rayDirection;l[0]=s,l[1]=o,l[2]=a;const c=this.triangleVertexIndices.length/3;this._callback=i;const u=this.bspNodeTree[0];this.intersectRayBSP(u,0,c)}intersectRayBSP(e,i,r){const n=this._rayOrigin,s=this._rayDirection;if(!_ft(e.aabb,n,s))return;const o=e.axis,a=e.d;if(n[o]<a||s[o]<0){const l=i,c=e.midStartIndex;if(l<c){const u=e.leftNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),n[o]>a||s[o]>0){const l=e.rightStartIndex,c=r;if(l<c){const u=e.rightNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}};FZ.numFacesTested=0;const vft=C(),Ex=[1/0,1/0,1/0],Cx=[-1/0,-1/0,-1/0];function bft(t,e,i,r,n,s){let o=i,a=r;for(;o<a;){const c=t[o];e[6*c+n+3]<=s?++o:(--a,t[o]=t[a],t[a]=c)}let l=o;for(a=r;l<a;){const c=t[a-1];e[6*c+n]>=s?--a:(t[a-1]=t[l],t[l]=c,++l)}return{next:o,mid:l}}function wft(t,e,i,r){if(r<=i)return $b(NaN,NaN,NaN,NaN,NaN,NaN);{const n=6*t[i];for(let s=0;s<3;++s)Ex[s]=e[n+0+s],Cx[s]=e[n+3+s]}for(let n=i+1;n<r;++n){const s=6*t[n];for(let o=0;o<3;++o)Ex[o]=Math.min(Ex[o],e[s+0+o]),Cx[o]=Math.max(Cx[o],e[s+3+o])}return $b(Ex[0],Ex[1],Ex[2],Cx[0],Cx[1],Cx[2])}function xft(t){const e=t[3]-t[0],i=t[4]-t[1],r=t[5]-t[2],n=e>i?e>r?0:i>r?1:2:i>r?1:r>e?2:0;return{axis:n,midValue:(t[n]+t[n+3])/2}}function Tft(t,e,i,r,n){const s=i-e,o=new Float32Array(6*s);for(let a=0;a<s;++a){const l=3*(a+e),c=t[l]*n,u=t[l+1]*n,d=t[l+2]*n;for(let p=0;p<3;++p){const m=r[c+p],y=r[u+p],_=r[d+p];o[6*a+p]=Math.min(m,y,_),o[6*a+3+p]=Math.max(m,y,_)}}return o}function Sft(t,e,i,r){const n=r-i;let s=0;for(let a=i;a<r;++a)for(let l=0;l<3;++l)s=Math.max(e[3*a+l],s);const o=s<=sCe?new Uint16Array(3*n):new Uint32Array(3*n);for(let a=0;a<n;++a){const l=3*(t[a]+i);for(let c=0;c<3;++c){const u=e[l+c];o[3*a+c]=u}}return o}const sCe=65535;let An=class extends Ua{constructor(){super(...arguments),this.output=U.Color,this.overlayMode=gf.Disabled,this.tileBlendInput=yf.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.invisible=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=it.Terrain}};h([V({count:U.COUNT})],An.prototype,"output",void 0),h([V({count:gf.COUNT})],An.prototype,"overlayMode",void 0),h([V({count:yf.COUNT})],An.prototype,"tileBlendInput",void 0),h([V()],An.prototype,"spherical",void 0),h([V()],An.prototype,"doublePrecisionRequiresObfuscation",void 0),h([V()],An.prototype,"receiveShadows",void 0),h([V()],An.prototype,"hasSlicePlane",void 0),h([V()],An.prototype,"backfaceCullingEnabled",void 0),h([V()],An.prototype,"textureFadingEnabled",void 0),h([V()],An.prototype,"renderOccluded",void 0),h([V()],An.prototype,"hasScreenSpaceReflections",void 0),h([V()],An.prototype,"hasCloudsReflections",void 0),h([V()],An.prototype,"invisible",void 0),h([V()],An.prototype,"tileBorders",void 0),h([V()],An.prototype,"visualizeNormals",void 0),h([V()],An.prototype,"screenSizePerspective",void 0),h([V()],An.prototype,"receiveAmbientOcclusion",void 0),h([V({count:it.COUNT})],An.prototype,"pbrMode",void 0),h([V({constValue:Ei.Compressed})],An.prototype,"normalType",void 0),h([V({constValue:In.Compressed})],An.prototype,"textureCoordinateType",void 0),h([V({constValue:!1})],An.prototype,"highStepCount",void 0),h([V({constValue:!1})],An.prototype,"useCustomDTRExponentForWater",void 0),h([V({constValue:!1})],An.prototype,"useFillLights",void 0),h([V({constValue:!0})],An.prototype,"hasColorTexture",void 0);const sz=7,Eft=10,oz=ds();var $a;(function(t){t[t.Opaque=0]="Opaque",t[t.Semitransparent=1]="Semitransparent",t[t.TransparentWithDraped=2]="TransparentWithDraped",t[t.Empty=3]="Empty"})($a||($a={}));let ld=class extends B1e{get _isGlobal(){return this._stage.viewingMode===Me.Global}get _techniques(){return this._context.techniqueRepository}get _rctx(){return this._context.renderContext.rctx}constructor(e,i,r,n,s){super({}),this._overlayRenderer=e,this._stage=i,this._allTiles=r,this._ellipsoidRadius=n,this.type=Ur.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new An,this._passParameters=new xEe,this._renderDataPool=new aa(Fdt),this._visiblePatchesByOrigin=new Map,this._allPatchesByOrigin=new Map,this._patchesByOriginDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new fEe,this._transparencyState=$a.Opaque,this._castShadows=!1,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.renderOccludedFlags=Pr.Occlude,this.produces=new Map([[ae.OPAQUE_TERRAIN,()=>this._produces()],[ae.TRANSPARENT_TERRAIN,()=>this._produces()],[ae.OCCLUDED_TERRAIN,()=>this._produces()]]),this._tileTextureCache=new SR((o,a)=>s.newCache(o,a),"TileTexture"),this.tileGeometryCache=new spt(s)}normalizeCtorArgs(){return{}}initialize(){this._stage.addRenderPlugin(this)}destroy(){this._stage.removeRenderPlugin(this),this._tileTextureCache.destroy(),this.tileGeometryCache.destroy()}_produces(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}consumes(){return this._overlayRenderer.hasWater?k1e:kF}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set visible(e){this._set("visible",!!e),this.setDirty()}set transparency(e){this._transparencyState!==e&&(this._techniqueConfiguration.invisible=e===$a.TransparentWithDraped||e===$a.Empty,this._transparencyState=e,this.setNeedsRender())}get transparency(){return this._transparencyState}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(e){this._techniqueConfiguration.visualizeNormals!==e&&(this._techniqueConfiguration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}get layerUid(){return wy}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._techniqueConfiguration.pbrMode!==e&&(this._techniqueConfiguration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?c5:Pr.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}setTileSize(e){this._tileSize=e,this._tileRenderer!=null&&(this._tileRenderer.tileSize=e),this.setDirty()}_prepareTileForLoading(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometryState(e),this.updateTileTexture(e,yt.TEXTURE_FADING)}updateTileTexture(e,i){this._tileRenderer!=null&&(this._tileRenderer.updateTileTexture(e,i===yt.TEXTURE_FADING?ss.FADING:ss.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(i))}updateTileGeometryState(e){for(const r of e.layerInfo[Vt.ELEVATION])r.pendingUpdates&=~yt.GEOMETRY;e.resetPendingUpdate(yt.GEOMETRY);const i=e.renderData.updateGeometryState();return i&&this.setDirty(),i}updateGeometryIfNeeded(e){e.isLoaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const i=e.renderData;i&&(i.releaseGeometry(),this._renderDataPool.release(i),i.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const i=Eft-sz,r=Math.max(0,Math.floor((e.level-i)/sz)*sz);if(this._isGlobal&&r===0)return Gs;for(;e.parent&&e.level>r;)e=e.parent;return e.centerAtSeaLevel}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=_n.UPDATE){this._patchesByOriginDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=_n.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=_n.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._tileRenderer=new mft(this._rctx,this._tileSize,this._techniques,this._tileTextureCache),this.updateTileBackground(),this._emptyTex=bve(this._rctx)}uninitializeRenderContext(){this._emptyTex=et(this._emptyTex),this._tileRenderer=et(this._tileRenderer)}intersect(e,i,r,n){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==$a.Opaque)return;const s=Cft,o=Aft;he(s,n,r),oe(o,1/s[0],1/s[1],1/s[2]);const a=e.results.min,l=e.results.max,c=e.results.ground,u=e.options.store===ho.MIN,d=!!e.results.ground.target,p=a9e(e.verticalOffset),m=e.tolerance;let y,_=u&&a.dist!=null?a.dist:1/0;const v=x=>{const T=x.renderData;if(!T?.vao)return;const S=T.geometry;Z4(oz,S.boundingBox);const E=T.localOrigin;p!=null&&(p.localOrigin=E,p.applyToAabb(oz));const A=oz;if(Ax[0]=r[0]-E[0],Ax[1]=r[1]-E[1],Ax[2]=r[2]-E[2],!cX(A,Ax,o,m,_))return;const P=(j,X,M)=>{j.set(this.type,x,X,M,zr),_=u&&a.dist!=null?a.dist:1/0},N=(j,X)=>{if(X!=null&&j>=0&&(e.options.backfacesTerrain||me(X,s)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||i==null||i(r,n,j))){if((c.dist==null||j<c.dist)&&P(c,j,X),e.options.isFiltered)return;e.options.store===ho.ALL&&(y==null?(y=KW(e.ray),P(y,j,X),e.results.all.push(y)):j<y.dist&&P(y,j,X)),(a.dist==null||j<a.dist)&&P(a,j,X),e.options.store!==ho.MIN&&(l.dist==null||j>l.dist)&&P(l,j,X)}},F=Oft;he(F,n,E);const D=S.indices,$=S.vertexAttributes,R=$.getField(O.POSITION,ws),k=new TR(R.typedBuffer,3,$.stride/4),B=S.indexCount/3;if(!p&&B>nCe){const j=x.renderData;j.intersectionData==null&&(j.intersectionData=new FZ(D,0,B,k)),j.intersectionData.intersectRay({r0:Ax,r1:F},N)}else LR(Ax,F,0,B,D,k,null,p,N)},w=this._rootTiles;w!=null&&(()=>{const x=this._tileIterator;x.reset(w);const T=e.options.invisibleTerrain;for(let S=x.next();S;S=x.next())!(S.visible||T&&S.intersectsClippingArea)||p==null&&!S.intersectsRay(r,s,m,_)||d&&this._useStencilForTile(S)?x.skipSubtree():v(S)})()}processScaleRangeQueries(e,i){if(!i.done)for(this._updatePatchGroups();e.updating&&!i.done;){e.prepare();for(const r of this._visiblePatchesByOrigin.values())for(const n of r)n.renderData?.textureReference!=null&&e.queriesForTile(n);e.process(),i.madeProgress()}}prepareTechnique(e){const i=ie("enable-feature:terrain-shadows")&&e.bindParameters.shadowMap.enabled;if(i!==this._castShadows&&(this._castShadows=i,this._patchesByOriginDirty=!0),e.bindParameters.slot===ae.OCCLUDED_TERRAIN){if(!(e.renderOccludedMask&c5))return null}else{const r=this.transparency===$a.Opaque?ae.OPAQUE_TERRAIN:ae.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==r)return null}if(this.transparency===$a.Empty)return null;switch(e.output){case U.Color:return this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.lastFrameColor!=null,this._techniqueConfiguration.hasCloudsReflections=e.bindParameters.cloudsFade.data!=null,this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssao!=null,this._techniqueConfiguration.overlayMode=this._overlayRenderer.mode,this._updateTechnique(U.Color,e.bindParameters.slot===ae.OCCLUDED_TERRAIN);case U.Shadow:case U.ShadowExcludeHighlight:return this._castShadows?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(U.Shadow,!1)):null;case U.Depth:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(U.Depth,!1);case U.Normal:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(U.Normal,!1);case U.ObjectAndLayerIdColor:return this._updateTechnique(U.ObjectAndLayerIdColor,!1);case U.Highlight:return this._overlayRenderer.hasHighlights?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(U.Highlight,!1)):null}return null}renderNode(e,i){switch(this._updatePatchGroups(),i.useStencil=!1,e.output){case U.Color:{const r=e.bindParameters.slot===ae.OCCLUDED_TERRAIN?$r.Occluded:$r.Color;this._renderMaterialPass(e,i,r);break}case U.Depth:case U.Normal:this._renderAuxiliaryPass(e,i,$r.Color,this._visiblePatchesByOrigin);break;case U.Highlight:this._renderAuxiliaryPass(e,i,$r.Highlight,this._visiblePatchesByOrigin);break;case U.Shadow:case U.ShadowExcludeHighlight:this._renderAuxiliaryPass(e,i,null,this._allPatchesByOrigin);break;case U.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,i,$r.ObjectAndLayerIdColor,this._visiblePatchesByOrigin)}}updateTileBackground(e){if(this._tileRenderer==null)return;const i=this._tileRenderer;let r;if(e!=null){const n=Ye.toUnitRGBA(e);r=Ce(n[0]||0,n[1]||0,n[2]||0)}i.setBackground(r),this._allTiles.forAll(n=>i.updateTileTexture(n,ss.FADING)),this._techniqueConfiguration.tileBlendInput=i.backgroundIsGrid?yf.GridComposite:i.backgroundColor!=null?yf.ColorComposite:yf.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchesByOriginDirty&&(this._rebuildPatchGroups(),this._patchesByOriginDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==bS.NONE){const e=Array.from(this._visiblePatchesByOrigin.values()),i=this._stencilEnabledLayerExtents;for(const r of e)mEe(this.renderOrder,r,i);e.sort((r,n)=>gEe(r[0],n[0],this.renderOrder)),this._visiblePatchesByOrigin=new Map(e.map(r=>[r[0].renderData.localOrigin,r])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){const e=this._rootTiles;if(e!=null){e[0]?.surface.checkAllTilesWaterproofness(),this._visiblePatchesByOrigin.clear(),this._allPatchesByOrigin.clear();for(const i of e)this._rebuildPatchGroupsForRootTile(i)}}_rebuildPatchGroupsForRootTile(e){const i=this._tileIterator;for(i.resetOne(e);!i.done;){const r=i.next(),n=r.renderData;if(!n){this._numTilesCulled++;continue}const s=n.localOrigin;if(this._castShadows){let a=this._allPatchesByOrigin.get(s);a||(a=new Array,this._allPatchesByOrigin.set(s,a)),a.push(r)}if(!r.visible){this._numTilesCulled++,i.skipSubtree();continue}let o=this._visiblePatchesByOrigin.get(s);o||(o=new Array,this._visiblePatchesByOrigin.set(s,o)),o.push(r),i.skipSubtree()}}_useStencilForTile(e){for(const i of this._stencilEnabledLayerExtents)if(e.intersectsExtent(i))return!0;return!1}_renderAuxiliaryPass(e,i,r,n){const s=e.rctx;this._passParameters.overlayContent=r,s.bindTechnique(i,this._passParameters,e.bindParameters);const o=this._stencilEnabledLayerExtents.length>0;n.forEach(a=>{const l=a[0].renderData.localOrigin;i.program.bindDraw(new uj(l),e.bindParameters,this._passParameters);for(let c=0;c<a.length;c++)this._renderPatch(e,i,a[c],Qt.TRIANGLES,o,r)}),e.rctx.bindVAO(null)}_renderMaterialPass(e,i,r){const{rctx:n}=e;this._passParameters.overlayContent=r,n.bindTechnique(i,this._passParameters,e.bindParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0;const s=e.bindParameters.camera,o=i.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const p=Ube(this._stage.viewingMode,this._ellipsoidRadius),m=this.pointsOfInterest.centerOnSurfaceFrequent.distance;p.update({distance:m,fovY:s.fovY})}const a=this._stencilEnabledLayerExtents.length>0,l=r===$r.Occluded;l&&(o.bindTexture("tex",this._emptyTex),o.setUniform3fv("textureOpacities",Gs),o.setUniform4fv("texOffsetAndScale",ru));const c=this._tileRenderer?.backgroundColor!=null?this._tileRenderer.backgroundColor:Gs;this._techniqueConfiguration.tileBlendInput===yf.ColorComposite&&o.setUniform3fv("backgroundColor",c);const u=this.wireframe?Qt.LINES:Qt.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&o.bindTexture("texNext",this._emptyTex);const d=this._visiblePatchesByOrigin;for(const p of d.values()){const m=p[0].renderData.localOrigin;i.program.bindDraw(new uj(m),e.bindParameters,this._passParameters),this._numOriginsRendered++;for(const y of p){const _=y.renderData,v=_.textureReference;if(v!=null){if(!l){o.setUniform4fv("texOffsetAndScale",v.offsetAndScale),o.bindTexture("tex",v.texture.texture);const w=_.textureFadeFactor,x=w<1?_.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&x!=null&&w<1?(o.setUniform1f("fadeFactor",w),o.setUniform4fv("nextTexOffsetAndScale",x.offsetAndScale),o.setUniform3fv("nextTexOpacities",x.opacities),o.bindTexture("texNext",x.texture.texture)):o.setUniform1f("fadeFactor",1),_.textureIsFading&&this.setNeedsRender(),o.setUniform3fv("textureOpacities",v.opacities)}this._renderPatch(e,i,y,u,a,r),y.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,i,r,n,s,o){const a=r.renderData,l=a.vao,c=l?.indexBuffer;if(c==null)return void(us&&console.error("Rendered tile with no indices: ",r.lij," : ",a));const u=i.program;o==null||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(u,a.overlay),s&&(i.useStencil=this._useStencilForTile(r),e.rctx.setPipelineState(i.getPipeline()));const d=a.geometry.indexCount;e.rctx.bindVAO(l),u.assertCompatibleVertexAttributeLocations(l),e.rctx.drawElements(n,d,c.indexType,0)}_bindOverlayPatchData(e,i){e.setUniform4fv("overlayTexOffset",i.offsets),e.setUniform4fv("overlayTexScale",i.scales)}_updateTechnique(e,i){return this._techniqueConfiguration.output=e,this._techniqueConfiguration.renderOccluded=i,this._shaderTechnique=this._techniques.releaseAndAcquire(TEe,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this._tileRenderer}}};h([f({readOnly:!0})],ld.prototype,"_isGlobal",null),h([f({value:!1})],ld.prototype,"renderingDisabled",null),h([f({value:!0})],ld.prototype,"visible",null),h([f()],ld.prototype,"renderPatchBorders",null),h([f()],ld.prototype,"visualizeNormals",null),h([f()],ld.prototype,"cullBackFaces",null),h([f({value:bS.FRONT_TO_BACK})],ld.prototype,"renderOrder",null),h([f()],ld.prototype,"wireframe",null),ld=h([z("esri.views.3d.terrain.TerrainRenderer")],ld);const Cft=C(),Aft=C(),Ax=C(),Oft=C();let Rft=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},Zp=class extends xe{constructor(e){super(e)}initialize(){this.addHandles([this.layers.on("change",()=>this._update()),le(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())]),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._waitTask=null,this.layers.destroy()}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(i=>!(!GA(i)||i.isRejected())&&!(i.isFulfilled()&&!Pft(i,this.viewSpatialReference,this.viewingMode))&&(e=i,!(i?.type==="vector-tile"||v5(i)))),e)if(e.isResolved()){const i=_k(e,this.viewSpatialReference,this.viewingMode);if(i!=null){const r=new ql(i.tileInfo);this._lockTilingScheme(r)}}else this._updateWhen(e)}_updateWhen(e){const i=e.when().catch(()=>{}).then(()=>{i!==this._waitTask||this.destroyed||this._update()});this._waitTask=i}_lockTilingScheme(e){if(this.viewingMode===Me.Global){const i=e.levels.length-1;e.spatialReference.isWebMercator?e=ql.makeWebMercatorAuxiliarySphere(i):n_(e.spatialReference)&&(e=ql.makeGCSWithTileSize(e.spatialReference,e.pixelSize,i))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this.removeAllHandles(),this.addHandles(le(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===Me.Global){const e=this.extentHelper.viewSpatialReference,i=n_(e)||Vf(e)||Gf(e);e.isWebMercator?this.tilingScheme=ql.WebMercatorAuxiliarySphere:i&&(this.tilingScheme=ql.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;e==null||Z1(e,this.extent)||(this.tilingScheme=ql.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function Pft(t,e,i){return _k(t,e,i)!=null}h([f()],Zp.prototype,"tilingScheme",void 0),h([f({readOnly:!0})],Zp.prototype,"extent",void 0),h([f({value:!1})],Zp.prototype,"tilingSchemeLocked",void 0),h([f({constructOnly:!0})],Zp.prototype,"viewSpatialReference",void 0),h([f({constructOnly:!0})],Zp.prototype,"layers",void 0),h([f({constructOnly:!0})],Zp.prototype,"extentHelper",void 0),h([f({constructOnly:!0})],Zp.prototype,"viewingMode",void 0),Zp=h([z("esri.views.3d.terrain.TilingSchemeLogic")],Zp);let Mft=class{constructor(){this.offset=Ue(),this.scale=0,this.tile=null}init(e,i,r,n){this.tile=e,this.offset[0]=i,this.offset[1]=r,this.scale=n}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}};var QL;let kt=QL=class extends Tn.EventedMixin(xe){constructor(t){super(t),this._scaleRangeQueries=new JL,this._iteratorPool=new aa(fEe,e=>e.remove=()=>this._iteratorPool.release(e)),this._postorderIterator=new Wht,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._usedMemory=null,this._performanceInfo=new Rft,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=C(),this._eyePosSurfaceSR=C(),this._splitLimits=new ad,this._frustum=gO(),this._viewProjectionMatrix=be(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._watchUpdatingTracking=new Ud,this._frameTask=WT,this._allTiles=new It,this._upsampleInfoPool=new aa(Mft),this._shouldEmitChangeEvent=!1,this._rootTilesExtent=Gt(),this.updatingProgress=.5,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=je.WebMercator,this.visibleElevationBounds=new J2(1/0,-1/0),this.rootTileElevationBounds=new J2(1/0,-1/0),this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._isWebMercator=!1,this._isWebMercatorOnPlateeCarree=!1,this.overlayManager=new rl({...t,surface:this}),this._isGlobal=!t.view?.state?.isLocal,this._tileConstructor=this._isGlobal?ipt:Qdt}initialize(){const t=this.view,e=t.resourceController;this._lercDecoder=wht(e);const i=e.memoryController;this._tileCache=new SR((l,c)=>i.newCache(l,c),"terrain-tile"),this._upsampleMapCache=i.newCache("terrain-upsample",l=>l.unloadMapData()),this._elevationQueryCache=new vht(i.newCache("elevation-query"));const r=this.overlayManager;this._renderer=new ld(r.renderer,t._stage,this._allTiles,Fi(t.spatialReference).radius,i),this.addHandles([le(()=>r.rendersOccluded,l=>this._renderer.setRenderOccludedOverlay(l)),le(()=>r.renderer.isEmpty,()=>this._evaluateTransparency()),le(()=>this.renderer.visible,l=>this.suspended=!l)],"overlayManager"),this.addHandles([le(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?ss.UNFADED:ss.IMMEDIATE)},Yi),le(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?ss.UNFADED:ss.IMMEDIATE),Yi),le(()=>this.backgroundColor,(l,c)=>{l?.equals(c)||(this._handleLayerViewChanges(),this._renderer.updateTileBackground(l))},qi),le(()=>this.snapLevel,()=>this._viewChanged=!0,qi),le(()=>this.view.pointsOfInterest,l=>{this._renderer.pointsOfInterest=l,this._watchUpdatingTracking.removeAll(),l&&this._watchUpdatingTracking.add(()=>l.focus.renderLocation,()=>this._allTilesSorted=!1)}),le(()=>nr.TERRAIN_TILE_TREE_SHOW_TILES,l=>{l&&!this._treeDebugger?pe(()=>import("./TerrainTileTree3DDebugger-cee75d51.js"),["./TerrainTileTree3DDebugger-cee75d51.js","./TileTreeDebugger-ee20aa0c.js"],import.meta.url).then(({TerrainTileTree3DDebugger:c})=>{!this._treeDebugger&&nr.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new c({view:t}))}):l||(this._treeDebugger=Pe(this._treeDebugger))},Zi)]);const{spatialReference:n}=t;this._extentHelper=Nht(this.viewingMode,{layers:t.map.allLayers,layerViews:t.allLayerViews,viewSpatialReference:n});const s=new J3({getCollections:()=>t.defaultsFromMap?.mapCollections?.map(({layers:l})=>l),getChildrenFunction:l=>l&&"layers"in l?l.layers:null}),o=new Zp({layers:s,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:n});this._set("tilingSchemeLogic",o),this._updateTilingScheme(),this._elevationDataRequester=e.createStreamDataRequester(df.ELEVATION),this._mapDataRequester=e.createStreamDataRequester(df.BASEMAP);const a=e.scheduler;this._frameTask=a.registerTask(ut.TERRAIN_SURFACE,this),this.addHandles([le(()=>this._extentHelper.stencilEnabledExtents,l=>this._renderer.setStencilEnabledLayerExtents(l),Zi),le(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),qi),le(()=>this.extent,()=>this._updateRootTiles(),Zi),t.on("resize",()=>this._viewChangeUpdate()),le(()=>{const l=t.state;return[this._lodBias,this.lodSnapping,t.quality,l.camera,l.contentCamera,l.fixedContentCamera]},()=>this._viewChangeUpdate(),Yi),le(()=>t.qualitySettings?.tiledSurface?.textureFadeDuration,l=>this._renderer.textureFadingEnabled=l>0,Zi),le(()=>t.qualitySettings?.physicallyBasedRenderingEnabled,l=>this._renderer.pbrMode=l?it.Terrain:it.Disabled,Zi),le(()=>this._userClippingExtent,()=>this._updateClippingExtent(),qi)]),this.addHandles(t.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges(),this._renderer.updateTileBackground(this.backgroundColor)}destroy(){this._frameTask.remove(),this._watchUpdatingTracking.destroy(),this._lercDecoder=Jt(this._lercDecoder),this._removeAllTiles(),this._set("tilingSchemeLogic",Pe(this.tilingSchemeLogic)),this._basemapLayerViewHandles.forEach((t,e)=>this._unregisterTiledLayerView(e)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",Pe(this.overlayManager)),this._tileCache=Pe(this._tileCache),AZ.prune(),this._treeDebugger=Pe(this._treeDebugger),this._renderer=Pe(this._renderer),this._iteratorPool=Pe(this._iteratorPool),this._upsampleMapCache=Pe(this._upsampleMapCache),this._elevationQueryCache=Pe(this._elevationQueryCache),this._set("view",null),this._extentHelper=Pe(this._extentHelper),this._upsampleInfoPool=Pe(this._upsampleInfoPool),Mht(),xdt()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){if(this.lodSnapping===_3.ON){const t=this.view,e=this.tilingScheme,i=t.pointsOfInterest?.cameraOnSurface?.scale;if(e&&i){const r=t.state.contentCamera;let n=TF(t,r.eye,r.viewForward,r.up).tilt;n>90&&(n=180-n);const s=2*(n/90)**2,o=e.levelAtScale(i)-s,a=Math.min(o+t.qualitySettings.tiledSurface.lodBias,this._splitLimits.maxLod||1/0);return a<=0?null:a}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?_3.ON:_3.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:t}=this,{clippingArea:e}=this.view;if(e==null||t==null)return null;const i=Gt(),r=GSe(e,i,t)?i:null,n=this._get("extent");return Z1(r,n)?n:r}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const t=qB(this.groundExtent,this._userClippingExtent,Gt()),e=this._get("extent");return Z1(t,e)?e:t}get groundExtent(){return this._tilingSchemeExtent!=null?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){return this.tilingSchemeLogic?.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||this._watchUpdatingTracking?.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||this.overlayManager?.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){return this.view?.map?.ground?.opacity??1}set baseOpacity(t){this.view.map.ground.opacity=t}get viewingMode(){return this.view.state.viewingMode}get ready(){return this._rootTiles!=null}set renderOrder(t){this._renderer.renderOrder=t,this._set("renderOrder",t)}get rootTiles(){return this._rootTiles}get spatialReference(){return this.tilingScheme?.spatialReference??null}get backgroundColor(){return this.view?.map?.ground?.surfaceColor}set backgroundColor(t){this.view.map.ground.surfaceColor=t}set slicePlaneEnabled(t){this._renderer.slicePlaneEnabled=t,this._set("slicePlaneEnabled",t),this._evaluateTransparency()}get tilingSchemeLocked(){return this.tilingSchemeLogic?.tilingSchemeLocked??!1}get wireframe(){return this._renderer?.wireframe}set wireframe(t){t!==this._renderer.wireframe&&(this._renderer.wireframe=t,this._updateAllTileGeometries())}get opaque(){return this._renderer.transparency===$a.Opaque}set suspended(t){this._set("suspended",t),this._viewChangeUpdate()}get textureFadeDuration(){return this.view.qualitySettings.tiledSurface.textureFadeDuration??0}intersect(t,e,i,r){this._renderer.intersect(t,e,i,r)}getElevation(t,e,i,r){const n=this._rootTiles;if(!n?.length||n[0].layerInfo[Vt.ELEVATION].length===0)return null;const s=Ka;return s[0]=t,s[1]=e,s[2]=i,Do(s,r,s,this._spatialReference)?Wae(n,s[0],s[1]):(ne.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null)}getElevations(t,e,i){const r=this._rootTiles,n=r?r[0].layerInfo[Vt.ELEVATION].length:0;if(r?.length&&n!==0)for(let s=0;s<e;++s){const o=3*s;i(s,Wae(r,t[o],t[o+1]))}else for(let s=0;s<e;++s)i(s,null)}getScale(t){if(!this.tilingScheme)return null;if(!lc(t,Ka,this.spatialReference))return ne.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const e=this._rootTiles;if(e!=null){for(const i of e)if(i?.containsPoint(Ka)){let r=i;for(;r.children[0]&&!r.rendered;){const n=r.children[0].extent;let s=0;Ka[0]>n[2]&&(s+=1),Ka[1]<n[1]&&(s+=2),r=r.children[s]}return this._getLodBiasCorrectedScale(r.level)}}return 1/0}getSphereElevationBounds(t,e){if(Ka[0]=t[0],Ka[1]=t[1],Ka[2]=t[2],Ka[3]=t[3],!Do(Ka,e,Ka,this.tilingScheme?.spatialReference))return ne.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let i=1/0,r=-1/0;const n=o=>{if(o&&CK(o.extent,Ka))if(o.isLeaf||o.rendered)i=Math.min(i,o.elevationBounds[0]),r=Math.max(r,o.elevationBounds[1]);else for(const a of o.children)n(a)},s=this._rootTiles;if(s!=null)for(const o of s)n(o);return{min:i,max:r}}getRootElevationBounds(){return{min:this.rootTileElevationBounds.min,max:this.rootTileElevationBounds.max}}getSphereScale(t,e){if(!this.tilingScheme)return null;if(!lc(t,Ka,this.spatialReference))return ne.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;Ka[3]=e;let i=null;const r=s=>{if(s&&CK(s.extent,Ka)){const o=s.children;if(o[0]&&!s.rendered)for(const a of o)r(a);else{const a=this._getLodBiasCorrectedScale(s.level);i=i==null?a:Math.min(i,a)}}},n=this._rootTiles;if(n!=null)for(const s of n)r(s);return i}queryVisibleScaleRange(t,e,i,r){const n=e?this.tilingScheme.levelAtScale(e):0,s=i?this.tilingScheme.levelAtScale(i):1/0,o=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(t,n+o,s+o,r)}_evaluateTransparency(){const t=this.baseOpacity,e=this.overlayManager.renderer.isEmpty,i=this._renderer.transparency,r=this._allSurfaceLayersTransparent()?e?$a.Empty:$a.TransparentWithDraped:t>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?$a.Opaque:$a.Semitransparent,n=i!==r;return n&&(this._renderer.transparency=r,this.view?._stage?.renderer.setParameters({terrainTransparency:this._renderer.transparency})),n}_updateTilingScheme(){const t=this.tilingSchemeLogic.tilingScheme;if(t===this.tilingScheme)return;sf(!!t,"tiling scheme cannot be reset to undefined"),this._isGlobal=!this.view?.state?.isLocal,this.tilingScheme&&this._removeAllTiles();const e=t?.spatialReference??je.WebMercator;this._spatialReference=e,this._isWebMercator=!!e?.isWebMercator,this._isWebMercatorOnPlateeCarree=this._isWebMercator&&ZH(this.view?.renderSpatialReference),this._set("tilingScheme",t),this._updateClippingExtent(),t&&(this._updateTiledLayers(),this._renderer.setTileSize(t.pixelSize),this.overlayManager.setSpatialReference(t.spatialReference),this._updateRootTiles())}_acquireTile(t,e,i,r){const n=this._tileCache.pop(QL._tileMemcacheKey);return n?(n.init(t,e,i,r,this),n):new this._tileConstructor(t,e,i,r,this)}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:t,tilingScheme:e}=this;if(!e)return;const i=Lft;let r=e.rootTilesInExtent(t,i,5*z2);if(this._rootTiles!=null){if(r.length>z2)return void ne.getLogger(this).warn(Q9e);const n=this._rootTiles.map(o=>o.lij),s=yOe(n,r,qae);if(this._updatingRootTiles=!0,s.removed.length>0||s.added.length>0){const o=this._rootTiles.filter(a=>!(s.removed.findIndex(l=>qae(l,a.lij))>-1)||(this._purgeTile(a),!1));s.added.forEach(a=>o.push(this._newRootTile(a))),this._setRootTiles(o)}}else this._updatingRootTiles=!0,r.length>z2&&(ne.getLogger(this).warn(eVe),r=e.rootTilesInExtent(t,i,z2)),this._setRootTiles(r.map(n=>this._newRootTile(n)));Z1(i,this._rootTilesExtent)||(this._rootTilesExtent=Gt(i)),this.renderer.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const t=this._allTiles.filter(e=>e.isLoaded&&e.intersectsClippingArea);t.forEach(e=>this._renderer.updateTileGeometryState(e)),t.forEach(e=>e.renderData.updateNeighborData()),this._updateTilesGeometries(t),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(t){if(t.length===0)return;t.sort(gg);const e=this.renderer;t.forEach(i=>e.updateGeometryIfNeeded(i)),t.forEach(i=>this._pendingTilesForElevationUpdateEvent.add(i))}_shouldSplit(t){return t.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===yt.SPLIT}_newRootTile(t){const e=this._acquireTile(0,t[1],t[2],null);return this._shouldSplit(e)&&e.setPendingUpdate(yt.SPLIT),this._loadTile(e),this._markTileToUpdate(e),this._updateRootTileElevationBounds(),e}_setRootTiles(t){if(this._rootTiles=t,this._allTiles.clear(),t!=null){const e=this._iteratorPool.acquire();for(e.reset(t);!e.done;)this._allTiles.push(e.next());e.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(t)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this.renderer.visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(t){t.updateClippingStatus(this.extent)&&t.resetPendingUpdate(yt.GEOMETRY)&&this._updateTileGeometryState(t)}_updateTilesVisibility(t){if(t==null)return;const e=edt(t),i=this.visibleElevationBounds;let r=e?i.min:1/0,n=e?i.max:-1/0;const s=this.extent,o=this._viewProjectionMatrix;this.setTileTreeDirty();const a=this._iteratorPool.acquire();for(a.reset(t);!a.done;){const l=a.next();l.updateClippingStatus(s)&&l.resetPendingUpdate(yt.GEOMETRY)&&this._updateTileGeometryState(l),l.setPendingUpdate(yt.RENDERDATA),l.computeVisibility(),l.updateScreenDepth(o),l.renderData&&(r=Math.min(l.elevationBounds[0],r),n=Math.max(l.elevationBounds[1],n))}a.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._updatePendingTileGeometries(),isFinite(r)&&isFinite(n)&&(i.min!==r||i.max!==n)&&(this.visibleElevationBounds=new J2(r,n))}_updateRootTileElevationBounds(){let t=1/0,e=-1/0;const i=this._rootTiles;i?.forEach(({elevationBounds:n})=>{t=Math.min(t,n[0]),e=Math.max(e,n[1])});const r=this.rootTileElevationBounds;r.min===t&&r.max===e||(this.rootTileElevationBounds=new J2(t,e))}_updateViewDependentParameters(){const{camera:t,contentCamera:e}=this.view.state,i=Math.tan(.5*e.fovX),r=Math.tan(.5*e.fovY),n=this.tilingScheme.pixelSize,s=2**-this._lodBias*t.pixelRatio;this._splitLimits.aboveGround=t.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=r,this._splitLimits.relativeWidthLimit=n/t.width*this.maxTextureScale*s,this._splitLimits.relativeHeightLimit=n/t.height*this.maxTextureScale*s,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?this._splitLimits.frustum=RN(this._splitLimits.frustum??gO(),e.frustum):this._splitLimits.frustum=null,RN(this._frustum,t.frustum),Di(this._viewProjectionMatrix,e.projectionMatrix,e.viewMatrix),se(this._eyePosRenderSR,e.eye),Do(t.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(t){t.rendered&&!t.shouldLoad&&(oCe(t)?this._loadChildren(t):Ift(t)&&this._loadParent(t))}_updateTileGeometryState(t){t.updateVisibility(),this._renderer.updateTileGeometryState(t)&&this._markTileToUpdate(t),this._usedMemory=null}_markAllTileNeighborsForGeometryUpdate(t){t.forEachLoadedNeighbor(e=>this._pendingTilesToUpdate.add(e))}_updateTileTexture(t,e){const i=t.resetPendingUpdate(yt.TEXTURE_FADING)?yt.TEXTURE_FADING:!!t.resetPendingUpdate(yt.TEXTURE_NOFADING)&&yt.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(t,i),this._usedMemory=null,e.madeProgress())}_emitElevationUpdateEventForTiles(){if(!this._shouldEmitChangeEvent)return;const t=lz.extent;mh(t),this._pendingTilesForElevationUpdateEvent.forEach(e=>Hy(t,e.extent,t)),this._pendingTilesForElevationUpdateEvent.clear(),lz.spatialReference=this.spatialReference,this.emit("elevation-change",lz),this._shouldEmitChangeEvent=!1}runTask(t){this._handleLayerViewChanges(t),this._frameTask.processQueue(t),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,t),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(t),this._sortTiles(t);const e=!this.view.state.fixedContentCamera;this._mergeAndSplit(t,e),this._updateElevation(t),this._updateTextures(t),e||this._mergeAndSplit(t,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._updatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),t.done&&t.hasProgressed&&this.requestUpdate(),this.notifyChange("updatingProgressValue")}_updateAllTilesStatus(t){if(!this._viewChanged||!this._rootTiles||t.done)return;this._viewChanged=!1;const e=this._iteratorPool.acquire();e.reset(this._rootTiles);const i=this.snapLevel,r=this._splitLimits,n=this._eyePosRenderSR;for(;!e.done;){const s=e.next(),o=s.shouldSplit(r,n,i);if(o!==yt.SPLIT){if(s.resetPendingUpdate(yt.SPLIT)&&s.updateAgentSuspension(),o===yt.ELEVATION&&s.updateAgents(Vt.ELEVATION),e.skipSubtree(),!s.isLeaf){s.setPendingUpdate(yt.MERGE),s.resetPendingUpdate(yt.SPLIT);const a=this._iteratorPool.acquire();a.resetOne(s);const l=this._viewProjectionMatrix;for(let c=a.next();!a.done;c=a.next())this._updateClippingStatus(c),c.updateVisibility(),c.updateScreenDepth(l);a.remove()}}else s.resetPendingUpdate(yt.MERGE),s.isLeaf&&(s.setPendingUpdate(yt.SPLIT),e.skipSubtree()),s.rendered&&s.setPendingUpdate(yt.RENDERDATA)}e.remove(),this.requestUpdate(),(this._shortBatches||!this._oneBatchPerFrameTask)&&this._updatePendingTileGeometries(),t.madeProgress()}_sortTiles(t){t.done||this._allTilesSorted||(Kht(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),t.madeProgress())}_markTileToUpdate(t){Se(t.isLoaded),t.intersectsClippingArea&&(this._pendingTilesToUpdate.add(t),this._markAllTileNeighborsForGeometryUpdate(t))}_updatePendingTileGeometries(){const t=this._pendingTilesToUpdate,e=Array.from(t.keys()).filter(n=>n.isLoaded&&n.intersectsClippingArea);if(e.length===0)return void t.clear();const i=(n,s)=>{!s?.isLoaded||!s.intersectsClippingArea||s.level<n.level||t.has(s)||(t.add(s),e.push(s),s.renderData.updateNeighborData())};e.sort(gg);const r=e.length;for(let n=0;n<r;++n){const s=e[n];Se(s.isLoaded),Se(s.intersectsClippingArea);const o=s.renderData;o.updateNeighborData();const a=o._dirtyEdgeResolutions,l=o.geometryState.neighborData.cornerPeerNeighbors,c=u=>{const d=w5[u];i(s,l[u]?.findCorner(b5(d),p=>p.isLoaded))};for(let u=0;u<4;++u)if(a&1<<u){const d=o.geometryState.neighborData.edgePeerNeighbors[u];d&&d?.level>=s.level&&d.forAllSubtreeOnSide(SZ(ng[u]),p=>!(!p.isLoaded||!p.intersectsClippingArea)&&(Se(t.has(p)||gg(s,p)<0),i(s,p),!0)),c((u+1)%4),c(u)}}t.clear(),this._updateTilesGeometries(e),this._shouldEmitChangeEvent=!0,us&&_5&&this.checkAllTilesWaterproofness()}_mergeAndSplit(t,e){if(this.suspended||t.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let i=!1;const r=this.view.state.fixedContentCamera;let n=!1;for(;!t.done;){n=!0;let s=!1;const o=!this._allTiles.some(a=>{if(!i&&!r&&!a.visible)return t.done;let l=a;if(a.resetPendingUpdate(yt.MERGE)){if(!e)return a.setPendingUpdate(yt.MERGE),t.done;for(;l.parent?.resetPendingUpdate(yt.MERGE);)l=l.parent;this._mergeTile(l),s=!0,t.madeProgress()}else a.resetPendingUpdate(yt.SPLIT)&&(this._splitTile(a),s=!0,t.madeProgress());return!t.done&&l===a&&a.resetPendingUpdate(yt.RENDERDATA)&&(this._updateRenderData(a),t.madeProgress()),t.done});if(s&&(this._allTilesSorted=!1,this._allTilesDirty=!0),o){if(!i){i=!0;continue}if(!s)break}else this._allTilesDirty=!0}n?t.madeProgress():this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries(),this._sortTiles(t)}_updateElevation(t){t.done||(this._allTiles.some(e=>(e.resetPendingUpdate(yt.GEOMETRY)&&(this._updateTileGeometryState(e),this._updateTileTexture(e,t),this._shortBatches&&this._updatePendingTileGeometries(),t.madeProgress()),t.done)),!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries())}_updateTextures(t){t.done||this._allTiles.some(e=>(this._updateTileTexture(e,t),t.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(_n.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const t=this.view.quality;return this.view.qualitySettings.tiledSurface.lodBias-(1-t)*J9e}_getLodBiasCorrectedScale(t){const e=this.tilingScheme.levels,i=_e(t-this._lodBias,0,e.length-1),r=i-Math.floor(i);return e[Math.floor(i)].scale*(1-r)+e[Math.ceil(i)].scale*r}_removeAllTiles(){this._rootTiles!=null&&(this._rootTiles.forEach(t=>this._purgeTile(t)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.renderer.visible=!1}_purgeDescendantTiles(t){if(!t.children[0])return!1;let e=!1;for(let i=0;i<4;++i)e=this._purgeTile(t.children[i])||e;return t.unsetChildren(),e}_purgeTile(t){const e=this._purgeDescendantTiles(t)||t.rendered;return this._allTiles.removeUnordered(t),this._unloadTile(t),this._tileCache.put(QL._tileMemcacheKey,t),e}_unloadTile(t){this._pendingTilesToUpdate.delete(t),this._pendingTilesForElevationUpdateEvent.delete(t),t.unload(this._renderer)}_splitTile(t){sf(t.isLeaf,"tile that is already split should not be split again!");const e=t.level+1,i=2*t.lij[1],r=2*t.lij[2];t.setChildren(this._createTile(e,i,r,t),this._createTile(e,i,r+1,t),this._createTile(e,i+1,r,t),this._createTile(e,i+1,r+1,t)),t.setPendingUpdate(yt.RENDERDATA),t.updateAgentSuspension(),this._allTiles.pushArray(t.children),this._allTilesDirty=!0,++this._performanceInfo.numSplit}_emitTileScaleChange(t,e=t.level){z$.spatialReference=this.spatialReference,z$.extent=t.extent,z$.scale=this._getLodBiasCorrectedScale(e),this.emit("scale-change",z$)}_createTile(t,e,i,r){sf(!!r,"_createTile sanity check");const n=this._acquireTile(t,e,i,r);return n.updateClippingStatus(this.extent),n.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(n)&&n.setPendingUpdate(yt.SPLIT),n}get _shortBatches(){return this.view.state.mode!==Si.IDLE}_mergeTile(t){sf(!t.hasPendingUpdate(yt.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(t)&&(sf(!t.renderData,"_mergeTile sanity check"),this._loadTile(t),this._markTileToUpdate(t),this._emitTileScaleChange(t),this._shortBatches&&this._updatePendingTileGeometries()),this._allTilesDirty=!0,++this._performanceInfo.numMerged}_loadChildren(t){sf(t.rendered,"parent should be rendered"),this._unloadTile(t);const e=t.children;e.forEach(i=>this._loadTile(i)),e.forEach(i=>this._pendingTilesToUpdate.add(i)),this._markAllTileNeighborsForGeometryUpdate(t),this._emitTileScaleChange(t,t.level+1),this._shortBatches&&this._updatePendingTileGeometries()}_loadParent(t){const e=t.parent;this._unloadChildren(e),this._loadTile(e),this._markTileToUpdate(e),this._emitTileScaleChange(e,e.level),this._shortBatches&&this._updatePendingTileGeometries()}_unloadChildren(t){const e=t.children;if(e[0])for(let i=0;i<4;++i){const r=e[i];this._unloadChildren(r),this._unloadTile(r)}}_loadTile(t){t.load(),t.setPendingUpdate(yt.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(t)}_elevationDataArrived(t,e,i){const r=new Lht(t.lij,t.extent,i);t.dataArrived(e,Vt.ELEVATION,r);const n=[t],s=t.level,o=this._iteratorPool.acquire();for(o.reset(n);!o.done;){const a=o.next();a.findElevationBoundsForLayer(e,s),a.computeElevationBounds()}s===0&&this._updateRootTileElevationBounds(),o.remove(),this._updateTilesVisibility(n)}_handleLayerViewChanges(t=Da){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let e=!1;const i=new Set;let r=-1;for(const n of this.view.allLayerViews.items)if(i.add(n.uid),DO(n)||tC(n))if(this._basemapLayerViewHandles.has(n.uid)&&!tC(n)){const s=this._layerClassFromLayerView(n),o=this._getLayerIdxByUID(s,n.uid);o!=null&&((o<r||r==null)&&(e=!0),r=o)}else this._registerTiledLayerView(n),n.layer.loaded&&(e=!0);this._basemapLayerViewHandles.forEach((n,s)=>{i.has(s)||(this._unregisterTiledLayerView(s),e=!0)}),e&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),t.madeProgress()}_allSurfaceLayersTransparent(){let t=this.view.map?.ground?.opacity===0;for(const e of this.view.allLayerViews.items)if(Aj(e)&&!wI(e.layer)&&e.fullOpacity!==0)return t=!1,t;return t}_hasCompositeBlendMode(){for(const t of this.view.allLayerViews.items)if((LO(t)||tC(t))&&odt(Pj[t.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(t){return Cj(t)?Vt.ELEVATION:Vt.MAP}_registerTiledLayerView(t){const e=[];if((LO(t)||tC(t))&&e.push(le(()=>t.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(ss.UNFADED)})),!tC(t)){const i=this._layerClassFromLayerView(t);e.push(le(()=>t.suspended,()=>this._updateTiledLayers())),e.push(le(()=>t.fullOpacity,()=>this._updateTileTextures(ss.UNFADED))),e.push(le(()=>"effectiveScaleRange"in t.layer?t.layer.effectiveScaleRange:null,()=>this._restartAllAgents(i))),e.push(t.on("data-changed",()=>{const r=this._getLayerIdxByUID(i,t.uid);r!=null&&this._invalidateLayerData(r,i)}))}this._unregisterTiledLayerView(t.uid),this._basemapLayerViewHandles.set(t.uid,e)}_unregisterTiledLayerView(t){const e=this._basemapLayerViewHandles.get(t);if(e){for(const i of e)i.remove();this._basemapLayerViewHandles.delete(t)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const t=this.view.allLayerViews,e=[[],[]];let i=null;t.forEach(r=>{if(!r.layer||r.suspended||!DO(r)||!r.fullExtent)return;const n=this._layerClassFromLayerView(r);if(n===Vt.MAP){const s=r.displayLevelRange.maxLevel;s!==1/0&&(i===null||s>i)&&(i=s)}e[n].push(r)});for(const r of f1){const n=this._layerViews[r],s=e[r];s.reverse();const o=s.length;let a=n.length!==o;const l=new Array(o),c=new Array(n.length);this._layerIndexByUid[r].clear();for(let u=0;u<o;u++){const d=s[u].uid;this._layerIndexByUid[r].set(d,u);const p=n.indexOf(s[u]);l[u]=p,u!==p&&(a=!0),p>-1&&(c[p]=u)}if(a){const u=this._postorderIterator;for(u.reset(this._rootTiles);!u.done;)u.next().modifyLayers(c,l,r);this._layerViews[r]=s,this._restartAllAgents(r),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&this._viewChangeUpdate()}_restartAllAgents(t){const e=this._postorderIterator;for(e.reset(this._rootTiles);!e.done;){const i=e.next();i.restartAgents(t),t===Vt.ELEVATION&&i.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(t,e){return this._layerViews[e][t]}numLayers(t){return this._layerViews[t].length}_updateTileTextures(t){this._allTiles.forAll(e=>{e.updateAgents(Vt.MAP),t===ss.IMMEDIATE?this.renderer.updateTileTexture(e,yt.TEXTURE_NOFADING):e.updateRenderData(Vt.MAP,t)}),this._evaluateTransparency()}_invalidateLayerData(t,e){this._allTiles.forAll(i=>i.removeLayerAgent(t,e)),this._allTiles.forAll(i=>i.invalidateLayerData(t,e))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(t=_n.UPDATE){this.renderer.setNeedsRender(t)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(t,e,i,r){const n=this.layerViewByIndex(e,i),s=n.layer;return!s.tilemapCache||vS(n)?this._requestTileData(t,i,n,r):(++this._asyncWorkItems,s.tilemapCache.fetchAvailability(t.lij[0],t.lij[1],t.lij[2],{...r,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(o=>{throw--this._asyncWorkItems,Et(r),Fn(o)||this._dataMissing(t,i,n,{notInTilemap:!0}),o}).then(()=>this._frameTask.schedule(()=>this._requestTileData(t,i,n,r),r.signal)))}_requestTileData(t,e,i,r){return e===Vt.ELEVATION?Cj(i)?this._requestElevationTileData(t,i,r):Promise.reject():Aj(i)?this._requestMapTileData(t,i,r):Promise.reject()}_requestElevationTileData(t,e,i){++this._asyncWorkItems;const r=o=>{if(Hn(i))return;const a=this._layerIndexByUid[Vt.ELEVATION].get(e.uid);a!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(t,a,o)):ne.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",Vt.ELEVATION,t.lij.toString())},n=o=>{Fn(o)||(this._dataMissing(t,Vt.ELEVATION,e,o),this.requestUpdate())};if(noe(e.layer))return e.layer.fetchTile(t.lij[0],t.lij[1],t.lij[2],{noDataValue:hO,signal:i.signal}).then(o=>{if(!Hn(i))return this._frameTask.schedule(()=>r(o),i.signal,n);ne.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},n).finally(()=>{--this._asyncWorkItems});const s=e.getTileUrl(t.lij[0],t.lij[1],t.lij[2]);return this._elevationDataRequester.request(s,"binary",i).then(o=>this._lercDecoder.decode(o,{noDataValue:hO},i.signal)).then(o=>{o?r(new bht(o)):n(new Error("LERC decoding failed"))},n).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(t,e,i){++this._asyncWorkItems;const r=(c,u)=>{--this._asyncWorkItems,wT(u),Hn(i)||(this._dataMissing(t,Vt.MAP,e,c),this.requestUpdate())},n=c=>u=>r(u,c),s=c=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),Hn(i)?wT(c):this._mapTileDataArrived(t,e,c)},i.signal,n(c)).catch(n(c)),o=(c,u=null)=>this._frameTask.schedule(()=>r(c,u));if(vS(e)){const c=e.schemaHelper.getLevelRowColumn(t.lij);return e.fetchTile(c[0],c[1],c[2],i).then(s,o)}if(yk(e))return e.fetchTile(t.lij[0],t.lij[1],t.lij[2],i).then(s,o);if(xZ(e)&&noe(e.layer))return e.layer.fetchTile(t.lij[0],t.lij[1],t.lij[2],i).then(c=>{if(Hn(i))return ne.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void o(pi());s(c)},o);let a=e.getTileUrl(t.lij[0],t.lij[1],t.lij[2]);_ht(e.layer)&&e.layer.refreshTimestamp&&(a+=`${a.includes("?")?"&":"?"}_ts=${e.layer.refreshTimestamp}`);const l=e.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(a,l,i).then(s,o)}_mapTileDataArrived(t,e,i){const r=this._getLayerIdxByUID(Vt.MAP,e.uid);r!=null?t.dataArrived(r,Vt.MAP,i):(wT(i),ne.getLogger(this).warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(t,e){return this._layerIndexByUid[t].get(e)}_dataMissing(t,e,i,r){const n=this._getLayerIdxByUID(e,i.uid);n!=null?t.dataMissing(n,e,r):ne.getLogger(this).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(t){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(e=>{e.renderData&&this.overlayManager.setTileParameters(e)}),this._renderer.setNeedsRender(t))}get performanceInfo(){const t=this._performanceInfo;return t.numNodes=this._allTiles.length,t.numLeaves=t.numVisible=t.numRendered=t.numLoadedPerLevel.length=t.numRenderedPerLevel.length=0,this._allTiles.forAll(e=>{e.isLeaf&&t.numLeaves++;const i=e.level;e.renderData&&(t.numLoadedPerLevel[i]=(t.numLoadedPerLevel[i]||0)+1),e.visible&&(t.numVisible++,e.rendered&&(t.numRenderedPerLevel[i]=(t.numRenderedPerLevel[i]||0)+1,t.numRendered++))}),t}get usedMemory(){return this.tilingScheme?(this._usedMemory==null&&(this._usedMemory=this._recalculateUsedMemory()),this._usedMemory??0):0}_recalculateUsedMemory(){return this.tilingScheme?Math.round(this._allTiles.reduce((t,e)=>t+e.usedMemory,0)):null}getUsedMemoryForLayerView(t){let e=0;const i=this._layerClassFromLayerView(t),r=this._getLayerIdxByUID(i,t.uid);return r!=null&&this._allTiles.forAll(n=>e+=n.getUsedMemoryForLayer(i,r)),e}getTile(t){if(t==null||this._rootTiles==null)return null;const e=t.split("/").map(o=>+o);if(e[0]===0)return this._rootTiles.find(o=>o.lij[1]===e[1]&&o.lij[2]===e[2]);const i=2**e[0],r=Math.floor(e[1]/i),n=Math.floor(e[2]/i);let s;if(this._rootTiles.some(o=>o.lij[1]===r&&o.lij[2]===n&&(s=o,!0)),s){let o=1<<e[0]-1;for(;s.lij[0]<e[0];){let a=e[1]&o?2:0;if((e[2]&o)>0&&a++,!s.children[a])return null;s=s.children[a],o>>=1}return sf(s.lij[0]===e[0]&&s.lij[1]===e[1]&&s.lij[2]===e[2],"not the right tile?"),s}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(t){this._renderer.renderPatchBorders=t}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(t){this._renderer.visualizeNormals=t}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(t){this._renderer.renderingDisabled=t}get test(){const t=this;return{renderer:t._renderer,lercDecoder:t._lercDecoder,forceReload:()=>{t._rootTiles!=null&&t._rootTiles.length>0&&(t._mergeTile(t._rootTiles[0]),t._viewChangeUpdate())},getTiles:()=>t._allTiles.toArray(),getRenderedTiles(){az.clear(),t._allTiles.forAll(i=>{i.visible&&i.rendered&&az.push(i)});const e=az.toArray();return mEe(t.renderOrder,e),e},lockTilingScheme(e,i){t._extentHelper.defaultTiledLayersExtent=i,t.tilingSchemeLogic.test.lockTilingScheme(e)}}}checkAllTilesWaterproofness(){if(!_5)return;const t=this._rootTiles;if(t==null)return;const e=s=>s?.renderData?.geometry?.indices?.length>0,i=(s,o)=>{e(s)&&console.error("Tile[",s.lij,"] has geometry although parent[",o.lij,"] has geom")},r=s=>{if(s.intersectsClippingArea)if(s.renderData&&!s.renderData.geometryState&&console.error("Tile[",s.lij,"] has renderData but not geometryState"),s.renderData&&!s.renderData.geometry&&console.error("Tile[",s.lij,"] has renderData but not geometryInfo"),!s.renderData?.geometry||(s.renderData.geometry.indices?.length??0)>0||console.error("Tile[",s.lij,"] has renderData but no indices - geometryInfo: ",s.renderData.geometry),e(s)){s.checkGeometryWaterproofness();for(const o of s.children)i(o,s)}else if(s.isLeaf)console.error("Tile[",s.lij,"] has no geometry and no children, from root to leaf");else for(const o of s.children)r(o)},n=s=>{const o=s.parent?.visible??!0,a=s.visible;s.computeVisibility();const l=s.visible;if(a!==l&&o&&console.error(" Tile[",s.lij,"] has out of date visibility: ",a," instead of ",l),!s.isLeaf)for(const c of s.children)n(c)};for(const s of t)r(s),n(s)}get isGlobal(){return this._isGlobal}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateeCarree(){return this._isWebMercatorOnPlateeCarree}isEastEndWrap(t){return this.isGlobal&&t[2]===this.lijEastEnd(t[0])-1}isWestEndWrap(t){return this.isGlobal&&t[2]===0}lijEastEnd(t){return 2**(t+(this.spatialReference!=null&&this.spatialReference.isGeographic?1:0))}wrapEastWest(t){const e=this.lijEastEnd(t[0]),i=t[2];if(0<=i&&i<e)return t;if(!this.isGlobal)return null;const r=(i+(i<0?e:0))%e;return[t[0],t[1],r]}enableInternalChecks(t){Nut(t)}enableWaterproofnessChecks(t){Dut(t)}};kt._tileMemcacheKey="TerrainTileMemcache",h([f()],kt.prototype,"_renderer",void 0),h([f({constructOnly:!0})],kt.prototype,"_scaleRangeQueries",void 0),h([f({constructOnly:!0})],kt.prototype,"view",void 0),h([f({constructOnly:!0})],kt.prototype,"overlayManager",void 0),h([f()],kt.prototype,"_hasPendingUpdates",void 0),h([f()],kt.prototype,"_asyncWorkItems",void 0),h([f()],kt.prototype,"_allTilesDirty",void 0),h([f()],kt.prototype,"_allTilesSorted",void 0),h([f()],kt.prototype,"_viewChanged",void 0),h([f()],kt.prototype,"_splitLimits",void 0),h([f({readOnly:!0})],kt.prototype,"_watchUpdatingTracking",void 0),h([f()],kt.prototype,"_frameTask",void 0),h([f({readOnly:!0})],kt.prototype,"snapLevel",null),h([f({readOnly:!0})],kt.prototype,"lodSnapping",null),h([f()],kt.prototype,"_userClippingExtent",null),h([f()],kt.prototype,"_rootTilesExtent",void 0),h([f({readOnly:!0})],kt.prototype,"extent",null),h([f({readOnly:!0})],kt.prototype,"groundExtent",null),h([f({readOnly:!0})],kt.prototype,"_tilingSchemeExtent",null),h([f({readOnly:!0})],kt.prototype,"updating",null),h([f({readOnly:!0})],kt.prototype,"running",null),h([f($ht)],kt.prototype,"updatingProgress",void 0),h([f({readOnly:!0})],kt.prototype,"updatingProgressValue",null),h([f()],kt.prototype,"_maxNumUpdating",void 0),h([f()],kt.prototype,"baseOpacity",null),h([f()],kt.prototype,"hasCompositeBlendMode",void 0),h([f({readOnly:!0})],kt.prototype,"viewingMode",null),h([f()],kt.prototype,"maxTextureScale",void 0),h([f({readOnly:!0})],kt.prototype,"ready",null),h([f({value:bS.FRONT_TO_BACK})],kt.prototype,"renderOrder",null),h([f({readOnly:!0})],kt.prototype,"rootTiles",null),h([f()],kt.prototype,"_rootTiles",void 0),h([f({readOnly:!0})],kt.prototype,"spatialReference",null),h([f({type:Ye})],kt.prototype,"backgroundColor",null),h([f({value:!1})],kt.prototype,"slicePlaneEnabled",null),h([f({readOnly:!0})],kt.prototype,"tilingScheme",void 0),h([f({readOnly:!0})],kt.prototype,"tilingSchemeLocked",null),h([f({readOnly:!0})],kt.prototype,"tilingSchemeLogic",void 0),h([f()],kt.prototype,"wireframe",null),h([f({value:!1})],kt.prototype,"suspended",null),h([f()],kt.prototype,"textureFadeDuration",null),h([f()],kt.prototype,"visibleElevationBounds",void 0),h([f()],kt.prototype,"rootTileElevationBounds",void 0),h([f()],kt.prototype,"_layerViewsDirty",void 0),h([f()],kt.prototype,"renderPatchBorders",null),h([f()],kt.prototype,"visualizeNormals",null),h([f()],kt.prototype,"renderingDisabled",null),kt=QL=h([z("esri.views.3d.terrain.TerrainSurface")],kt);const $ft=kt;function qae(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function oCe(t){const e=t.children;if(!e[0])return!1;for(const i of e)if(i.shouldLoad)return!0;for(const i of e)if(oCe(i))return!0;return!1}function Ift(t){return t.isLeaf&&(t.parent?.shouldLoad??!1)}const Ka=Kt(),Lft=Gt(),az=new It,lz={spatialReference:null,extent:Gt(),context:"ground"},z$={spatialReference:null,extent:null,scale:0};function Wae(t,e,i){for(const r of t){if(!r.containsPointXY(e,i))continue;let n=r;for(;n&&!n.renderData;){const o=(e>n.extentMidX?1:0)+(i<n.extentMidY?2:0);n=n.children[o]}const s=n?.renderData?.geometryState.samplerData??null;return Xr(e,i,s)}return null}let Dft=class{constructor(e,i,r,n){this.operation=e,this.geometry=i,this.states=r,this.sync=n}},RA=class extends xe{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(e,i){const r=this._dirtyGeomRecords.get(e);r&&(r.forEach((n,s)=>{const o=this._ensureGeomRecord(e,s);n.forEach(({geometry:a,operation:l,states:c},u)=>{let d=!1;if(l===kr.UPDATE){const p=o.get(u);if(p){if(c&ns.TRANSFORMATION){const m=this.model.getObject(s);this.model.updateRenderGeometryTransformation(m,a,p)&&(d=!0)}d||i.updates.push({renderGeometry:p,updateType:c})}else Ke(!1,"ModelDirtySet.commitLayer: invalid update")}if(l===kr.REMOVE||d){const p=o.get(u);p?(i.removes.push(p),o.delete(u)):l===kr.REMOVE&&Ke(!1,"ModelDirtySet.commitLayer: invalid remove")}if(l===kr.ADD||d){const p=this.model.getObject(s);if(p!=null){const m=this.model.getRenderGeometry(p,a);i.adds.push(m),o.set(u,m)}}}),o.size===0&&this._residentGeomRecords.get(e).delete(s)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this.dirty=this._hasDirtyGeometryRecords)}commitSyncUpdates(e,i){const r=this._dirtyGeomRecords.get(e);r&&r.forEach((n,s)=>{const o=this._ensureGeomRecord(e,s);n.forEach(({geometry:a,operation:l,states:c,sync:u},d)=>{let p=!1;if(l===kr.UPDATE&&u){const m=o.get(d);if(m){if(c&ns.TRANSFORMATION){const y=this.model.getObject(s);this.model.updateRenderGeometryTransformation(y,a,m)&&(p=!0)}p||i.updates.push({renderGeometry:m,updateType:c})}else Ke(!1,"ModelDirtySet.commitSyncUpdates: invalid update")}})})}getResidentRenderGeometries(e,i){const r=this._residentGeomRecords.get(e);r&&r.forEach(n=>n.forEach(s=>i.push(s)))}_objectStateChanged(e,i){for(const r of i.geometries)this._updateOrCreateDirtyRecord(i,r,null,kr.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(ns.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(ns.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(ns.OCCLUDEE,e)}attributesChanged({object:e,geometry:i,sync:r}){this._updateOrCreateDirtyRecord(e,i,null,kr.UPDATE,ns.GEOMETRY,r)}layerAdded(e){e.objects.forAll(i=>this._layerObjectAdded(e,i))}layerRemoved(e){e.objects.forAll(i=>this._layerObjectRemoved(e,i))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,i){const r=e.id;for(const n of i.geometries)this._geometryAdded(i,n,r)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const i of e.objects)this._layerObjectAdded(e.layer,i)}layerObjectsRemoved(e){for(const i of e.objects)this._layerObjectRemoved(e.layer,i)}_layerObjectRemoved(e,i){const r=e.id;for(const n of i.geometries)this._geometryRemoved(i,n,r)}transformationChanged(e){const i=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(i,r).forEach(n=>{this._updateOrCreateDirtyRecord(e,n.geometry,i,kr.UPDATE,ns.TRANSFORMATION)})}shaderTransformationChanged(e){const i=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(i,r).forEach(n=>{n.objectShaderTransformationChanged(e.shaderTransformation)})}geometryAdded(e){this._geometryAdded(e.object,e.geometry)}_geometryAdded(e,i,r=null){this._updateOrCreateDirtyRecord(e,i,r,kr.ADD)}geometryRemoved(e){this._geometryRemoved(e.object,e.geometry)}_geometryRemoved(e,i,r=null){this._updateOrCreateDirtyRecord(e,i,r,kr.REMOVE)}_updateOrCreateDirtyRecord(e,i,r,n,s=ns.NONE,o=!1){r=r??this._getParentLayerId(e);const a=e.id,l=i.id,c=this._ensureDirtyRecord(r,a),u=c.get(l);if(u){const d=u.operation;d===kr.REMOVE&&n===kr.ADD&&u.states!==ns.NONE?u.operation=kr.UPDATE:d===kr.REMOVE&&n===kr.ADD||d===kr.ADD&&n===kr.REMOVE?c.delete(l):d!==kr.UPDATE||n!==kr.REMOVE&&n!==kr.UPDATE?(Ke((d===kr.REMOVE||d===kr.ADD)&&n===kr.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),u.states|=s):(u.operation=n,u.states|=s),u.sync=u.sync||o}else c.set(l,new Dft(n,i,s,o));this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,i){let r=this._residentGeomRecords.get(e);r||(r=new Map,this._residentGeomRecords.set(e,r));let n=r.get(i);return n||(n=new Map,r.set(i,n)),n}get _hasDirtyGeometryRecords(){return Hc(this._dirtyGeomRecords,e=>Hc(e,i=>i&&i.size>0))}_ensureDirtyRecord(e,i){let r=this._dirtyGeomRecords.get(e);r||(r=new Map,this._dirtyGeomRecords.set(e,r));let n=r.get(i);return n||(n=new Map,r.set(i,n)),n}_getParentLayerId(e){return e.parentLayer?e.parentLayer.id:ARe}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let i="";return this._dirtyGeomRecords.forEach((r,n)=>{r.forEach((s,o)=>{i.length>0&&(i+=`
`),i+=n+"."+o;const a=[];s.forEach(l=>{const c=l.operation;a[c]||(a[c]=[]),a[c].push(l.geometry.id)});for(let l=0;l<a.length;l++)if(a[l]){i+=" "+e[l-1]+": ";for(let c=0;c<a[l].length;c++)i+=a[l][c]+", "}})}),i}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((i,r)=>i+r.size,0)},commit:i=>e._dirtyGeomRecords.forEach((r,n)=>e.commitLayer(n,i))}}};h([f({constructOnly:!0})],RA.prototype,"model",void 0),h([f()],RA.prototype,"dirty",void 0),RA=h([z("esri.views.3d.webgl-engine.lib.ModelDirtySet")],RA);const Nft=RA;let eD=class extends xe{constructor(){super(...arguments),this.dirtySet=new Nft({model:this}),this._content=new Map,this._originFactory=new qX(null)}getObject(e){return this._content.get(e)}add(e){const i=e.id;Ke(!this._content.has(i),"Model/Stage already contains object to be added"),this._content.set(i,e),s5(e)&&this.dirtySet.layerAdded(e)}remove(e){return!!this._content.has(e.id)&&(this._content.delete(e.id),s5(e)&&this.dirtySet.layerRemoved(e),!0)}addMany(e){for(const i of e)i&&(Ke(!this._content.has(i.id),"Model/Stage already contains object to be added"),this._content.set(i.id,i))}removeMany(e){for(const i of e)i&&(Ke(this._content.has(i.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(i.id))}has(e){return this._content.has(e.id)}forEachOfType(e,i){this._content.forEach(r=>{r.type===e&&i(r)})}getRenderGeometry(e,i){const r=new _S(i,{castShadow:e.castShadow,objectShaderTransformation:e.shaderTransformation});r.transformation=e.getCombinedStaticTransformation(i,Yae);const{localOrigin:n}=i;return r.localOrigin=n??this._originFactory.getOrigin(r.boundingSphere),r}updateRenderGeometryTransformation(e,i,r){if(e==null)return!1;r.transformation=e.getCombinedStaticTransformation(i,Yae);const n=this._originFactory.getOrigin(r.boundingSphere);return r.localOrigin!==n}getStats(){const e={},i=Array.from(this._content.values());for(let r=0;r<on.COUNT;++r)e[r]=i.filter(n=>n.type===r).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};h([f({constructOnly:!0})],eD.prototype,"dirtySet",void 0),eD=h([z("esri.views.3d.webgl-engine.parts.Model")],eD);const Yae=be();let Fft=class{constructor(e){this._totalCount=e,this._indexRanges=[0,e]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return this._indexRanges.length===0}componentCount(){const e=this._indexRanges;let i=0;for(let r=0;r<e.length;r+=2)i+=e[r+1];return i}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=kft(e)}forEachComponent(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const n=i[r],s=n+i[r+1];for(let o=n;o<s;o++)if(!e(o))return!1}return!0}forEachComponentRange(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const n=i[r];if(!e(n,n+i[r+1]))return!1}return!0}computeOffsetRanges(e){const i=new Array(this._indexRanges.length),r=this._indexRanges;for(let n=0;n<r.length;n+=2){const s=r[n],o=s+r[n+1],a=e[s],l=e[o];i[n]=a,i[n+1]=l-a}return i}};function kft(t){const e=new Array;if(t.length===0)return e;let i=t[0],r=1;for(let n=1;n<t.length;n++){const s=t[n];i+r===s?r+=1:(e.push(i),e.push(r),i=s,r=1)}return e.push(i),e.push(r),e}let Uft=class{constructor(e,i){this.offsets=i,this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null;const r=this.count;this.visibility=new Fft(r),this.materialDataBuffer=e.getBuffer(r),this.materialDataIndices=new Uint16Array(r);for(let n=0;n<r;n++)this.materialDataIndices[n]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return this.cachedGeometryRanges==null&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return this.highlightCounts==null?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return this.highlightCounts==null?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((this.cachedHighlightRanges==null||this.cachedDefaultRanges==null)&&this.highlightCounts!=null){const{highlightRanges:e,defaultRanges:i}=zft(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=e,this.cachedDefaultRanges=i}}};function zft(t,e,i){const r=[],n=[];let s=i.length,o=i.length;return e.forEachComponent(a=>(t[a]>0?(s!==a-1&&(r.length&&r.push(i[s+1]-r[r.length-1]),r.push(i[a])),s=a):(o!==a-1&&(n.length&&n.push(i[o+1]-n[n.length-1]),n.push(i[a])),o=a),!0)),r.length&&r.push(i[s+1]-r[r.length-1]),n.length&&n.push(i[o+1]-n[n.length-1]),{highlightRanges:r,defaultRanges:n}}let PA=class extends xe{constructor(){super(...arguments),this.visible=xT.Hidden}destroy(){this.intersectionGeometry=Pe(this.intersectionGeometry)}};var xT;h([f({autoDestroy:!0})],PA.prototype,"renderable",void 0),h([f({autoDestroy:!0})],PA.prototype,"components",void 0),PA=h([z("esri.views.3d.webgl-engine.collections.Component.ComponentObject")],PA),function(t){t[t.Hidden=0]="Hidden",t[t.Visible=1]="Visible"}(xT||(xT={}));function Bft(t,e,i,r){if(i>=e)return t;t==null&&(t=Vft());const n=t.isVisibleBit;let s=t.data;const o=lCe(s),a=i/o|0,l=i-o*a,c=(e-1)/o|0,u=s,d=r===n;if(!(i<u.length*o)&&d){const p=a+1,m=Math.ceil(u.length*o4),y=c+1;let _=Math.max(p,m);_=Math.min(_,y),s=new Uint32Array(_),s.set(u)}return a<s.length&&(s[a]=jft(s[a],l,d)),t.data=s,t}function aCe(t,e){if(t==null)return!0;const{isVisibleBit:i,data:r}=t,n=lCe(r);return e<r.length*n?Gft(i,r,e,n):!t.isVisibleBit}function Vft(t=!0){return{isVisibleBit:!t,data:new Uint32Array(0)}}function Gft(t,e,i,r){const n=i/r|0,s=i-n*r;return Hft(e[n],s)===t}function lCe(t){return t.BYTES_PER_ELEMENT*8}function jft(t,e,i){return t&~(1<<e)|(i?1:0)<<e}function Hft(t,e){return(t&1<<e)!=0}let qft=class{constructor(e,i){this._components=i,this._indices=e.indices?Sf(e.indices):pw(e.positions.length/3),this._positions=e.positions,this._componentIntersectionData=new Array(i.count)}destroy(){this._positions=null,this._indices=null,this._componentIntersectionData.length=0,this._perComponentAabbs=null}getComponentAabb(e,i){this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs());for(let r=0;r<6;r++)i[r]=this._perComponentAabbs[6*e+r];return i}getComponentPositions(e,i){i.indices=this._indices,i.data=this._positions,i.stride=3,i.startIndex=this._components.offsets[e],i.endIndex=this._components.offsets[e+1]}intersect(e,i,r,n,s,o,a){const l=new TR(this._positions,3),c=this._indices,u=this._components.offsets,d=iwe(e,i,Wft),p=e[2],m=i[2];this._components.visibility.forEachComponent(y=>{if(!aCe(this._components.pickability,y))return!0;const _=this.getComponentAabb(y,Yft);if(o!=null){const T=o[y];s!=null?s.componentOffset=T:(e[2]=p-T,i[2]=m-T)}if(s?.applyToAabb(_),!lX(_,e,d,r))return!0;const v=u[y]/3,w=u[y+1]/3,x=(T,S,E)=>a(y,T,Zl(S,S,n),E);return s==null&&w-v>nCe?(this._componentIntersectionData[y]==null&&(this._componentIntersectionData[y]=new FZ(this._indices,v,w,l)),this._componentIntersectionData[y].intersectRay({r0:e,r1:i},x)):LR(e,i,v,w,c,l,void 0,s,x),!0})}_computePerComponentAabbs(){const e=this._components.count,i=Jr(6*e),r=this._indices,n=this._positions,s=this._components.offsets;let o=0;for(let a=0;a<e;a++){const l=s[a],c=s[a+1];let u=1/0,d=1/0,p=1/0,m=-1/0,y=-1/0,_=-1/0;for(let v=l;v<c;v++){const w=3*r[v],x=n[w],T=n[w+1],S=n[w+2];u=Math.min(u,x),d=Math.min(d,T),p=Math.min(p,S),m=Math.max(m,x),y=Math.max(y,T),_=Math.max(_,S)}i[o++]=u,i[o++]=d,i[o++]=p,i[o++]=m,i[o++]=y,i[o++]=_}return i}get positions(){return this._positions}get indices(){return this._indices}};const Wft=C(),Yft=ds();let Xft=class{constructor(e,i,r){this.material=e,this.geometry=i,this.meta=r}destroy(){this.material.dispose(),this.geometry.dispose()}},Zft=class{constructor(e,i,r,n){this.vao=e,this.primitiveType=i,this.parameters=r,this.indexed=n}dispose(){this.vao.dispose()}},kZ=class{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}};function Jft(t,e){return{near:t,far:e}}function YR(t){return t?NO(t,1/0,-1/0):Jft(1/0,-1/0)}function NO(t,e,i){return t.near=e,t.far=i,t}function wS(t,e){e!=null&&(t.near=Math.min(t.near,e.near),t.far=Math.max(t.far,e.far))}function B$(t,e){return t.near<=e&&e<=t.far}const Gj={near:0,far:0};function Kft(t,e){const i=YR(),{eye:r,frustum:n,viewForward:s}=t;e.forAll(o=>{const a=o.offsetObb!=null?o.offsetObb:o.obb,l=me(zs(Rc,a.center,r),s),c=bF(a,s);if(B$(i,l-c)&&B$(i,l+c))return;const u=rmt(a,n);if(u===-1)return;if(u===0)return gm.far=l+c,gm.near=l-c,void wS(i,gm);const d=V$.pushNew();d.near=l-c,d.far=l+c,d.mask=u,d.object=o});for(let o=0;o<V$.length;o++){const a=V$.data[o];if(B$(i,a.near)&&B$(i,a.far))continue;gm.far=a.far,gm.near=1/0,imt(a.object.offsetObb!=null?a.object.offsetObb:a.object.obb,r,Qft,c=>{let u=emt;for(let d=0;d<cCe&&c.length>0;d++){if(!(a.mask&1<<d))continue;tmt(n[d],c,u);const p=c;c=u,u=p}for(let d=0;d<c.length;d+=3){oe(ol,c.data[d],c.data[d+1],c.data[d+2]);const p=me(zs(ol,ol,r),s);gm.near=Math.min(gm.near,p)}})===0&&(gm.near=0),wS(i,gm)}return V$.length=0,i}const V$=new It({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=null,t)}),gm=YR(),ol=C(),Av=C(),Qft=new It({deallocator:null}),emt=new It({deallocator:null});function tmt(t,e,i){i.length=0;const r=e.length-3;cz(ol,e,r);const n=ir(t,ol);n<=0&&(i.push(ol[0]),i.push(ol[1]),i.push(ol[2]));let s=0,o=n;for(;s<r;s+=3){cz(Av,e,s);const a=ir(t,Av);o*a<0&&(Ui(ol,Av,ol,a/(a-o)),al(i,ol)),a<=0&&al(i,Av),o=a,se(ol,Av)}o*n<0&&(cz(Av,e,r),Ui(ol,Av,ol,n/(n-o)),al(i,ol))}function cz(t,e,i){return oe(t,e.data[i],e.data[i+1],e.data[i+2])}function al(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2])}function imt(t,e,i,r){Db(Zae,t.quaternion),zs(Rc,e,t.center),bf(Rc,Rc,Zae);const n=8*((Rc[0]<-t.halfSize[0]?-1:Rc[0]>t.halfSize[0]?1:0)+3*(Rc[1]<-t.halfSize[1]?-1:Rc[1]>t.halfSize[1]?1:0)+9*(Rc[2]<-t.halfSize[2]?-1:Rc[2]>t.halfSize[2]?1:0)+13),s=Xae[n];if(s===0)return s;HW(G$,t.quaternion),jW(G$,G$,t.halfSize);const o=(a,l)=>{const c=Xae[n+l+1];return oe(a,((1&c)<<1)-1,(2&c)-1,((4&c)>>1)-1),Zl(a,a,G$),ce(a,t.center,a)};return i.length=0,al(i,o(uz,0)),al(i,o(Jae,1)),al(i,o(Rc,2)),al(i,o(Kae,3)),r(i),s===1||(i.length=0,al(i,uz),al(i,Kae),al(i,o(Rc,4)),al(i,o(Qae,5)),r(i),s===2||(i.length=0,al(i,uz),al(i,Qae),al(i,o(Rc,6)),al(i,Jae),r(i))),s}const Xae=(()=>{const t=new Array(216);let e=0;const i=r=>{for(let n=0;n<r.length;n++)t[e+n]=r[n];e+=8};return i([3,0,6,2,3,1,5,4]),i([2,0,2,3,1,5,4,0]),i([3,1,0,2,3,7,5,4]),i([2,0,1,3,2,6,4,0]),i([1,0,1,3,2,0,0,0]),i([2,1,5,7,3,2,0,0]),i([3,2,0,1,3,7,6,4]),i([2,2,0,1,3,7,6,0]),i([3,3,0,1,5,7,6,2]),i([2,0,1,5,4,6,2,0]),i([1,0,1,5,4,0,0,0]),i([2,1,3,7,5,4,0,0]),i([1,0,2,6,4,0,0,0]),i([0,0,0,0,0,0,0,0]),i([1,1,3,7,5,0,0,0]),i([2,2,3,7,6,4,0,0]),i([1,2,3,7,6,0,0,0]),i([2,3,1,5,7,6,2,0]),i([3,4,0,1,5,7,6,2]),i([2,5,7,6,4,0,1,0]),i([3,5,0,1,3,7,6,4]),i([2,4,5,7,6,2,0,0]),i([1,4,5,7,6,0,0,0]),i([2,5,1,3,7,6,4,0]),i([3,6,0,2,3,7,5,4]),i([2,6,2,3,7,5,4,0]),i([3,7,6,2,3,1,5,4]),t})(),cCe=4;function rmt(t,e){let i=0;for(let r=0;r<cCe;r++){const n=Qv(t,e[r]);if(n>0)return-1;n===0&&(i|=1<<r)}return i}const G$=Hr(),Zae=Sh(),Rc=C(),uz=C(),Jae=C(),Kae=C(),Qae=C();let nmt=class{constructor(e){this._objects=e}submit(e,i){this._objects.preSubmit(i),this._objects.visibleObjects.forAll(r=>r.renderable.material.submit(e,i,r))}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?Kft(e,this._objects.visibleObjects):null}};function smt(t){const e=Ir().vec3f(O.POSITION);return t.normals&&e.vec2i16(O.NORMALCOMPRESSED,{glNormalized:!0}),t.textureCoordinates===In.Default?e.vec2f(O.UV0):t.textureCoordinates===In.Atlas&&(e.vec2f(O.UV0),e.vec4u16(O.UVREGION,{glNormalized:!0})),t.colors&&e.vec4u8(O.COLOR,{glNormalized:!0}),e}let omt=class{constructor(){this.externalColor=Kt(),this.externalColorMixMode=ls.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}},amt=class extends Qr{constructor(e,i){super(e,"int",_i.Draw,(r,n,s)=>r.setUniform1i(e,i(n,s)))}};var Af;(function(t){t[t.Uniform=0]="Uniform",t[t.Varying=1]="Varying",t[t.COUNT=2]="COUNT"})(Af||(Af={}));const UZ=429496.7296;function uCe(t,e){RO(t/UZ*.5+.5,e)}function lmt(t,e){switch(e.componentData){case Af.Varying:return cmt(t,e);case Af.Uniform:return umt(t);case Af.COUNT:return;default:e.componentData}}function cmt(t,e){const{vertex:i,fragment:r}=t;i.include(Eh),i.uniforms.add(new oh("componentColorTex",s=>s.componentParameters.texture.texture)),t.attributes.add(O.COMPONENTINDEX,"float"),t.varyings.add("vExternalColorMixMode","mediump float"),t.varyings.add("vExternalColor","vec4");const n=e.output===U.ObjectAndLayerIdColor;n&&t.varyings.add("vObjectAndLayerIdColor","vec4"),t.include(axe),i.constants.add("elevationScale","float",2*UZ),i.constants.add("stride","float",ie("enable-feature:objectAndLayerId-rendering")?3:2),i.code.add(b`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),i.code.add(b`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${n?b`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:b`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),r.code.add(b`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${n?b`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function umt(t){const{vertex:e,fragment:i}=t;e.uniforms.add(new n5("externalColor",r=>r.componentParameters.externalColor)),i.uniforms.add(new amt("externalColorMixMode",r=>r.componentParameters.externalColorMixMode)),t.varyings.add("vExternalColor","vec4"),e.code.add(b`float readElevationOffset() {
return 0.0;
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),i.code.add(b`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}`)}var Yc;function hmt(t,e){const i=t.vertex;switch(i.code.add(b`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),e.vertexDiscardMode){case Yc.None:i.code.add(b`#define vertexDiscardByOpacity(_opacity_) {}`);break;case Yc.Opaque:i.code.add(b`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case Yc.Transparent:i.code.add(b`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case Yc.COUNT:break;default:e.vertexDiscardMode}}(function(t){t[t.None=0]="None",t[t.Transparent=1]="Transparent",t[t.Opaque=2]="Opaque",t[t.COUNT=3]="COUNT"})(Yc||(Yc={}));var Of;function b6t(t){return t&&Vf(t)?Of.Mars:t&&Gf(t)?Of.Moon:Of.Earth}(function(t){t[t.Earth=1]="Earth",t[t.Mars=2]="Mars",t[t.Moon=3]="Moon",t[t.COUNT=4]="COUNT"})(Of||(Of={}));var jc;(function(t){t[t.None=0]="None",t[t.NoOverlay=1]="NoOverlay",t[t.ColorOverlay=2]="ColorOverlay",t[t.ColorOverlayWithWater=3]="ColorOverlayWithWater",t[t.COUNT=4]="COUNT"})(jc||(jc={}));let ii=class extends bl{constructor(){super(...arguments),this.output=U.Color,this.textureCoordinateType=In.None,this.componentData=Af.Uniform,this.cullFace=dr.Back,this.vertexDiscardMode=Yc.None,this.doubleSidedMode=Kr.WindingOrder,this.alphaDiscardMode=Wi.Opaque,this.integratedMeshMode=jc.None,this.transparencyPassType=Qe.NONE,this.ellipsoidMode=Of.Earth,this.pbrMode=it.Disabled,this.normalType=Ei.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1}};h([V({count:U.COUNT})],ii.prototype,"output",void 0),h([V({count:In.COUNT})],ii.prototype,"textureCoordinateType",void 0),h([V({count:Af.COUNT})],ii.prototype,"componentData",void 0),h([V({count:dr.COUNT})],ii.prototype,"cullFace",void 0),h([V({count:Yc.COUNT})],ii.prototype,"vertexDiscardMode",void 0),h([V({count:Kr.COUNT})],ii.prototype,"doubleSidedMode",void 0),h([V({count:Wi.COUNT})],ii.prototype,"alphaDiscardMode",void 0),h([V({count:jc.COUNT})],ii.prototype,"integratedMeshMode",void 0),h([V({count:Qe.COUNT})],ii.prototype,"transparencyPassType",void 0),h([V({count:Of.COUNT})],ii.prototype,"ellipsoidMode",void 0),h([V({count:it.COUNT})],ii.prototype,"pbrMode",void 0),h([V({count:Ei.COUNT})],ii.prototype,"normalType",void 0),h([V()],ii.prototype,"spherical",void 0),h([V()],ii.prototype,"doublePrecisionRequiresObfuscation",void 0),h([V()],ii.prototype,"hasVertexColors",void 0),h([V()],ii.prototype,"hasNormals",void 0),h([V()],ii.prototype,"hasSlicePlane",void 0),h([V()],ii.prototype,"hasColorTexture",void 0),h([V()],ii.prototype,"receiveAmbientOcclusion",void 0),h([V()],ii.prototype,"receiveShadows",void 0),h([V()],ii.prototype,"blendingEnabled",void 0),h([V()],ii.prototype,"hasScreenSpaceReflections",void 0),h([V()],ii.prototype,"hasPolygonOffset",void 0),h([V()],ii.prototype,"hasMetallicRoughnessTexture",void 0),h([V()],ii.prototype,"hasEmissionTexture",void 0),h([V()],ii.prototype,"hasOcclusionTexture",void 0),h([V()],ii.prototype,"hasNormalTexture",void 0),h([V()],ii.prototype,"hasOccludees",void 0),h([V()],ii.prototype,"multipassEnabled",void 0),h([V()],ii.prototype,"cullAboveGround",void 0),h([V()],ii.prototype,"hasCloudsReflections",void 0),h([V()],ii.prototype,"snowCover",void 0),h([V()],ii.prototype,"objectAndLayerIdColor",void 0),h([V({constValue:!1})],ii.prototype,"occlusionPass",void 0),h([V({constValue:_i.Draw})],ii.prototype,"pbrTextureBindType",void 0),h([V({constValue:!0})],ii.prototype,"hasSliceHighlight",void 0),h([V({constValue:!1})],ii.prototype,"hasSliceInVertexProgram",void 0),h([V({constValue:!1})],ii.prototype,"useCustomDTRExponentForWater",void 0),h([V({constValue:!1})],ii.prototype,"hasVertexTangents",void 0),h([V({constValue:!0})],ii.prototype,"supportsTextureAtlas",void 0),h([V({constValue:!1})],ii.prototype,"highStepCount",void 0),h([V({constValue:!1})],ii.prototype,"instancedDoublePrecision",void 0),h([V({constValue:!1})],ii.prototype,"hasModelTransformation",void 0),h([V({constValue:!0})],ii.prototype,"useFillLights",void 0),h([V({constValue:!1})],ii.prototype,"objectAndLayerIdColorInstanced",void 0);function ele(t,e){t.include(gw,e),t.fragment.include(SO);const i=t.fragment;i.uniforms.add(new n5("baseColor",r=>r.baseColor)),i.uniforms.add(new ob("objectOpacity",r=>r.objectOpacity)),e.hasVertexColors?i.code.add(b`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):i.code.add(b`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),i.code.add(b`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function tle(t,e){const i=t.fragment;switch(e.doubleSidedMode){case Kr.None:i.code.add(b`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case Kr.View:t.include(hT,e),i.code.add(b`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case Kr.WindingOrder:i.code.add(b`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:e.doubleSidedMode;case Kr.COUNT:}switch(e.normalType){case Ei.Attribute:case Ei.Compressed:t.include(tk,e),i.code.add(b`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case Ei.ScreenDerivative:t.include(hT,e),i.code.add(b`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case Ei.Ground:e.spherical?(t.include(hT,e),i.code.add(b`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):i.code.add(b`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),i.code.add(b`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:e.normalType;case Ei.COUNT:}}function dmt(t,e){const i=t.fragment;if(e.hasColorTexture&&(e.output===U.Color||e.alphaDiscardMode!==Wi.Opaque)){t.include(yY,e);const r=e.textureCoordinateType===In.Atlas;i.uniforms.add(new oh("baseColorTexture",n=>n.texture)),r?(t.include(Eve),i.code.add(b`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, vuv0, vuvRegion);
}`)):i.code.add(b`vec4 readBaseColorTexture() {
return texture(baseColorTexture, vuv0);
}`)}else i.code.add(b`vec4 readBaseColorTexture() { return vec4(1.0); }`)}function pmt(t){const e=new mi;e.include(hT,t),e.include(tk,t),e.include(gw,t),e.include(xf,t),e.include(qS,t),e.include(lmt,t),e.include(uKe,t),e.include(gZe,t),e.include(dmt,t),e.include(hmt,t);const{vertex:i,fragment:r}=e;t.pbrMode!==it.Normal&&t.pbrMode!==it.Schematic||(e.include(vY,t),t.hasNormalTexture&&e.include(dxe,t));const n=t.output===U.Shadow||t.output===U.ShadowHighlight||t.output===U.ShadowExcludeHighlight;n&&t.componentData===Af.Varying?i.code.add(b`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):i.code.add(b`#define discardShadows(castShadows) {}`);const s=t.integratedMeshMode===jc.ColorOverlay||t.integratedMeshMode===jc.ColorOverlayWithWater,o=s&&t.output===U.Color&&t.pbrMode===it.WaterOnIntegratedMesh;return s&&(e.include(Vb,t),e.include(Get,t),t.spherical?i.code.add(b`
      const float invEllipsoidRadius = ${b.float(1/(t.ellipsoidMode===Of.Earth?yi.radius:t.ellipsoidMode===Of.Mars?vf.radius:wg.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):i.code.add(b`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),o&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3")),i.code.add(b`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${t.output===U.ObjectAndLayerIdColor?b`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${b.float(co)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${t.output===U.ObjectAndLayerIdColor?b`forwardObjectAndLayerIdColor();`:""}
      ${o?t.spherical?b`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:b`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${s?b`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),t.output===U.Alpha&&(r.include(vh),e.include(uc,t),e.include(ele,t),s&&r.uniforms.add(new Je("ovColorTex",(a,l)=>oj(a,l))),r.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.multipassEnabled?b`terrainDepthTest(vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?b`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        fragColor = vec4(materialColor.a);
      }
    `)),t.output===U.Color&&(r.include(vh),e.include(uc,t),e.include(ele,t),e.include(tle,t),e.include(Vb,t),t.receiveShadows?(e.include(nk,t),r.code.add(b`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):r.code.add(b`float evaluateShadow() { return 0.0; }`),s&&r.uniforms.add(new Je("ovColorTex",(a,l)=>oj(a,l))),r.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.multipassEnabled?b`terrainDepthTest(vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?b`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),t.pbrMode===it.Normal||t.pbrMode===it.Schematic?(Wf(r),r.code.add(b`
        ${t.pbrMode===it.Normal?b`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),t.hasNormalTexture?r.code.add(b`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):r.code.add(b`vec3 shadingNormal = normalVertex;`),r.code.add(b`${t.spherical?b`vec3 normalGround = normalize(positionWorld());`:b`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),r.code.add(b`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * evaluateAmbientOcclusionInverse();

        ${t.snowCover?b`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${s?b` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(t.receiveShadows?r.code.add(b`float shadow = evaluateShadow();`):t.spherical?(JS(r),r.code.add(b`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):r.code.add(b`float shadow = 0.0;`),o&&r.uniforms.add(new Je("ovNormalTex",(a,l)=>l.overlay?.getTexture($r.WaterNormal))),t.snowCover&&r.code.add(b`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`),r.code.add(b`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${s?b` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${o?b`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),r.code.add(b`
        fragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${t.transparencyPassType===Qe.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `)),(t.output===U.Depth||n)&&(e.include(Mg,t),r.code.add(b`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),t.output===U.Normal&&(e.include(tle,t),r.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material to influence ambient occlusion,
        // see the ssao fragment shader
        float alpha = ${t.normalType===Ei.Ground?"0.0":"1.0"};
        fragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),t.output===U.ObjectAndLayerIdColor&&e.fragment.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${s?b`fragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `),t.output===U.Highlight&&(e.include(I_),r.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${s?b`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  fragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),e}const fmt=Object.freeze(Object.defineProperty({__proto__:null,build:pmt},Symbol.toStringTag,{value:"Module"}));let hCe=class dCe extends Ci{initializeConfiguration(e,i){i.spherical=e.viewingMode===Me.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new wi(e.rctx,dCe.shader.get().build(this.configuration),pCe)}_setPipelineState(e){const i=this.configuration,r=i.integratedMeshMode!==jc.None,n=e===Qe.NONE,s=e===Qe.FrontFace;return Ot({blending:i.output!==U.Color&&i.output!==U.Alpha||!i.blendingEnabled?null:n?su:Wg(e),culling:CF(i.cullFace),depthTest:{func:L_(e)},depthWrite:n||s?_l:null,colorWrite:Ft,stencilWrite:r||i.hasOccludees?Ff:null,stencilTest:r?nKe(gl.IntegratedMeshMaskExcluded):i.hasOccludees?D_:null,polygonOffset:n||s?i.hasPolygonOffset?{factor:2,units:2}:null:JF})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};hCe.shader=new bi(fmt,()=>pe(()=>import("./ComponentShader.glsl-aef12a6f.js"),[],import.meta.url));const pCe=new Map([[O.POSITION,0],[O.NORMAL,1],[O.NORMALCOMPRESSED,1],[O.COLOR,2],[O.UV0,3],[O.UVREGION,4],[O.COMPONENTINDEX,5]]);let mmt=class extends Ki{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},zZ=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function nn(t={}){return(e,i)=>{const r=e._parameterCount??0;if(e._parameterCount=r+1,t.vectorOps){const n=t.vectorOps;Object.defineProperty(e,i,{get(){return this[r]},set(s){const o=this[r];if(o==null)this[r]=s;else{if(n.equals(o,s))return;n.copy(o,s)}this._setDirty()}})}else Object.defineProperty(e,i,{get(){return this[r]},set(n){this[r]!==n&&(t.dispose&&this[r]&&this[r].dispose(),this[r]=n,this._setDirty())}})}}function ile(){return(t,e)=>{const i=t._parameterCount??0;t._parameterCount=i+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(i),Object.defineProperty(t,e,{get(){return this[i]},set(r){this[i]!==r&&(this[i]=r,this._setDirty())}})}}let Tk=class{constructor(e){this._low=C(),this._high=C(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){se(this._low,se(rle,e));const i=zs(rle,e,this._low);se(this._high,i)}get(e){return ce(e,this._low,this._high)}getLowScaled(e){return te(e,this._low,1)}};const rle=mn();let Ms=class extends mmt{constructor(e,i){super(),this.toMapSpace=i,this.baseColor=Mt(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=Xo(ik),this.emissiveFactor=Ce(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new tD,this.componentParameters=new L3,this.textureAlphaCutoff=XN,this.alphaDiscardMode=Wi.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=Of.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new ii;const r=new Tk(e.position),n=vxe(e.rotationScale);uw(n,n),this.transformNormalGlobalFromModel=d0e(yh(n,n)),this.transformWorldFromModelTL=r.low,this.transformWorldFromModelTH=r.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this._technique=Jt(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return this.baseColorTexture!=null?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return this.metallicRoughnessTexture!=null?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return this.emissionTexture!=null?this.emissionTexture.glTexture:null}get textureOcclusion(){return this.occlusionTexture!=null?this.occlusionTexture.glTexture:null}get textureNormal(){return this.normalTexture!=null?this.normalTexture.glTexture:null}prepareTechnique(e,i,r,n){const s=this._techniqueConfiguration;s.hasVertexColors=n.colors,s.hasNormals=n.normals,s.textureCoordinateType=n.textureCoordinates,s.hasMetallicRoughnessTexture=this.metallicRoughnessTexture!=null,s.hasEmissionTexture=this.emissionTexture!=null,s.hasOcclusionTexture=this.occlusionTexture!=null,s.hasNormalTexture=this.normalTexture!=null,s.transparencyPassType=i.identifier===Xl.Material&&r.transparencyPassType!=null?r.transparencyPassType:Qe.NONE,s.multipassEnabled=i.identifier===Xl.Material&&r.multipassEnabled,s.cullAboveGround=i.identifier===Xl.Material&&r.multipassTerrain.cullAboveGround,s.ellipsoidMode=this.ellipsoidMode,s.componentData=this.componentParameters.type,s.cullFace=this.commonMaterialParameters.cullFace,s.doubleSidedMode=this.commonMaterialParameters.doubleSided?Kr.View:Kr.None,s.hasColorTexture=this.baseColorTexture!=null;const o=this._computeWhichMaterialPass();if(s.blendingEnabled=o===Ca.Transparent||o===Ca.OpaqueAndTransparent,s.alphaDiscardMode=this.alphaDiscardMode,s.integratedMeshMode=this.isIntegratedMesh?_mt(r)?ymt(r)?jc.ColorOverlayWithWater:jc.ColorOverlay:jc.NoOverlay:jc.None,s.hasPolygonOffset=this.polygonOffsetEnabled,s.pbrMode=s.integratedMeshMode===jc.ColorOverlayWithWater?it.WaterOnIntegratedMesh:this.usePBR?this.hasParametersFromSource?it.Schematic:it.Normal:it.Disabled,s.normalType=s.integratedMeshMode===jc.None?s.hasNormals?Ei.Compressed:Ei.ScreenDerivative:Ei.Ground,s.hasSlicePlane=r.slicePlane!=null&&this.commonMaterialParameters.hasSlicePlane,i.identifier===Xl.ShadowMap)s.output=U.Shadow,s.vertexDiscardMode=Yc.None;else if(i.identifier===Xl.Highlight)s.output=U.Highlight,s.vertexDiscardMode=Yc.None;else{switch(o===Ca.OpaqueAndTransparent?s.vertexDiscardMode=i.transparent?Yc.Opaque:Yc.Transparent:s.vertexDiscardMode=Yc.None,s.output=i.output,s.receiveAmbientOcclusion=!1,s.receiveShadows=!1,i.output){case U.Color:s.receiveAmbientOcclusion=r.ssao!=null,s.hasOccludees=r.hasOccludees,s.receiveShadows=r.shadowMap.ready,s.hasScreenSpaceReflections=r.ssr.lastFrameColor!=null,s.hasCloudsReflections=r.cloudsFade.data!=null;break;case U.Alpha:s.hasOccludees=r.hasOccludees;break;case U.ObjectAndLayerIdColor:s.objectAndLayerIdColor=!0}s.snowCover=this.hasSnowCover(r)}return this._technique=e.releaseAndAcquire(hCe,s,this._technique),this._setClean(),this._technique}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}submit(e,i,r){if(this.objectOpacity===0)return;const n=r.renderable.geometry,s=r.components,o=r.renderable.meta.cameraDepthSquared,a=s.geometryRanges,l=s.highlightRanges,c=s.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case Ca.Opaque:e.materialOpaque.submitDraw(this,n,a,o);break;case Ca.Transparent:e.materialTransparent.submitDraw(this,n,a,o);break;case Ca.OpaqueAndTransparent:e.materialOpaque.submitDraw(this,n,a,o),e.materialTransparent.submitDraw(this,n,a,o);break;case Ca.IntegratedMesh:e.materialIntegratedMesh.submitDraw(this,n,a,o),gmt(i)&&e.highlightIntegratedMesh.submitDraw(this,n,a,o)}const u=this.componentParameters.castShadows!==ys.None;u&&e.shadowMap.submitDraw(this,n,a,o),l!=null&&(e.highlight.submitDraw(this,n,l,o),u&&e.highlightShadowMap.submitDraw(this,n,l,o)),u&&c!=null&&e.defaultShadowMap.submitDraw(this,n,c,o)}_computeWhichMaterialPass(){return this.isIntegratedMesh?Ca.IntegratedMesh:this.objectOpacity<1?Ca.Transparent:this.componentParameters.opaqueOverride===ys.All?Ca.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===Wi.Blend||this.alphaDiscardMode===Wi.MaskBlend?Ca.Transparent:this.componentParameters.transparent===ys.None?Ca.Opaque:this.componentParameters.transparent===ys.All?Ca.Transparent:Ca.OpaqueAndTransparent}};var Ca,ys;h([nn({vectorOps:Kde})],Ms.prototype,"baseColor",void 0),h([nn()],Ms.prototype,"usePBR",void 0),h([nn()],Ms.prototype,"hasParametersFromSource",void 0),h([nn({vectorOps:mK})],Ms.prototype,"mrrFactors",void 0),h([nn({vectorOps:mK})],Ms.prototype,"emissiveFactor",void 0),h([nn({dispose:!0})],Ms.prototype,"baseColorTexture",void 0),h([nn({dispose:!0})],Ms.prototype,"metallicRoughnessTexture",void 0),h([nn({dispose:!0})],Ms.prototype,"emissionTexture",void 0),h([nn({dispose:!0})],Ms.prototype,"occlusionTexture",void 0),h([nn({dispose:!0})],Ms.prototype,"normalTexture",void 0),h([nn()],Ms.prototype,"objectOpacity",void 0),h([ile()],Ms.prototype,"commonMaterialParameters",void 0),h([ile()],Ms.prototype,"componentParameters",void 0),h([nn()],Ms.prototype,"textureAlphaCutoff",void 0),h([nn()],Ms.prototype,"alphaDiscardMode",void 0),h([nn()],Ms.prototype,"isIntegratedMesh",void 0),h([nn()],Ms.prototype,"polygonOffsetEnabled",void 0),h([nn()],Ms.prototype,"ellipsoidMode",void 0),h([nn()],Ms.prototype,"hasOccludees",void 0),function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.OpaqueAndTransparent=2]="OpaqueAndTransparent",t[t.IntegratedMesh=3]="IntegratedMesh"}(Ca||(Ca={}));let tD=class extends zZ{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=dr.Back,this.hasSlicePlane=!0}};h([nn()],tD.prototype,"doubleSided",void 0),h([nn()],tD.prototype,"cullFace",void 0),h([nn()],tD.prototype,"hasSlicePlane",void 0);let L3=class extends zZ{constructor(){super(...arguments),this.externalColor=Mt(1,1,1,1),this.externalColorMixMode=ls.Multiply,this.castShadows=ys.All}get transparent(){return this.externalColor[3]<1?ys.All:ys.None}get opaqueOverride(){return this.externalColorMixMode===ls.Replace&&this.externalColor[3]===1?ys.All:ys.None}get visible(){return this.externalColor[3]>0?ys.All:ys.None}get type(){return Af.Uniform}};h([nn({vectorOps:Kde})],L3.prototype,"externalColor",void 0),h([nn()],L3.prototype,"externalColorMixMode",void 0),h([nn()],L3.prototype,"castShadows",void 0),function(t){t[t.All=0]="All",t[t.Some=1]="Some",t[t.None=2]="None"}(ys||(ys={}));let MA=class extends zZ{constructor(){super(...arguments),this.texture=null,this.transparent=ys.None,this.opaqueOverride=ys.None,this.castShadows=ys.None}get type(){return Af.Varying}};function gmt(t){return t.overlay?.getTexture($r.Highlight)!=null}function ymt(t){return t.overlay?.getTexture($r.WaterNormal)!=null}function _mt(t){return t.overlay?.getTexture($r.ColorNoRasterImage)!=null}h([nn()],MA.prototype,"texture",void 0),h([nn()],MA.prototype,"transparent",void 0),h([nn()],MA.prototype,"opaqueOverride",void 0),h([nn()],MA.prototype,"castShadows",void 0);const E5=Ir().vec3f(O.POSITION).u16(O.COMPONENTINDEX),fCe=Ir().vec2u8(O.SIDENESS),vmt=pc(fCe),jj=Ir().vec3f(O.POSITION0).vec3f(O.POSITION1).vec3f(O.NORMAL).u16(O.COMPONENTINDEX).u8(O.VARIANTOFFSET,{glNormalized:!0}).u8(O.VARIANTSTROKE).u8(O.VARIANTEXTENSION,{glNormalized:!0}),Hj=Ir().vec3f(O.POSITION0).vec3f(O.POSITION1).vec3f(O.NORMALA).vec3f(O.NORMALB).u16(O.COMPONENTINDEX).u8(O.VARIANTOFFSET,{glNormalized:!0}).u8(O.VARIANTSTROKE).u8(O.VARIANTEXTENSION,{glNormalized:!0}),mCe=new Map([[O.POSITION0,0],[O.POSITION1,1],[O.COMPONENTINDEX,2],[O.VARIANTOFFSET,3],[O.VARIANTSTROKE,4],[O.VARIANTEXTENSION,5],[O.NORMAL,6],[O.NORMALA,6],[O.NORMALB,7],[O.SIDENESS,8]]);function nle(t,e,i){const r=e/3,n=new Uint32Array(i+1),s=new Uint32Array(i+1),o=(w,x)=>{w<x?n[w+1]++:s[x+1]++};for(let w=0;w<r;w++){const x=t[3*w],T=t[3*w+1],S=t[3*w+2];o(x,T),o(T,S),o(S,x)}let a=0,l=0;for(let w=0;w<i;w++){const x=n[w+1],T=s[w+1];n[w+1]=a,s[w+1]=l,a+=x,l+=T}const c=new Uint32Array(6*r),u=n[i],d=(w,x,T)=>{if(w<x){const S=n[w+1]++;c[2*S]=x,c[2*S+1]=T}else{const S=s[x+1]++;c[2*u+2*S]=w,c[2*u+2*S+1]=T}};for(let w=0;w<r;w++){const x=t[3*w],T=t[3*w+1],S=t[3*w+2];d(x,T,w),d(T,S,w),d(S,x,w)}const p=(w,x)=>{const T=2*w,S=x-w;for(let E=1;E<S;E++){const A=c[T+2*E],P=c[T+2*E+1];let N=E-1;for(;N>=0&&c[T+2*N]>A;N--)c[T+2*N+2]=c[T+2*N],c[T+2*N+3]=c[T+2*N+1];c[T+2*N+2]=A,c[T+2*N+3]=P}};for(let w=0;w<i;w++)p(n[w],n[w+1]),p(u+s[w],u+s[w+1]);const m=new Int32Array(3*r),y=(w,x)=>w===t[3*x]?0:w===t[3*x+1]?1:w===t[3*x+2]?2:-1,_=(w,x)=>{const T=y(w,x);m[3*x+T]=-1},v=(w,x,T,S)=>{const E=y(w,x);m[3*x+E]=S;const A=y(T,S);m[3*S+A]=x};for(let w=0;w<i;w++){let x=n[w];const T=n[w+1];let S=s[w];const E=s[w+1];for(;x<T&&S<E;){const A=c[2*x],P=c[2*u+2*S];A===P?(v(w,c[2*x+1],P,c[2*u+2*S+1]),x++,S++):A<P?(_(w,c[2*x+1]),x++):(_(P,c[2*u+2*S+1]),S++)}for(;x<T;)_(w,c[2*x+1]),x++;for(;S<E;)_(c[2*u+2*S],c[2*u+2*S+1]),S++}return m}let gCe=class{updateSettings(e){this.settings=e,this._edgeHashFunction=e.reducedPrecision?wmt:bmt}write(e,i,r){const n=this._edgeHashFunction(r);H$.seed=n;const s=H$.getIntRange(0,255),o=H$.getIntRange(0,this.settings.variants-1),a=.7,l=H$.getFloat(),c=255*(.5*xmt(-(1-Math.min(l/a,1))+Math.max(0,l-a)/(1-a),1.2)+.5);e.position0.setVec(i,r.position0),e.position1.setVec(i,r.position1),e.componentIndex.set(i,r.componentIndex),e.variantOffset.set(i,s),e.variantStroke.set(i,o),e.variantExtension.set(i,c)}trim(e,i){return e.slice(0,i)}};const BZ=new Float32Array(6),C5=new Uint32Array(BZ.buffer),Vy=new Uint32Array(1);function bmt(t){const e=BZ;e[0]=t.position0[0],e[1]=t.position0[1],e[2]=t.position0[2],e[3]=t.position1[0],e[4]=t.position1[1],e[5]=t.position1[2],Vy[0]=5381;for(let i=0;i<C5.length;i++)Vy[0]=31*Vy[0]+C5[i];return Vy[0]}function wmt(t){const e=BZ;e[0]=Ox(t.position0[0]),e[1]=Ox(t.position0[1]),e[2]=Ox(t.position0[2]),e[3]=Ox(t.position1[0]),e[4]=Ox(t.position1[1]),e[5]=Ox(t.position1[2]),Vy[0]=5381;for(let i=0;i<C5.length;i++)Vy[0]=31*Vy[0]+C5[i];return Vy[0]}const sle=1e4;function Ox(t){return Math.round(t*sle)/sle}function xmt(t,e){const i=t<0?-1:1;return Math.abs(t)**e*i}let A5=class{constructor(){this._commonWriter=new gCe}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return jj.createBuffer(e)}write(e,i,r){this._commonWriter.write(e,i,r),ce(j$,r.faceNormal0,r.faceNormal1),ge(j$,j$),e.normal.setVec(i,j$)}trim(e,i){return this._commonWriter.trim(e,i)}};A5.Layout=jj,A5.glLayout=pc(jj,1);let O5=class{constructor(){this._commonWriter=new gCe}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return Hj.createBuffer(e)}write(e,i,r){this._commonWriter.write(e,i,r),e.normalA.setVec(i,r.faceNormal0),e.normalB.setVec(i,r.faceNormal1)}trim(e,i){return this._commonWriter.trim(e,i)}};O5.Layout=Hj,O5.glLayout=pc(Hj,1);const j$=C(),H$=new NA,m1=-1;var R5;function Tmt(t,e,i,r=Rmt){const n=t.vertices.position,s=t.vertices.componentIndex,o=Rt(r.anglePlanar),a=Rt(r.angleSignificantEdge),l=Math.cos(a),c=Math.cos(o),u=qj.edge,d=u.position0,p=u.position1,m=u.faceNormal0,y=u.faceNormal1,_=Omt(t),v=Amt(t),w=v.length/4,x=e.allocate(w);let T=0;const S=w,E=i.allocate(S);let A=0,P=0,N=0;const F=bOe(0,w),D=new Float32Array(w);D.forEach((j,X,M)=>{n.getVec(v[4*X],d),n.getVec(v[4*X+1],p),M[X]=br(d,p)}),F.sort((j,X)=>D[X]-D[j]);const $=new Array,R=new Array;for(let j=0;j<w;j++){const X=F[j],M=D[X],I=v[4*X],G=v[4*X+1],q=v[4*X+2],Z=v[4*X+3],K=Z===m1;if(n.getVec(I,d),n.getVec(G,p),K)oe(m,_[3*q],_[3*q+1],_[3*q+2]),se(y,m),u.componentIndex=s.get(I),u.cosAngle=me(m,y);else{if(oe(m,_[3*q],_[3*q+1],_[3*q+2]),oe(y,_[3*Z],_[3*Z+1],_[3*Z+2]),u.componentIndex=s.get(I),u.cosAngle=me(m,y),Emt(u,c))continue;u.cosAngle<-.9999&&se(y,m)}P+=M,N++,K||Smt(u,l)?(e.write(x,T++,u),$.push(M)):Cmt(u,o)&&(i.write(E,A++,u),R.push(M))}const k=new Float32Array($.reverse()),B=new Float32Array(R.reverse());return{regular:{instancesData:e.trim(x,T),lodInfo:{lengths:k}},silhouette:{instancesData:i.trim(E,A),lodInfo:{lengths:B}},averageEdgeLength:P/N}}function Smt(t,e){return t.cosAngle<e}function Emt(t,e){return t.cosAngle>e}function Cmt(t,e){const i=xs(t.cosAngle),r=qj.fwd,n=qj.ortho;return Ng(r,t.position1,t.position0),i*(me(nt(n,t.faceNormal0,t.faceNormal1),r)>0?-1:1)>e}function Amt(t){const e=t.faces.length/3,i=t.faces,r=t.neighbors;let n=0;for(let a=0;a<e;a++){const l=r[3*a],c=r[3*a+1],u=r[3*a+2],d=i[3*a],p=i[3*a+1],m=i[3*a+2];n+=l===m1||d<p?1:0,n+=c===m1||p<m?1:0,n+=u===m1||m<d?1:0}const s=new Int32Array(4*n);let o=0;for(let a=0;a<e;a++){const l=r[3*a],c=r[3*a+1],u=r[3*a+2],d=i[3*a],p=i[3*a+1],m=i[3*a+2];(l===m1||d<p)&&(s[o++]=d,s[o++]=p,s[o++]=a,s[o++]=l),(c===m1||p<m)&&(s[o++]=p,s[o++]=m,s[o++]=a,s[o++]=c),(u===m1||m<d)&&(s[o++]=m,s[o++]=d,s[o++]=a,s[o++]=u)}return s}function Omt(t){const e=t.faces.length/3,i=t.vertices.position,r=t.faces,n=hz.v0,s=hz.v1,o=hz.v2,a=new Float32Array(3*e);for(let l=0;l<e;l++){const c=r[3*l],u=r[3*l+1],d=r[3*l+2];i.getVec(c,n),i.getVec(u,s),i.getVec(d,o),he(s,s,n),he(o,o,n),nt(n,s,o),ge(n,n),a[3*l]=n[0],a[3*l+1]=n[1],a[3*l+2]=n[2]}return a}(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH"})(R5||(R5={}));const qj={edge:{position0:C(),position1:C(),faceNormal0:C(),faceNormal1:C(),componentIndex:0,cosAngle:0},ortho:C(),fwd:C()},hz={v0:C(),v1:C(),v2:C()},Rmt={anglePlanar:4,angleSignificantEdge:35};function Pmt(t){const e=Mmt(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return ole.updateSettings(t.writerSettings),ale.updateSettings(t.writerSettings),Tmt(e,ole,ale)}function Mmt(t,e,i,r){if(e){const o=nle(i,r,t.count);return new $mt(i,r,o,t)}const n=nj(t.buffer,t.stride/4,{originalIndices:i,originalIndicesLength:r}),s=nle(n.indices,r,n.uniqueCount);return{faces:n.indices,facesLength:n.indices.length,neighbors:s,vertices:E5.createView(n.buffer)}}let $mt=class{constructor(e,i,r,n){this.faces=e,this.facesLength=i,this.neighbors=r,this.vertices=n}};const ole=new A5,ale=new O5,I6t=Ir().vec3f(O.POSITION0).vec3f(O.POSITION1),Imt=Ir().vec3f(O.POSITION0).vec3f(O.POSITION1).u16(O.COMPONENTINDEX);let Lmt=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},Dmt=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this.textureWidth=4096,this._dirty=!0;const r=new Li(this.textureWidth,1);r.samplingMode=Lt.NEAREST,r.wrapMode=Nt.CLAMP_TO_EDGE,this._texture=new Pt(this._rctx,r),this._data=new la(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,i,r,n,s,o){const a=e*this._fieldCount+i;this._dirty=!0,this._data.set(a,0,r),this._data.set(a,1,n),this._data.set(a,2,s),this._data.set(a,3,o)}setDataElement(e,i,r,n){const s=e*this._fieldCount+i;this._dirty=!0,this._data.set(s,r,n)}getDataElement(e,i,r){const n=e*this._fieldCount+i;return this._dirty=!0,this._data.get(n,r)}resizeToFit(e){const i=(e+1)*this._fieldCount;if(i>this._data.count){const r=Math.ceil(i/this.textureWidth)*this.textureWidth,n=new la(new ArrayBuffer(4*r));n.typedBuffer.set(this._data.typedBuffer),this._data=n}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,i=this._texture.descriptor.height;this._data.count>e*i&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const yCe=65536;let Nmt=class{constructor(e,i=1){this.textureBuffer=new Dmt(e,i),this._indexManager=new Lmt(yCe)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},_Ce=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const r of this._buffers)if(r.availableCount>=e)return r;if(e>yCe)return null;const i=new Nmt(this._rctx,this._fieldCount);return this._buffers.push(i),i}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const lle=ne.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");let Fmt=class{constructor(e,i){this._renderManager=e,this._viewingMode=i,this._objects=[new It,new It],this._renderSubmit=new nmt(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=ie("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new _Ce(e.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){Ke(this._objects[xT.Hidden].length===0&&this._objects[xT.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy();const e=this._objects.flatMap(i=>i.toArray());for(const i of e)i?.destroy()}createObject(e){const i=new PA;return i.toMapSpace=e.toMapSpace,i.transform=e.transform,i.obb=Cee(e.obb),i.components=new Uft(this._componentBufferManager,Sf(e.geometry.componentOffsets)),i.renderable=this._createRenderable(e,i.components),i.intersectionGeometry=new qft(e.geometry.positionData,i.components),this._objects[i.visible].push(i),i}destroyObject(e){const i=e;this._objects[i.visible].removeUnordered(i),i.destroy(),this._notifyDirty()}setObjectVisibility(e,i){const r=e;i!==r.visible&&(this._objects[r.visible].removeUnordered(r),this._objects[i].push(r),r.visible=i,this._notifyDirty())}preSubmit(e){const i=e.camera.eye;this.visibleObjects.forAll(r=>r.renderable.meta.cameraDepthSquared=bs(i,r.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,i){const r=e.renderable.material;i(r),r.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,i){const r=e;r.components.visibility.reset(i),r.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,i){return e.components.visibility.forEachComponent(i)}getComponentCount(e){const i=e,r=i.components.visibility.componentCount();return{visible:r,invisible:i.components.count-r}}setComponentData(e,i){const r=e,n=r.renderable.material,s=r.components,o=s.materialDataBuffer,a=s.materialDataIndices,l=new omt,c=o.textureBuffer,u=new Uint8Array(4),d=new Uint32Array(u.buffer);let p=0,m=0,y=0,_=s.verticalOffsets,v=1/0,w=-1/0,x=!1,T=!1,S=0;for(let E=0;E<s.count;E++){i(E,l),p+=+(l.externalColor[3]<1),m+=+(l.externalColorMixMode===ls.Replace&&l.externalColor[3]===1),y+=+l.castShadows,oxe(l.externalColor,l.externalColorMixMode,u),u[2]=254&u[2]|+l.castShadows,c.setData(a[E],0,u[0],u[1],u[2],u[3]),x||(x=E>0&&S!==d[0]),S=d[0],T||(T=l.elevationOffset!==0),T&&_==null&&(_=new Array(E).fill(0)),_!=null&&(_[E]=l.elevationOffset),v=Math.min(v,l.elevationOffset),w=Math.max(w,l.elevationOffset),uCe(l.elevationOffset,u),c.setData(a[E],1,u[0],u[1],u[2],u[3]);const A=l.objectAndLayerIdColor;A!=null&&c.setData(a[E],2,A[0],A[1],A[2],A[3]),l.pickable!==aCe(s.pickability,E)&&(s.pickability=Bft(s.pickability,s.count,E,l.pickable))}s.verticalOffsets=T?_:null,r.offsetObb=T?kye(r.obb,v,w,this._viewingMode,r.offsetObb!=null?r.offsetObb:Cee(r.obb)):null,x||T||this._hasObjectAndLayerId?(n.componentParameters=new MA,n.componentParameters.castShadows=dz(y,s.count),n.componentParameters.transparent=dz(p,s.count),n.componentParameters.opaqueOverride=dz(m,s.count),n.componentParameters.texture=c,c.updateTexture()):(n.componentParameters=new L3,n.componentParameters.castShadows=l.castShadows?ys.All:ys.None,n.componentParameters.externalColor=l.externalColor,n.componentParameters.externalColorMixMode=l.externalColorMixMode),this._notifyDirty()}getComponentAabb(e,i,r,n=!1){e.intersectionGeometry.getComponentAabb(i,r);const s=e,o=s.components.verticalOffsets;if(n||o==null)return r;const a=o[i];if(this._viewingMode===Me.Local||a===0)return r[2]+=a,r[5]+=a,r;const l=o9e(a);return l.localOrigin=s.transform.position,l.applyToAabb(r)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,i,r){return e.intersectionGeometry.getComponentPositions(i,r)}intersect(e,i,r,n,s,o){const a=e;s!=null&&(s.localOrigin=a.transform.position);const l=uw(cle,a.transform.rotationScale);zs(q$,i,a.transform.position),zs(W$,r,a.transform.position),Zl(q$,q$,l),Zl(W$,W$,l);const c=yh(cle,l);return a.intersectionGeometry.intersect(q$,W$,n,c,s,a.components.verticalOffsets,o)}addEdges(e,i,r,n){const s=e,{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets;return i.addComponentObject(e,s.transform,{center:s.obb.center,radius:t9e(s.obb)},a,o,l,r,n)}async extractEdgeInformation(e,i,r){const n=e,s=n.components.visibility;if(s.allInvisible())return{buffer:Imt.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets,c=E5.createBuffer(a.length/3);WR(c.position.typedBuffer,a,c.position.typedBufferStride,3),c2e(c.position,c.position,n.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const u=c.count,d=this._computeVisibilityIndices(o,s,l,u);return{origin:Br(n.transform.position),buffer:await i.extractComponentsEdgeLocations({indices:d,indicesLength:d.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},r)}}_setComponentIndices(e,i,r){let n=0;for(let s=0;s<r.length-1;s++){const o=r[s],a=r[s+1];for(let l=o;l<a;l++){const c=i?i[l]:l;e.set(c,n)}n++}}_computeVisibilityIndices(e,i,r,n){if(e&&i.allVisible())return e;let s=0;i.forEachComponentRange((l,c)=>(s+=r[c]-r[l],!0));const o=uh(e)?new Array(s):e?.BYTES_PER_ELEMENT===2||n<=65536?new Uint16Array(s):new Uint32Array(s);let a=0;return i.forEachComponentRange((l,c)=>{const u=r[l],d=r[c];for(let p=u;p<d;p++)o[a++]=e?e[p]:p;return!0}),o}addComponentHighlight(e,i){const r=e.components;r.highlightCounts==null&&(r.highlightCounts=new Uint32Array(r.count+1)),r.highlightCounts[i]++===0&&(r.highlightsDirty(),this._notifyDirty()),r.highlightCounts[r.count]++}removeComponentHighlight(e,i){const r=e.components;if(r.highlightCounts==null)return void lle.warn("Removing non-existing highlight.");const n=r.highlightCounts[i],s=r.highlightCounts[r.count];if(n!==0){if(n>1)return r.highlightCounts[i]=n-1,void(r.highlightCounts[r.count]=s-1);r.highlightCounts[i]=0,r.highlightsDirty(),this._notifyDirty(),s===1?r.highlightCounts=null:r.highlightCounts[r.count]=s-1}else lle.warn("Removing non-existing highlight.")}clearHighlights(e){const i=e.components;i.highlightCounts!=null&&(i.highlightCounts=null,i.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[xT.Visible]}_createRenderable(e,i){const r=this._renderManager.rctx,n=e.geometry,s=n.vertices.layoutParameters,o=Ri.createVertex(r,vi.STATIC_DRAW,n.vertices.data),a=n.indices?Ri.createIndex(r,vi.STATIC_DRAW,n.indices):null,l=pc(smt(s)),c=new Uint16Array(n.vertices.count);for(let _=0;_<i.count;_++){const v=i.offsets[_],w=i.offsets[_+1],x=i.materialDataIndices[_];if(n.indices!=null)for(let T=v;T<w;T++)c[n.indices[T]]=x;else for(let T=v;T<w;T++)c[T]=x}const u=Ri.createVertex(r,vi.STATIC_DRAW,c.buffer),d=new Ms(e.transform,e.toMapSpace),p=new bh(r,pCe,{data:l,componentIndices:kmt},{data:o,componentIndices:u},a),m=new Zft(p,Qt.TRIANGLES,s,a!=null),y={cameraDepthSquared:.5,gpuMemoryEstimate:o.byteLength+u.byteLength+(a!=null?a.byteLength:0)};return new Xft(d,m,y)}_notifyDirty(){this._renderManager.notifyDirty()}};const kmt=pc(Ir().u16(O.COMPONENTINDEX));function dz(t,e){return t===e?ys.All:t===0?ys.None:ys.Some}const cle=sa(),q$=C(),W$=C();let VZ=class extends Ki{constructor(){super(...arguments),this.opacity=1}};function Umt(t){const e=new mi;return e.include(ha),e.fragment.uniforms.add(new Je("tex",i=>i.texture)),t.hasOpacityFactor&&e.fragment.uniforms.add(new Oe("opacity",i=>i.opacity)),e.fragment.code.add(b`
    void main() {
      fragColor = texture(tex, uv) ${t.hasOpacityFactor?"* opacity":""};
    }`),e}const zmt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:VZ,build:Umt},Symbol.toStringTag,{value:"Module"}));var Jo;(function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.PremultipliedAlpha=2]="PremultipliedAlpha",t[t.COUNT=3]="COUNT"})(Jo||(Jo={}));let P5=class extends bl{constructor(){super(...arguments),this.alphaMode=Jo.None,this.hasOpacityFactor=!1}};h([V({count:Jo.COUNT})],P5.prototype,"alphaMode",void 0),h([V()],P5.prototype,"hasOpacityFactor",void 0);let GZ=class vCe extends Ci{initializeProgram(e){return new wi(e.rctx,vCe.shader.get().build(this.configuration),fi)}initializePipeline(){switch(this.configuration.alphaMode){case Jo.None:return Ot({colorWrite:Ft});case Jo.Alpha:return Ot({blending:fo(Te.SRC_ALPHA,Te.ONE,Te.ONE_MINUS_SRC_ALPHA,Te.ONE_MINUS_SRC_ALPHA),colorWrite:Ft});case Jo.PremultipliedAlpha:case Jo.COUNT:return Ot({blending:cc(Te.ONE,Te.ONE_MINUS_SRC_ALPHA),colorWrite:Ft})}}};GZ.shader=new bi(zmt,()=>pe(()=>import("./Compositing.glsl-ae8f834e.js"),[],import.meta.url));let bCe=class extends Ki{};function Bmt(){const t=new mi;return t.include(ha),t.fragment.uniforms.add(new Je("tex",e=>e.texture)),t.fragment.code.add(b`void main() {
fragColor = vec4(1.0 - texture(tex, uv).a);
}`),t}const Vmt=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:bCe,build:Bmt},Symbol.toStringTag,{value:"Module"}));let wCe=class xCe extends Ci{initializeProgram(e){return new wi(e.rctx,xCe.shader.get().build(),fi)}initializePipeline(){return Ot({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}};wCe.shader=new bi(Vmt,()=>pe(()=>import("./HUDCompositing.glsl-503735d0.js"),[],import.meta.url));let TCe=class extends Ki{};function Gmt(){const t=new mi;return t.include(ha),t.fragment.uniforms.add(new Je("colorTexture",e=>e.colorTexture),new Je("alphaTexture",e=>e.alphaTexture),new Je("frontFaceTexture",e=>e.frontFaceTexture)),t.fragment.code.add(b`void main() {
vec4 srcColor = texture(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture(alphaTexture, uv).r;
vec4 frontFace = texture(frontFaceTexture, uv);
fragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`),t}const jmt=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:TCe,build:Gmt},Symbol.toStringTag,{value:"Module"}));let SCe=class ECe extends Ci{initializeProgram(e){return new wi(e.rctx,ECe.shader.get().build(),fi)}initializePipeline(){return Ot({blending:fo(Te.SRC_ALPHA,Te.ONE,Te.ONE_MINUS_SRC_ALPHA,Te.ONE_MINUS_SRC_ALPHA),colorWrite:Ft})}};SCe.shader=new bi(jmt,()=>pe(()=>import("./OITCompositing.glsl-71f88bbc.js"),[],import.meta.url));let Hmt=class{constructor(e,i){this._rctx=e,this._techniqueRepository=i,this._configuration=new P5,this._passParameters=new VZ,this._oitParameters=new TCe,this._hudParameters=new bCe}compositeOIT(e,i,r,n){this._oitParameters.colorTexture=i,this._oitParameters.alphaTexture=r,this._oitParameters.frontFaceTexture=n;const s=this._techniqueRepository.acquire(SCe);this._rctx.bindTechnique(s,this._oitParameters,e),this._rctx.screen.draw(),s.release()}compositeHUD(e,i){this._hudParameters.texture=i;const r=this._techniqueRepository.acquire(wCe);this._rctx.bindTechnique(r,this._hudParameters,e),this._rctx.screen.draw(),r.release()}composite(e,i,r=Jo.None,n=1){this._configuration.alphaMode=r,this._configuration.hasOpacityFactor=n!==1,this._passParameters.texture=i,this._passParameters.opacity=n;const s=this._techniqueRepository.acquire(GZ,this._configuration);this._rctx.bindTechnique(s,this._passParameters,e),this._rctx.screen.draw(),s.release()}};const qmt=1e4,Wj=100,Wmt=500,Ymt=500,Xmt=.1;function Zmt(t,e,i){return BX(e,t)*(i[1]-i[0])+i[0]}function Jmt(t,e,i){let r=0;if(!e.some(s=>(r+=s.numGeometries,r>=qmt)))return sgt.compute(t,e);const n=YR();return i.forAll(s=>wS(n,Kmt(t,s))),n}function Kmt(t,e){if(!e.visible)return;const i=YR(),r=e.getSpatialQueryAccelerator();return r?Qmt(i,t,r):egt(i,t,e.objects),i}function Qmt(t,e,i){const r=e.eye,n=e.viewForward,s=e.frustum,o=l=>l.visible,a=i.objectCount;if(a<Wmt)NO(qu,e.near,Math.min(t.near,e.far)),i.forEachInDepthRange(r,n,$d.DepthOrder.FRONT_TO_BACK,qu,(l,c)=>{Yj(t,e,l),qu.far=t.near,c.setRange(qu)},s,o),NO(qu,Math.max(t.far,e.near),e.far),i.forEachInDepthRange(r,n,$d.DepthOrder.BACK_TO_FRONT,qu,(l,c)=>{Yj(t,e,l),qu.near=t.far,c.setRange(qu)},s,o);else{const l=Math.max(Math.min(a,Ymt),Math.ceil(a*Xmt)),c=i.findClosest(n,$d.DepthOrder.FRONT_TO_BACK,s,o,l),u=i.findClosest(n,$d.DepthOrder.BACK_TO_FRONT,s,o,l);c&&u&&(ule(t,e,c.boundingVolumeWorldSpace.bounds),ule(t,e,u.boundingVolumeWorldSpace.bounds))}}function egt(t,e,i){Rx.clear(),i.forAll(r=>{r.visible&&r.geometries.length!==0&&Rx.add(r)}),Rx.empty||(Rx.sort(e),NO(qu,e.near,Math.min(t.near,e.far)),Rx.forEachInDepthRange(qu,$d.DepthOrder.FRONT_TO_BACK,(r,n)=>{n<t.near&&Yj(t,e,r)}),NO(qu,Math.max(t.far,e.near),e.far),Rx.forEachInDepthRange(qu,$d.DepthOrder.BACK_TO_FRONT,(r,n,s)=>{t.far=Math.max(t.far,s)}))}function Yj(t,e,i){if(!i.visible||!Uy(e.frustum,i.boundingVolumeWorldSpace.bounds))return;const r=i.transformation,n=ngt;i.geometries.forEach(s=>{Di(n,r,s.transformation);const o=QT(n);CCe(t,e,s.boundingInfo,n,o)})}function CCe(t,e,i,r,n){if(i==null)return;Fe(Pa,i.center,r);const{eye:s,viewForward:o}=e,a=o[0]*(Pa[0]-s[0])+o[1]*(Pa[1]-s[1])+o[2]*(Pa[2]-s[2]);if(Pa[3]=i.radius*n,!(a-Pa[3]>t.near&&a+Pa[3]<t.far)&&Uy(e.frustum,Pa))if(i.radius>Wj&&i.getChildren())for(const l of i.getChildren())CCe(t,e,l,r,n);else Xj.unionDepthRangeWithAABB(t,e.viewProjectionMatrix,r,i.bbMin,i.bbMax)}function ule(t,e,i){const r=e.eye,n=e.viewForward,s=(i[0]-r[0])*n[0]+(i[1]-r[1])*n[1]+(i[2]-r[2])*n[2];t.near=Math.min(t.near,s-i[3]),t.far=Math.max(t.far,s+i[3])}let tgt=class{constructor(){this._items=new It({allocator:e=>e||{object:null,distance:0,near:0,far:0},deallocator:e=>(e.object=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().object=e}sort(e){const i=e.eye,r=e.viewForward;this._items.forAll(n=>{const s=n.object.boundingVolumeWorldSpace.bounds,o=(s[0]-i[0])*r[0]+(s[1]-i[1])*r[1]+(s[2]-i[2])*r[2];n.distance=o,n.near=o-s[3],n.far=o+s[3]}),this._items.sort((n,s)=>n.distance-s.distance)}forEachInDepthRange(e,i,r){if(i===$d.DepthOrder.FRONT_TO_BACK)for(let n=0;n<this._items.length;++n){const s=this._items.data[n];s.far<e.near||s.near>e.far||r(s.object,s.near,s.far)}else for(let n=this._items.length-1;n>=0;--n){const s=this._items.data[n];s.far<e.near||s.near>e.far||r(s.object,s.near,s.far)}}},igt=class{constructor(){this._view=be(),this._viewProj=be(),this._frustum=gO(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(e,i){this._reset(),Nn(this._view,e.viewMatrix),Di(this._viewProj,e.projectionMatrix,this._view),RN(this._frustum,e.frustum);const r=this._view,n=r[2],s=r[6],o=r[10],a=r[14];i.forAll(p=>p.forEachGeometry(m=>{if(!m.visible||!m.castShadow)return;const y=m.boundingSphere,_=n*y[0]+s*y[1]+o*y[2]+a,v=_-y[3],w=_+y[3];this._geometries.push(m),this._near.push(-w),this._far.push(-v)}));const l=new kZ;if(this._geometries.length===0)return l;for(let p=0;p<this._geometries.length;++p)this._near[p]>l.far&&(l.far=this._near[p]),this._near[p]>2&&this._far[p]<l.near&&(l.near=this._far[p]);const c=this._looseRange;c.near=Math.max(.5*l.near,2),c.far=2*l.far;let u=0,d=0;for(let p=0;p<this._geometries.length;++p)this._near[p]<l.near&&(this._near[p]>=c.near?l.near=this._near[p]:this._nearCandidates[u++]=p),this._far[p]>l.far&&(this._far[p]<=c.far?l.far=this._far[p]:this._farCandidates[d++]=p);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((p,m)=>this._near[p]<this._near[m]?-1:this._near[p]>this._near[m]?1:0),this._farCandidates.sort((p,m)=>this._far[p]<this._far[m]?1:this._far[p]>this._far[m]?-1:0);for(let p=0;p<this._nearCandidates.length;++p){const m=this._nearCandidates[p];if(this._near[m]<l.near){const y=this._geometries[m],_=y.boundingInfo;this._includeNearBoundingInfoRec(_,y.shaderTransformation,l)}}for(let p=0;p<this._farCandidates.length;++p){const m=this._farCandidates[p];if(this._far[m]>l.far){const y=this._geometries[m],_=y.boundingInfo;this._includeFarBoundingInfoRec(_,y.shaderTransformation,l)}}return this._reset(),l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(e,i,r){if(e==null)return;const n=e.center;Fe(Pa,n,i);const s=QT(i),o=Pa[0],a=Pa[1],l=Pa[2],c=e.radius*s,u=this._frustum;if(u[0][0]*o+u[0][1]*a+u[0][2]*l+u[0][3]>c||u[1][0]*o+u[1][1]*a+u[1][2]*l+u[1][3]>c||u[2][0]*o+u[2][1]*a+u[2][2]*l+u[2][3]>c||u[3][0]*o+u[3][1]*a+u[3][2]*l+u[3][3]>c)return;const d=this._view[2]*o+this._view[6]*a+this._view[10]*l+this._view[14],p=d+c;if(!(-(d-c)<2||-p>=r.near))if(-p>this._looseRange.near)r.near=-p;else{if(c>Wj){const m=e.getChildren();if(m!==void 0){for(const y of m)this._includeNearBoundingInfoRec(y,i,r);return}}Xj.unionDepthRangeWithAABB(r,this._viewProj,i,e.bbMin,e.bbMax)}}_includeFarBoundingInfoRec(e,i,r){if(e==null)return;let n=e.radius;const s=e.center;Fe(Pa,s,i);const o=QT(i),a=Pa[0],l=Pa[1],c=Pa[2];n*=o;const u=this._frustum;if(u[0][0]*a+u[0][1]*l+u[0][2]*c+u[0][3]>n||u[1][0]*a+u[1][1]*l+u[1][2]*c+u[1][3]>n||u[2][0]*a+u[2][1]*l+u[2][2]*c+u[2][3]>n||u[3][0]*a+u[3][1]*l+u[3][2]*c+u[3][3]>n)return;const d=this._view[2]*a+this._view[6]*l+this._view[10]*c+this._view[14]-n;if(!(-d<=r.far))if(-d<this._looseRange.far)r.far=-d;else{if(n>Wj){const p=e.getChildren();if(p!==void 0){for(const m of p)this._includeFarBoundingInfoRec(m,i,r);return}}Xj.unionDepthRangeWithAABB(r,this._viewProj,i,e.bbMin,e.bbMax)}}},rgt=class{constructor(){this._modelViewProj=be(),this._clipPosition=[Kt(),Kt(),Kt(),Kt(),Kt(),Kt(),Kt(),Kt()]}unionDepthRangeWithAABB(e,i,r,n,s){const o=this._modelViewProj;Di(o,i,r);let a=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],u=l===0||l===3||l===4||l===7?n[0]:s[0],d=l===0||l===1||l===4||l===5?n[1]:s[1],p=l<4?n[2]:s[2];c[0]=o[0]*u+o[4]*d+o[8]*p+o[12],c[1]=o[1]*u+o[5]*d+o[9]*p+o[13],c[2]=o[2]*u+o[6]*d+o[10]*p+o[14],c[3]=o[3]*u+o[7]*d+o[11]*p+o[15]}for(let l=0;l<12;++l){const c=this._clipPosition[pz[l][0]],u=this._clipPosition[pz[l][1]],d=this._clipPosition[pz[l][2]],p=this._clipTriangle(c,u,d);let m=!0;for(let y=0;y<p.length;++y)if(p[y][3]>=2){m=!1;break}if(!m){a=!0;for(let y=0;y<p.length;++y){const _=p[y][3];Number.isFinite(_)&&(e.near=Math.min(_,e.near),e.far=Math.max(_,e.far))}}}return a}_inside(e,i){return i===0?e[0]>=-e[3]:i===1?e[1]>=-e[3]:i===2?e[0]<=e[3]:i===3?e[1]<=e[3]:void Ke(!1)}_intersect(e,i,r){let n=0;return r===0?n=(-e[3]-e[0])/(i[0]-e[0]+i[3]-e[3]):r===1?n=(-e[3]-e[1])/(i[1]-e[1]+i[3]-e[3]):r===2?n=(e[3]-e[0])/(i[0]-e[0]-i[3]+e[3]):r===3&&(n=(e[3]-e[1])/(i[1]-e[1]-i[3]+e[3])),dq(Kt(),e,i,n)}_clipTriangle(e,i,r){let n=[e,i,r];for(let s=0;s<4;++s){const o=n;n=[];for(let a=0;a<o.length;++a){const l=o[a],c=o[(a+1)%o.length];this._inside(c,s)?(this._inside(l,s)||n.push(this._intersect(l,c,s)),n.push(c)):this._inside(l,s)&&n.push(this._intersect(l,c,s))}}return n}};const pz=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],Pa=xn(),ngt=be(),qu=YR(),Rx=new tgt,sgt=new igt,Xj=new rgt;let ogt=class{},agt=class extends Ki{constructor(){super(...arguments),this.textures=new ogt}};function lgt(){const t=new mi;return t.attributes.add(O.POSITION,"vec2"),t.vertex.uniforms.add(new ai("drawPosition",(e,i)=>cgt(e,i))),t.varyings.add("vUV","vec2"),t.vertex.code.add(b`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),t.fragment.uniforms.add(new Je("textureInput",e=>e.textures.input)),t.fragment.uniforms.add(new Je("textureMask",e=>e.textures.mask)),t.fragment.uniforms.add(new Je("textureOverlay",e=>e.textures.overlay)),t.fragment.uniforms.add(new Tf("maskEnabled",e=>e.magnifier.maskEnabled)),t.fragment.uniforms.add(new Tf("overlayEnabled",e=>e.magnifier.overlayEnabled)),t.fragment.code.add(b`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),t}function cgt(t,e){const i=e.camera.pixelRatio,r=t.magnifier.offset.x*i,n=t.magnifier.offset.y*i;Ed(t.magnifier.position,hle);const s=e.camera.screenToRender(hle,ugt),o=Math.ceil(i*t.magnifier.size),a=e.camera.fullWidth,l=e.camera.fullHeight;return Mr(hgt,(s[0]+r)/a*2-1,(s[1]-n)/l*2-1,o/a*2,o/l*2)}const hle=Zr(),ugt=ape(),hgt=Kt();async function dgt(t){const e=pe(()=>import("./mask-svg-023bbc42.js"),[],import.meta.url),i=pe(()=>import("./overlay-svg-d62383f3.js"),[],import.meta.url),r=$g((await e).default,{signal:t}),n=$g((await i).default,{signal:t}),s={mask:await r,overlay:await n};return Et(t),s}let w2=class extends xe{constructor(){super(...arguments),this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new agt,this.events=new Tn,this.attributeLocations=new Map([[O.POSITION,0]]),this._tmpScreenPoint=Zr(),this._tmpRenderPoint=ape()}get updating(){return this._imageSources==null&&this._imageLoadTask!=null&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this.removeAllHandles(),this._magnifier=e;const i=()=>{this._updateResourceLoading(),this.events.emit("request-render")};this._magnifier!=null&&this.addHandles(le(()=>this._magnifier?.version,i)),i()}get enabled(){return this._validMagnifier!=null}get _validMagnifier(){return this._magnifier!=null&&this._magnifier.visible&&this._magnifier.position!=null&&this._magnifier.size>0?this._magnifier:null}get _factor(){return this._magnifier!=null&&this._magnifier.factor||1}destroy(){this._magnifier=null,this._imageLoadTask!=null&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,i){const r=this._validMagnifier;if(r==null)return;const n=i.camera.pixelRatio,s=Math.ceil(n*r.size);if(this._updateResources(e,s),this._resources==null)return;const o=this._passParameters.textures,a=Math.ceil(1/this._factor*s);o.input.resize(a,a),Ed(r.position,this._tmpScreenPoint);const l=i.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),c=i.camera.fullWidth,u=i.camera.fullHeight,d=.5*a,p=.5*a;l[0]=_e(l[0],d,c-d-1),l[1]=_e(l[1],p,u-p-1);const m=Math.floor(l[0]-d),y=Math.floor(l[1]-p),_=this._resources.program;_.bindTexture("textureInput",o.input),e.gl.copyTexImage2D(o.input.descriptor.target,0,o.input.descriptor.pixelFormat,m,y,a,a,0),this._passParameters.magnifier=r,e.useProgram(_),_.bindPass(this._passParameters,i),e.bindVAO(this._resources.vao),e.setPipelineState(this._resources.pipelineState),e.drawArrays(Qt.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(e==null)return;const i=e.maskUrl,r=e.overlayUrl;this._imageLoadTask==null||this._imageLoadTask.maskUrl===i&&this._imageLoadTask.overlayUrl===r||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),this._imageSources==null&&this._imageLoadTask==null&&(this._imageLoadTask={maskUrl:i,overlayUrl:r,task:S_(async n=>{const s=i==null||r==null?dgt(n):null,o=i!=null?$g(i,{signal:n}):s.then(l=>l.mask),a=r!=null?$g(r,{signal:n}):s.then(l=>l.overlay);this._imageSources={mask:await o,overlay:await a},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,i){if(!this.enabled)return void this._disposeResources();if(this._resources!=null){if(this._passParameters.textures.size!==i){const n=this._createTextureResources(e,i);if(n==null)return void this._disposeResources();this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=n}return}const r=this._createTextureResources(e,i);r!=null&&(this._resources={program:this._createProgram(e),vao:Zf(e,mY,this.attributeLocations,0,1),pipelineState:Ot({blending:cc(Te.ONE,Te.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:Ft})},this._passParameters.textures=r)}_disposeResources(){this._resources!=null&&(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,i){if(this._imageSources==null)return null;this._imageSources.overlay.width=i,this._imageSources.overlay.height=i,this._imageSources.mask.width=i,this._imageSources.mask.height=i;const r=new Li;r.internalFormat=pt.RGBA,r.wrapMode=Nt.CLAMP_TO_EDGE,r.flipped=!0,r.preMultiplyAlpha=!Qhe(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result;const n=new Pt(e,r,this._imageSources.overlay);r.pixelFormat=r.internalFormat=pt.ALPHA,r.preMultiplyAlpha=!1;const s=new Pt(e,r,this._imageSources.mask);return r.pixelFormat=r.internalFormat=pt.RGBA,r.flipped=!1,{input:new Pt(e,r),mask:s,overlay:n,size:i}}_createProgram(e){return new wi(e,lgt(),this.attributeLocations)}};h([f()],w2.prototype,"_imageSources",void 0),h([f()],w2.prototype,"_imageLoadTask",void 0),h([f({readOnly:!0})],w2.prototype,"updating",null),w2=h([z("esri/views/3d/webgl-engine/lib/MagnifierHelper")],w2);let pgt=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new la(new ArrayBuffer(4)),this._uidToRenderColor=new Map,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new Map,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,i,r,n,s,o=null,a=null,l=null){if(!(e&&i&&r&&n)||(this._layerUidToId.set(n,r),this._layerUidToPopupEnabled.set(n,s),!s))return;let c=this._layerUidToGraphicsUidToObjectId.get(n);c||(c=new Map,this._layerUidToGraphicsUidToObjectId.set(n,c)),c.set(i,{objectId:e,attributeNodeId:o,attributeIndex:a,subLayerId:l})}getObjectAndLayerIdColor(e){const i=this.getObjectAndLayerIdColorArray(e);return Mt(i.get(0,1),i.get(0,2),i.get(0,3),255)}getObjectAndLayerIdColorArray(e){if(!e.layerUid||!e.graphicUid)return this.colorZero;const i=this._layerUidToPopupEnabled.get(e.layerUid);if(i===void 0)return ne.getLogger(this).warn("popupEnabled is undefined for layerUid "+e.layerUid),this.colorZero;if(i===!1)return this.colorZero;let r=this._uidToRenderColor.get(e.layerUid);r||(r=new Map,this._uidToRenderColor.set(e.layerUid,r));let n=r.get(e.graphicUid);if(!n){for(;!n;){const o=Math.floor(16777214*Math.random())+1;this._colorToUID.has(o)||(n=o)}if(n>16777215)throw new Error("Object ID Overflow");r.set(e.graphicUid,n),this._colorToUID.set(n,e)}const s=new ArrayBuffer(4);return new DataView(s).setUint32(0,n,!1),new la(s)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[i,r]of this._colorToUID.entries()){const n=this._layerUidToGraphicsUidToObjectId.get(r.layerUid);let s=null;n?(s=n.get(r.graphicUid),s||ne.getLogger(this).warn("getColorMapping: no entry found for graphicsId "+r.graphicUid)):ne.getLogger(this).warn("getColorMapping: no entry found for layerUid "+r.layerUid);const o=this._layerUidToId.get(r.layerUid);o||ne.getLogger(this).warn("no layerId found for uid "+r.layerUid),s&&o&&e.set(i,s.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:s.objectId,lid:o,attrId:s.attributeNodeId,attrIdx:s.attributeIndex,subLayerId:s.subLayerId}:{type:"object-and-layer-id",oid:s.objectId,lid:o})}return e}};var FO;(function(t){t[t.FrontToBack=0]="FrontToBack",t[t.BackToFront=1]="BackToFront"})(FO||(FO={}));let D0=class{constructor(e,i,r=FO.FrontToBack){this._rctx=e,this._techniqueRepository=i,this._sorting=r,this._draws=new It({initialSize:32,allocator:n=>n||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,i,r,n){const s=this._draws.pushNew();s.geometry=i,s.geometryRanges=r,s.material=e,s.depthSquaredHint=n,s.indexType=(i.indexed?i.vao.indexBuffer.indexType:null)??0}prepare(e,i){return this._draws.map(r=>r.material.prepareTechnique(this._techniqueRepository,e,i,r.geometry.parameters))}dispatch(e,i,r){const n=this._rctx;this._previouslyBoundDraw.clear();let s=null;const o=this._draws.length;for(let a=0;a<o;a++){const l=r[a];l===s&&l.configuration.transparencyPassType===Qe.NONE||(n.bindTechnique(l,e,i),s=l);const c=this._draws.data[a],u=c.geometry;n.bindVAO(u.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.program.bindDraw(c.material,i,e),this._previouslyBoundDraw.set(l,c.material));const d=c.geometryRanges,p=d.length;if(c.indexType!==0){const m=iD.get(c.indexType);for(let y=0;y<p;y+=2){const _=d[y],v=d[y+1];n.drawElements(u.primitiveType,v,c.indexType,_*m)}}else for(let m=0;m<p;m+=2){const y=d[m],_=d[m+1];n.drawArrays(u.primitiveType,y,_)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===FO.FrontToBack?1:-1;this._draws.sort((i,r)=>{const n=e*(i.depthSquaredHint-r.depthSquaredHint);return n!==0?n:i.geometry.vao.byteSize-r.geometry.vao.byteSize})}get count(){return this._draws.length}};const iD=new Map;iD.set(Ze.UNSIGNED_BYTE,1),iD.set(Ze.UNSIGNED_SHORT,2),iD.set(Ze.UNSIGNED_INT,4);let Zj=class extends tqe{constructor(){super({}),this._passes=null,this.produces=new Map([[ae.OPAQUE_MATERIAL,e=>this._produces(e)],[ae.TRANSPARENT_MATERIAL,e=>!!(this._passes&&this._passes.materialTransparent.count>0)&&this._produces(e)],[ae.INTEGRATED_MESH,e=>this._produces(e)]]),this._materialPassParameters=new Fet,this._shadowPassParameters=new ket,this._highlightPassParameters=new Uet,this._systems=new Set}initializeRenderContext(e){this._context=e;const i=e.renderContext.rctx,r=e.techniqueRepository;this._passes={materialOpaque:new D0(i,r),materialTransparent:new D0(i,r,FO.BackToFront),materialIntegratedMesh:new D0(i,r),shadowMap:new D0(i,r),highlight:new D0(i,r),highlightIntegratedMesh:new D0(i,r),highlightShadowMap:new D0(i,r),defaultShadowMap:new D0(i,r)}}get rctx(){return this._context.renderContext.rctx}uninitializeRenderContext(){}dispose(){this._context=null,this._systems.clear()}register(e){this._systems.add(e)}_produces(e){return this._systems.size!==0&&this._passes!==null&&(e===U.Highlight?this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0:e!==U.ShadowHighlight||this._passes.highlight.count>0)}prepareRender(e){if(this._systems.size!==0&&this._passes!==null){for(const i of Object.values(this._passes))i.prepareSubmit();this._systems.forEach(i=>i.submit(this._passes,e.bindParameters));for(const i of Object.values(this._passes))i.finishSubmit();this._context.techniqueRepository.frameUpdate()}}prepareTechniques(e){if(this._systems.size===0)return null;const i=e.output===U.Shadow||e.output===U.ShadowHighlight||e.output===U.ShadowExcludeHighlight?this._shadowPassParameters:e.output===U.Highlight?this._highlightPassParameters:this._materialPassParameters,r=e.bindParameters;return this._updateParameters(r.camera,i,r.slot===ae.TRANSPARENT_MATERIAL),this._materialPassParameters.output=e.output,this._invoke(e,(n,s)=>n.prepare(s,e.bindParameters))}renderNode(e,i){this._invoke(e,(r,n)=>r.dispatch(n,e.bindParameters,i))}_invoke(e,i){if(this._passes===null)return null;switch(e.bindParameters.slot){case ae.OPAQUE_MATERIAL:switch(e.output){case U.Color:case U.Depth:case U.Normal:case U.ObjectAndLayerIdColor:return i(this._passes.materialOpaque,this._materialPassParameters);case U.Highlight:return i(this._passes.highlight,this._highlightPassParameters);case U.Shadow:return i(this._passes.shadowMap,this._shadowPassParameters);case U.ShadowHighlight:return i(this._passes.highlightShadowMap,this._shadowPassParameters);case U.ShadowExcludeHighlight:return i(this._passes.defaultShadowMap,this._shadowPassParameters)}break;case ae.TRANSPARENT_MATERIAL:switch(e.output){case U.Color:case U.Alpha:case U.Depth:case U.Normal:case U.ObjectAndLayerIdColor:return i(this._passes.materialTransparent,this._materialPassParameters)}break;case ae.INTEGRATED_MESH:switch(e.output){case U.Color:case U.Depth:case U.Normal:case U.ObjectAndLayerIdColor:return i(this._passes.materialIntegratedMesh,this._materialPassParameters);case U.Highlight:return i(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}queryDepthRange(e){const i=new kZ;return this._systems.forEach(r=>wS(i,r.queryShadowCasterDepthRange(e))),i}_updateParameters(e,i,r){const n=e.viewInverseTransposeMatrix;oe(fz,n[3],n[7],n[11]),mz.set(fz),se(i.transformWorldFromViewTH,mz.high),se(i.transformWorldFromViewTL,mz.low),se(i.slicePlaneLocalOrigin,fz),gh(i.transformViewFromCameraRelativeRS,e.viewMatrix),Nn(i.transformProjFromView,e.projectionMatrix),i.identifier===Xl.Material&&(this._materialPassParameters.transparent=r,yh(dle,i.transformViewFromCameraRelativeRS),uw(i.transformNormalViewFromGlobal,dle))}};Zj=h([z("esri.views.3d.webgl-engine.core.renderPasses.RenderPassManager")],Zj);const fz=C(),dle=Hr(),mz=new Tk;let fgt=class{constructor(e=null,i=null,r=null){this.composite=e,this.normal=i,this.highlight=r}},rD=class extends xe{constructor(e){super({}),this._context=e,this._renderPlugins=new It,this._slots=new Array;for(let i=0;i<ae.MAX_SLOTS;++i)this._slots[i]=[]}normalizeCtorArgs(){return{}}add(e,i){const r=()=>{if(i?.aborted)throw e.uninitializeRenderContext(),pi();this._renderPlugins.push(e),e.produces.forEach((s,o)=>{this._slots[o].push(e)}),this._context.requestRender(),this.notifyChange("updating")},n=e.initializeRenderContext(this._context,i);if(dc(n))return n.then(r);r()}remove(e){if(this._renderPlugins.removeUnordered(e)!=null){for(let i=0;i<this._slots.length;++i)this._slots[i]=this._slots[i].filter(r=>r!==e);e.uninitializeRenderContext(),this._context.requestRender(),this.notifyChange("updating")}}prepareRender(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this._context.renderContext)})}updateAnimation(e){let i=!1;return this._renderPlugins.forAll(r=>{r.updateAnimation&&(i=r.updateAnimation(e)||i)}),i}renderFeatureChanged(){this._renderPlugins.forAll(e=>{e.renderFeatureChanged&&e.renderFeatureChanged()})}prepare(e){this._context.renderContext.bindParameters.slot=e,this._slots[e].forEach(i=>{const r=i.produces.get(e);r&&r(U.Color)&&(ple(i)&&i.prepareTechnique(this._context.renderContext),fle(i)&&i.prepareTechniques(this._context.renderContext))})}_getRenderables(e){this._context.renderContext.bindParameters.slot=e;const i=new Map;return this._slots[e].forEach(r=>{const n=r.produces.get(e);if(n&&n(U.Color)&&(!r.isDecoration||this._context.renderContext.bindParameters.decorations!==Ql.OFF))if(ple(r)){const s=r.prepareTechnique(this._context.renderContext);s!=null&&i.set(r,s)}else if(fle(r)){const s=r.prepareTechniques(this._context.renderContext);s!=null&&i.set(r,s)}else i.set(r,null)}),i}render(e,i=null,r=null){return this._getRenderables(e).forEach((n,s)=>r=s.renderNode(this._context.renderContext,n,i,r)),r}renderComposition(e,i){const r=this._getRenderables(e);let n=null;return r.forEach((s,o)=>{const a=o.renderNode(this._context.renderContext,s,i,null);n?.release(),n=a,i.composite=n}),n}queryDepthRange(e){const i=new kZ;return this._renderPlugins.forAll(r=>{const n=r.queryDepthRange?.(e);wS(i,n)}),i}get updating(){return this._renderPlugins.some(e=>e.running)}produces(e,i=U.Color){return this._slots[e].some(r=>{const n=r.produces.get(e);return!!n&&n(i)})}consumes(e){return this._renderPlugins.some(i=>i.consumes().required.includes(e))}get hasDecorations(){return this._renderPlugins.some(e=>e.isDecoration)}get renderOccludedFlags(){return this._renderPlugins.reduce((e,i)=>e|i.renderOccludedFlags,Pr.None)}get usedMemory(){return this._renderPlugins.reduce((e,i)=>e+(i.usedMemory??0),0)}};function ple(t){return"prepareTechnique"in t}function fle(t){return"prepareTechniques"in t}h([f({readOnly:!0})],rD.prototype,"updating",null),rD=h([z("esri.views.3d.webgl-engine.lib.RenderPluginManager")],rD);let x2=class extends fw{constructor(e){super(e),this._context=null,this.opacity=1,this.alphaMode=Jo.None,this._blitConfiguration=new P5,this._blitParameters=new VZ,this.produces=new Map([[ae.BLIT,()=>this._context!=null]])}consumes(){return U1e}initializeRenderContext(e){this._context=e}uninitializeRenderContext(){this._context=null}destroy(){}renderNode(e,i,r,n){const s=r?.composite?.colorTexture;if(!this._context||!s)return n;const o=this._context.techniqueRepository.acquire(GZ,this._blitConfiguration);return o?.compiled?(e.rctx.bindFramebuffer(n?.fbo),this._blitParameters.texture=s,this._blitParameters.opacity=this.opacity,e.rctx.bindTechnique(o,this._blitParameters,e.bindParameters),e.rctx.screen.draw(),o.release(),n):(this._context.requestRender(),n)}};h([f()],x2.prototype,"_context",void 0),h([f()],x2.prototype,"opacity",void 0),h([f()],x2.prototype,"alphaMode",void 0),x2=h([z("esri.views.3d.webgl-engine.effects.blit.Blit")],x2);let ACe=class extends Ki{};function mgt(){const t=new mi,{outputs:e,fragment:i}=t;return t.include(ha),i.uniforms.add(new oh("textureInput",r=>r.input)),i.constants.add("outlineSize","int",Math.ceil(jZ/2)),e.add("fragGrid","vec2"),i.code.add(b`
    void main() {
      float red = 0.0;
      float green = 1.0;
      int cellSize = ${b.int(rf)};
      vec2 texelSize = 1.0 / vec2(textureSize(textureInput, 0));
      vec2 offset = floor(gl_FragCoord.xy) * vec2(float(cellSize));

      for(int x = -outlineSize; x < cellSize + outlineSize; x += 2) {
        for(int y = -outlineSize; y < cellSize + outlineSize; y += 2) {
          vec2 coord = (offset + vec2(float(x), float(y))) * texelSize;
          vec4 value = texture(textureInput, coord);
          float mx = floor(max(value.g, value.b));

          red = max(red, ceil(value.r));
          green = min(green, mx);
          if(red == 1.0 && green == 0.0) {
            fragGrid = vec2(red, green);
            return;
          }
        }
      }
      fragGrid = vec2(red, green);
    }`),t}const rf=32,jZ=9,OCe=.4,ggt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:ACe,blurSize:OCe,build:mgt,gridCellPixelSize:rf,outlineSize:jZ},Symbol.toStringTag,{value:"Module"}));function ygt(){const t=new mi,{vertex:e,fragment:i}=t,r=e.code,n=i.code;return t.attributes.add(O.POSITION,"vec2"),t.varyings.add("uv","vec2"),t.attributes.add(O.UV0,"vec2"),e.uniforms.add(new Je("coverageTex",s=>s.coverageTexture),new zi("coverageRounding",s=>s.coverageRounding)),r.add(b`void main() {
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),i.uniforms.add(new Je("tex",s=>s.blurTexture),new Je("highlightTexture",s=>s.highlightTexture),new ai("uColor",s=>s.color),new ai("haloColor",s=>s.haloColor),new ai("opacities",s=>Mr(_gt,s.haloOpacity,s.haloOpacityOccluded,s.fillOpacity,s.fillOpacityOccluded))),i.constants.add("outlineSize","float",jZ),i.constants.add("blurSize","float",OCe),n.add(b`void main() {
vec4 blurredHighlightValue = texture(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture(highlightTexture, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - (outlineSize - blurSize) / outlineSize;
float outlineFactor = smoothstep(0.0, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
fragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),t}const _gt=Kt(),vgt=Object.freeze(Object.defineProperty({__proto__:null,build:ygt},Symbol.toStringTag,{value:"Module"}));let RCe=class PCe extends Ci{initializeProgram(e){return new wi(e.rctx,PCe.shader.get().build(),fi)}initializePipeline(){return Ot({blending:fo(Te.SRC_ALPHA,Te.ONE,Te.ONE_MINUS_SRC_ALPHA,Te.ONE_MINUS_SRC_ALPHA),colorWrite:Ft})}};RCe.shader=new bi(vgt,()=>pe(()=>import("./HighlightApply.glsl-4d482041.js"),[],import.meta.url));let MCe=class extends Ki{constructor(){super(...arguments),this.blurSize=Ue()}};function bgt(){const t=new mi,{attributes:e,varyings:i,vertex:r,fragment:n}=t;return e.add(O.POSITION,"vec2"),e.add(O.UV0,"vec2"),i.add("blurCoordinate","vec3"),r.uniforms.add(new Je("coverageTex",s=>s.coverageTexture),new zi("coverageRounding",s=>s.coverageRounding)),r.code.add(b`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), cov.g);
}`),n.uniforms.add(new pxe("blurSize",s=>s.blurSize),new oh("tex",s=>s.blurInputTexture)),n.code.add(b`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture(tex, uv);
if (blurCoordinate.z == 1.0) {
fragColor = center;
} else {
vec4 sum = center * 0.204164;
sum += texture(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture(tex, uv - blurSize * 3.294215) * 0.093913;
fragColor = sum;
}
}`),t}const wgt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:MCe,build:bgt},Symbol.toStringTag,{value:"Module"}));let $Ce=class ICe extends Ci{initializeProgram(e){return new wi(e.rctx,ICe.shader.get().build(),fi)}initializePipeline(){return Ot({colorWrite:Ft})}};$Ce.shader=new bi(wgt,()=>pe(()=>import("./HighlightBlur.glsl-6a0de5d7.js"),[],import.meta.url));let LCe=class DCe extends Ci{initializeProgram(e){return new wi(e.rctx,DCe.shader.get().build(),fi)}initializePipeline(){return Ot({colorWrite:Ft})}};LCe.shader=new bi(ggt,()=>pe(()=>import("./HighlightDownsample.glsl-e3b73265.js"),[],import.meta.url));let xgt=class extends Ki{constructor(){super(...arguments),this.color=Mt(1,0,1,1),this.haloColor=Mt(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.coverageRounding=ri(1,1)}},$A=class extends fw{constructor(e){super(e),this._context=null,this._passParameters=new xgt,this._downsampleDrawParameters=new ACe,this._blurDrawParameters=new MCe,this._blurColorFormat=ie("mac")?hi.RGBA:hi.RGBA4,this._grid={coverage:null,vao:null,verticalCellCount:0,horizontalCellCount:0,viewportWidth:0,viewportHeight:0},this.produces=new Map([[ae.HIGHLIGHT,()=>!0]])}consumes(){return z1e}initializeRenderContext(e){this._context=e,this._blurTechnique==null&&(this._blurTechnique=this._context.techniqueRepository.acquire($Ce)),this._downsampleTechnique==null&&(this._downsampleTechnique=this._context.techniqueRepository.acquire(LCe)),this._applyTechnique==null&&(this._applyTechnique=this._context.techniqueRepository.acquire(RCe)),this.addHandles([le(()=>this.view.highlightOptions.color,i=>{this._passParameters.color=pO(i??HSe),this.view.highlightOptions.haloColor||(this._passParameters.haloColor=this._passParameters.color),this._context.requestRender()},Yi),le(()=>this.view.highlightOptions.haloColor,i=>{this._passParameters.haloColor=i!=null?pO(i):this._passParameters.color,this._context.requestRender()},Yi),le(()=>this.view.highlightOptions.haloOpacity,i=>{this._passParameters.haloOpacity=i??qSe,this._passParameters.haloOpacityOccluded=.25*this._passParameters.haloOpacity,this._context.requestRender()},Yi),le(()=>this.view.highlightOptions.fillOpacity,i=>{this._passParameters.fillOpacity=i??WSe,this._passParameters.fillOpacityOccluded=.25*this._passParameters.fillOpacity,this._context.requestRender()},Yi)])}uninitializeRenderContext(){this._context=null}dispose(){this._blurTechnique=Jt(this._blurTechnique),this._downsampleTechnique=Jt(this._downsampleTechnique),this._applyTechnique=Jt(this._applyTechnique),this._grid.coverage=Jt(this._grid.coverage),this._grid.vao=et(this._grid.vao)}renderNode(e,i,r,n){const s=r?.highlight?.colorTexture;if(!this._context||!s)return;if(!(this._blurTechnique.compiled&&this._downsampleTechnique.compiled&&this._applyTechnique.compiled))return void this._context.requestRender();const o=e.bindParameters.camera,a=o.fullWidth,l=o.fullHeight,c=o.pixelRatio,u=Math.ceil(a/c),d=Math.ceil(l/c),p=this._context.fbos,m=p.rctx;this._gridUpdateResources(s),this._gridComputeCoverage(s,e.bindParameters),this._passParameters.highlightTexture=s,this._passParameters.coverageTexture=this._grid.coverage?.colorTexture;const{width:y,height:_}=s.descriptor;si(this._passParameters.coverageRounding,y/(Math.ceil(y/rf)*rf),_/(Math.ceil(_/rf)*rf));const v=m.bindTechnique(this._blurTechnique,this._passParameters,e.bindParameters),w=this._grid.vao;m.bindVAO(w);const x=p.acquire(this._blurColorFormat,u,d);m.bindFramebuffer(x.fbo),m.setViewport(0,0,u,d),m.clear(hr.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=s,si(this._blurDrawParameters.blurSize,1/u,0),v.bindDraw(this._blurDrawParameters,e.bindParameters,this._passParameters),m.drawArrays(this._blurTechnique.primitiveType,0,cg(w,"geometry"));const T=p.acquire(this._blurColorFormat,u,d);m.bindFramebuffer(T.fbo),m.clear(hr.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=x.colorTexture,si(this._blurDrawParameters.blurSize,0,1/d),v.bindDraw(this._blurDrawParameters,e.bindParameters,this._passParameters),m.drawArrays(this._blurTechnique.primitiveType,0,cg(w,"geometry")),m.bindFramebuffer(n?.fbo),m.setViewport4fv(o.fullViewport),this._passParameters.blurTexture=T.colorTexture,m.bindTechnique(this._applyTechnique,this._passParameters,e.bindParameters),m.drawArrays(this._applyTechnique.primitiveType,0,cg(w,"geometry")),T.release(),x.release()}_gridUpdateResources(e){if(!this._context)return;const i=this._context.fbos.rctx,r=this._grid,n=Math.ceil(e.descriptor.height/rf),s=Math.ceil(e.descriptor.width/rf);if(r.vao&&r.verticalCellCount===n&&r.horizontalCellCount===s)return;r.verticalCellCount=n,r.horizontalCellCount=s;const o=n+1,a=s+1,l=1/n,c=1/s,u=new Float32Array(6*4*o*a);let d=0;for(let p=0;p<o;p++)for(let m=0;m<a;m++)u[d++]=(m-.5)*c*2-1,u[d++]=(p-.5)*l*2-1,u[d++]=m*c,u[d++]=p*l,u[d++]=(m+.5)*c*2-1,u[d++]=(p-.5)*l*2-1,u[d++]=m*c,u[d++]=p*l,u[d++]=(m-.5)*c*2-1,u[d++]=(p+.5)*l*2-1,u[d++]=m*c,u[d++]=p*l,u[d++]=(m-.5)*c*2-1,u[d++]=(p+.5)*l*2-1,u[d++]=m*c,u[d++]=p*l,u[d++]=(m+.5)*c*2-1,u[d++]=(p-.5)*l*2-1,u[d++]=m*c,u[d++]=p*l,u[d++]=(m+.5)*c*2-1,u[d++]=(p+.5)*l*2-1,u[d++]=m*c,u[d++]=p*l;r.vao?.dispose(),r.vao=new np(i,fi,{geometry:ER},{geometry:Ri.createVertex(i,vi.STATIC_DRAW,u)})}_gridComputeCoverage(e,i){if(!this._context)return;const r=this._context.fbos.rctx,n=this._grid,s=e.descriptor,o=Math.ceil(s.width/rf),a=Math.ceil(s.height/rf);n.coverage?.release(),n.coverage=this._context.fbos.acquire(hi.RG,o,a),this._downsampleDrawParameters.input=e,r.bindFramebuffer(n.coverage.fbo),r.bindTechnique(this._downsampleTechnique,this._passParameters,i).bindDraw(this._downsampleDrawParameters,i,this._passParameters),r.setViewport(0,0,o,a),r.screen.draw()}get test(){return{coverage:this._grid.coverage}}};h([f()],$A.prototype,"_context",void 0),h([f()],$A.prototype,"view",void 0),$A=h([z("esri.views.3d.webgl-engine.effects.highlight.Highlight")],$A);let HZ=class extends bl{constructor(){super(...arguments),this.receiveShadows=!0}};h([V()],HZ.prototype,"receiveShadows",void 0);const Tgt=.99999,Sgt=.025;function Egt(t){const e=new mi;e.include(Gb,t),e.include(rk),e.include(ha);const i=e.fragment;return i.include(Eh),i.include(vh),i.uniforms.add(new Je("defaultDepthTex",(r,n)=>n.shadowMap.getSnapshot(yS.Default)),new Je("highlightDepthTex",(r,n)=>n.shadowMap.getSnapshot(yS.Highlight)),new Je("depthMap",(r,n)=>n.linearDepth?.colorTexture),new Je("highlightTexture",r=>r.highlight),new ai("uColor",r=>r.shadowColor),new zi("nearFar",(r,n)=>n.camera.nearFar),new Oe("opacity",r=>r.shadowOpacity),new Oe("occludedOpacity",r=>r.occludedShadowOpacity),new Oe("terminationFactor",r=>r.opacityElevation*r.dayNightTerminator),new $t("lightingMainDirectionView",(r,n)=>ge(gle,Fe(gle,n.lighting.mainLight.direction,n.camera.viewInverseTransposeMatrix))),new Vr("inverseViewMatrix",(r,n)=>qn(mle,yl(mle,n.camera.viewMatrix,n.camera.center)))),i.constants.add("unoccludedHighlightFlag","vec4",pX),i.code.add(b`
    vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, ivec2 iuv) {
      float leftPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(-1, 0), 0), nearFar);
      float rightPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(1, 0), 0), nearFar);
      float bottomPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(0, -1), 0), nearFar);
      float topPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(0, 1), 0), nearFar);

      bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
      bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);

      vec3 fragCoordHorizontal = pickLeft
                                  ? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
                                  : vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
      vec3 fragCoordVertical = pickBottom
                                  ? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
                                  : vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);

      vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
      vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);

      vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
      // Flip normal depending on triangle winding order for consistency
      return pickLeft == pickBottom ? normal : -normal;
    }

    void main(void) {
      vec4 highlightInfo = texture(highlightTexture, uv);
      float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
      if (visiblyHighlighted > ${b.float(Tgt)}) {
        discard;
      }

      ivec2 iuv = ivec2(uv * vec2(textureSize(depthMap, 0)));
      float depth = rgba2float(texelFetch(depthMap, iuv, 0));
      // 0.0 is the clear value of depthMap, which means nothing has been drawn there and we should discard
      if (depth == 0.0) {
        discard;
      }

      float currentPixelDepth = linearDepthFromFloat(depth, nearFar);

      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        discard;
      }

      vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
      vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;

      mat4 shadowMatrix;
      float linearDepth = -currentPixelDepth;
      int i = chooseCascade(linearDepth, shadowMatrix);

      if (i >= numCascades) {
        discard;
      }

      vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
        discard;
      }

      ivec2 texSize = textureSize(highlightDepthTex, 0);
      ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));

      float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
      bool shadowHighlight = depthHighlight < lvpos.z;

      if (!shadowHighlight) {
        discard;
      }

      float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
      bool shadowDefault = depthDefault < lvpos.z;

      vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, iuv);
      bool shaded = dot(normal, lightingMainDirectionView) < ${b.float(Sgt)};

      float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
      fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
    }
  `),e}const mle=be(),gle=C(),Cgt=Object.freeze(Object.defineProperty({__proto__:null,build:Egt},Symbol.toStringTag,{value:"Module"}));let Agt=class extends CX{constructor(){super(...arguments),this.shadowColor=Mt(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},NCe=class FCe extends Ci{constructor(e){super(e,new HZ,()=>this.destroy())}initializeProgram(e){return new wi(e.rctx,FCe.shader.get().build(this.configuration),fi)}initializePipeline(){return Ot({blending:fo(Te.SRC_ALPHA,Te.ONE,Te.ONE_MINUS_SRC_ALPHA,Te.ONE_MINUS_SRC_ALPHA),colorWrite:Ft,depthTest:null,depthWrite:null})}get primitiveType(){return Qt.TRIANGLE_STRIP}};NCe.shader=new bi(Cgt,()=>pe(()=>import("./ShadowHighlight.glsl-eea25400.js"),[],import.meta.url));const Ogt=.001953125,Rgt=4e4,Pgt=5e4;let T2=class extends fw{constructor(e){super(e),this._maxOpacity=1,this._passParameters=new Agt,this._drawParameters=new OKe,this._shadowDifference=.2,this._context=null,this.produces=new Map([[ae.SHADOW_HIGHLIGHT,()=>this._isVisible]])}consumes(){return z1e}initializeRenderContext(e){this._context=e,this.addHandles([le(()=>this.view.highlightOptions.shadowOpacity,i=>{this._passParameters.shadowOpacity=i??XSe,this._updateOccludedShadowOpacity(),this._updateMaxOpacity()},Yi),le(()=>this.view.highlightOptions.shadowDifference,i=>{this._shadowDifference=i??ZSe,this._updateOccludedShadowOpacity(),this._updateMaxOpacity()},Yi),le(()=>this.view.highlightOptions.shadowColor,i=>{this._passParameters.shadowColor=pO(i??YSe),this._updateMaxOpacity()},Yi)])}_updateOccludedShadowOpacity(){this._passParameters.occludedShadowOpacity=this._passParameters.shadowOpacity*(1-this._shadowDifference)}_updateMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3]}uninitializeRenderContext(){this._context=null}enable(){this._context&&this._technique==null&&(this._technique=this._context.techniqueRepository.acquire(NCe))}renderNode(e,i,r,n){const s=r?.highlight?.colorTexture;if(!(this._context&&r&&s&&this._isVisible))return;if(!this._technique?.compiled)return void this._context.requestRender();const o=e.bindParameters;if(!o.shadowMap.enabled||!o.linearDepth)return;const a=e.rctx,l=this._technique;this._passParameters.highlight=s,this._drawParameters.origin=o.camera.center,a.bindFramebuffer(n?.fbo),a.bindTechnique(l,this._passParameters,o).bindDraw(this._drawParameters,o,this._passParameters),a.screen.draw()}updateParameters(e,i){this._passParameters.opacityElevation=1-X3(Rgt,Pgt,e.relativeElevation);const r=this.viewingMode===Me.Global?ge(yle,e.center):oe(yle,0,0,1),n=me(r,i);this._passParameters.dayNightTerminator=X3(0,1,_e(30*n,0,1)),this._isVisible&&this.enable()}get _isVisible(){const{opacityElevation:e,dayNightTerminator:i}=this._passParameters;return this._maxOpacity*e*i>=Ogt}};h([f()],T2.prototype,"_context",void 0),h([f()],T2.prototype,"view",void 0),h([f()],T2.prototype,"viewingMode",void 0),T2=h([z("esri.views.3d.webgl-engine.effects.highlight.ShadowHighlight")],T2);const yle=C(),Px={maxSearchSteps:8,maxDistanceAreaTex:16};function Mgt(){const t=new mi;return t.include(ha),t.fragment.uniforms.add(new Je("edgesTexture",e=>e.inputTexture)),t.fragment.uniforms.add(new Je("areaTexture",e=>e.areaTexture)),t.fragment.uniforms.add(new Je("searchTexture",e=>e.searchTexture)),t.fragment.code.add(b`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 sampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset, vec2 resolution) {
        return texture(tex, coord + offset.x * resolution, 0.0);
      }

      float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
        e.r = bias + e.r * scale;
        return 255.0 * texture( searchTex, e, 0.0 ).r;
      }

      float searchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${b.int(Px.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float searchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${b.int(Px.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float searchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${b.int(Px.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${b.int(Px.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${b.int(Px.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture( areaTex, texcoord, 0.0 ).rg;
      }

      void main() {
        vec2 size = vec2(textureSize(edgesTexture, 0));
        vec2 resolution = 1.0 / size;
        vec2 pixelCoord = uv * size;
        vec4 offsets[2];
        offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        vec4 maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${b.int(Px.maxSearchSteps)} );

        ivec4 subsampleIndices = ivec4(0.0);
        vec4 weights = vec4(0.0);
        vec2 e = texture( edgesTexture, uv ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = searchXLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x, resolution );
          coords.y = offsets[1].y;
          d.x = coords.x;
          float e1 = texture( edgesTexture, coords, 0.0 ).r;
          coords.x = searchXRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y, resolution );
          d.y = coords.x;
          d = d * size.x - pixelCoord.x;
          vec2 sqrt_d = sqrt( abs(d) );
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ), resolution).r;
          weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = searchYUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z, resolution );
          coords.x = offsets[0].x;
          d.x = coords.y;
          float e1 = texture( edgesTexture, coords, 0.0 ).g;
          coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w, resolution );
          d.y = coords.y;
          d = d * size.y - pixelCoord.y;
          vec2 sqrt_d = sqrt(abs(d));
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0), resolution).g;
          weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
        }
        fragColor = weights;
      }
    `),t}const $gt=Object.freeze(Object.defineProperty({__proto__:null,build:Mgt},Symbol.toStringTag,{value:"Module"}));let kCe=class UCe extends Ci{initializeProgram(e){return new wi(e.rctx,UCe.shader.get().build(),fi)}initializePipeline(){return Ot({colorWrite:Ft})}};kCe.shader=new bi($gt,()=>pe(()=>import("./BlendWeights.glsl-faf4cc0b.js"),[],import.meta.url));function Igt(){const t=new mi;return t.include(ha),t.fragment.uniforms.add(new Je("blendWeightsTexture",e=>e.inputTexture),new Je("colorTexture",e=>e.color)),t.fragment.code.add(b`void main() {
vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
vec4 offsets = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets.zw).g;
a.a = texture(blendWeightsTexture, offsets.xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}
}`),t}const Lgt=Object.freeze(Object.defineProperty({__proto__:null,build:Igt},Symbol.toStringTag,{value:"Module"}));let zCe=class BCe extends Ci{initializeProgram(e){return new wi(e.rctx,BCe.shader.get().build(),fi)}initializePipeline(){return Ot({colorWrite:Ft})}};zCe.shader=new bi(Lgt,()=>pe(()=>import("./Blur.glsl-afd6d366.js"),[],import.meta.url));const _le={threshold:.05,localConstrastAdaption:2};function Dgt(){const t=new mi;return t.include(ha),t.fragment.uniforms.add(new Je("colorTexture",e=>e.color)),t.outputs.add("fragEdges","vec2"),t.fragment.code.add(b`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
      vec4 offsets[3];
      offsets[0] = vec4(uv.x - resolution.x, uv.y, uv.x, uv.y + resolution.y);
      offsets[1] = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
      offsets[2] = vec4(uv.x - 2.0 * resolution.x, uv.y, uv.x, uv.y + 2.0 * resolution.y);

      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture(colorTexture, uv).rgb;

      vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${b.float(_le.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges *= step(maxDelta, float(${b.float(_le.localConstrastAdaption)}) * delta.xy);

      fragEdges = edges;
    }
  `),t}const Ngt=Object.freeze(Object.defineProperty({__proto__:null,build:Dgt},Symbol.toStringTag,{value:"Module"}));let VCe=class GCe extends Ci{initializeProgram(e){return new wi(e.rctx,GCe.shader.get().build(),fi)}initializePipeline(){return Ot({colorWrite:Ft})}};VCe.shader=new bi(Ngt,()=>pe(()=>import("./EdgeDetect.glsl-77a14335.js"),[],import.meta.url));let Fgt=class extends Ki{},g1=class extends fw{constructor(e){super(e),this._context=null,this._areaTexture=null,this._searchTexture=null,this._isEnabled=!1,this._smaaParameters=new Fgt,this.produces=new Map([[ae.ANTIALIASING,()=>this._isEnabled&&this._context!=null]])}consumes(){return U1e}get updating(){return this._abortController!=null}initializeRenderContext(e){this._context=e,this.addHandles([le(()=>this.view.qualitySettings.antialiasingEnabled,i=>i||this._context?.isFeatureEnabled(Gn.Antialiasing)?this.enable():this.disable(),Yi)])}renderFeatureChanged(){this.view.qualitySettings.antialiasingEnabled||this._context?.isFeatureEnabled(Gn.Antialiasing)?this.enable():this.disable()}uninitializeRenderContext(){this.disable(),this._context=null}enable(){if(this._isEnabled||!this._context||this._abortController)return;if(this._edgeTechnique==null&&(this._edgeTechnique=this._context.techniqueRepository.acquire(VCe)),this._blendTechnique==null&&(this._blendTechnique=this._context.techniqueRepository.acquire(kCe)),this._blurTechnique==null&&(this._blurTechnique=this._context.techniqueRepository.acquire(zCe)),this._areaTexture&&this._searchTexture)return void(this._isEnabled=!0);this._abortController=new AbortController;const e=this._abortController.signal;pe(()=>import("./SMAAData-660b7d34.js"),[],import.meta.url).then(i=>this._loadTextures(this._context,i,e)).then(()=>{this._context?.requestRender(),this._abortController=null}).catch(i=>{Fn(i)||this._disposeTextures()})}_loadTextures(e,i,r){return Et(r),e?Promise.all([$g(i.areaTexture).then(n=>vle(e.fbos.rctx,Lt.LINEAR,pt.RGB,n)),$g(i.searchTexure).then(n=>vle(e.fbos.rctx,Lt.NEAREST,pt.LUMINANCE,n))]).then(([n,s])=>{Hn(r)?(n.dispose(),s.dispose(),Et(r)):(this._areaTexture=n,this._searchTexture=s,this._isEnabled=!0)}):Promise.reject()}_disposeTextures(){this._areaTexture=et(this._areaTexture),this._searchTexture=et(this._searchTexture)}disable(){this._abortController=nc(this._abortController),this._isEnabled=!1}destroy(){this.disable(),this._disposeTextures()}renderNode(e,i,r,n){const s=r?.composite?.colorTexture;if(!(this._isEnabled&&this._context&&r&&s))return n;if(!(this._edgeTechnique?.compiled&&this._blendTechnique?.compiled&&this._blurTechnique?.compiled))return this._context.requestRender(),n;const o=s.descriptor.width,a=s.descriptor.height,l=this._context.fbos,c=e.rctx;c.setViewport(0,0,o,a);const u=l.acquire(hi.RG,o,a);c.bindFramebuffer(u.fbo),c.setClearColor(0,0,0,1),c.clear(hr.COLOR_BUFFER_BIT),this._smaaParameters.color=s,c.bindTechnique(this._edgeTechnique,this._smaaParameters),c.screen.draw();const d=l.acquire(hi.RGBA,o,a);return c.bindFramebuffer(d.fbo),c.setClearColor(0,0,1,1),c.clear(hr.COLOR_BUFFER_BIT),this._smaaParameters.inputTexture=u.colorTexture,this._smaaParameters.areaTexture=this._areaTexture,this._smaaParameters.searchTexture=this._searchTexture,c.bindTechnique(this._blendTechnique,this._smaaParameters),c.screen.draw(),c.bindFramebuffer(n?.fbo),u.release(),c.setClearColor(0,1,0,1),c.clear(hr.COLOR_BUFFER_BIT),this._smaaParameters.inputTexture=d.colorTexture,c.bindTechnique(this._blurTechnique,this._smaaParameters),c.screen.draw(),d.release(),n}};function vle(t,e,i,r){const n=new Li;return n.pixelFormat=i,n.wrapMode=Nt.CLAMP_TO_EDGE,n.width=r.width,n.height=r.height,n.samplingMode=e,new Pt(t,n,r)}h([f()],g1.prototype,"view",void 0),h([f()],g1.prototype,"_context",void 0),h([f()],g1.prototype,"_abortController",void 0),h([f({readOnly:!0})],g1.prototype,"updating",null),g1=h([z("esri.views.3d.webgl-engine.effects.smaa.SMAA")],g1);let kgt=class{constructor(){this._step=xle,this._dilation=1,this._firstIdleTime=0}frame(e,i){if(i?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,ie("disable-feature:high-quality-idle"))this._dilation=1;else{const n=i?performance.now()-this._firstIdleTime:0;if(n>=ble+zgt)return this._step=1/0,void(this._dilation=1);this._dilation=n>=ble?Bgt:1}const r=_e(e/Ugt,xle,Ggt);this._step===1/0?this._step=r:this._step=this._step*wle+r*(1-wle)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}};const Ugt=.5,ble=12e4,zgt=1e4,Bgt=10,wle=.9,Vgt=30,xle=1e3/1,Ggt=1e3/Vgt;let jgt=class{constructor(e,i){this._fbos=e,this.compositingHelper=i,this._width=4,this._height=4}dispose(){this._color=Jt(this._color),this.releaseBuffers()}get framebuffer(){return this.color.detachDepth(),this.color.attachDepth(this.depth),this.color.fbo}get colorTexture(){return this.color.colorTexture}get depthTexture(){return this.depth.attachment}initializeFrame(e,i,r){this._fbos.interactive=!r;const n=this._fbos.rctx;this._width=e.fullWidth,this._height=e.fullHeight,G1(this,n.parameters.maxTextureSize);const s=this._color;return this._color=null,this.releaseBuffers(),this.bindFbo(),n.setClearStencil(0),n.setClearColor(i[0],i[1],i[2],i[3]),n.clearSafe(hr.COLOR_BUFFER_BIT|hr.DEPTH_BUFFER_BIT|hr.STENCIL_BUFFER_BIT),s}releaseBuffers(){this._color?.detachDepth(),this._depth=Jt(this._depth)}renderHUDVisibility(e,i,r){return e?.fbo.width===this._width&&e?.fbo.height===this._height||(e?.release(),e=this._fbos.acquire(hi.RGBA4,this._width,this._height)),e.attachDepth(r||this.depth),this._fbos.rctx.bindFramebuffer(e.fbo),this.renderToFBO(i,Hgt),e.detachDepth(),e}compositeToHUDVisibility(e,i){this._fbos.rctx.bindFramebuffer(e.hudVisibility?.fbo),this.compositingHelper.compositeHUD(e,i)}renderOITPass(e,i,r){let n,s;switch(i){case Qe.Color:n=this._fbos.acquire(hi.RGBA16F,this._width,this._height),s=[0,0,0,0];break;case Qe.Alpha:n=this._fbos.acquire(hi.R16F,this._width,this._height),s=[1,1,1,1];break;case Qe.FrontFace:n=this._fbos.acquire(hi.RGBA,this._width,this._height),s=[0,0,0,0]}return r?(n.acquireDepth(rs.DEPTH16_BUFFER),this._fbos.rctx.bindFramebuffer(n.fbo),this.renderToFBO(e,s,!0,!0),n.releaseDepth()):(n.attachDepth(this.depth),this._fbos.rctx.bindFramebuffer(n.fbo),this.renderToFBO(e,s),n.detachDepth()),n}compositeToFramebuffer(e,i,r,n){this.bindFbo(),this.compositingHelper.composite(e,i,r,n)}compositeTransparentOntoOpaque(e,i,r,n,s){s?(this._fbos.rctx.bindFramebuffer(s.fbo),this._fbos.rctx.setClearColor(0,0,0,1e-13),this._fbos.rctx.clearSafe(hr.COLOR_BUFFER_BIT)):this.bindFbo(),this.compositingHelper.compositeOIT(e,i.colorTexture,r.colorTexture,n.colorTexture)}renderDepthDetached(e){this._bindTarget(this.color),e(),this._bindTarget(this.color,this.depth)}renderToCachedFBO(e,i,r,n=hi.RGBA,s=rs.DEPTH16_BUFFER,o=this._width,a=this._height,l=null){return e?.fbo.width===o&&e?.fbo.height===a||(e=Jt(e)),e=e??this._fbos.acquire(n,o,a),s!=null&&e.acquireDepth(s),l?.forEach(c=>{e.acquireColor(c.format,c.attachment)}),this._fbos.rctx.bindFramebuffer(e.fbo),this.renderToFBO(i,r,!0,!0),e}renderToFBO(e,i,r=!1,n=!1){const s=this._fbos.rctx;let o=0;if(i){const l=Math.max(1e-13,i[3]);s.setClearColor(i[0],i[1],i[2],l),o|=hr.COLOR_BUFFER_BIT}r&&(o|=hr.DEPTH_BUFFER_BIT),n===!1?n=0:(n===!0&&(n=255),o|=hr.STENCIL_BUFFER_BIT),o&&s.clearSafe(o,n),e(),s.gl.flush()}renderToTargets(e,i,r,n,s=!1,o=!1){this._bindTarget(i,r),this.renderToFBO(e,n,s,o),i.detachDepth()}bindFbo(){this._bindTarget(this.color,this.depth)}_bindTarget(e,i){e.detachDepth(),e.attachDepth(i),this._fbos.rctx.bindFramebuffer(e.fbo)}get width(){return this._width}get height(){return this._height}get color(){return this._color||(this._color=this._fbos.acquire(hi.RGBA,this._width,this._height)),this._color}get depth(){return this._depth||(this._depth=this._fbos.acquireDepth(rs.DEPTH_STENCIL_TEXTURE,this._width,this._height)),this._depth}};const Hgt=[0,1,0,1],Sk=255,qgt=1/Sk;function Wgt(t){const e=new mi,i=e.fragment;return i.include(Eh),i.include(vh),e.include(rk),e.include(ha),e.include(nk,t),i.uniforms.add(new Je("depthMap",(r,n)=>n.linearDepth?.colorTexture),new Vr("inverseViewMatrix",(r,n)=>qn(Tle,yl(Tle,n.camera.viewMatrix,n.camera.center))),new zi("nearFar",(r,n)=>n.camera.nearFar)),i.constants.add("sampleValue","float",qgt),e.outputs.add("sampleCount","float"),i.code.add(b`void main(void) {
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
ivec2 texSize = textureSize(shadowMapTex, 0);
ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
sampleCount = sampleValue;
}`),e}const Tle=be(),Ygt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:Sk,build:Wgt},Symbol.toStringTag,{value:"Module"}));var xS;(function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"})(xS||(xS={}));let Jj=class extends bl{constructor(){super(...arguments),this.visualization=xS.Gradient,this.bandsEnabled=!1}};h([V({count:xS.COUNT})],Jj.prototype,"visualization",void 0),h([V()],Jj.prototype,"bandsEnabled",void 0);let jCe=class extends Ki{constructor(e){super(),this._data=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=wR(Xgt),this.bandSize=.1,this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}};const Xgt=Mt(.01,0,.25,1);function Zgt(t){const e=new mi,i=e.fragment;i.include(Eh),i.include(vh),e.include(rk),e.include(ha);const{visualization:r,bandsEnabled:n}=t;i.constants.add("inverseSampleValue","float",Sk),i.uniforms.add(new Je("shadowCastMap",a=>a.shadowCastMap),new Oe("sampleScale",a=>a.sampleScale),new Oe("opacityFromElevation",a=>a.opacityFromElevation),new ai("uColor",a=>a.color));const s=r===xS.Gradient,o=r===xS.Threshold;return s&&n?i.uniforms.add(new Oe("bandSize",a=>a.bandSize)):o&&i.uniforms.add(new Oe("threshold",a=>a.threshold)),i.code.add(b`
      void main(void) {
        float record = texture(shadowCastMap, uv).r;
        float pixelSamples = record * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${o?b`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${s&&n?b`strength = ceil(strength / bandSize) * bandSize;`:""}

        fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${s?b`* strength`:""});
      }
    `),e}const Jgt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:jCe,build:Zgt},Symbol.toStringTag,{value:"Module"}));let HCe=class qCe extends Ci{constructor(e,i){super(e,i,()=>this.destroy())}initializeProgram(e){return new wi(e.rctx,qCe.shader.get().build(this.configuration),fi)}initializePipeline(){return Ot({blending:su,colorWrite:Ft,depthTest:null,depthWrite:null})}get primitiveType(){return Qt.TRIANGLE_STRIP}};HCe.shader=new bi(Jgt,()=>pe(()=>import("./ShadowCastVisualize.glsl-582e978b.js"),[],import.meta.url));const Kgt=4e4,Qgt=5e4,WCe=1/512;let nD=class extends xe{constructor(e,i,r,n){super({}),this._techniqueRepository=e,this._rctx=i,this._data=r,this._requestRender=n,this._passParameters=new jCe(this._data),this._techniqueConfig=new Jj,this._enabled=!1,this._vao=Zf(i)}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=et(this._vao),this._techniqueRepository.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(HCe,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const i=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(i,this._passParameters,e),this._rctx.drawArrays(i.primitiveType,0,cg(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>WCe}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const i=this._passParameters.color;nT(e,i)||(Cd(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};h([f()],nD.prototype,"opacityFromElevation",null),nD=h([z("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],nD);let YCe=class XCe extends Ci{constructor(e){super(e,new HZ,()=>this.destroy())}initializeProgram(e){return new wi(e.rctx,XCe.shader.get().build(this.configuration),fi)}initializePipeline(){return Ot({blending:fo(Te.ONE,Te.ONE,Te.ONE,Te.ONE),colorWrite:Ft,depthTest:null,depthWrite:null})}get primitiveType(){return Qt.TRIANGLE_STRIP}};YCe.shader=new bi(Ygt,()=>pe(()=>import("./ShadowCastAccumulate.glsl-413c0ff1.js"),[],import.meta.url));let nl=class extends xe{constructor(e,i,r,n,s,o){super({}),this.fbos=e,this._stage=r,this._prepareForShadowMapPass=n,this._renderToShadowMap=s,this._requestRender=o,this._progress=0,this._sampleCount=0,this._passParameters=new CX,this._cachedLightDirections=[],this._depthRange=Gj,this._previewing=!1,this._cameraForcedForScreenshot=!1,this._shadowAccumulatorKey="shadowAccumulator",this._rctx=e.rctx,this._bindParameters=new OF(new WX(e,r.viewingMode),null),this._bindParameters.shadowMap.enabled=!0,this._vao=Zf(this._rctx),this._accumulationRenderer=new nD(i,this._rctx,this,o);const a=this._stage.view.resourceController.scheduler;this.addHandles([a.registerTask(ut.SHADOW_ACCUMULATOR,this),le(()=>r.renderView,l=>{this.removeHandles(Sle),l!=null&&this.addHandles(l.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),Sle)},Yi),le(()=>this._previewing,()=>this._requestRenderIfEnabled(),qi)],this._shadowAccumulatorKey)}normalizeCtorArgs(){return{}}dispose(){this._disable(),this.removeHandles(this._shadowAccumulatorKey),this._accumulationRenderer=et(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=et(this._fbo),this._vao=et(this._vao),this._accumulationTechniqueCached=Jt(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo?.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(this._accumulationTechniqueCached==null){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new YCe(e)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._fbo!=null&&this._sampleCount>0}get canAccumulate(){return this._bindParameters.linearDepth?.colorTexture!==null&&this._depthRange!==Gj&&this._opacityFromElevation>WCe}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const i=this._cachedLightDirections;if(yg(i,e,xb))return;const r=Math.min(Sk,e.length);i.length=r,this._sampleCount=r;for(let n=0;n<r;++n)i[n]=se(i[n]??C(),e[n]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,i,r,n){if(this._depthRange=i,this._updateCamera(r),this._bindParameters.contentCamera=n,this._bindParameters.linearDepth=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const s=this._cameraForcedForScreenshot?this._sampleCount:Math.min(e0t,this._sampleCount-this._progress);for(let o=0;o<s;++o)this._accumulateShadow();this._cameraForcedForScreenshot=!1,this._requestRender()}render(e){this._accumulationRenderer.render(e)}setOptions(e){if(e.enabled!==void 0){const i=this._fbo!=null;e.enabled!==i&&(e.enabled?this._enable():this._disable())}e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,i){return!this._isActive||!this._fbo||this._progress<1||e<0||e>=this._fbo.width||i<0||i>=this._fbo.height?0:(this._fbo.readPixels(e,i,1,1,pt.RED,hs.UNSIGNED_BYTE,Ele),Ele[0]/this._progress)}_enable(){this._progress=0;const e=new Li;e.pixelFormat=pt.RED,e.internalFormat=Ge.R8,e.wrapMode=Nt.CLAMP_TO_EDGE,this._fbo=new rp(this._rctx,e)}_disable(){this._fbo=et(this._fbo)}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(hr.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._lightDirections[this._progress++],this._depthRange);const e=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,cg(this._vao,"geometry"))}_updateCamera(e){!e.equals(this._bindParameters.camera)&&this._fbo&&(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-X3(Kgt,Qgt,e.relativeElevation))}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};h([f()],nl.prototype,"_progress",void 0),h([f()],nl.prototype,"_sampleCount",void 0),h([f()],nl.prototype,"_fbo",void 0),h([f()],nl.prototype,"_depthRange",void 0),h([f()],nl.prototype,"_previewing",void 0),h([f()],nl.prototype,"_accumulationRenderer",void 0),h([f()],nl.prototype,"_isRefining",null),h([f()],nl.prototype,"_isActive",null),h([f()],nl.prototype,"canAccumulate",null),h([f()],nl.prototype,"_isDoneAccumulating",null),h([f()],nl.prototype,"_opacityFromElevation",null),h([f()],nl.prototype,"running",null),nl=h([z("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],nl);const e0t=6,Sle="renderView",Ele=new Uint8Array(1),Cle=Ug();let t0t=class{constructor(){this._plane=Ug()}get isEnabled(){return!K0e(this.plane,Cle)}get plane(){return this._plane}set plane(e){lw(e||Cle,this._plane)}};function i0t(t,e){const i=-t[0],r=-t[1],n=-t[2],s=e[3],o=e[7],a=e[11],l=e[15];e[0]+=s*i,e[1]+=s*r,e[2]+=s*n,e[4]+=o*i,e[5]+=o*r,e[6]+=o*n,e[8]+=a*i,e[9]+=a*r,e[10]+=a*n,e[12]+=l*i,e[13]+=l*r,e[14]+=l*n}function r0t(t,e){const i=t[0],r=t[1],n=t[2];e[12]+=i*e[0]+r*e[4]+n*e[8],e[13]+=i*e[1]+r*e[5]+n*e[9],e[14]+=i*e[2]+r*e[6]+n*e[10],e[14]+=i*e[3]+r*e[7]+n*e[11]}let n0t=class{constructor(e){this._factory=e,this._originData=new Map}acquire(e){return this.register(this._factory.getOrigin(e))}register(e){const i=this._originData.get(e.id)||new s0t(e);return i.refCount++,this._originData.has(i.origin.id)||this._originData.set(i.origin.id,i),i}release(e){e.refCount--,e.refCount===0&&this._originData.delete(e.origin.id)}updateViewMatrices(e){this._originData.forEach(i=>{Nn(i.viewMatrix,e),r0t(i.origin.vec3,i.viewMatrix)})}},s0t=class{constructor(e){this.origin=e,this.refCount=0,this.viewMatrix=be()}},o0t=class extends o1e{constructor(e,i){super(),this.distanceFalloffFactor=e,this.transparency=i,this.transformNormalViewFromGlobal=Hr()}},a0t=class extends a1e{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Hr(),this.slicePlaneLocalOrigin=C(),this.transformNormalGlobalFromModel=Hr()}};function l0t(t){const e=b`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;t.code.add(e)}const c0t=ri(.5,-4e-4);function u0t(t,e){const i=t.vertex;i.include(l0t),i.constants.add("depthBias","vec2",c0t),i.uniforms.add(new zi("inverseViewport",(r,n)=>n.inverseViewport)),e.legacy?(i.uniforms.add(new Vr("proj",(r,n)=>n.camera.projectionMatrix)),i.code.add(b`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(i.uniforms.add(new sp("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal),new Vr("transformProjFromView",r=>r.transformProjFromView)),i.code.add(b`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),i.code.add(b`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function h0t(t,e){const i=t.fragment;i.constants.add("coverageTestThreshold","float",.01),e.antialiasing?i.code.add(b`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):i.code.add(b`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function d0t(t,e){const i=t.vertex;e.silhouette?(i.code.add(b`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),e.legacy?i.code.add(b`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):i.code.add(b`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):i.code.add(b`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function p0t(t,e){const i=t.vertex;i.include(Eh),i.uniforms.add(new Oe("distanceFalloffFactor",r=>r.distanceFalloffFactor)),i.code.add(b`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),i.uniforms.add(new oh("componentDataTex",r=>r.componentDataTexture)),t.attributes.add(O.COMPONENTINDEX,"float"),i.constants.add("componentColorFieldOffset","float",0),i.constants.add("componentOtherFieldOffset","float",1),i.constants.add("componentVerticalOffsetFieldOffset","float",2),i.constants.add("componentFieldCount","float",3),i.constants.add("lineWidthFractionFactor","float",8),i.constants.add("extensionLengthOffset","float",128),i.constants.add("verticalOffsetScale","float",2*UZ),i.code.add(b`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float texSize = float(textureSize(componentDataTex, 0).x);
float colIndex = mod(fieldIndex, texSize);
float rowIndex = floor(fieldIndex / texSize);
return vec2(colIndex, rowIndex) + 0.5;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
float verticalOffset;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
float verticalOffset = (rgba2float(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) - 0.5) * verticalOffsetScale;
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5,
verticalOffset
);
}`),e.legacy?i.code.add(b`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(i.uniforms.add(new mO("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel)),i.code.add(b`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),e.silhouette?(t.attributes.add(O.NORMALA,"vec3"),t.attributes.add(O.NORMALB,"vec3"),i.code.add(b`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(t.attributes.add(O.NORMAL,"vec3"),i.code.add(b`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),e.legacy?i.code.add(b`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(i.include(TY,e),i.uniforms.add(new sp("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new mO("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new nu("transformWorldFromModelTL",r=>r.transformWorldFromModelTL),new nu("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new $t("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new $t("transformWorldFromViewTH",r=>r.transformWorldFromViewTH)),i.code.add(b`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${e.spherical?b`normalize(transformWorldFromModelTL + rotatedModelPosition);`:b`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),i.uniforms.add(new Vr("transformProjFromView",(r,n)=>n.camera.projectionMatrix)),i.code.add(b`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),i.code.add(b`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function f0t(t){return t.mode===cs.SKETCH||t.mode===cs.MIXED}var cs,L1;(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH",t[t.MIXED=2]="MIXED",t[t.COUNT=3]="COUNT"})(cs||(cs={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.SILHOUETTE=1]="SILHOUETTE"}(L1||(L1={}));function qZ(t,e){const i=t.vertex;switch(t.attributes.add(O.SIDENESS,"vec2"),e.mode===cs.MIXED?i.code.add(b`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):i.code.add(b`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),e.mode){case cs.MIXED:i.code.add(b`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case cs.SKETCH:i.code.add(b`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case cs.SOLID:i.code.add(b`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case cs.COUNT:break;default:e.mode}}function m0t(t,e){const i=t.vertex;switch(t.include(qZ,e),e.mode){case cs.SOLID:i.code.add(b`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case cs.SKETCH:i.uniforms.add(new ob("strokesAmplitude",r=>r.strokesTexture.amplitude)),i.code.add(b`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case cs.MIXED:i.uniforms.add(new ob("strokesAmplitude",r=>r.strokesTexture.amplitude)),i.code.add(b`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function g0t(t,e){t.include(qZ,e);const{vertex:i,fragment:r}=t;switch(f0t(e)&&(i.uniforms.add(new oh("strokesTexture",n=>n.strokesTexture.texture)),i.uniforms.add(new ob("strokesLog2Resolution",n=>Math.log2(n.strokesTexture.resolution)),new ob("strokeVariants",n=>n.strokesTexture.variants)),t.varyings.add("vStrokeUV","vec2"),r.uniforms.add(new oh("strokesTexture",n=>n.strokesTexture.texture),new ob("strokesNormalizationScale",n=>n.strokesTexture.normalizationScale)),i.code.add(b`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) / vec2(textureSize(strokesTexture, 0));
vStrokeUV.x += variantOffset;
}`),t.fragment.include(Eh),r.code.add(b`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),e.mode){case cs.SOLID:i.code.add(b`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),r.code.add(b`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case cs.SKETCH:i.code.add(b`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),r.code.add(b`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case cs.MIXED:t.varyings.add("vType","float"),i.code.add(b`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),r.code.add(b`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function y0t(t){const e=new mi,{vertex:i,fragment:r}=e;return t.legacy&&i.uniforms.add(new Ale("model"),new Ale("localView")),e.include(u0t,t),e.include(p0t,t),e.include(m0t,t),e.include(qZ,t),e.include(g0t,t),e.include(vn,t),e.include(d0t,t),e.include(h0t,t),e.include(uc,t),e.varyings.add("vColor","vec4"),e.varyings.add("vRadius","float"),e.varyings.add("vPosition","vec3"),e.varyings.add("vWorldPosition","vec3"),t.multipassEnabled&&e.varyings.add("vViewPos","vec3"),e.varyings.add("vLineLengthPixels","float"),e.varyings.add("vSizeFalloffFactor","float"),i.uniforms.add(new zi("pixelToNDC",(n,s)=>si(_0t,2/s.camera.fullViewport[2],2/s.camera.fullViewport[3])),new ai("viewport",(n,s)=>s.camera.fullViewport),new Oe("pixelRatio",(n,s)=>s.camera.pixelRatio)),e.attributes.add(O.POSITION0,"vec3"),e.attributes.add(O.POSITION1,"vec3"),e.attributes.add(O.VARIANTOFFSET,"float"),e.attributes.add(O.VARIANTSTROKE,"float"),e.attributes.add(O.VARIANTEXTENSION,"float"),i.code.add(b`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      ${t.multipassEnabled?"vViewPos = viewPos;":""}

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      ${t.antialiasing?b`
        const float aaPaddingPixels = 1.0;

        // Line size with padding
        float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
        float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;`:b`
        float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
        float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;`}

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${t.mode===cs.SKETCH?b`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:t.mode===cs.MIXED?b`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `),r.code.add(b`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${t.multipassEnabled?"terrainDepthTest(vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      fragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `),e}const _0t=Ue();let Ale=class extends Qr{constructor(e){super(e,"mat4")}};const v0t=Object.freeze(Object.defineProperty({__proto__:null,build:y0t},Symbol.toStringTag,{value:"Module"}));let ZCe=class JCe extends Ci{initializeProgram(e){return new wi(e.rctx,JCe.shader.get().build(this.configuration),mCe)}initializePipeline(e){return e.blendMinMax?Ot({blending:fo(Te.ONE,Te.ONE,Te.ZERO,Te.ONE,Df.ADD,e.blendMinMax.MAX),depthTest:{func:Pi.LEQUAL},colorWrite:Ft}):Ot({depthTest:{func:Pi.LEQUAL},depthWrite:_l,colorWrite:Ft})}};ZCe.shader=new bi(v0t,()=>pe(()=>import("./EdgeShader.glsl-42efe35a.js"),[],import.meta.url));let cd=class extends Ua{constructor(){super(...arguments),this.mode=cs.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.spherical=!1}};h([V({count:cs.COUNT})],cd.prototype,"mode",void 0),h([V()],cd.prototype,"hasSlicePlane",void 0),h([V()],cd.prototype,"silhouette",void 0),h([V()],cd.prototype,"legacy",void 0),h([V()],cd.prototype,"antialiasing",void 0),h([V()],cd.prototype,"doublePrecisionRequiresObfuscation",void 0),h([V()],cd.prototype,"multipassEnabled",void 0),h([V()],cd.prototype,"cullAboveGround",void 0),h([V()],cd.prototype,"spherical",void 0),h([V({constValue:!1})],cd.prototype,"occlusionPass",void 0);const b0t=8,gz=128,w0t={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},x0t={solid:cs.SOLID,sketch:cs.SKETCH,uber:cs.MIXED};let yz=class KCe{constructor(e,i,r){this._rctx=e,this._shaderTechniqueRepository=i,this._configuration=new cd,this.refCount=0,this._renderables=new Set,this._sortedRenderables={[Bt.TRANSPARENT]:{[Bt.TRANSPARENT]:new It,[Bt.OPAQUE]:new It},[Bt.OPAQUE]:{[Bt.TRANSPARENT]:new It,[Bt.OPAQUE]:new It}},this._renderablesDirty=!1,this._drawParameters=new a0t,this._settings={...w0t,...r},this.key=KCe.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const n=this._settings.strokesTexture.variants;this.writerSettings={variants:n,reducedPrecision:nr.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=x0t[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this._rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=e.driverTest.doublePrecisionRequiresObfuscation.result,this._configuration.spherical=r.spherical}dispose(){this._technique=Jt(this._technique)}addRenderable(e){this._renderables.add(e),this._renderablesDirty=!0}removeRenderable(e){this._renderables.delete(e),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(e,i){this._renderablesDirty&&this._sortRenderables();const r=this._sortedRenderables[i];r[Bt.TRANSPARENT].forAll(e),r[Bt.OPAQUE].forAll(e)}updateTechnique(e,i){return this._configuration.multipassEnabled=!!e.multipassEnabled,this._configuration.cullAboveGround=!!e.multipassTerrain.cullAboveGround,this._configuration.silhouette=i,this._technique=this._shaderTechniqueRepository.releaseAndAcquire(ZCe,this._configuration,this._technique),this._technique}bindRegularEdges(e,i){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(i,!1),e,i)}bindSilhouetteEdges(e,i){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(i,!0),e,i)}renderRegularEdges(e,i,r,n,s){this._render(e,i,i.regular.vao,r,n,s)}renderSilhouetteEdges(e,i,r,n,s){this._render(e,i,i.silhouette.vao,r,n,s)}_render(e,i,r,n,s,o){o>0&&(this._bindDraw(e,i,n,s),this._rctx.bindVAO(r),this._rctx.drawArraysInstanced(Qt.TRIANGLE_FAN,0,4,o))}_bindDraw(e,i,r,n){if(this._drawParameters.componentDataTexture=i.components.buffer.textureBuffer.texture,this._drawParameters.strokesTexture=this._settings.strokesTexture,"origin"in i.transform)this._lastOriginId!==i.transform.origin.origin.id&&(e.setUniformMatrix4fv("localView",i.transform.origin.viewMatrix),this._lastOriginId=i.transform.origin.origin.id),e.setUniformMatrix4fv("model",i.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=i.transform.origin.origin.vec3;else{const s=new Tk(i.transform.position),o=yh(Ole,uw(Ole,i.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=s.low,this._drawParameters.transformWorldFromModelTH=s.high,this._drawParameters.transformWorldFromModelRS=i.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=o;const a=n.camera.viewInverseTransposeMatrix;oe(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}e.bindDraw(this._drawParameters,n,r)}_sortRenderables(){this._renderablesDirty=!1,this._sortedRenderables[Bt.TRANSPARENT][Bt.TRANSPARENT].clear(),this._sortedRenderables[Bt.TRANSPARENT][Bt.OPAQUE].clear(),this._sortedRenderables[Bt.OPAQUE][Bt.TRANSPARENT].clear(),this._sortedRenderables[Bt.OPAQUE][Bt.OPAQUE].clear(),this._renderables.forEach(i=>{i.objectTransparency!==Bt.INVISIBLE&&i.edgeTransparency!==Bt.INVISIBLE&&this._sortedRenderables[i.objectTransparency][i.edgeTransparency].push(i)});const e=(i,r)=>"origin"in i.transform?"origin"in r.transform?i.transform.origin.origin.id<r.transform.origin.origin.id?-1:i.transform.origin.origin.id>r.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[Bt.TRANSPARENT][Bt.TRANSPARENT].sort(e),this._sortedRenderables[Bt.TRANSPARENT][Bt.OPAQUE].sort(e),this._sortedRenderables[Bt.OPAQUE][Bt.TRANSPARENT].sort(e),this._sortedRenderables[Bt.OPAQUE][Bt.OPAQUE].sort(e)}static getKey(e,i,r){return`edges-t:${e}:${i}:${r}`}};const Ole=sa();function SUt(t,e){return e.push(t.buffer),{buffer:t.buffer,layout:new eHe(t.layout)}}function Y$(t){return new T1e(t.layout).createView(t.buffer)}let T0t=class extends oEe{constructor(e){super("EdgeProcessingWorker","extract",{extract:i=>[i.dataBuffer],extractComponentsEdgeLocations:i=>[i.dataBuffer],extractEdgeLocations:i=>[i.dataBuffer]},e)}async process(e,i,r){if(r)return Pmt(e);const n=await this.invoke(new _z(e),i);return this._unpackOutput(n)}async extractEdgeLocations(e,i){const r=await this.invokeMethod("extractEdgeLocations",new _z(e),i);return Y$(r)}async extractComponentsEdgeLocations(e,i){const r=await this.invokeMethod("extractComponentsEdgeLocations",new _z(e),i);return Y$(r)}_unpackOutput(e){return{regular:{instancesData:Y$(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:Y$(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}}},_z=class{constructor(e){this.dataBuffer=e.data.buffer,this.writerSettings=e.writerSettings,this.skipDeduplicate=e.skipDeduplicate,this.indices=uh(e.indices)?e.indices:e.indices.buffer,this.indicesType=uh(e.indices)?"Array":c4(e.indices)?"Uint32Array":"Uint16Array",this.indicesLength=e.indicesLength}};function S0t(t){const i=sC.resolution,r=i/2,n=new Uint8Array(4*i*i),s=4*i*r,o=sC.amplitude,a=2*o,l=4*i,c=Math.log2(i)+1,u=sC.strokes.length;let d=(c-1)*u*l;for(const{distance:m,pressure:y}of sC.strokes){let _=m,v=y,w=d;for(let x=0;x<c;x++){x!==0&&(_=Rle(_,kO.DISTANCE),v=Rle(v,kO.PRESSURE));for(let T=0;T<sC.resolution;T++){const S=.5+(_?_[T%_.length]/a:0),E=v?v[T%v.length]:1;RO(S,n,w),RO(E,n,w+s),w+=4}w-=l*(u+1)}d+=l}const p=new Pt(t,new Li(i),n);return new C0t(i,a,o,u,p)}function Rle(t,e){if(!t)return null;const i=t.length/2,r=E0t*i,n=new Array(i);let s=0;const o=e===kO.PRESSURE;for(let a=0;a<t.length;a+=2){const l=(t[a]+t[a+1])/2;n[s++]=o?Math.min(r,1-(1-l)*Ple):Math.min(r,l*Ple)}return n}var kO;(function(t){t[t.DISTANCE=0]="DISTANCE",t[t.PRESSURE=1]="PRESSURE"})(kO||(kO={}));const E0t=.1,Ple=.5;let C0t=class{constructor(e,i,r,n,s){this.resolution=e,this.normalizationScale=i,this.amplitude=r,this.variants=n,this.texture=s}dispose(){this.texture=et(this.texture)}};const sC={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function Mle(t){let e=null;for(const i of t){const r=i.type;if(A0t(i)){if(e==null)e=r;else if(e!==r)return"uber"}}return e??"uber"}function $le(t){let e=Bt.INVISIBLE;for(const{material:i}of t)if(QCe(i)){if(i.color[3]*i.opacity<1)return Bt.TRANSPARENT;e=Bt.OPAQUE}return e}function Ile(t){let e=Bt.INVISIBLE;for(const{material:i}of t)if(QCe(i)){switch(i.objectTransparency){case Bt.TRANSPARENT:case Bt.INVISIBLE:return Bt.TRANSPARENT;case Bt.OPAQUE:if(i.opacity<1)return Bt.TRANSPARENT}e=Bt.OPAQUE}return e}function QCe(t){return t.size*t.color[3]*t.opacity>0}function A0t(t){return t.size*t.color[3]>0}function Lle(t,e,i,r){for(let n=0;n<t.length;n++){const s=t[n].index,o=e[n],a=e[n+1];if(r)for(let l=o;l<a;l++){const c=r[l];i.set(c,s)}else for(let l=o;l<a;l++)i.set(l,s)}}let ud=class extends xe{constructor(t){super(t),this._updatingHandles=new Ud,this._perObjectData=new Map,this._perObjectDataEvictionCache=new Set,this._renderers=new Map,this._gpuMemoryUsage=0,this._workerAbort=new AbortController,this._tmpModelPosition=C(),this._localOrigins=new n0t(new qX(t.renderSR))}initialize(){this._worker=new T0t(this.schedule),this._componentColorManager=new _Ce(this.rctx,3);const t=fCe.createBuffer(4);for(let e=0;e<4;e++)t.sideness.set(e,0,e===0||e===3?0:1),t.sideness.set(e,1,e===0||e===1?0:1);this._verticesBufferObject=Ri.createVertex(this.rctx,vi.STATIC_DRAW,t.buffer)}destroy(){this.destroyed||(this._perObjectData.forEach(t=>this._discardObjectEntry(t)),this._perObjectData.clear(),this._strokesTexture=et(this._strokesTexture),this._componentColorManager=Pe(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=et(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy(),this._set("schedule",$0t))}get updating(){return this._updatingHandles.updating}get usedMemory(){return this._gpuMemoryUsage}shouldRender(){return this._renderers.size>0}async addComponentObject(t,e,i,r,n,s,o,a){if(this.hasObject(t))return this.getObjectMemoryUsage(t);let l;const c=new Nle(new Promise(d=>l=d),i.center,i.radius);this._perObjectData.set(t,c);const u=await this._updatingHandles.addPromise(this._addComponentGeometry(e,c,r,n,s,o,a));return this.setNeedsRender(),l(),u}async addOrUpdateObject3D(t,e,i,r){if(this.destroyed)return void ne.getLogger(this).warn("Attempt to add an object to a destroyed instance");const n=this._perObjectData.get(t);let s;n?.renderables.length>0&&this._perObjectDataEvictionCache.add(n);const o=t.boundingVolumeWorldSpace.bounds,a=new Nle(new Promise(c=>s=c),o,ag(o));this._perObjectData.set(t,a);const l=new Array;if(i.mergeGeometries&&t.geometries.length>1&&O0t(t))l.push(this._addObjectMergedGeometries(t,a,e,i,r));else for(let c=0;c<t.geometries.length;c++){const u=t.geometries[c];u.material.supportsEdges&&l.push(this._addGeometry(t,a,u,e[0],i,r))}await this._updatingHandles.addPromise(Promise.all(l)),this._perObjectDataEvictionCache.delete(a),this._discardObjectEntry(n),this.setNeedsRender(),s()}fastUpdateObject3DEdgesTransform(t){if(this.destroyed)return!1;const e=this._perObjectData.get(t);if(!e)return!1;const{geometries:i}=t,{renderables:r}=e;if(i.length===0||r.length===0)return!0;if(r.length>1)return!1;const[n]=r,s=n.transform;if(!(s instanceof vz))return!1;const[o]=i;if(o.localOrigin!==s.origin.origin)return!1;const a=be(),l=this._computeModelTransformWithLocalOrigin(t,o,a);return n.transform=new vz(a,l),this.setNeedsRender(),!0}_discardObjectEntry(t){t&&(t.renderables.length&&(t.renderables.forEach(e=>this._removeRenderable(e)),this.setNeedsRender()),t.loaded=null)}hasObject(t){return this._perObjectData.has(t)}async updateAllComponentOpacities(t,e){const i=await this._updatingHandles.addPromise(this._getObjectEntry(t));if(i==null)return;const r=e instanceof Array?n=>e[n]:()=>e;i.renderables.forEach(n=>{const s=n.components.meta.length;for(let o=0;o<s;o++){const a=r(o),l=n.components.meta[o],c=l.index;l.material.opacity=a,n.components.buffer.textureBuffer.setDataElement(c,1,3,255*a)}this._updateTransparency(n)}),this.setNeedsRender()}async getObjectMemoryUsage(t){const e=await this._getObjectEntry(t);return e!=null?e.renderables.reduce((i,r)=>i+r.statistics.gpuMemoryUsage,0):0}async updateAllComponentMaterials(t,e,i,r){const n=t instanceof Yg,s=!!i.hasSlicePlane,o=Mle(e),a=yz.getKey(o,s,n),l=await this._updatingHandles.addPromise(this._getObjectEntry(t));l!=null&&(l.renderables.forEach(c=>{if(a!==c.rendererKey){const u=this._renderers.get(c.rendererKey),d=this._acquireRenderer(o,s,n);u.removeRenderable(c),--u.refCount,c.rendererKey=a,d.addRenderable(c)}for(let u=0;u<e.length;u++)c.components.meta[u].material=e[u];r&&this._updateComponentBuffer(c.components),this._updateTransparency(c)}),this.setNeedsRender())}async updateAllVerticalOffsets(t,e){const i=await this._updatingHandles.addPromise(this._getObjectEntry(t));i!=null&&(i.renderables.forEach(r=>{const n=r.components.meta;for(let s=0;s<n.length;s++)r.components.meta[s].verticalOffset=e?.[s]??0;this._updateComponentBuffer(r.components)}),this.setNeedsRender())}async updateObjectVisibility(t,e){const i=await this._updatingHandles.addPromise(this._getObjectEntry(t));i!=null&&(i.renderables.forEach(r=>r.visible=e),this.setNeedsRender())}removeObject(t){const e=this._perObjectData.get(t);e&&(this._perObjectData.delete(t),this._discardObjectEntry(e))}async _getObjectEntry(t){const e=this._perObjectData.get(t);if(!e)throw new Error("no object");return await e.loaded,e.loaded==null?null:e}render(t,e){if(this._componentColorManager==null)return;this._localOrigins.updateViewMatrices(t.camera.viewMatrix);const i=t.camera.viewInverseTransposeMatrix,r=C(),n=new Tk;let s=0,o=0;if(this._renderers.forEach(l=>{if(l.refCount===0)return this._renderers.delete(l.key),void l.dispose();let c=!0,u=!0;l.forEachRenderable(d=>{d.visible&&(s+=d.statistics.averageEdgeLength,o++,c&&d.regular&&(l.updateTechnique(t,!1),c=!1),u&&d.silhouette&&(l.updateTechnique(t,!0),u=!1))},e)}),this._componentColorManager.garbageCollect(),this._componentColorManager.updateTextures(),o===0)return;const a=new o0t(40*s/o,e);oe(r,i[3],i[7],i[11]),n.set(r),se(a.transformWorldFromViewTH,n.high),se(a.transformWorldFromViewTL,n.low),gh(a.transformViewFromCameraRelativeRS,t.camera.viewMatrix),yh(zle,a.transformViewFromCameraRelativeRS),uw(a.transformNormalViewFromGlobal,zle),a.transformProjFromView=t.camera.projectionMatrix,this._updateObjectCameraDistances(t),this._renderers.forEach(l=>{this._renderRegularEdges(l,t,a),this._renderSilhouetteEdges(l,t,a)})}_updateTransparency(t){const e=$le(t.components.meta),i=Ile(t.components.meta);e===t.edgeTransparency&&i===t.objectTransparency||(t.edgeTransparency=e,t.objectTransparency=i,this._renderers.get(t.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(t,e,i){t.getCombinedShaderTransformation(e,i);const r=e.localOrigin!=null?this._localOrigins.register(e.localOrigin):this._localOrigins.acquire(oe(this._tmpModelPosition,i[12],i[13],i[14]));return e.localOrigin=r.origin,i0t(r.origin.vec3,i),r}_updateComponentBuffer(t){const{meta:e,buffer:i}=t,r=new Uint8Array(4);for(let n=0;n<e.length;n++){const s=e[n].material,o=e[n].index,a=_e(Math.round(s.size*b0t),0,255),l=_e(s.extensionLength,-gz,255-gz)+gz,c=s.type==="solid"?R5.SOLID:R5.SKETCH,u=255*s.opacity,d=s.color,p=255*d[0],m=255*d[1],y=255*d[2],_=255*d[3];i.textureBuffer.setData(o,0,p,m,y,_),i.textureBuffer.setData(o,1,a,l,c,u),uCe(e[n].verticalOffset,r),i.textureBuffer.setData(o,2,r[0],r[1],r[2],r[3])}}_createComponentBuffers(t){if(this._componentColorManager==null)return null;const e=new Array,i=this._componentColorManager.getBuffer(t.length);for(let n=0;n<t.length;n++){const s=t[n],o=i.acquireIndex();e.push({index:o,verticalOffset:0,material:s})}const r=new R0t(i,e);return this._updateComponentBuffer(r),r}_extractEdges(t,e,i,r,n,s=n.length){return this._worker.process({data:e,indices:n,indicesLength:s,writerSettings:t,skipDeduplicate:i},this._workerAbort.signal,r)}_createRenderable(t,e,i,r,n){const s=c=>this._verticesBufferObject!=null?new P0t(new np(this.rctx,mCe,{vertices:vmt,instances:c===L1.REGULAR?A5.glLayout:O5.glLayout},{vertices:this._verticesBufferObject,instances:Ri.createVertex(this.rctx,vi.STATIC_DRAW,c===L1.REGULAR?t.regular.instancesData.buffer:t.silhouette.instancesData.buffer)}),c===L1.REGULAR?t.regular.lodInfo:t.silhouette.lodInfo):null,o=t.regular.lodInfo.lengths.length>0?s(L1.REGULAR):null,a=t.silhouette.lodInfo.lengths.length>0?s(L1.SILHOUETTE):null,l=(o?.vao.usedMemory??0)+(a?.vao.usedMemory??0);return new M0t(o,a,{gpuMemoryUsage:l,externalMemoryUsage:n,averageEdgeLength:t.averageEdgeLength},i,$le(e.meta),Ile(e.meta),e,r)}async _addGeometry(t,e,i,r,n,s){if(i.edgeIndicesLength<=0)return;const o=i.attributes.get(O.POSITION),a=be(),l=this._computeModelTransformWithLocalOrigin(t,i,a),c=new Ule(o,a,l);return this._addPositionData(e,c,i.edgeIndicesLength,r,n,s)}async _addPositionData(t,e,i,r,n,s=!1){if(t.loaded==null)return;const o=this._createComponentBuffers([r]);if(o==null)return;const a=this._acquireRenderer(r.type,!!n.hasSlicePlane,!0),{modelTransform:l,origin:c}=e,u=e.position.indices,d=e.position,p=d.data.length/d.size,m=E5.createBuffer(p);for(let v=0;v<p;v++)m.position.set(v,0,d.data[v*d.size]),m.position.set(v,1,d.data[v*d.size+1]),m.position.set(v,2,d.data[v*d.size+2]);Lle(o.meta,[0,m.componentIndex.count],m.componentIndex);const y=await this._updatingHandles.addPromise(this._extractEdges(a.writerSettings,m,!1,s,u,i));if(t.loaded==null)return;const _=this._createRenderable(y,o,new vz(l,c),a.key,!1);t.renderables.push(_),a.addRenderable(_),this._gpuMemoryUsage+=_.statistics.gpuMemoryUsage}async _addComponentGeometry(t,e,i,r,n,s,o){if(e.loaded==null)return 0;const a=this._createComponentBuffers(s);if(a==null)return 0;const l=Mle(s),c=this._acquireRenderer(l,o.hasSlicePlane||!1,!1),u=E5.createBuffer(i.length/3);WR(u.position.typedBuffer,i,u.position.typedBufferStride,3),Lle(a.meta,n,u.componentIndex,r);const d=!0,p=c.writerSettings,m=await this._updatingHandles.addPromise(this._extractEdges(p,u,d,!1,r));if(e.loaded==null)return 0;const y=this._createRenderable(m,a,t,c.key,!0);return e.renderables.push(y),c.addRenderable(y),y.statistics.gpuMemoryUsage}async _addObjectMergedGeometries(t,e,i,r,n){const s=new Map;let o=0,a=null,l=0;const c=t.geometries.filter(x=>{if(x.edgeIndicesLength<=0||!x.material.supportsEdges)return!1;!a&&x.localOrigin&&(a=x);const T=x.attributes.get(O.POSITION);return l+=T.data.length/T.size,o+=x.edgeIndicesLength,!0});if(c.length===0)return;const u=l>=65536?Uint32Array:Uint16Array,d=o?new u(o):null,p=[];let m=0;c.forEach(x=>{const T=x.attributes.get(O.POSITION),S=T.indices;let E=s.get(T.data);if(E==null){E=p.length/3;for(let A=0;A<T.data.length;A+=T.size)p.push(T.data[A]),p.push(T.data[A+1]),p.push(T.data[A+2]);s.set(T.data,E)}for(let A=0;A<x.edgeIndicesLength;A++)d[m++]=E+S[A]});const y=a||t.geometries[0],_=be(),v=this._computeModelTransformWithLocalOrigin(t,y,_);for(let x=0;x<t.geometries.length;x++)t.geometries[x].localOrigin=v.origin;const w=new Ule(new ke(p,d,3),_,v);await this._updatingHandles.addPromise(this._addPositionData(e,w,d.length,i[0],r,n))}_acquireRenderer(t,e,i){const r=yz.getKey(t,e,i);let n=this._renderers.get(r);return this._strokesTexture==null&&(this._strokesTexture=S0t(this.rctx)),n||(n=new yz(this.rctx,this.techniqueRepository,{type:t,hasSlicePlane:e,strokesTexture:this._strokesTexture,legacy:i,spherical:this.viewingMode===Me.Global}),this._renderers.set(r,n)),++n.refCount,n}_removeRenderable(t){Dle(t.regular),Dle(t.silhouette);const e=this._renderers.get(t.rendererKey);if(e){e.removeRenderable(t),--e.refCount,"origin"in t.transform&&this._localOrigins.release(t.transform.origin),this._gpuMemoryUsage-=t.statistics.externalMemoryUsage?0:t.statistics.gpuMemoryUsage;for(const i of t.components.meta)t.components.buffer.releaseIndex(i.index)}}_updateObjectCameraDistances(t){const e=t.camera.eye,i=t.camera.viewForward,r=C(),n=s=>{zs(r,s.center,e);const o=me(r,i),a=s.radius,l=o<-a?1/0:o<a?0:o-a;s.renderables.forEach(c=>c.distanceToCamera=l)};this._perObjectData.forEach(n),this._perObjectDataEvictionCache.forEach(n)}_renderRegularEdges(t,e,i){const r=t.bindRegularEdges(i,e),n=i.transparency,s=e.camera.perScreenPixelRatio;t.forEachRenderable(o=>{if(!Fle(o)||!o.visible)return;const a=X$(o.regular.lod.lengths,o.distanceToCamera,s);t.renderRegularEdges(r,o,i,e,a)},n)}_renderSilhouetteEdges(t,e,i){const r=t.bindSilhouetteEdges(i,e),n=i.transparency,s=e.camera.perScreenPixelRatio;t.forEachRenderable(o=>{if(!kle(o)||!o.visible)return;const a=X$(o.silhouette.lod.lengths,o.distanceToCamera,s);t.renderSilhouetteEdges(r,o,i,e,a)},n)}get test(){return{hasRenderedPrimitives:t=>{let e=!1;const i=t.perScreenPixelRatio,r=(n,s)=>n.forEachRenderable(o=>{o.visible&&!e&&(Fle(o)&&(e=X$(o.regular.lod.lengths,o.distanceToCamera,i)>0),!e&&kle(o)&&(e=X$(o.silhouette.lod.lengths,o.distanceToCamera,i)>0))},s);return this._renderers.forEach(n=>{e||(r(n,Bt.OPAQUE),r(n,Bt.TRANSPARENT))}),e},getObjectData:t=>this._perObjectData.get(t)}}};function Dle(t){t!=null&&(t.vao.vertexBuffers.instances.dispose(),t.vao.disposeVAOOnly(),t.vao=null)}function O0t(t){let e=null,i=null;for(let r=0;r<t.geometries.length;r++){const n=t.geometries[r];if(n.material.supportsEdges){if(e){if(!yg(e,n.transformation))return!1}else e=n.transformation;if(i||n.localOrigin==null){if(i?.localOrigin!=null&&n.localOrigin!=null&&i.localOrigin.id!==n.localOrigin.id)return!1}else i=n}}return!0}h([f({constructOnly:!0})],ud.prototype,"rctx",void 0),h([f({constructOnly:!0})],ud.prototype,"renderSR",void 0),h([f({constructOnly:!0})],ud.prototype,"viewingMode",void 0),h([f({constructOnly:!0})],ud.prototype,"techniqueRepository",void 0),h([f({constructOnly:!0})],ud.prototype,"setNeedsRender",void 0),h([f({constructOnly:!0})],ud.prototype,"schedule",void 0),h([f({readOnly:!0})],ud.prototype,"_updatingHandles",void 0),h([f({readOnly:!0})],ud.prototype,"updating",null),ud=h([z("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],ud);class Nle{constructor(e,i,r){this.center=i,this.radius=r,this.renderables=new Array,this.loaded=e,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}}class R0t{constructor(e,i){this.buffer=e,this.meta=i}}class P0t{constructor(e,i){this.vao=e,this.lod=i}}let vz=class{constructor(e,i){this.modelMatrix=e,this.origin=i}};class M0t{constructor(e,i,r,n,s,o,a,l){this.regular=e,this.silhouette=i,this.statistics=r,this.transform=n,this.edgeTransparency=s,this.objectTransparency=o,this.components=a,this.rendererKey=l,this.distanceToCamera=0,this.visible=!0}}function Fle(t){return t.regular!=null}function kle(t){return t.silhouette!=null}function X$(t,e,i){const r=e*i,n=wOe(t,r,!0);return n===-1?r<t[0]?t.length:0:t.length-n}class Ule{constructor(e,i,r){this.position=e,this.modelTransform=i,this.origin=r}}const zle=Hr(),$0t=()=>Promise.reject();function op(t){return window.WebGL2RenderingContext&&t instanceof window.WebGL2RenderingContext}let Ble=class{constructor(e,i,r,n,s,o,a,l,c){this.createQuery=e,this.deleteQuery=i,this.resultAvailable=r,this.getResult=n,this.disjoint=s,this.beginTimeElapsed=o,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=c}},km=!1;function I0t(t,e){if(e.disjointTimerQuery)return null;let i=t.getExtension("EXT_disjoint_timer_query_webgl2");return i&&op(t)?new Ble(()=>t.createQuery(),r=>{t.deleteQuery(r),km=!1},r=>t.getQueryParameter(r,t.QUERY_RESULT_AVAILABLE),r=>t.getQueryParameter(r,t.QUERY_RESULT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{km||(km=!0,t.beginQuery(i.TIME_ELAPSED_EXT,r))},()=>{t.endQuery(i.TIME_ELAPSED_EXT),km=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>t.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):(i=t.getExtension("EXT_disjoint_timer_query"),i?new Ble(()=>i.createQueryEXT(),r=>{i.deleteQueryEXT(r),km=!1},r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_AVAILABLE_EXT),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_EXT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{km||(km=!0,i.beginQueryEXT(i.TIME_ELAPSED_EXT,r))},()=>{i.endQueryEXT(i.TIME_ELAPSED_EXT),km=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):null)}function L0t(t,e){const i=t.capabilities.disjointTimerQuery;return i==null?null:new D0t(i,e)}let D0t=class{constructor(e,i){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,i.forEach(r=>{const n=this._timer.createQuery(),s=this._timer.createQuery();this._queryPool.push(n,s),this._queryResults.set(r,null)})}start(){km||(this._currentQuery=this._queryPool.pop(),this._currentQuery!=null&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||this._currentQuery==null||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const i=this._queryResults.get(e);if(i==null)return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(i))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const r=this._timer.getResult(i)/1e6;return this._queryPool.unshift(i),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,r}abort(){this._currentQuery!=null&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){this._currentQuery!=null&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{e!=null&&this._timer.deleteQuery(e)})}};var Sr;(function(t){t.OVERLAY="overlay",t.PREPARE="prepare",t.SHADOW_MAP="shadow map",t.LINEAR_DEPTH="linear depth",t.ACCUMULATED_SHADOWS="accumulated shadows",t.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",t.SSAO="SSAO",t.OPAQUE="opaque",t.OPAQUE_EDGES="opaque edges",t.VOXEL="voxel",t.TRANSPARENT="transparent",t.TRANSPARENT_EDGES="transparent edges",t.HUD_VISIBILITY="HUD visibility",t.TRANSPARENT_TERRAIN="transparent terrain",t.ENVIRONMENT="environment",t.LASER_LINES="laser lines",t.OCCLUDED="occluded",t.ANTIALIASING="antialiasing",t.HIGHLIGHTS="highlights",t.HUD="HUD",t.HUD_OCCLUDED="HUD occluded",t.FINISH="finish"})(Sr||(Sr={}));const Vle="Total";let N0t=class{constructor(e){this._rctx=e,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new Qm(Vle),this._cpuTimeSamplers=new Map(Object.values(Sr).map(i=>[i,new Qm(i)])),this._enableGPUTimer=0,this._totalGPUTime=new Qm("GPU"),this._gpuTimeSamplers=new Map(Object.values(Sr).map(i=>[i,new Qm(i)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return this._gpuTimerPool!=null}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(this._gpuTimerPool==null){const i=[...Object.values(Sr),Vle];this._gpuTimerPool=L0t(this._rctx,i)}if(this._gpuTimerPool==null)return{hasGPUTimerSupport:!1,remove:()=>{}};++this._enableGPUTimer;let e=!1;return{hasGPUTimerSupport:!0,remove:()=>{e||(e=!0,--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=et(this._gpuTimerPool)))}}}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),this._gpuTimerPool&&this._gpuTimerPool.start()}advance(e){const i=performance.now();if(this._cpuTimeSamplers.get(e).record(i-this._lastTimeStampCPU),this._lastTimeStampCPU=i,this._gpuTimerPool){const r=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).record(r),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool){const i=this._gpuTimerPool.stop(Sr.FINISH);this._gpuTimeSamplers.get(Sr.FINISH).record(i),this._rctx.gl.flush()}const e=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+e,this._totalCPUTime.record(e),this._gpuTimerPool&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((i,r)=>i+(r.last||0),0)),++this._totalFrameCount}},Pc=class extends xe{get _bindParameters(){return this._renderContext.bindParameters}updateRenderFeatures(t=null,e=!ie("disable-feature:high-quality-idle")){this._renderStateFeatures=xU(e,t),this.notifyChange("_renderStateFeatures"),this._renderPlugins.renderFeatureChanged(),this._requestRender()}isFeatureEnabled(t,e=this._state){return this._renderStateFeatures.get(e,t)??!1}setFeatureEnabled(t,e,i){this._renderStateFeatures.set(e,t,i),this.notifyChange("_renderStateFeatures"),this._requestRender()}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(Gn.HighQualityTransparency)}get hasReflections(){return this.hasWater&&(this._ssrEnabled||this.isFeatureEnabled(Gn.WaterReflection))}get hasDecorations(){return this._materialRenderersHas.decorations||this._renderPlugins.hasDecorations}get hasHighlights(){return this._materialRenderersHas.highlights||this._renderPlugins.produces(ae.OPAQUE_MATERIAL,U.Highlight)||this._renderPlugins.produces(ae.DRAPED_MATERIAL,U.Highlight)}get hasShadowHighlights(){return this._materialRenderersHas.highlights||this._renderPlugins.produces(ae.OPAQUE_MATERIAL,U.ShadowHighlight)}get _magnifierEnabled(){return this._bindParameters.decorations===Ql.ON&&this._magnifierHelper.enabled}get fullResolutionAtmosphere(){return this._stage.view.qualitySettings.highResolutionAtmosphere||this.isFeatureEnabled(Gn.HighResolutionAtmosphere)}get hasWater(){return this._materialRenderersHas.water||this._hasOverlayWater}constructor(t,e,i,r,n,s,o,a){super({}),this._stage=t,this._techniqueRepository=r,this._rctx=n,this._compositingHelper=s,this._magnifierHelper=o,this._requestRender=a,this._materialRenderers=new It,this._needsTransparentPass=!1,this._materialRenderersHas={hudElements:!1,highlights:!1,water:!1,decorations:!1,occludees:!1},this._hasOverlayWater=!1,this.renderOverlay=l=>{},this._isRendering=!1,this._backgroundColor=Mt(0,0,0,1),this._sliceHelper=new t0t,this._state=Si.IDLE,this._highQualityTransparencyEnabled=!0,this._terrainTransparency=$a.Opaque,this._ssrEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new kgt,this._renderHiddenTransparentEdges=()=>{},this._pluginInput=new fgt,this._releaseGeometryLinearDepth=l=>l?.release(),this._geometryLinearDepthFormat=rs.DEPTH16_BUFFER,this.fboCache=new OGe(n),this._renderStateFeatures=xU(!ie("disable-feature:high-quality-idle"),t.view.qualityProfile),this._offscreen=new jgt(this.fboCache,this._compositingHelper),this.performanceInfo=new N0t(this._rctx),this._shadowMap=new WX(this.fboCache,t.viewingMode),this._highlight=new $A({view:t.view}),this._shadowHighlight=new T2({view:t.view,viewingMode:t.viewingMode}),this._shadowAccumulator=new nl(this.fboCache,r,t,l=>{const c=this.shadowsEnabled;this._shadowMap.enabled=!0,this._prepare(l.camera,l.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=c},(l,c,u)=>{l.shadowMap.start(l.camera,c,u,!0,this._stage.view.qualitySettings.maximumPixelRatio),this._renderShadowCascades(U.Shadow,l.shadowMap),l.shadowMap.finish(),l.camera.setGLViewport(this._rctx),this._prepare(l.camera,l.contentCamera)},a),this._ssao=new fA({view:this._stage.view}),this._renderContext=new hit(this._rctx,this._offscreen,this._shadowMap,this._sliceHelper),this._renderPlugins=new rD({renderContext:this._renderContext,techniqueRepository:r,textureRepository:i,materialRepository:e,requestRender:a,controller:t,fbos:this.fboCache,isFeatureEnabled:l=>this.isFeatureEnabled(l)}),this.renderPassManager=new Zj,this._renderPlugins.add(this.renderPassManager),this._smaa=new g1({view:this._stage.view}),this._renderPlugins.add(this._smaa),this._blit=new x2({opacity:1,alphaMode:Jo.None}),this._renderPlugins.add(this._blit),this._renderPlugins.add(this._ssao),this._renderPlugins.add(this._highlight),this._renderPlugins.add(this._shadowHighlight),this.addHandles([le(()=>this._stage.view.state.camera,()=>a(),Yi),le(()=>nr.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,l=>{this._renderHiddenTransparentEdges=l?()=>this._renderEdges(Bt.TRANSPARENT):()=>{},a()},Zi),le(()=>this._stage.view.environment.background?.color,l=>{const c=l?pO(l):ru;Mr(this._backgroundColor,c[0]*c[3],c[1]*c[3],c[2]*c[3],c[3]),a()},Yi)])}normalizeCtorArgs(){return{}}destroy(){this._smaa.destroy(),this._blit.destroy(),this._gpuTimerHandle=pr(this._gpuTimerHandle),this._materialRenderers.forAll(t=>t.dispose()),this._materialRenderers.clear(),this._offscreen.dispose(),this._shadowMap.dispose(),this._ssao.destroy(),this._highlight.dispose(),this._shadowHighlight.destroy(),this._shadowAccumulator.dispose(),this._edgeView=Pe(this._edgeView),this.renderPassManager.dispose(),this._releaseFBOs(),this._disposeOffscreenBuffers(),this.fboCache.destroy(),R1e.prune()}_releaseFBOs(){this._bindParameters.ssr.lastFrameColor=Jt(this._bindParameters.ssr.lastFrameColor),this._bindParameters.multipassTerrain.linearDepth=Jt(this._bindParameters.multipassTerrain.linearDepth),this._bindParameters.multipassGeometry.linearDepth=Jt(this._bindParameters.multipassGeometry.linearDepth)}_disposeOffscreenBuffers(){this._offscreen.dispose(),this._disposeBindBuffers()}_disposeBindBuffers(){this._shadowMap.disposeOffscreenBuffers(),this._bindParameters.linearDepth=Jt(this._bindParameters.linearDepth),this._bindParameters.hudVisibility=Jt(this._bindParameters.hudVisibility)}get updating(){return this._smaa.updating||this._edgeView!=null&&this._edgeView.updating||this._shadowAccumulator.running||this._renderPlugins.updating||!this.isCameraFinal}ensureEdgeView(){if(this._edgeView==null){const t=this._stage.view.resourceController;this._edgeView=new ud({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._techniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:F0t(t)}),this.addHandles(le(()=>this._edgeView?.updating,()=>this._requestRender(),qi)),this._requestRender()}return this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return I4(this._bindParameters.ssr.reprojectionMatrix,zr)}set _reprojectionMatrix(t){_H(this._bindParameters.ssr.reprojectionMatrix,t)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){return!!this._shadowMap?.enabled}setParameters(t){const{_shadowMap:e,_bindParameters:i}=this;if(t.qualitySettings?.reflections!==void 0&&this._ssrEnabled!==t.qualitySettings.reflections&&(this._ssrEnabled=t.qualitySettings.reflections,this._requestRender()),t.shadowMap!==void 0&&this._shadowMap.enabled!==t.shadowMap&&(this._shadowMap.enabled=t.shadowMap,this._requestRender()),t.shadowMapMaxCascades!==void 0&&e.maxCascades!==t.shadowMapMaxCascades&&(e.maxCascades=t.shadowMapMaxCascades,this._requestRender()),t.environment!=null){t.environment.weather!=null&&(this._bindParameters.weather=t.environment.weather,this._bindParameters.weatherVisible=!!t.weatherVisible);const r=t.environment.lighting.type!=="virtual";i.enableFillLights!==r&&(i.enableFillLights=r,this._requestRender())}t.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==t.highQualityTransparency&&(this._highQualityTransparencyEnabled=t.highQualityTransparency,this._requestRender()),t.hasOverlayWater!==void 0&&this._hasOverlayWater!==t.hasOverlayWater&&(this._hasOverlayWater=t.hasOverlayWater,this._requestRender()),t.slicePlane!==void 0&&this._sliceHelper.plane!==t.slicePlane&&(this._sliceHelper.plane=t.slicePlane,this._requestRender()),t.terrainTransparency!==void 0&&this._terrainTransparency!==t.terrainTransparency&&(this._terrainTransparency=t.terrainTransparency,this._requestRender()),t.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(t.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(t,e){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:i,removes:r,updates:n}=t;if(i.length===0&&r.length===0&&n.length===0)return;const s=Y2e(t);let o=!1;s.forEach((a,l)=>{if(e.done)return;let c=this._materialRenderers.find(u=>u.material===l);if(c==null&&a.adds.length>0){const u=new b3({material:l});u.initializeRenderContext(this._renderPlugins._context),c=u,this._materialRenderers.push(c)}c&&(c.modify(a),c.isEmpty&&(o=!0)),a.removes.forEach(u=>t.removes.removeUnordered(u)),a.adds.forEach(u=>t.adds.removeUnordered(u)),a.updates.forEach(u=>t.updates.removeUnordered(u)),e.madeProgress()}),o&&this._materialRenderers.filterInPlace(a=>!a.isEmpty||(a.dispose(),!1)),this._updateHasFlags(),this._requestRender()}_updateHasFlags(){const t=this._materialRenderersHas;t.decorations=!1,t.highlights=!1,t.hudElements=!1,t.water=!1,t.occludees=!1,this._materialRenderers.forAll(e=>{t.highlights||(t.highlights=e.hasHighlights),t.occludees||(t.occludees=e.hasOccludees),t.water||(t.water=e.hasWater),t.decorations||(t.decorations=e.isDecoration),t.hudElements||(t.hudElements=e.material.produces(ae.LINE_CALLOUTS_HUD_DEPTH,U.Color)||e.material.produces(ae.HUD_MATERIAL,U.Color)||e.material.produces(ae.LABEL_MATERIAL,U.Color))}),this._bindParameters.hasOccludees=t.occludees}updateAnimation(t){const e=this._hasAnimations;return this._hasAnimations=!1,this._materialRenderers.forAll(i=>this._hasAnimations=i.updateAnimation(t)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(t)||this._hasAnimations,this._hasAnimations!==e&&(this._gpuTimerHandle=e?pr(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}tick(){this.fboCache.clean()}render(t,e,i,r,n){const s=t!=null;this._isRendering=!0,this.performanceInfo.startFrame(),this.fboCache.frame(),this._disposeBindBuffers();const o=this._offscreen,{camera:a,contentCamera:l,mode:c,alignPixelEnabled:u}=i;this._state=c,this._bindParameters.overlay=this.renderOverlay(n),this.performanceInfo.advance(Sr.OVERLAY),this._renderContext.time=n,this._bindParameters.transparencyPassType=Qe.NONE,this._bindParameters.alignPixelEnabled=u,this._bindParameters.decorations=r;const d=Ug(this._sliceHelper.plane);r===Ql.OFF&&(this._sliceHelper.plane=null),a.setGLViewport(this._rctx);const p=o.initializeFrame(a,this._backgroundColor,s);this.hasReflections?this._bindParameters.ssr.lastFrameColor=p:p?.release(),this._prepare(a,l),this._renderPlugins.prepareRender(),this.performanceInfo.advance(Sr.PREPARE);const m=this._computeDepthRange(a);this._renderShadowMap(a,this._bindParameters.lighting.mainLight.direction,m),this.performanceInfo.advance(Sr.SHADOW_MAP),this._ensureBindParameters(a,l);const y=this._renderPlugins.produces(ae.OPAQUE_TERRAIN)&&(this._terrainTransparency===$a.Semitransparent||this._terrainTransparency===$a.TransparentWithDraped),_=this._highQualityTransparency&&y,v=this._needsTransparentPass||this._renderPlugins.produces(ae.TRANSPARENT_MATERIAL);this._prepareShaders(_,v),this._renderLinearDepth(),this.performanceInfo.advance(Sr.LINEAR_DEPTH),this._renderShadowAccumulation(m,a,l),this.performanceInfo.advance(Sr.ACCUMULATED_SHADOWS),this._ensureBindParametersSSR(n),this._renderSSAO(),this.performanceInfo.advance(Sr.SSAO),this._renderContext.output=U.Color,o.bindFbo(),this._renderOpaqueGeometry(),this._renderPlugins.render(ae.ENVIRONMENT_OPAQUE),this.performanceInfo.advance(Sr.OPAQUE),this._renderTerrainLinearDepth(_),this._setMultipassTerrain(_),this._renderEdges(Bt.OPAQUE),this.performanceInfo.advance(Sr.OPAQUE_EDGES),o.bindFbo(),this._renderPlugins.render(ae.VOXEL),this.performanceInfo.advance(Sr.VOXEL),this._renderHiddenTransparentEdges(),v&&(this._oitEnabled?this._renderOITPass(K2.Geometry):this._renderTransparentMaterial()),this.performanceInfo.advance(Sr.TRANSPARENT);const w=this._renderGeometryLinearDepth(_);this._renderHUDVisibility(w),_||this._renderInternalSlot(ae.LINE_CALLOUTS),this.performanceInfo.advance(Sr.HUD_VISIBILITY),this._renderObjectAndLayerIdColor(e),this.performanceInfo.advance(Sr.OBJECT_AND_LAYER_ID_COLOR),this._renderEdges(Bt.TRANSPARENT,w),this._releaseGeometryLinearDepth(w),this.performanceInfo.advance(Sr.TRANSPARENT_EDGES);const x=y?this._renderTransparentTerrain():null;x&&this._bindParameters.hudVisibility&&(_?this._renderLineCallouts(kl.Occluded):o.compositeToHUDVisibility(this._bindParameters,x.colorTexture),this._renderHUD(kl.Occluded,o.color),this.performanceInfo.advance(Sr.HUD_OCCLUDED)),this.performanceInfo.advance(Sr.TRANSPARENT_TERRAIN),this._setTerrainCulling(!1),x&&(o.compositeToFramebuffer(this._bindParameters,x.colorTexture,Jo.PremultipliedAlpha,1),x.release(),_&&(this._renderEdges(Bt.OPAQUE),this.performanceInfo.advance(Sr.OPAQUE_EDGES),v&&(this._oitEnabled?this._renderOITPass(K2.Geometry):this._renderTransparentMaterial()),this.performanceInfo.advance(Sr.TRANSPARENT),this._renderEdges(Bt.TRANSPARENT),this.performanceInfo.advance(Sr.TRANSPARENT_EDGES))),this._bindParameters.ssao=Jt(this._bindParameters.ssao),_&&this._renderLineCallouts(kl.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),o.bindFbo(),this._renderInternalSlot(ae.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderPlugins.render(ae.ENVIRONMENT_TRANSPARENT),this.performanceInfo.advance(Sr.ENVIRONMENT),this._renderLaserlines(),this.performanceInfo.advance(Sr.LASER_LINES),this._renderOccluded(),this.performanceInfo.advance(Sr.OCCLUDED);const T=this._magnifierEnabled&&t==null?this.fboCache.acquire(hi.RGBA,this._offscreen.width,this._offscreen.height):null,S=this._renderComposite(T??t,this._offscreen.color)??t;this.performanceInfo.advance(Sr.ANTIALIASING),this._renderHUD(kl.NotOccluded,S),this.performanceInfo.advance(Sr.HUD),this._renderHighlights(S,this._bindParameters),this.performanceInfo.advance(Sr.HIGHLIGHTS),this._magnifierEnabled&&this._magnifierHelper.render(this._rctx,this._bindParameters),S!==t&&(this._rctx.bindFramebuffer(t?.fbo),this._compositingHelper.composite(this._bindParameters,T?.colorTexture,Jo.None)),T!==t&&T?.release(),this.onPostRender&&this.onPostRender(),this._releaseFBOs(),this._offscreen.releaseBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=d,this._isRendering=!1,this.performanceInfo.finishFrame(),s&&(this._releaseFBOs(),this._disposeOffscreenBuffers())}_prepareShaders(t,e){this._renderContext.output=U.Color,this._prepareOpaqueGeometrySlots(),this._setMultipassTerrain(t),this._renderPlugins.prepare(ae.TRANSPARENT_TERRAIN),this._setMultipassTerrain(!1),t||this._prepareInternalSlots(this._materialRenderers,ae.LINE_CALLOUTS),e&&this._prepareTransparencySlots(),this._prepareInternalSlots(this._materialRenderers,ae.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderPlugins.prepare(ae.ENVIRONMENT_TRANSPARENT),this._renderPlugins.prepare(ae.LASERLINES),this._rctx.gl.flush()}_renderObjectAndLayerIdColor(t){if(t==null||!ie("enable-feature:objectAndLayerId-rendering"))return;const e=this._renderContext.output;this._rctx.bindFramebuffer(t.fbo),this._offscreen.renderToFBO(()=>this._renderAllGeometry(U.ObjectAndLayerIdColor),[0,0,0,0],!0,!0),this._rctx.bindFramebuffer(t.fbo),this._offscreen.renderToFBO(()=>{this._bindParameters.hudRenderStyle=kl.NotOccluded,this._renderInternalSlot(ae.HUD_MATERIAL)},void 0,!0,!0),this._renderContext.output=e}finish(t){this._hasAnimations||this._animationTimestep.clear();const e=this.performanceInfo.gpuSamplingEnabled,i=t===_n.BACKGROUND;if(i||e){const r=i?this.performanceInfo.elapsedTime:0,n=e?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),s=Math.max(r,n);this._animationTimestep.frame(s,i)}}readDepthPixels(t,e,i){const r=this._bindParameters.linearDepth?.fbo;if(r?.colorTexture)return void r.readPixels(e[0],e[1],e[2],e[3],pt.RGBA,hs.UNSIGNED_BYTE,i);const n=this.fboCache.acquire(hi.RGBA,this._offscreen.width,this._offscreen.height).acquireDepth(rs.DEPTH16_BUFFER);this._rctx.bindFramebuffer(n.fbo),this._ensureBindParameters(t,t),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const s=hr.COLOR_BUFFER_BIT|hr.DEPTH_BUFFER_BIT|hr.STENCIL_BUFFER_BIT;this._rctx.clearSafe(s),this._renderAllGeometry(U.Depth),n.fbo.readPixels(e[0],e[1],e[2],e[3],pt.RGBA,hs.UNSIGNED_BYTE,i),n.release()}readHUDVisibility(t,e,i,r,n){this._bindParameters.hudVisibility?.fbo.readPixels(t,e,i,r,pt.RGBA,hs.UNSIGNED_BYTE,n)}readAccumulatedShadow(t){return this._shadowAccumulator.readAccumulatedShadow(t[0],t[1])}_setMultipassTerrain(t){this._setMultipassEnabled(t),this._setTerrainCulling(t)}_setMultipassEnabled(t){this._bindParameters.multipassEnabled=t}_setTerrainCulling(t){this._bindParameters.multipassTerrain.cullAboveGround=t}_renderEdges(t,e){const i=this._edgeView;if(i?.shouldRender()){const{width:r,height:n,depth:s}=this._offscreen,o=this.fboCache.acquire(hi.RGBA,r,n),a=()=>i.render(this._bindParameters,t);this._offscreen.renderToTargets(a,o,e??s,Gle),this._offscreen.compositeToFramebuffer(this._bindParameters,o.colorTexture,Jo.Alpha,1),o.release()}}_renderShadowMap(t,e,i){const r=this._shadowMap;r.enabled&&(r.start(t,e,i,this.isFeatureEnabled(Gn.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._shadowHighlight.updateParameters(t,e),this._needsShadowHighlight?(this._renderShadowCascades(U.ShadowHighlight,this._shadowMap),r.moveSnapshot(yS.Highlight),r.clear(),this._renderShadowCascades(U.ShadowExcludeHighlight,this._shadowMap),r.copySnapshot(yS.Default),this._renderShadowCascades(U.ShadowHighlight,this._shadowMap)):this._renderShadowCascades(U.Shadow),r.finish(),t.setGLViewport(this._rctx))}_renderShadowCascades(t,e=this._shadowMap){for(const i of e.cascades)i.camera.setGLViewport(this._rctx),this._prepare(i.camera,i.camera),this._renderAllGeometry(t)}get _needsLinearDepth(){return this._renderPlugins.consumes(U.Depth)||this.hasReflections||this._needsShadowHighlight||this._needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?(this._bindParameters.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.linearDepth,()=>this._renderAllGeometry(U.Depth),[0,0,0,0],hi.RGBA,rs.DEPTH_STENCIL_BUFFER),this._bindParameters.linearDepth.releaseDepth(),this._offscreen.bindFbo()):this._bindParameters.linearDepth=Jt(this._bindParameters.linearDepth)}_renderTerrainLinearDepth(t){if(t){const e=this._renderContext.output;this._renderContext.output=U.Depth,this._bindParameters.multipassTerrain.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.multipassTerrain.linearDepth,()=>this._renderTransparentTerrain(),[-1e10,-1e10,-1e10,1]),this._bindParameters.multipassTerrain.linearDepth.releaseDepth(),this._renderContext.output=e}else this._bindParameters.multipassTerrain.linearDepth=Jt(this._bindParameters.multipassTerrain.linearDepth)}_renderGeometryLinearDepth(t){if(!t)return void(this._bindParameters.multipassGeometry.linearDepth=Jt(this._bindParameters.multipassGeometry.linearDepth));const e=this._renderContext.output;return this._bindParameters.multipassGeometry.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.multipassGeometry.linearDepth,()=>this._renderOpaqueGeometryAndTransparentMaterial(U.Depth),[1,1,1,1],hi.RGBA,this._geometryLinearDepthFormat),this._renderContext.output=e,this._bindParameters.multipassGeometry.linearDepth.detachDepth()}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(t){if(!this._needsDepthRange)return Gj;const e=Jmt(t,this._materialRenderers,this._stage.layers);return wS(e,this._renderPlugins.queryDepthRange(t)),e.near=Math.max(t.near,e.near),e.far=Math.min(t.far,e.far),e}_renderAllGeometry(t){this._renderContext.output=t,this._renderPlugins.prepare(ae.TRANSPARENT_TERRAIN),this._renderOpaqueGeometryAndTransparentMaterial(t),this._renderTransparentTerrain()}_renderOpaqueGeometryAndTransparentMaterial(t){this._renderContext.output=t,this._renderPlugins.prepare(ae.TRANSPARENT_MATERIAL),this._renderOpaqueGeometry(),this._renderTransparentMaterial()}_renderSSAO(){if(!this._renderPlugins.produces(ae.SSAO))return;const t=this._offscreen.renderToCachedFBO(null,()=>this._renderAllGeometry(U.Normal),[0,0,0,0],hi.RGBA4,rs.DEPTH24_BUFFER);t.releaseDepth(),this._offscreen.bindFbo(),this._pluginInput.normal=t,this._bindParameters.ssao=this._renderPlugins.render(ae.SSAO,this._pluginInput),t.release()}_prepareOpaqueGeometrySlots(){this._renderPlugins.prepare(ae.INTEGRATED_MESH),this._renderPlugins.prepare(ae.OPAQUE_TERRAIN),this._renderPlugins.prepare(ae.OPAQUE_MATERIAL),this._renderPlugins.prepare(ae.ENVIRONMENT_OPAQUE),this._prepareInternalSlots(this._materialRenderers,ae.OPAQUE_MATERIAL)}_renderOpaqueGeometry(){this._renderPlugins.render(ae.INTEGRATED_MESH),this._renderPlugins.render(ae.OPAQUE_TERRAIN),this._renderInternalSlot(ae.OPAQUE_MATERIAL),this._renderPlugins.render(ae.OPAQUE_MATERIAL)}_renderTransparentMaterial(){this._renderInternalSlot(ae.TRANSPARENT_MATERIAL),this._renderPlugins.render(ae.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){if(!this._renderPlugins.produces(ae.TRANSPARENT_TERRAIN))return;const t=()=>this._renderPlugins.render(ae.TRANSPARENT_TERRAIN,null);if(this._renderContext.output!==U.Color)return void t();const{width:e,height:i,depth:r}=this._offscreen,n=this.fboCache.acquire(hi.RGBA,e,i);return this._offscreen.renderToTargets(t,n,r,[0,0,0,0]),n}_renderHUDVisibility(t){this._shouldRenderInternalSlot(this._materialRenderers,ae.OCCLUSION_PIXELS)?(this._bindParameters.hudVisibility=this._offscreen.renderHUDVisibility(this._bindParameters.hudVisibility,()=>this._renderInternalSlot(ae.OCCLUSION_PIXELS),t),this._offscreen.bindFbo()):this._bindParameters.hudVisibility=Jt(this._bindParameters.hudVisibility)}_renderLineCallouts(t){if(this._bindParameters.hudRenderStyle=t,t===kl.Occluded){const e=()=>this._renderInternalSlot(ae.LINE_CALLOUTS),{width:i,height:r,color:n}=this._offscreen,s=this.fboCache.acquireDepth(rs.DEPTH16_BUFFER,i,r);this._offscreen.renderToTargets(e,n,s,void 0,!0,!0),s.release()}else this._renderInternalSlot(ae.LINE_CALLOUTS)}_renderLaserlines(){if(this._renderPlugins.render(ae.LASERLINES),this._renderPlugins.produces(ae.LASERLINES_CONTRAST_CONTROL)){const t=this._offscreen,{width:e,height:i,depth:r}=t,n=this.fboCache.acquire(hi.RGBA,e,i),s=()=>this._renderPlugins.render(ae.LASERLINES_CONTRAST_CONTROL);t.renderToTargets(s,n,r,Gle),t.compositeToFramebuffer(this._bindParameters,n.colorTexture,Jo.PremultipliedAlpha,1),n.release()}}_renderHUD(t,e){if(this._materialRenderersHas.hudElements)if(this._oitEnabled){const i=this._renderOITPass(K2.HUD,t);this._rctx.bindFramebuffer(e?.fbo),this._compositingHelper.composite(this._bindParameters,i.colorTexture,Jo.PremultipliedAlpha),i.release()}else if(t===kl.Occluded){const i=()=>this._renderHUDElements(t),{width:r,height:n,color:s}=this._offscreen,o=this.fboCache.acquireDepth(rs.DEPTH16_BUFFER,r,n);this._offscreen.renderToTargets(i,s,o,void 0,!0,!0),o.release()}else this._rctx.bindFramebuffer(null),e?.acquireDepth(rs.DEPTH16_BUFFER),this._rctx.bindFramebuffer(e?.fbo),this._renderHUDElements(t),e?.releaseDepth()}_renderHUDElements(t){this._bindParameters.hudRenderStyle=t,this._prepareInternalSlots(this._materialRenderers,ae.LINE_CALLOUTS_HUD_DEPTH,ae.HUD_MATERIAL,ae.LABEL_MATERIAL),this._renderInternalSlot(ae.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(ae.HUD_MATERIAL),this._renderInternalSlot(ae.LABEL_MATERIAL)}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._renderPlugins.produces(ae.SHADOW_HIGHLIGHT)&&this.hasShadowHighlights}_renderHighlights(t,e){if(!this.hasHighlights||e.decorations===Ql.OFF)return;const i=()=>{this._renderAllGeometry(U.Highlight),this._rctx.clearSafe(hr.DEPTH_BUFFER_BIT),this._renderHUDElements(kl.Both)},r=this._offscreen.renderToCachedFBO(null,i,[0,0,0,0],hi.RGBA4,rs.DEPTH_STENCIL_BUFFER);r.releaseDepth(),this._needsShadowHighlight&&(this._pluginInput.highlight=r,this._renderPlugins.render(ae.SHADOW_HIGHLIGHT,this._pluginInput,t)),this._renderPlugins.produces(ae.HIGHLIGHT)&&(this._pluginInput.composite=null,this._pluginInput.normal=null,this._pluginInput.highlight=r,this._renderPlugins.render(ae.HIGHLIGHT,this._pluginInput,t)),r.release()}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_renderShadowAccumulation(t,e,i){this._needsShadowCast&&this._bindParameters.linearDepth?.colorTexture&&this._shadowAccumulator.renderAccumulation(this._bindParameters.linearDepth,t,e,i)}_prepareTransparencySlots(){this._renderContext.output=U.Alpha,this._bindParameters.transparencyPassType=Qe.Alpha,this._prepareInternalSlots(this._materialRenderers,ae.TRANSPARENT_MATERIAL),this._renderPlugins.prepare(ae.TRANSPARENT_MATERIAL),this._renderContext.output=U.Color,this._bindParameters.transparencyPassType=Qe.Color,this._prepareInternalSlots(this._materialRenderers,ae.TRANSPARENT_MATERIAL),this._renderPlugins.prepare(ae.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=Qe.FrontFace,this._prepareInternalSlots(this._materialRenderers,ae.TRANSPARENT_MATERIAL),this._renderPlugins.prepare(ae.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=Qe.NONE}_renderOITPass(t,e=kl.Both){const i=t===K2.HUD,r=i?this.fboCache.acquire(hi.RGBA,this._offscreen.width,this._offscreen.height):null,n=i?()=>this._renderHUDElements(e):()=>this._renderTransparentMaterial(),s=this._renderContext.output;this._renderContext.output=U.Alpha,this._bindParameters.transparencyPassType=Qe.Alpha;const o=this._offscreen.renderOITPass(n,Qe.Alpha,i);this._renderContext.output=U.Color,this._bindParameters.transparencyPassType=Qe.Color;const a=this._offscreen.renderOITPass(n,Qe.Color,i);this._bindParameters.transparencyPassType=Qe.FrontFace;const l=this._offscreen.renderOITPass(n,Qe.FrontFace,i);return this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,a,o,l,r),r?.releaseDepth(),l.release(),a.release(),o.release(),this._bindParameters.transparencyPassType=Qe.NONE,this._renderContext.output=s,r}_renderOccluded(){let t=0;xc.clear(),this._materialRenderers.forAll(s=>{s.material&&s.material.isVisible()&&s.material.parameters.renderOccluded===Pr.OccludeAndTransparentStencil&&(t|=s.material.parameters.renderOccluded,xc.push(s))});const e=this._offscreen,i=(s,o,a,l,c)=>{if(!(t&o))return;const{width:u,height:d,depth:p}=e,m=this.fboCache.acquire(hi.RGBA,u,d);e.renderToTargets(a,m,p,[0,0,0,0],l,c),e.compositeToFramebuffer(this._bindParameters,m.colorTexture,Jo.PremultipliedAlpha,s),m.release()};xc.length!==0&&(this._prepareInternalSlots(xc,ae.OCCLUDER_MATERIAL,ae.TRANSPARENT_OCCLUDER_MATERIAL),this._renderInternalSlot(ae.OCCLUDER_MATERIAL,xc),i(.5,Pr.OccludeAndTransparentStencil,()=>this._renderInternalSlot(ae.TRANSPARENT_OCCLUDER_MATERIAL,xc),!1,!1)),xc.clear(),this._materialRenderers.forAll(s=>{s.material&&s.material.isVisible()&&(s.material.parameters.renderOccluded===Pr.OccludeAndTransparent||s.material.parameters.renderOccluded===Pr.Transparent||s.material.parameters.renderOccluded===Pr.Opaque)&&(t|=s.material.parameters.renderOccluded,xc.push(s))});const r=this._renderPlugins.renderOccludedFlags;if(t|=r,!t)return;const n=s=>{this._renderContext.renderOccludedMask=s,this._prepareInternalSlots(xc,ae.OPAQUE_MATERIAL,ae.TRANSPARENT_MATERIAL,ae.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),r>Pr.Occlude&&this._renderPlugins.render(ae.OCCLUDED_TERRAIN),this._renderInternalSlot(ae.OPAQUE_MATERIAL,xc),this._renderInternalSlot(ae.TRANSPARENT_MATERIAL,xc),this._renderInternalSlot(ae.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,xc),this._renderContext.resetRenderOccludedMask()};this._renderContext.output=U.Color,i(.5,Pr.OccludeAndTransparent,()=>n(Pr.OccludeAndTransparent),!0,gl.OutlineVisualElementMask),i(.5,Pr.Transparent,()=>n(Pr.Transparent),!0,gl.OutlineVisualElementMask),i(1,Pr.Opaque,()=>n(Pr.Opaque),!0,gl.OutlineVisualElementMask),xc.clear()}_renderComposite(t,e){this._renderPlugins.consumes(U.CompositeColor)&&(this._pluginInput.composite=e);let i=null;const r=this._renderPlugins.produces(ae.COMPOSITE);r&&(i=this._renderPlugins.renderComposition(ae.COMPOSITE,this._pluginInput),this._pluginInput.composite=i);const n=this._renderPlugins.produces(ae.ANTIALIASING),s=this._renderPlugins.render(n?ae.ANTIALIASING:ae.BLIT,this._pluginInput,t);return r&&i?.release(),s}_prepare(t,e){this._needsTransparentPass=this._materialRenderers.some(i=>i.material.produces(ae.TRANSPARENT_MATERIAL,U.Color)),this._bindParameters.camera=t,this._bindParameters.contentCamera=e}_ensureBindParameters(t,e){this._bindParameters.camera=t,this._bindParameters.contentCamera=e;const i=this._renderContext.offscreenRenderingHelper;this._bindParameters.mainColor=i.colorTexture,this._bindParameters.mainDepth=i.depthTexture}_ensureBindParametersSSR(t){if(this._bindParameters.ssr.lastFrameColor){this._ssrEnableTime==null&&(this._ssrEnableTime=t),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=zr:(qn(Hle,this._bindParameters.camera.viewMatrix),qn(jle,this._bindParameters.camera.projectionMatrix),Di(Mx,Hle,jle),Di(Mx,this._renderContext.lastFrameCamera.viewMatrix,Mx),Di(Mx,this._renderContext.lastFrameCamera.projectionMatrix,Mx),this._reprojectionMatrix=Mx);const e=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=e>0?Math.min(e,t-this._ssrEnableTime)/e:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._reprojectionMatrix=zr,this._ssrEnableTime=null}_shouldRenderInternalSlot(t,e){return this._bindParameters.slot=e,t.some(i=>i.prepareTechnique(this._renderContext)!=null)}_prepareInternalSlots(t,...e){for(const i of e)this._bindParameters.slot=i,t.forAll(r=>r.prepareTechnique(this._renderContext)!=null)}_renderInternalSlot(t,e=this._materialRenderers){this._bindParameters.slot=t,e.forAll(i=>{const r=i.prepareTechnique(this._renderContext);r&&i.renderNode(this._renderContext,r)})}get memoryInfo(){return{fbos:this.fboCache.usedMemory,vaos:this._materialRenderers.reduce((t,e)=>t+e.usedMemory,0),plugins:this._renderPlugins.usedMemory}}getMemoryForMaterial(t){return t==null?0:this._materialRenderers.find(i=>i.material===t)?.usedMemory??0}get usedMemory(){return this.fboCache.usedMemory+(this.edgeView?.usedMemory??0)+this._renderPlugins.usedMemory}get test(){const t=this;return{offscreen:this._offscreen,shadowMap:this._shadowMap,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,resetRenderStateFeatures:()=>{t._renderStateFeatures=xU(),this._renderPlugins.renderFeatureChanged(),this._requestRender()},releaseGeometryLinearDepth(e){t._releaseGeometryLinearDepth=e??(i=>i?.release()),t._geometryLinearDepthFormat=e?rs.DEPTH_STENCIL_TEXTURE:rs.DEPTH16_BUFFER},getFramebufferTexture:e=>{switch(e){case Q2.Color:return t._offscreen.colorTexture;case Q2.LinearDepth:return t._bindParameters.linearDepth?.colorTexture;case Q2.ShadowMap:return t._shadowMap.depthTexture;case Q2.HudVisibility:return t._bindParameters.hudVisibility?.colorTexture}}}}};var K2,Q2;h([f()],Pc.prototype,"_renderPlugins",void 0),h([f()],Pc.prototype,"_shadowAccumulator",void 0),h([f()],Pc.prototype,"_state",void 0),h([f()],Pc.prototype,"_renderStateFeatures",void 0),h([f({readOnly:!0})],Pc.prototype,"fullResolutionAtmosphere",null),h([f()],Pc.prototype,"_smaa",void 0),h([f()],Pc.prototype,"_blit",void 0),h([f({autoDestroy:!0})],Pc.prototype,"_edgeView",void 0),h([f()],Pc.prototype,"updating",null),h([f()],Pc.prototype,"isCameraFinal",null),Pc=h([z("esri.views.3d.webgl-engine.lib.Renderer")],Pc),function(t){t[t.Geometry=0]="Geometry",t[t.HUD=1]="HUD"}(K2||(K2={})),function(t){t[t.Color=0]="Color",t[t.LinearDepth=1]="LinearDepth",t[t.ShadowMap=2]="ShadowMap",t[t.HudVisibility=3]="HudVisibility"}(Q2||(Q2={}));const Gle=[0,0,0,0],xc=new It,jle=be(),Hle=be(),Mx=be();function F0t(t){return e=>t.immediate.schedule(e)}let k0t=class{constructor(e){this._rctx=e,this._vao=MGe(e)}destroy(){this._vao=et(this._vao)}draw(){this._vao!=null&&(this._rctx.bindVAO(this._vao),this._rctx.drawArrays(Qt.TRIANGLES,0,3))}get test(){return{cachedWebGLObjects:bz(this._vao?.glName)+bz(this._vao?.indexBuffer?.glName)+bz(this._vao?.vertexBuffers.geometry)}}};function bz(t){return t!=null?1:0}let eAe=class tAe{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:`#version 300 es
    precision highp float;

    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,fragment:`#version 300 es
    precision highp float;

    out vec4 fragColor;

    void main(void) {
      fragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`}}_createHelperProgram(){const e=tAe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}_createIndexbuffer(){return Ri.createIndex(this._rctx,vi.STATIC_DRAW,new Uint32Array([0]))}run(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,wt.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(Qt.POINTS,1,Ze.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}get test(){return{cachedWebGLObjects:this._indexBuffer?.glName?1:0}}},qle=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:Te.ONE,dstRGB:Te.ZERO,srcAlpha:Te.ONE,dstAlpha:Te.ZERO},this.blendEquation={mode:Df.ADD,modeAlpha:Df.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=Md.BACK,this.frontFace=oS.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=Pi.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:Md.FRONT_AND_BACK,func:Pi.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:Md.FRONT_AND_BACK,fail:Gr.KEEP,zFail:Gr.KEEP,zPass:Gr.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},U0t=class{constructor(e){this._allocations=new Map,e?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(e){this._allocations.set(e,new Error().stack)}remove(e){this._allocations.delete(e)}get information(){let e="";if(this._allocations.size>0){e+=`${this._allocations.size} live object allocations:
`;const i=new Map;this._allocations.forEach(r=>{i.set(r,(i.get(r)??0)+1)}),i.forEach((r,n)=>{const s=n.split(`
`);s.shift(),s.shift(),e+=`${r}: ${s.shift()}
`,s.forEach(o=>e+=`   ${o}
`)})}return e}};const z0t={RECORD_ALLOCATIONS:!1};let B0t=class{constructor(){for(this._current=new Array,this._allocations=new U0t(z0t.RECORD_ALLOCATIONS);this._current.length<Mn.COUNT;)this._current.push(0)}increment(e,i,r=1){this._current[e]+=r,this._allocations.add(i)}decrement(e,i,r=1){this._current[e]-=r,this._allocations.remove(i)}get current(){return this._current}get total(){return this.current.reduce((e,i,r)=>e+(r<Mn.UNCOUNTED?i:0),0)}get resourceInformation(){let e="";if(this.total>0){e+=`Live objects:
`;for(let i=0;i<Mn.COUNT;++i){const r=this._current[i];r>0&&(e+=`${Mn[i]}: ${r}
`)}}return e+=this._allocations.information,e}},V0t=class{constructor(e,i,r){const n=i.textureFilterAnisotropic,s=r.maxAnisotropy??1/0;this.versionString=e.getParameter(e.VERSION),this.maxVertexTextureImageUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxVertexAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxMaxAnisotropy=n?Math.min(e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY),s):1,this.maxTextureImageUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxRenderbufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),this.maxViewportDims=e.getParameter(e.MAX_VIEWPORT_DIMS),op(e)?(this.maxUniformBufferBindings=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=e.getParameter(e.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=e.getParameter(e.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=e.getParameter(e.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=e.getParameter(e.MAX_SAMPLES)):(this.maxUniformBufferBindings=0,this.maxVertexUniformBlocks=0,this.maxFragmentUniformBlocks=0,this.maxUniformBlockSize=0,this.uniformBufferOffsetAlignment=1,this.maxArrayTextureLayers=1,this.maxSamples=1)}};const G0t=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var Wle,iAe={exports:{}};(Wle=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(iAe.exports=Wle);const j0t=MR(iAe.exports);var Yle,Kj={exports:{}};Kj.exports,Yle=Kj,function(t){var e=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];e!==void 0&&(Yle.exports=e)}();const Xle=MR(Kj.exports);var rAe={exports:{}};(function(t){(function(e){var i=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();i!==void 0&&(t.exports=i)})()})(rAe);const H0t=MR(rAe.exports);var Wh=999,Zle=9999,wz=0,xz=1,Jle=2,Kle=3,Qle=4,Z$=5,q0t=6,W0t=7,Y0t=8,ece=9,X0t=10,tce=11,Z0t=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function J0t(){var t,e,i,r=0,n=0,s=Wh,o=[],a=[],l=1,c=0,u=0,d=!1,p=!1,m="";return function(R){return a=[],R!==null?_(R.replace?R.replace(/\r\n/g,`
`):R):v()};function y(R){R.length&&a.push({type:Z0t[s],data:R,position:u,line:l,column:c})}function _(R){var k;for(r=0,i=(m+=R).length;t=m[r],r<i;){switch(k=r,s){case wz:r=E();break;case xz:r=S();break;case Jle:r=T();break;case Kle:r=A();break;case Qle:r=F();break;case tce:r=N();break;case Z$:r=D();break;case Zle:r=$();break;case ece:r=x();break;case Wh:r=w()}k!==r&&(m[k]===`
`?(c=0,++l):++c)}return n+=r,m=m.slice(r),a}function v(R){return o.length&&y(o.join("")),s=X0t,y("(eof)"),a}function w(){return o=o.length?[]:o,e==="/"&&t==="*"?(u=n+r-1,s=wz,e=t,r+1):e==="/"&&t==="/"?(u=n+r-1,s=xz,e=t,r+1):t==="#"?(s=Jle,u=n+r,r):/\s/.test(t)?(s=ece,u=n+r,r):(d=/\d/.test(t),p=/[^\w_]/.test(t),u=n+r,s=d?Qle:p?Kle:Zle,r)}function x(){return/[^\s]/g.test(t)?(y(o.join("")),s=Wh,r):(o.push(t),e=t,r+1)}function T(){return t!=="\r"&&t!==`
`||e==="\\"?(o.push(t),e=t,r+1):(y(o.join("")),s=Wh,r)}function S(){return T()}function E(){return t==="/"&&e==="*"?(o.push(t),y(o.join("")),s=Wh,r+1):(o.push(t),e=t,r+1)}function A(){if(e==="."&&/\d/.test(t))return s=Z$,r;if(e==="/"&&t==="*")return s=wz,r;if(e==="/"&&t==="/")return s=xz,r;if(t==="."&&o.length){for(;P(o););return s=Z$,r}if(t===";"||t===")"||t==="("){if(o.length)for(;P(o););return y(t),s=Wh,r+1}var R=o.length===2&&t!=="=";if(/[\w_\d\s]/.test(t)||R){for(;P(o););return s=Wh,r}return o.push(t),e=t,r+1}function P(R){for(var k,B,j=0;;){if(k=Xle.indexOf(R.slice(0,R.length+j).join("")),B=Xle[k],k===-1){if(j--+R.length>0)continue;B=R.slice(0,1).join("")}return y(B),u+=B.length,(o=o.slice(B.length)).length}}function N(){return/[^a-fA-F0-9]/.test(t)?(y(o.join("")),s=Wh,r):(o.push(t),e=t,r+1)}function F(){return t==="."||/[eE]/.test(t)?(o.push(t),s=Z$,e=t,r+1):t==="x"&&o.length===1&&o[0]==="0"?(s=tce,o.push(t),e=t,r+1):/[^\d]/.test(t)?(y(o.join("")),s=Wh,r):(o.push(t),e=t,r+1)}function D(){return t==="f"&&(o.push(t),e=t,r+=1),/[eE]/.test(t)||t==="-"&&/[eE]/.test(e)?(o.push(t),e=t,r+1):/[^\d]/.test(t)?(y(o.join("")),s=Wh,r):(o.push(t),e=t,r+1)}function $(){if(/[^\d\w_]/.test(t)){var R=o.join("");return s=j0t.indexOf(R)>-1?Y0t:H0t.indexOf(R)>-1?W0t:q0t,y(o.join("")),s=Wh,r}return o.push(t),e=t,r+1}}function K0t(t){var e=J0t(),i=[];return i=(i=i.concat(e(t))).concat(e(null))}function Q0t(t){return K0t(t)}function eyt(t){return t.map(e=>e.type!=="eof"?e.data:"").join("")}const Tz=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]);function tyt(t,e="100",i="300 es"){const r=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const n of t)if(n.type==="preprocessor"){const s=r.exec(n.data);if(s){const o=s[1].replaceAll(/\s\s+/g," ");if(o===i)return o;if(o===e)return n.data="#version "+i,e;throw new Error("unknown glsl version: "+o)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:`
`}),null}function iyt(t,e){for(let i=e-1;i>=0;i--){const r=t[i];if(r.type!=="whitespace"&&r.type!=="block-comment"){if(r.type!=="keyword")break;if(r.data==="attribute"||r.data==="in")return!0}}return!1}function IA(t,e,i,r){r=r||i;for(const n of t)if(n.type==="ident"&&n.data===i)return r in e?e[r]++:e[r]=0,IA(t,e,r+"_"+e[r],r);return i}function nAe(t,e,i="afterVersion"){function r(l,c){for(let u=c;u<l.length;u++){const d=l[u];if(d.type==="operator"&&d.data===";")return u}return null}function n(l){let c=-1,u=0,d=-1;for(let p=0;p<l.length;p++){const m=l[p];if(m.type==="preprocessor"&&(/\#(if|ifdef|ifndef)\s+.+/.test(m.data)?++u:/\#endif\s*.*/.test(m.data)&&--u),i!=="afterVersion"&&i!=="afterPrecision"||m.type==="preprocessor"&&m.data.startsWith("#version")&&(d=Math.max(d,p)),i==="afterPrecision"&&m.type==="keyword"&&m.data==="precision"){const y=r(l,p);if(y===null)throw new Error("precision statement not followed by any semicolons!");d=Math.max(d,y)}c<d&&u===0&&(c=p)}return c+1}const s={data:`
`,type:"whitespace"},o=l=>l<t.length&&/[^\r\n]$/.test(t[l].data);let a=n(t);o(a-1)&&t.splice(a++,0,s);for(const l of e)t.splice(a++,0,l);o(a-1)&&o(a)&&t.splice(a,0,s)}function ryt(t,e,i,r="lowp"){nAe(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function nyt(t,e,i,r,n="lowp"){nAe(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:n},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function syt(t,e){let i,r,n=-1;for(let s=e;s<t.length;s++){const o=t[s];if(o.type==="operator"&&(o.data==="["&&(i=s),o.data==="]")){r=s;break}o.type==="integer"&&(n=parseInt(o.data,10))}return i&&r&&t.splice(i,r-i+1),n}function ice(t,e){if(t.startsWith("#version 300"))return t;const i=Q0t(t);if(tyt(i,"100","300 es")==="300 es")return t;let r=null,n=null;const s={},o={};for(let a=0;a<i.length;++a){const l=i[a];switch(l.type){case"keyword":e===Gc.VERTEX_SHADER&&l.data==="attribute"?l.data="in":l.data==="varying"&&(l.data=e===Gc.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(l.data.trim())&&(l.data=l.data.replaceAll(/(2D|Cube|EXT)/g,"")),e===Gc.FRAGMENT_SHADER&&l.data==="gl_FragColor"&&(r||(r=IA(i,s,"fragColor"),ryt(i,r,"vec4")),l.data=r),e===Gc.FRAGMENT_SHADER&&l.data==="gl_FragData"){const c=syt(i,a+1),u=IA(i,s,"fragData");nyt(i,u,"vec4",c,"mediump"),l.data=u}else e===Gc.FRAGMENT_SHADER&&l.data==="gl_FragDepthEXT"&&(n||(n=IA(i,s,"gl_FragDepth")),l.data=n);break;case"ident":if(G0t.includes(l.data)){if(e===Gc.VERTEX_SHADER&&iyt(i,a))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");l.data in o||(o[l.data]=IA(i,s,l.data)),l.data=o[l.data]}}}for(let a=i.length-1;a>=0;--a){const l=i[a];if(l.type==="preprocessor"){const c=l.data.match(/\#extension\s+(.*)\:/);if(c&&c[1]&&Tz.has(c[1].trim())){const p=i[a+1];i.splice(a,p&&p.type==="whitespace"?2:1)}const u=l.data.match(/\#ifdef\s+(.*)/);u&&u[1]&&Tz.has(u[1].trim())&&(l.data="#if 1");const d=l.data.match(/\#ifndef\s+(.*)/);d&&d[1]&&Tz.has(d[1].trim())&&(l.data="#if 0")}}return oyt(t,eyt(i))}function oyt(t,e){return e}const ayt=4294967295;let lyt=class{constructor(e,i,r,n,s=new Map){this._context=e,this._locations=n,this._uniformBlockBindings=s,this._refCount=1,this._compiled=!1,this._linesOfCode=0,this._nameToUniformLocation=new Map,this._nameToUniform1=new Map,this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),i.length===0&&console.error("Shaders source should not be empty!"),this._context.type===ni.WEBGL2&&(i=ice(i,Gc.VERTEX_SHADER),r=ice(r,Gc.FRAGMENT_SHADER)),this._vShader=rce(this._context,Gc.VERTEX_SHADER,i),this._fShader=rce(this._context,Gc.FRAGMENT_SHADER,r),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(Mn.Shader,this),O7()&&(this.vertexShader=i,this.fragmentShader=r);const o=this._context.gl,a=o.createProgram();if(o.attachShader(a,this._vShader),o.attachShader(a,this._fShader),this._locations.forEach((l,c)=>o.bindAttribLocation(a,l,c)),o.linkProgram(a),O7()&&!o.getProgramParameter(a,o.LINK_STATUS)&&console.error(`Could not link shader
validated: ${o.getProgramParameter(a,o.VALIDATE_STATUS)}, gl error ${o.getError()}, vertex: ${o.getShaderParameter(this._vShader,o.COMPILE_STATUS)}, fragment: ${o.getShaderParameter(this._fShader,o.COMPILE_STATUS)}, info log: ${o.getProgramInfoLog(a)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===ni.WEBGL2){const l=o;for(const[c,u]of this._uniformBlockBindings){const d=l.getUniformBlockIndex(a,c);d<ayt&&l.uniformBlockBinding(a,d,u)}}this._glName=a,this._context.instanceCounter.increment(Mn.Program,this)}get glName(){return this._glName}get hasGLName(){return this._glName!=null}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return e==null||this.glName==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl,i=this._context.instanceCounter;this._nameToUniformLocation.forEach(r=>r&&i.decrement(Mn.Uniform,r)),this._nameToUniformLocation.clear(),this._vShader&&(this._linesOfCode>0&&(i.decrement(Mn.LinesOfCode,this._vShader,this._linesOfCode),this._linesOfCode=0),e.deleteShader(this._vShader),this._vShader=null,i.decrement(Mn.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,i.decrement(Mn.Program,this))}ref(){++this._refCount}_getUniformLocation(e){const i=this._nameToUniformLocation.get(e);if(i!==void 0)return i;if(this.glName){const r=this._context.gl.getUniformLocation(this.glName,e);return this._nameToUniformLocation.set(e,r),r&&this._context.instanceCounter.increment(Mn.Uniform,r),r}return null}hasUniform(e){return this._getUniformLocation(e)!=null}setUniform1i(e,i){const r=this._nameToUniform1.get(e);r!==void 0&&i===r||(this._context.gl.uniform1i(this._getUniformLocation(e),i),this._nameToUniform1.set(e,i))}setUniform1iv(e,i){Op(this._nameToUniform1v,e,i)&&this._context.gl.uniform1iv(this._getUniformLocation(e),i)}setUniform2iv(e,i){Op(this._nameToUniform2,e,i)&&this._context.gl.uniform2iv(this._getUniformLocation(e),i)}setUniform3iv(e,i){Op(this._nameToUniform3,e,i)&&this._context.gl.uniform3iv(this._getUniformLocation(e),i)}setUniform4iv(e,i){Op(this._nameToUniform4,e,i)&&this._context.gl.uniform4iv(this._getUniformLocation(e),i)}setUniform1f(e,i){const r=this._nameToUniform1.get(e);r!==void 0&&i===r||(this._context.gl.uniform1f(this._getUniformLocation(e),i),this._nameToUniform1.set(e,i))}setUniform1fv(e,i){Op(this._nameToUniform1v,e,i)&&this._context.gl.uniform1fv(this._getUniformLocation(e),i)}setUniform2f(e,i,r){const n=this._nameToUniform2.get(e);n===void 0?(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),this._nameToUniform2.set(e,[i,r])):i===n[0]&&r===n[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),n[0]=i,n[1]=r)}setUniform2fv(e,i){Op(this._nameToUniform2,e,i)&&this._context.gl.uniform2fv(this._getUniformLocation(e),i)}setUniform3f(e,i,r,n){const s=this._nameToUniform3.get(e);s===void 0?(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,n),this._nameToUniform3.set(e,[i,r,n])):i===s[0]&&r===s[1]&&n===s[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,n),s[0]=i,s[1]=r,s[2]=n)}setUniform3fv(e,i){Op(this._nameToUniform3,e,i)&&this._context.gl.uniform3fv(this._getUniformLocation(e),i)}setUniform4f(e,i,r,n,s){const o=this._nameToUniform4.get(e);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,n,s),this._nameToUniform4.set(e,[i,r,n,s])):o!==void 0&&i===o[0]&&r===o[1]&&n===o[2]&&s===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,n,s),o[0]=i,o[1]=r,o[2]=n,o[3]=s)}setUniform4fv(e,i){Op(this._nameToUniform4,e,i)&&this._context.gl.uniform4fv(this._getUniformLocation(e),i)}setUniformMatrix3fv(e,i,r=!1){Op(this._nameToUniformMatrix3,e,i)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(e),r,i)}setUniformMatrix4fv(e,i,r=!1){Op(this._nameToUniformMatrix4,e,i)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(e),r,i)}stop(){}};function rce(t,e,i){const r=t.gl,n=r.createShader(e);return r.shaderSource(n,i),r.compileShader(n),O7()&&!r.getShaderParameter(n,r.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===Gc.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(r.getShaderInfoLog(n)),console.error(cyt(i))),n}function cyt(t){let e=2;return t.replaceAll(`
`,()=>`
`+uyt(e++)+":")}function uyt(t){return t>=1e3?t.toString():("  "+t).slice(-3)}function Op(t,e,i){const r=t.get(e);return r?_H(r,i):(t.set(e,Array.from(i)),!0)}let hyt=class{constructor(e){this._rctx=e,this._store=new XS}dispose(){this._store.forEach(e=>e.forEach(i=>i.dispose())),this._store.clear()}acquire(e,i,r,n){const s=this._store.get(e,i);if(s!=null)return s.ref(),s;const o=new lyt(this._rctx,e,i,r,n);return o.ref(),this._store.set(e,i,o),o}get test(){let e=0;return this._store.forEach(i=>i.forEach(r=>e+=r.hasGLName?2:1)),{cachedWebGLProgramObjects:e}}},XR=class{constructor(){this._result=!1}dispose(){this._program=et(this._program)}get result(){return this._program!=null&&(this._result=this._test(this._program),this.dispose()),this._result}},dyt=class extends XR{constructor(e){super(),this._rctx=e,this._helperProgram=null,this._rctx.type===ni.WEBGL2&&ie("mac")&&ie("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){super.dispose(),this._helperProgram?.dispose(),this._helperProgram=null}_test(e){const i=this._rctx,r=i.getBoundFramebufferObject(),{x:n,y:s,width:o,height:a}=i.getViewport();i.resetState();const l=new Li(1);l.wrapMode=Nt.CLAMP_TO_EDGE,l.samplingMode=Lt.NEAREST;const c=new rp(i,l),u=Ri.createIndex(this._rctx,vi.STATIC_DRAW,new Uint8Array([0]));i.bindFramebuffer(c),i.setViewport(0,0,1,1),i.useProgram(this._helperProgram),i.bindBuffer(u,wt.ELEMENT_ARRAY_BUFFER),i.drawElements(Qt.POINTS,1,Ze.UNSIGNED_BYTE,0),i.useProgram(e),i.bindVAO(null),i.drawArrays(Qt.TRIANGLES,0,258);const d=new Uint8Array(4);return c.readPixels(0,0,1,1,pt.RGBA,hs.UNSIGNED_BYTE,d),i.setViewport(n,s,o,a),i.bindFramebuffer(r),c.dispose(),u.dispose(),d[0]===255}_prepareProgram(){const i=`#version 300 es
    precision highp float;

    out float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${b.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,r=`#version 300 es
    precision highp float;

    in float triangleId;

    out vec4 fragColor;

    void main(void) {
      fragColor = triangleId == ${b.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(i,r,new Map([]))}_prepareHelperProgram(){const e=eAe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}},pyt=class extends XR{constructor(e){super(),this._rctx=e,this._program=nce(this._rctx,!1),this._obfuscated=nce(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=et(this._obfuscated)}_test(e){if(ie("force-double-precision-obfuscation"))return!0;if(this._obfuscated==null)return!1;const i=this._runProgram(e),r=this._runProgram(this._obfuscated);return i!==0&&(r===0||i/r>5)}_runProgram(e){const i=this._rctx;i.resetState();const r=new Li(1);r.wrapMode=Nt.CLAMP_TO_EDGE,r.samplingMode=Lt.NEAREST;const n=new rp(i,r),s=Ri.createVertex(i,vi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new bh(i,new Map([["position",0]]),{geometry:[new po("position",2,Ze.UNSIGNED_SHORT,0,4)]},{geometry:s}),a=Ce(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),l=Ce(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),c=new Float32Array(6);N7(a,c,3);const u=new Float32Array(6);N7(l,u,3),i.useProgram(e),e.setUniform3f("u_highA",c[0],c[2],c[4]),e.setUniform3f("u_lowA",c[1],c[3],c[5]),e.setUniform3f("u_highB",u[0],u[2],u[4]),e.setUniform3f("u_lowB",u[1],u[3],u[5]),i.bindFramebuffer(n),i.setViewport(0,0,1,1),i.bindVAO(o),i.drawArrays(Qt.TRIANGLE_STRIP,0,4);const d=new Uint8Array(4);n.readPixels(0,0,1,1,pt.RGBA,hs.UNSIGNED_BYTE,d),o.dispose(),n.dispose();const p=(a[2]-l[2])/25,m=BX(d);return Math.abs(p-m)}};function nce(t,e){const i=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,r=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `;return t.programCache.acquire(i,r,new Map([["position",0]]))}let fyt=class extends XR{constructor(e){if(super(),this._rctx=e,!e.gl)return;if(e.type===ni.WEBGL1)return void(this._result=!(!e.capabilities.textureFloat?.textureFloat||!e.capabilities.colorBufferFloat?.textureFloat));if(!(e.capabilities.textureFloat?.textureFloat&&e.capabilities.colorBufferFloat?.textureFloat&&e.capabilities.colorBufferFloat?.floatBlend))return;const i=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}_test(e){const i=this._rctx,r=new Li(1);r.wrapMode=Nt.CLAMP_TO_EDGE,r.dataType=hs.FLOAT,r.internalFormat=Ge.RGBA32F,r.samplingMode=Lt.NEAREST;const n=new rp(i,r),s=Ri.createVertex(i,vi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new bh(i,new Map([["a_pos",0]]),{geometry:[new po("a_pos",2,Ze.UNSIGNED_SHORT,0,4)]},{geometry:s});i.useProgram(e);const a=i.getBoundFramebufferObject(),{x:l,y:c,width:u,height:d}=i.getViewport();i.bindFramebuffer(n),i.setViewport(0,0,1,1),i.bindVAO(o),i.drawArrays(Qt.TRIANGLE_STRIP,0,4);const p=Ot({blending:wwe});i.setPipelineState(p),i.drawArrays(Qt.TRIANGLE_STRIP,0,4);const m=i.gl.getError();return i.setViewport(l,c,u,d),i.bindFramebuffer(a),o.dispose(),n.dispose(),m!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}},myt=class extends XR{constructor(e){super(),this._rctx=e;const i=`
      precision highp float;
      attribute vec2 a_pos;
      uniform highp sampler2D u_texture;
      varying vec4 v_color;

      float getBit(in float bitset, in int bitIndex) {
        float offset = pow(2.0, float(bitIndex));
        return mod(floor(bitset / offset), 2.0);
      }

      void main() {
        vec4 value = texture2D(u_texture, vec2(0.0));
        float bit = getBit(value.x * 255.0, 1);

        v_color = bit * vec4(1.0);
        gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
      }
      `,r=`
      precision highp float;
      varying vec4 v_color;

      void main() {
        gl_FragColor = v_color;
      }
      `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}_test(e){const i=this._rctx,r=new Li(1);r.wrapMode=Nt.CLAMP_TO_EDGE,r.samplingMode=Lt.NEAREST;const n=new rp(i,r),s=new Uint8Array(4),o=Ri.createVertex(i,vi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),a=new bh(i,new Map([["a_position",0]]),{geometry:[new po("a_position",2,Ze.SHORT,0,4)]},{geometry:o});i.useProgram(e);const l=new Pt(i,r,new Uint8Array([2,255,0,0]));e.setUniform1i("u_texture",0),i.bindTexture(l,0);const c=i.getBoundFramebufferObject();i.bindFramebuffer(n),i.useProgram(e);const{x:u,y:d,width:p,height:m}=i.getViewport();i.setViewport(0,0,1,1),i.bindVAO(a),i.drawArrays(Qt.TRIANGLE_STRIP,0,4),i.setViewport(u,d,p,m),n.readPixels(0,0,1,1,pt.RGBA,hs.UNSIGNED_BYTE,s),a.dispose(),n.dispose();const y=s[0]!==255||s[1]!==255||s[2]!==255||s[3]!==255;return y&&ne.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${s[0]}.${s[1]}.${s[2]}.${s[3]}]`),i.bindFramebuffer(c),y}};new po("a_pos",2,Ze.BYTE,0,2);new po("a_pos",2,Ze.BYTE,0,4),new po("a_tex",2,Ze.BYTE,2,4);const gyt={geometry:[new po("a_pos",2,Ze.UNSIGNED_SHORT,0,4)]};let yyt=class extends XR{constructor(e){super(),this._rctx=e;const i=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
    precision highp float;

    varying vec2 v_uv;

    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(e){const i=this._rctx;if(!i.gl)return e.dispose(),!0;const r=new Li(1);r.wrapMode=Nt.CLAMP_TO_EDGE,r.samplingMode=Lt.NEAREST;const n=new rp(i,r),s=Ri.createVertex(i,vi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new bh(i,new Map([["a_pos",0]]),gyt,{geometry:s}),a=new Li;a.samplingMode=Lt.LINEAR,a.wrapMode=Nt.CLAMP_TO_EDGE;const l=new Pt(i,a,LA);i.useProgram(e),i.bindTexture(l,0),e.setUniform1i("u_texture",0);const c=i.getBoundFramebufferObject(),{x:u,y:d,width:p,height:m}=i.getViewport();i.bindFramebuffer(n),i.setViewport(0,0,1,1),i.setClearColor(0,0,0,0),i.setBlendingEnabled(!1),i.clearSafe(hr.COLOR_BUFFER_BIT),i.bindVAO(o),i.drawArrays(Qt.TRIANGLE_STRIP,0,4);const y=new Uint8Array(4);return n.readPixels(0,0,1,1,pt.RGBA,hs.UNSIGNED_BYTE,y),o.dispose(),n.dispose(),l.dispose(),i.setViewport(u,d,p,m),i.bindFramebuffer(c),y[0]!==255}};const LA=new Image;LA.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",LA.width=5,LA.height=5,LA.decode();let _yt=class{constructor(e){this.rctx=e,this.floatBufferBlend=new fyt(e),this.svgPremultipliesAlpha=new yyt(e),this.doublePrecisionRequiresObfuscation=new pyt(e),this.ignoresSamplerPrecision=new myt(e),this.drawArraysRequiresIndicesTypeReset=new dyt(e)}dispose(){this.ignoresSamplerPrecision.dispose(),this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}};function vyt(t,e){if(e.disjointTimerQuery)return null;if(op(t))return{drawBuffers:t.drawBuffers.bind(t),MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS};if(e.drawBuffers)return null;const i=t.getExtension("WEBGL_draw_buffers");return i?{drawBuffers:i.drawBuffersWEBGL.bind(i),MAX_DRAW_BUFFERS:i.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:i.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function byt(t,e){if(e.compressedTextureETC)return null;const i=t.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function wyt(t,e){if(e.compressedTextureS3TC)return null;const i=t.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function xyt(t,e){if(op(t))return{MIN:t.MIN,MAX:t.MAX};if(e.blendMinMax)return null;{const i=t.getExtension("EXT_blend_minmax");return i?{MIN:i.MIN_EXT,MAX:i.MAX_EXT}:null}}function Tyt(t,e){if(e.textureFilterAnisotropic)return null;const i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}function Syt(t,e){if(op(t))return{textureFloat:!0,textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:t.HALF_FLOAT,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F};if(t instanceof WebGLRenderingContext){const i=!e.textureHalfFloat&&t.getExtension("OES_texture_half_float");return{textureFloat:!e.textureFloat&&!!t.getExtension("OES_texture_float"),textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!!i,textureHalfFloatLinear:!e.textureHalfFloatLinear&&!!t.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:i?i.HALF_FLOAT_OES:void 0}}return null}function Eyt(t,e){if(op(t)){const i=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),r=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),n=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return i||r||n?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!n,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}if(t instanceof WebGLRenderingContext){const i=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float"),r=!e.colorBufferFloat&&t.getExtension("WEBGL_color_buffer_float"),n=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return i||r||n?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!n,RGBA16F:i?i.RGBA16F_EXT:void 0,RGB16F:i?i.RGB16F_EXT:void 0,RGBA32F:r?r.RGBA32F_EXT:void 0}:null}return null}function sce(t,e,i,r,n){if(r&&op(t))return!0;if(e[i])return!1;for(const s of n)if(t.getExtension(s))return!0;return!1}function Cyt(t,e){if(!op(t)||e.textureNorm16)return null;const i=t.getExtension("EXT_texture_norm16");return i?{R16:i.R16_EXT,RG16:i.RG16_EXT,RGB16:i.RGB16_EXT,RGBA16:i.RGBA16_EXT,R16_SNORM:i.R16_SNORM_EXT,RG16_SNORM:i.RG16_SNORM_EXT,RGB16_SNORM:i.RGB16_SNORM_EXT,RGBA16_SNORM:i.RGBA16_SNORM_EXT}:null}function Ayt(t,e){const i=e.loseContext&&t.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}function Oyt(t,e){if(op(t))return{createVertexArray:t.createVertexArray.bind(t),deleteVertexArray:t.deleteVertexArray.bind(t),bindVertexArray:t.bindVertexArray.bind(t)};if(e.vao)return null;const i=t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object");return i?{createVertexArray:i.createVertexArrayOES.bind(i),deleteVertexArray:i.deleteVertexArrayOES.bind(i),bindVertexArray:i.bindVertexArrayOES.bind(i)}:null}let Ryt=class{constructor(e,i){this._gl=e,this._vertexArrayObject=null,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._textureFloat=null,this._colorBufferFloat=null,this._minMaxBlending=null,this._loseContext=null,this._drawBuffers=null,this._textureNorm16=null,this._depthTexture=null,this._textureFloatLinear=null,this._disabledExtensions=i.disabledExtensions||{},this._debugWebGLExtensions=i.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=vyt(this._gl,this._disabledExtensions)),this._drawBuffers}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=Oyt(this._gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=byt(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=wyt(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=Tyt(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=I0t(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=Syt(this._gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=Eyt(this._gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=xyt(this._gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=sce(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get loseContext(){return this._loseContext||(this._loseContext=Ayt(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=Cyt(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=sce(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(e){return this[e]}},Pyt=class{constructor(t,e){this.gl=t,this.instanceCounter=new B0t,this.programCache=new hyt(this),this._state=new qle,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=op(t)?ni.WEBGL2:ni.WEBGL1,this._loadExtensions(),this.configure(e)}get gl2(){return this.type===ni.WEBGL1?null:this.gl}configure(t){this._capabilities=new Ryt(this.gl,t),this._parameters=new V0t(this.gl,this._capabilities,t),Pt.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;const e=this.gl.getParameter(this.gl.VIEWPORT);this._state=new qle,this._state.viewport={x:e[0],y:e[1],width:e[2],height:e[3]},this._stateTracker=new cGe({setBlending:i=>{if(i){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(i.opRgb,i.opAlpha),this.setBlendFunctionSeparate(i.srcRgb,i.dstRgb,i.srcAlpha,i.dstAlpha);const r=i.color;this.setBlendColor(r.r,r.g,r.b,r.a)}else this.setBlendingEnabled(!1)},setCulling:i=>{i?(this.setFaceCullingEnabled(!0),this.setCullFace(i.face),this.setFrontFace(i.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:i=>{i?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(i.factor,i.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:i=>{i?(this.setDepthTestEnabled(!0),this.setDepthFunction(i.func)):this.setDepthTestEnabled(!1)},setStencilTest:i=>{if(i){this.setStencilTestEnabled(!0);const r=i.function;this.setStencilFunction(r.func,r.ref,r.mask);const n=i.operation;this.setStencilOp(n.fail,n.zFail,n.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:i=>{i?(this.setDepthWriteEnabled(!0),this.setDepthRange(i.zNear,i.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:i=>{i?this.setColorMask(i.r,i.g,i.b,i.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:i=>{i?this.setStencilWriteMask(i.mask):this.setStencilWriteMask(0)},setDrawBuffers:i=>{const{drawBuffers:r}=this._capabilities;if(i)r?.drawBuffers(i.buffers);else{const{drawFramebuffer:n}=this._state;n===null||n.colorAttachments.length===0?r?.drawBuffers([C7.BACK]):r?.drawBuffers([ll.COLOR_ATTACHMENT0])}}}),this.enforceState(),et(this._driverTest),this._driverTest=new _yt(this)}dispose(){et(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(wt.ARRAY_BUFFER),this.unbindBuffer(wt.ELEMENT_ARRAY_BUFFER),this.type===ni.WEBGL2&&(this.unbindBuffer(wt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(wt.PIXEL_PACK_BUFFER),this.unbindBuffer(wt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(wt.COPY_READ_BUFFER),this.unbindBuffer(wt.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,gd()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(t){this._stateTracker.setPipeline(t)}setBlendingEnabled(t){this._state.blend!==t&&(t===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=t,this._stateTracker.invalidateBlending())}externalProgramUpdate(){this._state.program?.stop(),this._state.program=null}externalTextureUnitUpdate(t,e){for(let i=0;i<t.length;++i)this._state.textureUnitMap[t[i]]=null;e>=0&&(this._state.activeTexture=e)}externalVertexArrayObjectUpdate(){const t=this.capabilities.vao;t&&(t.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(t,e,i,r){t===this._state.blendColor.r&&e===this._state.blendColor.g&&i===this._state.blendColor.b&&r===this._state.blendColor.a||(this.gl.blendColor(t,e,i,r),this._state.blendColor.r=t,this._state.blendColor.g=e,this._state.blendColor.b=i,this._state.blendColor.a=r,this._stateTracker.invalidateBlending())}setBlendFunction(t,e){t===this._state.blendFunction.srcRGB&&e===this._state.blendFunction.dstRGB||(this.gl.blendFunc(t,e),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=t,this._state.blendFunction.dstRGB=e,this._state.blendFunction.dstAlpha=e,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(t,e,i,r){this._state.blendFunction.srcRGB===t&&this._state.blendFunction.srcAlpha===i&&this._state.blendFunction.dstRGB===e&&this._state.blendFunction.dstAlpha===r||(this.gl.blendFuncSeparate(t,e,i,r),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=i,this._state.blendFunction.dstRGB=e,this._state.blendFunction.dstAlpha=r,this._stateTracker.invalidateBlending())}setBlendEquation(t){this._state.blendEquation.mode!==t&&(this.gl.blendEquation(t),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=t,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(t,e){this._state.blendEquation.mode===t&&this._state.blendEquation.modeAlpha===e||(this.gl.blendEquationSeparate(t,e),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setColorMask(t,e,i,r){this._state.colorMask.r===t&&this._state.colorMask.g===e&&this._state.colorMask.b===i&&this._state.colorMask.a===r||(this.gl.colorMask(t,e,i,r),this._state.colorMask.r=t,this._state.colorMask.g=e,this._state.colorMask.b=i,this._state.colorMask.a=r,this._stateTracker.invalidateColorWrite())}setClearColor(t,e,i,r){this._state.clearColor.r===t&&this._state.clearColor.g===e&&this._state.clearColor.b===i&&this._state.clearColor.a===r||(this.gl.clearColor(t,e,i,r),this._state.clearColor.r=t,this._state.clearColor.g=e,this._state.clearColor.b=i,this._state.clearColor.a=r)}setFaceCullingEnabled(t){this._state.faceCulling!==t&&(t===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=t,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(t){this._state.polygonOffsetFill!==t&&(t===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=t,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(t,e){this._state.polygonOffset[0]===t&&this._state.polygonOffset[1]===e||(this._state.polygonOffset[0]=t,this._state.polygonOffset[1]=e,this.gl.polygonOffset(t,e),this._stateTracker.invalidatePolygonOffset())}setCullFace(t){this._state.cullFace!==t&&(this.gl.cullFace(t),this._state.cullFace=t,this._stateTracker.invalidateCulling())}setFrontFace(t){this._state.frontFace!==t&&(this.gl.frontFace(t),this._state.frontFace=t,this._stateTracker.invalidateCulling())}setScissorTestEnabled(t){this._state.scissorTest!==t&&(t===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=t)}setScissorRect(t,e,i,r){this._state.scissorRect.x===t&&this._state.scissorRect.y===e&&this._state.scissorRect.width===i&&this._state.scissorRect.height===r||(this.gl.scissor(t,e,i,r),this._state.scissorRect.x=t,this._state.scissorRect.y=e,this._state.scissorRect.width=i,this._state.scissorRect.height=r)}setDepthTestEnabled(t){this._state.depthTest!==t&&(t===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=t,this._stateTracker.invalidateDepthTest())}setClearDepth(t){this._state.clearDepth!==t&&(this.gl.clearDepth(t),this._state.clearDepth=t)}setDepthFunction(t){this._state.depthFunction!==t&&(this.gl.depthFunc(t),this._state.depthFunction=t,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(t){this._state.depthWrite!==t&&(this.gl.depthMask(t),this._state.depthWrite=t,this._stateTracker.invalidateDepthWrite())}setDepthRange(t,e){this._state.depthRange.zNear===t&&this._state.depthRange.zFar===e||(this.gl.depthRange(t,e),this._state.depthRange.zNear=t,this._state.depthRange.zFar=e,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(t){this._state.stencilTest!==t&&(t===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=t,this._stateTracker.invalidateStencilTest())}setClearStencil(t){t!==this._state.clearStencil&&(this.gl.clearStencil(t),this._state.clearStencil=t)}setStencilFunction(t,e,i){this._state.stencilFunction.func===t&&this._state.stencilFunction.ref===e&&this._state.stencilFunction.mask===i||(this.gl.stencilFunc(t,e,i),this._state.stencilFunction.face=Md.FRONT_AND_BACK,this._state.stencilFunction.func=t,this._state.stencilFunction.ref=e,this._state.stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(t,e,i,r){this._state.stencilFunction.face===t&&this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===r||(this.gl.stencilFuncSeparate(t,e,i,r),this._state.stencilFunction.face=t,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(t){this._state.stencilWriteMask!==t&&(this.gl.stencilMask(t),this._state.stencilWriteMask=t,this._stateTracker.invalidateStencilWrite())}setStencilOp(t,e,i){this._state.stencilOperation.face===Md.FRONT_AND_BACK&&this._state.stencilOperation.fail===t&&this._state.stencilOperation.zFail===e&&this._state.stencilOperation.zPass===i||(this.gl.stencilOp(t,e,i),this._state.stencilOperation.face=Md.FRONT_AND_BACK,this._state.stencilOperation.fail=t,this._state.stencilOperation.zFail=e,this._state.stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(t,e,i,r){this._state.stencilOperation.face===t&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===r||(this.gl.stencilOpSeparate(t,e,i,r),this._state.stencilOperation.face=t,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setActiveTexture(t,e=!1){const i=this._state.activeTexture;return t>=0&&(e||t!==this._state.activeTexture)&&(this.gl.activeTexture(B6+t),this._state.activeTexture=t),i}clear(t){t&&this.gl.clear(t)}clearSafe(t,e=255){t&&(t&hr.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),t&hr.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),t&hr.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(e),this.gl.clear(t))}drawArrays(t,e,i){gd()&&(this._numOfDrawCalls++,this._numOfTriangles+=oce(t,i)),this.gl.drawArrays(t,e,i),cf(this.gl)}drawArraysInstanced(t,e,i,r){this.gl2?.drawArraysInstanced(t,e,i,r),cf(this.gl)}drawElements(t,e,i,r){if(gd()&&(this._numOfDrawCalls++,this._numOfTriangles+=oce(t,e)),this.gl.drawElements(t,e,i,r),gd()){const n=mGe(this);if(n){const s=this.getBoundVAO(),o=s?.indexBuffer,a=s?.vertexBuffers,l={indexBuffer:o,vertexBuffers:a},c={mode:t,count:e,type:i,offset:r},u=o?.size??0,d=r+e,p=u<d?`. Buffer is too small. Attempted to draw index ${d} of ${u}`:"";console.error(`drawElements: ${n}${p}`,{args:c,vao:l})}}}logInfo(){gd()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){gd()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(t,e,i,r){i=Math.max(Math.round(i),1),r=Math.max(Math.round(r),1);const n=this._state.viewport;n.x===t&&n.y===e&&n.width===i&&n.height===r||(n.x=t,n.y=e,n.width=i,n.height=r,this.gl.viewport(t,e,i,r))}setViewport4fv(t){this.setViewport(t[0],t[1],t[2],t[3])}getViewport(){const t=this._state.viewport;return{x:t.x,y:t.y,width:t.width,height:t.height}}useProgram(t){this._state.program!==t&&(this._state.program?.stop(),this._state.program=t,this.gl.useProgram(t?.glName??null))}bindTexture(t,e,i=!1){(e>=this.parameters.maxTextureImageUnits||e<0)&&console.error("Input texture unit is out of range of available units!");const r=this._state.textureUnitMap[e];return t?.glName==null?(r!=null&&(this.setActiveTexture(e,i),this.gl.bindTexture(r.descriptor.target,null)),this._state.textureUnitMap[e]=null,r):i||r!==t?(this.setActiveTexture(e,i),this.gl.bindTexture(t.descriptor.target,t.glName),t.applyChanges(),this._state.textureUnitMap[e]=t,r):(t.isDirty&&(this.setActiveTexture(e,i),t.applyChanges()),r)}unbindTexture(t){if(t!=null)for(let e=0;e<this.parameters.maxTextureImageUnits;e++)this._state.textureUnitMap[e]===t&&(this.bindTexture(null,e),this._state.textureUnitMap[e]=null)}bindFramebuffer(t,e=!1){if(e||this._state.readFramebuffer!==t||this._state.drawFramebuffer!==t){if(this._stateTracker.invalidateDrawBuffers(),t==null)return this.gl.bindFramebuffer(Eo.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);t.initializeAndBind(Eo.FRAMEBUFFER),this._state.readFramebuffer=t,this._state.drawFramebuffer=t}}bindFramebufferSeparate(t,e,i=!1){const r=e===Eo.READ_FRAMEBUFFER,n=r?this._state.readFramebuffer:this._state.drawFramebuffer;(i||n!==t)&&(t==null?this.gl.bindFramebuffer(e,null):t.initializeAndBind(e),r?this._state.readFramebuffer=t??null:this._state.drawFramebuffer=t??null)}blitFramebuffer(t,e,i=0,r=0,n=t.width,s=t.height,o=0,a=0,l=e.width,c=e.height,u=hr.COLOR_BUFFER_BIT,d=Lt.NEAREST){this.bindFramebufferSeparate(t,Eo.READ_FRAMEBUFFER),this.bindFramebufferSeparate(e,Eo.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(i,r,n,s,o,a,l,c,u,d)}bindBuffer(t,e){if(t)switch(e??(e=t.bufferType),e){case wt.ARRAY_BUFFER:this._state.vertexBuffer=Pl(this.gl,t,e,this._state.vertexBuffer);break;case wt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Pl(this.gl,t,e,this._state.indexBuffer);break;case wt.UNIFORM_BUFFER:this._state.uniformBuffer=Pl(this.gl,t,e,this._state.uniformBuffer);break;case wt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Pl(this.gl,t,e,this._state.pixelPackBuffer);break;case wt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Pl(this.gl,t,e,this._state.pixelUnpackBuffer);break;case wt.COPY_READ_BUFFER:this._state.copyReadBuffer=Pl(this.gl,t,e,this._state.copyReadBuffer);break;case wt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Pl(this.gl,t,e,this._state.copyWriteBuffer)}}bindRenderbuffer(t){const e=this.gl;t||(e.bindRenderbuffer(e.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==t&&(e.bindRenderbuffer(e.RENDERBUFFER,t.glName),this._state.renderbuffer=t)}_getBufferBinding(t,e){if(e>=this.parameters.maxUniformBufferBindings||e<0)return console.error("Uniform buffer binding point is out of range!"),null;const i=this._state.uniformBufferBindingPoints;let r=i[e];return r==null&&(r={buffer:null,offset:0,size:0},i[e]=r),r}bindBufferBase(t,e,i){const r=this._getBufferBinding(t,e);r!=null&&(r.buffer===i&&r.offset===0&&r.size===0||(this.gl.bindBufferBase(t,e,i?i.glName:null),r.buffer=i,r.offset=0,r.size=0))}bindBufferRange(t,e,i,r,n){const s=this._getBufferBinding(t,e);if(s!=null&&!(s.buffer===i&&s.offset===r&&s.size===n)){if(r%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(t,e,i.glName,r,n),s.buffer=i,s.offset=r,s.size=n}}bindUBO(t,e,i,r){e!=null?(gd()&&(r??e.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),e.initialize(),i!==void 0&&r!==void 0?this.bindBufferRange(wt.UNIFORM_BUFFER,t,e.buffer,i,r):this.bindBufferBase(wt.UNIFORM_BUFFER,t,e.buffer)):this.bindBufferBase(wt.UNIFORM_BUFFER,t,null)}unbindUBO(t){for(let e=0,i=this._state.uniformBufferBindingPoints.length;e<i;e++){const r=this._state.uniformBufferBindingPoints[e];r!=null&&r.buffer===t.buffer&&this.bindBufferBase(wt.UNIFORM_BUFFER,e,null)}}unbindBuffer(t){switch(t){case wt.ARRAY_BUFFER:this._state.vertexBuffer=Pl(this.gl,null,t,this._state.vertexBuffer);break;case wt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Pl(this.gl,null,t,this._state.indexBuffer);break;case wt.UNIFORM_BUFFER:this._state.uniformBuffer=Pl(this.gl,null,t,this._state.uniformBuffer);break;case wt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Pl(this.gl,null,t,this._state.pixelPackBuffer);break;case wt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Pl(this.gl,null,t,this._state.pixelUnpackBuffer);break;case wt.COPY_READ_BUFFER:this._state.copyReadBuffer=Pl(this.gl,null,t,this._state.copyReadBuffer);break;case wt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Pl(this.gl,null,t,this._state.copyWriteBuffer)}}bindVAO(t=null){t!=null?this._state.vertexArrayObject!==t&&(t.bind(),this._state.vertexArrayObject=t):this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null)}async clientWaitAsync(t=10){const e=this.gl,i=e.fenceSync(A7.SYNC_GPU_COMMANDS_COMPLETE,0);if(!i)throw new Error("Client wait failed, could not create sync object");let r;this.instanceCounter.increment(Mn.Sync,i),e.flush();do await V3(t),r=e.clientWaitSync(i,0,0);while(r===AN.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(Mn.Sync,i),e.deleteSync(i),r===AN.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(t=Eo.FRAMEBUFFER){return t===Eo.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(wt.ARRAY_BUFFER),this.unbindBuffer(wt.ELEMENT_ARRAY_BUFFER),this.type===ni.WEBGL2&&(this.unbindBuffer(wt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(wt.PIXEL_PACK_BUFFER),this.unbindBuffer(wt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(wt.COPY_READ_BUFFER),this.unbindBuffer(wt.COPY_WRITE_BUFFER));for(let t=0;t<this.parameters.maxTextureImageUnits;++t)this.bindTexture(null,t);this.setBlendingEnabled(!1),this.setBlendFunction(Te.ONE,Te.ZERO),this.setBlendEquation(Df.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(Md.BACK),this.setFrontFace(oS.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(Pi.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(Pi.ALWAYS,0,0),this.setStencilOp(Gr.KEEP,Gr.KEEP,Gr.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){const t=this.capabilities.vao;t&&t.bindVertexArray(null);const{gl:e,gl2:i}=this;for(let n=0;n<this.parameters.maxVertexAttributes;n++)e.disableVertexAttribArray(n);if(this._state.vertexBuffer?e.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):e.bindBuffer(wt.ARRAY_BUFFER,null),this._state.indexBuffer?e.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):e.bindBuffer(wt.ELEMENT_ARRAY_BUFFER,null),i!=null){this._state.uniformBuffer?i.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):i.bindBuffer(wt.UNIFORM_BUFFER,null);for(let n=0;n<this._parameters.maxUniformBufferBindings;n++){const s=this._state.uniformBufferBindingPoints[n];if(s!=null){const{buffer:o,offset:a,size:l}=s;o!==null?a===0&&l===0?i.bindBufferBase(wt.UNIFORM_BUFFER,n,o.glName):i.bindBufferRange(wt.UNIFORM_BUFFER,n,o.glName,a,l):i.bindBufferBase(wt.UNIFORM_BUFFER,n,null)}}this._state.pixelPackBuffer?i.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):i.bindBuffer(wt.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?i.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):i.bindBuffer(wt.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?i.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):i.bindBuffer(wt.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?i.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):i.bindBuffer(wt.COPY_WRITE_BUFFER,null),i.bindFramebuffer(Eo.READ_FRAMEBUFFER,null),i.readBuffer(i.BACK),this._state.readFramebuffer&&(i.bindFramebuffer(Eo.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),i.readBuffer(ll.COLOR_ATTACHMENT0)),i.bindFramebuffer(Eo.DRAW_FRAMEBUFFER,this._state.drawFramebuffer?.glName??null)}else this._state.readFramebuffer=this._state.drawFramebuffer,e.bindFramebuffer(Eo.FRAMEBUFFER,this._state.drawFramebuffer?.glName??null);if(t&&this._state.vertexArrayObject){const n=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(n)}e.useProgram(this._state.program?.glName??null),e.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),e.bindRenderbuffer(e.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?e.enable(this.gl.BLEND):e.disable(this.gl.BLEND),e.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),e.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),e.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),e.clearDepth(this._state.clearDepth),e.clearStencil(this._state.clearStencil),e.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),e.cullFace(this._state.cullFace),e.depthFunc(this._state.depthFunction),e.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),e.depthMask(this._state.depthWrite),e.frontFace(this._state.frontFace),e.lineWidth(1),this._state.faceCulling===!0?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),e.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),e.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),e.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),e.stencilMask(this._state.stencilWriteMask);for(let n=0;n<this.parameters.maxTextureImageUnits;n++){e.activeTexture(B6+n),e.bindTexture(sn.TEXTURE_2D,null),e.bindTexture(sn.TEXTURE_CUBE_MAP,null),this.type===ni.WEBGL2&&(e.bindTexture(sn.TEXTURE_3D,null),e.bindTexture(sn.TEXTURE_2D_ARRAY,null));const s=this._state.textureUnitMap[n];s!=null&&e.bindTexture(s.descriptor.target,s.glName)}e.activeTexture(B6+this._state.activeTexture);const r=this._state.viewport;e.viewport(r.x,r.y,r.width,r.height),this.resetInfo()}_loadExtensions(){this.type===ni.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}};function Pl(t,e,i,r){return e?r!==e&&t.bindBuffer(i,e.glName):t.bindBuffer(i,null),e}function oce(t,e){switch(t){case Qt.POINTS:return 2*e;case Qt.TRIANGLES:return e/3;case Qt.TRIANGLE_STRIP:case Qt.TRIANGLE_FAN:return e-2;default:return 0}}let Myt=class extends Pyt{constructor(e,i,r){super(e,i),this.gl=e,this.newCache=r,this._appleAmdDriverHelper=null,this._refCount=1,this.screen=new k0t(this)}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}dispose(){super.dispose(),this._appleAmdDriverHelper?.dispose(),this.screen.destroy()}bindTechnique(e,i,r,n){return this.useProgram(e.program),this.setPipelineState(e.getPipeline(!!n)),e.program.bindPass(i,r),e.program}runAppleAmdDriverHelper(){this.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper??(this._appleAmdDriverHelper=new eAe(this)),this._appleAmdDriverHelper.run())}get test(){return{cachedWebGLObjects:this.programCache.test.cachedWebGLProgramObjects+this.screen.test.cachedWebGLObjects+(this._appleAmdDriverHelper?.test.cachedWebGLObjects??0)}}};function ace(t){return!!t.frameUpdate}let S2=class extends xe{constructor(e,i,r){super({}),this._stage=e,this._techniqueRepository=i,this._rctx=r,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new Tn,this._frameTask=e.view.resourceController.scheduler.registerTask(ut.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(on.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return this._textureTechnique==null&&(this._textureTechnique=this._techniqueRepository.acquire(ZX,new JX)),this._textureTechnique}acquire(e){const i=this._textures.get(e);return i?(i.ref(),i.loadingPromise??i):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(i=>{const r=i.texture.frameUpdate(i.previousToken);r>=0&&r!==i.previousToken&&(i.previousToken=r,e=!0)}),e&&this.events.emit("changed",_n.BACKGROUND)}_createNewRef(e){const i=this._stage.getObject(e);if(i==null)return Ke(i!==void 0),null;const r=i.events.on("unloaded",()=>{r.remove(),this._onTextureUnloaded(e)}),n=new $yt(e,()=>{this._frameTask.schedule(()=>{n.isUnreferenced&&i.unload()})});return this._textures.set(e,n),n.ref(),i.glTexture?(this._updateGLTexture(n,i.glTexture),ace(i)&&this._frameUpdates.set(e,{texture:i,previousToken:-1}),n):(this._loadingCount++,n.loadingPromise=this._stage.schedule(()=>{const s=i.load(this._rctx),o=l=>(this._loadingCount--,n.loadingPromise=null,this._updateGLTexture(n,l),ace(i)&&this._frameUpdates.set(e,{texture:i,previousToken:-1}),n),a=l=>(this._loadingCount--,n.loadingPromise=null,Fn(l)||ne.getLogger(this).error(l),null);return dc(s)?s.then(o,a):o(s)}),n.loadingPromise)}_updateGLTexture(e,i){e.glTexture=i,this.events.emit("changed",_n.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};h([f()],S2.prototype,"_loadingCount",void 0),h([f()],S2.prototype,"_frameTask",void 0),h([f()],S2.prototype,"updating",null),S2=h([z("esri.views.3d.webgl-engine.lib.TextureRepository")],S2);let $yt=class{constructor(e,i){this.id=e,this._release=i,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(ne.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}};function Iyt(t,e){return new E2e(i=>Qtt(i,t),i=>i,e)}let DA=class extends xe{constructor(){super(...arguments),this._passParameters=new Lyt,this._resourcesTask=null}get passParameters(){return this._passParameters}destroy(){this._resourcesTask=nc(this._resourcesTask),this._passParameters.waveNormal=et(this._passParameters.waveNormal),this._passParameters.wavePerturbation=et(this._passParameters.wavePerturbation)}get updating(){return!!this._resourcesTask&&!this._resourcesTask.finished}ensureResources(e){return this._resourcesTask||(this._resourcesTask=S_(async i=>{await Promise.allSettled([this._loadImageResource(e,lr("esri/images/materials/water/normals.jpg"),r=>this._passParameters.waveNormal=r,i),this._loadImageResource(e,lr("esri/images/materials/water/perturbation.jpg"),r=>this._passParameters.wavePerturbation=r,i)])})),this._resourcesTask.finished?l_.LOADED:l_.LOADING}async _loadImageResource(e,i,r,n){try{const s=await $g(i,{signal:n});Et(n);const o=new Li(s.width,s.height);o.pixelFormat=pt.RGB,o.samplingMode=Lt.LINEAR_MIPMAP_LINEAR,o.hasMipmap=!0,o.maxAnisotropy=8,r(new Pt(e,o,s))}catch(s){ne.getLogger(this).error("Failed to load water material normal texture.",s)}}};h([f()],DA.prototype,"_resourcesTask",void 0),h([f({type:Boolean,readOnly:!0})],DA.prototype,"updating",null),DA=h([z("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],DA);let Lyt=class extends Ki{};const lce=2048,Dyt=1.5,Nyt=8;function Fyt(t,e){const{format:i,quality:r,rotation:n,disableDecorations:s}=t||{},o=WZ(t,e.padding),a=jyt(t,{width:e.width-o.left-o.right,height:e.height-o.top-o.bottom}),{width:l,height:c}=Gyt(t,a),u=Wyt(i),d=Kyt[u];return{format:u,quality:_e(r??d,0,100),area:a,width:l,height:c,rotation:n,disableDecorations:!!s,ignoreBackground:!!t?.ignoreBackground,ignorePadding:!!t?.ignorePadding}}function kyt(t,e){const i=Fyt(t,e),r=i.area,n=i.width/r.width,s=WZ(i,e.padding),o=s.left+s.right,a=s.top+s.bottom,l=e.width-o,c=e.height-a,u=Math.floor(l*n+o),d=Math.floor(c*n+a),p=t?.layers??[],m=i.ignoreBackground,y=i.ignorePadding;return{framebufferWidth:u,framebufferHeight:d,region:{x:Math.floor(r.x*n)+s.left,y:Math.floor(r.y*n)+s.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:n,layers:p,disableDecorations:i.disableDecorations,ignoreBackground:m,ignorePadding:y,objectAndLayerIdColor:!1}}function Sz(t,e,i){const{ctx:r,canvas:n}=sAe(t,i),s=r.getImageData(0,0,t.width,t.height),o=zyt(n,e);return oAe(n),{dataUrl:o,data:s}}function Ez(t,e){const{ctx:i,canvas:r}=sAe(t,e),n=i.getImageData(0,0,t.width,t.height);return oAe(r),n}function sAe(t,e){const i=Uyt();e.premultipliedAlpha&&Xyt(t),i.width=t.width,i.height=t.height;const r=i.getContext("2d",{willReadFrequently:!0});return r.putImageData(t,0,0),e.flipY&&Yyt(r),{ctx:r,canvas:i}}function oAe(t){t.width=0,t.height=0}function Uyt(){return Cz==null&&(Cz=document.createElement("canvas")),Cz}let Cz=null;function zyt(t,e){const i=Zyt[e.format],r=e.quality/100;return t.toDataURL(i,r)}function Byt(t,e,i,r=0,n=0,s=t.width-r,o=t.height-n,a=!1){const{data:l}=t,{width:c,height:u,data:d}=e,p=s/c,m=o/u,y=Math.ceil(p/2),_=Math.ceil(m/2),v=t.width;for(let w=0;w<u;w++)for(let x=0;x<c;x++){const T=4*(x+(a?u-w-1:w)*c);let S=0,E=0,A=0,P=0,N=0,F=0;const D=(w+.5)*m;for(let $=Math.floor(w*m);$<(w+1)*m;$++){const R=Math.abs(D-($+.5))/_,k=(x+.5)*p,B=R*R;for(let j=Math.floor(x*p);j<(x+1)*p;j++){const X=Math.abs(k-(j+.5))/y,M=Math.sqrt(B+X*X);if(M>=1)continue;let I=2*M*M*M-3*M*M+1;const G=4*(r+j+(n+$)*v);F+=I*l[G+3],E+=I,!i&&l[G+3]<255&&(I=I*l[G+3]/255),A+=I*l[G],P+=I*l[G+1],N+=I*l[G+2],S+=I}}d[T]=A/S,d[T+1]=P/S,d[T+2]=N/S,d[T+3]=F/E}return e}function Vyt(t,e,i){if(!e)return t;const{framebufferWidth:r,framebufferHeight:n,pixelRatio:s,region:o}=t,a=WZ(t,i),l=a.left+a.right,c=a.top+a.bottom,u=r-l,d=n-c,p=Math.min(Nyt,Math.min((lce-l)/u,(lce-c)/d));return p<Dyt?t:{...t,framebufferWidth:Math.round(u*p)+l,framebufferHeight:Math.round(d*p)+c,pixelRatio:s*p,resample:{region:{x:Math.round((o.x-a.left)*p)+a.left,y:Math.round((o.y-a.top)*p)+a.top,width:Math.round(o.width*p),height:Math.round(o.height*p)},width:r,height:n}}}function Gyt(t,e){if(!t)return e;const i=t.width,r=t.height;if(i!=null&&r!=null)return{width:Math.floor(i),height:Math.floor(r)};if(i==null&&r==null)return e;const n=e.width/e.height;return r==null?{width:Math.floor(i),height:Math.floor(i/n)}:{width:Math.floor(r*n),height:Math.floor(r)}}function jyt(t,e){const i={x:0,y:0,width:e.width,height:e.height};if(t?.area){t.area.x!=null&&(i.x=Math.floor(t.area.x)),t.area.y!=null&&(i.y=Math.floor(t.area.y));const r=t.area.width!=null?Math.floor(t.area.width):null,n=t.area.height!=null?Math.floor(t.area.height):null;if(i.width=e.width-i.x,i.height=e.height-i.y,r!=null&&n!=null)i.width=Math.min(i.width,r),i.height=Math.min(i.height,n);else if(r==null&&n!=null){const s=Math.min(i.width,r);i.height=s/i.width*i.height,i.width=s}else if(r!=null&&n==null){const s=Math.min(i.height,n);i.width=s/i.height*i.width,i.height=s}}return Hyt(qyt(i,t),e)}function Hyt(t,e){const i=Math.floor(Math.max(t.x,0)),r=Math.floor(Math.max(t.y,0)),n={x:i,y:r,width:Math.floor(Math.min(t.width,e.width-i)),height:Math.floor(Math.min(t.height,e.height-r))},s=n.width/n.height,o=t.width/t.height;if(o===s)return n;if(o>s){const c=Math.floor(n.width/o),u=n.height-c;return{x:n.x,y:Math.floor(n.y+u/2),width:n.width,height:c}}const a=Math.floor(n.height*o),l=n.width-a;return{x:Math.floor(n.x+l/2),y:n.y,width:a,height:n.height}}function qyt(t,e){if(e?.width==null||e.height==null)return t;const i=e.width/e.height,r=t.width/t.height;if(r===i)return t;if(r<i){const s=Math.floor(t.height*i);return t.x-=(s-t.width)/2,t.width=s,t}const n=Math.floor(t.width/i);return t.y-=(n-t.height)/2,t.height=n,t}function WZ(t,e){return!e||t&&t.ignorePadding?Qyt:e}function Wyt(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return Jyt}}function Yyt(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function Xyt(t){const e=t.data,i=e.length;for(let r=0;r<i;r+=4){const n=e[r+3];if(n!==255&&n>0){const s=255/n;e[r]=e[r]*s,e[r+1]=e[r+1]*s,e[r+2]=e[r+2]*s}}}const Zyt={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},cce=98,Jyt="png",Kyt={png:100,jpg:cce,jpeg:cce},Qyt={top:0,right:0,bottom:0,left:0};let e_t=class{constructor(e,i,r){this.parameters=e,this.frameHasDecorations=i,this.fbos=r}},t_t=class{constructor(e,i,r){this._rctx=e,this._renderFunctions=i,this._forceCameraHook=r,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(_n.BACKGROUND);const i=vs();return this._screenshotQueue.push({settings:e,resolver:i}),i.promise}update(e,i){for(const r of this._screenshotQueue){if(this._rctx==null){r.resolver.reject();continue}const n={...r.settings,pixelRatio:r.settings.pixelRatio*e.parameters.camera.pixelRatio},s=this._renderScreenshot(e,n,i);r.resolver(s)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,i,r){e.width=i.width,e.height=i.height;const n=e.getContext("2d"),s=r.pixelRatio;return n.save(),n.translate(0,i.height),n.scale(1,-1),r.region&&n.translate(-r.region.x,-r.region.y),n.scale(s,s),i=this._renderFunctions.renderOverlay(e,r.disableDecorations?Ql.OFF:Ql.ON,i),n.restore(),i}_readbackScreenshot(e,i){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},i):this._readbackScreenshotImmediate(e,i)}_readbackScreenshotResampled(e,i){const{framebufferWidth:r,framebufferHeight:n,region:s,resample:o}=e,a=this._ensureScreenshotEncodeCanvas();let l=y8(r,n,a);this._rctx.gl.readPixels(0,0,r,n,pt.RGBA,Ze.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),i(),l=this._renderScreenshotOverlay(a,l,{...e,region:void 0});const c=y8(s.width,s.height,a);return Byt(l,c,!0,o.region.x,n-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(e,i){const{framebufferHeight:r,region:n}=e,s=this._ensureScreenshotEncodeCanvas(),o=y8(n.width,n.height,s);return this._rctx.gl.readPixels(n.x,r-(n.y+n.height),n.width,n.height,pt.RGBA,Ze.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),i(),this._renderScreenshotOverlay(s,o,e)}_renderScreenshot(e,i,r){const n=e.parameters.camera,s={width:i.framebufferWidth,height:i.framebufferHeight};G1(s,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));let o=!1;const a=i.disableDecorations&&e.frameHasDecorations,l=s.width!==n.fullWidth||s.height!==n.fullHeight,c=i.ignorePadding&&n.pixelRatio!==i.pixelRatio,u=l||a||c||i.objectAndLayerIdColor;let d=null;i.objectAndLayerIdColor&&(d=e.fbos.acquire(hi.RGBA,s.width,s.height),d.acquireDepth(rs.DEPTH_STENCIL_BUFFER));let p=null;if(u){const v=n.clone();if(i.ignorePadding){const E=wR(v.padding);for(let A=0;A<4;A++)E[A]=Math.round(E[A]/v.pixelRatio*i.pixelRatio);v.padding=E}v.fullWidth=s.width,v.fullHeight=s.height,v.pixelRatio=i.pixelRatio;const w=n.fovX-v.fovX,x=n.fovY-v.fovY;w<0&&w<x?v.fovX=n.fovX:x<0&&x<w&&(v.fovY=n.fovY);const T={camera:v,contentCamera:v,mode:Si.IDLE,alignPixelEnabled:!0,contentPixelRatio:v.pixelRatio};this._forceCameraHook(T),o=!0,p=e.fbos.acquire(hi.RGBA,s.width,s.height);const S=i.disableDecorations?Ql.OFF:Ql.ON;this._renderFunctions.renderScene(p,d,T,S,r)}const m=()=>{this._rctx.bindFramebuffer(null),p?.release()};this._rctx.bindFramebuffer(p?.fbo);const y=this._readbackScreenshot(i,m);let _=null;if(i.objectAndLayerIdColor){const v=()=>{this._rctx.bindFramebuffer(null),d?.release()};this._rctx.bindFramebuffer(d?.fbo),_=this._readbackScreenshot(i,v),this._rctx.bindFramebuffer(null)}if(u&&!this._rctx.contextAttributes.alpha)for(let v=3;v<y.data.length;v+=4)y.data[v]=255;if(_&&!this._rctx.contextAttributes.alpha)for(let v=3;v<_.data.length;v+=4)_.data[v]=255;return o&&this._forceCameraHook(e.parameters),[y,_]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}},no=class extends xe{constructor(e){super({}),this.events=new Tn,this.waterTextureRepository=new DA,this._magnifierHelper=new w2,this.objectAndLayerIdRenderHelper=ie("enable-feature:objectAndLayerId-rendering")?new pgt:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode,this._initializeContext(e),this.addHandles([le(()=>this.waterTextureRepository?.updating,()=>this.requestRender(),Zi),le(()=>e.view.qualityProfile,n=>this.renderer?.updateRenderFeatures(n),Yi),this._magnifierHelper.events.on("request-render",()=>this.requestRender())]);const{memoryController:i}=e.view.resourceController;this.stippleTextureRepository=ltt(this._rctx,i),this.markerTextureRepository=Iyt(this._rctx,i),this._shaderTechniqueRepository=new v2e({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this.stippleTextureRepository,waterTextureRepository:this.waterTextureRepository,markerTextureRepository:this.markerTextureRepository}),this._textureRepository=new S2(e,this._shaderTechniqueRepository,this._rctx),this.addHandles(this._textureRepository.events.on("changed",n=>this.requestRender(n))),this._materialRepository=new b2e(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new Hmt(this._rctx,this._shaderTechniqueRepository),this.renderer=new Pc(e,this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,n=>this.requestRender(n));const r={renderScene:(n,s,o,a,l)=>this.renderer.render(n,s,o,a,l),requestRenderScene:n=>this.requestRender(n),prepareOverlay:()=>e.options.screenshot.prepareOverlay(),renderOverlay:(n,s,o)=>e.options.screenshot.renderOverlay(n,s,o)};this._screenshotManager=new t_t(this._rctx,r,n=>this.events.emit("force-camera-for-screenshot",n)),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=pr(this._frameTask),this._shaderTechniqueRepository=Pe(this._shaderTechniqueRepository)}requestRender(e=_n.UPDATE){this._needsRender=!0,e===_n.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(i=>i[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,i,r,n,s,o=s){const a=n.constrainWindowSize(i,r,s*n.pixelRatio,o*n.pixelRatio),l=this._ensureDepthBuffer(a);this.renderer.readDepthPixels(n,a,l);let c=Number.MAX_VALUE;for(let u=0;u<a[2]*a[3];u++){const d=Zmt(4*u,l,n.nearFar);c>d&&d!==n.nearFar[0]&&d!==n.nearFar[1]&&(c=d)}if(e){const u=e.pickDepth(i*n.pixelRatio,r*n.pixelRatio,n);u!=null&&c>u&&u!==n.nearFar[0]&&u!==n.nearFar[1]&&(c=u)}return c===Number.MAX_VALUE?void 0:c}_ensureDepthBuffer(e){const i=4*e[2]*e[3];return(this._tmpDepthBuffer==null||this._tmpDepthBuffer.byteLength<i)&&(this._tmpDepthBuffer=new Uint8Array(i)),this._tmpDepthBuffer}async reloadShaders(){hEe(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}_registerFrameTask(e){const i=e.view.state;let r=!1,n=_n.BACKGROUND,s=!1;const o={preRender:({time:a})=>{r=this.updating,n=this._needsUpdate?_n.UPDATE:_n.BACKGROUND,e.commitSyncLayers();const l=a-this._lastAnimationUpdate;if(l>this.renderer.animationTimestep||i.forcedAnimationTime!=null||r||this._needsRender){const c=l/this.renderer.animationTimeDilation,u=new owe(i.camera,c,i.forcedAnimationTime);this.renderer.updateAnimation(u)&&this.requestRender(_n.BACKGROUND),this._lastAnimationUpdate=a}},render:({time:a})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&i.camera.fullWidth>0&&i.camera.fullHeight>0){const l=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(null,null,i,Ql.ON,a),s=!0,l&&this.renderer.hasReflections&&(this.requestRender(_n.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:a})=>{const l=this.renderer.hasSlicePlane||this._magnifierHelper.enabled||this.renderer.hasDecorations||this.renderer.hasHighlights,c=new e_t(i,l,this.renderer.fboCache);this._textureRepository.update(),this._screenshotManager.update(c,a)},finish:()=>{s&&(this.renderer.finish(i.mode===Si.IDLE?n:_n.UPDATE),s=!1)}};this._frameTask=fb(o)}_initializeContext(e){const i=e.options;this._canvas=i.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const r={alpha:i.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:i.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:i.preserveDrawingBuffer??!1},n=pGe("3d",this._canvas,r);n!=null&&op(n)?(this._rctx=this._newRenderingContext(n,e),this._loadShaderOnlyExtensions(),!i.alpha&&this._rctx.contextAttributes.alpha&&ne.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&ie("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)):ne.getLogger(this).error("A WebGL2 context could not be created.")}_newRenderingContext(e,i){const r={disabledExtensions:i.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:i.options.debugWebGLExtensions||{},maxAnisotropy:8},n=(s,o)=>i.view.resourceController.memoryController.newCache(s,o);return new Myt(e,r,n)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloat")}getObjectAndLayerIdColor(e){return this.objectAndLayerIdRenderHelper!=null?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(e):null}get componentObjectCollection(){return this._componentObjectCollection==null&&(this._componentObjectCollection=new Fmt(this.renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};h([f({type:Boolean,readOnly:!0})],no.prototype,"updating",null),h([f({autoDestroy:!0})],no.prototype,"_rctx",void 0),h([f({autoDestroy:!0})],no.prototype,"_container",void 0),h([f({autoDestroy:!0})],no.prototype,"_canvas",void 0),h([f({autoDestroy:!0})],no.prototype,"stippleTextureRepository",void 0),h([f({autoDestroy:!0})],no.prototype,"markerTextureRepository",void 0),h([f({autoDestroy:!0})],no.prototype,"waterTextureRepository",void 0),h([f({autoDestroy:!0})],no.prototype,"_magnifierHelper",void 0),h([f({readOnly:!0})],no.prototype,"objectAndLayerIdRenderHelper",void 0),h([f({autoDestroy:!0})],no.prototype,"_textureRepository",void 0),h([f({autoDestroy:!0,readOnly:!0})],no.prototype,"renderer",void 0),h([f({autoDestroy:!0})],no.prototype,"_screenshotManager",void 0),h([f()],no.prototype,"componentObjectCollection",null),h([f({autoDestroy:!0})],no.prototype,"_componentObjectCollection",void 0),h([f()],no.prototype,"_needsUpdate",void 0),h([f()],no.prototype,"_needsWaterReflectionUpdate",void 0),no=h([z("esri.views.3d.webgl-engine.parts.RenderView")],no);let Mc=class extends xe{constructor(e){super(e),this._model=new eD,this._layers=new It,this._asyncChangeSet=new cj,this._syncChangeSet=new cj,this._layerSyncSet=new Set}initialize(){this._set("renderView",new no(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(ut.STAGE,this),this.addHandles(this._frameTask)}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){return this.renderView?.renderer}add(e){this._model.add(e),s5(e)&&this._addLayer(e),this.renderView.requestRender()}remove(e){e!=null&&!this.destroyed&&this._model.remove(e)&&(s5(e)&&this._removeLayer(e),this.renderView.requestRender())}addMany(e){e!=null&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){e!=null&&(this._model?.removeMany(e),this.renderView?.requestRender())}forEachOfType(e,i){this._model.forEachOfType(e,i)}handleEvent(e,i){this.destroyed||(this._model.dirtySet[e](i),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){this._frameTask.processQueue(e),this._commit(e)}_commit(e){const i=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{if(e.done)return;const n=this._layerSyncSet.has(r.id)||r.updatePolicy===Xy.SYNC,s=n?this._syncChangeSet:this._asyncChangeSet;i.commitLayer(r.id,s),this._layerSyncSet.delete(r.id),s.empty||(this.renderer.modify(s,n?Da:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Da),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{e.done||this._layerSyncSet.has(r.id)||r.updatePolicy!==Xy.ASYNC||(i.commitLayer(r.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(i=>{this._layerSyncSet.has(i.id)||i.updatePolicy===Xy.SYNC?(e.commitLayer(i.id,this._syncChangeSet),this._layerSyncSet.delete(i.id)):e.commitSyncUpdates(i.id,this._syncChangeSet)});for(const i of this._layerSyncSet)e.commitLayer(i,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Da),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Da),this.renderView.requestRender())}schedule(e,i){return this._frameTask.schedule(e,i)}reschedule(e,i){return this._frameTask.reschedule(e,i)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,Da))}addRenderPlugin(e,i){const r=this.renderer.renderPlugins.add(e,i),n=()=>{eoe(e)&&this.view.sceneIntersectionHelper.addIntersectionHandler(e)};if(dc(r))return r.then(n);n()}removeRenderPlugin(e){this.destroyed||(eoe(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.renderPlugins.remove(e))}get performanceInfo(){return this._model.getStats()}get test(){const e=this;return{getCount:i=>e._model.test.content.filter(r=>r.type===i).length,model:e._model}}};Mc.DebugSettings={endFrameContentValidation:!1},h([f({constructOnly:!0})],Mc.prototype,"view",void 0),h([f({constructOnly:!0})],Mc.prototype,"options",void 0),h([f({readOnly:!0})],Mc.prototype,"viewingMode",null),h([f({constructOnly:!0})],Mc.prototype,"container",void 0),h([f({readOnly:!0})],Mc.prototype,"updating",null),h([f({constructOnly:!0})],Mc.prototype,"_model",void 0),h([f({autoDestroy:!0})],Mc.prototype,"renderView",void 0),h([f({readOnly:!0})],Mc.prototype,"renderer",null),h([f({readOnly:!0})],Mc.prototype,"running",null),Mc=h([z("esri.views.3d.webgl-engine.Stage")],Mc);let i8t=class extends yF{constructor(e,i,r,n){super(i,r),this.point=e,this.createGraphic=n}};function aAe(t){return ip(t)&&t.intersector===Ur.PCL&&!!t.target}let n8t=class extends Oye{constructor(e,i,r,n,s){super(e),this.layerUid=e,this.sublayerUid=i,this.nodeIndex=r,this.componentIndex=n,this.triangleNr=s}},o8t=class extends yF{constructor(e,i,r){super(i,null),this.point=e,this.createVoxelGraphic=r}};function Ek(t){return ip(t)&&t.intersector===Ur.I3S&&!!t.target}function lAe(t){return ip(t)&&t.intersector===Ur.VOXEL&&!!t.target}function uce(t,e){return _F(t)||vF(t)?UO(t.target?.object,e):_it(t)?e.map?.ground:aAe(t)||Ek(t)||W2e(t)||lAe(t)?UO(t.target,e):null}function l8t(t,e){const i=Qj(t,e);return i!=null&&i.type==="graphic"?i.graphic:null}function Qj(t,e){if(t==null)return null;if(_F(t)||vF(t))return hce(t.target?.object,e);if(aAe(t)){const i=t.target.createGraphic();return{type:"graphic",graphic:i,layer:i.layer}}if(lAe(t)){const i=t.target.createVoxelGraphic();return{type:"graphic",graphic:i,layer:i.layer}}return W2e(t)||pZ(t)?hce(t.target,e):Ek(t)?i_t(t.target,e):null}function hce(t,e){if(t?.graphicUid==null)return null;const i=UO(t,e);if(i==null)return null;if(i===e.graphics)return e.graphicsView==null||typeof t.graphicUid!="number"?null:e.graphicsView.getHit(t.graphicUid);const r=e.allLayerViews.find(n=>n.layer===i);return!r||r.suspended||t.graphicUid==null?null:"getHit"in r?r.getHit(t.graphicUid):null}function i_t(t,e){const i=UO(t,e);if(i==null)return null;const r=e.allLayerViews.find(n=>n.layer===i);return r&&!r.suspended&&"getGraphicFromIntersectorTarget"in r?n_t(r.getGraphicFromIntersectorTarget(t)):null}function r_t(t,e){const i=UO(t,e);if(i==null)return null;const r=e.allLayerViews.find(n=>n.layer===i);return r&&!r.suspended&&"getAABBFromIntersectorTarget"in r?r.getAABBFromIntersectorTarget(t):null}function n_t(t){return t!=null?{type:"graphic",graphic:t,layer:t.layer}:null}function UO(t,e){return t?.layerUid==null?null:e.graphicsView!=null&&t.layerUid===e.graphicsView.processor.layer.id?e.graphics:e.map.findLayerByUid(t.layerUid)}function c8t(t,e){if(_F(t)||vF(t))return ag(t.target.object.boundingVolumeWorldSpace.bounds);if(pZ(t)){hpe(J$,t.transformation);const i=Math.max(J$[0],J$[1],J$[2]);return t.target.baseBoundingSphere.radius*i}if(Ek(t)){const i=r_t(t.target,e);return i?.5*$ge(i):null}return null}function u8t(t){return!_F(t)&&!vF(t)&&(pZ(t)?t.target.numLodLevels>1:!!Ek(t))}const J$=C();async function s_t(t,e){if(t.type==="2d")return t.hitTest(e);const i=await t.hitTest(e);if(i.results.length===0)return i;const r=(i.results[0].distance??0)*(1+o_t),n=i.results.findIndex(s=>(s.distance??0)>r);return n!==-1&&(i.results=i.results.slice(0,n)),i}const o_t=.05;function h8t(t){return t&&typeof t.highlight=="function"}function a_t(t){return t&&typeof t.maskOccludee=="function"}function d8t(t,e,i){return t==null||t>i&&(e===0||t<e)}function p8t(t,e){return t!=null&&t>0||e!=null&&e>0}function f8t(t){const e=t.effectiveScaleRange;return{minScale:e?.minScale??0,maxScale:e?.maxScale??0}}let Az,Oz;function l_t(t){const e=mve(t);for(;e.length>1;){const i=dce(e.shift());if(i.available)return i}return dce(e.shift())}function dce(t){switch(t){case ni.WEBGL1:return c_t();case ni.WEBGL2:return u_t()}}function c_t(){return Az||(Az=p_t()),Az}function u_t(){return Oz||(Oz=f_t()),Oz}let cAe=class{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}},h_t=class extends cAe{constructor(){super(...arguments),this.type=ni.WEBGL1}},d_t=class extends cAe{constructor(){super(...arguments),this.type=ni.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}};function uAe(t,e){if(t===ni.WEBGL1&&typeof WebGLRenderingContext>"u"||t===ni.WEBGL2&&typeof WebGL2RenderingContext>"u")return null;const i=document.createElement("canvas");if(!i)return null;let r=R7(i,t,{failIfMajorPerformanceCaveat:!0});if(r==null&&(r=R7(i,t),r!=null&&(e.majorPerformanceCaveat=!0)),r==null)return r;if(t===ni.WEBGL1){const s=r.getParameter(r.VERSION),o=s?.match(/^WebGL\s+([\d.]*)/);if(o){const a=parseFloat(o[1]);e.available=a>=.94}}else e.available=!0;e.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),e.supportsVertexShaderSamplers=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const n=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT);return n&&(e.supportsHighPrecisionFragment=n.precision>0),r}function p_t(){const t=new h_t,e=uAe(ni.WEBGL1,t);return e==null||(t.supportsElementIndexUint=e.getExtension("OES_element_index_uint")!==null,t.supportsStandardDerivatives=e.getExtension("OES_standard_derivatives")!==null,t.supportsInstancedArrays=e.getExtension("ANGLE_instanced_arrays")!==null,t.supportsTextureFloat=e.getExtension("OES_texture_float")!==null,t.supportsTextureHalfFloat=e.getExtension("OES_texture_half_float")!==null,t.supportsColorBufferFloat=e.getExtension("WEBGL_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=e.getExtension("EXT_color_buffer_half_float")!==null),t}function f_t(){const t=new d_t,e=uAe(ni.WEBGL2,t);return e==null||(t.supportsColorBufferFloat=e.getExtension("EXT_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=t.supportsColorBufferFloat||e.getExtension("EXT_color_buffer_half_float")!==null),t}function m_t(t){const e=l_t(t);if(!e.available)return new W("webgl:required",t==="3d"?"WebGL2 is required but not supported.":"WebGL is required but not supported.",new Error().stack);if(t==="3d"&&e.majorPerformanceCaveat)return new W("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!e.supportsHighPrecisionFragment)return new W("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!e.supportsVertexShaderSamplers)return new W("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(e.type===ni.WEBGL1){if(!e.supportsElementIndexUint)return new W("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!e.supportsStandardDerivatives)return new W("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!e.supportsInstancedArrays)return new W("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function g_t(t){return t&&"nodeType"in t}function y_t(t){return t&&typeof t.render=="function"}const pce={component:"esri-component"};let y1=class extends xe{constructor(){super(...arguments),this.widget=null}destroy(){this.node=null,this.widget?.destroy()}get id(){return this._get("id")??this.widget?.id??this.node?.id}set id(e){this._set("id",e)}set node(e){const i=this._get("node");e!==i&&(e&&e.classList.add(pce.component),i&&i.classList.remove(pce.component),this._set("node",e))}castNode(e){return this.widget?.destroy(),e?typeof e=="string"||g_t(e)?(this._set("widget",null),sF(e)):(y_t(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};h([f()],y1.prototype,"id",null),h([f()],y1.prototype,"node",null),h([rr("node")],y1.prototype,"castNode",null),h([f({readOnly:!0})],y1.prototype,"widget",void 0),y1=h([z("esri.views.ui.Component")],y1);const sD=y1,hAe="calcite-mode-";function __t(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replaceAll(/\s|'|"/g,"")}function v_t(){return __t().startsWith("dark")}function b_t(){return`${hAe}${v_t()?"dark":"light"}`}function w_t(t){x_t(t),t.classList.add(b_t())}function x_t(t){Array.from(t.classList).forEach(e=>{e.startsWith(hAe)&&t.classList.remove(e)})}const T_t={left:0,top:0,bottom:0,right:0},dAe={bottom:30,top:15,right:15,left:15},ym="esri-ui",Ml={ui:ym,corner:`${ym}-corner`,innerContainer:`${ym}-inner-container`,manualContainer:`${ym}-manual-container`,cornerContainer:`${ym}-corner-container`,topLeft:`${ym}-top-left`,topRight:`${ym}-top-right`,bottomLeft:`${ym}-bottom-left`,bottomRight:`${ym}-bottom-right`};function S_t(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function K$(t){return t===0?"0":`${t}px`}function Rz(t){const e=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(e===null||e===Object.prototype)&&("component"in t||"index"in t||"position"in t)?t:null}function Pz(t,{top:e,bottom:i,left:r,right:n}){t.style.top=e,t.style.bottom=i,t.style.left=r,t.style.right=n}let Jp=class extends Tn.EventedAccessor{constructor(t){super(t),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._locale=eu(),this.view=null,this._applyViewPadding=()=>{const e=this.container;e&&Pz(e,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const e=this._innerContainer;e&&Pz(e,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([le(()=>[this.view?.padding,this.container],this._applyViewPadding,Zi),le(()=>this.padding,this._applyUIPadding,Zi),le(()=>[this.container,this._locale],([t,e])=>{t&&t.setAttribute("lang",e)},Zi),iq(t=>{this._locale=t})])}destroy(){this.container=null;for(const t of this._components)t.destroy();this._components.length=0,this._componentMap.clear()}set container(t){const e=this._get("container");t!==e&&(t&&(t.classList.add(Ml.ui),w_t(t),this._attachContainers(t)),e&&(e.classList.remove(Ml.ui),Pz(e,{top:"",bottom:"",left:"",right:""}),o0e(e)),this._set("container",t))}get height(){const t=this.view?.height??0;if(t===0)return t;const e=this._getViewPadding(),{top:i,bottom:r}=e;return Math.max(t-i-r,0)}get padding(){return this._get("padding")}set padding(t){this._overrideIfSome("padding",t)}castPadding(t){return typeof t=="number"?{bottom:t,top:t,right:t,left:t}:{...dAe,...t}}get width(){const t=this.view?.width??0;if(t===0)return t;const e=this._getViewPadding(),{left:i,right:r}=e;return Math.max(t-i-r,0)}add(t,e){let i,r,n;if(Array.isArray(t))return void t.forEach(o=>this.add(o,e));const s=Rz(t);s&&({index:i,position:e,component:t,key:r}=s),e&&typeof e=="object"&&({index:i,key:r,position:e,internal:n}=e),!t||e&&!this._isValidPosition(e)||this._add(t,e,i,r,n)}remove(t,e){if(!t)return;if(Array.isArray(t))return t.map(r=>this.remove(r,e));const i=this._find(t);if(i){if(this._componentMap.has(i)&&this._componentMap.get(i)?.key!==e)return;const r=this._components.indexOf(i);return i.node.parentNode?.removeChild(i.node),this._componentMap.delete(i),this._components.splice(r,1)[0]}}empty(t,e={removeInternal:!1}){if(Array.isArray(t)){for(const n of t)this.empty(n,e);return}const i=this._positionNameToContainerLookup[t??"manual"],r=Array.prototype.slice.call(i.children).map(n=>this._findByNode(n)).filter(n=>n==null?!1:!(this._componentMap.get(n)?.internal??!1)||e.removeInternal);for(const n of r)this.remove(n)}move(t,e){if(Array.isArray(t)&&t.forEach(s=>this.move(s,e)),!t)return;let i;const r=Rz(t)||Rz(e);if(r&&(i=r.index,e=r.position,t=r.component||t),e&&!this._isValidPosition(e))return;const n=this.remove(t);n&&this.add(n,{position:e,index:i})}find(t){if(!t)return null;const e=this._findById(t);return e&&(e.widget||e.node)}getComponents(t,e={includeInternal:!1}){return t?Array.isArray(t)?t.flatMap(i=>this._getComponentsAtPosition(i,e)):this._getComponentsAtPosition(t,e):this._components.filter(i=>e.includeInternal||!this._componentMap.get(i)?.internal).map(({widget:i,node:r})=>i??r)}getPosition(t){for(const e in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[e].contains(t))return e;return null}_add(t,e,i,r,n){t instanceof sD||(t=new sD({node:t})),this._place({component:t,position:e,index:i}),this._components.push(t),this._componentMap.set(t,{key:r,internal:n})}_find(t){return t?t instanceof sD?this._findByComponent(t):typeof t=="string"?this._findById(t):this._findByNode(t.domNode||t):null}_getViewPadding(){return this.view?.padding??T_t}_attachContainers(t){t.appendChild(this._innerContainer),t.appendChild(this._manualContainer)}_initContainers(){const t=document.createElement("div");t.classList.add(Ml.innerContainer,Ml.cornerContainer);const e=document.createElement("div");e.classList.add(Ml.innerContainer,Ml.manualContainer);const i=document.createElement("div");i.classList.add(Ml.topLeft,Ml.corner),t.appendChild(i);const r=document.createElement("div");r.classList.add(Ml.topRight,Ml.corner),t.appendChild(r);const n=document.createElement("div");n.classList.add(Ml.bottomLeft,Ml.corner),t.appendChild(n);const s=document.createElement("div");s.classList.add(Ml.bottomRight,Ml.corner),t.appendChild(s),this._innerContainer=t,this._manualContainer=e;const o=Pze();this._cornerNameToContainerLookup={"top-left":i,"top-right":r,"bottom-left":n,"bottom-right":s,"top-leading":o?r:i,"top-trailing":o?i:r,"bottom-leading":o?s:n,"bottom-trailing":o?n:s},this._positionNameToContainerLookup={manual:e,...this._cornerNameToContainerLookup}}_isValidPosition(t){return!!this._positionNameToContainerLookup[t]}_place(t){const e=t.position??"manual",{component:i,index:r}=t,n=this._positionNameToContainerLookup[e],s=r!=null&&r>-1;if(S_t(i.widget)&&i.widget.startup(),!s)return void n.appendChild(i.node);const o=Array.from(n.children);if(r===0)return void(n.firstChild?kQ(i.node,n.firstChild):n.appendChild(i.node));r>=o.length?n.appendChild(i.node):kQ(i.node,o[r])}_toPixelPosition(t){return{top:K$(t.top),left:K$(t.left),right:K$(t.right),bottom:K$(t.bottom)}}_findByComponent(t){return this._components.find(e=>e===t)??null}_findById(t){return this._components.find(({id:e})=>e===t)??null}_findByNode(t){return this._components.find(({node:e})=>e===t)??null}_getComponentsAtPosition(t,e){const i=this._positionNameToContainerLookup[t];return Array.prototype.slice.call(i.children).map(r=>this._findByNode(r)).filter(ZO).filter(r=>e.includeInternal||!this._componentMap.get(r)?.internal).map(({widget:r,node:n})=>r??n)}};h([f()],Jp.prototype,"_locale",void 0),h([f()],Jp.prototype,"container",null),h([f()],Jp.prototype,"height",null),h([f({value:dAe})],Jp.prototype,"padding",null),h([rr("padding")],Jp.prototype,"castPadding",null),h([f()],Jp.prototype,"view",void 0),h([f()],Jp.prototype,"width",null),Jp=h([z("esri.views.ui.UI")],Jp);const E_t=Jp,C_t={handleInterceptedEvent:(t,e,i,r)=>(t.scheduleRender(),e.properties[`on${r.type}`].apply(e.properties.bind||i,[r]))},A_t={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{e.charAt(0)==="-"?t.style.setProperty(e,i):t.style[e]=i}},O_t=t=>({...A_t,...t}),R_t=(t,e)=>{const i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i},P_t=(t,e)=>t.find(e),fce=(t,e,i=!1)=>{let r=t;return e.forEach((n,s)=>{const o=r?.children?P_t(r.children,a=>a.domNode===n):void 0;i&&!o&&s!==e.length-1||(r=o)}),r},M_t=t=>{let e;const i={...C_t,...t},r=O_t(i),n=r.performanceLogger;let s,o=!0,a=!1;const l=[],c=[],u=(p,m,y)=>{let _;r.eventHandlerInterceptor=(w,x,T,S)=>function(E){let A;n("domEvent",E);const P=R_t(E.currentTarget,_.domNode),N=P.some(D=>customElements.get(D?.tagName?.toLowerCase()));if(E.eventPhase===Event.CAPTURING_PHASE||!N)P.reverse(),A=fce(_.getLastRender(),P);else{const D=E.composedPath(),$=D.slice(D.indexOf(E.currentTarget),D.indexOf(_.domNode)).reverse();A=fce(_.getLastRender(),$,!0)}let F;return A&&(F=i.handleInterceptedEvent(e,A,this,E)),n("domEventProcessed",E),F},i.postProcessProjectionOptions?.(r);const v=y();_=p(m,v,r),r.eventHandlerInterceptor=void 0,l.push(_),c.push(y),i.afterFirstVNodeRendered&&i.afterFirstVNodeRendered(_,v)};let d=()=>{if(s=void 0,o){o=!1,n("renderStart",void 0);for(let p=0;p<l.length;p++){const m=c[p]();n("rendered",void 0),l[p].update(m),n("patched",void 0)}n("renderDone",void 0),o=!0}};return i.modifyDoRenderImplementation&&(d=i.modifyDoRenderImplementation(d,l,c)),e={renderNow:d,scheduleRender:()=>{s||a||(s=requestAnimationFrame(d))},stop:()=>{s&&(cancelAnimationFrame(s),s=void 0),a=!0},resume:()=>{a=!1,o=!0,e.scheduleRender()},append:(p,m)=>{u(ky.append,p,m)},insertBefore:(p,m)=>{u(ky.insertBefore,p,m)},merge:(p,m)=>{u(ky.merge,p,m)},replace:(p,m)=>{u(ky.replace,p,m)},detach:p=>{for(let m=0;m<c.length;m++)if(c[m]===p)return c.splice(m,1),l.splice(m,1)[0];throw new Error("renderFunction was not found")}},e},E2={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let C2,pAe,Ck,fAe=!1,M5=!1,YZ=!1,Bc=!1,mce=null,eH=!1;const XZ=t=>{const e=new URL(t,No.$resourcesUrl$);return e.origin!==QR.location.origin?e.href:e.pathname},$_t=t=>No.$resourcesUrl$=t,Zb=(t,e="")=>()=>{},gce="http://www.w3.org/1999/xlink",yce={},I_t="http://www.w3.org/2000/svg",L_t="http://www.w3.org/1999/xhtml",D_t=t=>t!=null,ZZ=t=>(t=typeof t,t==="object"||t==="function");function N_t(t){var e,i,r;return(r=(i=(e=t.head)===null||e===void 0?void 0:e.querySelector('meta[name="csp-nonce"]'))===null||i===void 0?void 0:i.getAttribute("content"))!==null&&r!==void 0?r:void 0}const H=(t,e,...i)=>{let r=null,n=null,s=null,o=!1,a=!1;const l=[],c=d=>{for(let p=0;p<d.length;p++)r=d[p],Array.isArray(r)?c(r):r!=null&&typeof r!="boolean"&&((o=typeof t!="function"&&!ZZ(r))&&(r=String(r)),o&&a?l[l.length-1].$text$+=r:l.push(o?$5(null,r):r),a=o)};if(c(i),e){e.key&&(n=e.key),e.name&&(s=e.name);{const d=e.className||e.class;d&&(e.class=typeof d!="object"?d:Object.keys(d).filter(p=>d[p]).join(" "))}}if(typeof t=="function")return t(e===null?{}:e,l,k_t);const u=$5(t,null);return u.$attrs$=e,l.length>0&&(u.$children$=l),u.$key$=n,u.$name$=s,u},$5=(t,e)=>{const i={$flags$:0,$tag$:t,$text$:e,$elm$:null,$children$:null};return i.$attrs$=null,i.$key$=null,i.$name$=null,i},yo={},F_t=t=>t&&t.$tag$===yo,k_t={forEach:(t,e)=>t.map(_ce).forEach(e),map:(t,e)=>t.map(_ce).map(e).map(U_t)},_ce=t=>({vattrs:t.$attrs$,vchildren:t.$children$,vkey:t.$key$,vname:t.$name$,vtag:t.$tag$,vtext:t.$text$}),U_t=t=>{if(typeof t.vtag=="function"){const i=Object.assign({},t.vattrs);return t.vkey&&(i.key=t.vkey),t.vname&&(i.name=t.vname),H(t.vtag,i,...t.vchildren||[])}const e=$5(t.vtag,t.vtext);return e.$attrs$=t.vattrs,e.$children$=t.vchildren,e.$key$=t.vkey,e.$name$=t.vname,e},z_t=t=>pvt.map(e=>e(t)).find(e=>!!e),B_t=(t,e)=>t!=null&&!ZZ(t)?e&4?t==="false"?!1:t===""||!!t:e&2?parseFloat(t):e&1?String(t):t:t,V_t=t=>t,Ji=(t,e,i)=>{const r=V_t(t);return{emit:n=>G_t(r,e,{bubbles:!!(i&4),composed:!!(i&2),cancelable:!!(i&1),detail:n})}},G_t=(t,e,i)=>{const r=No.ce(e,i);return t.dispatchEvent(r),r},vce=new WeakMap,j_t=(t,e,i)=>{let r=L5.get(t);gvt&&i?(r=r||new CSSStyleSheet,typeof r=="string"?r=e:r.replaceSync(e)):r=e,L5.set(t,r)},H_t=(t,e,i,r)=>{var n;let s=mAe(e,i);const o=L5.get(s);if(t=t.nodeType===11?t:Gd,o)if(typeof o=="string"){t=t.head||t;let a=vce.get(t),l;if(a||vce.set(t,a=new Set),!a.has(s)){{l=Gd.createElement("style"),l.innerHTML=o;const c=(n=No.$nonce$)!==null&&n!==void 0?n:N_t(Gd);c!=null&&l.setAttribute("nonce",c),t.insertBefore(l,t.querySelector("link"))}a&&a.add(s)}}else t.adoptedStyleSheets.includes(o)||(t.adoptedStyleSheets=[...t.adoptedStyleSheets,o]);return s},q_t=t=>{const e=t.$cmpMeta$,i=t.$hostElement$,r=e.$flags$,n=Zb("attachStyles",e.$tagName$),s=H_t(i.shadowRoot?i.shadowRoot:i.getRootNode(),e,t.$modeName$);r&10&&(i["s-sc"]=s,i.classList.add(s+"-h"),r&2&&i.classList.add(s+"-s")),n()},mAe=(t,e)=>"sc-"+(e&&t.$flags$&32?t.$tagName$+"-"+e:t.$tagName$),bce=(t,e,i,r,n,s)=>{if(i!==r){let o=Sce(t,e),a=e.toLowerCase();if(e==="class"){const l=t.classList,c=wce(i),u=wce(r);l.remove(...c.filter(d=>d&&!u.includes(d))),l.add(...u.filter(d=>d&&!c.includes(d)))}else if(e==="style"){for(const l in i)(!r||r[l]==null)&&(l.includes("-")?t.style.removeProperty(l):t.style[l]="");for(const l in r)(!i||r[l]!==i[l])&&(l.includes("-")?t.style.setProperty(l,r[l]):t.style[l]=r[l])}else if(e!=="key")if(e==="ref")r&&r(t);else if(!t.__lookupSetter__(e)&&e[0]==="o"&&e[1]==="n")e[2]==="-"?e=e.slice(3):Sce(QR,a)?e=a.slice(2):e=a[2]+e.slice(3),i&&No.rel(t,e,i,!1),r&&No.ael(t,e,r,!1);else{const l=ZZ(r);if((o||l&&r!==null)&&!n)try{if(t.tagName.includes("-"))t[e]=r;else{const u=r??"";e==="list"?o=!1:(i==null||t[e]!=u)&&(t[e]=u)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(e=a,c=!0),r==null||r===!1?(r!==!1||t.getAttribute(e)==="")&&(c?t.removeAttributeNS(gce,e):t.removeAttribute(e)):(!o||s&4||n)&&!l&&(r=r===!0?"":r,c?t.setAttributeNS(gce,e,r):t.setAttribute(e,r))}}},W_t=/\s/,wce=t=>t?t.split(W_t):[],gAe=(t,e,i,r)=>{const n=e.$elm$.nodeType===11&&e.$elm$.host?e.$elm$.host:e.$elm$,s=t&&t.$attrs$||yce,o=e.$attrs$||yce;for(r in s)r in o||bce(n,r,s[r],void 0,i,e.$flags$);for(r in o)bce(n,r,s[r],o[r],i,e.$flags$)},I5=(t,e,i,r)=>{const n=e.$children$[i];let s=0,o,a,l;if(fAe||(YZ=!0,n.$tag$==="slot"&&(C2&&r.classList.add(C2+"-s"),n.$flags$|=n.$children$?2:1)),n.$text$!==null)o=n.$elm$=Gd.createTextNode(n.$text$);else if(n.$flags$&1)o=n.$elm$=Gd.createTextNode("");else{if(Bc||(Bc=n.$tag$==="svg"),o=n.$elm$=Gd.createElementNS(Bc?I_t:L_t,n.$flags$&2?"slot-fb":n.$tag$),Bc&&n.$tag$==="foreignObject"&&(Bc=!1),gAe(null,n,Bc),D_t(C2)&&o["s-si"]!==C2&&o.classList.add(o["s-si"]=C2),n.$children$)for(s=0;s<n.$children$.length;++s)a=I5(t,n,s,o),a&&o.appendChild(a);n.$tag$==="svg"?Bc=!1:o.tagName==="foreignObject"&&(Bc=!0)}return o["s-hn"]=Ck,n.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=pAe,o["s-sn"]=n.$name$||"",l=t&&t.$children$&&t.$children$[i],l&&l.$tag$===n.$tag$&&t.$elm$&&zO(t.$elm$,!1)),o},zO=(t,e)=>{No.$flags$|=1;const i=t.childNodes;for(let r=i.length-1;r>=0;r--){const n=i[r];n["s-hn"]!==Ck&&n["s-ol"]&&(vAe(n).insertBefore(n,JZ(n)),n["s-ol"].remove(),n["s-ol"]=void 0,YZ=!0),e&&zO(n,e)}No.$flags$&=-2},yAe=(t,e,i,r,n,s)=>{let o=t["s-cr"]&&t["s-cr"].parentNode||t,a;for(o.shadowRoot&&o.tagName===Ck&&(o=o.shadowRoot);n<=s;++n)r[n]&&(a=I5(null,i,n,t),a&&(r[n].$elm$=a,o.insertBefore(a,JZ(e))))},_Ae=(t,e,i,r,n)=>{for(;e<=i;++e)(r=t[e])&&(n=r.$elm$,xAe(r),M5=!0,n["s-ol"]?n["s-ol"].remove():zO(n,!0),n.remove())},Y_t=(t,e,i,r)=>{let n=0,s=0,o=0,a=0,l=e.length-1,c=e[0],u=e[l],d=r.length-1,p=r[0],m=r[d],y,_;for(;n<=l&&s<=d;)if(c==null)c=e[++n];else if(u==null)u=e[--l];else if(p==null)p=r[++s];else if(m==null)m=r[--d];else if(Q$(c,p))A2(c,p),c=e[++n],p=r[++s];else if(Q$(u,m))A2(u,m),u=e[--l],m=r[--d];else if(Q$(c,m))(c.$tag$==="slot"||m.$tag$==="slot")&&zO(c.$elm$.parentNode,!1),A2(c,m),t.insertBefore(c.$elm$,u.$elm$.nextSibling),c=e[++n],m=r[--d];else if(Q$(u,p))(c.$tag$==="slot"||m.$tag$==="slot")&&zO(u.$elm$.parentNode,!1),A2(u,p),t.insertBefore(u.$elm$,c.$elm$),u=e[--l],p=r[++s];else{for(o=-1,a=n;a<=l;++a)if(e[a]&&e[a].$key$!==null&&e[a].$key$===p.$key$){o=a;break}o>=0?(_=e[o],_.$tag$!==p.$tag$?y=I5(e&&e[s],i,o,t):(A2(_,p),e[o]=void 0,y=_.$elm$),p=r[++s]):(y=I5(e&&e[s],i,s,t),p=r[++s]),y&&vAe(c.$elm$).insertBefore(y,JZ(c.$elm$))}n>l?yAe(t,r[d+1]==null?null:r[d+1].$elm$,i,r,s,d):s>d&&_Ae(e,n,l)},Q$=(t,e)=>t.$tag$===e.$tag$?t.$tag$==="slot"?t.$name$===e.$name$:t.$key$===e.$key$:!1,JZ=t=>t&&t["s-ol"]||t,vAe=t=>(t["s-ol"]?t["s-ol"]:t).parentNode,A2=(t,e)=>{const i=e.$elm$=t.$elm$,r=t.$children$,n=e.$children$,s=e.$tag$,o=e.$text$;let a;o===null?(Bc=s==="svg"?!0:s==="foreignObject"?!1:Bc,s==="slot"||gAe(t,e,Bc),r!==null&&n!==null?Y_t(i,r,e,n):n!==null?(t.$text$!==null&&(i.textContent=""),yAe(i,null,e,n,0,n.length-1)):r!==null&&_Ae(r,0,r.length-1),Bc&&s==="svg"&&(Bc=!1)):(a=i["s-cr"])?a.parentNode.textContent=o:t.$text$!==o&&(i.data=o)},bAe=t=>{const e=t.childNodes;let i,r,n,s,o,a;for(r=0,n=e.length;r<n;r++)if(i=e[r],i.nodeType===1){if(i["s-sr"]){for(o=i["s-sn"],i.hidden=!1,s=0;s<n;s++)if(a=e[s].nodeType,e[s]["s-hn"]!==i["s-hn"]||o!==""){if(a===1&&o===e[s].getAttribute("slot")){i.hidden=!0;break}}else if(a===1||a===3&&e[s].textContent.trim()!==""){i.hidden=!0;break}}bAe(i)}},Sd=[],wAe=t=>{let e,i,r,n,s,o,a=0;const l=t.childNodes,c=l.length;for(;a<c;a++){if(e=l[a],e["s-sr"]&&(i=e["s-cr"])&&i.parentNode)for(r=i.parentNode.childNodes,n=e["s-sn"],o=r.length-1;o>=0;o--)i=r[o],!i["s-cn"]&&!i["s-nr"]&&i["s-hn"]!==e["s-hn"]&&(xce(i,n)?(s=Sd.find(u=>u.$nodeToRelocate$===i),M5=!0,i["s-sn"]=i["s-sn"]||n,s?s.$slotRefNode$=e:Sd.push({$slotRefNode$:e,$nodeToRelocate$:i}),i["s-sr"]&&Sd.map(u=>{xce(u.$nodeToRelocate$,i["s-sn"])&&(s=Sd.find(d=>d.$nodeToRelocate$===i),s&&!u.$slotRefNode$&&(u.$slotRefNode$=s.$slotRefNode$))})):Sd.some(u=>u.$nodeToRelocate$===i)||Sd.push({$nodeToRelocate$:i}));e.nodeType===1&&wAe(e)}},xce=(t,e)=>t.nodeType===1?t.getAttribute("slot")===null&&e===""||t.getAttribute("slot")===e:t["s-sn"]===e?!0:e==="",xAe=t=>{t.$attrs$&&t.$attrs$.ref&&t.$attrs$.ref(null),t.$children$&&t.$children$.map(xAe)},X_t=(t,e)=>{const i=t.$hostElement$,r=t.$cmpMeta$,n=t.$vnode$||$5(null,null),s=F_t(e)?e:H(null,null,e);Ck=i.tagName,r.$attrsToReflect$&&(s.$attrs$=s.$attrs$||{},r.$attrsToReflect$.map(([o,a])=>s.$attrs$[a]=i[o])),s.$tag$=null,s.$flags$|=4,t.$vnode$=s,s.$elm$=n.$elm$=i.shadowRoot||i,C2=i["s-sc"],pAe=i["s-cr"],fAe=(r.$flags$&1)!==0,M5=!1,A2(n,s);{if(No.$flags$|=1,YZ){wAe(s.$elm$);let o,a,l,c,u,d,p=0;for(;p<Sd.length;p++)o=Sd[p],a=o.$nodeToRelocate$,a["s-ol"]||(l=Gd.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(p=0;p<Sd.length;p++)if(o=Sd[p],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,u=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(d=l["s-nr"],d&&d["s-sn"]===a["s-sn"]&&c===d.parentNode&&(d=d.nextSibling,!d||!d["s-nr"])){u=d;break}(!u&&c!==a.parentNode||a.nextSibling!==u)&&a!==u&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,u))}else a.nodeType===1&&(a.hidden=!0)}M5&&bAe(s.$elm$),No.$flags$&=-2,Sd.length=0}},Z_t=(t,e)=>{},KZ=(t,e)=>(t.$flags$|=16,Z_t(t,t.$ancestorComponent$),vvt(()=>J_t(t,e))),J_t=(t,e)=>{const i=t.$hostElement$,r=Zb("scheduleUpdate",t.$cmpMeta$.$tagName$),n=i;let s;return e?s=TT(n,"componentWillLoad"):s=TT(n,"componentWillUpdate"),s=Tce(s,()=>TT(n,"componentWillRender")),r(),Tce(s,()=>K_t(t,n,e))},K_t=async(t,e,i)=>{const r=t.$hostElement$,n=Zb("update",t.$cmpMeta$.$tagName$);r["s-rc"],i&&q_t(t);const s=Zb("render",t.$cmpMeta$.$tagName$);Q_t(t,e,r),s(),n(),evt(t)},Q_t=(t,e,i)=>{try{mce=e,e=e.render&&e.render(),t.$flags$&=-17,t.$flags$|=2,(E2.hasRenderFn||E2.reflect)&&(E2.vdomRender||E2.reflect)&&(E2.hydrateServerSide||X_t(t,e))}catch(a){KR(a,t.$hostElement$)}return mce=null,null},evt=t=>{const e=t.$cmpMeta$.$tagName$,i=t.$hostElement$,r=Zb("postUpdate",e),n=i;t.$ancestorComponent$,TT(n,"componentDidRender"),t.$flags$&64?(TT(n,"componentDidUpdate"),r()):(t.$flags$|=64,TT(n,"componentDidLoad"),r())},QS=t=>{{const e=JR(t),i=e.$hostElement$.isConnected;return i&&(e.$flags$&18)===2&&KZ(e,!1),i}},TT=(t,e,i)=>{if(t&&t[e])try{return t[e](i)}catch(r){KR(r)}},Tce=(t,e)=>t&&t.then?t.then(e):e(),tvt=(t,e)=>JR(t).$instanceValues$.get(e),ivt=(t,e,i,r)=>{const n=JR(t),s=t,o=n.$instanceValues$.get(e),a=n.$flags$,l=s;i=B_t(i,r.$members$[e][0]);const c=Number.isNaN(o)&&Number.isNaN(i);if(i!==o&&!c){n.$instanceValues$.set(e,i);{if(r.$watchers$&&a&128){const d=r.$watchers$[e];d&&d.map(p=>{try{l[p](i,o,e)}catch(m){KR(m,s)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(i,o,e)===!1)return;KZ(n,!1)}}}},rvt=(t,e,i)=>{if(e.$members$){t.watchers&&(e.$watchers$=t.watchers);const r=Object.entries(e.$members$),n=t.prototype;r.map(([s,[o]])=>{(o&31||o&32)&&Object.defineProperty(n,s,{get(){return tvt(this,s)},set(a){ivt(this,s,a,e)},configurable:!0,enumerable:!0})});{const s=new Map;n.attributeChangedCallback=function(o,a,l){No.jmp(()=>{const c=s.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(n.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},t.observedAttributes=r.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return s.set(l,o),a[0]&512&&e.$attrsToReflect$.push([o,l]),l})}}return t},nvt=async(t,e,i,r,n)=>{if(!(e.$flags$&32)&&(n=t.constructor,e.$flags$|=32,customElements.whenDefined(i.$tagName$).then(()=>e.$flags$|=128),n.style)){let o=n.style;typeof o!="string"&&(o=o[e.$modeName$=z_t(t)]);const a=mAe(i,e.$modeName$);if(!L5.has(a)){const l=Zb("registerStyles",i.$tagName$);j_t(a,o,!!(i.$flags$&1)),l()}}e.$ancestorComponent$,(()=>KZ(e,!0))()},svt=t=>{},ovt=t=>{if(!(No.$flags$&1)){const e=JR(t),i=e.$cmpMeta$,r=Zb("connectedCallback",i.$tagName$);e.$flags$&1?(TAe(t,e,i.$listeners$),svt(e.$lazyInstance$)):(e.$flags$|=1,i.$flags$&12&&avt(t),i.$members$&&Object.entries(i.$members$).map(([n,[s]])=>{if(s&31&&t.hasOwnProperty(n)){const o=t[n];delete t[n],t[n]=o}}),nvt(t,e,i)),r()}},avt=t=>{const e=t["s-cr"]=Gd.createComment("");e["s-cn"]=!0,t.insertBefore(e,t.firstChild)},lvt=t=>{if(!(No.$flags$&1)){const e=JR(t);e.$rmListeners$&&(e.$rmListeners$.map(i=>i()),e.$rmListeners$=void 0)}},ln=(t,e)=>{const i={$flags$:e[0],$tagName$:e[1]};i.$members$=e[2],i.$listeners$=e[3],i.$watchers$=t.$watchers$,i.$attrsToReflect$=[];const r=t.prototype.connectedCallback,n=t.prototype.disconnectedCallback;return Object.assign(t.prototype,{__registerHost(){dvt(this,i)},connectedCallback(){ovt(this),r&&r.call(this)},disconnectedCallback(){lvt(this),n&&n.call(this)},__attachShadow(){this.attachShadow({mode:"open",delegatesFocus:!!(i.$flags$&16)})}}),t.is=i.$tagName$,rvt(t,i)},ZR=(t,e)=>e,TAe=(t,e,i,r)=>{i&&i.map(([n,s,o])=>{const a=uvt(t,n),l=cvt(e,o),c=hvt(n);No.ael(a,s,l,c),(e.$rmListeners$=e.$rmListeners$||[]).push(()=>No.rel(a,s,l,c))})},cvt=(t,e)=>i=>{try{E2.lazyLoad||t.$hostElement$[e](i)}catch(r){KR(r)}},uvt=(t,e)=>e&4?Gd:e&8?QR:e&16?Gd.body:t,hvt=t=>fvt?{passive:(t&1)!==0,capture:(t&2)!==0}:(t&2)!==0,SAe=new WeakMap,JR=t=>SAe.get(t),dvt=(t,e)=>{const i={$flags$:0,$hostElement$:t,$cmpMeta$:e,$instanceValues$:new Map};return TAe(t,i,e.$listeners$),SAe.set(t,i)},Sce=(t,e)=>e in t,KR=(t,e)=>(0,console.error)(t,e),L5=new Map,pvt=[],QR=typeof window<"u"?window:{},Gd=QR.document||{head:{}},cn=QR.HTMLElement||class{},No={$flags$:0,$resourcesUrl$:"",jmp:t=>t(),raf:t=>requestAnimationFrame(t),ael:(t,e,i,r)=>t.addEventListener(e,i,r),rel:(t,e,i,r)=>t.removeEventListener(e,i,r),ce:(t,e)=>new CustomEvent(t,e)},fvt=(()=>{let t=!1;try{Gd.addEventListener("e",null,Object.defineProperty({},"passive",{get(){t=!0}}))}catch{}return t})(),mvt=t=>Promise.resolve(t),gvt=(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})(),tH=[],EAe=[],CAe=(t,e)=>i=>{t.push(i),eH||(eH=!0,e&&No.$flags$&4?yvt(iH):No.raf(iH))},Ece=t=>{for(let e=0;e<t.length;e++)try{t[e](performance.now())}catch(i){KR(i)}t.length=0},iH=()=>{Ece(tH),Ece(EAe),(eH=tH.length>0)&&No.raf(iH)},yvt=t=>mvt().then(t),_vt=CAe(tH,!1),vvt=CAe(EAe,!0);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */function bvt(t){return t.map(e=>{let i="";for(let r=0;r<e;r++)i+=((1+Math.random())*65536|0).toString(16).substring(1);return i}).join("-")}const _w=()=>bvt([2,1,1,1,3]);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const AAe="calcite-mode-auto",OAe="calcite-mode-dark",wvt="calcite-mode-light",rH={autoMode:AAe,darkMode:OAe,lightMode:wvt,rtl:"calcite--rtl",calciteAnimate:"calcite-animate",calciteAnimateIn:"calcite-animate__in",calciteAnimateInUp:"calcite-animate__in-up",calciteAnimateInDown:"calcite-animate__in-down",calciteAnimateInRight:"calcite-animate__in-right",calciteAnimateInLeft:"calcite-animate__in-left",calciteAnimateInScale:"calcite-animate__in-scale"};/*!
* tabbable 6.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var RAe=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],D5=RAe.join(","),PAe=typeof Element>"u",Jb=PAe?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,N5=!PAe&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t?.ownerDocument},F5=function t(e,i){var r;i===void 0&&(i=!0);var n=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"inert"),s=n===""||n==="true",o=s||i&&e&&t(e.parentNode);return o},xvt=function(e){var i,r=e==null||(i=e.getAttribute)===null||i===void 0?void 0:i.call(e,"contenteditable");return r===""||r==="true"},MAe=function(e,i,r){if(F5(e))return[];var n=Array.prototype.slice.apply(e.querySelectorAll(D5));return i&&Jb.call(e,D5)&&n.unshift(e),n=n.filter(r),n},$Ae=function t(e,i,r){for(var n=[],s=Array.from(e);s.length;){var o=s.shift();if(!F5(o,!1))if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,c=t(l,!0,r);r.flatten?n.push.apply(n,c):n.push({scopeParent:o,candidates:c})}else{var u=Jb.call(o,D5);u&&r.filter(o)&&(i||!e.includes(o))&&n.push(o);var d=o.shadowRoot||typeof r.getShadowRoot=="function"&&r.getShadowRoot(o),p=!F5(d,!1)&&(!r.shadowRootFilter||r.shadowRootFilter(o));if(d&&p){var m=t(d===!0?o.children:d.children,!0,r);r.flatten?n.push.apply(n,m):n.push({scopeParent:o,candidates:m})}else s.unshift.apply(s,o.children)}}return n},IAe=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},D1=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||xvt(e))&&!IAe(e)?0:e.tabIndex},Tvt=function(e,i){var r=D1(e);return r<0&&i&&!IAe(e)?0:r},Svt=function(e,i){return e.tabIndex===i.tabIndex?e.documentOrder-i.documentOrder:e.tabIndex-i.tabIndex},LAe=function(e){return e.tagName==="INPUT"},Evt=function(e){return LAe(e)&&e.type==="hidden"},Cvt=function(e){var i=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(r){return r.tagName==="SUMMARY"});return i},Avt=function(e,i){for(var r=0;r<e.length;r++)if(e[r].checked&&e[r].form===i)return e[r]},Ovt=function(e){if(!e.name)return!0;var i=e.form||N5(e),r=function(a){return i.querySelectorAll('input[type="radio"][name="'+a+'"]')},n;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")n=r(window.CSS.escape(e.name));else try{n=r(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var s=Avt(n,e.form);return!s||s===e},Rvt=function(e){return LAe(e)&&e.type==="radio"},Pvt=function(e){return Rvt(e)&&!Ovt(e)},Mvt=function(e){var i,r=e&&N5(e),n=(i=r)===null||i===void 0?void 0:i.host,s=!1;if(r&&r!==e){var o,a,l;for(s=!!((o=n)!==null&&o!==void 0&&(a=o.ownerDocument)!==null&&a!==void 0&&a.contains(n)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!s&&n;){var c,u,d;r=N5(n),n=(c=r)===null||c===void 0?void 0:c.host,s=!!((u=n)!==null&&u!==void 0&&(d=u.ownerDocument)!==null&&d!==void 0&&d.contains(n))}}return s},Cce=function(e){var i=e.getBoundingClientRect(),r=i.width,n=i.height;return r===0&&n===0},$vt=function(e,i){var r=i.displayCheck,n=i.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var s=Jb.call(e,"details>summary:first-of-type"),o=s?e.parentElement:e;if(Jb.call(o,"details:not([open]) *"))return!0;if(!r||r==="full"||r==="legacy-full"){if(typeof n=="function"){for(var a=e;e;){var l=e.parentElement,c=N5(e);if(l&&!l.shadowRoot&&n(l)===!0)return Cce(e);e.assignedSlot?e=e.assignedSlot:!l&&c!==e.ownerDocument?e=c.host:e=l}e=a}if(Mvt(e))return!e.getClientRects().length;if(r!=="legacy-full")return!0}else if(r==="non-zero-area")return Cce(e);return!1},Ivt=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var i=e.parentElement;i;){if(i.tagName==="FIELDSET"&&i.disabled){for(var r=0;r<i.children.length;r++){var n=i.children.item(r);if(n.tagName==="LEGEND")return Jb.call(i,"fieldset[disabled] *")?!0:!n.contains(e)}return!0}i=i.parentElement}return!1},k5=function(e,i){return!(i.disabled||F5(i)||Evt(i)||$vt(i,e)||Cvt(i)||Ivt(i))},nH=function(e,i){return!(Pvt(i)||D1(i)<0||!k5(e,i))},Lvt=function(e){var i=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(i)||i>=0)},Dvt=function t(e){var i=[],r=[];return e.forEach(function(n,s){var o=!!n.scopeParent,a=o?n.scopeParent:n,l=Tvt(a,o),c=o?t(n.candidates):a;l===0?o?i.push.apply(i,c):i.push(a):r.push({documentOrder:s,tabIndex:l,item:n,isScope:o,content:c})}),r.sort(Svt).reduce(function(n,s){return s.isScope?n.push.apply(n,s.content):n.push(s.content),n},[]).concat(i)},DAe=function(e,i){i=i||{};var r;return i.getShadowRoot?r=$Ae([e],i.includeContainer,{filter:nH.bind(null,i),flatten:!1,getShadowRoot:i.getShadowRoot,shadowRootFilter:Lvt}):r=MAe(e,i.includeContainer,nH.bind(null,i)),Dvt(r)},Nvt=function(e,i){i=i||{};var r;return i.getShadowRoot?r=$Ae([e],i.includeContainer,{filter:k5.bind(null,i),flatten:!0,getShadowRoot:i.getShadowRoot}):r=MAe(e,i.includeContainer,k5.bind(null,i)),r},$x=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return Jb.call(e,D5)===!1?!1:nH(i,e)},Fvt=RAe.concat("iframe").join(","),Mz=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return Jb.call(e,Fvt)===!1?!1:k5(i,e)};const NAe={getShadowRoot:!0};function kvt(t){return vw(t,`.${rH.darkMode}, .${rH.lightMode}`)?.classList.contains("calcite-mode-dark")?"dark":"light"}function eE(t){const e="dir",i=`[${e}]`,r=vw(t,i);return r?r.getAttribute(e):"ltr"}function FAe(t){return t.getRootNode()}function kAe(t){return t.host||null}function QZ(t,{selector:e,id:i}){function r(n){if(!n)return null;n.assignedSlot&&(n=n.assignedSlot);const s=FAe(n),o=i?"getElementById"in s?s.getElementById(i):null:e?s.querySelector(e):null,a=kAe(s);return o||(a?r(a):null)}return r(t)}function vw(t,e){function i(r){return r?r.closest(e)||i(kAe(FAe(r))):null}return i(t)}function Uvt(t,e){return UAe(t,e)}function UAe(t,e){if(!t)return;const i=e(t);if(i!==void 0)return i;const{parentNode:r}=t;return UAe(r instanceof ShadowRoot?r.host:r,e)}function zvt(t,e){return!!Uvt(e,i=>i===t?!0:void 0)}function Bvt(t){return typeof t?.setFocus=="function"}async function tE(t){if(t)return Bvt(t)?t.setFocus():t.focus()}function Ak(t){t&&(DAe(t,NAe)[0]||t).focus()}const BO=":not([slot])";function oD(t,e,i){e&&!Array.isArray(e)&&typeof e!="string"&&(i=e,e=null);const r=e?Array.isArray(e)?e.map(n=>`[slot="${n}"]`).join(","):`[slot="${e}"]`:BO;return i?.all?Vvt(t,r,i):Gvt(t,r,i)}function zAe(t,e){return t?Array.from(t.children||[]).filter(i=>i?.matches(e)):[]}function Vvt(t,e,i){let r=e===BO?zAe(t,BO):Array.from(t.querySelectorAll(e));r=i&&i.direct===!1?r:r.filter(s=>s.parentElement===t),r=i?.matches?r.filter(s=>s?.matches(i.matches)):r;const n=i?.selector;return n?r.map(s=>Array.from(s.querySelectorAll(n))).reduce((s,o)=>[...s,...o],[]).filter(s=>!!s):r}function Gvt(t,e,i){let r=e===BO?zAe(t,BO)[0]||null:t.querySelector(e);r=i&&i.direct===!1||r?.parentElement===t?r:null,r=i?.matches?r?.matches(i.matches)?r:null:r;const n=i?.selector;return n?r?.querySelector(n):r}function Ace(t,e,i){if(typeof e=="string"&&e!=="")return e;if(e==="")return t[i]}function Oce(t,e){return!(e.left>t.right||e.right<t.left||e.top>t.bottom||e.bottom<t.top)}function oa(t){return(!!t).toString()}function jvt(t){return Wo(t)||qvt(t)}function Hvt(t){return Wvt(t).filter(e=>e.nodeType===Node.TEXT_NODE).map(e=>e.textContent).join("").trim()}function qvt(t){return!!Hvt(t)}function Wvt(t){return t.target.assignedNodes({flatten:!0})}function Wo(t){return!!Ok(t).length}function Ok(t){return t.target.assignedElements({flatten:!0})}function ST(t){return!!(t.isPrimary&&t.button===0)}const eI=(t,e,i,r=!0)=>{const n=t.indexOf(e),s=n===0,o=n===t.length-1;r&&(i=i==="previous"&&s?"last":i==="next"&&o?"first":i);let a;return i==="previous"?a=t[n-1]||t[r?t.length-1:n]:i==="next"?a=t[n+1]||t[r?0:n]:i==="last"?a=t[t.length-1]:a=t[0],tE(a),a};function Yvt(t,e){if(t.parentNode!==e.parentNode)return!1;const i=Array.from(t.parentNode.children);return i.indexOf(t)<i.indexOf(e)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */function Rce(){const{classList:t}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,i=()=>t.contains(OAe)||t.contains(AAe)&&e?"dark":"light",r=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),n=o=>{s!==o&&r(o),s=o};let s=i();r(s),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>n(o.matches?"dark":"light")),new MutationObserver(()=>n(i())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function Xvt(){typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document&&(document.readyState==="interactive"?Rce():document.addEventListener("DOMContentLoaded",()=>Rce(),{once:!0}))}const Zvt=Xvt;Zvt();let BAe;function Jvt(){try{XZ(".")}catch{$_t(La(lr(BAe)))}}function Kvt(t){const e=[];for(const i of Object.keys(t))customElements.get(`calcite-${i}`)||e.push(t[i]?.());return e.length>0?Promise.all(e):null}BAe="components/assets";const VAe=Symbol("widget"),GAe=Symbol("widget-test-data"),Qvt=[],e1t={},U5=new WeakMap;function jAe(t,e){let i=e.children;if(i?.length)for(let n=0;n<i.length;++n)i[n]=jAe(t,i[n]);else i=Qvt;const r=e.vnodeSelector;if(z5(r)){const n=e.properties||e1t,s=n.key||r;return{vnodeSelector:"div",properties:{key:s,afterCreate:t1t,afterUpdate:i1t,afterRemoved:HAe,parentWidget:t,widgetConstructor:r,widgetProperties:{...n,key:s,children:i}},children:void 0,text:void 0,domNode:null}}return e}function t1t(t,e,i,{parentWidget:r,widgetConstructor:n,widgetProperties:s}){const o=new n(s);o.container=t,U5.set(t,o),o.afterCreate?.(o,t),r.addHandles(Mi(()=>HAe(t))),queueMicrotask(()=>{o[GAe].projector.renderNow()})}function i1t(t,e,i,{widgetProperties:r}){const n=U5.get(t);n&&(n.set(r),n.afterUpdate?.(n,t))}function HAe(t){const e=U5.get(t);e&&(e.afterRemoved?.(e,t),e.destroy(),U5.delete(t))}function z5(t){return typeof t=="function"&&t[VAe]}const ec={arrowDown:"esri-icon-arrow-down",arrowUp:"esri-icon-arrow-up",basemap:"esri-icon-basemap",bookmark:"esri-icon-bookmark",calendar:"esri-icon-calendar",checkMark:"esri-icon-check-mark",checkboxUnchecked:"esri-icon-checkbox-unchecked",close:"esri-icon-close",collapse:"esri-icon-collapse",defaultAction:"esri-icon-default-action",description:"esri-icon-description",directions:"esri-icon-directions",dockBottom:"esri-icon-dock-bottom",dockLeft:"esri-icon-dock-left",dockRight:"esri-icon-dock-right",down:"esri-icon-down",downArrow:"esri-icon-down-arrow",download:"esri-icon-download",dragHorizontal:"esri-icon-drag-horizontal",dragVertical:"esri-icon-drag-vertical",duplicate:"esri-icon-duplicate",edit:"esri-icon-edit",elevationProfile:"esri-icon-elevation-profile",environmentSettings:"esri-icon-environment-settings",erase:"esri-icon-erase",error:"esri-icon-error",expand:"esri-icon-expand",fontFallbackText:"esri-icon-font-fallback-text",forward:"esri-icon-forward",gear:"esri-icon-gear",handleHorizontal:"esri-icon-handle-horizontal",handleVertical:"esri-icon-handle-vertical",home:"esri-icon-home",icon:"esri-icon",launchLinkExternal:"esri-icon-launch-link-external",layerList:"esri-icon-layer-list",layers:"esri-icon-layers",left:"esri-icon-left",leftArrows:"esri-icon-left-arrow",leftTriangleArrow:"esri-icon-left-triangle-arrow",lineOfSight:"esri-icon-line-of-sight",link:"esri-icon-link",linkExternal:"esri-icon-link-external",linkHorizontal:"esri-icon-link-horizontal",loadingIndicator:"esri-icon-loading-indicator",locate:"esri-icon-locate",locateCircled:"esri-icon-locate-circled",locked:"esri-icon-locked",mapPin:"esri-icon-map-pin",maximize:"esri-icon-maximize",measure:"esri-icon-measure",measureArea:"esri-icon-measure-area",measureBuildingHeightShadow:"esri-icon-measure-building-height-shadow",measureLine:"esri-icon-measure-line",menu:"esri-icon-menu",minimize:"esri-icon-minimize",minus:"esri-icon-minus",nonVisible:"esri-icon-non-visible",northNavigation:"esri-icon-north-navigation",noticeTriangle:"esri-icon-notice-triangle",organization:"esri-icon-organization",pan:"esri-icon-pan",pan2:"esri-icon-pan2",partlyCloudy:"esri-icon-partly-cloudy",pause:"esri-icon-pause",play:"esri-icon-play",playCircled:"esri-icon-play-circled",plus:"esri-icon-plus",polyline:"esri-icon-polyline",printer:"esri-icon-printer",radioChecked:"esri-icon-radio-checked",radioUnchecked:"esri-icon-radio-unchecked",refresh:"esri-icon-refresh",reverse:"esri-icon-reverse",right:"esri-icon-right",rightArrow:"esri-icon-right-arrow",rightTriangleArrow:"esri-icon-right-triangle-arrow",rotate:"esri-icon-rotate",save:"esri-icon-save",search:"esri-icon-search",settings2:"esri-icon-settings2",slice:"esri-icon-slice",swap:"esri-icon-swap",table:"esri-icon-table",timeClock:"esri-icon-time-clock",tracking:"esri-icon-tracking",trash:"esri-icon-trash",unlockedLinkHorizontal:"esri-icon-unlocked-link-horizontal",up:"esri-icon-up",upArrow:"esri-icon-up-arrow",upDownArrows:"esri-icon-up-down-arrows",urbanModel:"esri-icon-urban-model",vertexGps:"esri-icon-vertex-gps",visible:"esri-icon-visible",zoomInFixed:"esri-icon-zoom-in-fixed",zoomInMagnifyingGlass:"esri-icon-zoom-in-magnifying-glass",zoomOutFixed:"esri-icon-zoom-out-fixed",zoomToObject:"esri-icon-zoom-to-object"},Pce=new Set;function r1t(t){Pce.add(t),t.finally(()=>Pce.delete(t))}var qAe;const n1t="esri.widgets.Widget";let s1t=0;const o1t={widgetIcon:ec.checkboxUnchecked};function WAe(t,e){for(const i in e)t[i]!=null&&(typeof t[i]=="object"&&typeof e[i]=="object"?WAe(t[i],e?.[i]):t[i]=e[i]);return t}const a1t=M_t({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,i=/capture$/i;t.eventHandlerInterceptor=(r,n,s,o)=>{const a=e?.(r,n,s,o),l=i.test(r);if(!((r=r.replace(i,"")).toLowerCase()in s)||l){const c=r[2].toLowerCase()+r.slice(3),u=m=>a?.call(s,m);s.addEventListener(c,u,l);const d=()=>s.removeEventListener(c,u,l),p=o.afterRemoved;o.afterRemoved=m=>{p?.(m),d()}}return a}},handleInterceptedEvent(t,e,i,r){const{eventPhase:n,type:s}=r,o=n===Event.CAPTURING_PHASE;let a=`on${s}${o?"capture":""}`;const l=e.properties;(l&&a in l||(a=`on${s[0].toUpperCase()}${s.slice(1)}${o?"Capture":""}`,l&&a in l))&&(vye(),t.scheduleRender(),l[a].call(l.bind||i,r))}});let $z=!1,$s=class extends v4(Tn.EventedAccessor){constructor(t,e){super(t,e),this._attached=!1,this._projector=a1t,this._readyForTrueRender=!1,this.iconClass=o1t.widgetIcon,this.icon=null,this.key=this,this._loadLocale=CH(async()=>{if(this._messageBundleProps?.length){const o=await Promise.allSettled(this._messageBundleProps.map(async({bundlePath:a,propertyName:l})=>{if(this.destroyed)return;let c=await nq(a);this.uiStrings&&Object.keys(this.uiStrings)&&(c=WAe(ye(c),this.uiStrings)),this[l]=c}));if(this.destroyed)return;for(const a of o)a.status==="rejected"&&ne.getLogger(this).error("widget-intl:locale-error",this.declaredClass,a.reason)}await this.loadLocale()}),Jvt();const i="esri-widget-uid-"+Gq(),r=this.render.bind(this);this._trackingTarget=new g4(()=>this.scheduleRender());const n=()=>{if(!this._readyForTrueRender||this.destroyed)return null;const o=r();let{properties:a}=o;a||(o.properties=a={});const{key:l}=a;if(l||(a.key=i),z5(o.vnodeSelector)){if(!this.visible)return{vnodeSelector:"div",properties:{key:`${i}-hidden`,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0}}else this.visible?a.styles||(a.styles={}):(a.class="",a.styles={display:"none"}),a.styles.display||(a.styles.display="");let c=0;return o.children?.forEach(u=>{if(z5(u.vnodeSelector))return;let{properties:d}=u;d||(u.properties=d={}),d.key||(d.key=`${this.id}--${c++}`)}),jAe(this,o)};this.render=()=>{if($z)return n();let o=Cze(this)??null;if(o)return o;this._trackingTarget.clear(),$z=!0;try{o=_g(this._trackingTarget,n)}catch(a){throw console.error(a),a}finally{$z=!1}return o&&Aze(this,o),o};const s=this.beforeFirstRender();s?this._resourcesFetch=s.then(()=>{this._readyForTrueRender=!0,this._postInitialize()}):(this._resourcesFetch=Promise.resolve().then(()=>{this._postInitialize()}),this._readyForTrueRender=!0),this.addResolvingPromise(this._resourcesFetch),r1t(this._resourcesFetch)}normalizeCtorArgs(t,e){const i={...t};return e&&(i.container=e),i}postInitialize(){}beforeFirstRender(){const t=this.loadDependencies();return this._messageBundleProps?.length||t?Promise.all([t,this._loadLocale()]).then(()=>{}).catch(MJ):null}loadDependencies(){return null}loadLocale(){return null}destroy(){this.destroyed||(Pe(this._trackingTarget),Pe(this.viewModel),this._detach(this.container),this._set("container",null),this._emitter.clear(),this.render=()=>null,this._projector=null,P6(this))}set container(t){this._get("container")||this._set("container",t)}castContainer(t){return sF(t)}get domNode(){return this.container}set domNode(t){this.container=t}get id(){return this._get("id")||this.container?.id||Date.now().toString(16)+"-widget-"+s1t++}set id(t){t&&this._set("id",t)}get label(){return this.declaredClass.split(".").pop()}set label(t){this._overrideIfSome("label",t)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(t){this._set("visible",t)}get[(qAe=VAe,GAe)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(P6(this),this._projector.scheduleRender())}own(t){Xue(ne.getLogger(this.declaredClass),"`Widget.own()` is deprecated in favor of Widget.addHandles()'",{replacement:"Widget.addHandles()",version:"4.28"}),this.addHandles(t)}classes(...t){return Rze.apply(this,t)}renderNow(){P6(this),this._projector.renderNow()}_postInitialize(){if(this.destroyed)return;this.scheduleRender(),this._delegatedEventNames?.length&&this.addHandles(le(()=>this.viewModel,(e,i)=>{i&&this.removeHandles("delegated-events"),e&&f4(e)&&this.addHandles(this._delegatedEventNames.map(r=>sg(e,r,n=>{this.emit(r,n)})),"delegated-events")},Yi)),this.postInitialize();const t=async()=>{await this._loadLocale().catch(MJ),this.scheduleRender()};this.addHandles([iq(t),le(()=>this.uiStrings,t),ac(()=>this.container,e=>{this.destroyed||this._attach(e)},{initial:!0,once:!0})])}_attach(t){t&&(this._projector.merge(t,this.render),this._attached=!0)}_detach(t){this._attached&&(this._projector.detach(this.render),this._attached=!1),t?.parentNode?.removeChild(t)}};$s[qAe]=!0,h([f()],$s.prototype,"_readyForTrueRender",void 0),h([f({value:null})],$s.prototype,"container",null),h([rr("container")],$s.prototype,"castContainer",null),h([f()],$s.prototype,"iconClass",void 0),h([f()],$s.prototype,"icon",void 0),h([f()],$s.prototype,"id",null),h([f()],$s.prototype,"label",null),h([f()],$s.prototype,"renderable",null),h([f()],$s.prototype,"uiStrings",void 0),h([f()],$s.prototype,"viewModel",void 0),h([f({value:!0})],$s.prototype,"visible",null),h([f()],$s.prototype,"key",void 0),h([f()],$s.prototype,"children",void 0),h([f()],$s.prototype,"afterCreate",void 0),h([f()],$s.prototype,"afterUpdate",void 0),h([f()],$s.prototype,"afterRemoved",void 0),$s=h([z(n1t)],$s);const Xg=$s;function Mce(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function l1t(t,e){return t.length!==e.length||t.some((i,r)=>i.text!==e[r].text)}function tI(t,e,i){!i||!e||t.find(r=>r.layerView===e&&r.text===i)||t.push({text:i,layerView:e})}function c1t(t){return t.type==="bing-maps"}const N0=[];let O2=class extends xe{constructor(t){super(t),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.removeHandles("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new ft,this.view=null,this._allLayerViewsChange=e=>{this.removeHandles("suspension");const i=this.view?.allLayerViews;i&&this.addHandles(i.map(r=>le(()=>[r.suspended,r.layer?.attributionVisible],()=>this._updateAttributionItems())).toArray(),"suspension"),e?.removed&&e.removed.forEach(r=>{this._pendingAttributions.delete(r),this._fetchedAttributionData.delete(r)}),this._updateAttributionItems()},this.addHandles([Io(()=>this.view?.allLayerViews,"change",e=>this._allLayerViewsChange(e),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),ac(()=>this.view?.stationary===!0,()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.view?.ready?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const t=this.view,e=t?.allLayerViews;N0.length=0,t&&e?(e.forEach(i=>{if(i.suspended||!i.layer?.attributionVisible)return;const r=i.layer;if(Mce(r,"user"))return void tI(N0,i,r.copyright);if(r.hasAttributionData){if(this._fetchedAttributionData.has(i)){const s=this._fetchedAttributionData.get(i);return void(s?tI(N0,i,this._getDynamicAttribution(s,t,r)):Mce(r)&&tI(N0,i,r.copyright))}return void this._fetchAttributionData(i)}const n="portalItem"in r?r.portalItem?.accessInformation:void 0;tI(N0,i,n||r.copyright)}),l1t(this.items,N0)&&(this.items.removeAll(),this.items.addMany(N0)),N0.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(t){if(this._pendingAttributions.has(t))return;this._pendingAttributions.add(t);const e=await hh(t.layer.fetchAttributionData());if(this._pendingAttributions.has(t)){const i=e.ok?this._createContributionIndex(e.value,c1t(t.layer)):null;this._pendingAttributions.delete(t),this._fetchedAttributionData.set(t,i)}this._updateAttributionItems()}_createContributionIndex(t,e){const i=t.contributors,r={};if(!i)return r;for(let n=0;n<i.length;n++){const s=i[n],o=s.coverageAreas;if(!o)return;for(const a of o){const l=a.bbox,c=a.zoomMin-(e&&a.zoomMin?1:0),u=a.zoomMax-(e&&a.zoomMax?1:0),d=new Xi({xmin:l[1],ymin:l[0],xmax:l[3],ymax:l[2],spatialReference:je.WGS84}),p={extent:Gy(d),attribution:s.attribution||"",score:a.score!=null?a.score:100,id:n};for(let m=c;m<=u;m++)r[m]??(r[m]=[]),r[m].push(p)}}return r.maxKey=Math.max.apply(null,Object.keys(r)),r}_getDynamicAttribution(t,e,i){const{extent:r,scale:n}=e;let s=i.tileInfo?.scaleToZoom(n)??0;if(s=Math.min(t.maxKey??0,Math.round(s)),!r||s==null||s<=-1)return"";const o=t[s],a=sR(r.center.clone().normalize(),e.spatialReference),l=new Set;return o?o.filter(c=>{const u=c.id,d=!l.has(u)&&a&&c.extent&&tq(c.extent,a);return d&&l.add(u),d}).sort((c,u)=>u.score-c.score||c.objectId-u.objectId).map(c=>c.attribution).join(", "):""}};h([f({readOnly:!0,type:ft})],O2.prototype,"items",void 0),h([f({readOnly:!0})],O2.prototype,"state",null),h([f()],O2.prototype,"view",void 0),O2=h([z("esri.widgets.Attribution.AttributionViewModel")],O2);const YAe=O2,ka={anchor:"esri-widget__anchor",anchorDisabled:"esri-widget__anchor--disabled",button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",disabled:"esri-disabled",disabledElement:"esri-disabled-element",empty:"esri-widget__content--empty",emptyIllustration:"esri-widget__content-illustration--empty",heading:"esri-widget__heading",hidden:"esri-hidden",input:"esri-input",interactive:"esri-interactive",loader:"esri-widget__loader",loaderAnimation:"esri-widget__loader-animation",loaderText:"esri-widget__loader-text",menu:"esri-menu",menuHeader:"esri-menu__header",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuList:"esri-menu__list",noBookmarksIcon:"esri-widget__no-bookmark-icon",panel:"esri-widget--panel",panelHeightOnly:"esri-widget--panel-height-only",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",rotating:"esri-rotating",secondaryTick:"secondary-tick",select:"esri-select",table:"esri-widget__table",widget:"esri-widget",widgetButton:"esri-widget--button",widgetButtonActive:"esri-widget--button-active",widgetDisabled:"esri-widget--disabled"};function Rk(){return function(t,e){if(!t[e])throw new TypeError(`Cannot auto bind undefined function '${String(e)}'`);return{value:h1t(t[e])}}}function u1t(t){const e=t?.type;return t instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function h1t(t){return function(e,...i){u1t(e)?Lze(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):t.call(this,e,...i)}}function bw(t){return(e,i)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:i})}}var d1t=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}},XAe=function(t,e){for(var i=0,r=t.length;i<r;i++){var n=t[i];Array.isArray(n)?XAe(n,e):n!=null&&n!==!1&&(n.hasOwnProperty("vnodeSelector")||(n=d1t(n)),e.push(n))}},p1t=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(i.length===1&&typeof i[0]=="string")return{vnodeSelector:t,properties:e||void 0,children:void 0,text:i[0],domNode:null};var n=[];return XAe(i,n),{vnodeSelector:t,properties:e||void 0,children:n,text:void 0,domNode:null}};function Ne(t,e,...i){return typeof t!="function"||z5(t)?p1t(t,e,...i):t(e,...i)}function v8t(...t){return t}const Ix="esri-attribution",Ov={base:Ix,poweredBy:`${Ix}__powered-by`,sources:`${Ix}__sources`,open:`${Ix}--open`,sourcesOpen:`${Ix}__sources--open`,link:`${Ix}__link`,widgetIcon:ec.description};let Ea=class extends Xg{constructor(e,i){super(e,i),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(r=>r.forEach(({target:n})=>this._checkSourceTextOverflow(n))),this.iconClass=Ov.widgetIcon,this.icon=null,this.itemDelimiter=" | ",this.messages=null,this.viewModel=new YAe}initialize(){this.addHandles(Io(()=>this.viewModel?.items,"change",()=>this.scheduleRender()))}destroy(){this._resizeObserver?.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,i)=>(e.includes(i.text)||e.push(i.text),e),[]).join(this.itemDelimiter)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[Ov.open]:this._isOpen};return Ne("div",{bind:this,class:this.classes(Ov.base,ka.widget,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return Ne("div",{class:Ov.poweredBy},"Powered by"," ",Ne("a",{class:Ov.link,href:"http://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){const e=this._isOpen,i=this._isInteractive,r=i?0:void 0,{attributionText:n}=this,s={[Ov.sourcesOpen]:e,[ka.interactive]:i};return Ne("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(Ov.sources,s),innerHTML:n,tabIndex:r})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let i=!1;const{clientHeight:r,clientWidth:n,scrollWidth:s}=e,o=s>n,a=this._attributionTextOverflowed!==o;if(this._attributionTextOverflowed=o,a&&(i=!0),this._isOpen){const l=r<this._prevSourceNodeHeight;this._prevSourceNodeHeight=r,l&&(this._isOpen=!1,i=!0)}i&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};h([f()],Ea.prototype,"_isOpen",void 0),h([f()],Ea.prototype,"_isInteractive",null),h([f()],Ea.prototype,"_attributionTextOverflowed",void 0),h([f()],Ea.prototype,"_prevSourceNodeHeight",void 0),h([f({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],Ea.prototype,"attributionText",null),h([f()],Ea.prototype,"iconClass",void 0),h([f()],Ea.prototype,"icon",void 0),h([f()],Ea.prototype,"itemDelimiter",void 0),h([f()],Ea.prototype,"label",null),h([f(),bw("esri/widgets/Attribution/t9n/Attribution")],Ea.prototype,"messages",void 0),h([f()],Ea.prototype,"view",null),h([f({type:YAe})],Ea.prototype,"viewModel",void 0),h([Rk()],Ea.prototype,"_toggleState",null),Ea=h([z("esri.widgets.Attribution")],Ea);const f1t=Ea;function m1t(t){return t?.spatialReference?.isWebMercator||t?.spatialReference?.isGeographic||!1}const g1t=t=>{let e=class extends t{constructor(...i){super(...i),this.goToOverride=null,this.view=null}callGoTo(i){const{view:r}=this;return d4(r),this.goToOverride?this.goToOverride(r,i):r.goTo(i.target,i.options)}};return h([f()],e.prototype,"goToOverride",void 0),h([f()],e.prototype,"view",void 0),e=h([z("esri.widgets.support.GoTo")],e),e},y1t="esri.widgets.CompassViewModel";let _1=class extends g1t(xe){constructor(e){super(e),this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this.addHandles(le(()=>this.view,this._updateRotationWatcher,Zi))}destroy(){this.view=null}get canShowNorth(){return m1t(this.view)}get state(){return!this.view?.ready||this.view.type==="2d"&&!this.view.constraints.rotationEnabled?"disabled":this.canShowNorth?"compass":"rotation"}reset(){if(!this.view?.ready)return;const e={};this.view?.type==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const i=-e.heading;this.orientation={x:0,y:0,z:i}}_updateRotationWatcher(e){this.removeAllHandles(),e&&this.addHandles(e.type==="2d"?le(()=>e?.rotation,this._updateForRotation,Zi):le(()=>e?.camera,this._updateForCamera,Zi))}};h([f({readOnly:!0})],_1.prototype,"canShowNorth",null),h([f()],_1.prototype,"orientation",void 0),h([f({readOnly:!0})],_1.prototype,"state",null),h([f()],_1.prototype,"view",void 0),_1=h([z(y1t)],_1);const ZAe=_1,$ce="esri-compass",Iz={base:$ce,widgetIcon:ec.locateCircled,iconContainer:`${$ce}__icon-container`};let Kp=class extends Xg{constructor(e,i){super(e,i),this.iconClass=Iz.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new ZAe,this._reset=()=>{this.viewModel.reset()},this._toRotationTransform=r=>({transform:`rotateZ(${r.z}deg)`})}loadDependencies(){return Kvt({button:()=>pe(()=>import("./calcite-button-db732aef.js"),[],import.meta.url),icon:()=>pe(()=>import("./calcite-icon-c20c0c0f.js"),[],import.meta.url)})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:i}=this.viewModel,r=i==="rotation"?"arrow-up":"compass-needle",{messages:n}=this;return Ne("div",{class:this.classes(Iz.base,ka.widget)},Ne("calcite-button",{"aria-label":n.reset,class:ka.widgetButton,disabled:i==="disabled",kind:"neutral",onclick:this._reset,round:!0,scale:"s",title:n.reset},Ne("div",{"aria-hidden":"true",class:Iz.iconContainer,title:n.reset},Ne("calcite-icon",{icon:r,scale:"m",styles:this._toRotationTransform(e)}))))}};h([f()],Kp.prototype,"goToOverride",null),h([f()],Kp.prototype,"iconClass",void 0),h([f()],Kp.prototype,"icon",void 0),h([f()],Kp.prototype,"label",null),h([f(),bw("esri/widgets/Compass/t9n/Compass")],Kp.prototype,"messages",void 0),h([f()],Kp.prototype,"view",null),h([f({type:ZAe})],Kp.prototype,"viewModel",void 0),Kp=h([z("esri.widgets.Compass")],Kp);const _1t=Kp,Lx="esri-navigation-toggle",_m={base:Lx,widgetIcon:ec.pan2,button:`${Lx}__button`,activeButton:`${Lx}__button--active`,panButton:`${Lx}__button--pan`,rotateButton:`${Lx}__button--rotate`,isLayoutHorizontal:`${Lx}--horizontal`};let R2=class extends xe{constructor(e){super(e),this.navigationMode="pan",this.view=null}initialize(){this.addHandles(ac(()=>this.view?.inputManager,()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){return this.view?.ready&&this.view?.type==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){const e=this.view?.inputManager;e&&(e.primaryDragAction=this.navigationMode==="pan"?"pan":"rotate")}};h([f({readOnly:!0})],R2.prototype,"state",null),h([f()],R2.prototype,"navigationMode",void 0),h([f()],R2.prototype,"view",void 0),R2=h([z("esri.widgets.NavigationToggleViewModel")],R2);const JAe=R2;let hd=class extends Xg{constructor(e,i){super(e,i),this.iconClass=_m.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new JAe}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}toggle(){return this.viewModel.toggle()}render(){const e=this.viewModel?.state==="disabled",i=this.viewModel?.navigationMode==="pan",r={[ka.disabled]:e,[_m.isLayoutHorizontal]:this.layout==="horizontal"},n={[_m.activeButton]:i},s={[_m.activeButton]:!i},o=e?-1:0,a=this.messages.toggle;return Ne("div",{"aria-label":a,bind:this,class:this.classes(_m.base,ka.widget,r),onclick:this._toggle,onkeydown:this._toggle,tabIndex:o,title:a},Ne("div",{class:this.classes(_m.button,ka.widgetButton,_m.panButton,n)},Ne("span",{class:ec.pan})),Ne("div",{class:this.classes(_m.button,ka.widgetButton,_m.rotateButton,s)},Ne("span",{class:ec.rotate})))}_toggle(){this.toggle()}};h([f()],hd.prototype,"iconClass",void 0),h([f()],hd.prototype,"icon",void 0),h([f()],hd.prototype,"label",null),h([f({value:"vertical"})],hd.prototype,"layout",null),h([f(),bw("esri/widgets/NavigationToggle/t9n/NavigationToggle")],hd.prototype,"messages",void 0),h([f()],hd.prototype,"view",null),h([f({type:JAe})],hd.prototype,"viewModel",void 0),h([Rk()],hd.prototype,"_toggle",null),hd=h([z("esri.widgets.NavigationToggle")],hd);const v1t=hd,bo="esri-feature",b1t={base:bo,container:`${bo}__size-container`,title:`${bo}__title`,main:`${bo}__main-container`,btn:`${bo}__button`,icon:`${bo}__icon`,content:`${bo}__content`,contentNode:`${bo}__content-node`,contentNodeText:`${bo}__content-node--text`,contentElement:`${bo}__content-element`,text:`${bo}__text`,lastEditedInfo:`${bo}__last-edited-info`,fields:`${bo}__fields`,fieldHeader:`${bo}__field-header`,fieldData:`${bo}__field-data`,fieldDataDate:`${bo}__field-data--date`,loadingSpinnerContainer:`${bo}__loading-container`,spinner:`${bo}__loading-spinner`};let Um=class extends Xg{constructor(){super(...arguments),this.enabled=!0,this.iconClass=null,this.icon=null,this.title=""}render(){const t=this.enabled?0:-1,e={[ka.disabled]:!this.enabled,[ka.interactive]:this.enabled};return Ne("div",{bind:this,class:this.classes(ka.widgetButton,ka.widget,e),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:t,title:this.title},Ne("span",{"aria-hidden":"true",class:this.classes(b1t.icon,this.iconClass??""),role:"presentation"}),Ne("span",{class:ec.fontFallbackText},this.title))}_triggerAction(){this.action.call(this)}};h([f()],Um.prototype,"action",void 0),h([f()],Um.prototype,"enabled",void 0),h([f()],Um.prototype,"iconClass",void 0),h([f()],Um.prototype,"icon",void 0),h([f()],Um.prototype,"title",void 0),h([Rk()],Um.prototype,"_triggerAction",null),Um=h([z("esri.widgets.IconButton")],Um);const Ice=Um;let v1=class extends xe{get canZoomIn(){if(!this.view?.ready)return!1;const i=this.view?.constraints?.effectiveMaxScale;return i===0||this._scale>i}get canZoomOut(){const{view:e}=this;if(!e?.ready)return!1;const r=e.constraints?.effectiveMinScale;return r===0||this._scale<r}get _scale(){const e=this.view?.animation?.target;return(e&&"then"in e?void 0:e?.scale)??this.view?.scale??0}};h([f({readOnly:!0})],v1.prototype,"canZoomIn",null),h([f({readOnly:!0})],v1.prototype,"canZoomOut",null),h([f()],v1.prototype,"view",void 0),h([f()],v1.prototype,"_scale",null),v1=h([z("esri.widgets.Zoom.ZoomConditions2D")],v1);const w1t=v1;let P2=class extends xe{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};h([f({readOnly:!0})],P2.prototype,"canZoomIn",null),h([f({readOnly:!0})],P2.prototype,"canZoomOut",null),h([f()],P2.prototype,"view",void 0),P2=h([z("esri.widgets.Zoom.ZoomConditions3D")],P2);const x1t=P2;let cy=class extends xe{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return this._zoomConditions!=null&&this._zoomConditions.canZoomIn}get canZoomOut(){return this._zoomConditions!=null&&this._zoomConditions?.canZoomOut}get state(){return this.view?.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new w1t({view:e}):e.type==="3d"&&(this._zoomConditions=new x1t({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():B3(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():B3(e.goTo({zoomFactor:.5}))}};h([f()],cy.prototype,"_zoomConditions",void 0),h([f()],cy.prototype,"canZoomIn",null),h([f()],cy.prototype,"canZoomOut",null),h([f({readOnly:!0})],cy.prototype,"state",null),h([f()],cy.prototype,"view",null),cy=h([z("esri.widgets.Zoom.ZoomViewModel")],cy);const KAe=cy,Lz={base:"esri-zoom",widgetIcon:ec.zoomInMagnifyingGlass,horizontalLayout:"esri-zoom--horizontal"};let Qp=class extends Xg{constructor(e,i){super(e,i),this.iconClass=Lz.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new KAe}initialize(){this._zoomInButton=new Ice({action:this.zoomIn.bind(this),iconClass:ec.plus}),this._zoomOutButton=new Ice({action:this.zoomOut.bind(this),iconClass:ec.minus})}destroy(){this._zoomInButton=Pe(this._zoomInButton),this._zoomOutButton=Pe(this._zoomOutButton)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e=this.viewModel,i={[Lz.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:r,canZoomOut:n}=e;this._zoomInButton.enabled=r,this._zoomOutButton.enabled=n;const{zoomIn:s,zoomOut:o}=this.messages;return this._zoomInButton.title=s,this._zoomOutButton.title=o,Ne("div",{class:this.classes(Lz.base,ka.widget,i)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};h([f()],Qp.prototype,"iconClass",void 0),h([f()],Qp.prototype,"icon",void 0),h([f()],Qp.prototype,"label",null),h([f({value:"vertical"})],Qp.prototype,"layout",null),h([f(),bw("esri/widgets/Zoom/t9n/Zoom")],Qp.prototype,"messages",void 0),h([f()],Qp.prototype,"view",null),h([f({type:KAe})],Qp.prototype,"viewModel",void 0),Qp=h([z("esri.widgets.Zoom")],Qp);const T1t=Qp;function S1t(t){return t?.view!==void 0}let aD=class extends E_t{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=i=>{this.components.forEach(r=>{const n=this._find(r),s=n?.widget;S1t(s)&&(s.view=i)})},this._componentsWatcher=(i,r)=>{this._removeComponents(r),this._addComponents(i),this._adjustPadding(i)}}initialize(){this.addHandles([le(()=>this.components,this._componentsWatcher,Zi),le(()=>this.view,this._updateViewAwareWidgets,Zi)])}_add(e,i,r,n,s){let o=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;o=this._createComponent(e)}super._add(o,i,r,n,s)}_removeComponents(e){e.forEach(i=>{const r=this._find(i);r&&(this.remove(r),r.destroy())})}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:i}=this.padding;this.padding=i}}_addComponents(e){this.constructed&&e.forEach(i=>this.add(this._createComponent(i),this._defaultPositionLookup[i]))}_createComponent(e){const i=this._createWidget(e);return new sD({id:e,node:i})}_createWidget(e){const{view:i}=this;switch(e){case"attribution":return new f1t({view:i});case"compass":return new _1t({view:i});case"navigation-toggle":return new v1t({view:i});case"zoom":return new T1t({view:i})}}};h([f()],aD.prototype,"components",void 0),aD=h([z("esri.views.ui.DefaultUI")],aD);const QAe=aD;let lD=class extends QAe{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};h([f()],lD.prototype,"components",void 0),lD=h([z("esri.views.ui.3d.DefaultUI3D")],lD);const e3e=lD;let Be=class extends I8e(gVe(Xze(DVe))){constructor(t){super(t),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._resolveWhenReady=[],this._propertiesPool=new Og({slicePlane:H0e},this),this._resourceController=wut(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new WG({view:this}),this.labeler=new h1({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new eS,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new O1,this.environmentManager=new td,this.floors=new ft,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new kVe({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new Hct,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new e3e,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new JSe,lUe(),t?.environment||(this._defaults.environment=new c2,this.environment=this._defaults.environment);const e=(i=null)=>{i!=null&&i.type===tr.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async r=>{try{await r.when()}catch{}this._updatingChanged()}))};this.addHandles([Io(()=>this.map?.allLayers,"after-changes",i=>e(i),{onListenerAdd:()=>e(),onListenerRemove:()=>e(),sync:!0}),this.allLayerViews.on("after-changes",i=>this._updateUpdatingMonitors(i)),le(()=>this.map,i=>{i&&"load"in i&&i.load&&i.load().catch(()=>{})})]),this.inputManager=new IXe({view:this}),this.stateManager=new Jn({view:this})}initialize(){this.groundView=new nVe({view:this}),this._updateUpdatingMonitors();const t=()=>this._updateDefaultToMapOptions();this.addHandles(Io(()=>this.map?.allLayers,"after-changes",t,{onListenerAdd:t,onListenerRemove:t})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)},Zi),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)},Zi),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,e=>wRe(e>0?1e3/Math.ceil(e):0),Zi),this.updatingHandles.add(()=>this.map?.ground,t,Yi),this.updatingHandles.add(()=>this.map?.ground?.opacity,()=>this._updateDefaultHitTestOptions(),Yi),this.addHandles(le(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),qi))}destroy(){this.destroyed||(this.updatingHandles.removeAll(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=Pe(this.sharedSymbolResources),this._set("labeler",Pe(this.labeler)),this._set("deconflictor",Pe(this.deconflictor)),this._resourceController=Pe(this._resourceController),this._set("stateManager",Pe(this.stateManager)),this._set("inputManager",Pe(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",Pe(this.environmentManager)),this._set("environment",Pe(this.environment)),this.groundView=Pe(this.groundView),this._exitBasemapTerrain(),this._stage?.destroy())}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){return this.basemapTerrain?.spatialReference}get animation(){return this.state?.animation}get camera(){return this.stateManager?.camera}set camera(t){this.stateManager&&(this.stateManager.camera=t)}get contentCamera(){return this.stateManager?.contentCamera}set contentCamera(t){this.stateManager&&(this.stateManager.contentCamera=t)}installContentCameraReset(t={sticky:!1}){return this.stateManager.installContentCameraReset(t)}get center(){return this.stateManager?.center}set center(t){this.stateManager&&(this.stateManager.center=t)}get clippingArea(){if(this.viewingMode==="global")return null;const t=this.map;let e=this._userClippingArea||xJ(t,"clippingArea");return!this._userClippingArea&&!xJ(t,"clippingEnabled")||e==null?(this._clippingArea=null,null):e instanceof Xi?this.spatialReference&&(e=iI(e,this.spatialReference),e==null)?(ne.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(e=e.clone(),e.intersection(this._groundAndLayersExtent)==null&&(e.xmin=e.xmax,e.ymin=e.ymax),e.zmin=void 0,e.zmax=void 0,e.equals(this._clippingArea)||(this._clippingArea=e),this._clippingArea):(ne.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(t){this.ready&&this.viewingMode==="global"&&t!=null?ne.getLogger(this).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=t}get renderDataExtent(){if(this.state.viewingMode===Me.Global)return null;const t=this.renderSpatialReference,e=this.dataExtent;return e==null||t==null||e.spatialReference.equals(t)?e:iI(e,t)}get dataExtent(){let t=this._groundAndLayersExtent;const e=this.spatialReference||je.WGS84,i=iI(this.clippingArea,e);i!=null&&(t=t!=null?t.intersection(i):i);const r=this._get("dataExtent");return t!=null&&t.equals(r)?r:t}get _groundAndLayersExtent(){const t=this.spatialReference||je.WGS84;let e;const i=s=>{const o=iI(s,t);o!=null&&(e!=null?e.union(o):e=o.clone())},r=this.basemapTerrain;if(r?.spatialReference){const s=r.groundExtent;i(new Xi({xmin:s[0],ymin:s[1],zmin:0,xmax:s[2],ymax:s[3],zmax:0,spatialReference:r.spatialReference}))}if(this.map){const s=o=>{o.fullExtent==null||o.type==="graphics"&&o.internal||i(o.fullExtent)};this.map.allLayers.forEach(o=>s(o))}if(e==null)return null;e.hasZ?(e.zmin=Math.min(0,e.zmin??0),e.zmax=Math.max(0,e.zmax??0)):(e.zmin=0,e.zmax=0);const n=this._get("_groundAndLayersExtent");return e.equals(n)?n:e}set environment(t){t!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",t)}castEnvironment(t){return t?t instanceof c2?t:t instanceof HT?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(t):c2.fromWebsceneEnvironment(t):uo(c2,t):new c2}get extent(){return this.stateManager?.extent}set extent(t){this.stateManager&&(this.stateManager.extent=t)}get screenCenter(){return this.stateManager?.screenCenter}get frustum(){return this.stateManager?.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||(this.toolViewManager?.interacting??!1)}get stationary(){return!this.animation&&!this.resizing&&(this.state==null||this.state.stationary)}get navigating(){return this.state?.navigating??!1}get padding(){return this.stateManager?.padding}set padding(t){this.stateManager&&(this.stateManager.padding=t)}set qualityProfile(t){HL.isValidProfile(t)&&(HL.apply(t,this.qualitySettings),this._set("qualityProfile",t))}get qualityProfile(){return this._get("qualityProfile")||HL.getDefaultProfile()}set slicePlane(t){if(this._stage!=null&&this._stage.renderer.setParameters({slicePlane:t}),t==null)return void this._set("slicePlane",null);const e=this._propertiesPool.get("slicePlane");lw(t,e),this._set("slicePlane",e)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?A8e(this.scale,this.spatialReference):0}get scale(){return this.stateManager?.scale}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get heightModelInfo(){const t=this.getDefaultHeightModelInfo();return t!=null?tw.deriveUnitFromSR(t,this.spatialReference):null}get updating(){if(this.destroyed)return!1;let t=0,e=this.layerViewManager.updating,i=e?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(n=>{if(n.isFulfilled()){if(n.updating){if(e=!0,n.suspended||DO(n))return;++i,t+=n.updatingProgress}}else++i});for(const n of this._updatingObjects)n!=null&&n.updating&&(i+=.1,t+=.5*.1);for(const n of this._updatingObjectsWithProgress)n!=null&&n.updating&&(++i,t+=n.updatingProgress);const r=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;if(e=!!(e||i>0||this.updatingHandles.updating||!this.ready||!this.stationary||r||this._createGraphicsViewController||this.inputManager?.updating||this.map?.allLayers?.some(n=>!n.isFulfilled())||this.textures?.updating),e?(this._numUpdating=Math.max(i,this._numUpdating),t+=this._numUpdating-i):this._numUpdating=0,this._numUpdating>0?t/=this._numUpdating:t=e?0:1,this._get("updatingProgress")!==t){const n=performance.now();if(t<1){const s=Math.min((n-this._lastUpdateTime)/2e3,1);t=this.updatingProgress*(1-s)+t*s}this._set("updatingProgress",t),this._lastUpdateTime=e&&t<1?n:0}return e}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){const t=this._predeterminedViewingMode;if(t!=null)return o6(t);const e=this.spatialReference;return e?this.defaultsFromMap?.viewingMode!=null&&e.equals(this.defaultsFromMap.spatialReference)?o6(this.defaultsFromMap.viewingMode):tO(e,Me.Global)?"global":"local":"global"}set viewingMode(t){this.ready?ne.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",t)}get viewpoint(){return this.stateManager?.viewpoint}set viewpoint(t){this.stateManager&&(this.stateManager.viewpoint=t)}get zoom(){return this.stateManager.zoom}set zoom(t){this.stateManager&&(this.stateManager.zoom=t)}get resourceController(){return this._resourceController}get quality(){return this._resourceController?.memoryController?.memoryFactor??1}get resolutionScale(){return Math.sqrt(Math.min(1,this.quality/.75))}get performanceInfo(){return new Yut(this)}on(t,e,i,r){return this.viewEvents.on(t,e,i,r)||super.on(t,e)}hasEventListener(t){return super.hasEventListener(t)||this.viewEvents.hasHandler(t)}toMap(t,e){if(!this.ready)return ne.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;const i=e?this.externalToInternalIntersectOptions(e):this._defaultToMapOptions,r=i.graphics!=null&&(i.graphics.include!=null||i.graphics.exclude!=null),n=qee(t)?Hee(this,t):t,s=Ed(n);i.enableDraped=i.include&&!i.include.has(wy)||i.exclude&&i.exclude.has(wy);const o=this.sceneIntersectionHelper,a=_h(this.state.viewingMode);if(a.options.selectionMode=!0,a.options.store=r?ho.ALL:ho.MIN,o.intersectIntersectorScreen(s,a,i),r){for(const l of a.results.all){const c=Qj(l,this);if(c==null)return this._intersectResultToMapPoint(l);if(c.type!=="graphic"||this._testGraphicUidFilter(i.graphics,c.graphic))return this._intersectResultToMapPoint(l)}return null}return this._intersectResultToMapPoint(a.results.min)}toScreen(t){if(!this.ready)return ne.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;const e=(t.z==null?pf(this.elevationProvider,t):null)??0;return lc(t,Dx,this.renderSpatialReference,e),this.state.camera.projectToScreen(Dx,Dz),ph(Dz[0],Dz[1])}pixelSizeAt(t){return this.ready?t?(lc(t,Dx,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(Dx)):0:(ne.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(t){const e=this.basemapTerrain.overlayManager;return e?e.overlayPixelSizeInMapUnits(t,()=>this.pixelSizeAt(t)):1}hitTest(t,e){if(!this.ready)return ne.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;const i=qee(t)?Hee(this,t):t,r=Zr(i.x,i.y),n=e?this.externalToInternalIntersectOptions(e):this._defaultHitTestOptions;n.requiresGroundFeedback=!0,n.enableDraped=!0;const s=_h(this.state.viewingMode);s.options.selectionMode=!0,s.options.store=ho.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(r,s,n);const o=this._intersectResultsToHits(s.results.all,n.graphics),a=s.results.ground,l=uce(a,this),c=l!=null&&"type"in l&&l.type==="integrated-mesh"?l:null,u={screenPoint:i,results:o,ground:{mapPoint:this._intersectResultToMapPoint(a),distance:ip(a)?a.distanceInRenderSpace:0,layer:c}};return nr.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(u.intersector=s),Promise.resolve(u)}async popupHitTest(t){const{results:e,ground:i}=await s_t(this,t);let r=null;return!(e.length===0||Math.abs((e[0].distance??0)-i.distance)<1e-5)||i.layer&&i.layer.type==="integrated-mesh"||(r=i.mapPoint),{results:e,screenPoint:t,mapPoint:r}}goTo(t,e){return this.updatingHandles.addPromise(this.stateManager.goTo(t,e))}async whenAnalysisView(t){if(t.parent==null)throw new W("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:t});switch(t.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(t.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(t)}}whenLayerView(t){return super.whenLayerView(t)}async takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(e);return Sz(i,e,this._pixelFormat())}async _takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(e);return Ez(i,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(t){const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshotWithOID(e);return[Ez(i[0],this._pixelFormat()),Ez(i[1],this._pixelFormat())]}_completeSettings(t){const e=kyt(t,this);return e.pixelRatio/=this.state.pixelRatio,Vyt(e,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:t=>this._takeScreenshot(t),takeScreenshotWithObjectAndLayerId:t=>this._takeScreenshotWithObjectAndLayerId(t)}}async takeScreenshotWithObjectAndLayerId(t){if(!ie("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshotWithOID(e),r=Sz(i[0],e,this._pixelFormat()),n=this._completeSettings(t);return n.format="png",[r,Sz(i[1],n,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(this._stage.renderView.objectAndLayerIdRenderHelper==null)throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(t){return this.updatingHandles.addPromise(t)}importLayerView(t){return Qee.importLayerView(t)}hasLayerViewModule(t){return Qee.hasLayerViewModule(t)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){return this.map&&"initialViewProperties"in this.map&&this.map.initialViewProperties?.spatialReference||this.defaultsFromMap?.spatialReference||this.defaultsFromMap?.ready&&this._initialDefaultSpatialReference||null}async validate(){let t=m_t(this.type);const e=ie("safari");if(e&&e<9&&(t=new W("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:e})),t!=null)throw ne.getLogger(this).warn("#validate()",t.message),t}get _predeterminedViewingMode(){const t=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties?.viewingMode:null)??null;return t!=null?kK(t):null}getSpatialReferenceSupport({spatialReference:t,layer:e}){const i=this._predeterminedViewingMode;if(i!=null)return this._validateSpatialReferenceForViewingMode(t,e,i)?{constraints:this._makeSpatialReferenceConstraints(t,e,i)}:null;const r=this._validateSpatialReferenceForViewingMode(t,e,Me.Local),n=this._validateSpatialReferenceForViewingMode(t,e,Me.Global);return r||n?r&&n?{constraints:this._makeSpatialReferenceConstraints(t,e,null)}:r?{constraints:this._makeSpatialReferenceConstraints(t,e,Me.Local)}:{constraints:this._makeSpatialReferenceConstraints(t,e,Me.Global)}:null}_validateSpatialReferenceForViewingMode(t,e,i){return!!tO(t,i)&&(e==null||!!dK(e)||(!GA(e)||_k(e,t,i)!=null)&&(!hK(e)||i!==Me.Global))}_makeSpatialReferenceConstraints(t,e,i){if(e==null)return[{spatialReference:t,viewingMode:i}];const r=t.isWebMercator,n=t.isWGS84;return dK(e)&&(r||n)?!n||i===Me.Local||TZ(e.tileInfo,e.fullExtent,t,Me.Global)===null?[{spatialReference:t,viewingMode:i},{spatialReference:je.WebMercator,viewingMode:i}]:[{spatialReference:r?je.WGS84:je.WebMercator,viewingMode:i}]:GA(e)||hK(e)||!r&&!n?GA(e)&&r&&i!==Me.Global?[{spatialReference:t,viewingMode:i},{spatialReference:je.WGS84,viewingMode:Me.Local}]:[{spatialReference:t,viewingMode:i}]:[{spatialReference:t,viewingMode:i},{spatialReference:r?je.WGS84:je.WebMercator,viewingMode:i}]}_validateSpatialReference(t){const e=this.getSpatialReferenceSupport({spatialReference:t})!=null,i=this._predeterminedViewingMode;return e||(i!=null?ne.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${o6(i)} viewing mode.`):t.isGeographic&&ne.getLogger(this).warnOnce("Spatial reference is geographic but not supported.")),e}whenReady(){return new Promise(t=>{this.ready?t(this):this._resolveWhenReady.push(t)})}computeMapPointFromVec3d(t,e){let i=this.spatialReference||je.WGS84;return Do(t,this.renderSpatialReference,t,i)||(i=je.WGS84,Do(t,this.renderSpatialReference,t,i)),e?(e.x=t[0],e.y=t[1],e.z=t[2],e.spatialReference=i):e=new lt(t,i),e}trackGraphicState(t){if(!t.graphic)return ne.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const e=this.getViewForGraphic(t.graphic);let i=null,r=!1;const n=s=>{!r&&s!=null&&"processor"in s&&s.processor?.type==="graphics-3d"&&s.processor.graphicsCore&&(i=s.processor.graphicsCore.trackGraphicState(t))};return e!=null?n(e):this.whenViewForGraphic(t.graphic,{waitForLayer:!0}).then(s=>n(s),()=>{}).catch(()=>{}),Mi(()=>{r=!0,i!=null&&(i.remove(),i=null)})}highlight(t){if(Array.isArray(t))return db(t.map(i=>this.highlight(i)));if(ft.isCollection(t))return db(t.toArray().map(i=>this.highlight(i)));const e=this.getViewForGraphic(t);return e&&"highlight"in e?e.highlight(t):Mi()}maskOccludee(t){if(!t)return ne.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const e=this.getViewForGraphic(t);let i=null,r=!1;const n=s=>{!r&&s!=null&&a_t(s)&&(i=s.maskOccludee(t))};return e!=null?n(e):this.whenViewForGraphic(t,{waitForLayer:!0}).then(s=>n(s),()=>{}).catch(()=>{}),Mi(()=>{r=!0,i!=null&&(i.remove(),i=null)})}getViewForGraphic(t){return t.layer===this.graphics?this.graphicsView:t.layer?this.allLayerViews.find(e=>e.layer===t.layer):null}graphicChanged(t){this.graphicsView!=null&&this.graphicsView.graphicChanged(t)}async whenViewForGraphic(t,e){if(t.layer===this)return await Tg(()=>this.graphicsView),this.graphicsView;if(!t.layer||!this.map)throw new W("no-view-for-graphic");return e&&e.waitForLayer&&!this.map.allLayers.includes(t.layer)?new Promise((i,r)=>{const n=this.map.allLayers.on("change",s=>{s.added.includes(t.layer)&&(n.remove(),this.whenLayerView(t.layer).then(i,r))})}):this.whenLayerView(t.layer)}externalToInternalIntersectOptions(t){const e=this._externalToInternalRenderItems(t.include,D3.INCLUDE),i=this._externalToInternalRenderItems(t.exclude,D3.EXCLUDE);return{include:e.layerUids,exclude:i.layerUids,graphics:{include:e.graphicUids,exclude:i.graphicUids}}}_intersectResultToMapPoint(t,e){return t.getIntersectionPoint(Dx)?(e=this.computeMapPointFromVec3d(Dx,e),t.intersector===Ur.TERRAIN&&this.basemapTerrain&&(e.z=pf(this.basemapTerrain,e)??0),e):null}_intersectResultsToHits(t,e){const i=new Array;let r=null;for(let n=0;n<t.length;n++){const s=t[n],o=uce(s,this);if(o!=null&&(o===this.map.ground||"type"in o&&o.type==="integrated-mesh"))break;const a=Qj(s,this);if(a==null)continue;if(a.type==="graphic"){if(r==null&&n!==t.length-1&&(r=new Set),r!=null){const u=this._getGraphicFilterUid(a.graphic);if(r.has(u))continue;r.add(u)}if(!this._testGraphicUidFilter(e,a.graphic))continue}const l=this._intersectResultToMapPoint(s),c=s.distanceInRenderSpace;if(a.type==="media"){const u=a.element.toSource(l);i.push({...a,mapPoint:l,distance:c,sourcePoint:u})}else i.push({...a,mapPoint:l,distance:c})}return i}_getGraphicFilterUid(t){const e=t.sourceLayer,i=t.layer,r=e&&"objectIdField"in e?e:i&&"objectIdField"in i?i:e;if(r){const n=r.objectIdField??M8e,s=t.attributes?.[n];if(s)return`o-${r.id}-${s}`}return`u-${t.uid}`}_testGraphicUidFilter(t,e){const i=this._getGraphicFilterUid(e);return t==null||(t.include==null||t.include.has(i))&&(t.exclude==null||!t.exclude.has(i))}_externalToInternalRenderItems(t,e,i={layerUids:void 0,graphicUids:void 0}){if(!t)return i;if(t instanceof Lb)E1t(i,this._getGraphicFilterUid(t)),e===D3.INCLUDE&&(this.graphicsView!=null&&t.layer===this?oC(i,this.graphicsView.processor.layer.id):t.layer&&oC(i,t.layer.uid));else if(Zz(t))for(const r of t)r===this.graphics&&this.graphicsView!=null?oC(i,this.graphicsView.processor.layer.id):r===this.map.ground?oC(i,wy):this._externalToInternalRenderItems(r,e,i);else"uid"in t&&oC(i,t.uid);return i}_initBasemapTerrain(){this._set("basemapTerrain",new $ft({view:this})),this._set("elevationProvider",new EA({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new sl({view:this})),this._set("featureTiles",new so({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const t=()=>{const e=this.basemapTerrain?.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const i=this.basemapTerrain.extent!=null&&this.basemapTerrain.spatialReference!=null?Hf(N4(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;this.clippingArea!=null?this.featureTiles.filterExtent=this.clippingArea.intersection(i):this.featureTiles.filterExtent=i}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add(()=>nr.FEATURE_TILE_TREE_SHOW_TILES,e=>{e&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(pe(()=>import("./FeatureTileTree3DDebugger-84a8e654.js"),["./FeatureTileTree3DDebugger-84a8e654.js","./TileTreeDebugger-ee20aa0c.js"],import.meta.url)).then(({FeatureTileTree3DDebugger:i})=>{!this._featureTreeDebugger&&nr.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new i({view:this}))}):e||!this._featureTreeDebugger||nr.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},Yi),this.updatingHandles.add(()=>this.clippingArea,t,Yi),this.updatingHandles.add(()=>this.basemapTerrain.extent,t,Yi)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const t=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(t)||this._set("mapCoordsHelper",new iut(this.map,t));const e=this.state.isGlobal,i=C8e(e,t);i!==this.renderSpatialReference&&(this._set("renderCoordsHelper",out.create(this.state.viewingMode,i)),e||this.addHandles(le(()=>this.basemapTerrain?.extent,r=>{const n=this.renderCoordsHelper.spatialReference;r==null||r[0]===0&&r[1]===0&&r[2]===0&&r[3]===0||!oF(r,this.basemapTerrain.spatialReference,Lce,n)||(this.renderCoordsHelper.extent=Lce)},qi),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(rS/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(t=null){t!=null&&t.type===tr.MOVE||(this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(e=>{e.destroyed||(this.addHandles(le(()=>[e.updating,e.updatingProgress],()=>this._updatingChanged(),qi),"updatingMonitors"),e.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(t,e,i){if(!this.overlay||!this.overlay.hasVisibleItems)return i;const r=t.getContext("2d");return r.putImageData(i,0,0),this.overlay.renderCanvas(t,{disableDecorations:e===Ql.OFF}),r.getImageData(0,0,i.width,i.height)}_initStage(){const t={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(r,n,s)=>this._renderScreenshotOverlay(r,n,s)}},e=new qct(this.state.viewingMode,r=>this._stage.layers.forAll(r),this);this._set("sceneIntersectionHelper",e);const i=sF(this.surface);this._stage=new Mc({view:this,options:t,container:i}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,r=>this._stage.renderer.setParameters({highQualityTransparency:r}),Zi),le(()=>this.magnifier,r=>this._stage.renderView.magnifier=r,Yi),this.on("pointer-move",()=>this._stage?.renderer.resetAnimation()),sg(this._stage.renderView.canvas,"webglcontextlost",r=>this.fatalError=new W("webgl-context-lost",r.statusMessage))],"stage"),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(rS/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=Pe(this._stage),this.removeHandles("stage"),this._set("canvas",null)}_initSurface(t){this._exitSurface(),this.state.init(t,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new Jut({view:this,viewingMode:t,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.removeHandles("graphics-view"),this._createGraphicsViewController=new AbortController;const t=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(t,t),this._updatingChanged()}async _createGraphicsViewAsync(t){const e=(await pe(()=>import("./GraphicsView3D-98edec8f.js"),["./GraphicsView3D-98edec8f.js","./GraphicsProcessor-ef5fbca1.js","./diffUtils-3ed1f592.js","./Query-630c5d65.js","./Graphics3DObjectStates-b80419b4.js","./UniqueValueRenderer-176db886.js","./ColorStop-ac9a118d.js","./colorRamps-cf6fa9ce.js","./jsonUtils-3d6448c4.js","./DictionaryLoader-1a1ab2cc.js","./FieldsIndex-85e142d0.js","./heatmapUtils-3c0e0ece.js","./defaults-4b2d7493.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-717c64bf.js","./PooledRBush-05d409af.js","./quickselect-fc5bb707.js","./popupUtils-049df13a.js"],import.meta.url)).default;Et(t),await Tg(()=>this.basemapTerrain?.ready,t),this._set("graphicsView",new e({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.removeHandles("graphics-view"),this.graphicsView!=null&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const t=kK(this.viewingMode);if(t===Me.Global&&(this._clippingArea=null),this._initSurface(t),this._set("ready",!0),this.addHandles(Io(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const{map:i}=this,r=i&&"initialViewProperties"in i?i.initialViewProperties?.environment:void 0;r&&(this.environment=r)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect(),this._set("textures",new Z2(this._stage,this.resourceController.scheduler));const e=this._resolveWhenReady;this._resolveWhenReady=[],e.forEach(i=>i(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.removeHandles("graphics-view"),this._set("textures",Pe(this.textures)),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(wy);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(t.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(wy);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&t.opacity<1&&this._defaultHitTestOptions.exclude.add(t.uid)}}};function oC(t,e){t.layerUids||(t.layerUids=new Set),t.layerUids.add(e)}function E1t(t,e){t.graphicUids||(t.graphicUids=new Set),t.graphicUids.add(e)}function iI(t,e){return t!=null&&Hd(t.spatialReference,e)?Hf(t,e):null}var D3;Be.type="3d",h([f()],Be.prototype,"_userClippingArea",void 0),h([f()],Be.prototype,"_resourceController",void 0),h([f()],Be.prototype,"_stage",void 0),h([f({readOnly:!0})],Be.prototype,"deconflictor",void 0),h([f({readOnly:!0})],Be.prototype,"labeler",void 0),h([f(YV(eS,"analyses"))],Be.prototype,"analyses",void 0),h([f({type:sS,readOnly:!0})],Be.prototype,"animation",null),h([f({readOnly:!0})],Be.prototype,"basemapTerrain",void 0),h([f({readOnly:!0})],Be.prototype,"elevationProvider",void 0),h([f()],Be.prototype,"camera",null),h([f({type:du})],Be.prototype,"contentCamera",null),h([f({readOnly:!0})],Be.prototype,"canvas",void 0),h([f({type:lt})],Be.prototype,"center",null),h([f({type:Xi})],Be.prototype,"clippingArea",null),h([f({type:O1})],Be.prototype,"constraints",void 0),h([f({type:Xi,readOnly:!0})],Be.prototype,"renderDataExtent",null),h([f({type:Xi,readOnly:!0})],Be.prototype,"dataExtent",null),h([f({type:Xi,readOnly:!0})],Be.prototype,"_groundAndLayersExtent",null),h([f({value:null,type:c2})],Be.prototype,"environment",null),h([rr("environment")],Be.prototype,"castEnvironment",null),h([f({readOnly:!0})],Be.prototype,"environmentManager",void 0),h([f({type:Xi})],Be.prototype,"extent",null),h([f()],Be.prototype,"floors",void 0),h([f()],Be.prototype,"screenCenter",null),h([f()],Be.prototype,"frustum",null),h([f({type:Number,readOnly:!0})],Be.prototype,"fullOpacity",void 0),h([f({readOnly:!0})],Be.prototype,"graphicsView",void 0),h([f({readOnly:!0})],Be.prototype,"analysisViewManager",void 0),h([f()],Be.prototype,"groundView",void 0),h([f({type:Boolean})],Be.prototype,"initialExtentRequired",null),h([f()],Be.prototype,"_defaultsFromMapSettings",null),h([f()],Be.prototype,"interacting",null),h([f()],Be.prototype,"stationary",null),h([f()],Be.prototype,"navigating",null),h([f()],Be.prototype,"map",void 0),h([f({readOnly:!0})],Be.prototype,"mapCoordsHelper",void 0),h([f()],Be.prototype,"padding",null),h([f({type:sl,readOnly:!0})],Be.prototype,"pointsOfInterest",void 0),h([f({type:so,readOnly:!0})],Be.prototype,"featureTiles",void 0),h([f()],Be.prototype,"_featureTreeDebugger",void 0),h([f({type:Boolean})],Be.prototype,"screenSizePerspectiveEnabled",void 0),h([f({constructOnly:!0})],Be.prototype,"deactivatedWebGLExtensions",void 0),h([f({constructOnly:!0})],Be.prototype,"debugWebGLExtensions",void 0),h([f({constructOnly:!0})],Be.prototype,"renderCanvas",void 0),h([f({constructOnly:!0})],Be.prototype,"state",void 0),h([f({readOnly:!0})],Be.prototype,"inputManager",void 0),h([f({readOnly:!0})],Be.prototype,"stateManager",void 0),h([f({type:["low","medium","high"]})],Be.prototype,"qualityProfile",null),h([f({type:toe,get(){let t=this._get("qualitySettings");return t||(t=new toe,HL.apply(this.qualityProfile,t)),t}})],Be.prototype,"qualitySettings",void 0),h([f()],Be.prototype,"slicePlane",null),h([f({readOnly:!0})],Be.prototype,"typeSpecificPreconditionsReady",null),h([f({readOnly:!0})],Be.prototype,"renderCoordsHelper",void 0),h([f({readOnly:!0})],Be.prototype,"sceneIntersectionHelper",void 0),h([f({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],Be.prototype,"resolution",null),h([f({type:Number})],Be.prototype,"scale",null),h([f()],Be.prototype,"heightModelInfo",null),h([f()],Be.prototype,"spatialReference",void 0),h([f({type:Boolean,constructOnly:!0})],Be.prototype,"alphaCompositingEnabled",void 0),h([f({constructOnly:!0})],Be.prototype,"preserveDrawingBufferEnabled",void 0),h([f({type:Boolean})],Be.prototype,"supersampleScreenshotsEnabled",void 0),h([f({readOnly:!0})],Be.prototype,"type",void 0),h([f(),rr(t=>t instanceof QAe?t:MT(e3e,t))],Be.prototype,"ui",void 0),h([f({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.updating","toolViewManager.updating","analysisViewManager.updating","state.updating","textures.updating"]})],Be.prototype,"updating",null),h([f()],Be.prototype,"_updatingObjects",null),h([f()],Be.prototype,"_updatingObjectsWithProgress",null),h([f({type:Number,readOnly:!0,dependsOn:["updating"]})],Be.prototype,"updatingProgress",void 0),h([f({type:["global","local"]})],Be.prototype,"viewingMode",null),h([f({type:oc})],Be.prototype,"viewpoint",null),h([f({type:Number})],Be.prototype,"zoom",null),h([f({type:JSe})],Be.prototype,"highlightOptions",void 0),h([f({readOnly:!0})],Be.prototype,"quality",null),h([f({readOnly:!0})],Be.prototype,"resolutionScale",null),h([f()],Be.prototype,"textures",void 0),Be=h([z("esri.views.SceneView")],Be),function(t){t[t.INCLUDE=0]="INCLUDE",t[t.EXCLUDE=1]="EXCLUDE"}(D3||(D3={}));const Dx=C(),Dz=Zr(),Lce=Gt(),C1t=Be;function A1t(t){return t&&typeof t.render=="function"}function M8t(t){return t&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}let zm=class extends xe{constructor(t){super(t),this._vendorInfo=null,this._fullscreenStyle="width: 100%; height: 100%;",this.view=null,this._errorHandler=this._errorHandler.bind(this),this._stateHandler=this._stateHandler.bind(this)}destroy(){this._removeFullscreenListeners(),this.view=null}get element(){return this.view?.container??null}set element(t){this._override("element",t)}get state(){return this.element?this._isSupported()?this._isActive()?"active":"ready":"feature-unsupported":"disabled"}enter(){this._enterFullscreen()}exit(){this._exitFullscreen()}toggle(){this._isActive()?this._exitFullscreen():this._enterFullscreen()}_isSupported(){this._removeFullscreenListeners();const t=this._getVendorInfo(this.element);return this._addFullscreenListeners(t),this._vendorInfo=t,!!t}_isActive(){return!!this._vendorInfo&&!!document[this._vendorInfo.propertyName]}_stateHandler(){this.notifyChange("state"),this.state==="active"?this._addStyle():this._removeStyle()}_errorHandler(t){ne.getLogger(this).error("fullscreen request failed",t)}_getVendorInfo(t){if(t)return t.requestFullscreen?{enterName:"requestFullscreen",exitName:"exitFullscreen",errorEventName:"fullscreenerror",changeEventName:"fullscreenchange",propertyName:"fullscreen"}:t.webkitRequestFullScreen?{enterName:"webkitRequestFullscreen",exitName:"webkitCancelFullScreen",errorEventName:"webkitfullscreenerror",changeEventName:"webkitfullscreenchange",propertyName:"webkitIsFullScreen"}:t.mozRequestFullScreen?{enterName:"mozRequestFullScreen",exitName:"mozCancelFullScreen",errorEventName:"mozfullscreenerror",changeEventName:"mozfullscreenchange",propertyName:"mozFullScreen"}:void 0}_enterFullscreen(){if(this.state==="feature-unsupported")return void ne.getLogger(this).warn("The fullscreen API is not supported in this browser.");const{element:t}=this;t&&(this._vendorInfo&&t[this._vendorInfo.enterName].call(t),this.notifyChange("state"))}_addStyle(){const{element:t}=this;t&&t.setAttribute("style",this._fullscreenStyle)}_removeStyle(){const{element:t}=this;t&&t.removeAttribute("style")}_exitFullscreen(){if(this.state==="feature-unsupported")return;const{element:t}=this;t&&(this._vendorInfo&&document[this._vendorInfo.exitName].call(document),this.notifyChange("state"))}_addFullscreenListeners(t){t&&(document.addEventListener(t.changeEventName,this._stateHandler),document.addEventListener(t.errorEventName,this._errorHandler))}_removeFullscreenListeners(){const{_vendorInfo:t}=this;t&&(document.removeEventListener(t.changeEventName,this._stateHandler),document.removeEventListener(t.errorEventName,this._errorHandler))}};h([f()],zm.prototype,"element",null),h([f({readOnly:!0})],zm.prototype,"state",null),h([f()],zm.prototype,"view",void 0),h([f()],zm.prototype,"enter",null),h([f()],zm.prototype,"exit",null),h([f()],zm.prototype,"toggle",null),zm=h([z("esri.widgets.Fullscreen.FullscreenViewModel")],zm);const t3e=zm,O1t={base:"esri-fullscreen"};let ef=class extends Xg{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new t3e}get element(){return this.viewModel.element}set element(e){this.viewModel.element=e}get fullscreenTitle(){const e=this.viewModel?.state;return e==="active"?this.messages.exit:e==="ready"?this.messages.enter:""}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e=this.viewModel?.state,{fullscreenTitle:i}=this,r={[ka.disabled]:e==="disabled"||e==="feature-unsupported"};return Ne("div",{"aria-label":i,bind:this,class:this.classes(O1t.base,ka.widget,ka.widgetButton,r),onclick:this._toggle,onkeydown:this._toggle,role:"button",tabIndex:0,title:i},this._renderIcon(),this._renderTitle())}_renderIcon(){const e=this.viewModel?.state,i={[ec.zoomOutFixed]:e==="ready"||e==="disabled"||e==="feature-unsupported",[ec.zoomInFixed]:e==="active"};return Ne("span",{"aria-hidden":"true",class:this.classes(ec.icon,i)})}_renderTitle(){return Ne("span",{class:ec.fontFallbackText},this.fullscreenTitle)}_toggle(){this.viewModel.toggle()}};h([f()],ef.prototype,"element",null),h([f({readOnly:!0})],ef.prototype,"fullscreenTitle",null),h([f()],ef.prototype,"label",null),h([f(),bw("esri/widgets/Fullscreen/t9n/Fullscreen")],ef.prototype,"messages",void 0),h([f()],ef.prototype,"view",null),h([f({type:t3e})],ef.prototype,"viewModel",void 0),h([Rk()],ef.prototype,"_toggle",null),ef=h([z("esri.widgets.Fullscreen")],ef);const R1t=ef;var P1t=Object.defineProperty,M1t=Object.getOwnPropertyDescriptor,$1t=(t,e,i,r)=>{for(var n=r>1?void 0:r?M1t(e,i):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(n=(r?o(e,i,n):o(n))||n);return r&&n&&P1t(e,i,n),n};let VO=class extends Xg{constructor(t){super(t)}};VO=$1t([z("arcgis-core-template..Widget")],VO);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */function I1t(){return navigator.userAgentData}function L1t(){const t=I1t();return t?.brands?t.brands.map(({brand:e,version:i})=>`${e}/${i}`).join(" "):navigator.userAgent}const ww=/firefox/i.test(L1t()),eP=ww?new WeakMap:null;function D1t(){const{disabled:t}=this;t||HTMLElement.prototype.click.call(this)}function i3e(t){const e=t.target;if(ww&&!eP.get(e))return;const{disabled:i}=e;i&&t.preventDefault()}const r3e=["mousedown","mouseup","click"];function n3e(t){if(ww&&!eP.get(t.target))return;const{disabled:e}=t.target;e&&(t.stopImmediatePropagation(),t.preventDefault())}const B5={capture:!0};function N_(t,e=!1){if(t.disabled){t.el.setAttribute("tabindex","-1"),t.el.setAttribute("aria-disabled","true"),t.el.contains(document.activeElement)&&document.activeElement.blur(),s3e(t);return}a3e(t),typeof e=="function"?t.el.setAttribute("tabindex",e.call(t)?"0":"-1"):e===!0?t.el.setAttribute("tabindex","0"):e===!1&&t.el.removeAttribute("tabindex"),t.el.removeAttribute("aria-disabled")}function s3e(t){t.el.click=D1t,N1t(ww?o3e(t):t.el)}function N1t(t){t&&(t.addEventListener("pointerdown",i3e,B5),r3e.forEach(e=>t.addEventListener(e,n3e,B5)))}function o3e(t){return eP.get(t.el)}function a3e(t){delete t.el.click,F1t(ww?o3e(t):t.el)}function F1t(t){t&&(t.removeEventListener("pointerdown",i3e,B5),r3e.forEach(e=>t.removeEventListener(e,n3e,B5)))}function F_(t){if(!t.disabled||!ww)return;const e=t.el.parentElement||t.el;eP.set(t.el,e),s3e(t)}function k_(t){ww&&(eP.delete(t.el),a3e(t))}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const l3e=new WeakMap,c3e=new WeakMap;function Hs(t){c3e.set(t,new Promise(e=>l3e.set(t,e)))}function qs(t){l3e.get(t)()}function k1t(t){return c3e.get(t)}async function Ws(t){return await k1t(t),QS(t),new Promise(e=>requestAnimationFrame(()=>e()))}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */function tP(t){return t==="Enter"||t===" "}const u3e=["0","1","2","3","4","5","6","7","8","9"];/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */function hc(t,e,i){const r=U1t(t);return new r(e,i)}function U1t(t){class e extends window.MutationObserver{constructor(r){super(r),this.observedEntry=[],this.callback=r}observe(r,n){return this.observedEntry.push({target:r,options:n}),super.observe(r,n)}unobserve(r){const n=this.observedEntry.filter(s=>s.target!==r);this.observedEntry=[],this.callback(super.takeRecords(),this),this.disconnect(),n.forEach(s=>this.observe(s.target,s.options))}}return function(){return t==="intersection"?window.IntersectionObserver:t==="mutation"?e:window.ResizeObserver}()}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const z1t=new RegExp("\\.(0+)?$"),B1t=new RegExp("0+$");class Er{constructor(e){if(e instanceof Er)return e;const[i,r]=W1t(e).split(".").concat("");this.value=BigInt(i+r.padEnd(Er.DECIMALS,"0").slice(0,Er.DECIMALS))+BigInt(Er.ROUNDED&&r[Er.DECIMALS]>="5"),this.isNegative=e.charAt(0)==="-"}getIntegersAndDecimals(){const e=this.value.toString().replace("-","").padStart(Er.DECIMALS+1,"0"),i=e.slice(0,-Er.DECIMALS),r=e.slice(-Er.DECIMALS).replace(B1t,"");return{integers:i,decimals:r}}toString(){const{integers:e,decimals:i}=this.getIntegersAndDecimals();return`${this.isNegative?"-":""}${e}${i.length?"."+i:""}`}formatToParts(e){const{integers:i,decimals:r}=this.getIntegersAndDecimals(),n=e.numberFormatter.formatToParts(BigInt(i));return this.isNegative&&n.unshift({type:"minusSign",value:e.minusSign}),r.length&&(n.push({type:"decimal",value:e.decimal}),r.split("").forEach(s=>n.push({type:"fraction",value:s}))),n}format(e){const{integers:i,decimals:r}=this.getIntegersAndDecimals(),n=`${this.isNegative?e.minusSign:""}${e.numberFormatter.format(BigInt(i))}`,s=r.length?`${e.decimal}${r.split("").map(o=>e.numberFormatter.format(Number(o))).join("")}`:"";return`${n}${s}`}add(e){return Er.fromBigInt(this.value+new Er(e).value)}subtract(e){return Er.fromBigInt(this.value-new Er(e).value)}multiply(e){return Er._divRound(this.value*new Er(e).value,Er.SHIFT)}divide(e){return Er._divRound(this.value*Er.SHIFT,new Er(e).value)}}Er.DECIMALS=100;Er.ROUNDED=!0;Er.SHIFT=BigInt("1"+"0".repeat(Er.DECIMALS));Er._divRound=(t,e)=>Er.fromBigInt(t/e+(Er.ROUNDED?t*BigInt(2)/e%BigInt(2):BigInt(0)));Er.fromBigInt=t=>Object.assign(Object.create(Er.prototype),{value:t,isNegative:t<BigInt(0)});function eJ(t){return!(!t||isNaN(Number(t)))}function I8t(t){return!t||!Y1t(t)?"":V5(t,e=>{let i=!1;const r=e.split("").filter((n,s)=>n.match(/\./g)&&!i?(i=!0,!0):n.match(/\-/g)&&s===0?!0:u3e.includes(n)).join("");return eJ(r)?new Er(r).toString():""})}const h3e=/^([-0])0+(?=\d)/,V1t=/(?!^\.)\.$/,G1t=/(?!^-)-/g,j1t=/^-\b0\b\.?0*$/,H1t=/0*$/,L8t=t=>V5(t,e=>{const i=e.replace(G1t,"").replace(V1t,"").replace(h3e,"$1");return eJ(i)?j1t.test(i)?i:q1t(i):e});function q1t(t){const e=t.split(".")[1],i=new Er(t).toString(),[r,n]=i.split(".");return e&&n!==e?`${r}.${e}`:i}function V5(t,e){if(!t)return t;const i=t.toLowerCase().indexOf("e")+1;return i?t.replace(/[eE]*$/g,"").substring(0,i).concat(t.slice(i).replace(/[eE]/g,"")).split(/[eE]/).map((r,n)=>e(n===1?r.replace(/\./g,""):r)).join("e").replace(/^e/,"1e"):e(t)}function W1t(t){const e=t.split(/[eE]/);if(e.length===1)return t;const i=+t;if(Number.isSafeInteger(i))return`${i}`;const r=t.charAt(0)==="-",n=+e[1],s=e[0].split("."),o=(r?s[0].substring(1):s[0])||"",a=s[1]||"",l=(d,p)=>{const m=Math.abs(p)-d.length,y=m>0?`${"0".repeat(m)}${d}`:d;return`${y.slice(0,p)}.${y.slice(p)}`},c=(d,p)=>{const m=p>d.length?`${d}${"0".repeat(p-d.length)}`:d;return`${m.slice(0,p)}.${m.slice(p)}`},u=n>0?`${o}${c(a,n)}`:`${l(o,n)}${a}`;return`${r?"-":""}${u.charAt(0)==="."?"0":""}${u.replace(z1t,"").replace(h3e,"")}`}function Y1t(t){return u3e.some(e=>t.includes(e))}function D8t(t,e,i){const r=e.split(".")[1];if(r){const n=r.match(H1t)[0];if(n&&i.delocalize(t).length!==e.length&&r.indexOf("e")===-1){const s=i.decimal;return t=t.includes(s)?t:`${t}${s}`,t.padEnd(t.length+n.length,i.localize("0"))}}return t}const b_="en",X1t=["ar","bg","bs","ca","cs","da","de","el",b_,"es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","no","nl","pl","pt-BR","pt-PT","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-CN","zh-HK","zh-TW"],Z1t=["ar","bg","bs","ca","cs","da","de","de-AT","de-CH","el",b_,"en-AU","en-CA","en-GB","es","es-MX","et","fi","fr","fr-CH","he","hi","hr","hu","id","it","it-CH","ja","ko","lt","lv","mk","no","nl","pl","pt","pt-PT","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-CN","zh-HK","zh-TW"],J1t=["arab","arabext","bali","beng","deva","fullwide","gujr","guru","hanidec","khmr","knda","laoo","latn","limb","mlym","mong","mymr","orya","tamldec","telu","thai","tibt"],d3e=t=>J1t.includes(t),Nz=new Intl.NumberFormat().resolvedOptions().numberingSystem,p3e=Nz==="arab"||!d3e(Nz)?"latn":Nz,K1t=t=>d3e(t)?t:p3e;function f3e(t,e="cldr"){const i=e==="cldr"?Z1t:X1t;return t?i.includes(t)?t:(t=t.toLowerCase(),t==="nb"?"no":e==="t9n"&&t==="pt"?"pt-BR":(t.includes("-")&&(t=t.replace(/(\w+)-(\w+)/,(r,n,s)=>`${n}-${s.toUpperCase()}`),i.includes(t)||(t=t.split("-")[0])),t==="zh"?"zh-CN":i.includes(t)?t:(console.warn(`Translations for the "${t}" locale are not available and will fall back to the default, English (en).`),b_))):b_}const GO=new Set;function yu(t){Q1t(t),GO.size===0&&m3e?.observe(document.documentElement,{attributes:!0,attributeFilter:["lang"],subtree:!0}),GO.add(t)}function Q1t(t){t.effectiveLocale=ebt(t)}function _u(t){GO.delete(t),GO.size===0&&m3e.disconnect()}const m3e=hc("mutation",t=>{t.forEach(e=>{const i=e.target;GO.forEach(r=>{if(!zvt(i,r.el))return;const s=vw(r.el,"[lang]");if(!s){r.effectiveLocale=b_;return}const o=s.lang;r.effectiveLocale=s.hasAttribute("lang")&&o===""?b_:o})})});function ebt(t){return t.el.lang||vw(t.el,"[lang]")?.lang||document.documentElement.lang||b_}class tbt{constructor(){this.delocalize=e=>this._numberFormatOptions?V5(e,i=>i.replace(new RegExp(`[${this._minusSign}]`,"g"),"-").replace(new RegExp(`[${this._group}]`,"g"),"").replace(new RegExp(`[${this._decimal}]`,"g"),".").replace(new RegExp(`[${this._digits.join("")}]`,"g"),this._getDigitIndex)):e,this.localize=e=>this._numberFormatOptions?V5(e,i=>eJ(i.trim())?new Er(i.trim()).format(this).replace(new RegExp(`[${this._actualGroup}]`,"g"),this._group):i):e}get group(){return this._group}get decimal(){return this._decimal}get minusSign(){return this._minusSign}get digits(){return this._digits}get numberFormatter(){return this._numberFormatter}get numberFormatOptions(){return this._numberFormatOptions}set numberFormatOptions(e){if(e.locale=f3e(e?.locale),e.numberingSystem=K1t(e?.numberingSystem),!this._numberFormatOptions&&e.locale===b_&&e.numberingSystem===p3e&&Object.keys(e).length===2||JSON.stringify(this._numberFormatOptions)===JSON.stringify(e))return;this._numberFormatOptions=e,this._numberFormatter=new Intl.NumberFormat(this._numberFormatOptions.locale,this._numberFormatOptions),this._digits=[...new Intl.NumberFormat(this._numberFormatOptions.locale,{useGrouping:!1,numberingSystem:this._numberFormatOptions.numberingSystem}).format(9876543210)].reverse();const i=new Map(this._digits.map((n,s)=>[n,s])),r=new Intl.NumberFormat(this._numberFormatOptions.locale,{numberingSystem:this._numberFormatOptions.numberingSystem}).formatToParts(-123456789e-1);this._actualGroup=r.find(n=>n.type==="group").value,this._group=this._actualGroup.trim().length===0||this._actualGroup==" "?" ":this._actualGroup,this._decimal=r.find(n=>n.type==="decimal").value,this._minusSign=r.find(n=>n.type==="minusSign").value,this._getDigitIndex=n=>i.get(n)}}const N3=new tbt;/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const rI={};async function ibt(t,e){const i=`${e}_${t}`;return rI[i]||(rI[i]=fetch(XZ(`./assets/${e}/t9n/messages_${t}.json`)).then(r=>(r.ok||Dce(),r.json())).catch(()=>Dce())),rI[i]}function Dce(){throw new Error("could not fetch component message bundle")}function tJ(t){t.messages={...t.defaultMessages,...t.messageOverrides}}async function Oh(t){t.defaultMessages=await g3e(t,t.effectiveLocale),tJ(t)}async function g3e(t,e){const{el:i}=t,n=i.tagName.toLowerCase().replace("calcite-","");return ibt(f3e(e,"t9n"),n)}async function Rh(t,e){t.defaultMessages=await g3e(t,e),tJ(t)}function Ph(t){t.onMessagesChange=rbt}function Mh(t){t.onMessagesChange=void 0}function rbt(){tJ(this)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const nbt={icon:"icon",flipRtl:"flip-rtl"},Fz={},kz={},y3e={s:16,m:24,l:32};async function sbt({icon:t,scale:e}){const i=y3e[e],r=obt(t),n=r.charAt(r.length-1)==="F",o=`${n?r.substring(0,r.length-1):r}${i}${n?"F":""}`;if(Fz[o])return Fz[o];kz[o]||(kz[o]=fetch(XZ(`./assets/icon/${o}.json`)).then(l=>l.json()).catch(()=>(console.error(`"${o}" is not a valid calcite-ui-icon name`),"")));const a=await kz[o];return Fz[o]=a,a}function obt(t){const e=!isNaN(Number(t.charAt(0))),i=t.split("-");if(i.length>0){const n=/[a-z]/i;t=i.map((s,o)=>s.replace(n,function(l,c){return o===0&&c===0?l:l.toUpperCase()})).join("")}return e?`i${t}`:t}const abt=":host{display:inline-flex;color:var(--calcite-ui-icon-color)}:host([scale=s]){block-size:1rem;inline-size:1rem;min-inline-size:1rem;min-block-size:1rem}:host([scale=m]){block-size:1.5rem;inline-size:1.5rem;min-inline-size:1.5rem;min-block-size:1.5rem}:host([scale=l]){block-size:2rem;inline-size:2rem;min-inline-size:2rem;min-block-size:2rem}.flip-rtl{transform:scaleX(-1)}.svg{display:block}:host([hidden]){display:none}[hidden]{display:none}",lbt=ln(class extends cn{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.icon=null,this.flipRtl=!1,this.scale="m",this.textLabel=void 0,this.pathData=void 0,this.visible=!1}connectedCallback(){this.waitUntilVisible(()=>{this.visible=!0,this.loadIconPathData()})}disconnectedCallback(){this.intersectionObserver?.disconnect(),this.intersectionObserver=null}async componentWillLoad(){this.loadIconPathData()}render(){const{el:t,flipRtl:e,pathData:i,scale:r,textLabel:n}=this,s=eE(t),o=y3e[r],a=!!n,l=[].concat(i||"");return H(yo,{"aria-hidden":oa(!a),"aria-label":a?n:null,role:a?"img":null},H("svg",{"aria-hidden":"true",class:{[nbt.flipRtl]:s==="rtl"&&e,svg:!0},fill:"currentColor",height:"100%",viewBox:`0 0 ${o} ${o}`,width:"100%",xmlns:"http://www.w3.org/2000/svg"},l.map(c=>typeof c=="string"?H("path",{d:c}):H("path",{d:c.d,opacity:"opacity"in c?c.opacity:1}))))}async loadIconPathData(){const{icon:t,scale:e,visible:i}=this;!t||!i||(this.pathData=await sbt({icon:t,scale:e}))}waitUntilVisible(t){if(this.intersectionObserver=hc("intersection",e=>{e.forEach(i=>{i.isIntersecting&&(this.intersectionObserver.disconnect(),this.intersectionObserver=null,t())})},{rootMargin:"50px"}),!this.intersectionObserver){t();return}this.intersectionObserver.observe(this.el)}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{icon:["loadIconPathData"],scale:["loadIconPathData"]}}static get style(){return abt}},[1,"calcite-icon",{icon:[513],flipRtl:[516,"flip-rtl"],scale:[513],textLabel:[1,"text-label"],pathData:[32],visible:[32]}]);function Ba(){if(typeof customElements>"u")return;["calcite-icon"].forEach(e=>{switch(e){case"calcite-icon":customElements.get(e)||customElements.define(e,lbt);break}})}Ba();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const cbt='@charset "UTF-8";@media (prefers-reduced-motion: reduce){:root{--calcite-internal-duration-factor:0}}:host{position:relative;margin-inline:auto;display:none;align-items:center;justify-content:center;opacity:1;min-block-size:var(--calcite-loader-size);font-size:var(--calcite-loader-font-size);stroke:var(--calcite-ui-brand);stroke-width:3;fill:none;transform:scale(1, 1);animation:loader-color-shift calc(var(--calcite-internal-animation-timing-slow) / var(--calcite-internal-duration-factor) * 2 / var(--calcite-internal-duration-factor)) alternate-reverse infinite linear;padding-block:var(--calcite-loader-padding, 4rem)}:host([scale=s]){--calcite-loader-font-size:var(--calcite-font-size--2);--calcite-loader-size:2rem;--calcite-loader-size-inline:0.75rem}:host([scale=m]){--calcite-loader-font-size:var(--calcite-font-size-0);--calcite-loader-size:4rem;--calcite-loader-size-inline:1rem}:host([scale=l]){--calcite-loader-font-size:var(--calcite-font-size-2);--calcite-loader-size:6rem;--calcite-loader-size-inline:1.5rem}:host([no-padding]){padding-block:0px}:host{display:flex}.loader__text{display:block;text-align:center;font-size:var(--calcite-font-size--2);line-height:1rem;color:var(--calcite-ui-text-1);margin-block-start:calc(var(--calcite-loader-size) + 1.5rem)}.loader__percentage{position:absolute;display:block;text-align:center;color:var(--calcite-ui-text-1);font-size:var(--calcite-loader-font-size);inline-size:var(--calcite-loader-size);inset-inline-start:50%;margin-inline-start:calc(var(--calcite-loader-size) / 2 * -1);line-height:0.25;transform:scale(1, 1)}.loader__svgs{position:absolute;overflow:visible;opacity:1;inline-size:var(--calcite-loader-size);block-size:var(--calcite-loader-size);inset-inline-start:50%;margin-inline-start:calc(var(--calcite-loader-size) / 2 * -1);animation-iteration-count:infinite;animation-timing-function:linear;animation-duration:calc(var(--calcite-internal-animation-timing-slow) / var(--calcite-internal-duration-factor) * 6.66 / var(--calcite-internal-duration-factor));animation-name:loader-clockwise}.loader__svg{position:absolute;inset-block-start:0px;transform-origin:center;overflow:visible;inset-inline-start:0;inline-size:var(--calcite-loader-size);block-size:var(--calcite-loader-size);animation-iteration-count:infinite;animation-timing-function:linear}@supports (display: grid){.loader__svg--1{animation-name:loader-offset-1}.loader__svg--2{animation-name:loader-offset-2}.loader__svg--3{animation-name:loader-offset-3}}:host([type=determinate]){animation:none;stroke:var(--calcite-ui-border-3)}:host([type=determinate]) .loader__svgs{animation:none}:host([type=determinate]) .loader__svg--3{animation:none;stroke:var(--calcite-ui-brand);stroke-dasharray:150.79632;transform:rotate(-90deg);transition:all var(--calcite-internal-animation-timing-fast) linear}:host([inline]){position:relative;margin:0px;animation:none;stroke:currentColor;stroke-width:2;padding-block:0px;block-size:var(--calcite-loader-size-inline);min-block-size:var(--calcite-loader-size-inline);inline-size:var(--calcite-loader-size-inline);margin-inline-end:calc(var(--calcite-loader-size-inline) * 0.5);vertical-align:calc(var(--calcite-loader-size-inline) * -1 * 0.2)}:host([inline]) .loader__svgs{inset-block-start:0px;margin:0px;inset-inline-start:0;inline-size:var(--calcite-loader-size-inline);block-size:var(--calcite-loader-size-inline)}:host([inline]) .loader__svg{inline-size:var(--calcite-loader-size-inline);block-size:var(--calcite-loader-size-inline)}:host([complete]){opacity:0;transform:scale(0.75, 0.75);transform-origin:center;transition:opacity var(--calcite-internal-animation-timing-medium) linear 1000ms, transform var(--calcite-internal-animation-timing-medium) linear 1000ms}:host([complete]) .loader__svgs{opacity:0;transform:scale(0.75, 0.75);transform-origin:center;transition:opacity calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms}:host([complete]) .loader__percentage{color:var(--calcite-ui-brand);transform:scale(1.05, 1.05);transform-origin:center;transition:color var(--calcite-internal-animation-timing-medium) linear, transform var(--calcite-internal-animation-timing-medium) linear}.loader__svg--1{stroke-dasharray:27.9252444444 139.6262222222;animation-duration:calc(var(--calcite-internal-animation-timing-slow) / var(--calcite-internal-duration-factor) * 4.8 / var(--calcite-internal-duration-factor))}@keyframes loader-offset-1{0%{stroke-dasharray:27.9252444444 251.3272;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222 139.6262222222;stroke-dashoffset:-83.7757333333}100%{stroke-dasharray:27.9252444444 251.3272;stroke-dashoffset:-279.2524444444}}.loader__svg--2{stroke-dasharray:55.8504888889 139.6262222222;animation-duration:calc(var(--calcite-internal-animation-timing-slow) / var(--calcite-internal-duration-factor) * 6.4 / var(--calcite-internal-duration-factor))}@keyframes loader-offset-2{0%{stroke-dasharray:55.8504888889 223.4019555556;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222 139.6262222222;stroke-dashoffset:-97.7383555556}100%{stroke-dasharray:55.8504888889 223.4019555556;stroke-dashoffset:-279.2524444444}}.loader__svg--3{stroke-dasharray:13.9626222222 139.6262222222;animation-duration:calc(var(--calcite-internal-animation-timing-slow) / var(--calcite-internal-duration-factor) * 7.734 / var(--calcite-internal-duration-factor))}@keyframes loader-offset-3{0%{stroke-dasharray:13.9626222222 265.2898222222;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222 139.6262222222;stroke-dashoffset:-76.7944222222}100%{stroke-dasharray:13.9626222222 265.2898222222;stroke-dashoffset:-279.2524444444}}@keyframes loader-color-shift{0%{stroke:var(--calcite-ui-brand)}33%{stroke:var(--calcite-ui-brand-press)}66%{stroke:var(--calcite-ui-brand-hover)}100%{stroke:var(--calcite-ui-brand)}}@keyframes loader-clockwise{100%{transform:rotate(360deg)}}:host([hidden]){display:none}[hidden]{display:none}',ubt=ln(class extends cn{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.inline=!1,this.label=void 0,this.scale="m",this.type=void 0,this.value=0,this.text=""}render(){const{el:t,inline:e,label:i,scale:r,text:n,type:s,value:o}=this,a=t.id||_w(),l=.45,c=e?this.getInlineSize(r):this.getSize(r),u=c*l,d=`0 0 ${c} ${c}`,p=s==="determinate",m=2*u*Math.PI,y=o/100*m,_=m-y,v=Math.floor(o),w={"aria-valuenow":v,"aria-valuemin":0,"aria-valuemax":100,complete:v===100},x={r:u,cx:c/2,cy:c/2},T={"stroke-dasharray":`${y} ${_}`};return H(yo,{"aria-label":i,id:a,role:"progressbar",...p?w:{}},H("div",{class:"loader__svgs"},H("svg",{"aria-hidden":"true",class:"loader__svg loader__svg--1",viewBox:d},H("circle",{...x})),H("svg",{"aria-hidden":"true",class:"loader__svg loader__svg--2",viewBox:d},H("circle",{...x})),H("svg",{"aria-hidden":"true",class:"loader__svg loader__svg--3",viewBox:d,...p?{style:T}:{}},H("circle",{...x}))),n&&H("div",{class:"loader__text"},n),p&&H("div",{class:"loader__percentage"},o))}getSize(t){return{s:32,m:56,l:80}[t]}getInlineSize(t){return{s:12,m:16,l:20}[t]}get el(){return this}static get style(){return cbt}},[1,"calcite-loader",{inline:[516],label:[1],scale:[513],type:[513],value:[2],text:[1]}]);function em(){if(typeof customElements>"u")return;["calcite-loader"].forEach(e=>{switch(e){case"calcite-loader":customElements.get(e)||customElements.define(e,ubt);break}})}em();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const vm={button:"button",buttonTextVisible:"button--text-visible",buttonCompact:"button--compact",indicatorText:"indicator-text",iconContainer:"icon-container",slotContainer:"slot-container",slotContainerHidden:"slot-container--hidden",textContainer:"text-container",textContainerVisible:"text-container--visible"},hbt={tooltip:"tooltip"},dbt=`:host{box-sizing:border-box;background-color:var(--calcite-ui-foreground-1);color:var(--calcite-ui-text-2);font-size:var(--calcite-font-size--1)}:host *{box-sizing:border-box}:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-ui-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:flex;background-color:transparent;--calcite-action-indicator-color:var(--calcite-ui-brand)}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.button{position:relative;margin:0px;display:flex;inline-size:auto;cursor:pointer;align-items:center;justify-content:flex-start;border-style:none;background-color:var(--calcite-ui-foreground-1);fill:var(--calcite-ui-text-3);font-family:var(--calcite-sans-family);font-size:var(--calcite-font-size--2);line-height:1rem;font-weight:var(--calcite-font-weight-medium);color:var(--calcite-ui-text-3);outline-color:transparent;text-align:unset;flex:1 0 auto}.button:hover{background-color:var(--calcite-ui-foreground-2);fill:var(--calcite-ui-text-1);color:var(--calcite-ui-text-1)}.button:focus{background-color:var(--calcite-ui-foreground-2);fill:var(--calcite-ui-text-1);color:var(--calcite-ui-text-1);outline:2px solid var(--calcite-ui-focus-color, var(--calcite-ui-brand));outline-offset:calc(
            -2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-ui-focus-offset-invert),
                1
              )
            )
          )}.button:active{background-color:var(--calcite-ui-foreground-3)}.button .icon-container{pointer-events:none;margin:0px;display:flex;align-items:center;justify-content:center;min-inline-size:1rem;min-block-size:1rem}.button .text-container{margin:0px;inline-size:0px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;line-height:1.5rem;opacity:0;transition-property:opacity;transition-duration:150ms;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-property:margin;transition-property:inline-size}.button .text-container--visible{inline-size:auto;flex:1 1 auto;opacity:1;margin-inline-end:1rem}:host([scale=s]) .button{padding-inline:0.5rem;padding-block:0.25rem;font-size:var(--calcite-font-size--2);line-height:1rem;font-weight:var(--calcite-font-weight-normal)}:host([scale=s]) .button--text-visible .icon-container{margin-inline-end:0.5rem}:host([scale=m]) .button{padding-inline:1rem;padding-block:0.75rem;font-size:var(--calcite-font-size--1);line-height:1rem;font-weight:var(--calcite-font-weight-normal)}:host([scale=m]) .button--text-visible .icon-container{margin-inline-end:0.75rem}:host([scale=l]) .button{padding:1.25rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;font-weight:var(--calcite-font-weight-normal)}:host([scale=l]) .button--text-visible .icon-container{margin-inline-end:1rem}:host([alignment=center]) .button{justify-content:center}:host([alignment=end]) .button{justify-content:flex-end}:host([alignment=center]) .button .text-container--visible,:host([alignment=end]) .button .text-container--visible{flex:0 1 auto}:host([scale=s][compact]) .button,:host([scale=m][compact]) .button,:host([scale=l][compact]) .button{padding-inline:0px}.slot-container{display:flex}.slot-container--hidden{display:none}.button--text-visible{inline-size:100%}:host([active]) .button,:host([active]) .button:hover,:host([active]) .button:focus,:host([active][loading]) .button{background-color:var(--calcite-ui-foreground-3);fill:var(--calcite-ui-text-1);color:var(--calcite-ui-text-1)}:host([active]) .button:active{background-color:var(--calcite-ui-foreground-1)}:host([appearance=transparent]) .button{background-color:transparent;transition-property:box-shadow;transition-duration:150ms;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1)}:host([appearance=transparent]) .button:hover,:host([appearance=transparent]) .button:focus{background-color:transparent;box-shadow:0 0 0 2px var(--calcite-ui-border-1) inset}:host([active][appearance=transparent]) .button,:host([active][appearance=transparent]) .button:hover,:host([active][appearance=transparent]) .button:focus{background-color:var(--calcite-ui-foreground-3);fill:var(--calcite-ui-text-1);color:var(--calcite-ui-text-1)}:host([appearance=transparent][loading]) .button,:host([appearance=transparent][disabled]) .button{background-color:transparent}:host([loading]) .button,:host([loading]) .button:hover,:host([loading]) .button:focus{background-color:var(--calcite-ui-foreground-1)}:host([loading]) .button .text-container,:host([loading]) .button:hover .text-container,:host([loading]) .button:focus .text-container{opacity:var(--calcite-ui-opacity-disabled)}:host([loading]) calcite-loader[inline]{color:var(--calcite-ui-text-3);margin-inline-end:0px}:host([disabled]) .button,:host([disabled]) .button:hover,:host([disabled]) .button:focus{cursor:default;background-color:var(--calcite-ui-foreground-1);opacity:var(--calcite-ui-opacity-disabled)}:host([disabled][active]) .button,:host([disabled][active]) .button:hover,:host([disabled][active]) .button:focus{background-color:var(--calcite-ui-foreground-3);opacity:var(--calcite-ui-opacity-disabled)}:host([indicator]) .button::after{content:"";position:absolute;block-size:0.5rem;inline-size:0.5rem;border-radius:9999px;border-width:2px;background-color:var(--calcite-action-indicator-color);border-color:var(--calcite-ui-foreground-1);inset-block-end:0.75rem;inset-inline-end:0.75rem}:host([indicator]) .button--text-visible::after{inset-block-end:auto}:host([indicator]) .button:hover::after,:host([indicator]) .button:focus::after{border-color:var(--calcite-ui-foreground-1)}:host([indicator][scale=s]) .button::after{inset-block-end:0.25rem;inset-inline-end:0.25rem}:host([indicator][scale=s]) .button--text-visible::after{inset-block-end:auto;inset-inline-end:0.5rem}:host([indicator][active]) .button::after{border-color:var(--calcite-ui-foreground-3)}.indicator-text{position:absolute;inline-size:1px;block-size:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}:host([hidden]){display:none}[hidden]{display:none}`,pbt=ln(class extends cn{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.mutationObserver=hc("mutation",()=>QS(this)),this.guid=`calcite-action-${_w()}`,this.indicatorId=`${this.guid}-indicator`,this.buttonId=`${this.guid}-button`,this.handleTooltipSlotChange=t=>{const i=t.target.assignedElements({flatten:!0}).filter(r=>r?.matches("calcite-tooltip"))[0];i&&(i.referenceElement=this.buttonEl)},this.active=!1,this.alignment=void 0,this.appearance="solid",this.compact=!1,this.disabled=!1,this.icon=void 0,this.iconFlipRtl=!1,this.indicator=!1,this.label=void 0,this.loading=!1,this.scale="m",this.text=void 0,this.textEnabled=!1,this.messages=void 0,this.messageOverrides=void 0,this.effectiveLocale="",this.defaultMessages=void 0}onMessagesChange(){}effectiveLocaleChange(){Rh(this,this.effectiveLocale)}connectedCallback(){F_(this),yu(this),Ph(this),this.mutationObserver?.observe(this.el,{childList:!0,subtree:!0})}async componentWillLoad(){Hs(this),await Oh(this)}componentDidLoad(){qs(this)}disconnectedCallback(){k_(this),_u(this),Mh(this),this.mutationObserver?.disconnect()}componentDidRender(){N_(this)}async setFocus(){await Ws(this),this.buttonEl?.focus()}renderTextContainer(){const{text:t,textEnabled:e}=this,i={[vm.textContainer]:!0,[vm.textContainerVisible]:e};return t?H("div",{class:i,key:"text-container"},t):null}renderIndicatorText(){const{indicator:t,messages:e,indicatorId:i,buttonId:r}=this;return H("div",{"aria-labelledby":r,"aria-live":"polite",class:vm.indicatorText,id:i,role:"region"},t?e.indicator:null)}renderIconContainer(){const{loading:t,icon:e,scale:i,el:r,iconFlipRtl:n}=this,s=i==="l"?"m":"s",o=i==="l"?"l":"m",a=t?H("calcite-loader",{inline:!0,label:this.messages.loading,scale:o}):null,l=e?H("calcite-icon",{flipRtl:n,icon:e,scale:s}):null,c=a||l,u=c||r.children?.length,d=H("div",{class:{[vm.slotContainer]:!0,[vm.slotContainerHidden]:t}},H("slot",null));return u?H("div",{"aria-hidden":"true",class:vm.iconContainer,key:"icon-container"},c,d):null}render(){const{active:t,compact:e,disabled:i,loading:r,textEnabled:n,label:s,text:o,indicator:a,indicatorId:l,buttonId:c,messages:u}=this,d=`${s||o}${a?` (${u.indicator})`:""}`,p={[vm.button]:!0,[vm.buttonTextVisible]:n,[vm.buttonCompact]:e};return H(yo,null,H("button",{"aria-busy":oa(r),"aria-controls":a?l:null,"aria-disabled":oa(i),"aria-label":d,"aria-pressed":oa(t),class:p,disabled:i,id:c,ref:m=>this.buttonEl=m},this.renderIconContainer(),this.renderTextContainer()),H("slot",{name:hbt.tooltip,onSlotchange:this.handleTooltipSlotChange}),this.renderIndicatorText())}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{messageOverrides:["onMessagesChange"],effectiveLocale:["effectiveLocaleChange"]}}static get style(){return dbt}},[1,"calcite-action",{active:[516],alignment:[513],appearance:[513],compact:[516],disabled:[516],icon:[1],iconFlipRtl:[516,"icon-flip-rtl"],indicator:[516],label:[1],loading:[516],scale:[513],text:[1],textEnabled:[516,"text-enabled"],messages:[1040],messageOverrides:[1040],effectiveLocale:[32],defaultMessages:[32],setFocus:[64]}]);function xw(){if(typeof customElements>"u")return;["calcite-action","calcite-icon","calcite-loader"].forEach(e=>{switch(e){case"calcite-action":customElements.get(e)||customElements.define(e,pbt);break;case"calcite-icon":customElements.get(e)||Ba();break;case"calcite-loader":customElements.get(e)||em();break}})}xw();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */(function(t){if(typeof t.requestSubmit=="function")return;t.requestSubmit=function(r){r?(e(r,this),r.click()):(r=document.createElement("input"),r.type="submit",r.hidden=!0,this.appendChild(r),r.click(),this.removeChild(r))};function e(r,n){r instanceof HTMLElement||i(TypeError,"parameter 1 is not of type 'HTMLElement'"),r.type=="submit"||i(TypeError,"The specified element is not a submit button"),r.form==n||i(DOMException,"The specified element is not owned by this form element","NotFoundError")}function i(r,n,s){throw new r("Failed to execute 'requestSubmit' on 'HTMLFormElement': "+n+".",s)}})(HTMLFormElement.prototype);const sH="hidden-form-input";function iJ(t){return"checked"in t}const oH=new WeakMap,rJ=new WeakSet;function fbt(t,e){if(vw(e.parentElement,"[form]"))return!0;const r="calciteInternalFormComponentRegister";let n=!1;return t.addEventListener(r,s=>{n=s.composedPath().some(o=>rJ.has(o)),s.stopPropagation()},{once:!0}),e.dispatchEvent(new CustomEvent(r,{bubbles:!0,composed:!0})),n}function mbt(t){const{formEl:e}=t;return e?(e.requestSubmit(),!0):!1}function gbt(t){t.formEl?.reset()}function Pk(t){const{el:e,value:i}=t,r=_3e(t);if(!r||fbt(r,e))return;t.formEl=r,t.defaultValue=i,iJ(t)&&(t.defaultChecked=t.checked);const n=(t.onFormReset||ybt).bind(t);r.addEventListener("reset",n),oH.set(t.el,n),rJ.add(e)}function _3e(t){const{el:e,form:i}=t;return i?QZ(e,{id:i}):vw(e,"form")}function ybt(){if(iJ(this)){this.checked=this.defaultChecked;return}this.value=this.defaultValue}function Mk(t){const{el:e,formEl:i}=t;if(!i)return;const r=oH.get(e);i.removeEventListener("reset",r),oH.delete(e),t.formEl=null,rJ.delete(e)}function v3e(t,e){t.defaultValue=e}const b3e=t=>{t.target.dispatchEvent(new CustomEvent("calciteInternalHiddenInputChange",{bubbles:!0}))},Nce=t=>t.removeEventListener("change",b3e);function _bt(t){const{el:e,formEl:i,name:r,value:n}=t,{ownerDocument:s}=e,o=e.querySelectorAll(`input[slot="${sH}"]`);if(!i||!r){o.forEach(d=>{Nce(d),d.remove()});return}const a=Array.isArray(n)?n:[n],l=[],c=new Set;o.forEach(d=>{const p=a.find(m=>m==d.value);p!=null?(c.add(p),Fce(t,d,p)):l.push(d)});let u;a.forEach(d=>{if(c.has(d))return;let p=l.pop();p||(p=s.createElement("input"),p.slot=sH),u||(u=s.createDocumentFragment()),u.append(p),p.addEventListener("change",b3e),Fce(t,p,d)}),u&&e.append(u),l.forEach(d=>{Nce(d),d.remove()})}function Fce(t,e,i){const{defaultValue:r,disabled:n,form:s,name:o,required:a}=t;e.defaultValue=r,e.disabled=n,e.name=o,e.required=a,e.tabIndex=-1,s?e.setAttribute("form",s):e.removeAttribute("form"),iJ(t)?(e.checked=t.checked,e.defaultChecked=t.defaultChecked,e.value=t.checked?i||"on":""):e.value=i||"",t.syncHiddenFormInput?.(e)}const $k=({component:t})=>(_bt(t),H("slot",{name:sH}));/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const w3e="calciteInternalLabelClick",Ik="calciteInternalLabelConnected",G5="calciteInternalLabelDisconnected",kce="calcite-label",jO=new WeakMap,F3=new WeakMap,HO=new WeakMap,j5=new WeakMap,ET=new WeakSet,vbt=t=>{const{id:e}=t,i=e&&QZ(t,{selector:`${kce}[for="${e}"]`});if(i)return i;const r=vw(t,kce);return!r||bbt(r,t)?null:r};function bbt(t,e){let i;const r="custom-element-ancestor-check",n=o=>{o.stopImmediatePropagation();const a=o.composedPath();i=a.slice(a.indexOf(e),a.indexOf(t))};return t.addEventListener(r,n,{once:!0}),e.dispatchEvent(new CustomEvent(r,{composed:!0,bubbles:!0})),t.removeEventListener(r,n),i.filter(o=>o!==e&&o!==t).filter(o=>o.tagName?.includes("-")).length>0}function iE(t){const e=vbt(t.el);if(F3.has(e)&&e===t.labelEl||!e&&ET.has(t))return;const i=xbt.bind(t);if(e){t.labelEl=e;const r=jO.get(e)||[];r.push(t),jO.set(e,r.sort(x3e)),F3.has(t.labelEl)||(F3.set(t.labelEl,Uce),t.labelEl.addEventListener(w3e,Uce)),ET.delete(t),document.removeEventListener(Ik,HO.get(t)),j5.set(t,i),document.addEventListener(G5,i)}else ET.has(t)||(i(),document.removeEventListener(G5,j5.get(t)))}function iP(t){if(ET.delete(t),document.removeEventListener(Ik,HO.get(t)),document.removeEventListener(G5,j5.get(t)),HO.delete(t),j5.delete(t),!t.labelEl)return;const e=jO.get(t.labelEl);e.length===1&&(t.labelEl.removeEventListener(w3e,F3.get(t.labelEl)),F3.delete(t.labelEl)),jO.set(t.labelEl,e.filter(i=>i!==t).sort(x3e)),t.labelEl=null}function x3e(t,e){return Yvt(t.el,e.el)?-1:1}function Lk(t){return t.label||t.labelEl?.textContent?.trim()||""}function Uce(t){const e=t.detail.sourceEvent.target,i=jO.get(this),r=i.find(o=>o.el===e);if(i.includes(r))return;const s=i[0];s.disabled||s.onLabelClick(t)}function wbt(){ET.has(this)&&iE(this)}function xbt(){ET.add(this);const t=HO.get(this)||wbt.bind(this);HO.set(this,t),document.addEventListener(Ik,t)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const Tbt=["lang","role","aria-expanded"],H5=new Map;let CT;function T3e(t,e,i=!1){const{el:r}=t,n=i?t.globalAttributes:{};e.filter(s=>!!Tbt.includes(s)&&!!r.hasAttribute(s)).forEach(s=>{const o=r.getAttribute(s);o!==null&&(n[s]=o)}),t.globalAttributes=n}function S3e(t){t.forEach(({target:e})=>{const[i,r]=H5.get(e);T3e(i,r.attributeFilter)})}function E3e(t,e){const{el:i}=t,r={attributeFilter:e};H5.set(i,[t,r]),T3e(t,e,!0),CT||(CT=hc("mutation",S3e)),CT.observe(i,r)}function C3e(t){H5.delete(t.el),S3e(CT.takeRecords()),CT.disconnect();for(const[e,[,i]]of H5.entries())CT.observe(e,i)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const Tc={buttonLoader:"calcite-button--loader",content:"content",contentSlotted:"content--slotted",icon:"icon",iconStart:"icon--start",iconEnd:"icon--end",loadingIn:"loading-in",loadingOut:"loading-out",iconStartEmpty:"icon-start-empty",iconEndEmpty:"icon-end-empty",buttonPadding:"button-padding",buttonPaddingShrunk:"button-padding--shrunk"},Sbt=`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-ui-opacity-disabled)}:host([loading]) *,:host([disabled]) *,:host([loading]) ::slotted(*),:host([disabled]) ::slotted(*){pointer-events:none}:host{display:inline-block;inline-size:auto;vertical-align:middle}:host([round]){border-radius:50px}:host([round]) a,:host([round]) button{border-radius:50px}:host button,:host a{outline-color:transparent}:host button:focus,:host a:focus{outline:2px solid var(--calcite-ui-focus-color, var(--calcite-ui-brand));outline-offset:calc(
            2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-ui-focus-offset-invert),
                1
              )
            )
          )}:host button,:host a{--calcite-button-content-margin-internal:0.5rem;--calcite-button-padding-x-internal:7px;--calcite-button-padding-y-internal:3px;padding-block:var(--calcite-button-padding-y-internal);padding-inline:var(--calcite-button-padding-x-internal);position:relative;box-sizing:border-box;display:flex;block-size:100%;inline-size:100%;cursor:pointer;-webkit-user-select:none;user-select:none;-webkit-appearance:none;appearance:none;align-items:center;justify-content:center;border-radius:0px;border-style:none;text-align:center;font-family:inherit;font-weight:var(--calcite-font-weight-normal);text-decoration-line:none;transition:color var(--calcite-animation-timing) ease-in-out, background-color var(--calcite-animation-timing) ease-in-out, box-shadow var(--calcite-animation-timing) ease-in-out, outline-color var(--calcite-internal-animation-timing-fast) ease-in-out}:host button:hover,:host a:hover{text-decoration-line:none}:host button span,:host a span{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.content{margin-inline:var(--calcite-button-content-margin-internal)}.icon-start-empty .content{margin-inline-start:unset}.icon-end-empty .content{margin-inline-end:unset}:host([scale=m]) button,:host([scale=m]) a{--calcite-button-content-margin-internal:0.75rem}:host([scale=l]) button,:host([scale=l]) a{--calcite-button-content-margin-internal:1rem}:host([width=auto]){inline-size:auto}:host([width=half]){inline-size:50%}:host([width=full]){inline-size:100%}:host([alignment=center]:not([width=auto])) a,:host([alignment=center]:not([width=auto])) button{justify-content:center}:host([alignment=start]:not([width=auto])) a,:host([alignment=start]:not([width=auto])) button{justify-content:flex-start}:host([alignment=end]:not([width=auto])) a,:host([alignment=end]:not([width=auto])) button{justify-content:flex-end}:host([alignment*=space-between]:not([width=auto])) a,:host([alignment*=space-between]:not([width=auto])) button{justify-content:space-between}:host([alignment=icon-start-space-between]:not([width=auto])) .icon--start{margin-inline-end:auto}:host([alignment=icon-start-space-between]:not([width=auto])) a,:host([alignment=icon-start-space-between]:not([width=auto])) button{text-align:unset}:host([alignment=icon-end-space-between]:not([width=auto])) .icon--end{margin-inline-start:auto}:host([alignment=icon-end-space-between]:not([width=auto])) a,:host([alignment=icon-end-space-between]:not([width=auto])) button{text-align:unset}:host([alignment=center]) a:not(.content--slotted) .icon--start+.icon--end,:host([alignment=center]) button:not(.content--slotted) .icon--start+.icon--end{margin-inline-start:var(--calcite-button-content-margin-internal)}.icon{position:relative;margin:0px;display:inline-flex;font-weight:var(--calcite-font-weight-normal);line-height:inherit}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}:host([loading]) button,:host([loading]) a{opacity:var(--calcite-ui-opacity-disabled)}@keyframes loader-in{0%{inline-size:0;opacity:0;transform:scale(0.5)}100%{inline-size:1em;opacity:1;transform:scale(1)}}@keyframes loader-out{0%{inline-size:1em;opacity:1;transform:scale(1)}100%{inline-size:0;opacity:0;transform:scale(0.5)}}.calcite-button--loader{display:flex}.calcite-button--loader calcite-loader{margin:0px;transition:inline-size var(--calcite-internal-animation-timing-slow) ease-in-out, opacity var(--calcite-internal-animation-timing-slow) ease-in-out, transform var(--calcite-internal-animation-timing-slow) ease-in-out}.calcite-button--loader calcite-loader.loading-in{animation-name:loader-in;animation-duration:var(--calcite-internal-animation-timing-slow)}.calcite-button--loader calcite-loader.loading-out{animation-name:loader-out;animation-duration:var(--calcite-internal-animation-timing-slow)}:host([loading]) button.content--slotted .calcite-button--loader calcite-loader,:host([loading]) a.content--slotted .calcite-button--loader calcite-loader{margin-inline-end:var(--calcite-button-content-margin-internal)}:host([loading]) button:not(.content--slotted) .icon--start,:host([loading]) button:not(.content--slotted) .icon--end,:host([loading]) a:not(.content--slotted) .icon--start,:host([loading]) a:not(.content--slotted) .icon--end{display:none}:host([appearance]) button,:host([appearance]) a{border-width:1px;border-style:solid;border-color:transparent}:host([kind=brand]) button,:host([kind=brand]) a{background-color:var(--calcite-ui-brand);color:var(--calcite-ui-text-inverse)}:host([kind=brand]) button:hover,:host([kind=brand]) button:focus,:host([kind=brand]) a:hover,:host([kind=brand]) a:focus{background-color:var(--calcite-ui-brand-hover)}:host([kind=brand]) button:active,:host([kind=brand]) a:active{background-color:var(--calcite-ui-brand-press)}:host([kind=brand]) button calcite-loader,:host([kind=brand]) a calcite-loader{color:var(--calcite-ui-text-inverse)}:host([kind=danger]) button,:host([kind=danger]) a{background-color:var(--calcite-ui-danger);color:var(--calcite-ui-text-inverse)}:host([kind=danger]) button:hover,:host([kind=danger]) button:focus,:host([kind=danger]) a:hover,:host([kind=danger]) a:focus{background-color:var(--calcite-ui-danger-hover)}:host([kind=danger]) button:active,:host([kind=danger]) a:active{background-color:var(--calcite-ui-danger-press)}:host([kind=danger]) button calcite-loader,:host([kind=danger]) a calcite-loader{color:var(--calcite-ui-text-inverse)}:host([kind=neutral]) button,:host([kind=neutral]) a{background-color:var(--calcite-ui-foreground-3);color:var(--calcite-ui-text-1)}:host([kind=neutral]) button:hover,:host([kind=neutral]) button:focus,:host([kind=neutral]) a:hover,:host([kind=neutral]) a:focus{background-color:var(--calcite-ui-foreground-2)}:host([kind=neutral]) button:active,:host([kind=neutral]) a:active{background-color:var(--calcite-ui-foreground-1)}:host([kind=neutral]) button calcite-loader,:host([kind=neutral]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([kind=inverse]) button,:host([kind=inverse]) a{color:var(--calcite-ui-text-inverse);background-color:var(--calcite-ui-inverse)}:host([kind=inverse]) button:hover,:host([kind=inverse]) button:focus,:host([kind=inverse]) a:hover,:host([kind=inverse]) a:focus{background-color:var(--calcite-ui-inverse-hover)}:host([kind=inverse]) button:active,:host([kind=inverse]) a:active{background-color:var(--calcite-ui-inverse-press)}:host([kind=inverse]) button calcite-loader,:host([kind=inverse]) a calcite-loader{color:var(--calcite-ui-text-inverse)}:host([appearance=outline-fill]) button,:host([appearance=outline-fill]) a{border-width:1px;border-style:solid;background-color:var(--calcite-ui-foreground-1);box-shadow:inset 0 0 0 1px transparent}:host([appearance=outline-fill][kind=brand]) button,:host([appearance=outline-fill][kind=brand]) a{border-color:var(--calcite-ui-brand);background-color:var(--calcite-ui-foreground-1);color:var(--calcite-ui-brand)}:host([appearance=outline-fill][kind=brand]) button:hover,:host([appearance=outline-fill][kind=brand]) a:hover{border-color:var(--calcite-ui-brand-hover);color:var(--calcite-ui-brand-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-brand-hover)}:host([appearance=outline-fill][kind=brand]) button:focus,:host([appearance=outline-fill][kind=brand]) a:focus{border-color:var(--calcite-ui-brand);color:var(--calcite-ui-brand);box-shadow:inset 0 0 0 2px var(--calcite-ui-brand)}:host([appearance=outline-fill][kind=brand]) button:active,:host([appearance=outline-fill][kind=brand]) a:active{border-color:var(--calcite-ui-brand-press);color:var(--calcite-ui-brand-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-brand-press)}:host([appearance=outline-fill][kind=brand]) button calcite-loader,:host([appearance=outline-fill][kind=brand]) a calcite-loader{color:var(--calcite-ui-brand)}:host([appearance=outline-fill][kind=danger]) button,:host([appearance=outline-fill][kind=danger]) a{border-color:var(--calcite-ui-danger);background-color:var(--calcite-ui-foreground-1);color:var(--calcite-ui-danger)}:host([appearance=outline-fill][kind=danger]) button:hover,:host([appearance=outline-fill][kind=danger]) a:hover{border-color:var(--calcite-ui-danger-hover);color:var(--calcite-ui-danger-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-danger-hover)}:host([appearance=outline-fill][kind=danger]) button:focus,:host([appearance=outline-fill][kind=danger]) a:focus{border-color:var(--calcite-ui-danger);color:var(--calcite-ui-danger);box-shadow:inset 0 0 0 2px var(--calcite-ui-danger)}:host([appearance=outline-fill][kind=danger]) button:active,:host([appearance=outline-fill][kind=danger]) a:active{border-color:var(--calcite-ui-danger-press);color:var(--calcite-ui-danger-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-danger-press)}:host([appearance=outline-fill][kind=danger]) button calcite-loader,:host([appearance=outline-fill][kind=danger]) a calcite-loader{color:var(--calcite-ui-danger)}:host([appearance=outline-fill][kind=neutral]) button,:host([appearance=outline-fill][kind=neutral]) a{background-color:var(--calcite-ui-foreground-1);color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-border-1)}:host([appearance=outline-fill][kind=neutral]) button:hover,:host([appearance=outline-fill][kind=neutral]) a:hover{box-shadow:inset 0 0 0 1px var(--calcite-ui-foreground-3)}:host([appearance=outline-fill][kind=neutral]) button:focus,:host([appearance=outline-fill][kind=neutral]) a:focus{box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3)}:host([appearance=outline-fill][kind=neutral]) button:active,:host([appearance=outline-fill][kind=neutral]) a:active{box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3)}:host([appearance=outline-fill][kind=neutral]) button calcite-loader,:host([appearance=outline-fill][kind=neutral]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=outline-fill][kind=inverse]) button,:host([appearance=outline-fill][kind=inverse]) a{background-color:var(--calcite-ui-foreground-1);color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-inverse)}:host([appearance=outline-fill][kind=inverse]) button:hover,:host([appearance=outline-fill][kind=inverse]) a:hover{border-color:var(--calcite-ui-inverse-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-inverse-hover)}:host([appearance=outline-fill][kind=inverse]) button:focus,:host([appearance=outline-fill][kind=inverse]) a:focus{border-color:var(--calcite-ui-inverse);box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse)}:host([appearance=outline-fill][kind=inverse]) button:active,:host([appearance=outline-fill][kind=inverse]) a:active{border-color:var(--calcite-ui-inverse-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse-press)}:host([appearance=outline-fill][kind=inverse]) button calcite-loader,:host([appearance=outline-fill][kind=inverse]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=outline]) button,:host([appearance=outline]) a{border-width:1px;border-style:solid;background-color:transparent;box-shadow:inset 0 0 0 1px transparent}:host([appearance=outline][kind=brand]) button,:host([appearance=outline][kind=brand]) a{border-color:var(--calcite-ui-brand);background-color:transparent;color:var(--calcite-ui-brand)}:host([appearance=outline][kind=brand]) button:hover,:host([appearance=outline][kind=brand]) a:hover{border-color:var(--calcite-ui-brand-hover);color:var(--calcite-ui-brand-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-brand-hover)}:host([appearance=outline][kind=brand]) button:focus,:host([appearance=outline][kind=brand]) a:focus{border-color:var(--calcite-ui-brand);color:var(--calcite-ui-brand);box-shadow:inset 0 0 0 2px var(--calcite-ui-brand)}:host([appearance=outline][kind=brand]) button:active,:host([appearance=outline][kind=brand]) a:active{border-color:var(--calcite-ui-brand-press);color:var(--calcite-ui-brand-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-brand-press)}:host([appearance=outline][kind=brand]) button calcite-loader,:host([appearance=outline][kind=brand]) a calcite-loader{color:var(--calcite-ui-brand)}:host([appearance=outline][kind=danger]) button,:host([appearance=outline][kind=danger]) a{border-color:var(--calcite-ui-danger);background-color:transparent;color:var(--calcite-ui-danger)}:host([appearance=outline][kind=danger]) button:hover,:host([appearance=outline][kind=danger]) a:hover{border-color:var(--calcite-ui-danger-hover);color:var(--calcite-ui-danger-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-danger-hover)}:host([appearance=outline][kind=danger]) button:focus,:host([appearance=outline][kind=danger]) a:focus{border-color:var(--calcite-ui-danger);color:var(--calcite-ui-danger);box-shadow:inset 0 0 0 2px var(--calcite-ui-danger)}:host([appearance=outline][kind=danger]) button:active,:host([appearance=outline][kind=danger]) a:active{border-color:var(--calcite-ui-danger-press);color:var(--calcite-ui-danger-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-danger-press)}:host([appearance=outline][kind=danger]) button calcite-loader,:host([appearance=outline][kind=danger]) a calcite-loader{color:var(--calcite-ui-danger)}:host([appearance=outline][kind=neutral]) button,:host([appearance=outline][kind=neutral]) a{background-color:transparent;color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-border-1)}:host([appearance=outline][kind=neutral]) button:hover,:host([appearance=outline][kind=neutral]) a:hover{box-shadow:inset 0 0 0 1px var(--calcite-ui-foreground-3)}:host([appearance=outline][kind=neutral]) button:focus,:host([appearance=outline][kind=neutral]) a:focus{box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3)}:host([appearance=outline][kind=neutral]) button:active,:host([appearance=outline][kind=neutral]) a:active{box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3)}:host([appearance=outline][kind=neutral]) button calcite-loader,:host([appearance=outline][kind=neutral]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=outline][kind=inverse]) button,:host([appearance=outline][kind=inverse]) a{background-color:transparent;color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-inverse)}:host([appearance=outline][kind=inverse]) button:hover,:host([appearance=outline][kind=inverse]) a:hover{border-color:var(--calcite-ui-inverse-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-inverse-hover)}:host([appearance=outline][kind=inverse]) button:focus,:host([appearance=outline][kind=inverse]) a:focus{border-color:var(--calcite-ui-inverse);box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse)}:host([appearance=outline][kind=inverse]) button:active,:host([appearance=outline][kind=inverse]) a:active{border-color:var(--calcite-ui-inverse-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse-press)}:host([appearance=outline][kind=inverse]) button calcite-loader,:host([appearance=outline][kind=inverse]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=outline-fill][split-child=primary]) button,:host([appearance=outline][split-child=primary]) button{border-inline-end-width:0;border-inline-start-width:1px}:host([appearance=outline-fill][split-child=secondary]) button,:host([appearance=outline][split-child=secondary]) button{border-inline-start-width:0;border-inline-end-width:1px}:host([appearance=transparent]:not(.enable-editing-button)) button,:host([appearance=transparent]:not(.enable-editing-button)) a{background-color:transparent}:host([appearance=transparent]:not(.enable-editing-button)) button:hover,:host([appearance=transparent]:not(.enable-editing-button)) button:focus,:host([appearance=transparent]:not(.enable-editing-button)) a:hover,:host([appearance=transparent]:not(.enable-editing-button)) a:focus{background-color:var(--calcite-button-transparent-hover)}:host([appearance=transparent]:not(.enable-editing-button)) button:active,:host([appearance=transparent]:not(.enable-editing-button)) a:active{background-color:var(--calcite-button-transparent-press)}:host([appearance=transparent][kind=brand]) button,:host([appearance=transparent][kind=brand]) a{color:var(--calcite-ui-brand)}:host([appearance=transparent][kind=brand]) button:hover,:host([appearance=transparent][kind=brand]) a:hover{color:var(--calcite-ui-brand-hover)}:host([appearance=transparent][kind=brand]) button:focus,:host([appearance=transparent][kind=brand]) a:focus{color:var(--calcite-ui-brand)}:host([appearance=transparent][kind=brand]) button:active,:host([appearance=transparent][kind=brand]) a:active{color:var(--calcite-ui-brand-press)}:host([appearance=transparent][kind=brand]) button calcite-loader,:host([appearance=transparent][kind=brand]) a calcite-loader{color:var(--calcite-ui-brand)}:host([appearance=transparent][kind=danger]) button,:host([appearance=transparent][kind=danger]) a{color:var(--calcite-ui-danger)}:host([appearance=transparent][kind=danger]) button:hover,:host([appearance=transparent][kind=danger]) a:hover{color:var(--calcite-ui-danger-hover)}:host([appearance=transparent][kind=danger]) button:focus,:host([appearance=transparent][kind=danger]) a:focus{color:var(--calcite-ui-danger)}:host([appearance=transparent][kind=danger]) button:active,:host([appearance=transparent][kind=danger]) a:active{color:var(--calcite-ui-danger-press)}:host([appearance=transparent][kind=danger]) button calcite-loader,:host([appearance=transparent][kind=danger]) a calcite-loader{color:var(--calcite-ui-danger)}:host([appearance=transparent][kind=neutral]:not(.cancel-editing-button)) button,:host([appearance=transparent][kind=neutral]:not(.cancel-editing-button)) a,:host([appearance=transparent][kind=neutral]:not(.cancel-editing-button)) calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=transparent][kind=neutral].cancel-editing-button) button{border-block-start-width:1px;border-block-end-width:1px;color:var(--calcite-ui-text-3);border-block-start-color:var(--calcite-ui-border-input);border-block-end-color:var(--calcite-ui-border-input);border-block-style:solid}:host([appearance=transparent][kind=neutral].cancel-editing-button) button:not(.content--slotted){--calcite-button-padding-y-internal:0}:host([appearance=transparent][kind=neutral].cancel-editing-button) button:hover{color:var(--calcite-ui-text-1)}:host([appearance=transparent][kind=neutral].enable-editing-button) button{background-color:transparent}:host(.confirm-changes-button) button:focus,:host(.cancel-editing-button) button:focus,:host(.enable-editing-button) button:focus{outline-offset:-2px}:host([appearance=transparent][kind=inverse]) button,:host([appearance=transparent][kind=inverse]) a,:host([appearance=transparent][kind=inverse]) calcite-loader{color:var(--calcite-ui-text-inverse)}:host([scale=s]) button.content--slotted,:host([scale=s]) a.content--slotted{font-size:var(--calcite-font-size--2);line-height:1rem}:host([scale=s][appearance=transparent]) button.content--slotted,:host([scale=s][appearance=transparent]) a.content--slotted{--calcite-button-padding-x-internal:0.5rem}:host([scale=s]) button,:host([scale=s]) a{--calcite-button-padding-y-internal:3px}:host([scale=m]) button.content--slotted,:host([scale=m]) a.content--slotted{--calcite-button-padding-x-internal:11px;font-size:var(--calcite-font-size--1);line-height:1rem}:host([scale=m]) button,:host([scale=m]) a{--calcite-button-padding-y-internal:7px}:host([scale=m][appearance=transparent]) button.content--slotted,:host([scale=m][appearance=transparent]) a.content--slotted{--calcite-button-padding-x-internal:0.75rem}:host([scale=l]) button.content--slotted,:host([scale=l]) a.content--slotted{--calcite-button-padding-x-internal:15px;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=l]) .button-padding{--calcite-button-padding-x-internal:1rem;--calcite-button-padding-y-internal:11px}:host([scale=l]) .button-padding--shrunk{--calcite-button-padding-y-internal:9px}:host([scale=s]) button:not(.content--slotted),:host([scale=s]) a:not(.content--slotted){--calcite-button-padding-x-internal:0.125rem;--calcite-button-padding-y-internal:3px;inline-size:1.5rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-block-size:1.5rem}:host([scale=m]) button:not(.content--slotted),:host([scale=m]) a:not(.content--slotted){--calcite-button-padding-x-internal:0.125rem;--calcite-button-padding-y-internal:7px;inline-size:2rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-block-size:2rem}:host([scale=l]) button:not(.content--slotted),:host([scale=l]) a:not(.content--slotted){--calcite-button-padding-x-internal:0.125rem;--calcite-button-padding-y-internal:9px;inline-size:2.75rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-block-size:2.75rem}:host([scale=l][appearance=transparent]) button:not(.content--slotted),:host([scale=l][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-y-internal:0.625rem}:host([scale=s][icon-start][icon-end]) button:not(.content--slotted),:host([scale=s][icon-start][icon-end]) a:not(.content--slotted){--calcite-button-padding-x-internal:23px;block-size:1.5rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=s][icon-start][icon-end][appearance=transparent]) button:not(.content--slotted),:host([scale=s][icon-start][icon-end][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-x-internal:1.5rem}:host([scale=m][icon-start][icon-end]) button:not(.content--slotted),:host([scale=m][icon-start][icon-end]) a:not(.content--slotted){--calcite-button-padding-x-internal:2rem;block-size:2rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=m][icon-start][icon-end][appearance=transparent]) button:not(.content--slotted),:host([scale=m][icon-start][icon-end][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-x-internal:33px}:host([scale=l][icon-start][icon-end]) button:not(.content--slotted),:host([scale=l][icon-start][icon-end]) a:not(.content--slotted){--calcite-button-padding-x-internal:43px;block-size:2.75rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=l][icon-start][icon-end]) button:not(.content--slotted) .icon--start+.icon--end,:host([scale=l][icon-start][icon-end]) a:not(.content--slotted) .icon--start+.icon--end{margin-inline-start:1rem}:host([scale=l][icon-start][icon-end][appearance=transparent]) button:not(.content--slotted),:host([scale=l][icon-start][icon-end][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-x-internal:2.75rem}:host([hidden]){display:none}[hidden]{display:none}`,Ebt=ln(class extends cn{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.mutationObserver=hc("mutation",()=>this.updateHasContent()),this.resizeObserver=hc("resize",()=>this.setTooltipText()),this.handleClick=()=>{const{type:t}=this;this.href||(t==="submit"?mbt(this):t==="reset"&&gbt(this))},this.setTooltipText=()=>{const{contentEl:t}=this;t&&(this.tooltipText=t.offsetWidth<t.scrollWidth?this.el.innerText:null)},this.setChildEl=t=>{this.childEl=t,t&&this.resizeObserver?.observe(t)},this.alignment="center",this.appearance="solid",this.label=void 0,this.kind="brand",this.disabled=!1,this.form=void 0,this.href=void 0,this.iconEnd=void 0,this.iconFlipRtl=void 0,this.iconStart=void 0,this.loading=!1,this.name=void 0,this.rel=void 0,this.round=!1,this.scale="m",this.splitChild=!1,this.target=void 0,this.type="button",this.width="auto",this.messages=void 0,this.messageOverrides=void 0,this.hasContent=!1,this.hasLoader=!1,this.effectiveLocale="",this.defaultMessages=void 0,this.tooltipText=void 0,this.globalAttributes={ariaExpanded:void 0}}loadingChanged(t,e){t&&!e&&(this.hasLoader=!0),!t&&e&&window.setTimeout(()=>{this.hasLoader=!1},300)}onMessagesChange(){}async connectedCallback(){F_(this),yu(this),Ph(this),E3e(this,["aria-expanded"]),this.hasLoader=this.loading,this.setupTextContentObserver(),iE(this),this.formEl=_3e(this)}disconnectedCallback(){this.mutationObserver?.disconnect(),k_(this),iP(this),_u(this),Mh(this),this.resizeObserver?.disconnect(),this.formEl=null,C3e(this)}async componentWillLoad(){Hs(this),this.updateHasContent(),await Oh(this)}componentDidLoad(){qs(this),this.setTooltipText()}componentDidRender(){N_(this)}render(){const t=this.href?"a":"button",e=t,i=this.hasLoader?H("div",{class:Tc.buttonLoader},H("calcite-loader",{class:this.loading?Tc.loadingIn:Tc.loadingOut,inline:!0,label:this.messages.loading,scale:this.scale==="l"?"m":"s"})):null,r=!this.iconStart&&!this.iconEnd,n=H("calcite-icon",{class:{[Tc.icon]:!0,[Tc.iconStart]:!0},flipRtl:this.iconFlipRtl==="start"||this.iconFlipRtl==="both",icon:this.iconStart,scale:this.scale==="l"?"m":"s"}),s=H("calcite-icon",{class:{[Tc.icon]:!0,[Tc.iconEnd]:!0},flipRtl:this.iconFlipRtl==="end"||this.iconFlipRtl==="both",icon:this.iconEnd,scale:this.scale==="l"?"m":"s"}),o=H("span",{class:Tc.content,ref:a=>this.contentEl=a},H("slot",null));return H(e,{"aria-label":this.loading?this.messages.loading:Lk(this),"aria-live":"polite",class:{[Tc.buttonPadding]:r,[Tc.buttonPaddingShrunk]:!r,[Tc.contentSlotted]:this.hasContent,[Tc.iconStartEmpty]:!this.iconStart,[Tc.iconEndEmpty]:!this.iconEnd},disabled:this.disabled||this.loading,href:t==="a"&&this.href,name:t==="button"&&this.name,onClick:this.handleClick,ref:this.setChildEl,rel:t==="a"&&this.rel,tabIndex:this.disabled||this.loading?-1:null,target:t==="a"&&this.target,title:this.tooltipText,type:t==="button"&&this.type,...this.globalAttributes},i,this.iconStart?n:null,this.hasContent?o:null,this.iconEnd?s:null)}async setFocus(){await Ws(this),this.childEl?.focus()}effectiveLocaleChange(){Rh(this,this.effectiveLocale)}updateHasContent(){const t=this.el.textContent.trim().length>0||this.el.childNodes.length>0;this.hasContent=this.el.childNodes.length===1&&this.el.childNodes[0]?.nodeName==="#text"?this.el.textContent?.trim().length>0:t}setupTextContentObserver(){this.mutationObserver?.observe(this.el,{childList:!0,subtree:!0})}onLabelClick(){this.handleClick(),this.setFocus()}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{loading:["loadingChanged"],messageOverrides:["onMessagesChange"],effectiveLocale:["effectiveLocaleChange"]}}static get style(){return Sbt}},[1,"calcite-button",{alignment:[513],appearance:[513],label:[1],kind:[513],disabled:[516],form:[513],href:[513],iconEnd:[513,"icon-end"],iconFlipRtl:[513,"icon-flip-rtl"],iconStart:[513,"icon-start"],loading:[516],name:[513],rel:[513],round:[516],scale:[513],splitChild:[520,"split-child"],target:[513],type:[513],width:[513],messages:[1040],messageOverrides:[1040],hasContent:[32],hasLoader:[32],effectiveLocale:[32],defaultMessages:[32],tooltipText:[32],globalAttributes:[32],setFocus:[64]}]);function Cbt(){if(typeof customElements>"u")return;["calcite-button","calcite-icon","calcite-loader"].forEach(e=>{switch(e){case"calcite-button":customElements.get(e)||customElements.define(e,Ebt);break;case"calcite-icon":customElements.get(e)||Ba();break;case"calcite-loader":customElements.get(e)||em();break}})}Cbt();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const Abt=":host{display:flex}ul{margin:0px;display:inline-flex;block-size:100%;align-items:center;padding:0px}:host([layout=vertical]) ul{display:flex;inline-size:100%;flex-direction:column}:host([hidden]){display:none}[hidden]{display:none}",Obt=ln(class extends cn{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.menuItems=[],this.handleMenuSlotChange=t=>{this.menuItems=Ok(t),this.setMenuItemLayout(this.menuItems,this.layout)},this.label=void 0,this.layout="horizontal",this.messageOverrides=void 0,this.messages=void 0,this.defaultMessages=void 0,this.effectiveLocale="",this.globalAttributes={role:"menubar"}}handleLayoutChange(t){this.setMenuItemLayout(this.menuItems,t)}onMessagesChange(){}effectiveLocaleChange(){Rh(this,this.effectiveLocale)}connectedCallback(){yu(this),Ph(this),E3e(this,["role"])}async componentWillLoad(){Hs(this),await Oh(this)}componentDidLoad(){qs(this)}disconnectedCallback(){_u(this),Mh(this),C3e(this)}async setFocus(){await Ws(this),this.el.focus()}calciteInternalNavMenuItemKeyEvent(t){const e=t.target,i=t.detail.children,r=t.detail.event.key;t.stopPropagation(),r==="ArrowDown"?e.layout==="vertical"?eI(this.menuItems,e,"next",!1):t.detail.isSubmenuOpen&&i[0].setFocus():r==="ArrowUp"?this.layout==="vertical"?eI(this.menuItems,e,"previous",!1):t.detail.isSubmenuOpen&&i[i.length-1].setFocus():r==="ArrowRight"?this.layout==="horizontal"?eI(this.menuItems,e,"next",!1):t.detail.isSubmenuOpen&&i[0].setFocus():r==="ArrowLeft"?this.layout==="horizontal"?eI(this.menuItems,e,"previous",!1):t.detail.isSubmenuOpen&&this.focusParentElement(t.target):r==="Escape"&&this.focusParentElement(t.target),t.preventDefault()}focusParentElement(t){const e=t.parentElement;e&&(tE(e),e.open=!1)}setMenuItemLayout(t,e){t.forEach(i=>{i.layout=e,this.globalAttributes.role==="menubar"&&(i.isTopLevelItem=!0,i.topLevelMenuLayout=this.layout)})}render(){return H(yo,null,H("ul",{"aria-label":this.label,...this.globalAttributes},H("slot",{onSlotchange:this.handleMenuSlotChange})))}static get delegatesFocus(){return!0}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{layout:["handleLayoutChange"],messageOverrides:["onMessagesChange"],effectiveLocale:["effectiveLocaleChange"]}}static get style(){return Abt}},[17,"calcite-menu",{label:[1],layout:[513],messageOverrides:[1040],messages:[1040],defaultMessages:[32],effectiveLocale:[32],globalAttributes:[32],setFocus:[64]},[[0,"calciteInternalMenuItemKeyEvent","calciteInternalNavMenuItemKeyEvent"]]]);function A3e(){if(typeof customElements>"u")return;["calcite-menu"].forEach(e=>{switch(e){case"calcite-menu":customElements.get(e)||customElements.define(e,Obt);break}})}A3e();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const un={container:"container",content:"content",dropdownVertical:"dropdown--vertical",dropdownMenuItems:"dropdown-menu-items",dropdownAction:"dropdown-action",layoutVertical:"layout--vertical",hoverHrefIcon:"hover-href-icon",icon:"icon",iconBreadcrumb:"icon--breadcrumb",iconDropdown:"icon--dropdown",iconEnd:"icon--end",iconStart:"icon--start",isParentVertical:"parent--vertical",itemContent:"item-content",open:"open",nested:"nested",textContainer:"text-container"},Rbt=`:host{position:relative;box-sizing:border-box;display:flex;align-items:center;flex-shrink:0}:host .container,:host .item-content,:host .content{min-block-size:3rem}:host([layout=vertical]){inline-size:100%}:host(:not([layout=vertical])){block-size:100%}.container,.item-content{display:flex;block-size:100%;inline-size:100%;flex-direction:row;align-items:stretch}.content{position:relative;box-sizing:border-box;display:flex;block-size:100%;inline-size:100%;cursor:pointer;align-items:center;justify-content:center;background-color:var(--calcite-ui-foreground-1);padding-inline:1rem;font-size:var(--calcite-font-size-0);color:var(--calcite-ui-text-2);outline:2px solid transparent;outline-offset:2px;text-decoration:none;border-block-end:0.125rem solid transparent;padding-block-start:0.125rem}.content:hover{background-color:var(--calcite-ui-foreground-2);color:var(--calcite-ui-text-2)}.content:focus{background-color:var(--calcite-ui-foreground-2);color:var(--calcite-ui-text-2);outline:2px solid var(--calcite-ui-focus-color, var(--calcite-ui-brand));outline-offset:calc(
            -2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-ui-focus-offset-invert),
                1
              )
            )
          )}.content:active{background-color:var(--calcite-ui-foreground-3);color:var(--calcite-ui-text-1)}.content span{display:inline-flex}.content.layout--vertical{display:flex;inline-size:100%;justify-content:flex-start;padding-block:1rem;border-block-end:0;border-inline-end:0.25rem solid transparent}:host([active]) .content{color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-brand)}:host([active]) .content .icon{--calcite-ui-icon-color:var(--calcite-ui-brand)}:host([layout=vertical]) .content{padding-inline:0.75rem}.icon--start{margin-inline-end:0.75rem}.icon--end{margin-inline-start:0.75rem}:host([layout=vertical]) .icon--end{margin-inline-start:auto;padding-inline-start:0.75rem}.icon--dropdown{position:relative;margin-inline-start:auto;margin-inline-end:0px;padding-inline-start:0.5rem;--calcite-ui-icon-color:var(--calcite-ui-text-3)}:host([layout=vertical]) .icon--end~.icon--dropdown{margin-inline-start:0.75rem}:host([layout=vertical]) .hover-href-icon{padding-inline-start:0.5rem}:host([layout=vertical]) .hover-href-icon~.icon--end{margin-inline-start:0.5rem}:host([layout=vertical]) .hover-href-icon~.icon--breadcrumb{margin-inline-start:0.75rem}.icon--breadcrumb{margin-inline-end:0px;padding-inline-start:0.5rem;--calcite-ui-icon-color:var(--calcite-ui-text-3)}:host([layout=vertical]) .icon--breadcrumb{margin-inline-start:auto}:host([layout=vertical]) .icon--breadcrumb~.icon--dropdown{margin-inline-start:0.5rem}:host([layout=vertical]) .icon--end~.icon--breadcrumb{margin-inline-start:0.5rem}:host([breadcrumb]) .content{padding-inline-end:0.75rem}calcite-action{position:relative;block-size:auto;border-inline-start:1px solid var(--calcite-ui-foreground-1)}calcite-action:after{position:absolute;inset-inline-start:-1px;display:block;inline-size:1px;content:"";inset-block:0.75rem;background-color:var(--calcite-ui-border-3)}calcite-action:hover:after{block-size:100%;inset-block:0}.content:focus~calcite-action,.content:hover~calcite-action{color:var(--calcite-ui-text-1);border-inline-start:1px solid var(--calcite-ui-border-3)}.container:hover .dropdown-action{background-color:var(--calcite-ui-foreground-2)}.dropdown-menu-items{position:absolute;display:none;block-size:auto;min-inline-size:100%;flex-direction:column;overflow:visible;border:1px solid var(--calcite-ui-border-3);background:var(--calcite-ui-foreground-1);inset-block-start:100%;z-index:var(--calcite-app-z-index-dropdown)}.dropdown-menu-items.open{display:block}.dropdown-menu-items.nested{position:absolute;inset-block-start:-1px;transform:translateX(calc(100% - 2px))}.parent--vertical{flex-direction:column}.dropdown--vertical.dropdown-menu-items{position:relative;border-radius:0px;box-shadow:none;inset-block-start:0;transform:none}.dropdown--vertical.dropdown-menu-items:last-of-type{border-inline:0}:host([layout=vertical]:last-of-type) .dropdown-menu-items{border-block-end:0}:host([slot=submenu-item]) .parent--vertical{padding-inline-start:1.5rem}.dropdown-menu-items.nested.calcite--rtl{transform:translateX(calc(-100% + 2px))}.dropdown--vertical.dropdown-menu-items.nested.calcite--rtl{transform:none}.hover-href-icon{position:relative;inset-inline-end:0.25rem;margin-inline-start:auto;opacity:0;transition:all var(--calcite-internal-animation-timing-medium) ease-in-out}.content:focus .hover-href-icon,.content:hover .hover-href-icon{inset-inline-end:-0.25rem;opacity:1}:host([hidden]){display:none}[hidden]{display:none}`,Pbt=ln(class extends cn{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.calciteInternalMenuItemKeyEvent=Ji(this,"calciteInternalMenuItemKeyEvent",7),this.calciteMenuItemSelect=Ji(this,"calciteMenuItemSelect",7),this.clickHandler=t=>{(this.href&&t.target===this.dropdownActionEl||!this.href&&this.hasSubmenu)&&(this.open=!this.open),this.selectMenuItem(t)},this.handleMenuItemSlotChange=t=>{this.submenuItems=Ok(t),this.submenuItems.forEach(e=>{e.topLevelMenuLayout||(e.topLevelMenuLayout=this.topLevelMenuLayout)}),this.hasSubmenu=this.submenuItems.length>0},this.keyDownHandler=async t=>{if(t.key===" "||t.key==="Enter")this.selectMenuItem(t),this.hasSubmenu&&(!this.href||this.href&&t.target===this.dropdownActionEl)&&(this.open=!this.open),t.preventDefault();else if(t.key==="Escape"){if(this.open){this.open=!1;return}this.calciteInternalMenuItemKeyEvent.emit({event:t}),t.preventDefault()}else if(t.key==="ArrowDown"||t.key==="ArrowUp"){if(t.preventDefault(),(t.target===this.dropdownActionEl||!this.href)&&this.hasSubmenu&&!this.open&&this.layout==="horizontal"){this.open=!0;return}this.calciteInternalMenuItemKeyEvent.emit({event:t,children:this.submenuItems,isSubmenuOpen:this.open&&this.hasSubmenu})}else if(t.key==="ArrowLeft")t.preventDefault(),this.calciteInternalMenuItemKeyEvent.emit({event:t,children:this.submenuItems,isSubmenuOpen:!0});else if(t.key==="ArrowRight"){if(t.preventDefault(),(t.target===this.dropdownActionEl||!this.href)&&this.hasSubmenu&&!this.open&&this.layout==="vertical"){this.open=!0;return}this.calciteInternalMenuItemKeyEvent.emit({event:t,children:this.submenuItems,isSubmenuOpen:this.open&&this.hasSubmenu})}},this.active=void 0,this.breadcrumb=void 0,this.href=void 0,this.iconEnd=void 0,this.iconFlipRtl=void 0,this.iconStart=void 0,this.isTopLevelItem=!1,this.label=void 0,this.layout=void 0,this.messageOverrides=void 0,this.messages=void 0,this.open=!1,this.rel=void 0,this.target=void 0,this.text=void 0,this.topLevelMenuLayout=void 0,this.defaultMessages=void 0,this.effectiveLocale="",this.hasSubmenu=!1,this.submenuItems=void 0}onMessagesChange(){}effectiveLocaleChange(){Rh(this,this.effectiveLocale)}async setFocus(){await Ws(this),this.anchorEl.focus()}handleClickOut(t){this.topLevelMenuLayout!=="vertical"&&this.hasSubmenu&&this.open&&!t.composedPath().includes(this.el)&&(this.open=!1)}handleFocusOut(t){this.topLevelMenuLayout!=="vertical"&&!this.el.contains(t.relatedTarget)&&(this.open=!1)}connectedCallback(){yu(this),Ph(this)}async componentWillLoad(){Hs(this),await Oh(this)}componentDidLoad(){qs(this)}disconnectedCallback(){_u(this),Mh(this)}blurHandler(){this.isFocused=!1}focusHandler(t){const e=t.target;this.isFocused=!0,e.open&&!this.open&&(e.open=!1)}selectMenuItem(t){t.target!==this.dropdownActionEl&&this.calciteMenuItemSelect.emit()}renderIconStart(){return H("calcite-icon",{class:`${un.icon} ${un.iconStart}`,flipRtl:this.iconFlipRtl==="start"||this.iconFlipRtl==="both",icon:this.iconStart,key:un.iconStart,scale:"s"})}renderIconEnd(){return H("calcite-icon",{class:`${un.icon} ${un.iconEnd}`,flipRtl:this.iconFlipRtl==="end"||this.iconFlipRtl==="both",icon:this.iconEnd,key:un.iconEnd,scale:"s"})}renderBreadcrumbIcon(t){return H("calcite-icon",{class:`${un.icon} ${un.iconBreadcrumb}`,icon:t==="rtl"?"chevron-left":"chevron-right",key:un.iconBreadcrumb,scale:"s"})}renderDropdownIcon(t){const e=t==="rtl"?"chevron-left":"chevron-right";return H("calcite-icon",{class:`${un.icon} ${un.iconDropdown}`,icon:this.topLevelMenuLayout==="vertical"||this.isTopLevelItem?this.open?"chevron-up":"chevron-down":e,key:un.iconDropdown,scale:"s"})}renderDropdownAction(t){const e=t==="rtl"?"chevron-left":"chevron-right";return H("calcite-action",{class:un.dropdownAction,icon:this.topLevelMenuLayout==="vertical"||this.isTopLevelItem?this.open?"chevron-up":"chevron-down":e,key:un.dropdownAction,onClick:this.clickHandler,onKeyDown:this.keyDownHandler,text:this.messages.open,ref:i=>this.dropdownActionEl=i})}renderSubmenuItems(t){return H("calcite-menu",{class:{[un.dropdownMenuItems]:!0,[un.open]:this.open,[un.nested]:!this.isTopLevelItem,[rH.rtl]:t==="rtl",[un.dropdownVertical]:this.topLevelMenuLayout==="vertical"},label:this.messages.submenu,layout:"vertical",role:"menu"},H("slot",{name:"submenu-item",onSlotchange:this.handleMenuItemSlotChange}))}renderHrefIcon(t){return H("calcite-icon",{class:un.hoverHrefIcon,icon:t==="rtl"?"arrow-left":"arrow-right",key:un.hoverHrefIcon,scale:"s"})}renderItemContent(t){const e=this.href&&(this.topLevelMenuLayout==="vertical"||!this.isTopLevelItem);return H(ZR,null,this.iconStart&&this.renderIconStart(),H("div",{class:un.textContainer},H("span",null,this.text)),e&&this.renderHrefIcon(t),this.iconEnd&&this.renderIconEnd(),this.breadcrumb?this.renderBreadcrumbIcon(t):null,!this.href&&this.hasSubmenu?this.renderDropdownIcon(t):null)}render(){const t=eE(this.el);return H(yo,{onBlur:this.blurHandler,onFocus:this.focusHandler},H("li",{class:{[un.container]:!0,[un.isParentVertical]:this.topLevelMenuLayout==="vertical"},role:"none"},H("div",{class:un.itemContent},H("a",{"aria-current":this.isFocused?"page":!1,"aria-expanded":this.open,"aria-haspopup":this.hasSubmenu,"aria-label":this.label,class:{[un.layoutVertical]:this.layout==="vertical",[un.content]:!0},href:this.href,onClick:this.clickHandler,onKeyDown:this.keyDownHandler,rel:this.rel,role:"menuitem",tabIndex:this.isTopLevelItem?0:-1,target:this.target,ref:e=>this.anchorEl=e},this.renderItemContent(t)),this.href&&this.hasSubmenu?this.renderDropdownAction(t):null),this.renderSubmenuItems(t)))}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{messageOverrides:["onMessagesChange"],effectiveLocale:["effectiveLocaleChange"]}}static get style(){return Rbt}},[1,"calcite-menu-item",{active:[516],breadcrumb:[516],href:[1],iconEnd:[513,"icon-end"],iconFlipRtl:[513,"icon-flip-rtl"],iconStart:[513,"icon-start"],isTopLevelItem:[4,"is-top-level-item"],label:[1],layout:[513],messageOverrides:[1040],messages:[1040],open:[1540],rel:[513],target:[513],text:[1],topLevelMenuLayout:[1,"top-level-menu-layout"],defaultMessages:[32],effectiveLocale:[32],hasSubmenu:[32],submenuItems:[32],setFocus:[64]},[[8,"click","handleClickOut"],[0,"focusout","handleFocusOut"]]]);function Mbt(){if(typeof customElements>"u")return;["calcite-menu-item","calcite-action","calcite-icon","calcite-loader","calcite-menu"].forEach(e=>{switch(e){case"calcite-menu-item":customElements.get(e)||customElements.define(e,Pbt);break;case"calcite-action":customElements.get(e)||xw();break;case"calcite-icon":customElements.get(e)||Ba();break;case"calcite-loader":customElements.get(e)||em();break;case"calcite-menu":customElements.get(e)||A3e();break}})}Mbt();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const bm={container:"container",containerContent:"container-content",hasProgress:"progress-bar",hide:"hide",primary:"primary",secondary:"secondary",tertiary:"tertiary"},_a={logo:"logo",user:"user",progress:"progress",navigationAction:"navigation-action",contentStart:"content-start",contentEnd:"content-end",contentCenter:"content-center",navSecondary:"navigation-secondary",navTertiary:"navigation-tertiary"},$bt={hamburger:"hamburger"},Ibt=":host([hidden]){display:none}[hidden]{display:none}.container{margin-inline:auto;display:flex;inline-size:100%;flex-direction:column;margin-block:0;margin-inline:auto;background-color:var(--calcite-navigation-background, var(--calcite-ui-foreground-1))}.container.primary,.container.secondary,.container.tertiary{border-block-end:1px solid;border-block-end-color:var(--calcite-navigation-border-color, var(--calcite-ui-border-3))}.user,.logo{display:flex}.hide{display:none}.primary{block-size:4rem}.secondary{block-size:3rem}.tertiary{block-size:3rem}.container-content{margin-inline:auto;display:flex;block-size:100%;inline-size:100%;margin-block:0;inline-size:var(--calcite-navigation-width, 100%);max-inline-size:100%}.container-content.progress-bar{margin-block-start:0.125rem}slot[name]{display:flex;flex-direction:row}slot[name=navigation-secondary]::slotted(calcite-navigation),slot[name=navigation-tertiary]::slotted(calcite-navigation){inline-size:100%}slot[name=content-start]::slotted(*),slot[name=content-center]::slotted(*),slot[name=content-end]::slotted(*){display:flex;flex-direction:row;align-items:center}slot[name=progress],slot[name=progress] calcite-progress{inset-block-start:0;inset-inline:0}slot[name=content-end]{margin-inline-start:auto}slot[name=content-start]{margin-inline-end:auto}slot[name=content-end],slot[name=logo]~slot[name=user],slot[name=user]:only-child{margin-inline-start:auto}slot[name=content-center]{margin-inline-start:auto;margin-inline-end:auto}slot[name=content-start]~slot[name=content-center]{margin-inline-start:0px}slot[name=content-start]~slot[name=content-end],slot[name=content-center]~slot[name=content-end],slot[name=content-center]~slot[name=user],slot[name=content-end]~slot[name=user]{margin:0px}",Lbt=ln(class extends cn{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.calciteNavigationActionSelect=Ji(this,"calciteNavigationActionSelect",6),this.actionClickHandler=()=>{this.calciteNavigationActionSelect.emit()},this.handleUserSlotChange=t=>{this.isPrimaryLevel()&&(this.userSlotHasElements=Wo(t))},this.handleLogoSlotChange=t=>{this.isPrimaryLevel()&&(this.logoSlotHasElements=Wo(t))},this.handleContentStartSlotChange=t=>{this.isPrimaryLevel()&&(this.primaryContentStartSlotHasElements=Wo(t))},this.handleContentEndSlotChange=t=>{this.isPrimaryLevel()&&(this.primaryContentEndSlotHasElements=Wo(t))},this.handleContentCenterSlotChange=t=>{this.isPrimaryLevel()&&(this.primaryContentCenterSlotHasElements=Wo(t))},this.handleSecondarySlotChange=t=>{this.secondarySlotHasElements=Wo(t)},this.handleTertiarySlotChange=t=>{this.tertiarySlotHasElements=Wo(t)},this.handleMenuActionSlotChange=t=>{this.isPrimaryLevel()&&(this.navigationActionSlotHasElements=Wo(t),this.navigationActionSlotHasElements&&(this.navigationAction=!1))},this.handleProgressSlotChange=t=>{this.isPrimaryLevel()&&(this.progressSlotHasElement=Wo(t))},this.label=void 0,this.navigationAction=!1,this.logoSlotHasElements=void 0,this.navigationActionSlotHasElements=void 0,this.primaryContentCenterSlotHasElements=void 0,this.primaryContentEndSlotHasElements=void 0,this.primaryContentStartSlotHasElements=void 0,this.progressSlotHasElement=void 0,this.secondarySlotHasElements=void 0,this.tertiarySlotHasElements=void 0,this.userSlotHasElements=void 0}async setFocus(){return await Ws(this),this.navigationActionEl?.setFocus()}componentWillLoad(){Hs(this)}componentDidLoad(){qs(this)}isPrimaryLevel(){return this.el.slot!==_a.navSecondary&&this.el.slot!==_a.navTertiary}renderMenuAction(){return H("slot",{name:_a.navigationAction,onSlotchange:this.handleMenuActionSlotChange},this.navigationAction&&H("calcite-action",{icon:$bt.hamburger,onClick:this.actionClickHandler,text:this.label,ref:t=>this.navigationActionEl=t}))}render(){const t=this.logoSlotHasElements||this.userSlotHasElements||this.navigationActionSlotHasElements||this.primaryContentCenterSlotHasElements||this.primaryContentEndSlotHasElements||this.primaryContentStartSlotHasElements||this.navigationAction,e=this.el.slot;return H(yo,null,H("div",{class:{[bm.container]:!0,[bm.secondary]:e===_a.navSecondary,[bm.tertiary]:e===_a.navTertiary,[bm.primary]:t}},H("div",{class:{[bm.hide]:!this.progressSlotHasElement,[_a.progress]:!0}},H("slot",{name:_a.progress,onSlotchange:this.handleProgressSlotChange})),H("div",{class:{[bm.containerContent]:!0,[bm.hasProgress]:this.progressSlotHasElement}},this.renderMenuAction(),H("div",{class:{[bm.hide]:!this.logoSlotHasElements,[_a.logo]:!0}},H("slot",{name:_a.logo,onSlotchange:this.handleLogoSlotChange})),H("slot",{name:_a.contentStart,onSlotchange:this.handleContentStartSlotChange}),H("slot",{name:_a.contentCenter,onSlotchange:this.handleContentCenterSlotChange}),H("slot",{name:_a.contentEnd,onSlotchange:this.handleContentEndSlotChange}),H("div",{class:{[bm.hide]:!this.userSlotHasElements,[_a.user]:!0}},H("slot",{name:_a.user,onSlotchange:this.handleUserSlotChange})))),H(ZR,null,H("slot",{name:_a.navSecondary,onSlotchange:this.handleSecondarySlotChange}),H("slot",{name:_a.navTertiary,onSlotchange:this.handleTertiarySlotChange})))}get el(){return this}static get style(){return Ibt}},[1,"calcite-navigation",{label:[1],navigationAction:[516,"navigation-action"],logoSlotHasElements:[32],navigationActionSlotHasElements:[32],primaryContentCenterSlotHasElements:[32],primaryContentEndSlotHasElements:[32],primaryContentStartSlotHasElements:[32],progressSlotHasElement:[32],secondarySlotHasElements:[32],tertiarySlotHasElements:[32],userSlotHasElements:[32],setFocus:[64]}]);function Dbt(){if(typeof customElements>"u")return;["calcite-navigation","calcite-action","calcite-icon","calcite-loader"].forEach(e=>{switch(e){case"calcite-navigation":customElements.get(e)||customElements.define(e,Lbt);break;case"calcite-action":customElements.get(e)||xw();break;case"calcite-icon":customElements.get(e)||Ba();break;case"calcite-loader":customElements.get(e)||em();break}})}Dbt();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const F0={container:"container",heading:"heading",description:"description",anchor:"anchor",image:"image",standalone:"standalone"},Nbt=`:host{display:inline-flex;outline:2px solid transparent;outline-offset:2px}.anchor{margin:0px;display:flex;cursor:pointer;align-items:center;justify-content:center;font-size:var(--calcite-font-size-0);line-height:1.25rem;text-decoration-line:none;outline-color:transparent;transition:all var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s;border-block-end:2px solid transparent}.anchor:hover,.anchor:focus{background-color:var(--calcite-ui-foreground-2)}.anchor:focus{outline:2px solid var(--calcite-ui-focus-color, var(--calcite-ui-brand));outline-offset:calc(
            -2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-ui-focus-offset-invert),
                1
              )
            )
          )}.anchor:active{background-color:var(--calcite-ui-foreground-3)}.image{margin:0px;display:flex;block-size:1.75rem;padding-inline:1rem}.image~.container{padding-inline-start:0px}:host(:active) .anchor{color:var(--calcite-ui-text-1)}:host([active]) .anchor{color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-brand);--calcite-ui-icon-color:var(--calcite-ui-brand)}.container{margin-block-start:0.125rem;display:flex;flex-direction:column;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding-inline:1rem;text-align:start}.heading{margin-inline-start:0px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:var(--calcite-font-size-0);font-weight:var(--calcite-font-weight-medium);color:var(--calcite-ui-text-1)}.standalone{font-size:var(--calcite-font-size-1)}.description{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:var(--calcite-ui-text-2);font-size:var(--calcite-font-size--1)}:host([hidden]){display:none}[hidden]{display:none}`,Fbt=ln(class extends cn{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.active=void 0,this.href=void 0,this.label=void 0,this.rel=void 0,this.description=void 0,this.target=void 0,this.heading=void 0,this.thumbnail=void 0}async setFocus(){await Ws(this),this.href&&this.el.focus()}componentWillLoad(){Hs(this)}componentDidLoad(){qs(this)}render(){const{heading:t,description:e,thumbnail:i}=this;return H(yo,null,H("a",{class:F0.anchor,href:this.href,rel:this.rel,target:this.target},i&&H("img",{alt:this.label||"",class:F0.image,src:i}),(t||e)&&H("div",{class:F0.container},t&&H("span",{"aria-label":this.heading,class:{[F0.heading]:!0,[F0.standalone]:!this.description},key:F0.heading},t),e&&H("span",{"aria-label":this.description,class:F0.description,key:F0.description},e))))}static get delegatesFocus(){return!0}get el(){return this}static get style(){return Nbt}},[17,"calcite-navigation-logo",{active:[516],href:[513],label:[1],rel:[513],description:[1],target:[513],heading:[1],thumbnail:[1],setFocus:[64]}]);function kbt(){if(typeof customElements>"u")return;["calcite-navigation-logo"].forEach(e=>{switch(e){case"calcite-navigation-logo":customElements.get(e)||customElements.define(e,Fbt);break}})}kbt();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const Ubt=/^#[0-9A-F]{3}$/i,zbt=/^#[0-9A-F]{6}$/i,Bbt=/^#[0-9A-F]{4}$/i,Vbt=/^#[0-9A-F]{8}$/i;function aH(t,e=!1){return Gbt(t,e)||jbt(t,e)}function O3e(t,e,i){return t?t.length===e&&i.test(t):!1}function Gbt(t,e=!1){return O3e(t,e?5:4,e?Bbt:Ubt)}function jbt(t,e=!1){return O3e(t,e?9:7,e?Vbt:zbt)}function Hbt(t,e=!1){if(!aH(t,e))return null;t=t.replace("#","");let i,r,n,s;if(t.length===3||t.length===4){const[a,l,c,u]=t.split("");i=parseInt(`${a}${a}`,16),r=parseInt(`${l}${l}`,16),n=parseInt(`${c}${c}`,16),s=parseInt(`${u}${u}`,16)/255}else i=parseInt(t.slice(0,2),16),r=parseInt(t.slice(2,4),16),n=parseInt(t.slice(4,6),16),s=parseInt(t.slice(6,8),16)/255;return isNaN(s)?{r:i,g:r,b:n}:{r:i,g:r,b:n,a:s}}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */function qbt(t){let e=0;for(let r=0;r<t.length;r++)e=t.charCodeAt(r)+((e<<5)-e);let i="#";for(let r=0;r<3;r++){const n=e>>r*8&255;i+=("00"+n.toString(16)).substr(-2)}return i}function Wbt(t){let{r:e,g:i,b:r}=t;e/=255,i/=255,r/=255;const n=Math.max(e,i,r),s=Math.min(e,i,r),o=n-s;if(n===s)return 0;let a=(n+s)/2;switch(n){case e:a=(i-r)/o+(i<r?6:0);break;case i:a=(r-e)/o+2;break;case r:a=(e-i)/o+4;break}return Math.round(a*60)}function Ybt(t){return Wbt(Hbt(t))}const Xbt=":host{display:inline-block;overflow:hidden;border-radius:50%}:host([scale=s]){block-size:1.5rem;inline-size:1.5rem;font-size:var(--calcite-font-size--3)}:host([scale=m]){block-size:2rem;inline-size:2rem;font-size:var(--calcite-font-size--2)}:host([scale=l]){block-size:2.75rem;inline-size:2.75rem;font-size:var(--calcite-font-size-0)}.icon{display:flex}.background{display:flex;block-size:100%;inline-size:100%;align-items:center;justify-content:center;border-radius:50%}.initials{font-weight:var(--calcite-font-weight-bold);text-transform:uppercase;color:var(--calcite-ui-text-2)}.thumbnail{block-size:100%;inline-size:100%;border-radius:50%}:host([hidden]){display:none}[hidden]{display:none}",Zbt=ln(class extends cn{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.scale="m",this.thumbnail=void 0,this.fullName=void 0,this.username=void 0,this.userId=void 0,this.label=void 0,this.thumbnailFailedToLoad=!1}render(){return this.determineContent()}determineContent(){if(this.thumbnail&&!this.thumbnailFailedToLoad)return H("img",{alt:this.label||"",class:"thumbnail",onError:()=>this.thumbnailFailedToLoad=!0,src:this.thumbnail});const t=this.generateInitials(),e=this.generateFillColor();return H("span",{"aria-label":this.label||this.fullName,class:"background",role:"figure",style:{backgroundColor:e}},t?H("span",{"aria-hidden":"true",class:"initials"},t):H("calcite-icon",{class:"icon",icon:"user",scale:this.scale}))}generateFillColor(){const{userId:t,username:e,fullName:i,el:r}=this,n=kvt(r),s=t&&`#${t.substr(t.length-6)}`,o=e||i||"",a=s&&aH(s)?s:qbt(o);return!t&&!o||!aH(a)?"var(--calcite-ui-foreground-2)":`hsl(${Ybt(a)}, 60%, ${n==="dark"?20:90}%)`}generateInitials(){const{fullName:t,username:e}=this;return t?t.trim().split(" ").map(i=>i.substring(0,1)).join(""):e?e.substring(0,2):!1}get el(){return this}static get style(){return Xbt}},[1,"calcite-avatar",{scale:[513],thumbnail:[513],fullName:[513,"full-name"],username:[513],userId:[513,"user-id"],label:[1],thumbnailFailedToLoad:[32]}]);function R3e(){if(typeof customElements>"u")return;["calcite-avatar","calcite-icon"].forEach(e=>{switch(e){case"calcite-avatar":customElements.get(e)||customElements.define(e,Zbt);break;case"calcite-icon":customElements.get(e)||Ba();break}})}R3e();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const Nx={textContainer:"text-container",fullName:"full-name",username:"username",button:"button"},Jbt=`:host{display:inline-flex;outline:2px solid transparent;outline-offset:2px}:host .button{background-color:transparent;border:none;margin:0px;display:flex;cursor:pointer;align-items:center;justify-content:center;font-family:var(--calcite-sans-family);font-size:var(--calcite-font-size-0);line-height:1.25rem;outline-color:transparent;transition:all var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s;border-block-end:2px solid transparent}:host(:hover) .button,:host(:focus) .button{background-color:var(--calcite-ui-foreground-2)}:host(:focus) .button{outline:2px solid var(--calcite-ui-focus-color, var(--calcite-ui-brand));outline-offset:calc(
            -2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-ui-focus-offset-invert),
                1
              )
            )
          )}:host(:active) .button{background-color:var(--calcite-ui-foreground-3);color:var(--calcite-ui-text-1)}calcite-avatar{padding-inline:1rem}calcite-avatar~.text-container{padding-inline-start:0px}:host([active]) .button{border-color:var(--calcite-ui-brand);color:var(--calcite-ui-text-1);--calcite-ui-icon-color:var(--calcite-ui-brand)}.text-container{margin-block-start:0.125rem;display:flex;flex-direction:column;padding-inline:1rem;text-align:start}.full-name{margin-inline-start:0px;font-size:var(--calcite-font-size-0);font-weight:var(--calcite-font-weight-medium);color:var(--calcite-ui-text-1)}.username{color:var(--calcite-ui-text-2);font-size:var(--calcite-font-size--1)}:host([hidden]){display:none}[hidden]{display:none}`,Kbt=ln(class extends cn{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.active=void 0,this.fullName=void 0,this.label=void 0,this.textDisabled=!1,this.thumbnail=void 0,this.userId=void 0,this.username=void 0}async setFocus(){await Ws(this),this.el.focus()}componentWillLoad(){Hs(this)}componentDidLoad(){qs(this)}render(){return H(yo,null,H("button",{"aria-label":this.label,class:Nx.button},H("calcite-avatar",{"full-name":this.fullName,label:this.label,thumbnail:this.thumbnail,"user-id":this.userId,username:this.username}),(this.fullName||this.username)&&!this.textDisabled&&H("div",{class:Nx.textContainer},this.fullName&&H("span",{class:Nx.fullName,key:Nx.fullName},this.fullName),this.username&&H("span",{class:Nx.username,key:Nx.username},this.username))))}static get delegatesFocus(){return!0}get el(){return this}static get style(){return Jbt}},[17,"calcite-navigation-user",{active:[516],fullName:[1,"full-name"],label:[1],textDisabled:[516,"text-disabled"],thumbnail:[1],userId:[1,"user-id"],username:[1],setFocus:[64]}]);function Qbt(){if(typeof customElements>"u")return;["calcite-navigation-user","calcite-avatar","calcite-icon"].forEach(e=>{switch(e){case"calcite-navigation-user":customElements.get(e)||customElements.define(e,Kbt);break;case"calcite-avatar":customElements.get(e)||R3e();break;case"calcite-icon":customElements.get(e)||Ba();break}})}Qbt();var ewt=Object.defineProperty,twt=Object.getOwnPropertyDescriptor,nJ=(t,e,i,r)=>{for(var n=r>1?void 0:r?twt(e,i):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(n=(r?o(e,i,n):o(n))||n);return r&&n&&ewt(e,i,n),n};let qO=class extends VO{constructor(t){super(t),this.userMenuOpen=!1,this.closeUserMenu=()=>{this.userMenuOpen=!1};const e=t.store.view.container;e.addEventListener("mousedown",this.closeUserMenu),this.addHandles([{remove:()=>{e.removeEventListener("mousedown",this.closeUserMenu)}}])}signOut(){this.store.userStore.signOut(),this.closeUserMenu()}openScene(){const t=this.store.map.portalItem.itemPageUrl;t&&window.open(t,"new")}render(){const t=this.userMenuOpen?"":"hide";return Ne("div",null,Ne("calcite-navigation",{slot:"header"},Ne("calcite-navigation-logo",{slot:"logo",heading:this.store.map.portalItem.title,description:"ArcGIS Maps SDK for JavaScript",thumbnail:"./icon-64.svg",onclick:()=>{this.openScene()}}),this.renderUserProfile()),Ne("calcite-menu",{id:"user-menu",layout:"vertical",label:"Application menu",class:t},Ne("calcite-menu-item",{"icon-start":"sign-out",text:"Sign Out",onclick:()=>this.signOut()})))}renderUserProfile(){const t=this.store.userStore;if(t.authenticated){const e=t.user;return Ne("calcite-navigation-user",{slot:"user",active:this.userMenuOpen,onclick:()=>{this.userMenuOpen=!this.userMenuOpen},thumbnail:e?.thumbnailUrl,"full-name":e?.fullName,username:e?.username})}else return Ne("calcite-menu",{slot:"content-end"},Ne("calcite-menu-item",{onclick:()=>t.signIn(),text:"Sign in","icon-start":"user","text-enabled":!0}))}};nJ([f()],qO.prototype,"store",2);nJ([f()],qO.prototype,"userMenuOpen",2);qO=nJ([z("arcgis-core-template.Header")],qO);const iwt=qO;/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const zce=new Set;let AT;const P3e={childList:!0};function M3e(t){AT||(AT=hc("mutation",I3e)),AT.observe(t.el,P3e)}function $3e(t){zce.delete(t.el),I3e(AT.takeRecords()),AT.disconnect();for(const[e]of zce.entries())AT.observe(e,P3e)}function I3e(t){t.forEach(({target:e})=>{QS(e)})}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const sJ=(t,e)=>{const i=t.level?`h${t.level}`:"div";return delete t.level,H(i,{...t},e)};/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */function q5(t){return"opened"in t?t.opened:t.open}function Bce(t,e=!1){(e?t[t.transitionProp]:q5(t))?t.onBeforeOpen():t.onBeforeClose(),(e?t[t.transitionProp]:q5(t))?t.onOpen():t.onClose()}function TS(t,e=!1){_vt(()=>{if(t.transitionEl){let c=function(d){d.propertyName===t.openTransitionProp&&d.target===t.transitionEl&&(clearTimeout(l),t.transitionEl.removeEventListener("transitionstart",c),(e?t[t.transitionProp]:q5(t))?t.onBeforeOpen():t.onBeforeClose())},u=function(d){d.propertyName===t.openTransitionProp&&d.target===t.transitionEl&&((e?t[t.transitionProp]:q5(t))?t.onOpen():t.onClose(),t.transitionEl.removeEventListener("transitionend",u),t.transitionEl.removeEventListener("transitioncancel",u))};const{transitionDuration:i,transitionProperty:r}=getComputedStyle(t.transitionEl),n=i.split(","),o=r.split(",").indexOf(t.openTransitionProp),a=n[o]??n[0];if(a==="0s"){Bce(t,e);return}const l=setTimeout(()=>{t.transitionEl.removeEventListener("transitionstart",c),t.transitionEl.removeEventListener("transitionend",u),t.transitionEl.removeEventListener("transitioncancel",u),Bce(t,e)},parseFloat(a)*1e3);t.transitionEl.addEventListener("transitionstart",c),t.transitionEl.addEventListener("transitionend",u),t.transitionEl.addEventListener("transitioncancel",u)}})}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */function W5(t,e){return(t+e)%e}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */var rwt=typeof global=="object"&&global&&global.Object===Object&&global,nwt=typeof self=="object"&&self&&self.Object===Object&&self,L3e=rwt||nwt||Function("return this")(),Y5=L3e.Symbol,D3e=Object.prototype,swt=D3e.hasOwnProperty,owt=D3e.toString,aC=Y5?Y5.toStringTag:void 0;function awt(t){var e=swt.call(t,aC),i=t[aC];try{t[aC]=void 0;var r=!0}catch{}var n=owt.call(t);return r&&(e?t[aC]=i:delete t[aC]),n}var lwt=Object.prototype,cwt=lwt.toString;function uwt(t){return cwt.call(t)}var hwt="[object Null]",dwt="[object Undefined]",Vce=Y5?Y5.toStringTag:void 0;function pwt(t){return t==null?t===void 0?dwt:hwt:Vce&&Vce in Object(t)?awt(t):uwt(t)}function fwt(t){return t!=null&&typeof t=="object"}var mwt="[object Symbol]";function gwt(t){return typeof t=="symbol"||fwt(t)&&pwt(t)==mwt}var ywt=/\s/;function _wt(t){for(var e=t.length;e--&&ywt.test(t.charAt(e)););return e}var vwt=/^\s+/;function bwt(t){return t&&t.slice(0,_wt(t)+1).replace(vwt,"")}function lH(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var Gce=0/0,wwt=/^[-+]0x[0-9a-f]+$/i,xwt=/^0b[01]+$/i,Twt=/^0o[0-7]+$/i,Swt=parseInt;function jce(t){if(typeof t=="number")return t;if(gwt(t))return Gce;if(lH(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=lH(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=bwt(t);var i=xwt.test(t);return i||Twt.test(t)?Swt(t.slice(2),i?2:8):wwt.test(t)?Gce:+t}var Uz=function(){return L3e.Date.now()},Ewt="Expected a function",Cwt=Math.max,Awt=Math.min;function Owt(t,e,i){var r,n,s,o,a,l,c=0,u=!1,d=!1,p=!0;if(typeof t!="function")throw new TypeError(Ewt);e=jce(e)||0,lH(i)&&(u=!!i.leading,d="maxWait"in i,s=d?Cwt(jce(i.maxWait)||0,e):s,p="trailing"in i?!!i.trailing:p);function m(A){var P=r,N=n;return r=n=void 0,c=A,o=t.apply(N,P),o}function y(A){return c=A,a=setTimeout(w,e),u?m(A):o}function _(A){var P=A-l,N=A-c,F=e-P;return d?Awt(F,s-N):F}function v(A){var P=A-l,N=A-c;return l===void 0||P>=e||P<0||d&&N>=s}function w(){var A=Uz();if(v(A))return x(A);a=setTimeout(w,_(A))}function x(A){return a=void 0,p&&r?m(A):(r=n=void 0,o)}function T(){a!==void 0&&clearTimeout(a),c=0,r=l=n=a=void 0}function S(){return a===void 0?o:x(Uz())}function E(){var A=Uz(),P=v(A);if(r=arguments,n=this,l=A,P){if(a===void 0)return y(l);if(d)return clearTimeout(a),a=setTimeout(w,e),m(l)}return a===void 0&&(a=setTimeout(w,e)),o}return E.cancel=T,E.flush=S,E}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const N3e=["top","right","bottom","left"],Hce=["start","end"],qce=N3e.reduce((t,e)=>t.concat(e,e+"-"+Hce[0],e+"-"+Hce[1]),[]),SS=Math.min,ub=Math.max,X5=Math.round,nI=Math.floor,w_=t=>({x:t,y:t}),Rwt={left:"right",right:"left",bottom:"top",top:"bottom"},Pwt={start:"end",end:"start"};function cH(t,e,i){return ub(t,SS(e,i))}function Tw(t,e){return typeof t=="function"?t(e):t}function Ig(t){return t.split("-")[0]}function Rf(t){return t.split("-")[1]}function F3e(t){return t==="x"?"y":"x"}function oJ(t){return t==="y"?"height":"width"}function Dk(t){return["top","bottom"].includes(Ig(t))?"y":"x"}function aJ(t){return F3e(Dk(t))}function k3e(t,e,i){i===void 0&&(i=!1);const r=Rf(t),n=aJ(t),s=oJ(n);let o=n==="x"?r===(i?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(o=J5(o)),[o,J5(o)]}function Mwt(t){const e=J5(t);return[Z5(t),e,Z5(e)]}function Z5(t){return t.replace(/start|end/g,e=>Pwt[e])}function $wt(t,e,i){const r=["left","right"],n=["right","left"],s=["top","bottom"],o=["bottom","top"];switch(t){case"top":case"bottom":return i?e?n:r:e?r:n;case"left":case"right":return e?s:o;default:return[]}}function Iwt(t,e,i,r){const n=Rf(t);let s=$wt(Ig(t),i==="start",r);return n&&(s=s.map(o=>o+"-"+n),e&&(s=s.concat(s.map(Z5)))),s}function J5(t){return t.replace(/left|right|bottom|top/g,e=>Rwt[e])}function Lwt(t){return{top:0,right:0,bottom:0,left:0,...t}}function U3e(t){return typeof t!="number"?Lwt(t):{top:t,right:t,bottom:t,left:t}}function K5(t){return{...t,top:t.y,left:t.x,right:t.x+t.width,bottom:t.y+t.height}}function Wce(t,e,i){let{reference:r,floating:n}=t;const s=Dk(e),o=aJ(e),a=oJ(o),l=Ig(e),c=s==="y",u=r.x+r.width/2-n.width/2,d=r.y+r.height/2-n.height/2,p=r[a]/2-n[a]/2;let m;switch(l){case"top":m={x:u,y:r.y-n.height};break;case"bottom":m={x:u,y:r.y+r.height};break;case"right":m={x:r.x+r.width,y:d};break;case"left":m={x:r.x-n.width,y:d};break;default:m={x:r.x,y:r.y}}switch(Rf(e)){case"start":m[o]-=p*(i&&c?-1:1);break;case"end":m[o]+=p*(i&&c?-1:1);break}return m}const Dwt=async(t,e,i)=>{const{placement:r="bottom",strategy:n="absolute",middleware:s=[],platform:o}=i,a=s.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(e));let c=await o.getElementRects({reference:t,floating:e,strategy:n}),{x:u,y:d}=Wce(c,r,l),p=r,m={},y=0;for(let _=0;_<a.length;_++){const{name:v,fn:w}=a[_],{x,y:T,data:S,reset:E}=await w({x:u,y:d,initialPlacement:r,placement:p,strategy:n,middlewareData:m,rects:c,platform:o,elements:{reference:t,floating:e}});if(u=x??u,d=T??d,m={...m,[v]:{...m[v],...S}},E&&y<=50){y++,typeof E=="object"&&(E.placement&&(p=E.placement),E.rects&&(c=E.rects===!0?await o.getElementRects({reference:t,floating:e,strategy:n}):E.rects),{x:u,y:d}=Wce(c,p,l)),_=-1;continue}}return{x:u,y:d,placement:p,strategy:n,middlewareData:m}};async function WO(t,e){var i;e===void 0&&(e={});const{x:r,y:n,platform:s,rects:o,elements:a,strategy:l}=t,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:p=!1,padding:m=0}=Tw(e,t),y=U3e(m),v=a[p?d==="floating"?"reference":"floating":d],w=K5(await s.getClippingRect({element:(i=await(s.isElement==null?void 0:s.isElement(v)))==null||i?v:v.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),x=d==="floating"?{...o.floating,x:r,y:n}:o.reference,T=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),S=await(s.isElement==null?void 0:s.isElement(T))?await(s.getScale==null?void 0:s.getScale(T))||{x:1,y:1}:{x:1,y:1},E=K5(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({rect:x,offsetParent:T,strategy:l}):x);return{top:(w.top-E.top+y.top)/S.y,bottom:(E.bottom-w.bottom+y.bottom)/S.y,left:(w.left-E.left+y.left)/S.x,right:(E.right-w.right+y.right)/S.x}}const Nwt=t=>({name:"arrow",options:t,async fn(e){const{x:i,y:r,placement:n,rects:s,platform:o,elements:a,middlewareData:l}=e,{element:c,padding:u=0}=Tw(t,e)||{};if(c==null)return{};const d=U3e(u),p={x:i,y:r},m=aJ(n),y=oJ(m),_=await o.getDimensions(c),v=m==="y",w=v?"top":"left",x=v?"bottom":"right",T=v?"clientHeight":"clientWidth",S=s.reference[y]+s.reference[m]-p[m]-s.floating[y],E=p[m]-s.reference[m],A=await(o.getOffsetParent==null?void 0:o.getOffsetParent(c));let P=A?A[T]:0;(!P||!await(o.isElement==null?void 0:o.isElement(A)))&&(P=a.floating[T]||s.floating[y]);const N=S/2-E/2,F=P/2-_[y]/2-1,D=SS(d[w],F),$=SS(d[x],F),R=D,k=P-_[y]-$,B=P/2-_[y]/2+N,j=cH(R,B,k),X=!l.arrow&&Rf(n)!=null&&B!=j&&s.reference[y]/2-(B<R?D:$)-_[y]/2<0,M=X?B<R?B-R:B-k:0;return{[m]:p[m]+M,data:{[m]:j,centerOffset:B-j-M,...X&&{alignmentOffset:M}},reset:X}}});function Fwt(t,e,i){return(t?[...i.filter(n=>Rf(n)===t),...i.filter(n=>Rf(n)!==t)]:i.filter(n=>Ig(n)===n)).filter(n=>t?Rf(n)===t||(e?Z5(n)!==n:!1):!0)}const kwt=function(t){return t===void 0&&(t={}),{name:"autoPlacement",options:t,async fn(e){var i,r,n;const{rects:s,middlewareData:o,placement:a,platform:l,elements:c}=e,{crossAxis:u=!1,alignment:d,allowedPlacements:p=qce,autoAlignment:m=!0,...y}=Tw(t,e),_=d!==void 0||p===qce?Fwt(d||null,m,p):p,v=await WO(e,y),w=((i=o.autoPlacement)==null?void 0:i.index)||0,x=_[w];if(x==null)return{};const T=k3e(x,s,await(l.isRTL==null?void 0:l.isRTL(c.floating)));if(a!==x)return{reset:{placement:_[0]}};const S=[v[Ig(x)],v[T[0]],v[T[1]]],E=[...((r=o.autoPlacement)==null?void 0:r.overflows)||[],{placement:x,overflows:S}],A=_[w+1];if(A)return{data:{index:w+1,overflows:E},reset:{placement:A}};const P=E.map(D=>{const $=Rf(D.placement);return[D.placement,$&&u?D.overflows.slice(0,2).reduce((R,k)=>R+k,0):D.overflows[0],D.overflows]}).sort((D,$)=>D[1]-$[1]),F=((n=P.filter(D=>D[2].slice(0,Rf(D[0])?2:3).every($=>$<=0))[0])==null?void 0:n[0])||P[0][0];return F!==a?{data:{index:w+1,overflows:E},reset:{placement:F}}:{}}}},Yce=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var i,r;const{placement:n,middlewareData:s,rects:o,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:p,fallbackStrategy:m="bestFit",fallbackAxisSideDirection:y="none",flipAlignment:_=!0,...v}=Tw(t,e);if((i=s.arrow)!=null&&i.alignmentOffset)return{};const w=Ig(n),x=Ig(a)===a,T=await(l.isRTL==null?void 0:l.isRTL(c.floating)),S=p||(x||!_?[J5(a)]:Mwt(a));!p&&y!=="none"&&S.push(...Iwt(a,_,y,T));const E=[a,...S],A=await WO(e,v),P=[];let N=((r=s.flip)==null?void 0:r.overflows)||[];if(u&&P.push(A[w]),d){const R=k3e(n,o,T);P.push(A[R[0]],A[R[1]])}if(N=[...N,{placement:n,overflows:P}],!P.every(R=>R<=0)){var F,D;const R=(((F=s.flip)==null?void 0:F.index)||0)+1,k=E[R];if(k)return{data:{index:R,overflows:N},reset:{placement:k}};let B=(D=N.filter(j=>j.overflows[0]<=0).sort((j,X)=>j.overflows[1]-X.overflows[1])[0])==null?void 0:D.placement;if(!B)switch(m){case"bestFit":{var $;const j=($=N.map(X=>[X.placement,X.overflows.filter(M=>M>0).reduce((M,I)=>M+I,0)]).sort((X,M)=>X[1]-M[1])[0])==null?void 0:$[0];j&&(B=j);break}case"initialPlacement":B=a;break}if(n!==B)return{reset:{placement:B}}}return{}}}};function Xce(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function Zce(t){return N3e.some(e=>t[e]>=0)}const Uwt=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:i}=e,{strategy:r="referenceHidden",...n}=Tw(t,e);switch(r){case"referenceHidden":{const s=await WO(e,{...n,elementContext:"reference"}),o=Xce(s,i.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:Zce(o)}}}case"escaped":{const s=await WO(e,{...n,altBoundary:!0}),o=Xce(s,i.floating);return{data:{escapedOffsets:o,escaped:Zce(o)}}}default:return{}}}}};async function zwt(t,e){const{placement:i,platform:r,elements:n}=t,s=await(r.isRTL==null?void 0:r.isRTL(n.floating)),o=Ig(i),a=Rf(i),l=Dk(i)==="y",c=["left","top"].includes(o)?-1:1,u=s&&l?-1:1,d=Tw(e,t);let{mainAxis:p,crossAxis:m,alignmentAxis:y}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...d};return a&&typeof y=="number"&&(m=a==="end"?y*-1:y),l?{x:m*u,y:p*c}:{x:p*c,y:m*u}}const Bwt=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){const{x:i,y:r}=e,n=await zwt(e,t);return{x:i+n.x,y:r+n.y,data:n}}}},Vwt=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:i,y:r,placement:n}=e,{mainAxis:s=!0,crossAxis:o=!1,limiter:a={fn:v=>{let{x:w,y:x}=v;return{x:w,y:x}}},...l}=Tw(t,e),c={x:i,y:r},u=await WO(e,l),d=Dk(Ig(n)),p=F3e(d);let m=c[p],y=c[d];if(s){const v=p==="y"?"top":"left",w=p==="y"?"bottom":"right",x=m+u[v],T=m-u[w];m=cH(x,m,T)}if(o){const v=d==="y"?"top":"left",w=d==="y"?"bottom":"right",x=y+u[v],T=y-u[w];y=cH(x,y,T)}const _=a.fn({...e,[p]:m,[d]:y});return{..._,data:{x:_.x-i,y:_.y-r}}}}};function x_(t){return z3e(t)?(t.nodeName||"").toLowerCase():"#document"}function au(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function Zg(t){var e;return(e=(z3e(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function z3e(t){return t instanceof Node||t instanceof au(t).Node}function Lg(t){return t instanceof Element||t instanceof au(t).Element}function Uf(t){return t instanceof HTMLElement||t instanceof au(t).HTMLElement}function Jce(t){return typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof au(t).ShadowRoot}function rP(t){const{overflow:e,overflowX:i,overflowY:r,display:n}=Th(t);return/auto|scroll|overlay|hidden|clip/.test(e+r+i)&&!["inline","contents"].includes(n)}function Gwt(t){return["table","td","th"].includes(x_(t))}function lJ(t){const e=cJ(),i=Th(t);return i.transform!=="none"||i.perspective!=="none"||(i.containerType?i.containerType!=="normal":!1)||!e&&(i.backdropFilter?i.backdropFilter!=="none":!1)||!e&&(i.filter?i.filter!=="none":!1)||["transform","perspective","filter"].some(r=>(i.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(i.contain||"").includes(r))}function jwt(t){let e=ES(t);for(;Uf(e)&&!Nk(e);){if(lJ(e))return e;e=ES(e)}return null}function cJ(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Nk(t){return["html","body","#document"].includes(x_(t))}function Th(t){return au(t).getComputedStyle(t)}function Fk(t){return Lg(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function ES(t){if(x_(t)==="html")return t;const e=t.assignedSlot||t.parentNode||Jce(t)&&t.host||Zg(t);return Jce(e)?e.host:e}function B3e(t){const e=ES(t);return Nk(e)?t.ownerDocument?t.ownerDocument.body:t.body:Uf(e)&&rP(e)?e:B3e(e)}function YO(t,e,i){var r;e===void 0&&(e=[]),i===void 0&&(i=!0);const n=B3e(t),s=n===((r=t.ownerDocument)==null?void 0:r.body),o=au(n);return s?e.concat(o,o.visualViewport||[],rP(n)?n:[],o.frameElement&&i?YO(o.frameElement):[]):e.concat(n,YO(n,[],i))}function V3e(t){const e=Th(t);let i=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const n=Uf(t),s=n?t.offsetWidth:i,o=n?t.offsetHeight:r,a=X5(i)!==s||X5(r)!==o;return a&&(i=s,r=o),{width:i,height:r,$:a}}function uJ(t){return Lg(t)?t:t.contextElement}function OT(t){const e=uJ(t);if(!Uf(e))return w_(1);const i=e.getBoundingClientRect(),{width:r,height:n,$:s}=V3e(e);let o=(s?X5(i.width):i.width)/r,a=(s?X5(i.height):i.height)/n;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const Hwt=w_(0);function G3e(t){const e=au(t);return!cJ()||!e.visualViewport?Hwt:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function qwt(t,e,i){return e===void 0&&(e=!1),!i||e&&i!==au(t)?!1:e}function Kb(t,e,i,r){e===void 0&&(e=!1),i===void 0&&(i=!1);const n=t.getBoundingClientRect(),s=uJ(t);let o=w_(1);e&&(r?Lg(r)&&(o=OT(r)):o=OT(t));const a=qwt(s,i,r)?G3e(s):w_(0);let l=(n.left+a.x)/o.x,c=(n.top+a.y)/o.y,u=n.width/o.x,d=n.height/o.y;if(s){const p=au(s),m=r&&Lg(r)?au(r):r;let y=p.frameElement;for(;y&&r&&m!==p;){const _=OT(y),v=y.getBoundingClientRect(),w=Th(y),x=v.left+(y.clientLeft+parseFloat(w.paddingLeft))*_.x,T=v.top+(y.clientTop+parseFloat(w.paddingTop))*_.y;l*=_.x,c*=_.y,u*=_.x,d*=_.y,l+=x,c+=T,y=au(y).frameElement}}return K5({width:u,height:d,x:l,y:c})}function Wwt(t){let{rect:e,offsetParent:i,strategy:r}=t;const n=Uf(i),s=Zg(i);if(i===s)return e;let o={scrollLeft:0,scrollTop:0},a=w_(1);const l=w_(0);if((n||!n&&r!=="fixed")&&((x_(i)!=="body"||rP(s))&&(o=Fk(i)),Uf(i))){const c=Kb(i);a=OT(i),l.x=c.x+i.clientLeft,l.y=c.y+i.clientTop}return{width:e.width*a.x,height:e.height*a.y,x:e.x*a.x-o.scrollLeft*a.x+l.x,y:e.y*a.y-o.scrollTop*a.y+l.y}}function Ywt(t){return Array.from(t.getClientRects())}function j3e(t){return Kb(Zg(t)).left+Fk(t).scrollLeft}function Xwt(t){const e=Zg(t),i=Fk(t),r=t.ownerDocument.body,n=ub(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),s=ub(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let o=-i.scrollLeft+j3e(t);const a=-i.scrollTop;return Th(r).direction==="rtl"&&(o+=ub(e.clientWidth,r.clientWidth)-n),{width:n,height:s,x:o,y:a}}function Zwt(t,e){const i=au(t),r=Zg(t),n=i.visualViewport;let s=r.clientWidth,o=r.clientHeight,a=0,l=0;if(n){s=n.width,o=n.height;const c=cJ();(!c||c&&e==="fixed")&&(a=n.offsetLeft,l=n.offsetTop)}return{width:s,height:o,x:a,y:l}}function Jwt(t,e){const i=Kb(t,!0,e==="fixed"),r=i.top+t.clientTop,n=i.left+t.clientLeft,s=Uf(t)?OT(t):w_(1),o=t.clientWidth*s.x,a=t.clientHeight*s.y,l=n*s.x,c=r*s.y;return{width:o,height:a,x:l,y:c}}function Kce(t,e,i){let r;if(e==="viewport")r=Zwt(t,i);else if(e==="document")r=Xwt(Zg(t));else if(Lg(e))r=Jwt(e,i);else{const n=G3e(t);r={...e,x:e.x-n.x,y:e.y-n.y}}return K5(r)}function H3e(t,e){const i=ES(t);return i===e||!Lg(i)||Nk(i)?!1:Th(i).position==="fixed"||H3e(i,e)}function Kwt(t,e){const i=e.get(t);if(i)return i;let r=YO(t,[],!1).filter(a=>Lg(a)&&x_(a)!=="body"),n=null;const s=Th(t).position==="fixed";let o=s?ES(t):t;for(;Lg(o)&&!Nk(o);){const a=Th(o),l=lJ(o);!l&&a.position==="fixed"&&(n=null),(s?!l&&!n:!l&&a.position==="static"&&!!n&&["absolute","fixed"].includes(n.position)||rP(o)&&!l&&H3e(t,o))?r=r.filter(u=>u!==o):n=a,o=ES(o)}return e.set(t,r),r}function Qwt(t){let{element:e,boundary:i,rootBoundary:r,strategy:n}=t;const o=[...i==="clippingAncestors"?Kwt(e,this._c):[].concat(i),r],a=o[0],l=o.reduce((c,u)=>{const d=Kce(e,u,n);return c.top=ub(d.top,c.top),c.right=SS(d.right,c.right),c.bottom=SS(d.bottom,c.bottom),c.left=ub(d.left,c.left),c},Kce(e,a,n));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function ext(t){return V3e(t)}function txt(t,e,i){const r=Uf(e),n=Zg(e),s=i==="fixed",o=Kb(t,!0,s,e);let a={scrollLeft:0,scrollTop:0};const l=w_(0);if(r||!r&&!s)if((x_(e)!=="body"||rP(n))&&(a=Fk(e)),r){const c=Kb(e,!0,s,e);l.x=c.x+e.clientLeft,l.y=c.y+e.clientTop}else n&&(l.x=j3e(n));return{x:o.left+a.scrollLeft-l.x,y:o.top+a.scrollTop-l.y,width:o.width,height:o.height}}function Qce(t,e){return!Uf(t)||Th(t).position==="fixed"?null:e?e(t):t.offsetParent}function q3e(t,e){const i=au(t);if(!Uf(t))return i;let r=Qce(t,e);for(;r&&Gwt(r)&&Th(r).position==="static";)r=Qce(r,e);return r&&(x_(r)==="html"||x_(r)==="body"&&Th(r).position==="static"&&!lJ(r))?i:r||jwt(t)||i}const ixt=async function(t){let{reference:e,floating:i,strategy:r}=t;const n=this.getOffsetParent||q3e,s=this.getDimensions;return{reference:txt(e,await n(i),r),floating:{x:0,y:0,...await s(i)}}};function rxt(t){return Th(t).direction==="rtl"}const uH={convertOffsetParentRelativeRectToViewportRelativeRect:Wwt,getDocumentElement:Zg,getClippingRect:Qwt,getOffsetParent:q3e,getElementRects:ixt,getClientRects:Ywt,getDimensions:ext,getScale:OT,isElement:Lg,isRTL:rxt};function nxt(t,e){let i=null,r;const n=Zg(t);function s(){clearTimeout(r),i&&i.disconnect(),i=null}function o(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),s();const{left:c,top:u,width:d,height:p}=t.getBoundingClientRect();if(a||e(),!d||!p)return;const m=nI(u),y=nI(n.clientWidth-(c+d)),_=nI(n.clientHeight-(u+p)),v=nI(c),x={rootMargin:-m+"px "+-y+"px "+-_+"px "+-v+"px",threshold:ub(0,SS(1,l))||1};let T=!0;function S(E){const A=E[0].intersectionRatio;if(A!==l){if(!T)return o();A?o(!1,A):r=setTimeout(()=>{o(!1,1e-7)},100)}T=!1}try{i=new IntersectionObserver(S,{...x,root:n.ownerDocument})}catch{i=new IntersectionObserver(S,x)}i.observe(t)}return o(!0),s}function sxt(t,e,i,r){r===void 0&&(r={});const{ancestorScroll:n=!0,ancestorResize:s=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,c=uJ(t),u=n||s?[...c?YO(c):[],...YO(e)]:[];u.forEach(w=>{n&&w.addEventListener("scroll",i,{passive:!0}),s&&w.addEventListener("resize",i)});const d=c&&a?nxt(c,i):null;let p=-1,m=null;o&&(m=new ResizeObserver(w=>{let[x]=w;x&&x.target===c&&m&&(m.unobserve(e),cancelAnimationFrame(p),p=requestAnimationFrame(()=>{m&&m.observe(e)})),i()}),c&&!l&&m.observe(c),m.observe(e));let y,_=l?Kb(t):null;l&&v();function v(){const w=Kb(t);_&&(w.x!==_.x||w.y!==_.y||w.width!==_.width||w.height!==_.height)&&i(),_=w,y=requestAnimationFrame(v)}return i(),()=>{u.forEach(w=>{n&&w.removeEventListener("scroll",i),s&&w.removeEventListener("resize",i)}),d&&d(),m&&m.disconnect(),m=null,l&&cancelAnimationFrame(y)}}const oxt=(t,e,i)=>{const r=new Map,n={platform:uH,...i},s={...n.platform,_c:r};return Dwt(t,e,{...n,platform:s})};function axt(t){return lxt(t)}function zz(t){return t.assignedSlot?t.assignedSlot:t.parentNode instanceof ShadowRoot?t.parentNode.host:t.parentNode}function lxt(t){for(let e=t;e;e=zz(e))if(e instanceof Element&&getComputedStyle(e).display==="none")return null;for(let e=zz(t);e;e=zz(e)){if(!(e instanceof Element))continue;const i=getComputedStyle(e);if(i.display!=="contents"&&(i.position!=="static"||i.filter!=="none"||e.tagName==="BODY"))return e}return null}(function(){{const e=uH.getOffsetParent;uH.getOffsetParent=i=>e(i,axt)}})();const W3e=async(t,{referenceEl:e,floatingEl:i,overlayPositioning:r="absolute",placement:n,flipDisabled:s,flipPlacements:o,offsetDistance:a,offsetSkidding:l,arrowEl:c,type:u})=>{if(!e||!i)return null;const{x:d,y:p,placement:m,strategy:y,middlewareData:_}=await oxt(e,i,{strategy:r,placement:n==="auto"||n==="auto-start"||n==="auto-end"?void 0:dxt(i,n),middleware:uxt({placement:n,flipDisabled:s,flipPlacements:o,offsetDistance:a,offsetSkidding:l,arrowEl:c,type:u})});if(c&&_.arrow){const{x:S,y:E}=_.arrow,A=m.split("-")[0],P=S!=null?"left":"top",N=mxt[A],F={left:"",top:"",bottom:"",right:""};"floatingLayout"in t&&(t.floatingLayout=A==="left"||A==="right"?"horizontal":"vertical"),Object.assign(c.style,{...F,[P]:`${P=="left"?S:E}px`,[A]:"100%",transform:N})}const w=_.hide?.referenceHidden?"hidden":null,x=w?"none":null;i.setAttribute(cxt,m);const T=`translate(${Math.round(d)}px,${Math.round(p)}px)`;Object.assign(i.style,{visibility:w,pointerEvents:x,position:y,top:"0",left:"0",transform:T})},cxt="data-placement",eue=100,tue=["top","bottom","right","left","top-start","top-end","bottom-start","bottom-end","right-start","right-end","left-start","left-end"],iue={animation:"calcite-floating-ui-anim",animationActive:"calcite-floating-ui-anim--active"};function uxt({placement:t,flipDisabled:e,flipPlacements:i,offsetDistance:r,offsetSkidding:n,arrowEl:s,type:o}){const a=[Vwt(),Uwt()];if(o==="menu")return[...a,Yce({fallbackPlacements:i||["top-start","top","top-end","bottom-start","bottom","bottom-end"]})];if(o==="popover"||o==="tooltip"){const l=[...a,Bwt({mainAxis:typeof r=="number"?r:0,crossAxis:typeof n=="number"?n:0})];return t==="auto"||t==="auto-start"||t==="auto-end"?l.push(kwt({alignment:t==="auto-start"?"start":t==="auto-end"?"end":null})):e||l.push(Yce(i?{fallbackPlacements:i}:{})),s&&l.push(Nwt({element:s})),l}return[]}function hxt(t,e){const i=t.filter(r=>tue.includes(r));return i.length!==t.length&&console.warn(`${e.tagName}: Invalid value found in: flipPlacements. Try any of these: ${tue.map(r=>`"${r}"`).join(", ").trim()}`,{el:e}),i}function dxt(t,e){const i=["left","right"];return eE(t)==="rtl"&&i.reverse(),e.replace(/leading/gi,i[0]).replace(/trailing/gi,i[1])}async function pxt(t,e,i=!1){return t.open?(i?fxt(t):W3e)(t,e):void 0}function fxt(t){let e=Q5.get(t);return e||(e=Owt(W3e,eue,{leading:!0,maxWait:eue}),Q5.set(t,e),e)}const mxt={top:"",left:"rotate(-90deg)",bottom:"rotate(180deg)",right:"rotate(90deg)"},hH=new WeakMap,Q5=new WeakMap;function gxt(t,e,i){if(!i||!e)return;Y3e(t,e,i),Object.assign(i.style,{visibility:"hidden",pointerEvents:"none",position:t.overlayPositioning,top:"0",left:"0"});const r=sxt;hH.set(t,r(e,i,()=>t.reposition()))}function Y3e(t,e,i){!i||!e||(hH.get(t)?.(),hH.delete(t),Q5.get(t)?.cancel(),Q5.delete(t))}const rue=4,yxt=Math.ceil(Math.hypot(rue,rue));/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 *//*!
* focus-trap 7.5.2
* @license MIT, https://github.com/focus-trap/focus-trap/blob/master/LICENSE
*/function nue(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),i.push.apply(i,r)}return i}function sue(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?nue(Object(i),!0).forEach(function(r){_xt(t,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):nue(Object(i)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))})}return t}function _xt(t,e,i){return e=bxt(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function vxt(t,e){if(typeof t!="object"||t===null)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var r=i.call(t,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function bxt(t){var e=vxt(t,"string");return typeof e=="symbol"?e:String(e)}var oue={activateTrap:function(e,i){if(e.length>0){var r=e[e.length-1];r!==i&&r.pause()}var n=e.indexOf(i);n===-1||e.splice(n,1),e.push(i)},deactivateTrap:function(e,i){var r=e.indexOf(i);r!==-1&&e.splice(r,1),e.length>0&&e[e.length-1].unpause()}},wxt=function(e){return e.tagName&&e.tagName.toLowerCase()==="input"&&typeof e.select=="function"},xxt=function(e){return e?.key==="Escape"||e?.key==="Esc"||e?.keyCode===27},k3=function(e){return e?.key==="Tab"||e?.keyCode===9},Txt=function(e){return k3(e)&&!e.shiftKey},Sxt=function(e){return k3(e)&&e.shiftKey},aue=function(e){return setTimeout(e,0)},lue=function(e,i){var r=-1;return e.every(function(n,s){return i(n)?(r=s,!1):!0}),r},lC=function(e){for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];return typeof e=="function"?e.apply(void 0,r):e},sI=function(e){return e.target.shadowRoot&&typeof e.composedPath=="function"?e.composedPath()[0]:e.target},Ext=[],Cxt=function(e,i){var r=i?.document||document,n=i?.trapStack||Ext,s=sue({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0,isKeyForward:Txt,isKeyBackward:Sxt},i),o={containers:[],containerGroups:[],tabbableGroups:[],nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,delayInitialFocusTimer:void 0,recentNavEvent:void 0},a,l=function($,R,k){return $&&$[R]!==void 0?$[R]:s[k||R]},c=function($,R){var k=typeof R?.composedPath=="function"?R.composedPath():void 0;return o.containerGroups.findIndex(function(B){var j=B.container,X=B.tabbableNodes;return j.contains($)||k?.includes(j)||X.find(function(M){return M===$})})},u=function($){var R=s[$];if(typeof R=="function"){for(var k=arguments.length,B=new Array(k>1?k-1:0),j=1;j<k;j++)B[j-1]=arguments[j];R=R.apply(void 0,B)}if(R===!0&&(R=void 0),!R){if(R===void 0||R===!1)return R;throw new Error("`".concat($,"` was specified but was not a node, or did not return a node"))}var X=R;if(typeof R=="string"&&(X=r.querySelector(R),!X))throw new Error("`".concat($,"` as selector refers to no known node"));return X},d=function(){var $=u("initialFocus");if($===!1)return!1;if($===void 0||!Mz($,s.tabbableOptions))if(c(r.activeElement)>=0)$=r.activeElement;else{var R=o.tabbableGroups[0],k=R&&R.firstTabbableNode;$=k||u("fallbackFocus")}if(!$)throw new Error("Your focus-trap needs to have at least one focusable element");return $},p=function(){if(o.containerGroups=o.containers.map(function($){var R=DAe($,s.tabbableOptions),k=Nvt($,s.tabbableOptions),B=R.length>0?R[0]:void 0,j=R.length>0?R[R.length-1]:void 0,X=k.find(function(G){return $x(G)}),M=k.slice().reverse().find(function(G){return $x(G)}),I=!!R.find(function(G){return D1(G)>0});return{container:$,tabbableNodes:R,focusableNodes:k,posTabIndexesFound:I,firstTabbableNode:B,lastTabbableNode:j,firstDomTabbableNode:X,lastDomTabbableNode:M,nextTabbableNode:function(q){var Z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,K=R.indexOf(q);return K<0?Z?k.slice(k.indexOf(q)+1).find(function(Q){return $x(Q)}):k.slice(0,k.indexOf(q)).reverse().find(function(Q){return $x(Q)}):R[K+(Z?1:-1)]}}}),o.tabbableGroups=o.containerGroups.filter(function($){return $.tabbableNodes.length>0}),o.tabbableGroups.length<=0&&!u("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times");if(o.containerGroups.find(function($){return $.posTabIndexesFound})&&o.containerGroups.length>1)throw new Error("At least one node with a positive tabindex was found in one of your focus-trap's multiple containers. Positive tabindexes are only supported in single-container focus-traps.")},m=function D($){if($!==!1&&$!==r.activeElement){if(!$||!$.focus){D(d());return}$.focus({preventScroll:!!s.preventScroll}),o.mostRecentlyFocusedNode=$,wxt($)&&$.select()}},y=function($){var R=u("setReturnFocus",$);return R||(R===!1?!1:$)},_=function($){var R=$.target,k=$.event,B=$.isBackward,j=B===void 0?!1:B;R=R||sI(k),p();var X=null;if(o.tabbableGroups.length>0){var M=c(R,k),I=M>=0?o.containerGroups[M]:void 0;if(M<0)j?X=o.tabbableGroups[o.tabbableGroups.length-1].lastTabbableNode:X=o.tabbableGroups[0].firstTabbableNode;else if(j){var G=lue(o.tabbableGroups,function(Ae){var st=Ae.firstTabbableNode;return R===st});if(G<0&&(I.container===R||Mz(R,s.tabbableOptions)&&!$x(R,s.tabbableOptions)&&!I.nextTabbableNode(R,!1))&&(G=M),G>=0){var q=G===0?o.tabbableGroups.length-1:G-1,Z=o.tabbableGroups[q];X=D1(R)>=0?Z.lastTabbableNode:Z.lastDomTabbableNode}else k3(k)||(X=I.nextTabbableNode(R,!1))}else{var K=lue(o.tabbableGroups,function(Ae){var st=Ae.lastTabbableNode;return R===st});if(K<0&&(I.container===R||Mz(R,s.tabbableOptions)&&!$x(R,s.tabbableOptions)&&!I.nextTabbableNode(R))&&(K=M),K>=0){var Q=K===o.tabbableGroups.length-1?0:K+1,de=o.tabbableGroups[Q];X=D1(R)>=0?de.firstTabbableNode:de.firstDomTabbableNode}else k3(k)||(X=I.nextTabbableNode(R))}}else X=u("fallbackFocus");return X},v=function($){var R=sI($);if(!(c(R,$)>=0)){if(lC(s.clickOutsideDeactivates,$)){a.deactivate({returnFocus:s.returnFocusOnDeactivate});return}lC(s.allowOutsideClick,$)||$.preventDefault()}},w=function($){var R=sI($),k=c(R,$)>=0;if(k||R instanceof Document)k&&(o.mostRecentlyFocusedNode=R);else{$.stopImmediatePropagation();var B,j=!0;if(o.mostRecentlyFocusedNode)if(D1(o.mostRecentlyFocusedNode)>0){var X=c(o.mostRecentlyFocusedNode),M=o.containerGroups[X].tabbableNodes;if(M.length>0){var I=M.findIndex(function(G){return G===o.mostRecentlyFocusedNode});I>=0&&(s.isKeyForward(o.recentNavEvent)?I+1<M.length&&(B=M[I+1],j=!1):I-1>=0&&(B=M[I-1],j=!1))}}else o.containerGroups.some(function(G){return G.tabbableNodes.some(function(q){return D1(q)>0})})||(j=!1);else j=!1;j&&(B=_({target:o.mostRecentlyFocusedNode,isBackward:s.isKeyBackward(o.recentNavEvent)})),m(B||o.mostRecentlyFocusedNode||d())}o.recentNavEvent=void 0},x=function($){var R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;o.recentNavEvent=$;var k=_({event:$,isBackward:R});k&&(k3($)&&$.preventDefault(),m(k))},T=function($){if(xxt($)&&lC(s.escapeDeactivates,$)!==!1){$.preventDefault(),a.deactivate();return}(s.isKeyForward($)||s.isKeyBackward($))&&x($,s.isKeyBackward($))},S=function($){var R=sI($);c(R,$)>=0||lC(s.clickOutsideDeactivates,$)||lC(s.allowOutsideClick,$)||($.preventDefault(),$.stopImmediatePropagation())},E=function(){if(o.active)return oue.activateTrap(n,a),o.delayInitialFocusTimer=s.delayInitialFocus?aue(function(){m(d())}):m(d()),r.addEventListener("focusin",w,!0),r.addEventListener("mousedown",v,{capture:!0,passive:!1}),r.addEventListener("touchstart",v,{capture:!0,passive:!1}),r.addEventListener("click",S,{capture:!0,passive:!1}),r.addEventListener("keydown",T,{capture:!0,passive:!1}),a},A=function(){if(o.active)return r.removeEventListener("focusin",w,!0),r.removeEventListener("mousedown",v,!0),r.removeEventListener("touchstart",v,!0),r.removeEventListener("click",S,!0),r.removeEventListener("keydown",T,!0),a},P=function($){var R=$.some(function(k){var B=Array.from(k.removedNodes);return B.some(function(j){return j===o.mostRecentlyFocusedNode})});R&&m(d())},N=typeof window<"u"&&"MutationObserver"in window?new MutationObserver(P):void 0,F=function(){N&&(N.disconnect(),o.active&&!o.paused&&o.containers.map(function($){N.observe($,{subtree:!0,childList:!0})}))};return a={get active(){return o.active},get paused(){return o.paused},activate:function($){if(o.active)return this;var R=l($,"onActivate"),k=l($,"onPostActivate"),B=l($,"checkCanFocusTrap");B||p(),o.active=!0,o.paused=!1,o.nodeFocusedBeforeActivation=r.activeElement,R?.();var j=function(){B&&p(),E(),F(),k?.()};return B?(B(o.containers.concat()).then(j,j),this):(j(),this)},deactivate:function($){if(!o.active)return this;var R=sue({onDeactivate:s.onDeactivate,onPostDeactivate:s.onPostDeactivate,checkCanReturnFocus:s.checkCanReturnFocus},$);clearTimeout(o.delayInitialFocusTimer),o.delayInitialFocusTimer=void 0,A(),o.active=!1,o.paused=!1,F(),oue.deactivateTrap(n,a);var k=l(R,"onDeactivate"),B=l(R,"onPostDeactivate"),j=l(R,"checkCanReturnFocus"),X=l(R,"returnFocus","returnFocusOnDeactivate");k?.();var M=function(){aue(function(){X&&m(y(o.nodeFocusedBeforeActivation)),B?.()})};return X&&j?(j(y(o.nodeFocusedBeforeActivation)).then(M,M),this):(M(),this)},pause:function($){if(o.paused||!o.active)return this;var R=l($,"onPause"),k=l($,"onPostPause");return o.paused=!0,R?.(),A(),F(),k?.(),this},unpause:function($){if(!o.paused||!o.active)return this;var R=l($,"onUnpause"),k=l($,"onPostUnpause");return o.paused=!1,R?.(),p(),E(),F(),k?.(),this},updateContainerElements:function($){var R=[].concat($).filter(Boolean);return o.containers=R.map(function(k){return typeof k=="string"?r.querySelector(k):k}),o.active&&p(),F(),this}},a.updateContainerElements(e),a};const Axt=globalThis.calciteConfig,Oxt=Axt?.focusTrapStack||[];function Rxt(t,e){const{el:i}=t,r=e?.focusTrapEl||i;if(!r)return;const n={clickOutsideDeactivates:!0,escapeDeactivates:!1,fallbackFocus:r,setReturnFocus:s=>(tE(s),!1),...e?.focusTrapOptions,document:i.ownerDocument,tabbableOptions:NAe,trapStack:Oxt};t.focusTrap=Cxt(r,n)}function cue(t,e){t.focusTrapDisabled||t.focusTrap?.activate(e)}function Bz(t,e){t.focusTrap?.deactivate(e)}function Pxt(t){t.focusTrap?.updateContainerElements(t.el)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const uue={arrow:"calcite-floating-ui-arrow",arrowStroke:"calcite-floating-ui-arrow__stroke"},Mxt={width:12,height:6,strokeWidth:1},$xt=({floatingLayout:t,key:e,ref:i})=>{const{width:r,height:n,strokeWidth:s}=Mxt,o=r/2,a=t==="vertical",l=`M0,0 H${r} L${r-o},${n} Q${o},${n} ${o},${n} Z`;return H("svg",{"aria-hidden":"true",class:uue.arrow,height:r,key:e,ref:i,viewBox:`0 0 ${r} ${r+(a?0:s)}`,width:r+(a?s:0)},s>0&&H("path",{class:uue.arrowStroke,d:l,fill:"none","stroke-width":s+1}),H("path",{d:l,stroke:"none"}))};/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const wm={container:"container",imageContainer:"image-container",closeButtonContainer:"close-button-container",closeButton:"close-button",content:"content",hasHeader:"has-header",header:"header",headerContent:"header-content",heading:"heading"},Ixt="auto",hue="aria-controls",due="aria-expanded";class Lxt{constructor(){this.registeredElements=new Map,this.registeredElementCount=0,this.queryPopover=e=>{const{registeredElements:i}=this,r=e.find(n=>i.has(n));return i.get(r)},this.togglePopovers=e=>{const i=e.composedPath(),r=this.queryPopover(i);r&&!r.triggerDisabled&&(r.open=!r.open),Array.from(this.registeredElements.values()).filter(n=>n!==r&&n.autoClose&&n.open&&!i.includes(n)).forEach(n=>n.open=!1)},this.keyHandler=e=>{e.defaultPrevented||(e.key==="Escape"?this.closeAllPopovers():tP(e.key)&&this.togglePopovers(e))},this.clickHandler=e=>{ST(e)&&this.togglePopovers(e)}}registerElement(e,i){this.registeredElementCount++,this.registeredElements.set(e,i),this.registeredElementCount===1&&this.addListeners()}unregisterElement(e){this.registeredElements.delete(e)&&this.registeredElementCount--,this.registeredElementCount===0&&this.removeListeners()}closeAllPopovers(){Array.from(this.registeredElements.values()).forEach(e=>e.open=!1)}addListeners(){document.addEventListener("pointerdown",this.clickHandler,{capture:!0}),document.addEventListener("keydown",this.keyHandler,{capture:!0})}removeListeners(){document.removeEventListener("pointerdown",this.clickHandler,{capture:!0}),document.removeEventListener("keydown",this.keyHandler,{capture:!0})}}const Dxt=":host{--calcite-floating-ui-z-index:var(--calcite-popover-z-index, var(--calcite-app-z-index-popup));display:block;position:absolute;z-index:var(--calcite-floating-ui-z-index)}.calcite-floating-ui-anim{position:relative;transition:var(--calcite-floating-ui-transition);transition-property:transform, visibility, opacity;opacity:0;box-shadow:0 0 16px 0 rgba(0, 0, 0, 0.16);z-index:var(--calcite-app-z-index);border-radius:0.25rem}:host([data-placement^=bottom]) .calcite-floating-ui-anim{transform:translateY(-5px)}:host([data-placement^=top]) .calcite-floating-ui-anim{transform:translateY(5px)}:host([data-placement^=left]) .calcite-floating-ui-anim{transform:translateX(5px)}:host([data-placement^=right]) .calcite-floating-ui-anim{transform:translateX(-5px)}:host([data-placement]) .calcite-floating-ui-anim--active{opacity:1;transform:translate(0)}:host([calcite-hydrated-hidden]){visibility:hidden !important;pointer-events:none}.calcite-floating-ui-arrow{pointer-events:none;position:absolute;z-index:calc(var(--calcite-app-z-index) * -1);fill:var(--calcite-ui-foreground-1)}.calcite-floating-ui-arrow__stroke{stroke:var(--calcite-ui-border-3)}:host([scale=s]) .heading{padding-inline:0.75rem;padding-block:0.5rem;font-size:var(--calcite-font-size--1);line-height:1.375}:host([scale=m]) .heading{padding-inline:1rem;padding-block:0.75rem;font-size:var(--calcite-font-size-0);line-height:1.375}:host([scale=l]) .heading{padding-inline:1.25rem;padding-block:1rem;font-size:var(--calcite-font-size-1);line-height:1.375}:host{pointer-events:none}:host([open]){pointer-events:initial}.calcite-floating-ui-anim{border-radius:0.25rem;border-width:1px;border-style:solid;border-color:var(--calcite-ui-border-3);background-color:var(--calcite-ui-foreground-1)}.arrow::before{outline:1px solid var(--calcite-ui-border-3)}.header{display:flex;flex:1 1 auto;align-items:stretch;justify-content:flex-start;border-width:0px;border-block-end-width:1px;border-style:solid;border-block-end-color:var(--calcite-ui-border-3)}.heading{margin:0px;display:block;flex:1 1 auto;align-self:center;white-space:normal;font-weight:var(--calcite-font-weight-medium);color:var(--calcite-ui-text-1);word-wrap:break-word;word-break:break-word}.container{position:relative;display:flex;block-size:100%;flex-direction:row;flex-wrap:nowrap;border-radius:0.25rem;color:var(--calcite-ui-text-1)}.container.has-header{flex-direction:column}.content{display:flex;block-size:100%;inline-size:100%;flex-direction:column;flex-wrap:nowrap;align-self:center;word-wrap:break-word;word-break:break-word}.close-button-container{display:flex;overflow:hidden;flex:0 0 auto;border-start-end-radius:0.25rem;border-end-end-radius:0.25rem}::slotted(calcite-panel),::slotted(calcite-flow){block-size:100%}:host([hidden]){display:none}[hidden]{display:none}",pue=new Lxt,Nxt=ln(class extends cn{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.calcitePopoverBeforeClose=Ji(this,"calcitePopoverBeforeClose",6),this.calcitePopoverClose=Ji(this,"calcitePopoverClose",6),this.calcitePopoverBeforeOpen=Ji(this,"calcitePopoverBeforeOpen",6),this.calcitePopoverOpen=Ji(this,"calcitePopoverOpen",6),this.mutationObserver=hc("mutation",()=>this.updateFocusTrapElements()),this.guid=`calcite-popover-${_w()}`,this.openTransitionProp="opacity",this.hasLoaded=!1,this.setTransitionEl=t=>{this.transitionEl=t},this.setFilteredPlacements=()=>{const{el:t,flipPlacements:e}=this;this.filteredFlipPlacements=e?hxt(e,t):null},this.setUpReferenceElement=(t=!0)=>{this.removeReferences(),this.effectiveReferenceElement=this.getReferenceElement(),gxt(this,this.effectiveReferenceElement,this.el);const{el:e,referenceElement:i,effectiveReferenceElement:r}=this;t&&i&&!r&&console.warn(`${e.tagName}: reference-element id "${i}" was not found.`,{el:e}),this.addReferences()},this.getId=()=>this.el.id||this.guid,this.setExpandedAttr=()=>{const{effectiveReferenceElement:t,open:e}=this;t&&"setAttribute"in t&&t.setAttribute(due,oa(e))},this.addReferences=()=>{const{effectiveReferenceElement:t}=this;if(!t)return;const e=this.getId();"setAttribute"in t&&t.setAttribute(hue,e),pue.registerElement(t,this.el),this.setExpandedAttr()},this.removeReferences=()=>{const{effectiveReferenceElement:t}=this;t&&("removeAttribute"in t&&(t.removeAttribute(hue),t.removeAttribute(due)),pue.unregisterElement(t))},this.hide=()=>{this.open=!1},this.storeArrowEl=t=>{this.arrowEl=t,this.reposition(!0)},this.autoClose=!1,this.closable=!1,this.flipDisabled=!1,this.focusTrapDisabled=!1,this.pointerDisabled=!1,this.flipPlacements=void 0,this.heading=void 0,this.headingLevel=void 0,this.label=void 0,this.messageOverrides=void 0,this.messages=void 0,this.offsetDistance=yxt,this.offsetSkidding=0,this.open=!1,this.overlayPositioning="absolute",this.placement=Ixt,this.referenceElement=void 0,this.scale="m",this.triggerDisabled=!1,this.effectiveLocale="",this.floatingLayout="vertical",this.effectiveReferenceElement=void 0,this.defaultMessages=void 0}handleFocusTrapDisabled(t){this.open&&(t?Bz(this):cue(this))}flipPlacementsHandler(){this.setFilteredPlacements(),this.reposition(!0)}onMessagesChange(){}offsetDistanceOffsetHandler(){this.reposition(!0)}offsetSkiddingHandler(){this.reposition(!0)}openHandler(t){TS(this),t&&this.reposition(!0),this.setExpandedAttr()}overlayPositioningHandler(){this.reposition(!0)}placementHandler(){this.reposition(!0)}referenceElementHandler(){this.setUpReferenceElement(),this.reposition(!0)}effectiveLocaleChange(){Rh(this,this.effectiveLocale)}connectedCallback(){this.setFilteredPlacements(),yu(this),Ph(this),this.setUpReferenceElement(this.hasLoaded),Rxt(this),this.open&&TS(this)}async componentWillLoad(){await Oh(this),Hs(this)}componentDidLoad(){qs(this),this.referenceElement&&!this.effectiveReferenceElement&&this.setUpReferenceElement(),this.reposition(),this.hasLoaded=!0}disconnectedCallback(){this.removeReferences(),_u(this),Mh(this),Y3e(this,this.effectiveReferenceElement,this.el),Bz(this)}async reposition(t=!1){const{el:e,effectiveReferenceElement:i,placement:r,overlayPositioning:n,flipDisabled:s,filteredFlipPlacements:o,offsetDistance:a,offsetSkidding:l,arrowEl:c}=this;return pxt(this,{floatingEl:e,referenceEl:i,overlayPositioning:n,placement:r,flipDisabled:s,flipPlacements:o,offsetDistance:a,offsetSkidding:l,arrowEl:c,type:"popover"},t)}async setFocus(){await Ws(this),QS(this.el),Ak(this.el)}async updateFocusTrapElements(){Pxt(this)}getReferenceElement(){const{referenceElement:t,el:e}=this;return(typeof t=="string"?QZ(e,{id:t}):t)||null}onBeforeOpen(){this.calcitePopoverBeforeOpen.emit()}onOpen(){this.calcitePopoverOpen.emit(),cue(this)}onBeforeClose(){this.calcitePopoverBeforeClose.emit()}onClose(){this.calcitePopoverClose.emit(),Bz(this)}renderCloseButton(){const{messages:t,closable:e}=this;return e?H("div",{class:wm.closeButtonContainer,key:wm.closeButtonContainer},H("calcite-action",{appearance:"transparent",class:wm.closeButton,onClick:this.hide,scale:this.scale,text:t.close,ref:i=>this.closeButtonEl=i},H("calcite-icon",{icon:"x",scale:this.scale==="l"?"m":this.scale}))):null}renderHeader(){const{heading:t,headingLevel:e}=this,i=t?H(sJ,{class:wm.heading,level:e},t):null;return i?H("div",{class:wm.header,key:wm.header},i,this.renderCloseButton()):null}render(){const{effectiveReferenceElement:t,heading:e,label:i,open:r,pointerDisabled:n,floatingLayout:s}=this,o=t&&r,a=!o,l=n?null:H($xt,{floatingLayout:s,key:"floating-arrow",ref:this.storeArrowEl});return H(yo,{"aria-hidden":oa(a),"aria-label":i,"aria-live":"polite","calcite-hydrated-hidden":a,id:this.getId(),role:"dialog"},H("div",{class:{[iue.animation]:!0,[iue.animationActive]:o},ref:this.setTransitionEl},l,H("div",{class:{[wm.hasHeader]:!!e,[wm.container]:!0}},this.renderHeader(),H("div",{class:wm.content},H("slot",null)),e?null:this.renderCloseButton())))}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{focusTrapDisabled:["handleFocusTrapDisabled"],flipPlacements:["flipPlacementsHandler"],messageOverrides:["onMessagesChange"],offsetDistance:["offsetDistanceOffsetHandler"],offsetSkidding:["offsetSkiddingHandler"],open:["openHandler"],overlayPositioning:["overlayPositioningHandler"],placement:["placementHandler"],referenceElement:["referenceElementHandler"],effectiveLocale:["effectiveLocaleChange"]}}static get style(){return Dxt}},[1,"calcite-popover",{autoClose:[516,"auto-close"],closable:[516],flipDisabled:[516,"flip-disabled"],focusTrapDisabled:[516,"focus-trap-disabled"],pointerDisabled:[516,"pointer-disabled"],flipPlacements:[16],heading:[1],headingLevel:[514,"heading-level"],label:[1],messageOverrides:[1040],messages:[1040],offsetDistance:[514,"offset-distance"],offsetSkidding:[514,"offset-skidding"],open:[1540],overlayPositioning:[513,"overlay-positioning"],placement:[513],referenceElement:[1,"reference-element"],scale:[513],triggerDisabled:[516,"trigger-disabled"],effectiveLocale:[32],floatingLayout:[32],effectiveReferenceElement:[32],defaultMessages:[32],reposition:[64],setFocus:[64],updateFocusTrapElements:[64]}]);function kk(){if(typeof customElements>"u")return;["calcite-popover","calcite-action","calcite-icon","calcite-loader"].forEach(e=>{switch(e){case"calcite-popover":customElements.get(e)||customElements.define(e,Nxt);break;case"calcite-action":customElements.get(e)||xw();break;case"calcite-icon":customElements.get(e)||Ba();break;case"calcite-loader":customElements.get(e)||em();break}})}kk();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const fue={menu:"menu",defaultTrigger:"default-trigger"},dH={tooltip:"tooltip",trigger:"trigger"},Fxt={menu:"ellipsis"},kxt="data-active",Uxt=`:host{box-sizing:border-box;display:flex;flex-direction:column;font-size:var(--calcite-font-size-1);color:var(--calcite-ui-text-2)}.menu ::slotted(calcite-action){margin:0.125rem;display:flex;outline-color:transparent}.menu ::slotted(calcite-action[data-active]){outline:2px solid var(--calcite-ui-focus-color, var(--calcite-ui-brand));outline-offset:calc(
            2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-ui-focus-offset-invert),
                1
              )
            )
          );outline-offset:0px}.default-trigger{position:relative;block-size:100%;flex:0 1 auto;align-self:stretch}slot[name=trigger]::slotted(calcite-action),calcite-action::slotted([slot=trigger]){position:relative;block-size:100%;flex:0 1 auto;align-self:stretch}.menu{flex-direction:column;flex-wrap:nowrap;outline:2px solid transparent;outline-offset:2px}:host([hidden]){display:none}[hidden]{display:none}`,zxt=["ArrowUp","ArrowDown","End","Home"],Bxt=ln(class extends cn{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.calciteActionMenuOpen=Ji(this,"calciteActionMenuOpen",6),this.actionElements=[],this.guid=`calcite-action-menu-${_w()}`,this.menuId=`${this.guid}-menu`,this.menuButtonId=`${this.guid}-menu-button`,this.connectMenuButtonEl=()=>{const{menuButtonId:t,menuId:e,open:i,label:r}=this,n=this.slottedMenuButtonEl||this.defaultMenuButtonEl;this.menuButtonEl!==n&&(this.disconnectMenuButtonEl(),this.menuButtonEl=n,this.setTooltipReferenceElement(),n&&(n.active=i,n.setAttribute("aria-controls",e),n.setAttribute("aria-expanded",oa(i)),n.setAttribute("aria-haspopup","true"),n.id||(n.id=t),n.label||(n.label=r),n.text||(n.text=r),n.addEventListener("pointerdown",this.menuButtonClick),n.addEventListener("keydown",this.menuButtonKeyDown)))},this.disconnectMenuButtonEl=()=>{const{menuButtonEl:t}=this;t&&(t.removeEventListener("pointerdown",this.menuButtonClick),t.removeEventListener("keydown",this.menuButtonKeyDown))},this.setMenuButtonEl=t=>{const e=t.target.assignedElements({flatten:!0}).filter(i=>i?.matches("calcite-action"));this.slottedMenuButtonEl=e[0],this.connectMenuButtonEl()},this.setDefaultMenuButtonEl=t=>{this.defaultMenuButtonEl=t,this.connectMenuButtonEl()},this.handleCalciteActionClick=()=>{this.open=!1,this.setFocus()},this.menuButtonClick=t=>{ST(t)&&this.toggleOpen()},this.updateTooltip=t=>{const e=t.target.assignedElements({flatten:!0}).filter(i=>i?.matches("calcite-tooltip"));this.tooltipEl=e[0],this.setTooltipReferenceElement()},this.setTooltipReferenceElement=()=>{const{tooltipEl:t,expanded:e,menuButtonEl:i,open:r}=this;t&&(t.referenceElement=!e&&!r?i:null)},this.updateAction=(t,e)=>{const{guid:i,activeMenuItemIndex:r}=this,n=`${i}-action-${e}`;t.tabIndex=-1,t.setAttribute("role","menuitem"),t.id||(t.id=n),t.toggleAttribute(kxt,e===r)},this.updateActions=t=>{t?.forEach(this.updateAction)},this.handleDefaultSlotChange=t=>{const e=t.target.assignedElements({flatten:!0}).filter(i=>i?.matches("calcite-action"));this.actionElements=e},this.menuButtonKeyDown=t=>{const{key:e}=t,{actionElements:i,activeMenuItemIndex:r,open:n}=this;if(i.length){if(tP(e)){if(t.preventDefault(),!n){this.toggleOpen();return}const s=i[r];s?s.click():this.toggleOpen(!1)}if(e==="Tab"){this.open=!1;return}if(e==="Escape"){this.toggleOpen(!1),t.preventDefault();return}this.handleActionNavigation(t,e,i)}},this.handleActionNavigation=(t,e,i)=>{if(!this.isValidKey(e,zxt))return;if(t.preventDefault(),!this.open){this.toggleOpen(),(e==="Home"||e==="ArrowDown")&&(this.activeMenuItemIndex=0),(e==="End"||e==="ArrowUp")&&(this.activeMenuItemIndex=i.length-1);return}e==="Home"&&(this.activeMenuItemIndex=0),e==="End"&&(this.activeMenuItemIndex=i.length-1);const r=this.activeMenuItemIndex;e==="ArrowUp"&&(this.activeMenuItemIndex=W5(Math.max(r-1,-1),i.length)),e==="ArrowDown"&&(this.activeMenuItemIndex=W5(r+1,i.length))},this.toggleOpenEnd=()=>{this.setFocus(),this.el.removeEventListener("calcitePopoverOpen",this.toggleOpenEnd)},this.toggleOpen=(t=!this.open)=>{this.el.addEventListener("calcitePopoverOpen",this.toggleOpenEnd),this.open=t},this.appearance="solid",this.expanded=!1,this.flipPlacements=void 0,this.label=void 0,this.open=!1,this.overlayPositioning="absolute",this.placement="auto",this.scale=void 0,this.menuButtonEl=void 0,this.activeMenuItemIndex=-1}componentWillLoad(){Hs(this)}componentDidLoad(){qs(this)}disconnectedCallback(){this.disconnectMenuButtonEl()}expandedHandler(){this.open=!1,this.setTooltipReferenceElement()}openHandler(t){this.activeMenuItemIndex=this.open?0:-1,this.menuButtonEl&&(this.menuButtonEl.active=t),this.calciteActionMenuOpen.emit(),this.setTooltipReferenceElement()}closeCalciteActionMenuOnClick(t){!ST(t)||t.composedPath().includes(this.el)||(this.open=!1)}activeMenuItemIndexHandler(){this.updateActions(this.actionElements)}async setFocus(){return await Ws(this),tE(this.menuButtonEl)}renderMenuButton(){const{appearance:t,label:e,scale:i,expanded:r}=this;return H("slot",{name:dH.trigger,onSlotchange:this.setMenuButtonEl},H("calcite-action",{appearance:t,class:fue.defaultTrigger,icon:Fxt.menu,scale:i,text:e,textEnabled:r,ref:this.setDefaultMenuButtonEl}))}renderMenuItems(){const{actionElements:t,activeMenuItemIndex:e,open:i,menuId:r,menuButtonEl:n,label:s,placement:o,overlayPositioning:a,flipPlacements:l}=this,u=t[e]?.id||null;return H("calcite-popover",{flipPlacements:l,focusTrapDisabled:!0,label:s,offsetDistance:0,open:i,overlayPositioning:a,placement:o,pointerDisabled:!0,referenceElement:n},H("div",{"aria-activedescendant":u,"aria-labelledby":n?.id,class:fue.menu,id:r,onClick:this.handleCalciteActionClick,role:"menu",tabIndex:-1},H("slot",{onSlotchange:this.handleDefaultSlotChange})))}render(){return H(ZR,null,this.renderMenuButton(),this.renderMenuItems(),H("slot",{name:dH.tooltip,onSlotchange:this.updateTooltip}))}isValidKey(t,e){return!!e.find(i=>i===t)}get el(){return this}static get watchers(){return{expanded:["expandedHandler"],open:["openHandler"],activeMenuItemIndex:["activeMenuItemIndexHandler"]}}static get style(){return Uxt}},[1,"calcite-action-menu",{appearance:[513],expanded:[516],flipPlacements:[16],label:[1],open:[1540],overlayPositioning:[513,"overlay-positioning"],placement:[513],scale:[513],menuButtonEl:[32],activeMenuItemIndex:[32],setFocus:[64]},[[9,"pointerdown","closeCalciteActionMenuOnClick"]]]);function hJ(){if(typeof customElements>"u")return;["calcite-action-menu","calcite-action","calcite-icon","calcite-loader","calcite-popover"].forEach(e=>{switch(e){case"calcite-action-menu":customElements.get(e)||customElements.define(e,Bxt);break;case"calcite-action":customElements.get(e)||xw();break;case"calcite-icon":customElements.get(e)||Ba();break;case"calcite-loader":customElements.get(e)||em();break;case"calcite-popover":customElements.get(e)||kk();break}})}hJ();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const mue={handle:"handle",handleActivated:"handle--activated"},Vxt={drag:"drag"},Gxt=`:host{display:flex}.handle{display:flex;cursor:move;align-items:center;justify-content:center;align-self:stretch;border-style:none;background-color:transparent;outline-color:transparent;color:var(--calcite-ui-border-input);padding-block:0.75rem;padding-inline:0.25rem;line-height:0}.handle:hover{background-color:var(--calcite-ui-foreground-2);color:var(--calcite-ui-text-1)}.handle:focus{color:var(--calcite-ui-text-1);outline:2px solid var(--calcite-ui-focus-color, var(--calcite-ui-brand));outline-offset:calc(
            -2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-ui-focus-offset-invert),
                1
              )
            )
          )}.handle--activated{background-color:var(--calcite-ui-foreground-3);color:var(--calcite-ui-text-1)}.handle calcite-icon{color:inherit}:host([hidden]){display:none}[hidden]{display:none}`,jxt=ln(class extends cn{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.calciteHandleNudge=Ji(this,"calciteHandleNudge",6),this.calciteInternalHandleChange=Ji(this,"calciteInternalHandleChange",6),this.handleKeyDown=t=>{switch(t.key){case" ":this.activated=!this.activated,t.preventDefault();break;case"ArrowUp":if(!this.activated)return;t.preventDefault(),this.calciteHandleNudge.emit({direction:"up"});break;case"ArrowDown":if(!this.activated)return;t.preventDefault(),this.calciteHandleNudge.emit({direction:"down"});break}},this.handleBlur=()=>{this.activated=!1},this.activated=!1,this.dragHandle=void 0,this.messages=void 0,this.setPosition=void 0,this.setSize=void 0,this.label=void 0,this.messageOverrides=void 0,this.effectiveLocale=void 0,this.defaultMessages=void 0}handleAriaTextChange(){const t=this.getAriaText("live");t&&this.calciteInternalHandleChange.emit({message:t})}onMessagesChange(){}connectedCallback(){Ph(this),yu(this)}async componentWillLoad(){Hs(this),await Oh(this)}componentDidLoad(){qs(this)}disconnectedCallback(){Mh(this),_u(this)}effectiveLocaleChange(){Rh(this,this.effectiveLocale)}async setFocus(){await Ws(this),this.handleButton?.focus()}getAriaText(t){const{setPosition:e,setSize:i,label:r,messages:n,activated:s}=this;return!n||!r||typeof i!="number"||typeof e!="number"?null:(t==="label"?s?n.dragHandleChange:n.dragHandleIdle:s?n.dragHandleActive:n.dragHandleCommit).replace("{position}",e.toString()).replace("{itemLabel}",r).replace("{total}",i.toString())}render(){return H("span",{"aria-label":this.getAriaText("label"),"aria-pressed":oa(this.activated),class:{[mue.handle]:!0,[mue.handleActivated]:this.activated},onBlur:this.handleBlur,onKeyDown:this.handleKeyDown,role:"button",tabindex:"0",title:this.messages?.dragHandle,ref:t=>{this.handleButton=t}},H("calcite-icon",{icon:Vxt.drag,scale:"s"}))}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{messages:["handleAriaTextChange"],label:["handleAriaTextChange"],activated:["handleAriaTextChange"],setPosition:["handleAriaTextChange"],setSize:["handleAriaTextChange"],messageOverrides:["onMessagesChange"],effectiveLocale:["effectiveLocaleChange"]}}static get style(){return Gxt}},[1,"calcite-handle",{activated:[1540],dragHandle:[513,"drag-handle"],messages:[16],setPosition:[2,"set-position"],setSize:[2,"set-size"],label:[1],messageOverrides:[16],effectiveLocale:[32],defaultMessages:[32],setFocus:[64]}]);function X3e(){if(typeof customElements>"u")return;["calcite-handle","calcite-icon"].forEach(e=>{switch(e){case"calcite-handle":customElements.get(e)||customElements.define(e,jxt);break;case"calcite-icon":customElements.get(e)||Ba();break}})}X3e();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const gue={scrim:"scrim",content:"content"},yue={s:72,l:480},Hxt=":host{position:absolute;inset:0px;z-index:var(--calcite-app-z-index-overlay);display:flex;block-size:100%;inline-size:100%;flex-direction:column;align-items:stretch}@keyframes calcite-scrim-fade-in{0%{--tw-bg-opacity:0}100%{--tw-text-opacity:1}}.scrim{position:absolute;inset:0px;display:flex;flex-direction:column;align-content:center;align-items:center;justify-content:center;overflow:hidden;animation:calcite-scrim-fade-in var(--calcite-internal-animation-timing-medium) ease-in-out;background-color:var(--calcite-scrim-background, var(--calcite-scrim-background-internal))}.content{padding:1rem}:host([hidden]){display:none}[hidden]{display:none}",qxt=ln(class extends cn{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.resizeObserver=hc("resize",()=>this.handleResize()),this.handleDefaultSlotChange=t=>{this.hasContent=jvt(t)},this.storeLoaderEl=t=>{this.loaderEl=t,this.handleResize()},this.loading=!1,this.messages=void 0,this.messageOverrides=void 0,this.loaderScale=void 0,this.defaultMessages=void 0,this.effectiveLocale="",this.hasContent=!1}onMessagesChange(){}effectiveLocaleChange(){Rh(this,this.effectiveLocale)}connectedCallback(){yu(this),Ph(this),this.resizeObserver?.observe(this.el)}async componentWillLoad(){await Oh(this)}disconnectedCallback(){_u(this),Mh(this),this.resizeObserver?.disconnect()}render(){const{hasContent:t,loading:e,messages:i}=this;return H("div",{class:gue.scrim},e?H("calcite-loader",{label:i.loading,ref:this.storeLoaderEl,scale:this.loaderScale}):null,H("div",{class:gue.content,hidden:!t},H("slot",{onSlotchange:this.handleDefaultSlotChange})))}getScale(t){return t<yue.s?"s":t>=yue.l?"l":"m"}handleResize(){const{loaderEl:t,el:e}=this;t&&(this.loaderScale=this.getScale(Math.min(e.clientHeight,e.clientWidth)??0))}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{messageOverrides:["onMessagesChange"],effectiveLocale:["effectiveLocaleChange"]}}static get style(){return Hxt}},[1,"calcite-scrim",{loading:[516],messages:[1040],messageOverrides:[1040],loaderScale:[32],defaultMessages:[32],effectiveLocale:[32],hasContent:[32]}]);function dJ(){if(typeof customElements>"u")return;["calcite-scrim","calcite-loader"].forEach(e=>{switch(e){case"calcite-scrim":customElements.get(e)||customElements.define(e,qxt);break;case"calcite-loader":customElements.get(e)||em();break}})}dJ();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const Fx={content:"content",toggle:"toggle",header:"header"},va={button:"button",container:"container",content:"content",controlContainer:"control-container",description:"description",header:"header",headerContainer:"header-container",heading:"heading",icon:"icon",invalid:"invalid",statusIcon:"status-icon",summary:"summary",title:"title",toggle:"toggle",toggleIcon:"toggle-icon",valid:"valid"},kx={icon:"icon",control:"control",headerMenuActions:"header-menu-actions"},Vz={opened:"chevron-up",closed:"chevron-down",valid:"check-circle",invalid:"exclamation-mark-triangle"},Wxt=`:host{box-sizing:border-box;background-color:var(--calcite-ui-foreground-1);color:var(--calcite-ui-text-2);font-size:var(--calcite-font-size--1)}:host *{box-sizing:border-box}:host{--calcite-icon-size:1rem;--calcite-spacing-eighth:0.125rem;--calcite-spacing-quarter:0.25rem;--calcite-spacing-half:0.5rem;--calcite-spacing-three-quarters:0.75rem;--calcite-spacing:1rem;--calcite-spacing-plus-quarter:1.25rem;--calcite-spacing-plus-half:1.5rem;--calcite-spacing-double:2rem;--calcite-menu-min-width:10rem;--calcite-header-min-height:3rem;--calcite-footer-min-height:3rem}:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-ui-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:flex;flex-shrink:0;flex-grow:0;flex-direction:column;border-width:0px;border-block-end-width:1px;border-style:solid;border-color:var(--calcite-ui-border-3);padding:0px;transition-property:margin;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms;transition-timing-function:cubic-bezier(0.215, 0.440, 0.420, 0.880);flex-basis:auto}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.header{margin:0px;display:flex;align-content:space-between;align-items:center;fill:var(--calcite-ui-text-2);color:var(--calcite-ui-text-2)}.heading{margin:0px;padding:0px;font-weight:var(--calcite-font-weight-medium)}.header .heading{flex:1 1 auto;padding:0.5rem}.header{justify-content:flex-start;padding:0px}.header,.toggle{grid-area:header}.header-container{display:grid;align-items:stretch;grid-template:auto/auto 1fr auto auto;grid-template-areas:"handle header control menu";grid-column:header-start/menu-end;grid-row:1/2}.toggle{margin:0px;display:flex;cursor:pointer;flex-wrap:nowrap;align-items:center;justify-content:space-between;border-style:none;padding:0px;font-family:inherit;outline-color:transparent;text-align:initial;background-color:transparent}.toggle:hover{background-color:var(--calcite-ui-foreground-2)}.toggle:focus{outline:2px solid var(--calcite-ui-focus-color, var(--calcite-ui-brand));outline-offset:calc(
            -2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-ui-focus-offset-invert),
                1
              )
            )
          )}calcite-loader[inline]{grid-area:control;align-self:center}calcite-handle{grid-area:handle}.title{margin:0px;padding:0.75rem}.header .title .heading{padding:0px;font-size:var(--calcite-font-size--1);font-weight:var(--calcite-font-weight-medium);line-height:1.25;color:var(--calcite-ui-text-2);transition-property:color;transition-duration:150ms;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);word-wrap:break-word;word-break:break-word}.description{margin-block-start:0.125rem;padding:0px;font-size:var(--calcite-font-size--2);line-height:1.375;color:var(--calcite-ui-text-3);word-wrap:break-word;word-break:break-word}.icon{display:flex;margin-inline-start:0.75rem;margin-inline-end:0px}.status-icon.valid{color:var(--calcite-ui-success)}.status-icon.invalid{color:var(--calcite-ui-danger)}@keyframes spin{0%{transform:rotate(0deg)}50%{transform:rotate(180deg)}100%{transform:rotate(360deg)}}.toggle-icon{margin-block:0.75rem;align-self:center;justify-self:end;color:var(--calcite-ui-text-3);transition-property:color;transition-duration:150ms;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);margin-inline-end:1rem;margin-inline-start:auto}.toggle:hover .toggle-icon{color:var(--calcite-ui-text-1)}.container{position:relative;display:flex;block-size:100%;flex-direction:column}.content{position:relative;min-block-size:0px;flex:1 1 0%}@keyframes in{0%{opacity:0}100%{opacity:1}}.content{animation:in var(--calcite-internal-animation-timing-slow) ease-in-out;padding-block:var(--calcite-block-padding, 0.5rem);padding-inline:var(--calcite-block-padding, 0.625rem)}.control-container{margin:0px;display:flex;grid-area:control}calcite-action-menu{grid-area:menu}:host([open]){margin-block:0.5rem}:host([open]) .header .title .heading{color:var(--calcite-ui-text-1)}:host([hidden]){display:none}[hidden]{display:none}`,Yxt=ln(class extends cn{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.calciteBlockBeforeClose=Ji(this,"calciteBlockBeforeClose",6),this.calciteBlockBeforeOpen=Ji(this,"calciteBlockBeforeOpen",6),this.calciteBlockClose=Ji(this,"calciteBlockClose",6),this.calciteBlockOpen=Ji(this,"calciteBlockOpen",6),this.calciteBlockToggle=Ji(this,"calciteBlockToggle",6),this.openTransitionProp="opacity",this.onHeaderClick=()=>{this.open=!this.open,this.calciteBlockToggle.emit()},this.setTransitionEl=t=>{this.transitionEl=t},this.collapsible=!1,this.disabled=!1,this.dragHandle=!1,this.heading=void 0,this.headingLevel=void 0,this.loading=!1,this.open=!1,this.status=void 0,this.description=void 0,this.messages=void 0,this.messageOverrides=void 0,this.effectiveLocale=void 0,this.defaultMessages=void 0}openHandler(){TS(this)}onMessagesChange(){}async setFocus(){await Ws(this),Ak(this.el)}onBeforeOpen(){this.calciteBlockBeforeOpen.emit()}onOpen(){this.calciteBlockOpen.emit()}onBeforeClose(){this.calciteBlockBeforeClose.emit()}onClose(){this.calciteBlockClose.emit()}effectiveLocaleChange(){Rh(this,this.effectiveLocale)}connectedCallback(){M3e(this),F_(this),yu(this),Ph(this)}disconnectedCallback(){k_(this),_u(this),Mh(this),$3e(this)}async componentWillLoad(){await Oh(this),Hs(this),this.open&&TS(this)}componentDidLoad(){qs(this)}componentDidRender(){N_(this)}renderScrim(){const{loading:t}=this,e=H("slot",null);return[t?H("calcite-scrim",{loading:t}):null,e]}renderIcon(){const{loading:t,messages:e,status:i}=this,r=!!oD(this.el,kx.icon);return t?H("div",{class:va.icon,key:"loader"},H("calcite-loader",{inline:!0,label:e.loading})):i?H("div",{class:va.icon,key:"status-icon"},H("calcite-icon",{class:{[va.statusIcon]:!0,[va.valid]:i=="valid",[va.invalid]:i=="invalid"},icon:Vz[i],scale:"s"})):r?H("div",{class:va.icon,key:"icon-slot"},H("slot",{key:"icon-slot",name:kx.icon})):null}renderTitle(){const{heading:t,headingLevel:e,description:i}=this;return t||i?H("div",{class:va.title},H(sJ,{class:va.heading,level:e},t),i?H("div",{class:va.description},i):null):null}render(){const{collapsible:t,el:e,loading:i,open:r,messages:n}=this,s=r?n.collapse:n.expand,o=H("header",{class:va.header,id:Fx.header},this.renderIcon(),this.renderTitle()),a=!!oD(e,kx.control),l=!!oD(e,kx.headerMenuActions),c=r?Vz.opened:Vz.closed,u=H("div",{class:va.headerContainer},this.dragHandle?H("calcite-handle",null):null,t?H("button",{"aria-controls":Fx.content,"aria-describedby":Fx.header,"aria-expanded":t?oa(r):null,class:va.toggle,id:Fx.toggle,onClick:this.onHeaderClick,title:s},o,!a&&!l?H("calcite-icon",{"aria-hidden":"true",class:va.toggleIcon,icon:c,scale:"s"}):null):o,a?H("div",{class:va.controlContainer},H("slot",{name:kx.control})):null,l?H("calcite-action-menu",{label:n.options},H("slot",{name:kx.headerMenuActions})):null);return H(yo,null,H("article",{"aria-busy":oa(i),class:{[va.container]:!0}},u,H("section",{"aria-labelledby":Fx.toggle,class:va.content,hidden:!r,id:Fx.content,ref:this.setTransitionEl},this.renderScrim())))}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{open:["openHandler"],messageOverrides:["onMessagesChange"],effectiveLocale:["effectiveLocaleChange"]}}static get style(){return Wxt}},[1,"calcite-block",{collapsible:[516],disabled:[516],dragHandle:[516,"drag-handle"],heading:[1],headingLevel:[514,"heading-level"],loading:[516],open:[1540],status:[513],description:[1],messages:[1040],messageOverrides:[1040],effectiveLocale:[32],defaultMessages:[32],setFocus:[64]}]);function Xxt(){if(typeof customElements>"u")return;["calcite-block","calcite-action","calcite-action-menu","calcite-handle","calcite-icon","calcite-loader","calcite-popover","calcite-scrim"].forEach(e=>{switch(e){case"calcite-block":customElements.get(e)||customElements.define(e,Yxt);break;case"calcite-action":customElements.get(e)||xw();break;case"calcite-action-menu":customElements.get(e)||hJ();break;case"calcite-handle":customElements.get(e)||X3e();break;case"calcite-icon":customElements.get(e)||Ba();break;case"calcite-loader":customElements.get(e)||em();break;case"calcite-popover":customElements.get(e)||kk();break;case"calcite-scrim":customElements.get(e)||dJ();break}})}Xxt();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const Zxt={container:"container"},Jxt=":host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-ui-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:flex}:host([alignment=start]){text-align:start}:host([alignment=end]){text-align:end}:host([alignment=center]){text-align:center}:host([scale=s]) .container{gap:0.25rem;font-size:var(--calcite-font-size--2);line-height:1rem;margin-block-end:var(--calcite-label-margin-bottom, 0.5rem)}:host([scale=m]) .container{gap:0.5rem;font-size:var(--calcite-font-size--1);line-height:1rem;margin-block-end:var(--calcite-label-margin-bottom, 0.75rem)}:host([scale=l]) .container{gap:0.5rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;margin-block-end:var(--calcite-label-margin-bottom, 1rem)}:host .container{margin-inline:0px;margin-block-start:0px;inline-size:100%;line-height:1.375;color:var(--calcite-ui-text-1)}:host([layout=default]) .container{display:flex;flex-direction:column}:host([layout=inline]) .container,:host([layout=inline-space-between]) .container{display:flex;flex-direction:row;align-items:center;gap:0.5rem}:host([layout=inline][scale=l]) .container{gap:0.75rem}:host([layout=inline-space-between]) .container{justify-content:space-between}:host([disabled])>.container{opacity:var(--calcite-ui-opacity-disabled)}:host([disabled]) ::slotted(*[disabled]),:host([disabled]) ::slotted(*[disabled] *){--tw-bg-opacity:1}:host([disabled]) ::slotted(calcite-input-message:not([active])){--tw-bg-opacity:0}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}:host([hidden]){display:none}[hidden]{display:none}",Kxt=ln(class extends cn{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.calciteInternalLabelClick=Ji(this,"calciteInternalLabelClick",2),this.labelClickHandler=t=>{this.calciteInternalLabelClick.emit({sourceEvent:t})},this.alignment="start",this.for=void 0,this.scale="m",this.layout="default"}connectedCallback(){document.dispatchEvent(new CustomEvent(Ik))}disconnectedCallback(){document.dispatchEvent(new CustomEvent(G5))}render(){return H(yo,{onClick:this.labelClickHandler},H("div",{class:Zxt.container},H("slot",null)))}get el(){return this}static get style(){return Jxt}},[1,"calcite-label",{alignment:[513],for:[513],scale:[513],layout:[513]}]);function Z3e(){if(typeof customElements>"u")return;["calcite-label"].forEach(e=>{switch(e){case"calcite-label":customElements.get(e)||customElements.define(e,Kxt);break}})}Z3e();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const Qxt=`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-ui-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host([scale=s]) .container{block-size:0.75rem}:host([scale=s]) .track{block-size:0.75rem;inline-size:1.5rem}:host([scale=s]) .handle{block-size:0.5rem;inline-size:0.5rem}:host([scale=m]) .container{block-size:1rem}:host([scale=m]) .track{block-size:1rem;inline-size:2rem}:host([scale=m]) .handle{block-size:0.75rem;inline-size:0.75rem}:host([scale=l]) .container{block-size:1.5rem}:host([scale=l]) .track{block-size:1.5rem;inline-size:3rem}:host([scale=l]) .handle{block-size:1.25rem;inline-size:1.25rem}:host{position:relative;display:inline-block;inline-size:auto;cursor:pointer;-webkit-user-select:none;user-select:none;vertical-align:middle;tap-highlight-color:transparent}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.container{outline-width:0px}.track{pointer-events:none;position:relative;box-sizing:border-box;display:inline-block;border-radius:9999px;border-width:1px;border-style:solid;border-color:var(--calcite-ui-border-2);background-color:var(--calcite-ui-foreground-2);vertical-align:top;outline-color:transparent}:host(:focus) .track{outline:2px solid var(--calcite-ui-focus-color, var(--calcite-ui-brand));outline-offset:calc(
            2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-ui-focus-offset-invert),
                1
              )
            )
          )}.handle{pointer-events:none;position:absolute;display:block;border-radius:9999px;border-width:2px;border-style:solid;border-color:var(--calcite-ui-border-input);background-color:var(--calcite-ui-foreground-1);transition-property:all;transition-duration:150ms;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);inset-block-start:-1px;inset-inline:-1px auto}:host(:hover) .handle,:host(:focus) .handle{border-color:var(--calcite-ui-brand);box-shadow:inset 0 0 0 1px var(--calcite-ui-brand)}:host([checked]) .track{border-color:var(--calcite-ui-brand-hover);background-color:var(--calcite-ui-brand)}:host([checked]) .handle{border-color:var(--calcite-ui-brand);inset-inline:auto -1px}:host([checked]:hover) .track{border-color:var(--calcite-ui-brand-hover);background-color:var(--calcite-ui-brand)}:host([checked]:hover) .handle{border-color:var(--calcite-ui-brand-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-brand-hover)}@media (forced-colors: active){:host([checked]) .track{background-color:canvasText}}::slotted(input[slot=hidden-form-input]){margin:0 !important;opacity:0 !important;outline:none !important;padding:0 !important;position:absolute !important;inset:0 !important;transform:none !important;-webkit-appearance:none !important;z-index:-1 !important}:host([hidden]){display:none}[hidden]{display:none}`,e2t=ln(class extends cn{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.calciteSwitchChange=Ji(this,"calciteSwitchChange",6),this.keyDownHandler=t=>{!this.disabled&&tP(t.key)&&(this.toggle(),t.preventDefault())},this.clickHandler=()=>{this.disabled||this.toggle()},this.setSwitchEl=t=>{this.switchEl=t},this.disabled=!1,this.form=void 0,this.label=void 0,this.name=void 0,this.scale="m",this.checked=!1,this.value=void 0}async setFocus(){await Ws(this),tE(this.switchEl)}syncHiddenFormInput(t){t.type="checkbox"}onLabelClick(){this.disabled||(this.toggle(),this.setFocus())}toggle(){this.checked=!this.checked,this.calciteSwitchChange.emit()}connectedCallback(){F_(this),iE(this),Pk(this)}componentWillLoad(){Hs(this)}componentDidLoad(){qs(this)}disconnectedCallback(){k_(this),iP(this),Mk(this)}componentDidRender(){N_(this)}render(){return H(yo,{onClick:this.clickHandler,onKeyDown:this.keyDownHandler},H("div",{"aria-checked":oa(this.checked),"aria-label":Lk(this),class:"container",role:"switch",tabIndex:0,ref:this.setSwitchEl},H("div",{class:"track"},H("div",{class:"handle"})),H($k,{component:this})))}get el(){return this}static get style(){return Qxt}},[1,"calcite-switch",{disabled:[516],form:[513],label:[1],name:[513],scale:[513],checked:[1540],value:[8],setFocus:[64]}]);function J3e(){if(typeof customElements>"u")return;["calcite-switch"].forEach(e=>{switch(e){case"calcite-switch":customElements.get(e)||customElements.define(e,e2t);break}})}J3e();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const Ux={content:"content",toggle:"toggle"},Sc={content:"content",focusGuard:"focus-guard",invalid:"invalid",sectionHeader:"section-header",sectionHeaderText:"section-header__text",statusIcon:"status-icon",toggle:"toggle",toggleSwitch:"toggle--switch",toggleSwitchContainer:"toggle--switch-container",toggleSwitchContent:"toggle--switch__content",toggleSwitchText:"toggle--switch__text",valid:"valid"},oI={menuOpen:"chevron-down",menuClosedLeft:"chevron-left",menuClosedRight:"chevron-right",valid:"check-circle",invalid:"exclamation-mark-triangle"},t2t=`:host{box-sizing:border-box;display:block;background-color:var(--calcite-ui-foreground-1);font-size:var(--calcite-font-size--1);color:var(--calcite-ui-text-2)}:host([open]){border-width:0px;border-block-end-width:1px;border-style:solid;border-block-end-color:var(--calcite-ui-border-3)}:host(:last-child){border-block-end-width:0px}.toggle{inline-size:100%;border-width:0px;background-color:transparent;font-family:var(--calcite-sans-family);font-weight:var(--calcite-font-weight-medium);color:var(--calcite-ui-text-2)}.toggle--switch,.section-header{margin-inline:0px;margin-block:0.25rem;display:flex;cursor:pointer;-webkit-user-select:none;user-select:none;align-items:center;padding-inline:0px;padding-block:0.5rem;font-size:var(--calcite-font-size--1);outline-color:transparent}.toggle--switch:focus,.section-header:focus{outline:2px solid var(--calcite-ui-focus-color, var(--calcite-ui-brand));outline-offset:calc(
            2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-ui-focus-offset-invert),
                1
              )
            )
          )}.toggle--switch:hover,.section-header:hover{color:var(--calcite-ui-text-1)}.section-header .status-icon{align-self:flex-end}.section-header__text{margin-inline:0.75rem;margin-block:0px;flex:1 1 auto;text-align:initial;word-wrap:anywhere}.toggle--switch-container{position:relative;display:flex;inline-size:100%;align-items:center;background-color:transparent}.toggle--switch-container .focus-guard{--calcite-label-margin-bottom:0;pointer-events:none;position:absolute;inset-inline-end:0;margin-inline-start:0.25rem}.toggle--switch .status-icon{margin-inline-start:0.5rem}.toggle--switch__content{display:flex;flex:1 1 auto;align-items:center}.status-icon.valid{color:var(--calcite-ui-success)}.status-icon.invalid{color:var(--calcite-ui-danger)}:host([hidden]){display:none}[hidden]{display:none}`,i2t=ln(class extends cn{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.calciteBlockSectionToggle=Ji(this,"calciteBlockSectionToggle",6),this.handleHeaderKeyDown=t=>{tP(t.key)&&(this.toggleSection(),t.preventDefault(),t.stopPropagation())},this.toggleSection=()=>{this.open=!this.open,this.calciteBlockSectionToggle.emit()},this.open=!1,this.status=void 0,this.text=void 0,this.toggleDisplay="button",this.messages=void 0,this.messageOverrides=void 0,this.effectiveLocale=void 0,this.defaultMessages=void 0}onMessagesChange(){}async setFocus(){await Ws(this),Ak(this.el)}effectiveLocaleChange(){Rh(this,this.effectiveLocale)}connectedCallback(){yu(this),Ph(this)}async componentWillLoad(){await Oh(this),Hs(this)}componentDidLoad(){qs(this)}disconnectedCallback(){_u(this),Mh(this)}renderStatusIcon(){const{status:t}=this,e=oI[t]??!1,i={[Sc.statusIcon]:!0,[Sc.valid]:t=="valid",[Sc.invalid]:t=="invalid"};return e?H("calcite-icon",{class:i,icon:e,scale:"s"}):null}render(){const{el:t,messages:e,open:i,text:r,toggleDisplay:n}=this,s=eE(t),o=i?oI.menuOpen:s==="rtl"?oI.menuClosedLeft:oI.menuClosedRight,a=i?e.collapse:e.expand,l=n==="switch"?H("div",{class:{[Sc.toggleSwitchContainer]:!0}},H("div",{"aria-controls":Ux.content,"aria-expanded":oa(i),class:{[Sc.toggle]:!0,[Sc.toggleSwitch]:!0},id:Ux.toggle,onClick:this.toggleSection,onKeyDown:this.handleHeaderKeyDown,role:"button",tabIndex:0,title:a},H("div",{class:Sc.toggleSwitchContent},H("span",{class:Sc.toggleSwitchText},r)),this.renderStatusIcon()),H("calcite-label",{class:Sc.focusGuard,layout:"inline",tabIndex:-1},H("calcite-switch",{checked:i,label:a,scale:"s"}))):H("button",{"aria-controls":Ux.content,"aria-expanded":oa(i),class:{[Sc.sectionHeader]:!0,[Sc.toggle]:!0},id:Ux.toggle,onClick:this.toggleSection},H("calcite-icon",{icon:o,scale:"s"}),H("span",{class:Sc.sectionHeaderText},r),this.renderStatusIcon());return H(yo,null,l,H("section",{"aria-labelledby":Ux.toggle,class:Sc.content,hidden:!i,id:Ux.content},H("slot",null)))}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{messageOverrides:["onMessagesChange"],effectiveLocale:["effectiveLocaleChange"]}}static get style(){return t2t}},[1,"calcite-block-section",{open:[1540],status:[513],text:[1],toggleDisplay:[513,"toggle-display"],messages:[1040],messageOverrides:[1040],effectiveLocale:[32],defaultMessages:[32],setFocus:[64]}]);function r2t(){if(typeof customElements>"u")return;["calcite-block-section","calcite-icon","calcite-label","calcite-switch"].forEach(e=>{switch(e){case"calcite-block-section":customElements.get(e)||customElements.define(e,i2t);break;case"calcite-icon":customElements.get(e)||Ba();break;case"calcite-label":customElements.get(e)||Z3e();break;case"calcite-switch":customElements.get(e)||J3e();break}})}r2t();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */var e4;(function(t){t.brand="lightbulb",t.danger="exclamationMarkTriangle",t.info="information",t.success="checkCircle",t.warning="exclamationMarkTriangle"})(e4||(e4={}));/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const cC={title:"title",message:"message",link:"link",actionsEnd:"actions-end"},uC={actionsEnd:"actions-end",close:"notice-close",container:"container",content:"notice-content",icon:"notice-icon"},n2t=`:host([scale=s]){--calcite-notice-spacing-token-small:0.5rem;--calcite-notice-spacing-token-large:0.75rem}:host([scale=s]) .container slot[name=title]::slotted(*),:host([scale=s]) .container *::slotted([slot=title]){margin-block:0.125rem;font-size:var(--calcite-font-size--1);line-height:1.375}:host([scale=s]) .container slot[name=message]::slotted(*),:host([scale=s]) .container *::slotted([slot=message]){margin-block:0.125rem;font-size:var(--calcite-font-size--2);line-height:1.375}:host([scale=s]) ::slotted(calcite-link){margin-block:0.125rem;font-size:var(--calcite-font-size--2);line-height:1.375}:host([scale=s]) .notice-close{padding:0.5rem}:host([scale=m]){--calcite-notice-spacing-token-small:0.75rem;--calcite-notice-spacing-token-large:1rem}:host([scale=m]) .container slot[name=title]::slotted(*),:host([scale=m]) .container *::slotted([slot=title]){margin-block:0.125rem;font-size:var(--calcite-font-size-0);line-height:1.375}:host([scale=m]) .container slot[name=message]::slotted(*),:host([scale=m]) .container *::slotted([slot=message]){margin-block:0.125rem;font-size:var(--calcite-font-size--1);line-height:1.375}:host([scale=m]) ::slotted(calcite-link){margin-block:0.125rem;font-size:var(--calcite-font-size--1);line-height:1.375}:host([scale=l]){--calcite-notice-spacing-token-small:1rem;--calcite-notice-spacing-token-large:1.25rem}:host([scale=l]) .container slot[name=title]::slotted(*),:host([scale=l]) .container *::slotted([slot=title]){margin-block:0.125rem;font-size:var(--calcite-font-size-1);line-height:1.375}:host([scale=l]) .container slot[name=message]::slotted(*),:host([scale=l]) .container *::slotted([slot=message]){margin-block:0.125rem;font-size:var(--calcite-font-size-0);line-height:1.375}:host([scale=l]) ::slotted(calcite-link){margin-block:0.125rem;font-size:var(--calcite-font-size-0);line-height:1.375}:host([width=auto]){--calcite-notice-width:auto}:host([width=half]){--calcite-notice-width:50%}:host([width=full]){--calcite-notice-width:100%}:host{margin-inline:auto;display:none;max-inline-size:100%;align-items:center;inline-size:var(--calcite-notice-width)}.container{pointer-events:none;margin-block:0px;box-sizing:border-box;display:none;inline-size:100%;background-color:var(--calcite-ui-foreground-1);opacity:0;transition:all var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s;max-block-size:0;text-align:start;border-inline-start:0px solid;box-shadow:0 0 0 0 transparent}.notice-close{outline-color:transparent}.notice-close:focus{outline:2px solid var(--calcite-ui-focus-color, var(--calcite-ui-brand));outline-offset:calc(
            -2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-ui-focus-offset-invert),
                1
              )
            )
          )}:host{display:flex}:host([open]) .container{pointer-events:auto;display:flex;max-block-size:100%;align-items:center;border-width:2px;opacity:1;--tw-shadow:0 4px 8px -1px rgba(0, 0, 0, 0.08), 0 2px 4px -1px rgba(0, 0, 0, 0.04);--tw-shadow-colored:0 4px 8px -1px var(--tw-shadow-color), 0 2px 4px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.container slot[name=title]::slotted(*),.container *::slotted([slot=title]){margin:0px;font-weight:var(--calcite-font-weight-medium);color:var(--calcite-ui-text-1)}.container slot[name=message]::slotted(*),.container *::slotted([slot=message]){margin:0px;display:inline;font-weight:var(--calcite-font-weight-normal);color:var(--calcite-ui-text-2);margin-inline-end:var(--calcite-notice-spacing-token-small)}.notice-content{box-sizing:border-box;transition:all var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s;padding-inline:var(--calcite-notice-spacing-token-large);flex:0 0 auto;display:flex;min-inline-size:0px;flex-direction:column;overflow-wrap:break-word;flex:1 1 0;padding-block:var(--calcite-notice-spacing-token-small);padding-inline:0 var(--calcite-notice-spacing-token-small)}.notice-content:first-of-type:not(:only-child){padding-inline-start:var(--calcite-notice-spacing-token-large)}.notice-content:only-of-type{padding-block:var(--calcite-notice-spacing-token-small);padding-inline:var(--calcite-notice-spacing-token-large)}.notice-icon{display:flex;align-items:center;box-sizing:border-box;transition:all var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s;padding-block:var(--calcite-notice-spacing-token-small);padding-inline:var(--calcite-notice-spacing-token-large);flex:0 0 auto}.notice-close{display:flex;cursor:pointer;align-items:center;align-self:stretch;border-style:none;background-color:transparent;color:var(--calcite-ui-text-3);outline:2px solid transparent;outline-offset:2px;box-sizing:border-box;transition:all var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s;padding-block:var(--calcite-notice-spacing-token-small);padding-inline:var(--calcite-notice-spacing-token-large);flex:0 0 auto;-webkit-appearance:none}.notice-close:hover,.notice-close:focus{background-color:var(--calcite-ui-foreground-2);color:var(--calcite-ui-text-1)}.notice-close:active{background-color:var(--calcite-ui-foreground-3)}.actions-end{display:flex;align-self:stretch}:host([kind=brand]) .container{border-color:var(--calcite-ui-brand)}:host([kind=brand]) .container .notice-icon{color:var(--calcite-ui-brand)}:host([kind=info]) .container{border-color:var(--calcite-ui-info)}:host([kind=info]) .container .notice-icon{color:var(--calcite-ui-info)}:host([kind=danger]) .container{border-color:var(--calcite-ui-danger)}:host([kind=danger]) .container .notice-icon{color:var(--calcite-ui-danger)}:host([kind=success]) .container{border-color:var(--calcite-ui-success)}:host([kind=success]) .container .notice-icon{color:var(--calcite-ui-success)}:host([kind=warning]) .container{border-color:var(--calcite-ui-warning)}:host([kind=warning]) .container .notice-icon{color:var(--calcite-ui-warning)}:host([hidden]){display:none}[hidden]{display:none}`,K3e=ln(class extends cn{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.calciteNoticeBeforeClose=Ji(this,"calciteNoticeBeforeClose",6),this.calciteNoticeBeforeOpen=Ji(this,"calciteNoticeBeforeOpen",6),this.calciteNoticeClose=Ji(this,"calciteNoticeClose",6),this.calciteNoticeOpen=Ji(this,"calciteNoticeOpen",6),this.setTransitionEl=t=>{this.transitionEl=t},this.close=()=>{this.open=!1},this.openTransitionProp="opacity",this.open=!1,this.kind="brand",this.closable=!1,this.icon=void 0,this.iconFlipRtl=!1,this.scale="m",this.width="auto",this.messages=void 0,this.messageOverrides=void 0,this.effectiveLocale=void 0,this.defaultMessages=void 0}openHandler(){TS(this)}onMessagesChange(){}updateRequestedIcon(){this.requestedIcon=Ace(e4,this.icon,this.kind)}connectedCallback(){M3e(this),yu(this),Ph(this)}disconnectedCallback(){$3e(this),_u(this),Mh(this)}async componentWillLoad(){Hs(this),this.requestedIcon=Ace(e4,this.icon,this.kind),await Oh(this),this.open&&TS(this)}componentDidLoad(){qs(this)}render(){const{el:t}=this,e=H("button",{"aria-label":this.messages.close,class:uC.close,onClick:this.close,ref:r=>this.closeButton=r},H("calcite-icon",{icon:"x",scale:this.scale==="l"?"m":"s"})),i=oD(t,cC.actionsEnd);return H("div",{class:uC.container,ref:this.setTransitionEl},this.requestedIcon?H("div",{class:uC.icon},H("calcite-icon",{flipRtl:this.iconFlipRtl,icon:this.requestedIcon,scale:this.scale==="l"?"m":"s"})):null,H("div",{class:uC.content},H("slot",{name:cC.title}),H("slot",{name:cC.message}),H("slot",{name:cC.link})),i?H("div",{class:uC.actionsEnd},H("slot",{name:cC.actionsEnd})):null,this.closable?e:null)}async setFocus(){await Ws(this);const t=this.el.querySelector("calcite-link");if(!(!this.closeButton&&!t)){if(t)return t.setFocus();this.closeButton&&this.closeButton.focus()}}onBeforeClose(){this.calciteNoticeBeforeClose.emit()}onBeforeOpen(){this.calciteNoticeBeforeOpen.emit()}onClose(){this.calciteNoticeClose.emit()}onOpen(){this.calciteNoticeOpen.emit()}effectiveLocaleChange(){Rh(this,this.effectiveLocale)}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{open:["openHandler"],messageOverrides:["onMessagesChange"],icon:["updateRequestedIcon"],kind:["updateRequestedIcon"],effectiveLocale:["effectiveLocaleChange"]}}static get style(){return n2t}},[1,"calcite-notice",{open:[1540],kind:[513],closable:[516],icon:[520],iconFlipRtl:[516,"icon-flip-rtl"],scale:[513],width:[513],messages:[1040],messageOverrides:[1040],effectiveLocale:[32],defaultMessages:[32],setFocus:[64]}]);function Q3e(){if(typeof customElements>"u")return;["calcite-notice","calcite-icon"].forEach(e=>{switch(e){case"calcite-notice":customElements.get(e)||customElements.define(e,K3e);break;case"calcite-icon":customElements.get(e)||Ba();break}})}Q3e();const s2t=K3e,o2t=Q3e,N8t=Object.freeze(Object.defineProperty({__proto__:null,CalciteNotice:s2t,defineCustomElement:o2t},Symbol.toStringTag,{value:"Module"}));/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */let aI;function lI(t,e){return parseInt(t.getPropertyValue(e))}async function a2t(){return aI||(aI=new Promise(t=>{requestAnimationFrame(()=>{const e=getComputedStyle(document.body);t({width:{large:lI(e,"--calcite-app-breakpoint-width-lg"),medium:lI(e,"--calcite-app-breakpoint-width-md"),small:lI(e,"--calcite-app-breakpoint-width-sm"),xsmall:lI(e,"--calcite-app-breakpoint-width-xs")}})})}),aI)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const xm={page:"page",selected:"is-selected",previous:"previous",next:"next",disabled:"is-disabled",ellipsis:"ellipsis",ellipsisStart:"ellipsis--start",ellipsisEnd:"ellipsis--end"},_ue={next:"chevronRight",previous:"chevronLeft"},l2t=`:host{display:flex;writing-mode:horizontal-tb}:host([scale=s]) .previous,:host([scale=s]) .next,:host([scale=s]) .page,:host([scale=s]) .ellipsis{block-size:1.5rem;padding-inline:0.25rem;font-size:var(--calcite-font-size--2);line-height:1rem;min-inline-size:1.5rem}:host([scale=m]) .previous,:host([scale=m]) .next,:host([scale=m]) .page,:host([scale=m]) .ellipsis{block-size:2rem;padding-inline:0.5rem;font-size:var(--calcite-font-size--1);line-height:1rem;min-inline-size:2rem}:host([scale=l]) .previous,:host([scale=l]) .next,:host([scale=l]) .page,:host([scale=l]) .ellipsis{block-size:2.75rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-inline-size:2.75rem}:host([scale=l]) .previous,:host([scale=l]) .next{padding-inline:0.625rem}:host([scale=l]) .page,:host([scale=l]) .ellipsis{padding-inline:0.75rem}:host button{outline-color:transparent}:host button:focus{outline:2px solid var(--calcite-ui-focus-color, var(--calcite-ui-brand));outline-offset:calc(
            -2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-ui-focus-offset-invert),
                1
              )
            )
          )}.previous,.next,.page,.ellipsis{margin:0px;box-sizing:border-box;display:flex;align-items:center;justify-content:center;border-style:none;--tw-border-opacity:0;background-color:transparent;padding:0px;vertical-align:baseline;font-family:inherit;font-size:var(--calcite-font-size-0);line-height:1.25rem;color:var(--calcite-ui-text-3)}.previous,.next,.page{cursor:pointer;border-block:2px solid transparent}.previous:hover,.next:hover,.page:hover{color:var(--calcite-ui-text-1);transition:all var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s}.page:hover{border-block-end-color:var(--calcite-ui-border-2)}.page.is-selected{font-weight:var(--calcite-font-weight-medium);color:var(--calcite-ui-text-1);border-block-end-color:var(--calcite-ui-brand)}.previous:hover,.next:hover{background-color:var(--calcite-ui-foreground-2);color:var(--calcite-ui-brand)}.previous:active,.next:active{background-color:var(--calcite-ui-foreground-3)}.previous.is-disabled,.next.is-disabled{pointer-events:none;background-color:transparent}.previous.is-disabled>calcite-icon,.next.is-disabled>calcite-icon{opacity:var(--calcite-ui-opacity-disabled)}:host([hidden]){display:none}[hidden]{display:none}`,Gz=2,vue=2,hC={large:11,medium:9,small:7,xsmall:5},c2t=ln(class extends cn{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.calcitePaginationChange=Ji(this,"calcitePaginationChange",6),this.resizeObserver=hc("resize",t=>t.forEach(this.resizeHandler)),this.resizeHandler=({contentRect:{width:t}})=>this.setMaxItemsToBreakpoint(t),this.previousClicked=async()=>{await this.previousPage(),this.emitUpdate()},this.nextClicked=async()=>{await this.nextPage(),this.emitUpdate()},this.handlePageClick=t=>{const e=t.target;this.startItem=parseInt(e.value,10),this.emitUpdate()},this.groupSeparator=!1,this.messages=void 0,this.messageOverrides=void 0,this.numberingSystem=void 0,this.pageSize=20,this.scale="m",this.startItem=1,this.totalItems=0,this.defaultMessages=void 0,this.effectiveLocale="",this.maxItems=hC.xsmall,this.totalPages=void 0}onMessagesChange(){}handleTotalPages(){this.totalPages=this.totalItems/this.pageSize}effectiveLocaleChange(){Rh(this,this.effectiveLocale)}effectiveLocaleWatcher(){N3.numberFormatOptions={locale:this.effectiveLocale,numberingSystem:this.numberingSystem,useGrouping:this.groupSeparator}}connectedCallback(){yu(this),Ph(this),this.resizeObserver?.observe(this.el)}async componentWillLoad(){const[,t]=await Promise.all([Oh(this),a2t()]);this.breakpoints=t,Hs(this),this.handleTotalPages()}componentDidLoad(){qs(this),this.setMaxItemsToBreakpoint(this.el.clientWidth)}disconnectedCallback(){_u(this),Mh(this),this.resizeObserver?.disconnect()}async setFocus(){await Ws(this),this.el.focus()}async nextPage(){this.startItem=Math.min(this.getLastStart(),this.startItem+this.pageSize)}async previousPage(){this.startItem=Math.max(1,this.startItem-this.pageSize)}setMaxItemsToBreakpoint(t){const{breakpoints:e}=this;if(!(!e||!t)){if(t>=e.width.medium){this.maxItems=hC.large;return}if(t>=e.width.small){this.maxItems=hC.medium;return}if(t>=e.width.xsmall){this.maxItems=hC.small;return}this.maxItems=hC.xsmall}}getLastStart(){const{totalItems:t,pageSize:e,totalPages:i}=this;return(t%e===0?t-e:Math.floor(i)*e)+1}showStartEllipsis(){return this.totalPages>this.maxItems&&Math.floor(this.startItem/this.pageSize)>this.maxItems-Gz-vue}showEndEllipsis(){return this.totalPages>this.maxItems&&(this.totalItems-this.startItem)/this.pageSize>this.maxItems-Gz-(vue-1)}emitUpdate(){this.calcitePaginationChange.emit()}renderEllipsis(t){return H("span",{class:{[xm.ellipsis]:!0,[xm.ellipsisStart]:t==="start",[xm.ellipsisEnd]:t==="end"},key:t},"…")}renderItems(){const{totalItems:t,pageSize:e,startItem:i,maxItems:r,totalPages:n}=this,s=[],o=t>e,a=this.showStartEllipsis(),l=this.showEndEllipsis(),c=this.getLastStart();o&&s.push(this.renderPage(1)),a&&s.push(this.renderEllipsis("start"));const u=r-Gz-(l?1:0)-(a?1:0);let d,p;n-1<=u?(p=1+e,d=c-e):i/e<u?(p=1+e,d=1+u*e):i+u*e>=t?(p=c-u*e,d=c-e):(p=i-e*((u-1)/2),d=i+e*((u-1)/2));for(let m=0;m<u&&p<=d;m++)s.push(this.renderPage(p)),p=p+e;return l&&s.push(this.renderEllipsis("end")),s.push(this.renderPage(c)),s}renderPage(t){const{pageSize:e}=this,i=Math.floor(t/e)+(e===1?0:1);N3.numberFormatOptions={locale:this.effectiveLocale,numberingSystem:this.numberingSystem,useGrouping:this.groupSeparator};const r=N3.localize(i.toString()),n=t===this.startItem;return H("button",{"aria-current":n?"page":"false",class:{[xm.page]:!0,[xm.selected]:n},onClick:this.handlePageClick,value:t},r)}render(){const{totalItems:t,pageSize:e,startItem:i,messages:r,scale:n}=this,s=e===1?i<=e:i<e,o=i+e>t,a=n==="l"?"m":"s";return H(ZR,null,H("button",{"aria-label":r.previous,class:{[xm.previous]:!0,[xm.disabled]:s},disabled:s,onClick:this.previousClicked},H("calcite-icon",{flipRtl:!0,icon:_ue.previous,scale:a})),this.renderItems(),H("button",{"aria-label":r.next,class:{[xm.next]:!0,[xm.disabled]:o},disabled:o,onClick:this.nextClicked},H("calcite-icon",{flipRtl:!0,icon:_ue.next,scale:a})))}static get delegatesFocus(){return!0}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{messageOverrides:["onMessagesChange"],pageSize:["handleTotalPages"],totalItems:["handleTotalPages"],effectiveLocale:["effectiveLocaleChange","effectiveLocaleWatcher"]}}static get style(){return l2t}},[17,"calcite-pagination",{groupSeparator:[516,"group-separator"],messages:[1040],messageOverrides:[1040],numberingSystem:[1,"numbering-system"],pageSize:[514,"page-size"],scale:[513],startItem:[1538,"start-item"],totalItems:[514,"total-items"],defaultMessages:[32],effectiveLocale:[32],maxItems:[32],totalPages:[32],setFocus:[64],nextPage:[64],previousPage:[64]}]);function u2t(){if(typeof customElements>"u")return;["calcite-pagination","calcite-icon"].forEach(e=>{switch(e){case"calcite-pagination":customElements.get(e)||customElements.define(e,c2t);break;case"calcite-icon":customElements.get(e)||Ba();break}})}u2t();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const ba={actionBarContainer:"action-bar-container",backButton:"back-button",container:"container",header:"header",headerContainer:"header-container",headerContainerBorderEnd:"header-container--border-end",heading:"heading",summary:"summary",description:"description",headerContent:"header-content",headerActions:"header-actions",headerActionsEnd:"header-actions--end",headerActionsStart:"header-actions--start",contentWrapper:"content-wrapper",fabContainer:"fab-container",footer:"footer"},cI={close:"x",menu:"ellipsis",backLeft:"chevron-left",backRight:"chevron-right",expand:"chevron-down",collapse:"chevron-up"},k0={actionBar:"action-bar",headerActionsStart:"header-actions-start",headerActionsEnd:"header-actions-end",headerMenuActions:"header-menu-actions",headerContent:"header-content",fab:"fab",footer:"footer",footerActions:"footer-actions"},h2t=":host{box-sizing:border-box;background-color:var(--calcite-ui-foreground-1);color:var(--calcite-ui-text-2);font-size:var(--calcite-font-size--1)}:host *{box-sizing:border-box}:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-ui-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{position:relative;display:flex;block-size:100%;inline-size:100%;flex:1 1 auto;overflow:hidden;--calcite-min-header-height:calc(var(--calcite-icon-size) * 3)}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.header{margin:0px;display:flex;align-content:space-between;align-items:center;fill:var(--calcite-ui-text-2);color:var(--calcite-ui-text-2)}.heading{margin:0px;padding:0px;font-weight:var(--calcite-font-weight-medium)}.header .heading{flex:1 1 auto;padding:0.5rem}.container{margin:0px;display:flex;inline-size:100%;flex:1 1 auto;flex-direction:column;align-items:stretch;background-color:var(--calcite-ui-background);padding:0px;transition:max-block-size var(--calcite-animation-timing), inline-size var(--calcite-animation-timing)}.container[hidden]{display:none}.header{z-index:var(--calcite-app-z-index-header);display:flex;flex-direction:column;background-color:var(--calcite-ui-foreground-1);border-block-end:var(--calcite-panel-header-border-block-end, 1px solid var(--calcite-ui-border-3))}.header-container{display:flex;inline-size:100%;flex-direction:row;align-items:stretch;justify-content:flex-start;flex:0 0 auto}.header-container--border-end{border-block-end:1px solid var(--calcite-ui-border-3)}.action-bar-container{inline-size:100%}.action-bar-container ::slotted(calcite-action-bar){inline-size:100%}.header-content{display:flex;flex-direction:column;overflow:hidden;padding-inline:0.75rem;padding-block:0.875rem;margin-inline-end:auto}.header-content .heading,.header-content .description{display:block;overflow-wrap:break-word;padding:0px}.header-content .heading{margin-inline:0px;margin-block:0px 0.25rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;font-weight:var(--calcite-font-weight-medium)}.header-content .heading:only-child{margin-block-end:0px}.header-content .description{font-size:var(--calcite-font-size--1);line-height:1rem;color:var(--calcite-ui-text-2)}.back-button{border-width:0px;border-style:solid;border-color:var(--calcite-ui-border-3);border-inline-end-width:1px}.header-actions{display:flex;flex-direction:row;flex-wrap:nowrap;align-items:stretch}.header-actions--end{margin-inline-start:auto}.content-wrapper{display:flex;block-size:100%;flex:1 1 auto;flex-direction:column;flex-wrap:nowrap;align-items:stretch;overflow:auto;background-color:var(--calcite-ui-background)}.footer{display:flex;inline-size:100%;justify-content:space-evenly;background-color:var(--calcite-ui-foreground-1);flex:0 0 auto;padding:var(--calcite-panel-footer-padding, 0.5rem);border-block-start:1px solid var(--calcite-ui-border-3)}.fab-container{position:sticky;inset-block-end:0px;z-index:var(--calcite-app-z-index-sticky);margin-block:0px;margin-inline:auto;display:block;padding:0.5rem;inset-inline:0;inline-size:-moz-fit-content;inline-size:fit-content}:host([hidden]){display:none}[hidden]{display:none}",d2t=ln(class extends cn{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.calcitePanelClose=Ji(this,"calcitePanelClose",6),this.calcitePanelToggle=Ji(this,"calcitePanelToggle",6),this.calcitePanelScroll=Ji(this,"calcitePanelScroll",6),this.resizeObserver=hc("resize",()=>this.resizeHandler()),this.resizeHandler=()=>{const{panelScrollEl:t}=this;!t||typeof t.scrollHeight!="number"||typeof t.offsetHeight!="number"||(t.tabIndex=t.scrollHeight>t.offsetHeight?0:-1)},this.setContainerRef=t=>{this.containerEl=t},this.panelKeyDownHandler=t=>{this.closable&&t.key==="Escape"&&!t.defaultPrevented&&(this.close(),t.preventDefault())},this.close=()=>{this.closed=!0,this.calcitePanelClose.emit()},this.collapse=()=>{this.collapsed=!this.collapsed,this.calcitePanelToggle.emit()},this.panelScrollHandler=()=>{this.calcitePanelScroll.emit()},this.handleHeaderActionsStartSlotChange=t=>{this.hasStartActions=Wo(t)},this.handleHeaderActionsEndSlotChange=t=>{this.hasEndActions=Wo(t)},this.handleHeaderMenuActionsSlotChange=t=>{this.hasMenuItems=Wo(t)},this.handleActionBarSlotChange=t=>{const e=Ok(t).filter(i=>i?.matches("calcite-action-bar"));e.forEach(i=>i.layout="horizontal"),this.hasActionBar=!!e.length},this.handleHeaderContentSlotChange=t=>{this.hasHeaderContent=Wo(t)},this.handleFooterSlotChange=t=>{this.hasFooterContent=Wo(t)},this.handleFooterActionsSlotChange=t=>{this.hasFooterActions=Wo(t)},this.handleFabSlotChange=t=>{this.hasFab=Wo(t)},this.setPanelScrollEl=t=>{this.panelScrollEl=t,this.resizeObserver?.disconnect(),t&&(this.resizeObserver?.observe(t),this.resizeHandler())},this.closed=!1,this.disabled=!1,this.closable=!1,this.collapsed=!1,this.collapseDirection="down",this.collapsible=!1,this.headingLevel=void 0,this.loading=!1,this.heading=void 0,this.description=void 0,this.menuOpen=!1,this.messageOverrides=void 0,this.messages=void 0,this.hasStartActions=!1,this.hasEndActions=!1,this.hasMenuItems=!1,this.hasHeaderContent=!1,this.hasActionBar=!1,this.hasFooterContent=!1,this.hasFooterActions=!1,this.hasFab=!1,this.defaultMessages=void 0,this.effectiveLocale="",this.showHeaderContent=!1}onMessagesChange(){}connectedCallback(){F_(this),yu(this),Ph(this)}async componentWillLoad(){Hs(this),await Oh(this)}componentDidLoad(){qs(this)}componentDidRender(){N_(this)}disconnectedCallback(){k_(this),_u(this),Mh(this),this.resizeObserver?.disconnect()}effectiveLocaleChange(){Rh(this,this.effectiveLocale)}async setFocus(){await Ws(this),Ak(this.containerEl)}async scrollContentTo(t){this.panelScrollEl?.scrollTo(t)}renderHeaderContent(){const{heading:t,headingLevel:e,description:i,hasHeaderContent:r}=this,n=t?H(sJ,{class:ba.heading,level:e},t):null,s=i?H("span",{class:ba.description},i):null;return!r&&(n||s)?H("div",{class:ba.headerContent,key:"header-content"},n,s):null}renderActionBar(){return H("div",{class:ba.actionBarContainer,hidden:!this.hasActionBar},H("slot",{name:k0.actionBar,onSlotchange:this.handleActionBarSlotChange}))}renderHeaderSlottedContent(){return H("div",{class:ba.headerContent,hidden:!this.hasHeaderContent,key:"slotted-header-content"},H("slot",{name:k0.headerContent,onSlotchange:this.handleHeaderContentSlotChange}))}renderHeaderStartActions(){const{hasStartActions:t}=this;return H("div",{class:{[ba.headerActionsStart]:!0,[ba.headerActions]:!0},hidden:!t,key:"header-actions-start"},H("slot",{name:k0.headerActionsStart,onSlotchange:this.handleHeaderActionsStartSlotChange}))}renderHeaderActionsEnd(){const{hasEndActions:t,messages:e,closable:i,collapsed:r,collapseDirection:n,collapsible:s,hasMenuItems:o}=this,{collapse:a,expand:l,close:c}=e,u=[cI.expand,cI.collapse];n==="up"&&u.reverse();const d=s?H("calcite-action",{"aria-expanded":oa(!r),"aria-label":a,"data-test":"collapse",icon:r?u[0]:u[1],onClick:this.collapse,text:a,title:r?l:a}):null,p=i?H("calcite-action",{"aria-label":c,"data-test":"close",icon:cI.close,onClick:this.close,text:c,title:c}):null,m=H("slot",{name:k0.headerActionsEnd,onSlotchange:this.handleHeaderActionsEndSlotChange}),y=t||d||p||o;return H("div",{class:{[ba.headerActionsEnd]:!0,[ba.headerActions]:!0},hidden:!y,key:"header-actions-end"},m,this.renderMenu(),d,p)}renderMenu(){const{hasMenuItems:t,messages:e,menuOpen:i}=this;return H("calcite-action-menu",{flipPlacements:["top","bottom"],hidden:!t,key:"menu",label:e.options,open:i,placement:"bottom-end"},H("calcite-action",{icon:cI.menu,slot:dH.trigger,text:e.options}),H("slot",{name:k0.headerMenuActions,onSlotchange:this.handleHeaderMenuActionsSlotChange}))}renderHeaderNode(){const{hasHeaderContent:t,hasStartActions:e,hasEndActions:i,closable:r,collapsible:n,hasMenuItems:s,hasActionBar:o}=this,a=this.renderHeaderContent(),l=t||!!a||e||i||n||r||s;return this.showHeaderContent=l,H("header",{class:ba.header,hidden:!(l||o)},H("div",{class:{[ba.headerContainer]:!0,[ba.headerContainerBorderEnd]:o},hidden:!l},this.renderHeaderStartActions(),this.renderHeaderSlottedContent(),a,this.renderHeaderActionsEnd()),this.renderActionBar())}renderFooterNode(){const{hasFooterContent:t,hasFooterActions:e}=this,i=t||e;return H("footer",{class:ba.footer,hidden:!i},H("slot",{key:"footer-slot",name:k0.footer,onSlotchange:this.handleFooterSlotChange}),H("slot",{key:"footer-actions-slot",name:k0.footerActions,onSlotchange:this.handleFooterActionsSlotChange}))}renderContent(){return H("div",{class:ba.contentWrapper,hidden:this.collapsible&&this.collapsed,onScroll:this.panelScrollHandler,ref:this.setPanelScrollEl},H("slot",null),this.renderFab())}renderFab(){return H("div",{class:ba.fabContainer,hidden:!this.hasFab},H("slot",{name:k0.fab,onSlotchange:this.handleFabSlotChange}))}render(){const{loading:t,panelKeyDownHandler:e,closed:i,closable:r}=this,n=H("article",{"aria-busy":oa(t),class:ba.container,hidden:i,onKeyDown:e,tabIndex:r?0:-1,ref:this.setContainerRef},this.renderHeaderNode(),this.renderContent(),this.renderFooterNode());return H(ZR,null,t?H("calcite-scrim",{loading:t}):null,n)}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{messageOverrides:["onMessagesChange"],effectiveLocale:["effectiveLocaleChange"]}}static get style(){return h2t}},[1,"calcite-panel",{closed:[1540],disabled:[516],closable:[516],collapsed:[516],collapseDirection:[1,"collapse-direction"],collapsible:[516],headingLevel:[514,"heading-level"],loading:[516],heading:[1],description:[1],menuOpen:[516,"menu-open"],messageOverrides:[1040],messages:[1040],hasStartActions:[32],hasEndActions:[32],hasMenuItems:[32],hasHeaderContent:[32],hasActionBar:[32],hasFooterContent:[32],hasFooterActions:[32],hasFab:[32],defaultMessages:[32],effectiveLocale:[32],showHeaderContent:[32],setFocus:[64],scrollContentTo:[64]}]);function p2t(){if(typeof customElements>"u")return;["calcite-panel","calcite-action","calcite-action-menu","calcite-icon","calcite-loader","calcite-popover","calcite-scrim"].forEach(e=>{switch(e){case"calcite-panel":customElements.get(e)||customElements.define(e,d2t);break;case"calcite-action":customElements.get(e)||xw();break;case"calcite-action-menu":customElements.get(e)||hJ();break;case"calcite-icon":customElements.get(e)||Ba();break;case"calcite-loader":customElements.get(e)||em();break;case"calcite-popover":customElements.get(e)||kk();break;case"calcite-scrim":customElements.get(e)||dJ();break}})}p2t();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const f2t={container:"container"},m2t=`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-ui-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:block;cursor:pointer}:host .container{position:relative;outline:2px solid transparent;outline-offset:2px}:host .radio{cursor:pointer;border-radius:9999px;background-color:var(--calcite-ui-foreground-1);outline-color:transparent;transition:all var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s;box-shadow:inset 0 0 0 1px var(--calcite-ui-border-input)}:host([hovered]) .radio,:host(:not([checked])[focused]:not([disabled])) .radio{box-shadow:inset 0 0 0 2px var(--calcite-ui-brand)}:host([focused]) .radio{outline:2px solid var(--calcite-ui-focus-color, var(--calcite-ui-brand));outline-offset:calc(
            2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-ui-focus-offset-invert),
                1
              )
            )
          )}:host([disabled]) .radio{cursor:default;opacity:var(--calcite-ui-opacity-disabled)}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}:host([hovered][disabled]) .radio{box-shadow:inset 0 0 0 1px var(--calcite-ui-border-input)}:host([scale=s]){--calcite-radio-size:var(--calcite-font-size--2)}:host([scale=m]){--calcite-radio-size:var(--calcite-font-size--1)}:host([scale=l]){--calcite-radio-size:var(--calcite-font-size-0)}.radio{block-size:var(--calcite-radio-size);max-inline-size:var(--calcite-radio-size);min-inline-size:var(--calcite-radio-size)}:host([scale=s][checked]) .radio,:host([hovered][scale=s][checked][disabled]) .radio{box-shadow:inset 0 0 0 4px var(--calcite-ui-brand)}:host([scale=s][focused][checked]:not([disabled])) .radio{box-shadow:inset 0 0 0 4px var(--calcite-ui-brand), 0 0 0 2px var(--calcite-ui-foreground-1)}:host([scale=m][checked]) .radio,:host([hovered][scale=m][checked][disabled]) .radio{box-shadow:inset 0 0 0 5px var(--calcite-ui-brand)}:host([scale=m][focused][checked]:not([disabled])) .radio{box-shadow:inset 0 0 0 5px var(--calcite-ui-brand), 0 0 0 2px var(--calcite-ui-foreground-1)}:host([scale=l][checked]) .radio,:host([hovered][scale=l][checked][disabled]) .radio{box-shadow:inset 0 0 0 6px var(--calcite-ui-brand)}:host([scale=l][focused][checked]:not([disabled])) .radio{box-shadow:inset 0 0 0 6px var(--calcite-ui-brand), 0 0 0 2px var(--calcite-ui-foreground-1)}@media (forced-colors: active){:host([checked]) .radio::after,:host([checked][disabled]) .radio::after{content:"";inline-size:var(--calcite-radio-size);block-size:var(--calcite-radio-size);background-color:windowText;display:block}}::slotted(input[slot=hidden-form-input]){margin:0 !important;opacity:0 !important;outline:none !important;padding:0 !important;position:absolute !important;inset:0 !important;transform:none !important;-webkit-appearance:none !important;z-index:-1 !important}:host([hidden]){display:none}[hidden]{display:none}`,g2t=ln(class extends cn{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.calciteInternalRadioButtonBlur=Ji(this,"calciteInternalRadioButtonBlur",6),this.calciteRadioButtonChange=Ji(this,"calciteRadioButtonChange",6),this.calciteInternalRadioButtonCheckedChange=Ji(this,"calciteInternalRadioButtonCheckedChange",6),this.calciteInternalRadioButtonFocus=Ji(this,"calciteInternalRadioButtonFocus",6),this.selectItem=(t,e)=>{t[e].click()},this.queryButtons=()=>Array.from(this.rootNode.querySelectorAll("calcite-radio-button:not([hidden])")).filter(t=>t.name===this.name),this.isFocusable=()=>{const t=this.queryButtons(),e=t.find(r=>!r.disabled),i=t.find(r=>r.checked);return e===this.el&&!i},this.check=()=>{this.disabled||(this.focused=!0,this.setFocus(),!this.checked&&(this.uncheckAllRadioButtonsInGroup(),this.checked=!0,this.calciteRadioButtonChange.emit()))},this.clickHandler=()=>{this.disabled||this.check()},this.setContainerEl=t=>{this.containerEl=t},this.handleKeyDown=t=>{const e=["ArrowLeft","ArrowUp","ArrowRight","ArrowDown"," "],{key:i}=t,{el:r}=this;if(e.indexOf(i)===-1)return;if(i===" "){this.check(),t.preventDefault();return}let n=i;eE(r)==="rtl"&&(i==="ArrowRight"&&(n="ArrowLeft"),i==="ArrowLeft"&&(n="ArrowRight"));const s=Array.from(this.rootNode.querySelectorAll("calcite-radio-button:not([hidden]")).filter(l=>l.name===this.name);let o=0;const a=s.length;switch(s.some((l,c)=>{if(l.checked)return o=c,!0}),n){case"ArrowLeft":case"ArrowUp":t.preventDefault(),this.selectItem(s,W5(Math.max(o-1,-1),a));return;case"ArrowRight":case"ArrowDown":t.preventDefault(),this.selectItem(s,W5(o+1,a));return;default:return}},this.onContainerBlur=()=>{this.focused=!1,this.calciteInternalRadioButtonBlur.emit()},this.onContainerFocus=()=>{this.disabled||(this.focused=!0,this.calciteInternalRadioButtonFocus.emit())},this.checked=!1,this.disabled=!1,this.focused=!1,this.form=void 0,this.guid=void 0,this.hidden=!1,this.hovered=!1,this.label=void 0,this.name=void 0,this.required=!1,this.scale="m",this.value=void 0}checkedChanged(t){t&&this.uncheckOtherRadioButtonsInGroup(),this.calciteInternalRadioButtonCheckedChange.emit()}disabledChanged(){this.updateTabIndexOfOtherRadioButtonsInGroup()}hiddenChanged(){this.updateTabIndexOfOtherRadioButtonsInGroup()}nameChanged(){this.checkLastRadioButton()}async setFocus(){await Ws(this),this.disabled||tE(this.containerEl)}syncHiddenFormInput(t){t.type="radio"}onLabelClick(t){if(this.disabled||this.hidden)return;const e=t.currentTarget,i=e.for?this.rootNode.querySelector(`calcite-radio-button[id="${e.for}"]`):e.querySelector(`calcite-radio-button[name="${this.name}"]`);i&&(i.focused=!0,this.setFocus(),!i.checked&&(this.uncheckOtherRadioButtonsInGroup(),i.checked=!0,this.calciteRadioButtonChange.emit()))}checkLastRadioButton(){const e=this.queryButtons().filter(i=>i.checked);if(e?.length>1){const i=e[e.length-1];e.filter(r=>r!==i).forEach(r=>{r.checked=!1,r.emitCheckedChange()})}}async emitCheckedChange(){this.calciteInternalRadioButtonCheckedChange.emit()}uncheckAllRadioButtonsInGroup(){this.queryButtons().forEach(e=>{e.checked&&(e.checked=!1,e.focused=!1)})}uncheckOtherRadioButtonsInGroup(){this.queryButtons().filter(i=>i.guid!==this.guid).forEach(i=>{i.checked&&(i.checked=!1,i.focused=!1)})}updateTabIndexOfOtherRadioButtonsInGroup(){this.queryButtons().filter(i=>i.guid!==this.guid&&!i.disabled).forEach(i=>{QS(i)})}getTabIndex(){if(!this.disabled)return this.checked||this.isFocusable()?0:-1}pointerEnterHandler(){this.disabled||(this.hovered=!0)}pointerLeaveHandler(){this.disabled||(this.hovered=!1)}connectedCallback(){this.rootNode=this.el.getRootNode(),this.guid=this.el.id||`calcite-radio-button-${_w()}`,this.name&&this.checkLastRadioButton(),F_(this),iE(this),Pk(this),this.updateTabIndexOfOtherRadioButtonsInGroup()}componentWillLoad(){Hs(this)}componentDidLoad(){qs(this),this.focused&&!this.disabled&&this.setFocus()}disconnectedCallback(){k_(this),iP(this),Mk(this),this.updateTabIndexOfOtherRadioButtonsInGroup()}componentDidRender(){N_(this)}render(){const t=this.getTabIndex();return H(yo,{onClick:this.clickHandler,onKeyDown:this.handleKeyDown},H("div",{"aria-checked":oa(this.checked),"aria-label":Lk(this),class:f2t.container,onBlur:this.onContainerBlur,onFocus:this.onContainerFocus,role:"radio",tabIndex:t,ref:this.setContainerEl},H("div",{class:"radio"})),H($k,{component:this}))}get el(){return this}static get watchers(){return{checked:["checkedChanged"],disabled:["disabledChanged"],hidden:["hiddenChanged"],name:["nameChanged"]}}static get style(){return m2t}},[1,"calcite-radio-button",{checked:[1540],disabled:[516],focused:[1540],form:[513],guid:[1537],hidden:[516],hovered:[1540],label:[1],name:[513],required:[516],scale:[513],value:[1032],setFocus:[64],emitCheckedChange:[64]},[[1,"pointerenter","pointerEnterHandler"],[1,"pointerleave","pointerLeaveHandler"]]]);function y2t(){if(typeof customElements>"u")return;["calcite-radio-button"].forEach(e=>{switch(e){case"calcite-radio-button":customElements.get(e)||customElements.define(e,g2t);break}})}y2t();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const _2t=":host{display:flex;max-inline-size:100vw}:host([layout=horizontal]){flex-direction:row;flex-wrap:wrap}:host([layout=horizontal][scale=s]){gap:1rem}:host([layout=horizontal][scale=m]){gap:1.25rem}:host([layout=horizontal][scale=l]){gap:1.5rem}:host([layout=vertical]){flex-direction:column}:host([hidden]){display:none}[hidden]{display:none}",v2t=ln(class extends cn{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.calciteRadioButtonGroupChange=Ji(this,"calciteRadioButtonGroupChange",6),this.mutationObserver=hc("mutation",()=>this.passPropsToRadioButtons()),this.passPropsToRadioButtons=()=>{this.radioButtons=Array.from(this.el.querySelectorAll("calcite-radio-button")),this.selectedItem=Array.from(this.radioButtons).find(t=>t.checked)||null,this.radioButtons.length>0&&this.radioButtons.forEach(t=>{t.disabled=this.disabled||t.disabled,t.hidden=this.hidden,t.name=this.name,t.required=this.required,t.scale=this.scale})},this.disabled=!1,this.hidden=!1,this.layout="horizontal",this.name=void 0,this.required=!1,this.selectedItem=null,this.scale="m",this.radioButtons=[]}onDisabledChange(){this.passPropsToRadioButtons()}onHiddenChange(){this.passPropsToRadioButtons()}onLayoutChange(){this.passPropsToRadioButtons()}onScaleChange(){this.passPropsToRadioButtons()}connectedCallback(){this.passPropsToRadioButtons(),this.mutationObserver?.observe(this.el,{childList:!0,subtree:!0})}componentWillLoad(){Hs(this)}componentDidLoad(){qs(this)}disconnectedCallback(){this.mutationObserver?.disconnect()}getFocusableRadioButton(){return this.radioButtons.find(t=>!t.disabled)??null}async setFocus(){if(await Ws(this),this.selectedItem&&!this.selectedItem.disabled)return this.selectedItem.setFocus();if(this.radioButtons.length>0)return this.getFocusableRadioButton()?.setFocus()}radioButtonChangeHandler(t){this.selectedItem=t.target,this.calciteRadioButtonGroupChange.emit()}render(){return H(yo,{role:"radiogroup"},H("slot",null))}get el(){return this}static get watchers(){return{disabled:["onDisabledChange"],hidden:["onHiddenChange"],layout:["onLayoutChange"],scale:["onScaleChange"]}}static get style(){return _2t}},[1,"calcite-radio-button-group",{disabled:[516],hidden:[516],layout:[513],name:[513],required:[516],selectedItem:[1040],scale:[513],radioButtons:[32],setFocus:[64]},[[0,"calciteRadioButtonChange","radioButtonChangeHandler"]]]);function b2t(){if(typeof customElements>"u")return;["calcite-radio-button-group"].forEach(e=>{switch(e){case"calcite-radio-button-group":customElements.get(e)||customElements.define(e,v2t);break}})}b2t();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const w2t=":host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-ui-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:flex;background-color:var(--calcite-ui-foreground-1);inline-size:-moz-fit-content;inline-size:fit-content;outline:1px solid var(--calcite-ui-border-input);outline-offset:-1px}:host([appearance=outline]){background-color:transparent}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}:host([layout=vertical]){flex-direction:column;align-items:flex-start;align-self:flex-start}:host([width=full]){inline-size:100%;min-inline-size:-moz-fit-content;min-inline-size:fit-content}:host([width=full]) ::slotted(calcite-segmented-control-item){flex:1 1 auto}:host([width=full][layout=vertical]) ::slotted(calcite-segmented-control-item){justify-content:flex-start}::slotted(input[slot=hidden-form-input]){margin:0 !important;opacity:0 !important;outline:none !important;padding:0 !important;position:absolute !important;inset:0 !important;transform:none !important;-webkit-appearance:none !important;z-index:-1 !important}:host([hidden]){display:none}[hidden]{display:none}",x2t=ln(class extends cn{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.calciteSegmentedControlChange=Ji(this,"calciteSegmentedControlChange",6),this.handleClick=t=>{this.disabled||t.target.localName==="calcite-segmented-control-item"&&this.selectItem(t.target,!0)},this.mutationObserver=hc("mutation",()=>this.setUpItems()),this.appearance="solid",this.disabled=!1,this.form=void 0,this.required=!1,this.name=void 0,this.layout="horizontal",this.scale="m",this.value=null,this.selectedItem=void 0,this.width="auto"}handlePropsChange(){this.handleItemPropChange()}valueHandler(t){this.getItems().forEach(i=>i.checked=i.value===t)}handleSelectedItemChange(t,e){if(this.value=t?.value,t===e)return;const i=this.getItems(),r=i.filter(n=>n===t).pop();r?this.selectItem(r):i[0]&&(i[0].tabIndex=0)}componentWillLoad(){Hs(this),this.setUpItems()}componentDidLoad(){v3e(this,this.value),qs(this)}connectedCallback(){F_(this),iE(this),Pk(this),this.mutationObserver?.observe(this.el,{childList:!0}),this.handleItemPropChange()}disconnectedCallback(){k_(this),iP(this),Mk(this),this.mutationObserver?.unobserve(this.el)}componentDidRender(){N_(this)}render(){return H(yo,{onClick:this.handleClick,role:"radiogroup"},H("slot",null),H($k,{component:this}))}handleSelected(t){t.preventDefault(),this.selectItem(t.target),t.stopPropagation()}handleKeyDown(t){const e=["ArrowLeft","ArrowUp","ArrowRight","ArrowDown"," "],{key:i}=t,{el:r,selectedItem:n}=this;if(e.indexOf(i)===-1)return;let s=i;eE(r)==="rtl"&&(i==="ArrowRight"&&(s="ArrowLeft"),i==="ArrowLeft"&&(s="ArrowRight"));const o=this.getItems();let a=-1;switch(o.forEach((l,c)=>{l===n&&(a=c)}),s){case"ArrowLeft":case"ArrowUp":t.preventDefault();const l=a<1?o[o.length-1]:o[a-1];this.selectItem(l,!0);return;case"ArrowRight":case"ArrowDown":t.preventDefault();const c=a===-1?o[1]:o[a+1]||o[0];this.selectItem(c,!0);return;case" ":t.preventDefault(),this.selectItem(t.target,!0);return;default:return}}async setFocus(){await Ws(this),(this.selectedItem||this.getItems()[0])?.focus()}handleItemPropChange(){this.getItems().forEach(e=>{e.appearance=this.appearance,e.layout=this.layout,e.scale=this.scale})}onLabelClick(){this.setFocus()}getItems(){return Array.from(this.el.querySelectorAll("calcite-segmented-control-item"))}selectItem(t,e=!1){if(t===this.selectedItem)return;const i=this.getItems();let r=null;i.forEach(n=>{const s=n===t;(s&&!n.checked||!s&&n.checked)&&(n.checked=s),n.tabIndex=s?0:-1,s&&(r=n,e&&this.calciteSegmentedControlChange.emit())}),this.selectedItem=r,r&&r.focus()}setUpItems(){const t=this.getItems(),e=t.filter(i=>i.checked).pop();e?this.selectItem(e):t[0]&&(t[0].tabIndex=0)}get el(){return this}static get watchers(){return{appearance:["handlePropsChange"],layout:["handlePropsChange"],scale:["handlePropsChange"],value:["valueHandler"],selectedItem:["handleSelectedItemChange"]}}static get style(){return w2t}},[1,"calcite-segmented-control",{appearance:[513],disabled:[516],form:[513],required:[516],name:[513],layout:[513],scale:[513],value:[1025],selectedItem:[1040],width:[513],setFocus:[64]},[[0,"calciteInternalSegmentedControlItemChange","handleSelected"],[0,"keydown","handleKeyDown"]]]);function T2t(){if(typeof customElements>"u")return;["calcite-segmented-control"].forEach(e=>{switch(e){case"calcite-segmented-control":customElements.get(e)||customElements.define(e,x2t);break}})}T2t();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const S2t={input:"input"},bue={segmentedControlItemIcon:"segmented-control-item-icon"},E2t=`:host{display:flex;cursor:pointer;align-self:stretch;font-weight:var(--calcite-font-weight-normal);transition:background-color var(--calcite-internal-animation-timing-fast) ease-in-out, border-color var(--calcite-animation-timing) ease-in-out}:host label{pointer-events:none;margin:0.125rem;box-sizing:border-box;display:flex;flex:1 1 0%;align-items:center;color:var(--calcite-ui-text-3);transition:background-color var(--calcite-internal-animation-timing-fast) ease-in-out, border-color var(--calcite-internal-animation-timing-fast) ease-in-out, color var(--calcite-internal-animation-timing-fast) ease-in-out}.label--horizontal{justify-content:center}:host{outline-color:transparent}:host(:focus){outline:2px solid var(--calcite-ui-focus-color, var(--calcite-ui-brand));outline-offset:calc(
            -2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-ui-focus-offset-invert),
                1
              )
            )
          );outline-offset:-1px}.label--scale-s{padding-inline:0.5rem;font-size:var(--calcite-font-size--2);line-height:1rem;padding-block:0.125rem}.label--scale-m{padding-inline:0.75rem;font-size:var(--calcite-font-size--1);line-height:1rem;padding-block:0.375rem}.label--scale-l{padding-inline:1rem;padding-block:0.625rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host(:hover) label{background-color:var(--calcite-ui-foreground-2);color:var(--calcite-ui-text-1)}:host(:active) label{background-color:var(--calcite-ui-foreground-3)}:host([checked]) label{cursor:default;border-color:var(--calcite-ui-brand);background-color:var(--calcite-ui-brand);color:var(--calcite-ui-background)}:host([checked]) .label--outline,:host([checked]) .label--outline-fill{border-color:var(--calcite-ui-brand);background-color:var(--calcite-ui-foreground-1);box-shadow:inset 0 0 0 1px var(--calcite-ui-brand);color:var(--calcite-ui-brand)}:host([checked]) .label--outline{background-color:transparent}::slotted(input){display:none}@media (forced-colors: active){:host([checked]) label{background-color:highlight}:host([checked]) .label--outline,:host([checked]) .label--outline-fill{outline:2px solid transparent;outline-offset:2px}:host([checked]) label:not([class~=label--outline]) .segmented-control-item-icon{color:highlightText}}.segmented-control-item-icon{position:relative;margin:0px;display:inline-flex;line-height:inherit}:host([icon-start]) .label--scale-s .segmented-control-item-icon{margin-inline-end:0.5rem}:host([icon-end]) .label--scale-s .segmented-control-item-icon{margin-inline-start:0.5rem}:host([icon-start]) .label--scale-m .segmented-control-item-icon{margin-inline-end:0.75rem}:host([icon-end]) .label--scale-m .segmented-control-item-icon{margin-inline-start:0.75rem}:host([icon-start]) .label--scale-l .segmented-control-item-icon{margin-inline-end:1rem}:host([icon-end]) .label--scale-l .segmented-control-item-icon{margin-inline-start:1rem}:host([hidden]){display:none}[hidden]{display:none}`,C2t=ln(class extends cn{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.calciteInternalSegmentedControlItemChange=Ji(this,"calciteInternalSegmentedControlItemChange",6),this.checked=!1,this.iconFlipRtl=!1,this.iconStart=void 0,this.iconEnd=void 0,this.value=void 0,this.appearance="solid",this.layout="horizontal",this.scale="m"}handleCheckedChange(){this.calciteInternalSegmentedControlItemChange.emit()}render(){const{appearance:t,checked:e,layout:i,scale:r,value:n}=this,s=this.iconStart?H("calcite-icon",{class:bue.segmentedControlItemIcon,flipRtl:this.iconFlipRtl,icon:this.iconStart,key:"icon-start",scale:"s"}):null,o=this.iconEnd?H("calcite-icon",{class:bue.segmentedControlItemIcon,flipRtl:this.iconFlipRtl,icon:this.iconEnd,key:"icon-end",scale:"s"}):null;return H(yo,{"aria-checked":oa(e),"aria-label":n,role:"radio"},H("label",{class:{"label--scale-s":r==="s","label--scale-m":r==="m","label--scale-l":r==="l","label--horizontal":i==="horizontal","label--outline":t==="outline","label--outline-fill":t==="outline-fill"}},this.iconStart?s:null,H("slot",null,n),H("slot",{name:S2t.input}),this.iconEnd?o:null))}get el(){return this}static get watchers(){return{checked:["handleCheckedChange"]}}static get style(){return E2t}},[1,"calcite-segmented-control-item",{checked:[1540],iconFlipRtl:[516,"icon-flip-rtl"],iconStart:[513,"icon-start"],iconEnd:[513,"icon-end"],value:[1032],appearance:[1],layout:[1],scale:[1]}]);function A2t(){if(typeof customElements>"u")return;["calcite-segmented-control-item","calcite-icon"].forEach(e=>{switch(e){case"calcite-segmented-control-item":customElements.get(e)||customElements.define(e,C2t);break;case"calcite-icon":customElements.get(e)||Ba();break}})}A2t();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const O2t=(t,e,i)=>Math.max(e,Math.min(t,i)),R2t=new RegExp(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/),uI=t=>{const e=(""+t).match(R2t);return!e||parseInt(e[1])===0?0:Math.max(0,(e[1]?e[1].length:0)-(e[2]?+e[2]:0))};/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */function P2t(t,e,i){const r=e[0]-t[0],n=i[0]-e[0],s=e[1]-t[1],o=i[1]-e[1],a=s/(r||n<0&&0),l=o/(n||r<0&&0),c=(a*n+l*r)/(r+n);return(Math.sign(a)+Math.sign(l))*Math.min(Math.abs(a),Math.abs(l),.5*Math.abs(c))||0}function wue(t,e,i){const r=e[0]-t[0],n=e[1]-t[1];return r?(3*n/r-i)/2:i}function xue(t,e,i,r,n){const[s,o]=t,[a,l]=e,c=(a-s)/3,u=n([s+c,o+c*i]).join(","),d=n([a-c,l-c*r]).join(","),p=n([a,l]).join(",");return`C ${u} ${d} ${p}`}function M2t({width:t,height:e,min:i,max:r}){const n=r[0]-i[0],s=r[1]-i[1];return o=>{const a=(o[0]-i[0])/n*t,l=e-o[1]/s*e;return[a,l]}}function $2t(t){const[e,i]=t[0],r=[e,i],n=[e,i];return t.reduce(({min:s,max:o},[a,l])=>({min:[Math.min(s[0],a),Math.min(s[1],l)],max:[Math.max(o[0],a),Math.max(o[1],l)]}),{min:r,max:n})}function I2t({data:t,min:e,max:i,t:r}){if(t.length===0)return"";const[n,s]=r(t[0]),[o,a]=r(e),[l]=r(i);let c,u,d;const p=t.reduce((_,v,w)=>{if(u=t[w-2],d=t[w-1],w>1){const x=P2t(u,d,v),T=c===void 0?wue(u,d,x):c,S=xue(u,d,T,x,r);return c=x,`${_} ${S}`}return _},`M ${o},${a} L ${o},${s} L ${n},${s}`),m=t[t.length-1],y=xue(d,m,c,wue(d,m,c),r);return`${p} ${y} L ${l},${a} Z`}const L2t=":host{display:block;block-size:100%}.svg{fill:currentColor;stroke:transparent;margin:0px;display:block;block-size:100%;inline-size:100%;padding:0px}.svg .graph-path--highlight{fill:var(--calcite-ui-brand);opacity:0.5}:host([hidden]){display:none}[hidden]{display:none}",D2t=ln(class extends cn{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.graphId=`calcite-graph-${_w()}`,this.resizeObserver=hc("resize",()=>QS(this)),this.data=[],this.colorStops=void 0,this.highlightMin=void 0,this.highlightMax=void 0,this.min=void 0,this.max=void 0}connectedCallback(){this.resizeObserver?.observe(this.el)}disconnectedCallback(){this.resizeObserver?.disconnect()}render(){const{data:t,colorStops:e,el:i,highlightMax:r,highlightMin:n,min:s,max:o}=this,a=this.graphId,{clientHeight:l,clientWidth:c}=i;if(!t||t.length===0)return H("svg",{"aria-hidden":"true",class:"svg",height:l,preserveAspectRatio:"none",viewBox:`0 0 ${c} ${l}`,width:c});const{min:u,max:d}=$2t(t);let p=u,m=d;(s<u[0]||s>u[0])&&(p=[s,0]),(o>d[0]||o<d[0])&&(m=[o,d[1]]);const y=M2t({min:p,max:m,width:c,height:l}),[_]=y([n,m[1]]),[v]=y([r,m[1]]),w=I2t({data:t,min:u,max:d,t:y}),x=e?`url(#linear-gradient-${a})`:void 0;return H("svg",{"aria-hidden":"true",class:"svg",height:l,preserveAspectRatio:"none",viewBox:`0 0 ${c} ${l}`,width:c},e?H("defs",null,H("linearGradient",{id:`linear-gradient-${a}`,x1:"0",x2:"1",y1:"0",y2:"0"},e.map(({offset:T,color:S,opacity:E})=>H("stop",{offset:`${T*100}%`,"stop-color":S,"stop-opacity":E})))):null,n!==void 0?[H("mask",{height:"100%",id:`${a}1`,width:"100%",x:"0%",y:"0%"},H("path",{d:`
            M 0,0
            L ${_-1},0
            L ${_-1},${l}
            L 0,${l}
            Z
          `,fill:"white"})),H("mask",{height:"100%",id:`${a}2`,width:"100%",x:"0%",y:"0%"},H("path",{d:`
            M ${_+1},0
            L ${v-1},0
            L ${v-1},${l}
            L ${_+1}, ${l}
            Z
          `,fill:"white"})),H("mask",{height:"100%",id:`${a}3`,width:"100%",x:"0%",y:"0%"},H("path",{d:`
                M ${v+1},0
                L ${c},0
                L ${c},${l}
                L ${v+1}, ${l}
                Z
              `,fill:"white"})),H("path",{class:"graph-path",d:w,fill:x,mask:`url(#${a}1)`}),H("path",{class:"graph-path--highlight",d:w,fill:x,mask:`url(#${a}2)`}),H("path",{class:"graph-path",d:w,fill:x,mask:`url(#${a}3)`})]:H("path",{class:"graph-path",d:w,fill:x}))}get el(){return this}static get style(){return L2t}},[1,"calcite-graph",{data:[16],colorStops:[16],highlightMin:[2,"highlight-min"],highlightMax:[2,"highlight-max"],min:[514],max:[514]}]);function eOe(){if(typeof customElements>"u")return;["calcite-graph"].forEach(e=>{switch(e){case"calcite-graph":customElements.get(e)||customElements.define(e,D2t);break}})}eOe();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */const zx={handleLabel:"handle__label",handleLabelMinValue:"handle__label--minValue",handleLabelValue:"handle__label--value",tickMin:"tick__label--min",tickMax:"tick__label--max"},N2t=250,F2t=`@charset "UTF-8";:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-ui-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}.scale--s{--calcite-slider-handle-size:0.625rem;--calcite-slider-handle-extension-height:0.4rem;--calcite-slider-container-font-size:var(--calcite-font-size--3)}.scale--s .handle__label,.scale--s .tick__label{line-height:.75rem}.scale--m{--calcite-slider-handle-size:0.875rem;--calcite-slider-handle-extension-height:0.5rem;--calcite-slider-container-font-size:var(--calcite-font-size--2)}.scale--m .handle__label,.scale--m .tick__label{line-height:1rem}.scale--l{--calcite-slider-handle-size:1rem;--calcite-slider-handle-extension-height:0.65rem;--calcite-slider-container-font-size:var(--calcite-font-size--1)}.scale--l .handle__label,.scale--l .tick__label{line-height:1rem}.handle__label,.tick__label{font-weight:var(--calcite-font-weight-medium);color:var(--calcite-ui-text-2);font-size:var(--calcite-slider-container-font-size)}:host{display:block}.container{position:relative;display:block;overflow-wrap:normal;word-break:normal;padding-inline:calc(var(--calcite-slider-handle-size) * 0.5);padding-block:calc(var(--calcite-slider-handle-size) * 0.5);margin-block:calc(var(--calcite-slider-handle-size) * 0.5);margin-inline:0;--calcite-slider-full-handle-height:calc(
    var(--calcite-slider-handle-size) + var(--calcite-slider-handle-extension-height)
  );touch-action:none}:host([disabled]) .track__range,:host([disabled]) .tick--active{background-color:var(--calcite-ui-text-3)}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.scale--s .thumb:not(.thumb--precise){--calcite-slider-thumb-y-offset:-0.375rem}.scale--m .thumb:not(.thumb--precise){--calcite-slider-thumb-y-offset:-0.5rem}.scale--l .thumb:not(.thumb--precise){--calcite-slider-thumb-y-offset:-0.55rem}:host([precise]:not([has-histogram])) .container .thumb--value{--calcite-slider-thumb-y-offset:calc(var(--calcite-slider-full-handle-height) * -1)}.thumb-container{position:relative;max-inline-size:100%}.thumb{--calcite-slider-thumb-x-offset:calc(var(--calcite-slider-handle-size) * 0.5);position:absolute;margin:0px;display:flex;cursor:pointer;flex-direction:column;align-items:center;border-style:none;background-color:transparent;padding:0px;font-family:inherit;outline:2px solid transparent;outline-offset:2px;transform:translate(var(--calcite-slider-thumb-x-offset), var(--calcite-slider-thumb-y-offset))}.thumb .handle__label.static,.thumb .handle__label.transformed{position:absolute;inset-block:0px;opacity:0}.thumb .handle__label.hyphen::after{content:"—";display:inline-block;inline-size:1em}.thumb .handle__label.hyphen--wrap{display:flex}.thumb .handle{box-sizing:border-box;border-radius:9999px;background-color:var(--calcite-ui-foreground-1);outline-color:transparent;block-size:var(--calcite-slider-handle-size);inline-size:var(--calcite-slider-handle-size);box-shadow:0 0 0 2px var(--calcite-ui-text-3) inset;transition:border var(--calcite-internal-animation-timing-medium) ease, background-color var(--calcite-internal-animation-timing-medium) ease, box-shadow var(--calcite-animation-timing) ease}.thumb .handle-extension{inline-size:0.125rem;block-size:var(--calcite-slider-handle-extension-height);background-color:var(--calcite-ui-text-3)}.thumb:hover .handle{box-shadow:0 0 0 3px var(--calcite-ui-brand) inset}.thumb:hover .handle-extension{background-color:var(--calcite-ui-brand)}.thumb:focus .handle{outline:2px solid var(--calcite-ui-focus-color, var(--calcite-ui-brand));outline-offset:calc(
            2px *
            calc(
              1 -
              2 * clamp(
                0,
                var(--calcite-ui-focus-offset-invert),
                1
              )
            )
          )}.thumb:focus .handle-extension{background-color:var(--calcite-ui-brand)}.thumb.thumb--minValue{transform:translate(calc(var(--calcite-slider-thumb-x-offset) * -1), var(--calcite-slider-thumb-y-offset))}.thumb.thumb--precise{--calcite-slider-thumb-y-offset:-0.125rem}:host([label-handles]) .thumb{--calcite-slider-thumb-x-offset:50%}:host([label-handles]):host(:not([has-histogram])) .scale--s .thumb:not(.thumb--precise){--calcite-slider-thumb-y-offset:-1.4375rem}:host([label-handles]):host(:not([has-histogram])) .scale--m .thumb:not(.thumb--precise){--calcite-slider-thumb-y-offset:-1.875rem}:host([label-handles]):host(:not([has-histogram])) .scale--l .thumb:not(.thumb--precise){--calcite-slider-thumb-y-offset:-2rem}:host([has-histogram][label-handles]) .handle__label,:host([label-handles]:not([has-histogram])) .thumb--minValue.thumb--precise .handle__label{margin-block-start:0.5em}:host(:not([has-histogram]):not([precise])) .handle__label,:host([label-handles]:not([has-histogram])) .thumb--value .handle__label{margin-block-end:0.5em}:host([label-handles][precise]):host(:not([has-histogram])) .scale--s .thumb--value{--calcite-slider-thumb-y-offset:-2.075rem}:host([label-handles][precise]):host(:not([has-histogram])) .scale--m .thumb--value{--calcite-slider-thumb-y-offset:-2.75rem}:host([label-handles][precise]):host(:not([has-histogram])) .scale--l .thumb--value{--calcite-slider-thumb-y-offset:-3.0625rem}.thumb:focus .handle,.thumb--active .handle{background-color:var(--calcite-ui-brand);box-shadow:0 0 8px 0 rgba(0, 0, 0, 0.16)}.thumb:hover.thumb--precise:after,.thumb:focus.thumb--precise:after,.thumb--active.thumb--precise:after{background-color:var(--calcite-ui-brand)}.track{position:relative;block-size:0.125rem;border-radius:0px;background-color:var(--calcite-ui-border-2);transition:all var(--calcite-internal-animation-timing-medium) ease-in}.track__range{position:absolute;inset-block-start:0px;block-size:0.125rem;background-color:var(--calcite-ui-brand)}.container--range .track__range:hover{cursor:ew-resize}.container--range .track__range:after{position:absolute;inline-size:100%;content:"";inset-block-start:calc(var(--calcite-slider-full-handle-height) * 0.5 * -1);block-size:calc(var(--calcite-slider-handle-size) + var(--calcite-slider-handle-extension-height))}@media (forced-colors: active){.thumb{outline-width:0;outline-offset:0}.handle{outline:2px solid transparent;outline-offset:2px}.thumb:focus .handle,.thumb .handle-extension,.thumb:hover .handle-extension,.thumb:focus .handle-extension,.thumb:active .handle-extension{background-color:canvasText}.track{background-color:canvasText}.track__range{background-color:highlight}}.tick{position:absolute;block-size:0.25rem;inline-size:0.125rem;border-width:1px;border-style:solid;background-color:var(--calcite-ui-border-input);border-color:var(--calcite-ui-foreground-1);inset-block-start:-2px;pointer-events:none;margin-inline-start:calc(-1 * 0.125rem)}.tick--active{background-color:var(--calcite-ui-brand)}.tick__label{pointer-events:none;margin-block-start:0.875rem;display:flex;justify-content:center}.tick__label--min{transition:opacity var(--calcite-animation-timing)}.tick__label--max{transition:opacity var(--calcite-internal-animation-timing-fast)}:host([has-histogram][label-handles]) .tick__label--min,:host([has-histogram][label-handles]) .tick__label--max,:host([has-histogram][precise]) .tick__label--min,:host([has-histogram][precise]) .tick__label--max{font-weight:var(--calcite-font-weight-normal);color:var(--calcite-ui-text-3)}.graph{color:var(--calcite-ui-foreground-3);block-size:48px}:host([label-ticks][ticks]) .container{padding-block-end:calc(0.875rem + var(--calcite-slider-container-font-size))}:host([has-histogram]):host([precise][label-handles]) .container{padding-block-end:calc(var(--calcite-slider-full-handle-height) + 1em)}:host([has-histogram]):host([label-handles]:not([precise])) .container{padding-block-end:calc(var(--calcite-slider-handle-size) * 0.5 + 1em)}:host([has-histogram]):host([precise]:not([label-handles])) .container{padding-block-end:var(--calcite-slider-full-handle-height)}:host(:not([has-histogram])):host([precise]:not([label-handles])) .container{padding-block-start:var(--calcite-slider-full-handle-height)}:host(:not([has-histogram])):host([precise]:not([label-handles])) .container--range{padding-block-end:var(--calcite-slider-full-handle-height)}:host(:not([has-histogram])):host([label-handles]:not([precise])) .container{padding-block-start:calc(var(--calcite-slider-full-handle-height) + 4px)}:host(:not([has-histogram])):host([label-handles][precise]) .container{padding-block-start:calc(var(--calcite-slider-full-handle-height) + var(--calcite-slider-container-font-size) + 4px)}:host(:not([has-histogram])):host([label-handles][precise]) .container--range{padding-block-end:calc(var(--calcite-slider-full-handle-height) + var(--calcite-slider-container-font-size) + 4px)}::slotted(input[slot=hidden-form-input]){margin:0 !important;opacity:0 !important;outline:none !important;padding:0 !important;position:absolute !important;inset:0 !important;transform:none !important;-webkit-appearance:none !important;z-index:-1 !important}:host([hidden]){display:none}[hidden]{display:none}`;function Ec(t){return Array.isArray(t)}const k2t=ln(class extends cn{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.calciteSliderInput=Ji(this,"calciteSliderInput",6),this.calciteSliderChange=Ji(this,"calciteSliderChange",6),this.activeProp="value",this.guid=`calcite-slider-${_w()}`,this.dragUpdate=t=>{if(!this.disabled&&(t.preventDefault(),this.dragProp)){const e=this.translate(t.clientX||t.pageX);if(Ec(this.value)&&this.dragProp==="minMaxValue")if(this.minValueDragRange&&this.maxValueDragRange&&this.minMaxValueRange){const i=e-this.minValueDragRange,r=e+this.maxValueDragRange;r<=this.max&&i>=this.min&&r-i===this.minMaxValueRange&&this.setValue({minValue:this.clamp(i,"minValue"),maxValue:this.clamp(r,"maxValue")})}else this.minValueDragRange=e-this.minValue,this.maxValueDragRange=this.maxValue-e,this.minMaxValueRange=this.maxValue-this.minValue;else this.setValue({[this.dragProp]:this.clamp(e,this.dragProp)})}},this.pointerUpDragEnd=t=>{this.disabled||!ST(t)||this.dragEnd(t)},this.dragEnd=t=>{this.disabled||(this.removeDragListeners(),this.focusActiveHandle(t.clientX),this.lastDragPropValue!=this[this.dragProp]&&this.emitChange(),this.dragProp=null,this.lastDragPropValue=null,this.minValueDragRange=null,this.maxValueDragRange=null,this.minMaxValueRange=null)},this.storeTrackRef=t=>{this.trackEl=t},this.determineGroupSeparator=t=>{if(typeof t=="number")return N3.numberFormatOptions={locale:this.effectiveLocale,numberingSystem:this.numberingSystem,useGrouping:this.groupSeparator},N3.localize(t.toString())},this.disabled=!1,this.form=void 0,this.groupSeparator=!1,this.hasHistogram=!1,this.histogram=void 0,this.histogramStops=void 0,this.labelHandles=!1,this.labelTicks=!1,this.max=100,this.maxLabel=void 0,this.maxValue=void 0,this.min=0,this.minLabel=void 0,this.minValue=void 0,this.mirrored=!1,this.name=void 0,this.numberingSystem=void 0,this.pageStep=void 0,this.precise=!1,this.required=!1,this.snap=!1,this.step=1,this.ticks=void 0,this.value=0,this.scale="m",this.effectiveLocale="",this.minMaxValueRange=null,this.minValueDragRange=null,this.maxValueDragRange=null,this.tickValues=[]}histogramWatcher(t){this.hasHistogram=!!t}ticksWatcher(){this.tickValues=this.generateTickValues()}valueHandler(){this.setMinMaxFromValue()}minMaxValueHandler(){this.setValueFromMinMax()}connectedCallback(){F_(this),yu(this),this.setMinMaxFromValue(),this.setValueFromMinMax(),iE(this),Pk(this)}disconnectedCallback(){k_(this),iP(this),Mk(this),_u(this),this.removeDragListeners()}componentWillLoad(){Hs(this),Ec(this.value)||(this.value=this.snap?this.getClosestStep(this.value):this.clamp(this.value)),this.ticksWatcher(),this.histogramWatcher(this.histogram),v3e(this,this.value)}componentDidLoad(){qs(this)}componentDidRender(){this.labelHandles&&(this.adjustHostObscuredHandleLabel("value"),Ec(this.value)&&(this.adjustHostObscuredHandleLabel("minValue"),this.precise&&!this.hasHistogram||this.hyphenateCollidingRangeHandleLabels())),this.hideObscuredBoundingTickLabels(),N_(this)}render(){const t=this.el.id||this.guid,e=Ec(this.value)?"maxValue":"value",i=Ec(this.value)?this.maxValue:this.value,r=this.determineGroupSeparator(i),n=this.determineGroupSeparator(this.minValue),s=this.minValue||this.min,o=this.shouldUseMinValue(),a=this.getUnitInterval(o?this.minValue:s)*100,l=this.getUnitInterval(i)*100,c=this.shouldMirror(),u=`${c?100-a:a}%`,d=`${c?l:100-l}%`,p=Ec(this.value),m=`${zx.handleLabel} ${zx.handleLabelMinValue}`,y=`${zx.handleLabel} ${zx.handleLabelValue}`,_=H("div",{"aria-disabled":this.disabled,"aria-label":p?this.maxLabel:this.minLabel,"aria-orientation":"horizontal","aria-valuemax":this.max,"aria-valuemin":this.min,"aria-valuenow":i,class:{thumb:!0,"thumb--value":!0,"thumb--active":this.lastDragProp!=="minMaxValue"&&this.dragProp===e},onBlur:()=>this.activeProp=null,onFocus:()=>this.activeProp=e,onPointerDown:$=>this.pointerDownDragStart($,e),role:"slider",style:{right:d},tabIndex:0,ref:$=>this.maxHandle=$},H("div",{class:"handle"})),v=H("div",{"aria-disabled":this.disabled,"aria-label":p?this.maxLabel:this.minLabel,"aria-orientation":"horizontal","aria-valuemax":this.max,"aria-valuemin":this.min,"aria-valuenow":i,class:{thumb:!0,"thumb--value":!0,"thumb--active":this.lastDragProp!=="minMaxValue"&&this.dragProp===e},onBlur:()=>this.activeProp=null,onFocus:()=>this.activeProp=e,onPointerDown:$=>this.pointerDownDragStart($,e),role:"slider",style:{right:d},tabIndex:0,ref:$=>this.maxHandle=$},H("span",{"aria-hidden":"true",class:y},r),H("span",{"aria-hidden":"true",class:`${y} static`},r),H("span",{"aria-hidden":"true",class:`${y} transformed`},r),H("div",{class:"handle"})),w=H("div",{"aria-disabled":this.disabled,"aria-label":p?this.maxLabel:this.minLabel,"aria-orientation":"horizontal","aria-valuemax":this.max,"aria-valuemin":this.min,"aria-valuenow":i,class:{thumb:!0,"thumb--value":!0,"thumb--active":this.lastDragProp!=="minMaxValue"&&this.dragProp===e},onBlur:()=>this.activeProp=null,onFocus:()=>this.activeProp=e,onPointerDown:$=>this.pointerDownDragStart($,e),role:"slider",style:{right:d},tabIndex:0,ref:$=>this.maxHandle=$},H("div",{class:"handle"}),H("span",{"aria-hidden":"true",class:y},r),H("span",{"aria-hidden":"true",class:`${y} static`},r),H("span",{"aria-hidden":"true",class:`${y} transformed`},r)),x=H("div",{"aria-disabled":this.disabled,"aria-label":p?this.maxLabel:this.minLabel,"aria-orientation":"horizontal","aria-valuemax":this.max,"aria-valuemin":this.min,"aria-valuenow":i,class:{thumb:!0,"thumb--value":!0,"thumb--active":this.lastDragProp!=="minMaxValue"&&this.dragProp===e,"thumb--precise":!0},onBlur:()=>this.activeProp=null,onFocus:()=>this.activeProp=e,onPointerDown:$=>this.pointerDownDragStart($,e),role:"slider",style:{right:d},tabIndex:0,ref:$=>this.maxHandle=$},H("div",{class:"handle"}),H("div",{class:"handle-extension"})),T=H("div",{"aria-disabled":this.disabled,"aria-label":p?this.maxLabel:this.minLabel,"aria-orientation":"horizontal","aria-valuemax":this.max,"aria-valuemin":this.min,"aria-valuenow":i,class:{thumb:!0,"thumb--value":!0,"thumb--active":this.lastDragProp!=="minMaxValue"&&this.dragProp===e,"thumb--precise":!0},onBlur:()=>this.activeProp=null,onFocus:()=>this.activeProp=e,onPointerDown:$=>this.pointerDownDragStart($,e),role:"slider",style:{right:d},tabIndex:0,ref:$=>this.maxHandle=$},H("div",{class:"handle-extension"}),H("div",{class:"handle"})),S=H("div",{"aria-disabled":this.disabled,"aria-label":p?this.maxLabel:this.minLabel,"aria-orientation":"horizontal","aria-valuemax":this.max,"aria-valuemin":this.min,"aria-valuenow":i,class:{thumb:!0,"thumb--value":!0,"thumb--active":this.lastDragProp!=="minMaxValue"&&this.dragProp===e,"thumb--precise":!0},onBlur:()=>this.activeProp=null,onFocus:()=>this.activeProp=e,onPointerDown:$=>this.pointerDownDragStart($,e),role:"slider",style:{right:d},tabIndex:0,ref:$=>this.maxHandle=$},H("span",{"aria-hidden":"true",class:y},r),H("span",{"aria-hidden":"true",class:`${y} static`},r),H("span",{"aria-hidden":"true",class:`${y} transformed`},r),H("div",{class:"handle"}),H("div",{class:"handle-extension"})),E=H("div",{"aria-disabled":this.disabled,"aria-label":p?this.maxLabel:this.minLabel,"aria-orientation":"horizontal","aria-valuemax":this.max,"aria-valuemin":this.min,"aria-valuenow":i,class:{thumb:!0,"thumb--value":!0,"thumb--active":this.lastDragProp!=="minMaxValue"&&this.dragProp===e,"thumb--precise":!0},onBlur:()=>this.activeProp=null,onFocus:()=>this.activeProp=e,onPointerDown:$=>this.pointerDownDragStart($,e),role:"slider",style:{right:d},tabIndex:0,ref:$=>this.maxHandle=$},H("div",{class:"handle-extension"}),H("div",{class:"handle"}),H("span",{"aria-hidden":"true",class:y},r),H("span",{"aria-hidden":"true",class:`${y} static`},r),H("span",{"aria-hidden":"true",class:`${y} transformed`},r)),A=H("div",{"aria-disabled":this.disabled,"aria-label":this.minLabel,"aria-orientation":"horizontal","aria-valuemax":this.max,"aria-valuemin":this.min,"aria-valuenow":this.minValue,class:{thumb:!0,"thumb--minValue":!0,"thumb--active":this.dragProp==="minValue"},onBlur:()=>this.activeProp=null,onFocus:()=>this.activeProp="minValue",onPointerDown:$=>this.pointerDownDragStart($,"minValue"),role:"slider",style:{left:u},tabIndex:0,ref:$=>this.minHandle=$},H("div",{class:"handle"})),P=H("div",{"aria-disabled":this.disabled,"aria-label":this.minLabel,"aria-orientation":"horizontal","aria-valuemax":this.max,"aria-valuemin":this.min,"aria-valuenow":this.minValue,class:{thumb:!0,"thumb--minValue":!0,"thumb--active":this.dragProp==="minValue"},onBlur:()=>this.activeProp=null,onFocus:()=>this.activeProp="minValue",onPointerDown:$=>this.pointerDownDragStart($,"minValue"),role:"slider",style:{left:u},tabIndex:0,ref:$=>this.minHandle=$},H("span",{"aria-hidden":"true",class:m},n),H("span",{"aria-hidden":"true",class:`${m} static`},n),H("span",{"aria-hidden":"true",class:`${m} transformed`},n),H("div",{class:"handle"})),N=H("div",{"aria-disabled":this.disabled,"aria-label":this.minLabel,"aria-orientation":"horizontal","aria-valuemax":this.max,"aria-valuemin":this.min,"aria-valuenow":this.minValue,class:{thumb:!0,"thumb--minValue":!0,"thumb--active":this.dragProp==="minValue"},onBlur:()=>this.activeProp=null,onFocus:()=>this.activeProp="minValue",onPointerDown:$=>this.pointerDownDragStart($,"minValue"),role:"slider",style:{left:u},tabIndex:0,ref:$=>this.minHandle=$},H("div",{class:"handle"}),H("span",{"aria-hidden":"true",class:m},n),H("span",{"aria-hidden":"true",class:`${m} static`},n),H("span",{"aria-hidden":"true",class:`${m} transformed`},n)),F=H("div",{"aria-disabled":this.disabled,"aria-label":this.minLabel,"aria-orientation":"horizontal","aria-valuemax":this.max,"aria-valuemin":this.min,"aria-valuenow":this.minValue,class:{thumb:!0,"thumb--minValue":!0,"thumb--active":this.dragProp==="minValue","thumb--precise":!0},onBlur:()=>this.activeProp=null,onFocus:()=>this.activeProp="minValue",onPointerDown:$=>this.pointerDownDragStart($,"minValue"),role:"slider",style:{left:u},tabIndex:0,ref:$=>this.minHandle=$},H("div",{class:"handle-extension"}),H("div",{class:"handle"})),D=H("div",{"aria-disabled":this.disabled,"aria-label":this.minLabel,"aria-orientation":"horizontal","aria-valuemax":this.max,"aria-valuemin":this.min,"aria-valuenow":this.minValue,class:{thumb:!0,"thumb--minValue":!0,"thumb--active":this.dragProp==="minValue","thumb--precise":!0},onBlur:()=>this.activeProp=null,onFocus:()=>this.activeProp="minValue",onPointerDown:$=>this.pointerDownDragStart($,"minValue"),role:"slider",style:{left:u},tabIndex:0,ref:$=>this.minHandle=$},H("div",{class:"handle-extension"}),H("div",{class:"handle"}),H("span",{"aria-hidden":"true",class:m},n),H("span",{"aria-hidden":"true",class:`${m} static`},n),H("span",{"aria-hidden":"true",class:`${m} transformed`},n));return H(yo,{id:t,onTouchStart:this.handleTouchStart},H("div",{"aria-label":Lk(this),class:{container:!0,"container--range":p,[`scale--${this.scale}`]:!0}},this.renderGraph(),H("div",{class:"track",ref:this.storeTrackRef},H("div",{class:"track__range",onPointerDown:$=>this.pointerDownDragStart($,"minMaxValue"),style:{left:`${c?100-l:a}%`,right:`${c?a:100-l}%`}}),H("div",{class:"ticks"},this.tickValues.map($=>{const R=`${this.getUnitInterval($)*100}%`;let k=$>=s&&$<=i;return o&&(k=$>=this.minValue&&$<=this.maxValue),H("span",{class:{tick:!0,"tick--active":k},style:{left:c?"":R,right:c?R:""}},this.renderTickLabel($))}))),H("div",{class:"thumb-container"},!this.precise&&!this.labelHandles&&p&&A,!this.hasHistogram&&!this.precise&&this.labelHandles&&p&&P,this.precise&&!this.labelHandles&&p&&F,this.precise&&this.labelHandles&&p&&D,this.hasHistogram&&!this.precise&&this.labelHandles&&p&&N,!this.precise&&!this.labelHandles&&_,!this.hasHistogram&&!this.precise&&this.labelHandles&&v,!this.hasHistogram&&this.precise&&!this.labelHandles&&x,this.hasHistogram&&this.precise&&!this.labelHandles&&T,!this.hasHistogram&&this.precise&&this.labelHandles&&S,this.hasHistogram&&!this.precise&&this.labelHandles&&w,this.hasHistogram&&this.precise&&this.labelHandles&&E,H($k,{component:this}))))}renderGraph(){return this.histogram?H("calcite-graph",{class:"graph",colorStops:this.histogramStops,data:this.histogram,highlightMax:Ec(this.value)?this.maxValue:this.value,highlightMin:Ec(this.value)?this.minValue:this.min,max:this.max,min:this.min}):null}renderTickLabel(t){const e=Ec(this.value),i=t===this.min,r=t===this.max,n=this.determineGroupSeparator(t),s=H("span",{class:{tick__label:!0,[zx.tickMin]:i,[zx.tickMax]:r}},n);return this.labelTicks&&!this.hasHistogram&&!e||this.labelTicks&&!this.hasHistogram&&e&&!this.precise&&!this.labelHandles||this.labelTicks&&!this.hasHistogram&&e&&!this.precise&&this.labelHandles||this.labelTicks&&!this.hasHistogram&&e&&this.precise&&(i||r)||this.labelTicks&&this.hasHistogram&&!this.precise&&!this.labelHandles||this.labelTicks&&this.hasHistogram&&this.precise&&!this.labelHandles&&(i||r)||this.labelTicks&&this.hasHistogram&&!this.precise&&this.labelHandles&&(i||r)||this.labelTicks&&this.hasHistogram&&this.precise&&this.labelHandles&&(i||r)?s:null}keyDownHandler(t){const e=this.shouldMirror(),{activeProp:i,max:r,min:n,pageStep:s,step:o}=this,a=this[i],{key:l}=t;if(tP(l)){t.preventDefault();return}let c;if(l==="ArrowUp"||l==="ArrowRight"?c=a+o*(e&&l==="ArrowRight"?-1:1):l==="ArrowDown"||l==="ArrowLeft"?c=a-o*(e&&l==="ArrowLeft"?-1:1):l==="PageUp"?s&&(c=a+s):l==="PageDown"?s&&(c=a-s):l==="Home"?c=n:l==="End"&&(c=r),isNaN(c))return;t.preventDefault();const u=Number(c.toFixed(uI(o)));this.setValue({[i]:this.clamp(u,i)})}pointerDownHandler(t){if(this.disabled||!ST(t))return;const e=t.clientX||t.pageX,i=this.translate(e);let r="value";Ec(this.value)&&(i>=this.minValue&&i<=this.maxValue&&this.lastDragProp==="minMaxValue"?r="minMaxValue":r=Math.abs(this.maxValue-i)<Math.abs(this.minValue-i)||i>this.maxValue?"maxValue":"minValue"),this.lastDragPropValue=this[r],this.dragStart(r),this.el.shadowRoot.querySelector(".thumb:active")||this.setValue({[r]:this.clamp(i,r)}),this.focusActiveHandle(e)}handleTouchStart(t){t.preventDefault()}async setFocus(){await Ws(this),(this.minHandle?this.minHandle:this.maxHandle)?.focus()}setValueFromMinMax(){const{minValue:t,maxValue:e}=this;typeof t=="number"&&typeof e=="number"&&(this.value=[t,e])}setMinMaxFromValue(){const{value:t}=this;Ec(t)&&(this.minValue=t[0],this.maxValue=t[1])}onLabelClick(){this.setFocus()}shouldMirror(){return this.mirrored&&!this.hasHistogram}shouldUseMinValue(){return Ec(this.value)?this.hasHistogram&&this.maxValue===0||!this.hasHistogram&&this.minValue===0:!1}getTickDensity(){const t=(this.max-this.min)/this.ticks/N2t;return t<1?1:t}generateTickValues(){const t=this.ticks??0;if(t<=0)return[];const e=[this.min],i=this.getTickDensity(),r=t*i;let n=this.min;for(;n<this.max;)n+=r,e.push(Math.min(n,this.max));return e.includes(this.max)||e.push(this.max),e}pointerDownDragStart(t,e){ST(t)&&this.dragStart(e)}dragStart(t){this.dragProp=t,this.lastDragProp=this.dragProp,this.activeProp=t,document.addEventListener("pointermove",this.dragUpdate),document.addEventListener("pointerup",this.pointerUpDragEnd),document.addEventListener("pointercancel",this.dragEnd)}focusActiveHandle(t){switch(this.dragProp){case"minValue":this.minHandle.focus();break;case"maxValue":case"value":this.maxHandle.focus();break;case"minMaxValue":this.getClosestHandle(t).focus();break}}emitInput(){this.calciteSliderInput.emit()}emitChange(){this.calciteSliderChange.emit()}removeDragListeners(){document.removeEventListener("pointermove",this.dragUpdate),document.removeEventListener("pointerup",this.pointerUpDragEnd),document.removeEventListener("pointercancel",this.dragEnd)}setValue(t){let e;if(Object.keys(t).forEach(r=>{const n=t[r];e||(e=this[r]!==n),this[r]=n}),!e)return;this.dragProp||this.emitChange(),this.emitInput()}clamp(t,e){return t=O2t(t,this.min,this.max),e==="maxValue"&&(t=Math.max(t,this.minValue)),e==="minValue"&&(t=Math.min(t,this.maxValue)),t}translate(t){const e=this.max-this.min,{left:i,width:r}=this.trackEl.getBoundingClientRect(),n=(t-i)/r,s=this.shouldMirror(),o=this.clamp(this.min+e*(s?1-n:n));let a=Number(o.toFixed(uI(this.step)));return this.snap&&this.step&&(a=this.getClosestStep(a)),a}getClosestStep(t){if(t=Number(this.clamp(t).toFixed(uI(this.step))),this.step){const e=Math.round(t/this.step)*this.step;t=Number(this.clamp(e).toFixed(uI(this.step)))}return t}getClosestHandle(t){return this.getDistanceX(this.maxHandle,t)>this.getDistanceX(this.minHandle,t)?this.minHandle:this.maxHandle}getDistanceX(t,e){return Math.abs(t.getBoundingClientRect().left-e)}getFontSizeForElement(t){return Number(window.getComputedStyle(t).getPropertyValue("font-size").match(/\d+/)[0])}getUnitInterval(t){t=this.clamp(t);const e=this.max-this.min;return(t-this.min)/e}adjustHostObscuredHandleLabel(t){const e=this.el.shadowRoot.querySelector(`.handle__label--${t}`),i=this.el.shadowRoot.querySelector(`.handle__label--${t}.static`),r=this.el.shadowRoot.querySelector(`.handle__label--${t}.transformed`),n=i.getBoundingClientRect(),s=this.getHostOffset(n.left,n.right);e.style.transform=`translateX(${s}px)`,r.style.transform=`translateX(${s}px)`}hyphenateCollidingRangeHandleLabels(){const{shadowRoot:t}=this.el,e=this.shouldMirror(),i=e?"value":"minValue",r=e?"minValue":"value",n=t.querySelector(`.handle__label--${i}`),s=t.querySelector(`.handle__label--${i}.static`),o=t.querySelector(`.handle__label--${i}.transformed`),a=this.getHostOffset(s.getBoundingClientRect().left,s.getBoundingClientRect().right),l=t.querySelector(`.handle__label--${r}`),c=t.querySelector(`.handle__label--${r}.static`),u=t.querySelector(`.handle__label--${r}.transformed`),d=this.getHostOffset(c.getBoundingClientRect().left,c.getBoundingClientRect().right),p=this.getFontSizeForElement(n),m=this.getRangeLabelOverlap(o,u),y=n,_=p/2;if(m>0){if(y.classList.add("hyphen","hyphen--wrap"),d===0&&a===0){let v=m/2-_;v=Math.sign(v)===-1?Math.abs(v):-v;const w=this.getHostOffset(o.getBoundingClientRect().left+v-_,o.getBoundingClientRect().right+v-_);let x=m/2;const T=this.getHostOffset(u.getBoundingClientRect().left+x,u.getBoundingClientRect().right+x);w!==0&&(v+=w,x+=w),T!==0&&(v+=T,x+=T),n.style.transform=`translateX(${v}px)`,o.style.transform=`translateX(${v-_}px)`,l.style.transform=`translateX(${x}px)`,u.style.transform=`translateX(${x}px)`}else if(a>0||d>0)n.style.transform=`translateX(${a+_}px)`,l.style.transform=`translateX(${m+d}px)`,u.style.transform=`translateX(${m+d}px)`;else if(a<0||d<0){let v=Math.abs(a)+m-_;v=Math.sign(v)===-1?Math.abs(v):-v,n.style.transform=`translateX(${v}px)`,o.style.transform=`translateX(${v-_}px)`}}else y.classList.remove("hyphen","hyphen--wrap"),n.style.transform=`translateX(${a}px)`,o.style.transform=`translateX(${a}px)`,l.style.transform=`translateX(${d}px)`,u.style.transform=`translateX(${d}px)`}hideObscuredBoundingTickLabels(){const t=Ec(this.value);if(!this.hasHistogram&&!t&&!this.labelHandles&&!this.precise||!this.hasHistogram&&!t&&this.labelHandles&&!this.precise||!this.hasHistogram&&!t&&!this.labelHandles&&this.precise||!this.hasHistogram&&!t&&this.labelHandles&&this.precise||!this.hasHistogram&&t&&!this.precise||this.hasHistogram&&!this.precise&&!this.labelHandles)return;const e=this.el.shadowRoot.querySelector(".thumb--minValue"),i=this.el.shadowRoot.querySelector(".thumb--value"),r=this.el.shadowRoot.querySelector(".tick__label--min"),n=this.el.shadowRoot.querySelector(".tick__label--max");!e&&i&&r&&n&&(r.style.opacity=this.isMinTickLabelObscured(r,i)?"0":"1",n.style.opacity=this.isMaxTickLabelObscured(n,i)?"0":"1"),e&&i&&r&&n&&(r.style.opacity=this.isMinTickLabelObscured(r,e)||this.isMinTickLabelObscured(r,i)?"0":"1",n.style.opacity=this.isMaxTickLabelObscured(n,e)||this.isMaxTickLabelObscured(n,i)&&this.hasHistogram?"0":"1")}getHostOffset(t,e){const i=this.el.getBoundingClientRect(),r=7;return t+r<i.left?i.left-t-r:e-r>i.right?-(e-i.right)+r:0}getRangeLabelOverlap(t,e){const i=t.getBoundingClientRect(),r=e.getBoundingClientRect(),n=this.getFontSizeForElement(t),s=i.right+n-r.left;return Math.max(s,0)}isMinTickLabelObscured(t,e){const i=t.getBoundingClientRect(),r=e.getBoundingClientRect();return Oce(i,r)}isMaxTickLabelObscured(t,e){const i=t.getBoundingClientRect(),r=e.getBoundingClientRect();return Oce(i,r)}static get delegatesFocus(){return!0}get el(){return this}static get watchers(){return{histogram:["histogramWatcher"],ticks:["ticksWatcher"],value:["valueHandler"],minValue:["minMaxValueHandler"],maxValue:["minMaxValueHandler"]}}static get style(){return F2t}},[17,"calcite-slider",{disabled:[516],form:[513],groupSeparator:[516,"group-separator"],hasHistogram:[1540,"has-histogram"],histogram:[16],histogramStops:[16],labelHandles:[516,"label-handles"],labelTicks:[516,"label-ticks"],max:[514],maxLabel:[1,"max-label"],maxValue:[1026,"max-value"],min:[514],minLabel:[1,"min-label"],minValue:[1026,"min-value"],mirrored:[516],name:[513],numberingSystem:[1,"numbering-system"],pageStep:[514,"page-step"],precise:[516],required:[516],snap:[516],step:[514],ticks:[514],value:[1538],scale:[513],effectiveLocale:[32],minMaxValueRange:[32],minValueDragRange:[32],maxValueDragRange:[32],tickValues:[32],setFocus:[64]},[[0,"keydown","keyDownHandler"],[1,"pointerdown","pointerDownHandler"]]]);function U2t(){if(typeof customElements>"u")return;["calcite-slider","calcite-graph"].forEach(e=>{switch(e){case"calcite-slider":customElements.get(e)||customElements.define(e,k2t);break;case"calcite-graph":customElements.get(e)||eOe();break}})}U2t();var z2t=Object.defineProperty,B2t=Object.getOwnPropertyDescriptor,Uk=(t,e,i,r)=>{for(var n=r>1?void 0:r?B2t(e,i):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(n=(r?o(e,i,n):o(n))||n);return r&&n&&z2t(e,i,n),n};const jz=[.1,.2,.5,1,2,3,5];let CS=class extends VO{constructor(){super(...arguments),this.selectedSpeedFactor=jz.indexOf(1)}get quality(){return this.store.view.qualityProfile}set quality(t){this.store.view.qualityProfile=t}postInitialize(){this.addHandles([le(()=>this.selectedSpeedFactor,t=>{this.store.speedFactor=jz[t]})])}render(){const t=this.store.slides,e=!t,i=t&&t.length===0,r=!this.store.canReverse,n=!this.store.canForward,s=this.store.state!=="ready";return Ne("div",null,Ne("calcite-panel",{heading:"Slides",loading:e,style:"width: 300px;"},Ne("calcite-action",{icon:"refresh",text:"Previous slide",slot:"header-actions-end",disabled:i,onclick:()=>this.store.reset()}),Ne("calcite-action",{icon:"reverse",text:"Previous slide",slot:"header-actions-end",disabled:r,onclick:()=>this.store.reverse()}),Ne("calcite-action",{icon:"forward",text:"Nesxt slide",slot:"header-actions-end",disabled:n,onclick:()=>this.store.forward()}),this.renderStaging(s?"":"hide"),this.renderSettings(s?"hide":""),Ne("calcite-button",{width:"full",slot:"footer",appearance:"outline",disabled:i,onclick:()=>this.store.stop(),class:s?"":"hide"},"Cancel"),Ne("calcite-button",{width:"full",slot:"footer","icon-start":"video-web",disabled:i,onclick:()=>this.store.play(),class:s?"hide":""},"Play")))}renderStaging(t){return Ne("calcite-block",{open:!0,class:t},Ne("calcite-loader",{label:"Animation starting",text:"Animation starting",class:"player-loader"}),Ne("calcite-notice",{open:!0,icon:"information",scale:"s"},Ne("div",{slot:"message"},"Interrupt by pressing space bar or interacting with scene.")))}renderSettings(t){const e=this.store.speedFactor;let i;e===1?i="normal":e<1?i=`${1/e}x slower`:i=`${e}x faster`;const r=this.store.transition==="linear",n=this.store.transition==="linear"?"None":this.store.pauseBetweenSlides,s=["None","Short","Long"].map(a=>({value:a,checked:a===n})),o=this.store.transition!=="linear"&&this.store.waitForUpdates;return Ne("div",{class:t},Ne("calcite-block",{collapsible:!0,heading:"Animation",description:"Adjust speed and transitions"},Ne("calcite-icon",{scale:"s",slot:"icon",icon:"effects"}),Ne("calcite-label",null,"Speed (",i,")",Ne("calcite-slider",{value:this.selectedSpeedFactor,min:"0","label-handles":!0,max:jz.length-1,ticks:"1",onCalciteSliderInput:a=>this.selectedSpeedFactor=a.target.value})),Ne("calcite-label",null,"Transitions",Ne("calcite-radio-button-group",{name:"Transition",layout:"horizontal",onCalciteRadioButtonChange:a=>{this.store.transition=a.target.value}},Ne("calcite-label",{layout:"inline"},Ne("calcite-radio-button",{value:"bounce",checked:!0}),"Bounce"),Ne("calcite-label",{layout:"inline"},Ne("calcite-radio-button",{value:"linear"}),"Linear"))),Ne("calcite-label",null,"Pause between slides",Ne("calcite-segmented-control",{width:"full",onCalciteSegmentedControlChange:a=>{this.store.pauseBetweenSlides=a.target.value},disabled:r},s.map(a=>Ne("calcite-segmented-control-item",{value:a.value,checked:a.checked},a.value)))),Ne("calcite-label",{layout:"inline-space-between"},"Wait for view to update",Ne("calcite-switch",{onCalciteSwitchChange:a=>{this.store.waitForUpdates=!this.store.waitForUpdates},checked:o,disabled:r}))),Ne("calcite-block",{collapsible:!0,heading:"Settings",description:"Change visuals"},Ne("calcite-icon",{scale:"s",slot:"icon",icon:"gear"}),Ne("calcite-label",{layout:"inline-space-between"},"High quality",Ne("calcite-switch",{onCalciteSwitchChange:a=>{this.quality=a.target.checked?"high":"medium"}})),Ne("calcite-label",null,"Camera angle (",Math.floor(this.store.fov),"°)",Ne("calcite-slider",{value:this.store.fov,min:"1","label-handles":!0,"label-ticks":!0,max:"165",ticks:"54",precise:!0,onCalciteSliderInput:a=>{this.store.fov=a.target.value}}))))}};Uk([f()],CS.prototype,"store",2);Uk([f()],CS.prototype,"quality",1);Uk([f()],CS.prototype,"selectedSpeedFactor",2);CS=Uk([z("arcgis-core-template.Player")],CS);const V2t=CS;var G2t=Object.defineProperty,j2t=Object.getOwnPropertyDescriptor,tOe=(t,e,i,r)=>{for(var n=r>1?void 0:r?j2t(e,i):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(n=(r?o(e,i,n):o(n))||n);return r&&n&&G2t(e,i,n),n};let t4=class extends VO{postInitialize(){const t=this.store.view,e=new R1t({view:t});t.ui.add(e,"top-right");const i=new V2t({store:this.store.playerStore});t.ui.add(i,"bottom-right"),this.addHandles(le(()=>this.store.playerStore.state,r=>{r==="animating"?(i.visible=!1,e.visible=!1):r==="ready"&&(i.visible=!0,e.visible=!0)}))}render(){return Ne("div",null,Ne(iwt,{store:this.store}))}};tOe([f()],t4.prototype,"store",2);t4=tOe([z("arcgis-core-template.App")],t4);const H2t=t4;function Rv(t){return new Promise(e=>{setTimeout(e,t)})}var q2t=Object.defineProperty,W2t=Object.getOwnPropertyDescriptor,vu=(t,e,i,r)=>{for(var n=r>1?void 0:r?W2t(e,i):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(n=(r?o(e,i,n):o(n))||n);return r&&n&&q2t(e,i,n),n};let vl=class extends xe{constructor(t){super(t),this.slides=null,this.currentSlide=-1,this.speedFactor=1,this.transition="bounce",this.pauseBetweenSlides="Short",this.waitForUpdates=!0,this._state="ready",this._stopAnimation=()=>{},Tg(()=>this.slides).then(i=>{i.length&&this.reset(!1)});const e=i=>{i.key===" "&&this.stop()};window.addEventListener("keydown",e),this.addHandles([ac(()=>t.view.interacting,()=>this.stop()),{remove:()=>window.removeEventListener("keydown",e)}]),window.player=this}get state(){return this._state}get fov(){const t=this.view.camera;return t&&t.fov||0}set fov(t){let e=this.view.camera;e&&(e=e.clone(),e.fov=t,this.view.camera=e)}get canReverse(){return this.currentSlide>0}get canForward(){const t=this.slides?.length||0;return this.currentSlide<t-1}async pauseFor(t){if(this.transition==="linear")return;const e=[];switch(this.waitForUpdates&&e.push(Tg(()=>!this.view.updating)),this.pauseBetweenSlides){case"Short":e.push(Rv(t*.25));break;case"Long":e.push(Rv(t*1));break}await Promise.all(e)}async play(){if(this._state!=="ready")return;this._state="start-animation";let t=!0;this._stopAnimation=()=>{if(t){this._state="ready",t=!1;const e=this.view.animation;e&&e.stop()}this._stopAnimation=()=>{}};try{for(this.canForward?await Rv(2e3):await Promise.all([this.reset(),Rv(2e3)]),await Rv(1e3),t&&(this._state="animating",await Promise.all([this.pauseFor(1e3),Rv(1e3)]));this.canForward&&t;){const e=performance.now();await this.forward(),await this.pauseFor(performance.now()-e)}}finally{t&&(await Rv(1e3),this._state="ready")}}stop(){this._stopAnimation(),this._state="ready"}async reset(t=!0){await this.goToSlide(0,t)}async reverse(t=!0){await this.goToSlide(this.currentSlide-1,t)}async forward(t=!0){await this.goToSlide(this.currentSlide+1,t)}async goToSlide(t,e=!0){const i=this.slides;if(!i||t<0||t>=i.length)return Promise.reject();const r=i.getItemAt(t);this.currentSlide=t;const n=this.speedFactor,s={animate:e,speedFactor:n};this.transition==="linear"&&(s.easing="linear",console.log({options:s}));try{await r.applyTo(this.view,s)}catch{this.stop()}}};vu([f({constructOnly:!0})],vl.prototype,"view",2);vu([f()],vl.prototype,"state",1);vu([f()],vl.prototype,"slides",2);vu([f()],vl.prototype,"currentSlide",2);vu([f()],vl.prototype,"speedFactor",2);vu([f()],vl.prototype,"transition",2);vu([f()],vl.prototype,"pauseBetweenSlides",2);vu([f()],vl.prototype,"waitForUpdates",2);vu([f()],vl.prototype,"fov",1);vu([f()],vl.prototype,"canReverse",1);vu([f()],vl.prototype,"canForward",1);vu([f()],vl.prototype,"_state",2);vl=vu([z("arcgis-core-template.PlayerStore")],vl);const Y2t=vl,hI="esri-identity-form",Cc={base:hI,group:`${hI}__group`,label:`${hI}__label`,footer:`${hI}__footer`,esriInput:"esri-input",esriButton:"esri-button",esriButtonSecondary:"esri-button--secondary"},X2t="ArcGIS Online";let Bm=class extends Xg{constructor(e,i){super(e,i),this._usernameInputNode=null,this._passwordInputNode=null,this.signingIn=!1,this.server=null,this.resource=null,this.error=null,this.oAuthPrompt=!1}render(){const{error:e,server:i,resource:r,signingIn:n,oAuthPrompt:s,messages:o}=this,a=Ne("div",{class:Cc.group},LFe(s?o.oAuthInfo:o.info,{server:i&&/\.arcgis\.com/i.test(i)?X2t:i,resource:`(${r||o.lblItem})`})),l=s?null:Ne("div",{class:Cc.group,key:"username"},Ne("label",{class:Cc.label},o.lblUser,Ne("input",{afterCreate:cee,autocomplete:"off",bind:this,class:Cc.esriInput,"data-node-ref":"_usernameInputNode",required:!0,spellcheck:!1,type:"text",value:""}))),c=s?null:Ne("div",{class:Cc.group,key:"password"},Ne("label",{class:Cc.label},o.lblPwd,Ne("input",{afterCreate:cee,bind:this,class:Cc.esriInput,"data-node-ref":"_passwordInputNode",required:!0,type:"password",value:""}))),u=Ne("div",{class:this.classes(Cc.group,Cc.footer)},Ne("input",{class:Cc.esriButton,disabled:!!n,type:"submit",value:n?o.lblSigning:o.lblOk}),Ne("input",{bind:this,class:this.classes(Cc.esriButton,Cc.esriButtonSecondary),onclick:this._cancel,type:"button",value:o.lblCancel})),d=e?Ne("div",null,e.details?.httpStatus?o.invalidUser:o.noAuthService):null;return Ne("form",{bind:this,class:Cc.base,onsubmit:this._submit},a,d,l,c,u)}_cancel(){this._set("signingIn",!1),this._usernameInputNode&&(this._usernameInputNode.value=""),this._passwordInputNode&&(this._passwordInputNode.value=""),this.emit("cancel")}_submit(e){e.preventDefault(),this._set("signingIn",!0);const i=this.oAuthPrompt?{}:{username:this._usernameInputNode&&this._usernameInputNode.value,password:this._passwordInputNode&&this._passwordInputNode.value};this.emit("submit",i)}};h([f(),bw("esri/identity/t9n/identity")],Bm.prototype,"messages",void 0),h([f()],Bm.prototype,"signingIn",void 0),h([f()],Bm.prototype,"server",void 0),h([f()],Bm.prototype,"resource",void 0),h([f()],Bm.prototype,"error",void 0),h([f()],Bm.prototype,"oAuthPrompt",void 0),Bm=h([z("esri.identity.IdentityForm")],Bm);const Z2t=Bm;/*!
* tabbable 6.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var iOe=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],i4=iOe.join(","),rOe=typeof Element>"u",Qb=rOe?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,r4=!rOe&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t?.ownerDocument},n4=function t(e,i){var r;i===void 0&&(i=!0);var n=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"inert"),s=n===""||n==="true",o=s||i&&e&&t(e.parentNode);return o},J2t=function(e){var i,r=e==null||(i=e.getAttribute)===null||i===void 0?void 0:i.call(e,"contenteditable");return r===""||r==="true"},nOe=function(e,i,r){if(n4(e))return[];var n=Array.prototype.slice.apply(e.querySelectorAll(i4));return i&&Qb.call(e,i4)&&n.unshift(e),n=n.filter(r),n},sOe=function t(e,i,r){for(var n=[],s=Array.from(e);s.length;){var o=s.shift();if(!n4(o,!1))if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,c=t(l,!0,r);r.flatten?n.push.apply(n,c):n.push({scopeParent:o,candidates:c})}else{var u=Qb.call(o,i4);u&&r.filter(o)&&(i||!e.includes(o))&&n.push(o);var d=o.shadowRoot||typeof r.getShadowRoot=="function"&&r.getShadowRoot(o),p=!n4(d,!1)&&(!r.shadowRootFilter||r.shadowRootFilter(o));if(d&&p){var m=t(d===!0?o.children:d.children,!0,r);r.flatten?n.push.apply(n,m):n.push({scopeParent:o,candidates:m})}else s.unshift.apply(s,o.children)}}return n},oOe=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},N1=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||J2t(e))&&!oOe(e)?0:e.tabIndex},K2t=function(e,i){var r=N1(e);return r<0&&i&&!oOe(e)?0:r},Q2t=function(e,i){return e.tabIndex===i.tabIndex?e.documentOrder-i.documentOrder:e.tabIndex-i.tabIndex},aOe=function(e){return e.tagName==="INPUT"},eTt=function(e){return aOe(e)&&e.type==="hidden"},tTt=function(e){var i=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(r){return r.tagName==="SUMMARY"});return i},iTt=function(e,i){for(var r=0;r<e.length;r++)if(e[r].checked&&e[r].form===i)return e[r]},rTt=function(e){if(!e.name)return!0;var i=e.form||r4(e),r=function(a){return i.querySelectorAll('input[type="radio"][name="'+a+'"]')},n;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")n=r(window.CSS.escape(e.name));else try{n=r(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var s=iTt(n,e.form);return!s||s===e},nTt=function(e){return aOe(e)&&e.type==="radio"},sTt=function(e){return nTt(e)&&!rTt(e)},oTt=function(e){var i,r=e&&r4(e),n=(i=r)===null||i===void 0?void 0:i.host,s=!1;if(r&&r!==e){var o,a,l;for(s=!!((o=n)!==null&&o!==void 0&&(a=o.ownerDocument)!==null&&a!==void 0&&a.contains(n)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!s&&n;){var c,u,d;r=r4(n),n=(c=r)===null||c===void 0?void 0:c.host,s=!!((u=n)!==null&&u!==void 0&&(d=u.ownerDocument)!==null&&d!==void 0&&d.contains(n))}}return s},Tue=function(e){var i=e.getBoundingClientRect(),r=i.width,n=i.height;return r===0&&n===0},aTt=function(e,i){var r=i.displayCheck,n=i.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var s=Qb.call(e,"details>summary:first-of-type"),o=s?e.parentElement:e;if(Qb.call(o,"details:not([open]) *"))return!0;if(!r||r==="full"||r==="legacy-full"){if(typeof n=="function"){for(var a=e;e;){var l=e.parentElement,c=r4(e);if(l&&!l.shadowRoot&&n(l)===!0)return Tue(e);e.assignedSlot?e=e.assignedSlot:!l&&c!==e.ownerDocument?e=c.host:e=l}e=a}if(oTt(e))return!e.getClientRects().length;if(r!=="legacy-full")return!0}else if(r==="non-zero-area")return Tue(e);return!1},lTt=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var i=e.parentElement;i;){if(i.tagName==="FIELDSET"&&i.disabled){for(var r=0;r<i.children.length;r++){var n=i.children.item(r);if(n.tagName==="LEGEND")return Qb.call(i,"fieldset[disabled] *")?!0:!n.contains(e)}return!0}i=i.parentElement}return!1},s4=function(e,i){return!(i.disabled||n4(i)||eTt(i)||aTt(i,e)||tTt(i)||lTt(i))},pH=function(e,i){return!(sTt(i)||N1(i)<0||!s4(e,i))},cTt=function(e){var i=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(i)||i>=0)},uTt=function t(e){var i=[],r=[];return e.forEach(function(n,s){var o=!!n.scopeParent,a=o?n.scopeParent:n,l=K2t(a,o),c=o?t(n.candidates):a;l===0?o?i.push.apply(i,c):i.push(a):r.push({documentOrder:s,tabIndex:l,item:n,isScope:o,content:c})}),r.sort(Q2t).reduce(function(n,s){return s.isScope?n.push.apply(n,s.content):n.push(s.content),n},[]).concat(i)},hTt=function(e,i){i=i||{};var r;return i.getShadowRoot?r=sOe([e],i.includeContainer,{filter:pH.bind(null,i),flatten:!1,getShadowRoot:i.getShadowRoot,shadowRootFilter:cTt}):r=nOe(e,i.includeContainer,pH.bind(null,i)),uTt(r)},dTt=function(e,i){i=i||{};var r;return i.getShadowRoot?r=sOe([e],i.includeContainer,{filter:s4.bind(null,i),flatten:!0,getShadowRoot:i.getShadowRoot}):r=nOe(e,i.includeContainer,s4.bind(null,i)),r},Bx=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return Qb.call(e,i4)===!1?!1:pH(i,e)},pTt=iOe.concat("iframe").join(","),Hz=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return Qb.call(e,pTt)===!1?!1:s4(i,e)};/*!
* focus-trap 7.5.4
* @license MIT, https://github.com/focus-trap/focus-trap/blob/master/LICENSE
*/function Sue(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),i.push.apply(i,r)}return i}function Eue(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?Sue(Object(i),!0).forEach(function(r){fTt(t,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Sue(Object(i)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))})}return t}function fTt(t,e,i){return e=gTt(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function mTt(t,e){if(typeof t!="object"||t===null)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var r=i.call(t,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function gTt(t){var e=mTt(t,"string");return typeof e=="symbol"?e:String(e)}var Cue={activateTrap:function(e,i){if(e.length>0){var r=e[e.length-1];r!==i&&r.pause()}var n=e.indexOf(i);n===-1||e.splice(n,1),e.push(i)},deactivateTrap:function(e,i){var r=e.indexOf(i);r!==-1&&e.splice(r,1),e.length>0&&e[e.length-1].unpause()}},yTt=function(e){return e.tagName&&e.tagName.toLowerCase()==="input"&&typeof e.select=="function"},_Tt=function(e){return e?.key==="Escape"||e?.key==="Esc"||e?.keyCode===27},U3=function(e){return e?.key==="Tab"||e?.keyCode===9},vTt=function(e){return U3(e)&&!e.shiftKey},bTt=function(e){return U3(e)&&e.shiftKey},Aue=function(e){return setTimeout(e,0)},Oue=function(e,i){var r=-1;return e.every(function(n,s){return i(n)?(r=s,!1):!0}),r},dC=function(e){for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];return typeof e=="function"?e.apply(void 0,r):e},dI=function(e){return e.target.shadowRoot&&typeof e.composedPath=="function"?e.composedPath()[0]:e.target},wTt=[],xTt=function(e,i){var r=i?.document||document,n=i?.trapStack||wTt,s=Eue({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0,isKeyForward:vTt,isKeyBackward:bTt},i),o={containers:[],containerGroups:[],tabbableGroups:[],nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,delayInitialFocusTimer:void 0,recentNavEvent:void 0},a,l=function(R,k,B){return R&&R[k]!==void 0?R[k]:s[B||k]},c=function(R,k){var B=typeof k?.composedPath=="function"?k.composedPath():void 0;return o.containerGroups.findIndex(function(j){var X=j.container,M=j.tabbableNodes;return X.contains(R)||B?.includes(X)||M.find(function(I){return I===R})})},u=function(R){var k=s[R];if(typeof k=="function"){for(var B=arguments.length,j=new Array(B>1?B-1:0),X=1;X<B;X++)j[X-1]=arguments[X];k=k.apply(void 0,j)}if(k===!0&&(k=void 0),!k){if(k===void 0||k===!1)return k;throw new Error("`".concat(R,"` was specified but was not a node, or did not return a node"))}var M=k;if(typeof k=="string"&&(M=r.querySelector(k),!M))throw new Error("`".concat(R,"` as selector refers to no known node"));return M},d=function(){var R=u("initialFocus");if(R===!1)return!1;if(R===void 0||!Hz(R,s.tabbableOptions))if(c(r.activeElement)>=0)R=r.activeElement;else{var k=o.tabbableGroups[0],B=k&&k.firstTabbableNode;R=B||u("fallbackFocus")}if(!R)throw new Error("Your focus-trap needs to have at least one focusable element");return R},p=function(){if(o.containerGroups=o.containers.map(function(R){var k=hTt(R,s.tabbableOptions),B=dTt(R,s.tabbableOptions),j=k.length>0?k[0]:void 0,X=k.length>0?k[k.length-1]:void 0,M=B.find(function(q){return Bx(q)}),I=B.slice().reverse().find(function(q){return Bx(q)}),G=!!k.find(function(q){return N1(q)>0});return{container:R,tabbableNodes:k,focusableNodes:B,posTabIndexesFound:G,firstTabbableNode:j,lastTabbableNode:X,firstDomTabbableNode:M,lastDomTabbableNode:I,nextTabbableNode:function(Z){var K=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,Q=k.indexOf(Z);return Q<0?K?B.slice(B.indexOf(Z)+1).find(function(de){return Bx(de)}):B.slice(0,B.indexOf(Z)).reverse().find(function(de){return Bx(de)}):k[Q+(K?1:-1)]}}}),o.tabbableGroups=o.containerGroups.filter(function(R){return R.tabbableNodes.length>0}),o.tabbableGroups.length<=0&&!u("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times");if(o.containerGroups.find(function(R){return R.posTabIndexesFound})&&o.containerGroups.length>1)throw new Error("At least one node with a positive tabindex was found in one of your focus-trap's multiple containers. Positive tabindexes are only supported in single-container focus-traps.")},m=function $(R){var k=R.activeElement;if(k)return k.shadowRoot&&k.shadowRoot.activeElement!==null?$(k.shadowRoot):k},y=function $(R){if(R!==!1&&R!==m(document)){if(!R||!R.focus){$(d());return}R.focus({preventScroll:!!s.preventScroll}),o.mostRecentlyFocusedNode=R,yTt(R)&&R.select()}},_=function(R){var k=u("setReturnFocus",R);return k||(k===!1?!1:R)},v=function(R){var k=R.target,B=R.event,j=R.isBackward,X=j===void 0?!1:j;k=k||dI(B),p();var M=null;if(o.tabbableGroups.length>0){var I=c(k,B),G=I>=0?o.containerGroups[I]:void 0;if(I<0)X?M=o.tabbableGroups[o.tabbableGroups.length-1].lastTabbableNode:M=o.tabbableGroups[0].firstTabbableNode;else if(X){var q=Oue(o.tabbableGroups,function(st){var vt=st.firstTabbableNode;return k===vt});if(q<0&&(G.container===k||Hz(k,s.tabbableOptions)&&!Bx(k,s.tabbableOptions)&&!G.nextTabbableNode(k,!1))&&(q=I),q>=0){var Z=q===0?o.tabbableGroups.length-1:q-1,K=o.tabbableGroups[Z];M=N1(k)>=0?K.lastTabbableNode:K.lastDomTabbableNode}else U3(B)||(M=G.nextTabbableNode(k,!1))}else{var Q=Oue(o.tabbableGroups,function(st){var vt=st.lastTabbableNode;return k===vt});if(Q<0&&(G.container===k||Hz(k,s.tabbableOptions)&&!Bx(k,s.tabbableOptions)&&!G.nextTabbableNode(k))&&(Q=I),Q>=0){var de=Q===o.tabbableGroups.length-1?0:Q+1,Ae=o.tabbableGroups[de];M=N1(k)>=0?Ae.firstTabbableNode:Ae.firstDomTabbableNode}else U3(B)||(M=G.nextTabbableNode(k))}}else M=u("fallbackFocus");return M},w=function(R){var k=dI(R);if(!(c(k,R)>=0)){if(dC(s.clickOutsideDeactivates,R)){a.deactivate({returnFocus:s.returnFocusOnDeactivate});return}dC(s.allowOutsideClick,R)||R.preventDefault()}},x=function(R){var k=dI(R),B=c(k,R)>=0;if(B||k instanceof Document)B&&(o.mostRecentlyFocusedNode=k);else{R.stopImmediatePropagation();var j,X=!0;if(o.mostRecentlyFocusedNode)if(N1(o.mostRecentlyFocusedNode)>0){var M=c(o.mostRecentlyFocusedNode),I=o.containerGroups[M].tabbableNodes;if(I.length>0){var G=I.findIndex(function(q){return q===o.mostRecentlyFocusedNode});G>=0&&(s.isKeyForward(o.recentNavEvent)?G+1<I.length&&(j=I[G+1],X=!1):G-1>=0&&(j=I[G-1],X=!1))}}else o.containerGroups.some(function(q){return q.tabbableNodes.some(function(Z){return N1(Z)>0})})||(X=!1);else X=!1;X&&(j=v({target:o.mostRecentlyFocusedNode,isBackward:s.isKeyBackward(o.recentNavEvent)})),y(j||o.mostRecentlyFocusedNode||d())}o.recentNavEvent=void 0},T=function(R){var k=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;o.recentNavEvent=R;var B=v({event:R,isBackward:k});B&&(U3(R)&&R.preventDefault(),y(B))},S=function(R){if(_Tt(R)&&dC(s.escapeDeactivates,R)!==!1){R.preventDefault(),a.deactivate();return}(s.isKeyForward(R)||s.isKeyBackward(R))&&T(R,s.isKeyBackward(R))},E=function(R){var k=dI(R);c(k,R)>=0||dC(s.clickOutsideDeactivates,R)||dC(s.allowOutsideClick,R)||(R.preventDefault(),R.stopImmediatePropagation())},A=function(){if(o.active)return Cue.activateTrap(n,a),o.delayInitialFocusTimer=s.delayInitialFocus?Aue(function(){y(d())}):y(d()),r.addEventListener("focusin",x,!0),r.addEventListener("mousedown",w,{capture:!0,passive:!1}),r.addEventListener("touchstart",w,{capture:!0,passive:!1}),r.addEventListener("click",E,{capture:!0,passive:!1}),r.addEventListener("keydown",S,{capture:!0,passive:!1}),a},P=function(){if(o.active)return r.removeEventListener("focusin",x,!0),r.removeEventListener("mousedown",w,!0),r.removeEventListener("touchstart",w,!0),r.removeEventListener("click",E,!0),r.removeEventListener("keydown",S,!0),a},N=function(R){var k=R.some(function(B){var j=Array.from(B.removedNodes);return j.some(function(X){return X===o.mostRecentlyFocusedNode})});k&&y(d())},F=typeof window<"u"&&"MutationObserver"in window?new MutationObserver(N):void 0,D=function(){F&&(F.disconnect(),o.active&&!o.paused&&o.containers.map(function(R){F.observe(R,{subtree:!0,childList:!0})}))};return a={get active(){return o.active},get paused(){return o.paused},activate:function(R){if(o.active)return this;var k=l(R,"onActivate"),B=l(R,"onPostActivate"),j=l(R,"checkCanFocusTrap");j||p(),o.active=!0,o.paused=!1,o.nodeFocusedBeforeActivation=r.activeElement,k?.();var X=function(){j&&p(),A(),D(),B?.()};return j?(j(o.containers.concat()).then(X,X),this):(X(),this)},deactivate:function(R){if(!o.active)return this;var k=Eue({onDeactivate:s.onDeactivate,onPostDeactivate:s.onPostDeactivate,checkCanReturnFocus:s.checkCanReturnFocus},R);clearTimeout(o.delayInitialFocusTimer),o.delayInitialFocusTimer=void 0,P(),o.active=!1,o.paused=!1,D(),Cue.deactivateTrap(n,a);var B=l(k,"onDeactivate"),j=l(k,"onPostDeactivate"),X=l(k,"checkCanReturnFocus"),M=l(k,"returnFocus","returnFocusOnDeactivate");B?.();var I=function(){Aue(function(){M&&y(_(o.nodeFocusedBeforeActivation)),j?.()})};return M&&X?(X(_(o.nodeFocusedBeforeActivation)).then(I,I),this):(I(),this)},pause:function(R){if(o.paused||!o.active)return this;var k=l(R,"onPause"),B=l(R,"onPostPause");return o.paused=!0,k?.(),P(),D(),B?.(),this},unpause:function(R){if(!o.paused||!o.active)return this;var k=l(R,"onUnpause"),B=l(R,"onPostUnpause");return o.paused=!1,k?.(),p(),A(),D(),B?.(),this},updateContainerElements:function(R){var k=[].concat(R).filter(Boolean);return o.containers=k.map(function(B){return typeof B=="string"?r.querySelector(B):B}),o.active&&p(),D(),this}},a.updateContainerElements(e),a};const Pv="esri-identity-modal",Rp={base:Pv,open:`${Pv}--open`,closed:`${Pv}--closed`,title:`${Pv}__title`,dialog:`${Pv}__dialog`,content:`${Pv}__content`,closeButton:`${Pv}__close-button`,iconClose:"esri-icon-close"};let uy=class extends Xg{constructor(t,e){super(t,e),this.container=document.createElement("div"),this.content=null,this.open=!1,this._focusTrap=null,this._close=()=>{this.open=!1},document.body.appendChild(this.container),this.addHandles(le(()=>this.open,()=>this._toggleFocusTrap()))}destroy(){this._destroyFocusTrap()}get title(){return this.messages?.auth.signIn}render(){const t=this.id,{open:e,content:i,title:r,messages:n}=this,s=e&&!!i,o={[Rp.open]:s,[Rp.closed]:!s},a=Ne("button",{"aria-label":n.close,bind:this,class:Rp.closeButton,onclick:this._close,title:n.close,type:"button"},Ne("span",{"aria-hidden":"true",class:Rp.iconClose})),l=`${t}_title`,c=`${t}_content`,u=r?Ne("h1",{class:Rp.title,id:l},r):null,d=s?Ne("div",{afterCreate:this._createFocusTrap,"aria-describedby":c,"aria-labelledby":l,bind:this,class:Rp.dialog,role:"dialog"},a,u,this._renderContent(c)):null;return Ne("div",{class:this.classes(Rp.base,o),tabIndex:-1},d)}_destroyFocusTrap(){this._focusTrap?.deactivate({onDeactivate:()=>{}}),this._focusTrap=null}_toggleFocusTrap(){const{_focusTrap:t,open:e}=this;t&&(e?t.activate():t.deactivate())}_createFocusTrap(t){this._destroyFocusTrap();const e=requestAnimationFrame(()=>{this._focusTrap=xTt(t,{initialFocus:"input",onDeactivate:this._close}),this._toggleFocusTrap()});this.addHandles(Mi(()=>cancelAnimationFrame(e)))}_renderContent(t){const e=this.content;return typeof e=="string"?Ne("div",{class:Rp.content,id:t,innerHTML:e}):A1t(e)?Ne("div",{class:Rp.content,id:t},e.render()):e instanceof HTMLElement?Ne("div",{afterCreate:this._attachToNode,bind:e,class:Rp.content,id:t}):null}_attachToNode(t){const e=this;t.appendChild(e)}};h([f({readOnly:!0})],uy.prototype,"container",void 0),h([f()],uy.prototype,"content",void 0),h([f()],uy.prototype,"open",void 0),h([f(),bw("esri/t9n/common")],uy.prototype,"messages",void 0),h([f()],uy.prototype,"title",null),uy=h([z("esri.identity.IdentityModal")],uy);const Rue=uy,qz="esriJSAPIOAuth";class fH{constructor(e,i){this.oAuthInfo=null,this.storage=null,this.appId=null,this.codeVerifier=null,this.expires=null,this.refreshToken=null,this.ssl=null,this.stateUID=null,this.token=null,this.userId=null,this.oAuthInfo=e,this.storage=i,this._init()}isValid(){let e=!1;if(this.oAuthInfo&&this.userId&&(this.refreshToken||this.token)){if(this.expires==null&&this.refreshToken)e=!0;else if(this.expires){const i=Date.now();this.expires>i&&(this.expires-i)/1e3>60*this.oAuthInfo.minTimeUntilExpiration&&(e=!0)}}return e}save(){if(!this.storage)return!1;const e=this._load(),i=this.oAuthInfo;if(i&&i.authNamespace&&i.portalUrl){let r=e[i.authNamespace];r||(r=e[i.authNamespace]={}),this.appId||(this.appId=i.appId),r[i.portalUrl]={appId:this.appId,codeVerifier:this.codeVerifier,expires:this.expires,refreshToken:this.refreshToken,ssl:this.ssl,stateUID:this.stateUID,token:this.token,userId:this.userId};try{this.storage.setItem(qz,JSON.stringify(e))}catch(n){return console.warn(n),!1}return!0}return!1}destroy(){const e=this._load(),i=this.oAuthInfo;if(i?.appId&&i?.portalUrl&&(this.expires==null||this.expires>Date.now())&&(this.refreshToken||this.token)){const r=i.portalUrl.replace(/^http:/i,"https:")+"/sharing/rest/oauth2/revokeToken",n=new FormData;if(n.append("f","json"),n.append("auth_token",this.refreshToken||this.token),n.append("client_id",i.appId),n.append("token_type_hint",this.refreshToken?"refresh_token":"access_token"),typeof navigator.sendBeacon=="function")navigator.sendBeacon(r,n);else{const s=new XMLHttpRequest;s.open("POST",r),s.send(n)}}if(i&&i.authNamespace&&i.portalUrl&&this.storage){const r=e[i.authNamespace];if(r){delete r[i.portalUrl];try{this.storage.setItem(qz,JSON.stringify(e))}catch(n){console.log(n)}}}i&&(i._oAuthCred=null,this.oAuthInfo=null)}_init(){const e=this._load(),i=this.oAuthInfo;if(i&&i.authNamespace&&i.portalUrl){let r=e[i.authNamespace];r&&(r=r[i.portalUrl],r&&(this.appId=r.appId,this.codeVerifier=r.codeVerifier,this.expires=r.expires,this.refreshToken=r.refreshToken,this.ssl=r.ssl,this.stateUID=r.stateUID,this.token=r.token,this.userId=r.userId))}}_load(){let e={};if(this.storage){const i=this.storage.getItem(qz);if(i)try{e=JSON.parse(i)}catch(r){console.warn(r)}}return e}}fH.prototype.declaredClass="esri.identity.OAuthCredential";var mH;let Go=mH=class extends $e{constructor(t){super(t),this._oAuthCred=null,this.appId=null,this.authNamespace="/",this.expiration=20160,this.flowType="auto",this.forceLogin=!1,this.forceUserId=!1,this.locale=null,this.minTimeUntilExpiration=30,this.popup=!1,this.popupCallbackUrl="oauth-callback.html",this.popupWindowFeatures="height=490,width=800,resizable,scrollbars,status",this.portalUrl="https://www.arcgis.com",this.preserveUrlHash=!1,this.userId=null}clone(){return mH.fromJSON(this.toJSON())}};h([f({json:{write:!0}})],Go.prototype,"appId",void 0),h([f({json:{write:!0}})],Go.prototype,"authNamespace",void 0),h([f({json:{write:!0}})],Go.prototype,"expiration",void 0),h([f({json:{write:!0}})],Go.prototype,"flowType",void 0),h([f({json:{write:!0}})],Go.prototype,"forceLogin",void 0),h([f({json:{write:!0}})],Go.prototype,"forceUserId",void 0),h([f({json:{write:!0}})],Go.prototype,"locale",void 0),h([f({json:{write:!0}})],Go.prototype,"minTimeUntilExpiration",void 0),h([f({json:{write:!0}})],Go.prototype,"popup",void 0),h([f({json:{write:!0}})],Go.prototype,"popupCallbackUrl",void 0),h([f({json:{write:!0}})],Go.prototype,"popupWindowFeatures",void 0),h([f({json:{write:!0}})],Go.prototype,"portalUrl",void 0),h([f({json:{write:!0}})],Go.prototype,"preserveUrlHash",void 0),h([f({json:{write:!0}})],Go.prototype,"userId",void 0),Go=mH=h([z("esri.identity.OAuthInfo")],Go);const gH=Go;let $c=class extends $e{constructor(e){super(e),this.adminTokenServiceUrl=null,this.currentVersion=null,this.hasPortal=null,this.hasServer=null,this.owningSystemUrl=null,this.owningTenant=null,this.server=null,this.shortLivedTokenValidity=null,this.tokenServiceUrl=null,this.webTierAuth=null}};h([f({json:{write:!0}})],$c.prototype,"adminTokenServiceUrl",void 0),h([f({json:{write:!0}})],$c.prototype,"currentVersion",void 0),h([f({json:{write:!0}})],$c.prototype,"hasPortal",void 0),h([f({json:{write:!0}})],$c.prototype,"hasServer",void 0),h([f({json:{write:!0}})],$c.prototype,"owningSystemUrl",void 0),h([f({json:{write:!0}})],$c.prototype,"owningTenant",void 0),h([f({json:{write:!0}})],$c.prototype,"server",void 0),h([f({json:{write:!0}})],$c.prototype,"shortLivedTokenValidity",void 0),h([f({json:{write:!0}})],$c.prototype,"tokenServiceUrl",void 0),h([f({json:{write:!0}})],$c.prototype,"webTierAuth",void 0),$c=h([z("esri.identity.ServerInfo")],$c);const Wz=$c,cD={},lOe=t=>{const e=new Wl(t.owningSystemUrl).host,i=new Wl(t.server).host,r=/.+\.arcgis\.com$/i;return r.test(e)&&r.test(i)},yH=(t,e)=>!!(lOe(t)&&e&&e.some(i=>i.test(t.server)));let uD=null,hD=null;try{uD=window.localStorage,hD=window.sessionStorage}catch{}class cOe extends Tn{constructor(){super(),this._portalConfig=globalThis.esriGeowConfig,this.serverInfos=[],this.oAuthInfos=[],this.credentials=[],this._soReqs=[],this._xoReqs=[],this._portals=[],this._defaultOAuthInfo=null,this._defaultTokenValidity=60,this.dialog=null,this.formConstructor=Z2t,this.tokenValidity=null,this.normalizeWebTierAuth=!1,this._appOrigin=window.origin!=="null"?window.origin:window.location.origin,this._appUrlObj=bn(window.location.href),this._busy=null,this._rejectOnPersistedPageShow=!1,this._oAuthLocationParams=null,this._gwTokenUrl="/sharing/rest/generateToken",this._agsRest="/rest/services",this._agsPortal=/\/sharing(\/|$)/i,this._agsAdmin=/(https?:\/\/[^\/]+\/[^\/]+)\/admin\/?(\/.*)?$/i,this._adminSvcs=/\/rest\/admin\/services(\/|$)/i,this._gwDomains=[{regex:/^https?:\/\/www\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:dev|[a-z\d-]+\.mapsdev)\.arcgis\.com/i,customBaseUrl:"mapsdev.arcgis.com",tokenServiceUrl:"https://dev.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:devext|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,customBaseUrl:"mapsdevext.arcgis.com",tokenServiceUrl:"https://devext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:qaext|[a-z\d-]+\.mapsqa)\.arcgis\.com/i,customBaseUrl:"mapsqa.arcgis.com",tokenServiceUrl:"https://qaext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/[a-z\d-]+\.maps\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"}],this._legacyFed=[],this._regexSDirUrl=/http.+\/rest\/services\/?/gi,this._regexServerType=/(\/(FeatureServer|GPServer|GeoDataServer|GeocodeServer|GeoenrichmentServer|GeometryServer|GlobeServer|ImageServer|KnowledgeGraphServer|MapServer|MissionServer|MobileServer|NAServer|NetworkDiagramServer|OGCFeatureServer|ParcelFabricServer|RelationalCatalogServer|SceneServer|StreamServer|UtilityNetworkServer|ValidationServer|VectorTileServer|VersionManagementServer|VideoServer)).*/gi,this._gwUser=/http.+\/users\/([^\/]+)\/?.*/i,this._gwItem=/http.+\/items\/([^\/]+)\/?.*/i,this._gwGroup=/http.+\/groups\/([^\/]+)\/?.*/i,this._rePortalTokenSvc=/\/sharing(\/rest)?\/generatetoken/i,this._createDefaultOAuthInfo=!0,this._hasTestedIfAppIsOnPortal=!1,this._getOAuthLocationParams(),window.addEventListener("pageshow",e=>{this._pageShowHandler(e)})}registerServers(e){const i=this.serverInfos;i?(e=e.filter(r=>!this.findServerInfo(r.server)),this.serverInfos=i.concat(e)):this.serverInfos=e,e.forEach(r=>{r.owningSystemUrl&&this._portals.push(r.owningSystemUrl),r.hasPortal&&this._portals.push(r.server)})}registerOAuthInfos(e){const i=this.oAuthInfos;if(i){for(const r of e){const n=this.findOAuthInfo(r.portalUrl);n&&i.splice(i.indexOf(n),1)}this.oAuthInfos=i.concat(e)}else this.oAuthInfos=e}registerToken(e){e={...e};const i=this._sanitizeUrl(e.server),r=this._isServerRsrc(i);let n,s=this.findServerInfo(i),o=!0;s||(s=new Wz,s.server=this._getServerInstanceRoot(i),r?s.hasServer=!0:(s.tokenServiceUrl=this._getTokenSvcUrl(i),s.hasPortal=!0),this.registerServers([s])),n=this._findCredential(i),n?(delete e.server,Object.assign(n,e),o=!1):(n=new On({userId:e.userId,server:s.server,token:e.token,expires:e.expires,ssl:e.ssl,scope:r?"server":"portal"}),n.resources=[i],this.credentials.push(n)),n.emitTokenChange(!1),o||n.refreshServerTokens()}toJSON(){return u4({serverInfos:this.serverInfos.map(e=>e.toJSON()),oAuthInfos:this.oAuthInfos.map(e=>e.toJSON()),credentials:this.credentials.map(e=>e.toJSON())})}initialize(e){if(!e)return;typeof e=="string"&&(e=JSON.parse(e));const i=e.serverInfos,r=e.oAuthInfos,n=e.credentials;if(i){const s=[];i.forEach(o=>{o.server&&o.tokenServiceUrl&&s.push(o.declaredClass?o:new Wz(o))}),s.length&&this.registerServers(s)}if(r){const s=[];r.forEach(o=>{o.appId&&s.push(o.declaredClass?o:new gH(o))}),s.length&&this.registerOAuthInfos(s)}n&&n.forEach(s=>{s.server&&s.token&&s.expires&&s.expires>Date.now()&&((s=s.declaredClass?s:new On(s)).emitTokenChange(),this.credentials.push(s))})}findServerInfo(e){let i;e=this._sanitizeUrl(e);for(const r of this.serverInfos)if(this._hasSameServerInstance(r.server,e)){i=r;break}return i}findOAuthInfo(e){let i;e=this._sanitizeUrl(e);for(const r of this.oAuthInfos)if(this._hasSameServerInstance(r.portalUrl,e)){i=r;break}return i}findCredential(e,i){if(!e)return;let r;e=this._sanitizeUrl(e);const n=this._isServerRsrc(e)?"server":"portal";if(i){for(const s of this.credentials)if(this._hasSameServerInstance(s.server,e)&&i===s.userId&&s.scope===n){r=s;break}}else for(const s of this.credentials)if(this._hasSameServerInstance(s.server,e)&&this._getIdenticalSvcIdx(e,s)!==-1&&s.scope===n){r=s;break}return r}getCredential(e,i){let r,n,s=!0;i&&(r=!!i.token,n=i.error,s=i.prompt!==!1),i={...i},e=this._sanitizeUrl(e);const o=new AbortController,a=vs();if(i.signal&&os(i.signal,()=>{o.abort()}),os(o,()=>{a.reject(new W("identity-manager:user-aborted","ABORTED"))}),Hn(o))return a.promise;i.signal=o.signal;const l=this._isAdminResource(e),c=r?this.findCredential(e):null;let u;if(c&&n&&n.details&&n.details.httpStatus===498)c.destroy();else if(c)return u=new W("identity-manager:not-authorized","You are currently signed in as: '"+c.userId+"'. You do not have access to this resource: "+e,{error:n}),a.reject(u),a.promise;const d=this._findCredential(e,i);if(d)return a.resolve(d),a.promise;let p=this.findServerInfo(e);if(p)!p.hasPortal&&p.server&&p.owningSystemUrl&&this._hasSameServerInstance(p.server,p.owningSystemUrl)&&(p.hasPortal=!0),!p.hasServer&&this._isServerRsrc(e)&&(p._restInfoPms=this._getTokenSvcUrl(e),p.hasServer=!0);else{const m=this._getTokenSvcUrl(e);if(!m)return u=new W("identity-manager:unknown-resource","Unknown resource - could not find token service endpoint."),a.reject(u),a.promise;p=new Wz,p.server=this._getServerInstanceRoot(e),typeof m=="string"?(p.tokenServiceUrl=m,p.hasPortal=!0):(p._restInfoPms=m,p.hasServer=!0),this.registerServers([p])}return p.hasPortal&&p._selfReq===void 0&&(s||Ul(p.tokenServiceUrl,this._appOrigin)||this._gwDomains.some(m=>m.tokenServiceUrl===p.tokenServiceUrl))&&(p._selfReq={owningTenant:i?.owningTenant,selfDfd:this._getPortalSelf(p.tokenServiceUrl.replace(this._rePortalTokenSvc,"/sharing/rest/portals/self"),e)}),this._enqueue(e,p,i,a,l)}getResourceName(e){return this._isRESTService(e)?e.replace(this._regexSDirUrl,"").replace(this._regexServerType,"")||"":this._gwUser.test(e)&&e.replace(this._gwUser,"$1")||this._gwItem.test(e)&&e.replace(this._gwItem,"$1")||this._gwGroup.test(e)&&e.replace(this._gwGroup,"$1")||""}generateToken(e,i,r){const n=this._rePortalTokenSvc.test(e.tokenServiceUrl),s=new Wl(this._appOrigin),o=e.shortLivedTokenValidity;let a,l,c,u,d,p,m,y;i&&(y=this.tokenValidity||o||this._defaultTokenValidity,y>o&&o>0&&(y=o)),r&&(a=r.isAdmin,l=r.serverUrl,c=r.token,p=r.signal,m=r.ssl,e.customParameters=r.customParameters),a?u=e.adminTokenServiceUrl:(u=e.tokenServiceUrl,d=new Wl(u.toLowerCase()),e.webTierAuth&&r?.serverUrl&&!m&&s.scheme==="http"&&(Ul(s.uri,u,!0)||d.scheme==="https"&&s.host===d.host&&s.port==="7080"&&d.port==="7443")&&(u=u.replace(/^https:/i,"http:").replace(/:7443/i,":7080")));const _={query:{request:"getToken",username:i?.username,password:i?.password,serverUrl:l,token:c,expiration:y,referer:a||n?this._appOrigin:null,client:a?"referer":null,f:"json",...e.customParameters},method:"post",authMode:"anonymous",useProxy:this._useProxy(e,r),signal:p,...r?.ioArgs};return n||(_.withCredentials=!1),Ii(u,_).then(v=>{const w=v.data;if(!w?.token)return new W("identity-manager:authentication-failed","Unable to generate token");const x=e.server;return cD[x]||(cD[x]={}),i&&(cD[x][i.username]=i.password),w.validity=y,w})}isBusy(){return!!this._busy}checkSignInStatus(e){return this.checkAppAccess(e,"").then(i=>i.credential)}checkAppAccess(e,i,r){let n=!1;return this.getCredential(e,{prompt:!1}).then(s=>{let o;const a={f:"json"};if(s.scope==="portal")if(i&&(this._doPortalSignIn(e)||r?.force))o=s.server+"/sharing/rest/oauth2/validateAppAccess",a.client_id=i;else{if(!s.token)return{credential:s};o=s.server+"/sharing/rest"}else{if(!s.token)return{credential:s};o=s.server+"/rest/services"}return s.token&&(a.token=s.token),Ii(o,{query:a,authMode:"anonymous"}).then(l=>{if(l.data.valid===!1)throw new W("identity-manager:not-authorized",`You are currently signed in as: '${s.userId}'.`,l.data);return n=!!l.data.viewOnlyUserTypeApp,{credential:s}}).catch(l=>{if(l.name==="identity-manager:not-authorized")throw l;const c=l.details?.httpStatus;if(c===498)throw s.destroy(),new W("identity-manager:not-authenticated","User is not signed in.");if(c===400)throw new W("identity-manager:invalid-request");return{credential:s}})}).then(s=>({credential:s.credential,viewOnly:n}))}setOAuthResponseHash(e){e&&(e.charAt(0)==="#"&&(e=e.substring(1)),this._processOAuthPopupParams(F1(e)))}setOAuthRedirectionHandler(e){this._oAuthRedirectFunc=e}setProtocolErrorHandler(e){this._protocolFunc=e}signIn(e,i,r={}){const n=vs(),s=()=>{l?.remove(),c?.remove(),u?.remove(),a?.destroy(),this.dialog?.destroy(),this.dialog=a=l=c=u=null},o=()=>{s(),this._oAuthDfd=null,n.reject(new W("identity-manager:user-aborted","ABORTED"))};r.signal&&os(r.signal,()=>{o()});let a=new this.formConstructor;a.resource=this.getResourceName(e),a.server=i.server,this.dialog=new Rue,this.dialog.content=a,this.dialog.open=!0,this.emit("dialog-create");let l=a.on("cancel",o),c=le(()=>this.dialog.open,o),u=a.on("submit",d=>{this.generateToken(i,d,{isAdmin:r.isAdmin,signal:r.signal}).then(p=>{s();const m=new On({userId:d.username,server:i.server,token:p.token,expires:p.expires!=null?Number(p.expires):null,ssl:!!p.ssl,isAdmin:r.isAdmin,validity:p.validity});n.resolve(m)}).catch(p=>{a.error=p,a.signingIn=!1})});return n.promise}oAuthSignIn(e,i,r,n){this._oAuthDfd=vs();const s=this._oAuthDfd;let o;n?.signal&&os(n.signal,()=>{const y=this._oAuthDfd&&this._oAuthDfd.oAuthWin_;y&&!y.closed?y.close():this.dialog&&p()}),s.resUrl_=e,s.sinfo_=i,s.oinfo_=r;const a=r._oAuthCred;if(a.storage&&(r.flowType==="authorization-code"||r.flowType==="auto"&&i.currentVersion>=8.4)){let y=crypto.getRandomValues(new Uint8Array(32));o=Hk(y),a.codeVerifier=o,y=crypto.getRandomValues(new Uint8Array(32)),a.stateUID=Hk(y),a.save()||(a.codeVerifier=o=null)}else a.codeVerifier=null;let l,c,u,d;this._getCodeChallenge(o).then(y=>{const _=!n||n.oAuthPopupConfirmation!==!1;r.popup&&_?(l=new this.formConstructor,l.oAuthPrompt=!0,l.server=i.server,this.dialog=new Rue,this.dialog.content=l,this.dialog.open=!0,this.emit("dialog-create"),c=l.on("cancel",p),u=le(()=>this.dialog.open,p),d=l.on("submit",()=>{m(),this._doOAuthSignIn(e,i,r,y)})):this._doOAuthSignIn(e,i,r,y)});const p=()=>{m(),this._oAuthDfd=null,s.reject(new W("identity-manager:user-aborted","ABORTED"))},m=()=>{c?.remove(),u?.remove(),d?.remove(),l?.destroy(),this.dialog?.destroy(),this.dialog=null};return s.promise}destroyCredentials(){this.credentials&&this.credentials.slice().forEach(e=>{e.destroy()}),this.emit("credentials-destroy")}enablePostMessageAuth(e="https://www.arcgis.com/sharing/rest"){this._postMessageAuthHandle&&this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=sg(window,"message",i=>{if((i.origin===this._appOrigin||i.origin.endsWith(".arcgis.com"))&&i.data?.type==="arcgis:auth:requestCredential"){const r=i.source;this.getCredential(e).then(n=>{r.postMessage({type:"arcgis:auth:credential",credential:{expires:n.expires,server:n.server,ssl:n.ssl,token:n.token,userId:n.userId}},i.origin)}).catch(n=>{r.postMessage({type:"arcgis:auth:error",error:{name:n.name,message:n.message}},i.origin)})}})}disablePostMessageAuth(){this._postMessageAuthHandle&&(this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=null)}_getOAuthLocationParams(){let e=window.location.hash;if(e){e.charAt(0)==="#"&&(e=e.substring(1));const r=F1(e);let n=!1;if(r.access_token&&r.expires_in&&r.state&&r.hasOwnProperty("username"))try{r.state=JSON.parse(r.state),r.state.portalUrl&&(this._oAuthLocationParams=r,n=!0)}catch{}else if(r.error&&r.error_description&&(console.log("IdentityManager OAuth Error: ",r.error," - ",r.error_description),r.error==="access_denied"&&(n=!0,r.state)))try{r.state=JSON.parse(r.state)}catch{}n&&(window.location.hash=r.state?.hash||"")}let i=window.location.search;if(i){i.charAt(0)==="?"&&(i=i.substring(1));const r=F1(i);let n=!1;if(r.code&&r.state)try{r.state=JSON.parse(r.state),r.state.portalUrl&&r.state.uid&&(this._oAuthLocationParams=r,n=!0)}catch{}else if(r.error&&r.error_description&&(console.log("IdentityManager OAuth Error: ",r.error," - ",r.error_description),r.error==="access_denied"&&(n=!0,r.state)))try{r.state=JSON.parse(r.state)}catch{}if(n){const s={...r};["code","error","error_description","message_code","persist","state"].forEach(l=>{delete s[l]});const o=gb(s),a=window.location.pathname+(o?`?${o}`:"")+(r.state?.hash||"");window.history.replaceState(window.history.state,"",a)}}}_getOAuthToken(e,i,r,n,s){return e=e.replace(/^http:/i,"https:"),Ii(`${e}/sharing/rest/oauth2/token`,{authMode:"anonymous",method:"post",query:n&&s?{grant_type:"authorization_code",code:i,redirect_uri:n,client_id:r,code_verifier:s}:{grant_type:"refresh_token",refresh_token:i,client_id:r}}).then(o=>o.data)}_getCodeChallenge(e){if(e&&globalThis.isSecureContext){const i=new TextEncoder().encode(e);return crypto.subtle.digest("SHA-256",i).then(r=>Hk(new Uint8Array(r)))}return Promise.resolve(null)}_pageShowHandler(e){if(e.persisted&&this.isBusy()&&this._rejectOnPersistedPageShow){const i=new W("identity-manager:user-aborted","ABORTED");this._errbackFunc(i)}}_findCredential(e,i){let r,n,s,o,a=-1;const l=i?.token,c=i?.resource,u=this._isServerRsrc(e)?"server":"portal",d=this.credentials.filter(p=>this._hasSameServerInstance(p.server,e)&&p.scope===u);if(e=c||e,d.length)if(d.length===1){if(r=d[0],s=this.findServerInfo(r.server),n=s?.owningSystemUrl,o=n?this.findCredential(n,r.userId):void 0,a=this._getIdenticalSvcIdx(e,r),!l)return a===-1&&r.resources.push(e),this._addResource(e,o),r;a!==-1&&(r.resources.splice(a,1),this._removeResource(e,o))}else{let p,m;if(d.some(y=>(m=this._getIdenticalSvcIdx(e,y),m!==-1&&(p=y,s=this.findServerInfo(p.server),n=s?.owningSystemUrl,o=n?this.findCredential(n,p.userId):void 0,a=m,!0))),l)p&&(p.resources.splice(a,1),this._removeResource(e,o));else if(p)return this._addResource(e,o),p}}_findOAuthInfo(e){let i=this.findOAuthInfo(e);if(!i){for(const r of this.oAuthInfos)if(this._isIdProvider(r.portalUrl,e)){i=r;break}}return i}_addResource(e,i){i&&this._getIdenticalSvcIdx(e,i)===-1&&i.resources.push(e)}_removeResource(e,i){let r=-1;i&&(r=this._getIdenticalSvcIdx(e,i),r>-1&&i.resources.splice(r,1))}_useProxy(e,i){return i?.isAdmin&&!Ul(e.adminTokenServiceUrl,this._appOrigin)||!this._isPortalDomain(e.tokenServiceUrl)&&String(e.currentVersion)==="10.1"&&!Ul(e.tokenServiceUrl,this._appOrigin)}_getOrigin(e){const i=new Wl(e);return i.scheme+"://"+i.host+(i.port!=null?":"+i.port:"")}_getServerInstanceRoot(e){const i=e.toLowerCase();let r=i.indexOf(this._agsRest);return r===-1&&this._isAdminResource(e)&&(r=this._agsAdmin.test(e)?e.replace(this._agsAdmin,"$1").length:e.search(this._adminSvcs)),r!==-1||Hhe(i)||(r=i.indexOf("/sharing")),r===-1&&i.substr(-1)==="/"&&(r=i.length-1),r>-1?e.substring(0,r):e}_hasSameServerInstance(e,i){return e.substr(-1)==="/"&&(e=e.slice(0,-1)),e=e.toLowerCase(),i=this._getServerInstanceRoot(i).toLowerCase(),e=this._normalizeAGOLorgDomain(e),i=this._normalizeAGOLorgDomain(i),(e=e.substr(e.indexOf(":")))===(i=i.substr(i.indexOf(":")))}_normalizeAGOLorgDomain(e){const i=/^https?:\/\/(?:cdn|[a-z\d-]+\.maps)\.arcgis\.com/i,r=/^https?:\/\/(?:cdndev|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,n=/^https?:\/\/(?:cdnqa|[a-z\d-]+\.mapsqa)\.arcgis\.com/i;return i.test(e)?e=e.replace(i,"https://www.arcgis.com"):r.test(e)?e=e.replace(r,"https://devext.arcgis.com"):n.test(e)&&(e=e.replace(n,"https://qaext.arcgis.com")),e}_sanitizeUrl(e){const i=(Oi.request.proxyUrl||"").toLowerCase(),r=i?e.toLowerCase().indexOf(i+"?"):-1;return r!==-1&&(e=e.substring(r+i.length+1)),e=Dd(e),bn(e).path}_isRESTService(e){return e.includes(this._agsRest)}_isAdminResource(e){return this._agsAdmin.test(e)||this._adminSvcs.test(e)}_isServerRsrc(e){return this._isRESTService(e)||this._isAdminResource(e)}_isIdenticalService(e,i){let r=!1;if(this._isRESTService(e)&&this._isRESTService(i)){const n=this._getSuffix(e).toLowerCase(),s=this._getSuffix(i).toLowerCase();if(r=n===s,!r){const o=/(.*)\/(MapServer|FeatureServer|UtilityNetworkServer).*/gi;r=n.replaceAll(o,"$1")===s.replaceAll(o,"$1")}}else this._isAdminResource(e)&&this._isAdminResource(i)?r=!0:this._isServerRsrc(e)||this._isServerRsrc(i)||!this._isPortalDomain(e)||(r=!0);return r}_isPortalDomain(e){const i=new Wl(e.toLowerCase()),r=this._portalConfig;let n=this._gwDomains.some(s=>s.regex.test(i.uri));return!n&&r&&(n=this._hasSameServerInstance(this._getServerInstanceRoot(r.restBaseUrl),i.uri)),n||Oi.portalUrl&&(n=Ul(i,Oi.portalUrl,!0)),n||(n=this._portals.some(s=>this._hasSameServerInstance(s,i.uri))),n=n||this._agsPortal.test(i.path),n}_isIdProvider(e,i){let r=-1,n=-1;this._gwDomains.forEach((o,a)=>{r===-1&&o.regex.test(e)&&(r=a),n===-1&&o.regex.test(i)&&(n=a)});let s=!1;if(r>-1&&n>-1&&(r===0||r===4?n!==0&&n!==4||(s=!0):r===1?n!==1&&n!==2||(s=!0):r===2?n===2&&(s=!0):r===3&&n===3&&(s=!0)),!s){const o=this.findServerInfo(i),a=o?.owningSystemUrl;a&&lOe(o)&&this._isPortalDomain(a)&&this._isIdProvider(e,a)&&(s=!0)}return s}_getIdenticalSvcIdx(e,i){let r=-1;for(let n=0;n<i.resources.length;n++){const s=i.resources[n];if(this._isIdenticalService(e,s)){r=n;break}}return r}_getSuffix(e){return e.replace(this._regexSDirUrl,"").replace(this._regexServerType,"$1")}_getTokenSvcUrl(e){let i,r,n;if(this._isRESTService(e)||this._isAdminResource(e)){const s=this._getServerInstanceRoot(e);return i=s+"/admin/generateToken",r=Ii(e=s+"/rest/info",{query:{f:"json"}}).then(o=>o.data),{adminUrl:i,promise:r}}if(this._isPortalDomain(e)){let s="";if(this._gwDomains.some(o=>(o.regex.test(e)&&(s=o.tokenServiceUrl),!!s)),s||this._portals.some(o=>(this._hasSameServerInstance(o,e)&&(s=o+this._gwTokenUrl),!!s)),s||(n=e.toLowerCase().indexOf("/sharing"),n!==-1&&(s=e.substring(0,n)+this._gwTokenUrl)),s||(s=this._getOrigin(e)+this._gwTokenUrl),s){const o=new Wl(e).port;/^http:\/\//i.test(e)&&o==="7080"&&(s=s.replace(/:7080/i,":7443")),s=s.replace(/http:/i,"https:")}return s}if(e.toLowerCase().includes("premium.arcgisonline.com"))return"https://premium.arcgisonline.com/server/tokens"}_processOAuthResponseParams(e,i,r){const n=i._oAuthCred;if(e.code){const o=n.codeVerifier;return n.codeVerifier=null,n.stateUID=null,n.save(),this._getOAuthToken(r.server,e.code,i.appId,this._getRedirectURI(i,!0),o).then(a=>{const l=new On({userId:a.username,server:r.server,token:a.access_token,expires:Date.now()+1e3*a.expires_in,ssl:a.ssl,oAuthState:e.state,_oAuthCred:n});return i.userId=l.userId,n.storage=a.persist?uD:hD,n.refreshToken=a.refresh_token,n.token=null,n.expires=a.refresh_token_expires_in?Date.now()+1e3*a.refresh_token_expires_in:null,n.userId=l.userId,n.ssl=l.ssl,n.save(),l})}const s=new On({userId:e.username,server:r.server,token:e.access_token,expires:Date.now()+1e3*Number(e.expires_in),ssl:e.ssl==="true",oAuthState:e.state,_oAuthCred:n});return i.userId=s.userId,n.storage=e.persist?uD:hD,n.refreshToken=null,n.token=s.token,n.expires=s.expires,n.userId=s.userId,n.ssl=s.ssl,n.save(),Promise.resolve(s)}_processOAuthPopupParams(e){const i=this._oAuthDfd;if(this._oAuthDfd=null,i)if(clearInterval(this._oAuthIntervalId),this._oAuthOnPopupHandle?.remove(),e.error){const r=e.error==="access_denied",n=new W(r?"identity-manager:user-aborted":"identity-manager:authentication-failed",r?"ABORTED":"OAuth: "+e.error+" - "+e.error_description);i.reject(n)}else this._processOAuthResponseParams(e,i.oinfo_,i.sinfo_).then(r=>{i.resolve(r)}).catch(r=>{i.reject(r)})}_setOAuthResponseQueryString(e){e&&(e.charAt(0)==="?"&&(e=e.substring(1)),this._processOAuthPopupParams(F1(e)))}_exchangeToken(e,i,r){return Ii(`${e}/sharing/rest/oauth2/exchangeToken`,{authMode:"anonymous",method:"post",query:{f:"json",client_id:i,token:r}}).then(n=>n.data.token)}_getPlatformSelf(e,i){return e=e.replace(/^http:/i,"https:"),Ii(`${e}/sharing/rest/oauth2/platformSelf`,{authMode:"anonymous",headers:{"X-Esri-Auth-Client-Id":i,"X-Esri-Auth-Redirect-Uri":window.location.href.replace(/#.*$/,"")},method:"post",query:{f:"json",expiration:30},withCredentials:!0}).then(r=>r.data)}_getPortalSelf(e,i){let r;return this._gwDomains.some(n=>(n.regex.test(e)&&(r=n.customBaseUrl),!!r)),r?Promise.resolve({allSSL:!0,currentVersion:"8.4",customBaseUrl:r,portalMode:"multitenant",supportsOAuth:!0}):(this._appOrigin.startsWith("https:")?e=e.replace(/^http:/i,"https:").replace(/:7080/i,":7443"):/^http:/i.test(i)&&(e=e.replace(/^https:/i,"http:").replace(/:7443/i,":7080")),Ii(e,{query:{f:"json"},authMode:"anonymous",withCredentials:!0}).then(n=>n.data))}_doPortalSignIn(e){const i=this._portalConfig,r=window.location.href,n=this.findServerInfo(e);return!(!i&&!this._isPortalDomain(r)||!(n?n.hasPortal||n.owningSystemUrl&&this._isPortalDomain(n.owningSystemUrl):this._isPortalDomain(e))||!(this._isIdProvider(r,e)||i&&(this._hasSameServerInstance(this._getServerInstanceRoot(i.restBaseUrl),e)||this._isIdProvider(i.restBaseUrl,e))||Ul(r,e,!0)))}_checkProtocol(e,i,r,n){let s=!0;const o=n?i.adminTokenServiceUrl:i.tokenServiceUrl;return o.trim().toLowerCase().startsWith("https:")&&!this._appOrigin.startsWith("https:")&&rR(o)&&(s=!!this._protocolFunc&&!!this._protocolFunc({resourceUrl:e,serverInfo:i}),!s)&&r(new W("identity-manager:aborted","Aborted the Sign-In process to avoid sending password over insecure connection.")),s}_enqueue(e,i,r,n,s,o){return n||(n=vs()),n.resUrl_=e,n.sinfo_=i,n.options_=r,n.admin_=s,n.refresh_=o,this._busy?this._hasSameServerInstance(this._getServerInstanceRoot(e),this._busy.resUrl_)?(this._oAuthDfd&&this._oAuthDfd.oAuthWin_&&this._oAuthDfd.oAuthWin_.focus(),this._soReqs.push(n)):this._xoReqs.push(n):this._doSignIn(n),n.promise}_doSignIn(e){this._busy=e,this._rejectOnPersistedPageShow=!1;const i=c=>{const u=e.options_?.resource,d=e.resUrl_,p=e.refresh_;let m=!1;this.credentials.includes(c)||(p&&this.credentials.includes(p)?(p.userId=c.userId,p.token=c.token,p.expires=c.expires,p.validity=c.validity,p.ssl=c.ssl,p.creationTime=c.creationTime,m=!0,c=p):this.credentials.push(c)),c.resources||(c.resources=[]),c.resources.includes(u||d)||c.resources.push(u||d),c.scope=this._isServerRsrc(d)?"server":"portal",c.emitTokenChange();const y=this._soReqs,_={};this._soReqs=[],y.forEach(v=>{if(!this._isIdenticalService(d,v.resUrl_)){const w=this._getSuffix(v.resUrl_);_[w]||(_[w]=!0,c.resources.push(v.resUrl_))}}),e.resolve(c),y.forEach(v=>{this._hasSameServerInstance(this._getServerInstanceRoot(d),v.resUrl_)?v.resolve(c):this._soReqs.push(v)}),this._busy=e.resUrl_=e.sinfo_=e.refresh_=null,m||this.emit("credential-create",{credential:c}),this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},r=c=>{e.reject(c),this._busy=e.resUrl_=e.sinfo_=e.refresh_=null,this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},n=(c,u,d,p)=>{const m=e.sinfo_,y=!e.options_||e.options_.prompt!==!1,_=m.hasPortal&&this._findOAuthInfo(e.resUrl_);let v,w;if(c)i(new On({userId:c,server:m.server,token:d||null,expires:p!=null?Number(p):null,ssl:!!u}));else if(window!==window.parent&&this._appUrlObj.query?.["arcgis-auth-origin"]&&this._appUrlObj.query?.["arcgis-auth-portal"]&&this._hasSameServerInstance(this._getServerInstanceRoot(this._appUrlObj.query["arcgis-auth-portal"]),e.resUrl_)){window.parent.postMessage({type:"arcgis:auth:requestCredential"},this._appUrlObj.query["arcgis-auth-origin"]);const x=sg(window,"message",T=>{T.source===window.parent&&T.data&&(T.data.type==="arcgis:auth:credential"?(x.remove(),T.data.credential.expires<Date.now()?r(new W("identity-manager:credential-request-failed","Parent application's token has expired.")):i(new On(T.data.credential))):T.data.type==="arcgis:auth:error"&&(x.remove(),T.data.error.name==="tokenExpiredError"?r(new W("identity-manager:credential-request-failed","Parent application's token has expired.")):r(W.fromJSON(T.data.error))))});os(e.options_?.signal,()=>{x.remove()})}else if(_){let x=_._oAuthCred;if(!x){const T=new fH(_,uD),S=new fH(_,hD);T.isValid()&&S.isValid()?T.expires>S.expires?(x=T,S.destroy()):(x=S,T.destroy()):x=T.isValid()?T:S,_._oAuthCred=x}if(x.isValid()){v=new On({userId:x.userId,server:m.server,token:x.token,expires:x.expires,ssl:x.ssl,_oAuthCred:x});const T=_.appId!==x.appId&&this._doPortalSignIn(e.resUrl_);T||x.refreshToken?(e._pendingDfd=x.refreshToken?this._getOAuthToken(m.server,x.refreshToken,x.appId).then(S=>(v.expires=Date.now()+1e3*S.expires_in,v.token=S.access_token,v)):Promise.resolve(v),e._pendingDfd.then(S=>T?this._exchangeToken(S.server,_.appId,S.token).then(E=>(S.token=E,S)).catch(()=>S):S).then(S=>{i(S)}).catch(()=>{x?.destroy(),n()})):i(v)}else if(this._oAuthLocationParams&&this._hasSameServerInstance(_.portalUrl,this._oAuthLocationParams.state.portalUrl)&&(this._oAuthLocationParams.access_token||this._oAuthLocationParams.code&&this._oAuthLocationParams.state.uid===x.stateUID&&x.codeVerifier)){const T=this._oAuthLocationParams;this._oAuthLocationParams=null,e._pendingDfd=this._processOAuthResponseParams(T,_,m).then(S=>{i(S)}).catch(r)}else{const T=()=>{y?e._pendingDfd=this.oAuthSignIn(e.resUrl_,m,_,e.options_).then(i,r):(w=new W("identity-manager:not-authenticated","User is not signed in."),r(w))};this._doPortalSignIn(e.resUrl_)?e._pendingDfd=this._getPlatformSelf(m.server,_.appId).then(S=>{Ul(S.portalUrl,this._appOrigin,!0)?(v=new On({userId:S.username,server:m.server,expires:Date.now()+1e3*S.expires_in,token:S.token}),i(v)):T()}).catch(T):T()}}else if(y){if(this._checkProtocol(e.resUrl_,m,r,e.admin_)){let x=e.options_;e.admin_&&(x=x||{},x.isAdmin=!0),e._pendingDfd=this.signIn(e.resUrl_,m,x).then(i,r)}}else w=new W("identity-manager:not-authenticated","User is not signed in."),r(w)},s=()=>{const c=e.sinfo_,u=c.owningSystemUrl,d=e.options_;let p,m,y,_;if(d&&(p=d.token,m=d.error,y=d.prompt),_=this._findCredential(u,{token:p,resource:e.resUrl_}),!_){for(const v of this.credentials)if(this._isIdProvider(u,v.server)){_=v;break}}if(_){const v=this.findCredential(e.resUrl_,_.userId);if(v)i(v);else if(yH(c,this._legacyFed)){const w=_.toJSON();w.server=c.server,w.resources=null,i(new On(w))}else(e._pendingDfd=this.generateToken(this.findServerInfo(_.server),null,{serverUrl:e.resUrl_,token:_.token,signal:e.options_.signal,ssl:_.ssl})).then(w=>{i(new On({userId:_?.userId,server:c.server,token:w.token,expires:w.expires!=null?Number(w.expires):null,ssl:!!w.ssl,isAdmin:e.admin_,validity:w.validity}))},r)}else this._busy=null,p&&(e.options_.token=null),(e._pendingDfd=this.getCredential(u.replace(/\/?$/,"/sharing"),{resource:e.resUrl_,owningTenant:c.owningTenant,signal:e.options_.signal,token:p,error:m,prompt:y})).then(()=>{this._enqueue(e.resUrl_,e.sinfo_,e.options_,e,e.admin_)},v=>{e.resUrl_=e.sinfo_=e.refresh_=null,e.reject(v)})};this._errbackFunc=r;const o=e.sinfo_.owningSystemUrl,a=this._isServerRsrc(e.resUrl_),l=e.sinfo_._restInfoPms;l?l.promise.then(c=>{const u=e.sinfo_;if(u._restInfoPms){u.adminTokenServiceUrl=u._restInfoPms.adminUrl,u._restInfoPms=null,u.tokenServiceUrl=(Km("authInfo.tokenServicesUrl",c)||Km("authInfo.tokenServiceUrl",c)||Km("tokenServiceUrl",c))??null,u.shortLivedTokenValidity=Km("authInfo.shortLivedTokenValidity",c)??null,u.currentVersion=c.currentVersion,u.owningTenant=c.owningTenant;const d=u.owningSystemUrl=c.owningSystemUrl;d&&this._portals.push(d)}a&&u.owningSystemUrl?s():n()},()=>{e.sinfo_._restInfoPms=null;const c=new W("identity-manager:server-identification-failed","Unknown resource - could not find token service endpoint.");r(c)}):a&&o?s():e.sinfo_._selfReq?e.sinfo_._selfReq.selfDfd.then(c=>{const u={};let d,p,m,y;return c&&(d=c.user?.username,u.username=d,u.allSSL=c.allSSL,p=c.supportsOAuth,y=parseFloat(c.currentVersion),c.portalMode==="multitenant"&&(m=c.customBaseUrl),e.sinfo_.currentVersion=y),e.sinfo_.webTierAuth=!!d,d&&this.normalizeWebTierAuth?this.generateToken(e.sinfo_,null,{ssl:u.allSSL}).catch(()=>null).then(_=>(u.portalToken=_&&_.token,u.tokenExpiration=_&&_.expires,u)):!d&&p&&y>=4.4&&!this._findOAuthInfo(e.resUrl_)?this._generateOAuthInfo({portalUrl:e.sinfo_.server,customBaseUrl:m,owningTenant:e.sinfo_._selfReq.owningTenant}).catch(()=>null).then(()=>u):u}).catch(()=>null).then(c=>{e.sinfo_._selfReq=null,c?n(c.username,c.allSSL,c.portalToken,c.tokenExpiration):n()}):n()}_generateOAuthInfo(e){let i,r=null,n=e.portalUrl;const s=e.customBaseUrl,o=e.owningTenant,a=!this._defaultOAuthInfo&&this._createDefaultOAuthInfo&&!this._hasTestedIfAppIsOnPortal;if(a){r=window.location.href;let l=r.indexOf("?");l>-1&&(r=r.slice(0,l)),l=r.search(/\/(apps|home)\//),r=l>-1?r.slice(0,l):null}return a&&r?(this._hasTestedIfAppIsOnPortal=!0,i=Ii(r+"/sharing/rest",{query:{f:"json"}}).then(()=>{this._defaultOAuthInfo=new gH({appId:"arcgisonline",popupCallbackUrl:r+"/home/oauth-callback.html"})})):i=Promise.resolve(),i.then(()=>{if(this._defaultOAuthInfo)return n=n.replace(/^http:/i,"https:"),Ii(n+"/sharing/rest/oauth2/validateRedirectUri",{query:{accountId:o,client_id:this._defaultOAuthInfo.appId,redirect_uri:La(this._defaultOAuthInfo.popupCallbackUrl),f:"json"}}).then(l=>{if(l.data.valid){const c=this._defaultOAuthInfo.clone();l.data.urlKey&&s?c.portalUrl="https://"+l.data.urlKey.toLowerCase()+"."+s:c.portalUrl=n,c.popup=window!==window.top||!(Ul(n,this._appOrigin)||this._gwDomains.some(u=>u.regex.test(n)&&u.regex.test(this._appOrigin))),this.oAuthInfos.push(c)}})})}_doOAuthSignIn(e,i,r,n){const s=r._oAuthCred,o={portalUrl:r.portalUrl};!r.popup&&r.preserveUrlHash&&window.location.hash&&(o.hash=window.location.hash),s.stateUID&&(o.uid=s.stateUID);const a={client_id:r.appId,response_type:s.codeVerifier?"code":"token",state:JSON.stringify(o),expiration:r.expiration,locale:r.locale,redirect_uri:this._getRedirectURI(r,!!s.codeVerifier)};r.forceLogin&&(a.force_login=!0),r.forceUserId&&r.userId&&(a.prepopulatedusername=r.userId),!r.popup&&this._doPortalSignIn(e)&&(a.redirectToUserOrgUrl=!0),s.codeVerifier&&(a.code_challenge=n||s.codeVerifier,a.code_challenge_method=n?"S256":"plain");const l=r.portalUrl.replace(/^http:/i,"https:")+"/sharing/oauth2/authorize",c=l+"?"+gb(a);if(r.popup){const u=window.open(c,"esriJSAPIOAuth",r.popupWindowFeatures);if(u)u.focus(),this._oAuthDfd.oAuthWin_=u,this._oAuthIntervalId=setInterval(()=>{if(u.closed){clearInterval(this._oAuthIntervalId),this._oAuthOnPopupHandle.remove();const d=this._oAuthDfd;if(d){const p=new W("identity-manager:user-aborted","ABORTED");d.reject(p)}}},500),this._oAuthOnPopupHandle=sg(window,["arcgis:auth:hash","arcgis:auth:location:search"],d=>{d.type==="arcgis:auth:hash"?this.setOAuthResponseHash(d.detail):this._setOAuthResponseQueryString(d.detail)});else{const d=new W("identity-manager:popup-blocked","ABORTED");this._oAuthDfd.reject(d)}}else this._rejectOnPersistedPageShow=!0,this._oAuthRedirectFunc?this._oAuthRedirectFunc({authorizeParams:a,authorizeUrl:l,resourceUrl:e,serverInfo:i,oAuthInfo:r}):window.location.href=c}_getRedirectURI(e,i){const r=window.location.href.replace(/#.*$/,"");if(e.popup)return La(e.popupCallbackUrl);if(i){const n=bn(r);return n.query&&["code","error","error_description","message_code","persist","state"].forEach(s=>{delete n.query[s]}),_I(n.path,n.query)}return r}}cOe.prototype.declaredClass="esri.identity.IdentityManagerBase";let On=class extends Tn.EventedAccessor{constructor(t){super(t),this._oAuthCred=null,this.tokenRefreshBuffer=2,t?._oAuthCred&&(this._oAuthCred=t._oAuthCred)}initialize(){this.resources=this.resources||[],this.creationTime==null&&(this.creationTime=Date.now())}refreshToken(){const t=li.findServerInfo(this.server),e=t?.owningSystemUrl,i=!!e&&this.scope==="server",r=i&&yH(t,li._legacyFed),n=t.webTierAuth,s=n&&li.normalizeWebTierAuth,o=cD[this.server],a=o?.[this.userId];let l,c=this.resources&&this.resources[0],u=i?li.findServerInfo(e):null,d={username:this.userId,password:a};if(n&&!s)return;i&&!u&&li.serverInfos.some(m=>(li._isIdProvider(e,m.server)&&(u=m),!!u));const p=u?li.findCredential(u.server,this.userId):null;if(!i||p){if(!r){if(i)l={serverUrl:c,token:p?.token,ssl:p&&p.ssl};else if(s)d=null,l={ssl:this.ssl};else{if(!a){let m;return c&&(c=li._sanitizeUrl(c),this._enqueued=1,m=li._enqueue(c,t,null,null,this.isAdmin,this),m.then(()=>{this._enqueued=0,this.refreshServerTokens()}).catch(()=>{this._enqueued=0})),m}this.isAdmin&&(l={isAdmin:!0})}return li.generateToken(i?u:t,i?null:d,l).then(m=>{this.token=m.token,this.expires=m.expires!=null?Number(m.expires):null,this.creationTime=Date.now(),this.validity=m.validity,this.emitTokenChange(),this.refreshServerTokens()}).catch(()=>{})}p?.refreshToken()}}refreshServerTokens(){this.scope==="portal"&&li.credentials.forEach(t=>{const e=li.findServerInfo(t.server),i=e?.owningSystemUrl;t!==this&&t.userId===this.userId&&i&&t.scope==="server"&&(li._hasSameServerInstance(this.server,i)||li._isIdProvider(i,this.server))&&(yH(e,li._legacyFed)?(t.token=this.token,t.expires=this.expires,t.creationTime=this.creationTime,t.validity=this.validity,t.emitTokenChange()):t.refreshToken())})}emitTokenChange(t){clearTimeout(this._refreshTimer);const e=this.server?li.findServerInfo(this.server):null,i=e?.owningSystemUrl,r=i?li.findServerInfo(i):null;t===!1||i&&this.scope!=="portal"&&(!r?.webTierAuth||li.normalizeWebTierAuth)||this.expires==null&&this.validity==null||this._startRefreshTimer(),this.emit("token-change")}destroy(){this.userId=this.server=this.token=this.expires=this.validity=this.resources=this.creationTime=null,this._oAuthCred&&(this._oAuthCred.destroy(),this._oAuthCred=null);const t=li.credentials.indexOf(this);t>-1&&li.credentials.splice(t,1),this.emitTokenChange(),this.emit("destroy")}toJSON(){const t=u4({userId:this.userId,server:this.server,token:this.token,expires:this.expires,validity:this.validity,ssl:this.ssl,isAdmin:this.isAdmin,creationTime:this.creationTime,scope:this.scope}),e=this.resources;return e&&e.length>0&&(t.resources=e.slice()),t}_startRefreshTimer(){clearTimeout(this._refreshTimer);const t=6e4*this.tokenRefreshBuffer,e=2**31-1;let i=(this.validity?this.creationTime+6e4*this.validity:this.expires)-Date.now();i<0?i=0:i>e&&(i=e),this._refreshTimer=setTimeout(this.refreshToken.bind(this),i>t?i-t:i)}};h([f()],On.prototype,"creationTime",void 0),h([f()],On.prototype,"expires",void 0),h([f()],On.prototype,"isAdmin",void 0),h([f()],On.prototype,"oAuthState",void 0),h([f()],On.prototype,"resources",void 0),h([f()],On.prototype,"scope",void 0),h([f()],On.prototype,"server",void 0),h([f()],On.prototype,"ssl",void 0),h([f()],On.prototype,"token",void 0),h([f()],On.prototype,"tokenRefreshBuffer",void 0),h([f()],On.prototype,"userId",void 0),h([f()],On.prototype,"validity",void 0),On=h([z("esri.identity.Credential")],On);class uOe extends cOe{}uOe.prototype.declaredClass="esri.identity.IdentityManager";const hb=new uOe;rMe(hb);const TTt=Object.freeze(Object.defineProperty({__proto__:null,default:hb},Symbol.toStringTag,{value:"Module"}));var STt=Object.defineProperty,ETt=Object.getOwnPropertyDescriptor,pJ=(t,e,i,r)=>{for(var n=r>1?void 0:r?ETt(e,i):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(n=(r?o(e,i,n):o(n))||n);return r&&n&&STt(e,i,n),n};const hOe=new gH({appId:"KojZjH6glligLidj",popup:!0,popupCallbackUrl:`${document.location.origin}${document.location.pathname}oauth-callback-api.html`});hb.registerOAuthInfos([hOe]);window.setOAuthResponseHash=t=>{hb.setOAuthResponseHash(t)};let XO=class extends xe{constructor(){super(),hb.on("credential-create",t=>{const e=new ia;e.authMode="immediate",e.load().then(()=>{this.user=e.user})})}get authenticated(){return!!this.user}signIn(){hb.getCredential(hOe.portalUrl+"/sharing",{oAuthPopupConfirmation:!1})}signOut(){hb.destroyCredentials(),this.user=null}};pJ([f()],XO.prototype,"authenticated",1);pJ([f()],XO.prototype,"user",2);XO=pJ([z("arcgis-core-template.UserStore")],XO);const CTt=XO;var ATt=Object.defineProperty,OTt=Object.getOwnPropertyDescriptor,nP=(t,e,i,r)=>{for(var n=r>1?void 0:r?OTt(e,i):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(n=(r?o(e,i,n):o(n))||n);return r&&n&&ATt(e,i,n),n};let ew=class extends xe{constructor(t){super(t),this.userStore=new CTt,this.playerStore=new Y2t({view:t.view}),Tg(()=>this.map).then(async e=>{await e.load(),document.title=e.portalItem.title,await e.loadAll(),this.playerStore.slides=e.presentation.slides})}};nP([f({aliasOf:"view.map"})],ew.prototype,"map",2);nP([f({constructOnly:!0})],ew.prototype,"view",2);nP([f({constructOnly:!0})],ew.prototype,"userStore",2);nP([f({constructOnly:!0})],ew.prototype,"playerStore",2);ew=nP([z("arcgis-core-template.AppStore")],ew);const RTt=ew;console.log(`Using ArcGIS Maps SDK for JavaScript v${_4}`);const PTt=new URLSearchParams(document.location.search.slice(1)),MTt=PTt.get("webscene")||"91b46c2b162c48dba264b2190e1dbcff",$Tt=new x5e({portalItem:{id:MTt}}),dOe=new C1t({container:"viewDiv",map:$Tt});window.view=dOe;const ITt=new RTt({view:dOe});new H2t({container:"app",store:ITt});export{Igt as $,TCe as A,Gmt as B,Uve as C,ZN as D,hje as E,bZe as F,BKe as G,NKe as H,pmt as I,cdt as J,ldt as K,bk as L,udt as M,eit as N,a5 as O,ygt as P,MCe as Q,bgt as R,k7e as S,ACe as T,OCe as U,mgt as V,rf as W,jZ as X,Egt as Y,Mgt as Z,xEe as _,xve as a,O as a$,Dgt as a0,hKe as a1,bKe as a2,SX as a3,Sk as a4,Wgt as a5,Oit as a6,jCe as a7,Zgt as a8,y0t as a9,tw as aA,Jpe as aB,Hd as aC,ac as aD,Xy as aE,jH as aF,ft as aG,le as aH,qi as aI,vg as aJ,sj as aK,Lb as aL,$ht as aM,Yi as aN,S_ as aO,nc as aP,Hn as aQ,y3 as aR,CH as aS,Mi as aT,Io as aU,N4 as aV,kr as aW,db as aX,Jue as aY,dc as aZ,Wn as a_,$nt as aa,Ast as ab,dlt as ac,Mlt as ad,Elt as ae,Ud as af,Zi as ag,h as ah,f as ai,Mf as aj,z as ak,Pq as al,Pe as am,RK as an,xe as ao,tfe as ap,wht as aq,Jt as ar,W as as,T_ as at,Ii as au,bht as av,gb as aw,pe as ax,Et as ay,Ni as az,XGe as b,It as b$,ke as b0,_S as b1,ns as b2,KX as b3,yw as b4,Nt as b5,Hr as b6,wn as b7,EMt as b8,TO as b9,hh as bA,mb as bB,vW as bC,Ye as bD,Fy as bE,_W as bF,qge as bG,M6e as bH,ow as bI,bR as bJ,_t as bK,cu as bL,iAt as bM,age as bN,Nrt as bO,que as bP,rW as bQ,Pb as bR,qCt as bS,yR as bT,jd as bU,ra as bV,dq as bW,Kt as bX,_e as bY,rF as bZ,rw as b_,CMt as ba,vr as bb,Do as bc,je as bd,Yd as be,nt as bf,ge as bg,oe as bh,ne as bi,C as bj,J3 as bk,Fn as bl,jLt as bm,HLt as bn,iJe as bo,Rg as bp,lIt as bq,PNt as br,h5t as bs,ut as bt,nR as bu,Ct as bv,c5t as bw,Q$e as bx,ZCt as by,Mke as bz,Nve as c,Lke as c$,Yz as c0,Pue as c1,Tke as c2,fge as c3,hAt as c4,dAt as c5,oAt as c6,iO as c7,eW as c8,uAt as c9,MFe as cA,s_ as cB,GCt as cC,VCt as cD,BCt as cE,uo as cF,$e as cG,ye as cH,KSe as cI,ie as cJ,aa as cK,uu as cL,CQe as cM,Rq as cN,Cb as cO,U4 as cP,Ohe as cQ,jAt as cR,Zfe as cS,zSt as cT,mu as cU,SQe as cV,dCt as cW,Xke as cX,gge as cY,rAt as cZ,yAt as c_,mB as ca,WCt as cb,TFe as cc,MR as cd,lt as ce,Ad as cf,IS as cg,Xi as ch,dL as ci,Vq as cj,pCt as ck,S4 as cl,di as cm,Oi as cn,bCt as co,pEt as cp,CSt as cq,li as cr,ia as cs,Dd as ct,Mde as cu,VPe as cv,IJ as cw,lAt as cx,cAt as cy,zCt as cz,l1e as d,Oq as d$,aN as d0,oN as d1,JCt as d2,nAt as d3,FD as d4,qDe as d5,RS as d6,sNt as d7,OEt as d8,_Ve as d9,cNe as dA,Gq as dB,zf as dC,ASt as dD,tMe as dE,cCt as dF,yg as dG,nLe as dH,ipe as dI,rpe as dJ,tr as dK,gI as dL,NJe as dM,ds as dN,ZO as dO,LAt as dP,DLt as dQ,Gt as dR,mh as dS,kCt as dT,w3t as dU,Fd as dV,yb as dW,U$ as dX,Aq as dY,Cq as dZ,Xpe as d_,gNe as da,Tg as db,yCt as dc,BFt as dd,TZ as de,v4 as df,Tn as dg,ua as dh,gi as di,sR as dj,eut as dk,$Me as dl,Ut as dm,sNe as dn,F0e as dp,Che as dq,p4 as dr,Bq as ds,jT as dt,eO as du,DDe as dv,Oy as dw,Qc as dx,lNe as dy,q3 as dz,FHe as e,qPe as e$,BEt as e0,KEe as e1,$Et as e2,Y1 as e3,hR as e4,GT as e5,Hf as e6,wB as e7,Rn as e8,bB as e9,aAt as eA,WQe as eB,YQe as eC,uR as eD,a2e as eE,RLt as eF,OLt as eG,W3 as eH,jb as eI,__ as eJ,Ske as eK,mAt as eL,xke as eM,fAt as eN,ta as eO,QIe as eP,PLt as eQ,MQe as eR,pC as eS,jr as eT,Hi as eU,Db as eV,bf as eW,Sh as eX,mn as eY,XD as eZ,jTt as e_,TB as ea,LD as eb,gfe as ec,fEt as ed,RO as ee,J$e as ef,Ebt as eg,Cbt as eh,lbt as ei,Ba as ej,dNe as ek,PSt as el,bn as em,hEt as en,eu as eo,zTt as ep,Pmt as eq,Mmt as er,Tmt as es,SUt as et,E5 as eu,I6t as ev,Imt as ew,UTe as ex,BMe as ey,qq as ez,WHe as f,X3e as f$,Ul as f0,UH as f1,kOe as f2,zq as f3,TDe as f4,uCt as f5,rSt as f6,uMt as f7,PP as f8,y6e as f9,Rh as fA,Ws as fB,yu as fC,Ph as fD,M3e as fE,_u as fF,Mh as fG,$3e as fH,Hs as fI,Oh as fJ,qs as fK,H as fL,dH as fM,kk as fN,em as fO,hJ as fP,hc as fQ,Ji as fR,F_ as fS,N_ as fT,k_ as fU,eE as fV,k0 as fW,yo as fX,dJ as fY,p2t as fZ,oa as f_,iR as fa,bFt as fb,gu as fc,tF as fd,RDe as fe,ODe as ff,KLe as fg,fK as fh,CCt as fi,WH as fj,L2 as fk,ENe as fl,b3t as fm,DD as fn,UCt as fo,Ln as fp,wd as fq,La as fr,rr as fs,PS as ft,Dfe as fu,pbt as fv,xw as fw,ln as fx,cn as fy,Wo as fz,EY as g,Bn as g$,ubt as g0,LTt as g1,$K as g2,yOe as g3,vCt as g4,bNe as g5,l9 as g6,FK as g7,dEt as g8,vNe as g9,aSe as gA,hZ as gB,Ab as gC,lSe as gD,jst as gE,bj as gF,pi as gG,pht as gH,wSt as gI,TPe as gJ,L6 as gK,fq as gL,Ob as gM,Mb as gN,fu as gO,hIt as gP,HTt as gQ,AB as gR,ao as gS,dN as gT,rO as gU,h4 as gV,JMe as gW,KMe as gX,QMe as gY,e$e as gZ,hJe as g_,UK as ga,vs as gb,tIe as gc,Qy as gd,ECt as ge,Wpt as gf,pAt as gg,Zct as gh,Jct as gi,MT as gj,SLe as gk,se as gl,Fe as gm,be as gn,fRe as go,$J as gp,ONt as gq,z3 as gr,E_ as gs,cUe as gt,FNe as gu,ESt as gv,$St as gw,oSe as gx,Kot as gy,uZ as gz,Bje as h,eBe as h$,HAt as h0,WAt as h1,p5t as h2,Z$e as h3,nIt as h4,Mwe as h5,gX as h6,sIt as h7,oIt as h8,ea as h9,G3t as hA,YW as hB,zs as hC,te as hD,ce as hE,oKe as hF,ls as hG,KJe as hH,TR as hI,qn as hJ,wq as hK,QB as hL,bg as hM,zMe as hN,uLt as hO,Uee as hP,R_ as hQ,fIt as hR,pIt as hS,vN as hT,m_ as hU,KN as hV,kR as hW,Zl as hX,yh as hY,si as hZ,tS as h_,pl as ha,qPt as hb,k4 as hc,Vs as hd,Jr as he,Z1 as hf,b4 as hg,nr as hh,os as hi,xg as hj,zn as hk,p8t as hl,qB as hm,ic as hn,Fi as ho,QJe as hp,JW as hq,xH as hr,TH as hs,wOe as ht,DTt as hu,VS as hv,ZH as hw,XW as hx,HW as hy,N3t as hz,oQe as i,nde as i$,BW as i0,Lpe as i1,QDe as i2,wdt as i3,l_t as i4,$q as i5,bd as i6,PK as i7,Iht as i8,iOt as i9,FUe as iA,Br as iB,lr as iC,Lj as iD,Dj as iE,hCt as iF,Rfe as iG,fCt as iH,mCt as iI,kNe as iJ,YCt as iK,XCt as iL,$b as iM,MAt as iN,n3 as iO,YV as iP,Hy as iQ,YB as iR,HEt as iS,Wl as iT,JPe as iU,Pf as iV,tR as iW,QS as iX,Owt as iY,Ok as iZ,Ak as i_,d4 as ia,X9e as ib,AK as ic,M2 as id,s9 as ie,mLt as ig,Nre as ih,vEt as ii,dLt as ij,Kc as ik,PEt as il,VEt as im,fDe as io,LEt as ip,MEt as iq,PB as ir,dl as is,br as it,xn as iu,RUe as iv,$d as iw,tp as ix,tb as iy,s3t as iz,_2e as j,ni as j$,oEe as j0,Hc as j1,REt as j2,A1e as j3,y$e as j4,IT as j5,_Lt as j6,Jy as j7,M8e as j8,lu as j9,_l as jA,XF as jB,Ft as jC,Ff as jD,y_ as jE,D_ as jF,KF as jG,Ua as jH,YX as jI,ZF as jJ,ae as jK,Tit as jL,_Y as jM,ZS as jN,Ke as jO,PF as jP,j$t as jQ,hwe as jR,uX as jS,Qnt as jT,tst as jU,BPt as jV,ep as jW,lk as jX,bhe as jY,fw as jZ,Ur as j_,NTt as ja,lSt as jb,TLt as jc,mi as jd,tc as je,ml as jf,b as jg,vn as jh,uc as ji,Je as jj,Oe as jk,U as jl,XN as jm,Jf as jn,Qe as jo,bi as jp,cc as jq,Te as jr,V as js,dr as jt,Ci as ju,wi as jv,Ot as jw,Wg as jx,CF as jy,L_ as jz,Ldt as k,YPt as k$,Pi as k0,Md as k1,Gr as k2,We as k3,ur as k4,out as k5,Me as k6,C8e as k7,Ty as k8,Gn as k9,OB as kA,MSt as kB,V3 as kC,SEt as kD,pr as kE,T0t as kF,T4 as kG,bq as kH,t6 as kI,yi as kJ,hW as kK,ude as kL,bW as kM,pq as kN,yOt as kO,i5 as kP,on as kQ,T2e as kR,Yg as kS,Pr as kT,Mt as kU,Cd as kV,he as kW,Pse as kX,Y2 as kY,Po as kZ,Gs as k_,ho as ka,KW as kb,o8t as kc,VNt as kd,Ylt as ke,cNt as kf,xNt as kg,lNt as kh,oNt as ki,F2 as kj,$rt as kk,aNt as kl,mfe as km,_I as kn,DQ as ko,GEt as kp,ZT as kq,DAt as kr,BTt as ks,_Ct as kt,OH as ku,Ib as kv,fD as kw,gCt as kx,cR as ky,Qd as kz,qet as l,Q3 as l$,Le as l0,lR as l1,Dte as l2,JTe as l3,QTe as l4,lst as l5,Ou as l6,T3 as l7,E3 as l8,RTe as l9,bT as lA,za as lB,px as lC,g4 as lD,_g as lE,sAt as lF,eAt as lG,MJ as lH,Wd as lI,pR as lJ,Zt as lK,Fa as lL,yLt as lM,KCt as lN,QCt as lO,tAt as lP,nO as lQ,W4 as lR,gAt as lS,Owe as lT,iCt as lU,XH as lV,nCt as lW,rCt as lX,lf as lY,fO as lZ,Mo as l_,Eot as la,Knt as lb,iet as lc,Ag as ld,c2e as le,_Et as lf,net as lg,Qst as lh,Wst as li,Yst as lj,tot as lk,Zst as ll,Jst as lm,Zd as ln,Xst as lo,la as lp,eot as lq,OR as lr,IF as ls,ws as lt,ret as lu,Kst as lv,DF as lw,Ce as lx,wh as ly,dw as lz,iTe as m,uEt as m$,pf as m0,Nn as m1,wR as m2,NNt as m3,mj as m4,_s as m5,Ed as m6,AEt as m7,i3t as m8,WY as m9,rwt as mA,gwt as mB,lH as mC,rH as mD,mbt as mE,oD as mF,N3 as mG,eJ as mH,I8t as mI,ST as mJ,L8t as mK,D8t as mL,Ace as mM,iE as mN,Pk as mO,iP as mP,Mk as mQ,Er as mR,Lk as mS,$k as mT,u3e as mU,ZR as mV,Ug as mW,W0e as mX,n8e as mY,d8t as mZ,qo as m_,aw as ma,_h as mb,wy as mc,Zr as md,L as me,qSt as mf,Km as mg,uhe as mh,nSt as mi,TEt as mj,UTt as mk,A8e as ml,ERe as mm,hSt as mn,uSt as mo,$Lt as mp,MLt as mq,dSt as mr,cSt as ms,Iue as mt,AOe as mu,FEt as mv,Y5 as mw,fwt as mx,L3e as my,pwt as mz,NGe as n,me as n$,B3 as n0,u5e as n1,GAt as n2,aet as n3,KSt as n4,ph as n5,Dg as n6,md as n7,Yl as n8,cY as n9,es as nA,Rt as nB,Uke as nC,Ky as nD,uUe as nE,uw as nF,f7e as nG,Ku as nH,Ue as nI,ri as nJ,gEt as nK,C4 as nL,qEt as nM,Bf as nN,OSt as nO,che as nP,E$e as nQ,kue as nR,Wb as nS,Khe as nT,zH as nU,SSt as nV,Gy as nW,VMe as nX,Ukt as nY,jJ as nZ,Efe as n_,lY as na,ape as nb,Ui as nc,h3t as nd,BUe as ne,lc as nf,VVe as ng,f8e as nh,v3t as ni,ai as nj,fi as nk,su as nl,Qt as nm,Ir as nn,$_ as no,P_ as np,ZOt as nq,pO as nr,KOt as ns,YOt as nt,b7 as nu,XOt as nv,BNt as nw,iq as nx,mEt as ny,nq as nz,Git as o,uZe as o$,D3t as o0,k3t as o1,$At as o2,u6e as o3,Qv as o4,LN as o5,Ki as o6,NAt as o7,H$t as o8,r1e as o9,np as oA,Ri as oB,vi as oC,i8t as oD,c5e as oE,O4t as oF,df as oG,oF as oH,Dpe as oI,Yxe as oJ,mA as oK,G0e as oL,f8t as oM,M7 as oN,vh as oO,rk as oP,$t as oQ,yl as oR,pc as oS,bl as oT,ha as oU,Xc as oV,o3t as oW,xR as oX,AF as oY,k1e as oZ,n3t as o_,Di as oa,Vr as ob,pxe as oc,zi as od,nu as oe,zB as of,Ub as og,RF as oh,Eh as oi,I_ as oj,po as ok,Ze as ol,B1e as om,Ti as on,we as oo,na as op,Mr as oq,Ige as or,U3t as os,z3t as ot,V3t as ou,uW as ov,Oo as ow,$0e as ox,Z4 as oy,et as oz,Xb as p,EW as p$,mje as p0,pu as p1,hPt as p2,cPt as p3,uPt as p4,bUe as p5,nT as p6,Vtt as p7,Gtt as p8,fS as p9,xEt as pA,wEt as pB,ht as pC,jee as pD,sJe as pE,rIt as pF,CW as pG,EEt as pH,bs as pI,a3t as pJ,EN as pK,yfe as pL,UEt as pM,Gee as pN,jf as pO,Fq as pP,vbe as pQ,fh as pR,Xd as pS,aS as pT,co as pU,JF as pV,Qbe as pW,mZe as pX,hX as pY,Rd as pZ,IAt as p_,Zc as pa,xJe as pb,xG as pc,jX as pd,zTe as pe,WNt as pf,$Te as pg,vj as ph,sZ as pi,NH as pj,gh as pk,nst as pl,ITe as pm,NTe as pn,sst as po,rst as pp,ost as pq,Vg as pr,ist as ps,Tte as pt,WRt as pu,hu as pv,P7 as pw,est as px,qRt as py,WLt as pz,opt as q,Sf as q$,JOt as q0,dO as q1,xb as q2,l3t as q3,Ek as q4,fN as q5,_it as q6,l8t as q7,xLt as q8,WT as q9,s2e as qA,t2e as qB,zA as qC,UA as qD,Bre as qE,oet as qF,cLt as qG,Wpe as qH,jEt as qI,rDe as qJ,IEt as qK,x$e as qL,R$e as qM,o2e as qN,tq as qO,rEt as qP,fve as qQ,hGe as qR,Da as qS,d3t as qT,BVe as qU,gS as qV,n_ as qW,Yr as qX,c3t as qY,u3t as qZ,a_ as q_,u8t as qa,c8t as qb,aR as qc,kEt as qd,HPt as qe,Vee as qf,Vp as qg,Xo as qh,Sge as qi,LBe as qj,dUe as qk,f0e as ql,eg as qm,zr as qn,kTe as qo,cst as qp,vH as qq,SBe as qr,RSt as qs,VRe as qt,Ay as qu,LLt as qv,Dre as qw,NLt as qx,CLt as qy,r2e as qz,VZ as r,AUe as r$,kte as r0,fo as r1,Yn as r2,HD as r3,ZSt as r4,XSt as r5,K3 as r6,ffe as r7,HDe as r8,J as r9,jDe as rA,Or as rB,I2 as rC,zT as rD,nxe as rE,TX as rF,LGe as rG,jTe as rH,sde as rI,N0e as rJ,a3 as rK,u5t as rL,KT as rM,kUe as rN,lg as rO,ik as rP,Wi as rQ,b6t as rR,BSt as rS,eR as rT,iSt as rU,gO as rV,dIt as rW,jve as rX,kye as rY,B3t as rZ,Uy as r_,DK as ra,Nge as rb,Gue as rc,TOe as rd,yEt as re,fb as rf,o9e as rg,n8t as rh,x$ as ri,R2e as rj,smt as rk,hUe as rl,F3t as rm,sCt as rn,Cee as ro,xT as rp,VPt as rq,JT as rr,In as rs,GSe as rt,kS as ru,Bt as rv,u2e as rw,h2e as rx,cIt as ry,pfe as rz,Umt as s,L4t as s$,kK as s0,CK as s1,lut as s2,ioe as s3,$ue as s4,bH as s5,ISt as s6,WOt as s7,aY as s8,qOt as s9,ru as sA,FFt as sB,T5 as sC,jl as sD,Hl as sE,Uj as sF,Fj as sG,zj as sH,kj as sI,moe as sJ,Qot as sK,WE as sL,Q4 as sM,iF as sN,eF as sO,_R as sP,Kke as sQ,yct as sR,mQe as sS,pQe as sT,C7e as sU,JIt as sV,ZIt as sW,Og as sX,ULt as sY,Us as sZ,Ro as s_,foe as sa,Nj as sb,qh as sc,x5 as sd,lO as se,PW as sf,FT as sg,CEt as sh,JWe as si,MW as sj,cpe as sk,NT as sl,L0e as sm,l8e as sn,Eg as so,dF as sp,NBe as sq,r3t as sr,zte as ss,WPt as st,QO as su,lw as sv,TMt as sw,ir as sx,g3t as sy,_Le as sz,bCe as t,VLt as t$,qX as t0,Lo as t1,gSt as t2,Vc as t3,wLt as t4,NK as t5,fLt as t6,VJe as t7,K4 as t8,US as t9,cKe as tA,Ic as tB,Li as tC,rp as tD,Zf as tE,hs as tF,Pt as tG,hr as tH,cg as tI,Df as tJ,Lt as tK,pt as tL,Ge as tM,ALt as tN,pw as tO,CNt as tP,bet as tQ,ANt as tR,d2e as tS,_St as tT,Ld as tU,uO as tV,_Ie as tW,BD as tX,A4 as tY,uet as tZ,cet as t_,_ct as ta,yX as tb,Dn as tc,Ict as td,g0e as te,Z_e as tf,TW as tg,Sb as th,W_e as ti,l7e as tj,Ng as tk,aF as tl,i3 as tm,uF as tn,j0e as to,p3t as tp,y7e as tq,HSt as tr,vLt as ts,zEt as tt,kTt as tu,nkt as tv,NEt as tw,bLt as tx,ql as ty,tSt as tz,e1e as u,Cae as u$,Yo as u0,d5t as u1,qAt as u2,LOe as u3,YAt as u4,eEt as u5,QSt as u6,tEt as u7,JRe as u8,RFt as u9,mRe as uA,fpt as uB,YU as uC,XU as uD,SLt as uE,$j as uF,o_ as uG,ZEe as uH,bpt as uI,WEe as uJ,Lpt as uK,sy as uL,IZ as uM,$Z as uN,koe as uO,ypt as uP,zoe as uQ,Srt as uR,Zrt as uS,EI as uT,oae as uU,tae as uV,tDe as uW,iae as uX,_ae as uY,rae as uZ,cae as u_,kFt as ua,vxe as ub,I1 as uc,goe as ud,OFt as ue,MFt as uf,$1 as ug,CFt as uh,W8 as ui,NL as uj,sa as uk,bh as ul,Oxe as um,Qu as un,Vut as uo,Gut as up,TQe as uq,Tge as ur,HOt as us,NA as ut,ZFe as uu,Lf as uv,h6e as uw,FLt as ux,ILt as uy,Y6e as uz,Xje as v,M8t as v$,Aae as v0,Oae as v1,Rae as v2,DEt as v3,FAt as v4,uNt as v5,wNt as v6,yae as v7,wae as v8,yNt as v9,hNt as vA,Zlt as vB,Ort as vC,nW as vD,jCt as vE,bw as vF,Xg as vG,Kvt as vH,Ne as vI,ka as vJ,cee as vK,S3t as vL,Pze as vM,ec as vN,Rze as vO,A1t as vP,SNt as vQ,a4 as vR,Dke as vS,LFe as vT,v_t as vU,pRe as vV,Ike as vW,lN as vX,uN as vY,VTt as vZ,b1t as v_,gNt as va,qlt as vb,_Nt as vc,vNt as vd,Lne as ve,Nne as vf,Dne as vg,fNt as vh,mNt as vi,Joe as vj,Voe as vk,Goe as vl,joe as vm,uae as vn,Fae as vo,zae as vp,Koe as vq,kae as vr,J4 as vs,hTe as vt,bNt as vu,Crt as vv,Art as vw,dNt as vx,pNt as vy,uTe as vz,Dve as w,v8t as w0,fee as w1,RNt as w2,ENt as w3,aW as w4,Vke as w5,Gke as w6,g1t as w7,h8t as w8,JSt as w9,SH as wA,AOt as wB,Lnt as wC,Hb as wD,oCt as wE,lCt as wF,aIt as wG,GLt as wH,YNt as wI,l5t as wJ,N8t as wK,YSt as wa,WSt as wb,R4 as wc,LDe as wd,Jtt as we,_Ot as wf,qy as wg,Dwe as wh,m3t as wi,Sg as wj,v7e as wk,ZC as wl,jy as wm,FB as wn,y3t as wo,f3t as wp,ZUe as wq,$Ue as wr,aq as ws,Ko as wt,EUe as wu,AW as wv,cEt as ww,tCt as wx,mo as wy,PT as wz,lje as x,o3 as y,Bmt as z};
