import{aA as t,dZ as L,av as s,dU as f,dV as T,aw as m,ax as y,gx as D}from"./index-23eb2934.js";const R={BingMapsLayer:async()=>(await t(()=>import("./BingMapsLayer-384d6dfa.js"),["./BingMapsLayer-384d6dfa.js","./index-23eb2934.js","./index-fa8fa232.css","./imageBitmapUtils-24eafb7f.js"],import.meta.url)).default,BuildingSceneLayer:async()=>(await t(()=>import("./BuildingSceneLayer-dd6b3cd6.js"),["./BuildingSceneLayer-dd6b3cd6.js","./index-23eb2934.js","./index-fa8fa232.css","./BuildingComponentSublayer-8ba5a8f7.js","./FeatureLayer-9a2a645a.js","./FeatureLayerBase-021dec0f.js","./LayerFloorInfo-a38be31b.js","./serviceCapabilitiesUtils-cf1ffce2.js","./editsZScale-0196ed43.js","./queryZScale-d82cfcd2.js","./FeatureSet-f1314e24.js","./APIKeyMixin-a3cb7f62.js","./EditBusLayer-25e739ba.js","./OrderedLayer-3cd52461.js","./FeatureTemplate-b2852f06.js","./FeatureType-2ce1fd8e.js","./versionUtils-440d720d.js","./TopFeaturesQuery-e59e7125.js","./capabilities-c607cf72.js","./I3SIndexInfo-2764020b.js","./I3SLayerDefinitions-8b6a0d7b.js","./I3SUtil-1c8b7211.js","./I3SBinaryReader-3a3e7bcb.js","./popupUtils-00bfb769.js","./BuildingGroupSublayer-e3077671.js","./SceneService-ff4d6062.js","./elevationInfoUtils-4737e990.js"],import.meta.url)).default,CSVLayer:async()=>(await t(()=>import("./CSVLayer-8de9e56e.js"),["./CSVLayer-8de9e56e.js","./index-23eb2934.js","./index-fa8fa232.css","./FeatureLayer-9a2a645a.js","./FeatureLayerBase-021dec0f.js","./LayerFloorInfo-a38be31b.js","./serviceCapabilitiesUtils-cf1ffce2.js","./editsZScale-0196ed43.js","./queryZScale-d82cfcd2.js","./FeatureSet-f1314e24.js","./APIKeyMixin-a3cb7f62.js","./EditBusLayer-25e739ba.js","./OrderedLayer-3cd52461.js","./FeatureTemplate-b2852f06.js","./FeatureType-2ce1fd8e.js","./versionUtils-440d720d.js","./TopFeaturesQuery-e59e7125.js","./clientSideDefaults-8c0f4c2b.js","./QueryEngineCapabilities-85c4f1d0.js"],import.meta.url)).default,DimensionLayer:async()=>(await t(()=>import("./DimensionLayer-790f5797.js"),["./DimensionLayer-790f5797.js","./index-23eb2934.js","./index-fa8fa232.css","./Analysis-4db3b1e6.js","./LengthDimension-457afb4e.js"],import.meta.url)).default,ElevationLayer:async()=>(await t(()=>import("./ElevationLayer-f0f089c9.js"),["./ElevationLayer-f0f089c9.js","./index-23eb2934.js","./index-fa8fa232.css","./ArcGISCachedService-4424e63c.js","./TileInfoTilemapCache-20e3ba25.js","./TilemapCache-64c28550.js"],import.meta.url)).default,FeatureLayer:async()=>(await t(()=>import("./FeatureLayer-9a2a645a.js"),["./FeatureLayer-9a2a645a.js","./index-23eb2934.js","./index-fa8fa232.css","./FeatureLayerBase-021dec0f.js","./LayerFloorInfo-a38be31b.js","./serviceCapabilitiesUtils-cf1ffce2.js","./editsZScale-0196ed43.js","./queryZScale-d82cfcd2.js","./FeatureSet-f1314e24.js","./APIKeyMixin-a3cb7f62.js","./EditBusLayer-25e739ba.js","./OrderedLayer-3cd52461.js","./FeatureTemplate-b2852f06.js","./FeatureType-2ce1fd8e.js","./versionUtils-440d720d.js","./TopFeaturesQuery-e59e7125.js"],import.meta.url)).default,GeoJSONLayer:async()=>(await t(()=>import("./GeoJSONLayer-935b37d7.js"),["./GeoJSONLayer-935b37d7.js","./index-23eb2934.js","./index-fa8fa232.css","./clientSideDefaults-8c0f4c2b.js","./QueryEngineCapabilities-85c4f1d0.js","./FeatureSet-f1314e24.js","./OrderedLayer-3cd52461.js","./FeatureTemplate-b2852f06.js","./FeatureType-2ce1fd8e.js"],import.meta.url)).default,GeoRSSLayer:async()=>(await t(()=>import("./GeoRSSLayer-ea2248c3.js"),["./GeoRSSLayer-ea2248c3.js","./index-23eb2934.js","./index-fa8fa232.css"],import.meta.url)).default,GroupLayer:async()=>(await t(()=>import("./GroupLayer-e8828abd.js"),["./GroupLayer-e8828abd.js","./index-23eb2934.js","./index-fa8fa232.css"],import.meta.url)).default,ImageryLayer:async()=>(await t(()=>import("./ImageryLayer-a99f49a2.js"),["./ImageryLayer-a99f49a2.js","./index-23eb2934.js","./index-fa8fa232.css","./ImageHistogramParameters-975cbc84.js","./dataUtils-c826a84b.js","./pixelRangeUtils-367cd051.js","./generateRendererUtils-3eb8ee30.js","./FeatureSet-f1314e24.js","./imageBitmapUtils-24eafb7f.js","./executeQueryJSON-14f07b8a.js","./query-edfc9ae0.js","./pbfQueryUtils-2a79a9a2.js","./pbf-25f22ae3.js","./queryZScale-d82cfcd2.js","./AttachmentInfo-f003b9a8.js","./executeForIds-6f1e6e3e.js","./TopFeaturesQuery-e59e7125.js","./versionUtils-440d720d.js"],import.meta.url)).default,ImageryTileLayer:async()=>(await t(()=>import("./ImageryTileLayer-4bc38b08.js"),["./ImageryTileLayer-4bc38b08.js","./index-23eb2934.js","./index-fa8fa232.css","./ImageHistogramParameters-975cbc84.js","./dataUtils-c826a84b.js","./pixelRangeUtils-367cd051.js","./generateRendererUtils-3eb8ee30.js","./FeatureSet-f1314e24.js","./rasterProjectionHelper-0d32afe9.js","./utils-fe2b49cc.js","./TilemapCache-64c28550.js"],import.meta.url)).default,IntegratedMeshLayer:async()=>(await t(()=>import("./IntegratedMeshLayer-d9adb0d1.js"),["./IntegratedMeshLayer-d9adb0d1.js","./index-23eb2934.js","./index-fa8fa232.css","./persistable-1a713f0b.js","./resourceExtension-7953bc1b.js","./APIKeyMixin-a3cb7f62.js","./SceneService-ff4d6062.js","./I3SIndexInfo-2764020b.js","./I3SLayerDefinitions-8b6a0d7b.js","./SceneModification-a92ba5f5.js","./elevationInfoUtils-4737e990.js"],import.meta.url)).default,KMLLayer:async()=>(await t(()=>import("./KMLLayer-79615614.js"),["./KMLLayer-79615614.js","./index-23eb2934.js","./index-fa8fa232.css","./FeatureSet-f1314e24.js"],import.meta.url)).default,LineOfSightLayer:async()=>(await t(()=>import("./LineOfSightLayer-949f7b11.js"),["./LineOfSightLayer-949f7b11.js","./index-23eb2934.js","./index-fa8fa232.css","./Analysis-4db3b1e6.js","./LineOfSightAnalysisTarget-fb985666.js","./persistable-1a713f0b.js","./resourceExtension-7953bc1b.js","./elevationInfoUtils-4737e990.js"],import.meta.url)).default,LinkChartLayer:async()=>(await t(()=>import("./LinkChartLayer-3b07b311.js"),["./LinkChartLayer-3b07b311.js","./index-23eb2934.js","./index-fa8fa232.css","./geohashUtils-77d8429b.js","./FeatureStore-a1073f60.js","./BoundsStore-c119242a.js","./PooledRBush-e692eae8.js","./quickselect-c2336d0d.js","./QueryEngine-4b08bd0a.js","./WhereClause-e5d88aed.js","./TimeOnly-825cc71c.js","./json-48e3ea08.js","./QueryEngineCapabilities-85c4f1d0.js","./utils-064259aa.js","./utils-da4779cb.js","./generateRendererUtils-3eb8ee30.js","./optimizedFeatureQueryEngineAdapter-4d2eebdd.js","./clientSideDefaults-8c0f4c2b.js","./FeatureSet-f1314e24.js"],import.meta.url)).default,MapImageLayer:async()=>(await t(()=>import("./MapImageLayer-9c9199f4.js"),["./MapImageLayer-9c9199f4.js","./index-23eb2934.js","./index-fa8fa232.css","./APIKeyMixin-a3cb7f62.js","./SublayersOwner-1b7cf215.js","./QueryTask-2c7d2663.js","./executeForIds-6f1e6e3e.js","./query-edfc9ae0.js","./pbfQueryUtils-2a79a9a2.js","./pbf-25f22ae3.js","./queryZScale-d82cfcd2.js","./executeQueryJSON-14f07b8a.js","./FeatureSet-f1314e24.js","./executeQueryPBF-c714d632.js","./FeatureType-2ce1fd8e.js","./FeatureTemplate-b2852f06.js","./LayerFloorInfo-a38be31b.js","./serviceCapabilitiesUtils-cf1ffce2.js","./sublayerUtils-136706db.js","./ExportImageParameters-dd3e046b.js","./floorFilterUtils-73949d2d.js","./imageBitmapUtils-24eafb7f.js","./versionUtils-440d720d.js"],import.meta.url)).default,MapNotesLayer:async()=>(await t(()=>import("./MapNotesLayer-38864691.js"),["./MapNotesLayer-38864691.js","./index-23eb2934.js","./index-fa8fa232.css","./FeatureLayer-9a2a645a.js","./FeatureLayerBase-021dec0f.js","./LayerFloorInfo-a38be31b.js","./serviceCapabilitiesUtils-cf1ffce2.js","./editsZScale-0196ed43.js","./queryZScale-d82cfcd2.js","./FeatureSet-f1314e24.js","./APIKeyMixin-a3cb7f62.js","./EditBusLayer-25e739ba.js","./OrderedLayer-3cd52461.js","./FeatureTemplate-b2852f06.js","./FeatureType-2ce1fd8e.js","./versionUtils-440d720d.js","./TopFeaturesQuery-e59e7125.js","./objectIdUtils-967fafff.js"],import.meta.url)).default,MediaLayer:async()=>(await t(()=>import("./MediaLayer-d3447bef.js"),["./MediaLayer-d3447bef.js","./index-23eb2934.js","./index-fa8fa232.css","./MediaElementView-041539dd.js","./normalizeUtilsSync-c1ffee37.js","./resourceExtension-7953bc1b.js","./BoundsStore-c119242a.js","./PooledRBush-e692eae8.js","./quickselect-c2336d0d.js"],import.meta.url)).default,OGCFeatureLayer:async()=>(await t(()=>import("./OGCFeatureLayer-c07cb24e.js"),["./OGCFeatureLayer-c07cb24e.js","./index-23eb2934.js","./index-fa8fa232.css","./ogcFeatureUtils-513e4ff1.js","./geojson-43e8a531.js","./date-430969b3.js","./clientSideDefaults-8c0f4c2b.js","./QueryEngineCapabilities-85c4f1d0.js","./FeatureSet-f1314e24.js","./APIKeyMixin-a3cb7f62.js","./OrderedLayer-3cd52461.js","./FeatureType-2ce1fd8e.js","./FeatureTemplate-b2852f06.js"],import.meta.url)).default,OpenStreetMapLayer:async()=>(await t(()=>import("./OpenStreetMapLayer-3c2bb037.js"),["./OpenStreetMapLayer-3c2bb037.js","./index-23eb2934.js","./index-fa8fa232.css","./WebTileLayer-f222ec55.js","./imageBitmapUtils-24eafb7f.js"],import.meta.url)).default,OrientedImageryLayer:async()=>(await t(()=>import("./OrientedImageryLayer-0337951f.js"),["./OrientedImageryLayer-0337951f.js","./index-23eb2934.js","./index-fa8fa232.css","./FeatureLayer-9a2a645a.js","./FeatureLayerBase-021dec0f.js","./LayerFloorInfo-a38be31b.js","./serviceCapabilitiesUtils-cf1ffce2.js","./editsZScale-0196ed43.js","./queryZScale-d82cfcd2.js","./FeatureSet-f1314e24.js","./APIKeyMixin-a3cb7f62.js","./EditBusLayer-25e739ba.js","./OrderedLayer-3cd52461.js","./FeatureTemplate-b2852f06.js","./FeatureType-2ce1fd8e.js","./versionUtils-440d720d.js","./TopFeaturesQuery-e59e7125.js"],import.meta.url)).default,PointCloudLayer:async()=>(await t(()=>import("./PointCloudLayer-8973f615.js"),["./PointCloudLayer-8973f615.js","./index-23eb2934.js","./index-fa8fa232.css","./APIKeyMixin-a3cb7f62.js","./SceneService-ff4d6062.js","./I3SIndexInfo-2764020b.js","./PointCloudUniqueValueRenderer-a9dde223.js","./elevationInfoUtils-4737e990.js"],import.meta.url)).default,RouteLayer:async()=>(await t(()=>import("./RouteLayer-2ee69c90.js"),["./RouteLayer-2ee69c90.js","./index-23eb2934.js","./index-fa8fa232.css","./Stop-16b5fb72.js","./FeatureSet-f1314e24.js"],import.meta.url)).default,SceneLayer:async()=>(await t(()=>import("./SceneLayer-94f6e768.js"),["./SceneLayer-94f6e768.js","./index-23eb2934.js","./index-fa8fa232.css","./APIKeyMixin-a3cb7f62.js","./EditBusLayer-25e739ba.js","./SceneService-ff4d6062.js","./I3SIndexInfo-2764020b.js","./capabilities-c607cf72.js","./I3SLayerDefinitions-8b6a0d7b.js","./LayerFloorInfo-a38be31b.js","./persistable-1a713f0b.js","./resourceExtension-7953bc1b.js","./elevationInfoUtils-4737e990.js","./I3SUtil-1c8b7211.js","./I3SBinaryReader-3a3e7bcb.js","./popupUtils-00bfb769.js"],import.meta.url)).default,StreamLayer:async()=>(await t(()=>import("./index-23eb2934.js").then(e=>e.y8),["./index-23eb2934.js","./index-fa8fa232.css"],import.meta.url)).default,SubtypeGroupLayer:async()=>(await t(()=>import("./SubtypeGroupLayer-b04f6991.js"),["./SubtypeGroupLayer-b04f6991.js","./index-23eb2934.js","./index-fa8fa232.css","./APIKeyMixin-a3cb7f62.js","./EditBusLayer-25e739ba.js","./FeatureLayerBase-021dec0f.js","./LayerFloorInfo-a38be31b.js","./serviceCapabilitiesUtils-cf1ffce2.js","./FeatureTemplate-b2852f06.js","./versionUtils-440d720d.js"],import.meta.url)).default,TileLayer:async()=>(await t(()=>import("./TileLayer-a2df370d.js"),["./TileLayer-a2df370d.js","./index-23eb2934.js","./index-fa8fa232.css","./APIKeyMixin-a3cb7f62.js","./ArcGISCachedService-4424e63c.js","./TileInfoTilemapCache-20e3ba25.js","./TilemapCache-64c28550.js","./SublayersOwner-1b7cf215.js","./QueryTask-2c7d2663.js","./executeForIds-6f1e6e3e.js","./query-edfc9ae0.js","./pbfQueryUtils-2a79a9a2.js","./pbf-25f22ae3.js","./queryZScale-d82cfcd2.js","./executeQueryJSON-14f07b8a.js","./FeatureSet-f1314e24.js","./executeQueryPBF-c714d632.js","./FeatureType-2ce1fd8e.js","./FeatureTemplate-b2852f06.js","./LayerFloorInfo-a38be31b.js","./serviceCapabilitiesUtils-cf1ffce2.js","./sublayerUtils-136706db.js","./imageBitmapUtils-24eafb7f.js"],import.meta.url)).default,UnknownLayer:async()=>(await t(()=>import("./UnknownLayer-150690c8.js"),["./UnknownLayer-150690c8.js","./index-23eb2934.js","./index-fa8fa232.css"],import.meta.url)).default,UnsupportedLayer:async()=>(await t(()=>import("./UnsupportedLayer-d37a1cb7.js"),["./UnsupportedLayer-d37a1cb7.js","./index-23eb2934.js","./index-fa8fa232.css"],import.meta.url)).default,VectorTileLayer:async()=>(await t(()=>import("./VectorTileLayer-9c242678.js"),["./VectorTileLayer-9c242678.js","./index-23eb2934.js","./index-fa8fa232.css","./APIKeyMixin-a3cb7f62.js","./ArcGISCachedService-4424e63c.js","./TileInfoTilemapCache-20e3ba25.js","./TilemapCache-64c28550.js","./jsonContext-4a6a64b6.js","./StyleRepository-faada9e9.js","./TileClipper-ae6eca9e.js","./definitions-66367ebf.js"],import.meta.url)).default,VoxelLayer:async()=>(await t(()=>import("./VoxelLayer-ecd4c364.js"),["./VoxelLayer-ecd4c364.js","./index-23eb2934.js","./index-fa8fa232.css","./APIKeyMixin-a3cb7f62.js","./SceneService-ff4d6062.js","./I3SIndexInfo-2764020b.js","./persistable-1a713f0b.js","./resourceExtension-7953bc1b.js"],import.meta.url)).default,WFSLayer:async()=>(await t(()=>import("./WFSLayer-5cf510c1.js"),["./WFSLayer-5cf510c1.js","./index-23eb2934.js","./index-fa8fa232.css","./clientSideDefaults-8c0f4c2b.js","./QueryEngineCapabilities-85c4f1d0.js","./wfsUtils-234d7c7a.js","./geojson-43e8a531.js","./date-430969b3.js","./xmlUtils-444cb4c0.js","./FeatureSet-f1314e24.js","./OrderedLayer-3cd52461.js"],import.meta.url)).default,WMSLayer:async()=>(await t(()=>import("./WMSLayer-c4705645.js"),["./WMSLayer-c4705645.js","./index-23eb2934.js","./index-fa8fa232.css","./crsUtils-3bab3d8c.js","./ExportWMSImageParameters-a6c4a5dc.js","./imageBitmapUtils-24eafb7f.js"],import.meta.url)).default,WMTSLayer:async()=>(await t(()=>import("./WMTSLayer-eae399ba.js"),["./WMTSLayer-eae399ba.js","./index-23eb2934.js","./index-fa8fa232.css","./WebTileLayer-f222ec55.js","./imageBitmapUtils-24eafb7f.js","./TileInfoTilemapCache-20e3ba25.js","./crsUtils-3bab3d8c.js","./xmlUtils-444cb4c0.js"],import.meta.url)).default,WebTileLayer:async()=>(await t(()=>import("./WebTileLayer-f222ec55.js").then(e=>e.W),["./WebTileLayer-f222ec55.js","./index-23eb2934.js","./index-fa8fa232.css","./imageBitmapUtils-24eafb7f.js"],import.meta.url)).default};async function S(e,i){const r=L(e);if(!r)throw new s("invalid-url","Invalid scene service url");const a={...i,sceneServerUrl:r.url.path,layerId:r.sublayer??void 0};if(a.sceneLayerItem??(a.sceneLayerItem=await A(a)),a.sceneLayerItem==null)return p(a.sceneServerUrl.replace("/SceneServer","/FeatureServer"),a);const o=await V(a);if(!o?.url)throw new s("related-service-not-found","Could not find feature service through portal item relationship");const _=await p(o.url,a);return _.portalItem=o,_}async function A(e){const i=(await E(e)).serviceItemId;if(!i)return null;const r=new f({id:i,apiKey:e.apiKey}),a=await O(e);a!=null&&(r.portal=new T({url:a}));try{return r.load({signal:e.signal})}catch(o){return m(o),null}}async function E(e){if(e.rootDocument)return e.rootDocument;const i={query:{f:"json",token:e.apiKey},responseType:"json",signal:e.signal};try{const r=await y(e.sceneServerUrl,i);e.rootDocument=r.data}catch{e.rootDocument={}}return e.rootDocument}async function O(e){const i=D?.findServerInfo(e.sceneServerUrl);if(i?.owningSystemUrl)return i.owningSystemUrl;const r=e.sceneServerUrl.replace(/(.*\/rest)\/.*/i,"$1")+"/info";try{const a=(await y(r,{query:{f:"json"},responseType:"json",signal:e.signal})).data.owningSystemUrl;if(a)return a}catch(a){m(a)}return null}async function p(e,i){const r=L(e);if(!r)throw new s("invalid-feature-service-url","Invalid feature service url");const a=r.url.path,o=i.layerId;if(o==null)return{serverUrl:a};const _=E(i),d=n=>{const I={query:{f:"json"},responseType:"json",authMode:n,signal:i.signal};return y(a,I)},v=d("anonymous").catch(()=>d("no-prompt")),[c,w]=await Promise.all([v,_]),l=w?.layers,u=c.data&&c.data.layers;if(!Array.isArray(u))throw new Error("expected layers array");if(Array.isArray(l)){for(let n=0;n<Math.min(l.length,u.length);n++)if(l[n].id===o)return{serverUrl:a,layerId:u[n].id}}else if(o!=null&&o<u.length)return{serverUrl:a,layerId:u[o].id};throw new Error("could not find matching associated sublayer")}async function V({sceneLayerItem:e,signal:i}){if(!e)return null;try{const r=(await e.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:i})).find(o=>o.type==="Feature Service")||null;if(!r)return null;const a=new f({portal:r.portal,id:r.id});return await a.load(),a}catch(r){return m(r),null}}export{R as a,S as l};
